# Issue 11334: Update numpy to 1.7.0

archive/issues_011162.json:
```json
{
    "body": "Numpy-1.7.0 is now available and fixes the coercion problem that prevented us to go to numpy-1.6.x.\n\nNew spkg: [http://spkg-upload.googlecode.com/files/numpy-1.7.0.spkg](http://spkg-upload.googlecode.com/files/numpy-1.7.0.spkg)\n\nApply:\n* [attachment:trac_11334-dtype_object.patch]\n* [attachment:trac_11334-matrix_plot.patch]\n* [attachment:trac_11334-typecodes.patch]\n* [attachment:trac_11334-suppressdivide.patch]\n* [attachment:trac_11334-divide-v2.patch]\n* [attachment:trac_11334-cubemarcher.patch]\n* [attachment:trac_11334-numericalnoise.patch]\n* [attachment:11334_noise2.patch]\n\nAssignee: tbd\n\nCC:  @kiwifb @kini snark\n\nKeywords: sd40.5\n\nUpstream: Fixed upstream, in a later stable release.\n\nReviewer: Steven Trogdon, Jeroen Demeyer\n\nAuthor: Fran\u00e7ois Bissey\n\nMerged: sage-5.10.beta0\n\nDependencies: #12415, #13992\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/11334\n\n",
    "closed_at": "2013-04-15T08:43:22Z",
    "created_at": "2011-05-14T15:26:29Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.10",
    "title": "Update numpy to 1.7.0",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11334",
    "user": "https://github.com/jasongrout"
}
```
Numpy-1.7.0 is now available and fixes the coercion problem that prevented us to go to numpy-1.6.x.

New spkg: [http://spkg-upload.googlecode.com/files/numpy-1.7.0.spkg](http://spkg-upload.googlecode.com/files/numpy-1.7.0.spkg)

Apply:
* [attachment:trac_11334-dtype_object.patch]
* [attachment:trac_11334-matrix_plot.patch]
* [attachment:trac_11334-typecodes.patch]
* [attachment:trac_11334-suppressdivide.patch]
* [attachment:trac_11334-divide-v2.patch]
* [attachment:trac_11334-cubemarcher.patch]
* [attachment:trac_11334-numericalnoise.patch]
* [attachment:11334_noise2.patch]

Assignee: tbd

CC:  @kiwifb @kini snark

Keywords: sd40.5

Upstream: Fixed upstream, in a later stable release.

Reviewer: Steven Trogdon, Jeroen Demeyer

Author: Fran√ßois Bissey

Merged: sage-5.10.beta0

Dependencies: #12415, #13992

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/11334





---

archive/issue_comments_146774.json:
```json
{
    "body": "<a id='comment:1'></a>\nCCing fbissey since he's been extremely helpful in previous numpy upgrades.",
    "created_at": "2011-05-14T15:27:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146774",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:1'></a>
CCing fbissey since he's been extremely helpful in previous numpy upgrades.



---

archive/issue_comments_146775.json:
```json
{
    "body": "<a id='comment:2'></a>\nThx. it looks like numpy has been bumped to 1.6 in Gentoo so I can do some quick compatibility tests. It looks like a flag for gfortran has been added in the ebuild to help with the compiler autodetection madness it may be worth having it sage side too.\n\nDo you know if a scipy release is to follow, if not it would be best to revbump scipy to make sure it is rebuilt after numpy.\n\nOther matter there has been noise about lapack in numpy do we want to disable it, make it optional or keep the status quo?",
    "created_at": "2011-05-15T04:34:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146775",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:2'></a>
Thx. it looks like numpy has been bumped to 1.6 in Gentoo so I can do some quick compatibility tests. It looks like a flag for gfortran has been added in the ebuild to help with the compiler autodetection madness it may be worth having it sage side too.

Do you know if a scipy release is to follow, if not it would be best to revbump scipy to make sure it is rebuilt after numpy.

Other matter there has been noise about lapack in numpy do we want to disable it, make it optional or keep the status quo?



---

archive/issue_comments_146776.json:
```json
{
    "body": "<a id='comment:3'></a>\nI don't remember seeing anything on the scipy lists about an imminent scipy release.",
    "created_at": "2011-05-15T05:55:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146776",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:3'></a>
I don't remember seeing anything on the scipy lists about an imminent scipy release.



---

archive/issue_comments_146777.json:
```json
{
    "body": "<a id='comment:4'></a>\njust in:\n\n```\nsage -t  -long -force_lib \"devel/sage/doc/en/numerical_sage/numpy.rst\"\n**********************************************************************\nFile \"/usr/share/sage/devel/sage/doc/en/numerical_sage/numpy.rst\", line 97:\n    sage: 2.5*l\nExpected:\n    array([  0. ,   2.5,   5. ,   7.5,  10. ,  12.5,  15. ,  17.5,  20. ,  22.5])\nGot:\n    array([0.000000000000000, 2.50000000000000, 5.00000000000000,\n           7.50000000000000, 10.0000000000000, 12.5000000000000,\n           15.0000000000000, 17.5000000000000, 20.0000000000000,\n           22.5000000000000], dtype=object)\n**********************************************************************\nFile \"/usr/share/sage/devel/sage/doc/en/numerical_sage/numpy.rst\", line 289:\n    sage: xx\nExpected:\n    array([[ 0.  ,  0.25,  0.5 ,  0.75,  1.  ],\n           [ 0.  ,  0.25,  0.5 ,  0.75,  1.  ],\n           [ 0.  ,  0.25,  0.5 ,  0.75,  1.  ],\n           [ 0.  ,  0.25,  0.5 ,  0.75,  1.  ],\n           [ 0.  ,  0.25,  0.5 ,  0.75,  1.  ]])\nGot:\n    array([[0.000000000000000, 0.250000000000000, 0.500000000000000,\n            0.750000000000000, 1.00000000000000],\n           [0.000000000000000, 0.250000000000000, 0.500000000000000,\n            0.750000000000000, 1.00000000000000],\n           [0.000000000000000, 0.250000000000000, 0.500000000000000,\n            0.750000000000000, 1.00000000000000],\n           [0.000000000000000, 0.250000000000000, 0.500000000000000,\n            0.750000000000000, 1.00000000000000],\n           [0.000000000000000, 0.250000000000000, 0.500000000000000,\n            0.750000000000000, 1.00000000000000]], dtype=object)\n**********************************************************************\nFile \"/usr/share/sage/devel/sage/doc/en/numerical_sage/numpy.rst\", line 295:\n    sage: yy\nExpected:\n    array([[ 0.  ,  0.  ,  0.  ,  0.  ,  0.  ],\n           [ 0.25,  0.25,  0.25,  0.25,  0.25],\n           [ 0.5 ,  0.5 ,  0.5 ,  0.5 ,  0.5 ],\n           [ 0.75,  0.75,  0.75,  0.75,  0.75],\n           [ 1.  ,  1.  ,  1.  ,  1.  ,  1.  ]])\nGot:\n    array([[0.000000000000000, 0.000000000000000, 0.000000000000000,\n            0.000000000000000, 0.000000000000000],\n           [0.250000000000000, 0.250000000000000, 0.250000000000000,\n            0.250000000000000, 0.250000000000000],\n           [0.500000000000000, 0.500000000000000, 0.500000000000000,\n            0.500000000000000, 0.500000000000000],\n           [0.750000000000000, 0.750000000000000, 0.750000000000000,\n            0.750000000000000, 0.750000000000000],\n           [1.00000000000000, 1.00000000000000, 1.00000000000000,\n            1.00000000000000, 1.00000000000000]], dtype=object)\n**********************************************************************\nFile \"/usr/share/sage/devel/sage/doc/en/numerical_sage/numpy.rst\", line 301:\n    sage: f(xx,yy)\nExpected:\n    array([[ 0.    ,  0.0625,  0.25  ,  0.5625,  1.    ],\n           [ 0.0625,  0.125 ,  0.3125,  0.625 ,  1.0625],\n           [ 0.25  ,  0.3125,  0.5   ,  0.8125,  1.25  ],\n           [ 0.5625,  0.625 ,  0.8125,  1.125 ,  1.5625],\n           [ 1.    ,  1.0625,  1.25  ,  1.5625,  2.    ]])\nGot:\n    array([[0.000000000000000, 0.0625000000000000, 0.250000000000000,\n            0.562500000000000, 1.00000000000000],\n           [0.0625000000000000, 0.125000000000000, 0.312500000000000,\n            0.625000000000000, 1.06250000000000],\n           [0.250000000000000, 0.312500000000000, 0.500000000000000,\n            0.812500000000000, 1.25000000000000],\n           [0.562500000000000, 0.625000000000000, 0.812500000000000,\n            1.12500000000000, 1.56250000000000],\n           [1.00000000000000, 1.06250000000000, 1.25000000000000,\n            1.56250000000000, 2.00000000000000]], dtype=object)\n**********************************************************************\n2 items had failures:\n   1 of  55 in __main__.example_0\n   3 of  13 in __main__.example_1\n***Test Failed*** 4 failures.\n```\nthere may be more",
    "created_at": "2011-05-15T08:54:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146777",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:4'></a>
just in:

```
sage -t  -long -force_lib "devel/sage/doc/en/numerical_sage/numpy.rst"
**********************************************************************
File "/usr/share/sage/devel/sage/doc/en/numerical_sage/numpy.rst", line 97:
    sage: 2.5*l
Expected:
    array([  0. ,   2.5,   5. ,   7.5,  10. ,  12.5,  15. ,  17.5,  20. ,  22.5])
Got:
    array([0.000000000000000, 2.50000000000000, 5.00000000000000,
           7.50000000000000, 10.0000000000000, 12.5000000000000,
           15.0000000000000, 17.5000000000000, 20.0000000000000,
           22.5000000000000], dtype=object)
**********************************************************************
File "/usr/share/sage/devel/sage/doc/en/numerical_sage/numpy.rst", line 289:
    sage: xx
Expected:
    array([[ 0.  ,  0.25,  0.5 ,  0.75,  1.  ],
           [ 0.  ,  0.25,  0.5 ,  0.75,  1.  ],
           [ 0.  ,  0.25,  0.5 ,  0.75,  1.  ],
           [ 0.  ,  0.25,  0.5 ,  0.75,  1.  ],
           [ 0.  ,  0.25,  0.5 ,  0.75,  1.  ]])
Got:
    array([[0.000000000000000, 0.250000000000000, 0.500000000000000,
            0.750000000000000, 1.00000000000000],
           [0.000000000000000, 0.250000000000000, 0.500000000000000,
            0.750000000000000, 1.00000000000000],
           [0.000000000000000, 0.250000000000000, 0.500000000000000,
            0.750000000000000, 1.00000000000000],
           [0.000000000000000, 0.250000000000000, 0.500000000000000,
            0.750000000000000, 1.00000000000000],
           [0.000000000000000, 0.250000000000000, 0.500000000000000,
            0.750000000000000, 1.00000000000000]], dtype=object)
**********************************************************************
File "/usr/share/sage/devel/sage/doc/en/numerical_sage/numpy.rst", line 295:
    sage: yy
Expected:
    array([[ 0.  ,  0.  ,  0.  ,  0.  ,  0.  ],
           [ 0.25,  0.25,  0.25,  0.25,  0.25],
           [ 0.5 ,  0.5 ,  0.5 ,  0.5 ,  0.5 ],
           [ 0.75,  0.75,  0.75,  0.75,  0.75],
           [ 1.  ,  1.  ,  1.  ,  1.  ,  1.  ]])
Got:
    array([[0.000000000000000, 0.000000000000000, 0.000000000000000,
            0.000000000000000, 0.000000000000000],
           [0.250000000000000, 0.250000000000000, 0.250000000000000,
            0.250000000000000, 0.250000000000000],
           [0.500000000000000, 0.500000000000000, 0.500000000000000,
            0.500000000000000, 0.500000000000000],
           [0.750000000000000, 0.750000000000000, 0.750000000000000,
            0.750000000000000, 0.750000000000000],
           [1.00000000000000, 1.00000000000000, 1.00000000000000,
            1.00000000000000, 1.00000000000000]], dtype=object)
**********************************************************************
File "/usr/share/sage/devel/sage/doc/en/numerical_sage/numpy.rst", line 301:
    sage: f(xx,yy)
Expected:
    array([[ 0.    ,  0.0625,  0.25  ,  0.5625,  1.    ],
           [ 0.0625,  0.125 ,  0.3125,  0.625 ,  1.0625],
           [ 0.25  ,  0.3125,  0.5   ,  0.8125,  1.25  ],
           [ 0.5625,  0.625 ,  0.8125,  1.125 ,  1.5625],
           [ 1.    ,  1.0625,  1.25  ,  1.5625,  2.    ]])
Got:
    array([[0.000000000000000, 0.0625000000000000, 0.250000000000000,
            0.562500000000000, 1.00000000000000],
           [0.0625000000000000, 0.125000000000000, 0.312500000000000,
            0.625000000000000, 1.06250000000000],
           [0.250000000000000, 0.312500000000000, 0.500000000000000,
            0.812500000000000, 1.25000000000000],
           [0.562500000000000, 0.625000000000000, 0.812500000000000,
            1.12500000000000, 1.56250000000000],
           [1.00000000000000, 1.06250000000000, 1.25000000000000,
            1.56250000000000, 2.00000000000000]], dtype=object)
**********************************************************************
2 items had failures:
   1 of  55 in __main__.example_0
   3 of  13 in __main__.example_1
***Test Failed*** 4 failures.
```
there may be more



---

archive/issue_comments_146778.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n Numpy 1.6 was released today.\n+\n+New spkg: [http://spkg-upload.googlecode.com/files/numpy-1.6.0.spkg](http://spkg-upload.googlecode.com/files/numpy-1.6.0.spkg)\n``````\n",
    "created_at": "2011-05-15T20:10:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146778",
    "user": "https://github.com/kiwifb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,3 @@
 Numpy 1.6 was released today.
+
+New spkg: [http://spkg-upload.googlecode.com/files/numpy-1.6.0.spkg](http://spkg-upload.googlecode.com/files/numpy-1.6.0.spkg)
``````




---

archive/issue_comments_146779.json:
```json
{
    "body": "<a id='comment:5'></a>\nI have cut a new spkg for 1.6.0, I decided to go for plain update for now.",
    "created_at": "2011-05-15T20:10:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146779",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:5'></a>
I have cut a new spkg for 1.6.0, I decided to go for plain update for now.



---

archive/issue_comments_146780.json:
```json
{
    "body": "<a id='comment:6'></a>\nseems my home install has problems. Probably stuff messed around between python 2.6 and 2.7 because I am working on #9958. Another install didn't report any problems. So I will check on a vanilla sage but I think we won't need to do any patching.",
    "created_at": "2011-05-16T04:28:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146780",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:6'></a>
seems my home install has problems. Probably stuff messed around between python 2.6 and 2.7 because I am working on #9958. Another install didn't report any problems. So I will check on a vanilla sage but I think we won't need to do any patching.



---

archive/issue_comments_146781.json:
```json
{
    "body": "<a id='comment:7'></a>\nFor some reason the other install didn't upgrade that's why I didn't see anything on the second machine. So right now it looks like we have the following to correct:\n\n```\n        sage -t  -long -force_lib devel/sage/doc/en/numerical_sage/numpy.rst #\n 4 doctests failed\n         sage -t  -long -force_lib devel/sage/sage/symbolic/function.pyx # 1\n doctests failed\n         sage -t  -long -force_lib devel/sage/sage/plot/plot_field.py # 1\n doctests failed\n         sage -t  -long -force_lib devel/sage/sage/plot/matrix_plot.py # 1\n doctests failed\n         sage -t  -long -force_lib devel/sage/sage/matrix/matrix1.pyx # 1\n doctests failed\n         sage -t  -long -force_lib devel/sage/sage/numerical/optimize.py # 1\n doctests failed\n         sage -t  -long -force_lib devel/sage/sage/rings/integer.pyx # 1\n doctests failed\n         sage -t  -long -force_lib devel/sage/sage/functions/hyperbolic.py # 2\n doctests failed\n         sage -t  -long -force_lib devel/sage/sage/functions/trig.py # 3\n doctests failed\n         sage -t  -long -force_lib devel/sage/sage/functions/other.py # 2\n doctests failed\n }}}\nThe first one is already in the ticket, then we have\n{{{\nsage -t -long -force_lib \"devel/sage/sage/symbolic/function.pyx\"\n**********************************************************************\nFile \"/usr/share/sage/devel/sage/sage/symbolic/function.pyx\", line 596:\n    sage: csc(a)\nExpected:\n    array([        inf,  1.18839511,  1.09975017,  7.0861674 , -1.32134871])\nGot:\n    doctest:270: RuntimeWarning: divide by zero encountered in divide\n    array([        inf,  1.18839511,  1.09975017,  7.0861674 , -1.32134871])\n**********************************************************************\n}}}\n\n{{{\nsage -t -long -force_lib \"devel/sage/sage/plot/plot_field.py\"\n**********************************************************************\nFile \"/usr/share/sage/devel/sage/sage/plot/plot_field.py\", line 216:\n    sage: plot_slope_field(growth_rate*(1-y/capacity)*y, (x,0,5), (y,0,capacity*2)).show(aspect_ratio=1)\nExpected nothing\nGot:\n    doctest:622: RuntimeWarning: divide by zero encountered in divide\n    doctest:623: RuntimeWarning: invalid value encountered in multiply\n    doctest:624: RuntimeWarning: invalid value encountered in multiply\n**********************************************************************\n}}}\n\n{{{\nsage -t -long -force_lib \"devel/sage/sage/plot/matrix_plot.py\"\n**********************************************************************\nFile \"/usr/share/sage/devel/sage/sage/plot/matrix_plot.py\", line 383:\n    sage: matrix_plot([[sin(x), cos(x)], [1, 0]])\nExpected:\n    Traceback (most recent call last):\n    ...\n    ValueError: can not convert entries to floating point numbers\nGot:\n    Traceback (most recent call last):\n      File \"/usr/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/usr/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/usr/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_8[36]>\", line 1, in <module>\n        matrix_plot([[sin(x), cos(x)], [Integer(1), Integer(0)]])###line 383:\n    sage: matrix_plot([[sin(x), cos(x)], [1, 0]])\n      File \"/usr/lib/python2.7/site-packages/sage/misc/decorators.py\", line 381, in wrapper\n        return func(*args, **kwds)\n      File \"/usr/lib/python2.7/site-packages/sage/misc/decorators.py\", line 432, in wrapper\n        return func(*args, **options)\n      File \"/usr/lib/python2.7/site-packages/sage/plot/matrix_plot.py\", line 423, in matrix_plot\n        raise TypeError, \"mat must be a Matrix or a two dimensional array\"\n    TypeError: mat must be a Matrix or a two dimensional array\n**********************************************************************\n}}}\n\n{{{\nsage -t -long -force_lib \"devel/sage/sage/matrix/matrix1.pyx\"\n**********************************************************************\nFile \"/usr/share/sage/devel/sage/sage/matrix/matrix1.pyx\", line 468:\n    sage: sorted(numpy.typecodes.items())\nExpected:\n    [('All', '?bhilqpBHILQPfdgFDGSUVO'), ('AllFloat', 'fdgFDG'), ('AllInteger', 'bBhHiIlLqQpP'), ('Character', 'c'), ('Complex', 'FDG'), ('Float', 'fdg'), ('Integer', 'bhilqp'), ('UnsignedInteger', 'BHILQP')]\nGot:\n    [('All', '?bhilqpBHILQPefdgFDGSUVOMm'), ('AllFloat', 'efdgFDG'), ('AllInteger', 'bBhHiIlLqQpP'), ('Character', 'c'), ('Complex', 'FDG'), ('Datetime', 'Mm'), ('Float', 'efdg'), ('Integer', 'bhilqp'), ('UnsignedInteger', 'BHILQP')]\n**********************************************************************\n}}}\n\n{{{\nsage -t -long -force_lib \"devel/sage/sage/numerical/optimize.py\"\n**********************************************************************\nFile \"/usr/share/sage/devel/sage/sage/numerical/optimize.py\", line 162:\n    sage: find_minimum_on_interval(f, 1, 5, tol=1e-3)\nExpected:\n    (-3.28837136189098..., 3.42575079030572...)\nGot:\n    (-3.28837136189, 3.4257507903057229)\n}}}\n\n\n{{{\nsage -t -long -force_lib \"devel/sage/sage/rings/integer.pyx\"\n**********************************************************************\nFile \"/usr/share/sage/devel/sage/sage/rings/integer.pyx\", line 4738:\n    sage: numpy.array(2**40).dtype\nExpected:\n    dtype('int64')\nGot:\n    dtype('object')\n**********************************************************************\n}}}\n\n\n{{{\nsage -t -long -force_lib \"devel/sage/sage/functions/hyperbolic.py\"\n**********************************************************************\nFile \"/usr/share/sage/devel/sage/sage/functions/hyperbolic.py\", line 609:\n    sage: arcsech(a)\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/usr/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/usr/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_23[4]>\", line 1, in <module>\n        arcsech(a)###line 609:\n    sage: arcsech(a)\n      File \"function.pyx\", line 357, in sage.symbolic.function.Function.__call__ (sage/symbolic/function.cpp:3794)\n      File \"/usr/lib/python2.7/site-packages/sage/functions/hyperbolic.py\", line 612, in _eval_numpy_\n        return arccosh(1.0 / x)\n    ZeroDivisionError: float division by zero\n**********************************************************************\nFile \"/usr/share/sage/devel/sage/sage/functions/hyperbolic.py\", line 658:\n    sage: arccsch(a)\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/usr/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/usr/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_26[4]>\", line 1, in <module>\n        arccsch(a)###line 658:\n    sage: arccsch(a)\n      File \"function.pyx\", line 357, in sage.symbolic.function.Function.__call__ (sage/symbolic/function.cpp:3794)\n      File \"/usr/lib/python2.7/site-packages/sage/functions/hyperbolic.py\", line 661, in _eval_numpy_\n        return arcsinh(1.0 / x)\n    ZeroDivisionError: float division by zero\n**********************************************************************\n}}}\n\n{{{\nsage -t -long -force_lib \"devel/sage/sage/functions/trig.py\"\n**********************************************************************\nFile \"/usr/share/sage/devel/sage/sage/functions/trig.py\", line 827:\n    sage: atan2(a, b)\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/usr/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/usr/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_34[16]>\", line 1, in <module>\n        atan2(a, b)###line 827:\n    sage: atan2(a, b)\n      File \"function.pyx\", line 718, in sage.symbolic.function.GinacFunction.__call__ (sage/symbolic/function.cpp:6475)\n      File \"function.pyx\", line 357, in sage.symbolic.function.Function.__call__ (sage/symbolic/function.cpp:3794)\n      File \"function.pyx\", line 604, in sage.symbolic.function.Function._eval_numpy_ (sage/symbolic/function.cpp:5568)\n    NotImplementedError: The Function arctan2 does not support numpy arrays as arguments\n**********************************************************************\nFile \"/usr/share/sage/devel/sage/sage/functions/trig.py\", line 830:\n    sage: atan2(1,a)\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/usr/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/usr/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_34[17]>\", line 1, in <module>\n        atan2(Integer(1),a)###line 830:\n    sage: atan2(1,a)\n      File \"function.pyx\", line 718, in sage.symbolic.function.GinacFunction.__call__ (sage/symbolic/function.cpp:6475)\n      File \"function.pyx\", line 357, in sage.symbolic.function.Function.__call__ (sage/symbolic/function.cpp:3794)\n      File \"function.pyx\", line 604, in sage.symbolic.function.Function._eval_numpy_ (sage/symbolic/function.cpp:5568)\n    NotImplementedError: The Function arctan2 does not support numpy arrays as arguments\n**********************************************************************\nFile \"/usr/share/sage/devel/sage/sage/functions/trig.py\", line 833:\n    sage: atan2(a, 1)\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/usr/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/usr/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_34[18]>\", line 1, in <module>\n        atan2(a, Integer(1))###line 833:\n    sage: atan2(a, 1)\n      File \"function.pyx\", line 718, in sage.symbolic.function.GinacFunction.__call__ (sage/symbolic/function.cpp:6475)\n      File \"function.pyx\", line 357, in sage.symbolic.function.Function.__call__ (sage/symbolic/function.cpp:3794)\n      File \"function.pyx\", line 604, in sage.symbolic.function.Function._eval_numpy_ (sage/symbolic/function.cpp:5568)\n    NotImplementedError: The Function arctan2 does not support numpy arrays as arguments\n**********************************************************************\n}}}\n\n{{{\nsage -t -long -force_lib \"devel/sage/sage/functions/other.py\"\n**********************************************************************\nFile \"/usr/share/sage/devel/sage/sage/functions/other.py\", line 211:\n    sage: ceil(a)\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/usr/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/usr/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_5[20]>\", line 1, in <module>\n        ceil(a)###line 211:\n    sage: ceil(a)\n      File \"/usr/lib/python2.7/site-packages/sage/functions/other.py\", line 251, in __call__\n        return numpy.ceil(x)\n    AttributeError: ceil\n**********************************************************************\nFile \"/usr/share/sage/devel/sage/sage/functions/other.py\", line 366:\n    sage: floor(a)\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/usr/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/usr/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_9[15]>\", line 1, in <module>\n        floor(a)###line 366:\n    sage: floor(a)\n      File \"/usr/lib/python2.7/site-packages/sage/functions/other.py\", line 405, in __call__\n        return numpy.floor(x)\n    AttributeError: floor\n**********************************************************************\n}}}\n\nThe last three are particularly concerning, could you check what's up with these in numpy?",
    "created_at": "2011-05-16T19:56:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146781",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:7'></a>
For some reason the other install didn't upgrade that's why I didn't see anything on the second machine. So right now it looks like we have the following to correct:

```
        sage -t  -long -force_lib devel/sage/doc/en/numerical_sage/numpy.rst #
 4 doctests failed
         sage -t  -long -force_lib devel/sage/sage/symbolic/function.pyx # 1
 doctests failed
         sage -t  -long -force_lib devel/sage/sage/plot/plot_field.py # 1
 doctests failed
         sage -t  -long -force_lib devel/sage/sage/plot/matrix_plot.py # 1
 doctests failed
         sage -t  -long -force_lib devel/sage/sage/matrix/matrix1.pyx # 1
 doctests failed
         sage -t  -long -force_lib devel/sage/sage/numerical/optimize.py # 1
 doctests failed
         sage -t  -long -force_lib devel/sage/sage/rings/integer.pyx # 1
 doctests failed
         sage -t  -long -force_lib devel/sage/sage/functions/hyperbolic.py # 2
 doctests failed
         sage -t  -long -force_lib devel/sage/sage/functions/trig.py # 3
 doctests failed
         sage -t  -long -force_lib devel/sage/sage/functions/other.py # 2
 doctests failed
 }}}
The first one is already in the ticket, then we have
{{{
sage -t -long -force_lib "devel/sage/sage/symbolic/function.pyx"
**********************************************************************
File "/usr/share/sage/devel/sage/sage/symbolic/function.pyx", line 596:
    sage: csc(a)
Expected:
    array([        inf,  1.18839511,  1.09975017,  7.0861674 , -1.32134871])
Got:
    doctest:270: RuntimeWarning: divide by zero encountered in divide
    array([        inf,  1.18839511,  1.09975017,  7.0861674 , -1.32134871])
**********************************************************************
}}}

{{{
sage -t -long -force_lib "devel/sage/sage/plot/plot_field.py"
**********************************************************************
File "/usr/share/sage/devel/sage/sage/plot/plot_field.py", line 216:
    sage: plot_slope_field(growth_rate*(1-y/capacity)*y, (x,0,5), (y,0,capacity*2)).show(aspect_ratio=1)
Expected nothing
Got:
    doctest:622: RuntimeWarning: divide by zero encountered in divide
    doctest:623: RuntimeWarning: invalid value encountered in multiply
    doctest:624: RuntimeWarning: invalid value encountered in multiply
**********************************************************************
}}}

{{{
sage -t -long -force_lib "devel/sage/sage/plot/matrix_plot.py"
**********************************************************************
File "/usr/share/sage/devel/sage/sage/plot/matrix_plot.py", line 383:
    sage: matrix_plot([[sin(x), cos(x)], [1, 0]])
Expected:
    Traceback (most recent call last):
    ...
    ValueError: can not convert entries to floating point numbers
Got:
    Traceback (most recent call last):
      File "/usr/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/usr/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/usr/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_8[36]>", line 1, in <module>
        matrix_plot([[sin(x), cos(x)], [Integer(1), Integer(0)]])###line 383:
    sage: matrix_plot([[sin(x), cos(x)], [1, 0]])
      File "/usr/lib/python2.7/site-packages/sage/misc/decorators.py", line 381, in wrapper
        return func(*args, **kwds)
      File "/usr/lib/python2.7/site-packages/sage/misc/decorators.py", line 432, in wrapper
        return func(*args, **options)
      File "/usr/lib/python2.7/site-packages/sage/plot/matrix_plot.py", line 423, in matrix_plot
        raise TypeError, "mat must be a Matrix or a two dimensional array"
    TypeError: mat must be a Matrix or a two dimensional array
**********************************************************************
}}}

{{{
sage -t -long -force_lib "devel/sage/sage/matrix/matrix1.pyx"
**********************************************************************
File "/usr/share/sage/devel/sage/sage/matrix/matrix1.pyx", line 468:
    sage: sorted(numpy.typecodes.items())
Expected:
    [('All', '?bhilqpBHILQPfdgFDGSUVO'), ('AllFloat', 'fdgFDG'), ('AllInteger', 'bBhHiIlLqQpP'), ('Character', 'c'), ('Complex', 'FDG'), ('Float', 'fdg'), ('Integer', 'bhilqp'), ('UnsignedInteger', 'BHILQP')]
Got:
    [('All', '?bhilqpBHILQPefdgFDGSUVOMm'), ('AllFloat', 'efdgFDG'), ('AllInteger', 'bBhHiIlLqQpP'), ('Character', 'c'), ('Complex', 'FDG'), ('Datetime', 'Mm'), ('Float', 'efdg'), ('Integer', 'bhilqp'), ('UnsignedInteger', 'BHILQP')]
**********************************************************************
}}}

{{{
sage -t -long -force_lib "devel/sage/sage/numerical/optimize.py"
**********************************************************************
File "/usr/share/sage/devel/sage/sage/numerical/optimize.py", line 162:
    sage: find_minimum_on_interval(f, 1, 5, tol=1e-3)
Expected:
    (-3.28837136189098..., 3.42575079030572...)
Got:
    (-3.28837136189, 3.4257507903057229)
}}}


{{{
sage -t -long -force_lib "devel/sage/sage/rings/integer.pyx"
**********************************************************************
File "/usr/share/sage/devel/sage/sage/rings/integer.pyx", line 4738:
    sage: numpy.array(2**40).dtype
Expected:
    dtype('int64')
Got:
    dtype('object')
**********************************************************************
}}}


{{{
sage -t -long -force_lib "devel/sage/sage/functions/hyperbolic.py"
**********************************************************************
File "/usr/share/sage/devel/sage/sage/functions/hyperbolic.py", line 609:
    sage: arcsech(a)
Exception raised:
    Traceback (most recent call last):
      File "/usr/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/usr/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/usr/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_23[4]>", line 1, in <module>
        arcsech(a)###line 609:
    sage: arcsech(a)
      File "function.pyx", line 357, in sage.symbolic.function.Function.__call__ (sage/symbolic/function.cpp:3794)
      File "/usr/lib/python2.7/site-packages/sage/functions/hyperbolic.py", line 612, in _eval_numpy_
        return arccosh(1.0 / x)
    ZeroDivisionError: float division by zero
**********************************************************************
File "/usr/share/sage/devel/sage/sage/functions/hyperbolic.py", line 658:
    sage: arccsch(a)
Exception raised:
    Traceback (most recent call last):
      File "/usr/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/usr/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/usr/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_26[4]>", line 1, in <module>
        arccsch(a)###line 658:
    sage: arccsch(a)
      File "function.pyx", line 357, in sage.symbolic.function.Function.__call__ (sage/symbolic/function.cpp:3794)
      File "/usr/lib/python2.7/site-packages/sage/functions/hyperbolic.py", line 661, in _eval_numpy_
        return arcsinh(1.0 / x)
    ZeroDivisionError: float division by zero
**********************************************************************
}}}

{{{
sage -t -long -force_lib "devel/sage/sage/functions/trig.py"
**********************************************************************
File "/usr/share/sage/devel/sage/sage/functions/trig.py", line 827:
    sage: atan2(a, b)
Exception raised:
    Traceback (most recent call last):
      File "/usr/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/usr/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/usr/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_34[16]>", line 1, in <module>
        atan2(a, b)###line 827:
    sage: atan2(a, b)
      File "function.pyx", line 718, in sage.symbolic.function.GinacFunction.__call__ (sage/symbolic/function.cpp:6475)
      File "function.pyx", line 357, in sage.symbolic.function.Function.__call__ (sage/symbolic/function.cpp:3794)
      File "function.pyx", line 604, in sage.symbolic.function.Function._eval_numpy_ (sage/symbolic/function.cpp:5568)
    NotImplementedError: The Function arctan2 does not support numpy arrays as arguments
**********************************************************************
File "/usr/share/sage/devel/sage/sage/functions/trig.py", line 830:
    sage: atan2(1,a)
Exception raised:
    Traceback (most recent call last):
      File "/usr/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/usr/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/usr/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_34[17]>", line 1, in <module>
        atan2(Integer(1),a)###line 830:
    sage: atan2(1,a)
      File "function.pyx", line 718, in sage.symbolic.function.GinacFunction.__call__ (sage/symbolic/function.cpp:6475)
      File "function.pyx", line 357, in sage.symbolic.function.Function.__call__ (sage/symbolic/function.cpp:3794)
      File "function.pyx", line 604, in sage.symbolic.function.Function._eval_numpy_ (sage/symbolic/function.cpp:5568)
    NotImplementedError: The Function arctan2 does not support numpy arrays as arguments
**********************************************************************
File "/usr/share/sage/devel/sage/sage/functions/trig.py", line 833:
    sage: atan2(a, 1)
Exception raised:
    Traceback (most recent call last):
      File "/usr/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/usr/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/usr/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_34[18]>", line 1, in <module>
        atan2(a, Integer(1))###line 833:
    sage: atan2(a, 1)
      File "function.pyx", line 718, in sage.symbolic.function.GinacFunction.__call__ (sage/symbolic/function.cpp:6475)
      File "function.pyx", line 357, in sage.symbolic.function.Function.__call__ (sage/symbolic/function.cpp:3794)
      File "function.pyx", line 604, in sage.symbolic.function.Function._eval_numpy_ (sage/symbolic/function.cpp:5568)
    NotImplementedError: The Function arctan2 does not support numpy arrays as arguments
**********************************************************************
}}}

{{{
sage -t -long -force_lib "devel/sage/sage/functions/other.py"
**********************************************************************
File "/usr/share/sage/devel/sage/sage/functions/other.py", line 211:
    sage: ceil(a)
Exception raised:
    Traceback (most recent call last):
      File "/usr/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/usr/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/usr/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_5[20]>", line 1, in <module>
        ceil(a)###line 211:
    sage: ceil(a)
      File "/usr/lib/python2.7/site-packages/sage/functions/other.py", line 251, in __call__
        return numpy.ceil(x)
    AttributeError: ceil
**********************************************************************
File "/usr/share/sage/devel/sage/sage/functions/other.py", line 366:
    sage: floor(a)
Exception raised:
    Traceback (most recent call last):
      File "/usr/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/usr/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/usr/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_9[15]>", line 1, in <module>
        floor(a)###line 366:
    sage: floor(a)
      File "/usr/lib/python2.7/site-packages/sage/functions/other.py", line 405, in __call__
        return numpy.floor(x)
    AttributeError: floor
**********************************************************************
}}}

The last three are particularly concerning, could you check what's up with these in numpy?



---

archive/issue_comments_146782.json:
```json
{
    "body": "<a id='comment:8'></a>\nThis seems to have installed fine on OS X 10.4 PPC.  I'm running doctests now (which will take a LONG time) but I did already see the matrix/matrix1.pyx one while testing something else.",
    "created_at": "2011-06-30T19:54:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146782",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:8'></a>
This seems to have installed fine on OS X 10.4 PPC.  I'm running doctests now (which will take a LONG time) but I did already see the matrix/matrix1.pyx one while testing something else.



---

archive/issue_comments_146783.json:
```json
{
    "body": "<a id='comment:9'></a>\nThat's good that it at least install. On gentoo there are interactions problem between numpy and scipy to get cblas/blas/lapack right in scipy. I should check if the resulting scipy in vanilla sage suffers from the same problem.\n[http://bugs.gentoo.org/show_bug.cgi?id=371099](http://bugs.gentoo.org/show_bug.cgi?id=371099) \n\nThe last few failing tests are show stoppers as far as I am concerned.",
    "created_at": "2011-06-30T20:08:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146783",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:9'></a>
That's good that it at least install. On gentoo there are interactions problem between numpy and scipy to get cblas/blas/lapack right in scipy. I should check if the resulting scipy in vanilla sage suffers from the same problem.
[http://bugs.gentoo.org/show_bug.cgi?id=371099](http://bugs.gentoo.org/show_bug.cgi?id=371099) 

The last few failing tests are show stoppers as far as I am concerned.



---

archive/issue_comments_146784.json:
```json
{
    "body": "<a id='comment:10'></a>\nOkay, I got pretty much the same failures on a long run.  One weird thing... did we change `find_minimum_on_interval` away from SciPy recently?  This is the full output I get on the (otherwise same as your failure) test for that.\n\n```\n    sage: find_minimum_on_interval(f, 1, 5, tol=1e-3)\nExpected:\n    (-3.28837136189098..., 3.42575079030572...)\nGot:\n    (-3.28837136189, 3.4257507903057229)\nGLPK Simplex Optimizer, v4.44\n6 rows, 3 columns, 8 non-zeros\nPreprocessing...\n2 rows, 2 columns, 4 non-zeros\nScaling...\n A: min|aij| =  2.400e+01  max|aij| =  5.000e+01  ratio =  2.083e+00\nGM: min|aij| =  8.128e-01  max|aij| =  1.230e+00  ratio =  1.514e+00\nEQ: min|aij| =  6.606e-01  max|aij| =  1.000e+00  ratio =  1.514e+00\nConstructing initial basis...\nSize of triangular part = 2\n*     0: obj =  -5.100000000e+01  infeas =  0.000e+00 (0)\n*     1: obj =  -5.225000000e+01  infeas =  0.000e+00 (0)\nOPTIMAL SOLUTION FOUND\n```",
    "created_at": "2011-07-05T13:38:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146784",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:10'></a>
Okay, I got pretty much the same failures on a long run.  One weird thing... did we change `find_minimum_on_interval` away from SciPy recently?  This is the full output I get on the (otherwise same as your failure) test for that.

```
    sage: find_minimum_on_interval(f, 1, 5, tol=1e-3)
Expected:
    (-3.28837136189098..., 3.42575079030572...)
Got:
    (-3.28837136189, 3.4257507903057229)
GLPK Simplex Optimizer, v4.44
6 rows, 3 columns, 8 non-zeros
Preprocessing...
2 rows, 2 columns, 4 non-zeros
Scaling...
 A: min|aij| =  2.400e+01  max|aij| =  5.000e+01  ratio =  2.083e+00
GM: min|aij| =  8.128e-01  max|aij| =  1.230e+00  ratio =  1.514e+00
EQ: min|aij| =  6.606e-01  max|aij| =  1.000e+00  ratio =  1.514e+00
Constructing initial basis...
Size of triangular part = 2
*     0: obj =  -5.100000000e+01  infeas =  0.000e+00 (0)
*     1: obj =  -5.225000000e+01  infeas =  0.000e+00 (0)
OPTIMAL SOLUTION FOUND
```



---

archive/issue_comments_146785.json:
```json
{
    "body": "<a id='comment:11'></a>\n1.6.1 is now available. I'll have a look sometimes this week.",
    "created_at": "2011-07-31T23:37:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146785",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:11'></a>
1.6.1 is now available. I'll have a look sometimes this week.



---

archive/issue_comments_146786.json:
```json
{
    "body": "<a id='comment:12'></a>\nLooks like more of the same but maybe a little bit more. There are a few other things that may interfere on my setup and I had to solve that bit:\n[http://bugs.gentoo.org/show_bug.cgi?id=371099](http://bugs.gentoo.org/show_bug.cgi?id=371099) before doing the trial.",
    "created_at": "2011-08-08T04:00:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146786",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:12'></a>
Looks like more of the same but maybe a little bit more. There are a few other things that may interfere on my setup and I had to solve that bit:
[http://bugs.gentoo.org/show_bug.cgi?id=371099](http://bugs.gentoo.org/show_bug.cgi?id=371099) before doing the trial.



---

archive/issue_comments_146787.json:
```json
{
    "body": "<a id='comment:13'></a>\nOnce I had cleared a few blas problem that I had while solving the gentoo bug. I get exactly the same results. I also get the output from Karl in optimize. This is a verbose output of glpk which get called at some point. You only get to see the such verbose output if there was a failure in the test but not necessarily the test for which glpk is called funnily enough.",
    "created_at": "2011-08-08T23:21:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146787",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:13'></a>
Once I had cleared a few blas problem that I had while solving the gentoo bug. I get exactly the same results. I also get the output from Karl in optimize. This is a verbose output of glpk which get called at some point. You only get to see the such verbose output if there was a failure in the test but not necessarily the test for which glpk is called funnily enough.



---

archive/issue_comments_146788.json:
```json
{
    "body": "<a id='comment:14'></a>\nShould we try to move forward on this again? I will have a go at trying it with 4.8.alpha2. Any ideas about the current failures?",
    "created_at": "2011-11-25T00:49:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146788",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:14'></a>
Should we try to move forward on this again? I will have a go at trying it with 4.8.alpha2. Any ideas about the current failures?



---

archive/issue_comments_146789.json:
```json
{
    "body": "<a id='comment:15'></a>\nOk this is still broken in 4.8.alpha2. Some food for thought\n\n```\nsage\n----------------------------------------------------------------------\n----------------------------------------------------------------------\n**********************************************************************\n*                                                                    *\n* Warning: this is a prerelease version, and it may be unstable.     *\n*                                                                    *\n**********************************************************************\nsage: import numpy\nsage: a = numpy.linspace(0,2,6)\nsage: a\narray([0.0, 0.4, 0.8, 1.2, 1.6, 2], dtype=object)\nsage: ceil(a)\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n| Sage Version 4.8.alpha2, Release Date: 2011-11-19                  |\n| Type notebook() for the GUI, and license() for information.        |\n\n/home/fbissey/<ipython console> in <module>()\n\n/usr/lib64/python2.7/site-packages/sage/functions/other.py in __call__(self, x, maximum_bits)\n    250             elif type(x).__module__ == 'numpy':\n    251                 import numpy\n--> 252                 return numpy.ceil(x)\n    253 \n    254         x_original = x\n\nAttributeError: ceil\n```\nwith numpy-1.5.1 we just have\n\n```\nsage: a\narray([0.0, 0.4, 0.8, 1.2, 1.6, 2])\n```\nI suspect that for this one (functions/other.py) and functions/trig.py the pynac interface may need to be touched. All stuff that takes an numpy array and return a numpy array may have trouble.",
    "created_at": "2011-11-28T02:58:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146789",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:15'></a>
Ok this is still broken in 4.8.alpha2. Some food for thought

```
sage
----------------------------------------------------------------------
----------------------------------------------------------------------
**********************************************************************
*                                                                    *
* Warning: this is a prerelease version, and it may be unstable.     *
*                                                                    *
**********************************************************************
sage: import numpy
sage: a = numpy.linspace(0,2,6)
sage: a
array([0.0, 0.4, 0.8, 1.2, 1.6, 2], dtype=object)
sage: ceil(a)
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
| Sage Version 4.8.alpha2, Release Date: 2011-11-19                  |
| Type notebook() for the GUI, and license() for information.        |

/home/fbissey/<ipython console> in <module>()

/usr/lib64/python2.7/site-packages/sage/functions/other.py in __call__(self, x, maximum_bits)
    250             elif type(x).__module__ == 'numpy':
    251                 import numpy
--> 252                 return numpy.ceil(x)
    253 
    254         x_original = x

AttributeError: ceil
```
with numpy-1.5.1 we just have

```
sage: a
array([0.0, 0.4, 0.8, 1.2, 1.6, 2])
```
I suspect that for this one (functions/other.py) and functions/trig.py the pynac interface may need to be touched. All stuff that takes an numpy array and return a numpy array may have trouble.



---

archive/issue_comments_146790.json:
```json
{
    "body": "<a id='comment:16'></a>\nJust to add a bit of info. Same python and ipython\n\n```\nipython\nPython 2.7.2 (default, Oct 28 2011, 11:36:16) \nType \"copyright\", \"credits\" or \"license\" for more information.\n\nIPython 0.10.2 -- An enhanced Interactive Python.\n?         -> Introduction and overview of IPython's features.\n%quickref -> Quick reference.\nhelp      -> Python's own help system.\nobject?   -> Details about 'object'. ?object also works, ?? prints more.\n\nIn [1]: import numpy\n\nIn [2]: a = numpy.linspace(0,2,6)\n\nIn [3]: a\nOut[3]: array([ 0. ,  0.4,  0.8,  1.2,  1.6,  2. ])\n\nIn [4]: ceil(a)\n---------------------------------------------------------------------------\nNameError                                 Traceback (most recent call last)\n\n/home/fbissey/<ipython console> in <module>()\n\nNameError: name 'ceil' is not defined\n\nIn [5]: numpy.ceil(a)\nOut[5]: array([ 0.,  1.,  1.,  2.,  2.,  2.])\n```\nSo it works in ipython but we don't have the dtype=object attached to the array. Anyone knows what that means actually?",
    "created_at": "2011-11-28T03:21:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146790",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:16'></a>
Just to add a bit of info. Same python and ipython

```
ipython
Python 2.7.2 (default, Oct 28 2011, 11:36:16) 
Type "copyright", "credits" or "license" for more information.

IPython 0.10.2 -- An enhanced Interactive Python.
?         -> Introduction and overview of IPython's features.
%quickref -> Quick reference.
help      -> Python's own help system.
object?   -> Details about 'object'. ?object also works, ?? prints more.

In [1]: import numpy

In [2]: a = numpy.linspace(0,2,6)

In [3]: a
Out[3]: array([ 0. ,  0.4,  0.8,  1.2,  1.6,  2. ])

In [4]: ceil(a)
---------------------------------------------------------------------------
NameError                                 Traceback (most recent call last)

/home/fbissey/<ipython console> in <module>()

NameError: name 'ceil' is not defined

In [5]: numpy.ceil(a)
Out[5]: array([ 0.,  1.,  1.,  2.,  2.,  2.])
```
So it works in ipython but we don't have the dtype=object attached to the array. Anyone knows what that means actually?



---

archive/issue_comments_146791.json:
```json
{
    "body": "<a id='comment:17'></a>\nnumpy-1.5.1\n\n```\nsage: numpy.dtype(a[1])\ndtype('float64')\n```\nnumpy-1.6.1\n\n```\nsage: numpy.dtype(a[1])\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n\n/home/fbissey/<ipython console> in <module>()\n\nTypeError: data type not understood\n```",
    "created_at": "2011-11-28T03:49:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146791",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:17'></a>
numpy-1.5.1

```
sage: numpy.dtype(a[1])
dtype('float64')
```
numpy-1.6.1

```
sage: numpy.dtype(a[1])
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)

/home/fbissey/<ipython console> in <module>()

TypeError: data type not understood
```



---

archive/issue_comments_146792.json:
```json
{
    "body": "<a id='comment:18'></a>\n\n```\nsage: type(a[0])\n<type 'float'>\nsage: type(a[0:5])\n<type 'numpy.ndarray'>\nsage: type(a[2])\n<type 'float'>\nsage: type(a[3])\n<type 'float'>\nsage: type(a[4])\n<type 'float'>\nsage: type(a[5])\n<type 'sage.rings.integer.Integer'>\n```\nFor some reason numpy.linspace return an array with sage objects rather than just floats. I am guessing it may be deeper than that. Numpy probably uses sage types rather than converting to numpy types. The types of a[0] to a[4] is strange, is there  a sage type for floats? I mean I tried numpy.linspace(0,2.0,6) and I got <type 'sage.rings.real_mpfr.RealNumber'> for a[0] to a[4] and <type 'sage.rings.real_mpfr.RealLiteral'> for a[5].\n\nDoing a cast numpy.array(a,dtype=float) returns something that will work.",
    "created_at": "2011-11-28T11:09:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146792",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:18'></a>

```
sage: type(a[0])
<type 'float'>
sage: type(a[0:5])
<type 'numpy.ndarray'>
sage: type(a[2])
<type 'float'>
sage: type(a[3])
<type 'float'>
sage: type(a[4])
<type 'float'>
sage: type(a[5])
<type 'sage.rings.integer.Integer'>
```
For some reason numpy.linspace return an array with sage objects rather than just floats. I am guessing it may be deeper than that. Numpy probably uses sage types rather than converting to numpy types. The types of a[0] to a[4] is strange, is there  a sage type for floats? I mean I tried numpy.linspace(0,2.0,6) and I got <type 'sage.rings.real_mpfr.RealNumber'> for a[0] to a[4] and <type 'sage.rings.real_mpfr.RealLiteral'> for a[5].

Doing a cast numpy.array(a,dtype=float) returns something that will work.



---

archive/issue_comments_146793.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n-Numpy 1.6 was released today.\n+Numpy-1.6.1 is now available.\n \n-New spkg: [http://spkg-upload.googlecode.com/files/numpy-1.6.0.spkg](http://spkg-upload.googlecode.com/files/numpy-1.6.0.spkg)\n+New spkg: [http://spkg-upload.googlecode.com/files/numpy-1.6.1.spkg](http://spkg-upload.googlecode.com/files/numpy-1.6.1.spkg)\n``````\n",
    "created_at": "2012-01-11T03:48:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146793",
    "user": "https://github.com/kiwifb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
-Numpy 1.6 was released today.
+Numpy-1.6.1 is now available.
 
-New spkg: [http://spkg-upload.googlecode.com/files/numpy-1.6.0.spkg](http://spkg-upload.googlecode.com/files/numpy-1.6.0.spkg)
+New spkg: [http://spkg-upload.googlecode.com/files/numpy-1.6.1.spkg](http://spkg-upload.googlecode.com/files/numpy-1.6.1.spkg)
``````




---

archive/issue_events_042598.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "rename": {
        "from": "Update numpy to 1.6",
        "to": "Update numpy to 1.6.1"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11334#event-42598"
}
```



---

archive/issue_comments_146794.json:
```json
{
    "body": "<a id='comment:20'></a>\nI'll be starting to make patches to correct the doctests and document the new behavior in numpy 1.6.x. Some documentation may need updating.",
    "created_at": "2012-01-17T02:51:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146794",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:20'></a>
I'll be starting to make patches to correct the doctests and document the new behavior in numpy 1.6.x. Some documentation may need updating.



---

archive/issue_comments_146795.json:
```json
{
    "body": "<a id='comment:21'></a>\nActually I am a bit confused by one of the tests:\n\n```\n    ``plot_slope_field`` takes a function of two variables xvar and yvar\n    (for instance, if the variables are `x` and `y`, take `f(x,y)`), and at\n    representative points `(x_i,y_i)` between xmin, xmax, and ymin, ymax\n    respectively, plots a line with slope `f(x_i,y_i)` (see below).\n\n    ``plot_slope_field(f, (xvar, xmin, xmax), (yvar, ymin, ymax))``\n\n    EXAMPLES: \n\n    A logistic function modeling population growth::\n\n        sage: x,y = var('x y')\n        sage: capacity = 3 # thousand\n        sage: growth_rate = 0.7 # population increases by 70% per unit of time\n        sage: plot_slope_field(growth_rate*(1-y/capacity)*y, (x,0,5), (y,0,capacity*2))\n```\nThat function is independent of x, the next example after this depend on both x and y. I am suspecting the messages we get in this particular case is quite justified and it is surprising we didn't get any before. I am not sure what the correct formula should be.",
    "created_at": "2012-01-17T03:06:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146795",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:21'></a>
Actually I am a bit confused by one of the tests:

```
    ``plot_slope_field`` takes a function of two variables xvar and yvar
    (for instance, if the variables are `x` and `y`, take `f(x,y)`), and at
    representative points `(x_i,y_i)` between xmin, xmax, and ymin, ymax
    respectively, plots a line with slope `f(x_i,y_i)` (see below).

    ``plot_slope_field(f, (xvar, xmin, xmax), (yvar, ymin, ymax))``

    EXAMPLES: 

    A logistic function modeling population growth::

        sage: x,y = var('x y')
        sage: capacity = 3 # thousand
        sage: growth_rate = 0.7 # population increases by 70% per unit of time
        sage: plot_slope_field(growth_rate*(1-y/capacity)*y, (x,0,5), (y,0,capacity*2))
```
That function is independent of x, the next example after this depend on both x and y. I am suspecting the messages we get in this particular case is quite justified and it is surprising we didn't get any before. I am not sure what the correct formula should be.



---

archive/issue_comments_146796.json:
```json
{
    "body": "<a id='comment:22'></a>\nI am guessing it should have been\n\n```\ngrowth_rate*(1-x/capacity)*y\n```\ny being the time and x the population in thousands. That satisfy a simple dimensional analysis.",
    "created_at": "2012-01-17T03:09:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146796",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:22'></a>
I am guessing it should have been

```
growth_rate*(1-x/capacity)*y
```
y being the time and x the population in thousands. That satisfy a simple dimensional analysis.



---

archive/issue_comments_146797.json:
```json
{
    "body": "<a id='comment:23'></a>\nNo, wasn't it right before?  That's the standard logistic population model, where y is the population.  See http://en.wikipedia.org/wiki/Logistic_function#In_ecology:_modeling_population_growth, for example.",
    "created_at": "2012-01-17T03:14:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146797",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:23'></a>
No, wasn't it right before?  That's the standard logistic population model, where y is the population.  See http://en.wikipedia.org/wiki/Logistic_function#In_ecology:_modeling_population_growth, for example.



---

archive/issue_comments_146798.json:
```json
{
    "body": "<a id='comment:24'></a>\n\n```\nsage: plot_slope_field(growth_rate*(1-y/capacity)*y, (x,0,5), (y,0,capacity*2))\n}}}}\n> That function is independent of x, the next example after this depend on both x and y. I am suspecting the messages we get in\n\nThis should be ok. The point is that the slope dy/dx is a function of y only; this can be completely symbolically solved using separation of variables to get the [http://en.wikipedia.org/wiki/Logistic_function#In_ecology:_modeling_population_growth logistic function].\n\n> this particular case is quite justified and it is surprising we didn't get any before. I am not sure what the correct formula should be.\n\nIf this is the division by zero stuff, it's the whole business with the arrowheads having zero length. See #11208. I think Jason has a fix for this, actually, but I don't recall the whole story of what happened once it was reported to mpl.",
    "created_at": "2012-01-17T03:14:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146798",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:24'></a>

```
sage: plot_slope_field(growth_rate*(1-y/capacity)*y, (x,0,5), (y,0,capacity*2))
}}}}
> That function is independent of x, the next example after this depend on both x and y. I am suspecting the messages we get in

This should be ok. The point is that the slope dy/dx is a function of y only; this can be completely symbolically solved using separation of variables to get the [http://en.wikipedia.org/wiki/Logistic_function#In_ecology:_modeling_population_growth logistic function].

> this particular case is quite justified and it is surprising we didn't get any before. I am not sure what the correct formula should be.

If this is the division by zero stuff, it's the whole business with the arrowheads having zero length. See #11208. I think Jason has a fix for this, actually, but I don't recall the whole story of what happened once it was reported to mpl.



---

archive/issue_comments_146799.json:
```json
{
    "body": "<a id='comment:25'></a>\nSorry for that noise.  Jason is right.\n\n```\nsage: plot_slope_field(growth_rate*(1-y/capacity)*y, (x,0,5), (y,0,capacity*2))\n```\n> That function is independent of x, the next example after this depend on both x and y. I am suspecting the messages we get in\n\n\nThis should be ok. The point is that the slope dy/dx is a function of y only; this can be completely symbolically solved using separation of variables to get the [logistic function](http://en.wikipedia.org/wiki/Logistic_function#In_ecology:_modeling_population_growth).\n\n> this particular case is quite justified and it is surprising we didn't get any before. I am not sure what the correct formula should be.\n\n\nIf this is the division by zero stuff, it's the whole business with the arrowheads having zero length. See #11208. I think Jason has a fix for this, actually, but I don't recall the whole story of what happened once it was reported to mpl.",
    "created_at": "2012-01-17T03:15:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146799",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:25'></a>
Sorry for that noise.  Jason is right.

```
sage: plot_slope_field(growth_rate*(1-y/capacity)*y, (x,0,5), (y,0,capacity*2))
```
> That function is independent of x, the next example after this depend on both x and y. I am suspecting the messages we get in


This should be ok. The point is that the slope dy/dx is a function of y only; this can be completely symbolically solved using separation of variables to get the [logistic function](http://en.wikipedia.org/wiki/Logistic_function#In_ecology:_modeling_population_growth).

> this particular case is quite justified and it is surprising we didn't get any before. I am not sure what the correct formula should be.


If this is the division by zero stuff, it's the whole business with the arrowheads having zero length. See #11208. I think Jason has a fix for this, actually, but I don't recall the whole story of what happened once it was reported to mpl.



---

archive/issue_comments_146800.json:
```json
{
    "body": "<a id='comment:26'></a>\nOK I was interpreting the formula another way because I wasn't sure what it is actually computing. Seems like #11208 numpy, mpl and scipy all go hands in hands so if something start happening with one the others may get it too.\n\nOverall the change of behavior of numpy around type conversion is quite annoying.",
    "created_at": "2012-01-17T03:31:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146800",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:26'></a>
OK I was interpreting the formula another way because I wasn't sure what it is actually computing. Seems like #11208 numpy, mpl and scipy all go hands in hands so if something start happening with one the others may get it too.

Overall the change of behavior of numpy around type conversion is quite annoying.



---

archive/issue_comments_146801.json:
```json
{
    "body": "Attachment [trac11334-numpy.rst.patch](tarball://root/attachments/some-uuid/ticket11334/trac11334-numpy.rst.patch) by @kiwifb created at 2012-01-17 21:46:20\n\nfirst draft at updating the documentation",
    "created_at": "2012-01-17T21:46:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146801",
    "user": "https://github.com/kiwifb"
}
```

Attachment [trac11334-numpy.rst.patch](tarball://root/attachments/some-uuid/ticket11334/trac11334-numpy.rst.patch) by @kiwifb created at 2012-01-17 21:46:20

first draft at updating the documentation



---

archive/issue_comments_146802.json:
```json
{
    "body": "<a id='comment:27'></a>\nIt strikes me that the problem may be more an issue of the coercion to numpy types not working properly with numpy-1.6. I will look into that.",
    "created_at": "2012-01-17T22:23:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146802",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:27'></a>
It strikes me that the problem may be more an issue of the coercion to numpy types not working properly with numpy-1.6. I will look into that.



---

archive/issue_comments_146803.json:
```json
{
    "body": "<a id='comment:28'></a>\nAny ideas why stuff like this is happening with numpy-1.6.x\n\n```\nsage: numpy.arange(10.0)\narray([ 0.,  1.,  2.,  3.,  4.,  5.,  6.,  7.,  8.,  9.])\nsage: numpy.linspace(0.0,9.0,10)\narray([0.000000000000000, 1.00000000000000, 2.00000000000000,\n       3.00000000000000, 4.00000000000000, 5.00000000000000,\n       6.00000000000000, 7.00000000000000, 8.00000000000000,\n       9.00000000000000], dtype=object)\n```",
    "created_at": "2012-01-17T22:40:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146803",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:28'></a>
Any ideas why stuff like this is happening with numpy-1.6.x

```
sage: numpy.arange(10.0)
array([ 0.,  1.,  2.,  3.,  4.,  5.,  6.,  7.,  8.,  9.])
sage: numpy.linspace(0.0,9.0,10)
array([0.000000000000000, 1.00000000000000, 2.00000000000000,
       3.00000000000000, 4.00000000000000, 5.00000000000000,
       6.00000000000000, 7.00000000000000, 8.00000000000000,
       9.00000000000000], dtype=object)
```



---

archive/issue_comments_146804.json:
```json
{
    "body": "<a id='comment:29'></a>\nIt looks like it didn't automatically convert from RR to float, like it should.  That's what these two lines should do in sage/rings/real_mpfr.pyx\n\n```\ncdef object numpy_double_interface = {'typestr': '=f8'}\ncdef object numpy_object_interface = {'typestr': '|O'}\n```\n\nand this property in that same file:\n\n```\n    property __array_interface__:\n        def __get__(self):\n            \"\"\"\n            Used for NumPy conversion.\n            \n            EXAMPLES::\n\n                sage: import numpy\n                sage: numpy.arange(10.0)\n                array([ 0.,  1.,  2.,  3.,  4.,  5.,  6.,  7.,  8.,  9.])\n                sage: numpy.array([1.0, 1.1, 1.2]).dtype\n                dtype('float64')\n                sage: numpy.array([1.000000000000000000000000000000000000]).dtype\n                dtype('object')\n            \"\"\"\n            if (<RealField_class>self._parent).__prec <= 57: # max size of repr(float)\n                return numpy_double_interface\n            else:\n                return numpy_object_interface\n```\n\nSo maybe numpy doesn't do something with `__array_interface__` anymore in linspace?\n\nCan you try `numpy.linspace(0.0,9.0,float(10))`, `numpy.linspace(0.0,float(9),10)`, `numpy.linspace(float(0),9.0,10)` and various other combinations of float vs. Sage types in the arguments to narrow down what is triggering it?",
    "created_at": "2012-01-17T22:47:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146804",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:29'></a>
It looks like it didn't automatically convert from RR to float, like it should.  That's what these two lines should do in sage/rings/real_mpfr.pyx

```
cdef object numpy_double_interface = {'typestr': '=f8'}
cdef object numpy_object_interface = {'typestr': '|O'}
```

and this property in that same file:

```
    property __array_interface__:
        def __get__(self):
            """
            Used for NumPy conversion.
            
            EXAMPLES::

                sage: import numpy
                sage: numpy.arange(10.0)
                array([ 0.,  1.,  2.,  3.,  4.,  5.,  6.,  7.,  8.,  9.])
                sage: numpy.array([1.0, 1.1, 1.2]).dtype
                dtype('float64')
                sage: numpy.array([1.000000000000000000000000000000000000]).dtype
                dtype('object')
            """
            if (<RealField_class>self._parent).__prec <= 57: # max size of repr(float)
                return numpy_double_interface
            else:
                return numpy_object_interface
```

So maybe numpy doesn't do something with `__array_interface__` anymore in linspace?

Can you try `numpy.linspace(0.0,9.0,float(10))`, `numpy.linspace(0.0,float(9),10)`, `numpy.linspace(float(0),9.0,10)` and various other combinations of float vs. Sage types in the arguments to narrow down what is triggering it?



---

archive/issue_comments_146805.json:
```json
{
    "body": "<a id='comment:30'></a>\nI was writing something else:\n\nAnd more subtly:\n\n```\nsage: a=numpy.linspace(0,9,10)\nsage: a\narray([0.0, 1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9], dtype=object)\nsage: type(a[0])\n<type 'float'>\nsage: type(a[9])\n<type 'sage.rings.integer.Integer'>\n```\nSo linspace and arange deal with sage input very differently. There should be some coercion but it is not working properly.\n\nnow for what you are asking:\n\n```\nsage: numpy.linspace(0.0,9.0,float(10))\narray([0.000000000000000, 1.00000000000000, 2.00000000000000,\n       3.00000000000000, 4.00000000000000, 5.00000000000000,\n       6.00000000000000, 7.00000000000000, 8.00000000000000,\n       9.00000000000000], dtype=object)\nsage: numpy.linspace(0.0,float(9),10)\narray([0.000000000000000, 1.00000000000000, 2.00000000000000,\n       3.00000000000000, 4.00000000000000, 5.00000000000000,\n       6.00000000000000, 7.00000000000000, 8.00000000000000, 9.0], dtype=object)\nsage: numpy.linspace(float(0),9.0,10)\narray([0.000000000000000, 1.00000000000000, 2.00000000000000,\n       3.00000000000000, 4.00000000000000, 5.00000000000000,\n       6.00000000000000, 7.00000000000000, 8.00000000000000,\n       9.00000000000000], dtype=object)\n```\n\nI know about sage/rings/real_mpfr.pyx and the others that's how I got on thinking of coercion not working.",
    "created_at": "2012-01-17T22:52:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146805",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:30'></a>
I was writing something else:

And more subtly:

```
sage: a=numpy.linspace(0,9,10)
sage: a
array([0.0, 1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9], dtype=object)
sage: type(a[0])
<type 'float'>
sage: type(a[9])
<type 'sage.rings.integer.Integer'>
```
So linspace and arange deal with sage input very differently. There should be some coercion but it is not working properly.

now for what you are asking:

```
sage: numpy.linspace(0.0,9.0,float(10))
array([0.000000000000000, 1.00000000000000, 2.00000000000000,
       3.00000000000000, 4.00000000000000, 5.00000000000000,
       6.00000000000000, 7.00000000000000, 8.00000000000000,
       9.00000000000000], dtype=object)
sage: numpy.linspace(0.0,float(9),10)
array([0.000000000000000, 1.00000000000000, 2.00000000000000,
       3.00000000000000, 4.00000000000000, 5.00000000000000,
       6.00000000000000, 7.00000000000000, 8.00000000000000, 9.0], dtype=object)
sage: numpy.linspace(float(0),9.0,10)
array([0.000000000000000, 1.00000000000000, 2.00000000000000,
       3.00000000000000, 4.00000000000000, 5.00000000000000,
       6.00000000000000, 7.00000000000000, 8.00000000000000,
       9.00000000000000], dtype=object)
```

I know about sage/rings/real_mpfr.pyx and the others that's how I got on thinking of coercion not working.



---

archive/issue_comments_146806.json:
```json
{
    "body": "<a id='comment:31'></a>\nWeirder! The code for linspace uses arange inside. No change in the code between the 1.5.1 and 1.6.1 but the juicy important bit is as follow\n\n```\n        step = (stop-start)/float(num)\n        y = _nx.arange(0, num) * step + start\n```\nstep will become float (unless start or stop is complex or something). But the type of step and start will influence the final array.",
    "created_at": "2012-01-18T02:19:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146806",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:31'></a>
Weirder! The code for linspace uses arange inside. No change in the code between the 1.5.1 and 1.6.1 but the juicy important bit is as follow

```
        step = (stop-start)/float(num)
        y = _nx.arange(0, num) * step + start
```
step will become float (unless start or stop is complex or something). But the type of step and start will influence the final array.



---

archive/issue_comments_146807.json:
```json
{
    "body": "<a id='comment:32'></a>\nAnyone wants to ask on a numpy mailing list if it is a sign of bug in numpy or something that is clearly under-documented?",
    "created_at": "2012-02-17T00:10:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146807",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:32'></a>
Anyone wants to ask on a numpy mailing list if it is a sign of bug in numpy or something that is clearly under-documented?



---

archive/issue_comments_146808.json:
```json
{
    "body": "<a id='comment:33'></a>\nReplying to [jason](#comment%3A29):\n\n> So maybe numpy doesn't do something with `__array_interface__`        anymore in linspace?\n\n\nI've been tinkering here and this is exactly what is happening. I deleted all the\n\n```\nproperty __array_interface__:\n```\nblocks that were added by [5081-numpy-types.patch](http://trac.sagemath.org/sage_trac/raw-attachment/ticket/5081/5081-numpy-types.patch) and [6506-numpy-types.patch](http://trac.sagemath.org/sage_trac/raw-attachment/ticket/6506/6506-numpy-types.patch) with no apparent effect on what numpy.linspace() returns with numpy-1.6.1 installed. Of course, the deleted blocks do affect what numpy.arange() and numpy.array() return:\n\n```\nsage: numpy.arange(10.0)\narray([0, 1, 2, 3, 4, 5, 6, 7, 8, 9], dtype=object)\nsage: numpy.array([1.0, 1.1, 1.2]).dtype\ndtype('object')\n```\nAlso the example failure\n\n```\nfrom scipy import stats\nstats.uniform(0,15).ppf([0.5,0.7])\n```\nfrom ticket #5081 now again fails with numpy-1.6.x (s-o-g result):\n\n```\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n\n/storage/strogdon/gentoo/usr/local/portage/sage-on-gentoo/<ipython console> in <module>()\n\n/storage/strogdon/gentoo/usr/lib/python2.7/site-packages/scipy/stats/distributions.pyc in ppf(self, q)\n    449 \n    450     def ppf(self, q):\n--> 451         return self.dist.ppf(q, *self.args, **self.kwds)\n    452 \n    453     def isf(self, q):\n\n/storage/strogdon/gentoo/usr/lib/python2.7/site-packages/scipy/stats/distributions.pyc in ppf(self, q, *args, **kwds)\n   1514             goodargs = argsreduce(cond, *((q,)+args+(scale,loc)))\n   1515             scale, loc, goodargs = goodargs[-2], goodargs[-1], goodargs[:-2]\n-> 1516             place(output,cond,self._ppf(*goodargs)*scale + loc)\n   1517         if output.ndim == 0:\n   1518             return output[()]\n\n/storage/strogdon/gentoo/usr/lib/python2.7/site-packages/numpy/lib/function_base.pyc in place(arr, mask, vals)\n   1333 \n   1334     \"\"\"\n-> 1335     return _insert(arr, mask, vals)\n   1336 \n   1337 def _nanop(op, fill, a, axis=None):\n\nTypeError: array cannot be safely cast to required type\n```\nStarting with numpy-1.6.0 scalar upcasting rules were changed [http://docs.scipy.org/doc/numpy/reference/ufuncs.html](http://docs.scipy.org/doc/numpy/reference/ufuncs.html) and I'm wondering if this change is interfering with how sage/cython is handling the python !__array_interface!__ extension, at least relative to numpy.linspace(), and perhaps other numpy functions that are pure python.",
    "created_at": "2012-04-05T22:12:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146808",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:33'></a>
Replying to [jason](#comment%3A29):

> So maybe numpy doesn't do something with `__array_interface__`        anymore in linspace?


I've been tinkering here and this is exactly what is happening. I deleted all the

```
property __array_interface__:
```
blocks that were added by [5081-numpy-types.patch](http://trac.sagemath.org/sage_trac/raw-attachment/ticket/5081/5081-numpy-types.patch) and [6506-numpy-types.patch](http://trac.sagemath.org/sage_trac/raw-attachment/ticket/6506/6506-numpy-types.patch) with no apparent effect on what numpy.linspace() returns with numpy-1.6.1 installed. Of course, the deleted blocks do affect what numpy.arange() and numpy.array() return:

```
sage: numpy.arange(10.0)
array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9], dtype=object)
sage: numpy.array([1.0, 1.1, 1.2]).dtype
dtype('object')
```
Also the example failure

```
from scipy import stats
stats.uniform(0,15).ppf([0.5,0.7])
```
from ticket #5081 now again fails with numpy-1.6.x (s-o-g result):

```
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)

/storage/strogdon/gentoo/usr/local/portage/sage-on-gentoo/<ipython console> in <module>()

/storage/strogdon/gentoo/usr/lib/python2.7/site-packages/scipy/stats/distributions.pyc in ppf(self, q)
    449 
    450     def ppf(self, q):
--> 451         return self.dist.ppf(q, *self.args, **self.kwds)
    452 
    453     def isf(self, q):

/storage/strogdon/gentoo/usr/lib/python2.7/site-packages/scipy/stats/distributions.pyc in ppf(self, q, *args, **kwds)
   1514             goodargs = argsreduce(cond, *((q,)+args+(scale,loc)))
   1515             scale, loc, goodargs = goodargs[-2], goodargs[-1], goodargs[:-2]
-> 1516             place(output,cond,self._ppf(*goodargs)*scale + loc)
   1517         if output.ndim == 0:
   1518             return output[()]

/storage/strogdon/gentoo/usr/lib/python2.7/site-packages/numpy/lib/function_base.pyc in place(arr, mask, vals)
   1333 
   1334     """
-> 1335     return _insert(arr, mask, vals)
   1336 
   1337 def _nanop(op, fill, a, axis=None):

TypeError: array cannot be safely cast to required type
```
Starting with numpy-1.6.0 scalar upcasting rules were changed [http://docs.scipy.org/doc/numpy/reference/ufuncs.html](http://docs.scipy.org/doc/numpy/reference/ufuncs.html) and I'm wondering if this change is interfering with how sage/cython is handling the python !__array_interface!__ extension, at least relative to numpy.linspace(), and perhaps other numpy functions that are pure python.



---

archive/issue_comments_146809.json:
```json
{
    "body": "<a id='comment:34'></a>\nThat's the best clue we had in ages Steve. I am not sure when I will be able to dig it further as we have an extra long week end here (Tuesday is a university holyday).",
    "created_at": "2012-04-05T23:12:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146809",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:34'></a>
That's the best clue we had in ages Steve. I am not sure when I will be able to dig it further as we have an extra long week end here (Tuesday is a university holyday).



---

archive/issue_comments_146810.json:
```json
{
    "body": "<a id='comment:35'></a>\nHere is a minimal example of the problem:\n\n```\nsage: import numpy\nsage: numpy.array(0.5)\narray(0.500000000000000, dtype=object)\nsage: numpy.array(0.5r)\narray(0.5)\n```\n\nwhere as before it was\n\n```\nsage: import numpy\nsage: numpy.array(0.5)\narray(0.5)\nsage: numpy.array(0.5r)\narray(0.5)\n```",
    "created_at": "2012-05-28T09:05:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146810",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:35'></a>
Here is a minimal example of the problem:

```
sage: import numpy
sage: numpy.array(0.5)
array(0.500000000000000, dtype=object)
sage: numpy.array(0.5r)
array(0.5)
```

where as before it was

```
sage: import numpy
sage: numpy.array(0.5)
array(0.5)
sage: numpy.array(0.5r)
array(0.5)
```



---

archive/issue_comments_146811.json:
```json
{
    "body": "<a id='comment:36'></a>\nAlso, we should incorporate #7831",
    "created_at": "2012-05-28T09:05:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146811",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:36'></a>
Also, we should incorporate #7831



---

archive/issue_comments_146812.json:
```json
{
    "body": "<a id='comment:37'></a>\nSure Mike do you have any idea on how to fix the coercion problem? The way it's going we'll update directly to 1.7.",
    "created_at": "2012-05-28T09:11:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146812",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:37'></a>
Sure Mike do you have any idea on how to fix the coercion problem? The way it's going we'll update directly to 1.7.



---

archive/issue_comments_146813.json:
```json
{
    "body": "<a id='comment:38'></a>\nLooking into this it seems that the issue is that in `numpy/core/src/multiarray/ctors.c`, `PyArray_FromAny` no longer calls `_array_find_type` which I believe was responsible for accessing the `__array_interface__` attribute on our objects.  I'm sending a message to numpy-discussion now.",
    "created_at": "2012-05-28T10:04:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146813",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:38'></a>
Looking into this it seems that the issue is that in `numpy/core/src/multiarray/ctors.c`, `PyArray_FromAny` no longer calls `_array_find_type` which I believe was responsible for accessing the `__array_interface__` attribute on our objects.  I'm sending a message to numpy-discussion now.



---

archive/issue_comments_146814.json:
```json
{
    "body": "<a id='comment:39'></a>\nSee http://mail.scipy.org/pipermail/numpy-discussion/2012-May/062560.html",
    "created_at": "2012-05-28T10:18:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146814",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:39'></a>
See http://mail.scipy.org/pipermail/numpy-discussion/2012-May/062560.html



---

archive/issue_comments_146815.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd40.5\".",
    "created_at": "2012-05-28T10:23:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146815",
    "user": "https://github.com/mwhansen"
}
```

Changing keywords from "" to "sd40.5".



---

archive/issue_comments_146816.json:
```json
{
    "body": "<a id='comment:41'></a>\nThanks Mike, hopefully we'll get a meaningful answer.",
    "created_at": "2012-05-28T10:25:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146816",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:41'></a>
Thanks Mike, hopefully we'll get a meaningful answer.



---

archive/issue_comments_146817.json:
```json
{
    "body": "<a id='comment:42'></a>\nLooks like 1.6.2 was released last week. I guess I'll update my spkg.",
    "created_at": "2012-05-29T09:13:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146817",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:42'></a>
Looks like 1.6.2 was released last week. I guess I'll update my spkg.



---

archive/issue_comments_146818.json:
```json
{
    "body": "<a id='comment:43'></a>\nLooks like I found the commit where the change has been made [https://github.com/numpy/numpy/commit/2635398db3f26529ce2aaea4028a8118844f3c48](https://github.com/numpy/numpy/commit/2635398db3f26529ce2aaea4028a8118844f3c48)\n\nIf you look carefully the call to _array_find_type is still there but it has changed location. In 1.5.1 there was a sequence if(xx==NULL) then call _array_find_type else do some other stuff. In 1.6.1 the structure if(xx!=NULL) then do the other stuff else call _array_find_type.\n\nI will try to write a patch to see if this the cause of our observed behaviour.",
    "created_at": "2012-05-29T09:53:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146818",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:43'></a>
Looks like I found the commit where the change has been made [https://github.com/numpy/numpy/commit/2635398db3f26529ce2aaea4028a8118844f3c48](https://github.com/numpy/numpy/commit/2635398db3f26529ce2aaea4028a8118844f3c48)

If you look carefully the call to _array_find_type is still there but it has changed location. In 1.5.1 there was a sequence if(xx==NULL) then call _array_find_type else do some other stuff. In 1.6.1 the structure if(xx!=NULL) then do the other stuff else call _array_find_type.

I will try to write a patch to see if this the cause of our observed behaviour.



---

archive/issue_comments_146819.json:
```json
{
    "body": "<a id='comment:44'></a>\nI wrote a small patch to just ignore any code other than _array_find_type in ctors.c no luck so I don't think that's the real source of the problem at all. I thought the presence of a requested_dtype passed to this function could have been the source of the problem but my patch excludes that possibility entirely. So we have to go back to looking.",
    "created_at": "2012-05-29T10:33:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146819",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:44'></a>
I wrote a small patch to just ignore any code other than _array_find_type in ctors.c no luck so I don't think that's the real source of the problem at all. I thought the presence of a requested_dtype passed to this function could have been the source of the problem but my patch excludes that possibility entirely. So we have to go back to looking.



---

archive/issue_comments_146820.json:
```json
{
    "body": "<a id='comment:45'></a>\nProblem still present with numpy-1.6.2",
    "created_at": "2012-05-29T11:05:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146820",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:45'></a>
Problem still present with numpy-1.6.2



---

archive/issue_comments_146821.json:
```json
{
    "body": "<a id='comment:46'></a>\nNew spkg for 1.6.2 rebased on 1.5.1.p1 as well.",
    "created_at": "2012-05-30T00:29:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146821",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:46'></a>
New spkg for 1.6.2 rebased on 1.5.1.p1 as well.



---

archive/issue_comments_146822.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n-Numpy-1.6.1 is now available.\n+Numpy-1.6.2 is now available.\n \n-New spkg: [http://spkg-upload.googlecode.com/files/numpy-1.6.1.spkg](http://spkg-upload.googlecode.com/files/numpy-1.6.1.spkg)\n+New spkg: [http://spkg-upload.googlecode.com/files/numpy-1.6.2.spkg](http://spkg-upload.googlecode.com/files/numpy-1.6.2.spkg)\n``````\n",
    "created_at": "2012-05-30T00:29:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146822",
    "user": "https://github.com/kiwifb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
-Numpy-1.6.1 is now available.
+Numpy-1.6.2 is now available.
 
-New spkg: [http://spkg-upload.googlecode.com/files/numpy-1.6.1.spkg](http://spkg-upload.googlecode.com/files/numpy-1.6.1.spkg)
+New spkg: [http://spkg-upload.googlecode.com/files/numpy-1.6.2.spkg](http://spkg-upload.googlecode.com/files/numpy-1.6.2.spkg)
``````




---

archive/issue_events_042599.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "rename": {
        "from": "Update numpy to 1.6.1",
        "to": "Update numpy to 1.6.2"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11334#event-42599"
}
```



---

archive/issue_comments_146823.json:
```json
{
    "body": "<a id='comment:47'></a>\nMike, I think if you want to ask a question that may have a chance to attract attention on numpy-discussion you should ask: Why do arange and linspace return different dtype object on similar inputs of the same type?\n\nYou can then expand on the fact that arange which is completely coded in C respect our request  from array interface but linspace which call arange and then do something in python with the result doesn't respect it.",
    "created_at": "2012-06-02T10:35:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146823",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:47'></a>
Mike, I think if you want to ask a question that may have a chance to attract attention on numpy-discussion you should ask: Why do arange and linspace return different dtype object on similar inputs of the same type?

You can then expand on the fact that arange which is completely coded in C respect our request  from array interface but linspace which call arange and then do something in python with the result doesn't respect it.



---

archive/issue_comments_146824.json:
```json
{
    "body": "<a id='comment:48'></a>\nReplying to [mhansen](#comment%3A39):\n\n> See http://mail.scipy.org/pipermail/numpy-discussion/2012-May/062560.html\n\n\nI believe Mike is correct in that the commit referenced at the above numpy-discussion is the source of the \"regression\" in being unable to access the Sage-assigned !__array_interface!__ attribute. I cloned the numpy.git repository, set the master to the commit mentioned my Mike, and from that commit generated a numpy spkg which I installed. Sage manifested the undesirable  \"dtype=object\" when tested. Now if I set the master to the commit just prior to the above mentioned commit and generated a new numpy spkg, then when Sage was tested I got the numpy-1.5.1 behavior. I'm just not sure what's going inside numpy?",
    "created_at": "2012-06-04T18:38:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146824",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:48'></a>
Replying to [mhansen](#comment%3A39):

> See http://mail.scipy.org/pipermail/numpy-discussion/2012-May/062560.html


I believe Mike is correct in that the commit referenced at the above numpy-discussion is the source of the "regression" in being unable to access the Sage-assigned !__array_interface!__ attribute. I cloned the numpy.git repository, set the master to the commit mentioned my Mike, and from that commit generated a numpy spkg which I installed. Sage manifested the undesirable  "dtype=object" when tested. Now if I set the master to the commit just prior to the above mentioned commit and generated a new numpy spkg, then when Sage was tested I got the numpy-1.5.1 behavior. I'm just not sure what's going inside numpy?



---

archive/issue_comments_146825.json:
```json
{
    "body": "<a id='comment:49'></a>\nOK so this is indeed the guilty commit. I tried something very simple to see if it was the small bit of code around _array_find_dtype and it was obviously insufficient to uncover the problem. It is quite a big commit,. I am thinking that considering we see an inconsistent behavior that we should just open a bug with numpy.",
    "created_at": "2012-06-04T23:03:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146825",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:49'></a>
OK so this is indeed the guilty commit. I tried something very simple to see if it was the small bit of code around _array_find_dtype and it was obviously insufficient to uncover the problem. It is quite a big commit,. I am thinking that considering we see an inconsistent behavior that we should just open a bug with numpy.



---

archive/issue_comments_146826.json:
```json
{
    "body": "<a id='comment:50'></a>\nThanks Mike for the post on numpy's github tracker [https://github.com/numpy/numpy/issues/291](https://github.com/numpy/numpy/issues/291) I am not sure how they distribute the load between the github tracker and their trac server [http://projects.scipy.org/numpy/report](http://projects.scipy.org/numpy/report). I just hope they don't ignore it.",
    "created_at": "2012-06-05T09:42:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146826",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:50'></a>
Thanks Mike for the post on numpy's github tracker [https://github.com/numpy/numpy/issues/291](https://github.com/numpy/numpy/issues/291) I am not sure how they distribute the load between the github tracker and their trac server [http://projects.scipy.org/numpy/report](http://projects.scipy.org/numpy/report). I just hope they don't ignore it.



---

archive/issue_comments_146827.json:
```json
{
    "body": "Changing upstream from \"N/A\" to \"Reported upstream. No feedback yet.\"",
    "created_at": "2012-06-05T09:42:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146827",
    "user": "https://github.com/kiwifb"
}
```

Changing upstream from "N/A" to "Reported upstream. No feedback yet."



---

archive/issue_comments_146828.json:
```json
{
    "body": "Changing upstream from \"Reported upstream. No feedback yet.\" to \"Reported upstream. Developers acknowledge bug.\"",
    "created_at": "2012-06-24T10:43:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146828",
    "user": "https://github.com/kiwifb"
}
```

Changing upstream from "Reported upstream. No feedback yet." to "Reported upstream. Developers acknowledge bug."



---

archive/issue_comments_146829.json:
```json
{
    "body": "<a id='comment:51'></a>\nIt looks like numpy may revert to the old behavior in 1.7.0. There is some traction upstream for this to happen.",
    "created_at": "2012-06-24T10:43:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146829",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:51'></a>
It looks like numpy may revert to the old behavior in 1.7.0. There is some traction upstream for this to happen.



---

archive/issue_comments_146830.json:
```json
{
    "body": "<a id='comment:52'></a>\nLooks like 1.7.0 will have a fix: https://github.com/numpy/numpy/issues/291.  1.7.0 should be out very soon now.",
    "created_at": "2012-11-13T21:38:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146830",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:52'></a>
Looks like 1.7.0 will have a fix: https://github.com/numpy/numpy/issues/291.  1.7.0 should be out very soon now.



---

archive/issue_comments_146831.json:
```json
{
    "body": "Changing upstream from \"Reported upstream. Developers acknowledge bug.\" to \"Fixed upstream, in a later stable release.\"",
    "created_at": "2012-11-13T21:38:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146831",
    "user": "https://github.com/jasongrout"
}
```

Changing upstream from "Reported upstream. Developers acknowledge bug." to "Fixed upstream, in a later stable release."



---

archive/issue_comments_146832.json:
```json
{
    "body": "<a id='comment:53'></a>\nI know and I am waiting for that.",
    "created_at": "2012-11-13T23:53:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146832",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:53'></a>
I know and I am waiting for that.



---

archive/issue_comments_146833.json:
```json
{
    "body": "<a id='comment:54'></a>\nI have been toying with numpy 1.7.0b2 in sage-on-gentoo. I have added a small patch I discussed with Steve Trogdon that I will attach. In the meantime I have gobbles of the following:\n\n```\nsage -t -long -force_lib \"devel/sage-main/sage/functions/log.py\"\n**********************************************************************\nFile \"/usr/share/sage/devel/sage-main/sage/functions/log.py\", line 630:\n    sage: lambert_w(RDF(1))\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/usr/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/usr/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_12[4]>\", line 1, in <module>\n        lambert_w(RDF(Integer(1)))###line 630:\n    sage: lambert_w(RDF(1))\n      File \"/usr/lib64/python2.7/site-packages/sage/functions/log.py\", line 560, in __call__\n        return BuiltinFunction.__call__(self, 0, args[0], **kwds)\n      File \"function.pyx\", line 437, in sage.symbolic.function.Function.__call__ (sage/symbolic/function.cpp:5006)\n      File \"/usr/lib64/python2.7/site-packages/sage/functions/log.py\", line 607, in _eval_\n        return self._evalf_(n, z, parent=sage_structure_coerce_parent(z))\n      File \"/usr/lib64/python2.7/site-packages/sage/functions/log.py\", line 636, in _evalf_\n        return scipy.special.lambertw(z, n)\n      File \"lambertw.pyx\", line 342, in scipy.special.lambertw.lambertw (scipy/special/lambertw.c:1438)\n    TypeError: expected a readable buffer object\n**********************************************************************\n1 items had failures:\n   1 of   6 in __main__.example_12\n***Test Failed*** 1 failures.\nFor whitespace errors, see the file /home/fbissey/.sage/tmp/log_1583.py\n         [2.6 s]\n```\nAnything using matplotlib spams you to death with these. Without the patch we get the following instead:\n\n```\nsage -t -long -force_lib \"devel/sage-main/sage/functions/log.py\"\n**********************************************************************\nFile \"/usr/share/sage/devel/sage-main/sage/functions/log.py\", line 630:\n    sage: lambert_w(RDF(1))\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/usr/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/usr/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_12[4]>\", line 1, in <module>\n        lambert_w(RDF(Integer(1)))###line 630:\n    sage: lambert_w(RDF(1))\n      File \"/usr/lib64/python2.7/site-packages/sage/functions/log.py\", line 560, in __call__\n        return BuiltinFunction.__call__(self, 0, args[0], **kwds)\n      File \"function.pyx\", line 437, in sage.symbolic.function.Function.__call__ (sage/symbolic/function.cpp:5006)\n      File \"/usr/lib64/python2.7/site-packages/sage/functions/log.py\", line 607, in _eval_\n        return self._evalf_(n, z, parent=sage_structure_coerce_parent(z))\n      File \"/usr/lib64/python2.7/site-packages/sage/functions/log.py\", line 636, in _evalf_\n        return scipy.special.lambertw(z, n)\n      File \"lambertw.pyx\", line 342, in scipy.special.lambertw.lambertw (scipy/special/lambertw.c:1438)\n    ValueError: Missing __array_interface__ shape\n**********************************************************************\n1 items had failures:\n   1 of   6 in __main__.example_12\n***Test Failed*** 1 failures.\nFor whitespace errors, see the file /home/fbissey/.sage/tmp/log_15682.py\n         [2.6 s]\n```\nIt seems that the patch introduce some expectation on the type that are not identified at the present time.",
    "created_at": "2012-12-03T02:34:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146833",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:54'></a>
I have been toying with numpy 1.7.0b2 in sage-on-gentoo. I have added a small patch I discussed with Steve Trogdon that I will attach. In the meantime I have gobbles of the following:

```
sage -t -long -force_lib "devel/sage-main/sage/functions/log.py"
**********************************************************************
File "/usr/share/sage/devel/sage-main/sage/functions/log.py", line 630:
    sage: lambert_w(RDF(1))
Exception raised:
    Traceback (most recent call last):
      File "/usr/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/usr/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/usr/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_12[4]>", line 1, in <module>
        lambert_w(RDF(Integer(1)))###line 630:
    sage: lambert_w(RDF(1))
      File "/usr/lib64/python2.7/site-packages/sage/functions/log.py", line 560, in __call__
        return BuiltinFunction.__call__(self, 0, args[0], **kwds)
      File "function.pyx", line 437, in sage.symbolic.function.Function.__call__ (sage/symbolic/function.cpp:5006)
      File "/usr/lib64/python2.7/site-packages/sage/functions/log.py", line 607, in _eval_
        return self._evalf_(n, z, parent=sage_structure_coerce_parent(z))
      File "/usr/lib64/python2.7/site-packages/sage/functions/log.py", line 636, in _evalf_
        return scipy.special.lambertw(z, n)
      File "lambertw.pyx", line 342, in scipy.special.lambertw.lambertw (scipy/special/lambertw.c:1438)
    TypeError: expected a readable buffer object
**********************************************************************
1 items had failures:
   1 of   6 in __main__.example_12
***Test Failed*** 1 failures.
For whitespace errors, see the file /home/fbissey/.sage/tmp/log_1583.py
         [2.6 s]
```
Anything using matplotlib spams you to death with these. Without the patch we get the following instead:

```
sage -t -long -force_lib "devel/sage-main/sage/functions/log.py"
**********************************************************************
File "/usr/share/sage/devel/sage-main/sage/functions/log.py", line 630:
    sage: lambert_w(RDF(1))
Exception raised:
    Traceback (most recent call last):
      File "/usr/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/usr/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/usr/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_12[4]>", line 1, in <module>
        lambert_w(RDF(Integer(1)))###line 630:
    sage: lambert_w(RDF(1))
      File "/usr/lib64/python2.7/site-packages/sage/functions/log.py", line 560, in __call__
        return BuiltinFunction.__call__(self, 0, args[0], **kwds)
      File "function.pyx", line 437, in sage.symbolic.function.Function.__call__ (sage/symbolic/function.cpp:5006)
      File "/usr/lib64/python2.7/site-packages/sage/functions/log.py", line 607, in _eval_
        return self._evalf_(n, z, parent=sage_structure_coerce_parent(z))
      File "/usr/lib64/python2.7/site-packages/sage/functions/log.py", line 636, in _evalf_
        return scipy.special.lambertw(z, n)
      File "lambertw.pyx", line 342, in scipy.special.lambertw.lambertw (scipy/special/lambertw.c:1438)
    ValueError: Missing __array_interface__ shape
**********************************************************************
1 items had failures:
   1 of   6 in __main__.example_12
***Test Failed*** 1 failures.
For whitespace errors, see the file /home/fbissey/.sage/tmp/log_15682.py
         [2.6 s]
```
It seems that the patch introduce some expectation on the type that are not identified at the present time.



---

archive/issue_comments_146834.json:
```json
{
    "body": "Attachment [array_interface-shape.patch](tarball://root/attachments/some-uuid/ticket11334/array_interface-shape.patch) by @kiwifb created at 2012-12-03 02:35:08\n\nadd array_shape to coercion rule",
    "created_at": "2012-12-03T02:35:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146834",
    "user": "https://github.com/kiwifb"
}
```

Attachment [array_interface-shape.patch](tarball://root/attachments/some-uuid/ticket11334/array_interface-shape.patch) by @kiwifb created at 2012-12-03 02:35:08

add array_shape to coercion rule



---

archive/issue_comments_146835.json:
```json
{
    "body": "<a id='comment:55'></a>\nHere is a spkg so other people can enjoy. numpy 1.7 also has a new API. By default you can use the old one but we may want to move on to the new one eventually.",
    "created_at": "2012-12-03T02:59:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146835",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:55'></a>
Here is a spkg so other people can enjoy. numpy 1.7 also has a new API. By default you can use the old one but we may want to move on to the new one eventually.



---

archive/issue_comments_146836.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,4 @@\n Numpy-1.6.2 is now available.\n \n New spkg: [http://spkg-upload.googlecode.com/files/numpy-1.6.2.spkg](http://spkg-upload.googlecode.com/files/numpy-1.6.2.spkg)\n+NEwer spkg: [http://spkg-upload.googlecode.com/files/numpy-1.7.0b2.spkg](http://spkg-upload.googlecode.com/files/numpy-1.7.0b2.spkg)\n``````\n",
    "created_at": "2012-12-03T02:59:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146836",
    "user": "https://github.com/kiwifb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,4 @@
 Numpy-1.6.2 is now available.
 
 New spkg: [http://spkg-upload.googlecode.com/files/numpy-1.6.2.spkg](http://spkg-upload.googlecode.com/files/numpy-1.6.2.spkg)
+NEwer spkg: [http://spkg-upload.googlecode.com/files/numpy-1.7.0b2.spkg](http://spkg-upload.googlecode.com/files/numpy-1.7.0b2.spkg)
``````




---

archive/issue_comments_146837.json:
```json
{
    "body": "<a id='comment:56'></a>\nSteve pointed out to me that 1.7.0b2 didn't contain 2 little patches that we need and that will hopefully be in 1.7.0 final. The spkg is updated and there are way fewer doctest failures (matplotlib 1.2.0 will be a major source of doctest noise when we upgrade).\nSo the current failures:\n1) cosmetics\n\n```\nsage -t -long -force_lib \"devel/sage-main/sage/matrix/matrix1.pyx\"\n**********************************************************************\nFile \"/home/work/fbissey/sandbox/sage-5.4.rc0/devel/sage-main/sage/matrix/matrix1.pyx\", line 494:\n    sage: sorted(numpy.typecodes.items())\nExpected:\n    [('All', '?bhilqpBHILQPfdgFDGSUVO'), ('AllFloat', 'fdgFDG'), ('AllInteger', 'bBhHiIlLqQpP'), ('Character', 'c'), ('Complex', 'FDG'), ('Float', 'fdg'), ('Integer', 'bhilqp'), ('UnsignedInteger', 'BHILQP')]\nGot:\n    [('All', '?bhilqpBHILQPefdgFDGSUVOMm'), ('AllFloat', 'efdgFDG'), ('AllInteger', 'bBhHiIlLqQpP'), ('Character', 'c'), ('Complex', 'FDG'), ('Datetime', 'Mm'), ('Float', 'efdg'), ('Integer', 'bhilqp'), ('UnsignedInteger', 'BHILQP')]\n**********************************************************************\n1 items had failures:\n```\n2) lots of divide by 0 warnings - including our old friend riemann.pyx encountered in a previous upgrade.\n\n```\nsage -t -long -force_lib \"devel/sage-main/sage/calculus/riemann.pyx\"\n**********************************************************************\nFile \"/home/work/fbissey/sandbox/sage-5.4.rc0/devel/sage-main/sage/calculus/riemann.pyx\", line 111:\n    sage: m = Riemann_Map([f], [fprime], 0)  # long time (4 sec)\nExpected nothing\nGot:\n    doctest:1: RuntimeWarning: divide by zero encountered in divide\n**********************************************************************\nFile \"/home/work/fbissey/sandbox/sage-5.4.rc0/devel/sage-main/sage/calculus/riemann.pyx\", line 595:\n    sage: m = Riemann_Map([f], [fprime], 0)\nExpected nothing\nGot:\n    doctest:1: RuntimeWarning: divide by zero encountered in divide\n**********************************************************************\nFile \"/home/work/fbissey/sandbox/sage-5.4.rc0/devel/sage-main/sage/calculus/riemann.pyx\", line 647:\n    sage: m = Riemann_Map([f], [fprime], 0)\nExpected nothing\nGot:\n    doctest:1: RuntimeWarning: divide by zero encountered in divide\n**********************************************************************\nFile \"/home/work/fbissey/sandbox/sage-5.4.rc0/devel/sage-main/sage/calculus/riemann.pyx\", line 712:\n    sage: m = Riemann_Map([f], [fprime], 0)\nExpected nothing\nGot:\n    doctest:1: RuntimeWarning: divide by zero encountered in divide\n**********************************************************************\nFile \"/home/work/fbissey/sandbox/sage-5.4.rc0/devel/sage-main/sage/calculus/riemann.pyx\", line 801:\n    sage: m = Riemann_Map([f], [fprime], 0)\nExpected nothing\nGot:\n    doctest:1: RuntimeWarning: divide by zero encountered in divide\n**********************************************************************\nFile \"/home/work/fbissey/sandbox/sage-5.4.rc0/devel/sage-main/sage/calculus/riemann.pyx\", line 867:\n    sage: m = Riemann_Map([f], [fprime], 0)\nExpected nothing\nGot:\n    doctest:1: RuntimeWarning: divide by zero encountered in divide\n**********************************************************************\nFile \"/home/work/fbissey/sandbox/sage-5.4.rc0/devel/sage-main/sage/calculus/riemann.pyx\", line 163:\n    sage: m = Riemann_Map([f], [fprime], 0)\nExpected nothing\nGot:\n    doctest:1: RuntimeWarning: divide by zero encountered in divide\n**********************************************************************\nFile \"/home/work/fbissey/sandbox/sage-5.4.rc0/devel/sage-main/sage/calculus/riemann.pyx\", line 214:\n    sage: isinstance(Riemann_Map([f], [fprime], 0)._repr_(), str)  # long time\nExpected:\n    True\nGot:\n    doctest:1: RuntimeWarning: divide by zero encountered in divide\n    True\n**********************************************************************\nFile \"/home/work/fbissey/sandbox/sage-5.4.rc0/devel/sage-main/sage/calculus/riemann.pyx\", line 228:\n    sage: m = Riemann_Map([f], [fprime], 0)\nExpected nothing\nGot:\n    doctest:1: RuntimeWarning: divide by zero encountered in divide\n**********************************************************************\nFile \"/home/work/fbissey/sandbox/sage-5.4.rc0/devel/sage-main/sage/calculus/riemann.pyx\", line 334:\n    sage: m = Riemann_Map([f], [fprime], 0)\nExpected nothing\nGot:\n    doctest:1: RuntimeWarning: divide by zero encountered in divide\n**********************************************************************\nFile \"/home/work/fbissey/sandbox/sage-5.4.rc0/devel/sage-main/sage/calculus/riemann.pyx\", line 404:\n    sage: m = Riemann_Map([f], [fprime], 0)\nExpected nothing\nGot:\n    doctest:1: RuntimeWarning: divide by zero encountered in divide\n**********************************************************************\nFile \"/home/work/fbissey/sandbox/sage-5.4.rc0/devel/sage-main/sage/calculus/riemann.pyx\", line 447:\n    sage: m = Riemann_Map([f], [fprime], 0)\nExpected nothing\nGot:\n    doctest:1: RuntimeWarning: divide by zero encountered in divide\n**********************************************************************\nFile \"/home/work/fbissey/sandbox/sage-5.4.rc0/devel/sage-main/sage/calculus/riemann.pyx\", line 515:\n    sage: m = Riemann_Map([f], [fprime], 0)\nExpected nothing\nGot:\n    doctest:1: RuntimeWarning: divide by zero encountered in divide\n**********************************************************************\nFile \"/home/work/fbissey/sandbox/sage-5.4.rc0/devel/sage-main/sage/calculus/riemann.pyx\", line 543:\n    sage: m = Riemann_Map([f], [fprime], 0)\nExpected nothing\nGot:\n    doctest:1: RuntimeWarning: divide by zero encountered in divide\n**********************************************************************\n```\n\n```\nsage -t -long -force_lib \"devel/sage-main/sage/calculus/interpolators.pyx\"\n**********************************************************************\nFile \"/home/work/fbissey/sandbox/sage-5.4.rc0/devel/sage-main/sage/calculus/interpolators.pyx\", line 52:\n    sage: m = Riemann_Map([lambda x: ps.value(real(x))], [lambda x: ps.derivative(real(x))],0)\nExpected nothing\nGot:\n    doctest:1: RuntimeWarning: divide by zero encountered in divide\n**********************************************************************\nFile \"/home/work/fbissey/sandbox/sage-5.4.rc0/devel/sage-main/sage/calculus/interpolators.pyx\", line 183:\n    sage: m = Riemann_Map([lambda x: cs.value(real(x))], [lambda x: cs.derivative(real(x))], 0)\nExpected nothing\nGot:\n    doctest:1: RuntimeWarning: divide by zero encountered in divide\n**********************************************************************\n```\n\n```\nsage -t -long -force_lib \"devel/sage-main/sage/symbolic/function.pyx\"\n**********************************************************************\nFile \"/home/work/fbissey/sandbox/sage-5.4.rc0/devel/sage-main/sage/symbolic/function.pyx\", line 627:\n    sage: csc(a)\nExpected:\n    array([        inf,  1.18839511,  1.09975017,  7.0861674 , -1.32134871])\nGot:\n    doctest:270: RuntimeWarning: divide by zero encountered in divide\n    array([        inf,  1.18839511,  1.09975017,  7.0861674 , -1.32134871])\n**********************************************************************\n```\n\n```\nsage -t -long -force_lib \"devel/sage-main/sage/functions/hyperbolic.py\"\n**********************************************************************\nFile \"/home/work/fbissey/sandbox/sage-5.4.rc0/devel/sage-main/sage/functions/hyperbolic.py\", line 610:\n    sage: arcsech(a)\nExpected:\n    array([       inf,  1.3169579,  0.       ])\nGot:\n    doctest:613: RuntimeWarning: divide by zero encountered in divide\n    array([       inf,  1.3169579,  0.       ])\n**********************************************************************\nFile \"/home/work/fbissey/sandbox/sage-5.4.rc0/devel/sage-main/sage/functions/hyperbolic.py\", line 659:\n    sage: arccsch(a)\nExpected:\n    array([        inf,  1.44363548,  0.88137359])\nGot:\n    doctest:662: RuntimeWarning: divide by zero encountered in divide\n    array([        inf,  1.44363548,  0.88137359])\n**********************************************************************\n```\n\n```\nsage -t -long -force_lib \"devel/sage-main/sage/modules/vector_double_dense.pyx\"\n**********************************************************************\nFile \"/home/work/fbissey/sandbox/sage-5.4.rc0/devel/sage-main/sage/modules/vector_double_dense.pyx\", line 712:\n    sage: w.norm(p=-1.6)\nExpected:\n    0.0\nGot:\n    doctest:1992: RuntimeWarning: divide by zero encountered in power\n    0.0\n**********************************************************************\n```\n\n3) odd bits that needs looking at:\n\n```\nsage -t -long -force_lib \"devel/sage-main/sage/rings/real_mpfr.pyx\"\n**********************************************************************\nFile \"/home/work/fbissey/sandbox/sage-5.4.rc0/devel/sage-main/sage/rings/real_mpfr.pyx\", line 1270:\n    sage: numpy.array([1.000000000000000000000000000000000000]).dtype\nExpected:\n    dtype('object')\nGot:\n    dtype('O')\n**********************************************************************\n```\nand similarly in rings/integer.pyx, rings/complex_number.pyx and rings/rational.pyx.\n\n4) ????\n\n```\nsage -t -long -force_lib \"devel/sage-main/sage/plot/matrix_plot.py\"\n**********************************************************************\nFile \"/home/work/fbissey/sandbox/sage-5.4.rc0/devel/sage-main/sage/plot/matrix_plot.py\", line 438:\n    sage: matrix_plot([[sin(x), cos(x)], [1, 0]])\nExpected:\n    Traceback (most recent call last):\n    ...\n    ValueError: can not convert entries to floating point numbers\nGot:\n    Traceback (most recent call last):\n      File \"/usr/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/usr/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/usr/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_8[40]>\", line 1, in <module>\n        matrix_plot([[sin(x), cos(x)], [Integer(1), Integer(0)]])###line 438:\n    sage: matrix_plot([[sin(x), cos(x)], [1, 0]])\n      File \"/usr/lib64/python2.7/site-packages/sage/misc/decorators.py\", line 456, in wrapper\n        return func(*args, **kwds)\n      File \"/usr/lib64/python2.7/site-packages/sage/misc/decorators.py\", line 456, in wrapper\n        return func(*args, **kwds)\n      File \"/usr/lib64/python2.7/site-packages/sage/misc/decorators.py\", line 534, in wrapper\n        return func(*args, **options)\n      File \"/usr/lib64/python2.7/site-packages/sage/plot/matrix_plot.py\", line 478, in matrix_plot\n        raise TypeError, \"mat must be a Matrix or a two dimensional array\"\n    TypeError: mat must be a Matrix or a two dimensional array\n**********************************************************************\n```\nand a last one which I am not sure is numpy or sage-on-gentoo or a combination:\n\n```\nsage -t -long -force_lib \"devel/sage-main/sage/matrix/matrix_double_dense.pyx\"\n**********************************************************************\nFile \"/home/work/fbissey/sandbox/sage-5.4.rc0/devel/sage-main/sage/matrix/matrix_double_dense.pyx\", line 4033:\n    sage: A.exp(order=2)\nExpected:\n    [51.8888631634 74.6198348038]\n    [111.929752206 163.818615369]\nGot:\n    [51.9689561987  74.736564567]\n    [112.104846851 164.073803049]\n**********************************************************************\nFile \"/home/work/fbissey/sandbox/sage-5.4.rc0/devel/sage-main/sage/matrix/matrix_double_dense.pyx\", line 4052:\n    sage: A.exp(order=2)\nExpected:\n    [-19.6130852955 + 12.5327938535*I   3.81156364812 + 28.891438232*I]\n    [-32.3827876895 + 21.9087393169*I   2.29565402142 + 44.915581543*I]\nGot:\n    [-19.6146029538 + 12.5177438468*I  3.79496364496 + 28.8837993066*I]\n    [-32.3835809809 + 21.8842359579*I  2.26963300409 + 44.9013248277*I]\n**********************************************************************\n```",
    "created_at": "2012-12-03T22:10:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146837",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:56'></a>
Steve pointed out to me that 1.7.0b2 didn't contain 2 little patches that we need and that will hopefully be in 1.7.0 final. The spkg is updated and there are way fewer doctest failures (matplotlib 1.2.0 will be a major source of doctest noise when we upgrade).
So the current failures:
1) cosmetics

```
sage -t -long -force_lib "devel/sage-main/sage/matrix/matrix1.pyx"
**********************************************************************
File "/home/work/fbissey/sandbox/sage-5.4.rc0/devel/sage-main/sage/matrix/matrix1.pyx", line 494:
    sage: sorted(numpy.typecodes.items())
Expected:
    [('All', '?bhilqpBHILQPfdgFDGSUVO'), ('AllFloat', 'fdgFDG'), ('AllInteger', 'bBhHiIlLqQpP'), ('Character', 'c'), ('Complex', 'FDG'), ('Float', 'fdg'), ('Integer', 'bhilqp'), ('UnsignedInteger', 'BHILQP')]
Got:
    [('All', '?bhilqpBHILQPefdgFDGSUVOMm'), ('AllFloat', 'efdgFDG'), ('AllInteger', 'bBhHiIlLqQpP'), ('Character', 'c'), ('Complex', 'FDG'), ('Datetime', 'Mm'), ('Float', 'efdg'), ('Integer', 'bhilqp'), ('UnsignedInteger', 'BHILQP')]
**********************************************************************
1 items had failures:
```
2) lots of divide by 0 warnings - including our old friend riemann.pyx encountered in a previous upgrade.

```
sage -t -long -force_lib "devel/sage-main/sage/calculus/riemann.pyx"
**********************************************************************
File "/home/work/fbissey/sandbox/sage-5.4.rc0/devel/sage-main/sage/calculus/riemann.pyx", line 111:
    sage: m = Riemann_Map([f], [fprime], 0)  # long time (4 sec)
Expected nothing
Got:
    doctest:1: RuntimeWarning: divide by zero encountered in divide
**********************************************************************
File "/home/work/fbissey/sandbox/sage-5.4.rc0/devel/sage-main/sage/calculus/riemann.pyx", line 595:
    sage: m = Riemann_Map([f], [fprime], 0)
Expected nothing
Got:
    doctest:1: RuntimeWarning: divide by zero encountered in divide
**********************************************************************
File "/home/work/fbissey/sandbox/sage-5.4.rc0/devel/sage-main/sage/calculus/riemann.pyx", line 647:
    sage: m = Riemann_Map([f], [fprime], 0)
Expected nothing
Got:
    doctest:1: RuntimeWarning: divide by zero encountered in divide
**********************************************************************
File "/home/work/fbissey/sandbox/sage-5.4.rc0/devel/sage-main/sage/calculus/riemann.pyx", line 712:
    sage: m = Riemann_Map([f], [fprime], 0)
Expected nothing
Got:
    doctest:1: RuntimeWarning: divide by zero encountered in divide
**********************************************************************
File "/home/work/fbissey/sandbox/sage-5.4.rc0/devel/sage-main/sage/calculus/riemann.pyx", line 801:
    sage: m = Riemann_Map([f], [fprime], 0)
Expected nothing
Got:
    doctest:1: RuntimeWarning: divide by zero encountered in divide
**********************************************************************
File "/home/work/fbissey/sandbox/sage-5.4.rc0/devel/sage-main/sage/calculus/riemann.pyx", line 867:
    sage: m = Riemann_Map([f], [fprime], 0)
Expected nothing
Got:
    doctest:1: RuntimeWarning: divide by zero encountered in divide
**********************************************************************
File "/home/work/fbissey/sandbox/sage-5.4.rc0/devel/sage-main/sage/calculus/riemann.pyx", line 163:
    sage: m = Riemann_Map([f], [fprime], 0)
Expected nothing
Got:
    doctest:1: RuntimeWarning: divide by zero encountered in divide
**********************************************************************
File "/home/work/fbissey/sandbox/sage-5.4.rc0/devel/sage-main/sage/calculus/riemann.pyx", line 214:
    sage: isinstance(Riemann_Map([f], [fprime], 0)._repr_(), str)  # long time
Expected:
    True
Got:
    doctest:1: RuntimeWarning: divide by zero encountered in divide
    True
**********************************************************************
File "/home/work/fbissey/sandbox/sage-5.4.rc0/devel/sage-main/sage/calculus/riemann.pyx", line 228:
    sage: m = Riemann_Map([f], [fprime], 0)
Expected nothing
Got:
    doctest:1: RuntimeWarning: divide by zero encountered in divide
**********************************************************************
File "/home/work/fbissey/sandbox/sage-5.4.rc0/devel/sage-main/sage/calculus/riemann.pyx", line 334:
    sage: m = Riemann_Map([f], [fprime], 0)
Expected nothing
Got:
    doctest:1: RuntimeWarning: divide by zero encountered in divide
**********************************************************************
File "/home/work/fbissey/sandbox/sage-5.4.rc0/devel/sage-main/sage/calculus/riemann.pyx", line 404:
    sage: m = Riemann_Map([f], [fprime], 0)
Expected nothing
Got:
    doctest:1: RuntimeWarning: divide by zero encountered in divide
**********************************************************************
File "/home/work/fbissey/sandbox/sage-5.4.rc0/devel/sage-main/sage/calculus/riemann.pyx", line 447:
    sage: m = Riemann_Map([f], [fprime], 0)
Expected nothing
Got:
    doctest:1: RuntimeWarning: divide by zero encountered in divide
**********************************************************************
File "/home/work/fbissey/sandbox/sage-5.4.rc0/devel/sage-main/sage/calculus/riemann.pyx", line 515:
    sage: m = Riemann_Map([f], [fprime], 0)
Expected nothing
Got:
    doctest:1: RuntimeWarning: divide by zero encountered in divide
**********************************************************************
File "/home/work/fbissey/sandbox/sage-5.4.rc0/devel/sage-main/sage/calculus/riemann.pyx", line 543:
    sage: m = Riemann_Map([f], [fprime], 0)
Expected nothing
Got:
    doctest:1: RuntimeWarning: divide by zero encountered in divide
**********************************************************************
```

```
sage -t -long -force_lib "devel/sage-main/sage/calculus/interpolators.pyx"
**********************************************************************
File "/home/work/fbissey/sandbox/sage-5.4.rc0/devel/sage-main/sage/calculus/interpolators.pyx", line 52:
    sage: m = Riemann_Map([lambda x: ps.value(real(x))], [lambda x: ps.derivative(real(x))],0)
Expected nothing
Got:
    doctest:1: RuntimeWarning: divide by zero encountered in divide
**********************************************************************
File "/home/work/fbissey/sandbox/sage-5.4.rc0/devel/sage-main/sage/calculus/interpolators.pyx", line 183:
    sage: m = Riemann_Map([lambda x: cs.value(real(x))], [lambda x: cs.derivative(real(x))], 0)
Expected nothing
Got:
    doctest:1: RuntimeWarning: divide by zero encountered in divide
**********************************************************************
```

```
sage -t -long -force_lib "devel/sage-main/sage/symbolic/function.pyx"
**********************************************************************
File "/home/work/fbissey/sandbox/sage-5.4.rc0/devel/sage-main/sage/symbolic/function.pyx", line 627:
    sage: csc(a)
Expected:
    array([        inf,  1.18839511,  1.09975017,  7.0861674 , -1.32134871])
Got:
    doctest:270: RuntimeWarning: divide by zero encountered in divide
    array([        inf,  1.18839511,  1.09975017,  7.0861674 , -1.32134871])
**********************************************************************
```

```
sage -t -long -force_lib "devel/sage-main/sage/functions/hyperbolic.py"
**********************************************************************
File "/home/work/fbissey/sandbox/sage-5.4.rc0/devel/sage-main/sage/functions/hyperbolic.py", line 610:
    sage: arcsech(a)
Expected:
    array([       inf,  1.3169579,  0.       ])
Got:
    doctest:613: RuntimeWarning: divide by zero encountered in divide
    array([       inf,  1.3169579,  0.       ])
**********************************************************************
File "/home/work/fbissey/sandbox/sage-5.4.rc0/devel/sage-main/sage/functions/hyperbolic.py", line 659:
    sage: arccsch(a)
Expected:
    array([        inf,  1.44363548,  0.88137359])
Got:
    doctest:662: RuntimeWarning: divide by zero encountered in divide
    array([        inf,  1.44363548,  0.88137359])
**********************************************************************
```

```
sage -t -long -force_lib "devel/sage-main/sage/modules/vector_double_dense.pyx"
**********************************************************************
File "/home/work/fbissey/sandbox/sage-5.4.rc0/devel/sage-main/sage/modules/vector_double_dense.pyx", line 712:
    sage: w.norm(p=-1.6)
Expected:
    0.0
Got:
    doctest:1992: RuntimeWarning: divide by zero encountered in power
    0.0
**********************************************************************
```

3) odd bits that needs looking at:

```
sage -t -long -force_lib "devel/sage-main/sage/rings/real_mpfr.pyx"
**********************************************************************
File "/home/work/fbissey/sandbox/sage-5.4.rc0/devel/sage-main/sage/rings/real_mpfr.pyx", line 1270:
    sage: numpy.array([1.000000000000000000000000000000000000]).dtype
Expected:
    dtype('object')
Got:
    dtype('O')
**********************************************************************
```
and similarly in rings/integer.pyx, rings/complex_number.pyx and rings/rational.pyx.

4) ????

```
sage -t -long -force_lib "devel/sage-main/sage/plot/matrix_plot.py"
**********************************************************************
File "/home/work/fbissey/sandbox/sage-5.4.rc0/devel/sage-main/sage/plot/matrix_plot.py", line 438:
    sage: matrix_plot([[sin(x), cos(x)], [1, 0]])
Expected:
    Traceback (most recent call last):
    ...
    ValueError: can not convert entries to floating point numbers
Got:
    Traceback (most recent call last):
      File "/usr/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/usr/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/usr/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_8[40]>", line 1, in <module>
        matrix_plot([[sin(x), cos(x)], [Integer(1), Integer(0)]])###line 438:
    sage: matrix_plot([[sin(x), cos(x)], [1, 0]])
      File "/usr/lib64/python2.7/site-packages/sage/misc/decorators.py", line 456, in wrapper
        return func(*args, **kwds)
      File "/usr/lib64/python2.7/site-packages/sage/misc/decorators.py", line 456, in wrapper
        return func(*args, **kwds)
      File "/usr/lib64/python2.7/site-packages/sage/misc/decorators.py", line 534, in wrapper
        return func(*args, **options)
      File "/usr/lib64/python2.7/site-packages/sage/plot/matrix_plot.py", line 478, in matrix_plot
        raise TypeError, "mat must be a Matrix or a two dimensional array"
    TypeError: mat must be a Matrix or a two dimensional array
**********************************************************************
```
and a last one which I am not sure is numpy or sage-on-gentoo or a combination:

```
sage -t -long -force_lib "devel/sage-main/sage/matrix/matrix_double_dense.pyx"
**********************************************************************
File "/home/work/fbissey/sandbox/sage-5.4.rc0/devel/sage-main/sage/matrix/matrix_double_dense.pyx", line 4033:
    sage: A.exp(order=2)
Expected:
    [51.8888631634 74.6198348038]
    [111.929752206 163.818615369]
Got:
    [51.9689561987  74.736564567]
    [112.104846851 164.073803049]
**********************************************************************
File "/home/work/fbissey/sandbox/sage-5.4.rc0/devel/sage-main/sage/matrix/matrix_double_dense.pyx", line 4052:
    sage: A.exp(order=2)
Expected:
    [-19.6130852955 + 12.5327938535*I   3.81156364812 + 28.891438232*I]
    [-32.3827876895 + 21.9087393169*I   2.29565402142 + 44.915581543*I]
Got:
    [-19.6146029538 + 12.5177438468*I  3.79496364496 + 28.8837993066*I]
    [-32.3835809809 + 21.8842359579*I  2.26963300409 + 44.9013248277*I]
**********************************************************************
```



---

archive/issue_comments_146838.json:
```json
{
    "body": "<a id='comment:57'></a>\nI forgot that one which is another that puzzle me\n\n```\nsage -t -long -force_lib \"devel/sage-main/sage/plot/plot3d/implicit_surface.pyx\"\n**********************************************************************\nFile \"/usr/share/sage/devel/sage-main/sage/plot/plot3d/implicit_surface.pyx\", line 563:\n    sage: cube_marcher.y_vertices.any() or cube_marcher.z_vertices.any() # This shouldn't affect the Y or Z vertices.\nExpected:\n    False\nGot nothing\n**********************************************************************\nFile \"/usr/share/sage/devel/sage-main/sage/plot/plot3d/implicit_surface.pyx\", line 458:\n    sage: cube_marcher.x_vertices.any() # This shouldn't affect the X vertices.\nExpected:\n    False\nGot nothing\n**********************************************************************\n```\nAnd the matrix_double_dense.pyx filures seem to have disappeared after my last rebuild.",
    "created_at": "2012-12-03T23:25:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146838",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:57'></a>
I forgot that one which is another that puzzle me

```
sage -t -long -force_lib "devel/sage-main/sage/plot/plot3d/implicit_surface.pyx"
**********************************************************************
File "/usr/share/sage/devel/sage-main/sage/plot/plot3d/implicit_surface.pyx", line 563:
    sage: cube_marcher.y_vertices.any() or cube_marcher.z_vertices.any() # This shouldn't affect the Y or Z vertices.
Expected:
    False
Got nothing
**********************************************************************
File "/usr/share/sage/devel/sage-main/sage/plot/plot3d/implicit_surface.pyx", line 458:
    sage: cube_marcher.x_vertices.any() # This shouldn't affect the X vertices.
Expected:
    False
Got nothing
**********************************************************************
```
And the matrix_double_dense.pyx filures seem to have disappeared after my last rebuild.



---

archive/issue_comments_146839.json:
```json
{
    "body": "<a id='comment:58'></a>\nSteve pointed out that the array_interface-shape.patch patch is not necessary as the old numpy 1.5.1 behavior as been restored in full. It doesn't hurt either way but we don't need to add something we don't need.",
    "created_at": "2012-12-04T20:46:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146839",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:58'></a>
Steve pointed out that the array_interface-shape.patch patch is not necessary as the old numpy 1.5.1 behavior as been restored in full. It doesn't hurt either way but we don't need to add something we don't need.



---

archive/issue_events_042600.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "rename": {
        "from": "Update numpy to 1.6.2",
        "to": "Update numpy to 1.7.0"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11334#event-42600"
}
```



---

archive/issue_comments_146840.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,3 @@\n-Numpy-1.6.2 is now available.\n+Numpy-1.7.0 will be available soon and will fix the coercion problem that prevented us to go to numpy-1.6.x.\n \n-New spkg: [http://spkg-upload.googlecode.com/files/numpy-1.6.2.spkg](http://spkg-upload.googlecode.com/files/numpy-1.6.2.spkg)\n-NEwer spkg: [http://spkg-upload.googlecode.com/files/numpy-1.7.0b2.spkg](http://spkg-upload.googlecode.com/files/numpy-1.7.0b2.spkg)\n+New spkg: [http://spkg-upload.googlecode.com/files/numpy-1.7.0b2.spkg](http://spkg-upload.googlecode.com/files/numpy-1.7.0b2.spkg)\n``````\n",
    "created_at": "2012-12-04T20:46:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146840",
    "user": "https://github.com/kiwifb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,3 @@
-Numpy-1.6.2 is now available.
+Numpy-1.7.0 will be available soon and will fix the coercion problem that prevented us to go to numpy-1.6.x.
 
-New spkg: [http://spkg-upload.googlecode.com/files/numpy-1.6.2.spkg](http://spkg-upload.googlecode.com/files/numpy-1.6.2.spkg)
-NEwer spkg: [http://spkg-upload.googlecode.com/files/numpy-1.7.0b2.spkg](http://spkg-upload.googlecode.com/files/numpy-1.7.0b2.spkg)
+New spkg: [http://spkg-upload.googlecode.com/files/numpy-1.7.0b2.spkg](http://spkg-upload.googlecode.com/files/numpy-1.7.0b2.spkg)
``````




---

archive/issue_comments_146841.json:
```json
{
    "body": "<a id='comment:59'></a>\nAfter pulling the latest code from 1.7.x maintenance branch I can now see that the patch is still necessary. The pull that Steve had mentioned to me happened on the master not on the 1.7.x maintenance branch so it is not in the current 1.7 branch on github.",
    "created_at": "2012-12-04T23:05:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146841",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:59'></a>
After pulling the latest code from 1.7.x maintenance branch I can now see that the patch is still necessary. The pull that Steve had mentioned to me happened on the master not on the 1.7.x maintenance branch so it is not in the current 1.7 branch on github.



---

archive/issue_comments_146842.json:
```json
{
    "body": "<a id='comment:60'></a>\nSorry about the last message after more tests my conclusions are:\n* the current tip of the 1.7.x maintenance branch as well as 1.7.0b2 need two extra patches (included in the current spkg)\n* the array_interface-shape.patch patch is not necessary after all.\n\nDuring my early tests I was expecting the two numpy patch to have been merged in the 1.7.x maintenance branch and that lead to confusion.",
    "created_at": "2012-12-05T09:09:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146842",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:60'></a>
Sorry about the last message after more tests my conclusions are:
* the current tip of the 1.7.x maintenance branch as well as 1.7.0b2 need two extra patches (included in the current spkg)
* the array_interface-shape.patch patch is not necessary after all.

During my early tests I was expecting the two numpy patch to have been merged in the 1.7.x maintenance branch and that lead to confusion.



---

archive/issue_comments_146843.json:
```json
{
    "body": "<a id='comment:61'></a>\nDoes the rst patch above need to be updated to not talk about the 1.6 bug of converting Sage types?",
    "created_at": "2012-12-06T16:57:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146843",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:61'></a>
Does the rst patch above need to be updated to not talk about the 1.6 bug of converting Sage types?



---

archive/issue_comments_146844.json:
```json
{
    "body": "<a id='comment:62'></a>\nAt this stage there are no patch to add to sage the rst patch was something I started before I realized that we should do something else.\nI will put any patch I create for sage in the summary. There are a at least a couple of things we can fix now. The big question in my mind is: what do we do with all those divide by 0 warnings? Last time we had the author of riemann.pyx fix things.",
    "created_at": "2012-12-06T20:40:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146844",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:62'></a>
At this stage there are no patch to add to sage the rst patch was something I started before I realized that we should do something else.
I will put any patch I create for sage in the summary. There are a at least a couple of things we can fix now. The big question in my mind is: what do we do with all those divide by 0 warnings? Last time we had the author of riemann.pyx fix things.



---

archive/issue_comments_146845.json:
```json
{
    "body": "<a id='comment:63'></a>\nI'll try taking a look at it.  I don't have the most recent Sage yet, but I guess it's not a huge problem right now since numpy 1.7 hasn't been released yet either.",
    "created_at": "2012-12-06T21:10:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146845",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:63'></a>
I'll try taking a look at it.  I don't have the most recent Sage yet, but I guess it's not a huge problem right now since numpy 1.7 hasn't been released yet either.



---

archive/issue_comments_146846.json:
```json
{
    "body": "tentative fix for matrix_plot.py - not sure it is the right thing to do as we have a change of behavior rather than output.",
    "created_at": "2012-12-06T21:13:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146846",
    "user": "https://github.com/kiwifb"
}
```

tentative fix for matrix_plot.py - not sure it is the right thing to do as we have a change of behavior rather than output.



---

archive/issue_comments_146847.json:
```json
{
    "body": "Attachment [trac_11334-typecodes.patch](tarball://root/attachments/some-uuid/ticket11334/trac_11334-typecodes.patch) by @kiwifb created at 2012-12-06 21:14:00\n\nnew typecodes",
    "created_at": "2012-12-06T21:14:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146847",
    "user": "https://github.com/kiwifb"
}
```

Attachment [trac_11334-typecodes.patch](tarball://root/attachments/some-uuid/ticket11334/trac_11334-typecodes.patch) by @kiwifb created at 2012-12-06 21:14:00

new typecodes



---

archive/issue_comments_146848.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,8 @@\n Numpy-1.7.0 will be available soon and will fix the coercion problem that prevented us to go to numpy-1.6.x.\n \n New spkg: [http://spkg-upload.googlecode.com/files/numpy-1.7.0b2.spkg](http://spkg-upload.googlecode.com/files/numpy-1.7.0b2.spkg)\n+\n+Apply:\n+* [attachment:trac_11334-dtype_object.patch]\n+* [attachment:trac_11334-matrix_plot.patch]\n+* [attachment:trac_11334-typecodes.patch]\n``````\n",
    "created_at": "2012-12-06T21:18:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146848",
    "user": "https://github.com/kiwifb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,8 @@
 Numpy-1.7.0 will be available soon and will fix the coercion problem that prevented us to go to numpy-1.6.x.
 
 New spkg: [http://spkg-upload.googlecode.com/files/numpy-1.7.0b2.spkg](http://spkg-upload.googlecode.com/files/numpy-1.7.0b2.spkg)
+
+Apply:
+* [attachment:trac_11334-dtype_object.patch]
+* [attachment:trac_11334-matrix_plot.patch]
+* [attachment:trac_11334-typecodes.patch]
``````




---

archive/issue_comments_146849.json:
```json
{
    "body": "<a id='comment:64'></a>\nOK for you to have a look in the meantime here are the easy patches. Not completely sure it is the right thing to do in matrix_plot.py. While we are expecting an error we were expecting a different kind of error before.",
    "created_at": "2012-12-06T21:18:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146849",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:64'></a>
OK for you to have a look in the meantime here are the easy patches. Not completely sure it is the right thing to do in matrix_plot.py. While we are expecting an error we were expecting a different kind of error before.



---

archive/issue_comments_146850.json:
```json
{
    "body": "<a id='comment:65'></a>\nI'm unable to get the extra patches included in numpy-1.7.0b2.spkg to apply. The file to be patched in the header of each patch is missing a leading \"/\" for\n\n```\npatch -p1 <\"$patch\"\n```\nto work. One possibility is to change \"-p1\" to \"-p0\" in spkg-install.",
    "created_at": "2012-12-11T17:37:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146850",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:65'></a>
I'm unable to get the extra patches included in numpy-1.7.0b2.spkg to apply. The file to be patched in the header of each patch is missing a leading "/" for

```
patch -p1 <"$patch"
```
to work. One possibility is to change "-p1" to "-p0" in spkg-install.



---

archive/issue_comments_146851.json:
```json
{
    "body": "<a id='comment:66'></a>\nThanks for testing I forgot to do that and I tested my first version of the spkg but not the second. I will fix this shortly.",
    "created_at": "2012-12-11T21:07:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146851",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:66'></a>
Thanks for testing I forgot to do that and I tested my first version of the spkg but not the second. I will fix this shortly.



---

archive/issue_comments_146852.json:
```json
{
    "body": "<a id='comment:67'></a>\nspkg updated in the same location. I just edited the patch as we want the patching command to be uniform with the already existing cygwin patch which is still needed in my opinion.",
    "created_at": "2012-12-11T22:47:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146852",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:67'></a>
spkg updated in the same location. I just edited the patch as we want the patching command to be uniform with the already existing cygwin patch which is still needed in my opinion.



---

archive/issue_comments_146853.json:
```json
{
    "body": "<a id='comment:68'></a>\nHere is some background on the failing test\n\n```\nsage -t -long -force_lib \"devel/sage-main/sage/plot/matrix_plot.py\"\n```\nthat's mentioned above [above](http://trac.sagemath.org/sage_trac/ticket/11334#comment:56). The failure in Sage of\n\n```\nsage: matrix_plot([[sin(x), cos(x)], [1, 0]])\n```\nseems to be associated with the following sequence\n\n```\nsage: import numpy as np\nsage: np.asarray([[sin(x), cos(x)], [1, 0]], dtype = float)\n```\nWith numpy-1.5.1 I get\n\n```\nsage:  np.asarray([[sin(x), cos(x)], [1, 0]], dtype = float)\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n\n/storage/sage/sage-5.5.rc0/<ipython console> in <module>()\n\n/storage/sage/sage-5.5.rc0/local/lib/python2.7/site-packages/numpy/core/numeric.py in asarray(a, dtype, order)\n    282 \n    283     \"\"\"\n--> 284     return array(a, dtype, copy=False, order=order)\n    285 \n    286 def asanyarray(a, dtype=None, order=None):\n\nValueError: setting an array element with a sequence.\n```\nand with numpy-1.7.0b2\n\n```\nsage: np.asarray([[sin(x), cos(x)], [1, 0]], dtype = float)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n\n/storage/sage/sage-5.5.rc0/<ipython console> in <module>()\n\n/storage/sage/sage-5.5.rc0/local/lib/python2.7/site-packages/numpy/core/numeric.pyc in asarray(a, dtype, order)\n    318 \n    319     \"\"\"\n--> 320     return array(a, dtype, copy=False, order=order)\n    321 \n    322 def asanyarray(a, dtype=None, order=None):\n\n/storage/sage/sage-5.5.rc0/local/lib/python2.7/site-packages/sage/symbolic/expression.so in sage.symbolic.expression.Expression.__float__ (sage/symbolic/expression.cpp:7023)()\n\nTypeError: unable to simplify to float approximation\n```\nSo it would appear that the ValueError when using numpy-1.5.1 is thrown my numpy but the TypeError when using numpy-1.7.0b2 is thrown by Sage.",
    "created_at": "2012-12-13T21:13:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146853",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:68'></a>
Here is some background on the failing test

```
sage -t -long -force_lib "devel/sage-main/sage/plot/matrix_plot.py"
```
that's mentioned above [above](http://trac.sagemath.org/sage_trac/ticket/11334#comment:56). The failure in Sage of

```
sage: matrix_plot([[sin(x), cos(x)], [1, 0]])
```
seems to be associated with the following sequence

```
sage: import numpy as np
sage: np.asarray([[sin(x), cos(x)], [1, 0]], dtype = float)
```
With numpy-1.5.1 I get

```
sage:  np.asarray([[sin(x), cos(x)], [1, 0]], dtype = float)
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)

/storage/sage/sage-5.5.rc0/<ipython console> in <module>()

/storage/sage/sage-5.5.rc0/local/lib/python2.7/site-packages/numpy/core/numeric.py in asarray(a, dtype, order)
    282 
    283     """
--> 284     return array(a, dtype, copy=False, order=order)
    285 
    286 def asanyarray(a, dtype=None, order=None):

ValueError: setting an array element with a sequence.
```
and with numpy-1.7.0b2

```
sage: np.asarray([[sin(x), cos(x)], [1, 0]], dtype = float)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)

/storage/sage/sage-5.5.rc0/<ipython console> in <module>()

/storage/sage/sage-5.5.rc0/local/lib/python2.7/site-packages/numpy/core/numeric.pyc in asarray(a, dtype, order)
    318 
    319     """
--> 320     return array(a, dtype, copy=False, order=order)
    321 
    322 def asanyarray(a, dtype=None, order=None):

/storage/sage/sage-5.5.rc0/local/lib/python2.7/site-packages/sage/symbolic/expression.so in sage.symbolic.expression.Expression.__float__ (sage/symbolic/expression.cpp:7023)()

TypeError: unable to simplify to float approximation
```
So it would appear that the ValueError when using numpy-1.5.1 is thrown my numpy but the TypeError when using numpy-1.7.0b2 is thrown by Sage.



---

archive/issue_comments_146854.json:
```json
{
    "body": "<a id='comment:69'></a>\nOnd\u0159ej just pulled a request with all we need in the 1.7 maintainance branch. Expect new spkg/ebuild early next week based on a git pull.",
    "created_at": "2012-12-14T02:23:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146854",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:69'></a>
Ond≈ôej just pulled a request with all we need in the 1.7 maintainance branch. Expect new spkg/ebuild early next week based on a git pull.



---

archive/issue_comments_146855.json:
```json
{
    "body": "<a id='comment:70'></a>\nThere is a now a rc1. I will update when I can.",
    "created_at": "2013-01-04T09:16:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146855",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:70'></a>
There is a now a rc1. I will update when I can.



---

archive/issue_comments_146856.json:
```json
{
    "body": "<a id='comment:71'></a>\nspkg updated. I will soon run test against a vanilla 5.6.rc0 (as opposed to sage-on-gentoo).",
    "created_at": "2013-01-13T23:10:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146856",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:71'></a>
spkg updated. I will soon run test against a vanilla 5.6.rc0 (as opposed to sage-on-gentoo).



---

archive/issue_comments_146857.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n Numpy-1.7.0 will be available soon and will fix the coercion problem that prevented us to go to numpy-1.6.x.\n \n-New spkg: [http://spkg-upload.googlecode.com/files/numpy-1.7.0b2.spkg](http://spkg-upload.googlecode.com/files/numpy-1.7.0b2.spkg)\n+New spkg: [http://spkg-upload.googlecode.com/files/numpy-1.7.0.rc1.spkg](http://spkg-upload.googlecode.com/files/numpy-1.7.0.rc1.spkg)\n \n Apply:\n * [attachment:trac_11334-dtype_object.patch]\n``````\n",
    "created_at": "2013-01-13T23:10:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146857",
    "user": "https://github.com/kiwifb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 Numpy-1.7.0 will be available soon and will fix the coercion problem that prevented us to go to numpy-1.6.x.
 
-New spkg: [http://spkg-upload.googlecode.com/files/numpy-1.7.0b2.spkg](http://spkg-upload.googlecode.com/files/numpy-1.7.0b2.spkg)
+New spkg: [http://spkg-upload.googlecode.com/files/numpy-1.7.0.rc1.spkg](http://spkg-upload.googlecode.com/files/numpy-1.7.0.rc1.spkg)
 
 Apply:
 * [attachment:trac_11334-dtype_object.patch]
``````




---

archive/issue_comments_146858.json:
```json
{
    "body": "<a id='comment:72'></a>\nTests run here is the list of failing doctest\n\n```\n        sage -t -long devel/sage-main/sage/calculus/interpolators.pyx # 2 doctests failed\n        sage -t -long devel/sage-main/sage/misc/inline_fortran.py # 4 doctests failed\n        sage -t -long devel/sage-main/sage/calculus/riemann.pyx # 14 doctests failed\n        sage -t -long devel/sage-main/sage/symbolic/function.pyx # 1 doctests failed\n        sage -t -long devel/sage-main/sage/plot/plot_field.py # 1 doctests failed\n        sage -t -long devel/sage-main/sage/plot/plot3d/implicit_surface.pyx # 2 doctests failed\n        sage -t -long devel/sage-main/sage/plot/matrix_plot.py # 1 doctests failed\n        sage -t -long devel/sage-main/sage/matrix/matrix1.pyx # 1 doctests failed\n        sage -t -long devel/sage-main/sage/modules/vector_double_dense.pyx # 1 doctests failed\n        sage -t -long devel/sage-main/sage/rings/complex_number.pyx # 1 doctests failed\n        sage -t -long devel/sage-main/sage/rings/real_mpfr.pyx # 1 doctests failed\n        sage -t -long devel/sage-main/sage/rings/rational.pyx # 1 doctests failed\n        sage -t -long devel/sage-main/sage/rings/integer.pyx # 1 doctests failed\n        sage -t -long devel/sage-main/sage/functions/hyperbolic.py # 2 doctests failed\n```\nThere are a couple of new things I believe.\n\n```\nsage -t -long \"devel/sage-main/sage/misc/inline_fortran.py\" \n**********************************************************************\nFile \"/home/work/fbissey/sandbox/sage-5.6.rc0/devel/sage-main/sage/misc/inline_fortran.py\", line 29:\n    sage: fortran(_example)\nException raised:\n    Traceback (most recent call last):\n      File \"/home/work/fbissey/sandbox/sage-5.6.rc0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/home/work/fbissey/sandbox/sage-5.6.rc0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/home/work/fbissey/sandbox/sage-5.6.rc0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_1[4]>\", line 1, in <module>\n        fortran(_example)###line 29:\n    sage: fortran(_example)\n      File \"/home/work/fbissey/sandbox/sage-5.6.rc0/local/lib/python/site-packages/sage/misc/inline_fortran.py\", line 21, in __call__\n        return self.eval(*args, **kwds)\n      File \"/home/work/fbissey/sandbox/sage-5.6.rc0/local/lib/python/site-packages/sage/misc/inline_fortran.py\", line 84, in eval\n        f2py.compile(x, name, extra_args = extra_args, source_fn=fortran_file)\n      File \"/home/work/fbissey/sandbox/sage-5.6.rc0/local/lib/python/site-packages/numpy/f2py/__init__.py\", line 40, in compile\n        s,o = exec_command(c)\n      File \"/home/work/fbissey/sandbox/sage-5.6.rc0/local/lib/python/site-packages/numpy/distutils/exec_command.py\", line 197, in exec_command\n        if _with_python and (0 or sys.stdout.fileno()==-1):\n    AttributeError: _SpoofOut instance has no attribute 'fileno'\n**********************************************************************\nFile \"/home/work/fbissey/sandbox/sage-5.6.rc0/devel/sage-main/sage/misc/inline_fortran.py\", line 32:\n    sage: fib(n,int(10))\nException raised:\n    Traceback (most recent call last):\n      File \"/home/work/fbissey/sandbox/sage-5.6.rc0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/home/work/fbissey/sandbox/sage-5.6.rc0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/home/work/fbissey/sandbox/sage-5.6.rc0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_1[7]>\", line 1, in <module>\n        fib(n,int(Integer(10)))###line 32:\n    sage: fib(n,int(10))\n    NameError: name 'fib' is not defined\n**********************************************************************\nFile \"/home/work/fbissey/sandbox/sage-5.6.rc0/devel/sage-main/sage/misc/inline_fortran.py\", line 33:\n    sage: n\nExpected:\n    array([  0.,   1.,   1.,   2.,   3.,   5.,   8.,  13.,  21.,  34.])\nGot:\n    array([ 0.,  1.,  2.,  3.,  4.,  5.,  6.,  7.,  8.,  9.])\n**********************************************************************\nFile \"/home/work/fbissey/sandbox/sage-5.6.rc0/devel/sage-main/sage/misc/inline_fortran.py\", line 39:\n    sage: fortran.eval(\"SYNTAX ERROR !@#$\")\nExpected:\n    Traceback (most recent call last):\n    ...\n    RuntimeError: failed to compile Fortran code:...\nGot:\n    Traceback (most recent call last):\n      File \"/home/work/fbissey/sandbox/sage-5.6.rc0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/home/work/fbissey/sandbox/sage-5.6.rc0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/home/work/fbissey/sandbox/sage-5.6.rc0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_1[10]>\", line 1, in <module>\n        fortran.eval(\"SYNTAX ERROR !@#$\")###line 39:\n    sage: fortran.eval(\"SYNTAX ERROR !@#$\")\n      File \"/home/work/fbissey/sandbox/sage-5.6.rc0/local/lib/python/site-packages/sage/misc/inline_fortran.py\", line 84, in eval\n        f2py.compile(x, name, extra_args = extra_args, source_fn=fortran_file)\n      File \"/home/work/fbissey/sandbox/sage-5.6.rc0/local/lib/python/site-packages/numpy/f2py/__init__.py\", line 40, in compile\n        s,o = exec_command(c)\n      File \"/home/work/fbissey/sandbox/sage-5.6.rc0/local/lib/python/site-packages/numpy/distutils/exec_command.py\", line 197, in exec_command\n        if _with_python and (0 or sys.stdout.fileno()==-1):\n    AttributeError: _SpoofOut instance has no attribute 'fileno'\n```\nwhich also happens in 5.5 but I overlooked previously (because in my sage-on-gentoo this test always failed in parallel). This is therefore not caused by #13887.\nThis is new I believe\n\n```\nsage -t -long \"devel/sage-main/sage/plot/plot_field.py\"     \n**********************************************************************\nFile \"/home/work/fbissey/sandbox/sage-5.6.rc0/devel/sage-main/sage/plot/plot_field.py\", line 49:\n    sage: r.yvec_array\nExpected:\n    masked_array(data = [0.0 0.707106781187 0.707106781187 0.894427191],\n                 mask = [False False False False],\n           fill_value = 1e+20)\nGot:\n    masked_array(data = [0.0 0.7071067811865475 0.7071067811865475 0.8944271909999159],\n                 mask = [False False False False],\n           fill_value = 1e+20)\n    <BLANKLINE>\n```\nNumerical noise and a blank line..",
    "created_at": "2013-01-14T08:42:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146858",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:72'></a>
Tests run here is the list of failing doctest

```
        sage -t -long devel/sage-main/sage/calculus/interpolators.pyx # 2 doctests failed
        sage -t -long devel/sage-main/sage/misc/inline_fortran.py # 4 doctests failed
        sage -t -long devel/sage-main/sage/calculus/riemann.pyx # 14 doctests failed
        sage -t -long devel/sage-main/sage/symbolic/function.pyx # 1 doctests failed
        sage -t -long devel/sage-main/sage/plot/plot_field.py # 1 doctests failed
        sage -t -long devel/sage-main/sage/plot/plot3d/implicit_surface.pyx # 2 doctests failed
        sage -t -long devel/sage-main/sage/plot/matrix_plot.py # 1 doctests failed
        sage -t -long devel/sage-main/sage/matrix/matrix1.pyx # 1 doctests failed
        sage -t -long devel/sage-main/sage/modules/vector_double_dense.pyx # 1 doctests failed
        sage -t -long devel/sage-main/sage/rings/complex_number.pyx # 1 doctests failed
        sage -t -long devel/sage-main/sage/rings/real_mpfr.pyx # 1 doctests failed
        sage -t -long devel/sage-main/sage/rings/rational.pyx # 1 doctests failed
        sage -t -long devel/sage-main/sage/rings/integer.pyx # 1 doctests failed
        sage -t -long devel/sage-main/sage/functions/hyperbolic.py # 2 doctests failed
```
There are a couple of new things I believe.

```
sage -t -long "devel/sage-main/sage/misc/inline_fortran.py" 
**********************************************************************
File "/home/work/fbissey/sandbox/sage-5.6.rc0/devel/sage-main/sage/misc/inline_fortran.py", line 29:
    sage: fortran(_example)
Exception raised:
    Traceback (most recent call last):
      File "/home/work/fbissey/sandbox/sage-5.6.rc0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/home/work/fbissey/sandbox/sage-5.6.rc0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/home/work/fbissey/sandbox/sage-5.6.rc0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_1[4]>", line 1, in <module>
        fortran(_example)###line 29:
    sage: fortran(_example)
      File "/home/work/fbissey/sandbox/sage-5.6.rc0/local/lib/python/site-packages/sage/misc/inline_fortran.py", line 21, in __call__
        return self.eval(*args, **kwds)
      File "/home/work/fbissey/sandbox/sage-5.6.rc0/local/lib/python/site-packages/sage/misc/inline_fortran.py", line 84, in eval
        f2py.compile(x, name, extra_args = extra_args, source_fn=fortran_file)
      File "/home/work/fbissey/sandbox/sage-5.6.rc0/local/lib/python/site-packages/numpy/f2py/__init__.py", line 40, in compile
        s,o = exec_command(c)
      File "/home/work/fbissey/sandbox/sage-5.6.rc0/local/lib/python/site-packages/numpy/distutils/exec_command.py", line 197, in exec_command
        if _with_python and (0 or sys.stdout.fileno()==-1):
    AttributeError: _SpoofOut instance has no attribute 'fileno'
**********************************************************************
File "/home/work/fbissey/sandbox/sage-5.6.rc0/devel/sage-main/sage/misc/inline_fortran.py", line 32:
    sage: fib(n,int(10))
Exception raised:
    Traceback (most recent call last):
      File "/home/work/fbissey/sandbox/sage-5.6.rc0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/home/work/fbissey/sandbox/sage-5.6.rc0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/home/work/fbissey/sandbox/sage-5.6.rc0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_1[7]>", line 1, in <module>
        fib(n,int(Integer(10)))###line 32:
    sage: fib(n,int(10))
    NameError: name 'fib' is not defined
**********************************************************************
File "/home/work/fbissey/sandbox/sage-5.6.rc0/devel/sage-main/sage/misc/inline_fortran.py", line 33:
    sage: n
Expected:
    array([  0.,   1.,   1.,   2.,   3.,   5.,   8.,  13.,  21.,  34.])
Got:
    array([ 0.,  1.,  2.,  3.,  4.,  5.,  6.,  7.,  8.,  9.])
**********************************************************************
File "/home/work/fbissey/sandbox/sage-5.6.rc0/devel/sage-main/sage/misc/inline_fortran.py", line 39:
    sage: fortran.eval("SYNTAX ERROR !@#$")
Expected:
    Traceback (most recent call last):
    ...
    RuntimeError: failed to compile Fortran code:...
Got:
    Traceback (most recent call last):
      File "/home/work/fbissey/sandbox/sage-5.6.rc0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/home/work/fbissey/sandbox/sage-5.6.rc0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/home/work/fbissey/sandbox/sage-5.6.rc0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_1[10]>", line 1, in <module>
        fortran.eval("SYNTAX ERROR !@#$")###line 39:
    sage: fortran.eval("SYNTAX ERROR !@#$")
      File "/home/work/fbissey/sandbox/sage-5.6.rc0/local/lib/python/site-packages/sage/misc/inline_fortran.py", line 84, in eval
        f2py.compile(x, name, extra_args = extra_args, source_fn=fortran_file)
      File "/home/work/fbissey/sandbox/sage-5.6.rc0/local/lib/python/site-packages/numpy/f2py/__init__.py", line 40, in compile
        s,o = exec_command(c)
      File "/home/work/fbissey/sandbox/sage-5.6.rc0/local/lib/python/site-packages/numpy/distutils/exec_command.py", line 197, in exec_command
        if _with_python and (0 or sys.stdout.fileno()==-1):
    AttributeError: _SpoofOut instance has no attribute 'fileno'
```
which also happens in 5.5 but I overlooked previously (because in my sage-on-gentoo this test always failed in parallel). This is therefore not caused by #13887.
This is new I believe

```
sage -t -long "devel/sage-main/sage/plot/plot_field.py"     
**********************************************************************
File "/home/work/fbissey/sandbox/sage-5.6.rc0/devel/sage-main/sage/plot/plot_field.py", line 49:
    sage: r.yvec_array
Expected:
    masked_array(data = [0.0 0.707106781187 0.707106781187 0.894427191],
                 mask = [False False False False],
           fill_value = 1e+20)
Got:
    masked_array(data = [0.0 0.7071067811865475 0.7071067811865475 0.8944271909999159],
                 mask = [False False False False],
           fill_value = 1e+20)
    <BLANKLINE>
```
Numerical noise and a blank line..



---

archive/issue_comments_146859.json:
```json
{
    "body": "<a id='comment:73'></a>\nI just edited my last comment to repair some mismatching between sage version (I ran the tests on files from sage 5.6.rc0 with sage 5.5...)",
    "created_at": "2013-01-14T08:49:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146859",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:73'></a>
I just edited my last comment to repair some mismatching between sage version (I ran the tests on files from sage 5.6.rc0 with sage 5.5...)



---

archive/issue_comments_146860.json:
```json
{
    "body": "<a id='comment:74'></a>\nBreakage of inline fortran reported upstream at [https://github.com/numpy/numpy/issues/2915](https://github.com/numpy/numpy/issues/2915) as a recent commit look suspicious.",
    "created_at": "2013-01-14T09:07:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146860",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:74'></a>
Breakage of inline fortran reported upstream at [https://github.com/numpy/numpy/issues/2915](https://github.com/numpy/numpy/issues/2915) as a recent commit look suspicious.



---

archive/issue_comments_146861.json:
```json
{
    "body": "<a id='comment:75'></a>\nIt's more than suspicious. Reverting one line of this patch in the installed file enables the doctest to complete without errors.",
    "created_at": "2013-01-14T09:59:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146861",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:75'></a>
It's more than suspicious. Reverting one line of this patch in the installed file enables the doctest to complete without errors.



---

archive/issue_comments_146862.json:
```json
{
    "body": "<a id='comment:76'></a>\nNumpy upstream pointed me to #12415 which does solve the problem. So depending on it.",
    "created_at": "2013-01-14T21:11:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146862",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:76'></a>
Numpy upstream pointed me to #12415 which does solve the problem. So depending on it.



---

archive/issue_comments_146863.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#12415\"",
    "created_at": "2013-01-14T21:11:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146863",
    "user": "https://github.com/kiwifb"
}
```

Changing dependencies from "" to "#12415"



---

archive/issue_comments_146864.json:
```json
{
    "body": "Changing dependencies from \"#12415\" to \"#12415, #13992\"",
    "created_at": "2013-01-23T10:42:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146864",
    "user": "https://github.com/jdemeyer"
}
```

Changing dependencies from "#12415" to "#12415, #13992"



---

archive/issue_comments_146865.json:
```json
{
    "body": "<a id='comment:77'></a>\nPlease remove all reference to `sage_fortran` (#13349 and #13992), i.e. remove the following lines in `spkg-install`:\n\n```\nexport FC=\"${SAGE_LOCAL}/bin/sage_fortran\"\nexport F77=\"${SAGE_LOCAL}/bin/sage_fortran\"\nexport F90=\"${SAGE_LOCAL}/bin/sage_fortran\"\nexport F95=\"${SAGE_LOCAL}/bin/sage_fortran\"\n```",
    "created_at": "2013-01-23T10:42:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146865",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:77'></a>
Please remove all reference to `sage_fortran` (#13349 and #13992), i.e. remove the following lines in `spkg-install`:

```
export FC="${SAGE_LOCAL}/bin/sage_fortran"
export F77="${SAGE_LOCAL}/bin/sage_fortran"
export F90="${SAGE_LOCAL}/bin/sage_fortran"
export F95="${SAGE_LOCAL}/bin/sage_fortran"
```



---

archive/issue_comments_146866.json:
```json
{
    "body": "<a id='comment:78'></a>\nWill do. It's not like we are any closer to final on that one.",
    "created_at": "2013-01-23T10:52:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146866",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:78'></a>
Will do. It's not like we are any closer to final on that one.



---

archive/issue_comments_146867.json:
```json
{
    "body": "<a id='comment:79'></a>\nJust a word of encouragement to those on this ticket - we've had a number of requests for [pandas](http://pandas.pydata.org/) in Sage lately, but apparently this would be a prereq for easy_install-ing that, so we'd need it.",
    "created_at": "2013-02-06T02:49:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146867",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:79'></a>
Just a word of encouragement to those on this ticket - we've had a number of requests for [pandas](http://pandas.pydata.org/) in Sage lately, but apparently this would be a prereq for easy_install-ing that, so we'd need it.



---

archive/issue_comments_146868.json:
```json
{
    "body": "<a id='comment:80'></a>\nThanks Karl-dieter. Actually if you could provide help with the implicit_surface.py test (cube marcher) or get someone who know the code on that case we possibly could wrap it. We would may be wait for an official 1.7.0 but we'd be ready.",
    "created_at": "2013-02-06T04:18:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146868",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:80'></a>
Thanks Karl-dieter. Actually if you could provide help with the implicit_surface.py test (cube marcher) or get someone who know the code on that case we possibly could wrap it. We would may be wait for an official 1.7.0 but we'd be ready.



---

archive/issue_comments_146869.json:
```json
{
    "body": "<a id='comment:81'></a>\nI reviewed the marching cubes code when it went in.  I think here is the problem.  With the previous version of numpy:\n\n```\nimport numpy\nnumpy.array([[None,None],[None,None]]).any()\n```\nreturns False, but now returns None.",
    "created_at": "2013-02-06T04:53:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146869",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:81'></a>
I reviewed the marching cubes code when it went in.  I think here is the problem.  With the previous version of numpy:

```
import numpy
numpy.array([[None,None],[None,None]]).any()
```
returns False, but now returns None.



---

archive/issue_comments_146870.json:
```json
{
    "body": "<a id='comment:82'></a>\nI posted to numpy-discussion about it: http://mail.scipy.org/pipermail/numpy-discussion/2013-February/065377.html",
    "created_at": "2013-02-06T05:24:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146870",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:82'></a>
I posted to numpy-discussion about it: http://mail.scipy.org/pipermail/numpy-discussion/2013-February/065377.html



---

archive/issue_comments_146871.json:
```json
{
    "body": "<a id='comment:83'></a>\nReplying to [jason](#comment%3A81):\n> I reviewed the marching cubes code when it went in.  I think here is the problem.  With the previous version of numpy:\n> \n> \n> ```\n> import numpy\n> numpy.array([[None,None],[None,None]]).any()\n> ```\n> returns False, but now returns None.\n\n\nYes that correlate with some experiments I have with the marching cube code but I hadn't isolated the problem that deeply. I'll look at the discussion but I \nam not sure that is a wrong behavior.",
    "created_at": "2013-02-06T06:01:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146871",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:83'></a>
Replying to [jason](#comment%3A81):
> I reviewed the marching cubes code when it went in.  I think here is the problem.  With the previous version of numpy:
> 
> 
> ```
> import numpy
> numpy.array([[None,None],[None,None]]).any()
> ```
> returns False, but now returns None.


Yes that correlate with some experiments I have with the marching cube code but I hadn't isolated the problem that deeply. I'll look at the discussion but I 
am not sure that is a wrong behavior.



---

archive/issue_comments_146872.json:
```json
{
    "body": "<a id='comment:84'></a>\nI can see the behavior choice going either way.  The question for the numpy folks was if the change was intentional.  If not, the follow-up question is whether it should be changed to be backwards compatible.\n\nAt any rate, I think fixing the doctests to return nothing is fine.",
    "created_at": "2013-02-06T06:15:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146872",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:84'></a>
I can see the behavior choice going either way.  The question for the numpy folks was if the change was intentional.  If not, the follow-up question is whether it should be changed to be backwards compatible.

At any rate, I think fixing the doctests to return nothing is fine.



---

archive/issue_comments_146873.json:
```json
{
    "body": "<a id='comment:85'></a>\nBefore I do that can I ask about the purpose of test? The comment suggest that the calls have no adverse effects but this is not tested afterwards. Because I do not see the point of the test I would just remove it. Any comment on that?\n\nOnce this is sorted, we'll have to see how things combine with #12415. From what I understand from it and some other threads, some \"divide by 0 warnings\" will be with us forever. We probably should check when they appear but they cannot be hidden anymore (I think evanandel was playing hide and seek with them in riemann.pyx).",
    "created_at": "2013-02-06T08:45:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146873",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:85'></a>
Before I do that can I ask about the purpose of test? The comment suggest that the calls have no adverse effects but this is not tested afterwards. Because I do not see the point of the test I would just remove it. Any comment on that?

Once this is sorted, we'll have to see how things combine with #12415. From what I understand from it and some other threads, some "divide by 0 warnings" will be with us forever. We probably should check when they appear but they cannot be hidden anymore (I think evanandel was playing hide and seek with them in riemann.pyx).



---

archive/issue_comments_146874.json:
```json
{
    "body": "<a id='comment:86'></a>\nThis references the failure in the test\n\n```\nsage -t -long -force_lib \"devel/sage-main/sage/plot/matrix_plot.py\"\n```\nI have some concerns with the following block of code in matrix_plot.py\n\n```\n    try:\n        if sparse:\n            xy_data_array = mat\n        else:\n            xy_data_array = np.asarray(mat, dtype = float)\n    except TypeError:\n        raise TypeError, \"mat must be a Matrix or a two dimensional array\"\n    except ValueError:\n        raise ValueError, \"can not convert entries to floating point numbers\"\n\n    if len(xy_data_array.shape) < 2:\n        raise TypeError, \"mat must be a Matrix or a two dimensional array\"\n```\nThe subject failure occurs when the object \"mat\" is not sparse. In which case, the errors are thrown by\n\n```\nnp.asarray(mat, dtype = float)\n```\nI have not been able to pass any object \"mat\" to np.asarray() that returns a `TypeError` or `ValueError`\nthat remotely hints of the cause as being due to\n\n```\n\"mat must be a Matrix or a two dimensional array\"\n```\nI question whether this information can be returned by np.asarray() when used from Sage. I could be wrong though. The referenced failure does return a `TypeError`\n[See above](http://trac.sagemath.org/sage_trac/ticket/11334#comment:68). But this error reflects the inability to coerce the symbolic [sin(x), cos(x)] expressions to floats. It is possible to generate a `ValueError` when the object \"mat\" contains complex entries:\n\n```\nsage: import numpy\nsage: numpy.asarray([[1+1j,2+3j],[1,1]], dtype=float)\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n<ipython-input-5-2bd7229efabd> in <module>()\n----> 1 numpy.asarray([[Integer(1)+ComplexNumber(0, '1'),Integer(2)+ComplexNumber(0, '3')],[Integer(1),Integer(1)]], dtype=float)\n\n/storage/sage/sage-5.7.beta3/local/lib/python2.7/site-packages/numpy/core/numeric.pyc in asarray(a, dtype, order)\n    318 \n    319     \"\"\"\n--> 320     return array(a, dtype, copy=False, order=order)\n    321 \n    322 def asanyarray(a, dtype=None, order=None):\n\nValueError: setting an array element with a sequence.\n```\nThis is they type of error that's returned for the referenced test when using numpy-1.5.1. Sage interprets this error as\n\n```\n\"can not convert entries to floating point numbers\"\n```\nThis seems to be a correct interpretation, at least from the python side with the numpy of this ticket:\n\n```\n>>> import numpy\n>>> numpy.asarray([[1+1j,2+3j],[1,1]], dtype=float)\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\n  File \"/storage/sage/sage-5.7.beta3/local/lib/python2.7/site-packages/numpy/core/numeric.py\", line 320, in asarray\n    return array(a, dtype, copy=False, order=order)\nTypeError: can't convert complex to float\n```\nalthough here there is a `TypeError`?\n\nSo it seems to me that regardless of whether there is a `TypeError` or `ValueError` the root cause is inability to coerce to a float. The question of whether \"mat\" is a Matrix or appropriate array is determined by the lines in the code that parse the shape attribute of an object that has been successfully converted to a ndarray. But this is probably minor compared to #12415. Perhaps Mike (mhansen) has some input?",
    "created_at": "2013-02-07T02:30:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146874",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:86'></a>
This references the failure in the test

```
sage -t -long -force_lib "devel/sage-main/sage/plot/matrix_plot.py"
```
I have some concerns with the following block of code in matrix_plot.py

```
    try:
        if sparse:
            xy_data_array = mat
        else:
            xy_data_array = np.asarray(mat, dtype = float)
    except TypeError:
        raise TypeError, "mat must be a Matrix or a two dimensional array"
    except ValueError:
        raise ValueError, "can not convert entries to floating point numbers"

    if len(xy_data_array.shape) < 2:
        raise TypeError, "mat must be a Matrix or a two dimensional array"
```
The subject failure occurs when the object "mat" is not sparse. In which case, the errors are thrown by

```
np.asarray(mat, dtype = float)
```
I have not been able to pass any object "mat" to np.asarray() that returns a `TypeError` or `ValueError`
that remotely hints of the cause as being due to

```
"mat must be a Matrix or a two dimensional array"
```
I question whether this information can be returned by np.asarray() when used from Sage. I could be wrong though. The referenced failure does return a `TypeError`
[See above](http://trac.sagemath.org/sage_trac/ticket/11334#comment:68). But this error reflects the inability to coerce the symbolic [sin(x), cos(x)] expressions to floats. It is possible to generate a `ValueError` when the object "mat" contains complex entries:

```
sage: import numpy
sage: numpy.asarray([[1+1j,2+3j],[1,1]], dtype=float)
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<ipython-input-5-2bd7229efabd> in <module>()
----> 1 numpy.asarray([[Integer(1)+ComplexNumber(0, '1'),Integer(2)+ComplexNumber(0, '3')],[Integer(1),Integer(1)]], dtype=float)

/storage/sage/sage-5.7.beta3/local/lib/python2.7/site-packages/numpy/core/numeric.pyc in asarray(a, dtype, order)
    318 
    319     """
--> 320     return array(a, dtype, copy=False, order=order)
    321 
    322 def asanyarray(a, dtype=None, order=None):

ValueError: setting an array element with a sequence.
```
This is they type of error that's returned for the referenced test when using numpy-1.5.1. Sage interprets this error as

```
"can not convert entries to floating point numbers"
```
This seems to be a correct interpretation, at least from the python side with the numpy of this ticket:

```
>>> import numpy
>>> numpy.asarray([[1+1j,2+3j],[1,1]], dtype=float)
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "/storage/sage/sage-5.7.beta3/local/lib/python2.7/site-packages/numpy/core/numeric.py", line 320, in asarray
    return array(a, dtype, copy=False, order=order)
TypeError: can't convert complex to float
```
although here there is a `TypeError`?

So it seems to me that regardless of whether there is a `TypeError` or `ValueError` the root cause is inability to coerce to a float. The question of whether "mat" is a Matrix or appropriate array is determined by the lines in the code that parse the shape attribute of an object that has been successfully converted to a ndarray. But this is probably minor compared to #12415. Perhaps Mike (mhansen) has some input?



---

archive/issue_comments_146875.json:
```json
{
    "body": "<a id='comment:87'></a>\nThat would be good to have a little bit more on this although it is indeed not as big as #12415.\n\nIn other news 1.7rc2 has been released less than an hour ago. I am trying to get it up as quickly as possible with the changes Jeroen wants.",
    "created_at": "2013-02-07T02:39:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146875",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:87'></a>
That would be good to have a little bit more on this although it is indeed not as big as #12415.

In other news 1.7rc2 has been released less than an hour ago. I am trying to get it up as quickly as possible with the changes Jeroen wants.



---

archive/issue_comments_146876.json:
```json
{
    "body": "<a id='comment:88'></a>\nspkg updated to rc2 in summary.",
    "created_at": "2013-02-07T02:50:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146876",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:88'></a>
spkg updated to rc2 in summary.



---

archive/issue_comments_146877.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n Numpy-1.7.0 will be available soon and will fix the coercion problem that prevented us to go to numpy-1.6.x.\n \n-New spkg: [http://spkg-upload.googlecode.com/files/numpy-1.7.0.rc1.spkg](http://spkg-upload.googlecode.com/files/numpy-1.7.0.rc1.spkg)\n+New spkg: [http://spkg-upload.googlecode.com/files/numpy-1.7.0.rc2.spkg](http://spkg-upload.googlecode.com/files/numpy-1.7.0.rc2.spkg)\n \n Apply:\n * [attachment:trac_11334-dtype_object.patch]\n``````\n",
    "created_at": "2013-02-07T02:50:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146877",
    "user": "https://github.com/kiwifb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 Numpy-1.7.0 will be available soon and will fix the coercion problem that prevented us to go to numpy-1.6.x.
 
-New spkg: [http://spkg-upload.googlecode.com/files/numpy-1.7.0.rc1.spkg](http://spkg-upload.googlecode.com/files/numpy-1.7.0.rc1.spkg)
+New spkg: [http://spkg-upload.googlecode.com/files/numpy-1.7.0.rc2.spkg](http://spkg-upload.googlecode.com/files/numpy-1.7.0.rc2.spkg)
 
 Apply:
 * [attachment:trac_11334-dtype_object.patch]
``````




---

archive/issue_comments_146878.json:
```json
{
    "body": "<a id='comment:89'></a>\nWhen removing the Fortran stuff, you might need to add `-fPIC` as in #14022.",
    "created_at": "2013-02-07T07:05:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146878",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:89'></a>
When removing the Fortran stuff, you might need to add `-fPIC` as in #14022.



---

archive/issue_comments_146879.json:
```json
{
    "body": "<a id='comment:90'></a>\nReplying to [jdemeyer](#comment%3A89):\n> When removing the Fortran stuff, you might need to add `-fPIC` as in #14022.\n\n\nFunilly enough I thought about it :) and it is in. There is a very good chance that rc2 will be identical to the final release.",
    "created_at": "2013-02-07T08:07:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146879",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:90'></a>
Replying to [jdemeyer](#comment%3A89):
> When removing the Fortran stuff, you might need to add `-fPIC` as in #14022.


Funilly enough I thought about it :) and it is in. There is a very good chance that rc2 will be identical to the final release.



---

archive/issue_comments_146880.json:
```json
{
    "body": "<a id='comment:92'></a>\nok build and tested on top of 5.7.beta3 (but without #12415) and there are no new doctests failures. sage-on-gentoo and an older vanilla build got me a couple of latex output slightly different latex output. Very strange but probably steeming from something else.",
    "created_at": "2013-02-08T23:57:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146880",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:92'></a>
ok build and tested on top of 5.7.beta3 (but without #12415) and there are no new doctests failures. sage-on-gentoo and an older vanilla build got me a couple of latex output slightly different latex output. Very strange but probably steeming from something else.



---

archive/issue_comments_146881.json:
```json
{
    "body": "<a id='comment:93'></a>\nOK I completely missed the release which happened 4 days after rc2. New spkg will be available soon.",
    "created_at": "2013-02-24T08:43:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146881",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:93'></a>
OK I completely missed the release which happened 4 days after rc2. New spkg will be available soon.



---

archive/issue_comments_146882.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n Numpy-1.7.0 will be available soon and will fix the coercion problem that prevented us to go to numpy-1.6.x.\n \n-New spkg: [http://spkg-upload.googlecode.com/files/numpy-1.7.0.rc2.spkg](http://spkg-upload.googlecode.com/files/numpy-1.7.0.rc2.spkg)\n+New spkg: [http://spkg-upload.googlecode.com/files/numpy-1.7.0.spkg](http://spkg-upload.googlecode.com/files/numpy-1.7.0.spkg)\n \n Apply:\n * [attachment:trac_11334-dtype_object.patch]\n``````\n",
    "created_at": "2013-03-18T21:13:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146882",
    "user": "https://github.com/kiwifb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 Numpy-1.7.0 will be available soon and will fix the coercion problem that prevented us to go to numpy-1.6.x.
 
-New spkg: [http://spkg-upload.googlecode.com/files/numpy-1.7.0.rc2.spkg](http://spkg-upload.googlecode.com/files/numpy-1.7.0.rc2.spkg)
+New spkg: [http://spkg-upload.googlecode.com/files/numpy-1.7.0.spkg](http://spkg-upload.googlecode.com/files/numpy-1.7.0.spkg)
 
 Apply:
 * [attachment:trac_11334-dtype_object.patch]
``````




---

archive/issue_comments_146883.json:
```json
{
    "body": "<a id='comment:95'></a>\nspkg updated to numpy 1.7.0 final which is identical to 1.7.0.rc2. We need patches for the divide by zero warnings and the marching cubes test.",
    "created_at": "2013-03-18T21:13:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146883",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:95'></a>
spkg updated to numpy 1.7.0 final which is identical to 1.7.0.rc2. We need patches for the divide by zero warnings and the marching cubes test.



---

archive/issue_comments_146884.json:
```json
{
    "body": "correct dtype output for objects",
    "created_at": "2013-03-21T02:29:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146884",
    "user": "https://github.com/kiwifb"
}
```

correct dtype output for objects



---

archive/issue_comments_146885.json:
```json
{
    "body": "<a id='comment:96'></a>\nAttachment [trac_11334-dtype_object.patch](tarball://root/attachments/some-uuid/ticket11334/trac_11334-dtype_object.patch) by @kiwifb created at 2013-03-21 02:37:07\n\nrebased one patch against 5.9.beta0, more patches to follow.",
    "created_at": "2013-03-21T02:37:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146885",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:96'></a>
Attachment [trac_11334-dtype_object.patch](tarball://root/attachments/some-uuid/ticket11334/trac_11334-dtype_object.patch) by @kiwifb created at 2013-03-21 02:37:07

rebased one patch against 5.9.beta0, more patches to follow.



---

archive/issue_comments_146886.json:
```json
{
    "body": "add divide by 0 warnings",
    "created_at": "2013-03-21T23:16:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146886",
    "user": "https://github.com/kiwifb"
}
```

add divide by 0 warnings



---

archive/issue_comments_146887.json:
```json
{
    "body": "Attachment [trac_11334-cubemarcher.patch](tarball://root/attachments/some-uuid/ticket11334/trac_11334-cubemarcher.patch) by @kiwifb created at 2013-03-21 23:17:03\n\nfix cube_marcher doctests",
    "created_at": "2013-03-21T23:17:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146887",
    "user": "https://github.com/kiwifb"
}
```

Attachment [trac_11334-cubemarcher.patch](tarball://root/attachments/some-uuid/ticket11334/trac_11334-cubemarcher.patch) by @kiwifb created at 2013-03-21 23:17:03

fix cube_marcher doctests



---

archive/issue_comments_146888.json:
```json
{
    "body": "Attachment [trac_11334-numericalnoise.patch](tarball://root/attachments/some-uuid/ticket11334/trac_11334-numericalnoise.patch) by @kiwifb created at 2013-03-21 23:18:41\n\nfix numerical noise",
    "created_at": "2013-03-21T23:18:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146888",
    "user": "https://github.com/kiwifb"
}
```

Attachment [trac_11334-numericalnoise.patch](tarball://root/attachments/some-uuid/ticket11334/trac_11334-numericalnoise.patch) by @kiwifb created at 2013-03-21 23:18:41

fix numerical noise



---

archive/issue_comments_146889.json:
```json
{
    "body": "<a id='comment:97'></a>\nMore patches. Up to review.",
    "created_at": "2013-03-21T23:24:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146889",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:97'></a>
More patches. Up to review.



---

archive/issue_comments_146890.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-03-21T23:24:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146890",
    "user": "https://github.com/kiwifb"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_146891.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,3 +6,6 @@\n * [attachment:trac_11334-dtype_object.patch]\n * [attachment:trac_11334-matrix_plot.patch]\n * [attachment:trac_11334-typecodes.patch]\n+* [attachment:trac_11334-divide.patch]\n+* [attachment:trac_11334-cubemarcher]\n+* [attachment:trac_11334-numericalnoise.patch]\n``````\n",
    "created_at": "2013-03-21T23:24:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146891",
    "user": "https://github.com/kiwifb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,3 +6,6 @@
 * [attachment:trac_11334-dtype_object.patch]
 * [attachment:trac_11334-matrix_plot.patch]
 * [attachment:trac_11334-typecodes.patch]
+* [attachment:trac_11334-divide.patch]
+* [attachment:trac_11334-cubemarcher]
+* [attachment:trac_11334-numericalnoise.patch]
``````




---

archive/issue_comments_146892.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-Numpy-1.7.0 will be available soon and will fix the coercion problem that prevented us to go to numpy-1.6.x.\n+Numpy-1.7.0 is now available and fixes the coercion problem that prevented us to go to numpy-1.6.x.\n \n New spkg: [http://spkg-upload.googlecode.com/files/numpy-1.7.0.spkg](http://spkg-upload.googlecode.com/files/numpy-1.7.0.spkg)\n \n``````\n",
    "created_at": "2013-03-22T10:24:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146892",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-Numpy-1.7.0 will be available soon and will fix the coercion problem that prevented us to go to numpy-1.6.x.
+Numpy-1.7.0 is now available and fixes the coercion problem that prevented us to go to numpy-1.6.x.
 
 New spkg: [http://spkg-upload.googlecode.com/files/numpy-1.7.0.spkg](http://spkg-upload.googlecode.com/files/numpy-1.7.0.spkg)
 
``````




---

archive/issue_comments_146893.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -7,5 +7,5 @@\n * [attachment:trac_11334-matrix_plot.patch]\n * [attachment:trac_11334-typecodes.patch]\n * [attachment:trac_11334-divide.patch]\n-* [attachment:trac_11334-cubemarcher]\n+* [attachment:trac_11334-cubemarcher.patch]\n * [attachment:trac_11334-numericalnoise.patch]\n``````\n",
    "created_at": "2013-03-28T09:25:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146893",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -7,5 +7,5 @@
 * [attachment:trac_11334-matrix_plot.patch]
 * [attachment:trac_11334-typecodes.patch]
 * [attachment:trac_11334-divide.patch]
-* [attachment:trac_11334-cubemarcher]
+* [attachment:trac_11334-cubemarcher.patch]
 * [attachment:trac_11334-numericalnoise.patch]
``````




---

archive/issue_comments_146894.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-04-03T08:52:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146894",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_146895.json:
```json
{
    "body": "<a id='comment:0'></a>\nI assume this is caused by Numpy:\n\n```\nsage -t devel/sage/sage/calculus/riemann.pyx\n**********************************************************************\nFile \"devel/sage/sage/calculus/riemann.pyx\", line 120, in sage.calculus.riemann.Riemann_Map\nFailed example:\n    m = Riemann_Map([f, hf], [fprime, hfprime], 0.5 + 0.5*I)\nExpected nothing\nGot:\n    doctest:1: RuntimeWarning: divide by zero encountered in divide\n**********************************************************************\n```",
    "created_at": "2013-04-03T08:52:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146895",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:0'></a>
I assume this is caused by Numpy:

```
sage -t devel/sage/sage/calculus/riemann.pyx
**********************************************************************
File "devel/sage/sage/calculus/riemann.pyx", line 120, in sage.calculus.riemann.Riemann_Map
Failed example:
    m = Riemann_Map([f, hf], [fprime, hfprime], 0.5 + 0.5*I)
Expected nothing
Got:
    doctest:1: RuntimeWarning: divide by zero encountered in divide
**********************************************************************
```



---

archive/issue_comments_146896.json:
```json
{
    "body": "<a id='comment:1'></a>\nIt smells like one. There were 14 warnings and I patched 14 warnings in that file and that wasn't one of them. Where the heck does it come from?",
    "created_at": "2013-04-03T08:59:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146896",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:1'></a>
It smells like one. There were 14 warnings and I patched 14 warnings in that file and that wasn't one of them. Where the heck does it come from?



---

archive/issue_comments_146897.json:
```json
{
    "body": "<a id='comment:2'></a>\nI checked I don't have this one against 5.9.beta2 so it must be triggered by something else. I am OK to add a small patch for it but would very much like to know what ticket triggered it.",
    "created_at": "2013-04-03T09:09:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146897",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:2'></a>
I checked I don't have this one against 5.9.beta2 so it must be triggered by something else. I am OK to add a small patch for it but would very much like to know what ticket triggered it.



---

archive/issue_comments_146898.json:
```json
{
    "body": "<a id='comment:3'></a>\nThis was with a testing version of sage-5.9.beta4, so there were a bunch of tickets added.",
    "created_at": "2013-04-03T09:15:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146898",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>
This was with a testing version of sage-5.9.beta4, so there were a bunch of tickets added.



---

archive/issue_comments_146899.json:
```json
{
    "body": "<a id='comment:4'></a>\nNot really sure what would trigger something like that from that lot of tickets, my suspicions go with #13031, a change in the way the extension is built. I am assuming you are releasing 5.9.beta3 fairly soon so at least I'll be able to see if it appears on top of it.",
    "created_at": "2013-04-03T09:25:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146899",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:4'></a>
Not really sure what would trigger something like that from that lot of tickets, my suspicions go with #13031, a change in the way the extension is built. I am assuming you are releasing 5.9.beta3 fairly soon so at least I'll be able to see if it appears on top of it.



---

archive/issue_comments_146900.json:
```json
{
    "body": "<a id='comment:105'></a>\nReplying to [jdemeyer](#comment%3A100):\n> I assume this is caused by Numpy:\n> \n> ```\n> sage -t devel/sage/sage/calculus/riemann.pyx\n> **********************************************************************\n> File \"devel/sage/sage/calculus/riemann.pyx\", line 120, in sage.calculus.riemann.Riemann_Map\n> Failed example:\n>     m = Riemann_Map([f, hf], [fprime, hfprime], 0.5 + 0.5*I)\n> Expected nothing\n> Got:\n>     doctest:1: RuntimeWarning: divide by zero encountered in divide\n> **********************************************************************\n> ```\n\nI get this failure here too and I'm testing sage-5.9.beta1 and I don't get the failure associated with the patch for the test starting at line 109\n\n```\nsage: f(t) = e^(I*t)\nsage: fprime(t) = I*e^(I*t)\nsage: m = Riemann_Map([f], [fprime], 0)  # long time (4 sec)\n```",
    "created_at": "2013-04-03T16:51:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146900",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:105'></a>
Replying to [jdemeyer](#comment%3A100):
> I assume this is caused by Numpy:
> 
> ```
> sage -t devel/sage/sage/calculus/riemann.pyx
> **********************************************************************
> File "devel/sage/sage/calculus/riemann.pyx", line 120, in sage.calculus.riemann.Riemann_Map
> Failed example:
>     m = Riemann_Map([f, hf], [fprime, hfprime], 0.5 + 0.5*I)
> Expected nothing
> Got:
>     doctest:1: RuntimeWarning: divide by zero encountered in divide
> **********************************************************************
> ```

I get this failure here too and I'm testing sage-5.9.beta1 and I don't get the failure associated with the patch for the test starting at line 109

```
sage: f(t) = e^(I*t)
sage: fprime(t) = I*e^(I*t)
sage: m = Riemann_Map([f], [fprime], 0)  # long time (4 sec)
```



---

archive/issue_comments_146901.json:
```json
{
    "body": "<a id='comment:6'></a>\nI find the whole thing very curious. If you look at the divide patch you'll notice that all the warning generated by Riemann_Map are of the kind Riemann_Map([f], [fprime], 0) - it may be possible for other calls to generate a divide by zero warning but the ending \"0\" argument in Riemann_Map will automatically give you one. We could check with Eviatar but I am fairly sure that it is a case were you will have one, no matter what.\nSo you both see one that doesn't have a \"0\", that's possible but that you, Steve, don't see one at line 109 rings alarm bells. Would it be the machine on which you experience [https://github.com/cschwan/sage-on-gentoo/issues/208](https://github.com/cschwan/sage-on-gentoo/issues/208) by any chance?",
    "created_at": "2013-04-03T21:29:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146901",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:6'></a>
I find the whole thing very curious. If you look at the divide patch you'll notice that all the warning generated by Riemann_Map are of the kind Riemann_Map([f], [fprime], 0) - it may be possible for other calls to generate a divide by zero warning but the ending "0" argument in Riemann_Map will automatically give you one. We could check with Eviatar but I am fairly sure that it is a case were you will have one, no matter what.
So you both see one that doesn't have a "0", that's possible but that you, Steve, don't see one at line 109 rings alarm bells. Would it be the machine on which you experience [https://github.com/cschwan/sage-on-gentoo/issues/208](https://github.com/cschwan/sage-on-gentoo/issues/208) by any chance?



---

archive/issue_comments_146902.json:
```json
{
    "body": "<a id='comment:107'></a>\nReplying to [fbissey](#comment%3A106):\n>Steve, don't see one at line 109 rings alarm bells. Would it be the machine on which you experience [https://github.com/cschwan/sage-on-gentoo/issues/208](https://github.com/cschwan/sage-on-gentoo/issues/208) by any chance?\n\nNo, this is another machine. Vanilla Sage was built in prefix on this machine. And even on the machine associate with [https://github.com/cschwan/sage-on-gentoo/issues/208](https://github.com/cschwan/sage-on-gentoo/issues/208), vanilla Sage does not exhibit the odd behavior of that issue. I get with the prefix-built Sage\n\n```\n$ ./sage -t devel/sage/sage/calculus/riemann.pyx\nRunning doctests with ID 2013-04-03-16-48-12-0f9b93ae.\nDoctesting 1 file.\nsage -t devel/sage/sage/calculus/riemann.pyx\n**********************************************************************\nFile \"devel/sage/sage/calculus/riemann.pyx\", line 119, in sage.calculus.riemann.Riemann_Map\nFailed example:\n    m = Riemann_Map([f, hf], [fprime, hfprime], 0.5 + 0.5*I)\nExpected nothing\nGot:\n    doctest:1: RuntimeWarning: divide by zero encountered in divide\n**********************************************************************\nFile \"devel/sage/sage/calculus/riemann.pyx\", line 163, in sage.calculus.riemann.Riemann_Map.__init__\nFailed example:\n    m = Riemann_Map([f], [fprime], 0)\nExpected nothing\nGot:\n    doctest:1: RuntimeWarning: divide by zero encountered in divide\n**********************************************************************\nFile \"devel/sage/sage/calculus/riemann.pyx\", line 228, in sage.calculus.riemann.Riemann_Map._generate_theta_array\nFailed example:\n    m = Riemann_Map([f], [fprime], 0)\nExpected nothing\nGot:\n    doctest:1: RuntimeWarning: divide by zero encountered in divide\n**********************************************************************\n```\nThere is no failure associated with the test starting at line 109. However on a fresh start of Sage I get for the test starting at line 109:\n\n```\nsage: f(t) = e^(I*t)                                          \nsage: fprime(t) = I*e^(I*t)                                   \nsage: m = Riemann_Map([f], [fprime], 0)  # long time (4 sec)  \n/storage/sage/sage-5.9.beta1/local/bin/sage-ipython:1: RuntimeWarning: divide by zero encountered in divide\n  #!/usr/bin/env python\n```\nbut if I run the commands again without restarting Sage I get no `RuntimeWarning`. Is this to be expected? Is something being cached somewhere? And oddly with your patch \n[trac_11334-divide.patch](http://trac.sagemath.org/sage_trac/attachment/ticket/11334/trac_11334-divide.patch) I only get\n\n```\n$ ./sage -t devel/sage/sage/calculus/riemann.pyx                                                                                                                                                                                                                                Running doctests with ID 2013-04-03-17-14-01-9d1e8739.\nDoctesting 1 file.\nsage -t devel/sage/sage/calculus/riemann.pyx\n**********************************************************************\nFile \"devel/sage/sage/calculus/riemann.pyx\", line 120, in sage.calculus.riemann.Riemann_Map\nFailed example:\n    m = Riemann_Map([f, hf], [fprime, hfprime], 0.5 + 0.5*I)\nExpected nothing\nGot:\n    doctest:1: RuntimeWarning: divide by zero encountered in divide\n**********************************************************************\n```",
    "created_at": "2013-04-03T22:39:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146902",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:107'></a>
Replying to [fbissey](#comment%3A106):
>Steve, don't see one at line 109 rings alarm bells. Would it be the machine on which you experience [https://github.com/cschwan/sage-on-gentoo/issues/208](https://github.com/cschwan/sage-on-gentoo/issues/208) by any chance?

No, this is another machine. Vanilla Sage was built in prefix on this machine. And even on the machine associate with [https://github.com/cschwan/sage-on-gentoo/issues/208](https://github.com/cschwan/sage-on-gentoo/issues/208), vanilla Sage does not exhibit the odd behavior of that issue. I get with the prefix-built Sage

```
$ ./sage -t devel/sage/sage/calculus/riemann.pyx
Running doctests with ID 2013-04-03-16-48-12-0f9b93ae.
Doctesting 1 file.
sage -t devel/sage/sage/calculus/riemann.pyx
**********************************************************************
File "devel/sage/sage/calculus/riemann.pyx", line 119, in sage.calculus.riemann.Riemann_Map
Failed example:
    m = Riemann_Map([f, hf], [fprime, hfprime], 0.5 + 0.5*I)
Expected nothing
Got:
    doctest:1: RuntimeWarning: divide by zero encountered in divide
**********************************************************************
File "devel/sage/sage/calculus/riemann.pyx", line 163, in sage.calculus.riemann.Riemann_Map.__init__
Failed example:
    m = Riemann_Map([f], [fprime], 0)
Expected nothing
Got:
    doctest:1: RuntimeWarning: divide by zero encountered in divide
**********************************************************************
File "devel/sage/sage/calculus/riemann.pyx", line 228, in sage.calculus.riemann.Riemann_Map._generate_theta_array
Failed example:
    m = Riemann_Map([f], [fprime], 0)
Expected nothing
Got:
    doctest:1: RuntimeWarning: divide by zero encountered in divide
**********************************************************************
```
There is no failure associated with the test starting at line 109. However on a fresh start of Sage I get for the test starting at line 109:

```
sage: f(t) = e^(I*t)                                          
sage: fprime(t) = I*e^(I*t)                                   
sage: m = Riemann_Map([f], [fprime], 0)  # long time (4 sec)  
/storage/sage/sage-5.9.beta1/local/bin/sage-ipython:1: RuntimeWarning: divide by zero encountered in divide
  #!/usr/bin/env python
```
but if I run the commands again without restarting Sage I get no `RuntimeWarning`. Is this to be expected? Is something being cached somewhere? And oddly with your patch 
[trac_11334-divide.patch](http://trac.sagemath.org/sage_trac/attachment/ticket/11334/trac_11334-divide.patch) I only get

```
$ ./sage -t devel/sage/sage/calculus/riemann.pyx                                                                                                                                                                                                                                Running doctests with ID 2013-04-03-17-14-01-9d1e8739.
Doctesting 1 file.
sage -t devel/sage/sage/calculus/riemann.pyx
**********************************************************************
File "devel/sage/sage/calculus/riemann.pyx", line 120, in sage.calculus.riemann.Riemann_Map
Failed example:
    m = Riemann_Map([f, hf], [fprime, hfprime], 0.5 + 0.5*I)
Expected nothing
Got:
    doctest:1: RuntimeWarning: divide by zero encountered in divide
**********************************************************************
```



---

archive/issue_comments_146903.json:
```json
{
    "body": "<a id='comment:8'></a>\nOK, I think not getting the warning again is expected but I am not sure about the details of why. After my patch the test from line 119 becomes line 120 so that bit is consistent. \n\nWhat happens if you run the example of line 119/120 in sage? With or without the patch?",
    "created_at": "2013-04-03T22:49:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146903",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:8'></a>
OK, I think not getting the warning again is expected but I am not sure about the details of why. After my patch the test from line 119 becomes line 120 so that bit is consistent. 

What happens if you run the example of line 119/120 in sage? With or without the patch?



---

archive/issue_comments_146904.json:
```json
{
    "body": "<a id='comment:109'></a>\nReplying to [fbissey](#comment%3A108):\n> OK, I think not getting the warning again is expected but I am not sure about the details of why. After my patch the test from line 119 becomes line 120 so that bit is consistent. \n> \n> What happens if you run the example of line 119/120 in sage? With or without the patch?\n\nIt fails, at least on the first try it does\n\n```\nsage: f(t) = e^(I*t)\nsage: fprime(t) = I*e^(I*t)\nsage: hf(t) = 0.5*e^(-I*t)\nsage: hfprime(t) = 0.5*-I*e^(-I*t)\nsage: m = Riemann_Map([f, hf], [fprime, hfprime], 0.5 + 0.5*I)\n/storage/sage/sage-5.9.beta1/local/bin/sage-ipython:1: RuntimeWarning: divide by zero encountered in divide\n  #!/usr/bin/env python\n```",
    "created_at": "2013-04-03T23:04:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146904",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:109'></a>
Replying to [fbissey](#comment%3A108):
> OK, I think not getting the warning again is expected but I am not sure about the details of why. After my patch the test from line 119 becomes line 120 so that bit is consistent. 
> 
> What happens if you run the example of line 119/120 in sage? With or without the patch?

It fails, at least on the first try it does

```
sage: f(t) = e^(I*t)
sage: fprime(t) = I*e^(I*t)
sage: hf(t) = 0.5*e^(-I*t)
sage: hfprime(t) = 0.5*-I*e^(-I*t)
sage: m = Riemann_Map([f, hf], [fprime, hfprime], 0.5 + 0.5*I)
/storage/sage/sage-5.9.beta1/local/bin/sage-ipython:1: RuntimeWarning: divide by zero encountered in divide
  #!/usr/bin/env python
```



---

archive/issue_comments_146905.json:
```json
{
    "body": "<a id='comment:0'></a>\nOK I am building 5.9.beta2 from scratch on power7 and will try that here as well to see for myself. But 5.9.beta2 s-o-g doesn't suffer from this here.",
    "created_at": "2013-04-03T23:11:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146905",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:0'></a>
OK I am building 5.9.beta2 from scratch on power7 and will try that here as well to see for myself. But 5.9.beta2 s-o-g doesn't suffer from this here.



---

archive/issue_comments_146906.json:
```json
{
    "body": "<a id='comment:1'></a>\nOh wait in sage-on-gentoo I get it when I run the example manually but not when I run the doctest, this is getting weirder.",
    "created_at": "2013-04-03T23:14:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146906",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:1'></a>
Oh wait in sage-on-gentoo I get it when I run the example manually but not when I run the doctest, this is getting weirder.



---

archive/issue_comments_146907.json:
```json
{
    "body": "<a id='comment:2'></a>\nOK,\n\n```\n----------------------------------------------------------------------\n----------------------------------------------------------------------\n**********************************************************************\n*                                                                    *\n* Warning: this is a prerelease version, and it may be unstable.     *\n*                                                                    *\n**********************************************************************\nsage: f(t) = e^(I*t)\nsage: fprime(t) = I*e^(I*t)\nsage: hf(t) = 0.5*e^(-I*t)\nsage: hfprime(t) = 0.5*-I*e^(-I*t)\nsage: m = Riemann_Map([f, hf], [fprime, hfprime], 0.5 + 0.5*I)\n/usr/bin/sage-ipython:1: RuntimeWarning: divide by zero encountered in divide\n  #!/usr/bin/env python\n```\nbut\n| Sage Version 5.9.beta2, Release Date: 2013-03-28                   |\n| Type \"notebook()\" for the browser-based notebook interface.        |\n| Type \"help()\" for help.                                            |\n\n```\n----------------------------------------------------------------------\n----------------------------------------------------------------------\n**********************************************************************\n*                                                                    *\n* Warning: this is a prerelease version, and it may be unstable.     *\n*                                                                    *\n**********************************************************************\nsage: f(t) = e^(I*t)\nsage: fprime(t) = I*e^(I*t)\nsage: m = Riemann_Map([f], [fprime], 0)\n/usr/bin/sage-ipython:1: RuntimeWarning: divide by zero encountered in divide\n  #!/usr/bin/env python\nsage:  hf(t) = 0.5*e^(-I*t)\nsage: hfprime(t) = 0.5*-I*e^(-I*t)\nsage: m = Riemann_Map([f, hf], [fprime, hfprime], 0.5 + 0.5*I)\n```\nso in some conditions numpy warnings are not reset between these two adjacent tests and some other it is. I was going to ask if they could have been run out of order but I think the ticket for that is not happening anytime soon. But that would have explained why you see a failure in 119 but not 109.\n| Sage Version 5.9.beta2, Release Date: 2013-03-28                   |\n| Type \"notebook()\" for the browser-based notebook interface.        |\n| Type \"help()\" for help.                                            |",
    "created_at": "2013-04-03T23:21:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146907",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:2'></a>
OK,

```
----------------------------------------------------------------------
----------------------------------------------------------------------
**********************************************************************
*                                                                    *
* Warning: this is a prerelease version, and it may be unstable.     *
*                                                                    *
**********************************************************************
sage: f(t) = e^(I*t)
sage: fprime(t) = I*e^(I*t)
sage: hf(t) = 0.5*e^(-I*t)
sage: hfprime(t) = 0.5*-I*e^(-I*t)
sage: m = Riemann_Map([f, hf], [fprime, hfprime], 0.5 + 0.5*I)
/usr/bin/sage-ipython:1: RuntimeWarning: divide by zero encountered in divide
  #!/usr/bin/env python
```
but
| Sage Version 5.9.beta2, Release Date: 2013-03-28                   |
| Type "notebook()" for the browser-based notebook interface.        |
| Type "help()" for help.                                            |

```
----------------------------------------------------------------------
----------------------------------------------------------------------
**********************************************************************
*                                                                    *
* Warning: this is a prerelease version, and it may be unstable.     *
*                                                                    *
**********************************************************************
sage: f(t) = e^(I*t)
sage: fprime(t) = I*e^(I*t)
sage: m = Riemann_Map([f], [fprime], 0)
/usr/bin/sage-ipython:1: RuntimeWarning: divide by zero encountered in divide
  #!/usr/bin/env python
sage:  hf(t) = 0.5*e^(-I*t)
sage: hfprime(t) = 0.5*-I*e^(-I*t)
sage: m = Riemann_Map([f, hf], [fprime, hfprime], 0.5 + 0.5*I)
```
so in some conditions numpy warnings are not reset between these two adjacent tests and some other it is. I was going to ask if they could have been run out of order but I think the ticket for that is not happening anytime soon. But that would have explained why you see a failure in 119 but not 109.
| Sage Version 5.9.beta2, Release Date: 2013-03-28                   |
| Type "notebook()" for the browser-based notebook interface.        |
| Type "help()" for help.                                            |



---

archive/issue_comments_146908.json:
```json
{
    "body": "<a id='comment:3'></a>\nI get it in my build of 5.9.beta2 on power7, I cannot understand how the thing happens.",
    "created_at": "2013-04-04T02:51:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146908",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:3'></a>
I get it in my build of 5.9.beta2 on power7, I cannot understand how the thing happens.



---

archive/issue_comments_146909.json:
```json
{
    "body": "<a id='comment:4'></a>\nI've now tested 5.9.beta3 on two different machines and I get the following numpy-related warnings which I also saw with 5.9.beta2.\n\n```\n./sage -t --long devel/sage/sage/matrix/matrix2.pyx devel/sage/sage/symbolic/expression.pyx\nRunning doctests with ID 2013-04-04-12-42-24-9b2fa346.\nDoctesting 2 files.\nsage -t --long devel/sage/sage/matrix/matrix2.pyx\n**********************************************************************\nFile \"devel/sage/sage/matrix/matrix2.pyx\", line 11476, in sage.matrix.matrix2.Matrix.diagonal.plot\nFailed example:\n    A.plot()\nExpected nothing\nGot:\n    doctest:146: RuntimeWarning: numpy.dtype size changed, may indicate binary incompatibility\n    doctest:146: RuntimeWarning: numpy.ufunc size changed, may indicate binary incompatibility\n    doctest:3: RuntimeWarning: numpy.dtype size changed, may indicate binary incompatibility\n    doctest:3: RuntimeWarning: numpy.ufunc size changed, may indicate binary incompatibility\n    doctest:148: RuntimeWarning: numpy.dtype size changed, may indicate binary incompatibility\n    doctest:148: RuntimeWarning: numpy.ufunc size changed, may indicate binary incompatibility\n    doctest:150: RuntimeWarning: numpy.dtype size changed, may indicate binary incompatibility\n    doctest:150: RuntimeWarning: numpy.ufunc size changed, may indicate binary incompatibility\n    <BLANKLINE>\n**********************************************************************\n1 item had failures:\n   1 of   7 in sage.matrix.matrix2.Matrix.diagonal.plot\n    [2000 tests, 1 failure, 38.68 s]\nsage -t --long devel/sage/sage/symbolic/expression.pyx\n**********************************************************************\nFile \"devel/sage/sage/symbolic/expression.pyx\", line 8747, in sage.symbolic.expression.Expression.find_root\nFailed example:\n    f.find_root(-2, 3)\nExpected:\n    1.0\nGot:\n    doctest:146: RuntimeWarning: numpy.dtype size changed, may indicate binary incompatibility\n    doctest:146: RuntimeWarning: numpy.ufunc size changed, may indicate binary incompatibility\n    doctest:3: RuntimeWarning: numpy.dtype size changed, may indicate binary incompatibility\n    doctest:3: RuntimeWarning: numpy.ufunc size changed, may indicate binary incompatibility\n    doctest:148: RuntimeWarning: numpy.dtype size changed, may indicate binary incompatibility\n    doctest:148: RuntimeWarning: numpy.ufunc size changed, may indicate binary incompatibility\n    doctest:150: RuntimeWarning: numpy.dtype size changed, may indicate binary incompatibility\n    doctest:150: RuntimeWarning: numpy.ufunc size changed, may indicate binary incompatibility\n    1.0\n**********************************************************************\n1 item had failures:\n   1 of  29 in sage.symbolic.expression.Expression.find_root\n    [2041 tests, 1 failure, 36.88 s]\n----------------------------------------------------------------------\nsage -t --long devel/sage/sage/matrix/matrix2.pyx  # 1 doctest failed\nsage -t --long devel/sage/sage/symbolic/expression.pyx  # 1 doctest failed\n----------------------------------------------------------------------\nTotal time for all tests: 77.1 seconds\n    cpu time: 72.3 seconds\n    cumulative wall time: 75.6 seconds\n```\nWhat is really odd is that the seemingly offending lines when run from the Sage prompt give _no_ warnings. And I don't see where in the .pyx files `RuntimeWarnings` are explicitly turned on or off. It is as if warnings are only being turned on during doctesting or perhaps something else is up.",
    "created_at": "2013-04-04T18:27:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146909",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:4'></a>
I've now tested 5.9.beta3 on two different machines and I get the following numpy-related warnings which I also saw with 5.9.beta2.

```
./sage -t --long devel/sage/sage/matrix/matrix2.pyx devel/sage/sage/symbolic/expression.pyx
Running doctests with ID 2013-04-04-12-42-24-9b2fa346.
Doctesting 2 files.
sage -t --long devel/sage/sage/matrix/matrix2.pyx
**********************************************************************
File "devel/sage/sage/matrix/matrix2.pyx", line 11476, in sage.matrix.matrix2.Matrix.diagonal.plot
Failed example:
    A.plot()
Expected nothing
Got:
    doctest:146: RuntimeWarning: numpy.dtype size changed, may indicate binary incompatibility
    doctest:146: RuntimeWarning: numpy.ufunc size changed, may indicate binary incompatibility
    doctest:3: RuntimeWarning: numpy.dtype size changed, may indicate binary incompatibility
    doctest:3: RuntimeWarning: numpy.ufunc size changed, may indicate binary incompatibility
    doctest:148: RuntimeWarning: numpy.dtype size changed, may indicate binary incompatibility
    doctest:148: RuntimeWarning: numpy.ufunc size changed, may indicate binary incompatibility
    doctest:150: RuntimeWarning: numpy.dtype size changed, may indicate binary incompatibility
    doctest:150: RuntimeWarning: numpy.ufunc size changed, may indicate binary incompatibility
    <BLANKLINE>
**********************************************************************
1 item had failures:
   1 of   7 in sage.matrix.matrix2.Matrix.diagonal.plot
    [2000 tests, 1 failure, 38.68 s]
sage -t --long devel/sage/sage/symbolic/expression.pyx
**********************************************************************
File "devel/sage/sage/symbolic/expression.pyx", line 8747, in sage.symbolic.expression.Expression.find_root
Failed example:
    f.find_root(-2, 3)
Expected:
    1.0
Got:
    doctest:146: RuntimeWarning: numpy.dtype size changed, may indicate binary incompatibility
    doctest:146: RuntimeWarning: numpy.ufunc size changed, may indicate binary incompatibility
    doctest:3: RuntimeWarning: numpy.dtype size changed, may indicate binary incompatibility
    doctest:3: RuntimeWarning: numpy.ufunc size changed, may indicate binary incompatibility
    doctest:148: RuntimeWarning: numpy.dtype size changed, may indicate binary incompatibility
    doctest:148: RuntimeWarning: numpy.ufunc size changed, may indicate binary incompatibility
    doctest:150: RuntimeWarning: numpy.dtype size changed, may indicate binary incompatibility
    doctest:150: RuntimeWarning: numpy.ufunc size changed, may indicate binary incompatibility
    1.0
**********************************************************************
1 item had failures:
   1 of  29 in sage.symbolic.expression.Expression.find_root
    [2041 tests, 1 failure, 36.88 s]
----------------------------------------------------------------------
sage -t --long devel/sage/sage/matrix/matrix2.pyx  # 1 doctest failed
sage -t --long devel/sage/sage/symbolic/expression.pyx  # 1 doctest failed
----------------------------------------------------------------------
Total time for all tests: 77.1 seconds
    cpu time: 72.3 seconds
    cumulative wall time: 75.6 seconds
```
What is really odd is that the seemingly offending lines when run from the Sage prompt give _no_ warnings. And I don't see where in the .pyx files `RuntimeWarnings` are explicitly turned on or off. It is as if warnings are only being turned on during doctesting or perhaps something else is up.



---

archive/issue_comments_146910.json:
```json
{
    "body": "<a id='comment:5'></a>\nDid install sage and then upgrade numpy? I think it means that some components depending on numpy haven't been rebuilt. I have done my builds by replacing the numpy spkg in spkg/standard and then building from scratch to avoid that kind of problems.",
    "created_at": "2013-04-04T19:52:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146910",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:5'></a>
Did install sage and then upgrade numpy? I think it means that some components depending on numpy haven't been rebuilt. I have done my builds by replacing the numpy spkg in spkg/standard and then building from scratch to avoid that kind of problems.



---

archive/issue_comments_146911.json:
```json
{
    "body": "<a id='comment:6'></a>\nYes. I see. That would explain it. Normally I do an install from scratch but didn't here. I'll try again.",
    "created_at": "2013-04-04T20:06:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146911",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:6'></a>
Yes. I see. That would explain it. Normally I do an install from scratch but didn't here. I'll try again.



---

archive/issue_comments_146912.json:
```json
{
    "body": "suppress divide warnings in riemann.pyx",
    "created_at": "2013-04-04T22:00:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146912",
    "user": "https://github.com/kiwifb"
}
```

suppress divide warnings in riemann.pyx



---

archive/issue_comments_146913.json:
```json
{
    "body": "<a id='comment:7'></a>\nAttachment [trac_11334-suppressdivide.patch](tarball://root/attachments/some-uuid/ticket11334/trac_11334-suppressdivide.patch) by @strogdon created at 2013-04-04 22:54:26\n\nOK, so the above `RuntimeWarnings` are bogus and don't appear when things are built correctly (from scratch). Curiously,\n\n```\nsage -t --long devel/sage/sage/calculus/riemann.pyx\n```\ndoes not fail when testing using `'make ptestlong'`, but does yield the `'divide by zero'` warning when run individually.",
    "created_at": "2013-04-04T22:54:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146913",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:7'></a>
Attachment [trac_11334-suppressdivide.patch](tarball://root/attachments/some-uuid/ticket11334/trac_11334-suppressdivide.patch) by @strogdon created at 2013-04-04 22:54:26

OK, so the above `RuntimeWarnings` are bogus and don't appear when things are built correctly (from scratch). Curiously,

```
sage -t --long devel/sage/sage/calculus/riemann.pyx
```
does not fail when testing using `'make ptestlong'`, but does yield the `'divide by zero'` warning when run individually.



---

archive/issue_comments_146914.json:
```json
{
    "body": "<a id='comment:8'></a>\nYes very curious things like that happens. I am preparing a new set of patch with a different strategy to deal with riemann.pyx. I already uploaded one but I need to make a new patch for other divide warnings not coming from riemann.pyx - people willingly wanting to see 1/0 results.",
    "created_at": "2013-04-05T00:06:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146914",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:8'></a>
Yes very curious things like that happens. I am preparing a new set of patch with a different strategy to deal with riemann.pyx. I already uploaded one but I need to make a new patch for other divide warnings not coming from riemann.pyx - people willingly wanting to see 1/0 results.



---

archive/issue_comments_146915.json:
```json
{
    "body": "Attachment [trac_11334-divide-v2.patch](tarball://root/attachments/some-uuid/ticket11334/trac_11334-divide-v2.patch) by @kiwifb created at 2013-04-05 00:18:03\n\nfix non riemann.pyx divivde by zero warnings",
    "created_at": "2013-04-05T00:18:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146915",
    "user": "https://github.com/kiwifb"
}
```

Attachment [trac_11334-divide-v2.patch](tarball://root/attachments/some-uuid/ticket11334/trac_11334-divide-v2.patch) by @kiwifb created at 2013-04-05 00:18:03

fix non riemann.pyx divivde by zero warnings



---

archive/issue_comments_146916.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,6 +6,7 @@\n * [attachment:trac_11334-dtype_object.patch]\n * [attachment:trac_11334-matrix_plot.patch]\n * [attachment:trac_11334-typecodes.patch]\n-* [attachment:trac_11334-divide.patch]\n+* [attachment:trac_11334-suppressdivide.patch]\n+* [attachment:trac_11334-divide-v2.patch]\n * [attachment:trac_11334-cubemarcher.patch]\n * [attachment:trac_11334-numericalnoise.patch]\n``````\n",
    "created_at": "2013-04-05T00:20:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146916",
    "user": "https://github.com/kiwifb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,6 +6,7 @@
 * [attachment:trac_11334-dtype_object.patch]
 * [attachment:trac_11334-matrix_plot.patch]
 * [attachment:trac_11334-typecodes.patch]
-* [attachment:trac_11334-divide.patch]
+* [attachment:trac_11334-suppressdivide.patch]
+* [attachment:trac_11334-divide-v2.patch]
 * [attachment:trac_11334-cubemarcher.patch]
 * [attachment:trac_11334-numericalnoise.patch]
``````




---

archive/issue_comments_146917.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-04-05T00:20:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146917",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_146918.json:
```json
{
    "body": "<a id='comment:9'></a>\nOK new patch set. If that doesn't work for you we have a serious problem. Back to need review.",
    "created_at": "2013-04-05T00:20:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146918",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:9'></a>
OK new patch set. If that doesn't work for you we have a serious problem. Back to need review.



---

archive/issue_comments_146919.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Steven Trogdon\"",
    "created_at": "2013-04-05T23:56:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146919",
    "user": "https://github.com/strogdon"
}
```

Changing reviewer from "" to "Steven Trogdon"



---

archive/issue_comments_146920.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-04-05T23:56:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146920",
    "user": "https://github.com/strogdon"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_146921.json:
```json
{
    "body": "<a id='comment:0'></a>\nIt's odd that one has to resort to such \"trickery\" to ignore warnings. However, it is not without warrant since the ignore mechanism was already operative at a certain level in riemann.pyx. This works for me here - all \"divide by zero\" warnings have been removed from output and everything survives `make ptestlong`. Positive review.",
    "created_at": "2013-04-05T23:56:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146921",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:0'></a>
It's odd that one has to resort to such "trickery" to ignore warnings. However, it is not without warrant since the ignore mechanism was already operative at a certain level in riemann.pyx. This works for me here - all "divide by zero" warnings have been removed from output and everything survives `make ptestlong`. Positive review.



---

archive/issue_comments_146922.json:
```json
{
    "body": "<a id='comment:1'></a>\nI suspect the strange behavior we have seen may be a symptom of something deeper on the way the doctesting framework deals with warnings. Anyway it should be sorted by that last couple of patch for this case.",
    "created_at": "2013-04-06T10:19:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146922",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:1'></a>
I suspect the strange behavior we have seen may be a symptom of something deeper on the way the doctesting framework deals with warnings. Anyway it should be sorted by that last couple of patch for this case.



---

archive/issue_events_042601.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-06T14:52:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "milestone": "sage-5.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11334#event-42601"
}
```



---

archive/issue_comments_146923.json:
```json
{
    "body": "Changing author from \"\" to \"Fran\u00e7ois Bissey\"",
    "created_at": "2013-04-07T19:30:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146923",
    "user": "https://github.com/jdemeyer"
}
```

Changing author from "" to "Fran√ßois Bissey"



---

archive/issue_comments_146924.json:
```json
{
    "body": "<a id='comment:4'></a>\nAttachment [11334_noise2.patch](tarball://root/attachments/some-uuid/ticket11334/11334_noise2.patch) by @jdemeyer created at 2013-04-13 13:37:01\n\n[attachment:11334_noise2.patch] (numerical noise on OS X 10.8) needs review.",
    "created_at": "2013-04-13T13:37:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146924",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>
Attachment [11334_noise2.patch](tarball://root/attachments/some-uuid/ticket11334/11334_noise2.patch) by @jdemeyer created at 2013-04-13 13:37:01

[attachment:11334_noise2.patch] (numerical noise on OS X 10.8) needs review.



---

archive/issue_comments_146925.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-04-13T13:37:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146925",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_146926.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-04-13T13:37:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146926",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_146927.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -10,3 +10,4 @@\n * [attachment:trac_11334-divide-v2.patch]\n * [attachment:trac_11334-cubemarcher.patch]\n * [attachment:trac_11334-numericalnoise.patch]\n+* [attachment:11334_noise2.patch]\n``````\n",
    "created_at": "2013-04-14T23:51:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146927",
    "user": "https://github.com/kiwifb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -10,3 +10,4 @@
 * [attachment:trac_11334-divide-v2.patch]
 * [attachment:trac_11334-cubemarcher.patch]
 * [attachment:trac_11334-numericalnoise.patch]
+* [attachment:11334_noise2.patch]
``````




---

archive/issue_comments_146928.json:
```json
{
    "body": "<a id='comment:6'></a>\nWhen I first saw that I was wondering if it was a combination with python 2.7.4 but I haven't conducted any test on OS X 10.8. The patch looks fine to me and is compatible with the rest. I am taking it as a reviewer patch and putting this back to positive review.",
    "created_at": "2013-04-14T23:51:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146928",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:6'></a>
When I first saw that I was wondering if it was a combination with python 2.7.4 but I haven't conducted any test on OS X 10.8. The patch looks fine to me and is compatible with the rest. I am taking it as a reviewer patch and putting this back to positive review.



---

archive/issue_comments_146929.json:
```json
{
    "body": "Changing reviewer from \"Steven Trogdon\" to \"Steven Trogdon, Jeroen Demeyer\"",
    "created_at": "2013-04-14T23:51:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146929",
    "user": "https://github.com/kiwifb"
}
```

Changing reviewer from "Steven Trogdon" to "Steven Trogdon, Jeroen Demeyer"



---

archive/issue_comments_146930.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-04-14T23:51:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146930",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_146931.json:
```json
{
    "body": "Changing merged from \"\" to \"sage-5.10.beta0\"",
    "created_at": "2013-04-15T08:43:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146931",
    "user": "https://github.com/jdemeyer"
}
```

Changing merged from "" to "sage-5.10.beta0"



---

archive/issue_comments_146932.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-04-15T08:43:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11334#issuecomment-146932",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_042602.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-15T08:43:22Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11334",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11334#event-42602"
}
```
