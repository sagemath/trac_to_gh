# Issue 11804: delta_qexp() fails in large characteristic

archive/issues_011632.json:
```json
{
    "body": "Sage fails to compute the q-expansion of the Delta modular form in large (>= machine word) characteristic:\n\n```\nsage: R = IntegerModRing(5^100)\nsage: delta_qexp(200, 'q', R)\nException OverflowError: 'long int too large to convert' in  ignored\n---------------------------------------------------------------------------\nOverflowError                             Traceback (most recent call last)\n\n/home/jdemeyer/<ipython console> in <module>()\n\n/usr/local/src/sage-4.7.1/local/lib/python2.6/site-packages/sage/modular/modform/vm_basis.pyc in delta_qexp(prec, var, K)\n    389     ch = K.characteristic()\n    390     if ch > 0 and prec > 150:\n--> 391         return R(_delta_poly_modulo(ch, prec), prec, check=False)\n    392     else:\n    393         # compute over ZZ and coerce\n\n/usr/local/src/sage-4.7.1/local/lib/python2.6/site-packages/sage/modular/modform/vm_basis.pyc in _delta_poly_modulo(N, prec)\n    307\n    308     P = PolynomialRing(Integers(N), 'q')\n--> 309     f = Polynomial_zmod_flint(P, x=v, check=False)\n    310     t = verbose('made series')\n    311     # fast way of computing f*f truncated at prec\n\n/usr/local/src/sage-4.7.1/local/lib/python2.6/site-packages/sage/rings/polynomial/polynomial_zmod_flint.so in sage.rings.polynomial.polynomial_zmod_flint.Polynomial_zmod_flint.__init__ (sage/rings/polynomial/polynomial_zmod_flint.c:11069)()\n\n/usr/local/src/sage-4.7.1/local/lib/python2.6/site-packages/sage/rings/polynomial/polynomial_zmod_flint.so in sage.rings.polynomial.polynomial_zmod_flint.Polynomial_template.__init__ (sage/rings/polynomial/polynomial_zmod_flint.c:5301)()\n\n/usr/local/src/sage-4.7.1/local/lib/python2.6/site-packages/sage/rings/polynomial/polynomial_zmod_flint.so in sage.rings.polynomial.polynomial_zmod_flint.get_cparent (sage/rings/polynomial/polynomial_zmod_flint.c:2599)()\n\nOverflowError: long int too large to convert\n```\n\nAssignee: @aghitza\n\nCC:  spancratz lauder@maths.ox.ac.uk\n\nKeywords: FLINT NTL polynomial _mul_short _mul_trunc delta_qexp _delta_poly_modulo\n\nResolution: fixed\n\nAuthor: Jeroen Demeyer\n\nReviewer: Robert Bradshaw\n\nMerged: sage-4.7.2.alpha4\n\nIssue created by migration from https://trac.sagemath.org/ticket/11804\n\n",
    "closed_at": "2011-10-05T07:47:08Z",
    "created_at": "2011-09-16T07:24:54Z",
    "labels": [
        "component: basic arithmetic",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7.2",
    "title": "delta_qexp() fails in large characteristic",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11804",
    "user": "https://github.com/jdemeyer"
}
```
Sage fails to compute the q-expansion of the Delta modular form in large (>= machine word) characteristic:

```
sage: R = IntegerModRing(5^100)
sage: delta_qexp(200, 'q', R)
Exception OverflowError: 'long int too large to convert' in  ignored
---------------------------------------------------------------------------
OverflowError                             Traceback (most recent call last)

/home/jdemeyer/<ipython console> in <module>()

/usr/local/src/sage-4.7.1/local/lib/python2.6/site-packages/sage/modular/modform/vm_basis.pyc in delta_qexp(prec, var, K)
    389     ch = K.characteristic()
    390     if ch > 0 and prec > 150:
--> 391         return R(_delta_poly_modulo(ch, prec), prec, check=False)
    392     else:
    393         # compute over ZZ and coerce

/usr/local/src/sage-4.7.1/local/lib/python2.6/site-packages/sage/modular/modform/vm_basis.pyc in _delta_poly_modulo(N, prec)
    307
    308     P = PolynomialRing(Integers(N), 'q')
--> 309     f = Polynomial_zmod_flint(P, x=v, check=False)
    310     t = verbose('made series')
    311     # fast way of computing f*f truncated at prec

/usr/local/src/sage-4.7.1/local/lib/python2.6/site-packages/sage/rings/polynomial/polynomial_zmod_flint.so in sage.rings.polynomial.polynomial_zmod_flint.Polynomial_zmod_flint.__init__ (sage/rings/polynomial/polynomial_zmod_flint.c:11069)()

/usr/local/src/sage-4.7.1/local/lib/python2.6/site-packages/sage/rings/polynomial/polynomial_zmod_flint.so in sage.rings.polynomial.polynomial_zmod_flint.Polynomial_template.__init__ (sage/rings/polynomial/polynomial_zmod_flint.c:5301)()

/usr/local/src/sage-4.7.1/local/lib/python2.6/site-packages/sage/rings/polynomial/polynomial_zmod_flint.so in sage.rings.polynomial.polynomial_zmod_flint.get_cparent (sage/rings/polynomial/polynomial_zmod_flint.c:2599)()

OverflowError: long int too large to convert
```

Assignee: @aghitza

CC:  spancratz lauder@maths.ox.ac.uk

Keywords: FLINT NTL polynomial _mul_short _mul_trunc delta_qexp _delta_poly_modulo

Resolution: fixed

Author: Jeroen Demeyer

Reviewer: Robert Bradshaw

Merged: sage-4.7.2.alpha4

Issue created by migration from https://trac.sagemath.org/ticket/11804





---

archive/issue_comments_158425.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-09-16T07:26:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11804#issuecomment-158425",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_158426.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-09-25T05:30:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11804#issuecomment-158426",
    "user": "https://github.com/robertwb"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_158427.json:
```json
{
    "body": "<a id='comment:2'></a>\nI would like to see some documentation as well as examples in the new _mul_trunc functions. Also, something like\n\nsage: f = ...\nsage: g = ...\nsage: f*g\n...\nsage: f._mul_trunc(g, 2)\n...\n\nwould be illustrative of what goes on as well as being a good test. \n\nThe function as written will crash horribly if one does\n\nsage: f._mul_trunc(2, 2)\n\nit should probably be declared as\n\ncpdef Polynomial_dense_modn_ntl_zz _mul_trunc(self, Polynomial_dense_modn_ntl_zz _right, long n)\n\nOtherwise, the patch looks good. I am slightly concerned about performance degradation, but fixing this bug is more important.",
    "created_at": "2011-09-25T05:30:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11804#issuecomment-158427",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:2'></a>
I would like to see some documentation as well as examples in the new _mul_trunc functions. Also, something like

sage: f = ...
sage: g = ...
sage: f*g
...
sage: f._mul_trunc(g, 2)
...

would be illustrative of what goes on as well as being a good test. 

The function as written will crash horribly if one does

sage: f._mul_trunc(2, 2)

it should probably be declared as

cpdef Polynomial_dense_modn_ntl_zz _mul_trunc(self, Polynomial_dense_modn_ntl_zz _right, long n)

Otherwise, the patch looks good. I am slightly concerned about performance degradation, but fixing this bug is more important.



---

archive/issue_comments_158428.json:
```json
{
    "body": "Changing author from \"\" to \"Jeroen Demeyer\"",
    "created_at": "2011-09-25T20:09:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11804#issuecomment-158428",
    "user": "https://github.com/jdemeyer"
}
```

Changing author from "" to "Jeroen Demeyer"



---

archive/issue_comments_158429.json:
```json
{
    "body": "<a id='comment:3'></a>\nAttachment [11804.patch](tarball://root/attachments/some-uuid/ticket11804/11804.patch) by @jdemeyer created at 2011-09-25 20:09:54",
    "created_at": "2011-09-25T20:09:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11804#issuecomment-158429",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>
Attachment [11804.patch](tarball://root/attachments/some-uuid/ticket11804/11804.patch) by @jdemeyer created at 2011-09-25 20:09:54



---

archive/issue_comments_158430.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-09-25T20:09:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11804#issuecomment-158430",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_158431.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Robert Bradshaw\"",
    "created_at": "2011-09-25T20:09:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11804#issuecomment-158431",
    "user": "https://github.com/jdemeyer"
}
```

Changing reviewer from "" to "Robert Bradshaw"



---

archive/issue_comments_158432.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-10-04T04:18:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11804#issuecomment-158432",
    "user": "https://github.com/robertwb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_158433.json:
```json
{
    "body": "<a id='comment:4'></a>\nExcellent, thanks.",
    "created_at": "2011-10-04T04:18:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11804#issuecomment-158433",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:4'></a>
Excellent, thanks.



---

archive/issue_comments_158434.json:
```json
{
    "body": "Changing merged from \"\" to \"sage-4.7.2.alpha4\"",
    "created_at": "2011-10-05T07:47:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11804#issuecomment-158434",
    "user": "https://github.com/jdemeyer"
}
```

Changing merged from "" to "sage-4.7.2.alpha4"



---

archive/issue_events_044399.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-05T07:47:08Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11804",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11804#event-44399"
}
```



---

archive/issue_comments_158435.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-10-05T07:47:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11804#issuecomment-158435",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
