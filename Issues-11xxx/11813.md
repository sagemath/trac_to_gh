# Issue 11813: Stale caches with trac and transparent proxies

archive/issues_011641.json:
```json
{
    "assignees": [
        "https://github.com/sagetrac-mvngu",
        "https://github.com/haraldschilly"
    ],
    "body": "Many sites are running transparent web proxies. Which should be fine, but I and Simon King both recently ran into a bug where and attempt to download a patch from trac resulted in an old version of the patch. Needless to say, this is very dangerous for development.\n\nTo reproduce, you need to have a transparent proxy in front of you, and then\n1. Upload a patch to trac\n2. Download the patch (the proxy will cache it)\n3. Upload a new version of the patch under the same name\n4. Download the patch again - under some circumstances the old version of the patch is served by the (not so) transparent proxy.\n\nThis just happened to me with `trac11115-cached_cython.patch`. If I download it from boxen (without proxy), I receive the following http headers:\n\n```\nvbraun@boxen:~$ wget -O- -S https://github.com/sagemath/sage/files/ticket11115/trac11115-cached_cython.patch.gz | md5sum\n--05:39:42--  https://github.com/sagemath/sage/files/ticket11115/trac11115-cached_cython.patch.gz\n           => `-'\nResolving trac.sagemath.org... 128.208.160.197\nConnecting to trac.sagemath.org|128.208.160.197|:80... connected.\nHTTP request sent, awaiting response... \n  HTTP/1.1 200 Ok\n  Date: Sun, 18 Sep 2011 12:39:42 GMT\n  Server: Apache/2.2.8 (Ubuntu) DAV/2 SVN/1.5.1 mod_python/3.3.1 Python/2.5.2 mod_ssl/2.2.8 OpenSSL/0.9.8g mod_wsgi/2.0\n  ETag: W/\"anonymous/Sat, 17 Sep 2011 21:06:12 GMT/False\"\n  Content-Disposition: attachment\n  Content-Length: 151548\n  Last-Modified: Sat, 17 Sep 2011 21:06:12 GMT\n  Keep-Alive: timeout=15, max=1000\n  Connection: Keep-Alive\n  Content-Type: text/x-diff; charset=iso-8859-15\nLength: 151,548 (148K) [text/x-diff]\n\n100%[=============================================================================>] 151,548       --.--K/s             \n\n05:39:42 (161.15 MB/s) - `-' saved [151548/151548]\n\n0dc42d7f8d3ae270eb65927ed942ad24  -\n```\nThis is the correct patch. But behind my proxy, I receive a stale copy:\n\n```\nwget -O- -S https://github.com/sagemath/sage/files/ticket11115/trac11115-cached_cython.patch.gz | md5sum \n--2011-09-18 13:37:47--  https://github.com/sagemath/sage/files/ticket11115/trac11115-cached_cython.patch.gz\nResolving trac.sagemath.org... 128.208.160.197\nConnecting to trac.sagemath.org|128.208.160.197|:80... connected.\nHTTP request sent, awaiting response... \n  HTTP/1.0 200 OK\n  Date: Sat, 17 Sep 2011 20:37:09 GMT\n  Server: Apache/2.2.8 (Ubuntu) DAV/2 SVN/1.5.1 mod_python/3.3.1 Python/2.5.2 mod_ssl/2.2.8 OpenSSL/0.9.8g mod_wsgi/2.0\n  ETag: W/\"anonymous/Thu, 26 May 2011 07:16:22 GMT/False\"\n  Content-Disposition: attachment\n  Content-Length: 151609\n  Last-Modified: Thu, 26 May 2011 07:16:22 GMT\n  Content-Type: text/x-diff; charset=iso-8859-15\n  Age: 57638\n  X-Cache: HIT from fw.stp.dias.ie\n  X-Cache-Lookup: HIT from fw.stp.dias.ie:3128\n  Via: 1.1 fw.stp.dias.ie:3128 (squid/2.7.STABLE9)\n  Connection: keep-alive\nLength: 151609 (148K) [text/x-diff]\nSaving to: \u201cSTDOUT\u201d\n\n100%[============================================================>] 151,609     --.-K/s   in 0.002s  \n\n2011-09-18 13:37:47 (77.8 MB/s) - written to stdout [151609/151609]\n\nf88ca8ad9090aeacb6dc0c726dcc76b5  -\n```\nHTTP provides the ETag header to control cache freshness. The proxy (squid/2.7.STABLE9) should have checked with the trac server to see if the cached ETag `W/\"anonymous/Thu, 26 May 2011 07:16:22 GMT/False\"` is still up-to-date. If the resource were still up to date the trac server would reply `HTTP 304 Not Modified`, but since the ETag changed the trac server should reply with the new version of the patch. I don't have access to the server logs so I can't say what happened for sure, but something is broken.\n\nA workaround is to set the `Pragma: no-cache` in the client query (i.e. use `wget --no-cache`), but then its easy to forget that.\n\nIrrespective of who is precisely at fault, we should configure the trac server to never allow caching of the patches since their integrity is crucial for us and client-side caching doesn't really buy us much. For that, I propose to configure Apache to add the following to the headers for all resources under `/sage_trac/raw_attachment`:\n\n```\nCache-Control: no-cache\nExpires: Thu, 1 Jan 1970 00:00:00 GMT\n```\nhitting both the HTTP/1.0 and 1.1 cache control mechanisms.\n\nSee also upstream bug http://trac.edgewall.org/ticket/6367\n\nCC:  @koffie @williamstein @simon-king-jena @robertwb\n\nAuthor: **Harald Schilly**\n\nComponent: **website/wiki**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/11813_\n\n",
    "closed_at": "2014-06-17T18:52:17Z",
    "created_at": "2011-09-18T13:17:23Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/c%3A%20website%20/%20wiki",
        "https://github.com/sagemath/sage/labels/wontfix"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Stale caches with trac and transparent proxies",
    "type": "issue",
    "updated_at": "2014-06-17T18:52:17Z",
    "url": "https://github.com/sagemath/sage/issues/11813",
    "user": "https://github.com/vbraun"
}
```
Many sites are running transparent web proxies. Which should be fine, but I and Simon King both recently ran into a bug where and attempt to download a patch from trac resulted in an old version of the patch. Needless to say, this is very dangerous for development.

To reproduce, you need to have a transparent proxy in front of you, and then
1. Upload a patch to trac
2. Download the patch (the proxy will cache it)
3. Upload a new version of the patch under the same name
4. Download the patch again - under some circumstances the old version of the patch is served by the (not so) transparent proxy.

This just happened to me with `trac11115-cached_cython.patch`. If I download it from boxen (without proxy), I receive the following http headers:

```
vbraun@boxen:~$ wget -O- -S https://github.com/sagemath/sage/files/ticket11115/trac11115-cached_cython.patch.gz | md5sum
--05:39:42--  https://github.com/sagemath/sage/files/ticket11115/trac11115-cached_cython.patch.gz
           => `-'
Resolving trac.sagemath.org... 128.208.160.197
Connecting to trac.sagemath.org|128.208.160.197|:80... connected.
HTTP request sent, awaiting response... 
  HTTP/1.1 200 Ok
  Date: Sun, 18 Sep 2011 12:39:42 GMT
  Server: Apache/2.2.8 (Ubuntu) DAV/2 SVN/1.5.1 mod_python/3.3.1 Python/2.5.2 mod_ssl/2.2.8 OpenSSL/0.9.8g mod_wsgi/2.0
  ETag: W/"anonymous/Sat, 17 Sep 2011 21:06:12 GMT/False"
  Content-Disposition: attachment
  Content-Length: 151548
  Last-Modified: Sat, 17 Sep 2011 21:06:12 GMT
  Keep-Alive: timeout=15, max=1000
  Connection: Keep-Alive
  Content-Type: text/x-diff; charset=iso-8859-15
Length: 151,548 (148K) [text/x-diff]

100%[=============================================================================>] 151,548       --.--K/s             

05:39:42 (161.15 MB/s) - `-' saved [151548/151548]

0dc42d7f8d3ae270eb65927ed942ad24  -
```
This is the correct patch. But behind my proxy, I receive a stale copy:

```
wget -O- -S https://github.com/sagemath/sage/files/ticket11115/trac11115-cached_cython.patch.gz | md5sum 
--2011-09-18 13:37:47--  https://github.com/sagemath/sage/files/ticket11115/trac11115-cached_cython.patch.gz
Resolving trac.sagemath.org... 128.208.160.197
Connecting to trac.sagemath.org|128.208.160.197|:80... connected.
HTTP request sent, awaiting response... 
  HTTP/1.0 200 OK
  Date: Sat, 17 Sep 2011 20:37:09 GMT
  Server: Apache/2.2.8 (Ubuntu) DAV/2 SVN/1.5.1 mod_python/3.3.1 Python/2.5.2 mod_ssl/2.2.8 OpenSSL/0.9.8g mod_wsgi/2.0
  ETag: W/"anonymous/Thu, 26 May 2011 07:16:22 GMT/False"
  Content-Disposition: attachment
  Content-Length: 151609
  Last-Modified: Thu, 26 May 2011 07:16:22 GMT
  Content-Type: text/x-diff; charset=iso-8859-15
  Age: 57638
  X-Cache: HIT from fw.stp.dias.ie
  X-Cache-Lookup: HIT from fw.stp.dias.ie:3128
  Via: 1.1 fw.stp.dias.ie:3128 (squid/2.7.STABLE9)
  Connection: keep-alive
Length: 151609 (148K) [text/x-diff]
Saving to: “STDOUT”

100%[============================================================>] 151,609     --.-K/s   in 0.002s  

2011-09-18 13:37:47 (77.8 MB/s) - written to stdout [151609/151609]

f88ca8ad9090aeacb6dc0c726dcc76b5  -
```
HTTP provides the ETag header to control cache freshness. The proxy (squid/2.7.STABLE9) should have checked with the trac server to see if the cached ETag `W/"anonymous/Thu, 26 May 2011 07:16:22 GMT/False"` is still up-to-date. If the resource were still up to date the trac server would reply `HTTP 304 Not Modified`, but since the ETag changed the trac server should reply with the new version of the patch. I don't have access to the server logs so I can't say what happened for sure, but something is broken.

A workaround is to set the `Pragma: no-cache` in the client query (i.e. use `wget --no-cache`), but then its easy to forget that.

Irrespective of who is precisely at fault, we should configure the trac server to never allow caching of the patches since their integrity is crucial for us and client-side caching doesn't really buy us much. For that, I propose to configure Apache to add the following to the headers for all resources under `/sage_trac/raw_attachment`:

```
Cache-Control: no-cache
Expires: Thu, 1 Jan 1970 00:00:00 GMT
```
hitting both the HTTP/1.0 and 1.1 cache control mechanisms.

See also upstream bug http://trac.edgewall.org/ticket/6367

CC:  @koffie @williamstein @simon-king-jena @robertwb

Author: **Harald Schilly**

Component: **website/wiki**

_Issue created by migration from https://trac.sagemath.org/ticket/11813_





---

archive/issue_events_157357.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-09-18T13:17:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11813",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11813#event-157357"
}
```



---

archive/issue_events_157358.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-09-18T13:17:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11813",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20website%20/%20wiki",
    "label_color": "0075ca",
    "label_name": "c: website / wiki",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11813#event-157358"
}
```



---

archive/issue_events_157359.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-09-18T13:17:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11813",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11813#event-157359"
}
```



---

archive/issue_events_157360.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-09-18T13:17:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11813",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11813#event-157360"
}
```



---

archive/issue_events_157361.json:
```json
{
    "actor": "https://github.com/sagetrac-mvngu",
    "created_at": "2011-09-18T13:17:23Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/11813",
    "subject": "https://github.com/vbraun",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11813#event-157361"
}
```



---

archive/issue_events_157362.json:
```json
{
    "actor": "https://github.com/haraldschilly",
    "created_at": "2011-09-18T13:17:23Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/11813",
    "subject": "https://github.com/vbraun",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11813#event-157362"
}
```



---

archive/issue_comments_123427.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nI just looked at the trac server logs, and it never receives a second request for anything under `/sage_trac/raw-attachment` from our squid transparent proxy. So the culprit is definitely squid having a problem with ETag. Even though the docs say that it should work.\n\nThe caching works correctly for other resources, for example if I request `http://trac.sagemath.org/sage_trac/chrome/common/download.png` from behind the transparent proxy it does send a request up to the trac server, is answered with a `HTTP 304`, and  serves the up-to-date cached version. The only difference I can see is that trac does not include an ETag header in that case, so it is a different code path in squid.\n\n```\nvbraun@boxen:~$ wget -O- -S trac.sagemath.org/sage_trac/chrome/common/download.png | md5sum\n--08:21:23--  http://trac.sagemath.org/sage_trac/chrome/common/download.png\n           => `-'\nResolving trac.sagemath.org... 128.208.160.197\nConnecting to trac.sagemath.org|128.208.160.197|:80... connected.\nHTTP request sent, awaiting response... \n  HTTP/1.1 200 Ok\n  Date: Sun, 18 Sep 2011 15:21:23 GMT\n  Server: Apache/2.2.8 (Ubuntu) DAV/2 SVN/1.5.1 mod_python/3.3.1 Python/2.5.2 mod_ssl/2.2.8 OpenSSL/0.9.8g mod_wsgi/2.0\n  Content-Length: 164\n  Last-Modified: Fri, 23 Oct 2009 03:56:53 GMT\n  Keep-Alive: timeout=15, max=1000\n  Connection: Keep-Alive\n  Content-Type: image/png\nLength: 164 [image/png]\n\n100%[=============================================================================>] 164           --.--K/s             \n\n08:21:24 (10.92 MB/s) - `-' saved [164/164]\n\n750ae6e7739e23934867fb5fe9ee0bee  -\n```",
    "created_at": "2011-09-18T15:23:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11813#issuecomment-123427",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:1" align="right">comment:1</div>

I just looked at the trac server logs, and it never receives a second request for anything under `/sage_trac/raw-attachment` from our squid transparent proxy. So the culprit is definitely squid having a problem with ETag. Even though the docs say that it should work.

The caching works correctly for other resources, for example if I request `http://trac.sagemath.org/sage_trac/chrome/common/download.png` from behind the transparent proxy it does send a request up to the trac server, is answered with a `HTTP 304`, and  serves the up-to-date cached version. The only difference I can see is that trac does not include an ETag header in that case, so it is a different code path in squid.

```
vbraun@boxen:~$ wget -O- -S trac.sagemath.org/sage_trac/chrome/common/download.png | md5sum
--08:21:23--  http://trac.sagemath.org/sage_trac/chrome/common/download.png
           => `-'
Resolving trac.sagemath.org... 128.208.160.197
Connecting to trac.sagemath.org|128.208.160.197|:80... connected.
HTTP request sent, awaiting response... 
  HTTP/1.1 200 Ok
  Date: Sun, 18 Sep 2011 15:21:23 GMT
  Server: Apache/2.2.8 (Ubuntu) DAV/2 SVN/1.5.1 mod_python/3.3.1 Python/2.5.2 mod_ssl/2.2.8 OpenSSL/0.9.8g mod_wsgi/2.0
  Content-Length: 164
  Last-Modified: Fri, 23 Oct 2009 03:56:53 GMT
  Keep-Alive: timeout=15, max=1000
  Connection: Keep-Alive
  Content-Type: image/png
Length: 164 [image/png]

100%[=============================================================================>] 164           --.--K/s             

08:21:24 (10.92 MB/s) - `-' saved [164/164]

750ae6e7739e23934867fb5fe9ee0bee  -
```



---

archive/issue_comments_123428.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nReplying to [ticket:11813 vbraun]:\n> 4. Download the patch again - under some circumstances the old version of the patch is served by the (not so) transparent proxy.\n> \n\n> This just happened to me with `trac11115-cached_cython.patch`.\n\nWell, if you name it such...\n\nSCNR\n\n\n\n\n> A workaround is to set the `Pragma: no-cache` in the client query (i.e. use `wget --no-cache`), but then its easy to forget that.\n\nYou can put it into `~/.wgetrc`.\n\n\n\n \n> Irrespective of who is precisely at fault, we should configure the trac server to never allow caching of the patches since their integrity is crucial for us and client-side caching doesn't really buy us much. For that, I propose to configure Apache to add the following to the headers for all resources under `/sage_trac/raw_attachment`:\n\n\n```\nCache-Control: no-cache\nExpires: Thu, 1 Jan 1970 00:00:00 GMT\n```\n> hitting both the HTTP/1.0 and 1.1 cache control mechanisms.\n\nHmmm, I cannot tell how large the impact *on the machine running trac* will be, but in general I think that's a bad idea.\n\nI don't think it will be large at the moment *for ordinary users*, as most patches are [hopefully] small, but note that this also inhibits the use of `-N` (`--timestamping`), which is more [or also] crucial to the *client side*, especially for bots (or if you have a very slow, or expensive / volume-taxed connection).",
    "created_at": "2011-09-18T15:30:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11813#issuecomment-123428",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:2" align="right">comment:2</div>

Replying to [ticket:11813 vbraun]:
> 4. Download the patch again - under some circumstances the old version of the patch is served by the (not so) transparent proxy.
> 

> This just happened to me with `trac11115-cached_cython.patch`.

Well, if you name it such...

SCNR




> A workaround is to set the `Pragma: no-cache` in the client query (i.e. use `wget --no-cache`), but then its easy to forget that.

You can put it into `~/.wgetrc`.



 
> Irrespective of who is precisely at fault, we should configure the trac server to never allow caching of the patches since their integrity is crucial for us and client-side caching doesn't really buy us much. For that, I propose to configure Apache to add the following to the headers for all resources under `/sage_trac/raw_attachment`:


```
Cache-Control: no-cache
Expires: Thu, 1 Jan 1970 00:00:00 GMT
```
> hitting both the HTTP/1.0 and 1.1 cache control mechanisms.

Hmmm, I cannot tell how large the impact *on the machine running trac* will be, but in general I think that's a bad idea.

I don't think it will be large at the moment *for ordinary users*, as most patches are [hopefully] small, but note that this also inhibits the use of `-N` (`--timestamping`), which is more [or also] crucial to the *client side*, especially for bots (or if you have a very slow, or expensive / volume-taxed connection).



---

archive/issue_comments_123429.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nReplying to [@nexttime](#comment:2):\n> [...] this also inhibits the use of `-N` (`--timestamping`) [...]\n\nThinking more about it, I'm not so sure whether this would be a problem *with `wget`* (provided `Last-modified` is kept as is), but I rather doubt that other programs will be as \"smart\", i.e., first checking the modification time if a file is not to be cached anyway.",
    "created_at": "2011-09-18T15:38:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11813#issuecomment-123429",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:3" align="right">comment:3</div>

Replying to [@nexttime](#comment:2):
> [...] this also inhibits the use of `-N` (`--timestamping`) [...]

Thinking more about it, I'm not so sure whether this would be a problem *with `wget`* (provided `Last-modified` is kept as is), but I rather doubt that other programs will be as "smart", i.e., first checking the modification time if a file is not to be cached anyway.



---

archive/issue_comments_123430.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nI see your point about bots, though afaik that would only affect the sage patch buildbot. I'll cc Robert, maybe he can tell us how his bot checks freshness.\n\nOrdinary users don't download patches from trac on a regular basis, thats why I don't think there is any bandwidth issue. The problem with the `~/.wgetrc` bandaid is that you often don't know whether you are behind a transparent proxy. Sage developers regularly work away from their home institutions / in coffee shops, and who knows what is being cached.",
    "created_at": "2011-09-18T15:54:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11813#issuecomment-123430",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:4" align="right">comment:4</div>

I see your point about bots, though afaik that would only affect the sage patch buildbot. I'll cc Robert, maybe he can tell us how his bot checks freshness.

Ordinary users don't download patches from trac on a regular basis, thats why I don't think there is any bandwidth issue. The problem with the `~/.wgetrc` bandaid is that you often don't know whether you are behind a transparent proxy. Sage developers regularly work away from their home institutions / in coffee shops, and who knows what is being cached.



---

archive/issue_comments_123431.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nReplying to [@vbraun](#comment:4):\n> I see your point about bots, though afaik that would only affect the sage patch buildbot. I'll cc Robert, maybe he can tell us how his bot checks freshness.\n\nRobert [also] stores md5sums (or some hash code) of patches, so I assume he doesn't specifically use HTTP header information, and his bot *does* scan the ticket's comments, in contrast to my release tool and AFAIK also Jeroen's. (The advantage is that you don't have to fetch and parse the -- potentially large or long -- HTML version of a ticket at all; that's btw. another reason why we want the relevant files, spkgs or patches to be applied, to be referenced in the ticket's description.)\n\n\n\n \n> Ordinary users don't download patches from trac on a regular basis, thats why I don't think there is any bandwidth issue. The problem with the `~/.wgetrc` bandaid is that you often don't know whether you are behind a transparent proxy.\n\nWell, humans are more likely to read the comments on a ticket, so they actually *see* that a patch was re-uploaded / modified (though they perhaps don't look at the file modification times of the downloaded files, which one IMHO should do).\n\nBut the purpose of `~/.wgetrc` in this case would be to *always* disable caching (by default), such that it wouldn't matter whether you're behind a proxy or not (provided the proxy isn't broken and doesn't refuse to bypass caching).",
    "created_at": "2011-09-18T17:09:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11813#issuecomment-123431",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:5" align="right">comment:5</div>

Replying to [@vbraun](#comment:4):
> I see your point about bots, though afaik that would only affect the sage patch buildbot. I'll cc Robert, maybe he can tell us how his bot checks freshness.

Robert [also] stores md5sums (or some hash code) of patches, so I assume he doesn't specifically use HTTP header information, and his bot *does* scan the ticket's comments, in contrast to my release tool and AFAIK also Jeroen's. (The advantage is that you don't have to fetch and parse the -- potentially large or long -- HTML version of a ticket at all; that's btw. another reason why we want the relevant files, spkgs or patches to be applied, to be referenced in the ticket's description.)



 
> Ordinary users don't download patches from trac on a regular basis, thats why I don't think there is any bandwidth issue. The problem with the `~/.wgetrc` bandaid is that you often don't know whether you are behind a transparent proxy.

Well, humans are more likely to read the comments on a ticket, so they actually *see* that a patch was re-uploaded / modified (though they perhaps don't look at the file modification times of the downloaded files, which one IMHO should do).

But the purpose of `~/.wgetrc` in this case would be to *always* disable caching (by default), such that it wouldn't matter whether you're behind a proxy or not (provided the proxy isn't broken and doesn't refuse to bypass caching).



---

archive/issue_comments_123432.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nP.S.: The best way to bypass proxies or disable caching is to use HTTPS; unfortunately Sage's trac doesn't support it...",
    "created_at": "2011-09-18T17:16:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11813#issuecomment-123432",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:6" align="right">comment:6</div>

P.S.: The best way to bypass proxies or disable caching is to use HTTPS; unfortunately Sage's trac doesn't support it...



---

archive/issue_comments_123433.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@nexttime](#comment:5):\n> But the purpose of `~/.wgetrc` in this case would be to *always* disable caching (by default), such that it wouldn't matter whether you're behind a proxy or not (provided the proxy isn't broken and doesn't refuse to bypass caching).\n\nSo you are suggesting that every Sage developer puts a particular entry in `~/.wgetrc` on all of his laptops, just to be safe if he ever leaves his house with it. While we could just work around it in a few lines of the apache `httpd.conf`.\n\n> Well, humans are more likely to read the comments on a ticket, so they actually see that a patch was re-uploaded / modified (though they perhaps don't look at the file modification times of the downloaded files, which one IMHO should do).\n\nThe html version does not get erroneously cached, the bug manifests only with the raw attachment. Trac dishes out the html version with `Cache-control: must-revalidate`:\n\n```\nvbraun@boxen:~$ wget -O- -S https://github.com/sagemath/sage/files/ticket11115/trac11115-cached_cython.patch.gz | md5sum--10:49:49--  https://github.com/sagemath/sage/files/ticket11115/trac11115-cached_cython.patch.gz\n           => `-'\nResolving trac.sagemath.org... 128.208.160.197\nConnecting to trac.sagemath.org|128.208.160.197|:80... connected.\nHTTP request sent, awaiting response... \n  HTTP/1.1 200 Ok\n  Date: Sun, 18 Sep 2011 17:49:49 GMT\n  Server: Apache/2.2.8 (Ubuntu) DAV/2 SVN/1.5.1 mod_python/3.3.1 Python/2.5.2 mod_ssl/2.2.8 OpenSSL/0.9.8g mod_wsgi/2.0\n  ETag: W/\"anonymous/Sat, 17 Sep 2011 21:06:12 GMT/False\"\n  Cache-control: must-revalidate\n  Set-Cookie: trac_form_token=6ee2168bc6a1bd4e46d5ac03; Path=/sage_trac\n  Set-Cookie: trac_session=36b6b4eaaf22a880e1451a6a; expires=Sat, 17-Dec-2011 17:49:53 GMT; Path=/sage_trac\n  Content-Length: 750922\n  Vary: Accept-Encoding\n  Keep-Alive: timeout=15, max=1000\n  Connection: Keep-Alive\n  Content-Type: text/html;charset=utf-8\nLength: 750,922 (733K) [text/html]\n\n100%[===========================================================================================================================>] 750,922       --.--K/s             \n\n10:49:53 (181.60 MB/s) - `-' saved [750922/750922]\n\n0ee8396915e5be21797f03b88cacd53c  -\n```\nThough the `Vary: Accept-Encoding` header is very wrong. Looking at the trac trac (:-), this seems to be a known bug: http://trac.edgewall.org/ticket/6367. That ticket says: \"Also note that Request.send_file() function does not send a Cache-Control header. That should be OK if Vary * is sent\". This seems to be the issue, raw attachments neither have a `Cache-control` nor a `Vary: *` header.\n \nAnd I don't check manually that a downloaded file has the right time stamp, I have a computer to do menial task for me not the other way round :-)",
    "created_at": "2011-09-18T18:02:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11813#issuecomment-123433",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@nexttime](#comment:5):
> But the purpose of `~/.wgetrc` in this case would be to *always* disable caching (by default), such that it wouldn't matter whether you're behind a proxy or not (provided the proxy isn't broken and doesn't refuse to bypass caching).

So you are suggesting that every Sage developer puts a particular entry in `~/.wgetrc` on all of his laptops, just to be safe if he ever leaves his house with it. While we could just work around it in a few lines of the apache `httpd.conf`.

> Well, humans are more likely to read the comments on a ticket, so they actually see that a patch was re-uploaded / modified (though they perhaps don't look at the file modification times of the downloaded files, which one IMHO should do).

The html version does not get erroneously cached, the bug manifests only with the raw attachment. Trac dishes out the html version with `Cache-control: must-revalidate`:

```
vbraun@boxen:~$ wget -O- -S https://github.com/sagemath/sage/files/ticket11115/trac11115-cached_cython.patch.gz | md5sum--10:49:49--  https://github.com/sagemath/sage/files/ticket11115/trac11115-cached_cython.patch.gz
           => `-'
Resolving trac.sagemath.org... 128.208.160.197
Connecting to trac.sagemath.org|128.208.160.197|:80... connected.
HTTP request sent, awaiting response... 
  HTTP/1.1 200 Ok
  Date: Sun, 18 Sep 2011 17:49:49 GMT
  Server: Apache/2.2.8 (Ubuntu) DAV/2 SVN/1.5.1 mod_python/3.3.1 Python/2.5.2 mod_ssl/2.2.8 OpenSSL/0.9.8g mod_wsgi/2.0
  ETag: W/"anonymous/Sat, 17 Sep 2011 21:06:12 GMT/False"
  Cache-control: must-revalidate
  Set-Cookie: trac_form_token=6ee2168bc6a1bd4e46d5ac03; Path=/sage_trac
  Set-Cookie: trac_session=36b6b4eaaf22a880e1451a6a; expires=Sat, 17-Dec-2011 17:49:53 GMT; Path=/sage_trac
  Content-Length: 750922
  Vary: Accept-Encoding
  Keep-Alive: timeout=15, max=1000
  Connection: Keep-Alive
  Content-Type: text/html;charset=utf-8
Length: 750,922 (733K) [text/html]

100%[===========================================================================================================================>] 750,922       --.--K/s             

10:49:53 (181.60 MB/s) - `-' saved [750922/750922]

0ee8396915e5be21797f03b88cacd53c  -
```
Though the `Vary: Accept-Encoding` header is very wrong. Looking at the trac trac (:-), this seems to be a known bug: http://trac.edgewall.org/ticket/6367. That ticket says: "Also note that Request.send_file() function does not send a Cache-Control header. That should be OK if Vary * is sent". This seems to be the issue, raw attachments neither have a `Cache-control` nor a `Vary: *` header.
 
And I don't check manually that a downloaded file has the right time stamp, I have a computer to do menial task for me not the other way round :-)



---

archive/issue_comments_123434.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -75,4 +75,4 @@\n ```\n hitting both the HTTP/1.0 and 1.1 cache control mechanisms.\n \n-\n+See also upstream bug http://trac.edgewall.org/ticket/6367\n``````\n",
    "created_at": "2011-09-18T18:02:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11813#issuecomment-123434",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -75,4 +75,4 @@
 ```
 hitting both the HTTP/1.0 and 1.1 cache control mechanisms.
 
-
+See also upstream bug http://trac.edgewall.org/ticket/6367
``````




---

archive/issue_comments_123435.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@vbraun](#comment:7):\n> Replying to [@nexttime](#comment:5):\n> > But the purpose of `~/.wgetrc` in this case would be to *always* disable caching (by default), such that it wouldn't matter whether you're behind a proxy or not (provided the proxy isn't broken and doesn't refuse to bypass caching).\n\n> \n> So you are suggesting that every Sage developer puts a particular entry in `~/.wgetrc` on all of his laptops, just to be safe if he ever leaves his house with it.\n\nYou're right, that's of course too much to demand, compared to the minimal effort it takes to continually install a recent version of Sage with all necessary prerequisite patches etc. on every computer one might take with oneself.\n\n\n\n \n> > Well, humans are more likely to read the comments on a ticket, so they actually see that a patch was re-uploaded / modified (though they perhaps don't look at the file modification times of the downloaded files, which one IMHO should do).\n\n> \n> The html version does not get erroneously cached, the bug manifests only with the raw attachment.\n\nSo it is safe to read the comments; I didn't say anything else. Bots usually don't do that, which was my point.\n\n\n\n\n> And I don't check manually that a downloaded file has the right time stamp, I have a computer to do menial task for me not the other way round :-)\n\nWell, you should notice when a patch (which you know of it was) recently re-uploaded on trac suddenly has a modification time of months ago, and in case you have any doubt, you can easily view the HTML version, which also shows the *current* changeset header, and compare it to what you actually downloaded or have on your disk.\n\n\n\n\nHopefully this will be fixed by Edgewall, although -- despite the discussion on sage-devel -- we still have the more than two years old 0.11.5 version.",
    "created_at": "2011-09-18T18:54:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11813#issuecomment-123435",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@vbraun](#comment:7):
> Replying to [@nexttime](#comment:5):
> > But the purpose of `~/.wgetrc` in this case would be to *always* disable caching (by default), such that it wouldn't matter whether you're behind a proxy or not (provided the proxy isn't broken and doesn't refuse to bypass caching).

> 
> So you are suggesting that every Sage developer puts a particular entry in `~/.wgetrc` on all of his laptops, just to be safe if he ever leaves his house with it.

You're right, that's of course too much to demand, compared to the minimal effort it takes to continually install a recent version of Sage with all necessary prerequisite patches etc. on every computer one might take with oneself.



 
> > Well, humans are more likely to read the comments on a ticket, so they actually see that a patch was re-uploaded / modified (though they perhaps don't look at the file modification times of the downloaded files, which one IMHO should do).

> 
> The html version does not get erroneously cached, the bug manifests only with the raw attachment.

So it is safe to read the comments; I didn't say anything else. Bots usually don't do that, which was my point.




> And I don't check manually that a downloaded file has the right time stamp, I have a computer to do menial task for me not the other way round :-)

Well, you should notice when a patch (which you know of it was) recently re-uploaded on trac suddenly has a modification time of months ago, and in case you have any doubt, you can easily view the HTML version, which also shows the *current* changeset header, and compare it to what you actually downloaded or have on your disk.




Hopefully this will be fixed by Edgewall, although -- despite the discussion on sage-devel -- we still have the more than two years old 0.11.5 version.



---

archive/issue_comments_123436.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\n> Well, you should notice when a patch (which you know of it was) recently re-uploaded on trac suddenly has a modification time of months ago, and in case you have any doubt, you can easily view the HTML version, which also shows the current changeset header, and compare it to what you actually downloaded or have on your disk.\n\nNot necessarily. I often read the patch on trac (looking at the html version), then download it with `hg qimport .../raw-attachment/x.patch`, and then test it. Unless there are any test failures its easy to miss that mercurial got a stale copy.\n\nSince the upstream fix will add a `Cache-control: must-revalidate` and/or `Vary: *`, we don't lose anything by having Apache add those headers right now.",
    "created_at": "2011-09-18T19:13:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11813#issuecomment-123436",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:9" align="right">comment:9</div>

> Well, you should notice when a patch (which you know of it was) recently re-uploaded on trac suddenly has a modification time of months ago, and in case you have any doubt, you can easily view the HTML version, which also shows the current changeset header, and compare it to what you actually downloaded or have on your disk.

Not necessarily. I often read the patch on trac (looking at the html version), then download it with `hg qimport .../raw-attachment/x.patch`, and then test it. Unless there are any test failures its easy to miss that mercurial got a stale copy.

Since the upstream fix will add a `Cache-control: must-revalidate` and/or `Vary: *`, we don't lose anything by having Apache add those headers right now.



---

archive/issue_comments_123437.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nI looked at the squid logs today and it confirms what I said: Squid considers the `.../raw-attachment/...` resources to be always fresh and returns the cached values without revalidating them.",
    "created_at": "2011-09-19T11:50:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11813#issuecomment-123437",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:10" align="right">comment:10</div>

I looked at the squid logs today and it confirms what I said: Squid considers the `.../raw-attachment/...` resources to be always fresh and returns the cached values without revalidating them.



---

archive/issue_comments_123438.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nI added the following `.htaccess` file to my home directory on boxen\n\n```\nHeader set ETag \"W/\\\"anonymous/Mon, 19 Sep 2011 12:41:02 GMT/False\\\"\"\nHeader set Content-Type \"text/x-diff; charset=iso-8859-15\"\nHeader set Content-Disposition \"attachment\"\nHeader unset Accept-Ranges\nAddType \"text/x-diff; charset=iso-8859-15\" .patch\n```\nnow the same headers as from sage_trac/raw-attachment are served when trying to download a file with wget. Still, I can't reproduce the stale cache. In fact, squid now refuses to cache files for more than a few seconds. It seems like squid adds some funky request headers when talking to trac which I don't know about. \n\nSomebody needs to capture the tcp stream between the proxy and trac to make further progress.",
    "created_at": "2011-09-19T13:03:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11813#issuecomment-123438",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:11" align="right">comment:11</div>

I added the following `.htaccess` file to my home directory on boxen

```
Header set ETag "W/\"anonymous/Mon, 19 Sep 2011 12:41:02 GMT/False\""
Header set Content-Type "text/x-diff; charset=iso-8859-15"
Header set Content-Disposition "attachment"
Header unset Accept-Ranges
AddType "text/x-diff; charset=iso-8859-15" .patch
```
now the same headers as from sage_trac/raw-attachment are served when trying to download a file with wget. Still, I can't reproduce the stale cache. In fact, squid now refuses to cache files for more than a few seconds. It seems like squid adds some funky request headers when talking to trac which I don't know about. 

Somebody needs to capture the tcp stream between the proxy and trac to make further progress.



---

archive/issue_comments_123439.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@nexttime](#comment:2):\n> Replying to [ticket:11813 vbraun]:\n> > Irrespective of who is precisely at fault, we should configure the trac server to never allow caching of the patches since their integrity is crucial for us and client-side caching doesn't really buy us much. For that, I propose to configure Apache to add the following to the headers for all resources under `/sage_trac/raw_attachment`:\n\n> \n> ```\n> Cache-Control: no-cache\n> Expires: Thu, 1 Jan 1970 00:00:00 GMT\n> ```\n> > hitting both the HTTP/1.0 and 1.1 cache control mechanisms.\n\n> \n> Hmmm, I cannot tell how large the impact *on the machine running trac* will be, but in general I think that's a bad idea.\n> \n> I don't think it will be large at the moment *for ordinary users*, as most patches are [hopefully] small, but note that this also inhibits the use of `-N` (`--timestamping`), which is more [or also] crucial to the *client side*, especially for bots (or if you have a very slow, or expensive / volume-taxed connection).\n\nThis is the correct solution--it's what you do when you have a URI whose content may change. I don't think it'll be a severe issue for developers to hit trac itself rather than transparent proxies and it's a worthy price to pay for always getting the correct version. The raw patch is certainly cheaper on the server and connection than the html version. \n\nCurrently, there's only one patchbot and it's running locally, so no transparent proxy that I'm aware of :). In general, it only downloads patches when a new one was added (it parses the main ticket page (rss feed)). Patches are identified with md5 hashes, so although it could get confused by caches if they were in the way, when it gets a new version of a patch it doesn't get confused.",
    "created_at": "2011-09-19T16:57:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11813#issuecomment-123439",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@nexttime](#comment:2):
> Replying to [ticket:11813 vbraun]:
> > Irrespective of who is precisely at fault, we should configure the trac server to never allow caching of the patches since their integrity is crucial for us and client-side caching doesn't really buy us much. For that, I propose to configure Apache to add the following to the headers for all resources under `/sage_trac/raw_attachment`:

> 
> ```
> Cache-Control: no-cache
> Expires: Thu, 1 Jan 1970 00:00:00 GMT
> ```
> > hitting both the HTTP/1.0 and 1.1 cache control mechanisms.

> 
> Hmmm, I cannot tell how large the impact *on the machine running trac* will be, but in general I think that's a bad idea.
> 
> I don't think it will be large at the moment *for ordinary users*, as most patches are [hopefully] small, but note that this also inhibits the use of `-N` (`--timestamping`), which is more [or also] crucial to the *client side*, especially for bots (or if you have a very slow, or expensive / volume-taxed connection).

This is the correct solution--it's what you do when you have a URI whose content may change. I don't think it'll be a severe issue for developers to hit trac itself rather than transparent proxies and it's a worthy price to pay for always getting the correct version. The raw patch is certainly cheaper on the server and connection than the html version. 

Currently, there's only one patchbot and it's running locally, so no transparent proxy that I'm aware of :). In general, it only downloads patches when a new one was added (it parses the main ticket page (rss feed)). Patches are identified with md5 hashes, so although it could get confused by caches if they were in the way, when it gets a new version of a patch it doesn't get confused.



---

archive/issue_comments_123440.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nI propose to add the following to the Apache httpd.conf (untested):\n\n```\n<DirectoryMatch \".*/raw-attachment/.*\">\n  Header set Cache-control \"must-revalidate\"\n  Header set Vary \"*\"\n</DirectoryMatch>\n```\nThis should work then for all trac instances running on Sage.\n\nAlso, this shouldn't effect `wget --timestamping` since it only instructs the transparent proxy to always check back with the server, but not necessarily to download anything except the header.",
    "created_at": "2011-09-19T17:07:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11813#issuecomment-123440",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:13" align="right">comment:13</div>

I propose to add the following to the Apache httpd.conf (untested):

```
<DirectoryMatch ".*/raw-attachment/.*">
  Header set Cache-control "must-revalidate"
  Header set Vary "*"
</DirectoryMatch>
```
This should work then for all trac instances running on Sage.

Also, this shouldn't effect `wget --timestamping` since it only instructs the transparent proxy to always check back with the server, but not necessarily to download anything except the header.



---

archive/issue_comments_123441.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@vbraun](#comment:13):\n> I propose to add the following to the Apache httpd.conf (untested):\n\n\n```\n<DirectoryMatch \".*/raw-attachment/.*\">\n  Header set Cache-control \"must-revalidate\"\n  Header set Vary \"*\"\n</DirectoryMatch>\n```\n> This should work then for all trac instances running on Sage.\n> \n> Also, this shouldn't effect `wget --timestamping` since it only instructs the transparent proxy to always check back with the server, but not necessarily to download anything except the header.\n\nThen anybody with the appropriate permissions (ticket owners?!) go ahead!\n\n(Or at least give it a try.)",
    "created_at": "2011-09-19T17:15:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11813#issuecomment-123441",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@vbraun](#comment:13):
> I propose to add the following to the Apache httpd.conf (untested):


```
<DirectoryMatch ".*/raw-attachment/.*">
  Header set Cache-control "must-revalidate"
  Header set Vary "*"
</DirectoryMatch>
```
> This should work then for all trac instances running on Sage.
> 
> Also, this shouldn't effect `wget --timestamping` since it only instructs the transparent proxy to always check back with the server, but not necessarily to download anything except the header.

Then anybody with the appropriate permissions (ticket owners?!) go ahead!

(Or at least give it a try.)



---

archive/issue_comments_123442.json:
```json
{
    "body": "Author: **Harald Schilly**",
    "created_at": "2013-04-18T13:48:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11813#issuecomment-123442",
    "user": "https://github.com/vbraun"
}
```

Author: **Harald Schilly**



---

archive/issue_events_157363.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-04-18T13:48:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11813",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11813#event-157363"
}
```



---

archive/issue_comments_123443.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nHarald has made the change (with `LocationMatch` instead of `DirectoryMatch`) and it did add the headers in question:\n\n```\nvbraun@boxen:~$ wget -S -O /dev/null https://github.com/sagemath/sage/files/ticket14319/trac_14319-empty.patch.gz                                                                                               \n--06:47:04--  https://github.com/sagemath/sage/files/ticket14319/trac_14319-empty.patch.gz\n           => `/dev/null'\nResolving trac.sagemath.org... 128.208.160.197\nConnecting to trac.sagemath.org|128.208.160.197|:80... connected.\nHTTP request sent, awaiting response... \n  HTTP/1.1 200 Ok\n  Date: Thu, 18 Apr 2013 13:47:04 GMT\n  Server: Apache/2.2.8 (Ubuntu) DAV/2 SVN/1.5.1 mod_python/3.3.1 Python/2.5.2 PHP/5.2.4-2ubuntu5.25 with Suhosin-Patch mod_ssl/2.2.8 OpenSSL/0.9.8g mod_wsgi/2.0\n  ETag: W/\"anonymous/Thu, 18 Apr 2013 08:47:28 GMT/False\"\n  Content-Disposition: attachment\n  Set-Cookie: trac_session=632bd240e900edb0698c9b97; expires=Wed, 17-Jul-2013 13:47:04 GMT; Path=/sage_trac\n  Content-Length: 9819\n  Last-Modified: Thu, 18 Apr 2013 08:47:28 GMT\n  Cache-control: must-revalidate\n  Vary: *\n  Keep-Alive: timeout=15, max=1000\n  Connection: Keep-Alive\n  Content-Type: text/x-diff; charset=iso-8859-15\n```",
    "created_at": "2013-04-18T13:48:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11813#issuecomment-123443",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:15" align="right">comment:15</div>

Harald has made the change (with `LocationMatch` instead of `DirectoryMatch`) and it did add the headers in question:

```
vbraun@boxen:~$ wget -S -O /dev/null https://github.com/sagemath/sage/files/ticket14319/trac_14319-empty.patch.gz                                                                                               
--06:47:04--  https://github.com/sagemath/sage/files/ticket14319/trac_14319-empty.patch.gz
           => `/dev/null'
Resolving trac.sagemath.org... 128.208.160.197
Connecting to trac.sagemath.org|128.208.160.197|:80... connected.
HTTP request sent, awaiting response... 
  HTTP/1.1 200 Ok
  Date: Thu, 18 Apr 2013 13:47:04 GMT
  Server: Apache/2.2.8 (Ubuntu) DAV/2 SVN/1.5.1 mod_python/3.3.1 Python/2.5.2 PHP/5.2.4-2ubuntu5.25 with Suhosin-Patch mod_ssl/2.2.8 OpenSSL/0.9.8g mod_wsgi/2.0
  ETag: W/"anonymous/Thu, 18 Apr 2013 08:47:28 GMT/False"
  Content-Disposition: attachment
  Set-Cookie: trac_session=632bd240e900edb0698c9b97; expires=Wed, 17-Jul-2013 13:47:04 GMT; Path=/sage_trac
  Content-Length: 9819
  Last-Modified: Thu, 18 Apr 2013 08:47:28 GMT
  Cache-control: must-revalidate
  Vary: *
  Keep-Alive: timeout=15, max=1000
  Connection: Keep-Alive
  Content-Type: text/x-diff; charset=iso-8859-15
```



---

archive/issue_events_157364.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11813",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11813#event-157364"
}
```



---

archive/issue_events_157365.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11813",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11813#event-157365"
}
```



---

archive/issue_events_157366.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11813",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11813#event-157366"
}
```



---

archive/issue_events_157367.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11813",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11813#event-157367"
}
```



---

archive/issue_events_157368.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11813",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11813#event-157368"
}
```



---

archive/issue_events_157369.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11813",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11813#event-157369"
}
```



---

archive/issue_comments_123444.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nMaybe this can be closed, now that we have switched to git ?",
    "created_at": "2014-06-17T12:02:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11813#issuecomment-123444",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:19" align="right">comment:19</div>

Maybe this can be closed, now that we have switched to git ?



---

archive/issue_events_157370.json:
```json
{
    "actor": "https://github.com/koffie",
    "created_at": "2014-06-17T13:23:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11813",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11813#event-157370"
}
```



---

archive/issue_events_157371.json:
```json
{
    "actor": "https://github.com/koffie",
    "created_at": "2014-06-17T13:23:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11813",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11813#event-157371"
}
```



---

archive/issue_comments_123445.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nI agree, gave it positive review so Volker can close it.",
    "created_at": "2014-06-17T13:23:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11813#issuecomment-123445",
    "user": "https://github.com/koffie"
}
```

<div id="comment:20" align="right">comment:20</div>

I agree, gave it positive review so Volker can close it.



---

archive/issue_events_157372.json:
```json
{
    "actor": "https://github.com/koffie",
    "created_at": "2014-06-17T13:23:41Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11813",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11813#event-157372"
}
```



---

archive/issue_comments_123446.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nWell, while the switch to git alleviates the situation, it doesn't mean we no longer attach files to trac tickets.  Anyway, those perhaps get rarely updated in-place.",
    "created_at": "2014-06-17T13:33:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11813",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11813#issuecomment-123446",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:21" align="right">comment:21</div>

Well, while the switch to git alleviates the situation, it doesn't mean we no longer attach files to trac tickets.  Anyway, those perhaps get rarely updated in-place.



---

archive/issue_events_157373.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-06-17T18:52:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11813",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11813#event-157373"
}
```



---

archive/issue_events_157374.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-06-17T18:52:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11813",
    "label": "https://github.com/sagemath/sage/labels/wontfix",
    "label_color": "c6c6c6",
    "label_name": "wontfix",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11813#event-157374"
}
```



---

archive/issue_events_157375.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-06-17T18:52:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11813",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11813#event-157375"
}
```



---

archive/issue_events_157376.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-06-17T18:52:17Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/11813",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11813#event-157376"
}
```
