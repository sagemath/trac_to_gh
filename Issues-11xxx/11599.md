# Issue 11599: Wrap fan morphism in toric morphism

archive/issues_011427.json:
```json
{
    "assignees": [
        "https://github.com/aghitza"
    ],
    "body": "Since we have the very nice fan morphism class, we should use it to define toric morphisms of toric varieties.\n\nA big part of the patch is porting the scheme morphisms / hom sets to new-style parents and coercion. Categories should be better, too. Fixes #7946 and #6810 as a side effect.\n\nThe first two patches bring some sanity to the scheme morphisms. The 3rd patch changes names of methods/classes to something more reasonable and adds documentation. The 4th patch actually adds toric morphisms defined by polynomials or fan morphisms.\n\nApply:\n* [attachment: trac_11599_no_circular_imports.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_no_circular_imports.patch.gz)\n* [attachment: trac_11599_homset_new_coercion_model.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_homset_new_coercion_model.patch.gz)\n* [attachment: trac_11599_rename_morphisms.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_rename_morphisms.patch.gz)\n* [attachment: trac_11599_toric_morphisms.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_toric_morphisms.patch.gz)\n* [attachment: trac_11599_reviewer.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_reviewer.patch.gz)\n* [attachment: trac_11599_remove_class_suffix.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_remove_class_suffix.patch.gz)\n* [attachment: trac_11599_remaining_fixes.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_remaining_fixes.patch.gz)\n* [attachment: trac_11599_numerical_noise.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_numerical_noise.patch.gz)\n\nCC:  @sagetrac-davideklund @sagetrac-fschulze @miguelmarco\n\nComponent: **algebraic geometry**\n\nAuthor: **Volker Braun**\n\nReviewer: **Andrey Novoseltsev**\n\nMerged: **sage-5.0.beta9**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/11599_\n\n",
    "closed_at": "2012-03-21T22:04:39Z",
    "created_at": "2011-07-14T17:25:02Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20algebraic%20geometry",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Wrap fan morphism in toric morphism",
    "type": "issue",
    "updated_at": "2013-03-27T00:44:07Z",
    "url": "https://github.com/sagemath/sage/issues/11599",
    "user": "https://github.com/vbraun"
}
```
Since we have the very nice fan morphism class, we should use it to define toric morphisms of toric varieties.

A big part of the patch is porting the scheme morphisms / hom sets to new-style parents and coercion. Categories should be better, too. Fixes #7946 and #6810 as a side effect.

The first two patches bring some sanity to the scheme morphisms. The 3rd patch changes names of methods/classes to something more reasonable and adds documentation. The 4th patch actually adds toric morphisms defined by polynomials or fan morphisms.

Apply:
* [attachment: trac_11599_no_circular_imports.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_no_circular_imports.patch.gz)
* [attachment: trac_11599_homset_new_coercion_model.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_homset_new_coercion_model.patch.gz)
* [attachment: trac_11599_rename_morphisms.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_rename_morphisms.patch.gz)
* [attachment: trac_11599_toric_morphisms.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_toric_morphisms.patch.gz)
* [attachment: trac_11599_reviewer.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_reviewer.patch.gz)
* [attachment: trac_11599_remove_class_suffix.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_remove_class_suffix.patch.gz)
* [attachment: trac_11599_remaining_fixes.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_remaining_fixes.patch.gz)
* [attachment: trac_11599_numerical_noise.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_numerical_noise.patch.gz)

CC:  @sagetrac-davideklund @sagetrac-fschulze @miguelmarco

Component: **algebraic geometry**

Author: **Volker Braun**

Reviewer: **Andrey Novoseltsev**

Merged: **sage-5.0.beta9**

_Issue created by migration from https://trac.sagemath.org/ticket/11599_





---

archive/issue_events_153775.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-07-14T17:25:02Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "milestone_number": null,
    "milestone_title": "sage-5.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11599#event-153775"
}
```



---

archive/issue_events_153776.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-07-14T17:25:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20algebraic%20geometry",
    "label_color": "0000ff",
    "label_name": "c: algebraic geometry",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11599#event-153776"
}
```



---

archive/issue_events_153777.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-07-14T17:25:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11599#event-153777"
}
```



---

archive/issue_events_153778.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-07-14T17:25:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11599#event-153778"
}
```



---

archive/issue_events_153779.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2011-07-14T17:25:02Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "subject": "https://github.com/vbraun",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11599#event-153779"
}
```



---

archive/issue_comments_119080.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nWe should. I have been using the following code so far:\n\n```\ndef toric_morphism_list(phi, X, Y):\n    r\"\"\"\n    Given a fan morphism phi from X.fan() -> Y.fan(), return the list representation of the corresponding toric morphism.\n    \"\"\"\n    x = [SR.var(x_i, domain=\"positive\") for x_i in X.coordinate_ring().variable_names()]\n    result = [1] * Y.fan().nrays()\n    for rho, x_rho in zip(X.fan(1), x):\n        sigma_prime = phi.image_cone(rho)\n        degrees = sigma_prime.ray_matrix() \\ phi(rho.ray(0))\n        for i, d in zip(sigma_prime.ambient_ray_indices(), degrees):\n            result[i] *= x_rho^d\n    return result\n\ndef toric_morphism_dictionary(phi, X, Y):\n    r\"\"\"\n    Given a fan morphism phi from X.fan() -> Y.fan(), return the dictionary representation of the corresponding toric morphism.\n    \"\"\"\n    x = [SR.var(x_i, domain=\"positive\") for x_i in X.coordinate_ring().variable_names()]\n    y = [SR.var(y_i, domain=\"positive\") for y_i in Y.coordinate_ring().variable_names()]\n    result = dict((y_i, 1) for y_i in y)\n    for rho, x_rho in zip(X.fan(1), x):\n        sigma_prime = phi.image_cone(rho)\n        degrees = sigma_prime.ray_matrix() \\ phi(rho.ray(0))\n        for i, d in zip(sigma_prime.ambient_ray_indices(), degrees):\n            result[y[i]] *= x_rho^d\n    return result\n```\nUsing the dictionary representation it is quite easy to compute pullbacks, the problem here is that the underlying map of total coordinate rings is not a ring homomorphism, since it is likely to involve roots. The following paper may be useful for \"correct and general\" implementation:\nhttp://arxiv.org/abs/1004.4924",
    "created_at": "2011-07-16T03:56:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119080",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:1" align="right">comment:1</div>

We should. I have been using the following code so far:

```
def toric_morphism_list(phi, X, Y):
    r"""
    Given a fan morphism phi from X.fan() -> Y.fan(), return the list representation of the corresponding toric morphism.
    """
    x = [SR.var(x_i, domain="positive") for x_i in X.coordinate_ring().variable_names()]
    result = [1] * Y.fan().nrays()
    for rho, x_rho in zip(X.fan(1), x):
        sigma_prime = phi.image_cone(rho)
        degrees = sigma_prime.ray_matrix() \ phi(rho.ray(0))
        for i, d in zip(sigma_prime.ambient_ray_indices(), degrees):
            result[i] *= x_rho^d
    return result

def toric_morphism_dictionary(phi, X, Y):
    r"""
    Given a fan morphism phi from X.fan() -> Y.fan(), return the dictionary representation of the corresponding toric morphism.
    """
    x = [SR.var(x_i, domain="positive") for x_i in X.coordinate_ring().variable_names()]
    y = [SR.var(y_i, domain="positive") for y_i in Y.coordinate_ring().variable_names()]
    result = dict((y_i, 1) for y_i in y)
    for rho, x_rho in zip(X.fan(1), x):
        sigma_prime = phi.image_cone(rho)
        degrees = sigma_prime.ray_matrix() \ phi(rho.ray(0))
        for i, d in zip(sigma_prime.ambient_ray_indices(), degrees):
            result[y[i]] *= x_rho^d
    return result
```
Using the dictionary representation it is quite easy to compute pullbacks, the problem here is that the underlying map of total coordinate rings is not a ring homomorphism, since it is likely to involve roots. The following paper may be useful for "correct and general" implementation:
http://arxiv.org/abs/1004.4924



---

archive/issue_comments_119081.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nP.S. Ordered dictionaries seem very appropriate for this approach, but we need to upgrade Python for them.",
    "created_at": "2011-07-16T03:57:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119081",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:2" align="right">comment:2</div>

P.S. Ordered dictionaries seem very appropriate for this approach, but we need to upgrade Python for them.



---

archive/issue_comments_119082.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nThanks for pointing out the reference. Its fairly obvious that one has to use roots to write the maps but still its good to see that somebody worked out all the details. Though from a quick browse it seems like they don't elaborate on the relation with fan morphisms. E.g. the embedding of the obit closure can be written as a polynomial map in homogeneous coordinates but is not a toric morphism (given by a fan morphism).\n\nMy plan is to implement maps by homogeneous coordinate polynomials and maps by fan morphisms separately, with conversion methods from one to the other if it exists.\n\nEventually we should also have maps involving roots. I'm not sure how we should implement them; Just using symbolic ring variables would be simple but not play nice with compositions. At one point it would be good to write our own \"Homogeneous coordinate ring\" class that knows about the homogeneous rescalings. This would then allow for fractional powers in some nicer way. But I'll leave it for another ticket ;)",
    "created_at": "2011-07-16T10:56:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119082",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:3" align="right">comment:3</div>

Thanks for pointing out the reference. Its fairly obvious that one has to use roots to write the maps but still its good to see that somebody worked out all the details. Though from a quick browse it seems like they don't elaborate on the relation with fan morphisms. E.g. the embedding of the obit closure can be written as a polynomial map in homogeneous coordinates but is not a toric morphism (given by a fan morphism).

My plan is to implement maps by homogeneous coordinate polynomials and maps by fan morphisms separately, with conversion methods from one to the other if it exists.

Eventually we should also have maps involving roots. I'm not sure how we should implement them; Just using symbolic ring variables would be simple but not play nice with compositions. At one point it would be good to write our own "Homogeneous coordinate ring" class that knows about the homogeneous rescalings. This would then allow for fractional powers in some nicer way. But I'll leave it for another ticket ;)



---

archive/issue_comments_119083.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nThey don't elaborate the relation with fan morphisms because they consider arbitrary maps of toric varieties as varieties, including those that don't care about toric structure at all. In particular it is applicable to equivariant morphisms and orbit inclusions. And even in these cases it is necessary to use roots if one of the varieties is not smooth. E.g. a resolution of a singular variety would correspond to the identity map of lattices, but would involve roots in homogeneous coordinates.",
    "created_at": "2011-07-16T16:01:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119083",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:4" align="right">comment:4</div>

They don't elaborate the relation with fan morphisms because they consider arbitrary maps of toric varieties as varieties, including those that don't care about toric structure at all. In particular it is applicable to equivariant morphisms and orbit inclusions. And even in these cases it is necessary to use roots if one of the varieties is not smooth. E.g. a resolution of a singular variety would correspond to the identity map of lattices, but would involve roots in homogeneous coordinates.



---

archive/issue_comments_119084.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nI know. But without roots you can still have homogeneous polynomial maps and toric morphisms. Neither of the two is contained in the other. So I'm planning on implementing toric (equivariant) morphism separately.",
    "created_at": "2011-07-16T16:47:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119084",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:5" align="right">comment:5</div>

I know. But without roots you can still have homogeneous polynomial maps and toric morphisms. Neither of the two is contained in the other. So I'm planning on implementing toric (equivariant) morphism separately.



---

archive/issue_comments_119085.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,7 @@\n Since we have the very nice fan morphism class, we should use it to define toric morphisms of toric varieties.\n+\n+A big part of the patch is porting the scheme morphisms / hom sets to new-style parents and coercion. Categories should be better, too. Fixes #7946 as a side effect.\n+\n+Apply:\n+* [attachment: trac_11599_no_circular_imports.py](https://github.com/sagemath/sage/files/ticket11599/trac_11599_no_circular_imports.py.gz)\n+* [attachment: trac_11599_homset_new_coercion_model.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_homset_new_coercion_model.patch.gz)\n``````\n",
    "created_at": "2011-07-19T18:19:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119085",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,7 @@
 Since we have the very nice fan morphism class, we should use it to define toric morphisms of toric varieties.
+
+A big part of the patch is porting the scheme morphisms / hom sets to new-style parents and coercion. Categories should be better, too. Fixes #7946 as a side effect.
+
+Apply:
+* [attachment: trac_11599_no_circular_imports.py](https://github.com/sagemath/sage/files/ticket11599/trac_11599_no_circular_imports.py.gz)
+* [attachment: trac_11599_homset_new_coercion_model.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_homset_new_coercion_model.patch.gz)
``````




---

archive/issue_comments_119086.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nOk so far no new functionality. But I think now the groundwork is done and we can actually do some work on top of it. I'm sorry for the giant patch :-)",
    "created_at": "2011-07-19T18:19:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119086",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:6" align="right">comment:6</div>

Ok so far no new functionality. But I think now the groundwork is done and we can actually do some work on top of it. I'm sorry for the giant patch :-)



---

archive/issue_comments_119087.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nPickling is broken for some complex object like `EllipticCurveTorsionSubgroup` that contain circular self-references. This is a bug in unpickling the category framework, and will be addressed elsewhere. I've marked the offending unpickling doctests with `# optional - pickling` so we can fix them later.",
    "created_at": "2011-07-19T18:23:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119087",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:7" align="right">comment:7</div>

Pickling is broken for some complex object like `EllipticCurveTorsionSubgroup` that contain circular self-references. This is a bug in unpickling the category framework, and will be addressed elsewhere. I've marked the offending unpickling doctests with `# optional - pickling` so we can fix them later.



---

archive/issue_comments_119088.json:
```json
{
    "body": "Updated patch",
    "created_at": "2011-08-11T21:25:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119088",
    "user": "https://github.com/vbraun"
}
```

Updated patch



---

archive/issue_events_153780.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-08-11T21:35:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11599#event-153780"
}
```



---

archive/issue_comments_119089.json:
```json
{
    "body": "Author: **Volker Braun**",
    "created_at": "2011-08-11T21:35:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119089",
    "user": "https://github.com/vbraun"
}
```

Author: **Volker Braun**



---

archive/issue_comments_119090.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,6 +2,11 @@\n \n A big part of the patch is porting the scheme morphisms / hom sets to new-style parents and coercion. Categories should be better, too. Fixes #7946 as a side effect.\n \n+The first two patches bring some sanity to the scheme morphisms. The 3rd patch changes names of methods/classes to something more reasonable and adds documentation. The 4th patch actually adds toric morphisms defined by polynomials or fan morphisms.\n+\n Apply:\n * [attachment: trac_11599_no_circular_imports.py](https://github.com/sagemath/sage/files/ticket11599/trac_11599_no_circular_imports.py.gz)\n * [attachment: trac_11599_homset_new_coercion_model.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_homset_new_coercion_model.patch.gz)\n+* [attachment: trac_11599_rename_morphisms.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_rename_morphisms.patch.gz)\n+* [attachment: trac_11599_toric_morphisms.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_toric_morphisms.patch.gz)\n+\n``````\n",
    "created_at": "2011-08-11T21:35:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119090",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,6 +2,11 @@
 
 A big part of the patch is porting the scheme morphisms / hom sets to new-style parents and coercion. Categories should be better, too. Fixes #7946 as a side effect.
 
+The first two patches bring some sanity to the scheme morphisms. The 3rd patch changes names of methods/classes to something more reasonable and adds documentation. The 4th patch actually adds toric morphisms defined by polynomials or fan morphisms.
+
 Apply:
 * [attachment: trac_11599_no_circular_imports.py](https://github.com/sagemath/sage/files/ticket11599/trac_11599_no_circular_imports.py.gz)
 * [attachment: trac_11599_homset_new_coercion_model.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_homset_new_coercion_model.patch.gz)
+* [attachment: trac_11599_rename_morphisms.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_rename_morphisms.patch.gz)
+* [attachment: trac_11599_toric_morphisms.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_toric_morphisms.patch.gz)
+
``````




---

archive/issue_comments_119091.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nAttachment: **[trac_11599_no_circular_imports.py.gz](https://github.com/sagemath/sage/files/ticket11599/trac_11599_no_circular_imports.py.gz)**",
    "created_at": "2011-08-11T21:35:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119091",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:8" align="right">comment:8</div>

Attachment: **[trac_11599_no_circular_imports.py.gz](https://github.com/sagemath/sage/files/ticket11599/trac_11599_no_circular_imports.py.gz)**



---

archive/issue_comments_119092.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nThe first patch has wrong extension!",
    "created_at": "2011-08-12T16:14:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119092",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:9" align="right">comment:9</div>

The first patch has wrong extension!



---

archive/issue_comments_119093.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,7 +5,7 @@\n The first two patches bring some sanity to the scheme morphisms. The 3rd patch changes names of methods/classes to something more reasonable and adds documentation. The 4th patch actually adds toric morphisms defined by polynomials or fan morphisms.\n \n Apply:\n-* [attachment: trac_11599_no_circular_imports.py](https://github.com/sagemath/sage/files/ticket11599/trac_11599_no_circular_imports.py.gz)\n+* [attachment: trac_11599_no_circular_imports.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_no_circular_imports.patch.gz)\n * [attachment: trac_11599_homset_new_coercion_model.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_homset_new_coercion_model.patch.gz)\n * [attachment: trac_11599_rename_morphisms.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_rename_morphisms.patch.gz)\n * [attachment: trac_11599_toric_morphisms.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_toric_morphisms.patch.gz)\n``````\n",
    "created_at": "2011-08-12T16:18:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119093",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,7 +5,7 @@
 The first two patches bring some sanity to the scheme morphisms. The 3rd patch changes names of methods/classes to something more reasonable and adds documentation. The 4th patch actually adds toric morphisms defined by polynomials or fan morphisms.
 
 Apply:
-* [attachment: trac_11599_no_circular_imports.py](https://github.com/sagemath/sage/files/ticket11599/trac_11599_no_circular_imports.py.gz)
+* [attachment: trac_11599_no_circular_imports.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_no_circular_imports.patch.gz)
 * [attachment: trac_11599_homset_new_coercion_model.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_homset_new_coercion_model.patch.gz)
 * [attachment: trac_11599_rename_morphisms.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_rename_morphisms.patch.gz)
 * [attachment: trac_11599_toric_morphisms.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_toric_morphisms.patch.gz)
``````




---

archive/issue_comments_119094.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nOops, I clearly never read past the first letter of the extension ;-)",
    "created_at": "2011-08-12T16:18:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119094",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:10" align="right">comment:10</div>

Oops, I clearly never read past the first letter of the extension ;-)



---

archive/issue_comments_119095.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nI've noticed that there are various issues with torus factors, that is, not full-dimensional fans. While you can easily ignore the torus factor when dealing with a single toric variety, we need to be more careful when we consider morphisms. In any case, this needs some more work and I propose to do that elsewhere.",
    "created_at": "2011-08-13T19:09:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119095",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:11" align="right">comment:11</div>

I've noticed that there are various issues with torus factors, that is, not full-dimensional fans. While you can easily ignore the torus factor when dealing with a single toric variety, we need to be more careful when we consider morphisms. In any case, this needs some more work and I propose to do that elsewhere.



---

archive/issue_comments_119096.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nYes, I had this problem when I was dealing with charts corresponding to non-full-dimensional cones. We need to keep the information about directions corresponding to torus factor coordinates, standard basis vectors are not always the best choice. Magma calls these directions \"virtual rays\" but I am not fond of this name. In any case, I was going to work on it but after having #11400 in place to have a uniform access to representations of different types of rays.",
    "created_at": "2011-08-13T20:03:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119096",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:12" align="right">comment:12</div>

Yes, I had this problem when I was dealing with charts corresponding to non-full-dimensional cones. We need to keep the information about directions corresponding to torus factor coordinates, standard basis vectors are not always the best choice. Magma calls these directions "virtual rays" but I am not fond of this name. In any case, I was going to work on it but after having #11400 in place to have a uniform access to representations of different types of rays.



---

archive/issue_comments_119097.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nI thought we might be able to add the torus factor rays at the end of `fan.rays()`, so that we always have a 1-1 correspondence between rays and homogeneous variables. The list of 1-cones starts with the rays but does not include the torus factor rays. But I haven't tried this to see how it will work out.\n\nDoes this mean that you want me to review #11400 now? ;-)",
    "created_at": "2011-08-13T20:09:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119097",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:13" align="right">comment:13</div>

I thought we might be able to add the torus factor rays at the end of `fan.rays()`, so that we always have a 1-1 correspondence between rays and homogeneous variables. The list of 1-cones starts with the rays but does not include the torus factor rays. But I haven't tried this to see how it will work out.

Does this mean that you want me to review #11400 now? ;-)



---

archive/issue_comments_119098.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nI just noticed that we still haven't merged #10793. Of course I had some matrices accidentally transposed...",
    "created_at": "2011-08-13T22:12:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119098",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:14" align="right">comment:14</div>

I just noticed that we still haven't merged #10793. Of course I had some matrices accidentally transposed...



---

archive/issue_comments_119099.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@vbraun](#comment%3A13):\n> I thought we might be able to add the torus factor rays at the end of `fan.rays()`, so that we always have a 1-1 correspondence between rays and homogeneous variables. The list of 1-cones starts with the rays but does not include the torus factor rays. But I haven't tried this to see how it will work out.\n\nThat's an interesting idea, but we should be very careful if we implement it: there may be places where the rays of the fan are supposed to be \"honest\" and I am not quite sure how to search for such places. But maybe I just worry too much.\n\n> Does this mean that you want me to review #11400 now? ;-)\n\nI certainly would not mind ;-) And thanks for reviewing #10793!",
    "created_at": "2011-08-14T03:24:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119099",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@vbraun](#comment%3A13):
> I thought we might be able to add the torus factor rays at the end of `fan.rays()`, so that we always have a 1-1 correspondence between rays and homogeneous variables. The list of 1-cones starts with the rays but does not include the torus factor rays. But I haven't tried this to see how it will work out.

That's an interesting idea, but we should be very careful if we implement it: there may be places where the rays of the fan are supposed to be "honest" and I am not quite sure how to search for such places. But maybe I just worry too much.

> Does this mean that you want me to review #11400 now? ;-)

I certainly would not mind ;-) And thanks for reviewing #10793!



---

archive/issue_comments_119100.json:
```json
{
    "body": "Reviewer: **Andrey Novoseltsev**",
    "created_at": "2011-08-17T04:28:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119100",
    "user": "https://github.com/novoselt"
}
```

Reviewer: **Andrey Novoseltsev**



---

archive/issue_comments_119101.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nFor the record: the first patch looks totally fine to me. Also all long doctests pass with arbitrary number of patches applied, so they could be merged one-by-one. I definitely would like to slowly go over the code of the last patch myself, but if someone wants to approve 2 and 3 - you are very welcome!",
    "created_at": "2011-08-17T04:28:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119101",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:16" align="right">comment:16</div>

For the record: the first patch looks totally fine to me. Also all long doctests pass with arbitrary number of patches applied, so they could be merged one-by-one. I definitely would like to slowly go over the code of the last patch myself, but if someone wants to approve 2 and 3 - you are very welcome!



---

archive/issue_events_153781.json:
```json
{
    "actor": "https://github.com/zimmermann6",
    "created_at": "2011-09-12T15:14:11Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "title_is": "Wrap fan morphism in toric morphism",
    "title_was": "Wrap fan moriphism in toric morphism",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11599#event-153781"
}
```



---

archive/issue_comments_119102.json:
```json
{
    "body": "Rebased patch",
    "created_at": "2011-12-16T10:16:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119102",
    "user": "https://github.com/vbraun"
}
```

Rebased patch



---

archive/issue_comments_119103.json:
```json
{
    "body": "Attachment: **[trac_11599_no_circular_imports.patch.gz](https://github.com/sagemath/sage/files/ticket11599/trac_11599_no_circular_imports.patch.gz)**\n\nRebased patch",
    "created_at": "2011-12-16T10:16:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119103",
    "user": "https://github.com/vbraun"
}
```

Attachment: **[trac_11599_no_circular_imports.patch.gz](https://github.com/sagemath/sage/files/ticket11599/trac_11599_no_circular_imports.patch.gz)**

Rebased patch



---

archive/issue_comments_119104.json:
```json
{
    "body": "Attachment: **[trac_11599_rename_morphisms.2.patch.gz](https://github.com/sagemath/sage/files/ticket11599/trac_11599_rename_morphisms.2.patch.gz)**\n\nAttachment: **[trac_11599_toric_morphisms.patch.gz](https://github.com/sagemath/sage/files/ticket11599/trac_11599_toric_morphisms.patch.gz)**\n\nRebased patch",
    "created_at": "2011-12-16T10:17:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119104",
    "user": "https://github.com/vbraun"
}
```

Attachment: **[trac_11599_rename_morphisms.2.patch.gz](https://github.com/sagemath/sage/files/ticket11599/trac_11599_rename_morphisms.2.patch.gz)**

Attachment: **[trac_11599_toric_morphisms.patch.gz](https://github.com/sagemath/sage/files/ticket11599/trac_11599_toric_morphisms.patch.gz)**

Rebased patch



---

archive/issue_comments_119105.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nApply trac_11599_no_circular_imports.patch trac_11599_homset_new_coercion_model.patch trac_11599_rename_morphisms.patch trac_11599_toric_morphisms.patch \n\nRediffed because it conflicted with #11526",
    "created_at": "2011-12-16T10:22:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119105",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:18" align="right">comment:18</div>

Apply trac_11599_no_circular_imports.patch trac_11599_homset_new_coercion_model.patch trac_11599_rename_morphisms.patch trac_11599_toric_morphisms.patch 

Rediffed because it conflicted with #11526



---

archive/issue_comments_119106.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nLooking good.\n\nThere is a typo in trac_11599_homset_new_coercion_model.patch line 482: \"...the heigh of the coordinates\", should be \"height\".",
    "created_at": "2011-12-16T12:41:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119106",
    "user": "https://github.com/sagetrac-davideklund"
}
```

<div id="comment:19" align="right">comment:19</div>

Looking good.

There is a typo in trac_11599_homset_new_coercion_model.patch line 482: "...the heigh of the coordinates", should be "height".



---

archive/issue_comments_119107.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nThanks, fixed.",
    "created_at": "2011-12-16T13:04:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119107",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:20" align="right">comment:20</div>

Thanks, fixed.



---

archive/issue_comments_119108.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@sagetrac-davideklund](#comment%3A19):\n> Looking good.\n> \n> There is a typo in trac_11599_homset_new_coercion_model.patch line 482: \"...the heigh of the coordinates\", should be \"height\".\n\n\"Looking good\" as in positive review to the second patch with the fixed typo?-)",
    "created_at": "2011-12-29T17:19:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119108",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@sagetrac-davideklund](#comment%3A19):
> Looking good.
> 
> There is a typo in trac_11599_homset_new_coercion_model.patch line 482: "...the heigh of the coordinates", should be "height".

"Looking good" as in positive review to the second patch with the fixed typo?-)



---

archive/issue_comments_119109.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nVolker: regarding pickling issues and doctests marked \"optional - pickling\", is there already an open ticket for this? If not, should there be one?",
    "created_at": "2011-12-29T17:26:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119109",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:22" align="right">comment:22</div>

Volker: regarding pickling issues and doctests marked "optional - pickling", is there already an open ticket for this? If not, should there be one?



---

archive/issue_comments_119110.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nNext questions: why `AffineSpace_generic` now inherits from `AmbientSpace` only and not `AffineScheme` as well?",
    "created_at": "2011-12-29T17:41:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119110",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:23" align="right">comment:23</div>

Next questions: why `AffineSpace_generic` now inherits from `AmbientSpace` only and not `AffineScheme` as well?



---

archive/issue_comments_119111.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@novoselt](#comment%3A21):\n> Replying to [@sagetrac-davideklund](#comment%3A19):\n> > Looking good.\n> > \n> > There is a typo in trac_11599_homset_new_coercion_model.patch line 482: \"...the heigh of the coordinates\", should be \"height\".\n\n> \n> \"Looking good\" as in positive review to the second patch with the fixed typo?-)\n\nSorry, I meant that it looks good in general, would need to go through it more carefully for a review. I was planning to look at this ticket though, I hope to contribute to the review of it (but it might take a while for me to get started since I will be traveling).",
    "created_at": "2011-12-29T17:44:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119111",
    "user": "https://github.com/sagetrac-davideklund"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@novoselt](#comment%3A21):
> Replying to [@sagetrac-davideklund](#comment%3A19):
> > Looking good.
> > 
> > There is a typo in trac_11599_homset_new_coercion_model.patch line 482: "...the heigh of the coordinates", should be "height".

> 
> "Looking good" as in positive review to the second patch with the fixed typo?-)

Sorry, I meant that it looks good in general, would need to go through it more carefully for a review. I was planning to look at this ticket though, I hope to contribute to the review of it (but it might take a while for me to get started since I will be traveling).



---

archive/issue_comments_119112.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nThanks for a quick reply, David! I was going to review this ticket for a very embarrassingly long time (and have even boldly put myself as a reviewer)... My current plan is to go ahead and read through the patches during the break, but another set of eyes (and especially brains) would be very welcome at least for the general/non-toric part.",
    "created_at": "2011-12-29T17:49:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119112",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:25" align="right">comment:25</div>

Thanks for a quick reply, David! I was going to review this ticket for a very embarrassingly long time (and have even boldly put myself as a reviewer)... My current plan is to go ahead and read through the patches during the break, but another set of eyes (and especially brains) would be very welcome at least for the general/non-toric part.



---

archive/issue_comments_119113.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\n`AffineScheme` doesn't add much functionality to `Scheme`, which is the base for `AmbientSpace`. But I guess for completeness it should be listed amongst the parents. Its just my bias against multiple inheritance. Updated patch fixes it.\n\nI haven't made a ticket about pickling. While we should strive for pickle-ability, there are many places that don't support it. The issue here is somewhat complicated interaction of Python and Cython, so I think one would have to make the pickler smarter in order to solve it...",
    "created_at": "2011-12-29T17:55:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119113",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:26" align="right">comment:26</div>

`AffineScheme` doesn't add much functionality to `Scheme`, which is the base for `AmbientSpace`. But I guess for completeness it should be listed amongst the parents. Its just my bias against multiple inheritance. Updated patch fixes it.

I haven't made a ticket about pickling. While we should strive for pickle-ability, there are many places that don't support it. The issue here is somewhat complicated interaction of Python and Cython, so I think one would have to make the pickler smarter in order to solve it...



---

archive/issue_comments_119114.json:
```json
{
    "body": "Attachment: **[trac_11599_homset_new_coercion_model.patch.gz](https://github.com/sagemath/sage/files/ticket11599/trac_11599_homset_new_coercion_model.patch.gz)**\n\nUpdated patch",
    "created_at": "2011-12-29T17:55:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119114",
    "user": "https://github.com/vbraun"
}
```

Attachment: **[trac_11599_homset_new_coercion_model.patch.gz](https://github.com/sagemath/sage/files/ticket11599/trac_11599_homset_new_coercion_model.patch.gz)**

Updated patch



---

archive/issue_comments_119115.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nMy concern is that people who do use elliptic curves may find out that their personal code does not work anymore with these patches...\n\nThanks for inheritance clarification!\n\nIn `ambient_space.py`: can NT's comment and related commented code be gone due to the changes? (So that it does not confuse those who read this file in the future.)",
    "created_at": "2011-12-29T18:13:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119115",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:27" align="right">comment:27</div>

My concern is that people who do use elliptic curves may find out that their personal code does not work anymore with these patches...

Thanks for inheritance clarification!

In `ambient_space.py`: can NT's comment and related commented code be gone due to the changes? (So that it does not confuse those who read this file in the future.)



---

archive/issue_comments_119116.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nWith current patches:\n\n```\nSCORE sage/schemes/generic/homset.py: 85% (18 of 21)\n\nMissing documentation:\n\t * base_extend(self, R):\n\n\nMissing doctests:\n\t * is_SchemeHomset(H):\n\t * _element_constructor_(self, *args, **kwds):\n\n\nPossibly wrong (function name doesn't occur in doctests):\n\t * _element_constructor_(self, x, check=True):\n\t * _element_constructor_(self, *v, **kwds):\n\t * _element_constructor_(self, *v, **kwds):\n\t * _element_constructor_(self, *v, **kwds):\n```\nWould be nice to get to 100%.",
    "created_at": "2011-12-29T18:18:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119116",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:28" align="right">comment:28</div>

With current patches:

```
SCORE sage/schemes/generic/homset.py: 85% (18 of 21)

Missing documentation:
	 * base_extend(self, R):


Missing doctests:
	 * is_SchemeHomset(H):
	 * _element_constructor_(self, *args, **kwds):


Possibly wrong (function name doesn't occur in doctests):
	 * _element_constructor_(self, x, check=True):
	 * _element_constructor_(self, *v, **kwds):
	 * _element_constructor_(self, *v, **kwds):
	 * _element_constructor_(self, *v, **kwds):
```
Would be nice to get to 100%.



---

archive/issue_comments_119117.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n Since we have the very nice fan morphism class, we should use it to define toric morphisms of toric varieties.\n \n-A big part of the patch is porting the scheme morphisms / hom sets to new-style parents and coercion. Categories should be better, too. Fixes #7946 as a side effect.\n+A big part of the patch is porting the scheme morphisms / hom sets to new-style parents and coercion. Categories should be better, too. Fixes #7946 and #6810 as a side effect.\n \n The first two patches bring some sanity to the scheme morphisms. The 3rd patch changes names of methods/classes to something more reasonable and adds documentation. The 4th patch actually adds toric morphisms defined by polynomials or fan morphisms.\n \n``````\n",
    "created_at": "2011-12-29T18:18:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119117",
    "user": "https://github.com/novoselt"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 Since we have the very nice fan morphism class, we should use it to define toric morphisms of toric varieties.
 
-A big part of the patch is porting the scheme morphisms / hom sets to new-style parents and coercion. Categories should be better, too. Fixes #7946 as a side effect.
+A big part of the patch is porting the scheme morphisms / hom sets to new-style parents and coercion. Categories should be better, too. Fixes #7946 and #6810 as a side effect.
 
 The first two patches bring some sanity to the scheme morphisms. The 3rd patch changes names of methods/classes to something more reasonable and adds documentation. The 4th patch actually adds toric morphisms defined by polynomials or fan morphisms.
 
``````




---

archive/issue_comments_119118.json:
```json
{
    "body": "Attachment: **[trac_11599_rename_morphisms.patch.gz](https://github.com/sagemath/sage/files/ticket11599/trac_11599_rename_morphisms.patch.gz)**\n\nUpdated patch",
    "created_at": "2011-12-29T19:14:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119118",
    "user": "https://github.com/vbraun"
}
```

Attachment: **[trac_11599_rename_morphisms.patch.gz](https://github.com/sagemath/sage/files/ticket11599/trac_11599_rename_morphisms.patch.gz)**

Updated patch



---

archive/issue_comments_119119.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nAdded some more doctests to bring the whole directory to 95.4% doctest coverage ;-)",
    "created_at": "2011-12-29T19:15:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119119",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:29" align="right">comment:29</div>

Added some more doctests to bring the whole directory to 95.4% doctest coverage ;-)



---

archive/issue_comments_119120.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nI am confused by `SchemeHomset_generic.__call__` and its documentation. Why are things passed to `Set_generic.__call__` and documentation should be in `_call_` of derived classes? What exactly should be done by this particular class?\n\nI have also started a reviewer patch on top of all others fixing little issues, it is not in its final form yet.",
    "created_at": "2012-01-12T18:34:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119120",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:30" align="right">comment:30</div>

I am confused by `SchemeHomset_generic.__call__` and its documentation. Why are things passed to `Set_generic.__call__` and documentation should be in `_call_` of derived classes? What exactly should be done by this particular class?

I have also started a reviewer patch on top of all others fixing little issues, it is not in its final form yet.



---

archive/issue_comments_119121.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -9,4 +9,4 @@\n * [attachment: trac_11599_homset_new_coercion_model.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_homset_new_coercion_model.patch.gz)\n * [attachment: trac_11599_rename_morphisms.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_rename_morphisms.patch.gz)\n * [attachment: trac_11599_toric_morphisms.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_toric_morphisms.patch.gz)\n-\n+* [attachment: trac_11599_reviewer.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_reviewer.patch.gz)\n``````\n",
    "created_at": "2012-01-12T18:35:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119121",
    "user": "https://github.com/novoselt"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -9,4 +9,4 @@
 * [attachment: trac_11599_homset_new_coercion_model.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_homset_new_coercion_model.patch.gz)
 * [attachment: trac_11599_rename_morphisms.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_rename_morphisms.patch.gz)
 * [attachment: trac_11599_toric_morphisms.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_toric_morphisms.patch.gz)
-
+* [attachment: trac_11599_reviewer.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_reviewer.patch.gz)
``````




---

archive/issue_comments_119122.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nWhat's the point in having `SchemeHomset_points_projective_ring` at all if all it does is implementing two non-implemented methods? Can't we just get rid of it?",
    "created_at": "2012-01-21T01:12:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119122",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:32" align="right">comment:32</div>

What's the point in having `SchemeHomset_points_projective_ring` at all if all it does is implementing two non-implemented methods? Can't we just get rid of it?



---

archive/issue_comments_119123.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nPresumably somebody wanted to implement projective spaces over general rings but has not gotten around to doing it yet. I just kept what we have so that future generations know where to plug in the scheme morphism over rings. Also, some elliptic curve stuff derives from it. Again thats not really a good reason for keeping it but it might be useful in the future.",
    "created_at": "2012-01-21T01:50:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119123",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:33" align="right">comment:33</div>

Presumably somebody wanted to implement projective spaces over general rings but has not gotten around to doing it yet. I just kept what we have so that future generations know where to plug in the scheme morphism over rings. Also, some elliptic curve stuff derives from it. Again thats not really a good reason for keeping it but it might be useful in the future.



---

archive/issue_comments_119124.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nDone with the huge patch, all looks fine, little tweaks are in the reviewer patch.\n\nMoving on to the remaining ones...",
    "created_at": "2012-01-24T22:20:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119124",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:34" align="right">comment:34</div>

Done with the huge patch, all looks fine, little tweaks are in the reviewer patch.

Moving on to the remaining ones...



---

archive/issue_comments_119125.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nThe renaming is great, but do we need `_class` on the end of `_morphism_class`, `_homset_class`,  `_point_class`, `_point_homset_class`??? It seems to me that these functions return actual morphisms and homsets, not classes, so it is confusing (and it was especially confusing when they were undocumented). I propose getting rid of `_class` suffix.\n\nThere is also no consistency in \"a word for homset\": I think I saw \"homset\", \"hom set\", \"hom-set\", \"Hom-set\" and maybe other variants with capitalization-spacing-dashing. It would be nice to settle with a single one. Personally I prefer \"Hom-set\" with close second \"homset\". Or, perhaps, they should be referred to as \"sets of morphisms\".\n\nOtherwise I am fine with the third patch, so only the fun part is left!",
    "created_at": "2012-01-31T05:33:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119125",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:35" align="right">comment:35</div>

The renaming is great, but do we need `_class` on the end of `_morphism_class`, `_homset_class`,  `_point_class`, `_point_homset_class`??? It seems to me that these functions return actual morphisms and homsets, not classes, so it is confusing (and it was especially confusing when they were undocumented). I propose getting rid of `_class` suffix.

There is also no consistency in "a word for homset": I think I saw "homset", "hom set", "hom-set", "Hom-set" and maybe other variants with capitalization-spacing-dashing. It would be nice to settle with a single one. Personally I prefer "Hom-set" with close second "homset". Or, perhaps, they should be referred to as "sets of morphisms".

Otherwise I am fine with the third patch, so only the fun part is left!



---

archive/issue_comments_119126.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nFor the last patch:\n\n1. In `schemes.rst` extra trailing spaces are added to one line (which I think was recently prohibited ;-)) and `toric_morphism` is added twice - probably it should be only once?\n2. In `scheme.py` it adds `cached_method`, but it was already imported, so this hunk should not be there.\n3. In `toric_homset.py`: I think that generic description should not be duplicated in the module docstring. On the other hand AUTHOURS, EXAMPLES and license sections should be added.\n4. `__init__` in the beginning does not have a docstring at all. It would be nice also to add some clarifying comment what exactly is achieved by `register_conversion` there (although maybe I am supposed to know that?...)\n5. In the example of `_element_constructor_` can we please not use `Hom` as the name for `dP8.Hom(P2)`? `Hom` is a top-level function and overwriting it is a bit confusing, especially since the example is quite long. How about just `H` instead?\n6. In `_repr_defn` of toric morphism lines like \"Defined by sending the Rational polyhedral fan in 2-d lattice N to Rational polyhedral fan in 1-d lattice N.\" are constructed. \"the\" in front of domain but not codomain is a bit strange and I think we should remove it since fans are capitalized. Or put it in both places, but it makes strings longer ;-)\n7. In `_homset_class` of `toric_variety.py` the old doctest is deleted and it is actually no longer working. Without direct calls to private functions, `H([z0, z1, z0, z3])` is also not working, which bugs me quite a bit. The traceback goes to `NotImplementedError` and includes `Set_generic.__call__` which I have complained a bit in https://github.com/sagemath/sage/issues/11599#comment:30.\n\nThese are all the comments that I have, will upload new reviewer patch shortly.",
    "created_at": "2012-02-09T04:40:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119126",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:36" align="right">comment:36</div>

For the last patch:

1. In `schemes.rst` extra trailing spaces are added to one line (which I think was recently prohibited ;-)) and `toric_morphism` is added twice - probably it should be only once?
2. In `scheme.py` it adds `cached_method`, but it was already imported, so this hunk should not be there.
3. In `toric_homset.py`: I think that generic description should not be duplicated in the module docstring. On the other hand AUTHOURS, EXAMPLES and license sections should be added.
4. `__init__` in the beginning does not have a docstring at all. It would be nice also to add some clarifying comment what exactly is achieved by `register_conversion` there (although maybe I am supposed to know that?...)
5. In the example of `_element_constructor_` can we please not use `Hom` as the name for `dP8.Hom(P2)`? `Hom` is a top-level function and overwriting it is a bit confusing, especially since the example is quite long. How about just `H` instead?
6. In `_repr_defn` of toric morphism lines like "Defined by sending the Rational polyhedral fan in 2-d lattice N to Rational polyhedral fan in 1-d lattice N." are constructed. "the" in front of domain but not codomain is a bit strange and I think we should remove it since fans are capitalized. Or put it in both places, but it makes strings longer ;-)
7. In `_homset_class` of `toric_variety.py` the old doctest is deleted and it is actually no longer working. Without direct calls to private functions, `H([z0, z1, z0, z3])` is also not working, which bugs me quite a bit. The traceback goes to `NotImplementedError` and includes `Set_generic.__call__` which I have complained a bit in https://github.com/sagemath/sage/issues/11599#comment:30.

These are all the comments that I have, will upload new reviewer patch shortly.



---

archive/issue_events_153782.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2012-02-09T04:40:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11599#event-153782"
}
```



---

archive/issue_events_153783.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2012-02-09T04:40:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11599#event-153783"
}
```



---

archive/issue_comments_119127.json:
```json
{
    "body": "Attachment: **[trac_11599_reviewer.patch.gz](https://github.com/sagemath/sage/files/ticket11599/trac_11599_reviewer.patch.gz)**\n\nAttachment: **[trac_11599_remove_class_suffix.patch.gz](https://github.com/sagemath/sage/files/ticket11599/trac_11599_remove_class_suffix.patch.gz)**\n\nInitial patch",
    "created_at": "2012-02-19T22:47:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119127",
    "user": "https://github.com/vbraun"
}
```

Attachment: **[trac_11599_reviewer.patch.gz](https://github.com/sagemath/sage/files/ticket11599/trac_11599_reviewer.patch.gz)**

Attachment: **[trac_11599_remove_class_suffix.patch.gz](https://github.com/sagemath/sage/files/ticket11599/trac_11599_remove_class_suffix.patch.gz)**

Initial patch



---

archive/issue_comments_119128.json:
```json
{
    "body": "Attachment: **[trac_11599_remaining_fixes.patch.gz](https://github.com/sagemath/sage/files/ticket11599/trac_11599_remaining_fixes.patch.gz)**\n\nInitial patch",
    "created_at": "2012-02-19T22:47:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119128",
    "user": "https://github.com/vbraun"
}
```

Attachment: **[trac_11599_remaining_fixes.patch.gz](https://github.com/sagemath/sage/files/ticket11599/trac_11599_remaining_fixes.patch.gz)**

Initial patch



---

archive/issue_events_153784.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2012-02-19T22:49:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11599#event-153784"
}
```



---

archive/issue_events_153785.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2012-02-19T22:49:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11599#event-153785"
}
```



---

archive/issue_comments_119129.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -10,3 +10,5 @@\n * [attachment: trac_11599_rename_morphisms.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_rename_morphisms.patch.gz)\n * [attachment: trac_11599_toric_morphisms.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_toric_morphisms.patch.gz)\n * [attachment: trac_11599_reviewer.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_reviewer.patch.gz)\n+* [attachment: trac_11599_remove_class_suffix.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_remove_class_suffix.patch.gz)\n+* [attachment: trac_11599_remaining_fixes.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_remaining_fixes.patch.gz)\n``````\n",
    "created_at": "2012-02-19T22:49:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119129",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -10,3 +10,5 @@
 * [attachment: trac_11599_rename_morphisms.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_rename_morphisms.patch.gz)
 * [attachment: trac_11599_toric_morphisms.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_toric_morphisms.patch.gz)
 * [attachment: trac_11599_reviewer.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_reviewer.patch.gz)
+* [attachment: trac_11599_remove_class_suffix.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_remove_class_suffix.patch.gz)
+* [attachment: trac_11599_remaining_fixes.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_remaining_fixes.patch.gz)
``````




---

archive/issue_comments_119130.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nI renamed the method names to remove the `_class` suffix, this is the first new patch.\n\nThe final patch should deal with all of your remaining suggestions.",
    "created_at": "2012-02-19T22:49:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119130",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:37" align="right">comment:37</div>

I renamed the method names to remove the `_class` suffix, this is the first new patch.

The final patch should deal with all of your remaining suggestions.



---

archive/issue_comments_119131.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nThank you!\n\nWhat is the purpose of `fan` in `algebraic_scheme.py` in the very last patch? I think it is confusing to return for a subscheme the fan of the ambient space, especially if the subscheme happens to be a toric variety itself and then can potentially have its own associated fan of a smaller dimension.",
    "created_at": "2012-02-19T23:23:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119131",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:38" align="right">comment:38</div>

Thank you!

What is the purpose of `fan` in `algebraic_scheme.py` in the very last patch? I think it is confusing to return for a subscheme the fan of the ambient space, especially if the subscheme happens to be a toric variety itself and then can potentially have its own associated fan of a smaller dimension.



---

archive/issue_comments_119132.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nIf you want to construct a toric morphism from an algebraic scheme then the algebraic scheme needs to have a `fan()` method. Of course one could change he toric morphism to work around that, but after some thinking I thought it is best to do it. A toric subscheme is in general not a toric variety, so there shouldn't be any confusion.",
    "created_at": "2012-02-19T23:27:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119132",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:39" align="right">comment:39</div>

If you want to construct a toric morphism from an algebraic scheme then the algebraic scheme needs to have a `fan()` method. Of course one could change he toric morphism to work around that, but after some thinking I thought it is best to do it. A toric subscheme is in general not a toric variety, so there shouldn't be any confusion.



---

archive/issue_comments_119133.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nWell, looks good, hopefully it will make its way into Sage-5.0!",
    "created_at": "2012-02-20T00:14:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119133",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:40" align="right">comment:40</div>

Well, looks good, hopefully it will make its way into Sage-5.0!



---

archive/issue_events_153786.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2012-02-20T00:14:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11599#event-153786"
}
```



---

archive/issue_events_153787.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2012-02-20T00:14:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11599#event-153787"
}
```



---

archive/issue_comments_119134.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nThere is numerical noise on various systems (including ia64 and OSX 10.4 PPC):\n\n```\n**********************************************************************\nFile \"/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-5.0.beta6/devel/sage-main/sage/schemes/generic/morphism.py\", line 1292:\n    sage: P(2+I, 3-I, 4+5*I)\nExpected:\n    (0.317073170732 - 0.146341463415*I : 0.170731707317 - 0.463414634146*I : 1.0)\nGot:\n    (0.317073170732 - 0.146341463415*I : 0.170731707317 - 0.463414634146*I : 1.0 - 1.73387706291e-17*I)\n**********************************************************************\n```",
    "created_at": "2012-02-26T22:11:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119134",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:41" align="right">comment:41</div>

There is numerical noise on various systems (including ia64 and OSX 10.4 PPC):

```
**********************************************************************
File "/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-5.0.beta6/devel/sage-main/sage/schemes/generic/morphism.py", line 1292:
    sage: P(2+I, 3-I, 4+5*I)
Expected:
    (0.317073170732 - 0.146341463415*I : 0.170731707317 - 0.463414634146*I : 1.0)
Got:
    (0.317073170732 - 0.146341463415*I : 0.170731707317 - 0.463414634146*I : 1.0 - 1.73387706291e-17*I)
**********************************************************************
```



---

archive/issue_events_153788.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-02-26T22:11:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11599#event-153788"
}
```



---

archive/issue_events_153789.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-02-26T22:11:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11599#event-153789"
}
```



---

archive/issue_comments_119135.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nSo - what would be the correct way to deal with such noise?..",
    "created_at": "2012-03-06T17:05:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119135",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:42" align="right">comment:42</div>

So - what would be the correct way to deal with such noise?..



---

archive/issue_comments_119136.json:
```json
{
    "body": "Initial patch",
    "created_at": "2012-03-06T18:26:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119136",
    "user": "https://github.com/vbraun"
}
```

Initial patch



---

archive/issue_events_153790.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2012-03-06T18:28:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11599#event-153790"
}
```



---

archive/issue_events_153791.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2012-03-06T18:28:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11599#event-153791"
}
```



---

archive/issue_comments_119137.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -12,3 +12,4 @@\n * [attachment: trac_11599_reviewer.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_reviewer.patch.gz)\n * [attachment: trac_11599_remove_class_suffix.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_remove_class_suffix.patch.gz)\n * [attachment: trac_11599_remaining_fixes.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_remaining_fixes.patch.gz)\n+* [attachment: trac_11599_numerical_noise.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_numerical_noise.patch.gz)\n``````\n",
    "created_at": "2012-03-06T18:28:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119137",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -12,3 +12,4 @@
 * [attachment: trac_11599_reviewer.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_reviewer.patch.gz)
 * [attachment: trac_11599_remove_class_suffix.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_remove_class_suffix.patch.gz)
 * [attachment: trac_11599_remaining_fixes.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_remaining_fixes.patch.gz)
+* [attachment: trac_11599_numerical_noise.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_numerical_noise.patch.gz)
``````




---

archive/issue_comments_119138.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nAttachment: **[trac_11599_numerical_noise.patch.gz](https://github.com/sagemath/sage/files/ticket11599/trac_11599_numerical_noise.patch.gz)**\n\nI propose to just set the homogeneous variable to 1 instead of dividing by itself...",
    "created_at": "2012-03-06T18:28:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119138",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:43" align="right">comment:43</div>

Attachment: **[trac_11599_numerical_noise.patch.gz](https://github.com/sagemath/sage/files/ticket11599/trac_11599_numerical_noise.patch.gz)**

I propose to just set the homogeneous variable to 1 instead of dividing by itself...



---

archive/issue_events_153792.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2012-03-06T19:16:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11599#event-153792"
}
```



---

archive/issue_events_153793.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2012-03-06T19:16:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11599#event-153793"
}
```



---

archive/issue_comments_119139.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nSeems reasonable to me and passes all tests on Sage-5.0.beta7 (although I cannot test on those platforms).",
    "created_at": "2012-03-06T19:16:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119139",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:44" align="right">comment:44</div>

Seems reasonable to me and passes all tests on Sage-5.0.beta7 (although I cannot test on those platforms).



---

archive/issue_comments_119140.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nFor your information:\nthis patch conflicts with #715 (in the sense that a doctest from #715 fails with this patch applied).",
    "created_at": "2012-03-10T09:34:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119140",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:45" align="right">comment:45</div>

For your information:
this patch conflicts with #715 (in the sense that a doctest from #715 fails with this patch applied).



---

archive/issue_comments_119141.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nApply trac_11599_no_circular_imports.patch, trac_11599_homset_new_coercion_model.patch, trac_11599_rename_morphisms.patch, trac_11599_toric_morphisms.patch, trac_11599_reviewer.patch, trac_11599_remove_class_suffix.patch, trac_11599_remaining_fixes.patch, trac_11599_numerical_noise.patch\n\n(for the patchbot, which is failing #12544 because it tries to apply the patches here in the wrong order)",
    "created_at": "2012-03-12T10:19:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119141",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:46" align="right">comment:46</div>

Apply trac_11599_no_circular_imports.patch, trac_11599_homset_new_coercion_model.patch, trac_11599_rename_morphisms.patch, trac_11599_toric_morphisms.patch, trac_11599_reviewer.patch, trac_11599_remove_class_suffix.patch, trac_11599_remaining_fixes.patch, trac_11599_numerical_noise.patch

(for the patchbot, which is failing #12544 because it tries to apply the patches here in the wrong order)



---

archive/issue_comments_119142.json:
```json
{
    "body": "Merged: **sage-5.0.beta9**",
    "created_at": "2012-03-21T22:04:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119142",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.0.beta9**



---

archive/issue_events_153794.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-21T22:04:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11599#event-153794"
}
```



---

archive/issue_events_153795.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-21T22:04:39Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11599#event-153795"
}
```



---

archive/issue_comments_119143.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nHi there,\n\nIt's cool to see thinks moving forward and the doc getting better. However\ncommunication between developers could be better too. In this ticket, there is\na big chunk fixing the doc of `sage/structure/factory.pyx`. In my ticket,\nimproving `classcall` and `UniqueRepresentation`, I also discovered\nthat `sage/structure/factory.pyx` wasn't in the doc and that its doc was\nbroken. I didn't find any ticket that seems to fix it so I decided to go ahead\nand spend on hour improving it... For nothing except creating a conflict.\n\nNext time, please make such unrelated doctest improvements in a separate\nticket, and advertise them on trac!\n\nThanks,\n\nGrumpy Florent",
    "created_at": "2012-04-10T10:00:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119143",
    "user": "https://github.com/hivert"
}
```

<div id="comment:48" align="right">comment:48</div>

Hi there,

It's cool to see thinks moving forward and the doc getting better. However
communication between developers could be better too. In this ticket, there is
a big chunk fixing the doc of `sage/structure/factory.pyx`. In my ticket,
improving `classcall` and `UniqueRepresentation`, I also discovered
that `sage/structure/factory.pyx` wasn't in the doc and that its doc was
broken. I didn't find any ticket that seems to fix it so I decided to go ahead
and spend on hour improving it... For nothing except creating a conflict.

Next time, please make such unrelated doctest improvements in a separate
ticket, and advertise them on trac!

Thanks,

Grumpy Florent



---

archive/issue_comments_119144.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nThe patches here cause a serious slow-down in parts of the elliptic curve code, see #12853.",
    "created_at": "2012-04-18T12:00:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119144",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:49" align="right">comment:49</div>

The patches here cause a serious slow-down in parts of the elliptic curve code, see #12853.



---

archive/issue_comments_119145.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nMore precisely, the patch [attachment: trac_11599_homset_new_coercion_model.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_homset_new_coercion_model.patch.gz) causes the slow-down.",
    "created_at": "2012-04-18T12:05:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119145",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:50" align="right">comment:50</div>

More precisely, the patch [attachment: trac_11599_homset_new_coercion_model.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_homset_new_coercion_model.patch.gz) causes the slow-down.



---

archive/issue_comments_119146.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nIn trac_11599_homset_new_coercion_model.patch a comment is added in line 529 (now line 531) of sage/schemes/elliptic_curve/ell_curve_isogeny, which now reads\n\n```\n        sage: phi == loads(dumps(phi))   # optional - pickling https://github.com/sagemath/sage/issues/11599\n```\nand now fails if testing is done with the --optional flag.  Should \"optional\" be changed to \"not tested\" here until it is fixed?",
    "created_at": "2012-09-14T11:46:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119146",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:51" align="right">comment:51</div>

In trac_11599_homset_new_coercion_model.patch a comment is added in line 529 (now line 531) of sage/schemes/elliptic_curve/ell_curve_isogeny, which now reads

```
        sage: phi == loads(dumps(phi))   # optional - pickling https://github.com/sagemath/sage/issues/11599
```
and now fails if testing is done with the --optional flag.  Should "optional" be changed to "not tested" here until it is fixed?



---

archive/issue_comments_119147.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nPS Same on line 158 of ell_torsion.py.  As I understand it the tag #optional should be acompanied by the name of an optional spkg.",
    "created_at": "2012-09-14T11:53:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119147",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:52" align="right">comment:52</div>

PS Same on line 158 of ell_torsion.py.  As I understand it the tag #optional should be acompanied by the name of an optional spkg.



---

archive/issue_comments_119148.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nReplying to [@JohnCremona](#comment%3A51):\n> Should \"optional\" be changed to \"not tested\" here until it is fixed?\n\nEven better: \"known bug\", see #14362.",
    "created_at": "2013-03-27T00:44:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-119148",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:53" align="right">comment:53</div>

Replying to [@JohnCremona](#comment%3A51):
> Should "optional" be changed to "not tested" here until it is fixed?

Even better: "known bug", see #14362.
