# Issue 11599: Wrap fan morphism in toric morphism

archive/issues_011427.json:
```json
{
    "assignees": [],
    "body": "Since we have the very nice fan morphism class, we should use it to define toric morphisms of toric varieties.\n\nA big part of the patch is porting the scheme morphisms / hom sets to new-style parents and coercion. Categories should be better, too. Fixes #7946 and #6810 as a side effect.\n\nThe first two patches bring some sanity to the scheme morphisms. The 3rd patch changes names of methods/classes to something more reasonable and adds documentation. The 4th patch actually adds toric morphisms defined by polynomials or fan morphisms.\n\nApply:\n* [attachment:trac_11599_no_circular_imports.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_no_circular_imports.patch)\n* [attachment:trac_11599_homset_new_coercion_model.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_homset_new_coercion_model.patch)\n* [attachment:trac_11599_rename_morphisms.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_rename_morphisms.patch)\n* [attachment:trac_11599_toric_morphisms.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_toric_morphisms.patch)\n* [attachment:trac_11599_reviewer.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_reviewer.patch)\n* [attachment:trac_11599_remove_class_suffix.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_remove_class_suffix.patch)\n* [attachment:trac_11599_remaining_fixes.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_remaining_fixes.patch)\n* [attachment:trac_11599_numerical_noise.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_numerical_noise.patch)\n\n**Assignee:** @aghitza\n\n**CC:**  davideklund fschulze @miguelmarco\n\n**Reviewer:** Andrey Novoseltsev\n\n**Author:** Volker Braun\n\n**Merged:** sage-5.0.beta9\n\nIssue created by migration from https://trac.sagemath.org/ticket/11599\n\n",
    "closed_at": "2012-03-21T22:04:39Z",
    "created_at": "2011-07-14T17:25:02Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20algebraic%20geometry",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Wrap fan morphism in toric morphism",
    "type": "issue",
    "updated_at": "2013-03-27T00:44:07Z",
    "url": "https://github.com/sagemath/sage/issues/11599",
    "user": "https://github.com/vbraun"
}
```
Since we have the very nice fan morphism class, we should use it to define toric morphisms of toric varieties.

A big part of the patch is porting the scheme morphisms / hom sets to new-style parents and coercion. Categories should be better, too. Fixes #7946 and #6810 as a side effect.

The first two patches bring some sanity to the scheme morphisms. The 3rd patch changes names of methods/classes to something more reasonable and adds documentation. The 4th patch actually adds toric morphisms defined by polynomials or fan morphisms.

Apply:
* [attachment:trac_11599_no_circular_imports.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_no_circular_imports.patch)
* [attachment:trac_11599_homset_new_coercion_model.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_homset_new_coercion_model.patch)
* [attachment:trac_11599_rename_morphisms.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_rename_morphisms.patch)
* [attachment:trac_11599_toric_morphisms.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_toric_morphisms.patch)
* [attachment:trac_11599_reviewer.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_reviewer.patch)
* [attachment:trac_11599_remove_class_suffix.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_remove_class_suffix.patch)
* [attachment:trac_11599_remaining_fixes.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_remaining_fixes.patch)
* [attachment:trac_11599_numerical_noise.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_numerical_noise.patch)

**Assignee:** @aghitza

**CC:**  davideklund fschulze @miguelmarco

**Reviewer:** Andrey Novoseltsev

**Author:** Volker Braun

**Merged:** sage-5.0.beta9

Issue created by migration from https://trac.sagemath.org/ticket/11599





---

archive/issue_events_130934.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-07-14T17:25:02Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "milestone_number": null,
    "milestone_title": "sage-5.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11599#event-130934"
}
```



---

archive/issue_events_130935.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-07-14T17:25:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20algebraic%20geometry",
    "label_color": "08517b",
    "label_name": "component: algebraic geometry",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11599#event-130935"
}
```



---

archive/issue_events_130936.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-07-14T17:25:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "008080",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11599#event-130936"
}
```



---

archive/issue_comments_121254.json:
```json
{
    "body": "<a id='comment:1'>**Comment 1:**</a>\nWe should. I have been using the following code so far:\n\n```\ndef toric_morphism_list(phi, X, Y):\n    r\"\"\"\n    Given a fan morphism phi from X.fan() -> Y.fan(), return the list representation of the corresponding toric morphism.\n    \"\"\"\n    x = [SR.var(x_i, domain=\"positive\") for x_i in X.coordinate_ring().variable_names()]\n    result = [1] * Y.fan().nrays()\n    for rho, x_rho in zip(X.fan(1), x):\n        sigma_prime = phi.image_cone(rho)\n        degrees = sigma_prime.ray_matrix() \\ phi(rho.ray(0))\n        for i, d in zip(sigma_prime.ambient_ray_indices(), degrees):\n            result[i] *= x_rho^d\n    return result\n\ndef toric_morphism_dictionary(phi, X, Y):\n    r\"\"\"\n    Given a fan morphism phi from X.fan() -> Y.fan(), return the dictionary representation of the corresponding toric morphism.\n    \"\"\"\n    x = [SR.var(x_i, domain=\"positive\") for x_i in X.coordinate_ring().variable_names()]\n    y = [SR.var(y_i, domain=\"positive\") for y_i in Y.coordinate_ring().variable_names()]\n    result = dict((y_i, 1) for y_i in y)\n    for rho, x_rho in zip(X.fan(1), x):\n        sigma_prime = phi.image_cone(rho)\n        degrees = sigma_prime.ray_matrix() \\ phi(rho.ray(0))\n        for i, d in zip(sigma_prime.ambient_ray_indices(), degrees):\n            result[y[i]] *= x_rho^d\n    return result\n```\nUsing the dictionary representation it is quite easy to compute pullbacks, the problem here is that the underlying map of total coordinate rings is not a ring homomorphism, since it is likely to involve roots. The following paper may be useful for \"correct and general\" implementation:\nhttp://arxiv.org/abs/1004.4924",
    "created_at": "2011-07-16T03:56:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121254",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:1'>**Comment 1:**</a>
We should. I have been using the following code so far:

```
def toric_morphism_list(phi, X, Y):
    r"""
    Given a fan morphism phi from X.fan() -> Y.fan(), return the list representation of the corresponding toric morphism.
    """
    x = [SR.var(x_i, domain="positive") for x_i in X.coordinate_ring().variable_names()]
    result = [1] * Y.fan().nrays()
    for rho, x_rho in zip(X.fan(1), x):
        sigma_prime = phi.image_cone(rho)
        degrees = sigma_prime.ray_matrix() \ phi(rho.ray(0))
        for i, d in zip(sigma_prime.ambient_ray_indices(), degrees):
            result[i] *= x_rho^d
    return result

def toric_morphism_dictionary(phi, X, Y):
    r"""
    Given a fan morphism phi from X.fan() -> Y.fan(), return the dictionary representation of the corresponding toric morphism.
    """
    x = [SR.var(x_i, domain="positive") for x_i in X.coordinate_ring().variable_names()]
    y = [SR.var(y_i, domain="positive") for y_i in Y.coordinate_ring().variable_names()]
    result = dict((y_i, 1) for y_i in y)
    for rho, x_rho in zip(X.fan(1), x):
        sigma_prime = phi.image_cone(rho)
        degrees = sigma_prime.ray_matrix() \ phi(rho.ray(0))
        for i, d in zip(sigma_prime.ambient_ray_indices(), degrees):
            result[y[i]] *= x_rho^d
    return result
```
Using the dictionary representation it is quite easy to compute pullbacks, the problem here is that the underlying map of total coordinate rings is not a ring homomorphism, since it is likely to involve roots. The following paper may be useful for "correct and general" implementation:
http://arxiv.org/abs/1004.4924



---

archive/issue_comments_121255.json:
```json
{
    "body": "<a id='comment:2'>**Comment 2:**</a>\nP.S. Ordered dictionaries seem very appropriate for this approach, but we need to upgrade Python for them.",
    "created_at": "2011-07-16T03:57:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121255",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:2'>**Comment 2:**</a>
P.S. Ordered dictionaries seem very appropriate for this approach, but we need to upgrade Python for them.



---

archive/issue_comments_121256.json:
```json
{
    "body": "<a id='comment:3'>**Comment 3:**</a>\nThanks for pointing out the reference. Its fairly obvious that one has to use roots to write the maps but still its good to see that somebody worked out all the details. Though from a quick browse it seems like they don't elaborate on the relation with fan morphisms. E.g. the embedding of the obit closure can be written as a polynomial map in homogeneous coordinates but is not a toric morphism (given by a fan morphism).\n\nMy plan is to implement maps by homogeneous coordinate polynomials and maps by fan morphisms separately, with conversion methods from one to the other if it exists.\n\nEventually we should also have maps involving roots. I'm not sure how we should implement them; Just using symbolic ring variables would be simple but not play nice with compositions. At one point it would be good to write our own \"Homogeneous coordinate ring\" class that knows about the homogeneous rescalings. This would then allow for fractional powers in some nicer way. But I'll leave it for another ticket ;)",
    "created_at": "2011-07-16T10:56:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121256",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:3'>**Comment 3:**</a>
Thanks for pointing out the reference. Its fairly obvious that one has to use roots to write the maps but still its good to see that somebody worked out all the details. Though from a quick browse it seems like they don't elaborate on the relation with fan morphisms. E.g. the embedding of the obit closure can be written as a polynomial map in homogeneous coordinates but is not a toric morphism (given by a fan morphism).

My plan is to implement maps by homogeneous coordinate polynomials and maps by fan morphisms separately, with conversion methods from one to the other if it exists.

Eventually we should also have maps involving roots. I'm not sure how we should implement them; Just using symbolic ring variables would be simple but not play nice with compositions. At one point it would be good to write our own "Homogeneous coordinate ring" class that knows about the homogeneous rescalings. This would then allow for fractional powers in some nicer way. But I'll leave it for another ticket ;)



---

archive/issue_comments_121257.json:
```json
{
    "body": "<a id='comment:4'>**Comment 4:**</a>\nThey don't elaborate the relation with fan morphisms because they consider arbitrary maps of toric varieties as varieties, including those that don't care about toric structure at all. In particular it is applicable to equivariant morphisms and orbit inclusions. And even in these cases it is necessary to use roots if one of the varieties is not smooth. E.g. a resolution of a singular variety would correspond to the identity map of lattices, but would involve roots in homogeneous coordinates.",
    "created_at": "2011-07-16T16:01:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121257",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:4'>**Comment 4:**</a>
They don't elaborate the relation with fan morphisms because they consider arbitrary maps of toric varieties as varieties, including those that don't care about toric structure at all. In particular it is applicable to equivariant morphisms and orbit inclusions. And even in these cases it is necessary to use roots if one of the varieties is not smooth. E.g. a resolution of a singular variety would correspond to the identity map of lattices, but would involve roots in homogeneous coordinates.



---

archive/issue_comments_121258.json:
```json
{
    "body": "<a id='comment:5'>**Comment 5:**</a>\nI know. But without roots you can still have homogeneous polynomial maps and toric morphisms. Neither of the two is contained in the other. So I'm planning on implementing toric (equivariant) morphism separately.",
    "created_at": "2011-07-16T16:47:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121258",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:5'>**Comment 5:**</a>
I know. But without roots you can still have homogeneous polynomial maps and toric morphisms. Neither of the two is contained in the other. So I'm planning on implementing toric (equivariant) morphism separately.



---

archive/issue_comments_121259.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,7 @@\n Since we have the very nice fan morphism class, we should use it to define toric morphisms of toric varieties.\n+\n+A big part of the patch is porting the scheme morphisms / hom sets to new-style parents and coercion. Categories should be better, too. Fixes #7946 as a side effect.\n+\n+Apply:\n+* [attachment:trac_11599_no_circular_imports.py](https://github.com/sagemath/sage/files/ticket11599/trac_11599_no_circular_imports.py)\n+* [attachment:trac_11599_homset_new_coercion_model.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_homset_new_coercion_model.patch)\n``````\n",
    "created_at": "2011-07-19T18:19:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121259",
    "user": "https://github.com/vbraun"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,7 @@
 Since we have the very nice fan morphism class, we should use it to define toric morphisms of toric varieties.
+
+A big part of the patch is porting the scheme morphisms / hom sets to new-style parents and coercion. Categories should be better, too. Fixes #7946 as a side effect.
+
+Apply:
+* [attachment:trac_11599_no_circular_imports.py](https://github.com/sagemath/sage/files/ticket11599/trac_11599_no_circular_imports.py)
+* [attachment:trac_11599_homset_new_coercion_model.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_homset_new_coercion_model.patch)
``````




---

archive/issue_comments_121260.json:
```json
{
    "body": "<a id='comment:6'>**Comment 6:**</a>\nOk so far no new functionality. But I think now the groundwork is done and we can actually do some work on top of it. I'm sorry for the giant patch :-)",
    "created_at": "2011-07-19T18:19:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121260",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:6'>**Comment 6:**</a>
Ok so far no new functionality. But I think now the groundwork is done and we can actually do some work on top of it. I'm sorry for the giant patch :-)



---

archive/issue_comments_121261.json:
```json
{
    "body": "<a id='comment:7'>**Comment 7:**</a>\nPickling is broken for some complex object like `EllipticCurveTorsionSubgroup` that contain circular self-references. This is a bug in unpickling the category framework, and will be addressed elsewhere. I've marked the offending unpickling doctests with `# optional - pickling` so we can fix them later.",
    "created_at": "2011-07-19T18:23:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121261",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:7'>**Comment 7:**</a>
Pickling is broken for some complex object like `EllipticCurveTorsionSubgroup` that contain circular self-references. This is a bug in unpickling the category framework, and will be addressed elsewhere. I've marked the offending unpickling doctests with `# optional - pickling` so we can fix them later.



---

archive/issue_comments_121262.json:
```json
{
    "body": "Updated patch",
    "created_at": "2011-08-11T21:25:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121262",
    "user": "https://github.com/vbraun"
}
```

Updated patch



---

archive/issue_events_130937.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-08-11T21:35:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11599#event-130937"
}
```



---

archive/issue_comments_121263.json:
```json
{
    "body": "**Author:** Volker Braun",
    "created_at": "2011-08-11T21:35:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121263",
    "user": "https://github.com/vbraun"
}
```

**Author:** Volker Braun



---

archive/issue_comments_121264.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,6 +2,11 @@\n \n A big part of the patch is porting the scheme morphisms / hom sets to new-style parents and coercion. Categories should be better, too. Fixes #7946 as a side effect.\n \n+The first two patches bring some sanity to the scheme morphisms. The 3rd patch changes names of methods/classes to something more reasonable and adds documentation. The 4th patch actually adds toric morphisms defined by polynomials or fan morphisms.\n+\n Apply:\n * [attachment:trac_11599_no_circular_imports.py](https://github.com/sagemath/sage/files/ticket11599/trac_11599_no_circular_imports.py)\n * [attachment:trac_11599_homset_new_coercion_model.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_homset_new_coercion_model.patch)\n+* [attachment:trac_11599_rename_morphisms.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_rename_morphisms.patch)\n+* [attachment:trac_11599_toric_morphisms.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_toric_morphisms.patch)\n+\n``````\n",
    "created_at": "2011-08-11T21:35:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121264",
    "user": "https://github.com/vbraun"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,6 +2,11 @@
 
 A big part of the patch is porting the scheme morphisms / hom sets to new-style parents and coercion. Categories should be better, too. Fixes #7946 as a side effect.
 
+The first two patches bring some sanity to the scheme morphisms. The 3rd patch changes names of methods/classes to something more reasonable and adds documentation. The 4th patch actually adds toric morphisms defined by polynomials or fan morphisms.
+
 Apply:
 * [attachment:trac_11599_no_circular_imports.py](https://github.com/sagemath/sage/files/ticket11599/trac_11599_no_circular_imports.py)
 * [attachment:trac_11599_homset_new_coercion_model.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_homset_new_coercion_model.patch)
+* [attachment:trac_11599_rename_morphisms.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_rename_morphisms.patch)
+* [attachment:trac_11599_toric_morphisms.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_toric_morphisms.patch)
+
``````




---

archive/issue_comments_121265.json:
```json
{
    "body": "<a id='comment:8'>**Comment 8:**</a>\n**Attachment:** [trac_11599_no_circular_imports.py.gz](https://github.com/sagemath/sage/files/ticket11599/trac_11599_no_circular_imports.py.gz)",
    "created_at": "2011-08-11T21:35:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121265",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:8'>**Comment 8:**</a>
**Attachment:** [trac_11599_no_circular_imports.py.gz](https://github.com/sagemath/sage/files/ticket11599/trac_11599_no_circular_imports.py.gz)



---

archive/issue_comments_121266.json:
```json
{
    "body": "<a id='comment:9'>**Comment 9:**</a>\nThe first patch has wrong extension!",
    "created_at": "2011-08-12T16:14:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121266",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:9'>**Comment 9:**</a>
The first patch has wrong extension!



---

archive/issue_comments_121267.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -5,7 +5,7 @@\n The first two patches bring some sanity to the scheme morphisms. The 3rd patch changes names of methods/classes to something more reasonable and adds documentation. The 4th patch actually adds toric morphisms defined by polynomials or fan morphisms.\n \n Apply:\n-* [attachment:trac_11599_no_circular_imports.py](https://github.com/sagemath/sage/files/ticket11599/trac_11599_no_circular_imports.py)\n+* [attachment:trac_11599_no_circular_imports.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_no_circular_imports.patch)\n * [attachment:trac_11599_homset_new_coercion_model.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_homset_new_coercion_model.patch)\n * [attachment:trac_11599_rename_morphisms.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_rename_morphisms.patch)\n * [attachment:trac_11599_toric_morphisms.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_toric_morphisms.patch)\n``````\n",
    "created_at": "2011-08-12T16:18:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121267",
    "user": "https://github.com/vbraun"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -5,7 +5,7 @@
 The first two patches bring some sanity to the scheme morphisms. The 3rd patch changes names of methods/classes to something more reasonable and adds documentation. The 4th patch actually adds toric morphisms defined by polynomials or fan morphisms.
 
 Apply:
-* [attachment:trac_11599_no_circular_imports.py](https://github.com/sagemath/sage/files/ticket11599/trac_11599_no_circular_imports.py)
+* [attachment:trac_11599_no_circular_imports.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_no_circular_imports.patch)
 * [attachment:trac_11599_homset_new_coercion_model.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_homset_new_coercion_model.patch)
 * [attachment:trac_11599_rename_morphisms.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_rename_morphisms.patch)
 * [attachment:trac_11599_toric_morphisms.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_toric_morphisms.patch)
``````




---

archive/issue_comments_121268.json:
```json
{
    "body": "<a id='comment:10'>**Comment 10:**</a>\nOops, I clearly never read past the first letter of the extension ;-)",
    "created_at": "2011-08-12T16:18:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121268",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:10'>**Comment 10:**</a>
Oops, I clearly never read past the first letter of the extension ;-)



---

archive/issue_comments_121269.json:
```json
{
    "body": "<a id='comment:11'>**Comment 11:**</a>\nI've noticed that there are various issues with torus factors, that is, not full-dimensional fans. While you can easily ignore the torus factor when dealing with a single toric variety, we need to be more careful when we consider morphisms. In any case, this needs some more work and I propose to do that elsewhere.",
    "created_at": "2011-08-13T19:09:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121269",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:11'>**Comment 11:**</a>
I've noticed that there are various issues with torus factors, that is, not full-dimensional fans. While you can easily ignore the torus factor when dealing with a single toric variety, we need to be more careful when we consider morphisms. In any case, this needs some more work and I propose to do that elsewhere.



---

archive/issue_comments_121270.json:
```json
{
    "body": "<a id='comment:12'>**Comment 12:**</a>\nYes, I had this problem when I was dealing with charts corresponding to non-full-dimensional cones. We need to keep the information about directions corresponding to torus factor coordinates, standard basis vectors are not always the best choice. Magma calls these directions \"virtual rays\" but I am not fond of this name. In any case, I was going to work on it but after having #11400 in place to have a uniform access to representations of different types of rays.",
    "created_at": "2011-08-13T20:03:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121270",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:12'>**Comment 12:**</a>
Yes, I had this problem when I was dealing with charts corresponding to non-full-dimensional cones. We need to keep the information about directions corresponding to torus factor coordinates, standard basis vectors are not always the best choice. Magma calls these directions "virtual rays" but I am not fond of this name. In any case, I was going to work on it but after having #11400 in place to have a uniform access to representations of different types of rays.



---

archive/issue_comments_121271.json:
```json
{
    "body": "<a id='comment:13'>**Comment 13:**</a>\nI thought we might be able to add the torus factor rays at the end of `fan.rays()`, so that we always have a 1-1 correspondence between rays and homogeneous variables. The list of 1-cones starts with the rays but does not include the torus factor rays. But I haven't tried this to see how it will work out.\n\nDoes this mean that you want me to review #11400 now? ;-)",
    "created_at": "2011-08-13T20:09:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121271",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:13'>**Comment 13:**</a>
I thought we might be able to add the torus factor rays at the end of `fan.rays()`, so that we always have a 1-1 correspondence between rays and homogeneous variables. The list of 1-cones starts with the rays but does not include the torus factor rays. But I haven't tried this to see how it will work out.

Does this mean that you want me to review #11400 now? ;-)



---

archive/issue_comments_121272.json:
```json
{
    "body": "<a id='comment:14'>**Comment 14:**</a>\nI just noticed that we still haven't merged #10793. Of course I had some matrices accidentally transposed...",
    "created_at": "2011-08-13T22:12:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121272",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:14'>**Comment 14:**</a>
I just noticed that we still haven't merged #10793. Of course I had some matrices accidentally transposed...



---

archive/issue_comments_121273.json:
```json
{
    "body": "<a id='comment:15'>**Comment 15:**</a>\nReplying to [@vbraun](#comment%3A13):\n> I thought we might be able to add the torus factor rays at the end of `fan.rays()`, so that we always have a 1-1 correspondence between rays and homogeneous variables. The list of 1-cones starts with the rays but does not include the torus factor rays. But I haven't tried this to see how it will work out.\n\nThat's an interesting idea, but we should be very careful if we implement it: there may be places where the rays of the fan are supposed to be \"honest\" and I am not quite sure how to search for such places. But maybe I just worry too much.\n\n> Does this mean that you want me to review #11400 now? ;-)\n\nI certainly would not mind ;-) And thanks for reviewing #10793!",
    "created_at": "2011-08-14T03:24:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121273",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:15'>**Comment 15:**</a>
Replying to [@vbraun](#comment%3A13):
> I thought we might be able to add the torus factor rays at the end of `fan.rays()`, so that we always have a 1-1 correspondence between rays and homogeneous variables. The list of 1-cones starts with the rays but does not include the torus factor rays. But I haven't tried this to see how it will work out.

That's an interesting idea, but we should be very careful if we implement it: there may be places where the rays of the fan are supposed to be "honest" and I am not quite sure how to search for such places. But maybe I just worry too much.

> Does this mean that you want me to review #11400 now? ;-)

I certainly would not mind ;-) And thanks for reviewing #10793!



---

archive/issue_comments_121274.json:
```json
{
    "body": "**Reviewer:** Andrey Novoseltsev",
    "created_at": "2011-08-17T04:28:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121274",
    "user": "https://github.com/novoselt"
}
```

**Reviewer:** Andrey Novoseltsev



---

archive/issue_comments_121275.json:
```json
{
    "body": "<a id='comment:16'>**Comment 16:**</a>\nFor the record: the first patch looks totally fine to me. Also all long doctests pass with arbitrary number of patches applied, so they could be merged one-by-one. I definitely would like to slowly go over the code of the last patch myself, but if someone wants to approve 2 and 3 - you are very welcome!",
    "created_at": "2011-08-17T04:28:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121275",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:16'>**Comment 16:**</a>
For the record: the first patch looks totally fine to me. Also all long doctests pass with arbitrary number of patches applied, so they could be merged one-by-one. I definitely would like to slowly go over the code of the last patch myself, but if someone wants to approve 2 and 3 - you are very welcome!



---

archive/issue_events_130938.json:
```json
{
    "actor": "https://github.com/zimmermann6",
    "created_at": "2011-09-12T15:14:11Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "rename": {
        "from": "Wrap fan moriphism in toric morphism",
        "to": "Wrap fan morphism in toric morphism"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11599#event-130938"
}
```



---

archive/issue_comments_121276.json:
```json
{
    "body": "Rebased patch",
    "created_at": "2011-12-16T10:16:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121276",
    "user": "https://github.com/vbraun"
}
```

Rebased patch



---

archive/issue_comments_121277.json:
```json
{
    "body": "**Attachment:** [trac_11599_no_circular_imports.patch.gz](https://github.com/sagemath/sage/files/ticket11599/trac_11599_no_circular_imports.patch.gz)\n\nRebased patch",
    "created_at": "2011-12-16T10:16:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121277",
    "user": "https://github.com/vbraun"
}
```

**Attachment:** [trac_11599_no_circular_imports.patch.gz](https://github.com/sagemath/sage/files/ticket11599/trac_11599_no_circular_imports.patch.gz)

Rebased patch



---

archive/issue_comments_121278.json:
```json
{
    "body": "**Attachment:** [trac_11599_rename_morphisms.2.patch.gz](https://github.com/sagemath/sage/files/ticket11599/trac_11599_rename_morphisms.2.patch.gz)\n\n**Attachment:** [trac_11599_toric_morphisms.patch.gz](https://github.com/sagemath/sage/files/ticket11599/trac_11599_toric_morphisms.patch.gz)\n\nRebased patch",
    "created_at": "2011-12-16T10:17:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121278",
    "user": "https://github.com/vbraun"
}
```

**Attachment:** [trac_11599_rename_morphisms.2.patch.gz](https://github.com/sagemath/sage/files/ticket11599/trac_11599_rename_morphisms.2.patch.gz)

**Attachment:** [trac_11599_toric_morphisms.patch.gz](https://github.com/sagemath/sage/files/ticket11599/trac_11599_toric_morphisms.patch.gz)

Rebased patch



---

archive/issue_comments_121279.json:
```json
{
    "body": "<a id='comment:18'>**Comment 18:**</a>\nApply trac_11599_no_circular_imports.patch trac_11599_homset_new_coercion_model.patch trac_11599_rename_morphisms.patch trac_11599_toric_morphisms.patch \n\nRediffed because it conflicted with #11526",
    "created_at": "2011-12-16T10:22:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121279",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:18'>**Comment 18:**</a>
Apply trac_11599_no_circular_imports.patch trac_11599_homset_new_coercion_model.patch trac_11599_rename_morphisms.patch trac_11599_toric_morphisms.patch 

Rediffed because it conflicted with #11526



---

archive/issue_comments_121280.json:
```json
{
    "body": "<a id='comment:19'>**Comment 19:**</a>\nLooking good.\n\nThere is a typo in trac_11599_homset_new_coercion_model.patch line 482: \"...the heigh of the coordinates\", should be \"height\".",
    "created_at": "2011-12-16T12:41:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121280",
    "user": "https://github.com/sagetrac-davideklund"
}
```

<a id='comment:19'>**Comment 19:**</a>
Looking good.

There is a typo in trac_11599_homset_new_coercion_model.patch line 482: "...the heigh of the coordinates", should be "height".



---

archive/issue_comments_121281.json:
```json
{
    "body": "<a id='comment:20'>**Comment 20:**</a>\nThanks, fixed.",
    "created_at": "2011-12-16T13:04:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121281",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:20'>**Comment 20:**</a>
Thanks, fixed.



---

archive/issue_comments_121282.json:
```json
{
    "body": "<a id='comment:21'>**Comment 21:**</a>\nReplying to [davideklund](#comment%3A19):\n> Looking good.\n> \n> There is a typo in trac_11599_homset_new_coercion_model.patch line 482: \"...the heigh of the coordinates\", should be \"height\".\n\n\"Looking good\" as in positive review to the second patch with the fixed typo?-)",
    "created_at": "2011-12-29T17:19:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121282",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:21'>**Comment 21:**</a>
Replying to [davideklund](#comment%3A19):
> Looking good.
> 
> There is a typo in trac_11599_homset_new_coercion_model.patch line 482: "...the heigh of the coordinates", should be "height".

"Looking good" as in positive review to the second patch with the fixed typo?-)



---

archive/issue_comments_121283.json:
```json
{
    "body": "<a id='comment:22'>**Comment 22:**</a>\nVolker: regarding pickling issues and doctests marked \"optional - pickling\", is there already an open ticket for this? If not, should there be one?",
    "created_at": "2011-12-29T17:26:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121283",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:22'>**Comment 22:**</a>
Volker: regarding pickling issues and doctests marked "optional - pickling", is there already an open ticket for this? If not, should there be one?



---

archive/issue_comments_121284.json:
```json
{
    "body": "<a id='comment:23'>**Comment 23:**</a>\nNext questions: why `AffineSpace_generic` now inherits from `AmbientSpace` only and not `AffineScheme` as well?",
    "created_at": "2011-12-29T17:41:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121284",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:23'>**Comment 23:**</a>
Next questions: why `AffineSpace_generic` now inherits from `AmbientSpace` only and not `AffineScheme` as well?



---

archive/issue_comments_121285.json:
```json
{
    "body": "<a id='comment:24'>**Comment 24:**</a>\nReplying to [@novoselt](#comment%3A21):\n> Replying to [davideklund](#comment%3A19):\n> > Looking good.\n> > \n> > There is a typo in trac_11599_homset_new_coercion_model.patch line 482: \"...the heigh of the coordinates\", should be \"height\".\n\n> \n> \"Looking good\" as in positive review to the second patch with the fixed typo?-)\n\nSorry, I meant that it looks good in general, would need to go through it more carefully for a review. I was planning to look at this ticket though, I hope to contribute to the review of it (but it might take a while for me to get started since I will be traveling).",
    "created_at": "2011-12-29T17:44:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121285",
    "user": "https://github.com/sagetrac-davideklund"
}
```

<a id='comment:24'>**Comment 24:**</a>
Replying to [@novoselt](#comment%3A21):
> Replying to [davideklund](#comment%3A19):
> > Looking good.
> > 
> > There is a typo in trac_11599_homset_new_coercion_model.patch line 482: "...the heigh of the coordinates", should be "height".

> 
> "Looking good" as in positive review to the second patch with the fixed typo?-)

Sorry, I meant that it looks good in general, would need to go through it more carefully for a review. I was planning to look at this ticket though, I hope to contribute to the review of it (but it might take a while for me to get started since I will be traveling).



---

archive/issue_comments_121286.json:
```json
{
    "body": "<a id='comment:25'>**Comment 25:**</a>\nThanks for a quick reply, David! I was going to review this ticket for a very embarrassingly long time (and have even boldly put myself as a reviewer)... My current plan is to go ahead and read through the patches during the break, but another set of eyes (and especially brains) would be very welcome at least for the general/non-toric part.",
    "created_at": "2011-12-29T17:49:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121286",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:25'>**Comment 25:**</a>
Thanks for a quick reply, David! I was going to review this ticket for a very embarrassingly long time (and have even boldly put myself as a reviewer)... My current plan is to go ahead and read through the patches during the break, but another set of eyes (and especially brains) would be very welcome at least for the general/non-toric part.



---

archive/issue_comments_121287.json:
```json
{
    "body": "<a id='comment:26'>**Comment 26:**</a>\n`AffineScheme` doesn't add much functionality to `Scheme`, which is the base for `AmbientSpace`. But I guess for completeness it should be listed amongst the parents. Its just my bias against multiple inheritance. Updated patch fixes it.\n\nI haven't made a ticket about pickling. While we should strive for pickle-ability, there are many places that don't support it. The issue here is somewhat complicated interaction of Python and Cython, so I think one would have to make the pickler smarter in order to solve it...",
    "created_at": "2011-12-29T17:55:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121287",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:26'>**Comment 26:**</a>
`AffineScheme` doesn't add much functionality to `Scheme`, which is the base for `AmbientSpace`. But I guess for completeness it should be listed amongst the parents. Its just my bias against multiple inheritance. Updated patch fixes it.

I haven't made a ticket about pickling. While we should strive for pickle-ability, there are many places that don't support it. The issue here is somewhat complicated interaction of Python and Cython, so I think one would have to make the pickler smarter in order to solve it...



---

archive/issue_comments_121288.json:
```json
{
    "body": "**Attachment:** [trac_11599_homset_new_coercion_model.patch.gz](https://github.com/sagemath/sage/files/ticket11599/trac_11599_homset_new_coercion_model.patch.gz)\n\nUpdated patch",
    "created_at": "2011-12-29T17:55:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121288",
    "user": "https://github.com/vbraun"
}
```

**Attachment:** [trac_11599_homset_new_coercion_model.patch.gz](https://github.com/sagemath/sage/files/ticket11599/trac_11599_homset_new_coercion_model.patch.gz)

Updated patch



---

archive/issue_comments_121289.json:
```json
{
    "body": "<a id='comment:27'>**Comment 27:**</a>\nMy concern is that people who do use elliptic curves may find out that their personal code does not work anymore with these patches...\n\nThanks for inheritance clarification!\n\nIn `ambient_space.py`: can NT's comment and related commented code be gone due to the changes? (So that it does not confuse those who read this file in the future.)",
    "created_at": "2011-12-29T18:13:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121289",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:27'>**Comment 27:**</a>
My concern is that people who do use elliptic curves may find out that their personal code does not work anymore with these patches...

Thanks for inheritance clarification!

In `ambient_space.py`: can NT's comment and related commented code be gone due to the changes? (So that it does not confuse those who read this file in the future.)



---

archive/issue_comments_121290.json:
```json
{
    "body": "<a id='comment:28'>**Comment 28:**</a>\nWith current patches:\n\n```\nSCORE sage/schemes/generic/homset.py: 85% (18 of 21)\n\nMissing documentation:\n\t * base_extend(self, R):\n\n\nMissing doctests:\n\t * is_SchemeHomset(H):\n\t * _element_constructor_(self, *args, **kwds):\n\n\nPossibly wrong (function name doesn't occur in doctests):\n\t * _element_constructor_(self, x, check=True):\n\t * _element_constructor_(self, *v, **kwds):\n\t * _element_constructor_(self, *v, **kwds):\n\t * _element_constructor_(self, *v, **kwds):\n```\nWould be nice to get to 100%.",
    "created_at": "2011-12-29T18:18:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121290",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:28'>**Comment 28:**</a>
With current patches:

```
SCORE sage/schemes/generic/homset.py: 85% (18 of 21)

Missing documentation:
	 * base_extend(self, R):


Missing doctests:
	 * is_SchemeHomset(H):
	 * _element_constructor_(self, *args, **kwds):


Possibly wrong (function name doesn't occur in doctests):
	 * _element_constructor_(self, x, check=True):
	 * _element_constructor_(self, *v, **kwds):
	 * _element_constructor_(self, *v, **kwds):
	 * _element_constructor_(self, *v, **kwds):
```
Would be nice to get to 100%.



---

archive/issue_comments_121291.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n Since we have the very nice fan morphism class, we should use it to define toric morphisms of toric varieties.\n \n-A big part of the patch is porting the scheme morphisms / hom sets to new-style parents and coercion. Categories should be better, too. Fixes #7946 as a side effect.\n+A big part of the patch is porting the scheme morphisms / hom sets to new-style parents and coercion. Categories should be better, too. Fixes #7946 and #6810 as a side effect.\n \n The first two patches bring some sanity to the scheme morphisms. The 3rd patch changes names of methods/classes to something more reasonable and adds documentation. The 4th patch actually adds toric morphisms defined by polynomials or fan morphisms.\n \n``````\n",
    "created_at": "2011-12-29T18:18:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121291",
    "user": "https://github.com/novoselt"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 Since we have the very nice fan morphism class, we should use it to define toric morphisms of toric varieties.
 
-A big part of the patch is porting the scheme morphisms / hom sets to new-style parents and coercion. Categories should be better, too. Fixes #7946 as a side effect.
+A big part of the patch is porting the scheme morphisms / hom sets to new-style parents and coercion. Categories should be better, too. Fixes #7946 and #6810 as a side effect.
 
 The first two patches bring some sanity to the scheme morphisms. The 3rd patch changes names of methods/classes to something more reasonable and adds documentation. The 4th patch actually adds toric morphisms defined by polynomials or fan morphisms.
 
``````




---

archive/issue_comments_121292.json:
```json
{
    "body": "**Attachment:** [trac_11599_rename_morphisms.patch.gz](https://github.com/sagemath/sage/files/ticket11599/trac_11599_rename_morphisms.patch.gz)\n\nUpdated patch",
    "created_at": "2011-12-29T19:14:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121292",
    "user": "https://github.com/vbraun"
}
```

**Attachment:** [trac_11599_rename_morphisms.patch.gz](https://github.com/sagemath/sage/files/ticket11599/trac_11599_rename_morphisms.patch.gz)

Updated patch



---

archive/issue_comments_121293.json:
```json
{
    "body": "<a id='comment:29'>**Comment 29:**</a>\nAdded some more doctests to bring the whole directory to 95.4% doctest coverage ;-)",
    "created_at": "2011-12-29T19:15:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121293",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:29'>**Comment 29:**</a>
Added some more doctests to bring the whole directory to 95.4% doctest coverage ;-)



---

archive/issue_comments_121294.json:
```json
{
    "body": "<a id='comment:30'>**Comment 30:**</a>\nI am confused by `SchemeHomset_generic.__call__` and its documentation. Why are things passed to `Set_generic.__call__` and documentation should be in `_call_` of derived classes? What exactly should be done by this particular class?\n\nI have also started a reviewer patch on top of all others fixing little issues, it is not in its final form yet.",
    "created_at": "2012-01-12T18:34:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121294",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:30'>**Comment 30:**</a>
I am confused by `SchemeHomset_generic.__call__` and its documentation. Why are things passed to `Set_generic.__call__` and documentation should be in `_call_` of derived classes? What exactly should be done by this particular class?

I have also started a reviewer patch on top of all others fixing little issues, it is not in its final form yet.



---

archive/issue_comments_121295.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -9,4 +9,4 @@\n * [attachment:trac_11599_homset_new_coercion_model.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_homset_new_coercion_model.patch)\n * [attachment:trac_11599_rename_morphisms.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_rename_morphisms.patch)\n * [attachment:trac_11599_toric_morphisms.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_toric_morphisms.patch)\n-\n+* [attachment:trac_11599_reviewer.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_reviewer.patch)\n``````\n",
    "created_at": "2012-01-12T18:35:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121295",
    "user": "https://github.com/novoselt"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -9,4 +9,4 @@
 * [attachment:trac_11599_homset_new_coercion_model.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_homset_new_coercion_model.patch)
 * [attachment:trac_11599_rename_morphisms.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_rename_morphisms.patch)
 * [attachment:trac_11599_toric_morphisms.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_toric_morphisms.patch)
-
+* [attachment:trac_11599_reviewer.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_reviewer.patch)
``````




---

archive/issue_comments_121296.json:
```json
{
    "body": "<a id='comment:32'>**Comment 32:**</a>\nWhat's the point in having `SchemeHomset_points_projective_ring` at all if all it does is implementing two non-implemented methods? Can't we just get rid of it?",
    "created_at": "2012-01-21T01:12:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121296",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:32'>**Comment 32:**</a>
What's the point in having `SchemeHomset_points_projective_ring` at all if all it does is implementing two non-implemented methods? Can't we just get rid of it?



---

archive/issue_comments_121297.json:
```json
{
    "body": "<a id='comment:33'>**Comment 33:**</a>\nPresumably somebody wanted to implement projective spaces over general rings but has not gotten around to doing it yet. I just kept what we have so that future generations know where to plug in the scheme morphism over rings. Also, some elliptic curve stuff derives from it. Again thats not really a good reason for keeping it but it might be useful in the future.",
    "created_at": "2012-01-21T01:50:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121297",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:33'>**Comment 33:**</a>
Presumably somebody wanted to implement projective spaces over general rings but has not gotten around to doing it yet. I just kept what we have so that future generations know where to plug in the scheme morphism over rings. Also, some elliptic curve stuff derives from it. Again thats not really a good reason for keeping it but it might be useful in the future.



---

archive/issue_comments_121298.json:
```json
{
    "body": "<a id='comment:34'>**Comment 34:**</a>\nDone with the huge patch, all looks fine, little tweaks are in the reviewer patch.\n\nMoving on to the remaining ones...",
    "created_at": "2012-01-24T22:20:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121298",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:34'>**Comment 34:**</a>
Done with the huge patch, all looks fine, little tweaks are in the reviewer patch.

Moving on to the remaining ones...



---

archive/issue_comments_121299.json:
```json
{
    "body": "<a id='comment:35'>**Comment 35:**</a>\nThe renaming is great, but do we need `_class` on the end of `_morphism_class`, `_homset_class`,  `_point_class`, `_point_homset_class`??? It seems to me that these functions return actual morphisms and homsets, not classes, so it is confusing (and it was especially confusing when they were undocumented). I propose getting rid of `_class` suffix.\n\nThere is also no consistency in \"a word for homset\": I think I saw \"homset\", \"hom set\", \"hom-set\", \"Hom-set\" and maybe other variants with capitalization-spacing-dashing. It would be nice to settle with a single one. Personally I prefer \"Hom-set\" with close second \"homset\". Or, perhaps, they should be referred to as \"sets of morphisms\".\n\nOtherwise I am fine with the third patch, so only the fun part is left!",
    "created_at": "2012-01-31T05:33:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121299",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:35'>**Comment 35:**</a>
The renaming is great, but do we need `_class` on the end of `_morphism_class`, `_homset_class`,  `_point_class`, `_point_homset_class`??? It seems to me that these functions return actual morphisms and homsets, not classes, so it is confusing (and it was especially confusing when they were undocumented). I propose getting rid of `_class` suffix.

There is also no consistency in "a word for homset": I think I saw "homset", "hom set", "hom-set", "Hom-set" and maybe other variants with capitalization-spacing-dashing. It would be nice to settle with a single one. Personally I prefer "Hom-set" with close second "homset". Or, perhaps, they should be referred to as "sets of morphisms".

Otherwise I am fine with the third patch, so only the fun part is left!



---

archive/issue_comments_121300.json:
```json
{
    "body": "<a id='comment:36'>**Comment 36:**</a>\nFor the last patch:\n\n1. In `schemes.rst` extra trailing spaces are added to one line (which I think was recently prohibited ;-)) and `toric_morphism` is added twice - probably it should be only once?\n2. In `scheme.py` it adds `cached_method`, but it was already imported, so this hunk should not be there.\n3. In `toric_homset.py`: I think that generic description should not be duplicated in the module docstring. On the other hand AUTHOURS, EXAMPLES and license sections should be added.\n4. `__init__` in the beginning does not have a docstring at all. It would be nice also to add some clarifying comment what exactly is achieved by `register_conversion` there (although maybe I am supposed to know that?...)\n5. In the example of `_element_constructor_` can we please not use `Hom` as the name for `dP8.Hom(P2)`? `Hom` is a top-level function and overwriting it is a bit confusing, especially since the example is quite long. How about just `H` instead?\n6. In `_repr_defn` of toric morphism lines like \"Defined by sending the Rational polyhedral fan in 2-d lattice N to Rational polyhedral fan in 1-d lattice N.\" are constructed. \"the\" in front of domain but not codomain is a bit strange and I think we should remove it since fans are capitalized. Or put it in both places, but it makes strings longer ;-)\n7. In `_homset_class` of `toric_variety.py` the old doctest is deleted and it is actually no longer working. Without direct calls to private functions, `H([z0, z1, z0, z3])` is also not working, which bugs me quite a bit. The traceback goes to `NotImplementedError` and includes `Set_generic.__call__` which I have complained a bit in https://github.com/sagemath/sage/issues/11599#comment:30.\n\nThese are all the comments that I have, will upload new reviewer patch shortly.",
    "created_at": "2012-02-09T04:40:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121300",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:36'>**Comment 36:**</a>
For the last patch:

1. In `schemes.rst` extra trailing spaces are added to one line (which I think was recently prohibited ;-)) and `toric_morphism` is added twice - probably it should be only once?
2. In `scheme.py` it adds `cached_method`, but it was already imported, so this hunk should not be there.
3. In `toric_homset.py`: I think that generic description should not be duplicated in the module docstring. On the other hand AUTHOURS, EXAMPLES and license sections should be added.
4. `__init__` in the beginning does not have a docstring at all. It would be nice also to add some clarifying comment what exactly is achieved by `register_conversion` there (although maybe I am supposed to know that?...)
5. In the example of `_element_constructor_` can we please not use `Hom` as the name for `dP8.Hom(P2)`? `Hom` is a top-level function and overwriting it is a bit confusing, especially since the example is quite long. How about just `H` instead?
6. In `_repr_defn` of toric morphism lines like "Defined by sending the Rational polyhedral fan in 2-d lattice N to Rational polyhedral fan in 1-d lattice N." are constructed. "the" in front of domain but not codomain is a bit strange and I think we should remove it since fans are capitalized. Or put it in both places, but it makes strings longer ;-)
7. In `_homset_class` of `toric_variety.py` the old doctest is deleted and it is actually no longer working. Without direct calls to private functions, `H([z0, z1, z0, z3])` is also not working, which bugs me quite a bit. The traceback goes to `NotImplementedError` and includes `Set_generic.__call__` which I have complained a bit in https://github.com/sagemath/sage/issues/11599#comment:30.

These are all the comments that I have, will upload new reviewer patch shortly.



---

archive/issue_events_130939.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2012-02-09T04:40:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11599#event-130939"
}
```



---

archive/issue_events_130940.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2012-02-09T04:40:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11599#event-130940"
}
```



---

archive/issue_comments_121301.json:
```json
{
    "body": "**Attachment:** [trac_11599_reviewer.patch.gz](https://github.com/sagemath/sage/files/ticket11599/trac_11599_reviewer.patch.gz)\n\n**Attachment:** [trac_11599_remove_class_suffix.patch.gz](https://github.com/sagemath/sage/files/ticket11599/trac_11599_remove_class_suffix.patch.gz)\n\nInitial patch",
    "created_at": "2012-02-19T22:47:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121301",
    "user": "https://github.com/vbraun"
}
```

**Attachment:** [trac_11599_reviewer.patch.gz](https://github.com/sagemath/sage/files/ticket11599/trac_11599_reviewer.patch.gz)

**Attachment:** [trac_11599_remove_class_suffix.patch.gz](https://github.com/sagemath/sage/files/ticket11599/trac_11599_remove_class_suffix.patch.gz)

Initial patch



---

archive/issue_comments_121302.json:
```json
{
    "body": "**Attachment:** [trac_11599_remaining_fixes.patch.gz](https://github.com/sagemath/sage/files/ticket11599/trac_11599_remaining_fixes.patch.gz)\n\nInitial patch",
    "created_at": "2012-02-19T22:47:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121302",
    "user": "https://github.com/vbraun"
}
```

**Attachment:** [trac_11599_remaining_fixes.patch.gz](https://github.com/sagemath/sage/files/ticket11599/trac_11599_remaining_fixes.patch.gz)

Initial patch



---

archive/issue_events_130941.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2012-02-19T22:49:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11599#event-130941"
}
```



---

archive/issue_events_130942.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2012-02-19T22:49:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11599#event-130942"
}
```



---

archive/issue_comments_121303.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -10,3 +10,5 @@\n * [attachment:trac_11599_rename_morphisms.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_rename_morphisms.patch)\n * [attachment:trac_11599_toric_morphisms.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_toric_morphisms.patch)\n * [attachment:trac_11599_reviewer.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_reviewer.patch)\n+* [attachment:trac_11599_remove_class_suffix.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_remove_class_suffix.patch)\n+* [attachment:trac_11599_remaining_fixes.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_remaining_fixes.patch)\n``````\n",
    "created_at": "2012-02-19T22:49:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121303",
    "user": "https://github.com/vbraun"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -10,3 +10,5 @@
 * [attachment:trac_11599_rename_morphisms.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_rename_morphisms.patch)
 * [attachment:trac_11599_toric_morphisms.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_toric_morphisms.patch)
 * [attachment:trac_11599_reviewer.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_reviewer.patch)
+* [attachment:trac_11599_remove_class_suffix.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_remove_class_suffix.patch)
+* [attachment:trac_11599_remaining_fixes.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_remaining_fixes.patch)
``````




---

archive/issue_comments_121304.json:
```json
{
    "body": "<a id='comment:37'>**Comment 37:**</a>\nI renamed the method names to remove the `_class` suffix, this is the first new patch.\n\nThe final patch should deal with all of your remaining suggestions.",
    "created_at": "2012-02-19T22:49:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121304",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:37'>**Comment 37:**</a>
I renamed the method names to remove the `_class` suffix, this is the first new patch.

The final patch should deal with all of your remaining suggestions.



---

archive/issue_comments_121305.json:
```json
{
    "body": "<a id='comment:38'>**Comment 38:**</a>\nThank you!\n\nWhat is the purpose of `fan` in `algebraic_scheme.py` in the very last patch? I think it is confusing to return for a subscheme the fan of the ambient space, especially if the subscheme happens to be a toric variety itself and then can potentially have its own associated fan of a smaller dimension.",
    "created_at": "2012-02-19T23:23:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121305",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:38'>**Comment 38:**</a>
Thank you!

What is the purpose of `fan` in `algebraic_scheme.py` in the very last patch? I think it is confusing to return for a subscheme the fan of the ambient space, especially if the subscheme happens to be a toric variety itself and then can potentially have its own associated fan of a smaller dimension.



---

archive/issue_comments_121306.json:
```json
{
    "body": "<a id='comment:39'>**Comment 39:**</a>\nIf you want to construct a toric morphism from an algebraic scheme then the algebraic scheme needs to have a `fan()` method. Of course one could change he toric morphism to work around that, but after some thinking I thought it is best to do it. A toric subscheme is in general not a toric variety, so there shouldn't be any confusion.",
    "created_at": "2012-02-19T23:27:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121306",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:39'>**Comment 39:**</a>
If you want to construct a toric morphism from an algebraic scheme then the algebraic scheme needs to have a `fan()` method. Of course one could change he toric morphism to work around that, but after some thinking I thought it is best to do it. A toric subscheme is in general not a toric variety, so there shouldn't be any confusion.



---

archive/issue_comments_121307.json:
```json
{
    "body": "<a id='comment:40'>**Comment 40:**</a>\nWell, looks good, hopefully it will make its way into Sage-5.0!",
    "created_at": "2012-02-20T00:14:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121307",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:40'>**Comment 40:**</a>
Well, looks good, hopefully it will make its way into Sage-5.0!



---

archive/issue_events_130943.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2012-02-20T00:14:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11599#event-130943"
}
```



---

archive/issue_events_130944.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2012-02-20T00:14:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11599#event-130944"
}
```



---

archive/issue_comments_121308.json:
```json
{
    "body": "<a id='comment:41'>**Comment 41:**</a>\nThere is numerical noise on various systems (including ia64 and OSX 10.4 PPC):\n\n```\n**********************************************************************\nFile \"/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-5.0.beta6/devel/sage-main/sage/schemes/generic/morphism.py\", line 1292:\n    sage: P(2+I, 3-I, 4+5*I)\nExpected:\n    (0.317073170732 - 0.146341463415*I : 0.170731707317 - 0.463414634146*I : 1.0)\nGot:\n    (0.317073170732 - 0.146341463415*I : 0.170731707317 - 0.463414634146*I : 1.0 - 1.73387706291e-17*I)\n**********************************************************************\n```",
    "created_at": "2012-02-26T22:11:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121308",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:41'>**Comment 41:**</a>
There is numerical noise on various systems (including ia64 and OSX 10.4 PPC):

```
**********************************************************************
File "/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-5.0.beta6/devel/sage-main/sage/schemes/generic/morphism.py", line 1292:
    sage: P(2+I, 3-I, 4+5*I)
Expected:
    (0.317073170732 - 0.146341463415*I : 0.170731707317 - 0.463414634146*I : 1.0)
Got:
    (0.317073170732 - 0.146341463415*I : 0.170731707317 - 0.463414634146*I : 1.0 - 1.73387706291e-17*I)
**********************************************************************
```



---

archive/issue_events_130945.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-02-26T22:11:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11599#event-130945"
}
```



---

archive/issue_events_130946.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-02-26T22:11:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11599#event-130946"
}
```



---

archive/issue_comments_121309.json:
```json
{
    "body": "<a id='comment:42'>**Comment 42:**</a>\nSo - what would be the correct way to deal with such noise?..",
    "created_at": "2012-03-06T17:05:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121309",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:42'>**Comment 42:**</a>
So - what would be the correct way to deal with such noise?..



---

archive/issue_comments_121310.json:
```json
{
    "body": "Initial patch",
    "created_at": "2012-03-06T18:26:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121310",
    "user": "https://github.com/vbraun"
}
```

Initial patch



---

archive/issue_events_130947.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2012-03-06T18:28:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11599#event-130947"
}
```



---

archive/issue_events_130948.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2012-03-06T18:28:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11599#event-130948"
}
```



---

archive/issue_comments_121311.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -12,3 +12,4 @@\n * [attachment:trac_11599_reviewer.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_reviewer.patch)\n * [attachment:trac_11599_remove_class_suffix.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_remove_class_suffix.patch)\n * [attachment:trac_11599_remaining_fixes.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_remaining_fixes.patch)\n+* [attachment:trac_11599_numerical_noise.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_numerical_noise.patch)\n``````\n",
    "created_at": "2012-03-06T18:28:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121311",
    "user": "https://github.com/vbraun"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -12,3 +12,4 @@
 * [attachment:trac_11599_reviewer.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_reviewer.patch)
 * [attachment:trac_11599_remove_class_suffix.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_remove_class_suffix.patch)
 * [attachment:trac_11599_remaining_fixes.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_remaining_fixes.patch)
+* [attachment:trac_11599_numerical_noise.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_numerical_noise.patch)
``````




---

archive/issue_comments_121312.json:
```json
{
    "body": "<a id='comment:43'>**Comment 43:**</a>\n**Attachment:** [trac_11599_numerical_noise.patch.gz](https://github.com/sagemath/sage/files/ticket11599/trac_11599_numerical_noise.patch.gz)\n\nI propose to just set the homogeneous variable to 1 instead of dividing by itself...",
    "created_at": "2012-03-06T18:28:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121312",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:43'>**Comment 43:**</a>
**Attachment:** [trac_11599_numerical_noise.patch.gz](https://github.com/sagemath/sage/files/ticket11599/trac_11599_numerical_noise.patch.gz)

I propose to just set the homogeneous variable to 1 instead of dividing by itself...



---

archive/issue_events_130949.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2012-03-06T19:16:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11599#event-130949"
}
```



---

archive/issue_events_130950.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2012-03-06T19:16:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11599#event-130950"
}
```



---

archive/issue_comments_121313.json:
```json
{
    "body": "<a id='comment:44'>**Comment 44:**</a>\nSeems reasonable to me and passes all tests on Sage-5.0.beta7 (although I cannot test on those platforms).",
    "created_at": "2012-03-06T19:16:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121313",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:44'>**Comment 44:**</a>
Seems reasonable to me and passes all tests on Sage-5.0.beta7 (although I cannot test on those platforms).



---

archive/issue_comments_121314.json:
```json
{
    "body": "<a id='comment:45'>**Comment 45:**</a>\nFor your information:\nthis patch conflicts with #715 (in the sense that a doctest from #715 fails with this patch applied).",
    "created_at": "2012-03-10T09:34:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121314",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:45'>**Comment 45:**</a>
For your information:
this patch conflicts with #715 (in the sense that a doctest from #715 fails with this patch applied).



---

archive/issue_comments_121315.json:
```json
{
    "body": "<a id='comment:46'>**Comment 46:**</a>\nApply trac_11599_no_circular_imports.patch, trac_11599_homset_new_coercion_model.patch, trac_11599_rename_morphisms.patch, trac_11599_toric_morphisms.patch, trac_11599_reviewer.patch, trac_11599_remove_class_suffix.patch, trac_11599_remaining_fixes.patch, trac_11599_numerical_noise.patch\n\n(for the patchbot, which is failing #12544 because it tries to apply the patches here in the wrong order)",
    "created_at": "2012-03-12T10:19:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121315",
    "user": "https://github.com/loefflerd"
}
```

<a id='comment:46'>**Comment 46:**</a>
Apply trac_11599_no_circular_imports.patch, trac_11599_homset_new_coercion_model.patch, trac_11599_rename_morphisms.patch, trac_11599_toric_morphisms.patch, trac_11599_reviewer.patch, trac_11599_remove_class_suffix.patch, trac_11599_remaining_fixes.patch, trac_11599_numerical_noise.patch

(for the patchbot, which is failing #12544 because it tries to apply the patches here in the wrong order)



---

archive/issue_comments_121316.json:
```json
{
    "body": "**Merged:** sage-5.0.beta9",
    "created_at": "2012-03-21T22:04:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121316",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.0.beta9



---

archive/issue_events_130951.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-21T22:04:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11599#event-130951"
}
```



---

archive/issue_events_130952.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-21T22:04:39Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11599#event-130952"
}
```



---

archive/issue_comments_121317.json:
```json
{
    "body": "<a id='comment:48'>**Comment 48:**</a>\nHi there,\n\nIt's cool to see thinks moving forward and the doc getting better. However\ncommunication between developers could be better too. In this ticket, there is\na big chunk fixing the doc of `sage/structure/factory.pyx`. In my ticket,\nimproving `classcall` and `UniqueRepresentation`, I also discovered\nthat `sage/structure/factory.pyx` wasn't in the doc and that its doc was\nbroken. I didn't find any ticket that seems to fix it so I decided to go ahead\nand spend on hour improving it... For nothing except creating a conflict.\n\nNext time, please make such unrelated doctest improvements in a separate\nticket, and advertise them on trac!\n\nThanks,\n\nGrumpy Florent",
    "created_at": "2012-04-10T10:00:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121317",
    "user": "https://github.com/hivert"
}
```

<a id='comment:48'>**Comment 48:**</a>
Hi there,

It's cool to see thinks moving forward and the doc getting better. However
communication between developers could be better too. In this ticket, there is
a big chunk fixing the doc of `sage/structure/factory.pyx`. In my ticket,
improving `classcall` and `UniqueRepresentation`, I also discovered
that `sage/structure/factory.pyx` wasn't in the doc and that its doc was
broken. I didn't find any ticket that seems to fix it so I decided to go ahead
and spend on hour improving it... For nothing except creating a conflict.

Next time, please make such unrelated doctest improvements in a separate
ticket, and advertise them on trac!

Thanks,

Grumpy Florent



---

archive/issue_comments_121318.json:
```json
{
    "body": "<a id='comment:49'>**Comment 49:**</a>\nThe patches here cause a serious slow-down in parts of the elliptic curve code, see #12853.",
    "created_at": "2012-04-18T12:00:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121318",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:49'>**Comment 49:**</a>
The patches here cause a serious slow-down in parts of the elliptic curve code, see #12853.



---

archive/issue_comments_121319.json:
```json
{
    "body": "<a id='comment:50'>**Comment 50:**</a>\nMore precisely, the patch [attachment:trac_11599_homset_new_coercion_model.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_homset_new_coercion_model.patch) causes the slow-down.",
    "created_at": "2012-04-18T12:05:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121319",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:50'>**Comment 50:**</a>
More precisely, the patch [attachment:trac_11599_homset_new_coercion_model.patch](https://github.com/sagemath/sage/files/ticket11599/trac_11599_homset_new_coercion_model.patch) causes the slow-down.



---

archive/issue_comments_121320.json:
```json
{
    "body": "<a id='comment:51'>**Comment 51:**</a>\nIn trac_11599_homset_new_coercion_model.patch a comment is added in line 529 (now line 531) of sage/schemes/elliptic_curve/ell_curve_isogeny, which now reads\n\n```\n        sage: phi == loads(dumps(phi))   # optional - pickling https://github.com/sagemath/sage/issues/11599\n```\nand now fails if testing is done with the --optional flag.  Should \"optional\" be changed to \"not tested\" here until it is fixed?",
    "created_at": "2012-09-14T11:46:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121320",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:51'>**Comment 51:**</a>
In trac_11599_homset_new_coercion_model.patch a comment is added in line 529 (now line 531) of sage/schemes/elliptic_curve/ell_curve_isogeny, which now reads

```
        sage: phi == loads(dumps(phi))   # optional - pickling https://github.com/sagemath/sage/issues/11599
```
and now fails if testing is done with the --optional flag.  Should "optional" be changed to "not tested" here until it is fixed?



---

archive/issue_comments_121321.json:
```json
{
    "body": "<a id='comment:52'>**Comment 52:**</a>\nPS Same on line 158 of ell_torsion.py.  As I understand it the tag #optional should be acompanied by the name of an optional spkg.",
    "created_at": "2012-09-14T11:53:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121321",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:52'>**Comment 52:**</a>
PS Same on line 158 of ell_torsion.py.  As I understand it the tag #optional should be acompanied by the name of an optional spkg.



---

archive/issue_comments_121322.json:
```json
{
    "body": "<a id='comment:53'>**Comment 53:**</a>\nReplying to [@JohnCremona](#comment%3A51):\n> Should \"optional\" be changed to \"not tested\" here until it is fixed?\n\nEven better: \"known bug\", see #14362.",
    "created_at": "2013-03-27T00:44:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11599#issuecomment-121322",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:53'>**Comment 53:**</a>
Replying to [@JohnCremona](#comment%3A51):
> Should "optional" be changed to "not tested" here until it is fixed?

Even better: "known bug", see #14362.
