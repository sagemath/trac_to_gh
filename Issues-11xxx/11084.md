# Issue 11084: Singular 3-1-1-4.p6 fails to build with gcc 4.6.0.

archive/issues_010960.json:
```json
{
    "body": "After trying to build Sage with gcc 4.6.0 on OpenSolaris, I find it fails when building Singular, despite Singular (and all of Sage) builds with gcc-4.5.0.  The same issue occurs on various other systems.\n\n```\nIn file included from ../kernel/ring.h:13:0,\n                 from ../kernel/ideals.h:11,\n                 from ipshell.h:12,\n                 from tesths.cc:20:\n../kernel/polys-impl.h:177:0: warning: \"pPolyAssumeReturn\" redefined [enabled by default]\n../kernel/polys-impl.h:176:0: note: this is the location of the previous definition\nmpsr_Tok.cc: In function 'void mpsr_ttGen()':\nmpsr_Tok.cc:551:29: warning: deprecated conversion from string constant to 'char*' [-Wwrite-strings]\nUndefined\t\t\tfirst referenced\n symbol  \t\t\t    in file\nuniFactorizer(CanonicalForm const&, Variable const&, bool const&) /export/home/drkirkby/sage-new-gcc/sage-4.7.alpha2/local/lib/libsingcf.a(facFqFactorize.o)\nld: fatal: symbol referencing errors. No output written to gentable1\ncollect2: ld returned 1 exit status\nmake[4]: *** [iparith.inc] Error 1\nUndefined\t\t\tfirst referenced\n symbol  \t\t\t    in file\nuniFactorizer(CanonicalForm const&, Variable const&, bool const&) /export/home/drkirkby/sage-new-gcc/sage-4.7.alpha2/local/lib/libsingcf.a(facFqFactorize.o)\nld: fatal: symbol referencing errors. No output written to gentable2\ncollect2: ld returned 1 exit status\nmake[4]: *** [mpsr_Tok.inc] Error 1\nmake[4]: Target `install' not remade because of errors.\nmake[4]: Leaving directory `/export/home/drkirkby/sage-new-gcc/sage-4.7.alpha2/spkg/build/singular-3-1-1-4.p4/src/Singular'\nmake[3]: *** [install] Error 1\nmake[3]: Leaving directory `/export/home/drkirkby/sage-new-gcc/sage-4.7.alpha2/spkg/build/singular-3-1-1-4.p4/src'\nmake[2]: *** [/export/home/drkirkby/sage-new-gcc/sage-4.7.alpha2/local/bin/Singular-3-1-1] Error 2\nmake[2]: Leaving directory `/export/home/drkirkby/sage-new-gcc/sage-4.7.alpha2/spkg/build/singular-3-1-1-4.p4/src'\nUnable to build Singular.\n\nreal\t3m22.783s\nuser\t6m14.242s\nsys\t0m22.671s\nsage: An error occurred while installing singular-3-1-1-4.p4\n```\n\nA full log is attached. \n\nA revised package, which reduces the optimisation level, which at least allows this to build on OpenSolaris may be found at \n\nNew spkg, based on #9497: [http://boxen.math.washington.edu/home/jdemeyer/spkg/singular-3-1-1-4.p8.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/singular-3-1-1-4.p8.spkg)\n\nThis needs further testing on other platforms. \n\nOther problems related to gcc 4.6.0 can be found on #11216\n\nAssignee: GeorgSWeber\n\nResolution: fixed\n\nAuthor: David Kirkby, Jeroen Demeyer\n\nReviewer: Alexander Dreyer, Jeroen Demeyer\n\nUpstream: None of the above - read trac for reasoning.\n\nMerged: sage-4.7.rc0\n\nIssue created by migration from https://trac.sagemath.org/ticket/11084\n\n",
    "closed_at": "2011-04-20T19:56:44Z",
    "created_at": "2011-03-29T22:40:00Z",
    "labels": [
        "component: build",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7",
    "title": "Singular 3-1-1-4.p6 fails to build with gcc 4.6.0.",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11084",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```
After trying to build Sage with gcc 4.6.0 on OpenSolaris, I find it fails when building Singular, despite Singular (and all of Sage) builds with gcc-4.5.0.  The same issue occurs on various other systems.

```
In file included from ../kernel/ring.h:13:0,
                 from ../kernel/ideals.h:11,
                 from ipshell.h:12,
                 from tesths.cc:20:
../kernel/polys-impl.h:177:0: warning: "pPolyAssumeReturn" redefined [enabled by default]
../kernel/polys-impl.h:176:0: note: this is the location of the previous definition
mpsr_Tok.cc: In function 'void mpsr_ttGen()':
mpsr_Tok.cc:551:29: warning: deprecated conversion from string constant to 'char*' [-Wwrite-strings]
Undefined			first referenced
 symbol  			    in file
uniFactorizer(CanonicalForm const&, Variable const&, bool const&) /export/home/drkirkby/sage-new-gcc/sage-4.7.alpha2/local/lib/libsingcf.a(facFqFactorize.o)
ld: fatal: symbol referencing errors. No output written to gentable1
collect2: ld returned 1 exit status
make[4]: *** [iparith.inc] Error 1
Undefined			first referenced
 symbol  			    in file
uniFactorizer(CanonicalForm const&, Variable const&, bool const&) /export/home/drkirkby/sage-new-gcc/sage-4.7.alpha2/local/lib/libsingcf.a(facFqFactorize.o)
ld: fatal: symbol referencing errors. No output written to gentable2
collect2: ld returned 1 exit status
make[4]: *** [mpsr_Tok.inc] Error 1
make[4]: Target `install' not remade because of errors.
make[4]: Leaving directory `/export/home/drkirkby/sage-new-gcc/sage-4.7.alpha2/spkg/build/singular-3-1-1-4.p4/src/Singular'
make[3]: *** [install] Error 1
make[3]: Leaving directory `/export/home/drkirkby/sage-new-gcc/sage-4.7.alpha2/spkg/build/singular-3-1-1-4.p4/src'
make[2]: *** [/export/home/drkirkby/sage-new-gcc/sage-4.7.alpha2/local/bin/Singular-3-1-1] Error 2
make[2]: Leaving directory `/export/home/drkirkby/sage-new-gcc/sage-4.7.alpha2/spkg/build/singular-3-1-1-4.p4/src'
Unable to build Singular.

real	3m22.783s
user	6m14.242s
sys	0m22.671s
sage: An error occurred while installing singular-3-1-1-4.p4
```

A full log is attached. 

A revised package, which reduces the optimisation level, which at least allows this to build on OpenSolaris may be found at 

New spkg, based on #9497: [http://boxen.math.washington.edu/home/jdemeyer/spkg/singular-3-1-1-4.p8.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/singular-3-1-1-4.p8.spkg)

This needs further testing on other platforms. 

Other problems related to gcc 4.6.0 can be found on #11216

Assignee: GeorgSWeber

Resolution: fixed

Author: David Kirkby, Jeroen Demeyer

Reviewer: Alexander Dreyer, Jeroen Demeyer

Upstream: None of the above - read trac for reasoning.

Merged: sage-4.7.rc0

Issue created by migration from https://trac.sagemath.org/ticket/11084





---

archive/issue_comments_118266.json:
```json
{
    "body": "Attachment [singular-3-1-1-4.p4.log](tarball://root/attachments/some-uuid/ticket11084/singular-3-1-1-4.p4.log) by drkirkby created at 2011-03-29 22:41:49\n\nFailed build of Singular 3-1-1-4.p4 as part of Sage 4.7.alpha2 on a Sun Ultra 27 running OpenSolaris 06/2009",
    "created_at": "2011-03-29T22:41:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118266",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Attachment [singular-3-1-1-4.p4.log](tarball://root/attachments/some-uuid/ticket11084/singular-3-1-1-4.p4.log) by drkirkby created at 2011-03-29 22:41:49

Failed build of Singular 3-1-1-4.p4 as part of Sage 4.7.alpha2 on a Sun Ultra 27 running OpenSolaris 06/2009



---

archive/issue_comments_118267.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2011-03-29T22:43:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118267",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_118268.json:
```json
{
    "body": "Changing component from build to solaris.",
    "created_at": "2011-03-29T22:43:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118268",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Changing component from build to solaris.



---

archive/issue_comments_118269.json:
```json
{
    "body": "<a id='comment:1'></a>I've set the component to \"solaris\" as that is the only confirmed system on which this fails to build. Can someone change the component to \"build\" if this fails on Linux or OS X. \n\nDave",
    "created_at": "2011-03-29T22:43:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118269",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:1'></a>I've set the component to "solaris" as that is the only confirmed system on which this fails to build. Can someone change the component to "build" if this fails on Linux or OS X. 

Dave



---

archive/issue_comments_118270.json:
```json
{
    "body": "Changing assignee from GeorgSWeber to drkirkby.",
    "created_at": "2011-03-29T22:43:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118270",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Changing assignee from GeorgSWeber to drkirkby.



---

archive/issue_comments_118271.json:
```json
{
    "body": "Changing component from solaris to build.",
    "created_at": "2011-03-30T02:46:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118271",
    "user": "https://github.com/vbraun"
}
```

Changing component from solaris to build.



---

archive/issue_comments_118272.json:
```json
{
    "body": "Changing assignee from drkirkby to GeorgSWeber.",
    "created_at": "2011-03-30T02:46:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118272",
    "user": "https://github.com/vbraun"
}
```

Changing assignee from drkirkby to GeorgSWeber.



---

archive/issue_comments_118273.json:
```json
{
    "body": "<a id='comment:2'></a>Also fails on Fedora 15 alpha which uses gcc-4.6",
    "created_at": "2011-03-30T02:46:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118273",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:2'></a>Also fails on Fedora 15 alpha which uses gcc-4.6



---

archive/issue_comments_118274.json:
```json
{
    "body": "<a id='comment:3'></a>I just posted this to the `libsingular-devel` list:\n\nhttp://groups.google.com/group/libsingular-devel/browse_thread/thread/508c352214392315",
    "created_at": "2011-03-31T14:22:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118274",
    "user": "https://github.com/burcin"
}
```

<a id='comment:3'></a>I just posted this to the `libsingular-devel` list:

http://groups.google.com/group/libsingular-devel/browse_thread/thread/508c352214392315



---

archive/issue_comments_118275.json:
```json
{
    "body": "<a id='comment:4'></a>Maybe a demangling issue?\nSee my comment here:\nhttp://groups.google.com/group/libsingular-devel/browse_thread/thread/508c352214392315?hl=en\nMy best,\n  Alexander",
    "created_at": "2011-03-31T15:35:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118275",
    "user": "https://github.com/alexanderdreyer"
}
```

<a id='comment:4'></a>Maybe a demangling issue?
See my comment here:
http://groups.google.com/group/libsingular-devel/browse_thread/thread/508c352214392315?hl=en
My best,
  Alexander



---

archive/issue_comments_118276.json:
```json
{
    "body": "<a id='comment:5'></a>On a related note, our goal should probably be to update Singular to the newest upstream. IIRC I was able to build the latest upstream with gcc-4.6, but only the standalone singular. I was unable to build libsingular, though.",
    "created_at": "2011-03-31T16:02:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118276",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:5'></a>On a related note, our goal should probably be to update Singular to the newest upstream. IIRC I was able to build the latest upstream with gcc-4.6, but only the standalone singular. I was unable to build libsingular, though.



---

archive/issue_comments_118277.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:5 vbraun]:\n> On a related note, our goal should probably be to update Singular to the newest upstream. IIRC I was able to build the latest upstream with gcc-4.6, but only the standalone singular. I was unable to build libsingular, though.\n\n\nWe should really try to get this solved before the 24<sup>th</sup> May 2011, since Fedora 15 is released then, and Sage will fail to build on a fairly popular linux distribution. \n\nhttp://fedoraproject.org/wiki/Releases/15/Schedule",
    "created_at": "2011-04-07T20:30:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118277",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:6'></a>Replying to [comment:5 vbraun]:
> On a related note, our goal should probably be to update Singular to the newest upstream. IIRC I was able to build the latest upstream with gcc-4.6, but only the standalone singular. I was unable to build libsingular, though.


We should really try to get this solved before the 24<sup>th</sup> May 2011, since Fedora 15 is released then, and Sage will fail to build on a fairly popular linux distribution. 

http://fedoraproject.org/wiki/Releases/15/Schedule



---

archive/issue_comments_118278.json:
```json
{
    "body": "<a id='comment:7'></a>I reported that upstream:\nhttp://www.singular.uni-kl.de:8002/trac/ticket/332",
    "created_at": "2011-04-07T20:59:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118278",
    "user": "https://github.com/alexanderdreyer"
}
```

<a id='comment:7'></a>I reported that upstream:
http://www.singular.uni-kl.de:8002/trac/ticket/332



---

archive/issue_comments_118279.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2011-04-07T22:03:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118279",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Changing priority from major to critical.



---

archive/issue_comments_118280.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:7 AlexanderDreyer]:\n> I reported that upstream:\n> http://www.singular.uni-kl.de:8002/trac/ticket/332\n\nThank you. \n\nBurcin has already reported it on the mailing list, but there has been no response from any developers. Having it submitted to the bug database, as you have done, can only be a good thing. \n\nI've updated this to 'critical' as I think it's a pretty important bug to solve. Not that the priories seem to mean very much - e.g. #9739 has been opened for 8 months and has been a blocker for 5 months. \n\nDave",
    "created_at": "2011-04-07T22:03:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118280",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:8'></a>Replying to [comment:7 AlexanderDreyer]:
> I reported that upstream:
> http://www.singular.uni-kl.de:8002/trac/ticket/332

Thank you. 

Burcin has already reported it on the mailing list, but there has been no response from any developers. Having it submitted to the bug database, as you have done, can only be a good thing. 

I've updated this to 'critical' as I think it's a pretty important bug to solve. Not that the priories seem to mean very much - e.g. #9739 has been opened for 8 months and has been a blocker for 5 months. 

Dave



---

archive/issue_comments_118281.json:
```json
{
    "body": "<a id='comment:9'></a>I've reported on the singular list that the latest version still fails with gcc 4.6.0. I later tried to post this:\n\n---\nWith gcc 4.5.0 the same version builds ok on the same computer, so it does appear to be an issue with gcc 4.6.0.\n\nI would suggest it would be worth trying to build this with Sun Studio (which is a free download)\n\n http://www.oracle.com/technetwork/server-storage/solarisstudio/downloads/index.html\n\non a Linux system. The Sun (Oracle) compiler is much stricter than the GNU compilers, so will show up problems that current versions of GCC may not. It goes without saying this will not build with Sun Studio. (I tried this on a Solaris system, but you should get the same on a Linux machine).\n\nDave\n\n---\n\nbut it was rejected as it was thought to be spam. I guess it contains a link, but I don't think it's too much like spam. \n\nDave",
    "created_at": "2011-04-08T20:47:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118281",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:9'></a>I've reported on the singular list that the latest version still fails with gcc 4.6.0. I later tried to post this:

---
With gcc 4.5.0 the same version builds ok on the same computer, so it does appear to be an issue with gcc 4.6.0.

I would suggest it would be worth trying to build this with Sun Studio (which is a free download)

 http://www.oracle.com/technetwork/server-storage/solarisstudio/downloads/index.html

on a Linux system. The Sun (Oracle) compiler is much stricter than the GNU compilers, so will show up problems that current versions of GCC may not. It goes without saying this will not build with Sun Studio. (I tried this on a Solaris system, but you should get the same on a Linux machine).

Dave

---

but it was rejected as it was thought to be spam. I guess it contains a link, but I don't think it's too much like spam. 

Dave



---

archive/issue_comments_118282.json:
```json
{
    "body": "<a id='comment:10'></a>In principle not a bad idea, but due to some implementation tricks making Singular to compile von Solaris studio would be a full port.\n\nAs I pointed out on libSingular-devel, there is a demangling issue for some C++ function names on gcc 4.6. (Maybe tied to optimization options.)",
    "created_at": "2011-04-08T21:17:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118282",
    "user": "https://github.com/alexanderdreyer"
}
```

<a id='comment:10'></a>In principle not a bad idea, but due to some implementation tricks making Singular to compile von Solaris studio would be a full port.

As I pointed out on libSingular-devel, there is a demangling issue for some C++ function names on gcc 4.6. (Maybe tied to optimization options.)



---

archive/issue_comments_118283.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [comment:10 AlexanderDreyer]:\n> In principle not a bad idea, but due to some implementation tricks making Singular to compile von Solaris studio would be a full port.\n\n\nIt suspect it would only need to be converted to standard C and/and C++. \n\n> As I pointed out on libSingular-devel, there is a demangling issue for some C++ function names on gcc 4.6. (Maybe tied to optimization options.)",
    "created_at": "2011-04-08T21:45:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118283",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:11'></a>Replying to [comment:10 AlexanderDreyer]:
> In principle not a bad idea, but due to some implementation tricks making Singular to compile von Solaris studio would be a full port.


It suspect it would only need to be converted to standard C and/and C++. 

> As I pointed out on libSingular-devel, there is a demangling issue for some C++ function names on gcc 4.6. (Maybe tied to optimization options.)



---

archive/issue_comments_118284.json:
```json
{
    "body": "<a id='comment:12'></a>> It suspect it would only need to be converted to standard C and/and C++. \n\nIndeed, but this is ot done overnight.\n\nAnd: it won't fix this bug here. The lines of source code, that cause trouble are standard, this problem seems to accur during the compiler's optimization.",
    "created_at": "2011-04-08T22:05:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118284",
    "user": "https://github.com/alexanderdreyer"
}
```

<a id='comment:12'></a>> It suspect it would only need to be converted to standard C and/and C++. 

Indeed, but this is ot done overnight.

And: it won't fix this bug here. The lines of source code, that cause trouble are standard, this problem seems to accur during the compiler's optimization.



---

archive/issue_comments_118285.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:12 AlexanderDreyer]:\n> > It suspect it would only need to be converted to standard C and/and C++. \n\n> Indeed, but this is ot done overnight.\n\nTrue. \n\n> And: it won't fix this bug here. The lines of source code, that cause trouble are standard, this problem seems to accur during the compiler's optimization.\n\n\nIIRC, Singular uses -O3, which is a bit risky. Perhaps the optimiation level can be dropped to -O2, which is much safer. If I'm mistaken, and it is -O2, then I don't have any suggestions.",
    "created_at": "2011-04-08T22:36:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118285",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:13'></a>Replying to [comment:12 AlexanderDreyer]:
> > It suspect it would only need to be converted to standard C and/and C++. 

> Indeed, but this is ot done overnight.

True. 

> And: it won't fix this bug here. The lines of source code, that cause trouble are standard, this problem seems to accur during the compiler's optimization.


IIRC, Singular uses -O3, which is a bit risky. Perhaps the optimiation level can be dropped to -O2, which is much safer. If I'm mistaken, and it is -O2, then I don't have any suggestions.



---

archive/issue_comments_118286.json:
```json
{
    "body": "<a id='comment:14'></a>I've removed the \"*on OpenSolaris*\" from the title, as this is not specific to that platform, so the ticket title should reflect this.",
    "created_at": "2011-04-08T22:40:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118286",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:14'></a>I've removed the "*on OpenSolaris*" from the title, as this is not specific to that platform, so the ticket title should reflect this.



---

archive/issue_comments_118287.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2011-04-09T09:44:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118287",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_118288.json:
```json
{
    "body": "<a id='comment:15'></a>Replying to [comment:13 drkirkby]:\n\n> IIRC, Singular uses -O3, which is a bit risky. Perhaps the optimiation level can be dropped to -O2, which is much safer.\n\n\nReduced optimisation probably solves the problem. Changing to -O2 allows Singular to build with gcc 4.6.0 on at least OpenSolaris, but I have not yet verified if the doctests pass. I will start a fresh build of Sage, then run all the long doctests. \n\nIf one looks in spkg-install, one find that compiling at -O3 has caused problems in the past, so on one platform -O0 is used. \n\nSo I suspect this is solved. I've placed a package at \n\nhttp://boxen.math.washington.edu/home/kirkby/patches/singular-3-1-1-4.p5.spkg\n\nWe will need to verify if this builds and passes the tests properly on Linux, OS X, Solaris 10 (both x86 and SPARC) with gcc 4.6.0 before I will mark this for review. For now I'm setting to \"needs info\"\n\nDave \n\nPS.\n\nI reported about an hour ago to the Singular developers that I believe they are using reserved words in Singular too (http://www.singular.uni-kl.de:8002/trac/ticket/333).",
    "created_at": "2011-04-09T09:44:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118288",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:15'></a>Replying to [comment:13 drkirkby]:

> IIRC, Singular uses -O3, which is a bit risky. Perhaps the optimiation level can be dropped to -O2, which is much safer.


Reduced optimisation probably solves the problem. Changing to -O2 allows Singular to build with gcc 4.6.0 on at least OpenSolaris, but I have not yet verified if the doctests pass. I will start a fresh build of Sage, then run all the long doctests. 

If one looks in spkg-install, one find that compiling at -O3 has caused problems in the past, so on one platform -O0 is used. 

So I suspect this is solved. I've placed a package at 

http://boxen.math.washington.edu/home/kirkby/patches/singular-3-1-1-4.p5.spkg

We will need to verify if this builds and passes the tests properly on Linux, OS X, Solaris 10 (both x86 and SPARC) with gcc 4.6.0 before I will mark this for review. For now I'm setting to "needs info"

Dave 

PS.

I reported about an hour ago to the Singular developers that I believe they are using reserved words in Singular too (http://www.singular.uni-kl.de:8002/trac/ticket/333).



---

archive/issue_comments_118289.json:
```json
{
    "body": "Attachment [11084-Reduce_optimisation_level_in_Singular.patch](tarball://root/attachments/some-uuid/ticket11084/11084-Reduce_optimisation_level_in_Singular.patch) by drkirkby created at 2011-04-09 09:52:12\n\nReduces optimisation. For review purposes only.",
    "created_at": "2011-04-09T09:52:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118289",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Attachment [11084-Reduce_optimisation_level_in_Singular.patch](tarball://root/attachments/some-uuid/ticket11084/11084-Reduce_optimisation_level_in_Singular.patch) by drkirkby created at 2011-04-09 09:52:12

Reduces optimisation. For review purposes only.



---

archive/issue_comments_118290.json:
```json
{
    "body": "<a id='comment:17'></a>This seems to be the right solution: looking at Singular's original settings I just realized that most of Singular is not compiled with -O3 already. (This is the reason why plain Singular doesn't fail to build. The overall optimization level is set in the spkg, so its merely a bug of the package.)\nMaybe a better solution would be not to *increase* optimization and stay with the original settings.\n\nBuilding/installing of the skpg is fine for me. Let's see whether the tests succeed.",
    "created_at": "2011-04-09T21:31:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118290",
    "user": "https://github.com/alexanderdreyer"
}
```

<a id='comment:17'></a>This seems to be the right solution: looking at Singular's original settings I just realized that most of Singular is not compiled with -O3 already. (This is the reason why plain Singular doesn't fail to build. The overall optimization level is set in the spkg, so its merely a bug of the package.)
Maybe a better solution would be not to *increase* optimization and stay with the original settings.

Building/installing of the skpg is fine for me. Let's see whether the tests succeed.



---

archive/issue_comments_118291.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2011-04-09T21:31:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118291",
    "user": "https://github.com/alexanderdreyer"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_118292.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-04-09T23:56:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118292",
    "user": "https://github.com/alexanderdreyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_118293.json:
```json
{
    "body": "<a id='comment:18'></a>The tests suceeded, so positive review.",
    "created_at": "2011-04-09T23:56:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118293",
    "user": "https://github.com/alexanderdreyer"
}
```

<a id='comment:18'></a>The tests suceeded, so positive review.



---

archive/issue_comments_118294.json:
```json
{
    "body": "<a id='comment:19'></a>Replying to [comment:17 AlexanderDreyer]:\n> This seems to be the right solution\n\n\nI completely disagree.  Dropping the optimization is at best a workaround.  IMHO it can *never* be \"the right solution\".  It means that either the compiler or the code has a bug.  Maybe dropping the optimization to `-O2` covers up any issues, but I think one should really investigate what the true problem is.\n\nI am *very strongly* against saying to never increase the optimization level to `-O3`.  If some later upstream version has fixed this problem, we *should* increase the optimization level back to `-O3`.",
    "created_at": "2011-04-11T09:17:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118294",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:19'></a>Replying to [comment:17 AlexanderDreyer]:
> This seems to be the right solution


I completely disagree.  Dropping the optimization is at best a workaround.  IMHO it can *never* be "the right solution".  It means that either the compiler or the code has a bug.  Maybe dropping the optimization to `-O2` covers up any issues, but I think one should really investigate what the true problem is.

I am *very strongly* against saying to never increase the optimization level to `-O3`.  If some later upstream version has fixed this problem, we *should* increase the optimization level back to `-O3`.



---

archive/issue_comments_118295.json:
```json
{
    "body": "<a id='comment:20'></a>Replying to [comment:19 jdemeyer]:\n> Replying to [comment:17 AlexanderDreyer]:\n> > This seems to be the right solution\n\n> \n> I completely disagree.  Dropping the optimization is at best a workaround. \n\n\nAgreed. \n\n>  IMHO it can *never* be \"the right solution\".  It means that either the compiler or the code has a bug.  Maybe dropping the optimization to `-O2` covers up any issues, but I think one should really investigate what the true problem is.\n\n\n\nWell, a lot of the code in Sage is very difficult to navigate. Sage developers did not write it. Much is incomprehensible. Most gives a lot of compiler warnings. Sorting out if a gcc bug or a bug in the code is difficult. Then if it is a bug in the code, finding where is often very very difficult. One could spend ages on it. \n\n\n> I am *very strongly* against saying to never increase the optimization level to `-O3`.  If some later upstream version has fixed this problem, we *should* increase the optimization level back to `-O3`.\n\n\nGiven this code has caused many issues on many platforms with optimization issues, then I think not increasing it is worthwhile. It should also be realised that -O3 does not necessarily run faster than -O2. The higher optimization level invokes more speculative optimisations, which may cause the code to run slower. See this point from a GCC developer.\n\nhttp://gcc.gnu.org/ml/gcc-help/2010-07/msg00190.html\n\n\n---\n*The -O3 optoin should be safe for correct code. An important difference between -O2/-O3 and -O1 is that -O2 and -O3 enable strict aliasing and strict overflow. Those options provide better optimization for correct code, but are far more likely to cause unexpected code generation for incorrect code. See the -fstrict-aliasing and -fstrict-overflow options.*\n\n*The main difference between -O3 and -O2 is that -O3 enables more speculative optimizations. These should not miscompile your code, but they may cause your program to run more slowly. *\n\n---\n\nSo in summary\n* The upstream developers use -O2\n* Both -O2 and -O3 can cause problems with bad code. \n* -O3 can be slower than -O2\n* Previous attempts to use -O3 have caused problems on numerous platforms\n  * Fedora\n  * OpenSUSE on Itanium\n  * gcc on any platform\n* Just for good measure, the code can't be compiled with the Sun compiler, as it has hard-coded uses gcc-specific flags, so we can't even get a second opinion about doggy lines of code. \n* Finding whether it's a gcc bug or a bug in Singular would take quite a bit of effort, and IMHO would be better spent elsewhere. \n\nThere seems to be little appetite among the Sage community for investigating (and possibly fixing) the **thousands** of compiler warnings - some of which look potentially serious to me. To me at least, permitting -O3 on code which has caused numerous issues in the past is unwise. \n\nDave",
    "created_at": "2011-04-11T10:57:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118295",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:20'></a>Replying to [comment:19 jdemeyer]:
> Replying to [comment:17 AlexanderDreyer]:
> > This seems to be the right solution

> 
> I completely disagree.  Dropping the optimization is at best a workaround. 


Agreed. 

>  IMHO it can *never* be "the right solution".  It means that either the compiler or the code has a bug.  Maybe dropping the optimization to `-O2` covers up any issues, but I think one should really investigate what the true problem is.



Well, a lot of the code in Sage is very difficult to navigate. Sage developers did not write it. Much is incomprehensible. Most gives a lot of compiler warnings. Sorting out if a gcc bug or a bug in the code is difficult. Then if it is a bug in the code, finding where is often very very difficult. One could spend ages on it. 


> I am *very strongly* against saying to never increase the optimization level to `-O3`.  If some later upstream version has fixed this problem, we *should* increase the optimization level back to `-O3`.


Given this code has caused many issues on many platforms with optimization issues, then I think not increasing it is worthwhile. It should also be realised that -O3 does not necessarily run faster than -O2. The higher optimization level invokes more speculative optimisations, which may cause the code to run slower. See this point from a GCC developer.

http://gcc.gnu.org/ml/gcc-help/2010-07/msg00190.html


---
*The -O3 optoin should be safe for correct code. An important difference between -O2/-O3 and -O1 is that -O2 and -O3 enable strict aliasing and strict overflow. Those options provide better optimization for correct code, but are far more likely to cause unexpected code generation for incorrect code. See the -fstrict-aliasing and -fstrict-overflow options.*

*The main difference between -O3 and -O2 is that -O3 enables more speculative optimizations. These should not miscompile your code, but they may cause your program to run more slowly. *

---

So in summary
* The upstream developers use -O2
* Both -O2 and -O3 can cause problems with bad code. 
* -O3 can be slower than -O2
* Previous attempts to use -O3 have caused problems on numerous platforms
  * Fedora
  * OpenSUSE on Itanium
  * gcc on any platform
* Just for good measure, the code can't be compiled with the Sun compiler, as it has hard-coded uses gcc-specific flags, so we can't even get a second opinion about doggy lines of code. 
* Finding whether it's a gcc bug or a bug in Singular would take quite a bit of effort, and IMHO would be better spent elsewhere. 

There seems to be little appetite among the Sage community for investigating (and possibly fixing) the **thousands** of compiler warnings - some of which look potentially serious to me. To me at least, permitting -O3 on code which has caused numerous issues in the past is unwise. 

Dave



---

archive/issue_comments_118296.json:
```json
{
    "body": "<a id='comment:21'></a>> > > This seems to be the right solution\n\n> > \n> > I completely disagree.  Dropping the optimization is at best a workaround. \n\nOf course, I meant a solution for now (let's call this workaround).\n\nI also wanted to point out, that upstream Singular uses different optimization levels for different parts of the system. Some parts are actually compiled with -O3 (not the one which causes problems). \nSo I had wanted to suggest, that the spkg should not increase the optimization level over the levels, respectively, intended by the upstream developers. (It's known that -O3 sometimes yields performance issues.)\n\nFor some reason the Sage-package forces a unified optimization setting for all parts of Singular. Avoiding this would be the best of course.\n\nBTW: I'm pretty sure, the issue is a compiler bug: It complies without problems, but the linker looks for a (C++) function, whose mangled name doesn't fit what the linker expects.",
    "created_at": "2011-04-11T11:25:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118296",
    "user": "https://github.com/alexanderdreyer"
}
```

<a id='comment:21'></a>> > > This seems to be the right solution

> > 
> > I completely disagree.  Dropping the optimization is at best a workaround. 

Of course, I meant a solution for now (let's call this workaround).

I also wanted to point out, that upstream Singular uses different optimization levels for different parts of the system. Some parts are actually compiled with -O3 (not the one which causes problems). 
So I had wanted to suggest, that the spkg should not increase the optimization level over the levels, respectively, intended by the upstream developers. (It's known that -O3 sometimes yields performance issues.)

For some reason the Sage-package forces a unified optimization setting for all parts of Singular. Avoiding this would be the best of course.

BTW: I'm pretty sure, the issue is a compiler bug: It complies without problems, but the linker looks for a (C++) function, whose mangled name doesn't fit what the linker expects.



---

archive/issue_comments_118297.json:
```json
{
    "body": "<a id='comment:22'></a>Some administrative comment: there is already a new Singular spkg at #9497 (which will probably be merged in sage-4.7.alpha5), so you should rebase this ticket to the spkg at #9497.",
    "created_at": "2011-04-11T12:43:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118297",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'></a>Some administrative comment: there is already a new Singular spkg at #9497 (which will probably be merged in sage-4.7.alpha5), so you should rebase this ticket to the spkg at #9497.



---

archive/issue_comments_118298.json:
```json
{
    "body": "<a id='comment:23'></a>David, would you agree with the compromise to weaken your wording about the `-O3` issue?  I.e. replace \"Please do not push the optimisation to -O3. This has caused too many problems.\" by something along the lines of \"Currently, building Singular with -O3 fails using gcc 4.6.0.  Therefore, we compile using -O2.\"",
    "created_at": "2011-04-11T12:48:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118298",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'></a>David, would you agree with the compromise to weaken your wording about the `-O3` issue?  I.e. replace "Please do not push the optimisation to -O3. This has caused too many problems." by something along the lines of "Currently, building Singular with -O3 fails using gcc 4.6.0.  Therefore, we compile using -O2."



---

archive/issue_comments_118299.json:
```json
{
    "body": "<a id='comment:24'></a>I dug around for the missing symbol a bit and the issue is in const propagation where some function should get compiled into a const and a non-const version, but apparently one of them is missing when linking everything. I'm not sure if its a compiler bug or a misuse of const-ness that causes it.\n\nWith lower optimization gcc probably doesn't emit two distinct versions of the function. So the bug should only affect whether the code compiles or not, but never give wrong results.",
    "created_at": "2011-04-11T17:01:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118299",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:24'></a>I dug around for the missing symbol a bit and the issue is in const propagation where some function should get compiled into a const and a non-const version, but apparently one of them is missing when linking everything. I'm not sure if its a compiler bug or a misuse of const-ness that causes it.

With lower optimization gcc probably doesn't emit two distinct versions of the function. So the bug should only affect whether the code compiles or not, but never give wrong results.



---

archive/issue_comments_118300.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2011-04-11T20:33:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118300",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_118301.json:
```json
{
    "body": "Changing priority from critical to blocker.",
    "created_at": "2011-04-18T08:27:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118301",
    "user": "https://github.com/jdemeyer"
}
```

Changing priority from critical to blocker.



---

archive/issue_comments_118302.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-04-18T09:05:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118302",
    "user": "https://github.com/alexanderdreyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_118303.json:
```json
{
    "body": "<a id='comment:27'></a>I put the merged spkg here:\nhttp://boxen.math.washington.edu/home/dreyer/spkg/singular-3-1-1-4.p7.spkg\nUnfortunately, somebody else will need to review it now.",
    "created_at": "2011-04-18T09:05:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118303",
    "user": "https://github.com/alexanderdreyer"
}
```

<a id='comment:27'></a>I put the merged spkg here:
http://boxen.math.washington.edu/home/dreyer/spkg/singular-3-1-1-4.p7.spkg
Unfortunately, somebody else will need to review it now.



---

archive/issue_events_028759.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-04-18T16:19:50Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "milestone": "sage-4.7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11084#event-28759"
}
```



---

archive/issue_comments_118304.json:
```json
{
    "body": "<a id='comment:29'></a>Positive review. \n\nIs there a good reason this can't be merged into 4.7 now? Then all the gcc 4.6.0 issues will be resolved. #11159 does mention that gcc 4.6.0 will not build Sage and addresses an issue about GNU tar on Os X. But quite honestly if this is merged, and #11159 is not, then the is just a minor documentation error about GNU tar on OS X. I feel the gcc 4.6.0 issue is far more important than a minor error in the documentation. Or another ticket can be created to remove the comments about gcc 4.6.0 not building Sage. \n\nDave",
    "created_at": "2011-04-19T04:53:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118304",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:29'></a>Positive review. 

Is there a good reason this can't be merged into 4.7 now? Then all the gcc 4.6.0 issues will be resolved. #11159 does mention that gcc 4.6.0 will not build Sage and addresses an issue about GNU tar on Os X. But quite honestly if this is merged, and #11159 is not, then the is just a minor documentation error about GNU tar on OS X. I feel the gcc 4.6.0 issue is far more important than a minor error in the documentation. Or another ticket can be created to remove the comments about gcc 4.6.0 not building Sage. 

Dave



---

archive/issue_comments_118305.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-04-19T04:54:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118305",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_118306.json:
```json
{
    "body": "<a id='comment:31'></a>Are we really supposed to **overwrite** CFLAGS instead of **appending** CLFAGS when SAGE64 is set?\n\nFrom `spkg-install`:\n\n```\nif [ \"x$SAGE64\" = xyes ]; then\n    echo \"Building a 64-bit version of Singular\"\n    CFLAGS=\"-O2 -g -m64 \"\n    CXXFLAGS=\"-O2 -g -m64\"\n    CPPFLAGS=\"-O2 -g -m64\"\n    LDFLAGS=\"-m64 \"; export LDFLAGS\n    if [ \"x`uname`\" = xSunOS ] ; then\n      CC=\"$CC -m64\"\n      export CC\n      CXX=\"$CXX -m64\"\n      export CXX\n    fi\nfi\n```",
    "created_at": "2011-04-19T10:02:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118306",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:31'></a>Are we really supposed to **overwrite** CFLAGS instead of **appending** CLFAGS when SAGE64 is set?

From `spkg-install`:

```
if [ "x$SAGE64" = xyes ]; then
    echo "Building a 64-bit version of Singular"
    CFLAGS="-O2 -g -m64 "
    CXXFLAGS="-O2 -g -m64"
    CPPFLAGS="-O2 -g -m64"
    LDFLAGS="-m64 "; export LDFLAGS
    if [ "x`uname`" = xSunOS ] ; then
      CC="$CC -m64"
      export CC
      CXX="$CXX -m64"
      export CXX
    fi
fi
```



---

archive/issue_comments_118307.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2011-04-19T10:08:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118307",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_118308.json:
```json
{
    "body": "<a id='comment:32'></a>New spkg (not overwriting of CFLAGS when SAGE64 is set): [http://boxen.math.washington.edu/home/jdemeyer/spkg/singular-3-1-1-4.p8.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/singular-3-1-1-4.p8.spkg)",
    "created_at": "2011-04-19T10:08:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118308",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:32'></a>New spkg (not overwriting of CFLAGS when SAGE64 is set): [http://boxen.math.washington.edu/home/jdemeyer/spkg/singular-3-1-1-4.p8.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/singular-3-1-1-4.p8.spkg)



---

archive/issue_comments_118309.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-04-19T10:09:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118309",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_118310.json:
```json
{
    "body": "<a id='comment:34'></a>Replying to [comment:23 jdemeyer]:\n> David, would you agree with the compromise to weaken your wording about the `-O3` issue?  I.e. replace \"Please do not push the optimisation to -O3. This has caused too many problems.\" by something along the lines of \"Currently, building Singular with -O3 fails using gcc 4.6.0.  Therefore, we compile using -O2.\"\n\n\nI will make it less strong, but I feel it needs to be a bit stronger than just mention gcc 4.6.0. \n\nHow about \n\n*The original Singular source code builds part of Singular with -O2 and part with -O3. On several occasions Sage has forced the optimisation of the complete package to -O3, but this has caused various problems (tickets x, y, and x) either with specific compilers or on specific platforms. If you feel tempted to increase the optimiation to -O3, ask on the Singular mailing (whatever`@`wherever.org) list for advice and discuss in on sage-devel first. Also note that -O3 can be slower than -O2 in some instances.*\n\nDoes that seem reasonable?",
    "created_at": "2011-04-19T10:35:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118310",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:34'></a>Replying to [comment:23 jdemeyer]:
> David, would you agree with the compromise to weaken your wording about the `-O3` issue?  I.e. replace "Please do not push the optimisation to -O3. This has caused too many problems." by something along the lines of "Currently, building Singular with -O3 fails using gcc 4.6.0.  Therefore, we compile using -O2."


I will make it less strong, but I feel it needs to be a bit stronger than just mention gcc 4.6.0. 

How about 

*The original Singular source code builds part of Singular with -O2 and part with -O3. On several occasions Sage has forced the optimisation of the complete package to -O3, but this has caused various problems (tickets x, y, and x) either with specific compilers or on specific platforms. If you feel tempted to increase the optimiation to -O3, ask on the Singular mailing (whatever`@`wherever.org) list for advice and discuss in on sage-devel first. Also note that -O3 can be slower than -O2 in some instances.*

Does that seem reasonable?



---

archive/issue_comments_118311.json:
```json
{
    "body": "<a id='comment:35'></a>Replying to [comment:31 jdemeyer]:\n> Are we really supposed to **overwrite** CFLAGS instead of **appending** CLFAGS when SAGE64 is set?\n\n\nNo, that is an error, though it is a separate issue to the subject of the ticket. But it is easy to fix. \n\nDave",
    "created_at": "2011-04-19T10:37:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118311",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:35'></a>Replying to [comment:31 jdemeyer]:
> Are we really supposed to **overwrite** CFLAGS instead of **appending** CLFAGS when SAGE64 is set?


No, that is an error, though it is a separate issue to the subject of the ticket. But it is easy to fix. 

Dave



---

archive/issue_comments_118312.json:
```json
{
    "body": "<a id='comment:36'></a>Replying to [comment:35 drkirkby]:\n> Replying to [comment:31 jdemeyer]:\n> > Are we really supposed to **overwrite** CFLAGS instead of **appending** CLFAGS when SAGE64 is set?\n\n> \n> No, that is an error, though it is a separate issue to the subject of the ticket. But it is easy to fix. \n\n\nIn that case, please review my spkg [http://boxen.math.washington.edu/home/jdemeyer/spkg/singular-3-1-1-4.p8.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/singular-3-1-1-4.p8.spkg).",
    "created_at": "2011-04-19T12:48:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118312",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:36'></a>Replying to [comment:35 drkirkby]:
> Replying to [comment:31 jdemeyer]:
> > Are we really supposed to **overwrite** CFLAGS instead of **appending** CLFAGS when SAGE64 is set?

> 
> No, that is an error, though it is a separate issue to the subject of the ticket. But it is easy to fix. 


In that case, please review my spkg [http://boxen.math.washington.edu/home/jdemeyer/spkg/singular-3-1-1-4.p8.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/singular-3-1-1-4.p8.spkg).



---

archive/issue_comments_118313.json:
```json
{
    "body": "<a id='comment:37'></a>Replying to [comment:34 drkirkby]:\n> Replying to [comment:23 jdemeyer]:\n> > David, would you agree with the compromise to weaken your wording about the `-O3` issue?  I.e. replace \"Please do not push the optimisation to -O3. This has caused too many problems.\" by something along the lines of \"Currently, building Singular with -O3 fails using gcc 4.6.0.  Therefore, we compile using -O2.\"\n\n> \n> I will make it less strong, but I feel it needs to be a bit stronger than just mention gcc 4.6.0. \n> \n> How about \n> \n> *The original Singular source code builds part of Singular with -O2 and part with -O3. On several occasions Sage has forced the optimisation of the complete package to -O3, but this has caused various problems (tickets x, y, and x) either with specific compilers or on specific platforms. If you feel tempted to increase the optimiation to -O3, ask on the Singular mailing (whatever`@`wherever.org) list for advice and discuss in on sage-devel first. Also note that -O3 can be slower than -O2 in some instances.*\n> \n> Does that seem reasonable? \n\n\nIt's not unreasonable, but a lot of fuzz about nothing.  What do you think of the following comment from my spkg:\n\n```\n# By default, parts of Singular are compiled with -O2 and parts\n# with -O3.  If we do set any CFLAGS, this always overrides the\n# default CFLAGS set by upstream.  In order to be compatible, we\n# set the optimization to -O2.\n```\nI think it's most important to explain **why** we use `-O2`.  Since there is a good reason to use `-O2`, of course one should not randomly increase the `-O` level.",
    "created_at": "2011-04-19T12:56:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118313",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:37'></a>Replying to [comment:34 drkirkby]:
> Replying to [comment:23 jdemeyer]:
> > David, would you agree with the compromise to weaken your wording about the `-O3` issue?  I.e. replace "Please do not push the optimisation to -O3. This has caused too many problems." by something along the lines of "Currently, building Singular with -O3 fails using gcc 4.6.0.  Therefore, we compile using -O2."

> 
> I will make it less strong, but I feel it needs to be a bit stronger than just mention gcc 4.6.0. 
> 
> How about 
> 
> *The original Singular source code builds part of Singular with -O2 and part with -O3. On several occasions Sage has forced the optimisation of the complete package to -O3, but this has caused various problems (tickets x, y, and x) either with specific compilers or on specific platforms. If you feel tempted to increase the optimiation to -O3, ask on the Singular mailing (whatever`@`wherever.org) list for advice and discuss in on sage-devel first. Also note that -O3 can be slower than -O2 in some instances.*
> 
> Does that seem reasonable? 


It's not unreasonable, but a lot of fuzz about nothing.  What do you think of the following comment from my spkg:

```
# By default, parts of Singular are compiled with -O2 and parts
# with -O3.  If we do set any CFLAGS, this always overrides the
# default CFLAGS set by upstream.  In order to be compatible, we
# set the optimization to -O2.
```
I think it's most important to explain **why** we use `-O2`.  Since there is a good reason to use `-O2`, of course one should not randomly increase the `-O` level.



---

archive/issue_comments_118314.json:
```json
{
    "body": "<a id='comment:38'></a>Replying to [comment:37 jdemeyer]:\n> I think it's most important to explain **why** we use `-O2`.  Since there is a good reason to use `-O2`, of course one should not randomly increase the `-O` level.\n\n\nBut my point is that this package does appear to have had the optimisation randomly increased several times, which for Singular is a particularly bad idea, as it has caused numerous problems. Your wording gives no hint of the dangers. We are not being compatible for the sake of it - we are doing so as it is dangerous to do otherwise. \n\nDave",
    "created_at": "2011-04-19T20:42:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118314",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:38'></a>Replying to [comment:37 jdemeyer]:
> I think it's most important to explain **why** we use `-O2`.  Since there is a good reason to use `-O2`, of course one should not randomly increase the `-O` level.


But my point is that this package does appear to have had the optimisation randomly increased several times, which for Singular is a particularly bad idea, as it has caused numerous problems. Your wording gives no hint of the dangers. We are not being compatible for the sake of it - we are doing so as it is dangerous to do otherwise. 

Dave



---

archive/issue_comments_118315.json:
```json
{
    "body": "<a id='comment:39'></a>How about adding a phrase like this:\n\n```\n# By default, parts of Singular are compiled with -O2 and parts\n# with -O3.  If we do set any CFLAGS, this always overrides the\n# default CFLAGS set by upstream.  In order to be compatible, we\n# set the optimization to -O2.  Increasing the optimization level\n# to -O3 has caused various problems in the past either with\n# specific compilers or on specific platforms.\n```",
    "created_at": "2011-04-20T06:53:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118315",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:39'></a>How about adding a phrase like this:

```
# By default, parts of Singular are compiled with -O2 and parts
# with -O3.  If we do set any CFLAGS, this always overrides the
# default CFLAGS set by upstream.  In order to be compatible, we
# set the optimization to -O2.  Increasing the optimization level
# to -O3 has caused various problems in the past either with
# specific compilers or on specific platforms.
```



---

archive/issue_comments_118316.json:
```json
{
    "body": "<a id='comment:40'></a>New package, use -O2 optimization level also for ia64 systems (testing on iras shows that this now works): [http://boxen.math.washington.edu/home/jdemeyer/spkg/singular-3-1-1-4.p8.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/singular-3-1-1-4.p8.spkg)",
    "created_at": "2011-04-20T08:30:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118316",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:40'></a>New package, use -O2 optimization level also for ia64 systems (testing on iras shows that this now works): [http://boxen.math.washington.edu/home/jdemeyer/spkg/singular-3-1-1-4.p8.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/singular-3-1-1-4.p8.spkg)



---

archive/issue_comments_118317.json:
```json
{
    "body": "<a id='comment:41'></a>That looks ok to me. \n\nCould this not go into 4.7? It seems to me we have fixes for all the gcc 4.6.0 issues. If Sage will build on some platforms with gcc 4.6.0, we have a lot more chance of finding any remaining issues on other platforms.",
    "created_at": "2011-04-20T10:25:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118317",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:41'></a>That looks ok to me. 

Could this not go into 4.7? It seems to me we have fixes for all the gcc 4.6.0 issues. If Sage will build on some platforms with gcc 4.6.0, we have a lot more chance of finding any remaining issues on other platforms.



---

archive/issue_comments_118318.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-04-20T10:25:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118318",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_028760.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-04-20T15:01:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "milestone": "sage-4.7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11084#event-28760"
}
```



---

archive/issue_events_028761.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-04-20T15:01:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "milestone": "sage-4.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11084#event-28761"
}
```



---

archive/issue_comments_118319.json:
```json
{
    "body": "<a id='comment:43'></a>Replying to [comment:41 drkirkby]:\n> Could this not go into 4.7?\n\n\nI'm willing to try...",
    "created_at": "2011-04-20T15:01:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118319",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:43'></a>Replying to [comment:41 drkirkby]:
> Could this not go into 4.7?


I'm willing to try...



---

archive/issue_events_028762.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-04-20T19:56:44Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11084#event-28762"
}
```



---

archive/issue_comments_118320.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-04-20T19:56:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118320",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_118321.json:
```json
{
    "body": "<a id='comment:45'></a>I have also closed #6240 because of this ticket.",
    "created_at": "2011-04-20T20:58:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118321",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:45'></a>I have also closed #6240 because of this ticket.



---

archive/issue_comments_118322.json:
```json
{
    "body": "Diff for the singular spkg, for reviewing only",
    "created_at": "2011-04-30T20:12:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118322",
    "user": "https://github.com/jdemeyer"
}
```

Diff for the singular spkg, for reviewing only



---

archive/issue_comments_118323.json:
```json
{
    "body": "<a id='comment:47'></a>Attachment [singular-3-1-1-4.p6-p8.diff](tarball://root/attachments/some-uuid/ticket11084/singular-3-1-1-4.p6-p8.diff) by @jdemeyer created at 2011-04-30 21:26:25\n\nPlease see #11278 for a **blocker** follow-up, any ideas more than welcome...",
    "created_at": "2011-04-30T21:26:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11084#issuecomment-118323",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:47'></a>Attachment [singular-3-1-1-4.p6-p8.diff](tarball://root/attachments/some-uuid/ticket11084/singular-3-1-1-4.p6-p8.diff) by @jdemeyer created at 2011-04-30 21:26:25

Please see #11278 for a **blocker** follow-up, any ideas more than welcome...
