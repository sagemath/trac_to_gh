# Issue 11606: simplify constraints in linear programs

archive/issues_011434.json:
```json
{
    "body": "MixedIntegerLinearProgram doesn't notice when it is given constraints that already exist in the program, or that are constant multiples. A simple example:\n\n```\nsage: lp = MixedIntegerLinearProgram()\nsage: for each in xrange(10):\n....:     lp.add_constraint(lp[0]-lp[1],min=1)\n....:     \nsage: lp.show()\nMaximization:\n \nConstraints:\n  1.0 <= x_0 -x_1 \n  1.0 <= x_0 -x_1 \n  1.0 <= x_0 -x_1 \n  1.0 <= x_0 -x_1 \n  1.0 <= x_0 -x_1 \n  1.0 <= x_0 -x_1 \n  1.0 <= x_0 -x_1 \n  1.0 <= x_0 -x_1 \n  1.0 <= x_0 -x_1 \n  1.0 <= x_0 -x_1 \nVariables:\n  x_0 is a continuous variable (min=0.0, max=+oo)\n  x_1 is a continuous variable (min=0.0, max=+oo)\n```\nNotice that the same constraint appears 10 different times.\n\nApply:\n\n- [attachment:trac_11606_add_only_new_constraints_to_lp_using_sets.patch]\n\nThis patch depends on #11588 and #11607.\n\nAssignee: @nathanncohen\n\nCC:  @nathanncohen\n\nKeywords: sd32\n\nResolution: fixed\n\nAuthor: John Perry\n\nReviewer: Nathann Cohen\n\nMerged: sage-5.0.beta1\n\nIssue created by migration from https://trac.sagemath.org/ticket/11606\n\n",
    "closed_at": "2012-01-18T08:15:46Z",
    "created_at": "2011-07-16T19:08:03Z",
    "labels": [
        "component: linear programming"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.0",
    "title": "simplify constraints in linear programs",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11606",
    "user": "https://github.com/johnperry-math"
}
```
MixedIntegerLinearProgram doesn't notice when it is given constraints that already exist in the program, or that are constant multiples. A simple example:

```
sage: lp = MixedIntegerLinearProgram()
sage: for each in xrange(10):
....:     lp.add_constraint(lp[0]-lp[1],min=1)
....:     
sage: lp.show()
Maximization:
 
Constraints:
  1.0 <= x_0 -x_1 
  1.0 <= x_0 -x_1 
  1.0 <= x_0 -x_1 
  1.0 <= x_0 -x_1 
  1.0 <= x_0 -x_1 
  1.0 <= x_0 -x_1 
  1.0 <= x_0 -x_1 
  1.0 <= x_0 -x_1 
  1.0 <= x_0 -x_1 
  1.0 <= x_0 -x_1 
Variables:
  x_0 is a continuous variable (min=0.0, max=+oo)
  x_1 is a continuous variable (min=0.0, max=+oo)
```
Notice that the same constraint appears 10 different times.

Apply:

- [attachment:trac_11606_add_only_new_constraints_to_lp_using_sets.patch]

This patch depends on #11588 and #11607.

Assignee: @nathanncohen

CC:  @nathanncohen

Keywords: sd32

Resolution: fixed

Author: John Perry

Reviewer: Nathann Cohen

Merged: sage-5.0.beta1

Issue created by migration from https://trac.sagemath.org/ticket/11606





---

archive/issue_comments_155808.json:
```json
{
    "body": "<a id='comment:1'></a>To emphasize the need for this, in a sample application I'm working on, the number of constraints is decreased by an order of magnitude (93 vs. 787); in larger systems the different would likely be much larger.",
    "created_at": "2011-07-24T22:19:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155808",
    "user": "https://github.com/johnperry-math"
}
```

<a id='comment:1'></a>To emphasize the need for this, in a sample application I'm working on, the number of constraints is decreased by an order of magnitude (93 vs. 787); in larger systems the different would likely be much larger.



---

archive/issue_comments_155809.json:
```json
{
    "body": "Attachment [trac_11606_add_only_new_constraints_to_lp.patch](tarball://root/attachments/some-uuid/ticket11606/trac_11606_add_only_new_constraints_to_lp.patch) by @johnperry-math created at 2011-08-23 07:51:20",
    "created_at": "2011-08-23T07:51:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155809",
    "user": "https://github.com/johnperry-math"
}
```

Attachment [trac_11606_add_only_new_constraints_to_lp.patch](tarball://root/attachments/some-uuid/ticket11606/trac_11606_add_only_new_constraints_to_lp.patch) by @johnperry-math created at 2011-08-23 07:51:20



---

archive/issue_comments_155810.json:
```json
{
    "body": "<a id='comment:2'></a>The attached file is a first attempt at solving the problem. An optional argument, `check_redundant`, which defaults to `False`, is used to control whether to invoke the change. If so:\n\n* it proceeds row by row of the constraint matrix\n* it checks whether the same variables are nonzero\n* if so, it computes the ratio `r` between the coefficients of the \"leading\" variables\n* if it is negative, add the constraint\n\n  (if `r` is negative, the constraint is not so obviously redundant)\n\n* if the ratio of the lower & upper bounds disagrees with `r`, add the constraint\n* now check the ratio of the remaining variables in the current row; if it differs from `r`, add the constraint\n\nThis is meant to be a preliminary implementation rather than an efficient implementation; the best option is probably to visit the matrix & compare, but this would require going into each back end, which is probably a bad idea right now.",
    "created_at": "2011-08-23T08:04:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155810",
    "user": "https://github.com/johnperry-math"
}
```

<a id='comment:2'></a>The attached file is a first attempt at solving the problem. An optional argument, `check_redundant`, which defaults to `False`, is used to control whether to invoke the change. If so:

* it proceeds row by row of the constraint matrix
* it checks whether the same variables are nonzero
* if so, it computes the ratio `r` between the coefficients of the "leading" variables
* if it is negative, add the constraint

  (if `r` is negative, the constraint is not so obviously redundant)

* if the ratio of the lower & upper bounds disagrees with `r`, add the constraint
* now check the ratio of the remaining variables in the current row; if it differs from `r`, add the constraint

This is meant to be a preliminary implementation rather than an efficient implementation; the best option is probably to visit the matrix & compare, but this would require going into each back end, which is probably a bad idea right now.



---

archive/issue_comments_155811.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-08-23T08:04:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155811",
    "user": "https://github.com/johnperry-math"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_155812.json:
```json
{
    "body": "Changing author from \"\" to \"john_perry\"",
    "created_at": "2011-08-23T08:04:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155812",
    "user": "https://github.com/johnperry-math"
}
```

Changing author from "" to "john_perry"



---

archive/issue_comments_155813.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd32\".",
    "created_at": "2011-08-25T19:31:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155813",
    "user": "https://github.com/johnperry-math"
}
```

Changing keywords from "" to "sd32".



---

archive/issue_comments_155814.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2011-08-31T11:18:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155814",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_155815.json:
```json
{
    "body": "<a id='comment:5'></a>Hello John !\n\nI was thinking again about what I told you by email : in order to simplify constraints more efficiently, one could add the constraints to a Set object when adding it to the solvers, and add a new constraint only when it is not already included in the set. The search is then much more efficient, and handled by Python. If you also want to test for constraints which may be formaly different (i.e. the original constraint multiplied by two), you but have to insert the \"normalized\" constraint in the set instead of the one which is given.\n\nThis would mean doubling in memory the size of the stored constraints, as it would mean that the LP constraint's are remembered both by the backend and by a Set object in the MILP class, but this is also what is happening right now when returning the list of all constraints. This could also be rewritten as an interator to avoid the cost of memory, then again  have no idea how large your LP can be, but perhaps if you have many constraints this Set trick would help you much more.\n\nIn this case, the simplify_constraints would be a parameter of the MixedntegerLinearProgram __init__ method, so that the Set object is created and maintained from beginning to end when the user asks the constraints to be simplified.\n\nWell, my two cents `:-)`\n\nathann",
    "created_at": "2011-08-31T11:18:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155815",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:5'></a>Hello John !

I was thinking again about what I told you by email : in order to simplify constraints more efficiently, one could add the constraints to a Set object when adding it to the solvers, and add a new constraint only when it is not already included in the set. The search is then much more efficient, and handled by Python. If you also want to test for constraints which may be formaly different (i.e. the original constraint multiplied by two), you but have to insert the "normalized" constraint in the set instead of the one which is given.

This would mean doubling in memory the size of the stored constraints, as it would mean that the LP constraint's are remembered both by the backend and by a Set object in the MILP class, but this is also what is happening right now when returning the list of all constraints. This could also be rewritten as an interator to avoid the cost of memory, then again  have no idea how large your LP can be, but perhaps if you have many constraints this Set trick would help you much more.

In this case, the simplify_constraints would be a parameter of the MixedntegerLinearProgram __init__ method, so that the Set object is created and maintained from beginning to end when the user asks the constraints to be simplified.

Well, my two cents `:-)`

athann



---

archive/issue_comments_155816.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:5 ncohen]:\n> If you also want to test for constraints which may be formaly different (i.e. the original constraint multiplied by two), you but have to insert the \"normalized\" constraint in the set instead of the one which is given.\n\n\nI had thought of this, too. I think the only reason I didn't do it at the time is a law I've seen attributed to David Knuth: premature optimization is the root of all evil. I can certainly try it.\n\n> This could also be rewritten as an interator to avoid the cost of memory...\n\n\nI'm not quite following how to do this.\n\n> then again  have no idea how large your LP can be...\n\n\nHard data: a problem that exhausted memory on a 4GB machine a month ago computed yesterday in about 40MB.\n\n> In this case, the simplify_constraints would be a parameter of the MixedntegerLinearProgram __init__ method, so that the Set object is created and maintained from beginning to end when the user asks the constraints to be simplified.\n\n\nI'll try that, thanks.",
    "created_at": "2011-08-31T14:00:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155816",
    "user": "https://github.com/johnperry-math"
}
```

<a id='comment:6'></a>Replying to [comment:5 ncohen]:
> If you also want to test for constraints which may be formaly different (i.e. the original constraint multiplied by two), you but have to insert the "normalized" constraint in the set instead of the one which is given.


I had thought of this, too. I think the only reason I didn't do it at the time is a law I've seen attributed to David Knuth: premature optimization is the root of all evil. I can certainly try it.

> This could also be rewritten as an interator to avoid the cost of memory...


I'm not quite following how to do this.

> then again  have no idea how large your LP can be...


Hard data: a problem that exhausted memory on a 4GB machine a month ago computed yesterday in about 40MB.

> In this case, the simplify_constraints would be a parameter of the MixedntegerLinearProgram __init__ method, so that the Set object is created and maintained from beginning to end when the user asks the constraints to be simplified.


I'll try that, thanks.



---

archive/issue_comments_155817.json:
```json
{
    "body": "<a id='comment:7'></a>> > This could also be rewritten as an interator to avoid the cost of memory...\n\n> \n> I'm not quite following how to do this.\n\n\nOh. For the moment your patch returns a list of tuples, representing the constraints. Instead of that (which requires to build the whole list first, then to return it, thus doubling the memory cost), python can return the list element by element using the \"yield\" keyword. This would avoid doubling the memory, especially if you just want to check something for each constraint returned.",
    "created_at": "2011-09-01T16:19:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155817",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:7'></a>> > This could also be rewritten as an interator to avoid the cost of memory...

> 
> I'm not quite following how to do this.


Oh. For the moment your patch returns a list of tuples, representing the constraints. Instead of that (which requires to build the whole list first, then to return it, thus doubling the memory cost), python can return the list element by element using the "yield" keyword. This would avoid doubling the memory, especially if you just want to check something for each constraint returned.



---

archive/issue_comments_155818.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:7 ncohen]:\n> > > This could also be rewritten as an interator to avoid the cost of memory...\n\n> > \n> > I'm not quite following how to do this.\n\n> \n> Oh. For the moment your patch returns a list of tuples, representing the constraints. Instead of that (which requires to build the whole list first, then to return it, thus doubling the memory cost), python can return the list element by element using the \"yield\" keyword. This would avoid doubling the memory, especially if you just want to check something for each constraint returned.\n\n\nAre you thinking of #11607 here? This patch only affects the return value in one place; it returns `None`, and then only if the constraint is redundant.",
    "created_at": "2011-09-01T17:57:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155818",
    "user": "https://github.com/johnperry-math"
}
```

<a id='comment:8'></a>Replying to [comment:7 ncohen]:
> > > This could also be rewritten as an interator to avoid the cost of memory...

> > 
> > I'm not quite following how to do this.

> 
> Oh. For the moment your patch returns a list of tuples, representing the constraints. Instead of that (which requires to build the whole list first, then to return it, thus doubling the memory cost), python can return the list element by element using the "yield" keyword. This would avoid doubling the memory, especially if you just want to check something for each constraint returned.


Are you thinking of #11607 here? This patch only affects the return value in one place; it returns `None`, and then only if the constraint is redundant.



---

archive/issue_comments_155819.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:5 ncohen]:\n> I was thinking again about what I told you by email : in order to simplify constraints more efficiently, one could add the constraints to a Set object when adding it to the solvers, and add a new constraint only when it is not already included in the set. The search is then much more efficient, and handled by Python. If you also want to test for constraints which may be formaly different (i.e. the original constraint multiplied by two), you but have to insert the \"normalized\" constraint in the set instead of the one which is given.\n\n\n\nI have a working implementation along these lines, but there's one difficulty. In order to normalize the constraint, the code divides by the coefficient of the variable with the smallest index. For example, given the constraint `2*x_1-2*x_0<=2`, the code converts this to `x_1-x_0<=1`.\n\nIn order to do this, I want to use the `min()` command to determine the smallest non-zero key, determine its coefficient, and divide:\n\n```\n    i = min(f.keys())\n    c = f[i]\n    C = [(v,coeff/c) for (v,coeff) in f.iteritems() if v != -1]\n```\nThe problem with this is that `min` is a parameter to the function, so this provokes an error.\n\nI can rename the parameters as `min_value` and `max_value`, but this would break people's existing code. Alternately, I can define `self._min = min` in `__init__`, and call `self._min()` where I would ordinarily call `min()`.\n\nI am attaching a patch that uses the latter approach, but if you have suggestions for a better solution, I'm all ears. It wouldn't surprise me if there is one.\n\nBTW, does it matter if I use `Set` or `set`? You wrote the former, but currently I'm using the latter.",
    "created_at": "2011-09-01T20:41:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155819",
    "user": "https://github.com/johnperry-math"
}
```

<a id='comment:9'></a>Replying to [comment:5 ncohen]:
> I was thinking again about what I told you by email : in order to simplify constraints more efficiently, one could add the constraints to a Set object when adding it to the solvers, and add a new constraint only when it is not already included in the set. The search is then much more efficient, and handled by Python. If you also want to test for constraints which may be formaly different (i.e. the original constraint multiplied by two), you but have to insert the "normalized" constraint in the set instead of the one which is given.



I have a working implementation along these lines, but there's one difficulty. In order to normalize the constraint, the code divides by the coefficient of the variable with the smallest index. For example, given the constraint `2*x_1-2*x_0<=2`, the code converts this to `x_1-x_0<=1`.

In order to do this, I want to use the `min()` command to determine the smallest non-zero key, determine its coefficient, and divide:

```
    i = min(f.keys())
    c = f[i]
    C = [(v,coeff/c) for (v,coeff) in f.iteritems() if v != -1]
```
The problem with this is that `min` is a parameter to the function, so this provokes an error.

I can rename the parameters as `min_value` and `max_value`, but this would break people's existing code. Alternately, I can define `self._min = min` in `__init__`, and call `self._min()` where I would ordinarily call `min()`.

I am attaching a patch that uses the latter approach, but if you have suggestions for a better solution, I'm all ears. It wouldn't surprise me if there is one.

BTW, does it matter if I use `Set` or `set`? You wrote the former, but currently I'm using the latter.



---

archive/issue_comments_155820.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -25,6 +25,10 @@\n ```\n Notice that the same constraint appears 10 different times.\n \n+Apply:\n+\n+- [attachment:trac_11606_simplify_with_sets.patch]\n+\n Comment: 1\n \n Issue created by migration from https://trac.sagemath.org/ticket/11606\n``````\n",
    "created_at": "2011-09-01T20:43:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155820",
    "user": "https://github.com/johnperry-math"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -25,6 +25,10 @@
 ```
 Notice that the same constraint appears 10 different times.
 
+Apply:
+
+- [attachment:trac_11606_simplify_with_sets.patch]
+
 Comment: 1
 
 Issue created by migration from https://trac.sagemath.org/ticket/11606
``````




---

archive/issue_comments_155821.json:
```json
{
    "body": "<a id='comment:11'></a>More rigorous testing showed that I had overlooked an issue with the keys (variables whose coefficients are zero). Fixed in the revision of the patch.\n\n(Just noticed: it helps if one executes `hg qrefresh` before `hg export tip`...)",
    "created_at": "2011-09-01T21:31:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155821",
    "user": "https://github.com/johnperry-math"
}
```

<a id='comment:11'></a>More rigorous testing showed that I had overlooked an issue with the keys (variables whose coefficients are zero). Fixed in the revision of the patch.

(Just noticed: it helps if one executes `hg qrefresh` before `hg export tip`...)



---

archive/issue_comments_155822.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2011-09-01T21:31:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155822",
    "user": "https://github.com/johnperry-math"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_155823.json:
```json
{
    "body": "Attachment [trac_11606_simplify_with_sets.patch](tarball://root/attachments/some-uuid/ticket11606/trac_11606_simplify_with_sets.patch) by @johnperry-math created at 2011-09-01 21:32:24",
    "created_at": "2011-09-01T21:32:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155823",
    "user": "https://github.com/johnperry-math"
}
```

Attachment [trac_11606_simplify_with_sets.patch](tarball://root/attachments/some-uuid/ticket11606/trac_11606_simplify_with_sets.patch) by @johnperry-math created at 2011-09-01 21:32:24



---

archive/issue_comments_155824.json:
```json
{
    "body": "<a id='comment:12'></a>Hello John ! `:-)`\n\nI really didn't think at first this method would need to use either min or max later on :-)\n\nHopefully, this trick should work :\n\n```\nfrom __builtin__ import min as min_function\n```\n\nCould you also add in the explanation of the check_redundant parameter what is a \"redundant\" constraint ? Something like \"(two constraints are redundant when one can be obtained from the other scalar by multiplication)\" or something of the kind ? `:-)`\n\nOh, and it looks like there are some missing \"::\" before the beginning of Python code in the doctests, so those will not be properly formatted when building the documentation.\n\n```\nsage -docbuild reference html\n```\n\nTwo other remarks :\n\n* Set is a Sage version of set, the latter being a purely Python thing. The interest of Set is that it is hashable and immutable, while the \"set\" can be modified. When you do not need the elements to be immutable, I'm told the best is to use set. And this I was probably told after writing this part `:-)`\n\n* I thought that \n\n```\nmin( x for x in range(3) if x != 0 )\n```\n  would be faster than \n\n```\nmin([ x for x in range(3) if x != 0 ])\n```\n \n  as you do not create the list first, but it looks like the iterators have a cost too :\n\n```\nsage: %timeit min( x for x in range(10000) if x != 0 )\n125 loops, best of 3: 5.51 ms per loop\nsage: %timeit min([ x for x in range(10000) if x != 0 ])\n125 loops, best of 3: 4.56 ms per loop\nsage: %timeit min(x for x in range(10) if x != 0)\n625 loops, best of 3: 7.41 \u00b5s per loop\nsage: %timeit min([ x for x in range(10) if x != 0 ])\n625 loops, best of 3: 6.81 \u00b5s per loop\n```\nNathann",
    "created_at": "2011-09-02T13:58:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155824",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:12'></a>Hello John ! `:-)`

I really didn't think at first this method would need to use either min or max later on :-)

Hopefully, this trick should work :

```
from __builtin__ import min as min_function
```

Could you also add in the explanation of the check_redundant parameter what is a "redundant" constraint ? Something like "(two constraints are redundant when one can be obtained from the other scalar by multiplication)" or something of the kind ? `:-)`

Oh, and it looks like there are some missing "::" before the beginning of Python code in the doctests, so those will not be properly formatted when building the documentation.

```
sage -docbuild reference html
```

Two other remarks :

* Set is a Sage version of set, the latter being a purely Python thing. The interest of Set is that it is hashable and immutable, while the "set" can be modified. When you do not need the elements to be immutable, I'm told the best is to use set. And this I was probably told after writing this part `:-)`

* I thought that 

```
min( x for x in range(3) if x != 0 )
```
  would be faster than 

```
min([ x for x in range(3) if x != 0 ])
```
 
  as you do not create the list first, but it looks like the iterators have a cost too :

```
sage: %timeit min( x for x in range(10000) if x != 0 )
125 loops, best of 3: 5.51 ms per loop
sage: %timeit min([ x for x in range(10000) if x != 0 ])
125 loops, best of 3: 4.56 ms per loop
sage: %timeit min(x for x in range(10) if x != 0)
625 loops, best of 3: 7.41 µs per loop
sage: %timeit min([ x for x in range(10) if x != 0 ])
625 loops, best of 3: 6.81 µs per loop
```
Nathann



---

archive/issue_comments_155825.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-09-02T13:58:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155825",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_155826.json:
```json
{
    "body": "<a id='comment:13'></a>Alright! The new patch imports `min` via `__builtin__`, and fixes those issues with the documentation. The doctests take about twice as long to run on my machine now. :-(\n\nRegarding the iterators: now I understand what you mean. Actually, if memory serves (and it may deceive -- not sure) I think I tried that when defining `C`, but Cython defied me, claiming that generators weren't acceptable. That's when I noticed that you had placed *you* definition of `C` in a list. So, I didn't think to use it in the `min_function` (maybe I even tried).",
    "created_at": "2011-09-02T22:07:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155826",
    "user": "https://github.com/johnperry-math"
}
```

<a id='comment:13'></a>Alright! The new patch imports `min` via `__builtin__`, and fixes those issues with the documentation. The doctests take about twice as long to run on my machine now. :-(

Regarding the iterators: now I understand what you mean. Actually, if memory serves (and it may deceive -- not sure) I think I tried that when defining `C`, but Cython defied me, claiming that generators weren't acceptable. That's when I noticed that you had placed *you* definition of `C` in a list. So, I didn't think to use it in the `min_function` (maybe I even tried).



---

archive/issue_comments_155827.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,33 @@\n+MixedIntegerLinearProgram doesn't notice when it is given constraints that already exist in the program, or that are constant multiples. A simple example:\n \n+```\n+sage: lp = MixedIntegerLinearProgram()\n+sage: for each in xrange(10):\n+....:     lp.add_constraint(lp[0]-lp[1],min=1)\n+....:     \n+sage: lp.show()\n+Maximization:\n+ \n+Constraints:\n+  1.0 <= x_0 -x_1 \n+  1.0 <= x_0 -x_1 \n+  1.0 <= x_0 -x_1 \n+  1.0 <= x_0 -x_1 \n+  1.0 <= x_0 -x_1 \n+  1.0 <= x_0 -x_1 \n+  1.0 <= x_0 -x_1 \n+  1.0 <= x_0 -x_1 \n+  1.0 <= x_0 -x_1 \n+  1.0 <= x_0 -x_1 \n+Variables:\n+  x_0 is a continuous variable (min=0.0, max=+oo)\n+  x_1 is a continuous variable (min=0.0, max=+oo)\n+```\n+Notice that the same constraint appears 10 different times.\n+\n+Apply:\n+\n+- [attachment:trac_11606_add_only_new_constraints_to_lp_using_sets.patch]\n \n Comment: 1\n \n``````\n",
    "created_at": "2011-09-02T22:07:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155827",
    "user": "https://github.com/johnperry-math"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,33 @@
+MixedIntegerLinearProgram doesn't notice when it is given constraints that already exist in the program, or that are constant multiples. A simple example:
 
+```
+sage: lp = MixedIntegerLinearProgram()
+sage: for each in xrange(10):
+....:     lp.add_constraint(lp[0]-lp[1],min=1)
+....:     
+sage: lp.show()
+Maximization:
+ 
+Constraints:
+  1.0 <= x_0 -x_1 
+  1.0 <= x_0 -x_1 
+  1.0 <= x_0 -x_1 
+  1.0 <= x_0 -x_1 
+  1.0 <= x_0 -x_1 
+  1.0 <= x_0 -x_1 
+  1.0 <= x_0 -x_1 
+  1.0 <= x_0 -x_1 
+  1.0 <= x_0 -x_1 
+  1.0 <= x_0 -x_1 
+Variables:
+  x_0 is a continuous variable (min=0.0, max=+oo)
+  x_1 is a continuous variable (min=0.0, max=+oo)
+```
+Notice that the same constraint appears 10 different times.
+
+Apply:
+
+- [attachment:trac_11606_add_only_new_constraints_to_lp_using_sets.patch]
 
 Comment: 1
 
``````




---

archive/issue_comments_155828.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-09-02T22:08:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155828",
    "user": "https://github.com/johnperry-math"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_155829.json:
```json
{
    "body": "<a id='comment:15'></a>By the way, when reading the section on docstring markup in [Conventions for Coding in Sage](http://www.sagemath.org/doc/developer/conventions.html#docstring-markup-with-rest-and-sphinx), I noticed this:\n  **Warning:** Functions whose names start with an underscore do not currently appear in the reference manual, so avoid putting crucial documentation in their docstrings. In particular, if you are defining a class, you might put a long informative docstring after the class definition, not for the `__init__` method.\n\nShould we move that documentation out of `__init__`?\n\n(You have to scroll fairly far down to find the warning, or else do a search.)",
    "created_at": "2011-09-02T22:13:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155829",
    "user": "https://github.com/johnperry-math"
}
```

<a id='comment:15'></a>By the way, when reading the section on docstring markup in [Conventions for Coding in Sage](http://www.sagemath.org/doc/developer/conventions.html#docstring-markup-with-rest-and-sphinx), I noticed this:
  **Warning:** Functions whose names start with an underscore do not currently appear in the reference manual, so avoid putting crucial documentation in their docstrings. In particular, if you are defining a class, you might put a long informative docstring after the class definition, not for the `__init__` method.

Should we move that documentation out of `__init__`?

(You have to scroll fairly far down to find the warning, or else do a search.)



---

archive/issue_comments_155830.json:
```json
{
    "body": "<a id='comment:16'></a>Forgot about copying -- we would want to copy the flag for checking redundancy, as well as the constraints.",
    "created_at": "2011-09-02T22:53:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155830",
    "user": "https://github.com/johnperry-math"
}
```

<a id='comment:16'></a>Forgot about copying -- we would want to copy the flag for checking redundancy, as well as the constraints.



---

archive/issue_comments_155831.json:
```json
{
    "body": "<a id='comment:17'></a>Forgot about copying *sets*, not just assigning pointers...",
    "created_at": "2011-09-03T00:03:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155831",
    "user": "https://github.com/johnperry-math"
}
```

<a id='comment:17'></a>Forgot about copying *sets*, not just assigning pointers...



---

archive/issue_comments_155832.json:
```json
{
    "body": "<a id='comment:18'></a>Something isn't working correctly with the normalization, **sometimes**. I'm trying to figure out what changed that is causing the issue I'm seeing...",
    "created_at": "2011-09-05T19:14:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155832",
    "user": "https://github.com/johnperry-math"
}
```

<a id='comment:18'></a>Something isn't working correctly with the normalization, **sometimes**. I'm trying to figure out what changed that is causing the issue I'm seeing...



---

archive/issue_comments_155833.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-09-05T19:14:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155833",
    "user": "https://github.com/johnperry-math"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_155834.json:
```json
{
    "body": "<a id='comment:19'></a>As I suspected, it's a typing problem. Normalization performs a division, and `1/2` simplifies to `0` if `1` is an `int`. If `1` is an `Integer` or a `Rational`, then `1/2` simplifies to a `Rational`.\n\nThis strikes me as a matter best left to the client: the normalization shouldn't choose the type of the coefficients of the constraints; it's not even clear we can guess this *a priori*. So this isn't a bug after all.\n\nBut, I'd like someone else's opinion.",
    "created_at": "2011-09-05T19:24:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155834",
    "user": "https://github.com/johnperry-math"
}
```

<a id='comment:19'></a>As I suspected, it's a typing problem. Normalization performs a division, and `1/2` simplifies to `0` if `1` is an `int`. If `1` is an `Integer` or a `Rational`, then `1/2` simplifies to a `Rational`.

This strikes me as a matter best left to the client: the normalization shouldn't choose the type of the coefficients of the constraints; it's not even clear we can guess this *a priori*. So this isn't a bug after all.

But, I'd like someone else's opinion.



---

archive/issue_comments_155835.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2011-09-05T19:24:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155835",
    "user": "https://github.com/johnperry-math"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_comments_155836.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,35 @@\n+MixedIntegerLinearProgram doesn't notice when it is given constraints that already exist in the program, or that are constant multiples. A simple example:\n \n+```\n+sage: lp = MixedIntegerLinearProgram()\n+sage: for each in xrange(10):\n+....:     lp.add_constraint(lp[0]-lp[1],min=1)\n+....:     \n+sage: lp.show()\n+Maximization:\n+ \n+Constraints:\n+  1.0 <= x_0 -x_1 \n+  1.0 <= x_0 -x_1 \n+  1.0 <= x_0 -x_1 \n+  1.0 <= x_0 -x_1 \n+  1.0 <= x_0 -x_1 \n+  1.0 <= x_0 -x_1 \n+  1.0 <= x_0 -x_1 \n+  1.0 <= x_0 -x_1 \n+  1.0 <= x_0 -x_1 \n+  1.0 <= x_0 -x_1 \n+Variables:\n+  x_0 is a continuous variable (min=0.0, max=+oo)\n+  x_1 is a continuous variable (min=0.0, max=+oo)\n+```\n+Notice that the same constraint appears 10 different times.\n+\n+Apply:\n+\n+- [attachment:trac_11606_add_only_new_constraints_to_lp_using_sets.patch]\n+\n+This patch depends on #11588.\n \n Comment: 1\n \n``````\n",
    "created_at": "2011-09-06T00:54:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155836",
    "user": "https://github.com/johnperry-math"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,35 @@
+MixedIntegerLinearProgram doesn't notice when it is given constraints that already exist in the program, or that are constant multiples. A simple example:
 
+```
+sage: lp = MixedIntegerLinearProgram()
+sage: for each in xrange(10):
+....:     lp.add_constraint(lp[0]-lp[1],min=1)
+....:     
+sage: lp.show()
+Maximization:
+ 
+Constraints:
+  1.0 <= x_0 -x_1 
+  1.0 <= x_0 -x_1 
+  1.0 <= x_0 -x_1 
+  1.0 <= x_0 -x_1 
+  1.0 <= x_0 -x_1 
+  1.0 <= x_0 -x_1 
+  1.0 <= x_0 -x_1 
+  1.0 <= x_0 -x_1 
+  1.0 <= x_0 -x_1 
+  1.0 <= x_0 -x_1 
+Variables:
+  x_0 is a continuous variable (min=0.0, max=+oo)
+  x_1 is a continuous variable (min=0.0, max=+oo)
+```
+Notice that the same constraint appears 10 different times.
+
+Apply:
+
+- [attachment:trac_11606_add_only_new_constraints_to_lp_using_sets.patch]
+
+This patch depends on #11588.
 
 Comment: 1
 
``````




---

archive/issue_comments_155837.json:
```json
{
    "body": "<a id='comment:20'></a>I just noticed that the patch included depends on the patch for #11588 (copying a linear program), and changed the description to reflect this.",
    "created_at": "2011-09-06T00:54:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155837",
    "user": "https://github.com/johnperry-math"
}
```

<a id='comment:20'></a>I just noticed that the patch included depends on the patch for #11588 (copying a linear program), and changed the description to reflect this.



---

archive/issue_comments_155838.json:
```json
{
    "body": "<a id='comment:21'></a>Yep, depends on #11607, too. That can be removed, and I'll do so in the near future.",
    "created_at": "2011-09-06T00:57:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155838",
    "user": "https://github.com/johnperry-math"
}
```

<a id='comment:21'></a>Yep, depends on #11607, too. That can be removed, and I'll do so in the near future.



---

archive/issue_comments_155839.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,35 @@\n+MixedIntegerLinearProgram doesn't notice when it is given constraints that already exist in the program, or that are constant multiples. A simple example:\n \n+```\n+sage: lp = MixedIntegerLinearProgram()\n+sage: for each in xrange(10):\n+....:     lp.add_constraint(lp[0]-lp[1],min=1)\n+....:     \n+sage: lp.show()\n+Maximization:\n+ \n+Constraints:\n+  1.0 <= x_0 -x_1 \n+  1.0 <= x_0 -x_1 \n+  1.0 <= x_0 -x_1 \n+  1.0 <= x_0 -x_1 \n+  1.0 <= x_0 -x_1 \n+  1.0 <= x_0 -x_1 \n+  1.0 <= x_0 -x_1 \n+  1.0 <= x_0 -x_1 \n+  1.0 <= x_0 -x_1 \n+  1.0 <= x_0 -x_1 \n+Variables:\n+  x_0 is a continuous variable (min=0.0, max=+oo)\n+  x_1 is a continuous variable (min=0.0, max=+oo)\n+```\n+Notice that the same constraint appears 10 different times.\n+\n+Apply:\n+\n+- [attachment:trac_11606_add_only_new_constraints_to_lp_using_sets.patch]\n+\n+This patch depends on #11588 and #11607.\n \n Comment: 1\n \n``````\n",
    "created_at": "2011-09-06T00:57:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155839",
    "user": "https://github.com/johnperry-math"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,35 @@
+MixedIntegerLinearProgram doesn't notice when it is given constraints that already exist in the program, or that are constant multiples. A simple example:
 
+```
+sage: lp = MixedIntegerLinearProgram()
+sage: for each in xrange(10):
+....:     lp.add_constraint(lp[0]-lp[1],min=1)
+....:     
+sage: lp.show()
+Maximization:
+ 
+Constraints:
+  1.0 <= x_0 -x_1 
+  1.0 <= x_0 -x_1 
+  1.0 <= x_0 -x_1 
+  1.0 <= x_0 -x_1 
+  1.0 <= x_0 -x_1 
+  1.0 <= x_0 -x_1 
+  1.0 <= x_0 -x_1 
+  1.0 <= x_0 -x_1 
+  1.0 <= x_0 -x_1 
+  1.0 <= x_0 -x_1 
+Variables:
+  x_0 is a continuous variable (min=0.0, max=+oo)
+  x_1 is a continuous variable (min=0.0, max=+oo)
+```
+Notice that the same constraint appears 10 different times.
+
+Apply:
+
+- [attachment:trac_11606_add_only_new_constraints_to_lp_using_sets.patch]
+
+This patch depends on #11588 and #11607.
 
 Comment: 1
 
``````




---

archive/issue_comments_155840.json:
```json
{
    "body": "<a id='comment:22'></a>> but Cython defied me, claiming that generators weren't acceptable.\n\n\nOops, that's right. The current version of Cython doesn't like generators, this feature should be included in the next Cython release, and I assure you that we have been waiting for generators in Cython for a loooooooong time here. There are patches I haven't written yet \\\nwaiting for that, others that contain as a comment \"Change this as soon as we have iterators\".. Sigh :-)\n\n> Should we move that documentation out of __init__?\n\n\nWell, the current documentation of the __init__ method of the MixedIntegerLinearProgram class also appears just before, in the section's documentation (and that appears in the doc). But you are right : it's probably best to remove it just to avoid later mistakes.\n\nActually, it should just contain the line \"Constructor\" and the doctests. The command\n\n```\nsage -coverage file.pyx\n```\n\nis a statistic telling you whether all the functions have documentation and tests. It's nice to have around, but that's also why this __init__ function should have a minimal set of doctests -- so that the output of this software doesn't report that some doc is missing :-)\n\n> This strikes me as a matter best left to the client: the normalization shouldn't choose the type of the coefficients of the constraints\n\n\nYou are right in general, though in this special situation the answer has been taken from us. When a constraint is added, it is forwarded to the solver backend which is the only place where it is saved. Now, all of CPLEX/GLPK/Coin only accept floats as data. As mip.pyx is\\\n a Cython file, the best is probably to deal with float variables. By the way, why do you create so many lists ? Instead of\n\n```\ni = min_function([v for (v,coeff) in f.iteritems() if coeff != 0])\nc = f[i]\n```\n\nWhat about\n\n```\ncdef int i = 0\ncdef float c\n\nfor i, c in f.iteritems():\n    if c!= 0:\n        break\n```\n\nSorry about the delay again. I'm getting back to the point where I can deal with tasks on-the-fly, and not with the ones that should have been settled the week before :-)\n\nNathann",
    "created_at": "2011-09-08T12:11:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155840",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:22'></a>> but Cython defied me, claiming that generators weren't acceptable.


Oops, that's right. The current version of Cython doesn't like generators, this feature should be included in the next Cython release, and I assure you that we have been waiting for generators in Cython for a loooooooong time here. There are patches I haven't written yet \
waiting for that, others that contain as a comment "Change this as soon as we have iterators".. Sigh :-)

> Should we move that documentation out of __init__?


Well, the current documentation of the __init__ method of the MixedIntegerLinearProgram class also appears just before, in the section's documentation (and that appears in the doc). But you are right : it's probably best to remove it just to avoid later mistakes.

Actually, it should just contain the line "Constructor" and the doctests. The command

```
sage -coverage file.pyx
```

is a statistic telling you whether all the functions have documentation and tests. It's nice to have around, but that's also why this __init__ function should have a minimal set of doctests -- so that the output of this software doesn't report that some doc is missing :-)

> This strikes me as a matter best left to the client: the normalization shouldn't choose the type of the coefficients of the constraints


You are right in general, though in this special situation the answer has been taken from us. When a constraint is added, it is forwarded to the solver backend which is the only place where it is saved. Now, all of CPLEX/GLPK/Coin only accept floats as data. As mip.pyx is\
 a Cython file, the best is probably to deal with float variables. By the way, why do you create so many lists ? Instead of

```
i = min_function([v for (v,coeff) in f.iteritems() if coeff != 0])
c = f[i]
```

What about

```
cdef int i = 0
cdef float c

for i, c in f.iteritems():
    if c!= 0:
        break
```

Sorry about the delay again. I'm getting back to the point where I can deal with tasks on-the-fly, and not with the ones that should have been settled the week before :-)

Nathann



---

archive/issue_comments_155841.json:
```json
{
    "body": "<a id='comment:23'></a>Replying to [comment:22 ncohen]:\n> Well, the current documentation of the __init__ method of the MixedIntegerLinearProgram class also appears just before, in the section's documentation (and that appears in the doc). But you are right : it's probably best to remove it just to avoid later mistakes.\n> \n> Actually, it should just contain the line \"Constructor\" and the doctests.\n\n\nWill do.\n\n> > This strikes me as a matter best left to the client: the normalization shouldn't choose the type of the coefficients of the constraints\n\n> \n> You are right in general, though in this special situation the answer has been taken from us. When a constraint is added, it is forwarded to the solver backend which is the only place where it is saved. Now, all of CPLEX/GLPK/Coin only accept floats as data. As mip.pyx is a Cython file, the best is probably to deal with float variables.\n\n\nAre you saying I should coerce everything to floats, or leave it be? I thought to leave it be in case some future back end accepted rationals; the backends can do their own coercion.\n\n> By the way, why do you create so many lists ?\n\n\nYou seem to think I know something about proper P/Cython programming. `:-)` Thanks for the suggestion; that will help speed things up a bit, though I think my real problem lies elsewhere.\n\n> Sorry about the delay again. I'm getting back to the point where I can deal with tasks on-the-fly, and not with the ones that should have been settled the week before :-)\n\n\nNo problem. I'm in a bit of a fix myself, so it may take a few days before another patch is ready, anyway.\n\nBy the way, do you know what those colored balls next to \"opened: ... weeks ago\" mean?",
    "created_at": "2011-09-08T17:33:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155841",
    "user": "https://github.com/johnperry-math"
}
```

<a id='comment:23'></a>Replying to [comment:22 ncohen]:
> Well, the current documentation of the __init__ method of the MixedIntegerLinearProgram class also appears just before, in the section's documentation (and that appears in the doc). But you are right : it's probably best to remove it just to avoid later mistakes.
> 
> Actually, it should just contain the line "Constructor" and the doctests.


Will do.

> > This strikes me as a matter best left to the client: the normalization shouldn't choose the type of the coefficients of the constraints

> 
> You are right in general, though in this special situation the answer has been taken from us. When a constraint is added, it is forwarded to the solver backend which is the only place where it is saved. Now, all of CPLEX/GLPK/Coin only accept floats as data. As mip.pyx is a Cython file, the best is probably to deal with float variables.


Are you saying I should coerce everything to floats, or leave it be? I thought to leave it be in case some future back end accepted rationals; the backends can do their own coercion.

> By the way, why do you create so many lists ?


You seem to think I know something about proper P/Cython programming. `:-)` Thanks for the suggestion; that will help speed things up a bit, though I think my real problem lies elsewhere.

> Sorry about the delay again. I'm getting back to the point where I can deal with tasks on-the-fly, and not with the ones that should have been settled the week before :-)


No problem. I'm in a bit of a fix myself, so it may take a few days before another patch is ready, anyway.

By the way, do you know what those colored balls next to "opened: ... weeks ago" mean?



---

archive/issue_comments_155842.json:
```json
{
    "body": "<a id='comment:24'></a>> Are you saying I should coerce everything to floats, or leave it be? I thought to leave it be in case some future back end accepted rationals; the backends can do their own coercion.\n\n\nWell, I think the doubles wouldn't hurt. And I guess it would be the same for rationals if it gets implemented. The constraints in the LP would not change, all that matters is that equivalent constraints get coerced to the same values `:-)`\n\n> that will help speed things up a bit, though I think my real problem lies  elsewhere.\n\n\nYep, unfortunately `:-)`\n\n> By the way, do you know what those colored balls next to \"opened: ... weeks ago\" mean?\n\n\nOh. Did you try clicking on them ? The patches uploaded on a trac ticket are automatically applied and tested on a Sage install, and this ball prints the status of this operation. Browse the other tickets waiting for review and see how it changes `;-)`\n\nNathann",
    "created_at": "2011-09-08T18:28:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155842",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:24'></a>> Are you saying I should coerce everything to floats, or leave it be? I thought to leave it be in case some future back end accepted rationals; the backends can do their own coercion.


Well, I think the doubles wouldn't hurt. And I guess it would be the same for rationals if it gets implemented. The constraints in the LP would not change, all that matters is that equivalent constraints get coerced to the same values `:-)`

> that will help speed things up a bit, though I think my real problem lies  elsewhere.


Yep, unfortunately `:-)`

> By the way, do you know what those colored balls next to "opened: ... weeks ago" mean?


Oh. Did you try clicking on them ? The patches uploaded on a trac ticket are automatically applied and tested on a Sage install, and this ball prints the status of this operation. Browse the other tickets waiting for review and see how it changes `;-)`

Nathann



---

archive/issue_comments_155843.json:
```json
{
    "body": "<a id='comment:25'></a>Replying to [comment:24 ncohen]:\n> Oh. Did you try clicking on them ?\n\n\nI did, and I don't seem any status of an automatic patch and test. It seems only to summarize the data. Then there's a long horizontal line & white space.\n\nThe only thing I've noticed is that different patches sometimes have different colors.",
    "created_at": "2011-09-08T18:47:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155843",
    "user": "https://github.com/johnperry-math"
}
```

<a id='comment:25'></a>Replying to [comment:24 ncohen]:
> Oh. Did you try clicking on them ?


I did, and I don't seem any status of an automatic patch and test. It seems only to summarize the data. Then there's a long horizontal line & white space.

The only thing I've noticed is that different patches sometimes have different colors.



---

archive/issue_comments_155844.json:
```json
{
    "body": "<a id='comment:26'></a>http://trac.sagemath.org/sage_trac/ticket/11279",
    "created_at": "2011-09-08T18:49:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155844",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:26'></a>http://trac.sagemath.org/sage_trac/ticket/11279



---

archive/issue_comments_155845.json:
```json
{
    "body": "<a id='comment:27'></a>Replying to [comment:26 ncohen]:\n> http://trac.sagemath.org/sage_trac/ticket/11279\n\n\n???",
    "created_at": "2011-09-08T21:25:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155845",
    "user": "https://github.com/johnperry-math"
}
```

<a id='comment:27'></a>Replying to [comment:26 ncohen]:
> http://trac.sagemath.org/sage_trac/ticket/11279


???



---

archive/issue_comments_155846.json:
```json
{
    "body": "<a id='comment:28'></a>(On this ticket the circle is yellow and you will have more complete information if yo click on it)",
    "created_at": "2011-09-09T05:43:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155846",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:28'></a>(On this ticket the circle is yellow and you will have more complete information if yo click on it)



---

archive/issue_comments_155847.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2011-09-12T23:50:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155847",
    "user": "https://github.com/johnperry-math"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_155848.json:
```json
{
    "body": "<a id='comment:29'></a>The new patch reflects changes described above.",
    "created_at": "2011-09-12T23:50:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155848",
    "user": "https://github.com/johnperry-math"
}
```

<a id='comment:29'></a>The new patch reflects changes described above.



---

archive/issue_comments_155849.json:
```json
{
    "body": "<a id='comment:30'></a>The only change was to rebase the patch against the revised #11607.",
    "created_at": "2011-10-17T20:09:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155849",
    "user": "https://github.com/johnperry-math"
}
```

<a id='comment:30'></a>The only change was to rebase the patch against the revised #11607.



---

archive/issue_comments_155850.json:
```json
{
    "body": "<a id='comment:31'></a>***bump*** any chance of a review?",
    "created_at": "2011-12-06T21:44:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155850",
    "user": "https://github.com/johnperry-math"
}
```

<a id='comment:31'></a>***bump*** any chance of a review?



---

archive/issue_comments_155851.json:
```json
{
    "body": "<a id='comment:32'></a>Replying to [comment:31 john_perry]:\n> ***bump*** any chance of a review?\n\n\nRightrightrightright. You did well `:-D`\n\nNathann",
    "created_at": "2011-12-07T09:24:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155851",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:32'></a>Replying to [comment:31 john_perry]:
> ***bump*** any chance of a review?


Rightrightrightright. You did well `:-D`

Nathann



---

archive/issue_comments_155852.json:
```json
{
    "body": "<a id='comment:33'></a>Hellooooooo again !\n\nI have less than 30 minutes of battery left but it should be ok `:-D`\n\nSo. First, and before anything else, this patch needs to be rebased on the current version of Sage. This patch defines two methods (``constraints`` and ``number of contraints``) which have been added by another patch already, so Sage refuses to run when this patch is applied.\n\nShort of this, the patch looks good, so once this is settled it should be good to go `:-)`\n\nNathann",
    "created_at": "2011-12-08T00:19:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155852",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:33'></a>Hellooooooo again !

I have less than 30 minutes of battery left but it should be ok `:-D`

So. First, and before anything else, this patch needs to be rebased on the current version of Sage. This patch defines two methods (``constraints`` and ``number of contraints``) which have been added by another patch already, so Sage refuses to run when this patch is applied.

Short of this, the patch looks good, so once this is settled it should be good to go `:-)`

Nathann



---

archive/issue_comments_155853.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-12-08T00:19:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155853",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_155854.json:
```json
{
    "body": "Attachment [trac_11606_add_only_new_constraints_to_lp_using_sets.patch](tarball://root/attachments/some-uuid/ticket11606/trac_11606_add_only_new_constraints_to_lp_using_sets.patch) by @johnperry-math created at 2011-12-21 21:32:58",
    "created_at": "2011-12-21T21:32:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155854",
    "user": "https://github.com/johnperry-math"
}
```

Attachment [trac_11606_add_only_new_constraints_to_lp_using_sets.patch](tarball://root/attachments/some-uuid/ticket11606/trac_11606_add_only_new_constraints_to_lp_using_sets.patch) by @johnperry-math created at 2011-12-21 21:32:58



---

archive/issue_comments_155855.json:
```json
{
    "body": "<a id='comment:34'></a>I have rebased the patch against `sage-4.8.alpha4`. This patch **no longer** introduces the function `constraints()` that existed in the previous patch, and that caused the conflict. It does not provoke any doctest failures on my version of `sage-4.8.alpha4`.\n\nHowever, I did notice that three doctest failures currently occur with `sage-4.8.alpha4`:\n\n```\nFile \"/Applications/sage-4.8.alpha4/devel/sage-main/sage/numerical/mip.pyx\", line 523:\n    sage: p.show()\nExpected:\n...\nFile \"/Applications/sage-4.8.alpha4/devel/sage-main/sage/numerical/mip.pyx\", line 685:\n    sage: p.write_lp(SAGE_TMP+\"/lp_problem.lp\")\nException raised:\n...\nFile \"/Applications/sage-4.8.alpha4/devel/sage-main/sage/numerical/mip.pyx\", line 322:\n    sage: p\nExpected:\n...\n```\nSince these exist in an unpatched `sage-4.8.alpha4`, they have no bearing on this ticket, but is this a known issue? I'll open a new ticket if not. My machine is a MacBook Pro running OSX 10.6.8.",
    "created_at": "2011-12-21T21:41:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155855",
    "user": "https://github.com/johnperry-math"
}
```

<a id='comment:34'></a>I have rebased the patch against `sage-4.8.alpha4`. This patch **no longer** introduces the function `constraints()` that existed in the previous patch, and that caused the conflict. It does not provoke any doctest failures on my version of `sage-4.8.alpha4`.

However, I did notice that three doctest failures currently occur with `sage-4.8.alpha4`:

```
File "/Applications/sage-4.8.alpha4/devel/sage-main/sage/numerical/mip.pyx", line 523:
    sage: p.show()
Expected:
...
File "/Applications/sage-4.8.alpha4/devel/sage-main/sage/numerical/mip.pyx", line 685:
    sage: p.write_lp(SAGE_TMP+"/lp_problem.lp")
Exception raised:
...
File "/Applications/sage-4.8.alpha4/devel/sage-main/sage/numerical/mip.pyx", line 322:
    sage: p
Expected:
...
```
Since these exist in an unpatched `sage-4.8.alpha4`, they have no bearing on this ticket, but is this a known issue? I'll open a new ticket if not. My machine is a MacBook Pro running OSX 10.6.8.



---

archive/issue_comments_155856.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-12-21T21:41:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155856",
    "user": "https://github.com/johnperry-math"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_155857.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-12-21T21:50:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155857",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_155858.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Nathann Cohen\"",
    "created_at": "2011-12-21T21:50:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155858",
    "user": "https://github.com/nathanncohen"
}
```

Changing reviewer from "" to "Nathann Cohen"



---

archive/issue_comments_155859.json:
```json
{
    "body": "<a id='comment:35'></a>Positive review to this patch, which passes all tests ! `:-)`\n\nJohn, I do not see the errors you mentionned on my alpha4. The fact that the write_lp and p.show return errors lead me to think that you have CBC installed. Is this true ? `:-)`\nThrough OsiCbcSolverInterface, I did not find how to write those files and some \"names\" in the structure of a LP were not available (like the \"name of the lp\", or the \"name of the objective function\"), and because of that I did not enable the names in the CBc interface. Perhaps this is one of the things that would be fixed by a real interface with Cbc. But anyway, I guess those bugs only appear on your install because of Cbc. They can also be \"fixed\" by adding \"solver= GLPK\"in the doctests above.\n\nThank you for this patch ! `:-)`\n\nNathann",
    "created_at": "2011-12-21T21:50:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155859",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:35'></a>Positive review to this patch, which passes all tests ! `:-)`

John, I do not see the errors you mentionned on my alpha4. The fact that the write_lp and p.show return errors lead me to think that you have CBC installed. Is this true ? `:-)`
Through OsiCbcSolverInterface, I did not find how to write those files and some "names" in the structure of a LP were not available (like the "name of the lp", or the "name of the objective function"), and because of that I did not enable the names in the CBc interface. Perhaps this is one of the things that would be fixed by a real interface with Cbc. But anyway, I guess those bugs only appear on your install because of Cbc. They can also be "fixed" by adding "solver= GLPK"in the doctests above.

Thank you for this patch ! `:-)`

Nathann



---

archive/issue_comments_155860.json:
```json
{
    "body": "Changing author from \"john_perry\" to \"John Perry\"",
    "created_at": "2011-12-21T21:50:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155860",
    "user": "https://github.com/nathanncohen"
}
```

Changing author from "john_perry" to "John Perry"



---

archive/issue_events_030447.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-12-22T16:42:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "milestone": "sage-5.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11606#event-30447"
}
```



---

archive/issue_comments_155861.json:
```json
{
    "body": "<a id='comment:37'></a>Weird. I saw jdemeyer's change yesterday, but not ncohen's change two days ago.\n\n> John, I do not see the errors you mentionned on my alpha4. The fact that the write_lp and p.show return errors lead me to think that you have CBC installed. Is this true ? :-)\n\n\nBingo!\n\nAs I see, Cbc is a real problem for us, even though it seems good for me personally... then again, maybe not if I look at it long enough :-(",
    "created_at": "2011-12-23T15:54:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155861",
    "user": "https://github.com/johnperry-math"
}
```

<a id='comment:37'></a>Weird. I saw jdemeyer's change yesterday, but not ncohen's change two days ago.

> John, I do not see the errors you mentionned on my alpha4. The fact that the write_lp and p.show return errors lead me to think that you have CBC installed. Is this true ? :-)


Bingo!

As I see, Cbc is a real problem for us, even though it seems good for me personally... then again, maybe not if I look at it long enough :-(



---

archive/issue_comments_155862.json:
```json
{
    "body": "<a id='comment:38'></a>> As I see, Cbc is a real problem for us, even though it seems good for me personally... then again, maybe not if I look at it long enough :-(\n\n\nWell, if you find out how to solve a MIP using Coin's library without using OsiCbcSolverInterface, just let me know. This solver is driving me mad `:-p`\n\nNathann",
    "created_at": "2011-12-23T15:57:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155862",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:38'></a>> As I see, Cbc is a real problem for us, even though it seems good for me personally... then again, maybe not if I look at it long enough :-(


Well, if you find out how to solve a MIP using Coin's library without using OsiCbcSolverInterface, just let me know. This solver is driving me mad `:-p`

Nathann



---

archive/issue_comments_155863.json:
```json
{
    "body": "Changing merged from \"\" to \"sage-5.0.beta1\"",
    "created_at": "2012-01-18T08:15:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155863",
    "user": "https://github.com/jdemeyer"
}
```

Changing merged from "" to "sage-5.0.beta1"



---

archive/issue_comments_155864.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-01-18T08:15:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155864",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_030448.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-01-18T08:15:46Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11606#event-30448"
}
```



---

archive/issue_comments_155865.json:
```json
{
    "body": "<a id='comment:40'></a>Apply trac_11606_add_only_new_constraints_to_lp_using_sets.patch\n\n(for legacy patchbots running 4.8)",
    "created_at": "2012-03-12T17:35:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11606#issuecomment-155865",
    "user": "https://github.com/loefflerd"
}
```

<a id='comment:40'></a>Apply trac_11606_add_only_new_constraints_to_lp_using_sets.patch

(for legacy patchbots running 4.8)
