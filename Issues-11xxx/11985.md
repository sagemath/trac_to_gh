# Issue 11985: lcalc is too verbose (mysterious "Warning: new stack size")

archive/issues_011813.json:
```json
{
    "body": "I tried one simple example \"by hand\" that actually *uses* lcalc, and was not pleased by what happened:\n\n```\nsage: E = EllipticCurve('37a')\nsage: L = E.lseries()\nsage: L.zeros(10)\n  ***   Warning: new stack size = 1030944 (0.983 Mbytes).\n[0.000000000, 5.00317001, 6.87039122, 8.01433081, 9.93309835, 10.7751382, 11.7573247, 12.9583864, 15.6038579, 16.1920174]\nsage: L.zeros(10)\n  ***   Warning: new stack size = 1030944 (0.983 Mbytes).\n[0.000000000, 5.00317001, 6.87039122, 8.01433081, 9.93309835, 10.7751382, 11.7573247, 12.9583864, 15.6038579, 16.1920174]\n```\nBasically, every time you use lcalc to do anything with elliptic curve L-series, you get some mysterious warning (of course, really output from PARI).   However, the problem has been in released Sage for a long time.    It was in sage-4.7.  \n\nAssignee: @jdemeyer\n\nKeywords: lcalc\n\nReviewer: Travis Scrimshaw\n\nAuthor: Jeroen Demeyer\n\nBranch: u/jdemeyer/ticket/11985\n\nDependencies: #9640\n\nCommit: f609cb0e20f8b23b95a7f1d9a74f0ab9ef37f899\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/11985\n\n",
    "closed_at": "2014-02-03T16:07:49Z",
    "created_at": "2011-11-03T00:28:32Z",
    "labels": [
        "component: interfaces",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.2",
    "title": "lcalc is too verbose (mysterious \"Warning: new stack size\")",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11985",
    "user": "https://github.com/williamstein"
}
```
I tried one simple example "by hand" that actually *uses* lcalc, and was not pleased by what happened:

```
sage: E = EllipticCurve('37a')
sage: L = E.lseries()
sage: L.zeros(10)
  ***   Warning: new stack size = 1030944 (0.983 Mbytes).
[0.000000000, 5.00317001, 6.87039122, 8.01433081, 9.93309835, 10.7751382, 11.7573247, 12.9583864, 15.6038579, 16.1920174]
sage: L.zeros(10)
  ***   Warning: new stack size = 1030944 (0.983 Mbytes).
[0.000000000, 5.00317001, 6.87039122, 8.01433081, 9.93309835, 10.7751382, 11.7573247, 12.9583864, 15.6038579, 16.1920174]
```
Basically, every time you use lcalc to do anything with elliptic curve L-series, you get some mysterious warning (of course, really output from PARI).   However, the problem has been in released Sage for a long time.    It was in sage-4.7.  

Assignee: @jdemeyer

Keywords: lcalc

Reviewer: Travis Scrimshaw

Author: Jeroen Demeyer

Branch: u/jdemeyer/ticket/11985

Dependencies: #9640

Commit: f609cb0e20f8b23b95a7f1d9a74f0ab9ef37f899

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/11985





---

archive/issue_comments_165586.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#9640\"",
    "created_at": "2011-11-03T08:16:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11985#issuecomment-165586",
    "user": "https://github.com/jdemeyer"
}
```

Changing dependencies from "" to "#9640"



---

archive/issue_comments_165587.json:
```json
{
    "body": "Changing assignee from @JohnCremona to @jdemeyer.",
    "created_at": "2011-11-03T08:17:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11985#issuecomment-165587",
    "user": "https://github.com/jdemeyer"
}
```

Changing assignee from @JohnCremona to @jdemeyer.



---

archive/issue_comments_165588.json:
```json
{
    "body": "Changing component from elliptic curves to interfaces.",
    "created_at": "2011-11-03T08:17:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11985#issuecomment-165588",
    "user": "https://github.com/jdemeyer"
}
```

Changing component from elliptic curves to interfaces.



---

archive/issue_comments_165589.json:
```json
{
    "body": "Milestone sage-4.7.3 deleted",
    "created_at": "2011-11-03T16:14:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11985#issuecomment-165589",
    "user": "https://github.com/jdemeyer"
}
```

Milestone sage-4.7.3 deleted



---

archive/issue_comments_165590.json:
```json
{
    "body": "Changing branch from \"\" to \"u/jdemeyer/ticket/11985\"",
    "created_at": "2014-01-06T13:30:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11985#issuecomment-165590",
    "user": "https://github.com/jdemeyer"
}
```

Changing branch from "" to "u/jdemeyer/ticket/11985"



---

archive/issue_comments_165591.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-01-06T13:30:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11985#issuecomment-165591",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_165592.json:
```json
{
    "body": "Changing commit from \"\" to \"d2ae836f3c5daea16049dbf02531be5429f90fbf\"",
    "created_at": "2014-01-06T14:05:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11985#issuecomment-165592",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "" to "d2ae836f3c5daea16049dbf02531be5429f90fbf"



---

archive/issue_comments_165593.json:
```json
{
    "body": "<a id='comment:6'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                          |                                                        |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------|\n|[d2ae836](http://git.sagemath.org/sage.git/commit/?id=d2ae836f3c5daea16049dbf02531be5429f90fbf)|`Use pari_init_stack() instead of old allocatemoremem()`|",
    "created_at": "2014-01-06T14:05:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11985#issuecomment-165593",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                          |                                                        |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------|
|[d2ae836](http://git.sagemath.org/sage.git/commit/?id=d2ae836f3c5daea16049dbf02531be5429f90fbf)|`Use pari_init_stack() instead of old allocatemoremem()`|



---

archive/issue_comments_165594.json:
```json
{
    "body": "Changing commit from \"d2ae836f3c5daea16049dbf02531be5429f90fbf\" to \"f609cb0e20f8b23b95a7f1d9a74f0ab9ef37f899\"",
    "created_at": "2014-01-06T14:12:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11985#issuecomment-165594",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "d2ae836f3c5daea16049dbf02531be5429f90fbf" to "f609cb0e20f8b23b95a7f1d9a74f0ab9ef37f899"



---

archive/issue_comments_165595.json:
```json
{
    "body": "<a id='comment:7'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                          |                                                        |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------|\n|[f609cb0](http://git.sagemath.org/sage.git/commit/?id=f609cb0e20f8b23b95a7f1d9a74f0ab9ef37f899)|`Use pari_init_stack() instead of old allocatemoremem()`|",
    "created_at": "2014-01-06T14:12:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11985#issuecomment-165595",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                          |                                                        |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------|
|[f609cb0](http://git.sagemath.org/sage.git/commit/?id=f609cb0e20f8b23b95a7f1d9a74f0ab9ef37f899)|`Use pari_init_stack() instead of old allocatemoremem()`|



---

archive/issue_events_031774.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-01-06T14:14:37Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11985",
    "milestone": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11985#event-31774"
}
```



---

archive/issue_comments_165596.json:
```json
{
    "body": "Changing author from \"\" to \"Jeroen Demeyer\"",
    "created_at": "2014-01-06T14:14:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11985#issuecomment-165596",
    "user": "https://github.com/jdemeyer"
}
```

Changing author from "" to "Jeroen Demeyer"



---

archive/issue_comments_165597.json:
```json
{
    "body": "Changing keywords from \"\" to \"lcalc\".",
    "created_at": "2014-01-06T15:34:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11985#issuecomment-165597",
    "user": "https://github.com/fchapoton"
}
```

Changing keywords from "" to "lcalc".



---

archive/issue_comments_165598.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-01-09T02:38:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11985#issuecomment-165598",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_165599.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2014-01-09T02:38:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11985#issuecomment-165599",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw"



---

archive/issue_comments_165600.json:
```json
{
    "body": "<a id='comment:10'></a>\nLooks good to me.",
    "created_at": "2014-01-09T02:38:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11985#issuecomment-165600",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:10'></a>
Looks good to me.



---

archive/issue_comments_165601.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-01-11T14:56:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11985#issuecomment-165601",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_031775.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-01-11T14:56:07Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11985",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11985#event-31775"
}
```



---

archive/issue_comments_165602.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2014-01-15T20:15:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11985#issuecomment-165602",
    "user": "https://github.com/vbraun"
}
```

Changing status from closed to new.



---

archive/issue_events_031776.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-01-15T20:15:58Z",
    "event": "reopened",
    "issue": "https://github.com/sagemath/sagetest/issues/11985",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11985#event-31776"
}
```



---

archive/issue_comments_165603.json:
```json
{
    "body": "Resolution changed from fixed to ",
    "created_at": "2014-01-15T20:15:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11985#issuecomment-165603",
    "user": "https://github.com/vbraun"
}
```

Resolution changed from fixed to 



---

archive/issue_comments_165604.json:
```json
{
    "body": "<a id='comment:12'></a>\nI got this on mod during a doctests (somewhat random failure):\n\n```\nsage -t --long src/sage/schemes/elliptic_curves/lseries_ell.py\n**********************************************************************\nFile \"src/sage/schemes/elliptic_curves/lseries_ell.py\", line 243, in sage.schemes.elliptic_curves.lseries_ell.Lseries_ell.zeros\nFailed example:\n    E.lseries().zeros(2)\nExpected:\n    [0.000000000, 5.00317001]\nGot:\n      ***   Warning: not enough memory, new stack 1000000000.\n    [0.000000000, 5.00317001]\n**********************************************************************\nFile \"src/sage/schemes/elliptic_curves/lseries_ell.py\", line 246, in sage.schemes.elliptic_curves.lseries_ell.Lseries_ell.zeros\nFailed example:\n    a = E.lseries().zeros(20)             # long time\nExpected nothing\nGot:\n      ***   Warning: not enough memory, new stack 1000000000.\n**********************************************************************\n1 item had failures:\n```\nThis is also with #13163 but I'm pretty sure this ticket is the culprit...",
    "created_at": "2014-01-15T20:15:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11985#issuecomment-165604",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:12'></a>
I got this on mod during a doctests (somewhat random failure):

```
sage -t --long src/sage/schemes/elliptic_curves/lseries_ell.py
**********************************************************************
File "src/sage/schemes/elliptic_curves/lseries_ell.py", line 243, in sage.schemes.elliptic_curves.lseries_ell.Lseries_ell.zeros
Failed example:
    E.lseries().zeros(2)
Expected:
    [0.000000000, 5.00317001]
Got:
      ***   Warning: not enough memory, new stack 1000000000.
    [0.000000000, 5.00317001]
**********************************************************************
File "src/sage/schemes/elliptic_curves/lseries_ell.py", line 246, in sage.schemes.elliptic_curves.lseries_ell.Lseries_ell.zeros
Failed example:
    a = E.lseries().zeros(20)             # long time
Expected nothing
Got:
      ***   Warning: not enough memory, new stack 1000000000.
**********************************************************************
1 item had failures:
```
This is also with #13163 but I'm pretty sure this ticket is the culprit...



---

archive/issue_comments_165605.json:
```json
{
    "body": "<a id='comment:13'></a>\nPlease confirm that the system you were building this on was not low on memory. From reading the PARI sources, it looks like that message can only occur after a failed `malloc()`. You should make sure doctests have 2.5GB of memory available.",
    "created_at": "2014-01-15T22:16:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11985#issuecomment-165605",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>
Please confirm that the system you were building this on was not low on memory. From reading the PARI sources, it looks like that message can only occur after a failed `malloc()`. You should make sure doctests have 2.5GB of memory available.



---

archive/issue_comments_165606.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2014-01-15T22:16:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11985#issuecomment-165606",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_165607.json:
```json
{
    "body": "Changing status from needs_info to positive_review.",
    "created_at": "2014-01-15T22:16:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11985#issuecomment-165607",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_info to positive_review.



---

archive/issue_comments_165608.json:
```json
{
    "body": "<a id='comment:15'></a>\nAs I said its on mod, so a pretty beefy machine with 128GB ram. Of course I don't know exactly what happened, but I think its pretty unlikely that some runaway process ate everything except 2% of the available ram such that only this doctest failed. Twice in a row.",
    "created_at": "2014-01-16T04:36:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11985#issuecomment-165608",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:15'></a>
As I said its on mod, so a pretty beefy machine with 128GB ram. Of course I don't know exactly what happened, but I think its pretty unlikely that some runaway process ate everything except 2% of the available ram such that only this doctest failed. Twice in a row.



---

archive/issue_comments_165609.json:
```json
{
    "body": "<a id='comment:16'></a>\nDon't forget that `mod` also runs the Sage Notebook server, which might make your scenario more likely. Were you testing many jobs in parallel? And were those the only doctest failures that you got?",
    "created_at": "2014-01-16T07:25:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11985#issuecomment-165609",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>
Don't forget that `mod` also runs the Sage Notebook server, which might make your scenario more likely. Were you testing many jobs in parallel? And were those the only doctest failures that you got?



---

archive/issue_comments_165610.json:
```json
{
    "body": "<a id='comment:17'></a>\nThat was the only failure in the whole build process and, at least when I checked later, there were tons (~50GB) of free memory. The buildbot always tests the same number of processes, no more, no less.",
    "created_at": "2014-01-16T16:41:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11985#issuecomment-165610",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:17'></a>
That was the only failure in the whole build process and, at least when I checked later, there were tons (~50GB) of free memory. The buildbot always tests the same number of processes, no more, no less.



---

archive/issue_events_031777.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11985",
    "milestone": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11985#event-31777"
}
```



---

archive/issue_events_031778.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11985",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11985#event-31778"
}
```



---

archive/issue_comments_165611.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-02-03T16:07:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11985#issuecomment-165611",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_031779.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-02-03T16:07:49Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11985",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11985#event-31779"
}
```
