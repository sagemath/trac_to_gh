# Issue 11921: Allow Sympy conversion sign/sgn

archive/issues_011749.json:
```json
{
    "body": "From [this thread on sage-support](http://groups.google.com/group/sage-support/t/592e98fcece39df1):\n\n```\nHi, \nSage uses a dictionary to translate Sage function names to SymPy ones \nwhen they are different. \nSignal function is called \"sgn\" in Sage and \"sign\" in Sympy but the \nrespective translation is not in the dictionary, and a error is issued \nif one tries to do something like: \n   x = var('x'); sgn(x)._sympy_() \nTo fix it, it is just a matter of adding \n                \"sgn\": \"sign\", \nto the dictionary. \nSuch dictionary is called \"translation_table\" and it is inside \nfunction \"composition\" from class \"SympyConverter\" of file \"sage/ \nsymbolic/expression_conversions.py\". \nI would like to know how can I submit a patch, or ask someone to do \nit, and if it is necessary to include something in a unit test (like I \ndid for Sympy for the inverse translation). \n? \n```\n\nApply:\n* attachment:trac_11921-sympy_conversion.patch\n* attachment:trac_11921_conversionsDictionary.patch\n* attachment:trac_11921-doctest.patch\n* attachment:trac_11921-reviewer.patch\n\nAssignee: @burcin\n\nKeywords: sympy conversion beginner\n\nReviewer: Karl-Dieter Crisman\n\nAuthor: Peter Story, Burcin Erocal\n\nMerged: sage-5.0.beta10\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/11921\n\n",
    "closed_at": "2012-03-23T15:19:55Z",
    "created_at": "2011-10-14T12:37:30Z",
    "labels": [
        "component: symbolics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.0",
    "title": "Allow Sympy conversion sign/sgn",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11921",
    "user": "https://github.com/kcrisman"
}
```
From [this thread on sage-support](http://groups.google.com/group/sage-support/t/592e98fcece39df1):

```
Hi, 
Sage uses a dictionary to translate Sage function names to SymPy ones 
when they are different. 
Signal function is called "sgn" in Sage and "sign" in Sympy but the 
respective translation is not in the dictionary, and a error is issued 
if one tries to do something like: 
   x = var('x'); sgn(x)._sympy_() 
To fix it, it is just a matter of adding 
                "sgn": "sign", 
to the dictionary. 
Such dictionary is called "translation_table" and it is inside 
function "composition" from class "SympyConverter" of file "sage/ 
symbolic/expression_conversions.py". 
I would like to know how can I submit a patch, or ask someone to do 
it, and if it is necessary to include something in a unit test (like I 
did for Sympy for the inverse translation). 
? 
```

Apply:
* attachment:trac_11921-sympy_conversion.patch
* attachment:trac_11921_conversionsDictionary.patch
* attachment:trac_11921-doctest.patch
* attachment:trac_11921-reviewer.patch

Assignee: @burcin

Keywords: sympy conversion beginner

Reviewer: Karl-Dieter Crisman

Author: Peter Story, Burcin Erocal

Merged: sage-5.0.beta10

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/11921





---

archive/issue_comments_133513.json:
```json
{
    "body": "<a id='comment:1'></a>The conversions should be specified with the `conversions` argument to the `BuiltinFunction` constructor. Having the conversion near the function definition is easier to maintain than that table.\n\nIn this case, the constructor for sage.functions.generalized.FunctionSignum should be changed to include `'sympy': 'sign'` in the `conversions` argument.",
    "created_at": "2011-10-18T17:51:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11921#issuecomment-133513",
    "user": "https://github.com/burcin"
}
```

<a id='comment:1'></a>The conversions should be specified with the `conversions` argument to the `BuiltinFunction` constructor. Having the conversion near the function definition is easier to maintain than that table.

In this case, the constructor for sage.functions.generalized.FunctionSignum should be changed to include `'sympy': 'sign'` in the `conversions` argument.



---

archive/issue_comments_133514.json:
```json
{
    "body": "Milestone sage-4.7.3 deleted",
    "created_at": "2011-11-03T16:14:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11921#issuecomment-133514",
    "user": "https://github.com/jdemeyer"
}
```

Milestone sage-4.7.3 deleted



---

archive/issue_events_031524.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/peter.story",
    "created_at": "2012-01-11T16:28:48Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11921",
    "milestone": "sage-5.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11921#event-31524"
}
```



---

archive/issue_comments_133515.json:
```json
{
    "body": "<a id='comment:3'></a>Attachment [trac_11921_conversionsDictionary.patch](tarball://root/attachments/some-uuid/ticket11921/trac_11921_conversionsDictionary.patch) by peter.story created at 2012-01-11 16:28:48\n\nI performed the addition to the conversions argument as requested by burcin.\n\n\nHowever, `x = var('x'); sgn(x)._sympy_()` still fails.",
    "created_at": "2012-01-11T16:28:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11921#issuecomment-133515",
    "user": "https://trac.sagemath.org/admin/accounts/users/peter.story"
}
```

<a id='comment:3'></a>Attachment [trac_11921_conversionsDictionary.patch](tarball://root/attachments/some-uuid/ticket11921/trac_11921_conversionsDictionary.patch) by peter.story created at 2012-01-11 16:28:48

I performed the addition to the conversions argument as requested by burcin.


However, `x = var('x'); sgn(x)._sympy_()` still fails.



---

archive/issue_comments_133516.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-01-11T16:34:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11921#issuecomment-133516",
    "user": "https://trac.sagemath.org/admin/accounts/users/peter.story"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_133517.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-01-11T16:34:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11921#issuecomment-133517",
    "user": "https://trac.sagemath.org/admin/accounts/users/peter.story"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_133518.json:
```json
{
    "body": "Attachment [trac_11921-sympy_conversion.patch](tarball://root/attachments/some-uuid/ticket11921/trac_11921-sympy_conversion.patch) by @burcin created at 2012-01-11 18:03:52",
    "created_at": "2012-01-11T18:03:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11921#issuecomment-133518",
    "user": "https://github.com/burcin"
}
```

Attachment [trac_11921-sympy_conversion.patch](tarball://root/attachments/some-uuid/ticket11921/trac_11921-sympy_conversion.patch) by @burcin created at 2012-01-11 18:03:52



---

archive/issue_comments_133519.json:
```json
{
    "body": "<a id='comment:6'></a>I was wrong. For some reason, `SympyConverter.composition()` method defined a translation table of its own. attachment:trac_11921-sympy_conversion.patch fixes it to go through the standard mechanism. Your patch should work now.\n\nWe still need doctests to switch this to needs_review.",
    "created_at": "2012-01-11T18:05:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11921#issuecomment-133519",
    "user": "https://github.com/burcin"
}
```

<a id='comment:6'></a>I was wrong. For some reason, `SympyConverter.composition()` method defined a translation table of its own. attachment:trac_11921-sympy_conversion.patch fixes it to go through the standard mechanism. Your patch should work now.

We still need doctests to switch this to needs_review.



---

archive/issue_comments_133520.json:
```json
{
    "body": "Attachment [trac_11921-doctest.patch](tarball://root/attachments/some-uuid/ticket11921/trac_11921-doctest.patch) by @burcin created at 2012-02-08 12:03:33",
    "created_at": "2012-02-08T12:03:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11921#issuecomment-133520",
    "user": "https://github.com/burcin"
}
```

Attachment [trac_11921-doctest.patch](tarball://root/attachments/some-uuid/ticket11921/trac_11921-doctest.patch) by @burcin created at 2012-02-08 12:03:33



---

archive/issue_comments_133521.json:
```json
{
    "body": "<a id='comment:7'></a>I attached a new patch that adds a doctest as well. This is ready for review now.",
    "created_at": "2012-02-08T12:05:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11921#issuecomment-133521",
    "user": "https://github.com/burcin"
}
```

<a id='comment:7'></a>I attached a new patch that adds a doctest as well. This is ready for review now.



---

archive/issue_comments_133522.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-02-08T12:05:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11921#issuecomment-133522",
    "user": "https://github.com/burcin"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_133523.json:
```json
{
    "body": "<a id='comment:8'></a>I like everything here, good simplification and clarification of all this.  \n\nI'd like a different example, though!  \n\n```\nsage: from sage.symbolic.function import SymbolicFunction \nsage: f = SymbolicFunction('f', conversions=dict(sympy='ff'))\nsage: f(x)\nf(x)\nsage: f(x)._sympy_()\n<snip>\nValueError: Function FallingFactorial expects 2 argument(s), got 1.\n```\nWell!  That was a surprise.\n\nSo I'm adding a reviewer patch that just swaps `g` for `f` and then documents the less surprising error that sympy has no `gg` function.",
    "created_at": "2012-03-16T02:54:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11921#issuecomment-133523",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:8'></a>I like everything here, good simplification and clarification of all this.  

I'd like a different example, though!  

```
sage: from sage.symbolic.function import SymbolicFunction 
sage: f = SymbolicFunction('f', conversions=dict(sympy='ff'))
sage: f(x)
f(x)
sage: f(x)._sympy_()
<snip>
ValueError: Function FallingFactorial expects 2 argument(s), got 1.
```
Well!  That was a surprise.

So I'm adding a reviewer patch that just swaps `g` for `f` and then documents the less surprising error that sympy has no `gg` function.



---

archive/issue_comments_133524.json:
```json
{
    "body": "Attachment [trac_11921-reviewer.patch](tarball://root/attachments/some-uuid/ticket11921/trac_11921-reviewer.patch) by @kcrisman created at 2012-03-16 02:57:27",
    "created_at": "2012-03-16T02:57:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11921#issuecomment-133524",
    "user": "https://github.com/kcrisman"
}
```

Attachment [trac_11921-reviewer.patch](tarball://root/attachments/some-uuid/ticket11921/trac_11921-reviewer.patch) by @kcrisman created at 2012-03-16 02:57:27



---

archive/issue_comments_133525.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-03-16T02:58:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11921#issuecomment-133525",
    "user": "https://github.com/kcrisman"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_133526.json:
```json
{
    "body": "<a id='comment:9'></a>For patchbot:\n\nApply:\n* attachment:trac_11921-sympy_conversion.patch\n* attachment:trac_11921_conversionsDictionary.patch\n* attachment:trac_11921-doctest.patch\n* attachment:trac_11921-reviewer.patch",
    "created_at": "2012-03-16T02:58:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11921#issuecomment-133526",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:9'></a>For patchbot:

Apply:
* attachment:trac_11921-sympy_conversion.patch
* attachment:trac_11921_conversionsDictionary.patch
* attachment:trac_11921-doctest.patch
* attachment:trac_11921-reviewer.patch



---

archive/issue_events_031525.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-23T15:19:55Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11921",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11921#event-31525"
}
```



---

archive/issue_comments_133527.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-03-23T15:19:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11921",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11921#issuecomment-133527",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
