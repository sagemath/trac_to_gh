# Issue 11616: Upgrade MPIR to a more recent upstream release

archive/issues_011444.json:
```json
{
    "assignees": [],
    "body": "This is a follow-up to #8664 (and a couple of other tickets).\n\n\n\n\nThe following **new spkg** is based on the latest MPIR 2.1.3 spkg, the p9 from #12131:\n\n**New spkg:** [http://boxen.math.washington.edu/home/jdemeyer/spkg/mpir-2.4.0.p3.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/mpir-2.4.0.p3.spkg)\n\n### mpir-2.4.0.p3 (Jeroen Demeyer, April 26th, 2012)\n Trac #11616, reviewer fixes:\n* When the first configure run (with CFLAGS unset) of MPIR fails, bail\n  out with an error.  I am not aware of any system where MPIR fails\n  to configure with CFLAGS unset but succeeds with CFLAGS set.\n  This implies the following simplifications:\n  - We no longer read CC and CFLAGS from /usr/include/gmp.h or\n    /usr/local/include/gmp.h\n  - We no longer try to add -march=native, we simply use MPIR's flags.\n* Extract $CC and $CFLAGS from Makefile instead of mpir.h, which is\n  simpler and more reliable.\n* Added `quote_asm.patch` to add proper quoting to the m4 in .asm files.\n* Use `patch` to patch gmp-h.in instead of copying the file.\n* In get_processor_specific_cflags() in spkg-install, also check for\n  -mpower* and -mno-power* flags, as MPIR adds -mpower on 32-bit\n  PowerPC systems.\n\n### mpir-2.4.0.p2 (Leif Leonhardy, April 4th, 2012)\n #11616 (upgrading MPIR), further fixes:\n* Before enabling `-march=native`, minimalistically check whether the\n  system's assembler also understands the instructions the compiler emits\n  with that option.  (Work-around for e.g. GCC 4.6.3 on MacOS X 10.x and\n  Intel Core i7-family CPUs with AVX.)\n* Do not unconditionally unset `PYTHON`, since Sage (>=5.0.beta10) no longer\n  pollutes the environment with its package version variables, which previous-\n  ly confused yasm's `configure`.\n* Fix extraction of `__GMP_CC` and `__GMP_CFLAGS` from `gmp.h`, since MPIR\n  meanwhile defines these to preprocessor variables (rather than literals).\n  Also don't use `\\+` in `sed` patterns, as this is less portable.\n* Work around GCC 4.7.0 bug (compilation error) on Linux ia64 (Itanium) by\n  almost completely disabling optimization on that platform if GCC 4.7.x\n  is detected.  This doesn't hurt much if we later rebuild MPIR with a (non-\n  broken) GCC from the new GCC spkg.  Cf. #12765.\n* Do not build the C++ interface and static libraries when bootstrapping the\n  GCC spkg, i.e. if `SAGE_BUILD_TOOLCHAIN=yes`.  (GMP/MPIR is a prerequisite\n  for it, and MPIR will later get rebuilt with both enabled, with the newly\n  built GCC.)  Cf. #12782.\n* Fix a potential race condition in yasm's build by patching the re2c source.\n  Cf. #11844.\n* Add \"`patch` loop\" to apply any patches (`*.patch`) located in `patches/`.\n  Currently only the re2c patch matches that; the prepatched header to support\n  Sun's C compiler is still copied over (and only on SunOS, although it doesn't\n  do any harm on other platforms).\n* Minor clean-up; e.g. redirect error messages and warnings to `stderr`,\n  quote parameter to `--libdir`, add some comments and messages, also save\n  user's setting of `LDFLAGS` and `ABI`.\n\n### mpir-2.4.0.p1 (Leif Leonhardy, March 21st, 2012)\n* Upstream upgrade to MPIR 2.4.0 (#11616).\n  The 2.4.0.p0 spkg isn't in this history, as it was based\n  on the 2.1.3.p4 spkg, i.e., is \"on another branch\",\n  and never got merged into Sage.\n* Remove forcing a sequential `make install` again, since\n  the potential race condition was fixed in MPIR 2.1.4.\n* Fix `.hgtags`, which contained duplicate entries, and\n  was missing others.\n\n---\n\nThis fixes also:\n\n1. #11844: a potential race condition due to yasm when building MPIR in parallel.  We've never run into this [before] though.  The MPIR 2.4.0.**p2** spkg now includes a patch to upstream fixing that.\n\n2. #12782: when building MPIR to bootstrap GCC (i.e. when `SAGE_BUILD_TOOLCHAIN=yes`), do not build the C++ interface (and not the static library).  This would allow to build Sage on systems which have a C compiler but not a C++ compiler, and also saves time.\n\n---\n\nThe list of changes between MPIR 2.1.3 (more precisely, 2.1.1) and MPIR 2.4.0 is fairly long, so I haven't put them into the description, but [attached them](https://github.com/sagemath/sage/files/ticket11616/MPIR_upstream_changes_between_2.1.1_and_2.4.0.txt) in a plain text file.\n\n---\n\nTo install / test the spkg, it is sufficient to just\n\n1. Download the new spkg and copy it into `$SAGE_ROOT/spkg/standard/`.\n\n2. Install the MPIR spkg:\n\n```sh\n$ ./sage -f spkg/standard/mpir-<version>.spkg\n```\n\n3. Re-install all packages depending on MPIR:\n\n```sh\n$ env SAGE_UPGRADING=yes make build\n```\n   (or omit `build` to also rebuild the documentation in the same `make` run).\n\nTo run just MPIR's test suite, you can reinstall the spkg with `SAGE_CHECK=yes`:\n\n```sh\n$ env SAGE_CHECK=yes ./sage -f spkg/standard/mpir-<version>.spkg\n```\nOr, if you haven't yet installed the spkg (but copied it into `$SAGE_ROOT/spkg/standard/` as mentioned above), do:\n\n```sh\n$ env SAGE_CHECK=yes ./sage -i spkg/standard/mpir-<version>.spkg\n$ env SAGE_UPGRADING=yes make build # rebuilds all dependent packages\n```\nAfterwards you can run `make doc` to (re)build the documentation, and / or `make ptestlong` to run Sage's full test suite in parallel.\n\nAssignee: **@nexttime**\n\nCC:  justin wbhart jpflori\n\nKeywords: **sd32, GMP, SandyBridge, Westmere, yasm re2c race condition, Linux ia64 Itanium GCC 4.7.0 bug**\n\nReviewer: **Jeroen Demeyer, Leif Leonhardy, Volker Braun**\n\nAuthor: **Leif Leonhardy, Jeroen Demeyer**\n\nMerged: **sage-5.0.rc0**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/11616_\n\n",
    "closed_at": "2012-04-30T09:51:28Z",
    "created_at": "2011-07-20T20:49:56Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p1%20%E2%80%93%20blocker",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Upgrade MPIR to a more recent upstream release",
    "type": "issue",
    "updated_at": "2012-04-30T12:32:05Z",
    "url": "https://github.com/sagemath/sage/issues/11616",
    "user": "https://github.com/nexttime"
}
```
This is a follow-up to #8664 (and a couple of other tickets).




The following **new spkg** is based on the latest MPIR 2.1.3 spkg, the p9 from #12131:

**New spkg:** [http://boxen.math.washington.edu/home/jdemeyer/spkg/mpir-2.4.0.p3.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/mpir-2.4.0.p3.spkg)

### mpir-2.4.0.p3 (Jeroen Demeyer, April 26th, 2012)
 Trac #11616, reviewer fixes:
* When the first configure run (with CFLAGS unset) of MPIR fails, bail
  out with an error.  I am not aware of any system where MPIR fails
  to configure with CFLAGS unset but succeeds with CFLAGS set.
  This implies the following simplifications:
  - We no longer read CC and CFLAGS from /usr/include/gmp.h or
    /usr/local/include/gmp.h
  - We no longer try to add -march=native, we simply use MPIR's flags.
* Extract $CC and $CFLAGS from Makefile instead of mpir.h, which is
  simpler and more reliable.
* Added `quote_asm.patch` to add proper quoting to the m4 in .asm files.
* Use `patch` to patch gmp-h.in instead of copying the file.
* In get_processor_specific_cflags() in spkg-install, also check for
  -mpower* and -mno-power* flags, as MPIR adds -mpower on 32-bit
  PowerPC systems.

### mpir-2.4.0.p2 (Leif Leonhardy, April 4th, 2012)
 #11616 (upgrading MPIR), further fixes:
* Before enabling `-march=native`, minimalistically check whether the
  system's assembler also understands the instructions the compiler emits
  with that option.  (Work-around for e.g. GCC 4.6.3 on MacOS X 10.x and
  Intel Core i7-family CPUs with AVX.)
* Do not unconditionally unset `PYTHON`, since Sage (>=5.0.beta10) no longer
  pollutes the environment with its package version variables, which previous-
  ly confused yasm's `configure`.
* Fix extraction of `__GMP_CC` and `__GMP_CFLAGS` from `gmp.h`, since MPIR
  meanwhile defines these to preprocessor variables (rather than literals).
  Also don't use `\+` in `sed` patterns, as this is less portable.
* Work around GCC 4.7.0 bug (compilation error) on Linux ia64 (Itanium) by
  almost completely disabling optimization on that platform if GCC 4.7.x
  is detected.  This doesn't hurt much if we later rebuild MPIR with a (non-
  broken) GCC from the new GCC spkg.  Cf. #12765.
* Do not build the C++ interface and static libraries when bootstrapping the
  GCC spkg, i.e. if `SAGE_BUILD_TOOLCHAIN=yes`.  (GMP/MPIR is a prerequisite
  for it, and MPIR will later get rebuilt with both enabled, with the newly
  built GCC.)  Cf. #12782.
* Fix a potential race condition in yasm's build by patching the re2c source.
  Cf. #11844.
* Add "`patch` loop" to apply any patches (`*.patch`) located in `patches/`.
  Currently only the re2c patch matches that; the prepatched header to support
  Sun's C compiler is still copied over (and only on SunOS, although it doesn't
  do any harm on other platforms).
* Minor clean-up; e.g. redirect error messages and warnings to `stderr`,
  quote parameter to `--libdir`, add some comments and messages, also save
  user's setting of `LDFLAGS` and `ABI`.

### mpir-2.4.0.p1 (Leif Leonhardy, March 21st, 2012)
* Upstream upgrade to MPIR 2.4.0 (#11616).
  The 2.4.0.p0 spkg isn't in this history, as it was based
  on the 2.1.3.p4 spkg, i.e., is "on another branch",
  and never got merged into Sage.
* Remove forcing a sequential `make install` again, since
  the potential race condition was fixed in MPIR 2.1.4.
* Fix `.hgtags`, which contained duplicate entries, and
  was missing others.

---

This fixes also:

1. #11844: a potential race condition due to yasm when building MPIR in parallel.  We've never run into this [before] though.  The MPIR 2.4.0.**p2** spkg now includes a patch to upstream fixing that.

2. #12782: when building MPIR to bootstrap GCC (i.e. when `SAGE_BUILD_TOOLCHAIN=yes`), do not build the C++ interface (and not the static library).  This would allow to build Sage on systems which have a C compiler but not a C++ compiler, and also saves time.

---

The list of changes between MPIR 2.1.3 (more precisely, 2.1.1) and MPIR 2.4.0 is fairly long, so I haven't put them into the description, but [attached them](https://github.com/sagemath/sage/files/ticket11616/MPIR_upstream_changes_between_2.1.1_and_2.4.0.txt) in a plain text file.

---

To install / test the spkg, it is sufficient to just

1. Download the new spkg and copy it into `$SAGE_ROOT/spkg/standard/`.

2. Install the MPIR spkg:

```sh
$ ./sage -f spkg/standard/mpir-<version>.spkg
```

3. Re-install all packages depending on MPIR:

```sh
$ env SAGE_UPGRADING=yes make build
```
   (or omit `build` to also rebuild the documentation in the same `make` run).

To run just MPIR's test suite, you can reinstall the spkg with `SAGE_CHECK=yes`:

```sh
$ env SAGE_CHECK=yes ./sage -f spkg/standard/mpir-<version>.spkg
```
Or, if you haven't yet installed the spkg (but copied it into `$SAGE_ROOT/spkg/standard/` as mentioned above), do:

```sh
$ env SAGE_CHECK=yes ./sage -i spkg/standard/mpir-<version>.spkg
$ env SAGE_UPGRADING=yes make build # rebuilds all dependent packages
```
Afterwards you can run `make doc` to (re)build the documentation, and / or `make ptestlong` to run Sage's full test suite in parallel.

Assignee: **@nexttime**

CC:  justin wbhart jpflori

Keywords: **sd32, GMP, SandyBridge, Westmere, yasm re2c race condition, Linux ia64 Itanium GCC 4.7.0 bug**

Reviewer: **Jeroen Demeyer, Leif Leonhardy, Volker Braun**

Author: **Leif Leonhardy, Jeroen Demeyer**

Merged: **sage-5.0.rc0**

_Issue created by migration from https://trac.sagemath.org/ticket/11616_





---

archive/issue_events_137421.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-07-20T20:49:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "milestone_number": null,
    "milestone_title": "sage-5.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11616#event-137421"
}
```



---

archive/issue_events_137422.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-07-20T20:49:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
    "label_color": "000080",
    "label_name": "component: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11616#event-137422"
}
```



---

archive/issue_events_137423.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-07-20T20:49:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11616#event-137423"
}
```



---

archive/issue_events_137424.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-07-20T20:49:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11616#event-137424"
}
```



---

archive/issue_comments_121642.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,32 @@\n This is a follow-up to #8664.\n \n+The following spkgs are based on the **not yet positively reviewed** MPIR 2.1.3.p4 spkg from #8664:\n \n+* http://spkg-upload.googlecode.com/files/mpir-2.3.1.p0.spkg \n+\n+  md5sum: `ff0104e302611e49604a1c4ead97cbf4  mpir-2.3.1.p0.spkg`\n+\n+* http://spkg-upload.googlecode.com/files/mpir-2.4.0.p0.spkg \n+\n+  md5sum: `98e04aa43ceef04d83574f0ee8e152fc  mpir-2.4.0.p0.spkg`\n+\n+You may want to give them a try *now* though. (The former is just intended as a \"fallback\" spkg in case problems introduced in the latter should arise.)\n+\n+The list of changes between MPIR 2.1.3 (more precisely, 2.1.1) and MPIR 2.4.0 is fairly long, so I haven't put them into the description. I'll perhaps attach them as a text file later.\n+\n+For instructions on how to install / test the spkgs please see #8664, as these two also require the new GMP-ECM 6.3.p2 spkg from #5847 and two patches to the Sage library (one from each ticket); a Sage 4.7.1.rc0 (Sage library) spkg with these two patches already applied [comment:ticket:8664:114 is also available] *there*.\n+\n+---\n+\n+### mpir-2.4.0.p0 (Leif Leonhardy, July 21st, 2011)\n+* Upstream upgrade to MPIR 2.4.0 (#11616).\n+\n+### mpir-2.3.1.p0 (Leif Leonhardy, July 20th, 2011)\n+* Upstream upgrade to MPIR 2.3.1 (#11616).\n+* Clean up .hgtags.\n+\n+### mpir-2.1.3.p4 (Leif Leonhardy, July 19th, 2011)\n+* #8664: Upgrade Sage's MPIR spkg to version 2.1.3 \n+\n+ ...\n+\n``````\n",
    "created_at": "2011-07-22T07:32:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121642",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,32 @@
 This is a follow-up to #8664.
 
+The following spkgs are based on the **not yet positively reviewed** MPIR 2.1.3.p4 spkg from #8664:
 
+* http://spkg-upload.googlecode.com/files/mpir-2.3.1.p0.spkg 
+
+  md5sum: `ff0104e302611e49604a1c4ead97cbf4  mpir-2.3.1.p0.spkg`
+
+* http://spkg-upload.googlecode.com/files/mpir-2.4.0.p0.spkg 
+
+  md5sum: `98e04aa43ceef04d83574f0ee8e152fc  mpir-2.4.0.p0.spkg`
+
+You may want to give them a try *now* though. (The former is just intended as a "fallback" spkg in case problems introduced in the latter should arise.)
+
+The list of changes between MPIR 2.1.3 (more precisely, 2.1.1) and MPIR 2.4.0 is fairly long, so I haven't put them into the description. I'll perhaps attach them as a text file later.
+
+For instructions on how to install / test the spkgs please see #8664, as these two also require the new GMP-ECM 6.3.p2 spkg from #5847 and two patches to the Sage library (one from each ticket); a Sage 4.7.1.rc0 (Sage library) spkg with these two patches already applied [comment:ticket:8664:114 is also available] *there*.
+
+---
+
+### mpir-2.4.0.p0 (Leif Leonhardy, July 21st, 2011)
+* Upstream upgrade to MPIR 2.4.0 (#11616).
+
+### mpir-2.3.1.p0 (Leif Leonhardy, July 20th, 2011)
+* Upstream upgrade to MPIR 2.3.1 (#11616).
+* Clean up .hgtags.
+
+### mpir-2.1.3.p4 (Leif Leonhardy, July 19th, 2011)
+* #8664: Upgrade Sage's MPIR spkg to version 2.1.3 
+
+ ...
+
``````




---

archive/issue_comments_121643.json:
```json
{
    "body": "Note that some changes between 2.1.1 and 2.1.4 may be missing (documented elsewhere, i.e. at least on `mpir-devel` I think). The segfault was fixed in 2.1.3, the race condition in 2.1.4.",
    "created_at": "2011-07-22T07:49:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121643",
    "user": "https://github.com/nexttime"
}
```

Note that some changes between 2.1.1 and 2.1.4 may be missing (documented elsewhere, i.e. at least on `mpir-devel` I think). The segfault was fixed in 2.1.3, the race condition in 2.1.4.



---

archive/issue_comments_121644.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n This is a follow-up to #8664.\n \n-The following spkgs are based on the **not yet positively reviewed** MPIR 2.1.3.p4 spkg from #8664:\n+The following spkgs are based on the (not yet merged) MPIR 2.1.3.p4 spkg from #8664:\n \n * http://spkg-upload.googlecode.com/files/mpir-2.3.1.p0.spkg \n \n@@ -12,9 +12,11 @@\n \n You may want to give them a try *now* though. (The former is just intended as a \"fallback\" spkg in case problems introduced in the latter should arise.)\n \n-The list of changes between MPIR 2.1.3 (more precisely, 2.1.1) and MPIR 2.4.0 is fairly long, so I haven't put them into the description. I'll perhaps attach them as a text file later.\n+The list of changes between MPIR 2.1.3 (more precisely, 2.1.1) and MPIR 2.4.0 is fairly long, so I haven't put them into the description, but [attached them](https://github.com/sagemath/sage/files/ticket11616/MPIR_upstream_changes_between_2.1.1_and_2.4.0.txt) in a plain text file.\n \n For instructions on how to install / test the spkgs please see #8664, as these two also require the new GMP-ECM 6.3.p2 spkg from #5847 and two patches to the Sage library (one from each ticket); a Sage 4.7.1.rc0 (Sage library) spkg with these two patches already applied [comment:ticket:8664:114 is also available] *there*.\n+\n+Note that #5847 technically again **needs review** because I had to rebase the trivial one-line patch attached there.\n \n ---\n \n``````\n",
    "created_at": "2011-07-23T04:20:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121644",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 This is a follow-up to #8664.
 
-The following spkgs are based on the **not yet positively reviewed** MPIR 2.1.3.p4 spkg from #8664:
+The following spkgs are based on the (not yet merged) MPIR 2.1.3.p4 spkg from #8664:
 
 * http://spkg-upload.googlecode.com/files/mpir-2.3.1.p0.spkg 
 
@@ -12,9 +12,11 @@
 
 You may want to give them a try *now* though. (The former is just intended as a "fallback" spkg in case problems introduced in the latter should arise.)
 
-The list of changes between MPIR 2.1.3 (more precisely, 2.1.1) and MPIR 2.4.0 is fairly long, so I haven't put them into the description. I'll perhaps attach them as a text file later.
+The list of changes between MPIR 2.1.3 (more precisely, 2.1.1) and MPIR 2.4.0 is fairly long, so I haven't put them into the description, but [attached them](https://github.com/sagemath/sage/files/ticket11616/MPIR_upstream_changes_between_2.1.1_and_2.4.0.txt) in a plain text file.
 
 For instructions on how to install / test the spkgs please see #8664, as these two also require the new GMP-ECM 6.3.p2 spkg from #5847 and two patches to the Sage library (one from each ticket); a Sage 4.7.1.rc0 (Sage library) spkg with these two patches already applied [comment:ticket:8664:114 is also available] *there*.
+
+Note that #5847 technically again **needs review** because I had to rebase the trivial one-line patch attached there.
 
 ---
 
``````




---

archive/issue_comments_121645.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nAttachment: **[MPIR_upstream_changes_between_2.1.1_and_2.4.0.txt](https://github.com/sagemath/sage/files/ticket11616/MPIR_upstream_changes_between_2.1.1_and_2.4.0.txt)**\n\nSetting this to \"needs review\" since the MPIR 2.1.3.p4 from #8664 got positive review again, though so far only by a single reviewer.\n\nThe current packages are mainly meant for **testing the new upstream releases**, hopefully on a variety of platforms supported by Sage; some improvements or changes to Sage's part will most probably follow.\n\nIt would just be nice to *relatively early* know whether any of them (more important, MPIR 2.4.0) causes any problems on one of our platforms. (MPIR 2.5.0 is scheduled for September 1st, which isn't that far...)",
    "created_at": "2011-07-23T04:20:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121645",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:2'>Comment 2:</a>
Attachment: **[MPIR_upstream_changes_between_2.1.1_and_2.4.0.txt](https://github.com/sagemath/sage/files/ticket11616/MPIR_upstream_changes_between_2.1.1_and_2.4.0.txt)**

Setting this to "needs review" since the MPIR 2.1.3.p4 from #8664 got positive review again, though so far only by a single reviewer.

The current packages are mainly meant for **testing the new upstream releases**, hopefully on a variety of platforms supported by Sage; some improvements or changes to Sage's part will most probably follow.

It would just be nice to *relatively early* know whether any of them (more important, MPIR 2.4.0) causes any problems on one of our platforms. (MPIR 2.5.0 is scheduled for September 1st, which isn't that far...)



---

archive/issue_events_137425.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-07-23T04:20:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11616#event-137425"
}
```



---

archive/issue_comments_121646.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nReplying to [@nexttime](#comment%3A2):\n> (MPIR 2.5.0 is scheduled for September 1st, which isn't that far...)\n\nNews from [mpir-devel](http://groups.google.com/group/mpir-devel/browse_thread/thread/92aa30dec4c5832b):\n\n  *\"The release date for MPIR-2.5 was penciled in for 1st Sept, however we have decided to put it back a month to 1st Oct to allow us to get some more code in this release rather than wait for the MPIR-2.6 release on 1st Dec.\"*",
    "created_at": "2011-08-18T19:08:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121646",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:3'>Comment 3:</a>
Replying to [@nexttime](#comment%3A2):
> (MPIR 2.5.0 is scheduled for September 1st, which isn't that far...)

News from [mpir-devel](http://groups.google.com/group/mpir-devel/browse_thread/thread/92aa30dec4c5832b):

  *"The release date for MPIR-2.5 was penciled in for 1st Sept, however we have decided to put it back a month to 1st Oct to allow us to get some more code in this release rather than wait for the MPIR-2.6 release on 1st Dec."*



---

archive/issue_comments_121647.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nI've successfully built and tested sage using the 2.4.0.p0 spkg on skynet/eno. I'm currently building/testing on some other machines as well (although, I don't have access to a ppc mac, so I can't help in that regard).",
    "created_at": "2011-08-23T10:00:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121647",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:4'>Comment 4:</a>
I've successfully built and tested sage using the 2.4.0.p0 spkg on skynet/eno. I'm currently building/testing on some other machines as well (although, I don't have access to a ppc mac, so I can't help in that regard).



---

archive/issue_comments_121648.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nHmm, well I'm getting some random test failures on sage.math and skynet/iras with 2.4.0.p0. I'll try again with 2.3.1.p0 and report back.",
    "created_at": "2011-08-24T19:56:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121648",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:5'>Comment 5:</a>
Hmm, well I'm getting some random test failures on sage.math and skynet/iras with 2.4.0.p0. I'll try again with 2.3.1.p0 and report back.



---

archive/issue_comments_121649.json:
```json
{
    "body": "Changed keywords from **GMP, SandyBridge, Westmere** to **sd32, GMP, SandyBridge, Westmere**",
    "created_at": "2011-08-24T23:36:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121649",
    "user": "https://github.com/williamstein"
}
```

Changed keywords from **GMP, SandyBridge, Westmere** to **sd32, GMP, SandyBridge, Westmere**



---

archive/issue_comments_121650.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n This is a follow-up to #8664.\n \n-The following spkgs are based on the (not yet merged) MPIR 2.1.3.p4 spkg from #8664:\n+The following spkgs are based on the MPIR 2.1.3.p4 spkg from #8664:\n \n * http://spkg-upload.googlecode.com/files/mpir-2.3.1.p0.spkg \n \n@@ -10,13 +10,13 @@\n \n   md5sum: `98e04aa43ceef04d83574f0ee8e152fc  mpir-2.4.0.p0.spkg`\n \n-You may want to give them a try *now* though. (The former is just intended as a \"fallback\" spkg in case problems introduced in the latter should arise.)\n+You may want to give both of them a try, although the former is just intended as a \"fallback\" spkg in case problems introduced in the latter should arise.\n \n The list of changes between MPIR 2.1.3 (more precisely, 2.1.1) and MPIR 2.4.0 is fairly long, so I haven't put them into the description, but [attached them](https://github.com/sagemath/sage/files/ticket11616/MPIR_upstream_changes_between_2.1.1_and_2.4.0.txt) in a plain text file.\n \n-For instructions on how to install / test the spkgs please see #8664, as these two also require the new GMP-ECM 6.3.p2 spkg from #5847 and two patches to the Sage library (one from each ticket); a Sage 4.7.1.rc0 (Sage library) spkg with these two patches already applied [comment:ticket:8664:114 is also available] *there*.\n+For instructions on how to install / test the spkgs see also #8664, \n+though the necessary patch and GMP-ECM 6.3 spkg from #5847 are now merged into the (not yet released) Sage 4.7.2.alpha3.\n \n-Note that #5847 technically again **needs review** because I had to rebase the trivial one-line patch attached there.\n \n ---\n \n``````\n",
    "created_at": "2011-09-12T19:10:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121650",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 This is a follow-up to #8664.
 
-The following spkgs are based on the (not yet merged) MPIR 2.1.3.p4 spkg from #8664:
+The following spkgs are based on the MPIR 2.1.3.p4 spkg from #8664:
 
 * http://spkg-upload.googlecode.com/files/mpir-2.3.1.p0.spkg 
 
@@ -10,13 +10,13 @@
 
   md5sum: `98e04aa43ceef04d83574f0ee8e152fc  mpir-2.4.0.p0.spkg`
 
-You may want to give them a try *now* though. (The former is just intended as a "fallback" spkg in case problems introduced in the latter should arise.)
+You may want to give both of them a try, although the former is just intended as a "fallback" spkg in case problems introduced in the latter should arise.
 
 The list of changes between MPIR 2.1.3 (more precisely, 2.1.1) and MPIR 2.4.0 is fairly long, so I haven't put them into the description, but [attached them](https://github.com/sagemath/sage/files/ticket11616/MPIR_upstream_changes_between_2.1.1_and_2.4.0.txt) in a plain text file.
 
-For instructions on how to install / test the spkgs please see #8664, as these two also require the new GMP-ECM 6.3.p2 spkg from #5847 and two patches to the Sage library (one from each ticket); a Sage 4.7.1.rc0 (Sage library) spkg with these two patches already applied [comment:ticket:8664:114 is also available] *there*.
+For instructions on how to install / test the spkgs see also #8664, 
+though the necessary patch and GMP-ECM 6.3 spkg from #5847 are now merged into the (not yet released) Sage 4.7.2.alpha3.
 
-Note that #5847 technically again **needs review** because I had to rebase the trivial one-line patch attached there.
 
 ---
 
``````




---

archive/issue_comments_121651.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -20,6 +20,10 @@\n \n ---\n \n+Slightly related: #11844 reports a potential race condition due to yasm when building MPIR in parallel. We've never run into this [before] though.\n+\n+---\n+\n ### mpir-2.4.0.p0 (Leif Leonhardy, July 21st, 2011)\n * Upstream upgrade to MPIR 2.4.0 (#11616).\n \n``````\n",
    "created_at": "2011-09-24T14:51:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121651",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -20,6 +20,10 @@
 
 ---
 
+Slightly related: #11844 reports a potential race condition due to yasm when building MPIR in parallel. We've never run into this [before] though.
+
+---
+
 ### mpir-2.4.0.p0 (Leif Leonhardy, July 21st, 2011)
 * Upstream upgrade to MPIR 2.4.0 (#11616).
 
``````




---

archive/issue_comments_121652.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nAdded a reference to #11844 (potential race condition due to yasm when building MPIR in parallel).",
    "created_at": "2011-09-24T14:51:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121652",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:8'>Comment 8:</a>
Added a reference to #11844 (potential race condition due to yasm when building MPIR in parallel).



---

archive/issue_comments_121653.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -12,11 +12,42 @@\n \n You may want to give both of them a try, although the former is just intended as a \"fallback\" spkg in case problems introduced in the latter should arise.\n \n+**Note:** On **64-bit** processors running **32-bit** operating systems, one currently has to set `ABI=32`, otherwise the build will fail. This will be fixed in newer versions of the spkgs.\n+\n+\n+\n+\n The list of changes between MPIR 2.1.3 (more precisely, 2.1.1) and MPIR 2.4.0 is fairly long, so I haven't put them into the description, but [attached them](https://github.com/sagemath/sage/files/ticket11616/MPIR_upstream_changes_between_2.1.1_and_2.4.0.txt) in a plain text file.\n \n+\n+\n+\n For instructions on how to install / test the spkgs see also #8664, \n-though the necessary patch and GMP-ECM 6.3 spkg from #5847 are now merged into the (not yet released) Sage 4.7.2.alpha3.\n+although **the necessary patch and the required GMP-ECM 6.3 spkg from #5847 are now already merged into Sage 4.7.2.alpha3**; i.e., it is meanwhile sufficient to just\n \n+* copy the spkg into `$SAGE_ROOT/spkg/standard/`, then\n+\n+* run\n+\n+```sh\n+$ env SAGE_UPGRADING=yes make build\n+```\n+   (or omit `build` to also rebuild the documentation in the same `make` run).\n+\n+The test suite of our \"current\" FLINT 1.5.0 spkg won't build with any of the MPIR 2.x spkgs, so don't use `SAGE_CHECK=yes` when installing it. This will be addressed on #9858, by providing a FLINT 1.5.2 (or 1.6) spkg.\n+\n+To run just MPIR's test suite, you can reinstall the spkg with `SAGE_CHECK=yes`:\n+\n+```sh\n+$ env SAGE_CHECK=yes ./sage -f spkg/standard/mpir-<version>.spkg\n+```\n+Or, if you haven't yet installed the spkg (but copied it into `$SAGE_ROOT/spkg/standard/` as mentioned above), do:\n+\n+```sh\n+$ env SAGE_CHECK=yes ./sage -i spkg/standard/mpir-<version>.spkg\n+$ env SAGE_UPGRADING=yes make build # rebuilds all dependent packages\n+```\n+Afterwards you can run `make doc` to (re)build the documentation, and / or `make ptestlong` to run Sage's full test suite in parallel.\n \n ---\n \n``````\n",
    "created_at": "2011-10-03T07:29:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121653",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -12,11 +12,42 @@
 
 You may want to give both of them a try, although the former is just intended as a "fallback" spkg in case problems introduced in the latter should arise.
 
+**Note:** On **64-bit** processors running **32-bit** operating systems, one currently has to set `ABI=32`, otherwise the build will fail. This will be fixed in newer versions of the spkgs.
+
+
+
+
 The list of changes between MPIR 2.1.3 (more precisely, 2.1.1) and MPIR 2.4.0 is fairly long, so I haven't put them into the description, but [attached them](https://github.com/sagemath/sage/files/ticket11616/MPIR_upstream_changes_between_2.1.1_and_2.4.0.txt) in a plain text file.
 
+
+
+
 For instructions on how to install / test the spkgs see also #8664, 
-though the necessary patch and GMP-ECM 6.3 spkg from #5847 are now merged into the (not yet released) Sage 4.7.2.alpha3.
+although **the necessary patch and the required GMP-ECM 6.3 spkg from #5847 are now already merged into Sage 4.7.2.alpha3**; i.e., it is meanwhile sufficient to just
 
+* copy the spkg into `$SAGE_ROOT/spkg/standard/`, then
+
+* run
+
+```sh
+$ env SAGE_UPGRADING=yes make build
+```
+   (or omit `build` to also rebuild the documentation in the same `make` run).
+
+The test suite of our "current" FLINT 1.5.0 spkg won't build with any of the MPIR 2.x spkgs, so don't use `SAGE_CHECK=yes` when installing it. This will be addressed on #9858, by providing a FLINT 1.5.2 (or 1.6) spkg.
+
+To run just MPIR's test suite, you can reinstall the spkg with `SAGE_CHECK=yes`:
+
+```sh
+$ env SAGE_CHECK=yes ./sage -f spkg/standard/mpir-<version>.spkg
+```
+Or, if you haven't yet installed the spkg (but copied it into `$SAGE_ROOT/spkg/standard/` as mentioned above), do:
+
+```sh
+$ env SAGE_CHECK=yes ./sage -i spkg/standard/mpir-<version>.spkg
+$ env SAGE_UPGRADING=yes make build # rebuilds all dependent packages
+```
+Afterwards you can run `make doc` to (re)build the documentation, and / or `make ptestlong` to run Sage's full test suite in parallel.
 
 ---
 
``````




---

archive/issue_comments_121654.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nAdded a note on the need to set `ABI=32` on 64-bit machines running 32-bit operating systems. (The same is true for the already merged MPIR 2.1.3.p4 spkg.)\n\nAlso added a reference to #9858; FLINT 1.5.0's test suite won't build with any of the MPIR 2.x spkgs because it uses deprecated functions, and updated the installation instructions.",
    "created_at": "2011-10-03T07:29:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121654",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:9'>Comment 9:</a>
Added a note on the need to set `ABI=32` on 64-bit machines running 32-bit operating systems. (The same is true for the already merged MPIR 2.1.3.p4 spkg.)

Also added a reference to #9858; FLINT 1.5.0's test suite won't build with any of the MPIR 2.x spkgs because it uses deprecated functions, and updated the installation instructions.



---

archive/issue_comments_121655.json:
```json
{
    "body": "Work Issues: **Rebase the spkg(s) on the MPIR 2.1.3.p5 spkg from #11896.**",
    "created_at": "2011-10-05T03:34:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121655",
    "user": "https://github.com/nexttime"
}
```

Work Issues: **Rebase the spkg(s) on the MPIR 2.1.3.p5 spkg from #11896.**



---

archive/issue_events_137426.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-10-05T03:34:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11616#event-137426"
}
```



---

archive/issue_events_137427.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-10-05T03:34:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11616#event-137427"
}
```



---

archive/issue_comments_121656.json:
```json
{
    "body": "Changed dependencies from **#8664 #5847** to none",
    "created_at": "2011-11-21T17:32:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121656",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#8664 #5847** to none



---

archive/issue_comments_121657.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -12,7 +12,7 @@\n \n You may want to give both of them a try, although the former is just intended as a \"fallback\" spkg in case problems introduced in the latter should arise.\n \n-**Note:** On **64-bit** processors running **32-bit** operating systems, one currently has to set `ABI=32`, otherwise the build will fail. This will be fixed in newer versions of the spkgs.\n+**Note:** On **64-bit** processors running **32-bit** operating systems, one currently has to set `ABI=32`, otherwise the build will fail. This is already fixed in #11964.\n \n \n \n@@ -22,8 +22,7 @@\n \n \n \n-For instructions on how to install / test the spkgs see also #8664, \n-although **the necessary patch and the required GMP-ECM 6.3 spkg from #5847 are now already merged into Sage 4.7.2.alpha3**; i.e., it is meanwhile sufficient to just\n+For instructions on how to install / test the spkgs see also #8664.  It is sufficient to just\n \n * copy the spkg into `$SAGE_ROOT/spkg/standard/`, then\n \n@@ -33,8 +32,6 @@\n $ env SAGE_UPGRADING=yes make build\n ```\n    (or omit `build` to also rebuild the documentation in the same `make` run).\n-\n-The test suite of our \"current\" FLINT 1.5.0 spkg won't build with any of the MPIR 2.x spkgs, so don't use `SAGE_CHECK=yes` when installing it. This will be addressed on #9858, by providing a FLINT 1.5.2 (or 1.6) spkg.\n \n To run just MPIR's test suite, you can reinstall the spkg with `SAGE_CHECK=yes`:\n \n``````\n",
    "created_at": "2011-11-21T17:32:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121657",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -12,7 +12,7 @@
 
 You may want to give both of them a try, although the former is just intended as a "fallback" spkg in case problems introduced in the latter should arise.
 
-**Note:** On **64-bit** processors running **32-bit** operating systems, one currently has to set `ABI=32`, otherwise the build will fail. This will be fixed in newer versions of the spkgs.
+**Note:** On **64-bit** processors running **32-bit** operating systems, one currently has to set `ABI=32`, otherwise the build will fail. This is already fixed in #11964.
 
 
 
@@ -22,8 +22,7 @@
 
 
 
-For instructions on how to install / test the spkgs see also #8664, 
-although **the necessary patch and the required GMP-ECM 6.3 spkg from #5847 are now already merged into Sage 4.7.2.alpha3**; i.e., it is meanwhile sufficient to just
+For instructions on how to install / test the spkgs see also #8664.  It is sufficient to just
 
 * copy the spkg into `$SAGE_ROOT/spkg/standard/`, then
 
@@ -33,8 +32,6 @@
 $ env SAGE_UPGRADING=yes make build
 ```
    (or omit `build` to also rebuild the documentation in the same `make` run).
-
-The test suite of our "current" FLINT 1.5.0 spkg won't build with any of the MPIR 2.x spkgs, so don't use `SAGE_CHECK=yes` when installing it. This will be addressed on #9858, by providing a FLINT 1.5.2 (or 1.6) spkg.
 
 To run just MPIR's test suite, you can reinstall the spkg with `SAGE_CHECK=yes`:
 
``````




---

archive/issue_comments_121658.json:
```json
{
    "body": "Changed work issues from **Rebase the spkg(s) on the MPIR 2.1.3.p5 spkg from #11896.** to **Rebase the spkg(s) on the MPIR 2.1.3.p7 spkg from #11964**",
    "created_at": "2011-11-21T17:32:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121658",
    "user": "https://github.com/jdemeyer"
}
```

Changed work issues from **Rebase the spkg(s) on the MPIR 2.1.3.p5 spkg from #11896.** to **Rebase the spkg(s) on the MPIR 2.1.3.p7 spkg from #11964**



---

archive/issue_comments_121659.json:
```json
{
    "body": "Changed work issues from **Rebase the spkg(s) on the MPIR 2.1.3.p7 spkg from #11964** to **Rebase the spkg(s) on the MPIR 2.1.3.p9 spkg from #12131**",
    "created_at": "2012-03-19T01:33:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121659",
    "user": "https://github.com/nexttime"
}
```

Changed work issues from **Rebase the spkg(s) on the MPIR 2.1.3.p7 spkg from #11964** to **Rebase the spkg(s) on the MPIR 2.1.3.p9 spkg from #12131**



---

archive/issue_comments_121660.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nMPIR 2.5.1 has been released on March 11th.  We could also give that a try, although 2.4.0 has IMHO been tested a lot and didn't raise any problems within Sage, AFAIK, at least apparently not reproducible ones.",
    "created_at": "2012-03-19T01:40:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121660",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:13'>Comment 13:</a>
MPIR 2.5.1 has been released on March 11th.  We could also give that a try, although 2.4.0 has IMHO been tested a lot and didn't raise any problems within Sage, AFAIK, at least apparently not reproducible ones.



---

archive/issue_events_137428.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2012-03-21T00:38:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11616#event-137428"
}
```



---

archive/issue_events_137429.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2012-03-21T00:38:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11616#event-137429"
}
```



---

archive/issue_comments_121661.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,26 @@\n-This is a follow-up to #8664.\n+This is a follow-up to #8664 (and a couple of other tickets).\n+\n+\n+\n+\n+The following new spkg is based on the latest MPIR 2.1.3 spkg, the p9 from #12131:\n+ \n+**New spkg:** [http://boxen.math.washington.edu/home/leif/Sage/spkgs/mpir-2.4.0.p1.spkg](http://boxen.math.washington.edu/home/leif/Sage/spkgs/mpir-2.4.0.p1.spkg)\n+\n+**md5sum:** `0d88b7dfe358bb429a5a9aa3a3b4b00b  mpir-2.4.0.p1.spkg`\n+\n+### mpir-2.4.0.p1 (Leif Leonhardy, March 21st, 2012)\n+* Upstream upgrade to MPIR 2.4.0 (#11616).\n+  The 2.4.0.p0 spkg isn't in this history, as it was based\n+  on the 2.1.3.p4 spkg, i.e., is \"on another branch\",\n+  and never got merged into Sage.\n+* Remove forcing a sequential `make install` again, since\n+  the potential race condition was fixed in MPIR 2.1.4.\n+* Fix `.hgtags`, which contained duplicate entries, and\n+  was missing others. \n+\n+\n+---\n \n The following spkgs are based on the MPIR 2.1.3.p4 spkg from #8664:\n \n``````\n",
    "created_at": "2012-03-21T00:38:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121661",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,26 @@
-This is a follow-up to #8664.
+This is a follow-up to #8664 (and a couple of other tickets).
+
+
+
+
+The following new spkg is based on the latest MPIR 2.1.3 spkg, the p9 from #12131:
+ 
+**New spkg:** [http://boxen.math.washington.edu/home/leif/Sage/spkgs/mpir-2.4.0.p1.spkg](http://boxen.math.washington.edu/home/leif/Sage/spkgs/mpir-2.4.0.p1.spkg)
+
+**md5sum:** `0d88b7dfe358bb429a5a9aa3a3b4b00b  mpir-2.4.0.p1.spkg`
+
+### mpir-2.4.0.p1 (Leif Leonhardy, March 21st, 2012)
+* Upstream upgrade to MPIR 2.4.0 (#11616).
+  The 2.4.0.p0 spkg isn't in this history, as it was based
+  on the 2.1.3.p4 spkg, i.e., is "on another branch",
+  and never got merged into Sage.
+* Remove forcing a sequential `make install` again, since
+  the potential race condition was fixed in MPIR 2.1.4.
+* Fix `.hgtags`, which contained duplicate entries, and
+  was missing others. 
+
+
+---
 
 The following spkgs are based on the MPIR 2.1.3.p4 spkg from #8664:
 
``````




---

archive/issue_comments_121662.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nIt's not unlikely that I'll soon provide an MPIR 2.4.0.p2 spkg, also fixing a potential race condition in the `yasm` build, as well as an \"experimental\" MPIR 2.5.1 spkg.\n\nPlease build, test, and review!",
    "created_at": "2012-03-21T00:38:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121662",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:14'>Comment 14:</a>
It's not unlikely that I'll soon provide an MPIR 2.4.0.p2 spkg, also fixing a potential race condition in the `yasm` build, as well as an "experimental" MPIR 2.5.1 spkg.

Please build, test, and review!



---

archive/issue_comments_121663.json:
```json
{
    "body": "Author: **Leif Leonhardy**",
    "created_at": "2012-03-21T00:38:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121663",
    "user": "https://github.com/nexttime"
}
```

Author: **Leif Leonhardy**



---

archive/issue_comments_121664.json:
```json
{
    "body": "Changed work issues from **Rebase the spkg(s) on the MPIR 2.1.3.p9 spkg from #12131** to none",
    "created_at": "2012-03-21T00:38:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121664",
    "user": "https://github.com/nexttime"
}
```

Changed work issues from **Rebase the spkg(s) on the MPIR 2.1.3.p9 spkg from #12131** to none



---

archive/issue_comments_121665.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nThe following can be removed now:\n\n```\n# The Yasm build uses PYTHON from the environment to find python, so unset\n# it since the setting from 'spkg/standard/newest_version' confuses it:\nunset PYTHON\n# This can be removed once #10492 has been merged, which turns the \"package\n# version\" environment variables into solely `make` variables, such that the\n# (shell) environment does no longer get polluted.\n```\n\nAlso: do you feel like adding a work-around for #12765:\n\n```\n# Work around a bug in GCC 4.7.0 on ia64:\n# http://gcc.gnu.org/bugzilla/show_bug.cgi?id=48496\nif [ \"`uname -m`\" = ia64 ] && [ \"`testcc.sh $CC`\" = GCC ] ; then\n    if $CC -dumpversion | grep >/dev/null '^4\\.7\\.0$' ; then\n        echo >&2 \"Warning: Working around bug in gcc 4.7.0\"\n        CFLAGS=\"$CFLAGS -O0\"\n    fi\nfi\n```\n\nAfter sage-5.0.beta12 is released, I plan to test this spkg on the buildbots.",
    "created_at": "2012-04-03T12:33:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121665",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'>Comment 15:</a>
The following can be removed now:

```
# The Yasm build uses PYTHON from the environment to find python, so unset
# it since the setting from 'spkg/standard/newest_version' confuses it:
unset PYTHON
# This can be removed once #10492 has been merged, which turns the "package
# version" environment variables into solely `make` variables, such that the
# (shell) environment does no longer get polluted.
```

Also: do you feel like adding a work-around for #12765:

```
# Work around a bug in GCC 4.7.0 on ia64:
# http://gcc.gnu.org/bugzilla/show_bug.cgi?id=48496
if [ "`uname -m`" = ia64 ] && [ "`testcc.sh $CC`" = GCC ] ; then
    if $CC -dumpversion | grep >/dev/null '^4\.7\.0$' ; then
        echo >&2 "Warning: Working around bug in gcc 4.7.0"
        CFLAGS="$CFLAGS -O0"
    fi
fi
```

After sage-5.0.beta12 is released, I plan to test this spkg on the buildbots.



---

archive/issue_comments_121666.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nAlso: could you use `patch` for patching?  Looking at `patches/gmp-h.in.diff`, there is no need for a conditional patch.  The patch will only actually do something if `__SUNPRO_CC` is defined.",
    "created_at": "2012-04-03T12:48:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121666",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'>Comment 16:</a>
Also: could you use `patch` for patching?  Looking at `patches/gmp-h.in.diff`, there is no need for a conditional patch.  The patch will only actually do something if `__SUNPRO_CC` is defined.



---

archive/issue_comments_121667.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nNote that I have a mpir-2.1.3.p10 at #12782, we should coordinate somehow.",
    "created_at": "2012-04-04T06:59:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121667",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'>Comment 17:</a>
Note that I have a mpir-2.1.3.p10 at #12782, we should coordinate somehow.



---

archive/issue_comments_121668.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nReplying to [@jdemeyer](#comment%3A17):\n> Note that I have a mpir-2.1.3.p10 at #12782, we should coordinate somehow.\n\nI'm currently working on a 2.4.0.p2 with a couple of fixes, including one for ia64 and GCC 4.7.0.\n\nNo way to get around this but disabling optimization completely?",
    "created_at": "2012-04-04T19:28:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121668",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:18'>Comment 18:</a>
Replying to [@jdemeyer](#comment%3A17):
> Note that I have a mpir-2.1.3.p10 at #12782, we should coordinate somehow.

I'm currently working on a 2.4.0.p2 with a couple of fixes, including one for ia64 and GCC 4.7.0.

No way to get around this but disabling optimization completely?



---

archive/issue_comments_121669.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nReplying to [@nexttime](#comment%3A18):\n> No way to get around this but disabling optimization completely?\n\nI have investigated but didn't manage to fix the build using anything but `-O0`.  Anyway, if #12369 gets merged, it's not really a problem.",
    "created_at": "2012-04-04T19:34:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121669",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:19'>Comment 19:</a>
Replying to [@nexttime](#comment%3A18):
> No way to get around this but disabling optimization completely?

I have investigated but didn't manage to fix the build using anything but `-O0`.  Anyway, if #12369 gets merged, it's not really a problem.



---

archive/issue_comments_121670.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nIf you're creating a new spkg anyway, could you incorporate my changes from #12782?",
    "created_at": "2012-04-04T19:49:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121670",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'>Comment 20:</a>
If you're creating a new spkg anyway, could you incorporate my changes from #12782?



---

archive/issue_comments_121671.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nReplying to [@jdemeyer](#comment%3A20):\n> If you're creating a new spkg anyway, could you incorporate my changes from #12782?\n\nYes, although I kept the `unset PYTHON`, since it is safe and otherwise doesn't hurt.",
    "created_at": "2012-04-04T19:57:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121671",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:21'>Comment 21:</a>
Replying to [@jdemeyer](#comment%3A20):
> If you're creating a new spkg anyway, could you incorporate my changes from #12782?

Yes, although I kept the `unset PYTHON`, since it is safe and otherwise doesn't hurt.



---

archive/issue_comments_121672.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nReplying to [@nexttime](#comment%3A21):\n> Replying to [@jdemeyer](#comment%3A20):\n> > If you're creating a new spkg anyway, could you incorporate my changes from #12782?\n\n> \n> Yes, although I kept the `unset PYTHON`, since it is safe and otherwise doesn't hurt.\n\nWe can also skip building a static library when building just for GCC in the first place I think.",
    "created_at": "2012-04-04T20:26:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121672",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:22'>Comment 22:</a>
Replying to [@nexttime](#comment%3A21):
> Replying to [@jdemeyer](#comment%3A20):
> > If you're creating a new spkg anyway, could you incorporate my changes from #12782?

> 
> Yes, although I kept the `unset PYTHON`, since it is safe and otherwise doesn't hurt.

We can also skip building a static library when building just for GCC in the first place I think.



---

archive/issue_comments_121673.json:
```json
{
    "body": "Diff between the previous spkg in Sage and my new p1 spkg.  For reference / review only.",
    "created_at": "2012-04-05T15:02:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121673",
    "user": "https://github.com/nexttime"
}
```

Diff between the previous spkg in Sage and my new p1 spkg.  For reference / review only.



---

archive/issue_comments_121674.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,11 +3,51 @@\n \n \n \n-The following new spkg is based on the latest MPIR 2.1.3 spkg, the p9 from #12131:\n- \n+The following new spkgs are based on the latest MPIR 2.1.3 spkg, the p9 from #12131:\n+\n+**New spkg:** [http://boxen.math.washington.edu/home/leif/Sage/spkgs/mpir-2.4.0.p2.spkg](http://boxen.math.washington.edu/home/leif/Sage/spkgs/mpir-2.4.0.p2.spkg)\n+\n+**md5sum:** `c9e6d8e2f5de4a09b4b16ee2354a9e17  mpir-2.4.0.p2.spkg`\n+\n+(Preliminary; changes not yet committed.)\n+\n+\n **New spkg:** [http://boxen.math.washington.edu/home/leif/Sage/spkgs/mpir-2.4.0.p1.spkg](http://boxen.math.washington.edu/home/leif/Sage/spkgs/mpir-2.4.0.p1.spkg)\n \n **md5sum:** `0d88b7dfe358bb429a5a9aa3a3b4b00b  mpir-2.4.0.p1.spkg`\n+\n+\n+\n+### mpir-2.4.0.p2 (Leif Leonhardy, April 4th, 2012)\n+ #11616 (upgrading MPIR), further fixes:\n+* Before enabling `-march=native`, minimalistically check whether the\n+  system's assembler also understands the instructions the compiler emits\n+  with that option.  (Work-around for e.g. GCC 4.6.3 on MacOS X 10.x and\n+  Intel Core i7-family CPUs with AVX.)\n+* Do not unconditionally unset `PYTHON`, since Sage (>=5.0.beta10) no longer\n+  pollutes the environment with its package version variables, which previous-\n+  ly confused yasm's `configure`.\n+* Fix extraction of `__GMP_CC` and `__GMP_CFLAGS` from `gmp.h`, since MPIR\n+  meanwhile defines these to preprocessor variables (rather than literals).\n+  Also don't use `\\+` in `sed` patterns, as this is less portable.\n+* Work around GCC 4.7.0 bug (compilation error) on Linux ia64 (Itanium) by\n+  almost completely disabling optimization on that platform if GCC 4.7.x\n+  is detected.  This doesn't hurt much if we later rebuild MPIR with a (non-\n+  broken) GCC from the new GCC spkg.  Cf. #12765.\n+* Do not build the C++ interface and static libraries when bootstrapping the\n+  GCC spkg, i.e. if `SAGE_BUILD_TOOLCHAIN=yes`.  (GMP/MPIR is a prerequisite\n+  for it, and MPIR will later get rebuilt with both enabled, with the newly\n+  built GCC.)  Cf. #12782.\n+* Fix a potential race condition in yasm's build by patching the re2c source.\n+  Cf. #11844.\n+* Add \"`patch` loop\" to apply any patches (`*.patch`) located in `patches/`.\n+  Currently only the re2c patch matches that; the prepatched header to support\n+  Sun's C compiler is still copied over (and only on SunOS, although it doesn't\n+  do any harm on other platforms).\n+* Minor clean-up; e.g. redirect error messages and warnings to `stderr`,\n+  quote parameter to `--libdir`, add some comments and messages, also save\n+  user's setting of `LDFLAGS` and `ABI`.\n+\n \n ### mpir-2.4.0.p1 (Leif Leonhardy, March 21st, 2012)\n * Upstream upgrade to MPIR 2.4.0 (#11616).\n``````\n",
    "created_at": "2012-04-05T15:39:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121674",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,11 +3,51 @@
 
 
 
-The following new spkg is based on the latest MPIR 2.1.3 spkg, the p9 from #12131:
- 
+The following new spkgs are based on the latest MPIR 2.1.3 spkg, the p9 from #12131:
+
+**New spkg:** [http://boxen.math.washington.edu/home/leif/Sage/spkgs/mpir-2.4.0.p2.spkg](http://boxen.math.washington.edu/home/leif/Sage/spkgs/mpir-2.4.0.p2.spkg)
+
+**md5sum:** `c9e6d8e2f5de4a09b4b16ee2354a9e17  mpir-2.4.0.p2.spkg`
+
+(Preliminary; changes not yet committed.)
+
+
 **New spkg:** [http://boxen.math.washington.edu/home/leif/Sage/spkgs/mpir-2.4.0.p1.spkg](http://boxen.math.washington.edu/home/leif/Sage/spkgs/mpir-2.4.0.p1.spkg)
 
 **md5sum:** `0d88b7dfe358bb429a5a9aa3a3b4b00b  mpir-2.4.0.p1.spkg`
+
+
+
+### mpir-2.4.0.p2 (Leif Leonhardy, April 4th, 2012)
+ #11616 (upgrading MPIR), further fixes:
+* Before enabling `-march=native`, minimalistically check whether the
+  system's assembler also understands the instructions the compiler emits
+  with that option.  (Work-around for e.g. GCC 4.6.3 on MacOS X 10.x and
+  Intel Core i7-family CPUs with AVX.)
+* Do not unconditionally unset `PYTHON`, since Sage (>=5.0.beta10) no longer
+  pollutes the environment with its package version variables, which previous-
+  ly confused yasm's `configure`.
+* Fix extraction of `__GMP_CC` and `__GMP_CFLAGS` from `gmp.h`, since MPIR
+  meanwhile defines these to preprocessor variables (rather than literals).
+  Also don't use `\+` in `sed` patterns, as this is less portable.
+* Work around GCC 4.7.0 bug (compilation error) on Linux ia64 (Itanium) by
+  almost completely disabling optimization on that platform if GCC 4.7.x
+  is detected.  This doesn't hurt much if we later rebuild MPIR with a (non-
+  broken) GCC from the new GCC spkg.  Cf. #12765.
+* Do not build the C++ interface and static libraries when bootstrapping the
+  GCC spkg, i.e. if `SAGE_BUILD_TOOLCHAIN=yes`.  (GMP/MPIR is a prerequisite
+  for it, and MPIR will later get rebuilt with both enabled, with the newly
+  built GCC.)  Cf. #12782.
+* Fix a potential race condition in yasm's build by patching the re2c source.
+  Cf. #11844.
+* Add "`patch` loop" to apply any patches (`*.patch`) located in `patches/`.
+  Currently only the re2c patch matches that; the prepatched header to support
+  Sun's C compiler is still copied over (and only on SunOS, although it doesn't
+  do any harm on other platforms).
+* Minor clean-up; e.g. redirect error messages and warnings to `stderr`,
+  quote parameter to `--libdir`, add some comments and messages, also save
+  user's setting of `LDFLAGS` and `ABI`.
+
 
 ### mpir-2.4.0.p1 (Leif Leonhardy, March 21st, 2012)
 * Upstream upgrade to MPIR 2.4.0 (#11616).
``````




---

archive/issue_comments_121675.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nAttachment: **[mpir-2.1.3.p9-2.4.0.p1.diff.gz](https://github.com/sagemath/sage/files/ticket11616/mpir-2.1.3.p9-2.4.0.p1.diff.gz)**\n\nI've uploaded a second, p2 spkg with further fixes, also incorporating [the] changes from / for\n\n* #11844 (potential race condition in `yasm` build),\n* #12765 (build error on Linux ia64 (Itanium) with GCC 4.7.0, which is a GCC bug),\n* #12782 (build MPIR without C++ interface [and without static libraries] when bootstrapping the GCC spkg),\n* `configure` error with the GCC spkg on MacOS X (on a Core i7 with AVX), as [reported on sage-release](http://groups.google.com/group/sage-release/browse_thread/thread/e2a87c73dc1625f2/59f691883df94e7f#59f691883df94e7f).\n\nSee the changelog entries in the description and the attached diffs for details and further changes.\n\n\n\n\nThe p2 is still somewhat preliminary (subject to further testing), although *I don't expect*<sup>TM</sup> further changes to be necessary, despite that haven't committed the changes yet.",
    "created_at": "2012-04-05T15:39:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121675",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:23'>Comment 23:</a>
Attachment: **[mpir-2.1.3.p9-2.4.0.p1.diff.gz](https://github.com/sagemath/sage/files/ticket11616/mpir-2.1.3.p9-2.4.0.p1.diff.gz)**

I've uploaded a second, p2 spkg with further fixes, also incorporating [the] changes from / for

* #11844 (potential race condition in `yasm` build),
* #12765 (build error on Linux ia64 (Itanium) with GCC 4.7.0, which is a GCC bug),
* #12782 (build MPIR without C++ interface [and without static libraries] when bootstrapping the GCC spkg),
* `configure` error with the GCC spkg on MacOS X (on a Core i7 with AVX), as [reported on sage-release](http://groups.google.com/group/sage-release/browse_thread/thread/e2a87c73dc1625f2/59f691883df94e7f#59f691883df94e7f).

See the changelog entries in the description and the attached diffs for details and further changes.




The p2 is still somewhat preliminary (subject to further testing), although *I don't expect*<sup>TM</sup> further changes to be necessary, despite that haven't committed the changes yet.



---

archive/issue_comments_121676.json:
```json
{
    "body": "Changed keywords from **sd32, GMP, SandyBridge, Westmere** to **sd32, GMP, SandyBridge, Westmere, yasm re2c race condition, Linux ia64 Itanium GCC 4.7.0 bug**",
    "created_at": "2012-04-05T15:39:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121676",
    "user": "https://github.com/nexttime"
}
```

Changed keywords from **sd32, GMP, SandyBridge, Westmere** to **sd32, GMP, SandyBridge, Westmere, yasm re2c race condition, Linux ia64 Itanium GCC 4.7.0 bug**



---

archive/issue_comments_121677.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -62,7 +62,7 @@\n \n ---\n \n-The following spkgs are based on the MPIR 2.1.3.p4 spkg from #8664:\n+The following spkgs are based on the **obsolete** MPIR 2.1.3.p4 spkg from #8664:\n \n * http://spkg-upload.googlecode.com/files/mpir-2.3.1.p0.spkg \n \n@@ -74,7 +74,21 @@\n \n You may want to give both of them a try, although the former is just intended as a \"fallback\" spkg in case problems introduced in the latter should arise.\n \n-**Note:** On **64-bit** processors running **32-bit** operating systems, one currently has to set `ABI=32`, otherwise the build will fail. This is already fixed in #11964.\n+**Note:** On **64-bit** processors running **32-bit** operating systems, one currently has to set `ABI=32`, otherwise the build will fail. This is already fixed in #11964.  (This does **not apply** to the newer MPIR 2.4.0 p1 and p2 spkgs.)\n+\n+### mpir-2.4.0.p0 (Leif Leonhardy, July 21st, 2011)\n+* Upstream upgrade to MPIR 2.4.0 (#11616).\n+\n+### mpir-2.3.1.p0 (Leif Leonhardy, July 20th, 2011)\n+* Upstream upgrade to MPIR 2.3.1 (#11616).\n+* Clean up .hgtags.\n+\n+### mpir-2.1.3.p4 (Leif Leonhardy, July 19th, 2011)\n+* #8664: Upgrade Sage's MPIR spkg to version 2.1.3 \n+\n+ ...\n+\n+---\n \n \n \n@@ -110,19 +124,6 @@\n \n ---\n \n-Slightly related: #11844 reports a potential race condition due to yasm when building MPIR in parallel. We've never run into this [before] though.\n+Slightly related: #11844 reports a potential race condition due to yasm when building MPIR in parallel.  We've never run into this [before] though.  The MPIR 2.4.0.**p2** spkg now includes a patch to upstream fixing that.\n \n----\n \n-### mpir-2.4.0.p0 (Leif Leonhardy, July 21st, 2011)\n-* Upstream upgrade to MPIR 2.4.0 (#11616).\n-\n-### mpir-2.3.1.p0 (Leif Leonhardy, July 20th, 2011)\n-* Upstream upgrade to MPIR 2.3.1 (#11616).\n-* Clean up .hgtags.\n-\n-### mpir-2.1.3.p4 (Leif Leonhardy, July 19th, 2011)\n-* #8664: Upgrade Sage's MPIR spkg to version 2.1.3 \n-\n- ...\n-\n``````\n",
    "created_at": "2012-04-05T16:04:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121677",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -62,7 +62,7 @@
 
 ---
 
-The following spkgs are based on the MPIR 2.1.3.p4 spkg from #8664:
+The following spkgs are based on the **obsolete** MPIR 2.1.3.p4 spkg from #8664:
 
 * http://spkg-upload.googlecode.com/files/mpir-2.3.1.p0.spkg 
 
@@ -74,7 +74,21 @@
 
 You may want to give both of them a try, although the former is just intended as a "fallback" spkg in case problems introduced in the latter should arise.
 
-**Note:** On **64-bit** processors running **32-bit** operating systems, one currently has to set `ABI=32`, otherwise the build will fail. This is already fixed in #11964.
+**Note:** On **64-bit** processors running **32-bit** operating systems, one currently has to set `ABI=32`, otherwise the build will fail. This is already fixed in #11964.  (This does **not apply** to the newer MPIR 2.4.0 p1 and p2 spkgs.)
+
+### mpir-2.4.0.p0 (Leif Leonhardy, July 21st, 2011)
+* Upstream upgrade to MPIR 2.4.0 (#11616).
+
+### mpir-2.3.1.p0 (Leif Leonhardy, July 20th, 2011)
+* Upstream upgrade to MPIR 2.3.1 (#11616).
+* Clean up .hgtags.
+
+### mpir-2.1.3.p4 (Leif Leonhardy, July 19th, 2011)
+* #8664: Upgrade Sage's MPIR spkg to version 2.1.3 
+
+ ...
+
+---
 
 
 
@@ -110,19 +124,6 @@
 
 ---
 
-Slightly related: #11844 reports a potential race condition due to yasm when building MPIR in parallel. We've never run into this [before] though.
+Slightly related: #11844 reports a potential race condition due to yasm when building MPIR in parallel.  We've never run into this [before] though.  The MPIR 2.4.0.**p2** spkg now includes a patch to upstream fixing that.
 
----
 
-### mpir-2.4.0.p0 (Leif Leonhardy, July 21st, 2011)
-* Upstream upgrade to MPIR 2.4.0 (#11616).
-
-### mpir-2.3.1.p0 (Leif Leonhardy, July 20th, 2011)
-* Upstream upgrade to MPIR 2.3.1 (#11616).
-* Clean up .hgtags.
-
-### mpir-2.1.3.p4 (Leif Leonhardy, July 19th, 2011)
-* #8664: Upgrade Sage's MPIR spkg to version 2.1.3 
-
- ...
-
``````




---

archive/issue_comments_121678.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,7 +3,7 @@\n \n \n \n-The following new spkgs are based on the latest MPIR 2.1.3 spkg, the p9 from #12131:\n+The following **new spkgs** are based on the latest MPIR 2.1.3 spkg, the p9 from #12131:\n \n **New spkg:** [http://boxen.math.washington.edu/home/leif/Sage/spkgs/mpir-2.4.0.p2.spkg](http://boxen.math.washington.edu/home/leif/Sage/spkgs/mpir-2.4.0.p2.spkg)\n \n@@ -62,7 +62,7 @@\n \n ---\n \n-The following spkgs are based on the **obsolete** MPIR 2.1.3.p4 spkg from #8664:\n+The following **old spkgs** are based on the **obsolete** MPIR 2.1.3.**p4** spkg from #8664:\n \n * http://spkg-upload.googlecode.com/files/mpir-2.3.1.p0.spkg \n \n@@ -74,7 +74,7 @@\n \n You may want to give both of them a try, although the former is just intended as a \"fallback\" spkg in case problems introduced in the latter should arise.\n \n-**Note:** On **64-bit** processors running **32-bit** operating systems, one currently has to set `ABI=32`, otherwise the build will fail. This is already fixed in #11964.  (This does **not apply** to the newer MPIR 2.4.0 p1 and p2 spkgs.)\n+**Note:** On **64-bit** processors running **32-bit** operating systems, one currently has to set `ABI=32`, otherwise the build will fail.  (This does **not apply** to the newer MPIR 2.4.0 p1 and p2 spkgs.)\n \n ### mpir-2.4.0.p0 (Leif Leonhardy, July 21st, 2011)\n * Upstream upgrade to MPIR 2.4.0 (#11616).\n``````\n",
    "created_at": "2012-04-05T16:09:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121678",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,7 +3,7 @@
 
 
 
-The following new spkgs are based on the latest MPIR 2.1.3 spkg, the p9 from #12131:
+The following **new spkgs** are based on the latest MPIR 2.1.3 spkg, the p9 from #12131:
 
 **New spkg:** [http://boxen.math.washington.edu/home/leif/Sage/spkgs/mpir-2.4.0.p2.spkg](http://boxen.math.washington.edu/home/leif/Sage/spkgs/mpir-2.4.0.p2.spkg)
 
@@ -62,7 +62,7 @@
 
 ---
 
-The following spkgs are based on the **obsolete** MPIR 2.1.3.p4 spkg from #8664:
+The following **old spkgs** are based on the **obsolete** MPIR 2.1.3.**p4** spkg from #8664:
 
 * http://spkg-upload.googlecode.com/files/mpir-2.3.1.p0.spkg 
 
@@ -74,7 +74,7 @@
 
 You may want to give both of them a try, although the former is just intended as a "fallback" spkg in case problems introduced in the latter should arise.
 
-**Note:** On **64-bit** processors running **32-bit** operating systems, one currently has to set `ABI=32`, otherwise the build will fail. This is already fixed in #11964.  (This does **not apply** to the newer MPIR 2.4.0 p1 and p2 spkgs.)
+**Note:** On **64-bit** processors running **32-bit** operating systems, one currently has to set `ABI=32`, otherwise the build will fail.  (This does **not apply** to the newer MPIR 2.4.0 p1 and p2 spkgs.)
 
 ### mpir-2.4.0.p0 (Leif Leonhardy, July 21st, 2011)
 * Upstream upgrade to MPIR 2.4.0 (#11616).
``````




---

archive/issue_comments_121679.json:
```json
{
    "body": "<a id='comment:26'>Comment 26:</a>\nWhy don't you simply remove lines 179--189 regarding PYTHON?  I don't think it serves any purpose anymore.  Also, it shouldn't be needed for upgrades since `PYTHON` is only set by the old `spkg/install` and `spkg/install` is always immediately upgraded.",
    "created_at": "2012-04-05T19:28:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121679",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:26'>Comment 26:</a>
Why don't you simply remove lines 179--189 regarding PYTHON?  I don't think it serves any purpose anymore.  Also, it shouldn't be needed for upgrades since `PYTHON` is only set by the old `spkg/install` and `spkg/install` is always immediately upgraded.



---

archive/issue_comments_121680.json:
```json
{
    "body": "<a id='comment:27'>Comment 27:</a>\nReplying to [@jdemeyer](#comment%3A26):\n> Why don't you simply remove lines 179--189 regarding PYTHON?  I don't think it serves any purpose anymore.\n\nIt does, because occasionally people (try to) install newer MPIR spkgs into older (e.g. 4.8) Sage installations.  And doesn't hurt anyway, just makes Sage more robust.",
    "created_at": "2012-04-05T19:37:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121680",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:27'>Comment 27:</a>
Replying to [@jdemeyer](#comment%3A26):
> Why don't you simply remove lines 179--189 regarding PYTHON?  I don't think it serves any purpose anymore.

It does, because occasionally people (try to) install newer MPIR spkgs into older (e.g. 4.8) Sage installations.  And doesn't hurt anyway, just makes Sage more robust.



---

archive/issue_comments_121681.json:
```json
{
    "body": "<a id='comment:28'>Comment 28:</a>\nReplying to [@nexttime](#comment%3A27):\n> It does, because occasionally people (try to) install newer MPIR spkgs into older (e.g. 4.8) Sage installations.  And doesn't hurt anyway\n\nIt does hurt at least a little simply because it makes `spkg-install` and `SPKG.txt` larger than needed.  I would remove it (but I'm not setting the ticket to needs_work for this).",
    "created_at": "2012-04-05T20:22:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121681",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:28'>Comment 28:</a>
Replying to [@nexttime](#comment%3A27):
> It does, because occasionally people (try to) install newer MPIR spkgs into older (e.g. 4.8) Sage installations.  And doesn't hurt anyway

It does hurt at least a little simply because it makes `spkg-install` and `SPKG.txt` larger than needed.  I would remove it (but I'm not setting the ticket to needs_work for this).



---

archive/issue_comments_121682.json:
```json
{
    "body": "<a id='comment:29'>Comment 29:</a>\nAlso: could  you use `patch` for patching also the file `gmp-h.in` unconditionally?  I think having both patches and copied files is just asking for trouble.",
    "created_at": "2012-04-05T20:31:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121682",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:29'>Comment 29:</a>
Also: could  you use `patch` for patching also the file `gmp-h.in` unconditionally?  I think having both patches and copied files is just asking for trouble.



---

archive/issue_comments_121683.json:
```json
{
    "body": "<a id='comment:30'>Comment 30:</a>\nReplying to [@jdemeyer](#comment%3A28):\n> Replying to [@nexttime](#comment%3A27):\n> > It does, because occasionally people (try to) install newer MPIR spkgs into older (e.g. 4.8) Sage installations.  And doesn't hurt anyway\n\n> It does hurt at least a little simply because it makes `spkg-install` and `SPKG.txt` larger than needed.  I would remove it (but I'm not setting the ticket to needs_work for this).\n\nOf course.  But regarding such, I wouldn't have opened dozens of tickets and touched as many spkgs for the \"newer autotools `--libdir` issue\"; a single symbolic link from `$SAGE_LOCAL/lib64` to `./lib` would have sufficed, as we don't mix 32- and 64-bit builds anyway.  IIRC someone *now* wants to create the `lib64` directory (or a link?)...",
    "created_at": "2012-04-05T20:36:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121683",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:30'>Comment 30:</a>
Replying to [@jdemeyer](#comment%3A28):
> Replying to [@nexttime](#comment%3A27):
> > It does, because occasionally people (try to) install newer MPIR spkgs into older (e.g. 4.8) Sage installations.  And doesn't hurt anyway

> It does hurt at least a little simply because it makes `spkg-install` and `SPKG.txt` larger than needed.  I would remove it (but I'm not setting the ticket to needs_work for this).

Of course.  But regarding such, I wouldn't have opened dozens of tickets and touched as many spkgs for the "newer autotools `--libdir` issue"; a single symbolic link from `$SAGE_LOCAL/lib64` to `./lib` would have sufficed, as we don't mix 32- and 64-bit builds anyway.  IIRC someone *now* wants to create the `lib64` directory (or a link?)...



---

archive/issue_comments_121684.json:
```json
{
    "body": "<a id='comment:31'>Comment 31:</a>\nReplying to [@nexttime](#comment%3A30):\n> But regarding such, I wouldn't have opened dozens of tickets and touched as many spkgs for the \"newer autotools `--libdir` issue\";\n\nAgreed, I don't think we went with the best solution for that.",
    "created_at": "2012-04-05T20:39:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121684",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:31'>Comment 31:</a>
Replying to [@nexttime](#comment%3A30):
> But regarding such, I wouldn't have opened dozens of tickets and touched as many spkgs for the "newer autotools `--libdir` issue";

Agreed, I don't think we went with the best solution for that.



---

archive/issue_comments_121685.json:
```json
{
    "body": "<a id='comment:32'>Comment 32:</a>\nReplying to [@jdemeyer](#comment%3A29):\n> Also: could  you use `patch` for patching also the file `gmp-h.in` unconditionally?  I think having both patches and copied files is just asking for trouble.\n\nI don't think it's asking for trouble, but see the *Special !Update/Build Instructions* / TODO.\n\nI so far was just too lazy, and -- more important -- didn't want to remove Dave's messages and comments... ;-)",
    "created_at": "2012-04-05T20:41:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121685",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:32'>Comment 32:</a>
Replying to [@jdemeyer](#comment%3A29):
> Also: could  you use `patch` for patching also the file `gmp-h.in` unconditionally?  I think having both patches and copied files is just asking for trouble.

I don't think it's asking for trouble, but see the *Special !Update/Build Instructions* / TODO.

I so far was just too lazy, and -- more important -- didn't want to remove Dave's messages and comments... ;-)



---

archive/issue_comments_121686.json:
```json
{
    "body": "<a id='comment:33'>Comment 33:</a>\nConcerning `__GMP_CC` and `__GMP_CFLAGS`: how about simply running the preprocessor on\n\n```\n#include \"$header_file\"\nsage_gmp_cc=__GMP_CC\n```\nand then `sed`ding out the last line?",
    "created_at": "2012-04-05T20:46:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121686",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:33'>Comment 33:</a>
Concerning `__GMP_CC` and `__GMP_CFLAGS`: how about simply running the preprocessor on

```
#include "$header_file"
sage_gmp_cc=__GMP_CC
```
and then `sed`ding out the last line?



---

archive/issue_comments_121687.json:
```json
{
    "body": "<a id='comment:34'>Comment 34:</a>\nLeif: leave your package as it is.  I might make a reviewer patch fixing a few small things.",
    "created_at": "2012-04-05T20:48:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121687",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:34'>Comment 34:</a>
Leif: leave your package as it is.  I might make a reviewer patch fixing a few small things.



---

archive/issue_comments_121688.json:
```json
{
    "body": "<a id='comment:35'>Comment 35:</a>\nReplying to [@jdemeyer](#comment%3A33):\n> Concerning `__GMP_CC` and `__GMP_CFLAGS`: how about simply running the preprocessor on\n> \n> ```\n> #include \"$header_file\"\n> sage_gmp_cc=__GMP_CC\n> ```\n> and then `sed`ding out the last line?\n\nWell, that has a couple of pitfalls as well, since such headers contain a lot, have conditional parts, and usually include other files, such that one would probably have to set up include directories as well as potentially preprocessor variables, too.  `sed` is faster and easier; I could also use `[e]grep` (and \"postprocess\" its output), although I prefer the way it's made now.",
    "created_at": "2012-04-05T21:57:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121688",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:35'>Comment 35:</a>
Replying to [@jdemeyer](#comment%3A33):
> Concerning `__GMP_CC` and `__GMP_CFLAGS`: how about simply running the preprocessor on
> 
> ```
> #include "$header_file"
> sage_gmp_cc=__GMP_CC
> ```
> and then `sed`ding out the last line?

Well, that has a couple of pitfalls as well, since such headers contain a lot, have conditional parts, and usually include other files, such that one would probably have to set up include directories as well as potentially preprocessor variables, too.  `sed` is faster and easier; I could also use `[e]grep` (and "postprocess" its output), although I prefer the way it's made now.



---

archive/issue_events_137430.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-07T10:55:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11616#event-137430"
}
```



---

archive/issue_events_137431.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-07T10:55:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11616#event-137431"
}
```



---

archive/issue_comments_121689.json:
```json
{
    "body": "<a id='comment:36'>Comment 36:</a>\nThis fails on hawk (OpenSolaris 06.2009-32), I'll investigate:\n\n```\nm4  -DHAVE_CONFIG_H -D__GMP_WITHIN_GMP -DOPERATION_popcount -DPIC popcount.asm >tmp-popcount.s\nlibtool: compile:  gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_perfect_square_p -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2 -c perfect_square_p.c  -fPIC -DPIC -o .libs/perfect_square_p.o\nlibtool: compile:  gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_bdivmod -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2 -c bdivmod.c  -fPIC -DPIC -o .libs/bdivmod.o\n/bin/sh ../libtool --tag=CC   --mode=compile gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_`echo gcd | sed 's/_$//'`    -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2  -c -o gcd.lo gcd.c\nm4  -DHAVE_CONFIG_H -D__GMP_WITHIN_GMP -DOPERATION_hamdist -DPIC hamdist.asm >tmp-hamdist.s\nlibtool: compile:  gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_gcd -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2 -c gcd.c  -fPIC -DPIC -o .libs/gcd.o\nlibtool: compile:  gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_perfect_square_p -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2 -c perfect_square_p.c -o perfect_square_p.o >/dev/null 2>&1\n/bin/sh ../libtool --tag=CC   --mode=compile gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_`echo gcd_1 | sed 's/_$//'`    -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2  -c -o gcd_1.lo gcd_1.c\nlibtool: compile:  gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_bdivmod -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2 -c bdivmod.c -o bdivmod.o >/dev/null 2>&1\nlibtool: compile:  gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_gcd_1 -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2 -c gcd_1.c  -fPIC -DPIC -o .libs/gcd_1.o\n/bin/sh ../libtool --tag=CC   --mode=compile gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_`echo gcdext | sed 's/_$//'`    -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2  -c -o gcdext.lo gcdext.c\n/bin/sh ../libtool --tag=CC   --mode=compile gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_`echo tdiv_qr | sed 's/_$//'`    -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2  -c -o tdiv_qr.lo tdiv_qr.c\n/bin/sh ../libtool --tag=CC   --mode=compile gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_`echo jacobi_base | sed 's/_$//'`    -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2  -c -o jacobi_base.lo jacobi_base.c\nlibtool: compile:  gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_gcd_1 -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2 -c gcd_1.c -o gcd_1.o >/dev/null 2>&1\nlibtool: compile:  gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_gcdext -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2 -c gcdext.c  -fPIC -DPIC -o .libs/gcdext.o\nlibtool: compile:  gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_tdiv_qr -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2 -c tdiv_qr.c  -fPIC -DPIC -o .libs/tdiv_qr.o\nlibtool: compile:  gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_jacobi_base -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2 -c jacobi_base.c  -fPIC -DPIC -o .libs/jacobi_base.o\n/bin/sh ../libtool --tag=CC   --mode=compile gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_`echo get_d | sed 's/_$//'`    -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2  -c -o get_d.lo get_d.c\nlibtool: compile:  gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_gcd -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2 -c gcd.c -o gcd.o >/dev/null 2>&1\n\nm4:hamdist.asm:41 bad macro name\ndefine(,1)\nlibtool: compile:  gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_get_d -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2 -c get_d.c  -fPIC -DPIC -o .libs/get_d.o\n/bin/sh ../libtool --tag=CC   --mode=compile gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_`echo mullow_n | sed 's/_$//'`    -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2  -c -o mullow_n.lo mullow_n.c\n/bin/sh ../libtool --tag=CC   --mode=compile gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_`echo mulhigh_n | sed 's/_$//'`    -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2  -c -o mulhigh_n.lo mulhigh_n.c\nlibtool: compile:  gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_jacobi_base -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2 -c jacobi_base.c -o jacobi_base.o >/dev/null 2>&1\nlibtool: compile:  gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_mullow_n -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2 -c mullow_n.c  -fPIC -DPIC -o .libs/mullow_n.o\n\nm4:popcount.asm:41 bad macro name\ndefine(,1)\nmake[4]: *** [popcount.lo] Error 1\n/bin/sh ../libtool --tag=CC   --mode=compile gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_`echo mullow_n_basecase | sed 's/_$//'`    -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2  -c -o mullow_n_basecase.lo mullow_n_basecase.c\nlibtool: compile:  gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_mulhigh_n -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2 -c mulhigh_n.c  -fPIC -DPIC -o .libs/mulhigh_n.o\nlibtool: compile:  gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_mullow_n_basecase -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2 -c mullow_n_basecase.c  -fPIC -DPIC -o .libs/mullow_n_basecase.o\nlibtool: compile:  gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_get_d -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2 -c get_d.c -o get_d.o >/dev/null 2>&1\n/bin/sh ../libtool --tag=CC   --mode=compile gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_`echo mullow_basecase | sed 's/_$//'`    -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2  -c -o mullow_basecase.lo mullow_basecase.c\nlibtool: compile:  gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_mullow_n -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2 -c mullow_n.c -o mullow_n.o >/dev/null 2>&1\n/bin/sh ../libtool --tag=CC   --mode=compile gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_`echo redc_1 | sed 's/_$//'`    -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2  -c -o redc_1.lo redc_1.c\nmake[4]: *** [hamdist.lo] Error 1\n```",
    "created_at": "2012-04-07T10:55:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121689",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:36'>Comment 36:</a>
This fails on hawk (OpenSolaris 06.2009-32), I'll investigate:

```
m4  -DHAVE_CONFIG_H -D__GMP_WITHIN_GMP -DOPERATION_popcount -DPIC popcount.asm >tmp-popcount.s
libtool: compile:  gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_perfect_square_p -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2 -c perfect_square_p.c  -fPIC -DPIC -o .libs/perfect_square_p.o
libtool: compile:  gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_bdivmod -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2 -c bdivmod.c  -fPIC -DPIC -o .libs/bdivmod.o
/bin/sh ../libtool --tag=CC   --mode=compile gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_`echo gcd | sed 's/_$//'`    -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2  -c -o gcd.lo gcd.c
m4  -DHAVE_CONFIG_H -D__GMP_WITHIN_GMP -DOPERATION_hamdist -DPIC hamdist.asm >tmp-hamdist.s
libtool: compile:  gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_gcd -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2 -c gcd.c  -fPIC -DPIC -o .libs/gcd.o
libtool: compile:  gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_perfect_square_p -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2 -c perfect_square_p.c -o perfect_square_p.o >/dev/null 2>&1
/bin/sh ../libtool --tag=CC   --mode=compile gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_`echo gcd_1 | sed 's/_$//'`    -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2  -c -o gcd_1.lo gcd_1.c
libtool: compile:  gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_bdivmod -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2 -c bdivmod.c -o bdivmod.o >/dev/null 2>&1
libtool: compile:  gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_gcd_1 -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2 -c gcd_1.c  -fPIC -DPIC -o .libs/gcd_1.o
/bin/sh ../libtool --tag=CC   --mode=compile gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_`echo gcdext | sed 's/_$//'`    -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2  -c -o gcdext.lo gcdext.c
/bin/sh ../libtool --tag=CC   --mode=compile gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_`echo tdiv_qr | sed 's/_$//'`    -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2  -c -o tdiv_qr.lo tdiv_qr.c
/bin/sh ../libtool --tag=CC   --mode=compile gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_`echo jacobi_base | sed 's/_$//'`    -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2  -c -o jacobi_base.lo jacobi_base.c
libtool: compile:  gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_gcd_1 -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2 -c gcd_1.c -o gcd_1.o >/dev/null 2>&1
libtool: compile:  gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_gcdext -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2 -c gcdext.c  -fPIC -DPIC -o .libs/gcdext.o
libtool: compile:  gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_tdiv_qr -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2 -c tdiv_qr.c  -fPIC -DPIC -o .libs/tdiv_qr.o
libtool: compile:  gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_jacobi_base -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2 -c jacobi_base.c  -fPIC -DPIC -o .libs/jacobi_base.o
/bin/sh ../libtool --tag=CC   --mode=compile gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_`echo get_d | sed 's/_$//'`    -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2  -c -o get_d.lo get_d.c
libtool: compile:  gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_gcd -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2 -c gcd.c -o gcd.o >/dev/null 2>&1

m4:hamdist.asm:41 bad macro name
define(,1)
libtool: compile:  gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_get_d -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2 -c get_d.c  -fPIC -DPIC -o .libs/get_d.o
/bin/sh ../libtool --tag=CC   --mode=compile gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_`echo mullow_n | sed 's/_$//'`    -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2  -c -o mullow_n.lo mullow_n.c
/bin/sh ../libtool --tag=CC   --mode=compile gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_`echo mulhigh_n | sed 's/_$//'`    -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2  -c -o mulhigh_n.lo mulhigh_n.c
libtool: compile:  gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_jacobi_base -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2 -c jacobi_base.c -o jacobi_base.o >/dev/null 2>&1
libtool: compile:  gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_mullow_n -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2 -c mullow_n.c  -fPIC -DPIC -o .libs/mullow_n.o

m4:popcount.asm:41 bad macro name
define(,1)
make[4]: *** [popcount.lo] Error 1
/bin/sh ../libtool --tag=CC   --mode=compile gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_`echo mullow_n_basecase | sed 's/_$//'`    -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2  -c -o mullow_n_basecase.lo mullow_n_basecase.c
libtool: compile:  gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_mulhigh_n -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2 -c mulhigh_n.c  -fPIC -DPIC -o .libs/mulhigh_n.o
libtool: compile:  gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_mullow_n_basecase -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2 -c mullow_n_basecase.c  -fPIC -DPIC -o .libs/mullow_n_basecase.o
libtool: compile:  gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_get_d -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2 -c get_d.c -o get_d.o >/dev/null 2>&1
/bin/sh ../libtool --tag=CC   --mode=compile gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_`echo mullow_basecase | sed 's/_$//'`    -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2  -c -o mullow_basecase.lo mullow_basecase.c
libtool: compile:  gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_mullow_n -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2 -c mullow_n.c -o mullow_n.o >/dev/null 2>&1
/bin/sh ../libtool --tag=CC   --mode=compile gcc -std=gnu99 -DHAVE_CONFIG_H -I. -I.. -D__GMP_WITHIN_GMP -I.. -DOPERATION_`echo redc_1 | sed 's/_$//'`    -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2  -c -o redc_1.lo redc_1.c
make[4]: *** [hamdist.lo] Error 1
```



---

archive/issue_comments_121690.json:
```json
{
    "body": "<a id='comment:37'>Comment 37:</a>\nLooks like an upstream bug to me: they write\n\n```\ndefine(OPERATION_popcount, 1)\n```\nwhen they probably mean\n\n```\ndefine(`OPERATION_popcount', 1)\n```",
    "created_at": "2012-04-07T11:39:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121690",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:37'>Comment 37:</a>
Looks like an upstream bug to me: they write

```
define(OPERATION_popcount, 1)
```
when they probably mean

```
define(`OPERATION_popcount', 1)
```



---

archive/issue_comments_121691.json:
```json
{
    "body": "<a id='comment:38'>Comment 38:</a>\nReported this m4 quoting bug to mpir-devel.",
    "created_at": "2012-04-07T11:52:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121691",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:38'>Comment 38:</a>
Reported this m4 quoting bug to mpir-devel.



---

archive/issue_comments_121692.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -59,6 +59,9 @@\n * Fix `.hgtags`, which contained duplicate entries, and\n   was missing others. \n \n+---\n+\n+This fixes also: #11844 reports a potential race condition due to yasm when building MPIR in parallel.  We've never run into this [before] though.  The MPIR 2.4.0.**p2** spkg now includes a patch to upstream fixing that.\n \n ---\n \n@@ -68,7 +71,7 @@\n \n   md5sum: `ff0104e302611e49604a1c4ead97cbf4  mpir-2.3.1.p0.spkg`\n \n-* http://spkg-upload.googlecode.com/files/mpir-2.4.0.p0.spkg \n+* http://spkg-upload.googlecode.com/files/mpir-2.4.0.p0.spkg (based on the 2.1.3.p4 spkg) \n \n   md5sum: `98e04aa43ceef04d83574f0ee8e152fc  mpir-2.4.0.p0.spkg`\n \n@@ -122,8 +125,3 @@\n ```\n Afterwards you can run `make doc` to (re)build the documentation, and / or `make ptestlong` to run Sage's full test suite in parallel.\n \n----\n-\n-Slightly related: #11844 reports a potential race condition due to yasm when building MPIR in parallel.  We've never run into this [before] though.  The MPIR 2.4.0.**p2** spkg now includes a patch to upstream fixing that.\n-\n-\n``````\n",
    "created_at": "2012-04-07T12:18:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121692",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -59,6 +59,9 @@
 * Fix `.hgtags`, which contained duplicate entries, and
   was missing others. 
 
+---
+
+This fixes also: #11844 reports a potential race condition due to yasm when building MPIR in parallel.  We've never run into this [before] though.  The MPIR 2.4.0.**p2** spkg now includes a patch to upstream fixing that.
 
 ---
 
@@ -68,7 +71,7 @@
 
   md5sum: `ff0104e302611e49604a1c4ead97cbf4  mpir-2.3.1.p0.spkg`
 
-* http://spkg-upload.googlecode.com/files/mpir-2.4.0.p0.spkg 
+* http://spkg-upload.googlecode.com/files/mpir-2.4.0.p0.spkg (based on the 2.1.3.p4 spkg) 
 
   md5sum: `98e04aa43ceef04d83574f0ee8e152fc  mpir-2.4.0.p0.spkg`
 
@@ -122,8 +125,3 @@
 ```
 Afterwards you can run `make doc` to (re)build the documentation, and / or `make ptestlong` to run Sage's full test suite in parallel.
 
----
-
-Slightly related: #11844 reports a potential race condition due to yasm when building MPIR in parallel.  We've never run into this [before] though.  The MPIR 2.4.0.**p2** spkg now includes a patch to upstream fixing that.
-
-
``````




---

archive/issue_comments_121693.json:
```json
{
    "body": "<a id='comment:40'>Comment 40:</a>\nIt's much simpler to read CC and CFLAGS from Makefile, so I'll make that change.",
    "created_at": "2012-04-07T12:55:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121693",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:40'>Comment 40:</a>
It's much simpler to read CC and CFLAGS from Makefile, so I'll make that change.



---

archive/issue_comments_121694.json:
```json
{
    "body": "<a id='comment:41'>Comment 41:</a>\nI'm confused.  Why are we reading `/usr/include/gmp.h`???",
    "created_at": "2012-04-07T13:00:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121694",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:41'>Comment 41:</a>
I'm confused.  Why are we reading `/usr/include/gmp.h`???



---

archive/issue_comments_121695.json:
```json
{
    "body": "<a id='comment:42'>Comment 42:</a>\nIt looks like the flags from /usr/include/gmp.h are only used when the flags from MPIR could not be read.  But that means that ./configure failed, so we won't be able to build anyway...",
    "created_at": "2012-04-07T13:03:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121695",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:42'>Comment 42:</a>
It looks like the flags from /usr/include/gmp.h are only used when the flags from MPIR could not be read.  But that means that ./configure failed, so we won't be able to build anyway...



---

archive/issue_comments_121696.json:
```json
{
    "body": "<a id='comment:43'>Comment 43:</a>\nWork in progress, based on your .p2: [http://boxen.math.washington.edu/home/jdemeyer/spkg/mpir-2.4.0.p2.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/mpir-2.4.0.p2.spkg)",
    "created_at": "2012-04-07T13:05:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121696",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:43'>Comment 43:</a>
Work in progress, based on your .p2: [http://boxen.math.washington.edu/home/jdemeyer/spkg/mpir-2.4.0.p2.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/mpir-2.4.0.p2.spkg)



---

archive/issue_comments_121697.json:
```json
{
    "body": "Changed author from **Leif Leonhardy** to **Leif Leonhardy, Jeroen Demeyer**",
    "created_at": "2012-04-09T10:37:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121697",
    "user": "https://github.com/jdemeyer"
}
```

Changed author from **Leif Leonhardy** to **Leif Leonhardy, Jeroen Demeyer**



---

archive/issue_comments_121698.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2012-04-09T10:37:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121698",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**



---

archive/issue_events_137432.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-09T10:37:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11616#event-137432"
}
```



---

archive/issue_events_137433.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-09T10:37:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "label": "https://github.com/sagemath/sage/labels/p1%20%E2%80%93%20blocker",
    "label_color": "ff0000",
    "label_name": "p1 \u2013 blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11616#event-137433"
}
```



---

archive/issue_events_137434.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-09T10:57:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11616#event-137434"
}
```



---

archive/issue_events_137435.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-09T10:57:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11616#event-137435"
}
```



---

archive/issue_comments_121699.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,9 +5,7 @@\n \n The following **new spkgs** are based on the latest MPIR 2.1.3 spkg, the p9 from #12131:\n \n-**New spkg:** [http://boxen.math.washington.edu/home/leif/Sage/spkgs/mpir-2.4.0.p2.spkg](http://boxen.math.washington.edu/home/leif/Sage/spkgs/mpir-2.4.0.p2.spkg)\n-\n-**md5sum:** `c9e6d8e2f5de4a09b4b16ee2354a9e17  mpir-2.4.0.p2.spkg`\n+**New spkg:** [http://boxen.math.washington.edu/home/jdemeyer/spkg/mpir-2.4.0.p2.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/mpir-2.4.0.p2.spkg)\n \n (Preliminary; changes not yet committed.)\n \n@@ -17,19 +15,18 @@\n **md5sum:** `0d88b7dfe358bb429a5a9aa3a3b4b00b  mpir-2.4.0.p1.spkg`\n \n \n-\n-### mpir-2.4.0.p2 (Leif Leonhardy, April 4th, 2012)\n+### mpir-2.4.0.p2 (Leif Leonhardy, Jeroen Demeyer, April 9th, 2012)\n  #11616 (upgrading MPIR), further fixes:\n-* Before enabling `-march=native`, minimalistically check whether the\n-  system's assembler also understands the instructions the compiler emits\n-  with that option.  (Work-around for e.g. GCC 4.6.3 on MacOS X 10.x and\n-  Intel Core i7-family CPUs with AVX.)\n-* Do not unconditionally unset `PYTHON`, since Sage (>=5.0.beta10) no longer\n-  pollutes the environment with its package version variables, which previous-\n-  ly confused yasm's `configure`.\n-* Fix extraction of `__GMP_CC` and `__GMP_CFLAGS` from `gmp.h`, since MPIR\n-  meanwhile defines these to preprocessor variables (rather than literals).\n-  Also don't use `\\+` in `sed` patterns, as this is less portable.\n+* When the first configure run (with CFLAGS unset) of MPIR fails, bail\n+  out with an error.  I am not aware of any system where MPIR fails\n+  to configure with CFLAGS unset but succeeds with CFLAGS set.\n+  -- Jeroen Demeyer\n+  This implies the following simplifications:\n+  - We no longer read CC and CFLAGS from /usr/include/gmp.h or\n+    /usr/local/include/gmp.h\n+  - We no longer try to add -march=native, we simply use MPIR's flags.\n+* Extract $CC and $CFLAGS from Makefile instead of mpir.h, which is\n+  simpler and more reliable.\n * Work around GCC 4.7.0 bug (compilation error) on Linux ia64 (Itanium) by\n   almost completely disabling optimization on that platform if GCC 4.7.x\n   is detected.  This doesn't hurt much if we later rebuild MPIR with a (non-\n@@ -40,14 +37,12 @@\n   built GCC.)  Cf. #12782.\n * Fix a potential race condition in yasm's build by patching the re2c source.\n   Cf. #11844.\n+* Added `quote_asm.patch` to add proper quoting to the m4 in .asm files.\n * Add \"`patch` loop\" to apply any patches (`*.patch`) located in `patches/`.\n-  Currently only the re2c patch matches that; the prepatched header to support\n-  Sun's C compiler is still copied over (and only on SunOS, although it doesn't\n-  do any harm on other platforms).\n+  Use this to patch gmp-h.in instead of copying the file.\n * Minor clean-up; e.g. redirect error messages and warnings to `stderr`,\n   quote parameter to `--libdir`, add some comments and messages, also save\n   user's setting of `LDFLAGS` and `ABI`.\n-\n \n ### mpir-2.4.0.p1 (Leif Leonhardy, March 21st, 2012)\n * Upstream upgrade to MPIR 2.4.0 (#11616).\n@@ -61,7 +56,11 @@\n \n ---\n \n-This fixes also: #11844 reports a potential race condition due to yasm when building MPIR in parallel.  We've never run into this [before] though.  The MPIR 2.4.0.**p2** spkg now includes a patch to upstream fixing that.\n+This fixes also:\n+\n+1. #11844: a potential race condition due to yasm when building MPIR in parallel.  We've never run into this [before] though.  The MPIR 2.4.0.**p2** spkg now includes a patch to upstream fixing that.\n+\n+2. #12782: when building MPIR to bootstrap GCC (i.e. when SAGE_BUILD_TOOLCHAIN=yes), do not build the C++ interface (and not the static library).  This would allow to build Sage on systems which have a C compiler but not a C++ compiler.\n \n ---\n \n``````\n",
    "created_at": "2012-04-09T10:57:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121699",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,9 +5,7 @@
 
 The following **new spkgs** are based on the latest MPIR 2.1.3 spkg, the p9 from #12131:
 
-**New spkg:** [http://boxen.math.washington.edu/home/leif/Sage/spkgs/mpir-2.4.0.p2.spkg](http://boxen.math.washington.edu/home/leif/Sage/spkgs/mpir-2.4.0.p2.spkg)
-
-**md5sum:** `c9e6d8e2f5de4a09b4b16ee2354a9e17  mpir-2.4.0.p2.spkg`
+**New spkg:** [http://boxen.math.washington.edu/home/jdemeyer/spkg/mpir-2.4.0.p2.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/mpir-2.4.0.p2.spkg)
 
 (Preliminary; changes not yet committed.)
 
@@ -17,19 +15,18 @@
 **md5sum:** `0d88b7dfe358bb429a5a9aa3a3b4b00b  mpir-2.4.0.p1.spkg`
 
 
-
-### mpir-2.4.0.p2 (Leif Leonhardy, April 4th, 2012)
+### mpir-2.4.0.p2 (Leif Leonhardy, Jeroen Demeyer, April 9th, 2012)
  #11616 (upgrading MPIR), further fixes:
-* Before enabling `-march=native`, minimalistically check whether the
-  system's assembler also understands the instructions the compiler emits
-  with that option.  (Work-around for e.g. GCC 4.6.3 on MacOS X 10.x and
-  Intel Core i7-family CPUs with AVX.)
-* Do not unconditionally unset `PYTHON`, since Sage (>=5.0.beta10) no longer
-  pollutes the environment with its package version variables, which previous-
-  ly confused yasm's `configure`.
-* Fix extraction of `__GMP_CC` and `__GMP_CFLAGS` from `gmp.h`, since MPIR
-  meanwhile defines these to preprocessor variables (rather than literals).
-  Also don't use `\+` in `sed` patterns, as this is less portable.
+* When the first configure run (with CFLAGS unset) of MPIR fails, bail
+  out with an error.  I am not aware of any system where MPIR fails
+  to configure with CFLAGS unset but succeeds with CFLAGS set.
+  -- Jeroen Demeyer
+  This implies the following simplifications:
+  - We no longer read CC and CFLAGS from /usr/include/gmp.h or
+    /usr/local/include/gmp.h
+  - We no longer try to add -march=native, we simply use MPIR's flags.
+* Extract $CC and $CFLAGS from Makefile instead of mpir.h, which is
+  simpler and more reliable.
 * Work around GCC 4.7.0 bug (compilation error) on Linux ia64 (Itanium) by
   almost completely disabling optimization on that platform if GCC 4.7.x
   is detected.  This doesn't hurt much if we later rebuild MPIR with a (non-
@@ -40,14 +37,12 @@
   built GCC.)  Cf. #12782.
 * Fix a potential race condition in yasm's build by patching the re2c source.
   Cf. #11844.
+* Added `quote_asm.patch` to add proper quoting to the m4 in .asm files.
 * Add "`patch` loop" to apply any patches (`*.patch`) located in `patches/`.
-  Currently only the re2c patch matches that; the prepatched header to support
-  Sun's C compiler is still copied over (and only on SunOS, although it doesn't
-  do any harm on other platforms).
+  Use this to patch gmp-h.in instead of copying the file.
 * Minor clean-up; e.g. redirect error messages and warnings to `stderr`,
   quote parameter to `--libdir`, add some comments and messages, also save
   user's setting of `LDFLAGS` and `ABI`.
-
 
 ### mpir-2.4.0.p1 (Leif Leonhardy, March 21st, 2012)
 * Upstream upgrade to MPIR 2.4.0 (#11616).
@@ -61,7 +56,11 @@
 
 ---
 
-This fixes also: #11844 reports a potential race condition due to yasm when building MPIR in parallel.  We've never run into this [before] though.  The MPIR 2.4.0.**p2** spkg now includes a patch to upstream fixing that.
+This fixes also:
+
+1. #11844: a potential race condition due to yasm when building MPIR in parallel.  We've never run into this [before] though.  The MPIR 2.4.0.**p2** spkg now includes a patch to upstream fixing that.
+
+2. #12782: when building MPIR to bootstrap GCC (i.e. when SAGE_BUILD_TOOLCHAIN=yes), do not build the C++ interface (and not the static library).  This would allow to build Sage on systems which have a C compiler but not a C++ compiler.
 
 ---
 
``````




---

archive/issue_comments_121700.json:
```json
{
    "body": "<a id='comment:46'>Comment 46:</a>\nLeif, I simplified the spkg-install by bailing out with an error if the first configure run fails.  This means I could remove the part which reads CC/CFLAGS from /usr/include/gmp.h and the part which tries to add -march=native.\n\nThe new spkg was tested with success on: bsd (OS X 10.6 x86_64), hawk (OpenSolaris x86 32bit), boxen (Linux x86_64), moufang (OS X 10.4 ppc), silius (Linux ppc), silius (Linux ppc64), cleo (Linux ia64 with GCC-4.7.0).",
    "created_at": "2012-04-09T11:30:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121700",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:46'>Comment 46:</a>
Leif, I simplified the spkg-install by bailing out with an error if the first configure run fails.  This means I could remove the part which reads CC/CFLAGS from /usr/include/gmp.h and the part which tries to add -march=native.

The new spkg was tested with success on: bsd (OS X 10.6 x86_64), hawk (OpenSolaris x86 32bit), boxen (Linux x86_64), moufang (OS X 10.4 ppc), silius (Linux ppc), silius (Linux ppc64), cleo (Linux ia64 with GCC-4.7.0).



---

archive/issue_comments_121701.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,16 +3,11 @@\n \n \n \n-The following **new spkgs** are based on the latest MPIR 2.1.3 spkg, the p9 from #12131:\n+The following **new spkg** is based on the latest MPIR 2.1.3 spkg, the p9 from #12131:\n \n **New spkg:** [http://boxen.math.washington.edu/home/jdemeyer/spkg/mpir-2.4.0.p2.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/mpir-2.4.0.p2.spkg)\n \n (Preliminary; changes not yet committed.)\n-\n-\n-**New spkg:** [http://boxen.math.washington.edu/home/leif/Sage/spkgs/mpir-2.4.0.p1.spkg](http://boxen.math.washington.edu/home/leif/Sage/spkgs/mpir-2.4.0.p1.spkg)\n-\n-**md5sum:** `0d88b7dfe358bb429a5a9aa3a3b4b00b  mpir-2.4.0.p1.spkg`\n \n \n ### mpir-2.4.0.p2 (Leif Leonhardy, Jeroen Demeyer, April 9th, 2012)\n@@ -64,19 +59,21 @@\n \n ---\n \n-The following **old spkgs** are based on the **obsolete** MPIR 2.1.3.**p4** spkg from #8664:\n+Some **old spkgs**:\n \n-* http://spkg-upload.googlecode.com/files/mpir-2.3.1.p0.spkg \n+* [http://boxen.math.washington.edu/home/leif/Sage/spkgs/mpir-2.4.0.p1.spkg](http://boxen.math.washington.edu/home/leif/Sage/spkgs/mpir-2.4.0.p1.spkg) (based on 2.1.3.p9) \n+\n+  md5sum: `0d88b7dfe358bb429a5a9aa3a3b4b00b  mpir-2.4.0.p1.spkg`\n+\n+* http://spkg-upload.googlecode.com/files/mpir-2.3.1.p0.spkg (based on 2.1.3.p4) \n \n   md5sum: `ff0104e302611e49604a1c4ead97cbf4  mpir-2.3.1.p0.spkg`\n \n-* http://spkg-upload.googlecode.com/files/mpir-2.4.0.p0.spkg (based on the 2.1.3.p4 spkg) \n+* http://spkg-upload.googlecode.com/files/mpir-2.4.0.p0.spkg (based on 2.1.3.p4) \n \n   md5sum: `98e04aa43ceef04d83574f0ee8e152fc  mpir-2.4.0.p0.spkg`\n \n You may want to give both of them a try, although the former is just intended as a \"fallback\" spkg in case problems introduced in the latter should arise.\n-\n-**Note:** On **64-bit** processors running **32-bit** operating systems, one currently has to set `ABI=32`, otherwise the build will fail.  (This does **not apply** to the newer MPIR 2.4.0 p1 and p2 spkgs.)\n \n ### mpir-2.4.0.p0 (Leif Leonhardy, July 21st, 2011)\n * Upstream upgrade to MPIR 2.4.0 (#11616).\n``````\n",
    "created_at": "2012-04-09T14:41:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121701",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,16 +3,11 @@
 
 
 
-The following **new spkgs** are based on the latest MPIR 2.1.3 spkg, the p9 from #12131:
+The following **new spkg** is based on the latest MPIR 2.1.3 spkg, the p9 from #12131:
 
 **New spkg:** [http://boxen.math.washington.edu/home/jdemeyer/spkg/mpir-2.4.0.p2.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/mpir-2.4.0.p2.spkg)
 
 (Preliminary; changes not yet committed.)
-
-
-**New spkg:** [http://boxen.math.washington.edu/home/leif/Sage/spkgs/mpir-2.4.0.p1.spkg](http://boxen.math.washington.edu/home/leif/Sage/spkgs/mpir-2.4.0.p1.spkg)
-
-**md5sum:** `0d88b7dfe358bb429a5a9aa3a3b4b00b  mpir-2.4.0.p1.spkg`
 
 
 ### mpir-2.4.0.p2 (Leif Leonhardy, Jeroen Demeyer, April 9th, 2012)
@@ -64,19 +59,21 @@
 
 ---
 
-The following **old spkgs** are based on the **obsolete** MPIR 2.1.3.**p4** spkg from #8664:
+Some **old spkgs**:
 
-* http://spkg-upload.googlecode.com/files/mpir-2.3.1.p0.spkg 
+* [http://boxen.math.washington.edu/home/leif/Sage/spkgs/mpir-2.4.0.p1.spkg](http://boxen.math.washington.edu/home/leif/Sage/spkgs/mpir-2.4.0.p1.spkg) (based on 2.1.3.p9) 
+
+  md5sum: `0d88b7dfe358bb429a5a9aa3a3b4b00b  mpir-2.4.0.p1.spkg`
+
+* http://spkg-upload.googlecode.com/files/mpir-2.3.1.p0.spkg (based on 2.1.3.p4) 
 
   md5sum: `ff0104e302611e49604a1c4ead97cbf4  mpir-2.3.1.p0.spkg`
 
-* http://spkg-upload.googlecode.com/files/mpir-2.4.0.p0.spkg (based on the 2.1.3.p4 spkg) 
+* http://spkg-upload.googlecode.com/files/mpir-2.4.0.p0.spkg (based on 2.1.3.p4) 
 
   md5sum: `98e04aa43ceef04d83574f0ee8e152fc  mpir-2.4.0.p0.spkg`
 
 You may want to give both of them a try, although the former is just intended as a "fallback" spkg in case problems introduced in the latter should arise.
-
-**Note:** On **64-bit** processors running **32-bit** operating systems, one currently has to set `ABI=32`, otherwise the build will fail.  (This does **not apply** to the newer MPIR 2.4.0 p1 and p2 spkgs.)
 
 ### mpir-2.4.0.p0 (Leif Leonhardy, July 21st, 2011)
 * Upstream upgrade to MPIR 2.4.0 (#11616).
``````




---

archive/issue_comments_121702.json:
```json
{
    "body": "Changed reviewer from **Jeroen Demeyer** to **Jeroen Demeyer, Leif Leonhardy**",
    "created_at": "2012-04-09T15:31:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121702",
    "user": "https://github.com/nexttime"
}
```

Changed reviewer from **Jeroen Demeyer** to **Jeroen Demeyer, Leif Leonhardy**



---

archive/issue_comments_121703.json:
```json
{
    "body": "<a id='comment:48'>Comment 48:</a>\nIt would have been better if you made a p3, and not deleted my diff with the changes of my p2.\n\nI agree with some, but not all of your changes:\n\n* There's no need to remove the conditional unsetting of `PYTHON`, as I already argued above.\n\n* I wouldn't add a patch for the `.asm` files, but instead \"patch\" them (with `sed`) on the fly.  Otherwise this just blows up the Mercurial repository, and hopefully upstream will fix this in the next release.  (MPIR 2.5.2 was originally scheduled for about one or two weeks ago.)\n\n* Reading `CC` and `CFLAGS` *from system-wide `gmp.h` files* is also for informational purposes.  Using the strings from that header (and not MPIR's `Makefile`, which btw. could contain tabs as well) is the safer way, as these definitions are documented and **supposed** to be (easily read out and) used by other programs.  (The [structure of the] `Makefile` is subject to change without notice.)\n  You should also check whether reading the `CFLAGS` from the `Makefile` apparently succeeded. \n\n* I don't know why you removed the `-march=native` stuff; I does in general make sense, especially since (at least the version in Sage -- also regarding how long it takes to get a \"new\" version in) will not always properly detect the CPU, i.e., will choose a more generic target CPU [family] than `-march=native` does.\n\n* It's not necessary to move the work-around for GCC 4.7.x on ia64, as we don't support Itanium on anything but Linux.  Moreover, using the odd `testcc.sh` script fails if `$CC` contains more than one word, and using shell pattern matching is not only more efficient but also more readable. \n\n* I'm pretty sure we still need a work-around for newer CPUs (and GCCs) on MacOS X, slightly different to what I previously added to the p2, at least to avoid strange error messages.",
    "created_at": "2012-04-09T15:31:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121703",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:48'>Comment 48:</a>
It would have been better if you made a p3, and not deleted my diff with the changes of my p2.

I agree with some, but not all of your changes:

* There's no need to remove the conditional unsetting of `PYTHON`, as I already argued above.

* I wouldn't add a patch for the `.asm` files, but instead "patch" them (with `sed`) on the fly.  Otherwise this just blows up the Mercurial repository, and hopefully upstream will fix this in the next release.  (MPIR 2.5.2 was originally scheduled for about one or two weeks ago.)

* Reading `CC` and `CFLAGS` *from system-wide `gmp.h` files* is also for informational purposes.  Using the strings from that header (and not MPIR's `Makefile`, which btw. could contain tabs as well) is the safer way, as these definitions are documented and **supposed** to be (easily read out and) used by other programs.  (The [structure of the] `Makefile` is subject to change without notice.)
  You should also check whether reading the `CFLAGS` from the `Makefile` apparently succeeded. 

* I don't know why you removed the `-march=native` stuff; I does in general make sense, especially since (at least the version in Sage -- also regarding how long it takes to get a "new" version in) will not always properly detect the CPU, i.e., will choose a more generic target CPU [family] than `-march=native` does.

* It's not necessary to move the work-around for GCC 4.7.x on ia64, as we don't support Itanium on anything but Linux.  Moreover, using the odd `testcc.sh` script fails if `$CC` contains more than one word, and using shell pattern matching is not only more efficient but also more readable. 

* I'm pretty sure we still need a work-around for newer CPUs (and GCCs) on MacOS X, slightly different to what I previously added to the p2, at least to avoid strange error messages.



---

archive/issue_comments_121704.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -55,7 +55,7 @@\n \n 1. #11844: a potential race condition due to yasm when building MPIR in parallel.  We've never run into this [before] though.  The MPIR 2.4.0.**p2** spkg now includes a patch to upstream fixing that.\n \n-2. #12782: when building MPIR to bootstrap GCC (i.e. when SAGE_BUILD_TOOLCHAIN=yes), do not build the C++ interface (and not the static library).  This would allow to build Sage on systems which have a C compiler but not a C++ compiler.\n+2. #12782: when building MPIR to bootstrap GCC (i.e. when `SAGE_BUILD_TOOLCHAIN=yes`), do not build the C++ interface (and not the static library).  This would allow to build Sage on systems which have a C compiler but not a C++ compiler, and also saves time.\n \n ---\n \n``````\n",
    "created_at": "2012-04-09T15:41:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121704",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -55,7 +55,7 @@
 
 1. #11844: a potential race condition due to yasm when building MPIR in parallel.  We've never run into this [before] though.  The MPIR 2.4.0.**p2** spkg now includes a patch to upstream fixing that.
 
-2. #12782: when building MPIR to bootstrap GCC (i.e. when SAGE_BUILD_TOOLCHAIN=yes), do not build the C++ interface (and not the static library).  This would allow to build Sage on systems which have a C compiler but not a C++ compiler.
+2. #12782: when building MPIR to bootstrap GCC (i.e. when `SAGE_BUILD_TOOLCHAIN=yes`), do not build the C++ interface (and not the static library).  This would allow to build Sage on systems which have a C compiler but not a C++ compiler, and also saves time.
 
 ---
 
``````




---

archive/issue_comments_121705.json:
```json
{
    "body": "<a id='comment:50'>Comment 50:</a>\n> I am not aware of any system where MPIR fails to configure with `CFLAGS` unset but succeeds with `CFLAGS` set.\n\nThis can very well happen if e.g. the compiler defaults to some target CPU / instruction set the assembler doesn't fully support, and `CFLAGS` restrict the architecture.  Same for `CFLAGS` working around some brokenness of the compiler.",
    "created_at": "2012-04-09T15:52:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121705",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:50'>Comment 50:</a>
> I am not aware of any system where MPIR fails to configure with `CFLAGS` unset but succeeds with `CFLAGS` set.

This can very well happen if e.g. the compiler defaults to some target CPU / instruction set the assembler doesn't fully support, and `CFLAGS` restrict the architecture.  Same for `CFLAGS` working around some brokenness of the compiler.



---

archive/issue_comments_121706.json:
```json
{
    "body": "<a id='comment:51'>Comment 51:</a>\nReplying to [@nexttime](#comment%3A48):\n> It would have been better if you made a p3, and not deleted my diff with the changes of my p2.\n\nSince your changes weren't committed, I thought it was open to changes.  Anyway, this would probably \"blow up\" the Mercurial repository more than my .asm patch ;-)\n\n>  There's no need to remove the conditional unsetting of `PYTHON`, as I already argued above.\n\nI really don't see the need for the `PYTHON` stuff.  If somebody just installs this spkg with \"`./sage -i`\", then `PYTHON` will not be set.  `PYTHON` will only be set if this spkg is installed through `spkg/install`.  I cannot think of a plausable scenario where this would happen.\n\n>  I wouldn't add a patch for the `.asm` files, but instead \"patch\" them (with `sed`) on the fly.  Otherwise this just blows up the Mercurial repository\n\nThe patch isn't that large, so it's not going to \"blow up\" the Mercurial repository.  Besides, I don't want to worry about the portability of the find/sed commands that I'm using.\n\n>  Reading `CC` and `CFLAGS` *from system-wide `gmp.h` files* is also for informational purposes.\n\nWho reads log files anyway?\n\n> Using the strings from that header (and not MPIR's `Makefile`, which btw. could contain tabs as well) is the safer way, as these definitions are documented and **supposed** to be (easily read out and) used by other programs.  (The [structure of the] `Makefile` is subject to change without notice.)\n\nAgreed that it's subject to change without notice, but at least we'll notice if it changes.  Reading them from Makefile is absolutely the easiest way.\n\n> You should also check whether reading the `CFLAGS` from the `Makefile` apparently succeeded. \n\nThis is harder to do.  In theory, `CFLAGS` could be empty.  Moreover, it looks quite unlikely to me that reading `CC` would succeed but reading `CFLAGS` would fail.\n\n>  I don't know why you removed the `-march=native` stuff;\n\nI removed it because it wasn't used!  Reading the CC and CFLAGS from MPIR should always succeed now (as far as I can tell), so the code using `-march=native` would never be reached.\n\n> I does in general make sense, especially since (at least the version in Sage -- also regarding how long it takes to get a \"new\" version in) will not always properly detect the CPU, i.e., will choose a more generic target CPU [family] than `-march=native` does.\n\nPerhaps always using `-march=native` does make sense, but that's outside the scope of this ticket.\n\n>  It's not necessary to move the work-around for GCC 4.7.x on ia64, as we don't support Itanium on anything but Linux.\n\nSo what?  Why *a priori* restrict it to Linux?\n\n> Moreover, using the odd `testcc.sh` script fails if `$CC` contains more than one word\n\nAgreed, `$CC` should be quoted.\n\n> using shell pattern matching is not only more efficient\n\nSeriously?  You're worrying about efficientcy of shell scripts?\n\n> but also more readable.\n\nI find my code quite readable.\n\n>  I'm pretty sure we still need a work-around for newer CPUs (and GCCs) on MacOS X, slightly different to what I previously added to the p2, at least to avoid strange error messages.\n\nLet's see what users report...  It doesn't make sense to me to add a complicated workaround for a corner case which doesn't occur in practice.",
    "created_at": "2012-04-09T18:25:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121706",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:51'>Comment 51:</a>
Replying to [@nexttime](#comment%3A48):
> It would have been better if you made a p3, and not deleted my diff with the changes of my p2.

Since your changes weren't committed, I thought it was open to changes.  Anyway, this would probably "blow up" the Mercurial repository more than my .asm patch ;-)

>  There's no need to remove the conditional unsetting of `PYTHON`, as I already argued above.

I really don't see the need for the `PYTHON` stuff.  If somebody just installs this spkg with "`./sage -i`", then `PYTHON` will not be set.  `PYTHON` will only be set if this spkg is installed through `spkg/install`.  I cannot think of a plausable scenario where this would happen.

>  I wouldn't add a patch for the `.asm` files, but instead "patch" them (with `sed`) on the fly.  Otherwise this just blows up the Mercurial repository

The patch isn't that large, so it's not going to "blow up" the Mercurial repository.  Besides, I don't want to worry about the portability of the find/sed commands that I'm using.

>  Reading `CC` and `CFLAGS` *from system-wide `gmp.h` files* is also for informational purposes.

Who reads log files anyway?

> Using the strings from that header (and not MPIR's `Makefile`, which btw. could contain tabs as well) is the safer way, as these definitions are documented and **supposed** to be (easily read out and) used by other programs.  (The [structure of the] `Makefile` is subject to change without notice.)

Agreed that it's subject to change without notice, but at least we'll notice if it changes.  Reading them from Makefile is absolutely the easiest way.

> You should also check whether reading the `CFLAGS` from the `Makefile` apparently succeeded. 

This is harder to do.  In theory, `CFLAGS` could be empty.  Moreover, it looks quite unlikely to me that reading `CC` would succeed but reading `CFLAGS` would fail.

>  I don't know why you removed the `-march=native` stuff;

I removed it because it wasn't used!  Reading the CC and CFLAGS from MPIR should always succeed now (as far as I can tell), so the code using `-march=native` would never be reached.

> I does in general make sense, especially since (at least the version in Sage -- also regarding how long it takes to get a "new" version in) will not always properly detect the CPU, i.e., will choose a more generic target CPU [family] than `-march=native` does.

Perhaps always using `-march=native` does make sense, but that's outside the scope of this ticket.

>  It's not necessary to move the work-around for GCC 4.7.x on ia64, as we don't support Itanium on anything but Linux.

So what?  Why *a priori* restrict it to Linux?

> Moreover, using the odd `testcc.sh` script fails if `$CC` contains more than one word

Agreed, `$CC` should be quoted.

> using shell pattern matching is not only more efficient

Seriously?  You're worrying about efficientcy of shell scripts?

> but also more readable.

I find my code quite readable.

>  I'm pretty sure we still need a work-around for newer CPUs (and GCCs) on MacOS X, slightly different to what I previously added to the p2, at least to avoid strange error messages.

Let's see what users report...  It doesn't make sense to me to add a complicated workaround for a corner case which doesn't occur in practice.



---

archive/issue_comments_121707.json:
```json
{
    "body": "<a id='comment:52'>Comment 52:</a>\nReplying to [@nexttime](#comment%3A48):\n> using the odd `testcc.sh` script fails if `$CC` contains more than one word\n\nActually, not quoting `$CC` makes more sense, see #12821.",
    "created_at": "2012-04-09T19:00:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121707",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:52'>Comment 52:</a>
Replying to [@nexttime](#comment%3A48):
> using the odd `testcc.sh` script fails if `$CC` contains more than one word

Actually, not quoting `$CC` makes more sense, see #12821.



---

archive/issue_comments_121708.json:
```json
{
    "body": "<a id='comment:53'>Comment 53:</a>\nReplying to [@jdemeyer](#comment%3A51):\n> Replying to [@nexttime](#comment%3A48):\n> > It would have been better if you made a p3, and not deleted my diff with the changes of my p2.\n\n> Since your changes weren't committed, I thought it was open to changes.  Anyway, this would probably \"blow up\" the Mercurial repository more than my .asm patch ;-)\n\nThe raw patch alone is 32 KB.  If one makes changes to other people's code, one should always make a diff; that's what reviewer patches are for.  I also wanted to make further changes.  Apart from that, it's confusing to have different spkgs with the same patch level at different locations.\n\n\n> >  There's no need to remove the conditional unsetting of `PYTHON`, as I already argued above.\n\n> I really don't see the need for the `PYTHON` stuff.  If somebody just installs this spkg with \"`./sage -i`\", then `PYTHON` will not be set.  `PYTHON` will only be set if this spkg is installed through `spkg/install`.  I cannot think of a plausable scenario where this would happen.\n\nXD Just follow the instructions given in this ticket's description (and elsewhere):\n\n```sh\n$ cp mpir-x,y,z.pN.spkg \"$SAGE_ROOT\"/spkg/standard/\n$ env SAGE_UPGRADING=yes make build\n```\n\n\n> >  I wouldn't add a patch for the `.asm` files, but instead \"patch\" them (with `sed`) on the fly.  Otherwise this just blows up the Mercurial repository\n\n> The patch isn't that large, so it's not going to \"blow up\" the Mercurial repository.  Besides, I don't want to worry about the portability of the find/sed commands that I'm using.\n\n:-) Elsewhere we do...\n\n \n> >  Reading `CC` and `CFLAGS` *from system-wide `gmp.h` files* is also for informational purposes.\n\n> Who reads log files anyway?\n\nThen why cat `config.log` in case of an error, and give all the other messages? ;-)\n\n\n> > Using the strings from that header (and not MPIR's `Makefile`, which btw. could contain tabs as well) is the safer way, as these definitions are documented and **supposed** to be (easily read out and) used by other programs.  (The [structure of the] `Makefile` is subject to change without notice.)\n\n> Agreed that it's subject to change without notice, but at least we'll notice if it changes.\n\nNot necessarily.\n\n>  Reading them from Makefile is absolutely the easiest way.\n\nIs it?  You use almost the same `sed` commands.  And it's more error-prone; just imagine we have\n\n```make\nCFLAGS = -foo -bar # This is a comment.\n```\nThen `mpir_cflags` would certainly not be empty, but ... (Likewise for `CC`.)  Even the usage of one or more tabs can break your code.  \n\n> > You should also check whether reading the `CFLAGS` from the `Makefile` apparently succeeded. \n\n> This is harder to do.  In theory, `CFLAGS` could be empty.\n\nIn that case we might (try to) add `-march=native`, using the functions that have already been there... ;-)\n\n>  Moreover, it looks quite unlikely to me that reading `CC` would succeed but reading `CFLAGS` would fail.\n\nSee above.  A tab character is sufficient, a comment leads to weird errors later.\n\n\n> >  I don't know why you removed the `-march=native` stuff;\n\n> I removed it because it wasn't used!  Reading the CC and CFLAGS from MPIR should always succeed now (as far as I can tell), so the code using `-march=native` would never be reached.\n\nThat was true for my p2 (provided `upstream_cflags` weren't empty), and was subject to change, as I didn't notice that in the first place.  And as you mentioned, MPIR's `CFLAGS` may not contain processor-specific flags.  Different compilers might use / need different flags, and the code was open for extensions regarding that.\n  \n\n> > I does in general make sense, especially since (at least the version in Sage -- also regarding how long it takes to get a \"new\" version in) will not always properly detect the CPU, i.e., will choose a more generic target CPU [family] than `-march=native` does.\n\n> Perhaps always using `-march=native` does make sense, but that's outside the scope of this ticket.\n\nIs it?  But removing the code *is* in its scope?  Doesn't make sense to first remove it here and later again add slightly changed code on another ticket. \n\n\n> >  It's not necessary to move the work-around for GCC 4.7.x on ia64, as we don't support Itanium on anything but Linux.\n\n> So what?  Why *a priori* restrict it to Linux?\n\nI didn't know you were porting MacOS to Itanium (a dead architecture btw.)... \n\n\n> > Moreover, using the odd `testcc.sh` script fails if `$CC` contains more than one word\n\n> Agreed, `$CC` should be quoted.\n\nPerhaps rather change `testcc.sh`, although\n\n```sh\nif $CC -E -x c /dev/null -dM 2>&1 | grep __GNUC__ >/dev/null; then\n    # It's GCC.\n    ...\nfi\n```\ndoes it, and is much simpler.\n\n\n> > using shell pattern matching is not only more efficient\n\n> Seriously?  You're worrying about efficientcy of shell scripts?\n\nIt's also more reliable.  (And in general, we have packages where `configure` takes longer than the whole build.)\n\n> > but also more readable.\n\n> I find my code quite readable.\n\nYou mean like e.g.\n\n```sh\nif [ -n \"$AS\" -a \"$AS\" != \"as\" ]; then ...\n```\ninstead of\n\n```sh\nif [[ $AS != as ]]; then ...\n```\nor\n\n```sh\n    arg=`echo \"$arg\" | sed \\\n        -e 's/^-\\(compatibility_version\\)/-dylib_\\1/' \\\n        -e 's/^-\\(current_version\\)/-dylib_\\1/' \\\n        -e 's/^-\\(install_name\\)/-dylib_\\1/' \\\n```\ninstead of\n\n```sh\n    case \"$arg\" in\n        -compatibility_version) arg=-dylib_compatibility_version;;\n        -current_version)       arg=-dylib_current_version;;\n        -install_name)          arg=-dylib_install_name\n    esac\n```\n?\n\n\n> >  I'm pretty sure we still need a work-around for newer CPUs (and GCCs) on MacOS X, slightly different to what I previously added to the p2, at least to avoid strange error messages.\n\n> Let's see what users report...  It doesn't make sense to me to add a complicated workaround for a corner case which doesn't occur in practice.\n\nWell, it's certainly a corner case (btw. like most of the regularly occuring MacOS trouble ;-) ), but it did happen, so I added a test to catch it, give an appropriate message, and work around it.",
    "created_at": "2012-04-09T21:15:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121708",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:53'>Comment 53:</a>
Replying to [@jdemeyer](#comment%3A51):
> Replying to [@nexttime](#comment%3A48):
> > It would have been better if you made a p3, and not deleted my diff with the changes of my p2.

> Since your changes weren't committed, I thought it was open to changes.  Anyway, this would probably "blow up" the Mercurial repository more than my .asm patch ;-)

The raw patch alone is 32 KB.  If one makes changes to other people's code, one should always make a diff; that's what reviewer patches are for.  I also wanted to make further changes.  Apart from that, it's confusing to have different spkgs with the same patch level at different locations.


> >  There's no need to remove the conditional unsetting of `PYTHON`, as I already argued above.

> I really don't see the need for the `PYTHON` stuff.  If somebody just installs this spkg with "`./sage -i`", then `PYTHON` will not be set.  `PYTHON` will only be set if this spkg is installed through `spkg/install`.  I cannot think of a plausable scenario where this would happen.

XD Just follow the instructions given in this ticket's description (and elsewhere):

```sh
$ cp mpir-x,y,z.pN.spkg "$SAGE_ROOT"/spkg/standard/
$ env SAGE_UPGRADING=yes make build
```


> >  I wouldn't add a patch for the `.asm` files, but instead "patch" them (with `sed`) on the fly.  Otherwise this just blows up the Mercurial repository

> The patch isn't that large, so it's not going to "blow up" the Mercurial repository.  Besides, I don't want to worry about the portability of the find/sed commands that I'm using.

:-) Elsewhere we do...

 
> >  Reading `CC` and `CFLAGS` *from system-wide `gmp.h` files* is also for informational purposes.

> Who reads log files anyway?

Then why cat `config.log` in case of an error, and give all the other messages? ;-)


> > Using the strings from that header (and not MPIR's `Makefile`, which btw. could contain tabs as well) is the safer way, as these definitions are documented and **supposed** to be (easily read out and) used by other programs.  (The [structure of the] `Makefile` is subject to change without notice.)

> Agreed that it's subject to change without notice, but at least we'll notice if it changes.

Not necessarily.

>  Reading them from Makefile is absolutely the easiest way.

Is it?  You use almost the same `sed` commands.  And it's more error-prone; just imagine we have

```make
CFLAGS = -foo -bar # This is a comment.
```
Then `mpir_cflags` would certainly not be empty, but ... (Likewise for `CC`.)  Even the usage of one or more tabs can break your code.  

> > You should also check whether reading the `CFLAGS` from the `Makefile` apparently succeeded. 

> This is harder to do.  In theory, `CFLAGS` could be empty.

In that case we might (try to) add `-march=native`, using the functions that have already been there... ;-)

>  Moreover, it looks quite unlikely to me that reading `CC` would succeed but reading `CFLAGS` would fail.

See above.  A tab character is sufficient, a comment leads to weird errors later.


> >  I don't know why you removed the `-march=native` stuff;

> I removed it because it wasn't used!  Reading the CC and CFLAGS from MPIR should always succeed now (as far as I can tell), so the code using `-march=native` would never be reached.

That was true for my p2 (provided `upstream_cflags` weren't empty), and was subject to change, as I didn't notice that in the first place.  And as you mentioned, MPIR's `CFLAGS` may not contain processor-specific flags.  Different compilers might use / need different flags, and the code was open for extensions regarding that.
  

> > I does in general make sense, especially since (at least the version in Sage -- also regarding how long it takes to get a "new" version in) will not always properly detect the CPU, i.e., will choose a more generic target CPU [family] than `-march=native` does.

> Perhaps always using `-march=native` does make sense, but that's outside the scope of this ticket.

Is it?  But removing the code *is* in its scope?  Doesn't make sense to first remove it here and later again add slightly changed code on another ticket. 


> >  It's not necessary to move the work-around for GCC 4.7.x on ia64, as we don't support Itanium on anything but Linux.

> So what?  Why *a priori* restrict it to Linux?

I didn't know you were porting MacOS to Itanium (a dead architecture btw.)... 


> > Moreover, using the odd `testcc.sh` script fails if `$CC` contains more than one word

> Agreed, `$CC` should be quoted.

Perhaps rather change `testcc.sh`, although

```sh
if $CC -E -x c /dev/null -dM 2>&1 | grep __GNUC__ >/dev/null; then
    # It's GCC.
    ...
fi
```
does it, and is much simpler.


> > using shell pattern matching is not only more efficient

> Seriously?  You're worrying about efficientcy of shell scripts?

It's also more reliable.  (And in general, we have packages where `configure` takes longer than the whole build.)

> > but also more readable.

> I find my code quite readable.

You mean like e.g.

```sh
if [ -n "$AS" -a "$AS" != "as" ]; then ...
```
instead of

```sh
if [[ $AS != as ]]; then ...
```
or

```sh
    arg=`echo "$arg" | sed \
        -e 's/^-\(compatibility_version\)/-dylib_\1/' \
        -e 's/^-\(current_version\)/-dylib_\1/' \
        -e 's/^-\(install_name\)/-dylib_\1/' \
```
instead of

```sh
    case "$arg" in
        -compatibility_version) arg=-dylib_compatibility_version;;
        -current_version)       arg=-dylib_current_version;;
        -install_name)          arg=-dylib_install_name
    esac
```
?


> >  I'm pretty sure we still need a work-around for newer CPUs (and GCCs) on MacOS X, slightly different to what I previously added to the p2, at least to avoid strange error messages.

> Let's see what users report...  It doesn't make sense to me to add a complicated workaround for a corner case which doesn't occur in practice.

Well, it's certainly a corner case (btw. like most of the regularly occuring MacOS trouble ;-) ), but it did happen, so I added a test to catch it, give an appropriate message, and work around it.



---

archive/issue_comments_121709.json:
```json
{
    "body": "<a id='comment:54'>Comment 54:</a>\nReplying to [@nexttime](#comment%3A53):\n> Well, it's certainly a corner case (btw. like most of the regularly occuring MacOS trouble ;-) ), but it did happen\n\nIt did happen with a **different** version of the MPIR spkg, so I don't see why that is relevant.",
    "created_at": "2012-04-09T21:48:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121709",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:54'>Comment 54:</a>
Replying to [@nexttime](#comment%3A53):
> Well, it's certainly a corner case (btw. like most of the regularly occuring MacOS trouble ;-) ), but it did happen

It did happen with a **different** version of the MPIR spkg, so I don't see why that is relevant.



---

archive/issue_comments_121710.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,23 +5,37 @@\n \n The following **new spkg** is based on the latest MPIR 2.1.3 spkg, the p9 from #12131:\n \n-**New spkg:** [http://boxen.math.washington.edu/home/jdemeyer/spkg/mpir-2.4.0.p2.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/mpir-2.4.0.p2.spkg)\n+**New spkg:** [http://boxen.math.washington.edu/home/jdemeyer/spkg/mpir-2.4.0.p3.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/mpir-2.4.0.p3.spkg)\n \n (Preliminary; changes not yet committed.)\n \n-\n-### mpir-2.4.0.p2 (Leif Leonhardy, Jeroen Demeyer, April 9th, 2012)\n- #11616 (upgrading MPIR), further fixes:\n+### mpir-2.4.0.p3 (Jeroen Demeyer, April 10th, 2012)\n+ Trac #11616, reviewer fixes:\n * When the first configure run (with CFLAGS unset) of MPIR fails, bail\n   out with an error.  I am not aware of any system where MPIR fails\n   to configure with CFLAGS unset but succeeds with CFLAGS set.\n-  -- Jeroen Demeyer\n   This implies the following simplifications:\n   - We no longer read CC and CFLAGS from /usr/include/gmp.h or\n     /usr/local/include/gmp.h\n   - We no longer try to add -march=native, we simply use MPIR's flags.\n * Extract $CC and $CFLAGS from Makefile instead of mpir.h, which is\n   simpler and more reliable.\n+* Added `quote_asm.patch` to add proper quoting to the m4 in .asm files.\n+* Use `patch` to patch gmp-h.in instead of copying the file.\n+* Remove \"unset PYTHON\" which is not needed anymore since Trac #10492.\n+\n+### mpir-2.4.0.p2 (Leif Leonhardy, April 4th, 2012)\n+ #11616 (upgrading MPIR), further fixes:\n+* Before enabling `-march=native`, minimalistically check whether the\n+  system's assembler also understands the instructions the compiler emits\n+  with that option.  (Work-around for e.g. GCC 4.6.3 on MacOS X 10.x and\n+  Intel Core i7-family CPUs with AVX.)\n+* Do not unconditionally unset `PYTHON`, since Sage (>=5.0.beta10) no longer\n+  pollutes the environment with its package version variables, which previous-\n+  ly confused yasm's `configure`.\n+* Fix extraction of `__GMP_CC` and `__GMP_CFLAGS` from `gmp.h`, since MPIR\n+  meanwhile defines these to preprocessor variables (rather than literals).\n+  Also don't use `\\+` in `sed` patterns, as this is less portable.\n * Work around GCC 4.7.0 bug (compilation error) on Linux ia64 (Itanium) by\n   almost completely disabling optimization on that platform if GCC 4.7.x\n   is detected.  This doesn't hurt much if we later rebuild MPIR with a (non-\n@@ -32,9 +46,10 @@\n   built GCC.)  Cf. #12782.\n * Fix a potential race condition in yasm's build by patching the re2c source.\n   Cf. #11844.\n-* Added `quote_asm.patch` to add proper quoting to the m4 in .asm files.\n * Add \"`patch` loop\" to apply any patches (`*.patch`) located in `patches/`.\n-  Use this to patch gmp-h.in instead of copying the file.\n+  Currently only the re2c patch matches that; the prepatched header to support\n+  Sun's C compiler is still copied over (and only on SunOS, although it doesn't\n+  do any harm on other platforms).\n * Minor clean-up; e.g. redirect error messages and warnings to `stderr`,\n   quote parameter to `--libdir`, add some comments and messages, also save\n   user's setting of `LDFLAGS` and `ABI`.\n@@ -47,7 +62,7 @@\n * Remove forcing a sequential `make install` again, since\n   the potential race condition was fixed in MPIR 2.1.4.\n * Fix `.hgtags`, which contained duplicate entries, and\n-  was missing others. \n+  was missing others.\n \n ---\n \n@@ -59,21 +74,22 @@\n \n ---\n \n-Some **old spkgs**:\n+Some **older spkgs**:\n \n+* [http://boxen.math.washington.edu/home/leif/Sage/spkgs/mpir-2.4.0.p2.spkg](http://boxen.math.washington.edu/home/leif/Sage/spkgs/mpir-2.4.0.p2.spkg) (based on 2.1.3.p9) \n+\n+  md5sum: `c9e6d8e2f5de4a09b4b16ee2354a9e17  mpir-2.4.0.p2.spkg`\n * [http://boxen.math.washington.edu/home/leif/Sage/spkgs/mpir-2.4.0.p1.spkg](http://boxen.math.washington.edu/home/leif/Sage/spkgs/mpir-2.4.0.p1.spkg) (based on 2.1.3.p9) \n \n   md5sum: `0d88b7dfe358bb429a5a9aa3a3b4b00b  mpir-2.4.0.p1.spkg`\n+* http://spkg-upload.googlecode.com/files/mpir-2.4.0.p0.spkg (based on 2.1.3.p4) \n \n+  md5sum: `98e04aa43ceef04d83574f0ee8e152fc  mpir-2.4.0.p0.spkg`\n * http://spkg-upload.googlecode.com/files/mpir-2.3.1.p0.spkg (based on 2.1.3.p4) \n \n   md5sum: `ff0104e302611e49604a1c4ead97cbf4  mpir-2.3.1.p0.spkg`\n \n-* http://spkg-upload.googlecode.com/files/mpir-2.4.0.p0.spkg (based on 2.1.3.p4) \n-\n-  md5sum: `98e04aa43ceef04d83574f0ee8e152fc  mpir-2.4.0.p0.spkg`\n-\n-You may want to give both of them a try, although the former is just intended as a \"fallback\" spkg in case problems introduced in the latter should arise.\n+The last is just intended as a \"fallback\" spkg in case problems should arise.\n \n ### mpir-2.4.0.p0 (Leif Leonhardy, July 21st, 2011)\n * Upstream upgrade to MPIR 2.4.0 (#11616).\n@@ -89,19 +105,21 @@\n \n ---\n \n-\n-\n-\n The list of changes between MPIR 2.1.3 (more precisely, 2.1.1) and MPIR 2.4.0 is fairly long, so I haven't put them into the description, but [attached them](https://github.com/sagemath/sage/files/ticket11616/MPIR_upstream_changes_between_2.1.1_and_2.4.0.txt) in a plain text file.\n \n+---\n \n+To install / test the spkg, it is sufficient to just\n \n+1. Download the new spkg and copy it into `$SAGE_ROOT/spkg/standard/`.\n \n-For instructions on how to install / test the spkgs see also #8664.  It is sufficient to just\n+2. Install the MPIR spkg:\n \n-* copy the spkg into `$SAGE_ROOT/spkg/standard/`, then\n+```sh\n+$ ./sage -f spkg/standard/mpir-<version>.spkg\n+```\n \n-* run\n+3. Re-install all packages depending on MPIR:\n \n ```sh\n $ env SAGE_UPGRADING=yes make build\n@@ -120,4 +138,3 @@\n $ env SAGE_UPGRADING=yes make build # rebuilds all dependent packages\n ```\n Afterwards you can run `make doc` to (re)build the documentation, and / or `make ptestlong` to run Sage's full test suite in parallel.\n-\n``````\n",
    "created_at": "2012-04-10T12:40:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121710",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,23 +5,37 @@
 
 The following **new spkg** is based on the latest MPIR 2.1.3 spkg, the p9 from #12131:
 
-**New spkg:** [http://boxen.math.washington.edu/home/jdemeyer/spkg/mpir-2.4.0.p2.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/mpir-2.4.0.p2.spkg)
+**New spkg:** [http://boxen.math.washington.edu/home/jdemeyer/spkg/mpir-2.4.0.p3.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/mpir-2.4.0.p3.spkg)
 
 (Preliminary; changes not yet committed.)
 
-
-### mpir-2.4.0.p2 (Leif Leonhardy, Jeroen Demeyer, April 9th, 2012)
- #11616 (upgrading MPIR), further fixes:
+### mpir-2.4.0.p3 (Jeroen Demeyer, April 10th, 2012)
+ Trac #11616, reviewer fixes:
 * When the first configure run (with CFLAGS unset) of MPIR fails, bail
   out with an error.  I am not aware of any system where MPIR fails
   to configure with CFLAGS unset but succeeds with CFLAGS set.
-  -- Jeroen Demeyer
   This implies the following simplifications:
   - We no longer read CC and CFLAGS from /usr/include/gmp.h or
     /usr/local/include/gmp.h
   - We no longer try to add -march=native, we simply use MPIR's flags.
 * Extract $CC and $CFLAGS from Makefile instead of mpir.h, which is
   simpler and more reliable.
+* Added `quote_asm.patch` to add proper quoting to the m4 in .asm files.
+* Use `patch` to patch gmp-h.in instead of copying the file.
+* Remove "unset PYTHON" which is not needed anymore since Trac #10492.
+
+### mpir-2.4.0.p2 (Leif Leonhardy, April 4th, 2012)
+ #11616 (upgrading MPIR), further fixes:
+* Before enabling `-march=native`, minimalistically check whether the
+  system's assembler also understands the instructions the compiler emits
+  with that option.  (Work-around for e.g. GCC 4.6.3 on MacOS X 10.x and
+  Intel Core i7-family CPUs with AVX.)
+* Do not unconditionally unset `PYTHON`, since Sage (>=5.0.beta10) no longer
+  pollutes the environment with its package version variables, which previous-
+  ly confused yasm's `configure`.
+* Fix extraction of `__GMP_CC` and `__GMP_CFLAGS` from `gmp.h`, since MPIR
+  meanwhile defines these to preprocessor variables (rather than literals).
+  Also don't use `\+` in `sed` patterns, as this is less portable.
 * Work around GCC 4.7.0 bug (compilation error) on Linux ia64 (Itanium) by
   almost completely disabling optimization on that platform if GCC 4.7.x
   is detected.  This doesn't hurt much if we later rebuild MPIR with a (non-
@@ -32,9 +46,10 @@
   built GCC.)  Cf. #12782.
 * Fix a potential race condition in yasm's build by patching the re2c source.
   Cf. #11844.
-* Added `quote_asm.patch` to add proper quoting to the m4 in .asm files.
 * Add "`patch` loop" to apply any patches (`*.patch`) located in `patches/`.
-  Use this to patch gmp-h.in instead of copying the file.
+  Currently only the re2c patch matches that; the prepatched header to support
+  Sun's C compiler is still copied over (and only on SunOS, although it doesn't
+  do any harm on other platforms).
 * Minor clean-up; e.g. redirect error messages and warnings to `stderr`,
   quote parameter to `--libdir`, add some comments and messages, also save
   user's setting of `LDFLAGS` and `ABI`.
@@ -47,7 +62,7 @@
 * Remove forcing a sequential `make install` again, since
   the potential race condition was fixed in MPIR 2.1.4.
 * Fix `.hgtags`, which contained duplicate entries, and
-  was missing others. 
+  was missing others.
 
 ---
 
@@ -59,21 +74,22 @@
 
 ---
 
-Some **old spkgs**:
+Some **older spkgs**:
 
+* [http://boxen.math.washington.edu/home/leif/Sage/spkgs/mpir-2.4.0.p2.spkg](http://boxen.math.washington.edu/home/leif/Sage/spkgs/mpir-2.4.0.p2.spkg) (based on 2.1.3.p9) 
+
+  md5sum: `c9e6d8e2f5de4a09b4b16ee2354a9e17  mpir-2.4.0.p2.spkg`
 * [http://boxen.math.washington.edu/home/leif/Sage/spkgs/mpir-2.4.0.p1.spkg](http://boxen.math.washington.edu/home/leif/Sage/spkgs/mpir-2.4.0.p1.spkg) (based on 2.1.3.p9) 
 
   md5sum: `0d88b7dfe358bb429a5a9aa3a3b4b00b  mpir-2.4.0.p1.spkg`
+* http://spkg-upload.googlecode.com/files/mpir-2.4.0.p0.spkg (based on 2.1.3.p4) 
 
+  md5sum: `98e04aa43ceef04d83574f0ee8e152fc  mpir-2.4.0.p0.spkg`
 * http://spkg-upload.googlecode.com/files/mpir-2.3.1.p0.spkg (based on 2.1.3.p4) 
 
   md5sum: `ff0104e302611e49604a1c4ead97cbf4  mpir-2.3.1.p0.spkg`
 
-* http://spkg-upload.googlecode.com/files/mpir-2.4.0.p0.spkg (based on 2.1.3.p4) 
-
-  md5sum: `98e04aa43ceef04d83574f0ee8e152fc  mpir-2.4.0.p0.spkg`
-
-You may want to give both of them a try, although the former is just intended as a "fallback" spkg in case problems introduced in the latter should arise.
+The last is just intended as a "fallback" spkg in case problems should arise.
 
 ### mpir-2.4.0.p0 (Leif Leonhardy, July 21st, 2011)
 * Upstream upgrade to MPIR 2.4.0 (#11616).
@@ -89,19 +105,21 @@
 
 ---
 
-
-
-
 The list of changes between MPIR 2.1.3 (more precisely, 2.1.1) and MPIR 2.4.0 is fairly long, so I haven't put them into the description, but [attached them](https://github.com/sagemath/sage/files/ticket11616/MPIR_upstream_changes_between_2.1.1_and_2.4.0.txt) in a plain text file.
 
+---
 
+To install / test the spkg, it is sufficient to just
 
+1. Download the new spkg and copy it into `$SAGE_ROOT/spkg/standard/`.
 
-For instructions on how to install / test the spkgs see also #8664.  It is sufficient to just
+2. Install the MPIR spkg:
 
-* copy the spkg into `$SAGE_ROOT/spkg/standard/`, then
+```sh
+$ ./sage -f spkg/standard/mpir-<version>.spkg
+```
 
-* run
+3. Re-install all packages depending on MPIR:
 
 ```sh
 $ env SAGE_UPGRADING=yes make build
@@ -120,4 +138,3 @@
 $ env SAGE_UPGRADING=yes make build # rebuilds all dependent packages
 ```
 Afterwards you can run `make doc` to (re)build the documentation, and / or `make ptestlong` to run Sage's full test suite in parallel.
-
``````




---

archive/issue_comments_121711.json:
```json
{
    "body": "Attachment: **[mpir-2.4.0.p1-p2.diff.gz](https://github.com/sagemath/sage/files/ticket11616/mpir-2.4.0.p1-p2.diff.gz)**\n\nDiff between the 2.4.0.p1 and 2.4.0.p2 spkgs. For reference / review only.",
    "created_at": "2012-04-10T12:43:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121711",
    "user": "https://github.com/jdemeyer"
}
```

Attachment: **[mpir-2.4.0.p1-p2.diff.gz](https://github.com/sagemath/sage/files/ticket11616/mpir-2.4.0.p1-p2.diff.gz)**

Diff between the 2.4.0.p1 and 2.4.0.p2 spkgs. For reference / review only.



---

archive/issue_comments_121712.json:
```json
{
    "body": "<a id='comment:57'>Comment 57:</a>\nLeif, I took your .p2, committed the changes and based my .p3 on that.  If a future version of the MPIR spkg wants to re-enable some of the code I deleted, it's in the Mercurial history, so it's not lost forever.",
    "created_at": "2012-04-10T12:50:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121712",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:57'>Comment 57:</a>
Leif, I took your .p2, committed the changes and based my .p3 on that.  If a future version of the MPIR spkg wants to re-enable some of the code I deleted, it's in the Mercurial history, so it's not lost forever.



---

archive/issue_comments_121713.json:
```json
{
    "body": "<a id='comment:58'>Comment 58:</a>\nReplying to [@nexttime](#comment%3A53):\n> If one makes changes to other people's code, one should always make a diff; that's what reviewer patches are for.  I also wanted to make further changes.  Apart from that, it's confusing to have different spkgs with the same patch level at different locations.\n\nAgreed, that's fixed now.\n\n> XD Just follow the instructions given in this ticket's description (and elsewhere):\n\nI fixed your instructions.\n\n> > The patch isn't that large, so it's not going to \"blow up\" the Mercurial repository.  Besides, I don't want to worry about the portability of the find/sed commands that I'm using.\n\n> \n> :-) Elsewhere we do...\n\nAgain: since I'm not sure how to do it in a portable way, I prefer to be safe and not do it.\n\n> >  Reading them from Makefile is absolutely the easiest way.\n\n> \n> Is it?  You use almost the same `sed` commands.  And it's more error-prone; just imagine we have\n> \n> ```make\n> CFLAGS = -foo -bar # This is a comment.\n> ```\n> Then `mpir_cflags` would certainly not be empty, but ... (Likewise for `CC`.)  Even the usage of one or more tabs can break your code.  \n\nThis is all true, but the point is that MPIR (actually, automake) doesn't put those comments, nor do they use TABs.  We cannot predict how `Makefile` will look like in the future, but we also cannot predict how `gmp.h` or `mpir.h` will look like in the future.  I think it is very unlikely that a future MPIR will break my script in a way that nobody notices.\n\n> Is it?  But removing the code *is* in its scope?\n\nThe removed code wasn't used.  Feel free to make a new MPIR spkg to re-enable `-march=native`.  Even better: fix the upstream code to add `march=native` if supported.",
    "created_at": "2012-04-10T13:03:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121713",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:58'>Comment 58:</a>
Replying to [@nexttime](#comment%3A53):
> If one makes changes to other people's code, one should always make a diff; that's what reviewer patches are for.  I also wanted to make further changes.  Apart from that, it's confusing to have different spkgs with the same patch level at different locations.

Agreed, that's fixed now.

> XD Just follow the instructions given in this ticket's description (and elsewhere):

I fixed your instructions.

> > The patch isn't that large, so it's not going to "blow up" the Mercurial repository.  Besides, I don't want to worry about the portability of the find/sed commands that I'm using.

> 
> :-) Elsewhere we do...

Again: since I'm not sure how to do it in a portable way, I prefer to be safe and not do it.

> >  Reading them from Makefile is absolutely the easiest way.

> 
> Is it?  You use almost the same `sed` commands.  And it's more error-prone; just imagine we have
> 
> ```make
> CFLAGS = -foo -bar # This is a comment.
> ```
> Then `mpir_cflags` would certainly not be empty, but ... (Likewise for `CC`.)  Even the usage of one or more tabs can break your code.  

This is all true, but the point is that MPIR (actually, automake) doesn't put those comments, nor do they use TABs.  We cannot predict how `Makefile` will look like in the future, but we also cannot predict how `gmp.h` or `mpir.h` will look like in the future.  I think it is very unlikely that a future MPIR will break my script in a way that nobody notices.

> Is it?  But removing the code *is* in its scope?

The removed code wasn't used.  Feel free to make a new MPIR spkg to re-enable `-march=native`.  Even better: fix the upstream code to add `march=native` if supported.



---

archive/issue_comments_121714.json:
```json
{
    "body": "<a id='comment:59'>Comment 59:</a>\nJustin Walker reported success on OS X 10.7 with my previous .p2 spkg (essentially equal to the current .p3).  The relevant part of the log:\n\n```\n****************************************************\nHost system:\nDarwin Eisenstein.local 11.1.0 Darwin Kernel Version 11.1.0: Tue Jul 26 16:07:11 PDT 2011; root:xnu-1699.22.81~1/RELEASE_X86_64 x86_64\n****************************************************\nC compiler: gcc\nC compiler version:\nUsing built-in specs.\nCOLLECT_GCC=gcc\nCOLLECT_LTO_WRAPPER=/private/tmp/sage-5.0.beta12-gcc/local/libexec/gcc/x86_64-apple-darwin11.1.0/4.6.3/lto-wrapper\nTarget: x86_64-apple-darwin11.1.0\nConfigured with: ../src/configure --prefix=/private/tmp/sage-5.0.beta12-gcc/local --with-local-prefix=/private/tmp/sage-5.0.beta12-gcc/local --with-gmp=/private/tmp/sage-5.0.beta12-gcc/local --with-mpfr=/private/tmp/sage-5.0.beta12-gcc/local --with-mpc=/private/tmp/sage-5.0.beta12-gcc/local --with-system-zlib --disable-multilib --enable-checking=yes\nThread model: posix\ngcc version 4.6.3 (GCC)\n****************************************************\n[...]\nSettings chosen by MPIR when configuring with CFLAGS unset:\n  CC:      gcc -std=gnu99\n  CFLAGS:  -O2 -m64 -march=corei7 -mtune=corei7-avx\nSettings required to properly build MPIR, taking into account SAGE_DEBUG etc.:\n  CFLAGS:\n  LDFLAGS:\n  ABI:\nSettings from the \"global\" environment:\n  CC:      gcc\n  CFLAGS:\n  LDFLAGS:\n  ABI:\n  (CPP, CPPFLAGS, CXX and CXXFLAGS are listed below; these don't get modified.)\nUsing MPIR's settings (plus mandatory ones).\nFinally using the following settings:\n  CC=gcc\n  CFLAGS=-O2 -m64 -march=corei7 -mtune=corei7-avx\n  CPP=\n  CPPFLAGS=\n  CXX=g++\n  CXXFLAGS=\n  LDFLAGS=\n  ABI=\n(These settings may still get overridden by 'configure' or Makefiles.)\nConfiguring MPIR with the following options:\n    --prefix=\"/private/tmp/sage-5.0.beta12-gcc/local\" --libdir=\"/private/tmp/sage-5.0.beta12-gcc/local/lib\" --enable-cxx --enable-static --enable-gmpcompat --enable-shared\n```",
    "created_at": "2012-04-10T21:46:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121714",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:59'>Comment 59:</a>
Justin Walker reported success on OS X 10.7 with my previous .p2 spkg (essentially equal to the current .p3).  The relevant part of the log:

```
****************************************************
Host system:
Darwin Eisenstein.local 11.1.0 Darwin Kernel Version 11.1.0: Tue Jul 26 16:07:11 PDT 2011; root:xnu-1699.22.81~1/RELEASE_X86_64 x86_64
****************************************************
C compiler: gcc
C compiler version:
Using built-in specs.
COLLECT_GCC=gcc
COLLECT_LTO_WRAPPER=/private/tmp/sage-5.0.beta12-gcc/local/libexec/gcc/x86_64-apple-darwin11.1.0/4.6.3/lto-wrapper
Target: x86_64-apple-darwin11.1.0
Configured with: ../src/configure --prefix=/private/tmp/sage-5.0.beta12-gcc/local --with-local-prefix=/private/tmp/sage-5.0.beta12-gcc/local --with-gmp=/private/tmp/sage-5.0.beta12-gcc/local --with-mpfr=/private/tmp/sage-5.0.beta12-gcc/local --with-mpc=/private/tmp/sage-5.0.beta12-gcc/local --with-system-zlib --disable-multilib --enable-checking=yes
Thread model: posix
gcc version 4.6.3 (GCC)
****************************************************
[...]
Settings chosen by MPIR when configuring with CFLAGS unset:
  CC:      gcc -std=gnu99
  CFLAGS:  -O2 -m64 -march=corei7 -mtune=corei7-avx
Settings required to properly build MPIR, taking into account SAGE_DEBUG etc.:
  CFLAGS:
  LDFLAGS:
  ABI:
Settings from the "global" environment:
  CC:      gcc
  CFLAGS:
  LDFLAGS:
  ABI:
  (CPP, CPPFLAGS, CXX and CXXFLAGS are listed below; these don't get modified.)
Using MPIR's settings (plus mandatory ones).
Finally using the following settings:
  CC=gcc
  CFLAGS=-O2 -m64 -march=corei7 -mtune=corei7-avx
  CPP=
  CPPFLAGS=
  CXX=g++
  CXXFLAGS=
  LDFLAGS=
  ABI=
(These settings may still get overridden by 'configure' or Makefiles.)
Configuring MPIR with the following options:
    --prefix="/private/tmp/sage-5.0.beta12-gcc/local" --libdir="/private/tmp/sage-5.0.beta12-gcc/local/lib" --enable-cxx --enable-static --enable-gmpcompat --enable-shared
```



---

archive/issue_comments_121715.json:
```json
{
    "body": "<a id='comment:60'>Comment 60:</a>\nI restored the `unset PYTHON` part.\n\nI also added a check for `-mpower*` flags in spkg-install, as MPIR adds `-mpowerpc` on 32-bit PowerPC systems (at least on Skynet silius in 32-bit mode).\n\nThe spkg is still in the same location, needs review.",
    "created_at": "2012-04-14T21:36:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121715",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:60'>Comment 60:</a>
I restored the `unset PYTHON` part.

I also added a check for `-mpower*` flags in spkg-install, as MPIR adds `-mpowerpc` on 32-bit PowerPC systems (at least on Skynet silius in 32-bit mode).

The spkg is still in the same location, needs review.



---

archive/issue_comments_121716.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -9,7 +9,7 @@\n \n (Preliminary; changes not yet committed.)\n \n-### mpir-2.4.0.p3 (Jeroen Demeyer, April 10th, 2012)\n+### mpir-2.4.0.p3 (Jeroen Demeyer, April 14th, 2012)\n  Trac #11616, reviewer fixes:\n * When the first configure run (with CFLAGS unset) of MPIR fails, bail\n   out with an error.  I am not aware of any system where MPIR fails\n@@ -22,7 +22,8 @@\n   simpler and more reliable.\n * Added `quote_asm.patch` to add proper quoting to the m4 in .asm files.\n * Use `patch` to patch gmp-h.in instead of copying the file.\n-* Remove \"unset PYTHON\" which is not needed anymore since Trac #10492.\n+* In get_processor_specific_cflags() in spkg-install, also check for\n+  -mpower* flags, as MPIR adds -mpower on 32-bit PowerPC systems.\n \n ### mpir-2.4.0.p2 (Leif Leonhardy, April 4th, 2012)\n  #11616 (upgrading MPIR), further fixes:\n``````\n",
    "created_at": "2012-04-14T21:37:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121716",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -9,7 +9,7 @@
 
 (Preliminary; changes not yet committed.)
 
-### mpir-2.4.0.p3 (Jeroen Demeyer, April 10th, 2012)
+### mpir-2.4.0.p3 (Jeroen Demeyer, April 14th, 2012)
  Trac #11616, reviewer fixes:
 * When the first configure run (with CFLAGS unset) of MPIR fails, bail
   out with an error.  I am not aware of any system where MPIR fails
@@ -22,7 +22,8 @@
   simpler and more reliable.
 * Added `quote_asm.patch` to add proper quoting to the m4 in .asm files.
 * Use `patch` to patch gmp-h.in instead of copying the file.
-* Remove "unset PYTHON" which is not needed anymore since Trac #10492.
+* In get_processor_specific_cflags() in spkg-install, also check for
+  -mpower* flags, as MPIR adds -mpower on 32-bit PowerPC systems.
 
 ### mpir-2.4.0.p2 (Leif Leonhardy, April 4th, 2012)
  #11616 (upgrading MPIR), further fixes:
``````




---

archive/issue_comments_121717.json:
```json
{
    "body": "<a id='comment:62'>Comment 62:</a>\nLooks good to me. If you commit the outstanding changes then I'll give it a positive review.",
    "created_at": "2012-04-19T16:47:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121717",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:62'>Comment 62:</a>
Looks good to me. If you commit the outstanding changes then I'll give it a positive review.



---

archive/issue_comments_121718.json:
```json
{
    "body": "<a id='comment:63'>Comment 63:</a>\nReplying to [@jdemeyer](#comment%3A58):\n> Replying to [@nexttime](#comment%3A53):\n> > >  Reading them from Makefile is absolutely the easiest way.\n\n> > \n> > Is it?  You use almost the same `sed` commands.  And it's more error-prone; just imagine we have\n> > \n> > ```make\n> > CFLAGS = -foo -bar # This is a comment.\n> > ```\n> > Then `mpir_cflags` would certainly not be empty, but ... (Likewise for `CC`.)  Even the usage of one or more tabs can break your code.  \n\n> This is all true, but the point is that MPIR (actually, automake) doesn't put those comments, nor do they use TABs.  We cannot predict how `Makefile` will look like in the future, but we also cannot predict how `gmp.h` or `mpir.h` will look like in the future.  I think it is very unlikely that a future MPIR will break my script in a way that nobody notices.\n\nThis doesn't make sense at all.  Why do you refuse to use the documented, supposed (and hence safest) way (or location) to get the flags from?  (And it's in no way more complicated than what you currently do.  You could of course also run the preprocessor on `gmp.h`, but that's IMHO slight overkill.)\n\nThe structure and/or contents of the generated Makefiles is likely to change with other versions of autotools, probably without intent of the MPIR developers.\n\nIn any case, you should have just changed the `get_upstream_selected_cflags()` function, instead of removing it.\n\n---\n\nYou should also add `-mno-power*` to `get_processor_specific_cflags()`, since at least a user might use such.\n\nThe other changes are reasonable, so I'm ok with the spkg modulo the useless changes w.r.t. extracting `CFLAGS` (and as already mentioned, I'd just change the `.asm` files on the fly, not add a large patch which is under revision control for that*).\n\nDon't know whether we should `cat` the whole `config.log` in case `configure` failed in the first place; I'd just print its full filename (and we don't have to \"rename\" it), like we do in some other spkgs.\n\n\n[* The \"autotools way\" would by the way be to check whether m4 bails out on `define(,1)`, and only if that's the case, modify the offending source files.]",
    "created_at": "2012-04-19T18:15:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121718",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:63'>Comment 63:</a>
Replying to [@jdemeyer](#comment%3A58):
> Replying to [@nexttime](#comment%3A53):
> > >  Reading them from Makefile is absolutely the easiest way.

> > 
> > Is it?  You use almost the same `sed` commands.  And it's more error-prone; just imagine we have
> > 
> > ```make
> > CFLAGS = -foo -bar # This is a comment.
> > ```
> > Then `mpir_cflags` would certainly not be empty, but ... (Likewise for `CC`.)  Even the usage of one or more tabs can break your code.  

> This is all true, but the point is that MPIR (actually, automake) doesn't put those comments, nor do they use TABs.  We cannot predict how `Makefile` will look like in the future, but we also cannot predict how `gmp.h` or `mpir.h` will look like in the future.  I think it is very unlikely that a future MPIR will break my script in a way that nobody notices.

This doesn't make sense at all.  Why do you refuse to use the documented, supposed (and hence safest) way (or location) to get the flags from?  (And it's in no way more complicated than what you currently do.  You could of course also run the preprocessor on `gmp.h`, but that's IMHO slight overkill.)

The structure and/or contents of the generated Makefiles is likely to change with other versions of autotools, probably without intent of the MPIR developers.

In any case, you should have just changed the `get_upstream_selected_cflags()` function, instead of removing it.

---

You should also add `-mno-power*` to `get_processor_specific_cflags()`, since at least a user might use such.

The other changes are reasonable, so I'm ok with the spkg modulo the useless changes w.r.t. extracting `CFLAGS` (and as already mentioned, I'd just change the `.asm` files on the fly, not add a large patch which is under revision control for that*).

Don't know whether we should `cat` the whole `config.log` in case `configure` failed in the first place; I'd just print its full filename (and we don't have to "rename" it), like we do in some other spkgs.


[* The "autotools way" would by the way be to check whether m4 bails out on `define(,1)`, and only if that's the case, modify the offending source files.]



---

archive/issue_comments_121719.json:
```json
{
    "body": "<a id='comment:64'>Comment 64:</a>\nReplying to [@nexttime](#comment%3A63):\n> Why do you refuse to use the documented, supposed (and hence safest) way (or location) to get the flags from?\n\nIs it really documented as such?  I don't find any mention of `GMP_CC` or `MPIR_CC` in the MPIR manual.",
    "created_at": "2012-04-19T18:35:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121719",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:64'>Comment 64:</a>
Replying to [@nexttime](#comment%3A63):
> Why do you refuse to use the documented, supposed (and hence safest) way (or location) to get the flags from?

Is it really documented as such?  I don't find any mention of `GMP_CC` or `MPIR_CC` in the MPIR manual.



---

archive/issue_comments_121720.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -23,7 +23,8 @@\n * Added `quote_asm.patch` to add proper quoting to the m4 in .asm files.\n * Use `patch` to patch gmp-h.in instead of copying the file.\n * In get_processor_specific_cflags() in spkg-install, also check for\n-  -mpower* flags, as MPIR adds -mpower on 32-bit PowerPC systems.\n+  -mpower* and -mno-power* flags, as MPIR adds -mpower on 32-bit\n+  PowerPC systems.\n \n ### mpir-2.4.0.p2 (Leif Leonhardy, April 4th, 2012)\n  #11616 (upgrading MPIR), further fixes:\n``````\n",
    "created_at": "2012-04-26T07:31:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121720",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -23,7 +23,8 @@
 * Added `quote_asm.patch` to add proper quoting to the m4 in .asm files.
 * Use `patch` to patch gmp-h.in instead of copying the file.
 * In get_processor_specific_cflags() in spkg-install, also check for
-  -mpower* flags, as MPIR adds -mpower on 32-bit PowerPC systems.
+  -mpower* and -mno-power* flags, as MPIR adds -mpower on 32-bit
+  PowerPC systems.
 
 ### mpir-2.4.0.p2 (Leif Leonhardy, April 4th, 2012)
  #11616 (upgrading MPIR), further fixes:
``````




---

archive/issue_comments_121721.json:
```json
{
    "body": "<a id='comment:66'>Comment 66:</a>\nReplying to [@nexttime](#comment%3A63):\n> You should also add `-mno-power*` to `get_processor_specific_cflags()`, since at least a user might use such.\n\nDone.",
    "created_at": "2012-04-26T07:32:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121721",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:66'>Comment 66:</a>
Replying to [@nexttime](#comment%3A63):
> You should also add `-mno-power*` to `get_processor_specific_cflags()`, since at least a user might use such.

Done.



---

archive/issue_comments_121722.json:
```json
{
    "body": "<a id='comment:67'>Comment 67:</a>\nReplying to [@nexttime](#comment%3A63):\n> Don't know whether we should `cat` the whole `config.log` in case `configure` failed in the first place; I'd just print its full filename (and we don't have to \"rename\" it), like we do in some other spkgs.\n\nI see, we don't `cat config.log`, but the otherwise normal output.  (Must have been late...)\n\nStill, I'd print the pathname of `config.log`, which usually reveals what really went wrong, if `configure` failed.",
    "created_at": "2012-04-26T11:40:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121722",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:67'>Comment 67:</a>
Replying to [@nexttime](#comment%3A63):
> Don't know whether we should `cat` the whole `config.log` in case `configure` failed in the first place; I'd just print its full filename (and we don't have to "rename" it), like we do in some other spkgs.

I see, we don't `cat config.log`, but the otherwise normal output.  (Must have been late...)

Still, I'd print the pathname of `config.log`, which usually reveals what really went wrong, if `configure` failed.



---

archive/issue_comments_121723.json:
```json
{
    "body": "<a id='comment:68'>Comment 68:</a>\nThis builds successfully (and passes self-tests) for me on various platforms. I don't think I'm competent to review all of the patches; what can we do to make some progress on this ticket? (One very minor comment: in the last version, I would have used \"hg rename\" to change `gmp-h.in.diff` to `gmp-h.in.patch`.)",
    "created_at": "2012-04-27T17:06:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121723",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:68'>Comment 68:</a>
This builds successfully (and passes self-tests) for me on various platforms. I don't think I'm competent to review all of the patches; what can we do to make some progress on this ticket? (One very minor comment: in the last version, I would have used "hg rename" to change `gmp-h.in.diff` to `gmp-h.in.patch`.)



---

archive/issue_comments_121724.json:
```json
{
    "body": "<a id='comment:69'>Comment 69:</a>\nI think this ticket shows that there is a need for a better management of C(XX)FLAGS in Sage. Ideally via some shell script that is part of Sage, so that not every spkg has to reinvent the wheel. The whole approach of parsing the install of another spkg to recreate its CFLAGS is just wrong, and arguing how to make this bandaid less likely to break in the future is not particularly helpful. \n\nBut now is not the time to create some CFLAGS framework. The spkg here seems to work pretty well, is better what we currently ship, is easy enough to read to see what it does, and is unlikely to be improved upon with some minor patches. So lets ship it!",
    "created_at": "2012-04-27T21:49:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121724",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:69'>Comment 69:</a>
I think this ticket shows that there is a need for a better management of C(XX)FLAGS in Sage. Ideally via some shell script that is part of Sage, so that not every spkg has to reinvent the wheel. The whole approach of parsing the install of another spkg to recreate its CFLAGS is just wrong, and arguing how to make this bandaid less likely to break in the future is not particularly helpful. 

But now is not the time to create some CFLAGS framework. The spkg here seems to work pretty well, is better what we currently ship, is easy enough to read to see what it does, and is unlikely to be improved upon with some minor patches. So lets ship it!



---

archive/issue_comments_121725.json:
```json
{
    "body": "Changed reviewer from **Jeroen Demeyer, Leif Leonhardy** to **Jeroen Demeyer, Leif Leonhardy, Volker Braun**",
    "created_at": "2012-04-28T12:04:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121725",
    "user": "https://github.com/jdemeyer"
}
```

Changed reviewer from **Jeroen Demeyer, Leif Leonhardy** to **Jeroen Demeyer, Leif Leonhardy, Volker Braun**



---

archive/issue_comments_121726.json:
```json
{
    "body": "<a id='comment:71'>Comment 71:</a>\nFor the record:\n\nThere seems to be some progress on the GCC 4.7 on ia64 issue, but assuming that\n\n* GCC 4.7.1 will be released in July, and\n\n* there'll (hopefully) be some Sage 5.1 or whatever *final* release before that,\n\nI think we can leave the GCC 4.7.**x** (rather than 4.7.**0**) work-around as is here.  (Same for the MPFR, GMP-ECM and some other, not yet merged / positively reviewed tickets.)",
    "created_at": "2012-04-29T11:24:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121726",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:71'>Comment 71:</a>
For the record:

There seems to be some progress on the GCC 4.7 on ia64 issue, but assuming that

* GCC 4.7.1 will be released in July, and

* there'll (hopefully) be some Sage 5.1 or whatever *final* release before that,

I think we can leave the GCC 4.7.**x** (rather than 4.7.**0**) work-around as is here.  (Same for the MPFR, GMP-ECM and some other, not yet merged / positively reviewed tickets.)



---

archive/issue_comments_121727.json:
```json
{
    "body": "<a id='comment:72'>Comment 72:</a>\nLeif, do you agree with giving this ticket positive_review?",
    "created_at": "2012-04-29T12:26:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121727",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:72'>Comment 72:</a>
Leif, do you agree with giving this ticket positive_review?



---

archive/issue_comments_121728.json:
```json
{
    "body": "<a id='comment:73'>Comment 73:</a>\nReplying to [@jdemeyer](#comment%3A72):\n> Leif, do you agree with giving this ticket positive_review?\n\nWell, printing the path to `config.log` in case the first `configure` run failed is certainly a minor issue (although adding it is a minor change which wouldn't need large-scale testing as well).\n\nVolker said he was waiting for the changes to be committed, and I haven't looked at the latest spkg (w.r.t. usual spkg sanity checks) myself, otherwise I would have set it to positive review already.\n\nSo I just don't know whether you were planning to make some further changes, and/or commit them.",
    "created_at": "2012-04-29T12:38:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121728",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:73'>Comment 73:</a>
Replying to [@jdemeyer](#comment%3A72):
> Leif, do you agree with giving this ticket positive_review?

Well, printing the path to `config.log` in case the first `configure` run failed is certainly a minor issue (although adding it is a minor change which wouldn't need large-scale testing as well).

Volker said he was waiting for the changes to be committed, and I haven't looked at the latest spkg (w.r.t. usual spkg sanity checks) myself, otherwise I would have set it to positive review already.

So I just don't know whether you were planning to make some further changes, and/or commit them.



---

archive/issue_comments_121729.json:
```json
{
    "body": "<a id='comment:74'>Comment 74:</a>\nReplying to [@nexttime](#comment%3A73):\n> So I just don't know whether you were planning to make some further changes, and/or commit them.\n\nAlso the description still states the p3 was preliminary.",
    "created_at": "2012-04-29T12:41:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121729",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:74'>Comment 74:</a>
Replying to [@nexttime](#comment%3A73):
> So I just don't know whether you were planning to make some further changes, and/or commit them.

Also the description still states the p3 was preliminary.



---

archive/issue_comments_121730.json:
```json
{
    "body": "<a id='comment:75'>Comment 75:</a>\nReplying to [@nexttime](#comment%3A73):\n> Volker said he was waiting for the changes to be committed, and I haven't looked at the latest spkg (w.r.t. usual spkg sanity checks) myself, otherwise I would have set it to positive review already.\n\nFWIW, the current(?) p3 spkg (md5sum `45bd5544cfa568e1d7752f335495c336`) looks technically sane to me (except that the changes aren't committed yet).\n\n(I guess it's unnecessary to mention that I of course don't agree on parts of the changelog entry in `SPKG.txt`.)",
    "created_at": "2012-04-29T13:53:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121730",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:75'>Comment 75:</a>
Replying to [@nexttime](#comment%3A73):
> Volker said he was waiting for the changes to be committed, and I haven't looked at the latest spkg (w.r.t. usual spkg sanity checks) myself, otherwise I would have set it to positive review already.

FWIW, the current(?) p3 spkg (md5sum `45bd5544cfa568e1d7752f335495c336`) looks technically sane to me (except that the changes aren't committed yet).

(I guess it's unnecessary to mention that I of course don't agree on parts of the changelog entry in `SPKG.txt`.)



---

archive/issue_comments_121731.json:
```json
{
    "body": "Diff between the 2.4.0.p2 and 2.4.0.p3 spkgs. For reference / review only.",
    "created_at": "2012-04-29T14:06:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121731",
    "user": "https://github.com/jdemeyer"
}
```

Diff between the 2.4.0.p2 and 2.4.0.p3 spkgs. For reference / review only.



---

archive/issue_comments_121732.json:
```json
{
    "body": "<a id='comment:76'>Comment 76:</a>\nAttachment: **[mpir-2.4.0.p2-p3.diff.gz](https://github.com/sagemath/sage/files/ticket11616/mpir-2.4.0.p2-p3.diff.gz)**\n\nAdded path to `config.log` in case of failure, committed changes.",
    "created_at": "2012-04-29T14:10:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121732",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:76'>Comment 76:</a>
Attachment: **[mpir-2.4.0.p2-p3.diff.gz](https://github.com/sagemath/sage/files/ticket11616/mpir-2.4.0.p2-p3.diff.gz)**

Added path to `config.log` in case of failure, committed changes.



---

archive/issue_comments_121733.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -7,9 +7,7 @@\n \n **New spkg:** [http://boxen.math.washington.edu/home/jdemeyer/spkg/mpir-2.4.0.p3.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/mpir-2.4.0.p3.spkg)\n \n-(Preliminary; changes not yet committed.)\n-\n-### mpir-2.4.0.p3 (Jeroen Demeyer, April 14th, 2012)\n+### mpir-2.4.0.p3 (Jeroen Demeyer, April 26th, 2012)\n  Trac #11616, reviewer fixes:\n * When the first configure run (with CFLAGS unset) of MPIR fails, bail\n   out with an error.  I am not aware of any system where MPIR fails\n@@ -76,37 +74,6 @@\n \n ---\n \n-Some **older spkgs**:\n-\n-* [http://boxen.math.washington.edu/home/leif/Sage/spkgs/mpir-2.4.0.p2.spkg](http://boxen.math.washington.edu/home/leif/Sage/spkgs/mpir-2.4.0.p2.spkg) (based on 2.1.3.p9) \n-\n-  md5sum: `c9e6d8e2f5de4a09b4b16ee2354a9e17  mpir-2.4.0.p2.spkg`\n-* [http://boxen.math.washington.edu/home/leif/Sage/spkgs/mpir-2.4.0.p1.spkg](http://boxen.math.washington.edu/home/leif/Sage/spkgs/mpir-2.4.0.p1.spkg) (based on 2.1.3.p9) \n-\n-  md5sum: `0d88b7dfe358bb429a5a9aa3a3b4b00b  mpir-2.4.0.p1.spkg`\n-* http://spkg-upload.googlecode.com/files/mpir-2.4.0.p0.spkg (based on 2.1.3.p4) \n-\n-  md5sum: `98e04aa43ceef04d83574f0ee8e152fc  mpir-2.4.0.p0.spkg`\n-* http://spkg-upload.googlecode.com/files/mpir-2.3.1.p0.spkg (based on 2.1.3.p4) \n-\n-  md5sum: `ff0104e302611e49604a1c4ead97cbf4  mpir-2.3.1.p0.spkg`\n-\n-The last is just intended as a \"fallback\" spkg in case problems should arise.\n-\n-### mpir-2.4.0.p0 (Leif Leonhardy, July 21st, 2011)\n-* Upstream upgrade to MPIR 2.4.0 (#11616).\n-\n-### mpir-2.3.1.p0 (Leif Leonhardy, July 20th, 2011)\n-* Upstream upgrade to MPIR 2.3.1 (#11616).\n-* Clean up .hgtags.\n-\n-### mpir-2.1.3.p4 (Leif Leonhardy, July 19th, 2011)\n-* #8664: Upgrade Sage's MPIR spkg to version 2.1.3 \n-\n- ...\n-\n----\n-\n The list of changes between MPIR 2.1.3 (more precisely, 2.1.1) and MPIR 2.4.0 is fairly long, so I haven't put them into the description, but [attached them](https://github.com/sagemath/sage/files/ticket11616/MPIR_upstream_changes_between_2.1.1_and_2.4.0.txt) in a plain text file.\n \n ---\n``````\n",
    "created_at": "2012-04-29T14:10:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121733",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -7,9 +7,7 @@
 
 **New spkg:** [http://boxen.math.washington.edu/home/jdemeyer/spkg/mpir-2.4.0.p3.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/mpir-2.4.0.p3.spkg)
 
-(Preliminary; changes not yet committed.)
-
-### mpir-2.4.0.p3 (Jeroen Demeyer, April 14th, 2012)
+### mpir-2.4.0.p3 (Jeroen Demeyer, April 26th, 2012)
  Trac #11616, reviewer fixes:
 * When the first configure run (with CFLAGS unset) of MPIR fails, bail
   out with an error.  I am not aware of any system where MPIR fails
@@ -76,37 +74,6 @@
 
 ---
 
-Some **older spkgs**:
-
-* [http://boxen.math.washington.edu/home/leif/Sage/spkgs/mpir-2.4.0.p2.spkg](http://boxen.math.washington.edu/home/leif/Sage/spkgs/mpir-2.4.0.p2.spkg) (based on 2.1.3.p9) 
-
-  md5sum: `c9e6d8e2f5de4a09b4b16ee2354a9e17  mpir-2.4.0.p2.spkg`
-* [http://boxen.math.washington.edu/home/leif/Sage/spkgs/mpir-2.4.0.p1.spkg](http://boxen.math.washington.edu/home/leif/Sage/spkgs/mpir-2.4.0.p1.spkg) (based on 2.1.3.p9) 
-
-  md5sum: `0d88b7dfe358bb429a5a9aa3a3b4b00b  mpir-2.4.0.p1.spkg`
-* http://spkg-upload.googlecode.com/files/mpir-2.4.0.p0.spkg (based on 2.1.3.p4) 
-
-  md5sum: `98e04aa43ceef04d83574f0ee8e152fc  mpir-2.4.0.p0.spkg`
-* http://spkg-upload.googlecode.com/files/mpir-2.3.1.p0.spkg (based on 2.1.3.p4) 
-
-  md5sum: `ff0104e302611e49604a1c4ead97cbf4  mpir-2.3.1.p0.spkg`
-
-The last is just intended as a "fallback" spkg in case problems should arise.
-
-### mpir-2.4.0.p0 (Leif Leonhardy, July 21st, 2011)
-* Upstream upgrade to MPIR 2.4.0 (#11616).
-
-### mpir-2.3.1.p0 (Leif Leonhardy, July 20th, 2011)
-* Upstream upgrade to MPIR 2.3.1 (#11616).
-* Clean up .hgtags.
-
-### mpir-2.1.3.p4 (Leif Leonhardy, July 19th, 2011)
-* #8664: Upgrade Sage's MPIR spkg to version 2.1.3 
-
- ...
-
----
-
 The list of changes between MPIR 2.1.3 (more precisely, 2.1.1) and MPIR 2.4.0 is fairly long, so I haven't put them into the description, but [attached them](https://github.com/sagemath/sage/files/ticket11616/MPIR_upstream_changes_between_2.1.1_and_2.4.0.txt) in a plain text file.
 
 ---
``````




---

archive/issue_events_137436.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-29T14:10:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11616#event-137436"
}
```



---

archive/issue_events_137437.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-29T14:10:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11616#event-137437"
}
```



---

archive/issue_events_137438.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-30T09:51:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11616#event-137438"
}
```



---

archive/issue_events_137439.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-30T09:51:28Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11616#event-137439"
}
```



---

archive/issue_comments_121734.json:
```json
{
    "body": "Merged: **sage-5.0.rc0**",
    "created_at": "2012-04-30T09:51:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121734",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.0.rc0**



---

archive/issue_comments_121735.json:
```json
{
    "body": "<a id='comment:78'>Comment 78:</a>\nReplying to [@vbraun](#comment%3A69):\n> I think this ticket shows that there is a need for a better management of C(XX)FLAGS in Sage. Ideally via some shell script that is part of Sage, so that not every spkg has to reinvent the wheel. The whole approach of parsing the install of another spkg to recreate its CFLAGS is just wrong [...]\n\nSee #12890 for a partial reply.\n\n\n\n\nW.r.t. \"parsing the install of another spkg\":\n\nNo spkg does this.  Some use preprocessor variables defined in other [s]pkgs' C headers, some use Python files of another, or use Python's `Makefile` settings through distutils, some even link to another's library and call functions for that purpose, others e.g. use `pkgconfig`.  Whether MPFR's, MPC's and GMP-ECM's (upstream) behaviour is *appropriate for Sage* has already been discussed elsewhere.\n\nThe specific problem with MPIR (similar to those with MPFR etc.) simply is that it by default doesn't allow to **add** or override *some* `CFLAGS`.  Therefore we have to cheat it by feeding it with its own, slightly modified flags after doing a \"dry\" build (i.e., running `configure` once just to see what flags it otherwise would use).\n\n\nWhat Jeroen calls \"good `CFLAGS`\" are basically `-march=...`(-related) parameters.  Also depending on MPIR's age (especially within Sage), these aren't always optimal.  Further, most of MPIR is implemented in assembly language, where `CFLAGS` are almost completely irrelevant.",
    "created_at": "2012-04-30T12:32:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11616",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11616#issuecomment-121735",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:78'>Comment 78:</a>
Replying to [@vbraun](#comment%3A69):
> I think this ticket shows that there is a need for a better management of C(XX)FLAGS in Sage. Ideally via some shell script that is part of Sage, so that not every spkg has to reinvent the wheel. The whole approach of parsing the install of another spkg to recreate its CFLAGS is just wrong [...]

See #12890 for a partial reply.




W.r.t. "parsing the install of another spkg":

No spkg does this.  Some use preprocessor variables defined in other [s]pkgs' C headers, some use Python files of another, or use Python's `Makefile` settings through distutils, some even link to another's library and call functions for that purpose, others e.g. use `pkgconfig`.  Whether MPFR's, MPC's and GMP-ECM's (upstream) behaviour is *appropriate for Sage* has already been discussed elsewhere.

The specific problem with MPIR (similar to those with MPFR etc.) simply is that it by default doesn't allow to **add** or override *some* `CFLAGS`.  Therefore we have to cheat it by feeding it with its own, slightly modified flags after doing a "dry" build (i.e., running `configure` once just to see what flags it otherwise would use).


What Jeroen calls "good `CFLAGS`" are basically `-march=...`(-related) parameters.  Also depending on MPIR's age (especially within Sage), these aren't always optimal.  Further, most of MPIR is implemented in assembly language, where `CFLAGS` are almost completely irrelevant.
