# Issue 11794: Optional cythonised cached hash for Python classes

archive/issues_011622.json:
```json
{
    "assignees": [
        "https://github.com/jasongrout"
    ],
    "body": "By default, the hash of an instance is obtained from the string representation. It would be computed over and over again, which is slow:\n\n```\nsage: from sage.structure.parent import Parent\nsage: P = Parent()\nsage: P.__hash__??\nType:method-wrapper\nBase Class:<type 'method-wrapper'>\nString Form:<method-wrapper '__hash__' of sage.structure.parent.Parent object at 0x53809b0>\nNamespace:Interactive\nDefinition:P.__hash__(self)\nSource:\n    def __hash__(self):\n        return hash(self.__repr__())\nsage: timeit(\"hash(P)\")\n625 loops, best of 3: 19.4 \u00b5s per loop\n```\n\nOf course, a solution is to cache the hash once it is computed. This is done, for instance, in polynomial rings, and it is much faster:\n\n```\nsage: P.<x> = QQ[]\nsage: P.__hash__??\nType:instancemethod\nBase Class:<type 'instancemethod'>\nString Form:<bound method PolynomialRing_field_with_category.__hash__ of Univariate Polynomial Ring in x over Rational Field>\nNamespace:Interactive\nFile:/mnt/local/king/SAGE/sandbox/sage-4.7.2.alpha2/local/lib/python2.6/site-packages/sage/rings/polynomial/polynomial_ring.py\nDefinition:P.__hash__(self)\nSource:\n    def __hash__(self):\n        # should be faster than just relying on the string representation\n        try:\n            return self._cached_hash\n        except AttributeError:\n            pass\n        h = self._cached_hash = hash((self.base_ring(),self.variable_name()))\n        return h\nsage: timeit(\"hash(P)\")\n625 loops, best of 3: 3.08 \u00b5s per loop\n```\n\nEven more speed is possible if the hash method is written in Cython.\n\nHowever, it would probably be unfeasible to rewrite all of Sage such that the hash is inherited from a cdef'd class, and also it may not be wanted to cache the hash.\n\nWhat I am proposing here is a metaclass, that provides the option to add a cached cythonised hash method to any class.\n\nApply [attachment: trac11794_fast_hash_metaclass.patch](https://github.com/sagemath/sage/files/ticket11794/trac11794_fast_hash_metaclass.patch.gz)\n\nDepends on #11115\nDepends on #11791\n\nCC:  @robertwb\n\nComponent: **misc**\n\nAuthor: **Simon King**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/11794_\n\n",
    "created_at": "2011-09-13T07:04:40Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/needs%20work"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Optional cythonised cached hash for Python classes",
    "type": "issue",
    "updated_at": "2022-12-29T01:28:25Z",
    "url": "https://github.com/sagemath/sage/issues/11794",
    "user": "https://github.com/simon-king-jena"
}
```
By default, the hash of an instance is obtained from the string representation. It would be computed over and over again, which is slow:

```
sage: from sage.structure.parent import Parent
sage: P = Parent()
sage: P.__hash__??
Type:method-wrapper
Base Class:<type 'method-wrapper'>
String Form:<method-wrapper '__hash__' of sage.structure.parent.Parent object at 0x53809b0>
Namespace:Interactive
Definition:P.__hash__(self)
Source:
    def __hash__(self):
        return hash(self.__repr__())
sage: timeit("hash(P)")
625 loops, best of 3: 19.4 µs per loop
```

Of course, a solution is to cache the hash once it is computed. This is done, for instance, in polynomial rings, and it is much faster:

```
sage: P.<x> = QQ[]
sage: P.__hash__??
Type:instancemethod
Base Class:<type 'instancemethod'>
String Form:<bound method PolynomialRing_field_with_category.__hash__ of Univariate Polynomial Ring in x over Rational Field>
Namespace:Interactive
File:/mnt/local/king/SAGE/sandbox/sage-4.7.2.alpha2/local/lib/python2.6/site-packages/sage/rings/polynomial/polynomial_ring.py
Definition:P.__hash__(self)
Source:
    def __hash__(self):
        # should be faster than just relying on the string representation
        try:
            return self._cached_hash
        except AttributeError:
            pass
        h = self._cached_hash = hash((self.base_ring(),self.variable_name()))
        return h
sage: timeit("hash(P)")
625 loops, best of 3: 3.08 µs per loop
```

Even more speed is possible if the hash method is written in Cython.

However, it would probably be unfeasible to rewrite all of Sage such that the hash is inherited from a cdef'd class, and also it may not be wanted to cache the hash.

What I am proposing here is a metaclass, that provides the option to add a cached cythonised hash method to any class.

Apply [attachment: trac11794_fast_hash_metaclass.patch](https://github.com/sagemath/sage/files/ticket11794/trac11794_fast_hash_metaclass.patch.gz)

Depends on #11115
Depends on #11791

CC:  @robertwb

Component: **misc**

Author: **Simon King**

_Issue created by migration from https://trac.sagemath.org/ticket/11794_





---

archive/issue_events_157057.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2011-09-13T07:04:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11794",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11794#event-157057"
}
```



---

archive/issue_events_157058.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2011-09-13T07:04:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11794",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11794#event-157058"
}
```



---

archive/issue_events_157059.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2011-09-13T07:04:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11794",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11794#event-157059"
}
```



---

archive/issue_events_157060.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2011-09-13T07:04:40Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/11794",
    "subject": "https://github.com/simon-king-jena",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11794#event-157060"
}
```



---

archive/issue_comments_123206.json:
```json
{
    "body": "A metaclass that provides any class with a cythonised cached hash method",
    "created_at": "2011-09-13T07:09:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11794#issuecomment-123206",
    "user": "https://github.com/simon-king-jena"
}
```

A metaclass that provides any class with a cythonised cached hash method



---

archive/issue_comments_123207.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nAttachment: **[trac11791_fast_hash_metaclass.patch.gz](https://github.com/sagemath/sage/files/ticket11794/trac11791_fast_hash_metaclass.patch.gz)**\n\nThe attached patch provides a new metaclass that overrides the hash method of an existing class with a fast cached method.\n\n**1. __Providing existing classes with a fast hash__**\n\nOne way of using it is to take an existing class and apply the metaclass to it:\n\n```\nsage: P = FastHashMetaclass(Parent)()\nsage: P\n<class '__main__.Parent_with_hash'>\nsage: timeit(\"hash(P)\")\n625 loops, best of 3: 464 ns per loop\n\nsage: C = FastHashMetaclass(QQ['x'].__class__)\nsage: C\n<class 'sage.rings.polynomial.polynomial_ring.PolynomialRing_field_with_category_with_hash'>\nsage: P = C(QQ,'x')\nsage: P\nUnivariate Polynomial Ring in x over Rational Field\nsage: timeit(\"hash(P)\")\n625 loops, best of 3: 458 ns per loop\n```\n\n**2. __Class definition with metaclass__**\n\nThe second way of using it is to provide it as `__metaclass__` in a class definition. It allows to demonstrate (by printing status information) that the hash really is cached:\n\n```\nsage: class Bar:\n....:     __metaclass__ = FastHashMetaclass\n....:     def __init__(self,R):\n....:         self.R = R\n....:     def __repr__(self):\n....:         return \"[%s]\"%self.R\n....:     def __hash__(self):\n....:         print \"base hash\"\n....:         return hash(repr(self))\n....:     \nsage: P = Bar(9)\nsage: P\n[9]\nsage: hash(P)\nbase hash\n8209412804338245734\nsage: hash(P)\n8209412804338245734\nsage: hash(repr(P))\n8209412804338245734\nsage: timeit(\"hash(P)\")\n625 loops, best of 3: 467 ns per loop\n```\n\n**3. __Dynamic metaclasses__**\n\nPickling of classes requires (as usual) that the class definition can be imported from a module. Thus, in the next example, I give the definition in interactive Cython. It demonstrates that the new metaclass can be combined with other metaclasses:\n\n```\nsage: cython_code = [\n... 'from sage.misc.fast_hash import FastHashMetaclass',\n... 'class Bar(UniqueRepresentation):',\n... '    __metaclass__ = FastHashMetaclass',\n... '    def __init__(self,R):',\n... '        self.R = R',\n... '    def __repr__(self):',\n... '        return \"[%s]\"%self.R',\n... '    def __hash__(self):',\n... '        print \"base hash\"',\n... '        return hash(repr(self))']\nsage: cython('\\n'.join(cython_code))\n```\n\nThe metaclass associated with `UniqueRepresentation` makes the Bar instances unique parents:\n\n```\nsage: b = Bar(5)\nsage: b is Bar(5)\nTrue\nsage: loads(dumps(b)) is b    # indirect doctest\nTrue\n```\n\n`WithFastHashMetaclass` additionally makes the hash cached and fast:\n\n```\nsage: hash(b)\nbase hash\n8209412804334245746\nsage: hash(b)\n8209412804334245746\nsage: timeit(\"hash(b)\")\n625 loops, best of 3: 475 ns per loop\n```\n\nTechnical detail: In order to mix the metaclasses, I turn the metaclasses into dynamic classes. In other words, the metaclasses have a metaclass, themselves:\n\n```\nsage: type(b)\n<class '_mnt_local_king__sage_temp_mpc622_31222_tmp_0_spyx_0.Bar'>\nsage: type(type(b))\n<class 'sage.misc.fast_hash.FastHashAndClasscallMetaclass'>\nsage: type(type(b)).__bases__\n(<class 'sage.misc.fast_hash.FastHashMetaclass'>, <class 'sage.misc.classcall_metaclass.ClasscallMetaclass'>)\nsage: type(type(type(b)))\n<class 'sage.structure.dynamic_class.DynamicMetaclass'>\n```\nI think that this approach could be scalable, and might be useful in other places.\n\n**4. __Speeding up existing instances**\n\nAnother way of using it is to provide single instances of a class with the fast hash. This is only possible if the class is a \"heap type\":\n\n```\nsage: F = CombinatorialFreeModule(QQ, ['a','b'])\nsage: timeit(\"hash(F)\")\n625 loops, best of 3: 1.09 \u00b5s per loop\nsage: F.__class__ = FastHashMetaclass(F.__class__)\nsage: timeit(\"hash(F)\")\n625 loops, best of 3: 467 ns per loop\nsage: P.<x> = QQ[]\nsage: P.__class__ = FastHashMetaclass(P.__class__)\nsage: timeit(\"hash(P)\")\n625 loops, best of 3: 483 ns per loop\nsage: x.__class__ = FastHashMetaclass(x.__class__)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n\n/mnt/local/king/SAGE/sandbox/sage-4.7.2.alpha2/devel/sage-main/<ipython console> in <module>()\n\nTypeError: __class__ assignment: only for heap types\n```\n\n**5. __The price to pay__**\n\nThere is no free lunch. Thus, one might expect that the fast hash comes with a price to pay. Unfortunately, this is indeed the case:\n\n```\nsage: F = CombinatorialFreeModule(QQ, ['a','b'])\nsage: D = dir(F)\nsage: timeit('for s in D: a = getattr(F,s)', number=10000)\n10000 loops, best of 3: 84.9 \u00b5s per loop\nsage: from sage.misc.fast_hash import FastHashMetaclass\nsage: F.__class__ = FastHashMetaclass(F.__class__)\nsage: timeit('for s in D: a = getattr(F,s)', number=10000)\n10000 loops, best of 3: 96.2 \u00b5s per loop\nsage: (96.2-84.9)/84.9\n0.133097762073027\n```\n\nHence, I am not suggesting to use the new metaclass everywhere. But when a fast hash is needed, it may be a useful option. Note that the regression in the previous example is temporary:\n\n```\nsage: F.__class__\n<class 'sage.combinat.free_module.CombinatorialFreeModule_with_category_with_hash'>\nsage: F.__class__.__base__\n<class 'sage.combinat.free_module.CombinatorialFreeModule_with_category'>\nsage: F.__class__ = F.__class__.__base__\nsage: timeit('for s in D: a = getattr(F,s)', number=10000)\n10000 loops, best of 3: 84.6 \u00b5s per loop\n```\n\nHence, it could even be an option to temporarily get a fast hash and later bring all other methods back to speed.\n\n**__Dependencies__**\n\n#11115 makes cached functions picklable, and that is what we need here.\n\n#11791 provides introspection for classes with dynamic metaclasses. As we have seen above, we *have* dynamic metaclasses.\n\nI'll try to milden the speed regression exposed above. But I think it is OK to make it \"needs review\".",
    "created_at": "2011-09-13T07:37:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11794#issuecomment-123207",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:1" align="right">comment:1</div>

Attachment: **[trac11791_fast_hash_metaclass.patch.gz](https://github.com/sagemath/sage/files/ticket11794/trac11791_fast_hash_metaclass.patch.gz)**

The attached patch provides a new metaclass that overrides the hash method of an existing class with a fast cached method.

**1. __Providing existing classes with a fast hash__**

One way of using it is to take an existing class and apply the metaclass to it:

```
sage: P = FastHashMetaclass(Parent)()
sage: P
<class '__main__.Parent_with_hash'>
sage: timeit("hash(P)")
625 loops, best of 3: 464 ns per loop

sage: C = FastHashMetaclass(QQ['x'].__class__)
sage: C
<class 'sage.rings.polynomial.polynomial_ring.PolynomialRing_field_with_category_with_hash'>
sage: P = C(QQ,'x')
sage: P
Univariate Polynomial Ring in x over Rational Field
sage: timeit("hash(P)")
625 loops, best of 3: 458 ns per loop
```

**2. __Class definition with metaclass__**

The second way of using it is to provide it as `__metaclass__` in a class definition. It allows to demonstrate (by printing status information) that the hash really is cached:

```
sage: class Bar:
....:     __metaclass__ = FastHashMetaclass
....:     def __init__(self,R):
....:         self.R = R
....:     def __repr__(self):
....:         return "[%s]"%self.R
....:     def __hash__(self):
....:         print "base hash"
....:         return hash(repr(self))
....:     
sage: P = Bar(9)
sage: P
[9]
sage: hash(P)
base hash
8209412804338245734
sage: hash(P)
8209412804338245734
sage: hash(repr(P))
8209412804338245734
sage: timeit("hash(P)")
625 loops, best of 3: 467 ns per loop
```

**3. __Dynamic metaclasses__**

Pickling of classes requires (as usual) that the class definition can be imported from a module. Thus, in the next example, I give the definition in interactive Cython. It demonstrates that the new metaclass can be combined with other metaclasses:

```
sage: cython_code = [
... 'from sage.misc.fast_hash import FastHashMetaclass',
... 'class Bar(UniqueRepresentation):',
... '    __metaclass__ = FastHashMetaclass',
... '    def __init__(self,R):',
... '        self.R = R',
... '    def __repr__(self):',
... '        return "[%s]"%self.R',
... '    def __hash__(self):',
... '        print "base hash"',
... '        return hash(repr(self))']
sage: cython('\n'.join(cython_code))
```

The metaclass associated with `UniqueRepresentation` makes the Bar instances unique parents:

```
sage: b = Bar(5)
sage: b is Bar(5)
True
sage: loads(dumps(b)) is b    # indirect doctest
True
```

`WithFastHashMetaclass` additionally makes the hash cached and fast:

```
sage: hash(b)
base hash
8209412804334245746
sage: hash(b)
8209412804334245746
sage: timeit("hash(b)")
625 loops, best of 3: 475 ns per loop
```

Technical detail: In order to mix the metaclasses, I turn the metaclasses into dynamic classes. In other words, the metaclasses have a metaclass, themselves:

```
sage: type(b)
<class '_mnt_local_king__sage_temp_mpc622_31222_tmp_0_spyx_0.Bar'>
sage: type(type(b))
<class 'sage.misc.fast_hash.FastHashAndClasscallMetaclass'>
sage: type(type(b)).__bases__
(<class 'sage.misc.fast_hash.FastHashMetaclass'>, <class 'sage.misc.classcall_metaclass.ClasscallMetaclass'>)
sage: type(type(type(b)))
<class 'sage.structure.dynamic_class.DynamicMetaclass'>
```
I think that this approach could be scalable, and might be useful in other places.

**4. __Speeding up existing instances**

Another way of using it is to provide single instances of a class with the fast hash. This is only possible if the class is a "heap type":

```
sage: F = CombinatorialFreeModule(QQ, ['a','b'])
sage: timeit("hash(F)")
625 loops, best of 3: 1.09 µs per loop
sage: F.__class__ = FastHashMetaclass(F.__class__)
sage: timeit("hash(F)")
625 loops, best of 3: 467 ns per loop
sage: P.<x> = QQ[]
sage: P.__class__ = FastHashMetaclass(P.__class__)
sage: timeit("hash(P)")
625 loops, best of 3: 483 ns per loop
sage: x.__class__ = FastHashMetaclass(x.__class__)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)

/mnt/local/king/SAGE/sandbox/sage-4.7.2.alpha2/devel/sage-main/<ipython console> in <module>()

TypeError: __class__ assignment: only for heap types
```

**5. __The price to pay__**

There is no free lunch. Thus, one might expect that the fast hash comes with a price to pay. Unfortunately, this is indeed the case:

```
sage: F = CombinatorialFreeModule(QQ, ['a','b'])
sage: D = dir(F)
sage: timeit('for s in D: a = getattr(F,s)', number=10000)
10000 loops, best of 3: 84.9 µs per loop
sage: from sage.misc.fast_hash import FastHashMetaclass
sage: F.__class__ = FastHashMetaclass(F.__class__)
sage: timeit('for s in D: a = getattr(F,s)', number=10000)
10000 loops, best of 3: 96.2 µs per loop
sage: (96.2-84.9)/84.9
0.133097762073027
```

Hence, I am not suggesting to use the new metaclass everywhere. But when a fast hash is needed, it may be a useful option. Note that the regression in the previous example is temporary:

```
sage: F.__class__
<class 'sage.combinat.free_module.CombinatorialFreeModule_with_category_with_hash'>
sage: F.__class__.__base__
<class 'sage.combinat.free_module.CombinatorialFreeModule_with_category'>
sage: F.__class__ = F.__class__.__base__
sage: timeit('for s in D: a = getattr(F,s)', number=10000)
10000 loops, best of 3: 84.6 µs per loop
```

Hence, it could even be an option to temporarily get a fast hash and later bring all other methods back to speed.

**__Dependencies__**

#11115 makes cached functions picklable, and that is what we need here.

#11791 provides introspection for classes with dynamic metaclasses. As we have seen above, we *have* dynamic metaclasses.

I'll try to milden the speed regression exposed above. But I think it is OK to make it "needs review".



---

archive/issue_comments_123208.json:
```json
{
    "body": "Dependencies: **#11115, #11791**",
    "created_at": "2011-09-13T07:37:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11794#issuecomment-123208",
    "user": "https://github.com/simon-king-jena"
}
```

Dependencies: **#11115, #11791**



---

archive/issue_comments_123209.json:
```json
{
    "body": "Author: **Simon King**",
    "created_at": "2011-09-13T07:37:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11794#issuecomment-123209",
    "user": "https://github.com/simon-king-jena"
}
```

Author: **Simon King**



---

archive/issue_events_157061.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2011-09-13T07:37:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11794",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11794#event-157061"
}
```



---

archive/issue_comments_123210.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nReplying to [@simon-king-jena](#comment%3A1):\n> I'll try to milden the speed regression exposed above. But I think it is OK to make it \"needs review\".\n\nI have just posted a new patch (also correcting the patch name - please disregard the first patch!). It is not only mildening the regression: It actually provides a *general* speedup!\n\n```\nsage: from sage.misc.fast_hash import FastHashMetaclass\nsage: F = CombinatorialFreeModule(QQ, ['a','b'])\nsage: D = dir(F)\nsage: timeit('for s in D: a = getattr(F,s)', number=10000)\n10000 loops, best of 3: 84.1 \u00b5s per loop\nsage: timeit(\"hash(F)\")\n625 loops, best of 3: 1.09 \u00b5s per loop\nsage: F.__class__ = FastHashMetaclass(F.__class__)\nsage: timeit('for s in D: a = getattr(F,s)', number=10000)\n10000 loops, best of 3: 64.4 \u00b5s per loop\nsage: timeit(\"hash(F)\")\n625 loops, best of 3: 443 ns per loop\nsage: TestSuite(F).run()\n```",
    "created_at": "2011-09-13T08:53:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11794#issuecomment-123210",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:2" align="right">comment:2</div>

Replying to [@simon-king-jena](#comment%3A1):
> I'll try to milden the speed regression exposed above. But I think it is OK to make it "needs review".

I have just posted a new patch (also correcting the patch name - please disregard the first patch!). It is not only mildening the regression: It actually provides a *general* speedup!

```
sage: from sage.misc.fast_hash import FastHashMetaclass
sage: F = CombinatorialFreeModule(QQ, ['a','b'])
sage: D = dir(F)
sage: timeit('for s in D: a = getattr(F,s)', number=10000)
10000 loops, best of 3: 84.1 µs per loop
sage: timeit("hash(F)")
625 loops, best of 3: 1.09 µs per loop
sage: F.__class__ = FastHashMetaclass(F.__class__)
sage: timeit('for s in D: a = getattr(F,s)', number=10000)
10000 loops, best of 3: 64.4 µs per loop
sage: timeit("hash(F)")
625 loops, best of 3: 443 ns per loop
sage: TestSuite(F).run()
```



---

archive/issue_comments_123211.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -46,3 +46,4 @@\n \n What I am proposing here is a metaclass, that provides the option to add a cached cythonised hash method to any class.\n \n+Apply [attachment: trac11794_fast_hash_metaclass.patch](https://github.com/sagemath/sage/files/ticket11794/trac11794_fast_hash_metaclass.patch.gz)\n``````\n",
    "created_at": "2011-09-13T09:10:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11794#issuecomment-123211",
    "user": "https://github.com/simon-king-jena"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -46,3 +46,4 @@
 
 What I am proposing here is a metaclass, that provides the option to add a cached cythonised hash method to any class.
 
+Apply [attachment: trac11794_fast_hash_metaclass.patch](https://github.com/sagemath/sage/files/ticket11794/trac11794_fast_hash_metaclass.patch.gz)
``````




---

archive/issue_comments_123212.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nFor the patchbot:\n\nApply trac11794_fast_hash_metaclass.patch",
    "created_at": "2011-09-13T09:10:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11794#issuecomment-123212",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:3" align="right">comment:3</div>

For the patchbot:

Apply trac11794_fast_hash_metaclass.patch



---

archive/issue_comments_123213.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nI slightly modified the patch: One doc string needed an additional `::` for making the html reference look nice.\n\nFor the patchbot:\n\nApply trac11794_fast_hash_metaclass.patch",
    "created_at": "2011-09-13T09:40:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11794#issuecomment-123213",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:4" align="right">comment:4</div>

I slightly modified the patch: One doc string needed an additional `::` for making the html reference look nice.

For the patchbot:

Apply trac11794_fast_hash_metaclass.patch



---

archive/issue_comments_123214.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nNot all is good:\n\n```\nsage: C = Objects().parent_class\nsage: type('tmp',(FastHashMetaclass(C),),{})\n```\nyields an infinite recursion.",
    "created_at": "2011-09-13T12:27:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11794#issuecomment-123214",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:5" align="right">comment:5</div>

Not all is good:

```
sage: C = Objects().parent_class
sage: type('tmp',(FastHashMetaclass(C),),{})
```
yields an infinite recursion.



---

archive/issue_comments_123215.json:
```json
{
    "body": "Attachment: **[trac11794_fast_hash_metaclass.patch.gz](https://github.com/sagemath/sage/files/ticket11794/trac11794_fast_hash_metaclass.patch.gz)**\n\nA metaclass that provides any class with a cythonised cached hash method (disregard the previous patch)",
    "created_at": "2011-09-13T12:48:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11794#issuecomment-123215",
    "user": "https://github.com/simon-king-jena"
}
```

Attachment: **[trac11794_fast_hash_metaclass.patch.gz](https://github.com/sagemath/sage/files/ticket11794/trac11794_fast_hash_metaclass.patch.gz)**

A metaclass that provides any class with a cythonised cached hash method (disregard the previous patch)



---

archive/issue_comments_123216.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nThe problem is solved with the latest patch version:\n\n```\nsage: from sage.misc.fast_hash import FastHashMetaclass, HashWithCache\nsage: from sage.structure.element import Element\nsage: C = Objects().parent_class\nsage: M = FastHashMetaclass('tmp',(FastHashMetaclass(C),FastHashMetaclass(Element)),{})\nsage: M.mro()\n[<class '__main__.tmp'>, <type 'sage.misc.fast_hash.HashWithCache'>, <class '__main__.tmp'>, <class 'sage.categories.objects.Objects.parent_class'>, <type 'sage.structure.element.Element'>, <type 'sage.structure.sage_object.SageObject'>, <type 'object'>]\n```",
    "created_at": "2011-09-13T12:49:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11794#issuecomment-123216",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:6" align="right">comment:6</div>

The problem is solved with the latest patch version:

```
sage: from sage.misc.fast_hash import FastHashMetaclass, HashWithCache
sage: from sage.structure.element import Element
sage: C = Objects().parent_class
sage: M = FastHashMetaclass('tmp',(FastHashMetaclass(C),FastHashMetaclass(Element)),{})
sage: M.mro()
[<class '__main__.tmp'>, <type 'sage.misc.fast_hash.HashWithCache'>, <class '__main__.tmp'>, <class 'sage.categories.objects.Objects.parent_class'>, <type 'sage.structure.element.Element'>, <type 'sage.structure.sage_object.SageObject'>, <type 'object'>]
```



---

archive/issue_comments_123217.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nAgain for the patchbot:\n\nApply trac11794_fast_hash_metaclass.patch",
    "created_at": "2011-09-13T12:50:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11794#issuecomment-123217",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:7" align="right">comment:7</div>

Again for the patchbot:

Apply trac11794_fast_hash_metaclass.patch



---

archive/issue_comments_123218.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nHi Simon, \n\nLooks like you have done a lot of hard work here ! Thanks ! I might review it more or less soon. \n\nI've a question: how does it interact with #8119 ? Does it solve the problem there ?\n\nCheers,\n\nFlorent",
    "created_at": "2012-03-22T18:52:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11794#issuecomment-123218",
    "user": "https://github.com/hivert"
}
```

<div id="comment:8" align="right">comment:8</div>

Hi Simon, 

Looks like you have done a lot of hard work here ! Thanks ! I might review it more or less soon. 

I've a question: how does it interact with #8119 ? Does it solve the problem there ?

Cheers,

Florent



---

archive/issue_comments_123219.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nHi Florent!\n\nReplying to [@hivert](#comment%3A8):\n> I've a question: how does it interact with #8119 ? Does it solve the problem there ?\n\nOne could argue that my patch does not change any existing implementation of hash in Sage -- it is a new option to get a fast hash in a comfortable way, but that new option would (at least in the beginning) not be applied.\n\nOf course one could also argue that my patch could provide a tool to solve #8119. But I think the situation is not so easy. With my patch, the hash would be cached, so that renaming an object would not change the hash. However, consider the following two scenarios\n\nA)\n1. Create P\n2. hash(P)\n3. P.rename(\"bla\")\n4. hash(P)\n\nversus\n\nB)\n1. Create P\n2. P.rename(\"bla\")\n3. hash(P)\n\nWith my patch, you would get the same result in A)2. and A)4 - which solves #8119 in scenario A). However, you would get a different result in A).2 and B).3.\n\nHence, #8119 is no duplicate, but weakly related.",
    "created_at": "2012-03-22T19:34:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11794#issuecomment-123219",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:9" align="right">comment:9</div>

Hi Florent!

Replying to [@hivert](#comment%3A8):
> I've a question: how does it interact with #8119 ? Does it solve the problem there ?

One could argue that my patch does not change any existing implementation of hash in Sage -- it is a new option to get a fast hash in a comfortable way, but that new option would (at least in the beginning) not be applied.

Of course one could also argue that my patch could provide a tool to solve #8119. But I think the situation is not so easy. With my patch, the hash would be cached, so that renaming an object would not change the hash. However, consider the following two scenarios

A)
1. Create P
2. hash(P)
3. P.rename("bla")
4. hash(P)

versus

B)
1. Create P
2. P.rename("bla")
3. hash(P)

With my patch, you would get the same result in A)2. and A)4 - which solves #8119 in scenario A). However, you would get a different result in A).2 and B).3.

Hence, #8119 is no duplicate, but weakly related.



---

archive/issue_comments_123220.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@simon-king-jena](#comment%3A9):\n> Hence, #8119 is no duplicate, but weakly related.\n\nOn the other hand: If one would use the metaclass provided by my patch ALL OVER THE PLACE in Sage, then one could solve #8119 by simply starting the rename() method by calling `hash(self)`. Then, the hash would be computed and cached before renaming, and thus the cached hash value would not change when renaming.\n\nHowever, applying the metaclass everywhere is probably a very bad idea. The intention of this ticket really is to just provide a new **optional** feature.",
    "created_at": "2012-03-22T19:41:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11794#issuecomment-123220",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@simon-king-jena](#comment%3A9):
> Hence, #8119 is no duplicate, but weakly related.

On the other hand: If one would use the metaclass provided by my patch ALL OVER THE PLACE in Sage, then one could solve #8119 by simply starting the rename() method by calling `hash(self)`. Then, the hash would be computed and cached before renaming, and thus the cached hash value would not change when renaming.

However, applying the metaclass everywhere is probably a very bad idea. The intention of this ticket really is to just provide a new **optional** feature.



---

archive/issue_comments_123221.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@hivert](#comment%3A8):\n> Hi Simon, \n> \n> Looks like you have done a lot of hard work here ! Thanks ! I might review it more or less soon. \n> \n> I've a question: how does it interact with #8119 ? Does it solve the problem there ?\n\nNow (after a look at Robert's patch from #8119) I understand your question: Robert suggests to cache the hash value of `CategoryObject`, and he removes a couple of custom hash methods that actually do nothing but replicate the default hash method.\n\nThen, I'd say the relation of the two tickets is as follows:\n* With Robert's patch, the DEFAULT hash of `CategoryObject` would be cached. If a sub-class has its own hash method, then this would *not* be automatically cached. And if your sub-class is actually just a Python class, then its hash would *not* be automatically fast.\n* With my patch, if you write a Python class with a custom hash method, then you can additionally provide the new metaclass, and would turn the slow uncached custom hash into a fast cached custom hash.\n\nI am not sure what would happen in the following situation: Start with a class C that uses the `FastHash` metaclass. Create a subclass D of C that has a custom hash. Would the hash of D be automatically fast and cached, because it derives from a class with the `FastHash` metaclass?\n\nNeed to test it - that would be nice to have, I think.",
    "created_at": "2012-03-22T19:55:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11794#issuecomment-123221",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@hivert](#comment%3A8):
> Hi Simon, 
> 
> Looks like you have done a lot of hard work here ! Thanks ! I might review it more or less soon. 
> 
> I've a question: how does it interact with #8119 ? Does it solve the problem there ?

Now (after a look at Robert's patch from #8119) I understand your question: Robert suggests to cache the hash value of `CategoryObject`, and he removes a couple of custom hash methods that actually do nothing but replicate the default hash method.

Then, I'd say the relation of the two tickets is as follows:
* With Robert's patch, the DEFAULT hash of `CategoryObject` would be cached. If a sub-class has its own hash method, then this would *not* be automatically cached. And if your sub-class is actually just a Python class, then its hash would *not* be automatically fast.
* With my patch, if you write a Python class with a custom hash method, then you can additionally provide the new metaclass, and would turn the slow uncached custom hash into a fast cached custom hash.

I am not sure what would happen in the following situation: Start with a class C that uses the `FastHash` metaclass. Create a subclass D of C that has a custom hash. Would the hash of D be automatically fast and cached, because it derives from a class with the `FastHash` metaclass?

Need to test it - that would be nice to have, I think.



---

archive/issue_events_157062.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11794",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11794#event-157062"
}
```



---

archive/issue_events_157063.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11794",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11794#event-157063"
}
```



---

archive/issue_events_157064.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11794",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11794#event-157064"
}
```



---

archive/issue_events_157065.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11794",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11794#event-157065"
}
```



---

archive/issue_events_157066.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11794",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11794#event-157066"
}
```



---

archive/issue_events_157067.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11794",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11794#event-157067"
}
```



---

archive/issue_events_157068.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11794",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11794#event-157068"
}
```



---

archive/issue_events_157069.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11794",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11794#event-157069"
}
```



---

archive/issue_comments_123222.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\n> Looks like you have done a lot of hard work here ! Thanks ! I might review it more or less soon. \n\nThat old joke still makes me laugh.\n\nNathann",
    "created_at": "2015-08-15T20:29:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11794#issuecomment-123222",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:16" align="right">comment:16</div>

> Looks like you have done a lot of hard work here ! Thanks ! I might review it more or less soon. 

That old joke still makes me laugh.

Nathann



---

archive/issue_events_157070.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2015-08-15T20:29:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11794",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11794#event-157070"
}
```



---

archive/issue_events_157071.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2015-08-15T20:29:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11794",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11794#event-157071"
}
```



---

archive/issue_comments_123223.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@nathanncohen](#comment%3A16):\n> > Looks like you have done a lot of hard work here ! Thanks ! I might review it more or less soon. \n\n> \n> That old joke still makes me laugh.\n\nWell, it had no branch anyway, and it depends on a ticket that needs work.",
    "created_at": "2015-08-16T11:48:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11794#issuecomment-123223",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@nathanncohen](#comment%3A16):
> > Looks like you have done a lot of hard work here ! Thanks ! I might review it more or less soon. 

> 
> That old joke still makes me laugh.

Well, it had no branch anyway, and it depends on a ticket that needs work.



---

archive/issue_comments_123224.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\n> Well, it had no branch anyway, and it depends on a ticket that needs work.\n\nYep.\n\nI hate to see work wasted. Sorry `:-/`\n\nNathann",
    "created_at": "2015-08-16T11:50:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11794#issuecomment-123224",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:18" align="right">comment:18</div>

> Well, it had no branch anyway, and it depends on a ticket that needs work.

Yep.

I hate to see work wasted. Sorry `:-/`

Nathann



---

archive/issue_comments_123225.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nHello,\n\nWe intend to remove the stupid hash implementation from `Element` and `CategoryObject` in #19016 (already done for `SageObject` in #18246). For some classes, it would be good to have a generic mechanism for caching hash!\n\nVincent",
    "created_at": "2015-08-16T18:06:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11794#issuecomment-123225",
    "user": "https://github.com/videlec"
}
```

<div id="comment:19" align="right">comment:19</div>

Hello,

We intend to remove the stupid hash implementation from `Element` and `CategoryObject` in #19016 (already done for `SageObject` in #18246). For some classes, it would be good to have a generic mechanism for caching hash!

Vincent



---

archive/issue_comments_123226.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,11 +4,11 @@\n sage: from sage.structure.parent import Parent\n sage: P = Parent()\n sage: P.__hash__??\n-Type:\t\tmethod-wrapper\n-Base Class:\t<type 'method-wrapper'>\n-String Form:\t<method-wrapper '__hash__' of sage.structure.parent.Parent object at 0x53809b0>\n-Namespace:\tInteractive\n-Definition:\tP.__hash__(self)\n+Type:method-wrapper\n+Base Class:<type 'method-wrapper'>\n+String Form:<method-wrapper '__hash__' of sage.structure.parent.Parent object at 0x53809b0>\n+Namespace:Interactive\n+Definition:P.__hash__(self)\n Source:\n     def __hash__(self):\n         return hash(self.__repr__())\n@@ -21,12 +21,12 @@\n ```\n sage: P.<x> = QQ[]\n sage: P.__hash__??\n-Type:\t\tinstancemethod\n-Base Class:\t<type 'instancemethod'>\n-String Form:\t<bound method PolynomialRing_field_with_category.__hash__ of Univariate Polynomial Ring in x over Rational Field>\n-Namespace:\tInteractive\n-File:\t\t/mnt/local/king/SAGE/sandbox/sage-4.7.2.alpha2/local/lib/python2.6/site-packages/sage/rings/polynomial/polynomial_ring.py\n-Definition:\tP.__hash__(self)\n+Type:instancemethod\n+Base Class:<type 'instancemethod'>\n+String Form:<bound method PolynomialRing_field_with_category.__hash__ of Univariate Polynomial Ring in x over Rational Field>\n+Namespace:Interactive\n+File:/mnt/local/king/SAGE/sandbox/sage-4.7.2.alpha2/local/lib/python2.6/site-packages/sage/rings/polynomial/polynomial_ring.py\n+Definition:P.__hash__(self)\n Source:\n     def __hash__(self):\n         # should be faster than just relying on the string representation\n``````\n",
    "created_at": "2015-09-06T15:20:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11794",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11794#issuecomment-123226",
    "user": "https://github.com/fchapoton"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,11 +4,11 @@
 sage: from sage.structure.parent import Parent
 sage: P = Parent()
 sage: P.__hash__??
-Type:		method-wrapper
-Base Class:	<type 'method-wrapper'>
-String Form:	<method-wrapper '__hash__' of sage.structure.parent.Parent object at 0x53809b0>
-Namespace:	Interactive
-Definition:	P.__hash__(self)
+Type:method-wrapper
+Base Class:<type 'method-wrapper'>
+String Form:<method-wrapper '__hash__' of sage.structure.parent.Parent object at 0x53809b0>
+Namespace:Interactive
+Definition:P.__hash__(self)
 Source:
     def __hash__(self):
         return hash(self.__repr__())
@@ -21,12 +21,12 @@
 ```
 sage: P.<x> = QQ[]
 sage: P.__hash__??
-Type:		instancemethod
-Base Class:	<type 'instancemethod'>
-String Form:	<bound method PolynomialRing_field_with_category.__hash__ of Univariate Polynomial Ring in x over Rational Field>
-Namespace:	Interactive
-File:		/mnt/local/king/SAGE/sandbox/sage-4.7.2.alpha2/local/lib/python2.6/site-packages/sage/rings/polynomial/polynomial_ring.py
-Definition:	P.__hash__(self)
+Type:instancemethod
+Base Class:<type 'instancemethod'>
+String Form:<bound method PolynomialRing_field_with_category.__hash__ of Univariate Polynomial Ring in x over Rational Field>
+Namespace:Interactive
+File:/mnt/local/king/SAGE/sandbox/sage-4.7.2.alpha2/local/lib/python2.6/site-packages/sage/rings/polynomial/polynomial_ring.py
+Definition:P.__hash__(self)
 Source:
     def __hash__(self):
         # should be faster than just relying on the string representation
``````




---

archive/issue_events_157072.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-12-29T01:28:25Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11794",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11794#event-157072"
}
```
