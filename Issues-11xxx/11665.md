# Issue 11665: Don't delete built Sage documentation until Sphinx has been successfully (re)installed

archive/issues_011493.json:
```json
{
    "assignees": [],
    "body": "As the title says.\n\n---\n\n**New spkg: http://spkg-upload.googlecode.com/files/sphinx-1.0.4.p8.spkg**\n\n**md5sum**: `5529e918d8a73e1476c0366fd5fcee35  sphinx-1.0.4.p8.spkg`\n\n### sphinx-1.0.4.p8 (Leif Leonhardy, August 17th 2011)\n* #11665: Don't delete previously built Sage documentation (in\n  $SAGE_ROOT/devel/sage-*/doc/output/) until Sphinx has been successfully\n  reinstalled.\n* Also, don't delete a previous Sphinx installation until Sphinx has been\n  successfully (re)built. To achieve this, we now first run 'python\n  setup.py build', then delete any previously installed version, and after\n  that run 'python setup.py install'.\n* Quote the filename of patches.\n* Some clean-up, add some messages (and blank lines to separate the output).\n* Added some more of Sphinx' dependencies, corrected minimal version numbers\n  required.\n\n\nDepends on #11659\n\nKeywords: **spkg doc/output html latex**\n\nComponent: **packages: standard**\n\nAuthor: **Leif Leonhardy**\n\nReviewer: **John Palmieri**\n\nMerged: **sage-4.7.2.alpha2**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/11665_\n\n",
    "closed_at": "2011-08-18T22:05:26Z",
    "created_at": "2011-08-08T14:50:35Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.7.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Don't delete built Sage documentation until Sphinx has been successfully (re)installed",
    "type": "issue",
    "updated_at": "2011-08-18T22:05:26Z",
    "url": "https://github.com/sagemath/sage/issues/11665",
    "user": "https://github.com/nexttime"
}
```
As the title says.

---

**New spkg: http://spkg-upload.googlecode.com/files/sphinx-1.0.4.p8.spkg**

**md5sum**: `5529e918d8a73e1476c0366fd5fcee35  sphinx-1.0.4.p8.spkg`

### sphinx-1.0.4.p8 (Leif Leonhardy, August 17th 2011)
* #11665: Don't delete previously built Sage documentation (in
  $SAGE_ROOT/devel/sage-*/doc/output/) until Sphinx has been successfully
  reinstalled.
* Also, don't delete a previous Sphinx installation until Sphinx has been
  successfully (re)built. To achieve this, we now first run 'python
  setup.py build', then delete any previously installed version, and after
  that run 'python setup.py install'.
* Quote the filename of patches.
* Some clean-up, add some messages (and blank lines to separate the output).
* Added some more of Sphinx' dependencies, corrected minimal version numbers
  required.


Depends on #11659

Keywords: **spkg doc/output html latex**

Component: **packages: standard**

Author: **Leif Leonhardy**

Reviewer: **John Palmieri**

Merged: **sage-4.7.2.alpha2**

_Issue created by migration from https://trac.sagemath.org/ticket/11665_





---

archive/issue_events_156991.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-08-08T14:50:35Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11665",
    "milestone_number": null,
    "milestone_title": "sage-4.7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11665#event-156991"
}
```



---

archive/issue_events_156992.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-08-08T14:50:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11665",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
    "label_color": "000080",
    "label_name": "c: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11665#event-156992"
}
```



---

archive/issue_events_156993.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-08-08T14:50:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11665",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11665#event-156993"
}
```



---

archive/issue_events_156994.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-08-08T14:50:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11665",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11665#event-156994"
}
```



---

archive/issue_comments_120178.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nI wonder if we should delete previously built Sage documentation at all (in *all* devel branches btw.), since rebuilding the documentation takes a fair amount of time, and if someone's going to rebuild it (from scratch), he'll certainly be smart enough to delete whatever generated output he wants (or needs) to.\n\nThe current behaviour is IMHO somewhat surprising, at least in that it affects *all* branches as mentioned above.\n\nAnd worse, this even happens whenever Sphinx gets reinstalled just because some of its (direct or indirect) dependencies changed (when using `make` with `SAGE_UPGRADING=yes` to also rebuild all dependent packages).",
    "created_at": "2011-08-08T15:06:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11665#issuecomment-120178",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:1" align="right">comment:1</div>

I wonder if we should delete previously built Sage documentation at all (in *all* devel branches btw.), since rebuilding the documentation takes a fair amount of time, and if someone's going to rebuild it (from scratch), he'll certainly be smart enough to delete whatever generated output he wants (or needs) to.

The current behaviour is IMHO somewhat surprising, at least in that it affects *all* branches as mentioned above.

And worse, this even happens whenever Sphinx gets reinstalled just because some of its (direct or indirect) dependencies changed (when using `make` with `SAGE_UPGRADING=yes` to also rebuild all dependent packages).



---

archive/issue_comments_120179.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,20 @@\n As the title says.\n \n-New Sphinx 1.0.4.p8 spkg will come soon.\n+---\n \n+**New spkg: http://spkg-upload.googlecode.com/files/sphinx-1.0.4.p8.spkg**\n+\n+**md5sum**: `2cf773e35ef8f0b9b18ffb0a4061f974  sphinx-1.0.4.p8.spkg`\n+\n+### sphinx-1.0.4.p8 (Leif Leonhardy, August 8th 2011)\n+* #11665: Don't delete previously built Sage documentation (in\n+  $SAGE_ROOT/devel/sage-*/doc/output/) until Sphinx has been successfully\n+  reinstalled.\n+* Also, don't delete a previous Sphinx installation until Sphinx has been\n+  successfully (re)built. To achieve this, we now first run 'python\n+  setup.py build', then delete any previously installed version, and after\n+  that run 'python setup.py install'.\n+* Quote the filename of patches.\n+* Some clean-up, add some messages (and blank lines to separate the output).\n+* Added some more of Sphinx' dependencies.\n+\n``````\n",
    "created_at": "2011-08-08T16:08:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11665#issuecomment-120179",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,20 @@
 As the title says.
 
-New Sphinx 1.0.4.p8 spkg will come soon.
+---
 
+**New spkg: http://spkg-upload.googlecode.com/files/sphinx-1.0.4.p8.spkg**
+
+**md5sum**: `2cf773e35ef8f0b9b18ffb0a4061f974  sphinx-1.0.4.p8.spkg`
+
+### sphinx-1.0.4.p8 (Leif Leonhardy, August 8th 2011)
+* #11665: Don't delete previously built Sage documentation (in
+  $SAGE_ROOT/devel/sage-*/doc/output/) until Sphinx has been successfully
+  reinstalled.
+* Also, don't delete a previous Sphinx installation until Sphinx has been
+  successfully (re)built. To achieve this, we now first run 'python
+  setup.py build', then delete any previously installed version, and after
+  that run 'python setup.py install'.
+* Quote the filename of patches.
+* Some clean-up, add some messages (and blank lines to separate the output).
+* Added some more of Sphinx' dependencies.
+
``````




---

archive/issue_comments_120180.json:
```json
{
    "body": "Author: **Leif Leonhardy**",
    "created_at": "2011-08-08T16:08:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11665#issuecomment-120180",
    "user": "https://github.com/nexttime"
}
```

Author: **Leif Leonhardy**



---

archive/issue_comments_120181.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nNew spkg is up.",
    "created_at": "2011-08-08T16:08:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11665#issuecomment-120181",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:2" align="right">comment:2</div>

New spkg is up.



---

archive/issue_events_156995.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-08-08T16:08:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11665",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11665#event-156995"
}
```



---

archive/issue_comments_120182.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nI know this isn't your change, but setup.py says\n\n```\nrequires = ['Pygments>=0.8', 'Jinja2>=2.2', 'docutils>=0.5']\n```\nSo why are the prerequisites \"Pygments >= 1.3.1\" and \"docutils >= 0.4\"?\n\nThe changes look okay at first glance, otherwise.  I'll keep looking at them, as should other people.",
    "created_at": "2011-08-10T20:35:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11665#issuecomment-120182",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:3" align="right">comment:3</div>

I know this isn't your change, but setup.py says

```
requires = ['Pygments>=0.8', 'Jinja2>=2.2', 'docutils>=0.5']
```
So why are the prerequisites "Pygments >= 1.3.1" and "docutils >= 0.4"?

The changes look okay at first glance, otherwise.  I'll keep looking at them, as should other people.



---

archive/issue_comments_120183.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nAnother pre-existing condition (i.e., this was a problem with the previous version of the spkg):\n\n```\nProcessing dependencies for Sphinx==1.0.4\nSearching for docutils==0.7\nBest match: docutils 0.7\nAdding docutils 0.7 to easy-install.pth file\n\nUsing /Applications/sage_builds/sage-4.7.1.rc2/local/lib/python2.6/site-packages\n```\nWhy wasn't docutils in `easy-install.pth` already?  The other prerequisites look okay, for example\n\n```\nSearching for Jinja2==2.5.5\nBest match: Jinja2 2.5.5\nProcessing Jinja2-2.5.5-py2.6.egg\nJinja2 2.5.5 is already the active version in easy-install.pth\n\nUsing /Applications/sage_builds/sage-4.7.1.rc2/local/lib/python2.6/site-packages/Jinja2-2.5.5-py2.6.egg\n```\nLooking at easy-install.pth, indeed there is no entry for docutils, either before or after (!) the Sphinx installation.  Before installing Sphinx, this is perhaps the fault of the docutils spkg, although I'm not sure how to fix it.  After installing Sphinx, either there is a problem with the Sphinx installation process, or the line \"Adding docutils 0.7 to easy-install.pth file\" is just wrong.",
    "created_at": "2011-08-15T17:52:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11665#issuecomment-120183",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:4" align="right">comment:4</div>

Another pre-existing condition (i.e., this was a problem with the previous version of the spkg):

```
Processing dependencies for Sphinx==1.0.4
Searching for docutils==0.7
Best match: docutils 0.7
Adding docutils 0.7 to easy-install.pth file

Using /Applications/sage_builds/sage-4.7.1.rc2/local/lib/python2.6/site-packages
```
Why wasn't docutils in `easy-install.pth` already?  The other prerequisites look okay, for example

```
Searching for Jinja2==2.5.5
Best match: Jinja2 2.5.5
Processing Jinja2-2.5.5-py2.6.egg
Jinja2 2.5.5 is already the active version in easy-install.pth

Using /Applications/sage_builds/sage-4.7.1.rc2/local/lib/python2.6/site-packages/Jinja2-2.5.5-py2.6.egg
```
Looking at easy-install.pth, indeed there is no entry for docutils, either before or after (!) the Sphinx installation.  Before installing Sphinx, this is perhaps the fault of the docutils spkg, although I'm not sure how to fix it.  After installing Sphinx, either there is a problem with the Sphinx installation process, or the line "Adding docutils 0.7 to easy-install.pth file" is just wrong.



---

archive/issue_comments_120184.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nReplying to [@jhpalmieri](#comment:4):\n> Why wasn't docutils in `easy-install.pth` already? [...] \n\n> Looking at easy-install.pth, indeed there is no entry for docutils, either before or after (!) the Sphinx installation.  Before installing Sphinx, this is perhaps the fault of the docutils spkg, although I'm not sure how to fix it.  After installing Sphinx, either there is a problem with the Sphinx installation process, or the line \"Adding docutils 0.7 to easy-install.pth file\" is just wrong.\n\nPerhaps [attachment: ticket:10176:easy_install.py.debug.patch](https://github.com/sagemath/sage/files/ticket11665/b997038bb52214daa9b7b65ba98ea1ea.gz) helps in debugging this.\n\n(I don't have an entry for `docutils` in `easy-install.pth` in any Sage installation since [at least] Sage 4.5.3; haven't checked earlier versions just because they're located on other machines or filesystems.)",
    "created_at": "2011-08-16T20:08:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11665#issuecomment-120184",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:5" align="right">comment:5</div>

Replying to [@jhpalmieri](#comment:4):
> Why wasn't docutils in `easy-install.pth` already? [...] 

> Looking at easy-install.pth, indeed there is no entry for docutils, either before or after (!) the Sphinx installation.  Before installing Sphinx, this is perhaps the fault of the docutils spkg, although I'm not sure how to fix it.  After installing Sphinx, either there is a problem with the Sphinx installation process, or the line "Adding docutils 0.7 to easy-install.pth file" is just wrong.

Perhaps [attachment: ticket:10176:easy_install.py.debug.patch](https://github.com/sagemath/sage/files/ticket11665/b997038bb52214daa9b7b65ba98ea1ea.gz) helps in debugging this.

(I don't have an entry for `docutils` in `easy-install.pth` in any Sage installation since [at least] Sage 4.5.3; haven't checked earlier versions just because they're located on other machines or filesystems.)



---

archive/issue_comments_120185.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@nexttime](#comment:5):\n> (I don't have an entry for `docutils` in `easy-install.pth` in any Sage installation since [at least] Sage 4.5.3; haven't checked earlier versions just because they're located on other machines or filesystems.)\n\nFWIW, in no Sage installation since [at least] Sage 4.2.1, so I guess it's never been there.",
    "created_at": "2011-08-16T20:21:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11665#issuecomment-120185",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@nexttime](#comment:5):
> (I don't have an entry for `docutils` in `easy-install.pth` in any Sage installation since [at least] Sage 4.5.3; haven't checked earlier versions just because they're located on other machines or filesystems.)

FWIW, in no Sage installation since [at least] Sage 4.2.1, so I guess it's never been there.



---

archive/issue_comments_120186.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nDo you understand why the Sphinx installation process says \"Adding docutils 0.7 to easy-install.pth file\" but doesn't actually do anything?\n\nOtherwise, I'm happy with the changes, except that the list of prerequisites in SPKG.txt should be changed (or explained, if it should stay as is).  The issue with docutils and easy-install.pth can be deferred to another ticket, if it even needs to be addressed at all.  (Sphinx seems to work, so I don't know how important it is.)",
    "created_at": "2011-08-16T20:45:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11665#issuecomment-120186",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:7" align="right">comment:7</div>

Do you understand why the Sphinx installation process says "Adding docutils 0.7 to easy-install.pth file" but doesn't actually do anything?

Otherwise, I'm happy with the changes, except that the list of prerequisites in SPKG.txt should be changed (or explained, if it should stay as is).  The issue with docutils and easy-install.pth can be deferred to another ticket, if it even needs to be addressed at all.  (Sphinx seems to work, so I don't know how important it is.)



---

archive/issue_comments_120187.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@jhpalmieri](#comment:7):\n> Do you understand why the Sphinx installation process says \"Adding docutils 0.7 to easy-install.pth file\" but doesn't actually do anything?\n\nWell, Sphinx just uses distutils / distribute, and IIRC that prints that message.\n\nA problem we previously had was that packages found in Python's current path won't get added, despite of the message (which is printed in advance).\n\n\n\n\n> Otherwise, I'm happy with the changes, except that the list of prerequisites in SPKG.txt should be changed (or explained, if it should stay as is).\n\nYes, I can correct them. AFAIK a couple of spkgs have rather \"random\" numbers as the minimal version of some other package required; usually simply the current version in Sage is taken. (And not even the upstream pages always give the correct versions required, some not even the full list of requirements.)",
    "created_at": "2011-08-16T21:05:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11665#issuecomment-120187",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@jhpalmieri](#comment:7):
> Do you understand why the Sphinx installation process says "Adding docutils 0.7 to easy-install.pth file" but doesn't actually do anything?

Well, Sphinx just uses distutils / distribute, and IIRC that prints that message.

A problem we previously had was that packages found in Python's current path won't get added, despite of the message (which is printed in advance).




> Otherwise, I'm happy with the changes, except that the list of prerequisites in SPKG.txt should be changed (or explained, if it should stay as is).

Yes, I can correct them. AFAIK a couple of spkgs have rather "random" numbers as the minimal version of some other package required; usually simply the current version in Sage is taken. (And not even the upstream pages always give the correct versions required, some not even the full list of requirements.)



---

archive/issue_comments_120188.json:
```json
{
    "body": "Reviewer: **John Palmieri**",
    "created_at": "2011-08-16T21:05:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11665#issuecomment-120188",
    "user": "https://github.com/nexttime"
}
```

Reviewer: **John Palmieri**



---

archive/issue_comments_120189.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nP.S.:\n\nAs long as the packages are installed in `.../site-packages/<package-basename>/` (like `docutils` are), this doesn't matter or cause any trouble.\n\nJust the message is perhaps confusing.",
    "created_at": "2011-08-16T21:16:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11665#issuecomment-120189",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:9" align="right">comment:9</div>

P.S.:

As long as the packages are installed in `.../site-packages/<package-basename>/` (like `docutils` are), this doesn't matter or cause any trouble.

Just the message is perhaps confusing.



---

archive/issue_comments_120190.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nOkay.  Once you upgrade the list of prerequisites, I'll give this a positive review.  It doesn't sound like it's necessary to open a follow-up ticket on docutils and easy-install.pth.",
    "created_at": "2011-08-16T21:29:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11665#issuecomment-120190",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:10" align="right">comment:10</div>

Okay.  Once you upgrade the list of prerequisites, I'll give this a positive review.  It doesn't sound like it's necessary to open a follow-up ticket on docutils and easy-install.pth.



---

archive/issue_comments_120191.json:
```json
{
    "body": "Diff between Jeroens's p7 spkg (#11659) and the p8. For reference / review.",
    "created_at": "2011-08-16T23:29:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11665#issuecomment-120191",
    "user": "https://github.com/nexttime"
}
```

Diff between Jeroens's p7 spkg (#11659) and the p8. For reference / review.



---

archive/issue_comments_120192.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nAttachment: **[sphinx-1.0.4.p7-p8.diff.gz](https://github.com/sagemath/sage/files/ticket11665/sphinx-1.0.4.p7-p8.diff.gz)**\n\n\n```diff\ndiff -r 2febeec86a8f -r be96c2edf57b SPKG.txt\n--- a/SPKG.txt\tMon Aug 08 17:46:04 2011 +0200\n+++ b/SPKG.txt\tWed Aug 17 01:17:37 2011 +0200\n@@ -11,7 +11,7 @@\n \n == License ==\n \n-Modified BSD\n+Modified BSD; see e.g. its egg-info file for other options\n \n == SPKG Maintainers ==\n \n@@ -19,16 +19,17 @@\n \n == Upstream Contact ==\n \n-Author:  Georg Brandl <georg at python org>\n-Home Page: http://sphinx.pocoo.org\n+Author: Georg Brandl <georg at python org>\n+Home Page: http://sphinx.pocoo.org, \n+  see also http://pypi.python.org/pypi/Sphinx\n \n == Dependencies ==\n- * Jinja >= 2.2\n- * Pygments >= 1.3.1\n- * docutils >= 0.4\n- * distutils\n+ * Jinja2 >= 2.2\n+ * Pygments >= 0.8\n+ * docutils >= 0.5\n+ * setuptools / distribute\n  * Python\n- * GNU patch\n+ * GNU patch (shipped with Sage)\n \n == Special Update/Build Instructions ==\n \n@@ -63,7 +64,7 @@\n \n == Changelog ==\n \n-=== sphinx-1.0.4.p8 (Leif Leonhardy, August 8th 2011) ===\n+=== sphinx-1.0.4.p8 (Leif Leonhardy, August 17th 2011) ===\n  * #11665: Don't delete previously built Sage documentation (in\n    $SAGE_ROOT/devel/sage-*/doc/output/) until Sphinx has been successfully\n    reinstalled.\n@@ -73,7 +74,8 @@\n    that run 'python setup.py install'.\n  * Quote the filename of patches.\n  * Some clean-up, add some messages (and blank lines to separate the output).\n- * Added some more of Sphinx' dependencies.\n+ * Added some more of Sphinx' dependencies, corrected minimal version numbers\n+   required.\n \n === sphinx-1.0.4.p7 (Jeroen Demeyer, 2011-08-08) ===\n  * Ticket #11659: Increase LaTeX SAVE_SIZE from 20000 to 50000\n```\nI've updated the attached diff (between the p7 and the p8); I'll replace the spkg on Google code soon.",
    "created_at": "2011-08-16T23:35:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11665#issuecomment-120192",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:11" align="right">comment:11</div>

Attachment: **[sphinx-1.0.4.p7-p8.diff.gz](https://github.com/sagemath/sage/files/ticket11665/sphinx-1.0.4.p7-p8.diff.gz)**


```diff
diff -r 2febeec86a8f -r be96c2edf57b SPKG.txt
--- a/SPKG.txt	Mon Aug 08 17:46:04 2011 +0200
+++ b/SPKG.txt	Wed Aug 17 01:17:37 2011 +0200
@@ -11,7 +11,7 @@
 
 == License ==
 
-Modified BSD
+Modified BSD; see e.g. its egg-info file for other options
 
 == SPKG Maintainers ==
 
@@ -19,16 +19,17 @@
 
 == Upstream Contact ==
 
-Author:  Georg Brandl <georg at python org>
-Home Page: http://sphinx.pocoo.org
+Author: Georg Brandl <georg at python org>
+Home Page: http://sphinx.pocoo.org, 
+  see also http://pypi.python.org/pypi/Sphinx
 
 == Dependencies ==
- * Jinja >= 2.2
- * Pygments >= 1.3.1
- * docutils >= 0.4
- * distutils
+ * Jinja2 >= 2.2
+ * Pygments >= 0.8
+ * docutils >= 0.5
+ * setuptools / distribute
  * Python
- * GNU patch
+ * GNU patch (shipped with Sage)
 
 == Special Update/Build Instructions ==
 
@@ -63,7 +64,7 @@
 
 == Changelog ==
 
-=== sphinx-1.0.4.p8 (Leif Leonhardy, August 8th 2011) ===
+=== sphinx-1.0.4.p8 (Leif Leonhardy, August 17th 2011) ===
  * #11665: Don't delete previously built Sage documentation (in
    $SAGE_ROOT/devel/sage-*/doc/output/) until Sphinx has been successfully
    reinstalled.
@@ -73,7 +74,8 @@
    that run 'python setup.py install'.
  * Quote the filename of patches.
  * Some clean-up, add some messages (and blank lines to separate the output).
- * Added some more of Sphinx' dependencies.
+ * Added some more of Sphinx' dependencies, corrected minimal version numbers
+   required.
 
 === sphinx-1.0.4.p7 (Jeroen Demeyer, 2011-08-08) ===
  * Ticket #11659: Increase LaTeX SAVE_SIZE from 20000 to 50000
```
I've updated the attached diff (between the p7 and the p8); I'll replace the spkg on Google code soon.



---

archive/issue_comments_120193.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,9 +4,9 @@\n \n **New spkg: http://spkg-upload.googlecode.com/files/sphinx-1.0.4.p8.spkg**\n \n-**md5sum**: `2cf773e35ef8f0b9b18ffb0a4061f974  sphinx-1.0.4.p8.spkg`\n+**md5sum**: `5529e918d8a73e1476c0366fd5fcee35  sphinx-1.0.4.p8.spkg`\n \n-### sphinx-1.0.4.p8 (Leif Leonhardy, August 8th 2011)\n+### sphinx-1.0.4.p8 (Leif Leonhardy, August 17th 2011)\n * #11665: Don't delete previously built Sage documentation (in\n   $SAGE_ROOT/devel/sage-*/doc/output/) until Sphinx has been successfully\n   reinstalled.\n@@ -16,5 +16,6 @@\n   that run 'python setup.py install'.\n * Quote the filename of patches.\n * Some clean-up, add some messages (and blank lines to separate the output).\n-* Added some more of Sphinx' dependencies.\n+* Added some more of Sphinx' dependencies, corrected minimal version numbers\n+  required.\n \n``````\n",
    "created_at": "2011-08-16T23:54:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11665#issuecomment-120193",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,9 +4,9 @@
 
 **New spkg: http://spkg-upload.googlecode.com/files/sphinx-1.0.4.p8.spkg**
 
-**md5sum**: `2cf773e35ef8f0b9b18ffb0a4061f974  sphinx-1.0.4.p8.spkg`
+**md5sum**: `5529e918d8a73e1476c0366fd5fcee35  sphinx-1.0.4.p8.spkg`
 
-### sphinx-1.0.4.p8 (Leif Leonhardy, August 8th 2011)
+### sphinx-1.0.4.p8 (Leif Leonhardy, August 17th 2011)
 * #11665: Don't delete previously built Sage documentation (in
   $SAGE_ROOT/devel/sage-*/doc/output/) until Sphinx has been successfully
   reinstalled.
@@ -16,5 +16,6 @@
   that run 'python setup.py install'.
 * Quote the filename of patches.
 * Some clean-up, add some messages (and blank lines to separate the output).
-* Added some more of Sphinx' dependencies.
+* Added some more of Sphinx' dependencies, corrected minimal version numbers
+  required.
 
``````




---

archive/issue_comments_120194.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@nexttime](#comment:11):\n> I'll replace the spkg on Google code soon.\n\nNew spkg is up now. Funny how many people already downloaded the previous one.",
    "created_at": "2011-08-16T23:54:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11665#issuecomment-120194",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@nexttime](#comment:11):
> I'll replace the spkg on Google code soon.

New spkg is up now. Funny how many people already downloaded the previous one.



---

archive/issue_comments_120195.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nP.S.: I still wonder whether we should delete previously built Sage documentation at all, and if so, of which branch(es).\n\nI believe doing so has more potential of annoyance than not doing so.",
    "created_at": "2011-08-16T23:59:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11665#issuecomment-120195",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:13" align="right">comment:13</div>

P.S.: I still wonder whether we should delete previously built Sage documentation at all, and if so, of which branch(es).

I believe doing so has more potential of annoyance than not doing so.



---

archive/issue_comments_120196.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@nexttime](#comment:13):\n> P.S.: I still wonder whether we should delete previously built Sage documentation at all, and if so, of which branch(es).\n> \n> I believe doing so has more potential of annoyance than not doing so.\n\nThere have certainly been cases where old doctree directories were incompatible between Sphinx versions, resulting in crashes for `sage -docbuild ...`.",
    "created_at": "2011-08-17T00:17:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11665#issuecomment-120196",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@nexttime](#comment:13):
> P.S.: I still wonder whether we should delete previously built Sage documentation at all, and if so, of which branch(es).
> 
> I believe doing so has more potential of annoyance than not doing so.

There have certainly been cases where old doctree directories were incompatible between Sphinx versions, resulting in crashes for `sage -docbuild ...`.



---

archive/issue_comments_120197.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@jhpalmieri](#comment:14):\n> Replying to [@nexttime](#comment:13):\n> > I believe doing so has more potential of annoyance than not doing so.\n\n> \n> There have certainly been cases where old doctree directories were incompatible between Sphinx versions, resulting in crashes for `sage -docbuild ...`.\n\nWell, that's easily fixed by a `rm -rf devel/sage/doc/output`; the deletion of work which perhaps took hours (or more) of CPU time isn't.",
    "created_at": "2011-08-17T00:37:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11665#issuecomment-120197",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@jhpalmieri](#comment:14):
> Replying to [@nexttime](#comment:13):
> > I believe doing so has more potential of annoyance than not doing so.

> 
> There have certainly been cases where old doctree directories were incompatible between Sphinx versions, resulting in crashes for `sage -docbuild ...`.

Well, that's easily fixed by a `rm -rf devel/sage/doc/output`; the deletion of work which perhaps took hours (or more) of CPU time isn't.



---

archive/issue_comments_120198.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nIf #6495 gets reviewed and merged, it will speed up generation of the reference manual on machines with many processors.  So deleting the output wouldn't be as much of an issue then.  (The reference manual is the real bottleneck; everything else takes just a few minutes.)\n\nThe deletion of the output was introduced in #7286. Some options:\n\n- Delete the output, as is done now.\n- Don't delete the output, but print a message after installation about potential problems.  Such a message may get lost among many others during a run of `sage -upgrade`.\n- Delete the output if we've updated the version of Sphinx (which we can tell by looking at the name of the Sphinx directory in SAGE_LOCAL/lib/python/site-packages), but not otherwise.  But Sage-specific changes in Sphinx, which wouldn't affect the Sphinx version number, could conceivably lead to incompatible pickles.\n\nThe first of these is in some sense the safest, since it is the status quo.  It will make some operations take more time, but it won't cause things to fail in confusing ways.  The others could lead to failures and confusing error messages.  So your comment that deleting the docs has \"more potential of annoyance than not doing so\" depends on your point of view: is it better to make things work but take longer, or to have them be faster but possibly fail in confusing ways.\n\nSpeaking of confusing error messages, for a while now, running \"sage -docbuild tutorial pickle\" (or replace 'pickle' by 'json') has failed...",
    "created_at": "2011-08-17T01:42:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11665#issuecomment-120198",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:16" align="right">comment:16</div>

If #6495 gets reviewed and merged, it will speed up generation of the reference manual on machines with many processors.  So deleting the output wouldn't be as much of an issue then.  (The reference manual is the real bottleneck; everything else takes just a few minutes.)

The deletion of the output was introduced in #7286. Some options:

- Delete the output, as is done now.
- Don't delete the output, but print a message after installation about potential problems.  Such a message may get lost among many others during a run of `sage -upgrade`.
- Delete the output if we've updated the version of Sphinx (which we can tell by looking at the name of the Sphinx directory in SAGE_LOCAL/lib/python/site-packages), but not otherwise.  But Sage-specific changes in Sphinx, which wouldn't affect the Sphinx version number, could conceivably lead to incompatible pickles.

The first of these is in some sense the safest, since it is the status quo.  It will make some operations take more time, but it won't cause things to fail in confusing ways.  The others could lead to failures and confusing error messages.  So your comment that deleting the docs has "more potential of annoyance than not doing so" depends on your point of view: is it better to make things work but take longer, or to have them be faster but possibly fail in confusing ways.

Speaking of confusing error messages, for a while now, running "sage -docbuild tutorial pickle" (or replace 'pickle' by 'json') has failed...



---

archive/issue_comments_120199.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nThe funny thing is that #6495's description says:\n\n  *\"Building the Sage reference manual can use significant computer resources. Easing the burden could speed up Sage development.\"*\n\nBuilding the documentation in parallel doesn't take *less* resources, but even more. It only makes things faster *if you have more resources available*.",
    "created_at": "2011-08-17T01:50:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11665#issuecomment-120199",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:17" align="right">comment:17</div>

The funny thing is that #6495's description says:

  *"Building the Sage reference manual can use significant computer resources. Easing the burden could speed up Sage development."*

Building the documentation in parallel doesn't take *less* resources, but even more. It only makes things faster *if you have more resources available*.



---

archive/issue_comments_120200.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nThat's a bit misleading.  Building the entire reference manual in one piece takes more memory, for example, than building it in chunks \u2014 it doesn't scale up well \u2014 so building with two threads should use less memory, even with both threads combined, than building before the patches at #6495.  This is especially true when building in LaTeX format, it seems to me.  Based on my anecdotal experiences: building, say, the PDF version of the reference manual was pretty painful before the patches on my home computer: it slowed other things down noticeably.  Building after the patches is more pleasant.\n\n(I didn't write the description at #6495, for what that's worth.)",
    "created_at": "2011-08-17T01:59:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11665#issuecomment-120200",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:18" align="right">comment:18</div>

That's a bit misleading.  Building the entire reference manual in one piece takes more memory, for example, than building it in chunks — it doesn't scale up well — so building with two threads should use less memory, even with both threads combined, than building before the patches at #6495.  This is especially true when building in LaTeX format, it seems to me.  Based on my anecdotal experiences: building, say, the PDF version of the reference manual was pretty painful before the patches on my home computer: it slowed other things down noticeably.  Building after the patches is more pleasant.

(I didn't write the description at #6495, for what that's worth.)



---

archive/issue_comments_120201.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@jhpalmieri](#comment:18):\n> (I didn't write the description at #6495, for what that's worth.)\n\nI know, Mitesh did.",
    "created_at": "2011-08-17T02:03:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11665#issuecomment-120201",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@jhpalmieri](#comment:18):
> (I didn't write the description at #6495, for what that's worth.)

I know, Mitesh did.



---

archive/issue_events_156996.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2011-08-17T05:04:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11665",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11665#event-156996"
}
```



---

archive/issue_events_156997.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2011-08-17T05:04:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11665",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11665#event-156997"
}
```



---

archive/issue_comments_120202.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nThe current spkg gets a positive review.",
    "created_at": "2011-08-17T05:04:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11665#issuecomment-120202",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:20" align="right">comment:20</div>

The current spkg gets a positive review.



---

archive/issue_comments_120203.json:
```json
{
    "body": "Merged: **sage-4.7.2.alpha2**",
    "created_at": "2011-08-18T22:05:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11665#issuecomment-120203",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-4.7.2.alpha2**



---

archive/issue_events_156998.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-08-18T22:05:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11665",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11665#event-156998"
}
```



---

archive/issue_events_156999.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-08-18T22:05:26Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/11665",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11665#event-156999"
}
```
