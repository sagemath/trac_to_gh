# Issue 11239: Incorrect coercion of polynomials over finite fields

archive/issues_011067.json:
```json
{
    "assignees": [],
    "body": "Trying to coerce a polynomial over a finite field into a polynomial ring over a bigger field gives a bogus result:\n\n```\nsage: Fq.<a> = GF(5^2)\nsage: Fqq.<b> = GF(5^4)\nsage: f = Fq['x'].random_element(); f\n3*x^2 + (a + 4)*x + 2*a + 4\nsage: Fqq['y'](f)\n3*y^2 + (b + 4)*y + 2*b + 4\n```\nIn this example, Sage simply replaces every \u2018a\u2019 with \u2018b\u2019, but a is not b.  If we coerce directly from Fq to Fqq, we get a `NotImplementedError`, which is unfortunate but in any case not incorrect. ;).\n\n```\nsage: Fqq(a)\n\u2026\n/usr/local/share/sage/sage/local/lib/python2.6/site-packages/sage/rings/finite_rings/finite_field_givaro.pyc in _coerce_map_from_(self, R)\n    348                 elif self.degree() % R.degree() == 0:\n    349                     # This is where we *would* do coercion from one nontrivial finite field to another...\n--> 350                     raise NotImplementedError\n    351 \n    352     def gen(self, n=0):\n\nNotImplementedError:\n```\n\nUse git branch.\n\n\nDepends on #8335\n\nAssignee: **@robertwb**\n\nCC:  @sagetrac-jpflori\n\nKeywords: **finite fields, polynomials, coercion, sd53**\n\nBranch/Commit: **[61c565b](https://github.com/sagemath/sagetrac-mirror/commit/61c565b7beccc1466bdac4d17fab755cbf5f9c9c)**\n\nReviewer: **Jean-Pierre Flori**\n\nAuthor: **Peter Bruin**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/11239_\n\n",
    "closed_at": "2014-03-05T09:36:26Z",
    "created_at": "2011-04-22T16:45:45Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20coercion",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Incorrect coercion of polynomials over finite fields",
    "type": "issue",
    "updated_at": "2014-03-05T09:36:26Z",
    "url": "https://github.com/sagemath/sage/issues/11239",
    "user": "https://github.com/sagetrac-johanbosman"
}
```
Trying to coerce a polynomial over a finite field into a polynomial ring over a bigger field gives a bogus result:

```
sage: Fq.<a> = GF(5^2)
sage: Fqq.<b> = GF(5^4)
sage: f = Fq['x'].random_element(); f
3*x^2 + (a + 4)*x + 2*a + 4
sage: Fqq['y'](f)
3*y^2 + (b + 4)*y + 2*b + 4
```
In this example, Sage simply replaces every ‘a’ with ‘b’, but a is not b.  If we coerce directly from Fq to Fqq, we get a `NotImplementedError`, which is unfortunate but in any case not incorrect. ;).

```
sage: Fqq(a)
…
/usr/local/share/sage/sage/local/lib/python2.6/site-packages/sage/rings/finite_rings/finite_field_givaro.pyc in _coerce_map_from_(self, R)
    348                 elif self.degree() % R.degree() == 0:
    349                     # This is where we *would* do coercion from one nontrivial finite field to another...
--> 350                     raise NotImplementedError
    351 
    352     def gen(self, n=0):

NotImplementedError:
```

Use git branch.


Depends on #8335

Assignee: **@robertwb**

CC:  @sagetrac-jpflori

Keywords: **finite fields, polynomials, coercion, sd53**

Branch/Commit: **[61c565b](https://github.com/sagemath/sagetrac-mirror/commit/61c565b7beccc1466bdac4d17fab755cbf5f9c9c)**

Reviewer: **Jean-Pierre Flori**

Author: **Peter Bruin**

_Issue created by migration from https://trac.sagemath.org/ticket/11239_





---

archive/issue_events_135913.json:
```json
{
    "actor": "https://github.com/sagetrac-johanbosman",
    "created_at": "2011-04-22T16:45:45Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11239#event-135913"
}
```



---

archive/issue_events_135914.json:
```json
{
    "actor": "https://github.com/sagetrac-johanbosman",
    "created_at": "2011-04-22T16:45:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20coercion",
    "label_color": "0000ff",
    "label_name": "component: coercion",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11239#event-135914"
}
```



---

archive/issue_events_135915.json:
```json
{
    "actor": "https://github.com/sagetrac-johanbosman",
    "created_at": "2011-04-22T16:45:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11239#event-135915"
}
```



---

archive/issue_events_135916.json:
```json
{
    "actor": "https://github.com/sagetrac-johanbosman",
    "created_at": "2011-04-22T16:45:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11239#event-135916"
}
```



---

archive/issue_comments_114401.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1,3 @@\n-Incorrect coercion of polynomials over finite fields\n-\n Trying to coerce a polynomial over a finite field into a polynomial ring over a bigger field gives a bogus result:\n \n ```\n``````\n",
    "created_at": "2011-04-22T16:47:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114401",
    "user": "https://github.com/sagetrac-johanbosman"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1,3 @@
-Incorrect coercion of polynomials over finite fields
-
 Trying to coerce a polynomial over a finite field into a polynomial ring over a bigger field gives a bogus result:
 
 ```
``````




---

archive/issue_comments_114402.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\n> If we coerce directly from Fq to Fqq, we get a `NotImplementedError`, which is unfortunate ...\n\nIt is, however, difficult to see how this could be done, because there are, in this case, two embeddings of the smaller field in the larger, neither of which can be distinguished from the other:\n\n```\nsage: Fq.<a> = GF(5^2); Fqq.<b> = GF(5^4)\nsage: Hom(Fq, Fqq).list()\n[\nRing morphism:\n  From: Finite Field in a of size 5^2\n  To:   Finite Field in b of size 5^4\n  Defn: a |--> 4*b^3 + 4*b^2 + 4*b + 3,\nRing morphism:\n  From: Finite Field in a of size 5^2\n  To:   Finite Field in b of size 5^4\n  Defn: a |--> b^3 + b^2 + b + 3\n]\n```\nsince\n\n```\nsage: a.minimal_polynomial().roots(ring=F625, multiplicities=False)\n[4*b^3 + 4*b^2 + 4*b + 3, b^3 + b^2 + b + 3]\n```\nAs for the polynomial coercion, this is seriously damaged.  Bogus results are produced even when the characteristics are different.  I have tracked the problem down to the following, but haven't been able to get further.\n\n```\nsage: Fq.<a> = GF(2^4); Fqq.<b> = GF(3^7)\nsage: PFq.<x> = Fq[]; PFqq.<y> = Fqq[]\nsage: f = x^3 + (a^3 + 1)*x\nsage: sage.rings.polynomial.polynomial_zz_pex.Polynomial_ZZ_pEX(PFqq, f)\ny^3 + (b^3 + 1)*y\n```",
    "created_at": "2011-04-23T08:11:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114402",
    "user": "https://github.com/sagetrac-fwclarke"
}
```

<div id="comment:2" align="right">Comment 2</div>

> If we coerce directly from Fq to Fqq, we get a `NotImplementedError`, which is unfortunate ...

It is, however, difficult to see how this could be done, because there are, in this case, two embeddings of the smaller field in the larger, neither of which can be distinguished from the other:

```
sage: Fq.<a> = GF(5^2); Fqq.<b> = GF(5^4)
sage: Hom(Fq, Fqq).list()
[
Ring morphism:
  From: Finite Field in a of size 5^2
  To:   Finite Field in b of size 5^4
  Defn: a |--> 4*b^3 + 4*b^2 + 4*b + 3,
Ring morphism:
  From: Finite Field in a of size 5^2
  To:   Finite Field in b of size 5^4
  Defn: a |--> b^3 + b^2 + b + 3
]
```
since

```
sage: a.minimal_polynomial().roots(ring=F625, multiplicities=False)
[4*b^3 + 4*b^2 + 4*b + 3, b^3 + b^2 + b + 3]
```
As for the polynomial coercion, this is seriously damaged.  Bogus results are produced even when the characteristics are different.  I have tracked the problem down to the following, but haven't been able to get further.

```
sage: Fq.<a> = GF(2^4); Fqq.<b> = GF(3^7)
sage: PFq.<x> = Fq[]; PFqq.<y> = Fqq[]
sage: f = x^3 + (a^3 + 1)*x
sage: sage.rings.polynomial.polynomial_zz_pex.Polynomial_ZZ_pEX(PFqq, f)
y^3 + (b^3 + 1)*y
```



---

archive/issue_comments_114403.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -8,7 +8,7 @@\n sage: Fqq['y'](f)\n 3*y^2 + (b + 4)*y + 2*b + 4\n ```\n-In this example, Sage simply replaces every \u2018a\u2019 with \u2018b\u2019, but a is not b.  If we coerce directly from Fq to Fqq, we get a NotImplementedError, which is unfortunate but in any case not incorrect. ;).\n+In this example, Sage simply replaces every \u2018a\u2019 with \u2018b\u2019, but a is not b.  If we coerce directly from Fq to Fqq, we get a `NotImplementedError`, which is unfortunate but in any case not incorrect. ;).\n \n ```\n sage: Fqq(a)\n``````\n",
    "created_at": "2011-04-23T08:11:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114403",
    "user": "https://github.com/sagetrac-fwclarke"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -8,7 +8,7 @@
 sage: Fqq['y'](f)
 3*y^2 + (b + 4)*y + 2*b + 4
 ```
-In this example, Sage simply replaces every ‘a’ with ‘b’, but a is not b.  If we coerce directly from Fq to Fqq, we get a NotImplementedError, which is unfortunate but in any case not incorrect. ;).
+In this example, Sage simply replaces every ‘a’ with ‘b’, but a is not b.  If we coerce directly from Fq to Fqq, we get a `NotImplementedError`, which is unfortunate but in any case not incorrect. ;).
 
 ```
 sage: Fqq(a)
``````




---

archive/issue_events_135917.json:
```json
{
    "actor": "https://github.com/dkrenn",
    "created_at": "2011-10-19T08:56:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11239#event-135917"
}
```



---

archive/issue_comments_114404.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nIt seems that everything that can be represented as polynomial is converted in that way. The phenomenon also appears with quotient rings:\n\n```\nsage: R.<x> = ZZ[]\nsage: A.<a> = R.quotient(x^3+2); PA.<s> = A[]\nsage: B.<b> = R.quotient(x^5+3); PB.<t> = B[]\nsage: f = a*s^3 + a^2*s; f\na*s^3 + a^2*s\nsage: PB(f)\nb*t^3 + b^2*t\n```\nOne way to solve this problem would be to check whether the coefficients of one polynomial rings can be converted (coerced) to the other...",
    "created_at": "2011-10-19T08:56:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114404",
    "user": "https://github.com/dkrenn"
}
```

<div id="comment:3" align="right">Comment 3</div>

It seems that everything that can be represented as polynomial is converted in that way. The phenomenon also appears with quotient rings:

```
sage: R.<x> = ZZ[]
sage: A.<a> = R.quotient(x^3+2); PA.<s> = A[]
sage: B.<b> = R.quotient(x^5+3); PB.<t> = B[]
sage: f = a*s^3 + a^2*s; f
a*s^3 + a^2*s
sage: PB(f)
b*t^3 + b^2*t
```
One way to solve this problem would be to check whether the coefficients of one polynomial rings can be converted (coerced) to the other...



---

archive/issue_comments_114405.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nReplying to [@dkrenn](#comment%3A3):\n> One way to solve this problem would be to check whether the coefficients of one polynomial rings can be converted (coerced) to the other...\n\nI would strongly advice against the attempt to solve it on the level of conversion.\n\nI know that at least some classes of polynomial rings are still following the old coercion model, and am preparing a patch that is supposed to fix that. According to the new model, there should be a method `_element_constructor_` that does the conversion, and a separate `_coerce_map_from_`, that determines whether there is a coercion (not just a conversion).\n\nI think that it is ok to have that bogus conversion - as long as it is not used as a coercion. One could, of course, try to throw an error when doing a conversion in the case that there is no fixed embedding of the base rings. However, testing it *repeatedly*, that's to say testing it *for each individual polynomial to be converted*, sounds like a waste of computation time to me.",
    "created_at": "2011-10-24T11:03:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114405",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:4" align="right">Comment 4</div>

Replying to [@dkrenn](#comment%3A3):
> One way to solve this problem would be to check whether the coefficients of one polynomial rings can be converted (coerced) to the other...

I would strongly advice against the attempt to solve it on the level of conversion.

I know that at least some classes of polynomial rings are still following the old coercion model, and am preparing a patch that is supposed to fix that. According to the new model, there should be a method `_element_constructor_` that does the conversion, and a separate `_coerce_map_from_`, that determines whether there is a coercion (not just a conversion).

I think that it is ok to have that bogus conversion - as long as it is not used as a coercion. One could, of course, try to throw an error when doing a conversion in the case that there is no fixed embedding of the base rings. However, testing it *repeatedly*, that's to say testing it *for each individual polynomial to be converted*, sounds like a waste of computation time to me.



---

archive/issue_comments_114406.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nIf in the example in the ticket description, one replaces\n\n```\nsage: Fqq['y'](f)\n```\nby\n\n```\nsage: Fqq['y']._coerce_(f)\n```\none at least gets a sensible error:\n\n```\nTypeError: no canonical coercion from Univariate Polynomial Ring in x over Finite Field in a of size 5^2 to Univariate Polynomial Ring in y over Finite Field in b of size 5^4\n```\n\nI tried the same example using the compatible finite fields from #8335.  The problem (that the coefficients are converted in the stupid way) persists, both for conversion and for coercion.  This is surprising, because in that case there *is* a coercion map between the finite fields.",
    "created_at": "2013-08-05T16:19:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114406",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:6" align="right">Comment 6</div>

If in the example in the ticket description, one replaces

```
sage: Fqq['y'](f)
```
by

```
sage: Fqq['y']._coerce_(f)
```
one at least gets a sensible error:

```
TypeError: no canonical coercion from Univariate Polynomial Ring in x over Finite Field in a of size 5^2 to Univariate Polynomial Ring in y over Finite Field in b of size 5^4
```

I tried the same example using the compatible finite fields from #8335.  The problem (that the coefficients are converted in the stupid way) persists, both for conversion and for coercion.  This is surprising, because in that case there *is* a coercion map between the finite fields.



---

archive/issue_comments_114407.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nThe problem lies in the *NTL implementation* of polynomials over finite fields.  (Edit: this was already discovered in [comment:2](#comment%3A2) above.)  This is the default implementation for polynomials over finite fields, even though the fields themselves are only implemented via NTL in characteristic 2, and via Givaro or PARI otherwise.\n\nThe following example demonstrates this (after applying #8335 plus a patch that I will upload shortly):\n\n```\nsage: K.<a> = GF(5^2, conway=True, prefix='z')\nsage: L.<b> = GF(5^4, conway=True, prefix='z')\nsage: type(K)\n<class 'sage.rings.finite_rings.finite_field_givaro.FiniteField_givaro_with_category'>\nsage: R = PolynomialRing(K, 'x', implementation='NTL')\nsage: S = PolynomialRing(L, 'x', implementation='NTL')\nsage: f = R.gen() + a; f\nx + a\nsage: type(f)\n<type 'sage.rings.polynomial.polynomial_zz_pex.Polynomial_ZZ_pEX'>\nsage: S(f)\nx + b\nsage: R = PolynomialRing(K, 'x', implementation='generic')\nsage: S = PolynomialRing(L, 'x', implementation='generic')\nsage: f = R.gen() + a; f\nx + a\nsage: type(f)\n<class 'sage.rings.polynomial.polynomial_element_generic.Polynomial_generic_dense_field'>\nsage: S(f)\nx + b^3 + b^2 + b + 3\n```",
    "created_at": "2013-08-05T17:51:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114407",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:7" align="right">Comment 7</div>

The problem lies in the *NTL implementation* of polynomials over finite fields.  (Edit: this was already discovered in [comment:2](#comment%3A2) above.)  This is the default implementation for polynomials over finite fields, even though the fields themselves are only implemented via NTL in characteristic 2, and via Givaro or PARI otherwise.

The following example demonstrates this (after applying #8335 plus a patch that I will upload shortly):

```
sage: K.<a> = GF(5^2, conway=True, prefix='z')
sage: L.<b> = GF(5^4, conway=True, prefix='z')
sage: type(K)
<class 'sage.rings.finite_rings.finite_field_givaro.FiniteField_givaro_with_category'>
sage: R = PolynomialRing(K, 'x', implementation='NTL')
sage: S = PolynomialRing(L, 'x', implementation='NTL')
sage: f = R.gen() + a; f
x + a
sage: type(f)
<type 'sage.rings.polynomial.polynomial_zz_pex.Polynomial_ZZ_pEX'>
sage: S(f)
x + b
sage: R = PolynomialRing(K, 'x', implementation='generic')
sage: S = PolynomialRing(L, 'x', implementation='generic')
sage: f = R.gen() + a; f
x + a
sage: type(f)
<class 'sage.rings.polynomial.polynomial_element_generic.Polynomial_generic_dense_field'>
sage: S(f)
x + b^3 + b^2 + b + 3
```



---

archive/issue_comments_114408.json:
```json
{
    "body": "Dependencies: **#8335**",
    "created_at": "2013-08-05T17:56:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114408",
    "user": "https://github.com/pjbruin"
}
```

Dependencies: **#8335**



---

archive/issue_comments_114409.json:
```json
{
    "body": "Author: **pbruin**",
    "created_at": "2013-08-05T17:56:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114409",
    "user": "https://github.com/pjbruin"
}
```

Author: **pbruin**



---

archive/issue_events_135918.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2013-08-05T17:56:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11239#event-135918"
}
```



---

archive/issue_events_135919.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2013-08-05T17:56:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11239#event-135919"
}
```



---

archive/issue_comments_114410.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -22,3 +22,6 @@\n \n NotImplementedError:\n ```\n+\n+Apply: [attachment: trac_11239-polynomial_coercion_preliminary.patch](https://github.com/sagemath/sage/files/ticket11239/trac_11239-polynomial_coercion_preliminary.patch.gz)\n+\n``````\n",
    "created_at": "2013-08-05T17:56:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114410",
    "user": "https://github.com/pjbruin"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -22,3 +22,6 @@
 
 NotImplementedError:
 ```
+
+Apply: [attachment: trac_11239-polynomial_coercion_preliminary.patch](https://github.com/sagemath/sage/files/ticket11239/trac_11239-polynomial_coercion_preliminary.patch.gz)
+
``````




---

archive/issue_comments_114411.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\nAt this point there are two possible solutions:\n- either fix the NTL polynomial constructor,\n- or make the generic polynomial constructor coerce the coefficients if necessary, and make the NTL polynomial constructor raise an error if it is given a polynomial over a smaller finite field.\nThe first solution would be preferable in principle, but certainly harder and maybe even unreasonable, since the NTL polynomial constructor is a lower-level thing that should not have to care about maps between non-trivial finite fields.",
    "created_at": "2013-08-05T18:05:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114411",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:9" align="right">Comment 9</div>

At this point there are two possible solutions:
- either fix the NTL polynomial constructor,
- or make the generic polynomial constructor coerce the coefficients if necessary, and make the NTL polynomial constructor raise an error if it is given a polynomial over a smaller finite field.
The first solution would be preferable in principle, but certainly harder and maybe even unreasonable, since the NTL polynomial constructor is a lower-level thing that should not have to care about maps between non-trivial finite fields.



---

archive/issue_comments_114412.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\nReplying to [@dkrenn](#comment%3A3):\n> It seems that everything that can be represented as polynomial is converted in that way. The phenomenon also appears with quotient rings:\n> \n> ```\n> sage: R.<x> = ZZ[]\n> sage: A.<a> = R.quotient(x^3+2); PA.<s> = A[]\n> sage: B.<b> = R.quotient(x^5+3); PB.<t> = B[]\n> sage: f = a*s^3 + a^2*s; f\n> a*s^3 + a^2*s\n> sage: PB(f)\n> b*t^3 + b^2*t\n> ```\n\nDebatable as it may seem, this is the behaviour currently described in the documentation of `PolynomialQuotientRing_generic._element_constructor_()`.  Attempting a coercion (`PB.coerce(f)`) instead of a conversion (`PB(f)`) does lead to\n\n```\nTypeError: no canonical coercion from Univariate Polynomial Ring in s over Univariate Quotient Polynomial Ring in a over Integer Ring with modulus x^3 + 2 to Univariate Polynomial Ring in t over Univariate Quotient Polynomial Ring in b over Integer Ring with modulus x^5 + 3\n```\nas expected.",
    "created_at": "2013-08-05T19:55:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114412",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:10" align="right">Comment 10</div>

Replying to [@dkrenn](#comment%3A3):
> It seems that everything that can be represented as polynomial is converted in that way. The phenomenon also appears with quotient rings:
> 
> ```
> sage: R.<x> = ZZ[]
> sage: A.<a> = R.quotient(x^3+2); PA.<s> = A[]
> sage: B.<b> = R.quotient(x^5+3); PB.<t> = B[]
> sage: f = a*s^3 + a^2*s; f
> a*s^3 + a^2*s
> sage: PB(f)
> b*t^3 + b^2*t
> ```

Debatable as it may seem, this is the behaviour currently described in the documentation of `PolynomialQuotientRing_generic._element_constructor_()`.  Attempting a coercion (`PB.coerce(f)`) instead of a conversion (`PB(f)`) does lead to

```
TypeError: no canonical coercion from Univariate Polynomial Ring in s over Univariate Quotient Polynomial Ring in a over Integer Ring with modulus x^3 + 2 to Univariate Polynomial Ring in t over Univariate Quotient Polynomial Ring in b over Integer Ring with modulus x^5 + 3
```
as expected.



---

archive/issue_comments_114413.json:
```json
{
    "body": "Attachment: **[trac_11239-polynomial_zz_pex.patch.gz](https://github.com/sagemath/sage/files/ticket11239/trac_11239-polynomial_zz_pex.patch.gz)**\n\nfix coercion of polynomials over finite fields",
    "created_at": "2013-08-05T23:30:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114413",
    "user": "https://github.com/pjbruin"
}
```

Attachment: **[trac_11239-polynomial_zz_pex.patch.gz](https://github.com/sagemath/sage/files/ticket11239/trac_11239-polynomial_zz_pex.patch.gz)**

fix coercion of polynomials over finite fields



---

archive/issue_comments_114414.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -23,5 +23,5 @@\n NotImplementedError:\n ```\n \n-Apply: [attachment: trac_11239-polynomial_coercion_preliminary.patch](https://github.com/sagemath/sage/files/ticket11239/trac_11239-polynomial_coercion_preliminary.patch.gz)\n+Apply: [attachment: trac_11239-polynomial_coercion_preliminary.patch](https://github.com/sagemath/sage/files/ticket11239/trac_11239-polynomial_coercion_preliminary.patch.gz), [attachment: trac_11239-polynomial_zz_pex.patch](https://github.com/sagemath/sage/files/ticket11239/trac_11239-polynomial_zz_pex.patch.gz)\n \n``````\n",
    "created_at": "2013-08-05T23:37:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114414",
    "user": "https://github.com/pjbruin"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -23,5 +23,5 @@
 NotImplementedError:
 ```
 
-Apply: [attachment: trac_11239-polynomial_coercion_preliminary.patch](https://github.com/sagemath/sage/files/ticket11239/trac_11239-polynomial_coercion_preliminary.patch.gz)
+Apply: [attachment: trac_11239-polynomial_coercion_preliminary.patch](https://github.com/sagemath/sage/files/ticket11239/trac_11239-polynomial_coercion_preliminary.patch.gz), [attachment: trac_11239-polynomial_zz_pex.patch](https://github.com/sagemath/sage/files/ticket11239/trac_11239-polynomial_zz_pex.patch.gz)
 
``````




---

archive/issue_comments_114415.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\nFixing the NTL polynomial constructor turned out to be easy.  With the second patch, polynomials over compatible finite fields (#8335) coerce correctly, and trying to convert polynomials over non-compatible finite fields raises a `TypeError`, as it should.",
    "created_at": "2013-08-05T23:37:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114415",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:11" align="right">Comment 11</div>

Fixing the NTL polynomial constructor turned out to be easy.  With the second patch, polynomials over compatible finite fields (#8335) coerce correctly, and trying to convert polynomials over non-compatible finite fields raises a `TypeError`, as it should.



---

archive/issue_events_135920.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2013-08-05T23:37:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11239#event-135920"
}
```



---

archive/issue_events_135921.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2013-08-05T23:37:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11239#event-135921"
}
```



---

archive/issue_comments_114416.json:
```json
{
    "body": "Changed author from **pbruin** to **Peter Bruin**",
    "created_at": "2013-08-05T23:39:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114416",
    "user": "https://github.com/pjbruin"
}
```

Changed author from **pbruin** to **Peter Bruin**



---

archive/issue_events_135922.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11239#event-135922"
}
```



---

archive/issue_events_135923.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11239#event-135923"
}
```



---

archive/issue_comments_114417.json:
```json
{
    "body": "Changed keywords from **finite fields, polynomials, coercion** to **finite fields, polynomials, coercion, sd53**",
    "created_at": "2013-09-26T18:04:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114417",
    "user": "https://github.com/sagetrac-jpflori"
}
```

Changed keywords from **finite fields, polynomials, coercion** to **finite fields, polynomials, coercion, sd53**



---

archive/issue_comments_114418.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\nJust stumbled upon that bug while playing with finite fields.\nThis is really a nice bug.",
    "created_at": "2013-09-26T18:04:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114418",
    "user": "https://github.com/sagetrac-jpflori"
}
```

<div id="comment:14" align="right">Comment 14</div>

Just stumbled upon that bug while playing with finite fields.
This is really a nice bug.



---

archive/issue_comments_114419.json:
```json
{
    "body": "Attachment: **[trac_11239-polynomial_coercion_preliminary.patch.gz](https://github.com/sagemath/sage/files/ticket11239/trac_11239-polynomial_coercion_preliminary.patch.gz)**\n\nupdate (old version had bogus doctest fix)",
    "created_at": "2013-11-02T19:24:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114419",
    "user": "https://github.com/pjbruin"
}
```

Attachment: **[trac_11239-polynomial_coercion_preliminary.patch.gz](https://github.com/sagemath/sage/files/ticket11239/trac_11239-polynomial_coercion_preliminary.patch.gz)**

update (old version had bogus doctest fix)



---

archive/issue_comments_114420.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\nPeter, have you considered the impact of using has_coerce_map on the level of conversion? memory and time consumption.",
    "created_at": "2013-12-21T12:54:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114420",
    "user": "https://github.com/lftabera"
}
```

<div id="comment:15" align="right">Comment 15</div>

Peter, have you considered the impact of using has_coerce_map on the level of conversion? memory and time consumption.



---

archive/issue_comments_114421.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">Comment 16</div>\n\nReplying to [@lftabera](#comment%3A15):\n> Peter, have you considered the impact of using has_coerce_map on the level of conversion? memory and time consumption.\n\nNot really; my first priority was to get correct behaviour, preferably in a clean way.  The cause of this bug appears to be precisely that the conversion currently doesn't check if a coercion exists.  Do you have an example in which this patch is too inefficient?",
    "created_at": "2013-12-21T14:58:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114421",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:16" align="right">Comment 16</div>

Replying to [@lftabera](#comment%3A15):
> Peter, have you considered the impact of using has_coerce_map on the level of conversion? memory and time consumption.

Not really; my first priority was to get correct behaviour, preferably in a clean way.  The cause of this bug appears to be precisely that the conversion currently doesn't check if a coercion exists.  Do you have an example in which this patch is too inefficient?



---

archive/issue_comments_114422.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">Comment 17</div>\n\nI agree with Peter.\nLet's get somethig correct first.\nThe current behavior is just non sense and prone to horrible errors in computations.\nWe can speed it up later rather than let this bitrot forever.",
    "created_at": "2013-12-25T15:53:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114422",
    "user": "https://github.com/sagetrac-jpflori"
}
```

<div id="comment:17" align="right">Comment 17</div>

I agree with Peter.
Let's get somethig correct first.
The current behavior is just non sense and prone to horrible errors in computations.
We can speed it up later rather than let this bitrot forever.



---

archive/issue_comments_114423.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">Comment 18</div>\n\nAnyway, the coercion framework is already called in the previous test so efficiency is already potentially screwed up.\n\nI've just made a git branch from the patch.\nOtherwise looks good to me, positive review.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/236effb\">236effb</a></td><td><code>Trac 11239: fix coercion of polynomials over finite fields</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e46d9bf\">e46d9bf</a></td><td><code>Trac 11239: fix coercion of polynomials over finite fields, first step</code></td></tr></table>\n",
    "created_at": "2013-12-31T10:34:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114423",
    "user": "https://github.com/sagetrac-jpflori"
}
```

<div id="comment:18" align="right">Comment 18</div>

Anyway, the coercion framework is already called in the previous test so efficiency is already potentially screwed up.

I've just made a git branch from the patch.
Otherwise looks good to me, positive review.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/236effb">236effb</a></td><td><code>Trac 11239: fix coercion of polynomials over finite fields</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e46d9bf">e46d9bf</a></td><td><code>Trac 11239: fix coercion of polynomials over finite fields, first step</code></td></tr></table>




---

archive/issue_events_135924.json:
```json
{
    "actor": "https://github.com/sagetrac-jpflori",
    "created_at": "2013-12-31T10:34:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11239#event-135924"
}
```



---

archive/issue_events_135925.json:
```json
{
    "actor": "https://github.com/sagetrac-jpflori",
    "created_at": "2013-12-31T10:34:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11239#event-135925"
}
```



---

archive/issue_comments_114424.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -23,5 +23,5 @@\n NotImplementedError:\n ```\n \n-Apply: [attachment: trac_11239-polynomial_coercion_preliminary.patch](https://github.com/sagemath/sage/files/ticket11239/trac_11239-polynomial_coercion_preliminary.patch.gz), [attachment: trac_11239-polynomial_zz_pex.patch](https://github.com/sagemath/sage/files/ticket11239/trac_11239-polynomial_zz_pex.patch.gz)\n+Use git branch.\n \n``````\n",
    "created_at": "2013-12-31T10:34:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114424",
    "user": "https://github.com/sagetrac-jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -23,5 +23,5 @@
 NotImplementedError:
 ```
 
-Apply: [attachment: trac_11239-polynomial_coercion_preliminary.patch](https://github.com/sagemath/sage/files/ticket11239/trac_11239-polynomial_coercion_preliminary.patch.gz), [attachment: trac_11239-polynomial_zz_pex.patch](https://github.com/sagemath/sage/files/ticket11239/trac_11239-polynomial_zz_pex.patch.gz)
+Use git branch.
 
``````




---

archive/issue_comments_114425.json:
```json
{
    "body": "Branch: **[u/jpflori/ticket/11239](https://github.com/sagemath/sagetrac-mirror/tree/u/jpflori/ticket/11239)**",
    "created_at": "2013-12-31T10:34:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114425",
    "user": "https://github.com/sagetrac-jpflori"
}
```

Branch: **[u/jpflori/ticket/11239](https://github.com/sagemath/sagetrac-mirror/tree/u/jpflori/ticket/11239)**



---

archive/issue_comments_114426.json:
```json
{
    "body": "Commit: **[236effb](https://github.com/sagemath/sagetrac-mirror/commit/236effb6198c6192dce0cedc0e53423c68743e3e)**",
    "created_at": "2013-12-31T10:34:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114426",
    "user": "https://github.com/sagetrac-jpflori"
}
```

Commit: **[236effb](https://github.com/sagemath/sagetrac-mirror/commit/236effb6198c6192dce0cedc0e53423c68743e3e)**



---

archive/issue_comments_114427.json:
```json
{
    "body": "Reviewer: **Jean-Pierre Flori**",
    "created_at": "2013-12-31T10:34:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114427",
    "user": "https://github.com/sagetrac-jpflori"
}
```

Reviewer: **Jean-Pierre Flori**



---

archive/issue_comments_114428.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">Comment 19</div>\n\nIn the doc about the coercion framework, it's written that a conversion is not supposed to make mathematical sense, but in this case I feel it's really conterintuitive and prone to errors to let L(f) just replace the generator of a finite field with another one, especially when another conversion/coercion makes sense, whence the need for this ticket...\n\nIf someone thinks the solution is overkill and goes against the coercion model philosophy, feel free to put the ticket back to another status.",
    "created_at": "2013-12-31T10:51:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114428",
    "user": "https://github.com/sagetrac-jpflori"
}
```

<div id="comment:19" align="right">Comment 19</div>

In the doc about the coercion framework, it's written that a conversion is not supposed to make mathematical sense, but in this case I feel it's really conterintuitive and prone to errors to let L(f) just replace the generator of a finite field with another one, especially when another conversion/coercion makes sense, whence the need for this ticket...

If someone thinks the solution is overkill and goes against the coercion model philosophy, feel free to put the ticket back to another status.



---

archive/issue_comments_114429.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">Comment 20</div>\n\nNot sure what to think about the quotients of univariate polynomial rings, except that it really feel akward.",
    "created_at": "2013-12-31T10:52:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114429",
    "user": "https://github.com/sagetrac-jpflori"
}
```

<div id="comment:20" align="right">Comment 20</div>

Not sure what to think about the quotients of univariate polynomial rings, except that it really feel akward.



---

archive/issue_events_135926.json:
```json
{
    "actor": "https://github.com/sagetrac-jpflori",
    "created_at": "2013-12-31T11:48:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11239#event-135926"
}
```



---

archive/issue_events_135927.json:
```json
{
    "actor": "https://github.com/sagetrac-jpflori",
    "created_at": "2013-12-31T11:48:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11239#event-135927"
}
```



---

archive/issue_comments_114430.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">Comment 21</div>\n\nMaybe this is worth a broader discussion on sage-devel...\n\nEspecially, should we let the stupid conversion in when there is no coercion (as it seems to fit Sage's philosophy and it is in place for quotients)?",
    "created_at": "2013-12-31T11:48:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114430",
    "user": "https://github.com/sagetrac-jpflori"
}
```

<div id="comment:21" align="right">Comment 21</div>

Maybe this is worth a broader discussion on sage-devel...

Especially, should we let the stupid conversion in when there is no coercion (as it seems to fit Sage's philosophy and it is in place for quotients)?



---

archive/issue_comments_114431.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">Comment 22</div>\n\nHere you go:\n* https://groups.google.com/d/msg/sage-devel/Z4iNgVMFoms/HxIZ98edPk0J",
    "created_at": "2013-12-31T11:59:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114431",
    "user": "https://github.com/sagetrac-jpflori"
}
```

<div id="comment:22" align="right">Comment 22</div>

Here you go:
* https://groups.google.com/d/msg/sage-devel/Z4iNgVMFoms/HxIZ98edPk0J



---

archive/issue_comments_114432.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">Comment 23</div>\n\nReplying to [@sagetrac-jpflori](#comment%3A21):\n> Maybe this is worth a broader discussion on sage-devel...\n\nI think it is worth thinking about whether the \"stupid\" conversion should be allowed between different quotients of a polynomial ring.  However, for the problem addressed in this ticket, there is really only one sensible thing to do, namely applying the canonical map between the base rings.\n\n> Especially, should we let the stupid conversion in when there is no coercion (as it seems to fit Sage's philosophy and it is in place for quotients)?\n\nI personally think that allowing `Fqq['y'](f)` to 'desperately' apply any available conversion, however nonsensical it may be, to the coefficients is a bad idea.  I don't see what is gained by permitting this notation; it seems to make it far too easy for the user to unwittingy introduce mysterious errors in this way.  If someone really wants this behaviour, it is much better to require explicitly lifting the finite field elements to **Z**[*x*] or another suitable ring.\n\nI would be in favour of a less permissive approach for conversions between different polynomial ring quotients as well, but again, this ticket is not the place to decide that.",
    "created_at": "2013-12-31T12:35:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114432",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:23" align="right">Comment 23</div>

Replying to [@sagetrac-jpflori](#comment%3A21):
> Maybe this is worth a broader discussion on sage-devel...

I think it is worth thinking about whether the "stupid" conversion should be allowed between different quotients of a polynomial ring.  However, for the problem addressed in this ticket, there is really only one sensible thing to do, namely applying the canonical map between the base rings.

> Especially, should we let the stupid conversion in when there is no coercion (as it seems to fit Sage's philosophy and it is in place for quotients)?

I personally think that allowing `Fqq['y'](f)` to 'desperately' apply any available conversion, however nonsensical it may be, to the coefficients is a bad idea.  I don't see what is gained by permitting this notation; it seems to make it far too easy for the user to unwittingy introduce mysterious errors in this way.  If someone really wants this behaviour, it is much better to require explicitly lifting the finite field elements to **Z**[*x*] or another suitable ring.

I would be in favour of a less permissive approach for conversions between different polynomial ring quotients as well, but again, this ticket is not the place to decide that.



---

archive/issue_comments_114433.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">Comment 24</div>\n\nReplying to [@pjbruin](#comment%3A23):\n> Replying to [@sagetrac-jpflori](#comment%3A21):\n> > Maybe this is worth a broader discussion on sage-devel...\n\n> I think it is worth thinking about whether the \"stupid\" conversion should be allowed between different quotients of a polynomial ring.  However, for the problem addressed in this ticket, there is really only one sensible thing to do, namely applying the canonical map between the base rings.\n> \n\nI agree.\n\n> > Especially, should we let the stupid conversion in when there is no coercion (as it seems to fit Sage's philosophy and it is in place for quotients)?\n\n> I personally think that allowing `Fqq['y'](f)` to 'desperately' apply any available conversion, however nonsensical it may be, to the coefficients is a bad idea.  I don't see what is gained by permitting this notation; it seems to make it far too easy for the user to unwittingy introduce mysterious errors in this way.  If someone really wants this behaviour, it is much better to require explicitly lifting the finite field elements to **Z**[*x*] or another suitable ring.\n\nI completely agree, whence my previous positive review.\nBut the doc for coercion kind of make me think, humm, maybe some people want the stupid behavior as well...\n\n> \n> I would be in favour of a less permissive approach for conversions between different polynomial ring quotients as well, but again, this ticket is not the place to decide that.\n\nI agree as well, I was just menitoning it because it's already mentioned here :)\n\nAnyway, if nobody gives a strong opinion of why to keep conversions without any mathematical sense and confusing for naive users on sage-devel, then I'll put this back to positive review quickly as I think that the situation with this ticket is far better.\nNote that maybe some efficiency could be gained by replacing the has_coerce_map_from by something else but I have no idea what to do now and no time to think about it, I'd just like to remove the stupid conversion unless someone convinces me to keep them of course.",
    "created_at": "2013-12-31T12:45:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114433",
    "user": "https://github.com/sagetrac-jpflori"
}
```

<div id="comment:24" align="right">Comment 24</div>

Replying to [@pjbruin](#comment%3A23):
> Replying to [@sagetrac-jpflori](#comment%3A21):
> > Maybe this is worth a broader discussion on sage-devel...

> I think it is worth thinking about whether the "stupid" conversion should be allowed between different quotients of a polynomial ring.  However, for the problem addressed in this ticket, there is really only one sensible thing to do, namely applying the canonical map between the base rings.
> 

I agree.

> > Especially, should we let the stupid conversion in when there is no coercion (as it seems to fit Sage's philosophy and it is in place for quotients)?

> I personally think that allowing `Fqq['y'](f)` to 'desperately' apply any available conversion, however nonsensical it may be, to the coefficients is a bad idea.  I don't see what is gained by permitting this notation; it seems to make it far too easy for the user to unwittingy introduce mysterious errors in this way.  If someone really wants this behaviour, it is much better to require explicitly lifting the finite field elements to **Z**[*x*] or another suitable ring.

I completely agree, whence my previous positive review.
But the doc for coercion kind of make me think, humm, maybe some people want the stupid behavior as well...

> 
> I would be in favour of a less permissive approach for conversions between different polynomial ring quotients as well, but again, this ticket is not the place to decide that.

I agree as well, I was just menitoning it because it's already mentioned here :)

Anyway, if nobody gives a strong opinion of why to keep conversions without any mathematical sense and confusing for naive users on sage-devel, then I'll put this back to positive review quickly as I think that the situation with this ticket is far better.
Note that maybe some efficiency could be gained by replacing the has_coerce_map_from by something else but I have no idea what to do now and no time to think about it, I'd just like to remove the stupid conversion unless someone convinces me to keep them of course.



---

archive/issue_comments_114434.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">Comment 25</div>\n\nSee my answer on sage-devel. In a nutshell: I would recommend against doing expensive tests when talking about conversion, and I would be rather permissive in conversions.\n\nConversions have no defined properties, and thus there is nothing that one could test. They don't need to be composable. They aren't even maps (only partially defined). It is perfectly fine to have a conversion for all elements of a ring R1 into a ring R2 and of all elements of a ring R2 into a ring R3, but only some elements (e.g.: polynomials of degree zero) of R1 convert into R3 without raising an error.\n\nPlease clearly distinguish between coercion and conversion. Coercions are morphisms. They are unique (for any pair of parents). They can be composed. The identity is a morphism (which together with the uniqueness and composability can imply the non-existence of certain coercions).\n\nI only know of one rule for conversion: If there is a coercion then conversion must coincide with it. And since the rules for conversions are so relaxed, I don't see why one should do expensive tests before applying a conversion (in particular when one thinks that conversions are not defined parent-by-parent, but element-by-element).",
    "created_at": "2013-12-31T17:21:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114434",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:25" align="right">Comment 25</div>

See my answer on sage-devel. In a nutshell: I would recommend against doing expensive tests when talking about conversion, and I would be rather permissive in conversions.

Conversions have no defined properties, and thus there is nothing that one could test. They don't need to be composable. They aren't even maps (only partially defined). It is perfectly fine to have a conversion for all elements of a ring R1 into a ring R2 and of all elements of a ring R2 into a ring R3, but only some elements (e.g.: polynomials of degree zero) of R1 convert into R3 without raising an error.

Please clearly distinguish between coercion and conversion. Coercions are morphisms. They are unique (for any pair of parents). They can be composed. The identity is a morphism (which together with the uniqueness and composability can imply the non-existence of certain coercions).

I only know of one rule for conversion: If there is a coercion then conversion must coincide with it. And since the rules for conversions are so relaxed, I don't see why one should do expensive tests before applying a conversion (in particular when one thinks that conversions are not defined parent-by-parent, but element-by-element).



---

archive/issue_comments_114435.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">Comment 26</div>\n\nReplying to [@simon-king-jena](#comment%3A25):\n> See my answer on sage-devel. In a nutshell: I would recommend against doing expensive tests when talking about conversion, and I would be rather permissive in conversions.\n> \n> Conversions have no defined properties, and thus there is nothing that one could test.\n\nGiven that a conversion needs to coincide with the coercion if the latter exists, one must check for a coercion before applying the \"stupid\" conversion (assuming the \"stupid\" conversion is desired at all).\n\nIn the situation of this ticket, there is a coercion map between the polynomial rings (assuming the finite fields know that they are compatible; see the doctests, not the ticket description).  The problem was that the element constructor didn't check for this and always applied the \"stupid\" conversion.  (The same problem arises when using `R.coerce(f)`, because the coercion map just defers to a conversion using the element constructor.)\n\nI think the point in the above discussion was whether my solution of calling `has_coerce_map_from()` is expensive; I guess not, but even if it is, it is still necessary to guarantee compatibility of conversion and coercion.\n\n> They don't need to be composable. They aren't even maps (only partially defined). It is perfectly fine to have a conversion for all elements of a ring R1 into a ring R2 and of all elements of a ring R2 into a ring R3, but only some elements (e.g.: polynomials of degree zero) of R1 convert into R3 without raising an error.\n\nThat is actually what I was trying to say on sage-devel in the context of polynomial ring quotients, but I wasn't very clear.  I agree that the existence of coercion doesn't have to be transitive, or to satisfy any rules; in the context of this ticket, I think it is perfectly fine if the \"stupid\" conversion is not used at all.",
    "created_at": "2013-12-31T18:11:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114435",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:26" align="right">Comment 26</div>

Replying to [@simon-king-jena](#comment%3A25):
> See my answer on sage-devel. In a nutshell: I would recommend against doing expensive tests when talking about conversion, and I would be rather permissive in conversions.
> 
> Conversions have no defined properties, and thus there is nothing that one could test.

Given that a conversion needs to coincide with the coercion if the latter exists, one must check for a coercion before applying the "stupid" conversion (assuming the "stupid" conversion is desired at all).

In the situation of this ticket, there is a coercion map between the polynomial rings (assuming the finite fields know that they are compatible; see the doctests, not the ticket description).  The problem was that the element constructor didn't check for this and always applied the "stupid" conversion.  (The same problem arises when using `R.coerce(f)`, because the coercion map just defers to a conversion using the element constructor.)

I think the point in the above discussion was whether my solution of calling `has_coerce_map_from()` is expensive; I guess not, but even if it is, it is still necessary to guarantee compatibility of conversion and coercion.

> They don't need to be composable. They aren't even maps (only partially defined). It is perfectly fine to have a conversion for all elements of a ring R1 into a ring R2 and of all elements of a ring R2 into a ring R3, but only some elements (e.g.: polynomials of degree zero) of R1 convert into R3 without raising an error.

That is actually what I was trying to say on sage-devel in the context of polynomial ring quotients, but I wasn't very clear.  I agree that the existence of coercion doesn't have to be transitive, or to satisfy any rules; in the context of this ticket, I think it is perfectly fine if the "stupid" conversion is not used at all.



---

archive/issue_comments_114436.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">Comment 27</div>\n\nReplying to [@pjbruin](#comment%3A26):\n> Replying to [@simon-king-jena](#comment%3A25):\n> > See my answer on sage-devel. In a nutshell: I would recommend against doing expensive tests when talking about conversion, and I would be rather permissive in conversions.\n> > \n> > Conversions have no defined properties, and thus there is nothing that one could test.\n\n> \n> Given that a conversion needs to coincide with the coercion if the latter exists, one must check for a coercion before applying the \"stupid\" conversion (assuming the \"stupid\" conversion is desired at all).\n\nNo!! It is just the other way around! Ideally, you have a fast cheap stupid conversion, and then a potentially expensive tests tells you whether this conversion qualifies as a coercion. This, by the way, is exactly what happens when `R._coerce_map_from_(S)` returns True: The return value asserts that the conversion qualifies as a coercion.\n\n> That is actually what I was trying to say on sage-devel in the context of polynomial ring quotients, but I wasn't very clear.  I agree that the existence of coercion doesn't have to be transitive, or to satisfy any rules; \n\nYou mean, conversion, not coercion? Coercion must be transitive. That's one of the axioms.",
    "created_at": "2013-12-31T19:15:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114436",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:27" align="right">Comment 27</div>

Replying to [@pjbruin](#comment%3A26):
> Replying to [@simon-king-jena](#comment%3A25):
> > See my answer on sage-devel. In a nutshell: I would recommend against doing expensive tests when talking about conversion, and I would be rather permissive in conversions.
> > 
> > Conversions have no defined properties, and thus there is nothing that one could test.

> 
> Given that a conversion needs to coincide with the coercion if the latter exists, one must check for a coercion before applying the "stupid" conversion (assuming the "stupid" conversion is desired at all).

No!! It is just the other way around! Ideally, you have a fast cheap stupid conversion, and then a potentially expensive tests tells you whether this conversion qualifies as a coercion. This, by the way, is exactly what happens when `R._coerce_map_from_(S)` returns True: The return value asserts that the conversion qualifies as a coercion.

> That is actually what I was trying to say on sage-devel in the context of polynomial ring quotients, but I wasn't very clear.  I agree that the existence of coercion doesn't have to be transitive, or to satisfy any rules; 

You mean, conversion, not coercion? Coercion must be transitive. That's one of the axioms.



---

archive/issue_comments_114437.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">Comment 28</div>\n\nReplying to [@simon-king-jena](#comment%3A27):\n> > Given that a conversion needs to coincide with the coercion if the latter exists, one must check for a coercion before applying the \"stupid\" conversion (assuming the \"stupid\" conversion is desired at all).\n\n> \n> No!! It is just the other way around!\n\nI think I see what you mean, but am still not sure.  Are you suggesting that also the existing\n\n```python\nelif self.base_ring().has_coerce_map_from(P):\n    return C(self, [x], check=True, is_gen=False,\n    construct=construct)\n```\nin `PolynomialRing._element_constructor_()` should go away and that there should be custom coercion maps to replace this check and the similar one added by my patch?\n\n> You mean, conversion, not coercion? Coercion must be transitive. That's one of the axioms.\n\nYes, I meant conversion.",
    "created_at": "2013-12-31T21:44:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114437",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:28" align="right">Comment 28</div>

Replying to [@simon-king-jena](#comment%3A27):
> > Given that a conversion needs to coincide with the coercion if the latter exists, one must check for a coercion before applying the "stupid" conversion (assuming the "stupid" conversion is desired at all).

> 
> No!! It is just the other way around!

I think I see what you mean, but am still not sure.  Are you suggesting that also the existing

```python
elif self.base_ring().has_coerce_map_from(P):
    return C(self, [x], check=True, is_gen=False,
    construct=construct)
```
in `PolynomialRing._element_constructor_()` should go away and that there should be custom coercion maps to replace this check and the similar one added by my patch?

> You mean, conversion, not coercion? Coercion must be transitive. That's one of the axioms.

Yes, I meant conversion.



---

archive/issue_comments_114438.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">Comment 29</div>\n\nReplying to [@simon-king-jena](#comment%3A27):\n> No!! It is just the other way around! Ideally, you have a fast cheap stupid conversion, and then a potentially expensive tests tells you whether this conversion qualifies as a coercion. This, by the way, is exactly what happens when `R._coerce_map_from_(S)` returns True: The return value asserts that the conversion qualifies as a coercion.\n\nActually, that is something I wondered about before. From an efficiency point of view this is a really bad idea: we have just established that between two very specific parents S and R there exists a coercion and to actually perform it we boot back to completely generic code that has to figure out exactly what conversion to apply, doing all kinds of type checks again. It would seem much better to refactor such code to immediately call the special case that the conversion code is going to arrive at anyway.",
    "created_at": "2013-12-31T22:56:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114438",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:29" align="right">Comment 29</div>

Replying to [@simon-king-jena](#comment%3A27):
> No!! It is just the other way around! Ideally, you have a fast cheap stupid conversion, and then a potentially expensive tests tells you whether this conversion qualifies as a coercion. This, by the way, is exactly what happens when `R._coerce_map_from_(S)` returns True: The return value asserts that the conversion qualifies as a coercion.

Actually, that is something I wondered about before. From an efficiency point of view this is a really bad idea: we have just established that between two very specific parents S and R there exists a coercion and to actually perform it we boot back to completely generic code that has to figure out exactly what conversion to apply, doing all kinds of type checks again. It would seem much better to refactor such code to immediately call the special case that the conversion code is going to arrive at anyway.



---

archive/issue_comments_114439.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">Comment 30</div>\n\nHere is the way in which I think this bug should be solved conceptually.  It is motivated by the fact that if *A* is a commutative ring, the object *A*[*x*] in the category of *A*-algebras represents the forgetful functor to the category of sets.\n- Implement a class `PolynomialRingMorphism` modelling ring homomorphisms *f*: *A*[*x*] -> *C*, where *A* and *C* are commutative rings.  Note that *C* is not required to be a polynomial ring.  Such ring homomorphisms correspond bijectively to pairs (*g*, *c*), where *g*: *A* -> *C* is a ring homomorphism and *c* is an element of *C*, where the bijection is given by *g* = *f*|<sub>A</sub> and *c* = *f*(*x*); cf. the above motivation.\n- Have optimised code for the following special case: *C* = *B*[*y*] where *B* is an *A*-algebra (or: has a coercion map from *A*), *g* is the composition of the obvious maps *A* -> *B* -> *C*, and *c* = *y*. In this case, *f* is the map *A*[*x*] -> *C*[*y*] that we will declare as the coercion map.  Given an element *p* of *A*[*x*], the `PolynomialRingMorphism` in this special case should just take the list of coefficients of *p*, map them to *B* and hence construct the desired element *f*(*p*) of *B*[*y*].\n- If *C* = *B*[*y*], where *B* has a coercion map from *A*, let `C._coerce_map_from_(A['x'])` return the `PolynomialRingMorphism` for the above special case.\n- A general `PolynomialRingMorphism` could be implemented either in terms of this special case or independently from it.  The first approach would work as follows: given a general *f*: *A*[*x*] -> *C* as in the first point, represented by a pair (*g*, *c*), applying *f* to a polynomial *p* in *A*[*x*] can be implemented by first mapping *p* to *C*[*y*] (applying *g* to the coefficients as in the special case) and then substituting *c* for *y*.\nThis is probably not very difficult to implement.  This ticket could function as a temporary solution for the bug it fixes, until we have the real solution.\n\nP.S. The current `_coerce_map_from_()`, in the case of univariate polynomial rings where there exists a coercion between the base rings, returns `False` unless the variable name is the same.  In the above, I chose the different letters *x* and *y* to clearly distinguish between the polynomial rings; they are not meant as Sage variable names.\n\nP.P.S. It turns out that the special case already exists (in more generality) as `RingHomomorphism_from_base`.  In the above notation, it applies *g* elementwise to the `dict` of coefficients; for univariate dense polynomials a `list` would probaby be faster, but it looks like a good starting point.",
    "created_at": "2014-01-03T23:53:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114439",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:30" align="right">Comment 30</div>

Here is the way in which I think this bug should be solved conceptually.  It is motivated by the fact that if *A* is a commutative ring, the object *A*[*x*] in the category of *A*-algebras represents the forgetful functor to the category of sets.
- Implement a class `PolynomialRingMorphism` modelling ring homomorphisms *f*: *A*[*x*] -> *C*, where *A* and *C* are commutative rings.  Note that *C* is not required to be a polynomial ring.  Such ring homomorphisms correspond bijectively to pairs (*g*, *c*), where *g*: *A* -> *C* is a ring homomorphism and *c* is an element of *C*, where the bijection is given by *g* = *f*|<sub>A</sub> and *c* = *f*(*x*); cf. the above motivation.
- Have optimised code for the following special case: *C* = *B*[*y*] where *B* is an *A*-algebra (or: has a coercion map from *A*), *g* is the composition of the obvious maps *A* -> *B* -> *C*, and *c* = *y*. In this case, *f* is the map *A*[*x*] -> *C*[*y*] that we will declare as the coercion map.  Given an element *p* of *A*[*x*], the `PolynomialRingMorphism` in this special case should just take the list of coefficients of *p*, map them to *B* and hence construct the desired element *f*(*p*) of *B*[*y*].
- If *C* = *B*[*y*], where *B* has a coercion map from *A*, let `C._coerce_map_from_(A['x'])` return the `PolynomialRingMorphism` for the above special case.
- A general `PolynomialRingMorphism` could be implemented either in terms of this special case or independently from it.  The first approach would work as follows: given a general *f*: *A*[*x*] -> *C* as in the first point, represented by a pair (*g*, *c*), applying *f* to a polynomial *p* in *A*[*x*] can be implemented by first mapping *p* to *C*[*y*] (applying *g* to the coefficients as in the special case) and then substituting *c* for *y*.
This is probably not very difficult to implement.  This ticket could function as a temporary solution for the bug it fixes, until we have the real solution.

P.S. The current `_coerce_map_from_()`, in the case of univariate polynomial rings where there exists a coercion between the base rings, returns `False` unless the variable name is the same.  In the above, I chose the different letters *x* and *y* to clearly distinguish between the polynomial rings; they are not meant as Sage variable names.

P.P.S. It turns out that the special case already exists (in more generality) as `RingHomomorphism_from_base`.  In the above notation, it applies *g* elementwise to the `dict` of coefficients; for univariate dense polynomials a `list` would probaby be faster, but it looks like a good starting point.



---

archive/issue_events_135928.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11239#event-135928"
}
```



---

archive/issue_events_135929.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11239#event-135929"
}
```



---

archive/issue_comments_114440.json:
```json
{
    "body": "Changed commit from **[236effb](https://github.com/sagemath/sagetrac-mirror/commit/236effb6198c6192dce0cedc0e53423c68743e3e)** to **[07d774f](https://github.com/sagemath/sagetrac-mirror/commit/07d774f5f0c226d866cf4ea519951f92268063ff)**",
    "created_at": "2014-03-02T23:47:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114440",
    "user": "https://github.com/pjbruin"
}
```

Changed commit from **[236effb](https://github.com/sagemath/sagetrac-mirror/commit/236effb6198c6192dce0cedc0e53423c68743e3e)** to **[07d774f](https://github.com/sagemath/sagetrac-mirror/commit/07d774f5f0c226d866cf4ea519951f92268063ff)**



---

archive/issue_comments_114441.json:
```json
{
    "body": "Changed branch from **[u/jpflori/ticket/11239](https://github.com/sagemath/sagetrac-mirror/tree/u/jpflori/ticket/11239)** to **[u/pbruin/11239-polynomial_coercion](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/11239-polynomial_coercion)**",
    "created_at": "2014-03-02T23:47:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114441",
    "user": "https://github.com/pjbruin"
}
```

Changed branch from **[u/jpflori/ticket/11239](https://github.com/sagemath/sagetrac-mirror/tree/u/jpflori/ticket/11239)** to **[u/pbruin/11239-polynomial_coercion](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/11239-polynomial_coercion)**



---

archive/issue_events_135930.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-03-02T23:47:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11239#event-135930"
}
```



---

archive/issue_events_135931.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-03-02T23:47:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11239#event-135931"
}
```



---

archive/issue_comments_114442.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">Comment 32</div>\n\nHere is a fix based on the existing one and the \"P.P.S\" from [comment:30](#comment%3A30).  This gets rid of the test for coercion maps in the polynomial constructor.",
    "created_at": "2014-03-02T23:47:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114442",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:32" align="right">Comment 32</div>

Here is a fix based on the existing one and the "P.P.S" from [comment:30](#comment%3A30).  This gets rid of the test for coercion maps in the polynomial constructor.



---

archive/issue_events_135932.json:
```json
{
    "actor": "https://github.com/sagetrac-jpflori",
    "created_at": "2014-03-03T13:09:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11239#event-135932"
}
```



---

archive/issue_events_135933.json:
```json
{
    "actor": "https://github.com/sagetrac-jpflori",
    "created_at": "2014-03-03T13:09:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11239#event-135933"
}
```



---

archive/issue_comments_114443.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">Comment 33</div>\n\nLooks good enough for me and passes tests.",
    "created_at": "2014-03-03T13:09:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114443",
    "user": "https://github.com/sagetrac-jpflori"
}
```

<div id="comment:33" align="right">Comment 33</div>

Looks good enough for me and passes tests.



---

archive/issue_comments_114444.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">Comment 34</div>\n\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dbe7209abde689a03b288511db1aa8b6fa991e9c\">dbe7209</a></td><td><code>remove unused declaration from polynomial_ring_homomorphism.pxd</code></td></tr></table>\n",
    "created_at": "2014-03-03T13:29:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114444",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:34" align="right">Comment 34</div>

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dbe7209abde689a03b288511db1aa8b6fa991e9c">dbe7209</a></td><td><code>remove unused declaration from polynomial_ring_homomorphism.pxd</code></td></tr></table>




---

archive/issue_comments_114445.json:
```json
{
    "body": "Changed commit from **[07d774f](https://github.com/sagemath/sagetrac-mirror/commit/07d774f5f0c226d866cf4ea519951f92268063ff)** to **[dbe7209](https://github.com/sagemath/sagetrac-mirror/commit/dbe7209abde689a03b288511db1aa8b6fa991e9c)**",
    "created_at": "2014-03-03T13:29:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114445",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[07d774f](https://github.com/sagemath/sagetrac-mirror/commit/07d774f5f0c226d866cf4ea519951f92268063ff)** to **[dbe7209](https://github.com/sagemath/sagetrac-mirror/commit/dbe7209abde689a03b288511db1aa8b6fa991e9c)**



---

archive/issue_events_135934.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2014-03-03T13:29:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11239#event-135934"
}
```



---

archive/issue_events_135935.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2014-03-03T13:29:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11239#event-135935"
}
```



---

archive/issue_comments_114446.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">Comment 35</div>\n\nI trust this latest change is OK too.  (I started implementing a class `PolynomialRingHomomorphism` as in [comment:30](#comment%3A30), but didn't include it in the branch since it isn't finished and isn't needed to fix this bug; I should have removed the declaration too.)",
    "created_at": "2014-03-03T13:32:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114446",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:35" align="right">Comment 35</div>

I trust this latest change is OK too.  (I started implementing a class `PolynomialRingHomomorphism` as in [comment:30](#comment%3A30), but didn't include it in the branch since it isn't finished and isn't needed to fix this bug; I should have removed the declaration too.)



---

archive/issue_events_135936.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-03-03T13:32:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11239#event-135936"
}
```



---

archive/issue_events_135937.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-03-03T13:32:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11239#event-135937"
}
```



---

archive/issue_comments_114447.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">Comment 36</div>\n\nThe latest change is ok with me as it just removes something unused.",
    "created_at": "2014-03-03T13:33:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114447",
    "user": "https://github.com/sagetrac-jpflori"
}
```

<div id="comment:36" align="right">Comment 36</div>

The latest change is ok with me as it just removes something unused.



---

archive/issue_events_135938.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2014-03-03T15:14:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11239#event-135938"
}
```



---

archive/issue_events_135939.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2014-03-03T15:14:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11239#event-135939"
}
```



---

archive/issue_comments_114448.json:
```json
{
    "body": "Changed commit from **[dbe7209](https://github.com/sagemath/sagetrac-mirror/commit/dbe7209abde689a03b288511db1aa8b6fa991e9c)** to **[61c565b](https://github.com/sagemath/sagetrac-mirror/commit/61c565b7beccc1466bdac4d17fab755cbf5f9c9c)**",
    "created_at": "2014-03-03T15:14:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114448",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[dbe7209](https://github.com/sagemath/sagetrac-mirror/commit/dbe7209abde689a03b288511db1aa8b6fa991e9c)** to **[61c565b](https://github.com/sagemath/sagetrac-mirror/commit/61c565b7beccc1466bdac4d17fab755cbf5f9c9c)**



---

archive/issue_comments_114449.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">Comment 37</div>\n\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/61c565b7beccc1466bdac4d17fab755cbf5f9c9c\">61c565b</a></td><td><code>distinguish between sparse and dense in PolynomialRingHomomorphism_from_base</code></td></tr></table>\n",
    "created_at": "2014-03-03T15:14:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114449",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:37" align="right">Comment 37</div>

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/61c565b7beccc1466bdac4d17fab755cbf5f9c9c">61c565b</a></td><td><code>distinguish between sparse and dense in PolynomialRingHomomorphism_from_base</code></td></tr></table>




---

archive/issue_comments_114450.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">Comment 38</div>\n\nSorry, I realised the patch didn't take sparse polynomial rings into account.  There was also a minor mistake in two existing doctests.",
    "created_at": "2014-03-03T15:16:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114450",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:38" align="right">Comment 38</div>

Sorry, I realised the patch didn't take sparse polynomial rings into account.  There was also a minor mistake in two existing doctests.



---

archive/issue_events_135940.json:
```json
{
    "actor": "https://github.com/sagetrac-jpflori",
    "created_at": "2014-03-03T15:22:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11239#event-135940"
}
```



---

archive/issue_events_135941.json:
```json
{
    "actor": "https://github.com/sagetrac-jpflori",
    "created_at": "2014-03-03T15:22:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11239#event-135941"
}
```



---

archive/issue_comments_114451.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">Comment 39</div>\n\nI should be the one being sorry... I should have seen the error in the doctest.\nAnyway, it looks better now and I wasn't aware that we have saprse polynomials!",
    "created_at": "2014-03-03T15:22:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114451",
    "user": "https://github.com/sagetrac-jpflori"
}
```

<div id="comment:39" align="right">Comment 39</div>

I should be the one being sorry... I should have seen the error in the doctest.
Anyway, it looks better now and I wasn't aware that we have saprse polynomials!



---

archive/issue_comments_114452.json:
```json
{
    "body": "Changed branch from **[u/pbruin/11239-polynomial_coercion](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/11239-polynomial_coercion)** to **[61c565b](https://github.com/sagemath/sagetrac-mirror/commit/61c565b7beccc1466bdac4d17fab755cbf5f9c9c)**",
    "created_at": "2014-03-05T09:36:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11239#issuecomment-114452",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/pbruin/11239-polynomial_coercion](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/11239-polynomial_coercion)** to **[61c565b](https://github.com/sagemath/sagetrac-mirror/commit/61c565b7beccc1466bdac4d17fab755cbf5f9c9c)**



---

archive/issue_events_135942.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-03-05T09:36:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11239#event-135942"
}
```



---

archive/issue_events_135943.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "a4b97566e0e90be364d851ac0199bcdb7022ce03",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2014-03-05T09:36:26Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/11239",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11239#event-135943"
}
```
