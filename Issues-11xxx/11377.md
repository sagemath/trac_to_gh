# Issue 11377: Clean and harmonize module_list.py

archive/issues_011205.json:
```json
{
    "body": "module_list.py is quite messy in its current state. There are several things that can be done:\n1. remove the unused debian bits\n2. we have SAGE_LOCAL and SAGE_INC variables but there use iis not uniform\n3. we also have numpy_include_dirs, numpy_depends, flint_depends, singular_depends and ginac_depends and most of them are under-used.\n\nIn this ticket I remove old debian stuff, use SAGE_INC, SAGE_LOCAL and the other variables in a uniform fashion removing all instances of SAGE_ROOT +/local/... and so on to replace it by the appropriate variable. \n\nApply:\n* [attachment:trac_11377-build_module_listpy.patch]\n* [attachment:trac_11377-extraflint-dependencies.patch]\n\n**Assignee:** GeorgSWeber\n\n**CC:**  @strogdon @robertwb\n\n**Keywords:** sd31\n\n**Resolution:** fixed\n\n**Author:** Fran\u00e7ois Bissey\n\n**Reviewer:** Volker Braun\n\n**Merged:** sage-4.7.1.alpha4\n\nIssue created by migration from https://trac.sagemath.org/ticket/11377\n\n",
    "closed_at": "2011-06-15T15:24:57Z",
    "created_at": "2011-05-25T01:22:48Z",
    "labels": [
        "component: build",
        "critical"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7.1",
    "title": "Clean and harmonize module_list.py",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11377",
    "user": "https://github.com/kiwifb"
}
```
module_list.py is quite messy in its current state. There are several things that can be done:
1. remove the unused debian bits
2. we have SAGE_LOCAL and SAGE_INC variables but there use iis not uniform
3. we also have numpy_include_dirs, numpy_depends, flint_depends, singular_depends and ginac_depends and most of them are under-used.

In this ticket I remove old debian stuff, use SAGE_INC, SAGE_LOCAL and the other variables in a uniform fashion removing all instances of SAGE_ROOT +/local/... and so on to replace it by the appropriate variable. 

Apply:
* [attachment:trac_11377-build_module_listpy.patch]
* [attachment:trac_11377-extraflint-dependencies.patch]

**Assignee:** GeorgSWeber

**CC:**  @strogdon @robertwb

**Keywords:** sd31

**Resolution:** fixed

**Author:** François Bissey

**Reviewer:** Volker Braun

**Merged:** sage-4.7.1.alpha4

Issue created by migration from https://trac.sagemath.org/ticket/11377





---

archive/attachments_014946.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_11377-build_module_listpy.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket11377/trac_11377-build_module_listpy.patch",
    "created_at": "2011-05-25T01:25:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11377",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/kiwifb"
}
```



---

archive/issue_comments_156034.json:
```json
{
    "body": "patch to module_list.py",
    "created_at": "2011-05-25T01:25:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11377#issuecomment-156034",
    "user": "https://github.com/kiwifb"
}
```

patch to module_list.py



---

archive/issue_comments_156035.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2011-05-25T01:25:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11377#issuecomment-156035",
    "user": "https://github.com/kiwifb"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_156036.json:
```json
{
    "body": "**Author:** Fran\u00e7ois Bissey",
    "created_at": "2011-05-25T01:25:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11377#issuecomment-156036",
    "user": "https://github.com/kiwifb"
}
```

**Author:** François Bissey



---

archive/issue_comments_156037.json:
```json
{
    "body": "<a id='comment:3'></a>\nNow that 4.7.1.alpha0 is out this can be reviewed.",
    "created_at": "2011-05-27T21:29:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11377#issuecomment-156037",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:3'></a>
Now that 4.7.1.alpha0 is out this can be reviewed.



---

archive/issue_comments_156038.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2011-06-13T20:14:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11377#issuecomment-156038",
    "user": "https://github.com/vbraun"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_156039.json:
```json
{
    "body": "<a id='comment:4'></a>\nLooks good to me. But in Sage-4.7.1.alpha2 there were some more extension modules added (under sage.groups.perm_gps.partn_ref). Can you updated your patch for that? I'll review it then asap.",
    "created_at": "2011-06-13T20:14:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11377#issuecomment-156039",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:4'></a>
Looks good to me. But in Sage-4.7.1.alpha2 there were some more extension modules added (under sage.groups.perm_gps.partn_ref). Can you updated your patch for that? I'll review it then asap.



---

archive/issue_comments_156040.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"sd31\".",
    "created_at": "2011-06-13T20:15:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11377#issuecomment-156040",
    "user": "https://github.com/vbraun"
}
```

**Changing keywords** from "" to "sd31".



---

archive/issue_comments_156041.json:
```json
{
    "body": "<a id='comment:6'></a>\nIt is up to date for 4.7.1.alpha2 already. The only possible problems could be with #9989 depending on which one is merged first and whether my suggested changes for it are accepted.",
    "created_at": "2011-06-13T21:29:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11377#issuecomment-156041",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:6'></a>
It is up to date for 4.7.1.alpha2 already. The only possible problems could be with #9989 depending on which one is merged first and whether my suggested changes for it are accepted.



---

archive/issue_comments_156042.json:
```json
{
    "body": "<a id='comment:7'></a>\nThe patch applies, but `sage.groups.perm_gps.partn_ref.*` don't use `SAGE_INC` and the `flint_depends`:\n\n```\n\n    Extension('sage.groups.perm_gps.partn_ref.automorphism_group_canonical_label',\n              sources = ['sage/groups/perm_gps/partn_ref/automorphism_group_canonical_label.pyx'],\n              libraries = ['gmp', 'flint'],\n              include_dirs = [SAGE_ROOT + '/local/include/FLINT/'],\n              extra_compile_args = ['-std=c99'],\n              depends = [SAGE_ROOT + \"/local/include/FLINT/flint.h\"]),\n```",
    "created_at": "2011-06-13T22:27:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11377#issuecomment-156042",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:7'></a>
The patch applies, but `sage.groups.perm_gps.partn_ref.*` don't use `SAGE_INC` and the `flint_depends`:

```

    Extension('sage.groups.perm_gps.partn_ref.automorphism_group_canonical_label',
              sources = ['sage/groups/perm_gps/partn_ref/automorphism_group_canonical_label.pyx'],
              libraries = ['gmp', 'flint'],
              include_dirs = [SAGE_ROOT + '/local/include/FLINT/'],
              extra_compile_args = ['-std=c99'],
              depends = [SAGE_ROOT + "/local/include/FLINT/flint.h"]),
```



---

archive/issue_comments_156043.json:
```json
{
    "body": "<a id='comment:8'></a>\nI thought I had taken care of that. My apologies it will take a few hours until I can take care of them.",
    "created_at": "2011-06-13T23:08:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11377#issuecomment-156043",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:8'></a>
I thought I had taken care of that. My apologies it will take a few hours until I can take care of them.



---

archive/attachments_014947.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_11377-extraflint-dependencies.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket11377/trac_11377-extraflint-dependencies.patch",
    "created_at": "2011-06-14T00:00:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11377",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/kiwifb"
}
```



---

archive/issue_comments_156044.json:
```json
{
    "body": "I missed a number of flint dependencies in the original patch. Apply trac_11377-build_module_listpy.patchafter",
    "created_at": "2011-06-14T00:00:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11377#issuecomment-156044",
    "user": "https://github.com/kiwifb"
}
```

I missed a number of flint dependencies in the original patch. Apply trac_11377-build_module_listpy.patchafter



---

archive/issue_comments_156045.json:
```json
{
    "body": "<a id='comment:9'></a>\nIt turns out I had missed another instance of flint in sage.set.disjoints.set. So the additional patch takes care of it. It was all done on top of alpha2, hopefully there is nothing wrecking it already in alpha3.",
    "created_at": "2011-06-14T00:04:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11377#issuecomment-156045",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:9'></a>
It turns out I had missed another instance of flint in sage.set.disjoints.set. So the additional patch takes care of it. It was all done on top of alpha2, hopefully there is nothing wrecking it already in alpha3.



---

archive/issue_comments_156046.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -4,3 +4,7 @@\n 3. we also have numpy_include_dirs, numpy_depends, flint_depends, singular_depends and ginac_depends and most of them are under-used.\n \n In this ticket I remove old debian stuff, use SAGE_INC, SAGE_LOCAL and the other variables in a uniform fashion removing all instances of SAGE_ROOT +/local/... and so on to replace it by the appropriate variable. \n+\n+Apply:\n+* [attachment:trac_11377-build_module_listpy.patch]\n+* [attachment:trac_11377-extraflint-dependencies.patch]\n``````\n",
    "created_at": "2011-06-14T00:04:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11377#issuecomment-156046",
    "user": "https://github.com/kiwifb"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -4,3 +4,7 @@
 3. we also have numpy_include_dirs, numpy_depends, flint_depends, singular_depends and ginac_depends and most of them are under-used.
 
 In this ticket I remove old debian stuff, use SAGE_INC, SAGE_LOCAL and the other variables in a uniform fashion removing all instances of SAGE_ROOT +/local/... and so on to replace it by the appropriate variable. 
+
+Apply:
+* [attachment:trac_11377-build_module_listpy.patch]
+* [attachment:trac_11377-extraflint-dependencies.patch]
``````




---

archive/issue_comments_156047.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2011-06-14T00:04:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11377#issuecomment-156047",
    "user": "https://github.com/kiwifb"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_156048.json:
```json
{
    "body": "<a id='comment:10'></a>\nIn the last patch description the word after shouldn't have come last. It is applied after trac_11377-build_module_listpy.patch.",
    "created_at": "2011-06-14T00:06:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11377#issuecomment-156048",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:10'></a>
In the last patch description the word after shouldn't have come last. It is applied after trac_11377-build_module_listpy.patch.



---

archive/issue_comments_156049.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2011-06-14T00:37:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11377#issuecomment-156049",
    "user": "https://github.com/vbraun"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_156050.json:
```json
{
    "body": "**Reviewer:** Volker Braun",
    "created_at": "2011-06-14T00:37:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11377#issuecomment-156050",
    "user": "https://github.com/vbraun"
}
```

**Reviewer:** Volker Braun



---

archive/issue_comments_156051.json:
```json
{
    "body": "<a id='comment:11'></a>\nLooks great!",
    "created_at": "2011-06-14T00:37:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11377#issuecomment-156051",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:11'></a>
Looks great!



---

archive/issue_comments_156052.json:
```json
{
    "body": "**Merged:** sage-4.7.1.alpha4",
    "created_at": "2011-06-15T15:24:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11377#issuecomment-156052",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-4.7.1.alpha4



---

archive/issue_comments_156053.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2011-06-15T15:24:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11377#issuecomment-156053",
    "user": "https://github.com/jdemeyer"
}
```

**Resolution:** fixed



---

archive/issue_events_035087.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-06-15T15:24:57Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11377",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11377#event-35087"
}
```



---

archive/issue_comments_156054.json:
```json
{
    "body": "<a id='comment:14'></a>\nWould have been nice if you'd cc'ed me ;-) (as I have introduced `SAGE_INC` :-) and always been interested in cleaning the whole mess up, not to mention tickets like #8664, #9914, or the \"final\" trouble with #4000 ...).\n\nRobert B. originally planned (about 14+ month ago, cf. e.g. #7987) to \"automate\" most of what's currently hand-coded in `module_list.py` (by Cython pragmas local to the modules' files), so I mostly made changes that affect only small parts.\n\nBtw, I may have missed something, but neither alpha4 (nor alpha3) have yet been announced; the `README.FIRST`s still state\n> *There is no point in testing it because the version can change any time.*\n",
    "created_at": "2011-06-18T16:49:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11377#issuecomment-156054",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:14'></a>
Would have been nice if you'd cc'ed me ;-) (as I have introduced `SAGE_INC` :-) and always been interested in cleaning the whole mess up, not to mention tickets like #8664, #9914, or the "final" trouble with #4000 ...).

Robert B. originally planned (about 14+ month ago, cf. e.g. #7987) to "automate" most of what's currently hand-coded in `module_list.py` (by Cython pragmas local to the modules' files), so I mostly made changes that affect only small parts.

Btw, I may have missed something, but neither alpha4 (nor alpha3) have yet been announced; the `README.FIRST`s still state
> *There is no point in testing it because the version can change any time.*




---

archive/issue_comments_156055.json:
```json
{
    "body": "<a id='comment:15'></a>\nHi Robert,\n\nsorry I didn't know you had introduced it. I was vaguely aware of the existence of an effort like #7987 but didn't know the ticket or that a ticket was actually open.\n\nI must say my primary aim was the elimination of reference to SAGE_ROOT which is a pain for sage-on-gentoo. And of course once started I had to clean the whole thing, I have been waiting for some time with my clean up patch I can tell you. So I am glad it got reviewed positively and all.",
    "created_at": "2011-06-18T19:58:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11377#issuecomment-156055",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:15'></a>
Hi Robert,

sorry I didn't know you had introduced it. I was vaguely aware of the existence of an effort like #7987 but didn't know the ticket or that a ticket was actually open.

I must say my primary aim was the elimination of reference to SAGE_ROOT which is a pain for sage-on-gentoo. And of course once started I had to clean the whole thing, I have been waiting for some time with my clean up patch I can tell you. So I am glad it got reviewed positively and all.



---

archive/issue_comments_156056.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [fbissey](#comment%3A15):\n> And of course once started I had to clean the whole thing, I have been waiting for some time with my clean up patch I can tell you. So I am glad it got reviewed positively and all.\n\n\nAnd above all *merged*! Making larger changes to `module_list.py` is some kind of Sisyphean task since many tickets (unrelated to the build system) frequently modify parts of it.\n\nReducing the need for the latter should IMHO be the next step, as it somewhat thwarts concurrent, modular development and maintainability.\n\nI've more than once spent days to figure out and remove useless dependencies (e.g. on libraries) last year, in some cases just to - not much later - see the effort being more or less in vain...",
    "created_at": "2011-06-18T21:39:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11377#issuecomment-156056",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:16'></a>
Replying to [fbissey](#comment%3A15):
> And of course once started I had to clean the whole thing, I have been waiting for some time with my clean up patch I can tell you. So I am glad it got reviewed positively and all.


And above all *merged*! Making larger changes to `module_list.py` is some kind of Sisyphean task since many tickets (unrelated to the build system) frequently modify parts of it.

Reducing the need for the latter should IMHO be the next step, as it somewhat thwarts concurrent, modular development and maintainability.

I've more than once spent days to figure out and remove useless dependencies (e.g. on libraries) last year, in some cases just to - not much later - see the effort being more or less in vain...
