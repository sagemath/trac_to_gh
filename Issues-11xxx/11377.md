# Issue 11377: Clean and harmonize module_list.py

archive/issues_011205.json:
```json
{
    "body": "Assignee: GeorgSWeber\n\nCC:  @strogdon @robertwb\n\nKeywords: sd31\n\nmodule_list.py is quite messy in its current state. There are several things that can be done:\n1. remove the unused debian bits\n2. we have SAGE_LOCAL and SAGE_INC variables but there use iis not uniform\n3. we also have numpy_include_dirs, numpy_depends, flint_depends, singular_depends and ginac_depends and most of them are under-used.\n\nIn this ticket I remove old debian stuff, use SAGE_INC, SAGE_LOCAL and the other variables in a uniform fashion removing all instances of SAGE_ROOT +/local/... and so on to replace it by the appropriate variable. \n\nApply:\n* [attachment:trac_11377-build_module_listpy.patch]\n* [attachment:trac_11377-extraflint-dependencies.patch]\n\nIssue created by migration from https://trac.sagemath.org/ticket/11377\n\n",
    "closed_at": "2011-06-15T15:24:57Z",
    "created_at": "2011-05-25T01:22:48Z",
    "labels": [
        "component: build",
        "critical"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7.1",
    "title": "Clean and harmonize module_list.py",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11377",
    "user": "https://github.com/kiwifb"
}
```
Assignee: GeorgSWeber

CC:  @strogdon @robertwb

Keywords: sd31

module_list.py is quite messy in its current state. There are several things that can be done:
1. remove the unused debian bits
2. we have SAGE_LOCAL and SAGE_INC variables but there use iis not uniform
3. we also have numpy_include_dirs, numpy_depends, flint_depends, singular_depends and ginac_depends and most of them are under-used.

In this ticket I remove old debian stuff, use SAGE_INC, SAGE_LOCAL and the other variables in a uniform fashion removing all instances of SAGE_ROOT +/local/... and so on to replace it by the appropriate variable. 

Apply:
* [attachment:trac_11377-build_module_listpy.patch]
* [attachment:trac_11377-extraflint-dependencies.patch]

Issue created by migration from https://trac.sagemath.org/ticket/11377





---

archive/issue_comments_123054.json:
```json
{
    "body": "Attachment [trac_11377-build_module_listpy.patch](tarball://root/attachments/some-uuid/ticket11377/trac_11377-build_module_listpy.patch) by @kiwifb created at 2011-05-25 01:25:12\n\npatch to module_list.py",
    "created_at": "2011-05-25T01:25:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11377#issuecomment-123054",
    "user": "https://github.com/kiwifb"
}
```

Attachment [trac_11377-build_module_listpy.patch](tarball://root/attachments/some-uuid/ticket11377/trac_11377-build_module_listpy.patch) by @kiwifb created at 2011-05-25 01:25:12

patch to module_list.py



---

archive/issue_comments_123055.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-05-25T01:25:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11377#issuecomment-123055",
    "user": "https://github.com/kiwifb"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_123056.json:
```json
{
    "body": "Now that 4.7.1.alpha0 is out this can be reviewed.",
    "created_at": "2011-05-27T21:29:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11377#issuecomment-123056",
    "user": "https://github.com/kiwifb"
}
```

Now that 4.7.1.alpha0 is out this can be reviewed.



---

archive/issue_comments_123057.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-06-13T20:14:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11377#issuecomment-123057",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_123058.json:
```json
{
    "body": "Looks good to me. But in Sage-4.7.1.alpha2 there were some more extension modules added (under sage.groups.perm_gps.partn_ref). Can you updated your patch for that? I'll review it then asap.",
    "created_at": "2011-06-13T20:14:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11377#issuecomment-123058",
    "user": "https://github.com/vbraun"
}
```

Looks good to me. But in Sage-4.7.1.alpha2 there were some more extension modules added (under sage.groups.perm_gps.partn_ref). Can you updated your patch for that? I'll review it then asap.



---

archive/issue_comments_123059.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd31\".",
    "created_at": "2011-06-13T20:15:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11377#issuecomment-123059",
    "user": "https://github.com/vbraun"
}
```

Changing keywords from "" to "sd31".



---

archive/issue_comments_123060.json:
```json
{
    "body": "It is up to date for 4.7.1.alpha2 already. The only possible problems could be with #9989 depending on which one is merged first and whether my suggested changes for it are accepted.",
    "created_at": "2011-06-13T21:29:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11377#issuecomment-123060",
    "user": "https://github.com/kiwifb"
}
```

It is up to date for 4.7.1.alpha2 already. The only possible problems could be with #9989 depending on which one is merged first and whether my suggested changes for it are accepted.



---

archive/issue_comments_123061.json:
```json
{
    "body": "The patch applies, but `sage.groups.perm_gps.partn_ref.*` don't use `SAGE_INC` and the `flint_depends`:\n\n```\n\n    Extension('sage.groups.perm_gps.partn_ref.automorphism_group_canonical_label',\n              sources = ['sage/groups/perm_gps/partn_ref/automorphism_group_canonical_label.pyx'],\n              libraries = ['gmp', 'flint'],\n              include_dirs = [SAGE_ROOT + '/local/include/FLINT/'],\n              extra_compile_args = ['-std=c99'],\n              depends = [SAGE_ROOT + \"/local/include/FLINT/flint.h\"]),\n```",
    "created_at": "2011-06-13T22:27:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11377#issuecomment-123061",
    "user": "https://github.com/vbraun"
}
```

The patch applies, but `sage.groups.perm_gps.partn_ref.*` don't use `SAGE_INC` and the `flint_depends`:

```

    Extension('sage.groups.perm_gps.partn_ref.automorphism_group_canonical_label',
              sources = ['sage/groups/perm_gps/partn_ref/automorphism_group_canonical_label.pyx'],
              libraries = ['gmp', 'flint'],
              include_dirs = [SAGE_ROOT + '/local/include/FLINT/'],
              extra_compile_args = ['-std=c99'],
              depends = [SAGE_ROOT + "/local/include/FLINT/flint.h"]),
```



---

archive/issue_comments_123062.json:
```json
{
    "body": "I thought I had taken care of that. My apologies it will take a few hours until I can take care of them.",
    "created_at": "2011-06-13T23:08:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11377#issuecomment-123062",
    "user": "https://github.com/kiwifb"
}
```

I thought I had taken care of that. My apologies it will take a few hours until I can take care of them.



---

archive/issue_comments_123063.json:
```json
{
    "body": "Attachment [trac_11377-extraflint-dependencies.patch](tarball://root/attachments/some-uuid/ticket11377/trac_11377-extraflint-dependencies.patch) by @kiwifb created at 2011-06-14 00:00:07\n\nI missed a number of flint dependencies in the original patch. Apply trac_11377-build_module_listpy.patchafter",
    "created_at": "2011-06-14T00:00:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11377#issuecomment-123063",
    "user": "https://github.com/kiwifb"
}
```

Attachment [trac_11377-extraflint-dependencies.patch](tarball://root/attachments/some-uuid/ticket11377/trac_11377-extraflint-dependencies.patch) by @kiwifb created at 2011-06-14 00:00:07

I missed a number of flint dependencies in the original patch. Apply trac_11377-build_module_listpy.patchafter



---

archive/issue_comments_123064.json:
```json
{
    "body": "It turns out I had missed another instance of flint in sage.set.disjoints.set. So the additional patch takes care of it. It was all done on top of alpha2, hopefully there is nothing wrecking it already in alpha3.",
    "created_at": "2011-06-14T00:04:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11377#issuecomment-123064",
    "user": "https://github.com/kiwifb"
}
```

It turns out I had missed another instance of flint in sage.set.disjoints.set. So the additional patch takes care of it. It was all done on top of alpha2, hopefully there is nothing wrecking it already in alpha3.



---

archive/issue_comments_123065.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-06-14T00:04:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11377#issuecomment-123065",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_123066.json:
```json
{
    "body": "In the last patch description the word after shouldn't have come last. It is applied after trac_11377-build_module_listpy.patch.",
    "created_at": "2011-06-14T00:06:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11377#issuecomment-123066",
    "user": "https://github.com/kiwifb"
}
```

In the last patch description the word after shouldn't have come last. It is applied after trac_11377-build_module_listpy.patch.



---

archive/issue_comments_123067.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-06-14T00:37:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11377#issuecomment-123067",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_123068.json:
```json
{
    "body": "Looks great!",
    "created_at": "2011-06-14T00:37:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11377#issuecomment-123068",
    "user": "https://github.com/vbraun"
}
```

Looks great!



---

archive/issue_comments_123069.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2011-06-14T20:07:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11377#issuecomment-123069",
    "user": "https://github.com/jdemeyer"
}
```

Changing priority from major to critical.



---

archive/issue_comments_123070.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-06-15T15:24:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11377#issuecomment-123070",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_029537.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-06-15T15:24:57Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11377",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11377#event-29537"
}
```



---

archive/issue_comments_123071.json:
```json
{
    "body": "Would have been nice if you'd cc'ed me ;-) (as I have introduced `SAGE_INC` :-) and always been interested in cleaning the whole mess up, not to mention tickets like #8664, #9914, or the \"final\" trouble with #4000 ...).\n\nRobert B. originally planned (about 14+ month ago, cf. e.g. #7987) to \"automate\" most of what's currently hand-coded in `module_list.py` (by Cython pragmas local to the modules' files), so I mostly made changes that affect only small parts.\n\nBtw, I may have missed something, but neither alpha4 (nor alpha3) have yet been announced; the `README.FIRST`s still state\n> *There is no point in testing it because the version can change any time.*",
    "created_at": "2011-06-18T16:49:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11377#issuecomment-123071",
    "user": "https://github.com/nexttime"
}
```

Would have been nice if you'd cc'ed me ;-) (as I have introduced `SAGE_INC` :-) and always been interested in cleaning the whole mess up, not to mention tickets like #8664, #9914, or the "final" trouble with #4000 ...).

Robert B. originally planned (about 14+ month ago, cf. e.g. #7987) to "automate" most of what's currently hand-coded in `module_list.py` (by Cython pragmas local to the modules' files), so I mostly made changes that affect only small parts.

Btw, I may have missed something, but neither alpha4 (nor alpha3) have yet been announced; the `README.FIRST`s still state
> *There is no point in testing it because the version can change any time.*



---

archive/issue_comments_123072.json:
```json
{
    "body": "Hi Robert,\n\nsorry I didn't know you had introduced it. I was vaguely aware of the existence of an effort like #7987 but didn't know the ticket or that a ticket was actually open.\n\nI must say my primary aim was the elimination of reference to SAGE_ROOT which is a pain for sage-on-gentoo. And of course once started I had to clean the whole thing, I have been waiting for some time with my clean up patch I can tell you. So I am glad it got reviewed positively and all.",
    "created_at": "2011-06-18T19:58:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11377#issuecomment-123072",
    "user": "https://github.com/kiwifb"
}
```

Hi Robert,

sorry I didn't know you had introduced it. I was vaguely aware of the existence of an effort like #7987 but didn't know the ticket or that a ticket was actually open.

I must say my primary aim was the elimination of reference to SAGE_ROOT which is a pain for sage-on-gentoo. And of course once started I had to clean the whole thing, I have been waiting for some time with my clean up patch I can tell you. So I am glad it got reviewed positively and all.



---

archive/issue_comments_123073.json:
```json
{
    "body": "Replying to [comment:15 fbissey]:\n> And of course once started I had to clean the whole thing, I have been waiting for some time with my clean up patch I can tell you. So I am glad it got reviewed positively and all.\n\n\nAnd above all *merged*! Making larger changes to `module_list.py` is some kind of Sisyphean task since many tickets (unrelated to the build system) frequently modify parts of it.\n\nReducing the need for the latter should IMHO be the next step, as it somewhat thwarts concurrent, modular development and maintainability.\n\nI've more than once spent days to figure out and remove useless dependencies (e.g. on libraries) last year, in some cases just to - not much later - see the effort being more or less in vain...",
    "created_at": "2011-06-18T21:39:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11377",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11377#issuecomment-123073",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:15 fbissey]:
> And of course once started I had to clean the whole thing, I have been waiting for some time with my clean up patch I can tell you. So I am glad it got reviewed positively and all.


And above all *merged*! Making larger changes to `module_list.py` is some kind of Sisyphean task since many tickets (unrelated to the build system) frequently modify parts of it.

Reducing the need for the latter should IMHO be the next step, as it somewhat thwarts concurrent, modular development and maintainability.

I've more than once spent days to figure out and remove useless dependencies (e.g. on libraries) last year, in some cases just to - not much later - see the effort being more or less in vain...
