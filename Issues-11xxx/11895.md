# Issue 11895: Make p-adic numbers unhashable

archive/issues_011723.json:
```json
{
    "assignees": [
        "https://github.com/roed314"
    ],
    "body": "Only fixed modulus p-adic numbers should be hashable, all others can not implement a reasonable hash function. Currently some of them do which can cause horrible bugs:\n\n```\nsage: @cached_function\n....: def is_one(x):\n....:     return x==1\n\nsage: R = Zp(3, 70)\nsage: is_one(R(1,1))\nTrue\nsage: is_one(R(2^64))\nTrue\nsage: R(2^64)\n1 + 2*3 + 2*3^2 + 3^3 + 3^4 + 2*3^5 + 3^7 + 2*3^8 + 3^10 + 2*3^11 + 2*3^13 + 3^14 + 2*3^16 + 3^18 + 3^19 + 2*3^20 + 3^21 + 3^23 + 2*3^25 + 3^26 + 2*3^27 + 2*3^28 + 3^29 + 2*3^30 + 2*3^31 + 2*3^34 + 2*3^35 + 2*3^36 + 3^37 + 3^38 + 3^39 + 3^40 + O(3^70)\n```\n\nThe problem here is that `==` has been changed so that two numbers are equal if they are equal to the least common precision. In this example, the two elements are equal to precision one and they have the same hash value (at least on my machine).\n\nThe proposal of this ticket is to make p-adics unhashable (but cacheable through #16316). The modifications required for this to work are almost always related to functions which implemented manual caching through dictionaries. The long list of dependencies is mostly about rewriting constructor functions to go through `UniqueFactory` or `CachedRepresentation` which gets unhashable elements right as of #16317. (I believe that these changes are valuable refactorings anyway.)\n\nI can imagine that some people will not like such a change. What are the alternatives?\n\n* Keep it the way it is. (I do not think that this is a good idea. If you do intensive p-adic computations then the birthday paradox will eventually hit you.)\n* Mark p-adics in a special way so their `==` is not used by `cached_method` and friends. (Not an option, because p-adics may be wrapped inside other objects which will still use their operator `==`.)\n* Change `==` for p-adics to say whether two numbers are \"really\" equal. (Bad idea. Say you are in a p-adic field. Some algorithm wants to know whether `x` is invertible and says `x==0`. Now this will be false for most `p`-adic zeros.)\n* Make `__hash__` return a constant. (This would work but will give horrible performance.)\n* \u2026?\n\nDepends on #11670\nDepends on #15897\nDepends on #15898\nDepends on #15956\nDepends on #16122\nDepends on #16124\nDepends on #16129\nDepends on #16250\nDepends on #16251\nDepends on #16316\nDepends on #16317\nDepends on #16318\nDepends on #16321\nDepends on #16339\nDepends on #16341\nDepends on #16342\n\nCC:  @roed314 @simon-king-jena\n\nKeywords: **hash, days71**\n\nBranch/Commit: **[u/saraedum/ticket/11895](https://github.com/sagemath/sagetrac-mirror/tree/u/saraedum/ticket/11895) @ [`42afa4d`](https://github.com/sagemath/sagetrac-mirror/commit/42afa4d47da18d38095cd54313731f856ae5f083)**\n\nWork Issues: **one pickle from the pickle jar does not unpickle correctly**\n\nStopgaps: **todo**\n\nComponent: **padics**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/11895_\n\n",
    "closed_at": "2016-03-26T12:05:14Z",
    "created_at": "2011-10-04T20:40:23Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/c%3A%20padics",
        "https://github.com/sagemath/sage/labels/invalid"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Make p-adic numbers unhashable",
    "type": "issue",
    "updated_at": "2016-03-26T12:05:14Z",
    "url": "https://github.com/sagemath/sage/issues/11895",
    "user": "https://github.com/mmasdeu"
}
```
Only fixed modulus p-adic numbers should be hashable, all others can not implement a reasonable hash function. Currently some of them do which can cause horrible bugs:

```
sage: @cached_function
....: def is_one(x):
....:     return x==1

sage: R = Zp(3, 70)
sage: is_one(R(1,1))
True
sage: is_one(R(2^64))
True
sage: R(2^64)
1 + 2*3 + 2*3^2 + 3^3 + 3^4 + 2*3^5 + 3^7 + 2*3^8 + 3^10 + 2*3^11 + 2*3^13 + 3^14 + 2*3^16 + 3^18 + 3^19 + 2*3^20 + 3^21 + 3^23 + 2*3^25 + 3^26 + 2*3^27 + 2*3^28 + 3^29 + 2*3^30 + 2*3^31 + 2*3^34 + 2*3^35 + 2*3^36 + 3^37 + 3^38 + 3^39 + 3^40 + O(3^70)
```

The problem here is that `==` has been changed so that two numbers are equal if they are equal to the least common precision. In this example, the two elements are equal to precision one and they have the same hash value (at least on my machine).

The proposal of this ticket is to make p-adics unhashable (but cacheable through #16316). The modifications required for this to work are almost always related to functions which implemented manual caching through dictionaries. The long list of dependencies is mostly about rewriting constructor functions to go through `UniqueFactory` or `CachedRepresentation` which gets unhashable elements right as of #16317. (I believe that these changes are valuable refactorings anyway.)

I can imagine that some people will not like such a change. What are the alternatives?

* Keep it the way it is. (I do not think that this is a good idea. If you do intensive p-adic computations then the birthday paradox will eventually hit you.)
* Mark p-adics in a special way so their `==` is not used by `cached_method` and friends. (Not an option, because p-adics may be wrapped inside other objects which will still use their operator `==`.)
* Change `==` for p-adics to say whether two numbers are "really" equal. (Bad idea. Say you are in a p-adic field. Some algorithm wants to know whether `x` is invertible and says `x==0`. Now this will be false for most `p`-adic zeros.)
* Make `__hash__` return a constant. (This would work but will give horrible performance.)
* â€¦?

Depends on #11670
Depends on #15897
Depends on #15898
Depends on #15956
Depends on #16122
Depends on #16124
Depends on #16129
Depends on #16250
Depends on #16251
Depends on #16316
Depends on #16317
Depends on #16318
Depends on #16321
Depends on #16339
Depends on #16341
Depends on #16342

CC:  @roed314 @simon-king-jena

Keywords: **hash, days71**

Branch/Commit: **[u/saraedum/ticket/11895](https://github.com/sagemath/sagetrac-mirror/tree/u/saraedum/ticket/11895) @ [`42afa4d`](https://github.com/sagemath/sagetrac-mirror/commit/42afa4d47da18d38095cd54313731f856ae5f083)**

Work Issues: **one pickle from the pickle jar does not unpickle correctly**

Stopgaps: **todo**

Component: **padics**

_Issue created by migration from https://trac.sagemath.org/ticket/11895_





---

archive/issue_events_158761.json:
```json
{
    "actor": "https://github.com/mmasdeu",
    "created_at": "2011-10-04T20:40:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11895#event-158761"
}
```



---

archive/issue_events_158762.json:
```json
{
    "actor": "https://github.com/mmasdeu",
    "created_at": "2011-10-04T20:40:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20padics",
    "label_color": "0000ff",
    "label_name": "c: padics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11895#event-158762"
}
```



---

archive/issue_events_158763.json:
```json
{
    "actor": "https://github.com/mmasdeu",
    "created_at": "2011-10-04T20:40:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20critical%20/%202",
    "label_color": "ff7700",
    "label_name": "p: critical / 2",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11895#event-158763"
}
```



---

archive/issue_events_158764.json:
```json
{
    "actor": "https://github.com/mmasdeu",
    "created_at": "2011-10-04T20:40:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11895#event-158764"
}
```



---

archive/issue_events_158765.json:
```json
{
    "actor": "https://github.com/mmasdeu",
    "created_at": "2011-10-04T20:40:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20padics",
    "label_color": "0000ff",
    "label_name": "c: padics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11895#event-158765"
}
```



---

archive/issue_events_158766.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2011-10-04T20:40:23Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "subject": "https://github.com/mmasdeu",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11895#event-158766"
}
```



---

archive/issue_comments_124899.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nApply 11895.patch",
    "created_at": "2011-11-08T06:11:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124899",
    "user": "https://github.com/roed314"
}
```

<div id="comment:1" align="right">comment:1</div>

Apply 11895.patch



---

archive/issue_comments_124900.json:
```json
{
    "body": "Attachment: **[11895.patch.gz](https://github.com/sagemath/sage/files/ticket11895/11895.patch.gz)**\n\nCreates a hash function for extension elements",
    "created_at": "2011-11-09T00:59:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124900",
    "user": "https://github.com/roed314"
}
```

Attachment: **[11895.patch.gz](https://github.com/sagemath/sage/files/ticket11895/11895.patch.gz)**

Creates a hash function for extension elements



---

archive/issue_events_158767.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2011-11-09T00:59:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11895#event-158767"
}
```



---

archive/issue_comments_124901.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nCan you clean up the formatting of the docstrings a bit? There's a general convention that long lines in docstrings (except doctests!) should be wrapped at 80 columns and trailing whitespace removed. Other than that this looks fine to me.",
    "created_at": "2012-03-10T11:34:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124901",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:3" align="right">comment:3</div>

Can you clean up the formatting of the docstrings a bit? There's a general convention that long lines in docstrings (except doctests!) should be wrapped at 80 columns and trailing whitespace removed. Other than that this looks fine to me.



---

archive/issue_comments_124902.json:
```json
{
    "body": "Work Issues: **whitespace, line wrapping in docstrings**",
    "created_at": "2012-03-26T18:22:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124902",
    "user": "https://github.com/loefflerd"
}
```

Work Issues: **whitespace, line wrapping in docstrings**



---

archive/issue_events_158768.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2012-03-26T18:22:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11895#event-158768"
}
```



---

archive/issue_events_158769.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2012-03-26T18:22:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11895#event-158769"
}
```



---

archive/issue_comments_124903.json:
```json
{
    "body": "Author: **David Roe**",
    "created_at": "2012-03-26T18:22:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124903",
    "user": "https://github.com/loefflerd"
}
```

Author: **David Roe**



---

archive/issue_comments_124904.json:
```json
{
    "body": "Reviewer: **David Loeffler**",
    "created_at": "2012-03-26T18:22:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124904",
    "user": "https://github.com/loefflerd"
}
```

Reviewer: **David Loeffler**



---

archive/issue_comments_124905.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nWhen trying the input:\n\n```\nsage: R.<x> = PolynomialRing(QQ)\nsage: Cp.<g> = Qp(7,100).extension(x^2-17)\nsage: ECp = EllipticCurve('14a1').change_ring(Cp)\nsage: xx = (6*g + 6) + 5*7 + (g + 3)*7^2 + (4*g + 1)*7^3 + (g + 5)*7^4 + (3*g + 3)*7^5 + 3*7^6 + (5*g + 2)*7^7 + (5*g + 6)*7^8 + 2*7^9 + 7^10 + 7^11 + 6*g*7^12 + (3*g + 2)*7^13 + (3*g + 2)*7^14 + 3*g*7^15 + 5*7^16 + (6*g + 3)*7^17 + 2*g*7^18 + (g + 6)*7^19 + 6*7^20 + (g + 6)*7^21 + 4*7^22 + (6*g + 6)*7^23 + (2*g + 4)*7^24 + (2*g + 6)*7^25 + 5*g*7^26 + (4*g + 1)*7^27 + (3*g + 1)*7^28 + (6*g + 4)*7^29 + (5*g + 5)*7^30 + (3*g + 6)*7^31 + 7^32 + (2*g + 3)*7^33 + (3*g + 5)*7^34 + (3*g + 2)*7^35 + (2*g + 1)*7^36 + g*7^37 + 6*g*7^38 + (5*g + 1)*7^39 + (2*g + 1)*7^40 + (3*g + 6)*7^41 + (4*g + 1)*7^42 + (3*g + 5)*7^43 + (5*g + 4)*7^44 + (4*g + 1)*7^45 + 3*7^46 + (2*g + 3)*7^47 + (5*g + 6)*7^48 + (5*g + 2)*7^49 + (g + 1)*7^50 + 5*g*7^51 + 3*7^52 + 2*7^53 + (5*g + 4)*7^54 + (3*g + 2)*7^55 + (4*g + 1)*7^56 + (6*g + 2)*7^57 + (6*g + 3)*7^58 + (3*g + 4)*7^60 + (4*g + 1)*7^61 + (2*g + 6)*7^63 + (3*g + 2)*7^64 + (4*g + 3)*7^65 + (g + 1)*7^66 + (2*g + 4)*7^68 + (2*g + 4)*7^69 + (5*g + 5)*7^70 + (5*g + 5)*7^71 + (3*g + 1)*7^72 + (3*g + 6)*7^73 + (2*g + 6)*7^74 + (4*g + 1)*7^75 + 5*7^76 + 2*g*7^77 + 3*g*7^78 + (5*g + 2)*7^79 + (5*g + 3)*7^80 + (2*g + 6)*7^81 + (3*g + 4)*7^82 + (5*g + 5)*7^83 + (2*g + 2)*7^84 + (g + 2)*7^85 + 6*7^86 + (2*g + 6)*7^87 + (2*g + 6)*7^88 + 3*g*7^89 + (5*g + 2)*7^90 + 3*g*7^91 + (2*g + 6)*7^92 + 7^93 + (2*g + 6)*7^94 + (4*g + 4)*7^95 + (4*g + 3)*7^96 + 3*7^97 + (g + 5)*7^98 + (5*g + 5)*7^99 + O(7^100)\nsage: yy = (5*g + 2) + (3*g + 1)*7 + (6*g + 1)*7^2 + 2*g*7^3 + 7^4 + (3*g + 6)*7^5 + 6*g*7^6 + (3*g + 4)*7^7 + (4*g + 4)*7^8 + 2*g*7^9 + (g + 1)*7^10 + (4*g + 2)*7^11 + (g + 4)*7^12 + (5*g + 2)*7^13 + (5*g + 3)*7^14 + (3*g + 6)*7^15 + (g + 1)*7^16 + (4*g + 3)*7^17 + (4*g + 2)*7^19 + (4*g + 5)*7^20 + (6*g + 4)*7^21 + (6*g + 1)*7^22 + (3*g + 1)*7^23 + 7^24 + (4*g + 2)*7^25 + (g + 6)*7^26 + (3*g + 3)*7^27 + 5*7^28 + (6*g + 6)*7^30 + (4*g + 4)*7^31 + (g + 4)*7^32 + (2*g + 2)*7^33 + (3*g + 6)*7^34 + (5*g + 4)*7^35 + (3*g + 5)*7^36 + (2*g + 6)*7^37 + (4*g + 5)*7^38 + 4*g*7^40 + (g + 5)*7^41 + (5*g + 2)*7^42 + (3*g + 1)*7^43 + 5*g*7^44 + (4*g + 6)*7^45 + (2*g + 2)*7^46 + (2*g + 3)*7^47 + (3*g + 5)*7^48 + 5*7^49 + (4*g + 2)*7^50 + (g + 6)*7^51 + (4*g + 6)*7^52 + (4*g + 1)*7^53 + 2*g*7^54 + (3*g + 1)*7^56 + (5*g + 6)*7^58 + (2*g + 2)*7^59 + 2*7^60 + 3*7^61 + (6*g + 6)*7^62 + (6*g + 4)*7^63 + (4*g + 3)*7^64 + (6*g + 3)*7^65 + (2*g + 6)*7^66 + (g + 2)*7^67 + 4*7^68 + (3*g + 2)*7^69 + (2*g + 3)*7^70 + (2*g + 2)*7^71 + (5*g + 5)*7^72 + (6*g + 3)*7^73 + 3*g*7^74 + 4*7^75 + (g + 5)*7^76 + (g + 3)*7^77 + (5*g + 4)*7^78 + 5*7^79 + 2*g*7^80 + 3*7^81 + 6*g*7^82 + (4*g + 2)*7^83 + (3*g + 5)*7^84 + (2*g + 4)*7^85 + 2*g*7^86 + (g + 2)*7^87 + (3*g + 4)*7^88 + (g + 4)*7^89 + 6*g*7^90 + 2*g*7^92 + (2*g + 1)*7^93 + (5*g + 3)*7^94 + (4*g + 3)*7^95 + (5*g + 3)*7^96 + (3*g + 1)*7^97 + (4*g + 4)*7^98 + 2*7^99 + O(7^100)\nsage: P = ECp([xx,yy])\nsage: print 2*P\n```\nI get the following error:\n\n```\n/data/sage-5.3.rc1/local/lib/python2.7/site-packages/sage/rings/padics/padic_ZZ_pX_CR_element.so in sage.rings.padics.padic_ZZ_pX_CR_element.pAdicZZpXCRElement.__hash__ (sage/rings/padics/padic_ZZ_pX_CR_element.cpp:16654)()\n\nOverflowError: Python int too large to convert to C long\n```",
    "created_at": "2012-09-13T14:40:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124905",
    "user": "https://github.com/mmasdeu"
}
```

<div id="comment:5" align="right">comment:5</div>

When trying the input:

```
sage: R.<x> = PolynomialRing(QQ)
sage: Cp.<g> = Qp(7,100).extension(x^2-17)
sage: ECp = EllipticCurve('14a1').change_ring(Cp)
sage: xx = (6*g + 6) + 5*7 + (g + 3)*7^2 + (4*g + 1)*7^3 + (g + 5)*7^4 + (3*g + 3)*7^5 + 3*7^6 + (5*g + 2)*7^7 + (5*g + 6)*7^8 + 2*7^9 + 7^10 + 7^11 + 6*g*7^12 + (3*g + 2)*7^13 + (3*g + 2)*7^14 + 3*g*7^15 + 5*7^16 + (6*g + 3)*7^17 + 2*g*7^18 + (g + 6)*7^19 + 6*7^20 + (g + 6)*7^21 + 4*7^22 + (6*g + 6)*7^23 + (2*g + 4)*7^24 + (2*g + 6)*7^25 + 5*g*7^26 + (4*g + 1)*7^27 + (3*g + 1)*7^28 + (6*g + 4)*7^29 + (5*g + 5)*7^30 + (3*g + 6)*7^31 + 7^32 + (2*g + 3)*7^33 + (3*g + 5)*7^34 + (3*g + 2)*7^35 + (2*g + 1)*7^36 + g*7^37 + 6*g*7^38 + (5*g + 1)*7^39 + (2*g + 1)*7^40 + (3*g + 6)*7^41 + (4*g + 1)*7^42 + (3*g + 5)*7^43 + (5*g + 4)*7^44 + (4*g + 1)*7^45 + 3*7^46 + (2*g + 3)*7^47 + (5*g + 6)*7^48 + (5*g + 2)*7^49 + (g + 1)*7^50 + 5*g*7^51 + 3*7^52 + 2*7^53 + (5*g + 4)*7^54 + (3*g + 2)*7^55 + (4*g + 1)*7^56 + (6*g + 2)*7^57 + (6*g + 3)*7^58 + (3*g + 4)*7^60 + (4*g + 1)*7^61 + (2*g + 6)*7^63 + (3*g + 2)*7^64 + (4*g + 3)*7^65 + (g + 1)*7^66 + (2*g + 4)*7^68 + (2*g + 4)*7^69 + (5*g + 5)*7^70 + (5*g + 5)*7^71 + (3*g + 1)*7^72 + (3*g + 6)*7^73 + (2*g + 6)*7^74 + (4*g + 1)*7^75 + 5*7^76 + 2*g*7^77 + 3*g*7^78 + (5*g + 2)*7^79 + (5*g + 3)*7^80 + (2*g + 6)*7^81 + (3*g + 4)*7^82 + (5*g + 5)*7^83 + (2*g + 2)*7^84 + (g + 2)*7^85 + 6*7^86 + (2*g + 6)*7^87 + (2*g + 6)*7^88 + 3*g*7^89 + (5*g + 2)*7^90 + 3*g*7^91 + (2*g + 6)*7^92 + 7^93 + (2*g + 6)*7^94 + (4*g + 4)*7^95 + (4*g + 3)*7^96 + 3*7^97 + (g + 5)*7^98 + (5*g + 5)*7^99 + O(7^100)
sage: yy = (5*g + 2) + (3*g + 1)*7 + (6*g + 1)*7^2 + 2*g*7^3 + 7^4 + (3*g + 6)*7^5 + 6*g*7^6 + (3*g + 4)*7^7 + (4*g + 4)*7^8 + 2*g*7^9 + (g + 1)*7^10 + (4*g + 2)*7^11 + (g + 4)*7^12 + (5*g + 2)*7^13 + (5*g + 3)*7^14 + (3*g + 6)*7^15 + (g + 1)*7^16 + (4*g + 3)*7^17 + (4*g + 2)*7^19 + (4*g + 5)*7^20 + (6*g + 4)*7^21 + (6*g + 1)*7^22 + (3*g + 1)*7^23 + 7^24 + (4*g + 2)*7^25 + (g + 6)*7^26 + (3*g + 3)*7^27 + 5*7^28 + (6*g + 6)*7^30 + (4*g + 4)*7^31 + (g + 4)*7^32 + (2*g + 2)*7^33 + (3*g + 6)*7^34 + (5*g + 4)*7^35 + (3*g + 5)*7^36 + (2*g + 6)*7^37 + (4*g + 5)*7^38 + 4*g*7^40 + (g + 5)*7^41 + (5*g + 2)*7^42 + (3*g + 1)*7^43 + 5*g*7^44 + (4*g + 6)*7^45 + (2*g + 2)*7^46 + (2*g + 3)*7^47 + (3*g + 5)*7^48 + 5*7^49 + (4*g + 2)*7^50 + (g + 6)*7^51 + (4*g + 6)*7^52 + (4*g + 1)*7^53 + 2*g*7^54 + (3*g + 1)*7^56 + (5*g + 6)*7^58 + (2*g + 2)*7^59 + 2*7^60 + 3*7^61 + (6*g + 6)*7^62 + (6*g + 4)*7^63 + (4*g + 3)*7^64 + (6*g + 3)*7^65 + (2*g + 6)*7^66 + (g + 2)*7^67 + 4*7^68 + (3*g + 2)*7^69 + (2*g + 3)*7^70 + (2*g + 2)*7^71 + (5*g + 5)*7^72 + (6*g + 3)*7^73 + 3*g*7^74 + 4*7^75 + (g + 5)*7^76 + (g + 3)*7^77 + (5*g + 4)*7^78 + 5*7^79 + 2*g*7^80 + 3*7^81 + 6*g*7^82 + (4*g + 2)*7^83 + (3*g + 5)*7^84 + (2*g + 4)*7^85 + 2*g*7^86 + (g + 2)*7^87 + (3*g + 4)*7^88 + (g + 4)*7^89 + 6*g*7^90 + 2*g*7^92 + (2*g + 1)*7^93 + (5*g + 3)*7^94 + (4*g + 3)*7^95 + (5*g + 3)*7^96 + (3*g + 1)*7^97 + (4*g + 4)*7^98 + 2*7^99 + O(7^100)
sage: P = ECp([xx,yy])
sage: print 2*P
```
I get the following error:

```
/data/sage-5.3.rc1/local/lib/python2.7/site-packages/sage/rings/padics/padic_ZZ_pX_CR_element.so in sage.rings.padics.padic_ZZ_pX_CR_element.pAdicZZpXCRElement.__hash__ (sage/rings/padics/padic_ZZ_pX_CR_element.cpp:16654)()

OverflowError: Python int too large to convert to C long
```



---

archive/issue_comments_124906.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nThree remarks:\n- It looks like the hash maximally only contain about 3 decimal digits of information. That's way too small! Hash table lookups are based on having `O(1)` elements in the bins. To give you an idea of how small the constant in the `O(1)` should be: Python's dictionaries make sure that the average bin size in 0.7 (smaller than 1). You're fighting the birthday paradox here, so don't underestimate the likelyhood of collisions. Anyway, when using more than 1000 elements in a dictionary, the proposed hash will let dictionaries just degrade to a linear search, but with way larger memory overhead.\n- It may seem that having hashes depend on precision (which isn't taken into account in equality testing!) is a mild condition, but it's not. If you have a large matrix or other aggregate element, you can easily end up with some small precision elements in there. This will lead to very confusing situation where a dict lookup doesn't find your key, but you know you have a key that's equal to a stored one. Of course, if you're relying on equality in p-adic computations you've already lost ...\n- Caching functions on equality of arguments is a very bad idea with the p-adics. If I construct a known invertible matrix to too low a precision, I'll get determinant 0. If subsequently I construct the same matrix to higher precision, a cached determinant function would recognize the argument as equal to one he'd seem before (because equality is only to lowest common precision) and would just give me the 0 back. \n\nProperties 2 and 3 conspire to hide the problem a bit:\n\n```\nsage: @cached_function\n....: def DISC(f):\n....:         return discriminant(f)\n....: \nsage: K=Qp(2,500)\nsage: P.<x>=K[]\nsage: f=(1+O(2^200))*x^2-(2^200+O(2^200))\nsage: DISC(f)\n0\nsage: g=(1+O(2^300))*x^2-(2^200+O(2^300))\nsage: DISC(g)\n2^202 + O(2^302)\nsage: \nsage: hash(f), hash(g)\n(15360174650385708, 15377766836429868)\nsage: f == g\nTrue\n```\nso the entry under f isn't found when looking up g because they end up being stored in different bins, so the difference in hash is enough to distinguish them. As soon as the dictionary gets resized in a way that lets those two hashes end up in the same bin, it'll be a toss-up which answer you get back from either `DISC(f)` or `DISC(g)`. Oh course, by then it will be very painful to track down what happened.\n\nTo show that functions that depend on more of their arguments than just equality should not be cached:\n\n```\nsage: a=3\nsage: b=GF(5)(3)\nsage: @cached_function\n....: def test(a):\n....:         return a^2\n....: \nsage: [test(a),test(b)]\n[9, 9]\nsage: test.clear_cache()\nsage: [test(b),test(a)]\n[4, 4]\n```",
    "created_at": "2012-09-13T15:58:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124906",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:6" align="right">comment:6</div>

Three remarks:
- It looks like the hash maximally only contain about 3 decimal digits of information. That's way too small! Hash table lookups are based on having `O(1)` elements in the bins. To give you an idea of how small the constant in the `O(1)` should be: Python's dictionaries make sure that the average bin size in 0.7 (smaller than 1). You're fighting the birthday paradox here, so don't underestimate the likelyhood of collisions. Anyway, when using more than 1000 elements in a dictionary, the proposed hash will let dictionaries just degrade to a linear search, but with way larger memory overhead.
- It may seem that having hashes depend on precision (which isn't taken into account in equality testing!) is a mild condition, but it's not. If you have a large matrix or other aggregate element, you can easily end up with some small precision elements in there. This will lead to very confusing situation where a dict lookup doesn't find your key, but you know you have a key that's equal to a stored one. Of course, if you're relying on equality in p-adic computations you've already lost ...
- Caching functions on equality of arguments is a very bad idea with the p-adics. If I construct a known invertible matrix to too low a precision, I'll get determinant 0. If subsequently I construct the same matrix to higher precision, a cached determinant function would recognize the argument as equal to one he'd seem before (because equality is only to lowest common precision) and would just give me the 0 back. 

Properties 2 and 3 conspire to hide the problem a bit:

```
sage: @cached_function
....: def DISC(f):
....:         return discriminant(f)
....: 
sage: K=Qp(2,500)
sage: P.<x>=K[]
sage: f=(1+O(2^200))*x^2-(2^200+O(2^200))
sage: DISC(f)
0
sage: g=(1+O(2^300))*x^2-(2^200+O(2^300))
sage: DISC(g)
2^202 + O(2^302)
sage: 
sage: hash(f), hash(g)
(15360174650385708, 15377766836429868)
sage: f == g
True
```
so the entry under f isn't found when looking up g because they end up being stored in different bins, so the difference in hash is enough to distinguish them. As soon as the dictionary gets resized in a way that lets those two hashes end up in the same bin, it'll be a toss-up which answer you get back from either `DISC(f)` or `DISC(g)`. Oh course, by then it will be very painful to track down what happened.

To show that functions that depend on more of their arguments than just equality should not be cached:

```
sage: a=3
sage: b=GF(5)(3)
sage: @cached_function
....: def test(a):
....:         return a^2
....: 
sage: [test(a),test(b)]
[9, 9]
sage: test.clear_cache()
sage: [test(b),test(a)]
[4, 4]
```



---

archive/issue_comments_124907.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nNils, I agree that there are some horrible compromises to be had on this issue.  I would like to make p-adic elements unhashable, but there are some nasty consequences of doing so.  We can't add points on elliptic curves over p-adic fields.  We can't print matrices.  Out of curiousity I tried changing the hash methods on elements of Zp and Qp to raise a `TypeError`.  Hundreds of doctest failures.  There's an assumption that elements are hashable throughout Sage.\n\nI don't know what the answer is.  If we can come to a consensus on this I'm happy to fix the whitespace issues.  :-)",
    "created_at": "2012-10-15T08:29:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124907",
    "user": "https://github.com/roed314"
}
```

<div id="comment:7" align="right">comment:7</div>

Nils, I agree that there are some horrible compromises to be had on this issue.  I would like to make p-adic elements unhashable, but there are some nasty consequences of doing so.  We can't add points on elliptic curves over p-adic fields.  We can't print matrices.  Out of curiousity I tried changing the hash methods on elements of Zp and Qp to raise a `TypeError`.  Hundreds of doctest failures.  There's an assumption that elements are hashable throughout Sage.

I don't know what the answer is.  If we can come to a consensus on this I'm happy to fix the whitespace issues.  :-)



---

archive/issue_comments_124908.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nI had a look into this. Except for one place (which could certainly be worked around somehow), the doctests seem to fail because caching doesn't work anymore. Would there be something wrong with adding a `_cache_key()` to `SageObject` which per default returns `self`. Only if the element is not hashable (but should be cacheable) it could return something that is actually a unique key for this element \u2014 something like `self.dumps()` maybe.\n\nI gave it a try (see attached patch). The only doctests that fail seem to be a few places where `self.dumps()` doesn't work and one problem in `sage/modular/overconvergent/weightspace.py`.",
    "created_at": "2012-10-16T18:07:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124908",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:8" align="right">comment:8</div>

I had a look into this. Except for one place (which could certainly be worked around somehow), the doctests seem to fail because caching doesn't work anymore. Would there be something wrong with adding a `_cache_key()` to `SageObject` which per default returns `self`. Only if the element is not hashable (but should be cacheable) it could return something that is actually a unique key for this element â€” something like `self.dumps()` maybe.

I gave it a try (see attached patch). The only doctests that fail seem to be a few places where `self.dumps()` doesn't work and one problem in `sage/modular/overconvergent/weightspace.py`.



---

archive/issue_comments_124909.json:
```json
{
    "body": "experimental patch to disable caching for padics",
    "created_at": "2012-10-16T18:08:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124909",
    "user": "https://github.com/saraedum"
}
```

experimental patch to disable caching for padics



---

archive/issue_events_158770.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:34:36Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11895#event-158770"
}
```



---

archive/issue_events_158771.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:34:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11895#event-158771"
}
```



---

archive/issue_comments_124910.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nAttachment: **[cache.patch.gz](https://github.com/sagemath/sage/files/ticket11895/cache.patch.gz)**",
    "created_at": "2013-08-13T15:34:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124910",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:9" align="right">comment:9</div>

Attachment: **[cache.patch.gz](https://github.com/sagemath/sage/files/ticket11895/cache.patch.gz)**



---

archive/issue_events_158772.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11895#event-158772"
}
```



---

archive/issue_events_158773.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11895#event-158773"
}
```



---

archive/issue_comments_124911.json:
```json
{
    "body": "Dependencies: **#15897**",
    "created_at": "2014-03-06T13:44:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124911",
    "user": "https://github.com/saraedum"
}
```

Dependencies: **#15897**



---

archive/issue_comments_124912.json:
```json
{
    "body": "Branch: **[u/saraedum/ticket/11895](https://github.com/sagemath/sagetrac-mirror/tree/u/saraedum/ticket/11895)**",
    "created_at": "2014-03-06T13:48:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124912",
    "user": "https://github.com/saraedum"
}
```

Branch: **[u/saraedum/ticket/11895](https://github.com/sagemath/sagetrac-mirror/tree/u/saraedum/ticket/11895)**



---

archive/issue_comments_124913.json:
```json
{
    "body": "Changed dependencies from **#15897** to **#15897, #15898**",
    "created_at": "2014-03-06T15:45:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124913",
    "user": "https://github.com/saraedum"
}
```

Changed dependencies from **#15897** to **#15897, #15898**



---

archive/issue_comments_124914.json:
```json
{
    "body": "Changed branch from **[u/saraedum/ticket/11895](https://github.com/sagemath/sagetrac-mirror/tree/u/saraedum/ticket/11895)** to none",
    "created_at": "2014-03-06T15:45:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124914",
    "user": "https://github.com/saraedum"
}
```

Changed branch from **[u/saraedum/ticket/11895](https://github.com/sagemath/sagetrac-mirror/tree/u/saraedum/ticket/11895)** to none



---

archive/issue_comments_124915.json:
```json
{
    "body": "Branch: **[u/saraedum/ticket/11895](https://github.com/sagemath/sagetrac-mirror/tree/u/saraedum/ticket/11895)**",
    "created_at": "2014-03-07T10:33:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124915",
    "user": "https://github.com/saraedum"
}
```

Branch: **[u/saraedum/ticket/11895](https://github.com/sagemath/sagetrac-mirror/tree/u/saraedum/ticket/11895)**



---

archive/issue_comments_124916.json:
```json
{
    "body": "<div id=\"comment:15\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/eb811aa1e013eb31560e4c10b961f3633248f0ec\"><code>eb811aa</code></a></td><td><code>Introduced _cache_key for sage objects</code></td></tr></table>\n",
    "created_at": "2014-03-15T23:30:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124916",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:15"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/eb811aa1e013eb31560e4c10b961f3633248f0ec"><code>eb811aa</code></a></td><td><code>Introduced _cache_key for sage objects</code></td></tr></table>




---

archive/issue_comments_124917.json:
```json
{
    "body": "Commit: **[`eb811aa`](https://github.com/sagemath/sagetrac-mirror/commit/eb811aa1e013eb31560e4c10b961f3633248f0ec)**",
    "created_at": "2014-03-15T23:30:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124917",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[`eb811aa`](https://github.com/sagemath/sagetrac-mirror/commit/eb811aa1e013eb31560e4c10b961f3633248f0ec)**



---

archive/issue_comments_124918.json:
```json
{
    "body": "<div id=\"comment:16\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ab5ef13ff20bf2e128b76826606950d2a9b1cf45\"><code>ab5ef13</code></a></td><td><code>Enable caching for non-hashable objects</code></td></tr></table>\n",
    "created_at": "2014-03-16T14:36:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124918",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:16"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ab5ef13ff20bf2e128b76826606950d2a9b1cf45"><code>ab5ef13</code></a></td><td><code>Enable caching for non-hashable objects</code></td></tr></table>




---

archive/issue_comments_124919.json:
```json
{
    "body": "Changed commit from **[`eb811aa`](https://github.com/sagemath/sagetrac-mirror/commit/eb811aa1e013eb31560e4c10b961f3633248f0ec)** to **[`ab5ef13`](https://github.com/sagemath/sagetrac-mirror/commit/ab5ef13ff20bf2e128b76826606950d2a9b1cf45)**",
    "created_at": "2014-03-16T14:36:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124919",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`eb811aa`](https://github.com/sagemath/sagetrac-mirror/commit/eb811aa1e013eb31560e4c10b961f3633248f0ec)** to **[`ab5ef13`](https://github.com/sagemath/sagetrac-mirror/commit/ab5ef13ff20bf2e128b76826606950d2a9b1cf45)**



---

archive/issue_comments_124920.json:
```json
{
    "body": "Changed dependencies from **#15897, #15898** to **#15897, #15898, #15956**",
    "created_at": "2014-03-16T22:33:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124920",
    "user": "https://github.com/saraedum"
}
```

Changed dependencies from **#15897, #15898** to **#15897, #15898, #15956**



---

archive/issue_comments_124921.json:
```json
{
    "body": "Changed commit from **[`ab5ef13`](https://github.com/sagemath/sagetrac-mirror/commit/ab5ef13ff20bf2e128b76826606950d2a9b1cf45)** to **[`aed468f`](https://github.com/sagemath/sagetrac-mirror/commit/aed468f0fcfe1a6c492b579f75d5d9db5db1917d)**",
    "created_at": "2014-03-16T22:34:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124921",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`ab5ef13`](https://github.com/sagemath/sagetrac-mirror/commit/ab5ef13ff20bf2e128b76826606950d2a9b1cf45)** to **[`aed468f`](https://github.com/sagemath/sagetrac-mirror/commit/aed468f0fcfe1a6c492b579f75d5d9db5db1917d)**



---

archive/issue_comments_124922.json:
```json
{
    "body": "<div id=\"comment:18\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4f376cf3f71098a7c78a25734379fd26f6c0647c\"><code>4f376cf</code></a></td><td><code>Fixed _test_one and _test_zero for unhashable elements of monoids</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/927c2ba5baacf6a63a1eaff913df8adfc8f99ca4\"><code>927c2ba</code></a></td><td><code>Made polynomials with unhashable coefficients unhashable</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/aed468f0fcfe1a6c492b579f75d5d9db5db1917d\"><code>aed468f</code></a></td><td><code>Enabled caching for unhashable objects in factories</code></td></tr></table>\n",
    "created_at": "2014-03-16T22:34:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124922",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:18"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4f376cf3f71098a7c78a25734379fd26f6c0647c"><code>4f376cf</code></a></td><td><code>Fixed _test_one and _test_zero for unhashable elements of monoids</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/927c2ba5baacf6a63a1eaff913df8adfc8f99ca4"><code>927c2ba</code></a></td><td><code>Made polynomials with unhashable coefficients unhashable</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/aed468f0fcfe1a6c492b579f75d5d9db5db1917d"><code>aed468f</code></a></td><td><code>Enabled caching for unhashable objects in factories</code></td></tr></table>




---

archive/issue_comments_124923.json:
```json
{
    "body": "Changed commit from **[`aed468f`](https://github.com/sagemath/sagetrac-mirror/commit/aed468f0fcfe1a6c492b579f75d5d9db5db1917d)** to **[`39c9c5f`](https://github.com/sagemath/sagetrac-mirror/commit/39c9c5f1cd76344db0727bcffaab6ad3b9ef1b94)**",
    "created_at": "2014-03-19T18:06:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124923",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`aed468f`](https://github.com/sagemath/sagetrac-mirror/commit/aed468f0fcfe1a6c492b579f75d5d9db5db1917d)** to **[`39c9c5f`](https://github.com/sagemath/sagetrac-mirror/commit/39c9c5f1cd76344db0727bcffaab6ad3b9ef1b94)**



---

archive/issue_comments_124924.json:
```json
{
    "body": "<div id=\"comment:19\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dba5677ceacb5531b6d1266e489412804c7f3934\"><code>dba5677</code></a></td><td><code>Use a UniqueFactory to cache instances of QuaternionAlgebra</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2453e37cd00d99e033cbab9e4343e0ee02e5fd6b\"><code>2453e37</code></a></td><td><code>Merge branch 'u/saraedum/ticket/15897' of git://trac.sagemath.org/sage into ticket/11895</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/55bf7be591e181fc7016a0422307881a8360c57f\"><code>55bf7be</code></a></td><td><code>Use a UniqueFactory to cache instances of DirichletGroup</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/40786c973965d22b7b44ea92163f637263f97d86\"><code>40786c9</code></a></td><td><code>Merge branch 'u/saraedum/ticket/15898' of git://trac.sagemath.org/sage into ticket/11895</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3a05a1aec6459e59f0b7069af4bc1100a71a9502\"><code>3a05a1a</code></a></td><td><code>Improved handling of unhashable keys in weak dictionary</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/468b5cc25a6ce6b46eafd858b36452f7d8718bdb\"><code>468b5cc</code></a></td><td><code>Merge branch 'u/saraedum/ticket/15956' of git://trac.sagemath.org/sage into ticket/11895</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d79e9ce24ed3b888283bb519a060d4896133639f\"><code>d79e9ce</code></a></td><td><code>Implemented _cache_key() for polynomials</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a3a192c7712cca5bba8f1d2a824b3587ab3cf12d\"><code>a3a192c</code></a></td><td><code>fixed a typo in CA_template.pxi</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/39c9c5f1cd76344db0727bcffaab6ad3b9ef1b94\"><code>39c9c5f</code></a></td><td><code>fixed a hashing doctest for fixed modulus p-adic elements</code></td></tr></table>\n",
    "created_at": "2014-03-19T18:06:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124924",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:19"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dba5677ceacb5531b6d1266e489412804c7f3934"><code>dba5677</code></a></td><td><code>Use a UniqueFactory to cache instances of QuaternionAlgebra</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2453e37cd00d99e033cbab9e4343e0ee02e5fd6b"><code>2453e37</code></a></td><td><code>Merge branch 'u/saraedum/ticket/15897' of git://trac.sagemath.org/sage into ticket/11895</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/55bf7be591e181fc7016a0422307881a8360c57f"><code>55bf7be</code></a></td><td><code>Use a UniqueFactory to cache instances of DirichletGroup</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/40786c973965d22b7b44ea92163f637263f97d86"><code>40786c9</code></a></td><td><code>Merge branch 'u/saraedum/ticket/15898' of git://trac.sagemath.org/sage into ticket/11895</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3a05a1aec6459e59f0b7069af4bc1100a71a9502"><code>3a05a1a</code></a></td><td><code>Improved handling of unhashable keys in weak dictionary</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/468b5cc25a6ce6b46eafd858b36452f7d8718bdb"><code>468b5cc</code></a></td><td><code>Merge branch 'u/saraedum/ticket/15956' of git://trac.sagemath.org/sage into ticket/11895</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d79e9ce24ed3b888283bb519a060d4896133639f"><code>d79e9ce</code></a></td><td><code>Implemented _cache_key() for polynomials</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a3a192c7712cca5bba8f1d2a824b3587ab3cf12d"><code>a3a192c</code></a></td><td><code>fixed a typo in CA_template.pxi</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/39c9c5f1cd76344db0727bcffaab6ad3b9ef1b94"><code>39c9c5f</code></a></td><td><code>fixed a hashing doctest for fixed modulus p-adic elements</code></td></tr></table>




---

archive/issue_comments_124925.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nIt seems that only two doctests fail now. Both are related to manually implemented caches. One for number fields the other one for division polynomials for elliptic curves.",
    "created_at": "2014-03-19T18:09:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124925",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:20" align="right">comment:20</div>

It seems that only two doctests fail now. Both are related to manually implemented caches. One for number fields the other one for division polynomials for elliptic curves.



---

archive/issue_comments_124926.json:
```json
{
    "body": "Changed dependencies from **#15897, #15898, #15956** to **#15897, #15898, #15956, #10448, #11670**",
    "created_at": "2014-03-19T18:09:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124926",
    "user": "https://github.com/saraedum"
}
```

Changed dependencies from **#15897, #15898, #15956** to **#15897, #15898, #15956, #10448, #11670**



---

archive/issue_comments_124927.json:
```json
{
    "body": "<div id=\"comment:21\"></div>\n\nBranch pushed to git repo; I updated commit sha1. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bdaaaffa4603355c0ef5afad8c43e42766c2dfcf\"><code>bdaaaff</code></a></td><td><code>Fixed a pickling doctest for QuaternionAlgebras</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/67ed0b7a73019e66adeaa036a79561c7412b9090\"><code>67ed0b7</code></a></td><td><code>Merge branch 'u/saraedum/ticket/15897' of git://trac.sagemath.org/sage into ticket/11895</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ebe6a39deb3382f9f4b1391e542018b6471c8de0\"><code>ebe6a39</code></a></td><td><code>Doctest to illustrate that caching of DirichletGroups works</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0521e977661e2e56da15e9cbcbbe6d68cb1809e7\"><code>0521e97</code></a></td><td><code>Doctest to illustrate that base_ring must be a part of the cache key created by the DirichletGroup factory</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3d01887fd988b6124cc3283c40f6929138e51659\"><code>3d01887</code></a></td><td><code>cleaned up docstring of DirichletGroup</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5210dd93350c22eff8b1ca468d717cbf035145cb\"><code>5210dd9</code></a></td><td><code>Merge branch 'u/saraedum/ticket/15898' of git://trac.sagemath.org/sage into ticket/11895</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/22e0a1036f021e881d65bd7bb6d444e9077dc767\"><code>22e0a10</code></a></td><td><code>Handle already merged tickets correctly when merging dependencies in the dev scripts.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/898294f3148ff84630e180922691098804f5b051\"><code>898294f</code></a></td><td><code>Merge branch 'u/saraedum/ticket/16124' of git://trac.sagemath.org/sage into ticket/11895</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d178cfb7084a2068dfbf47152cd9fc0a1bb81809\"><code>d178cfb</code></a></td><td><code>Properly escape {} in sagedev.push()</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/454727a95a28b9df29f08a8bb58760d9630854ec\"><code>454727a</code></a></td><td><code>Merge branch 'u/saraedum/ticket/16122' of git://trac.sagemath.org/sage into ticket/11895</code></td></tr></table>\n",
    "created_at": "2014-04-10T17:13:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124927",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21"></div>

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bdaaaffa4603355c0ef5afad8c43e42766c2dfcf"><code>bdaaaff</code></a></td><td><code>Fixed a pickling doctest for QuaternionAlgebras</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/67ed0b7a73019e66adeaa036a79561c7412b9090"><code>67ed0b7</code></a></td><td><code>Merge branch 'u/saraedum/ticket/15897' of git://trac.sagemath.org/sage into ticket/11895</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ebe6a39deb3382f9f4b1391e542018b6471c8de0"><code>ebe6a39</code></a></td><td><code>Doctest to illustrate that caching of DirichletGroups works</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0521e977661e2e56da15e9cbcbbe6d68cb1809e7"><code>0521e97</code></a></td><td><code>Doctest to illustrate that base_ring must be a part of the cache key created by the DirichletGroup factory</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3d01887fd988b6124cc3283c40f6929138e51659"><code>3d01887</code></a></td><td><code>cleaned up docstring of DirichletGroup</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5210dd93350c22eff8b1ca468d717cbf035145cb"><code>5210dd9</code></a></td><td><code>Merge branch 'u/saraedum/ticket/15898' of git://trac.sagemath.org/sage into ticket/11895</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/22e0a1036f021e881d65bd7bb6d444e9077dc767"><code>22e0a10</code></a></td><td><code>Handle already merged tickets correctly when merging dependencies in the dev scripts.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/898294f3148ff84630e180922691098804f5b051"><code>898294f</code></a></td><td><code>Merge branch 'u/saraedum/ticket/16124' of git://trac.sagemath.org/sage into ticket/11895</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d178cfb7084a2068dfbf47152cd9fc0a1bb81809"><code>d178cfb</code></a></td><td><code>Properly escape {} in sagedev.push()</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/454727a95a28b9df29f08a8bb58760d9630854ec"><code>454727a</code></a></td><td><code>Merge branch 'u/saraedum/ticket/16122' of git://trac.sagemath.org/sage into ticket/11895</code></td></tr></table>




---

archive/issue_comments_124928.json:
```json
{
    "body": "Changed commit from **[`39c9c5f`](https://github.com/sagemath/sagetrac-mirror/commit/39c9c5f1cd76344db0727bcffaab6ad3b9ef1b94)** to **[`454727a`](https://github.com/sagemath/sagetrac-mirror/commit/454727a95a28b9df29f08a8bb58760d9630854ec)**",
    "created_at": "2014-04-10T17:13:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124928",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`39c9c5f`](https://github.com/sagemath/sagetrac-mirror/commit/39c9c5f1cd76344db0727bcffaab6ad3b9ef1b94)** to **[`454727a`](https://github.com/sagemath/sagetrac-mirror/commit/454727a95a28b9df29f08a8bb58760d9630854ec)**



---

archive/issue_comments_124929.json:
```json
{
    "body": "Changed dependencies from **#15897, #15898, #15956, #10448, #11670** to **#15897, #15898, #15956, #16122, #16124**",
    "created_at": "2014-04-10T17:13:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124929",
    "user": "https://github.com/saraedum"
}
```

Changed dependencies from **#15897, #15898, #15956, #10448, #11670** to **#15897, #15898, #15956, #16122, #16124**



---

archive/issue_comments_124930.json:
```json
{
    "body": "Changed dependencies from **#15897, #15898, #15956, #16122, #16124** to **#15897, #15898, #15956, #16122, #16124, #16129**",
    "created_at": "2014-04-11T08:16:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124930",
    "user": "https://github.com/saraedum"
}
```

Changed dependencies from **#15897, #15898, #15956, #16122, #16124** to **#15897, #15898, #15956, #16122, #16124, #16129**



---

archive/issue_comments_124931.json:
```json
{
    "body": "<div id=\"comment:24\"></div>\n\nBranch pushed to git repo; I updated commit sha1. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f1cbe039cc9305bc898fbc01b7f138ced5db23eb\"><code>f1cbe03</code></a></td><td><code>Merge branch 'develop' into ticket/11670</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8e968244cb356aaa863eb6a3caff46c74d48f182\"><code>8e96824</code></a></td><td><code>Raise an error if the generator of a number field has not been specified.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9b4deffd7823cc4e71c6122b99615d765bd9d87f\"><code>9b4deff</code></a></td><td><code>Trac #11670: reviewer patch</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/28890aca8bf8c28c548f774b71e1f82cccb98da0\"><code>28890ac</code></a></td><td><code>Merge branch 'u/pbruin/11670-NumberField_unique' of git://trac.sagemath.org/sage into ticket/11895</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/53e19158e481fd862e6f6adbd2d3a099208ed678\"><code>53e1915</code></a></td><td><code>recursively unpack tuples in cachefung._cache_key</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ba6db3dec1974f56dfb3e32a09aa7e46abbd8390\"><code>ba6db3d</code></a></td><td><code>Made multivariate polynomials with unhashable coefficients unhashable</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/07e77d209b8b37b9aa89a9c228e0ded5bb8ff9f7\"><code>07e77d2</code></a></td><td><code>Implemented _cache_key for elliptic curves defined with (unhashable) p-adic coefficients</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ccd475a73f88f683d5f50ae797cc35dc53d838e0\"><code>ccd475a</code></a></td><td><code>use proper @cached_function in monsky_washnitzer</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7cf0eb4e1456eb69e304443cc907d5051cff6ebc\"><code>7cf0eb4</code></a></td><td><code>Rewrote part of ProjectiveSpace.resultant() to avoid a problem with unhashable p-adics</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/35894b53ce04d0ca8aa541ba2906b2bfb7837aec\"><code>35894b5</code></a></td><td><code>Fixed EltPair.__hash__ to make discover_action work for unhashable parents.</code></td></tr></table>\n",
    "created_at": "2014-04-12T00:08:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124931",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:24"></div>

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f1cbe039cc9305bc898fbc01b7f138ced5db23eb"><code>f1cbe03</code></a></td><td><code>Merge branch 'develop' into ticket/11670</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8e968244cb356aaa863eb6a3caff46c74d48f182"><code>8e96824</code></a></td><td><code>Raise an error if the generator of a number field has not been specified.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9b4deffd7823cc4e71c6122b99615d765bd9d87f"><code>9b4deff</code></a></td><td><code>Trac #11670: reviewer patch</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/28890aca8bf8c28c548f774b71e1f82cccb98da0"><code>28890ac</code></a></td><td><code>Merge branch 'u/pbruin/11670-NumberField_unique' of git://trac.sagemath.org/sage into ticket/11895</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/53e19158e481fd862e6f6adbd2d3a099208ed678"><code>53e1915</code></a></td><td><code>recursively unpack tuples in cachefung._cache_key</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ba6db3dec1974f56dfb3e32a09aa7e46abbd8390"><code>ba6db3d</code></a></td><td><code>Made multivariate polynomials with unhashable coefficients unhashable</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/07e77d209b8b37b9aa89a9c228e0ded5bb8ff9f7"><code>07e77d2</code></a></td><td><code>Implemented _cache_key for elliptic curves defined with (unhashable) p-adic coefficients</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ccd475a73f88f683d5f50ae797cc35dc53d838e0"><code>ccd475a</code></a></td><td><code>use proper @cached_function in monsky_washnitzer</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7cf0eb4e1456eb69e304443cc907d5051cff6ebc"><code>7cf0eb4</code></a></td><td><code>Rewrote part of ProjectiveSpace.resultant() to avoid a problem with unhashable p-adics</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/35894b53ce04d0ca8aa541ba2906b2bfb7837aec"><code>35894b5</code></a></td><td><code>Fixed EltPair.__hash__ to make discover_action work for unhashable parents.</code></td></tr></table>




---

archive/issue_comments_124932.json:
```json
{
    "body": "Changed commit from **[`454727a`](https://github.com/sagemath/sagetrac-mirror/commit/454727a95a28b9df29f08a8bb58760d9630854ec)** to **[`35894b5`](https://github.com/sagemath/sagetrac-mirror/commit/35894b53ce04d0ca8aa541ba2906b2bfb7837aec)**",
    "created_at": "2014-04-12T00:08:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124932",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`454727a`](https://github.com/sagemath/sagetrac-mirror/commit/454727a95a28b9df29f08a8bb58760d9630854ec)** to **[`35894b5`](https://github.com/sagemath/sagetrac-mirror/commit/35894b53ce04d0ca8aa541ba2906b2bfb7837aec)**



---

archive/issue_comments_124933.json:
```json
{
    "body": "Changed dependencies from **#15897, #15898, #15956, #16122, #16124, #16129** to **#11670, #15897, #15898, #15956, #16122, #16124, #16129**",
    "created_at": "2014-04-12T00:08:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124933",
    "user": "https://github.com/saraedum"
}
```

Changed dependencies from **#15897, #15898, #15956, #16122, #16124, #16129** to **#11670, #15897, #15898, #15956, #16122, #16124, #16129**



---

archive/issue_comments_124934.json:
```json
{
    "body": "<div id=\"comment:26\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1934ffa3950e97b927f1df7f3ac15b931af53c40\"><code>1934ffa</code></a></td><td><code>Fixed test cases for @weak_cached_function</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c26938c9f9f05b62f0f5a744eec34a886ae4c08b\"><code>c26938c</code></a></td><td><code>Fixed the doctest for EltPair's __hash__() to reflect the new behaviour.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d2cff6e0d937f0238fb7a2694608782dcf1f432c\"><code>d2cff6e</code></a></td><td><code>Some random changes to fix the remaining doctest bugs. Will start a new branch which contains some of these.</code></td></tr></table>\n",
    "created_at": "2014-04-25T09:39:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124934",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:26"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1934ffa3950e97b927f1df7f3ac15b931af53c40"><code>1934ffa</code></a></td><td><code>Fixed test cases for @weak_cached_function</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c26938c9f9f05b62f0f5a744eec34a886ae4c08b"><code>c26938c</code></a></td><td><code>Fixed the doctest for EltPair's __hash__() to reflect the new behaviour.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d2cff6e0d937f0238fb7a2694608782dcf1f432c"><code>d2cff6e</code></a></td><td><code>Some random changes to fix the remaining doctest bugs. Will start a new branch which contains some of these.</code></td></tr></table>




---

archive/issue_comments_124935.json:
```json
{
    "body": "Changed commit from **[`35894b5`](https://github.com/sagemath/sagetrac-mirror/commit/35894b53ce04d0ca8aa541ba2906b2bfb7837aec)** to **[`d2cff6e`](https://github.com/sagemath/sagetrac-mirror/commit/d2cff6e0d937f0238fb7a2694608782dcf1f432c)**",
    "created_at": "2014-04-25T09:39:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124935",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`35894b5`](https://github.com/sagemath/sagetrac-mirror/commit/35894b53ce04d0ca8aa541ba2906b2bfb7837aec)** to **[`d2cff6e`](https://github.com/sagemath/sagetrac-mirror/commit/d2cff6e0d937f0238fb7a2694608782dcf1f432c)**



---

archive/issue_comments_124936.json:
```json
{
    "body": "Changed dependencies from **#11670, #15897, #15898, #15956, #16122, #16124, #16129** to **#11670, #15897, #15898, #15956, #16122, #16124, #16129, #16250**",
    "created_at": "2014-04-27T13:37:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124936",
    "user": "https://github.com/saraedum"
}
```

Changed dependencies from **#11670, #15897, #15898, #15956, #16122, #16124, #16129** to **#11670, #15897, #15898, #15956, #16122, #16124, #16129, #16250**



---

archive/issue_comments_124937.json:
```json
{
    "body": "Changed dependencies from **#11670, #15897, #15898, #15956, #16122, #16124, #16129, #16250** to **#11670, #15897, #15898, #15956, #16122, #16124, #16129, #16250, #16251**",
    "created_at": "2014-04-27T13:55:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124937",
    "user": "https://github.com/saraedum"
}
```

Changed dependencies from **#11670, #15897, #15898, #15956, #16122, #16124, #16129, #16250** to **#11670, #15897, #15898, #15956, #16122, #16124, #16129, #16250, #16251**



---

archive/issue_events_158774.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:19:32Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11895#event-158774"
}
```



---

archive/issue_events_158775.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:19:32Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11895#event-158775"
}
```



---

archive/issue_comments_124938.json:
```json
{
    "body": "Changed dependencies from **#11670, #15897, #15898, #15956, #16122, #16124, #16129, #16250, #16251** to **#11670, #15897, #15898, #15956, #16122, #16124, #16129, #16250, #16251, #16316**",
    "created_at": "2014-05-09T23:01:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124938",
    "user": "https://github.com/saraedum"
}
```

Changed dependencies from **#11670, #15897, #15898, #15956, #16122, #16124, #16129, #16250, #16251** to **#11670, #15897, #15898, #15956, #16122, #16124, #16129, #16250, #16251, #16316**



---

archive/issue_comments_124939.json:
```json
{
    "body": "Changed dependencies from **#11670, #15897, #15898, #15956, #16122, #16124, #16129, #16250, #16251, #16316** to **#11670, #15897, #15898, #15956, #16122, #16124, #16129, #16250, #16251, #16316, #163177**",
    "created_at": "2014-05-09T23:17:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124939",
    "user": "https://github.com/saraedum"
}
```

Changed dependencies from **#11670, #15897, #15898, #15956, #16122, #16124, #16129, #16250, #16251, #16316** to **#11670, #15897, #15898, #15956, #16122, #16124, #16129, #16250, #16251, #16316, #163177**



---

archive/issue_comments_124940.json:
```json
{
    "body": "Changed dependencies from **#11670, #15897, #15898, #15956, #16122, #16124, #16129, #16250, #16251, #16316, #163177** to **#11670, #15897, #15898, #15956, #16122, #16124, #16129, #16250, #16251, #16316, #16317**",
    "created_at": "2014-05-09T23:17:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124940",
    "user": "https://github.com/saraedum"
}
```

Changed dependencies from **#11670, #15897, #15898, #15956, #16122, #16124, #16129, #16250, #16251, #16316, #163177** to **#11670, #15897, #15898, #15956, #16122, #16124, #16129, #16250, #16251, #16316, #16317**



---

archive/issue_comments_124941.json:
```json
{
    "body": "Changed dependencies from **#11670, #15897, #15898, #15956, #16122, #16124, #16129, #16250, #16251, #16316, #16317** to **#11670, #15897, #15898, #15956, #16122, #16124, #16129, #16250, #16251, #16316, #16317, #16318**",
    "created_at": "2014-05-09T23:50:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124941",
    "user": "https://github.com/saraedum"
}
```

Changed dependencies from **#11670, #15897, #15898, #15956, #16122, #16124, #16129, #16250, #16251, #16316, #16317** to **#11670, #15897, #15898, #15956, #16122, #16124, #16129, #16250, #16251, #16316, #16317, #16318**



---

archive/issue_comments_124942.json:
```json
{
    "body": "Changed dependencies from **#11670, #15897, #15898, #15956, #16122, #16124, #16129, #16250, #16251, #16316, #16317, #16318** to **#11670, #15897, #15898, #15956, #16122, #16124, #16129, #16250, #16251, #16316, #16317, #16318, #16321**",
    "created_at": "2014-05-11T23:48:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124942",
    "user": "https://github.com/saraedum"
}
```

Changed dependencies from **#11670, #15897, #15898, #15956, #16122, #16124, #16129, #16250, #16251, #16316, #16317, #16318** to **#11670, #15897, #15898, #15956, #16122, #16124, #16129, #16250, #16251, #16316, #16317, #16318, #16321**



---

archive/issue_comments_124943.json:
```json
{
    "body": "Changed dependencies from **#11670, #15897, #15898, #15956, #16122, #16124, #16129, #16250, #16251, #16316, #16317, #16318, #16321** to **#11670, #15897, #15898, #15956, #16122, #16124, #16129, #16250, #16251, #16316, #16317, #16318, #16321, #16339**",
    "created_at": "2014-05-12T20:45:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124943",
    "user": "https://github.com/saraedum"
}
```

Changed dependencies from **#11670, #15897, #15898, #15956, #16122, #16124, #16129, #16250, #16251, #16316, #16317, #16318, #16321** to **#11670, #15897, #15898, #15956, #16122, #16124, #16129, #16250, #16251, #16316, #16317, #16318, #16321, #16339**



---

archive/issue_comments_124944.json:
```json
{
    "body": "<div id=\"comment:36\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/94fcddbe05b38dd914b5afbcfc5fbfa14105a100\"><code>94fcddb</code></a></td><td><code>Merge branch 'u/saraedum/ticket/16337' of git://trac.sagemath.org/sage into ticket/15692</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/72fce8b2eea7a4e943fcf25cd705631ed62dcb92\"><code>72fce8b</code></a></td><td><code>Added a pickle parameter for @cached_method</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/07178496787dfa2e02b7bab8e32ca8e2971edaba\"><code>0717849</code></a></td><td><code>Enable pickling of the cache for groebner_basis()</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/561072f600616cc8801053853bcbe0e819c65a30\"><code>561072f</code></a></td><td><code>Merge branch 'u/saraedum/ticket/15692' of git://trac.sagemath.org/sage into ticket/16321</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c74f601d1c736495b632001f04b3c7f3b6823c71\"><code>c74f601</code></a></td><td><code>Fix incorrect usage of key parameter of @cached_method for ambient spaces of modular forms</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8f7ec6f69571f758fb001264cb00b9dce288e8d3\"><code>8f7ec6f</code></a></td><td><code>Merge branch 'u/saraedum/ticket/16321' of git://trac.sagemath.org/sage into ticket/11895</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/034ea7aeb2b45912c7223c6864ab3f82022e0661\"><code>034ea7a</code></a></td><td><code>HeckeAlgebra and HeckeAlgebra_anemic inherit from CachedRepresentation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fe5ad0a7138d0217de4eb9534ad7359393d1340d\"><code>fe5ad0a</code></a></td><td><code>HeckeAlgebra uses @cached_method where possible</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fddc853b27aaacd89d18ac1958742b343bb97ae7\"><code>fddc853</code></a></td><td><code>Fixed the expected output of an unstable eigenvalue test.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/42afa4d47da18d38095cd54313731f856ae5f083\"><code>42afa4d</code></a></td><td><code>Merge branch 'u/saraedum/ticket/16339' of git://trac.sagemath.org/sage into ticket/11895</code></td></tr></table>\n",
    "created_at": "2014-05-12T20:55:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124944",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:36"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/94fcddbe05b38dd914b5afbcfc5fbfa14105a100"><code>94fcddb</code></a></td><td><code>Merge branch 'u/saraedum/ticket/16337' of git://trac.sagemath.org/sage into ticket/15692</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/72fce8b2eea7a4e943fcf25cd705631ed62dcb92"><code>72fce8b</code></a></td><td><code>Added a pickle parameter for @cached_method</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/07178496787dfa2e02b7bab8e32ca8e2971edaba"><code>0717849</code></a></td><td><code>Enable pickling of the cache for groebner_basis()</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/561072f600616cc8801053853bcbe0e819c65a30"><code>561072f</code></a></td><td><code>Merge branch 'u/saraedum/ticket/15692' of git://trac.sagemath.org/sage into ticket/16321</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c74f601d1c736495b632001f04b3c7f3b6823c71"><code>c74f601</code></a></td><td><code>Fix incorrect usage of key parameter of @cached_method for ambient spaces of modular forms</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8f7ec6f69571f758fb001264cb00b9dce288e8d3"><code>8f7ec6f</code></a></td><td><code>Merge branch 'u/saraedum/ticket/16321' of git://trac.sagemath.org/sage into ticket/11895</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/034ea7aeb2b45912c7223c6864ab3f82022e0661"><code>034ea7a</code></a></td><td><code>HeckeAlgebra and HeckeAlgebra_anemic inherit from CachedRepresentation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fe5ad0a7138d0217de4eb9534ad7359393d1340d"><code>fe5ad0a</code></a></td><td><code>HeckeAlgebra uses @cached_method where possible</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fddc853b27aaacd89d18ac1958742b343bb97ae7"><code>fddc853</code></a></td><td><code>Fixed the expected output of an unstable eigenvalue test.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/42afa4d47da18d38095cd54313731f856ae5f083"><code>42afa4d</code></a></td><td><code>Merge branch 'u/saraedum/ticket/16339' of git://trac.sagemath.org/sage into ticket/11895</code></td></tr></table>




---

archive/issue_comments_124945.json:
```json
{
    "body": "Changed commit from **[`d2cff6e`](https://github.com/sagemath/sagetrac-mirror/commit/d2cff6e0d937f0238fb7a2694608782dcf1f432c)** to **[`42afa4d`](https://github.com/sagemath/sagetrac-mirror/commit/42afa4d47da18d38095cd54313731f856ae5f083)**",
    "created_at": "2014-05-12T20:55:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124945",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d2cff6e`](https://github.com/sagemath/sagetrac-mirror/commit/d2cff6e0d937f0238fb7a2694608782dcf1f432c)** to **[`42afa4d`](https://github.com/sagemath/sagetrac-mirror/commit/42afa4d47da18d38095cd54313731f856ae5f083)**



---

archive/issue_comments_124946.json:
```json
{
    "body": "Changed dependencies from **#11670, #15897, #15898, #15956, #16122, #16124, #16129, #16250, #16251, #16316, #16317, #16318, #16321, #16339** to **#11670, #15897, #15898, #15956, #16122, #16124, #16129, #16250, #16251, #16316, #16317, #16318, #16321, #16339, #16341**",
    "created_at": "2014-05-12T23:11:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124946",
    "user": "https://github.com/saraedum"
}
```

Changed dependencies from **#11670, #15897, #15898, #15956, #16122, #16124, #16129, #16250, #16251, #16316, #16317, #16318, #16321, #16339** to **#11670, #15897, #15898, #15956, #16122, #16124, #16129, #16250, #16251, #16316, #16317, #16318, #16321, #16339, #16341**



---

archive/issue_comments_124947.json:
```json
{
    "body": "Changed dependencies from **#11670, #15897, #15898, #15956, #16122, #16124, #16129, #16250, #16251, #16316, #16317, #16318, #16321, #16339, #16341** to **#11670, #15897, #15898, #15956, #16122, #16124, #16129, #16250, #16251, #16316, #16317, #16318, #16321, #16339, #16341, #16342**",
    "created_at": "2014-05-13T00:01:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124947",
    "user": "https://github.com/saraedum"
}
```

Changed dependencies from **#11670, #15897, #15898, #15956, #16122, #16124, #16129, #16250, #16251, #16316, #16317, #16318, #16321, #16339, #16341** to **#11670, #15897, #15898, #15956, #16122, #16124, #16129, #16250, #16251, #16316, #16317, #16318, #16321, #16339, #16341, #16342**



---

archive/issue_comments_124948.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nPlease update the ticket description to reflect what this ticket is now really about.",
    "created_at": "2014-05-13T11:41:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124948",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:39" align="right">comment:39</div>

Please update the ticket description to reflect what this ticket is now really about.



---

archive/issue_comments_124949.json:
```json
{
    "body": "Changed reviewer from **David Loeffler** to none",
    "created_at": "2014-05-13T13:13:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124949",
    "user": "https://github.com/saraedum"
}
```

Changed reviewer from **David Loeffler** to none



---

archive/issue_comments_124950.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,8 +1,27 @@\n-Extensions of p-adic numbers seem to be unhashable, and this becomes a problem when used in cached methods. For example, the following code raises a TypeError:\n+Only fixed modulus p-adic numbers should be hashable, all others can not implement a reasonable hash function. Currently some of them do which can cause horrible bugs:\n \n ```\n-sage: K.<a>=Qq(3^2)\n-sage: M=Matrix(K,1,1,1)\n-sage: print M\n+sage: @cached_function\n+....: def is_one(x):\n+....:     return x==1\n+\n+sage: R = Zp(3, 70)\n+sage: is_one(R(1,1))\n+True\n+sage: is_one(R(2^64))\n+True\n+sage: R(2^64)\n+1 + 2*3 + 2*3^2 + 3^3 + 3^4 + 2*3^5 + 3^7 + 2*3^8 + 3^10 + 2*3^11 + 2*3^13 + 3^14 + 2*3^16 + 3^18 + 3^19 + 2*3^20 + 3^21 + 3^23 + 2*3^25 + 3^26 + 2*3^27 + 2*3^28 + 3^29 + 2*3^30 + 2*3^31 + 2*3^34 + 2*3^35 + 2*3^36 + 3^37 + 3^38 + 3^39 + 3^40 + O(3^70)\n ```\n \n+The problem here is that `==` has been changed so that two numbers are equal if they are equal to the least common precision. In this example, the two elements are equal to precision one and they have the same hash value (at least on my machine).\n+\n+The proposal of this ticket is to make p-adics unhashable (but cacheable through #16316). The modifications required for this to work are almost always related to functions which implemented manual caching through dictionaries. The long list of dependencies is mostly about rewriting constructor functions to go through `UniqueFactory` or `CachedRepresentation` which gets unhashable elements right as of #16317. (I believe that these changes are valuable refactorings anyway.)\n+\n+I can imagine that some people will not like such a change. What are the alternatives?\n+\n+* Keep it the way it is. (I do not think that this is a good idea. If you do intensive p-adic computations then the birthday paradox will eventually hit you.)\n+* Mark p-adics in a special way so their `==` is not used by `cached_method` and friends. (Not an option, because p-adics may be wrapped inside other objects which will still use their operator `==`.)\n+* Change `==` for p-adics to say whether two numbers are \"really\" equal. (Bad idea. Say you are in a p-adic field. Some algorithm wants to know whether `x` is invertible and says `x==0`. Now this will be false for most `p`-adic zeros.)\n+* Make `__hash__` return a constant. (This would work but will give horrible performance.)\n+* \u2026?\n``````\n",
    "created_at": "2014-05-13T13:13:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124950",
    "user": "https://github.com/saraedum"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,8 +1,27 @@
-Extensions of p-adic numbers seem to be unhashable, and this becomes a problem when used in cached methods. For example, the following code raises a TypeError:
+Only fixed modulus p-adic numbers should be hashable, all others can not implement a reasonable hash function. Currently some of them do which can cause horrible bugs:
 
 ```
-sage: K.<a>=Qq(3^2)
-sage: M=Matrix(K,1,1,1)
-sage: print M
+sage: @cached_function
+....: def is_one(x):
+....:     return x==1
+
+sage: R = Zp(3, 70)
+sage: is_one(R(1,1))
+True
+sage: is_one(R(2^64))
+True
+sage: R(2^64)
+1 + 2*3 + 2*3^2 + 3^3 + 3^4 + 2*3^5 + 3^7 + 2*3^8 + 3^10 + 2*3^11 + 2*3^13 + 3^14 + 2*3^16 + 3^18 + 3^19 + 2*3^20 + 3^21 + 3^23 + 2*3^25 + 3^26 + 2*3^27 + 2*3^28 + 3^29 + 2*3^30 + 2*3^31 + 2*3^34 + 2*3^35 + 2*3^36 + 3^37 + 3^38 + 3^39 + 3^40 + O(3^70)
 ```
 
+The problem here is that `==` has been changed so that two numbers are equal if they are equal to the least common precision. In this example, the two elements are equal to precision one and they have the same hash value (at least on my machine).
+
+The proposal of this ticket is to make p-adics unhashable (but cacheable through #16316). The modifications required for this to work are almost always related to functions which implemented manual caching through dictionaries. The long list of dependencies is mostly about rewriting constructor functions to go through `UniqueFactory` or `CachedRepresentation` which gets unhashable elements right as of #16317. (I believe that these changes are valuable refactorings anyway.)
+
+I can imagine that some people will not like such a change. What are the alternatives?
+
+* Keep it the way it is. (I do not think that this is a good idea. If you do intensive p-adic computations then the birthday paradox will eventually hit you.)
+* Mark p-adics in a special way so their `==` is not used by `cached_method` and friends. (Not an option, because p-adics may be wrapped inside other objects which will still use their operator `==`.)
+* Change `==` for p-adics to say whether two numbers are "really" equal. (Bad idea. Say you are in a p-adic field. Some algorithm wants to know whether `x` is invertible and says `x==0`. Now this will be false for most `p`-adic zeros.)
+* Make `__hash__` return a constant. (This would work but will give horrible performance.)
+* â€¦?
``````




---

archive/issue_comments_124951.json:
```json
{
    "body": "Changed author from **David Roe** to none",
    "created_at": "2014-05-13T13:13:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124951",
    "user": "https://github.com/saraedum"
}
```

Changed author from **David Roe** to none



---

archive/issue_events_158776.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2014-05-13T13:13:08Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "title_is": "Make p-adic numbers unhashable",
    "title_was": "padic_ZZ_pX_CR_element is unhashable",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11895#event-158776"
}
```



---

archive/issue_comments_124952.json:
```json
{
    "body": "Changed work issues from **whitespace, line wrapping in docstrings** to **one pickle from the pickle jar does not unpickle correctly**",
    "created_at": "2014-05-13T13:13:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124952",
    "user": "https://github.com/saraedum"
}
```

Changed work issues from **whitespace, line wrapping in docstrings** to **one pickle from the pickle jar does not unpickle correctly**



---

archive/issue_comments_124953.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nAdded Simon since we talked about this in Bad Boll a while ago.",
    "created_at": "2014-05-13T13:14:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124953",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:41" align="right">comment:41</div>

Added Simon since we talked about this in Bad Boll a while ago.



---

archive/issue_events_158777.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11895#event-158777"
}
```



---

archive/issue_events_158778.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11895#event-158778"
}
```



---

archive/issue_comments_124954.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nThe ticket description mentions a problem when comparing `x==0`, but that is incorrect. Comparison first coerces both sides to a common parent, and if the rhs is a Python int then this will be the same padic ring as `x`. So if `==` were to compare both sides including the precision we'd still be fine. Of course when comparing two padics you coerce to the lower precision, so the main issue remains.\n\nJust making elements not hashable is also terrible, many algorithms use sets and dicts. E.g. if the coefficient field is not hashable then you can't compute groebner bases in polynomial rings, rendering it essentially useless.",
    "created_at": "2014-09-25T13:42:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124954",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:43" align="right">comment:43</div>

The ticket description mentions a problem when comparing `x==0`, but that is incorrect. Comparison first coerces both sides to a common parent, and if the rhs is a Python int then this will be the same padic ring as `x`. So if `==` were to compare both sides including the precision we'd still be fine. Of course when comparing two padics you coerce to the lower precision, so the main issue remains.

Just making elements not hashable is also terrible, many algorithms use sets and dicts. E.g. if the coefficient field is not hashable then you can't compute groebner bases in polynomial rings, rendering it essentially useless.



---

archive/issue_comments_124955.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nReplying to [@vbraun](#comment:43):\n> The ticket description mentions a problem when comparing `x==0`, but that is incorrect. Comparison first coerces both sides to a common parent, and if the rhs is a Python int then this will be the same padic ring as `x`. So if `==` were to compare both sides including the precision we'd still be fine. Of course when comparing two padics you coerce to the lower precision, so the main issue remains.\n\nI'm not sure I understand. Say you are in Qp with 2 digits of precision. Then 0 coerces to `O(p^2)`. Setting `x=O(p)` gives `x != 0` when including precisions in the comparison.\n\n> Just making elements not hashable is also terrible, many algorithms use sets and dicts. E.g. if the coefficient field is not hashable then you can't compute groebner bases in polynomial rings, rendering it essentially useless.\n\nI agree that disabling hashing has its drawbacks but I do not see an alternative. Judging from the doctests, not that many things break, actually. But I guess that some algorithms have to be modified to support unhashable elements if we want to use them with p-adic numbers.",
    "created_at": "2014-09-25T13:54:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124955",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:44" align="right">comment:44</div>

Replying to [@vbraun](#comment:43):
> The ticket description mentions a problem when comparing `x==0`, but that is incorrect. Comparison first coerces both sides to a common parent, and if the rhs is a Python int then this will be the same padic ring as `x`. So if `==` were to compare both sides including the precision we'd still be fine. Of course when comparing two padics you coerce to the lower precision, so the main issue remains.

I'm not sure I understand. Say you are in Qp with 2 digits of precision. Then 0 coerces to `O(p^2)`. Setting `x=O(p)` gives `x != 0` when including precisions in the comparison.

> Just making elements not hashable is also terrible, many algorithms use sets and dicts. E.g. if the coefficient field is not hashable then you can't compute groebner bases in polynomial rings, rendering it essentially useless.

I agree that disabling hashing has its drawbacks but I do not see an alternative. Judging from the doctests, not that many things break, actually. But I guess that some algorithms have to be modified to support unhashable elements if we want to use them with p-adic numbers.



---

archive/issue_comments_124956.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nReplying to [@saraedum](#comment:44):\n> I'm not sure I understand. Say you are in Qp with 2 digits of precision. Then 0 coerces to `O(p^2)`. Setting `x=O(p)` gives `x != 0` when including precisions in the comparison.\n\nOk, I hadn't thought about that. But IMHO thats more of an issue with having two separate and competing ways of specifying precision, one in the parent and one in the element:\n\n```\nsage: O(3).parent()(3)\n3 + O(3^21)\n```\n\n> I agree that disabling hashing has its drawbacks but I do not see an alternative.\n\nI don't have a good answer right now either, but it once again shows the importance of this issue. We need to fix our failure to adhere to Python's convention about comparison and hashes.",
    "created_at": "2014-09-25T14:05:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124956",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:45" align="right">comment:45</div>

Replying to [@saraedum](#comment:44):
> I'm not sure I understand. Say you are in Qp with 2 digits of precision. Then 0 coerces to `O(p^2)`. Setting `x=O(p)` gives `x != 0` when including precisions in the comparison.

Ok, I hadn't thought about that. But IMHO thats more of an issue with having two separate and competing ways of specifying precision, one in the parent and one in the element:

```
sage: O(3).parent()(3)
3 + O(3^21)
```

> I agree that disabling hashing has its drawbacks but I do not see an alternative.

I don't have a good answer right now either, but it once again shows the importance of this issue. We need to fix our failure to adhere to Python's convention about comparison and hashes.



---

archive/issue_comments_124957.json:
```json
{
    "body": "Stopgaps: **todo**",
    "created_at": "2015-08-25T16:09:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124957",
    "user": "https://github.com/sagetrac-jakobkroeker"
}
```

Stopgaps: **todo**



---

archive/issue_comments_124958.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nReplying to [@vbraun](#comment:45):\n> But IMHO thats more of an issue with having two separate and competing ways of specifying precision, one in the parent and one in the element\n\nIs it really about competing ways? I guess this happens because it is possible to specify precision in the element at all.\n\n> Replying to [@saraedum](#comment:44):\n> > I agree that disabling hashing has its drawbacks but I do not see an alternative.\n\n> I don't have a good answer right now either, but it once again shows the importance of this issue.\n> We need to fix our failure to adhere to Python's convention about comparison and hashes.\n\nThe problem is that sometimes you want `a==b` to mean, `a` is essentially the same as `b`, say in an algorithm that doese `while(x!=0)`, and sometimes to you want it to mean `a` is indistinguishable from `b`. The latter is maybe what you want in dictionary lookups. But not always, for example if you have a dict which maps powers of `x`, the variable in a polynomial ring, to whatever, then you probably do not care about the precision of the `1` coefficient.\nSo what I'm trying to say is that precision is tricky. Sure, many algorithms might just throw an exception if we disable hashing. But would they really work correctly otherwise? Whenever we make a dictionary lookup with elements with precision, it seems that we need to decide on a case by case basis which version of `==` would produce the right result. Throwing an exception and requiring people to explicitly specify what they want to happen seems to be a better solution IMO.",
    "created_at": "2015-08-25T20:00:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124958",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:47" align="right">comment:47</div>

Replying to [@vbraun](#comment:45):
> But IMHO thats more of an issue with having two separate and competing ways of specifying precision, one in the parent and one in the element

Is it really about competing ways? I guess this happens because it is possible to specify precision in the element at all.

> Replying to [@saraedum](#comment:44):
> > I agree that disabling hashing has its drawbacks but I do not see an alternative.

> I don't have a good answer right now either, but it once again shows the importance of this issue.
> We need to fix our failure to adhere to Python's convention about comparison and hashes.

The problem is that sometimes you want `a==b` to mean, `a` is essentially the same as `b`, say in an algorithm that doese `while(x!=0)`, and sometimes to you want it to mean `a` is indistinguishable from `b`. The latter is maybe what you want in dictionary lookups. But not always, for example if you have a dict which maps powers of `x`, the variable in a polynomial ring, to whatever, then you probably do not care about the precision of the `1` coefficient.
So what I'm trying to say is that precision is tricky. Sure, many algorithms might just throw an exception if we disable hashing. But would they really work correctly otherwise? Whenever we make a dictionary lookup with elements with precision, it seems that we need to decide on a case by case basis which version of `==` would produce the right result. Throwing an exception and requiring people to explicitly specify what they want to happen seems to be a better solution IMO.



---

archive/issue_events_158779.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2016-03-24T02:19:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11895#event-158779"
}
```



---

archive/issue_events_158780.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2016-03-24T02:19:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11895#event-158780"
}
```



---

archive/issue_events_158781.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2016-03-24T02:19:42Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11895#event-158781"
}
```



---

archive/issue_comments_124959.json:
```json
{
    "body": "Changed keywords from **hash** to **hash, days71**",
    "created_at": "2016-03-24T02:19:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124959",
    "user": "https://github.com/saraedum"
}
```

Changed keywords from **hash** to **hash, days71**



---

archive/issue_comments_124960.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nWe are abandoning this in favor of #20246.",
    "created_at": "2016-03-24T02:19:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11895#issuecomment-124960",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:48" align="right">comment:48</div>

We are abandoning this in favor of #20246.



---

archive/issue_events_158782.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-03-26T12:05:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11895#event-158782"
}
```



---

archive/issue_events_158783.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-03-26T12:05:14Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/11895",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11895#event-158783"
}
```
