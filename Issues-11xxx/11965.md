# Issue 11965: OS X 10.7 Lion: Error building sage.misc.darwin_utilities extension

archive/issues_011793.json:
```json
{
    "body": "Building the sage.misc.darwin_utilities fails on OS X 10.7.2 with gcc-4.2.1 (build 5658) using XCode 4.\n\n```\ndeep:sage wstein$ export MAKE=\"make -j1\"\ndeep:sage wstein$ sage -br\n\n----------------------------------------------------------\nsage: Building and installing modified Sage library files.\n\n\nInstalling c_lib\nscons: `install' is up to date.\nUpdating Cython code....\nTime to execute 0 commands: 0.0105319023132 seconds\nFinished compiling Cython code (time = 0.939815998077 seconds)\nrunning install\nrunning build\nrunning build_py\nrunning build_ext\nbuilding 'sage.misc.darwin_utilities' extension\ngcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 \n-Wall -Wstrict-prototypes -I/Users/wstein/sage/install/sage-4.7.3.alpha1/local/include -I/Users/wstein/sage/install/sage-4.7.3.alpha1/local/include/csage -I/Users/wstein/sage/install/sage-4.7.3.alpha1/devel/sage/sage/ext -I/Users/wstein/sage/install/sage-4.7.3.alpha1/local/include/python2.6 -c sage/misc/darwin_memory_usage.c -o build/temp.macosx-10.7-x86_64-2.6/sage/misc/darwin_memory_usage.o -w\nIn file included from sage/misc/darwin_memory_usage.c:4:\n/usr/include/mach/task_info.h:252: \nerror: expected specifier-qualifier-list before \u2018vm_extmod_statistics_data_t\u2019\nerror: command 'gcc' failed with exit status 1\nsage: There was an error installing modified sage library code.\n\n\n\ndeep:sage wstein$ gcc -v\nUsing built-in specs.\nTarget: i686-apple-darwin11\n...\ngcc version 4.2.1 (Based on Apple Inc. build 5658) (LLVM build 2335.15.00)\n```\n\nSee the #11881 metaticket for porting Sage to Lion.\n\nAssignee: drkirkby\n\nResolution: fixed\n\nAuthor: William Stein\n\nReviewer: Jeroen Demeyer\n\nMerged: sage-4.8.alpha2\n\nIssue created by migration from https://trac.sagemath.org/ticket/11965\n\n",
    "closed_at": "2011-11-14T21:50:45Z",
    "created_at": "2011-10-31T06:30:34Z",
    "labels": [
        "component: porting",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.8",
    "title": "OS X 10.7 Lion: Error building sage.misc.darwin_utilities extension",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11965",
    "user": "https://github.com/williamstein"
}
```
Building the sage.misc.darwin_utilities fails on OS X 10.7.2 with gcc-4.2.1 (build 5658) using XCode 4.

```
deep:sage wstein$ export MAKE="make -j1"
deep:sage wstein$ sage -br

----------------------------------------------------------
sage: Building and installing modified Sage library files.


Installing c_lib
scons: `install' is up to date.
Updating Cython code....
Time to execute 0 commands: 0.0105319023132 seconds
Finished compiling Cython code (time = 0.939815998077 seconds)
running install
running build
running build_py
running build_ext
building 'sage.misc.darwin_utilities' extension
gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 
-Wall -Wstrict-prototypes -I/Users/wstein/sage/install/sage-4.7.3.alpha1/local/include -I/Users/wstein/sage/install/sage-4.7.3.alpha1/local/include/csage -I/Users/wstein/sage/install/sage-4.7.3.alpha1/devel/sage/sage/ext -I/Users/wstein/sage/install/sage-4.7.3.alpha1/local/include/python2.6 -c sage/misc/darwin_memory_usage.c -o build/temp.macosx-10.7-x86_64-2.6/sage/misc/darwin_memory_usage.o -w
In file included from sage/misc/darwin_memory_usage.c:4:
/usr/include/mach/task_info.h:252: 
error: expected specifier-qualifier-list before ‘vm_extmod_statistics_data_t’
error: command 'gcc' failed with exit status 1
sage: There was an error installing modified sage library code.



deep:sage wstein$ gcc -v
Using built-in specs.
Target: i686-apple-darwin11
...
gcc version 4.2.1 (Based on Apple Inc. build 5658) (LLVM build 2335.15.00)
```

See the #11881 metaticket for porting Sage to Lion.

Assignee: drkirkby

Resolution: fixed

Author: William Stein

Reviewer: Jeroen Demeyer

Merged: sage-4.8.alpha2

Issue created by migration from https://trac.sagemath.org/ticket/11965





---

archive/issue_comments_170761.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -18,9 +18,11 @@\n running build_py\n running build_ext\n building 'sage.misc.darwin_utilities' extension\n-gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -Wstrict-prototypes -I/Users/wstein/sage/install/sage-4.7.3.alpha1/local/include -I/Users/wstein/sage/install/sage-4.7.3.alpha1/local/include/csage -I/Users/wstein/sage/install/sage-4.7.3.alpha1/devel/sage/sage/ext -I/Users/wstein/sage/install/sage-4.7.3.alpha1/local/include/python2.6 -c sage/misc/darwin_memory_usage.c -o build/temp.macosx-10.7-x86_64-2.6/sage/misc/darwin_memory_usage.o -w\n+gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 \n+-Wall -Wstrict-prototypes -I/Users/wstein/sage/install/sage-4.7.3.alpha1/local/include -I/Users/wstein/sage/install/sage-4.7.3.alpha1/local/include/csage -I/Users/wstein/sage/install/sage-4.7.3.alpha1/devel/sage/sage/ext -I/Users/wstein/sage/install/sage-4.7.3.alpha1/local/include/python2.6 -c sage/misc/darwin_memory_usage.c -o build/temp.macosx-10.7-x86_64-2.6/sage/misc/darwin_memory_usage.o -w\n In file included from sage/misc/darwin_memory_usage.c:4:\n-/usr/include/mach/task_info.h:252: error: expected specifier-qualifier-list before \u2018vm_extmod_statistics_data_t\u2019\n+/usr/include/mach/task_info.h:252: \n+error: expected specifier-qualifier-list before \u2018vm_extmod_statistics_data_t\u2019\n error: command 'gcc' failed with exit status 1\n sage: There was an error installing modified sage library code.\n \n``````\n",
    "created_at": "2011-10-31T06:31:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11965#issuecomment-170761",
    "user": "https://github.com/williamstein"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -18,9 +18,11 @@
 running build_py
 running build_ext
 building 'sage.misc.darwin_utilities' extension
-gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -Wstrict-prototypes -I/Users/wstein/sage/install/sage-4.7.3.alpha1/local/include -I/Users/wstein/sage/install/sage-4.7.3.alpha1/local/include/csage -I/Users/wstein/sage/install/sage-4.7.3.alpha1/devel/sage/sage/ext -I/Users/wstein/sage/install/sage-4.7.3.alpha1/local/include/python2.6 -c sage/misc/darwin_memory_usage.c -o build/temp.macosx-10.7-x86_64-2.6/sage/misc/darwin_memory_usage.o -w
+gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 
+-Wall -Wstrict-prototypes -I/Users/wstein/sage/install/sage-4.7.3.alpha1/local/include -I/Users/wstein/sage/install/sage-4.7.3.alpha1/local/include/csage -I/Users/wstein/sage/install/sage-4.7.3.alpha1/devel/sage/sage/ext -I/Users/wstein/sage/install/sage-4.7.3.alpha1/local/include/python2.6 -c sage/misc/darwin_memory_usage.c -o build/temp.macosx-10.7-x86_64-2.6/sage/misc/darwin_memory_usage.o -w
 In file included from sage/misc/darwin_memory_usage.c:4:
-/usr/include/mach/task_info.h:252: error: expected specifier-qualifier-list before ‘vm_extmod_statistics_data_t’
+/usr/include/mach/task_info.h:252: 
+error: expected specifier-qualifier-list before ‘vm_extmod_statistics_data_t’
 error: command 'gcc' failed with exit status 1
 sage: There was an error installing modified sage library code.
 
``````




---

archive/issue_comments_170762.json:
```json
{
    "body": "<a id='comment:2'></a>\nI got this module to build by simply commenting out the line that was importing something that is now not allowed.   With this one fix the Sage-4.7.3.alpha1 library builds!",
    "created_at": "2011-10-31T06:37:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11965#issuecomment-170762",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:2'></a>
I got this module to build by simply commenting out the line that was importing something that is now not allowed.   With this one fix the Sage-4.7.3.alpha1 library builds!



---

archive/issue_comments_170763.json:
```json
{
    "body": "<a id='comment:3'></a>\nIncidentally, getting rid of that #include does not break building on OS X 10.6, so it is likely safe.",
    "created_at": "2011-10-31T06:43:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11965#issuecomment-170763",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:3'></a>
Incidentally, getting rid of that #include does not break building on OS X 10.6, so it is likely safe.



---

archive/issue_comments_170764.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-10-31T06:44:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11965#issuecomment-170764",
    "user": "https://github.com/williamstein"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_170765.json:
```json
{
    "body": "<a id='comment:4'></a>\nAttachment [trac_11965.patch](tarball://root/attachments/some-uuid/ticket11965/trac_11965.patch) by @williamstein created at 2011-10-31 06:44:52",
    "created_at": "2011-10-31T06:44:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11965#issuecomment-170765",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:4'></a>
Attachment [trac_11965.patch](tarball://root/attachments/some-uuid/ticket11965/trac_11965.patch) by @williamstein created at 2011-10-31 06:44:52



---

archive/issue_comments_170766.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -34,3 +34,5 @@\n ...\n gcc version 4.2.1 (Based on Apple Inc. build 5658) (LLVM build 2335.15.00)\n ```\n+\n+See the #11881 metaticket for porting Sage to Lion.\n``````\n",
    "created_at": "2011-11-01T18:13:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11965#issuecomment-170766",
    "user": "https://github.com/williamstein"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -34,3 +34,5 @@
 ...
 gcc version 4.2.1 (Based on Apple Inc. build 5658) (LLVM build 2335.15.00)
 ```
+
+See the #11881 metaticket for porting Sage to Lion.
``````




---

archive/issue_comments_170767.json:
```json
{
    "body": "Milestone sage-4.7.3 deleted",
    "created_at": "2011-11-03T16:14:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11965#issuecomment-170767",
    "user": "https://github.com/jdemeyer"
}
```

Milestone sage-4.7.3 deleted



---

archive/issue_comments_170768.json:
```json
{
    "body": "Changing author from \"\" to \"William Stein\"",
    "created_at": "2011-11-10T13:31:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11965#issuecomment-170768",
    "user": "https://github.com/jdemeyer"
}
```

Changing author from "" to "William Stein"



---

archive/issue_events_037357.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-11-10T13:31:16Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11965",
    "milestone": "sage-4.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11965#event-37357"
}
```



---

archive/issue_events_037358.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-11-14T21:50:45Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11965",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11965#event-37358"
}
```



---

archive/issue_comments_170769.json:
```json
{
    "body": "<a id='comment:8'></a>\nWorks for me on OS X 10.4 PPC.  With William's claim that it also works on 10.6 and 10.7, I give it a positive_review.",
    "created_at": "2011-11-14T21:50:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11965#issuecomment-170769",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>
Works for me on OS X 10.4 PPC.  With William's claim that it also works on 10.6 and 10.7, I give it a positive_review.



---

archive/issue_comments_170770.json:
```json
{
    "body": "Changing merged from \"\" to \"sage-4.8.alpha2\"",
    "created_at": "2011-11-14T21:50:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11965#issuecomment-170770",
    "user": "https://github.com/jdemeyer"
}
```

Changing merged from "" to "sage-4.8.alpha2"



---

archive/issue_comments_170771.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-11-14T21:50:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11965#issuecomment-170771",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_170772.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Jeroen Demeyer\"",
    "created_at": "2011-11-14T21:50:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11965#issuecomment-170772",
    "user": "https://github.com/jdemeyer"
}
```

Changing reviewer from "" to "Jeroen Demeyer"
