# Issue 11660: docutils files not world-readable

archive/issues_011488.json:
```json
{
    "body": "Assignee: tbd\n\nThe new docutils spkg from #10166 has its `src` directory not world-readable which causes trouble when running Sage as a different user from the user which compiled Sage.  For example, the following fails from the notebook:\n\n```\nsage: EllipticCurve?\nIOError: [Errno 13] Permission denied: '/usr/local/sage/sage-4.7.1.rc0/local/lib/python2.6/site-packages/docutils/writers/html4css1/html4css1.css'\n```\n\nThis problem is not upstream, it was introduced in Sage.\n\nNew spkg simply changing the permission of the files inside the `src` directory of the spkg: [http://boxen.math.washington.edu/home/jdemeyer/spkg/docutils-0.7.p0.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/docutils-0.7.p0.spkg)\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/11660\n\n",
    "closed_at": "2011-08-09T16:52:50Z",
    "created_at": "2011-08-08T12:40:55Z",
    "labels": [
        "component: packages: standard",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7.1",
    "title": "docutils files not world-readable",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11660",
    "user": "https://github.com/jdemeyer"
}
```
Assignee: tbd

The new docutils spkg from #10166 has its `src` directory not world-readable which causes trouble when running Sage as a different user from the user which compiled Sage.  For example, the following fails from the notebook:

```
sage: EllipticCurve?
IOError: [Errno 13] Permission denied: '/usr/local/sage/sage-4.7.1.rc0/local/lib/python2.6/site-packages/docutils/writers/html4css1/html4css1.css'
```

This problem is not upstream, it was introduced in Sage.

New spkg simply changing the permission of the files inside the `src` directory of the spkg: [http://boxen.math.washington.edu/home/jdemeyer/spkg/docutils-0.7.p0.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/docutils-0.7.p0.spkg)


Issue created by migration from https://trac.sagemath.org/ticket/11660





---

archive/issue_comments_128126.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-08-08T12:59:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11660",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11660#issuecomment-128126",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_128127.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-08-08T13:20:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11660",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11660#issuecomment-128127",
    "user": "https://github.com/nexttime"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_128128.json:
```json
{
    "body": "I would have added a note to *Special Update/Build Instructions* (and tagged the new changeset to `docutils-0.7.p0`) though.",
    "created_at": "2011-08-08T13:20:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11660",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11660#issuecomment-128128",
    "user": "https://github.com/nexttime"
}
```

I would have added a note to *Special Update/Build Instructions* (and tagged the new changeset to `docutils-0.7.p0`) though.



---

archive/issue_comments_128129.json:
```json
{
    "body": "Ideally this should be done with chmod in the setup script. Eventually we will want to transition to a build system where upstream sources remain untouched in the src/ directory (which is why they're not under our revision control).",
    "created_at": "2011-08-08T13:23:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11660",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11660#issuecomment-128129",
    "user": "https://github.com/kini"
}
```

Ideally this should be done with chmod in the setup script. Eventually we will want to transition to a build system where upstream sources remain untouched in the src/ directory (which is why they're not under our revision control).



---

archive/issue_comments_128130.json:
```json
{
    "body": "Replying to [comment:3 kini]:\n> Ideally this should be done with chmod in the setup script. Eventually we will want to transition to a build system where upstream sources remain untouched in the src/ directory (which is why they're not under our revision control).\n\n\nYep, but it's not always clear if someone just extracted the upstream sources the wrong way.\n\nJeroen, did you report this upstream? (Apparently only some files had wrong permissions, so I assume they came indeed from upstream.)\n\nP.S.: Feel free to consider #11658 critical or a blocker; #11519 can be closed as a duplicate.",
    "created_at": "2011-08-08T13:30:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11660",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11660#issuecomment-128130",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:3 kini]:
> Ideally this should be done with chmod in the setup script. Eventually we will want to transition to a build system where upstream sources remain untouched in the src/ directory (which is why they're not under our revision control).


Yep, but it's not always clear if someone just extracted the upstream sources the wrong way.

Jeroen, did you report this upstream? (Apparently only some files had wrong permissions, so I assume they came indeed from upstream.)

P.S.: Feel free to consider #11658 critical or a blocker; #11519 can be closed as a duplicate.



---

archive/issue_comments_128131.json:
```json
{
    "body": "+1 for fixing this in the setup script and setting the source files to reasonable values after unpacking. I suggest the following:\n\n```sh\nchmod -R u+rwX,go+rX src\n```\nNote that the capital X sets executable permissions for directories and files with u+x ONLY. To make sure that we don't trip over a posix issue I tested it on skynet/mark2 and it works on solaris, too.",
    "created_at": "2011-08-08T14:30:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11660",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11660#issuecomment-128131",
    "user": "https://github.com/vbraun"
}
```

+1 for fixing this in the setup script and setting the source files to reasonable values after unpacking. I suggest the following:

```sh
chmod -R u+rwX,go+rX src
```
Note that the capital X sets executable permissions for directories and files with u+x ONLY. To make sure that we don't trip over a posix issue I tested it on skynet/mark2 and it works on solaris, too.



---

archive/issue_comments_128132.json:
```json
{
    "body": "Replying to [comment:5 vbraun]:\n> I suggest the following:\n\n{{{#!sh\nchmod -R u+rwX,go+rX src\n}}}\nI guess you meant\n\n```sh\nchmod -R u+rw,go+rX src\n```\nas `u+X` doesn't make much sense (though it could in principle happen that some file has execute permissions for the group or others but not the owner himself, but such should certainly be reported upstream).",
    "created_at": "2011-08-08T15:21:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11660",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11660#issuecomment-128132",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:5 vbraun]:
> I suggest the following:

{{{#!sh
chmod -R u+rwX,go+rX src
}}}
I guess you meant

```sh
chmod -R u+rw,go+rX src
```
as `u+X` doesn't make much sense (though it could in principle happen that some file has execute permissions for the group or others but not the owner himself, but such should certainly be reported upstream).



---

archive/issue_comments_128133.json:
```json
{
    "body": "Replying to [comment:5 vbraun]:\n> +1 for fixing this in the setup script and setting the source files to reasonable values after unpacking.\n\n\nThe problem with this is that it doesn't allow for special cases. Perhaps there are scenarios where unusual permissions make sense.",
    "created_at": "2011-08-08T15:50:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11660",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11660#issuecomment-128133",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:5 vbraun]:
> +1 for fixing this in the setup script and setting the source files to reasonable values after unpacking.


The problem with this is that it doesn't allow for special cases. Perhaps there are scenarios where unusual permissions make sense.



---

archive/issue_comments_128134.json:
```json
{
    "body": "1. The chmod command will only increase the permissions, so it can't break anything as long as upstream has at least a minimum of sanity\n   1. Any makefile that does **not** use `install` (with explicit permissions) to install files is broken, we just haven't triggered the bug yet.",
    "created_at": "2011-08-08T17:15:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11660",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11660#issuecomment-128134",
    "user": "https://github.com/vbraun"
}
```

1. The chmod command will only increase the permissions, so it can't break anything as long as upstream has at least a minimum of sanity
   1. Any makefile that does **not** use `install` (with explicit permissions) to install files is broken, we just haven't triggered the bug yet.



---

archive/issue_comments_128135.json:
```json
{
    "body": "Replying to [comment:8 vbraun]:\n> Any makefile that does **not** use `install` (with explicit permissions) to install files is broken, we just haven't triggered the bug yet.\n\n\nYou are probably right, but unfortunately we cannot fix every spkg to do this :-)",
    "created_at": "2011-08-08T19:38:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11660",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11660#issuecomment-128135",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:8 vbraun]:
> Any makefile that does **not** use `install` (with explicit permissions) to install files is broken, we just haven't triggered the bug yet.


You are probably right, but unfortunately we cannot fix every spkg to do this :-)



---

archive/issue_events_030617.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-08-09T16:52:50Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11660",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11660#event-30617"
}
```



---

archive/issue_comments_128136.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-08-09T16:52:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11660",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11660#issuecomment-128136",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_128137.json:
```json
{
    "body": "Replying to [comment:7 jdemeyer]:\n> Replying to [comment:5 vbraun]:\n> > +1 for fixing this in the setup script and setting the source files to reasonable values after unpacking.\n\n> \n> The problem with this is that it doesn't allow for special cases. Perhaps there are scenarios where unusual permissions make sense. \n\n\nSure. When I said \"the setup script\" I meant the spkg-install script in an individual SPKG. So those scenarios could be handled on an individual basis.",
    "created_at": "2011-08-10T08:02:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11660",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11660#issuecomment-128137",
    "user": "https://github.com/kini"
}
```

Replying to [comment:7 jdemeyer]:
> Replying to [comment:5 vbraun]:
> > +1 for fixing this in the setup script and setting the source files to reasonable values after unpacking.

> 
> The problem with this is that it doesn't allow for special cases. Perhaps there are scenarios where unusual permissions make sense. 


Sure. When I said "the setup script" I meant the spkg-install script in an individual SPKG. So those scenarios could be handled on an individual basis.
