# Issue 11800: Problem with points at infinity in hyperelliptic curves

archive/issues_011628.json:
```json
{
    "assignees": [],
    "body": "The function that lists the points on a hyperelliptic curve assumes that the point [0, 1, 0] is always valid. This is wrong and creates the following bug:\n\n```\nsage: R.<x> = GF(7)[]\nsage: H = HyperellipticCurve(3*x^2 + 5*x + 1)\nsage: H.points()\n...\nTypeError: Coordinates [0, 1, 0] do not define a point on Hyperelliptic Curve over Finite Field of size 7 defined by y^2 = 3*x^2 + 5*x + 1\n```\n\nApply\n* [attachment:trac_11800_allow_conics.patch](https://github.com/sagemath/sage/files/ticket11800/trac_11800_allow_conics.patch)\n* [attachment:11800-reviewer.patch](https://github.com/sagemath/sage/files/ticket11800/11800-reviewer.patch)\n\n**Assignee:** @aghitza\n\n**CC:**  nestibal jpflori\n\n**Keywords:** ecc2011, sd35, hyperelliptic curve, conic\n\n**Reviewer:** Marco Streng\n\n**Author:** David Eklund\n\n**Merged:** sage-5.0.beta11\n\nIssue created by migration from https://trac.sagemath.org/ticket/11800\n\n",
    "closed_at": "2012-03-28T10:03:54Z",
    "created_at": "2011-09-14T13:41:21Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20algebraic%20geometry",
        "https://github.com/sagemath/sage/labels/minor",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Problem with points at infinity in hyperelliptic curves",
    "type": "issue",
    "updated_at": "2013-08-28T12:41:09Z",
    "url": "https://github.com/sagemath/sage/issues/11800",
    "user": "https://github.com/sagetrac-gaudry"
}
```
The function that lists the points on a hyperelliptic curve assumes that the point [0, 1, 0] is always valid. This is wrong and creates the following bug:

```
sage: R.<x> = GF(7)[]
sage: H = HyperellipticCurve(3*x^2 + 5*x + 1)
sage: H.points()
...
TypeError: Coordinates [0, 1, 0] do not define a point on Hyperelliptic Curve over Finite Field of size 7 defined by y^2 = 3*x^2 + 5*x + 1
```

Apply
* [attachment:trac_11800_allow_conics.patch](https://github.com/sagemath/sage/files/ticket11800/trac_11800_allow_conics.patch)
* [attachment:11800-reviewer.patch](https://github.com/sagemath/sage/files/ticket11800/11800-reviewer.patch)

**Assignee:** @aghitza

**CC:**  nestibal jpflori

**Keywords:** ecc2011, sd35, hyperelliptic curve, conic

**Reviewer:** Marco Streng

**Author:** David Eklund

**Merged:** sage-5.0.beta11

Issue created by migration from https://trac.sagemath.org/ticket/11800





---

archive/issue_events_133885.json:
```json
{
    "actor": "https://github.com/sagetrac-gaudry",
    "created_at": "2011-09-14T13:41:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "milestone_number": null,
    "milestone_title": "sage-5.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11800#event-133885"
}
```



---

archive/issue_events_133886.json:
```json
{
    "actor": "https://github.com/sagetrac-gaudry",
    "created_at": "2011-09-14T13:41:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20algebraic%20geometry",
    "label_color": "08517b",
    "label_name": "component: algebraic geometry",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11800#event-133886"
}
```



---

archive/issue_events_133887.json:
```json
{
    "actor": "https://github.com/sagetrac-gaudry",
    "created_at": "2011-09-14T13:41:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "label": "https://github.com/sagemath/sage/labels/minor",
    "label_color": "ff0000",
    "label_name": "minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11800#event-133887"
}
```



---

archive/issue_events_133888.json:
```json
{
    "actor": "https://github.com/sagetrac-gaudry",
    "created_at": "2011-09-14T13:41:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "008080",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11800#event-133888"
}
```



---

archive/issue_comments_125478.json:
```json
{
    "body": "<a id='comment:1'></a>\nThe *Author(s)* field refers to authors of attached code, e.g. patches fixing a bug, not (necessarily the same as) those who opened a ticket.\n\nIn short, if there's no code, the *Author(s)* field should be empty.",
    "created_at": "2011-09-14T17:32:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11800#issuecomment-125478",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:1'></a>
The *Author(s)* field refers to authors of attached code, e.g. patches fixing a bug, not (necessarily the same as) those who opened a ticket.

In short, if there's no code, the *Author(s)* field should be empty.



---

archive/issue_comments_125479.json:
```json
{
    "body": "**Changing author** from \"Pierrick Gaudry, Paul Zimmermann\" to \"\".",
    "created_at": "2011-09-15T10:00:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11800#issuecomment-125479",
    "user": "https://github.com/zimmermann6"
}
```

**Changing author** from "Pierrick Gaudry, Paul Zimmermann" to "".



---

archive/issue_comments_125480.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"ecc2011\".",
    "created_at": "2011-09-16T12:33:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11800#issuecomment-125480",
    "user": "https://github.com/zimmermann6"
}
```

**Changing keywords** from "" to "ecc2011".



---

archive/issue_comments_125481.json:
```json
{
    "body": "The patch bans defining polynomials of degree two for hyperelliptic curves, and corrects two typos.",
    "created_at": "2011-12-17T12:46:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11800#issuecomment-125481",
    "user": "https://github.com/sagetrac-davideklund"
}
```

The patch bans defining polynomials of degree two for hyperelliptic curves, and corrects two typos.



---

archive/issue_events_133889.json:
```json
{
    "actor": "https://github.com/sagetrac-davideklund",
    "created_at": "2011-12-17T12:59:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11800#event-133889"
}
```



---

archive/issue_comments_125482.json:
```json
{
    "body": "<a id='comment:5'></a>\n**Attachment:** [trac_11800_ban_degree_two.patch.gz](https://github.com/sagemath/sage/files/ticket11800/trac_11800_ban_degree_two.patch.gz)\n\nThe problem arises exactly when `F=y^2+h*y-f` has degree 2. But then F defines a conic! Even though the definition of hyperelliptic curve seems to vary (sometimes requiring genus > 1 and sometimes including the genus 1 case) I think that the case where `y^2+h*y-f` has degree 2 should raise an error since it is rather confusing to call a rational curve hyperelliptic. Banning this case also seems to get rid of some additional weirdness such as for example the TypeError when `h=0` and `f=x+1`.\n\nAs far as I can tell, it is not checked at the moment whether the curve defined by `y^2+h*y-f` has any singularities away from infinity, or whether it is irreducible or reduced.",
    "created_at": "2011-12-17T12:59:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11800#issuecomment-125482",
    "user": "https://github.com/sagetrac-davideklund"
}
```

<a id='comment:5'></a>
**Attachment:** [trac_11800_ban_degree_two.patch.gz](https://github.com/sagemath/sage/files/ticket11800/trac_11800_ban_degree_two.patch.gz)

The problem arises exactly when `F=y^2+h*y-f` has degree 2. But then F defines a conic! Even though the definition of hyperelliptic curve seems to vary (sometimes requiring genus > 1 and sometimes including the genus 1 case) I think that the case where `y^2+h*y-f` has degree 2 should raise an error since it is rather confusing to call a rational curve hyperelliptic. Banning this case also seems to get rid of some additional weirdness such as for example the TypeError when `h=0` and `f=x+1`.

As far as I can tell, it is not checked at the moment whether the curve defined by `y^2+h*y-f` has any singularities away from infinity, or whether it is irreducible or reduced.



---

archive/issue_comments_125483.json:
```json
{
    "body": "**Author:** David Eklund",
    "created_at": "2011-12-17T12:59:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11800#issuecomment-125483",
    "user": "https://github.com/sagetrac-davideklund"
}
```

**Author:** David Eklund



---

archive/issue_comments_125484.json:
```json
{
    "body": "**Work Issues:** rebase",
    "created_at": "2011-12-18T22:09:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11800#issuecomment-125484",
    "user": "https://github.com/mstreng"
}
```

**Work Issues:** rebase



---

archive/issue_comments_125485.json:
```json
{
    "body": "<a id='comment:7'></a>\nA big rewrite of the hyperelliptic curve constructor has happened at #11930 and is not completely compatible with the patch here. It is easy to rebase the current patch to apply after #11930, but not the other way around. I'll upload a rebase.",
    "created_at": "2011-12-18T22:09:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11800#issuecomment-125485",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:7'></a>
A big rewrite of the hyperelliptic curve constructor has happened at #11930 and is not completely compatible with the patch here. It is easy to rebase the current patch to apply after #11930, but not the other way around. I'll upload a rebase.



---

archive/issue_comments_125486.json:
```json
{
    "body": "**Dependencies:** #11930",
    "created_at": "2011-12-18T22:09:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11800#issuecomment-125486",
    "user": "https://github.com/mstreng"
}
```

**Dependencies:** #11930



---

archive/issue_comments_125487.json:
```json
{
    "body": "**Attachment:** [11800.patch.gz](https://github.com/sagemath/sage/files/ticket11800/11800.patch.gz)\n\nrebase to apply after #11930",
    "created_at": "2011-12-18T22:09:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11800#issuecomment-125487",
    "user": "https://github.com/mstreng"
}
```

**Attachment:** [11800.patch.gz](https://github.com/sagemath/sage/files/ticket11800/11800.patch.gz)

rebase to apply after #11930



---

archive/issue_comments_125488.json:
```json
{
    "body": "<a id='comment:8'></a>\napply [attachment:11800.patch](https://github.com/sagemath/sage/files/ticket11800/11800.patch)",
    "created_at": "2011-12-18T22:10:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11800#issuecomment-125488",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:8'></a>
apply [attachment:11800.patch](https://github.com/sagemath/sage/files/ticket11800/11800.patch)



---

archive/issue_comments_125489.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -7,3 +7,5 @@\n ...\n TypeError: Coordinates [0, 1, 0] do not define a point on Hyperelliptic Curve over Finite Field of size 67 defined by y^2 = 24*x^2 + 33*x + 43\n ```\n+\n+Apply [attachment:11800.patch](https://github.com/sagemath/sage/files/ticket11800/11800.patch)\n``````\n",
    "created_at": "2011-12-18T22:10:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11800#issuecomment-125489",
    "user": "https://github.com/mstreng"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -7,3 +7,5 @@
 ...
 TypeError: Coordinates [0, 1, 0] do not define a point on Hyperelliptic Curve over Finite Field of size 67 defined by y^2 = 24*x^2 + 33*x + 43
 ```
+
+Apply [attachment:11800.patch](https://github.com/sagemath/sage/files/ticket11800/11800.patch)
``````




---

archive/issue_comments_125490.json:
```json
{
    "body": "**Changing work issues** from \"rebase\" to \"\".",
    "created_at": "2011-12-18T22:10:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11800#issuecomment-125490",
    "user": "https://github.com/mstreng"
}
```

**Changing work issues** from "rebase" to "".



---

archive/issue_comments_125491.json:
```json
{
    "body": "**Changing keywords** from \"ecc2011\" to \"ecc2011, sd35, hyperelliptic curve, conic\".",
    "created_at": "2011-12-18T22:12:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11800#issuecomment-125491",
    "user": "https://github.com/mstreng"
}
```

**Changing keywords** from "ecc2011" to "ecc2011, sd35, hyperelliptic curve, conic".



---

archive/issue_events_133890.json:
```json
{
    "actor": "https://github.com/mstreng",
    "created_at": "2011-12-18T23:10:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11800#event-133890"
}
```



---

archive/issue_events_133891.json:
```json
{
    "actor": "https://github.com/mstreng",
    "created_at": "2011-12-18T23:10:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "008080",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11800#event-133891"
}
```



---

archive/issue_comments_125492.json:
```json
{
    "body": "<a id='comment:10'></a>\nActually, I don't see any reason to ban conics from being hyperelliptic curves in Sage. Mathematically, I would say that a hyperelliptic curve has genus >= 2, but I don't want to forbid people to use the HyperelllipticCurve classes for lower-genus curves. For example, a user may have some loop going on where curves sometimes have genus 0, but sometimes higher.\n\nThe point `(0:1:0)` is not a reason to change things: for genus >=2 it is a singular point that you are not really interested in anyway! Indeed, the 0, 1, or 2 rational points that you get when you resolve that singularity are much more interesting.\n\nRather than disallowing conics, we could make a separate case in the `points` function instead.",
    "created_at": "2011-12-18T23:10:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11800#issuecomment-125492",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:10'></a>
Actually, I don't see any reason to ban conics from being hyperelliptic curves in Sage. Mathematically, I would say that a hyperelliptic curve has genus >= 2, but I don't want to forbid people to use the HyperelllipticCurve classes for lower-genus curves. For example, a user may have some loop going on where curves sometimes have genus 0, but sometimes higher.

The point `(0:1:0)` is not a reason to change things: for genus >=2 it is a singular point that you are not really interested in anyway! Indeed, the 0, 1, or 2 rational points that you get when you resolve that singularity are much more interesting.

Rather than disallowing conics, we could make a separate case in the `points` function instead.



---

archive/issue_comments_125493.json:
```json
{
    "body": "<a id='comment:11'></a>\nOk thanks, I will watch out for consistency with #11930. \n\nI will start working on the points method so that it allows conics, that is the case where (0:1:0) does not lie on the curve. This appears to be the better option, since changing the points method seems perfectly safe and banning conics is controversial (at least to some degree).\n\nThe problem when f is of degree 1 and h=0 (or more generally h=constant) stems from issues in the homogenization of `y^2+h*y-f` in the init method of HyperellipticCurve_generic. I will try to deal with these issues, probably opening a new ticket.",
    "created_at": "2011-12-19T14:27:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11800#issuecomment-125493",
    "user": "https://github.com/sagetrac-davideklund"
}
```

<a id='comment:11'></a>
Ok thanks, I will watch out for consistency with #11930. 

I will start working on the points method so that it allows conics, that is the case where (0:1:0) does not lie on the curve. This appears to be the better option, since changing the points method seems perfectly safe and banning conics is controversial (at least to some degree).

The problem when f is of degree 1 and h=0 (or more generally h=constant) stems from issues in the homogenization of `y^2+h*y-f` in the init method of HyperellipticCurve_generic. I will try to deal with these issues, probably opening a new ticket.



---

archive/issue_events_133892.json:
```json
{
    "actor": "https://github.com/sagetrac-davideklund",
    "created_at": "2011-12-21T11:08:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "008080",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11800#event-133892"
}
```



---

archive/issue_events_133893.json:
```json
{
    "actor": "https://github.com/sagetrac-davideklund",
    "created_at": "2011-12-21T11:08:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11800#event-133893"
}
```



---

archive/issue_comments_125494.json:
```json
{
    "body": "<a id='comment:12'></a>\nI changed the description to a simpler example (to include in the documentation) which illustrates the same issue.",
    "created_at": "2011-12-21T11:08:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11800#issuecomment-125494",
    "user": "https://github.com/sagetrac-davideklund"
}
```

<a id='comment:12'></a>
I changed the description to a simpler example (to include in the documentation) which illustrates the same issue.



---

archive/issue_comments_125495.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,11 +1,11 @@\n The function that lists the points on a hyperelliptic curve assumes that the point [0, 1, 0] is always valid. This is wrong and creates the following bug:\n \n ```\n-sage: R.<x> = GF(67)[]\n-sage: H = HyperellipticCurve(24*x^2 + 33*x + 43)\n+sage: R.<x> = GF(7)[]\n+sage: H = HyperellipticCurve(3*x^2 + 5*x + 1)\n sage: H.points()\n ...\n-TypeError: Coordinates [0, 1, 0] do not define a point on Hyperelliptic Curve over Finite Field of size 67 defined by y^2 = 24*x^2 + 33*x + 43\n+TypeError: Coordinates [0, 1, 0] do not define a point on Hyperelliptic Curve over Finite Field of size 7 defined by y^2 = 3*x^2 + 5*x + 1\n ```\n \n-Apply [attachment:11800.patch](https://github.com/sagemath/sage/files/ticket11800/11800.patch)\n+Apply [attachment:trac_11800_allow_conics.patch](https://github.com/sagemath/sage/files/ticket11800/trac_11800_allow_conics.patch)\n``````\n",
    "created_at": "2011-12-21T11:08:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11800#issuecomment-125495",
    "user": "https://github.com/sagetrac-davideklund"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,11 +1,11 @@
 The function that lists the points on a hyperelliptic curve assumes that the point [0, 1, 0] is always valid. This is wrong and creates the following bug:
 
 ```
-sage: R.<x> = GF(67)[]
-sage: H = HyperellipticCurve(24*x^2 + 33*x + 43)
+sage: R.<x> = GF(7)[]
+sage: H = HyperellipticCurve(3*x^2 + 5*x + 1)
 sage: H.points()
 ...
-TypeError: Coordinates [0, 1, 0] do not define a point on Hyperelliptic Curve over Finite Field of size 67 defined by y^2 = 24*x^2 + 33*x + 43
+TypeError: Coordinates [0, 1, 0] do not define a point on Hyperelliptic Curve over Finite Field of size 7 defined by y^2 = 3*x^2 + 5*x + 1
 ```
 
-Apply [attachment:11800.patch](https://github.com/sagemath/sage/files/ticket11800/11800.patch)
+Apply [attachment:trac_11800_allow_conics.patch](https://github.com/sagemath/sage/files/ticket11800/trac_11800_allow_conics.patch)
``````




---

archive/issue_comments_125496.json:
```json
{
    "body": "<a id='comment:14'></a>\nNot related to the example in the ticket description or to the patch, but very much related to the title of this ticket and the first line of the description: what is \"points\" supposed to mean? I assume it means points over the base field, but of which model?\n\n* The affine model in `_repr_` means no points at infinity.\n* The plane projective model (currently underlying the implementation) is not the natural thing to look at at infinity, it always has one point `(0:1:0)` at infinity, which is singular (assuming genus > 1).\n* The smooth projective model (the actual hyperelliptic curve) is what you get when you desingularize `(0:1:0)`. It has 0, 1 or 2 points at infinity defined over the base field. Is there a framework in Sage that would make it possible to have 2 point objects representing the different points at infinity?\n\nSee #11980",
    "created_at": "2012-01-03T09:19:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11800#issuecomment-125496",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:14'></a>
Not related to the example in the ticket description or to the patch, but very much related to the title of this ticket and the first line of the description: what is "points" supposed to mean? I assume it means points over the base field, but of which model?

* The affine model in `_repr_` means no points at infinity.
* The plane projective model (currently underlying the implementation) is not the natural thing to look at at infinity, it always has one point `(0:1:0)` at infinity, which is singular (assuming genus > 1).
* The smooth projective model (the actual hyperelliptic curve) is what you get when you desingularize `(0:1:0)`. It has 0, 1 or 2 points at infinity defined over the base field. Is there a framework in Sage that would make it possible to have 2 point objects representing the different points at infinity?

See #11980



---

archive/issue_comments_125497.json:
```json
{
    "body": "<a id='comment:15'></a>\nPoints at infinity are counted incorrectly for degree 2 by this patch.\n\n```\nsage: C = Conic(GF(7), [1, 0, 0, -1, 0, 1])\nsage: R.<x> = GF(7)[]\nsage: H = HyperellipticCurve(x^2+1)\nsage: C\nProjective Conic Curve over Finite Field of size 7 defined by x^2 - y^2 + z^2\nsage: H\nHyperelliptic Curve over Finite Field of size 7 defined by y^2 = x^2 + 1\nsage: C.is_smooth()\nTrue\nsage: H.points()\n[(0 : 6 : 1), (0 : 1 : 1), (1 : 4 : 1), (1 : 3 : 1), (6 : 4 : 1), (6 : 3 : 1)]\nsage: H([1,1,0])\n(1 : 1 : 0)\nsage: H([1,-1,0])\n(6 : 1 : 0)\n```\nHere C and H represent the same curve. It is a smooth conic over a finite field of order 7, hence has 8 rational points, but only 6 are found.\n\nIn general, if H has degree 2, there are 0 or 2 rational points at infinity (as in my previous comment). Since H has degree < 4, the plane model equals the smooth model, so these points can be represented and returned correctly in Sage.",
    "created_at": "2012-01-03T09:52:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11800#issuecomment-125497",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:15'></a>
Points at infinity are counted incorrectly for degree 2 by this patch.

```
sage: C = Conic(GF(7), [1, 0, 0, -1, 0, 1])
sage: R.<x> = GF(7)[]
sage: H = HyperellipticCurve(x^2+1)
sage: C
Projective Conic Curve over Finite Field of size 7 defined by x^2 - y^2 + z^2
sage: H
Hyperelliptic Curve over Finite Field of size 7 defined by y^2 = x^2 + 1
sage: C.is_smooth()
True
sage: H.points()
[(0 : 6 : 1), (0 : 1 : 1), (1 : 4 : 1), (1 : 3 : 1), (6 : 4 : 1), (6 : 3 : 1)]
sage: H([1,1,0])
(1 : 1 : 0)
sage: H([1,-1,0])
(6 : 1 : 0)
```
Here C and H represent the same curve. It is a smooth conic over a finite field of order 7, hence has 8 rational points, but only 6 are found.

In general, if H has degree 2, there are 0 or 2 rational points at infinity (as in my previous comment). Since H has degree < 4, the plane model equals the smooth model, so these points can be represented and returned correctly in Sage.



---

archive/issue_events_133894.json:
```json
{
    "actor": "https://github.com/mstreng",
    "created_at": "2012-01-03T09:52:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11800#event-133894"
}
```



---

archive/issue_events_133895.json:
```json
{
    "actor": "https://github.com/mstreng",
    "created_at": "2012-01-03T09:52:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11800#event-133895"
}
```



---

archive/issue_comments_125498.json:
```json
{
    "body": "**Reviewer:** Marco Streng",
    "created_at": "2012-01-03T09:52:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11800#issuecomment-125498",
    "user": "https://github.com/mstreng"
}
```

**Reviewer:** Marco Streng



---

archive/issue_comments_125499.json:
```json
{
    "body": "<a id='comment:16'></a>\nIn the present patch, the points() method returns all the rational points on the plane projective model, including those on the line at infinity.\n\nI agree that when the projective plane model is singular (the typical case) we really want the points() method to spit out points on a smooth model. Maybe the issue should be raised in a separate ticket. A comment on the matter by David Kohel:\n\nThe approach of Magma is to use weighted projective space which allows one to represent two points at infinity (when the degree of `f + h^2/4` is even). In this case one gets two points at infinity rather than one (singular when g > 0).",
    "created_at": "2012-02-13T02:45:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11800#issuecomment-125499",
    "user": "https://github.com/sagetrac-davideklund"
}
```

<a id='comment:16'></a>
In the present patch, the points() method returns all the rational points on the plane projective model, including those on the line at infinity.

I agree that when the projective plane model is singular (the typical case) we really want the points() method to spit out points on a smooth model. Maybe the issue should be raised in a separate ticket. A comment on the matter by David Kohel:

The approach of Magma is to use weighted projective space which allows one to represent two points at infinity (when the degree of `f + h^2/4` is even). In this case one gets two points at infinity rather than one (singular when g > 0).



---

archive/issue_comments_125500.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [davideklund](#comment%3A16):\n> The approach of Magma is to use weighted projective space which allows one to represent two points at infinity (when the degree of `f + h^2/4` is even). In this case one gets two points at infinity rather than one (singular when g > 0).\n\nYes, this is a standard textbook approach to hyperelliptic curves. It is requested in the documentation of [rational_points](http://www.sagemath.org/doc/reference/sage/schemes/generic/algebraic_scheme.html#sage.schemes.generic.algebraic_scheme.AlgebraicScheme_subscheme.rational_points) as a way of representing two points at infinity. I don't think weighted projective spaces exist in Sage, so a minimal implementation of weighted projective spaces (like Magma's `WeightedProjectiveSpace`) would be a first step.\n\nAnyway, your patch looks good. I'll test it now.",
    "created_at": "2012-02-13T09:40:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11800#issuecomment-125500",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:17'></a>
Replying to [davideklund](#comment%3A16):
> The approach of Magma is to use weighted projective space which allows one to represent two points at infinity (when the degree of `f + h^2/4` is even). In this case one gets two points at infinity rather than one (singular when g > 0).

Yes, this is a standard textbook approach to hyperelliptic curves. It is requested in the documentation of [rational_points](http://www.sagemath.org/doc/reference/sage/schemes/generic/algebraic_scheme.html#sage.schemes.generic.algebraic_scheme.AlgebraicScheme_subscheme.rational_points) as a way of representing two points at infinity. I don't think weighted projective spaces exist in Sage, so a minimal implementation of weighted projective spaces (like Magma's `WeightedProjectiveSpace`) would be a first step.

Anyway, your patch looks good. I'll test it now.



---

archive/issue_comments_125501.json:
```json
{
    "body": "<a id='comment:18'></a>\nI see that the new patch isn't set to \"needs review\" yet, but I'll comment on it anyway: I think some explanation of the situation at infinity is in order in the documentation. How about the following?\n\n\"This method currently lists points in the plane projective model, which means that one point (0:1:0) at infinity is returned if the degree of the curve is at least 4. Later implementations may consider the more mathematically correct desingularisation at infinity, replacing (0:1:0) by 0 or 2 smooth rational points if the degree is even.\" + EXAMPLE of degree 6.\n\nAlso, your method of finding points at infinity is linear in the field order, this can be improved by taking (1:y:0) and solving for y (i.e., extracting 1 square root), exactly as currently the affine points are found by taking (x:y:1) for each x and solving for y.",
    "created_at": "2012-02-13T10:18:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11800#issuecomment-125501",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:18'></a>
I see that the new patch isn't set to "needs review" yet, but I'll comment on it anyway: I think some explanation of the situation at infinity is in order in the documentation. How about the following?

"This method currently lists points in the plane projective model, which means that one point (0:1:0) at infinity is returned if the degree of the curve is at least 4. Later implementations may consider the more mathematically correct desingularisation at infinity, replacing (0:1:0) by 0 or 2 smooth rational points if the degree is even." + EXAMPLE of degree 6.

Also, your method of finding points at infinity is linear in the field order, this can be improved by taking (1:y:0) and solving for y (i.e., extracting 1 square root), exactly as currently the affine points are found by taking (x:y:1) for each x and solving for y.



---

archive/issue_comments_125502.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [@mstreng](#comment%3A18):\n> I see that the new patch isn't set to \"needs review\" yet, but I'll comment on it anyway: I think some explanation of the situation at infinity is in order in the documentation. How about the following?\n> \n> \"This method currently lists points in the plane projective model, which means that one point (0:1:0) at infinity is returned if the degree of the curve is at least 4. Later implementations may consider the more mathematically correct desingularisation at infinity, replacing (0:1:0) by 0 or 2 smooth rational points if the degree is even.\" + EXAMPLE of degree 6.\n> \n> Also, your method of finding points at infinity is linear in the field order, this can be improved by taking (1:y:0) and solving for y (i.e., extracting 1 square root), exactly as currently the affine points are found by taking (x:y:1) for each x and solving for y.\n\nThank you for your comments! I hoped to attend to this earlier. I think I will get some time to work on it soon.\n\nYes, some comment like the one you supply would be in order in the documentation. About the method for finding points: I used brute force since I deliberately choose simple code before efficiency. But I will implement the refined approach you suggest.",
    "created_at": "2012-02-25T19:28:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11800#issuecomment-125502",
    "user": "https://github.com/sagetrac-davideklund"
}
```

<a id='comment:19'></a>
Replying to [@mstreng](#comment%3A18):
> I see that the new patch isn't set to "needs review" yet, but I'll comment on it anyway: I think some explanation of the situation at infinity is in order in the documentation. How about the following?
> 
> "This method currently lists points in the plane projective model, which means that one point (0:1:0) at infinity is returned if the degree of the curve is at least 4. Later implementations may consider the more mathematically correct desingularisation at infinity, replacing (0:1:0) by 0 or 2 smooth rational points if the degree is even." + EXAMPLE of degree 6.
> 
> Also, your method of finding points at infinity is linear in the field order, this can be improved by taking (1:y:0) and solving for y (i.e., extracting 1 square root), exactly as currently the affine points are found by taking (x:y:1) for each x and solving for y.

Thank you for your comments! I hoped to attend to this earlier. I think I will get some time to work on it soon.

Yes, some comment like the one you supply would be in order in the documentation. About the method for finding points: I used brute force since I deliberately choose simple code before efficiency. But I will implement the refined approach you suggest.



---

archive/issue_comments_125503.json:
```json
{
    "body": "Patch updated. More efficient method to find the points at infinity and added documentation.",
    "created_at": "2012-03-17T01:16:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11800#issuecomment-125503",
    "user": "https://github.com/sagetrac-davideklund"
}
```

Patch updated. More efficient method to find the points at infinity and added documentation.



---

archive/issue_events_133896.json:
```json
{
    "actor": "https://github.com/sagetrac-davideklund",
    "created_at": "2012-03-17T01:17:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11800#event-133896"
}
```



---

archive/issue_events_133897.json:
```json
{
    "actor": "https://github.com/sagetrac-davideklund",
    "created_at": "2012-03-17T01:17:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11800#event-133897"
}
```



---

archive/issue_comments_125504.json:
```json
{
    "body": "<a id='comment:20'></a>\n**Attachment:** [trac_11800_allow_conics.patch.gz](https://github.com/sagemath/sage/files/ticket11800/trac_11800_allow_conics.patch.gz)",
    "created_at": "2012-03-17T01:17:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11800#issuecomment-125504",
    "user": "https://github.com/sagetrac-davideklund"
}
```

<a id='comment:20'></a>
**Attachment:** [trac_11800_allow_conics.patch.gz](https://github.com/sagemath/sage/files/ticket11800/trac_11800_allow_conics.patch.gz)



---

archive/issue_comments_125505.json:
```json
{
    "body": "<a id='comment:21'></a>\nfor patchbot:\n\napply trac_11800_allow_conics.patch",
    "created_at": "2012-03-17T14:29:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11800#issuecomment-125505",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:21'></a>
for patchbot:

apply trac_11800_allow_conics.patch



---

archive/issue_comments_125506.json:
```json
{
    "body": "**Attachment:** [11800-reviewer.patch.gz](https://github.com/sagemath/sage/files/ticket11800/11800-reviewer.patch.gz)\n\nbreak at 79 characters, shortened polynomial coefficient access",
    "created_at": "2012-03-17T20:52:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11800#issuecomment-125506",
    "user": "https://github.com/mstreng"
}
```

**Attachment:** [11800-reviewer.patch.gz](https://github.com/sagemath/sage/files/ticket11800/11800-reviewer.patch.gz)

break at 79 characters, shortened polynomial coefficient access



---

archive/issue_comments_125507.json:
```json
{
    "body": "**Changing dependencies** from \"#11930\" to \"\".",
    "created_at": "2012-03-17T20:57:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11800#issuecomment-125507",
    "user": "https://github.com/mstreng"
}
```

**Changing dependencies** from "#11930" to "".



---

archive/issue_comments_125508.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -8,4 +8,6 @@\n TypeError: Coordinates [0, 1, 0] do not define a point on Hyperelliptic Curve over Finite Field of size 7 defined by y^2 = 3*x^2 + 5*x + 1\n ```\n \n-Apply [attachment:trac_11800_allow_conics.patch](https://github.com/sagemath/sage/files/ticket11800/trac_11800_allow_conics.patch)\n+Apply\n+* [attachment:trac_11800_allow_conics.patch](https://github.com/sagemath/sage/files/ticket11800/trac_11800_allow_conics.patch)\n+* [attachment:11800-reviewer.patch](https://github.com/sagemath/sage/files/ticket11800/11800-reviewer.patch)\n``````\n",
    "created_at": "2012-03-17T20:57:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11800#issuecomment-125508",
    "user": "https://github.com/mstreng"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -8,4 +8,6 @@
 TypeError: Coordinates [0, 1, 0] do not define a point on Hyperelliptic Curve over Finite Field of size 7 defined by y^2 = 3*x^2 + 5*x + 1
 ```
 
-Apply [attachment:trac_11800_allow_conics.patch](https://github.com/sagemath/sage/files/ticket11800/trac_11800_allow_conics.patch)
+Apply
+* [attachment:trac_11800_allow_conics.patch](https://github.com/sagemath/sage/files/ticket11800/trac_11800_allow_conics.patch)
+* [attachment:11800-reviewer.patch](https://github.com/sagemath/sage/files/ticket11800/11800-reviewer.patch)
``````




---

archive/issue_comments_125509.json:
```json
{
    "body": "<a id='comment:23'></a>\nPython style guides ask for breaking of lines at 79 characters. Aside from that, the patch is good. If you agree with my reviewer patch, then feel free to set the ticket to \"positive review\".",
    "created_at": "2012-03-17T21:08:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11800#issuecomment-125509",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:23'></a>
Python style guides ask for breaking of lines at 79 characters. Aside from that, the patch is good. If you agree with my reviewer patch, then feel free to set the ticket to "positive review".



---

archive/issue_comments_125510.json:
```json
{
    "body": "<a id='comment:24'></a>\nReplying to [@mstreng](#comment%3A23):\n> Python style guides ask for breaking of lines at 79 characters. Aside from that, the patch is good. If you agree with my reviewer patch, then feel free to set the ticket to \"positive review\". \n\nOk, thanks! I agree with your changes.",
    "created_at": "2012-03-18T17:36:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11800#issuecomment-125510",
    "user": "https://github.com/sagetrac-davideklund"
}
```

<a id='comment:24'></a>
Replying to [@mstreng](#comment%3A23):
> Python style guides ask for breaking of lines at 79 characters. Aside from that, the patch is good. If you agree with my reviewer patch, then feel free to set the ticket to "positive review". 

Ok, thanks! I agree with your changes.



---

archive/issue_events_133898.json:
```json
{
    "actor": "https://github.com/sagetrac-davideklund",
    "created_at": "2012-03-18T17:36:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11800#event-133898"
}
```



---

archive/issue_events_133899.json:
```json
{
    "actor": "https://github.com/sagetrac-davideklund",
    "created_at": "2012-03-18T17:36:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11800#event-133899"
}
```



---

archive/issue_events_133900.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-28T10:03:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11800#event-133900"
}
```



---

archive/issue_events_133901.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-28T10:03:54Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11800#event-133901"
}
```



---

archive/issue_comments_125511.json:
```json
{
    "body": "**Merged:** sage-5.0.beta11",
    "created_at": "2012-03-28T10:03:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11800#issuecomment-125511",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.0.beta11



---

archive/issue_comments_125512.json:
```json
{
    "body": "<a id='comment:26'></a>\nSee #15115 for getting the correct points at infinity in general.",
    "created_at": "2013-08-28T12:41:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11800",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11800#issuecomment-125512",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:26'></a>
See #15115 for getting the correct points at infinity in general.
