# Issue 11969: Clean up top-level Makefile

archive/issues_011797.json:
```json
{
    "body": "Using `&&` inside commands for pipestatus does not work.  Therefore, in the top-level Makefile, we should move `$(TESTPRELIMS)` out of `$(PIPE)`.\n\nFor example, if `sage-starts` fails, one would get\n\n```\n$ make ptestlong\n[...]\nspkg/pipestatus \". local/bin/sage-env && sage-starts && ./sage -tp 0  -sagenb -long devel/sage/doc/common devel/sage/doc/de devel/sage/doc/en devel/sage/doc/fr devel/sage/doc/ru devel/sage/sage 2>&1\" \"tee -a ptestlong.log\"\n\nTesting that Sage starts...\nTraceback (most recent call last):\n  File \"/usr/local/src/sage-4.7.2.alpha4/local/bin/sage-eval\", line 4, in <module>\n    from sage.all import *\n  File \"/usr/local/src/sage-4.7.2.alpha4/local/lib/python2.6/site-packages/sage/all.py\", line 68, in <module>\n    from sage.misc.all       import *         # takes a while\n  File \"/usr/local/src/sage-4.7.2.alpha4/local/lib/python2.6/site-packages/sage/misc/all.py\", line 81, in <module>\n    from functional import (additive_order,\n  File \"/usr/local/src/sage-4.7.2.alpha4/local/lib/python2.6/site-packages/sage/misc/functional.py\", line 36, in <module>\n    from sage.rings.complex_double import CDF\n  File \"integer.pxd\", line 9, in init sage.rings.complex_double (sage/rings/complex_double.c:14716)\nImportError: libgmp.so.8: cannot open shared object file: No such file or directory\nSage failed to start up.\nPlease email sage-devel (http://groups.google.com/group/sage-devel)\nexplaining the problem and send the log file\n  /usr/local/src/sage-4.7.2.alpha4/start.log\nDescribe your computer, operating system, etc.\nspkg/pipestatus: line 44: [: -ne: unary operator expected\nmake: *** [ptestlong] Error 1\n```\n\nNote the penultimate line.\n\nThe attached patch also:\n1. removes `sage-starts` from `sage -tp`, because running `make ptest` or `make ptestlong` already runs `sage-starts`.\n2. runs `./sage -b` in the `make build` rule.  This ensures that the Sage library is up-to-date when testing or building documentation.\n3. adds `make testalllong` and `make ptestalllong` for completeness.\n4. generally cleans up the `Makefile`.\n\n**Apply**:\n1. [attachment:11969_testprelims.patch] to **SAGE_ROOT**\n2. [attachment:11969_scripts.patch] to **scripts**\n\nAssignee: GeorgSWeber\n\nKeywords: Makefile pipestatus\n\nResolution: fixed\n\nDependencies: #11926, #11972, #11959\n\nAuthor: Jeroen Demeyer\n\nReviewer: John Palmieri, Leif Leonhardy\n\nMerged: sage-4.8.alpha2\n\nIssue created by migration from https://trac.sagemath.org/ticket/11969\n\n",
    "closed_at": "2011-11-14T17:32:28Z",
    "created_at": "2011-10-31T08:30:18Z",
    "labels": [
        "component: build",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.8",
    "title": "Clean up top-level Makefile",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11969",
    "user": "https://github.com/jdemeyer"
}
```
Using `&&` inside commands for pipestatus does not work.  Therefore, in the top-level Makefile, we should move `$(TESTPRELIMS)` out of `$(PIPE)`.

For example, if `sage-starts` fails, one would get

```
$ make ptestlong
[...]
spkg/pipestatus ". local/bin/sage-env && sage-starts && ./sage -tp 0  -sagenb -long devel/sage/doc/common devel/sage/doc/de devel/sage/doc/en devel/sage/doc/fr devel/sage/doc/ru devel/sage/sage 2>&1" "tee -a ptestlong.log"

Testing that Sage starts...
Traceback (most recent call last):
  File "/usr/local/src/sage-4.7.2.alpha4/local/bin/sage-eval", line 4, in <module>
    from sage.all import *
  File "/usr/local/src/sage-4.7.2.alpha4/local/lib/python2.6/site-packages/sage/all.py", line 68, in <module>
    from sage.misc.all       import *         # takes a while
  File "/usr/local/src/sage-4.7.2.alpha4/local/lib/python2.6/site-packages/sage/misc/all.py", line 81, in <module>
    from functional import (additive_order,
  File "/usr/local/src/sage-4.7.2.alpha4/local/lib/python2.6/site-packages/sage/misc/functional.py", line 36, in <module>
    from sage.rings.complex_double import CDF
  File "integer.pxd", line 9, in init sage.rings.complex_double (sage/rings/complex_double.c:14716)
ImportError: libgmp.so.8: cannot open shared object file: No such file or directory
Sage failed to start up.
Please email sage-devel (http://groups.google.com/group/sage-devel)
explaining the problem and send the log file
  /usr/local/src/sage-4.7.2.alpha4/start.log
Describe your computer, operating system, etc.
spkg/pipestatus: line 44: [: -ne: unary operator expected
make: *** [ptestlong] Error 1
```

Note the penultimate line.

The attached patch also:
1. removes `sage-starts` from `sage -tp`, because running `make ptest` or `make ptestlong` already runs `sage-starts`.
2. runs `./sage -b` in the `make build` rule.  This ensures that the Sage library is up-to-date when testing or building documentation.
3. adds `make testalllong` and `make ptestalllong` for completeness.
4. generally cleans up the `Makefile`.

**Apply**:
1. [attachment:11969_testprelims.patch] to **SAGE_ROOT**
2. [attachment:11969_scripts.patch] to **scripts**

Assignee: GeorgSWeber

Keywords: Makefile pipestatus

Resolution: fixed

Dependencies: #11926, #11972, #11959

Author: Jeroen Demeyer

Reviewer: John Palmieri, Leif Leonhardy

Merged: sage-4.8.alpha2

Issue created by migration from https://trac.sagemath.org/ticket/11969





---

archive/issue_comments_142400.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n Using \\`&&\\` inside commands for pipestatus does not work.  Therefore, in the top-level Makefile, we should move \\`$(TESTPRELIMS)\\` out of \\`$(PIPE)\\`.\n+\n+**Apply** [attachment:11969_testprelims.patch] to **SAGE_ROOT**\n \n Author: Jeroen Demeyer\n \n```\n",
    "created_at": "2011-10-31T08:34:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11969#issuecomment-142400",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,6 @@
 Using \`&&\` inside commands for pipestatus does not work.  Therefore, in the top-level Makefile, we should move \`$(TESTPRELIMS)\` out of \`$(PIPE)\`.
+
+**Apply** [attachment:11969_testprelims.patch] to **SAGE_ROOT**
 
 Author: Jeroen Demeyer
 
```




---

archive/issue_comments_142401.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-10-31T08:34:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11969#issuecomment-142401",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_142402.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,36 @@\n+Using \\`&&\\` inside commands for pipestatus does not work.  Therefore, in the top-level Makefile, we should move \\`$(TESTPRELIMS)\\` out of \\`$(PIPE)\\`.\n \n+For example, if \\`sage-starts\\` fails, one would get\n+\n+\\`\\`\\`\n+$ make ptestlong\n+[...]\n+spkg/pipestatus \". local/bin/sage-env && sage-starts && ./sage -tp 0  -sagenb -long devel/sage/doc/common devel/sage/doc/de devel/sage/doc/en devel/sage/doc/fr devel/sage/doc/ru devel/sage/sage 2>&1\" \"tee -a ptestlong.log\"\n+\n+Testing that Sage starts...\n+Traceback (most recent call last):\n+  File \"/usr/local/src/sage-4.7.2.alpha4/local/bin/sage-eval\", line 4, in <module>\n+    from sage.all import *\n+  File \"/usr/local/src/sage-4.7.2.alpha4/local/lib/python2.6/site-packages/sage/all.py\", line 68, in <module>\n+    from sage.misc.all       import *         # takes a while\n+  File \"/usr/local/src/sage-4.7.2.alpha4/local/lib/python2.6/site-packages/sage/misc/all.py\", line 81, in <module>\n+    from functional import (additive_order,\n+  File \"/usr/local/src/sage-4.7.2.alpha4/local/lib/python2.6/site-packages/sage/misc/functional.py\", line 36, in <module>\n+    from sage.rings.complex_double import CDF\n+  File \"integer.pxd\", line 9, in init sage.rings.complex_double (sage/rings/complex_double.c:14716)\n+ImportError: libgmp.so.8: cannot open shared object file: No such file or directory\n+Sage failed to start up.\n+Please email sage-devel (http://groups.google.com/group/sage-devel)\n+explaining the problem and send the log file\n+  /usr/local/src/sage-4.7.2.alpha4/start.log\n+Describe your computer, operating system, etc.\n+spkg/pipestatus: line 44: [: -ne: unary operator expected\n+make: *** [ptestlong] Error 1\n+\\`\\`\\`\n+\n+Note the penultimate line.\n+\n+**Apply** [attachment:11969_testprelims.patch] to **SAGE_ROOT**\n \n Author: Jeroen Demeyer\n \n```\n",
    "created_at": "2011-10-31T08:35:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11969#issuecomment-142402",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,36 @@
+Using \`&&\` inside commands for pipestatus does not work.  Therefore, in the top-level Makefile, we should move \`$(TESTPRELIMS)\` out of \`$(PIPE)\`.
 
+For example, if \`sage-starts\` fails, one would get
+
+\`\`\`
+$ make ptestlong
+[...]
+spkg/pipestatus ". local/bin/sage-env && sage-starts && ./sage -tp 0  -sagenb -long devel/sage/doc/common devel/sage/doc/de devel/sage/doc/en devel/sage/doc/fr devel/sage/doc/ru devel/sage/sage 2>&1" "tee -a ptestlong.log"
+
+Testing that Sage starts...
+Traceback (most recent call last):
+  File "/usr/local/src/sage-4.7.2.alpha4/local/bin/sage-eval", line 4, in <module>
+    from sage.all import *
+  File "/usr/local/src/sage-4.7.2.alpha4/local/lib/python2.6/site-packages/sage/all.py", line 68, in <module>
+    from sage.misc.all       import *         # takes a while
+  File "/usr/local/src/sage-4.7.2.alpha4/local/lib/python2.6/site-packages/sage/misc/all.py", line 81, in <module>
+    from functional import (additive_order,
+  File "/usr/local/src/sage-4.7.2.alpha4/local/lib/python2.6/site-packages/sage/misc/functional.py", line 36, in <module>
+    from sage.rings.complex_double import CDF
+  File "integer.pxd", line 9, in init sage.rings.complex_double (sage/rings/complex_double.c:14716)
+ImportError: libgmp.so.8: cannot open shared object file: No such file or directory
+Sage failed to start up.
+Please email sage-devel (http://groups.google.com/group/sage-devel)
+explaining the problem and send the log file
+  /usr/local/src/sage-4.7.2.alpha4/start.log
+Describe your computer, operating system, etc.
+spkg/pipestatus: line 44: [: -ne: unary operator expected
+make: *** [ptestlong] Error 1
+\`\`\`
+
+Note the penultimate line.
+
+**Apply** [attachment:11969_testprelims.patch] to **SAGE_ROOT**
 
 Author: Jeroen Demeyer
 
```




---

archive/issue_comments_142403.json:
```json
{
    "body": "Changing keywords from \"\" to \"Makefile pipestatus\".",
    "created_at": "2011-10-31T08:57:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11969#issuecomment-142403",
    "user": "https://github.com/jdemeyer"
}
```

Changing keywords from "" to "Makefile pipestatus".



---

archive/issue_comments_142404.json:
```json
{
    "body": "<a id='comment:4'></a>Looks reasonable, although you could just use parentheses in the parameter to `pipestatus`.  (That way, the output of `sage-starts` would still get logged, too.)",
    "created_at": "2011-10-31T16:09:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11969#issuecomment-142404",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:4'></a>Looks reasonable, although you could just use parentheses in the parameter to `pipestatus`.  (That way, the output of `sage-starts` would still get logged, too.)



---

archive/issue_comments_142405.json:
```json
{
    "body": "<a id='comment:5'></a>Looks okay to me, too. I think it also makes sense to move sage-env out of `TESTPRELIMS` and only run it explicitly where needed.  I think that logging the output from `sage-starts` might be nice, but it's pretty minor.\n\nDoes `sage -t` accept `--optional` as meaning the same as `-optional`?  It accepts `--sagenb` and `--long`.  Do you want to change those while you're editing those lines?",
    "created_at": "2011-10-31T17:15:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11969#issuecomment-142405",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:5'></a>Looks okay to me, too. I think it also makes sense to move sage-env out of `TESTPRELIMS` and only run it explicitly where needed.  I think that logging the output from `sage-starts` might be nice, but it's pretty minor.

Does `sage -t` accept `--optional` as meaning the same as `-optional`?  It accepts `--sagenb` and `--long`.  Do you want to change those while you're editing those lines?



---

archive/issue_comments_142406.json:
```json
{
    "body": "<a id='comment:6'></a>I noticed that `make ptestlong` actually runs `sage-starts` **twice**: once from the `Makefile` and once from `sage-sage`.\n\nI propose **not** to run `sage-starts` when the user explicitly runs\n\n```\n$ ./sage -tp [...]\n```\nbut to run `sage-starts` only when the user does\n\n```\n$ make ptestlong\n```\n\nThe rationale is that `sage -tp` is often done with one or few files and then the overhead of `sage-starts` might be significant.  However, for a `make ptestlong` run, running `sage-starts` once does not really impact the testing time.",
    "created_at": "2011-10-31T17:32:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11969#issuecomment-142406",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>I noticed that `make ptestlong` actually runs `sage-starts` **twice**: once from the `Makefile` and once from `sage-sage`.

I propose **not** to run `sage-starts` when the user explicitly runs

```
$ ./sage -tp [...]
```
but to run `sage-starts` only when the user does

```
$ make ptestlong
```

The rationale is that `sage -tp` is often done with one or few files and then the overhead of `sage-starts` might be significant.  However, for a `make ptestlong` run, running `sage-starts` once does not really impact the testing time.



---

archive/issue_comments_142407.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-10-31T17:32:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11969#issuecomment-142407",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_142408.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,38 @@\n+Using \\`&&\\` inside commands for pipestatus does not work.  Therefore, in the top-level Makefile, we should move \\`$(TESTPRELIMS)\\` out of \\`$(PIPE)\\`.\n \n+For example, if \\`sage-starts\\` fails, one would get\n+\n+\\`\\`\\`\n+$ make ptestlong\n+[...]\n+spkg/pipestatus \". local/bin/sage-env && sage-starts && ./sage -tp 0  -sagenb -long devel/sage/doc/common devel/sage/doc/de devel/sage/doc/en devel/sage/doc/fr devel/sage/doc/ru devel/sage/sage 2>&1\" \"tee -a ptestlong.log\"\n+\n+Testing that Sage starts...\n+Traceback (most recent call last):\n+  File \"/usr/local/src/sage-4.7.2.alpha4/local/bin/sage-eval\", line 4, in <module>\n+    from sage.all import *\n+  File \"/usr/local/src/sage-4.7.2.alpha4/local/lib/python2.6/site-packages/sage/all.py\", line 68, in <module>\n+    from sage.misc.all       import *         # takes a while\n+  File \"/usr/local/src/sage-4.7.2.alpha4/local/lib/python2.6/site-packages/sage/misc/all.py\", line 81, in <module>\n+    from functional import (additive_order,\n+  File \"/usr/local/src/sage-4.7.2.alpha4/local/lib/python2.6/site-packages/sage/misc/functional.py\", line 36, in <module>\n+    from sage.rings.complex_double import CDF\n+  File \"integer.pxd\", line 9, in init sage.rings.complex_double (sage/rings/complex_double.c:14716)\n+ImportError: libgmp.so.8: cannot open shared object file: No such file or directory\n+Sage failed to start up.\n+Please email sage-devel (http://groups.google.com/group/sage-devel)\n+explaining the problem and send the log file\n+  /usr/local/src/sage-4.7.2.alpha4/start.log\n+Describe your computer, operating system, etc.\n+spkg/pipestatus: line 44: [: -ne: unary operator expected\n+make: *** [ptestlong] Error 1\n+\\`\\`\\`\n+\n+Note the penultimate line.\n+\n+**Apply**:\n+1. [attachment:11969_testprelims.patch] to **SAGE_ROOT**\n+2. [attachment:11969_scripts.patch] to **scripts**\n \n Author: Jeroen Demeyer\n \n```\n",
    "created_at": "2011-10-31T17:39:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11969#issuecomment-142408",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,38 @@
+Using \`&&\` inside commands for pipestatus does not work.  Therefore, in the top-level Makefile, we should move \`$(TESTPRELIMS)\` out of \`$(PIPE)\`.
 
+For example, if \`sage-starts\` fails, one would get
+
+\`\`\`
+$ make ptestlong
+[...]
+spkg/pipestatus ". local/bin/sage-env && sage-starts && ./sage -tp 0  -sagenb -long devel/sage/doc/common devel/sage/doc/de devel/sage/doc/en devel/sage/doc/fr devel/sage/doc/ru devel/sage/sage 2>&1" "tee -a ptestlong.log"
+
+Testing that Sage starts...
+Traceback (most recent call last):
+  File "/usr/local/src/sage-4.7.2.alpha4/local/bin/sage-eval", line 4, in <module>
+    from sage.all import *
+  File "/usr/local/src/sage-4.7.2.alpha4/local/lib/python2.6/site-packages/sage/all.py", line 68, in <module>
+    from sage.misc.all       import *         # takes a while
+  File "/usr/local/src/sage-4.7.2.alpha4/local/lib/python2.6/site-packages/sage/misc/all.py", line 81, in <module>
+    from functional import (additive_order,
+  File "/usr/local/src/sage-4.7.2.alpha4/local/lib/python2.6/site-packages/sage/misc/functional.py", line 36, in <module>
+    from sage.rings.complex_double import CDF
+  File "integer.pxd", line 9, in init sage.rings.complex_double (sage/rings/complex_double.c:14716)
+ImportError: libgmp.so.8: cannot open shared object file: No such file or directory
+Sage failed to start up.
+Please email sage-devel (http://groups.google.com/group/sage-devel)
+explaining the problem and send the log file
+  /usr/local/src/sage-4.7.2.alpha4/start.log
+Describe your computer, operating system, etc.
+spkg/pipestatus: line 44: [: -ne: unary operator expected
+make: *** [ptestlong] Error 1
+\`\`\`
+
+Note the penultimate line.
+
+**Apply**:
+1. [attachment:11969_testprelims.patch] to **SAGE_ROOT**
+2. [attachment:11969_scripts.patch] to **scripts**
 
 Author: Jeroen Demeyer
 
```




---

archive/issue_comments_142409.json:
```json
{
    "body": "<a id='comment:7'></a>Attachment [11969_scripts.patch](tarball://root/attachments/some-uuid/ticket11969/11969_scripts.patch) by @jdemeyer created at 2011-10-31 17:39:44",
    "created_at": "2011-10-31T17:39:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11969#issuecomment-142409",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>Attachment [11969_scripts.patch](tarball://root/attachments/some-uuid/ticket11969/11969_scripts.patch) by @jdemeyer created at 2011-10-31 17:39:44



---

archive/issue_comments_142410.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,43 @@\n+Using \\`&&\\` inside commands for pipestatus does not work.  Therefore, in the top-level Makefile, we should move \\`$(TESTPRELIMS)\\` out of \\`$(PIPE)\\`.\n \n+For example, if \\`sage-starts\\` fails, one would get\n+\n+\\`\\`\\`\n+$ make ptestlong\n+[...]\n+spkg/pipestatus \". local/bin/sage-env && sage-starts && ./sage -tp 0  -sagenb -long devel/sage/doc/common devel/sage/doc/de devel/sage/doc/en devel/sage/doc/fr devel/sage/doc/ru devel/sage/sage 2>&1\" \"tee -a ptestlong.log\"\n+\n+Testing that Sage starts...\n+Traceback (most recent call last):\n+  File \"/usr/local/src/sage-4.7.2.alpha4/local/bin/sage-eval\", line 4, in <module>\n+    from sage.all import *\n+  File \"/usr/local/src/sage-4.7.2.alpha4/local/lib/python2.6/site-packages/sage/all.py\", line 68, in <module>\n+    from sage.misc.all       import *         # takes a while\n+  File \"/usr/local/src/sage-4.7.2.alpha4/local/lib/python2.6/site-packages/sage/misc/all.py\", line 81, in <module>\n+    from functional import (additive_order,\n+  File \"/usr/local/src/sage-4.7.2.alpha4/local/lib/python2.6/site-packages/sage/misc/functional.py\", line 36, in <module>\n+    from sage.rings.complex_double import CDF\n+  File \"integer.pxd\", line 9, in init sage.rings.complex_double (sage/rings/complex_double.c:14716)\n+ImportError: libgmp.so.8: cannot open shared object file: No such file or directory\n+Sage failed to start up.\n+Please email sage-devel (http://groups.google.com/group/sage-devel)\n+explaining the problem and send the log file\n+  /usr/local/src/sage-4.7.2.alpha4/start.log\n+Describe your computer, operating system, etc.\n+spkg/pipestatus: line 44: [: -ne: unary operator expected\n+make: *** [ptestlong] Error 1\n+\\`\\`\\`\n+\n+Note the penultimate line.\n+\n+The attached patch also:\n+1. removes \\`sage-starts\\` from \\`sage -tp\\`, because running \\`make ptest\\` or \\`make ptestlong\\` already runs \\`sage-starts\\`.\n+2. ensures that \\`make test\\` and all variants run \\`./sage -b\\` before doing the testing.\n+3. adds \\`make testalllong\\` and \\`make ptestalllong\\` for completeness.\n+\n+**Apply**:\n+1. [attachment:11969_testprelims.patch] to **SAGE_ROOT**\n+2. [attachment:11969_scripts.patch] to **scripts**\n \n Author: Jeroen Demeyer\n \n```\n",
    "created_at": "2011-10-31T17:47:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11969#issuecomment-142410",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,43 @@
+Using \`&&\` inside commands for pipestatus does not work.  Therefore, in the top-level Makefile, we should move \`$(TESTPRELIMS)\` out of \`$(PIPE)\`.
 
+For example, if \`sage-starts\` fails, one would get
+
+\`\`\`
+$ make ptestlong
+[...]
+spkg/pipestatus ". local/bin/sage-env && sage-starts && ./sage -tp 0  -sagenb -long devel/sage/doc/common devel/sage/doc/de devel/sage/doc/en devel/sage/doc/fr devel/sage/doc/ru devel/sage/sage 2>&1" "tee -a ptestlong.log"
+
+Testing that Sage starts...
+Traceback (most recent call last):
+  File "/usr/local/src/sage-4.7.2.alpha4/local/bin/sage-eval", line 4, in <module>
+    from sage.all import *
+  File "/usr/local/src/sage-4.7.2.alpha4/local/lib/python2.6/site-packages/sage/all.py", line 68, in <module>
+    from sage.misc.all       import *         # takes a while
+  File "/usr/local/src/sage-4.7.2.alpha4/local/lib/python2.6/site-packages/sage/misc/all.py", line 81, in <module>
+    from functional import (additive_order,
+  File "/usr/local/src/sage-4.7.2.alpha4/local/lib/python2.6/site-packages/sage/misc/functional.py", line 36, in <module>
+    from sage.rings.complex_double import CDF
+  File "integer.pxd", line 9, in init sage.rings.complex_double (sage/rings/complex_double.c:14716)
+ImportError: libgmp.so.8: cannot open shared object file: No such file or directory
+Sage failed to start up.
+Please email sage-devel (http://groups.google.com/group/sage-devel)
+explaining the problem and send the log file
+  /usr/local/src/sage-4.7.2.alpha4/start.log
+Describe your computer, operating system, etc.
+spkg/pipestatus: line 44: [: -ne: unary operator expected
+make: *** [ptestlong] Error 1
+\`\`\`
+
+Note the penultimate line.
+
+The attached patch also:
+1. removes \`sage-starts\` from \`sage -tp\`, because running \`make ptest\` or \`make ptestlong\` already runs \`sage-starts\`.
+2. ensures that \`make test\` and all variants run \`./sage -b\` before doing the testing.
+3. adds \`make testalllong\` and \`make ptestalllong\` for completeness.
+
+**Apply**:
+1. [attachment:11969_testprelims.patch] to **SAGE_ROOT**
+2. [attachment:11969_scripts.patch] to **scripts**
 
 Author: Jeroen Demeyer
 
```




---

archive/issue_comments_142411.json:
```json
{
    "body": "<a id='comment:9'></a>I made some additional changes to the top-level `Makefile`, needs_review",
    "created_at": "2011-10-31T18:03:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11969#issuecomment-142411",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>I made some additional changes to the top-level `Makefile`, needs_review



---

archive/issue_comments_142412.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-10-31T18:03:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11969#issuecomment-142412",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_142413.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,43 @@\n+Using \\`&&\\` inside commands for pipestatus does not work.  Therefore, in the top-level Makefile, we should move \\`$(TESTPRELIMS)\\` out of \\`$(PIPE)\\`.\n \n+For example, if \\`sage-starts\\` fails, one would get\n+\n+\\`\\`\\`\n+$ make ptestlong\n+[...]\n+spkg/pipestatus \". local/bin/sage-env && sage-starts && ./sage -tp 0  -sagenb -long devel/sage/doc/common devel/sage/doc/de devel/sage/doc/en devel/sage/doc/fr devel/sage/doc/ru devel/sage/sage 2>&1\" \"tee -a ptestlong.log\"\n+\n+Testing that Sage starts...\n+Traceback (most recent call last):\n+  File \"/usr/local/src/sage-4.7.2.alpha4/local/bin/sage-eval\", line 4, in <module>\n+    from sage.all import *\n+  File \"/usr/local/src/sage-4.7.2.alpha4/local/lib/python2.6/site-packages/sage/all.py\", line 68, in <module>\n+    from sage.misc.all       import *         # takes a while\n+  File \"/usr/local/src/sage-4.7.2.alpha4/local/lib/python2.6/site-packages/sage/misc/all.py\", line 81, in <module>\n+    from functional import (additive_order,\n+  File \"/usr/local/src/sage-4.7.2.alpha4/local/lib/python2.6/site-packages/sage/misc/functional.py\", line 36, in <module>\n+    from sage.rings.complex_double import CDF\n+  File \"integer.pxd\", line 9, in init sage.rings.complex_double (sage/rings/complex_double.c:14716)\n+ImportError: libgmp.so.8: cannot open shared object file: No such file or directory\n+Sage failed to start up.\n+Please email sage-devel (http://groups.google.com/group/sage-devel)\n+explaining the problem and send the log file\n+  /usr/local/src/sage-4.7.2.alpha4/start.log\n+Describe your computer, operating system, etc.\n+spkg/pipestatus: line 44: [: -ne: unary operator expected\n+make: *** [ptestlong] Error 1\n+\\`\\`\\`\n+\n+Note the penultimate line.\n+\n+The attached patch also:\n+1. removes \\`sage-starts\\` from \\`sage -tp\\`, because running \\`make ptest\\` or \\`make ptestlong\\` already runs \\`sage-starts\\`.\n+2. runs \\`./sage -b\\` in the \\`make build\\` rule.  This ensures that the Sage library is up-to-date when testing or building documentation.\n+3. adds \\`make testalllong\\` and \\`make ptestalllong\\` for completeness.\n+\n+**Apply**:\n+1. [attachment:11969_testprelims.patch] to **SAGE_ROOT**\n+2. [attachment:11969_scripts.patch] to **scripts**\n \n Author: Jeroen Demeyer\n \n```\n",
    "created_at": "2011-10-31T18:10:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11969#issuecomment-142413",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,43 @@
+Using \`&&\` inside commands for pipestatus does not work.  Therefore, in the top-level Makefile, we should move \`$(TESTPRELIMS)\` out of \`$(PIPE)\`.
 
+For example, if \`sage-starts\` fails, one would get
+
+\`\`\`
+$ make ptestlong
+[...]
+spkg/pipestatus ". local/bin/sage-env && sage-starts && ./sage -tp 0  -sagenb -long devel/sage/doc/common devel/sage/doc/de devel/sage/doc/en devel/sage/doc/fr devel/sage/doc/ru devel/sage/sage 2>&1" "tee -a ptestlong.log"
+
+Testing that Sage starts...
+Traceback (most recent call last):
+  File "/usr/local/src/sage-4.7.2.alpha4/local/bin/sage-eval", line 4, in <module>
+    from sage.all import *
+  File "/usr/local/src/sage-4.7.2.alpha4/local/lib/python2.6/site-packages/sage/all.py", line 68, in <module>
+    from sage.misc.all       import *         # takes a while
+  File "/usr/local/src/sage-4.7.2.alpha4/local/lib/python2.6/site-packages/sage/misc/all.py", line 81, in <module>
+    from functional import (additive_order,
+  File "/usr/local/src/sage-4.7.2.alpha4/local/lib/python2.6/site-packages/sage/misc/functional.py", line 36, in <module>
+    from sage.rings.complex_double import CDF
+  File "integer.pxd", line 9, in init sage.rings.complex_double (sage/rings/complex_double.c:14716)
+ImportError: libgmp.so.8: cannot open shared object file: No such file or directory
+Sage failed to start up.
+Please email sage-devel (http://groups.google.com/group/sage-devel)
+explaining the problem and send the log file
+  /usr/local/src/sage-4.7.2.alpha4/start.log
+Describe your computer, operating system, etc.
+spkg/pipestatus: line 44: [: -ne: unary operator expected
+make: *** [ptestlong] Error 1
+\`\`\`
+
+Note the penultimate line.
+
+The attached patch also:
+1. removes \`sage-starts\` from \`sage -tp\`, because running \`make ptest\` or \`make ptestlong\` already runs \`sage-starts\`.
+2. runs \`./sage -b\` in the \`make build\` rule.  This ensures that the Sage library is up-to-date when testing or building documentation.
+3. adds \`make testalllong\` and \`make ptestalllong\` for completeness.
+
+**Apply**:
+1. [attachment:11969_testprelims.patch] to **SAGE_ROOT**
+2. [attachment:11969_scripts.patch] to **scripts**
 
 Author: Jeroen Demeyer
 
```




---

archive/issue_comments_142414.json:
```json
{
    "body": "<a id='comment:11'></a>I'm wary of not running sage-starts as part of \"sage -tp\".  It was introduced in #7103 to fix a problem when someone ran \"sage -tp\" before actually running Sage.  I can see someone doing \"make build\" and then \"./sage -tp ...\" in order to test whether a new Sage build fixes problems in a particular directory.",
    "created_at": "2011-10-31T20:36:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11969#issuecomment-142414",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:11'></a>I'm wary of not running sage-starts as part of "sage -tp".  It was introduced in #7103 to fix a problem when someone ran "sage -tp" before actually running Sage.  I can see someone doing "make build" and then "./sage -tp ..." in order to test whether a new Sage build fixes problems in a particular directory.



---

archive/issue_comments_142415.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:11 jhpalmieri]:\n> I can see someone doing \"make build\" and then \"./sage -tp ...\" in order to test whether a new Sage build fixes problems in a particular directory.\n\n\nThen all those tests would fail.  Is that a problem?\n\nIn all seriousness: I can see some arguments supporting `sage-starts` before `./sage -tp [...]`.  But then we should **also** do that for `./sage -t [...]`.  I value consistency and predictability very high, I prefer either \"always\" or \"never\" to anything in between.",
    "created_at": "2011-10-31T22:37:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11969#issuecomment-142415",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>Replying to [comment:11 jhpalmieri]:
> I can see someone doing "make build" and then "./sage -tp ..." in order to test whether a new Sage build fixes problems in a particular directory.


Then all those tests would fail.  Is that a problem?

In all seriousness: I can see some arguments supporting `sage-starts` before `./sage -tp [...]`.  But then we should **also** do that for `./sage -t [...]`.  I value consistency and predictability very high, I prefer either "always" or "never" to anything in between.



---

archive/issue_comments_142416.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:12 jdemeyer]:\n> Replying to [comment:11 jhpalmieri]:\n> > I can see someone doing \"make build\" and then \"./sage -tp ...\" in order to test whether a new Sage build fixes problems in a particular directory.\n\n> \n> Then all those tests would fail.  Is that a problem?\n\n\nNo, the problem is that you might get this:\n\n```\nA mysterious error (perhaps a memory error?) occurred, which may have crashed doctest.\n```\nAnd you get it from a race condition, where multiple processes are simultaneously trying to create the same subdirectories of .sage.  So it doesn't occur when you do \"sage -t\", only \"sage -tp\".",
    "created_at": "2011-10-31T22:43:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11969#issuecomment-142416",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:13'></a>Replying to [comment:12 jdemeyer]:
> Replying to [comment:11 jhpalmieri]:
> > I can see someone doing "make build" and then "./sage -tp ..." in order to test whether a new Sage build fixes problems in a particular directory.

> 
> Then all those tests would fail.  Is that a problem?


No, the problem is that you might get this:

```
A mysterious error (perhaps a memory error?) occurred, which may have crashed doctest.
```
And you get it from a race condition, where multiple processes are simultaneously trying to create the same subdirectories of .sage.  So it doesn't occur when you do "sage -t", only "sage -tp".



---

archive/issue_comments_142417.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:6 jdemeyer]:\n> I noticed that `make ptestlong` actually runs `sage-starts` **twice**: once from the `Makefile` and once from `sage-sage`.\n> \n> I propose **not** to run `sage-starts` when the user explicitly runs\n\n{{{\n$ ./sage -tp [...]\n}}}\n> but to run `sage-starts` only when the user does\n\n{{{\n$ make ptestlong\n}}}\n> \n> The rationale is that `sage -tp` is often done with one or few files and then the overhead of `sage-starts` might be significant.  However, for a `make ptestlong` run, running `sage-starts` once does not really impact the testing time.\n\n\nYes, definitely, i.e. remove it from `sage-sage`.",
    "created_at": "2011-10-31T22:45:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11969#issuecomment-142417",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:14'></a>Replying to [comment:6 jdemeyer]:
> I noticed that `make ptestlong` actually runs `sage-starts` **twice**: once from the `Makefile` and once from `sage-sage`.
> 
> I propose **not** to run `sage-starts` when the user explicitly runs

{{{
$ ./sage -tp [...]
}}}
> but to run `sage-starts` only when the user does

{{{
$ make ptestlong
}}}
> 
> The rationale is that `sage -tp` is often done with one or few files and then the overhead of `sage-starts` might be significant.  However, for a `make ptestlong` run, running `sage-starts` once does not really impact the testing time.


Yes, definitely, i.e. remove it from `sage-sage`.



---

archive/issue_comments_142418.json:
```json
{
    "body": "<a id='comment:15'></a>Rebased to #11926.",
    "created_at": "2011-10-31T22:49:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11969#issuecomment-142418",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>Rebased to #11926.



---

archive/issue_comments_142419.json:
```json
{
    "body": "<a id='comment:16'></a>Replying to [comment:13 jhpalmieri]:\n> And you get it from a race condition, where multiple processes are simultaneously trying to create the same subdirectories of .sage.\n\n\nHow is this solved by running `sage-starts`?  I would assume that a user doing `./sage -tp` has already ran Sage at least once.  And it also seems that #11926 should solve precisely this problem (except in the rare case where the changed code has to do with creating directories in the Sage startup).\n\nAlso, such a race condition is a bug in Sage.  If you have more information about when it occurs and for which directories, we can look into this.  (I find it *very* annoying that Python doesn't seem to have an equivalent of `mkdir -p`, making a directory but not complaining if it exists).",
    "created_at": "2011-10-31T22:59:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11969#issuecomment-142419",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>Replying to [comment:13 jhpalmieri]:
> And you get it from a race condition, where multiple processes are simultaneously trying to create the same subdirectories of .sage.


How is this solved by running `sage-starts`?  I would assume that a user doing `./sage -tp` has already ran Sage at least once.  And it also seems that #11926 should solve precisely this problem (except in the rare case where the changed code has to do with creating directories in the Sage startup).

Also, such a race condition is a bug in Sage.  If you have more information about when it occurs and for which directories, we can look into this.  (I find it *very* annoying that Python doesn't seem to have an equivalent of `mkdir -p`, making a directory but not complaining if it exists).



---

archive/issue_comments_142420.json:
```json
{
    "body": "<a id='comment:17'></a>Sorry, hadn't read John's comments before my last post.\n\nBut IMHO, if there are race conditions in creating directories (in `$DOT_SAGE/`), the race conditions should get fixed instead of using dumb work-arounds that are hardly ever necessary.\n\nNote that e.g. only `sage-ptest` supports `SAGE_TEST_ITER`.",
    "created_at": "2011-10-31T23:03:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11969#issuecomment-142420",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:17'></a>Sorry, hadn't read John's comments before my last post.

But IMHO, if there are race conditions in creating directories (in `$DOT_SAGE/`), the race conditions should get fixed instead of using dumb work-arounds that are hardly ever necessary.

Note that e.g. only `sage-ptest` supports `SAGE_TEST_ITER`.



---

archive/issue_comments_142421.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [comment:16 jdemeyer]:\n> Replying to [comment:13 jhpalmieri]:\n> > And you get it from a race condition, where multiple processes are simultaneously trying to create the same subdirectories of .sage.\n\n> \n> I would assume that a user doing `./sage -tp` has already ran Sage at least once.  And it also seems that #11926 should solve precisely this problem (except in the rare case where the changed code has to do with creating directories in the Sage startup).\n\n\nThis doesn't help if `$DOT_SAGE` differs, e.g. because the user changed the variable's setting, or it's just a different user that runs Sage [for the first time maybe, or deleted his previous `.sage`, or there are new directories to create].",
    "created_at": "2011-10-31T23:15:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11969#issuecomment-142421",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:18'></a>Replying to [comment:16 jdemeyer]:
> Replying to [comment:13 jhpalmieri]:
> > And you get it from a race condition, where multiple processes are simultaneously trying to create the same subdirectories of .sage.

> 
> I would assume that a user doing `./sage -tp` has already ran Sage at least once.  And it also seems that #11926 should solve precisely this problem (except in the rare case where the changed code has to do with creating directories in the Sage startup).


This doesn't help if `$DOT_SAGE` differs, e.g. because the user changed the variable's setting, or it's just a different user that runs Sage [for the first time maybe, or deleted his previous `.sage`, or there are new directories to create].



---

archive/issue_comments_142422.json:
```json
{
    "body": "<a id='comment:19'></a>> If you have more information about when it occurs and for which directories, we can look into this.\n\n\nYou could look at #7103, as I mentioned above, and to #7079, to which #7103 refers.\n\n> I find it very annoying that Python doesn't seem to have an equivalent of mkdir -p, making a directory but not complaining if it exists\n\n\nSee #11972.  I think the patch there should also take care of the race conditions when creating DOT_SAGE and its various subdirectories, which seemed to be the problem with #7103.  One way to test: remove the sage-starts code from the doctesting routines and set DOT_SAGE to a non-existing directory and run \"sage -tp ...\".  Repeat many times and see if you ever get \"mysterious errors\".  Then apply the patch at #11972 and see if that fixes it.\n\nIf this fixes it, then I'm willing to make #11972 a prerequisite for this ticket and remove the execution of sage-starts from sage-sage.  But I'm not willing to remove sage-starts unless we're pretty sure that we haven't reintroduced a possible bug in doctesting.",
    "created_at": "2011-11-01T04:24:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11969#issuecomment-142422",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:19'></a>> If you have more information about when it occurs and for which directories, we can look into this.


You could look at #7103, as I mentioned above, and to #7079, to which #7103 refers.

> I find it very annoying that Python doesn't seem to have an equivalent of mkdir -p, making a directory but not complaining if it exists


See #11972.  I think the patch there should also take care of the race conditions when creating DOT_SAGE and its various subdirectories, which seemed to be the problem with #7103.  One way to test: remove the sage-starts code from the doctesting routines and set DOT_SAGE to a non-existing directory and run "sage -tp ...".  Repeat many times and see if you ever get "mysterious errors".  Then apply the patch at #11972 and see if that fixes it.

If this fixes it, then I'm willing to make #11972 a prerequisite for this ticket and remove the execution of sage-starts from sage-sage.  But I'm not willing to remove sage-starts unless we're pretty sure that we haven't reintroduced a possible bug in doctesting.



---

archive/issue_comments_142423.json:
```json
{
    "body": "Attachment [11969_testprelims.patch](tarball://root/attachments/some-uuid/ticket11969/11969_testprelims.patch) by @jdemeyer created at 2011-11-01 09:57:49",
    "created_at": "2011-11-01T09:57:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11969#issuecomment-142423",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [11969_testprelims.patch](tarball://root/attachments/some-uuid/ticket11969/11969_testprelims.patch) by @jdemeyer created at 2011-11-01 09:57:49



---

archive/issue_comments_142424.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,44 @@\n+Using \\`&&\\` inside commands for pipestatus does not work.  Therefore, in the top-level Makefile, we should move \\`$(TESTPRELIMS)\\` out of \\`$(PIPE)\\`.\n \n+For example, if \\`sage-starts\\` fails, one would get\n+\n+\\`\\`\\`\n+$ make ptestlong\n+[...]\n+spkg/pipestatus \". local/bin/sage-env && sage-starts && ./sage -tp 0  -sagenb -long devel/sage/doc/common devel/sage/doc/de devel/sage/doc/en devel/sage/doc/fr devel/sage/doc/ru devel/sage/sage 2>&1\" \"tee -a ptestlong.log\"\n+\n+Testing that Sage starts...\n+Traceback (most recent call last):\n+  File \"/usr/local/src/sage-4.7.2.alpha4/local/bin/sage-eval\", line 4, in <module>\n+    from sage.all import *\n+  File \"/usr/local/src/sage-4.7.2.alpha4/local/lib/python2.6/site-packages/sage/all.py\", line 68, in <module>\n+    from sage.misc.all       import *         # takes a while\n+  File \"/usr/local/src/sage-4.7.2.alpha4/local/lib/python2.6/site-packages/sage/misc/all.py\", line 81, in <module>\n+    from functional import (additive_order,\n+  File \"/usr/local/src/sage-4.7.2.alpha4/local/lib/python2.6/site-packages/sage/misc/functional.py\", line 36, in <module>\n+    from sage.rings.complex_double import CDF\n+  File \"integer.pxd\", line 9, in init sage.rings.complex_double (sage/rings/complex_double.c:14716)\n+ImportError: libgmp.so.8: cannot open shared object file: No such file or directory\n+Sage failed to start up.\n+Please email sage-devel (http://groups.google.com/group/sage-devel)\n+explaining the problem and send the log file\n+  /usr/local/src/sage-4.7.2.alpha4/start.log\n+Describe your computer, operating system, etc.\n+spkg/pipestatus: line 44: [: -ne: unary operator expected\n+make: *** [ptestlong] Error 1\n+\\`\\`\\`\n+\n+Note the penultimate line.\n+\n+The attached patch also:\n+1. removes \\`sage-starts\\` from \\`sage -tp\\`, because running \\`make ptest\\` or \\`make ptestlong\\` already runs \\`sage-starts\\`.\n+2. runs \\`./sage -b\\` in the \\`make build\\` rule.  This ensures that the Sage library is up-to-date when testing or building documentation.\n+3. adds \\`make testalllong\\` and \\`make ptestalllong\\` for completeness.\n+4. generally cleans up the \\`Makefile\\`.\n+\n+**Apply**:\n+1. [attachment:11969_testprelims.patch] to **SAGE_ROOT**\n+2. [attachment:11969_scripts.patch] to **scripts**\n \n Author: Jeroen Demeyer\n \n```\n",
    "created_at": "2011-11-01T09:58:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11969#issuecomment-142424",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,44 @@
+Using \`&&\` inside commands for pipestatus does not work.  Therefore, in the top-level Makefile, we should move \`$(TESTPRELIMS)\` out of \`$(PIPE)\`.
 
+For example, if \`sage-starts\` fails, one would get
+
+\`\`\`
+$ make ptestlong
+[...]
+spkg/pipestatus ". local/bin/sage-env && sage-starts && ./sage -tp 0  -sagenb -long devel/sage/doc/common devel/sage/doc/de devel/sage/doc/en devel/sage/doc/fr devel/sage/doc/ru devel/sage/sage 2>&1" "tee -a ptestlong.log"
+
+Testing that Sage starts...
+Traceback (most recent call last):
+  File "/usr/local/src/sage-4.7.2.alpha4/local/bin/sage-eval", line 4, in <module>
+    from sage.all import *
+  File "/usr/local/src/sage-4.7.2.alpha4/local/lib/python2.6/site-packages/sage/all.py", line 68, in <module>
+    from sage.misc.all       import *         # takes a while
+  File "/usr/local/src/sage-4.7.2.alpha4/local/lib/python2.6/site-packages/sage/misc/all.py", line 81, in <module>
+    from functional import (additive_order,
+  File "/usr/local/src/sage-4.7.2.alpha4/local/lib/python2.6/site-packages/sage/misc/functional.py", line 36, in <module>
+    from sage.rings.complex_double import CDF
+  File "integer.pxd", line 9, in init sage.rings.complex_double (sage/rings/complex_double.c:14716)
+ImportError: libgmp.so.8: cannot open shared object file: No such file or directory
+Sage failed to start up.
+Please email sage-devel (http://groups.google.com/group/sage-devel)
+explaining the problem and send the log file
+  /usr/local/src/sage-4.7.2.alpha4/start.log
+Describe your computer, operating system, etc.
+spkg/pipestatus: line 44: [: -ne: unary operator expected
+make: *** [ptestlong] Error 1
+\`\`\`
+
+Note the penultimate line.
+
+The attached patch also:
+1. removes \`sage-starts\` from \`sage -tp\`, because running \`make ptest\` or \`make ptestlong\` already runs \`sage-starts\`.
+2. runs \`./sage -b\` in the \`make build\` rule.  This ensures that the Sage library is up-to-date when testing or building documentation.
+3. adds \`make testalllong\` and \`make ptestalllong\` for completeness.
+4. generally cleans up the \`Makefile\`.
+
+**Apply**:
+1. [attachment:11969_testprelims.patch] to **SAGE_ROOT**
+2. [attachment:11969_scripts.patch] to **scripts**
 
 Author: Jeroen Demeyer
 
```




---

archive/issue_comments_142425.json:
```json
{
    "body": "Milestone sage-4.7.3 deleted",
    "created_at": "2011-11-03T16:14:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11969#issuecomment-142425",
    "user": "https://github.com/jdemeyer"
}
```

Milestone sage-4.7.3 deleted



---

archive/issue_comments_142426.json:
```json
{
    "body": "<a id='comment:25'></a>This all looks good to me, and I'm happy with the patch to the scripts repo now that #11972 is merged.",
    "created_at": "2011-11-12T18:30:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11969#issuecomment-142426",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:25'></a>This all looks good to me, and I'm happy with the patch to the scripts repo now that #11972 is merged.



---

archive/issue_events_031690.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2011-11-12T18:30:24Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11969",
    "milestone": "sage-4.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11969#event-31690"
}
```



---

archive/issue_comments_142427.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-11-12T18:30:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11969#issuecomment-142427",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_142428.json:
```json
{
    "body": "<a id='comment:26'></a>Replying to [comment:25 jhpalmieri]:\n> This all looks good to me, and I'm happy with the patch to the scripts repo now that #11972 is merged.\n\n\nThanks for the review!",
    "created_at": "2011-11-14T08:27:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11969#issuecomment-142428",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:26'></a>Replying to [comment:25 jhpalmieri]:
> This all looks good to me, and I'm happy with the patch to the scripts repo now that #11972 is merged.


Thanks for the review!



---

archive/issue_events_031691.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-11-14T17:32:28Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11969",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11969#event-31691"
}
```



---

archive/issue_comments_142429.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-11-14T17:32:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11969",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11969#issuecomment-142429",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
