# Issue 11683: ell_curve_isogeny initialization

archive/issues_011511.json:
```json
{
    "body": "The import of sage/schemes/elliptic_curves/ell_curve_isogeny.py (which happens on every startup of sage) takes a relatively big amount of time\n\n```\n$ time ./sage -startuptime|grep ell_curve_isogeny:\n          ell_curve_isogeny: 0.133 (ell_field)\n\nreal    0m0.994s\nuser    0m0.810s\nsys     0m0.154s\n```\nLazily computing the constants in this file helps a lot (see the attached patch):\n\n```\n$ time ./sage -startuptime|grep ell_curve_isogeny:\n          ell_curve_isogeny: 0.001 (ell_field)\n\nreal    0m0.849s\nuser    0m0.672s\nsys     0m0.164s\n```\n**Apply:**\n\n1. [attachment:trac_11683_ell_curve_isogeny_speedup_combined.patch]\n2. [attachment:trac_11683_review.patch]\n\nto the sage repository.\n\nAssignee: @JohnCremona\n\nCC:  fschulze\n\nKeywords: startup, initialization, sd32, sd35\n\nResolution: fixed\n\nAuthor: Julian Rueth, John Cremona\n\nReviewer: Julian Rueth, Frithjof Schulze\n\nMerged: sage-5.0.beta7\n\nIssue created by migration from https://trac.sagemath.org/ticket/11683\n\n",
    "closed_at": "2012-03-04T21:19:33Z",
    "created_at": "2011-08-12T18:03:30Z",
    "labels": [
        "component: elliptic curves",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.0",
    "title": "ell_curve_isogeny initialization",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11683",
    "user": "https://github.com/saraedum"
}
```
The import of sage/schemes/elliptic_curves/ell_curve_isogeny.py (which happens on every startup of sage) takes a relatively big amount of time

```
$ time ./sage -startuptime|grep ell_curve_isogeny:
          ell_curve_isogeny: 0.133 (ell_field)

real    0m0.994s
user    0m0.810s
sys     0m0.154s
```
Lazily computing the constants in this file helps a lot (see the attached patch):

```
$ time ./sage -startuptime|grep ell_curve_isogeny:
          ell_curve_isogeny: 0.001 (ell_field)

real    0m0.849s
user    0m0.672s
sys     0m0.164s
```
**Apply:**

1. [attachment:trac_11683_ell_curve_isogeny_speedup_combined.patch]
2. [attachment:trac_11683_review.patch]

to the sage repository.

Assignee: @JohnCremona

CC:  fschulze

Keywords: startup, initialization, sd32, sd35

Resolution: fixed

Author: Julian Rueth, John Cremona

Reviewer: Julian Rueth, Frithjof Schulze

Merged: sage-5.0.beta7

Issue created by migration from https://trac.sagemath.org/ticket/11683





---

archive/issue_comments_135927.json:
```json
{
    "body": "<a id='comment:1'></a>Attachment [trac_11683_ell_curve_isogeny_speedup.patch](tarball://root/attachments/some-uuid/ticket11683/trac_11683_ell_curve_isogeny_speedup.patch) by @robertwb created at 2011-08-23 06:25:28\n\nI would like to see the initial comments placed in context, and perhaps a doctest for the actual computation of Psi5 (even if it takes 4s). In any case, you do need doctests.",
    "created_at": "2011-08-23T06:25:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11683#issuecomment-135927",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:1'></a>Attachment [trac_11683_ell_curve_isogeny_speedup.patch](tarball://root/attachments/some-uuid/ticket11683/trac_11683_ell_curve_isogeny_speedup.patch) by @robertwb created at 2011-08-23 06:25:28

I would like to see the initial comments placed in context, and perhaps a doctest for the actual computation of Psi5 (even if it takes 4s). In any case, you do need doctests.



---

archive/issue_comments_135928.json:
```json
{
    "body": "<a id='comment:2'></a>Attachment [trac_11683_ell_curve_isogeny_speedup_docstrings.patch](tarball://root/attachments/some-uuid/ticket11683/trac_11683_ell_curve_isogeny_speedup_docstrings.patch) by @saraedum created at 2011-08-24 18:09:07\n\nYou're right. I turned the comments describing how to compute the precomputed things into docstrings. Unfortunately they don't seem to work anymore. The line\n\n```\nsage: Psi5 = sum([X**i * f.coefficient({x:i})(X,t) for i in range(3)]).monic()\n```\nfails with\n\n```\nAttributeError: 'sage.rings.polynomial.multi_polynomial_libsingular.MPolynomial_libsingular' object has no attribute 'monic'\n```\n\nCan this be fixed easily?",
    "created_at": "2011-08-24T18:09:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11683#issuecomment-135928",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:2'></a>Attachment [trac_11683_ell_curve_isogeny_speedup_docstrings.patch](tarball://root/attachments/some-uuid/ticket11683/trac_11683_ell_curve_isogeny_speedup_docstrings.patch) by @saraedum created at 2011-08-24 18:09:07

You're right. I turned the comments describing how to compute the precomputed things into docstrings. Unfortunately they don't seem to work anymore. The line

```
sage: Psi5 = sum([X**i * f.coefficient({x:i})(X,t) for i in range(3)]).monic()
```
fails with

```
AttributeError: 'sage.rings.polynomial.multi_polynomial_libsingular.MPolynomial_libsingular' object has no attribute 'monic'
```

Can this be fixed easily?



---

archive/issue_comments_135929.json:
```json
{
    "body": "<a id='comment:4'></a>**Complaint:**\n\nYou completely deleted the following comment from the code:\n\n```\n3887\t \t# Since these take some time to compute (480s for l=7, ?? for l=13) we \n3888\t \t# precompute them.  Here is how they may be computed: \n...\n[explanation of how precomputing can be done]\n```",
    "created_at": "2011-08-24T18:59:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11683#issuecomment-135929",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:4'></a>**Complaint:**

You completely deleted the following comment from the code:

```
3887	 	# Since these take some time to compute (480s for l=7, ?? for l=13) we 
3888	 	# precompute them.  Here is how they may be computed: 
...
[explanation of how precomputing can be done]
```



---

archive/issue_comments_135930.json:
```json
{
    "body": "<a id='comment:5'></a>(and I think a comment about how big precomputations were done is the most important thing to keep.)",
    "created_at": "2011-08-24T19:00:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11683#issuecomment-135930",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:5'></a>(and I think a comment about how big precomputations were done is the most important thing to keep.)



---

archive/issue_comments_135931.json:
```json
{
    "body": "<a id='comment:6'></a>Wow, I completely missed the boat there. Never mind regarding my above comments.  They are the same as Robert's.",
    "created_at": "2011-08-24T19:01:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11683#issuecomment-135931",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:6'></a>Wow, I completely missed the boat there. Never mind regarding my above comments.  They are the same as Robert's.



---

archive/issue_comments_135932.json:
```json
{
    "body": "<a id='comment:7'></a>The claimed code for pre-computing Psi does not work at all.   Even changing the monic() part to do what is intended totally fails to give the claimed result.   Some remarks:\n\n1. This code was originally introduced by John Cremona and his undergrad student in #6887, and given a positive review by Christian Wuthrich.  At that point the comment about how to compute the polys should have been changed to a doctest.  Oops.\n\n2. One could not use the examples (if they worked) to compute more values of Psi, since they depend on the Fricke module table, which is only computed up to ell=13.  \n\n3. The definition and meaning of Psi should be documented.  I spent maybe 30 minutes wondering and searching, and I still am not completely sure *precisely* what Psi even is...\n\nSo I suggest removing these broken examples from the second patch, then setting this patch as \"needs review\".  I'll ping John Cremona and request that he add an appropriate doctest illustrating how to compute Psi, and documenting what it is.  I'm betting this will be really trivial for him to do. (I'm surprised it wasn't for me, because I just did a lot with explicit isogenies for an REU this summer... but it wasn't.)",
    "created_at": "2011-08-24T19:58:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11683#issuecomment-135932",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:7'></a>The claimed code for pre-computing Psi does not work at all.   Even changing the monic() part to do what is intended totally fails to give the claimed result.   Some remarks:

1. This code was originally introduced by John Cremona and his undergrad student in #6887, and given a positive review by Christian Wuthrich.  At that point the comment about how to compute the polys should have been changed to a doctest.  Oops.

2. One could not use the examples (if they worked) to compute more values of Psi, since they depend on the Fricke module table, which is only computed up to ell=13.  

3. The definition and meaning of Psi should be documented.  I spent maybe 30 minutes wondering and searching, and I still am not completely sure *precisely* what Psi even is...

So I suggest removing these broken examples from the second patch, then setting this patch as "needs review".  I'll ping John Cremona and request that he add an appropriate doctest illustrating how to compute Psi, and documenting what it is.  I'm betting this will be really trivial for him to do. (I'm surprised it wasn't for me, because I just did a lot with explicit isogenies for an REU this summer... but it wasn't.)



---

archive/issue_comments_135933.json:
```json
{
    "body": "<a id='comment:8'></a>I pinged John Cremona, whose computer responded \"I am away and will not have internet access until 31 August.\"",
    "created_at": "2011-08-24T20:00:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11683#issuecomment-135933",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:8'></a>I pinged John Cremona, whose computer responded "I am away and will not have internet access until 31 August."



---

archive/issue_comments_135934.json:
```json
{
    "body": "Changing keywords from \"startup, initialization\" to \"startup, initialization, sd32\".",
    "created_at": "2011-08-24T23:30:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11683#issuecomment-135934",
    "user": "https://github.com/williamstein"
}
```

Changing keywords from "startup, initialization" to "startup, initialization, sd32".



---

archive/issue_comments_135935.json:
```json
{
    "body": "<a id='comment:10'></a>Sorry for the delay.  I'll document this better and make sure that the current documentation and description of the precomputation fits the existing code -- there are some choice to be made.  Meanwhile, here's a small amount of explanatory theory:\n\nFor l=2,3,5,7,13, the curve `X_0(l)` has genus zero, so its function field is pure transcendental.  The Fricke Module, denoted t, is a generator of the function field such that t=0 and t=oo lie above j=oo; the normalization here is completely classical, and the situation is fully defined by giving j as a degree l+1 rational function in t, which is what the Fricke_module dict in the code does (though not for l=2 which is simpler and handled entirely separately).\n\nNext one writes down a \"universal elliptic curve with l-isogeny\", say `E_t`, as a curve over Q(t) with j-invariant j (viewed as an element of Q(t)).  This is not unique!  I have used different choices in the past and this needs sorting out since the later formulas depend on the choice.  A good choice is one such that `E_t` is defined and with good reduction at all t except t=0 and t=oo (which are irrelevant since those values correspond to j=oo);  but one is forced to also have bad reduction at values of t above j=0 and j=1728 when l=1 (mod 3, resp. 4).  Once the model for `E_t` is chosen, Psi is the monic factor of degree (l-1)/2 of the l-division polynomial of `E_t` which defined the isogeny, and which is used in the isogeny code.\n\nI am writing this up -- there's an old preprint of me and Mark Watkins which never got finished, and now there's more delay since with my student Kimi I am extending all this to the cases where `X_0(l)` is hyperelliptic.",
    "created_at": "2011-09-03T17:22:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11683#issuecomment-135935",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:10'></a>Sorry for the delay.  I'll document this better and make sure that the current documentation and description of the precomputation fits the existing code -- there are some choice to be made.  Meanwhile, here's a small amount of explanatory theory:

For l=2,3,5,7,13, the curve `X_0(l)` has genus zero, so its function field is pure transcendental.  The Fricke Module, denoted t, is a generator of the function field such that t=0 and t=oo lie above j=oo; the normalization here is completely classical, and the situation is fully defined by giving j as a degree l+1 rational function in t, which is what the Fricke_module dict in the code does (though not for l=2 which is simpler and handled entirely separately).

Next one writes down a "universal elliptic curve with l-isogeny", say `E_t`, as a curve over Q(t) with j-invariant j (viewed as an element of Q(t)).  This is not unique!  I have used different choices in the past and this needs sorting out since the later formulas depend on the choice.  A good choice is one such that `E_t` is defined and with good reduction at all t except t=0 and t=oo (which are irrelevant since those values correspond to j=oo);  but one is forced to also have bad reduction at values of t above j=0 and j=1728 when l=1 (mod 3, resp. 4).  Once the model for `E_t` is chosen, Psi is the monic factor of degree (l-1)/2 of the l-division polynomial of `E_t` which defined the isogeny, and which is used in the isogeny code.

I am writing this up -- there's an old preprint of me and Mark Watkins which never got finished, and now there's more delay since with my student Kimi I am extending all this to the cases where `X_0(l)` is hyperelliptic.



---

archive/issue_comments_135936.json:
```json
{
    "body": "<a id='comment:11'></a>I am currently working on this and will upload a patch when done.",
    "created_at": "2011-09-28T14:56:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11683#issuecomment-135936",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:11'></a>I am currently working on this and will upload a patch when done.



---

archive/issue_comments_135937.json:
```json
{
    "body": "<a id='comment:12'></a>The new patch includes the first two.  I have added doctests which show that the cached values are correctly computed.  At the same time I simplified the generic kernels a lot by using a better model for the universal elliptic curve with l-isogeny (you should be able to see that a lot more is deleted than added in the patch).\n\nI added substantial explanation in the docstrings.  So I hope this will be acceptable!  (I forgot to check rebuilding the docs, and will do that now to try to catch any ReST markup problems.)",
    "created_at": "2011-09-29T15:54:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11683#issuecomment-135937",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:12'></a>The new patch includes the first two.  I have added doctests which show that the cached values are correctly computed.  At the same time I simplified the generic kernels a lot by using a better model for the universal elliptic curve with l-isogeny (you should be able to see that a lot more is deleted than added in the patch).

I added substantial explanation in the docstrings.  So I hope this will be acceptable!  (I forgot to check rebuilding the docs, and will do that now to try to catch any ReST markup problems.)



---

archive/issue_comments_135938.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -20,7 +20,9 @@\n sys     0m0.164s\n ```\n \n-Keywords: startup, initialization\n+**Apply:**\n+\n+1. [attachment:trac_11683_ell_curve_isogeny_speedup_combined.patch]\n \n Upstream: Not yet reported upstream; Will do shortly.\n \n```\n",
    "created_at": "2011-09-29T15:54:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11683#issuecomment-135938",
    "user": "https://github.com/JohnCremona"
}
```

Description changed:
```diff
--- 
+++ 
@@ -20,7 +20,9 @@
 sys     0m0.164s
 ```
 
-Keywords: startup, initialization
+**Apply:**
+
+1. [attachment:trac_11683_ell_curve_isogeny_speedup_combined.patch]
 
 Upstream: Not yet reported upstream; Will do shortly.
 
```




---

archive/issue_comments_135939.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-09-29T15:54:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11683#issuecomment-135939",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_135940.json:
```json
{
    "body": "Replaces both previous patches; applies to 4.7.2.alpha2",
    "created_at": "2011-09-29T16:19:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11683#issuecomment-135940",
    "user": "https://github.com/JohnCremona"
}
```

Replaces both previous patches; applies to 4.7.2.alpha2



---

archive/issue_comments_135941.json:
```json
{
    "body": "<a id='comment:13'></a>Attachment [trac_11683_ell_curve_isogeny_speedup_combined.patch](tarball://root/attachments/some-uuid/ticket11683/trac_11683_ell_curve_isogeny_speedup_combined.patch) by @JohnCremona created at 2011-09-29 16:20:02\n\nThere were some markup problems, now fixed and the patch replaced.",
    "created_at": "2011-09-29T16:20:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11683#issuecomment-135941",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:13'></a>Attachment [trac_11683_ell_curve_isogeny_speedup_combined.patch](tarball://root/attachments/some-uuid/ticket11683/trac_11683_ell_curve_isogeny_speedup_combined.patch) by @JohnCremona created at 2011-09-29 16:20:02

There were some markup problems, now fixed and the patch replaced.



---

archive/issue_comments_135942.json:
```json
{
    "body": "<a id='comment:14'></a>I can now compute the generic kernels in negligible time for l=2,3,5,7 and only 18s for l=13 (compared to over 10 hours!).  If people think it is worth it I will revise the patch accordingly.  Then we can test 2,3,5,7 every time and l=13 with a # long time tag.",
    "created_at": "2011-09-30T16:00:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11683#issuecomment-135942",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:14'></a>I can now compute the generic kernels in negligible time for l=2,3,5,7 and only 18s for l=13 (compared to over 10 hours!).  If people think it is worth it I will revise the patch accordingly.  Then we can test 2,3,5,7 every time and l=13 with a # long time tag.



---

archive/issue_comments_135943.json:
```json
{
    "body": "Changing keywords from \"startup, initialization, sd32\" to \"startup, initialization, sd32, sd35\".",
    "created_at": "2011-12-21T16:49:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11683#issuecomment-135943",
    "user": "https://github.com/saraedum"
}
```

Changing keywords from "startup, initialization, sd32" to "startup, initialization, sd32, sd35".



---

archive/issue_comments_135944.json:
```json
{
    "body": "<a id='comment:15'></a>Replying to [comment:14 cremona]:\n> I can now compute the generic kernels in negligible time for l=2,3,5,7 and only 18s for l=13 (compared to over 10 hours!).  If people think it is worth it I will revise the patch accordingly.  Then we can test 2,3,5,7 every time and l=13 with a # long time tag.\n\n\nJust a remark, it seems sage improved quite a bit on the underlying computation. It is quite a bit faster than 13 hours (that is what the docstring says) already:\n\n```\nsage: time a,b=Psi(13, use_stored=True),Psi(13, use_stored=False)\nTime: CPU 178.47 s, Wall: 178.51 s\nsage: a==b\nTrue\n```",
    "created_at": "2011-12-21T16:49:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11683#issuecomment-135944",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:15'></a>Replying to [comment:14 cremona]:
> I can now compute the generic kernels in negligible time for l=2,3,5,7 and only 18s for l=13 (compared to over 10 hours!).  If people think it is worth it I will revise the patch accordingly.  Then we can test 2,3,5,7 every time and l=13 with a # long time tag.


Just a remark, it seems sage improved quite a bit on the underlying computation. It is quite a bit faster than 13 hours (that is what the docstring says) already:

```
sage: time a,b=Psi(13, use_stored=True),Psi(13, use_stored=False)
Time: CPU 178.47 s, Wall: 178.51 s
sage: a==b
True
```



---

archive/issue_comments_135945.json:
```json
{
    "body": "<a id='comment:17'></a>[the docstring said \"10\" hours of course]\n\nWe fixed a few typos. Looking at the changes to `isogenies_prime_degree_genus_0()` we're wondering if this actually adds any new functionality/fixes a problem? If so, shouldn't there be a doctest for it?",
    "created_at": "2011-12-21T21:42:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11683#issuecomment-135945",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:17'></a>[the docstring said "10" hours of course]

We fixed a few typos. Looking at the changes to `isogenies_prime_degree_genus_0()` we're wondering if this actually adds any new functionality/fixes a problem? If so, shouldn't there be a doctest for it?



---

archive/issue_comments_135946.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2011-12-21T21:42:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11683#issuecomment-135946",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_135947.json:
```json
{
    "body": "fixes some typos",
    "created_at": "2011-12-21T21:44:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11683#issuecomment-135947",
    "user": "https://github.com/saraedum"
}
```

fixes some typos



---

archive/issue_comments_135948.json:
```json
{
    "body": "<a id='comment:18'></a>Attachment [trac_11683_review.patch](tarball://root/attachments/some-uuid/ticket11683/trac_11683_review.patch) by @saraedum created at 2011-12-21 21:50:53",
    "created_at": "2011-12-21T21:50:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11683#issuecomment-135948",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:18'></a>Attachment [trac_11683_review.patch](tarball://root/attachments/some-uuid/ticket11683/trac_11683_review.patch) by @saraedum created at 2011-12-21 21:50:53



---

archive/issue_comments_135949.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,31 @@\n+The import of sage/schemes/elliptic_curves/ell_curve_isogeny.py (which happens on every startup of sage) takes a relatively big amount of time\n \n+```\n+$ time ./sage -startuptime|grep ell_curve_isogeny:\n+          ell_curve_isogeny: 0.133 (ell_field)\n+\n+real    0m0.994s\n+user    0m0.810s\n+sys     0m0.154s\n+```\n+\n+Lazily computing the constants in this file helps a lot (see the attached patch):\n+\n+```\n+$ time ./sage -startuptime|grep ell_curve_isogeny:\n+          ell_curve_isogeny: 0.001 (ell_field)\n+\n+real    0m0.849s\n+user    0m0.672s\n+sys     0m0.164s\n+```\n+\n+**Apply:**\n+\n+1. [attachment:trac_11683_ell_curve_isogeny_speedup_combined.patch]\n+2. [attachment:trac_11683_review.patch]\n+\n+to the sage repository.\n \n Upstream: Not yet reported upstream; Will do shortly.\n \n```\n",
    "created_at": "2011-12-21T21:50:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11683#issuecomment-135949",
    "user": "https://github.com/saraedum"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,31 @@
+The import of sage/schemes/elliptic_curves/ell_curve_isogeny.py (which happens on every startup of sage) takes a relatively big amount of time
 
+```
+$ time ./sage -startuptime|grep ell_curve_isogeny:
+          ell_curve_isogeny: 0.133 (ell_field)
+
+real    0m0.994s
+user    0m0.810s
+sys     0m0.154s
+```
+
+Lazily computing the constants in this file helps a lot (see the attached patch):
+
+```
+$ time ./sage -startuptime|grep ell_curve_isogeny:
+          ell_curve_isogeny: 0.001 (ell_field)
+
+real    0m0.849s
+user    0m0.672s
+sys     0m0.164s
+```
+
+**Apply:**
+
+1. [attachment:trac_11683_ell_curve_isogeny_speedup_combined.patch]
+2. [attachment:trac_11683_review.patch]
+
+to the sage repository.
 
 Upstream: Not yet reported upstream; Will do shortly.
 
```




---

archive/issue_comments_135950.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2011-12-22T14:55:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11683#issuecomment-135950",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_135951.json:
```json
{
    "body": "<a id='comment:19'></a>Replying to [comment:17 saraedum]:\n> [the docstring said \"10\" hours of course]\n> \n> We fixed a few typos. Looking at the changes to `isogenies_prime_degree_genus_0()` we're wondering if this actually adds any new functionality/fixes a problem? If so, shouldn't there be a doctest for it?\n\n\nThe algorithm has been slightly simplified in the following ways:  it works with the Fricke polynomials which are ZZ[t] rather than the actual Fricke modules (which are rational functions with denominator t), thus avoiding the creation of rational functions.  Secondly, it uses a different model for the universal elliptic curve defined over Q(t), which is integral over Z[t] and has good reduction at as many places as possible.  This makes the generic kernel polynomials lie in Z[t][x] rather than Q(t)[x], and also makes them simpler.\n\nThe previous version was not incorrect at all, but this seemed to be the right time to replace the older models with new ones, since the code was being refactored anyway.\n\nThanks for fixing the typos;  I have set the ticket back to \"needs review\".",
    "created_at": "2011-12-22T14:55:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11683#issuecomment-135951",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:19'></a>Replying to [comment:17 saraedum]:
> [the docstring said "10" hours of course]
> 
> We fixed a few typos. Looking at the changes to `isogenies_prime_degree_genus_0()` we're wondering if this actually adds any new functionality/fixes a problem? If so, shouldn't there be a doctest for it?


The algorithm has been slightly simplified in the following ways:  it works with the Fricke polynomials which are ZZ[t] rather than the actual Fricke modules (which are rational functions with denominator t), thus avoiding the creation of rational functions.  Secondly, it uses a different model for the universal elliptic curve defined over Q(t), which is integral over Z[t] and has good reduction at as many places as possible.  This makes the generic kernel polynomials lie in Z[t][x] rather than Q(t)[x], and also makes them simpler.

The previous version was not incorrect at all, but this seemed to be the right time to replace the older models with new ones, since the code was being refactored anyway.

Thanks for fixing the typos;  I have set the ticket back to "needs review".



---

archive/issue_comments_135952.json:
```json
{
    "body": "<a id='comment:20'></a>Please re-review this patch so that it can go into 5.0!!!!  The last review was positive apart from some trivial typos, but several months later it has not yet been merged just because it was reset to \"needs review\"",
    "created_at": "2012-02-24T10:06:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11683#issuecomment-135952",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:20'></a>Please re-review this patch so that it can go into 5.0!!!!  The last review was positive apart from some trivial typos, but several months later it has not yet been merged just because it was reset to "needs review"



---

archive/issue_comments_135953.json:
```json
{
    "body": "<a id='comment:21'></a>The patches apply fine to 5.0.beta5 and all the tests in elliptic_curves pass, so please will someone give this a positive review!!!!",
    "created_at": "2012-02-24T10:14:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11683#issuecomment-135953",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:21'></a>The patches apply fine to 5.0.beta5 and all the tests in elliptic_curves pass, so please will someone give this a positive review!!!!



---

archive/issue_comments_135954.json:
```json
{
    "body": "<a id='comment:22'></a>Replying to [comment:21 cremona]:\n\nI have very little time right now, but will re-review the patch tomorrow evening.",
    "created_at": "2012-02-24T21:02:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11683#issuecomment-135954",
    "user": "https://trac.sagemath.org/admin/accounts/users/fschulze"
}
```

<a id='comment:22'></a>Replying to [comment:21 cremona]:

I have very little time right now, but will re-review the patch tomorrow evening.



---

archive/issue_comments_135955.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2012-02-25T21:22:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11683#issuecomment-135955",
    "user": "https://trac.sagemath.org/admin/accounts/users/fschulze"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_135956.json:
```json
{
    "body": "<a id='comment:23'></a>The documentation for Psi is missing some of the information from your comment above: It states the places of bad reduction of E_t but doesn't mention that E_t is a 'universal elliptic curve with l-isogeny' and that the model was specifically chosen for it's reduction behaviour. Shouldn't this information also be in the docstring?\n\nEverything else looks OK (with the doctests still running).",
    "created_at": "2012-02-25T21:22:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11683#issuecomment-135956",
    "user": "https://trac.sagemath.org/admin/accounts/users/fschulze"
}
```

<a id='comment:23'></a>The documentation for Psi is missing some of the information from your comment above: It states the places of bad reduction of E_t but doesn't mention that E_t is a 'universal elliptic curve with l-isogeny' and that the model was specifically chosen for it's reduction behaviour. Shouldn't this information also be in the docstring?

Everything else looks OK (with the doctests still running).



---

archive/issue_comments_135957.json:
```json
{
    "body": "<a id='comment:24'></a>Replying to [comment:23 fschulze]:\n> The documentation for Psi is missing some of the information from your comment above: It states the places of bad reduction of E_t but doesn't mention that E_t is a 'universal elliptic curve with l-isogeny' and that the model was specifically chosen for it's reduction behaviour. Shouldn't this information also be in the docstring?\n> \n\n\nYou may be right, but it's a docstring not a textbook or thesis...we are currently finishing similar (though more complicated) code for all the cases where X_0(l) is hyperelliptic, and also getting these genus 0 cases to apply in characteristics 2 and 3, so there will be a lot more to say then (at which point we'll move this code into a separate file too).\n\n> Everything else looks OK (with the doctests still running).",
    "created_at": "2012-02-25T23:01:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11683#issuecomment-135957",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:24'></a>Replying to [comment:23 fschulze]:
> The documentation for Psi is missing some of the information from your comment above: It states the places of bad reduction of E_t but doesn't mention that E_t is a 'universal elliptic curve with l-isogeny' and that the model was specifically chosen for it's reduction behaviour. Shouldn't this information also be in the docstring?
> 


You may be right, but it's a docstring not a textbook or thesis...we are currently finishing similar (though more complicated) code for all the cases where X_0(l) is hyperelliptic, and also getting these genus 0 cases to apply in characteristics 2 and 3, so there will be a lot more to say then (at which point we'll move this code into a separate file too).

> Everything else looks OK (with the doctests still running).



---

archive/issue_comments_135958.json:
```json
{
    "body": "<a id='comment:25'></a>I think that the docstrings already are very long too.\n\nIs there maybe a reference one could add? Julian and I tried to understand this patch and didn't found many references. The preprint you mentioned above only has 'Fricke, Not sure which book'. I believe adding such a reference would be a lot of help for other people in the future.",
    "created_at": "2012-02-26T07:46:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11683#issuecomment-135958",
    "user": "https://trac.sagemath.org/admin/accounts/users/fschulze"
}
```

<a id='comment:25'></a>I think that the docstrings already are very long too.

Is there maybe a reference one could add? Julian and I tried to understand this patch and didn't found many references. The preprint you mentioned above only has 'Fricke, Not sure which book'. I believe adding such a reference would be a lot of help for other people in the future.



---

archive/issue_comments_135959.json:
```json
{
    "body": "<a id='comment:26'></a>One reason the docstrings are long is that I was asked (e.g. on this ticket) to give an explanation.  So please do not now ask me to shorten them.  As for references, as I have already said, there is an old unpublished preprint by me and Mark Watkins, which has now been superceded (we now use better models), and there will be a PhD thesis by Kimi Tsukazaki, but he has not written it yet.  I hope you are not suggesting that the code cannot be accepted into Sage until his thesis has been written and examined and passed?  On the contrary, I was hoping that the code based on his thesis (which includes  many more prime l as I have already said) would be accepted into Sage -- on its merits because it works -- before he submits the thesis.\n\nI feel I am going round in circles here.  This ticket was created because the old code was causing an unnecessary delay in Sage startup time, and the patch fixes that, and clarifies how the code works at the same time.",
    "created_at": "2012-02-26T12:21:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11683#issuecomment-135959",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:26'></a>One reason the docstrings are long is that I was asked (e.g. on this ticket) to give an explanation.  So please do not now ask me to shorten them.  As for references, as I have already said, there is an old unpublished preprint by me and Mark Watkins, which has now been superceded (we now use better models), and there will be a PhD thesis by Kimi Tsukazaki, but he has not written it yet.  I hope you are not suggesting that the code cannot be accepted into Sage until his thesis has been written and examined and passed?  On the contrary, I was hoping that the code based on his thesis (which includes  many more prime l as I have already said) would be accepted into Sage -- on its merits because it works -- before he submits the thesis.

I feel I am going round in circles here.  This ticket was created because the old code was causing an unnecessary delay in Sage startup time, and the patch fixes that, and clarifies how the code works at the same time.



---

archive/issue_comments_135960.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2012-02-26T14:31:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11683#issuecomment-135960",
    "user": "https://trac.sagemath.org/admin/accounts/users/fschulze"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_135961.json:
```json
{
    "body": "<a id='comment:27'></a>I didn't mean to suggest that the code can not be accepted. It obviously is an improvement and I just wanted to know if the documentation could be improved by adding a reference.\n\nI will give the patch a positive review now. Further improvements to the documentation will probably happen when your more general code arrives.",
    "created_at": "2012-02-26T14:31:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11683#issuecomment-135961",
    "user": "https://trac.sagemath.org/admin/accounts/users/fschulze"
}
```

<a id='comment:27'></a>I didn't mean to suggest that the code can not be accepted. It obviously is an improvement and I just wanted to know if the documentation could be improved by adding a reference.

I will give the patch a positive review now. Further improvements to the documentation will probably happen when your more general code arrives.



---

archive/issue_comments_135962.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,29 @@\n+The import of sage/schemes/elliptic_curves/ell_curve_isogeny.py (which happens on every startup of sage) takes a relatively big amount of time\n \n+```\n+$ time ./sage -startuptime|grep ell_curve_isogeny:\n+          ell_curve_isogeny: 0.133 (ell_field)\n+\n+real    0m0.994s\n+user    0m0.810s\n+sys     0m0.154s\n+```\n+Lazily computing the constants in this file helps a lot (see the attached patch):\n+\n+```\n+$ time ./sage -startuptime|grep ell_curve_isogeny:\n+          ell_curve_isogeny: 0.001 (ell_field)\n+\n+real    0m0.849s\n+user    0m0.672s\n+sys     0m0.164s\n+```\n+**Apply:**\n+\n+1. [attachment:trac_11683_ell_curve_isogeny_speedup_combined.patch]\n+2. [attachment:trac_11683_review.patch]\n+\n+to the sage repository.\n \n Upstream: Not yet reported upstream; Will do shortly.\n \n```\n",
    "created_at": "2012-02-26T14:35:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11683#issuecomment-135962",
    "user": "https://trac.sagemath.org/admin/accounts/users/fschulze"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,29 @@
+The import of sage/schemes/elliptic_curves/ell_curve_isogeny.py (which happens on every startup of sage) takes a relatively big amount of time
 
+```
+$ time ./sage -startuptime|grep ell_curve_isogeny:
+          ell_curve_isogeny: 0.133 (ell_field)
+
+real    0m0.994s
+user    0m0.810s
+sys     0m0.154s
+```
+Lazily computing the constants in this file helps a lot (see the attached patch):
+
+```
+$ time ./sage -startuptime|grep ell_curve_isogeny:
+          ell_curve_isogeny: 0.001 (ell_field)
+
+real    0m0.849s
+user    0m0.672s
+sys     0m0.164s
+```
+**Apply:**
+
+1. [attachment:trac_11683_ell_curve_isogeny_speedup_combined.patch]
+2. [attachment:trac_11683_review.patch]
+
+to the sage repository.
 
 Upstream: Not yet reported upstream; Will do shortly.
 
```




---

archive/issue_comments_135963.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-02-26T14:35:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11683#issuecomment-135963",
    "user": "https://trac.sagemath.org/admin/accounts/users/fschulze"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_135964.json:
```json
{
    "body": "<a id='comment:28'></a>Tested with sage-5.0.beta5. The patch applies fine and all doctests pass.",
    "created_at": "2012-02-26T14:35:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11683#issuecomment-135964",
    "user": "https://trac.sagemath.org/admin/accounts/users/fschulze"
}
```

<a id='comment:28'></a>Tested with sage-5.0.beta5. The patch applies fine and all doctests pass.



---

archive/issue_comments_135965.json:
```json
{
    "body": "<a id='comment:29'></a>Replying to [comment:27 fschulze]:\n> I didn't mean to suggest that the code can not be accepted. It obviously is an improvement and I just wanted to know if the documentation could be improved by adding a reference.\n> \n> I will give the patch a positive review now. Further improvements to the documentation will probably happen when your more general code arrives.\n\n\nThanks.",
    "created_at": "2012-02-26T14:57:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11683#issuecomment-135965",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:29'></a>Replying to [comment:27 fschulze]:
> I didn't mean to suggest that the code can not be accepted. It obviously is an improvement and I just wanted to know if the documentation could be improved by adding a reference.
> 
> I will give the patch a positive review now. Further improvements to the documentation will probably happen when your more general code arrives.


Thanks.



---

archive/issue_events_030690.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-04T21:19:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11683",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11683#event-30690"
}
```



---

archive/issue_comments_135966.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-03-04T21:19:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11683",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11683#issuecomment-135966",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
