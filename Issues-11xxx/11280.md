# Issue 11280: check XCode version on MacOSX, and bail out if it is 4

archive/issues_011108.json:
```json
{
    "body": "Currently, XCode 4 (namely, version 4.0.1) produces a Sage executable that crashes on startup. Here we patch prereqs to guard against it.\nPlease see http://groups.google.com/group/sage-devel/browse_thread/thread/54e9c5216ad6451f for more details.\n\nThis patch also takes care of #8566.\n\nThe patch should be applied in SAGEROOT/spkg/base, using hg import\nIn same directory, one should place \nhttp://boxen.math.washington.edu/home/dima/patches/prereq-0.9.tar\n(and remove prereq-0.8.tar; prereq-0.9/ is an exact copy of prereq-0.8/, only \nrenamed)\n\nPS. If you want to test this in existing Sage installation, you can start \n../../sage -sh in SAGEROOT/spkg/base, untar prereq-0.9.tar, and start ./prereq-0.9-install\n\n\n\nAssignee: GeorgSWeber\n\nCC:  drkirkby @williamstein @jasongrout @jdemeyer @kcrisman\n\nKeywords: XCode 4\n\nResolution: fixed\n\nAuthor: Dmitrii Pasechnik\n\nReviewer: David Kirkby\n\nMerged: sage-4.7.rc2\n\nIssue created by migration from https://trac.sagemath.org/ticket/11280\n\n",
    "closed_at": "2011-05-08T12:24:48Z",
    "created_at": "2011-05-02T06:28:08Z",
    "labels": [
        "component: build",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7",
    "title": "check XCode version on MacOSX, and bail out if it is 4",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11280",
    "user": "https://github.com/dimpase"
}
```
Currently, XCode 4 (namely, version 4.0.1) produces a Sage executable that crashes on startup. Here we patch prereqs to guard against it.
Please see http://groups.google.com/group/sage-devel/browse_thread/thread/54e9c5216ad6451f for more details.

This patch also takes care of #8566.

The patch should be applied in SAGEROOT/spkg/base, using hg import
In same directory, one should place 
http://boxen.math.washington.edu/home/dima/patches/prereq-0.9.tar
(and remove prereq-0.8.tar; prereq-0.9/ is an exact copy of prereq-0.8/, only 
renamed)

PS. If you want to test this in existing Sage installation, you can start 
../../sage -sh in SAGEROOT/spkg/base, untar prereq-0.9.tar, and start ./prereq-0.9-install



Assignee: GeorgSWeber

CC:  drkirkby @williamstein @jasongrout @jdemeyer @kcrisman

Keywords: XCode 4

Resolution: fixed

Author: Dmitrii Pasechnik

Reviewer: David Kirkby

Merged: sage-4.7.rc2

Issue created by migration from https://trac.sagemath.org/ticket/11280





---

archive/issue_comments_145647.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,2 @@\n Currently, XCode 4 (namely, version 4.0.1) produces a Sage executable that crashes on startup. Here we patch prereqs to guard against it.\n+Please see http://groups.google.com/group/sage-devel/browse_thread/thread/54e9c5216ad6451f for more details.\n``````\n",
    "created_at": "2011-05-02T06:39:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11280#issuecomment-145647",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,2 @@
 Currently, XCode 4 (namely, version 4.0.1) produces a Sage executable that crashes on startup. Here we patch prereqs to guard against it.
+Please see http://groups.google.com/group/sage-devel/browse_thread/thread/54e9c5216ad6451f for more details.
``````




---

archive/issue_comments_145648.json:
```json
{
    "body": "<a id='comment:2'></a>\nWith XCode 2.4:\n\n```\n$ xcodebuild -version\nComponent versions: DevToolsCore-757.0; DevToolsSupport-733.0\n```\nso in the patch $XCODE_VERS (and $XCODE_VERS_MAJOR) end up being empty.  A more reliable way to check for the version might be what Macports is doing - essentially that's\n\n```\n$ defaults read /Developer/Applications/Xcode.app/Contents/version CFBundleShortVersionString\n```\nwhich prints \"2.4\" for me.",
    "created_at": "2011-05-02T07:36:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11280#issuecomment-145648",
    "user": "https://trac.sagemath.org/admin/accounts/users/logix"
}
```

<a id='comment:2'></a>
With XCode 2.4:

```
$ xcodebuild -version
Component versions: DevToolsCore-757.0; DevToolsSupport-733.0
```
so in the patch $XCODE_VERS (and $XCODE_VERS_MAJOR) end up being empty.  A more reliable way to check for the version might be what Macports is doing - essentially that's

```
$ defaults read /Developer/Applications/Xcode.app/Contents/version CFBundleShortVersionString
```
which prints "2.4" for me.



---

archive/issue_comments_145649.json:
```json
{
    "body": "<a id='comment:3'></a>\nReplying to [logix](#comment%3A2):\n> With XCode 2.4:\n> \n> \n> ```\n> $ xcodebuild -version\n> Component versions: DevToolsCore-757.0; DevToolsSupport-733.0\n> ```\n> so in the patch $XCODE_VERS (and $XCODE_VERS_MAJOR) end up being empty.  A more reliable way to check for the version might be what Macports is doing - essentially that's\n> \n> \n> ```\n> $ defaults read /Developer/Applications/Xcode.app/Contents/version CFBundleShortVersionString\n> ```\n> which prints \"2.4\" for me.\n\nOne can, I suppose, just do\n\n```\nif [ $XCODE_VERS_MAJOR = \"\" ]; then\n   XCODE_VERS_MAJOR=\"2\"\nfi\n```\n\nOK, you can't build Sage with XCode 2, anyway, right?\nSo this also should be checked and the installation should exit, isn't it?",
    "created_at": "2011-05-02T15:20:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11280#issuecomment-145649",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:3'></a>
Replying to [logix](#comment%3A2):
> With XCode 2.4:
> 
> 
> ```
> $ xcodebuild -version
> Component versions: DevToolsCore-757.0; DevToolsSupport-733.0
> ```
> so in the patch $XCODE_VERS (and $XCODE_VERS_MAJOR) end up being empty.  A more reliable way to check for the version might be what Macports is doing - essentially that's
> 
> 
> ```
> $ defaults read /Developer/Applications/Xcode.app/Contents/version CFBundleShortVersionString
> ```
> which prints "2.4" for me.

One can, I suppose, just do

```
if [ $XCODE_VERS_MAJOR = "" ]; then
   XCODE_VERS_MAJOR="2"
fi
```

OK, you can't build Sage with XCode 2, anyway, right?
So this also should be checked and the installation should exit, isn't it?



---

archive/issue_comments_145650.json:
```json
{
    "body": "<a id='comment:4'></a>\nReplying to [dimpase](#comment%3A3):\n> One can, I suppose, just do\n> \n> ```\n> if [ $XCODE_VERS_MAJOR = \"\" ]; then\n>    XCODE_VERS_MAJOR=\"2\"\n> fi\n> ```\n\n\nWell, technically in this case we might even be seeing XCode 1, but I suppose that that check will do in practice - at least if your check works with even the oldest XCode 3.x versions.\n\n  \n> OK, you can't build Sage with XCode 2, anyway, right?\n> So this also should be checked and the installation should exit, isn't it?\n\n\nThe last time I tried, it worked, but that was almost a year ago (Sage 4.4.3).  I haven't tried since then, but I'll see if I manage to do so within the next couple of days.",
    "created_at": "2011-05-02T20:59:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11280#issuecomment-145650",
    "user": "https://trac.sagemath.org/admin/accounts/users/logix"
}
```

<a id='comment:4'></a>
Replying to [dimpase](#comment%3A3):
> One can, I suppose, just do
> 
> ```
> if [ $XCODE_VERS_MAJOR = "" ]; then
>    XCODE_VERS_MAJOR="2"
> fi
> ```


Well, technically in this case we might even be seeing XCode 1, but I suppose that that check will do in practice - at least if your check works with even the oldest XCode 3.x versions.

  
> OK, you can't build Sage with XCode 2, anyway, right?
> So this also should be checked and the installation should exit, isn't it?


The last time I tried, it worked, but that was almost a year ago (Sage 4.4.3).  I haven't tried since then, but I'll see if I manage to do so within the next couple of days.



---

archive/issue_comments_145651.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-05-04T09:45:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11280#issuecomment-145651",
    "user": "https://github.com/dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_145652.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [logix](#comment%3A4):\n\nI updated the patch to handle cases of Xcode's major version less than 3.\nPlease test (I tested the script as much as I could, but I don't have a very old Xcode around)",
    "created_at": "2011-05-04T09:45:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11280#issuecomment-145652",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:6'></a>
Replying to [logix](#comment%3A4):

I updated the patch to handle cases of Xcode's major version less than 3.
Please test (I tested the script as much as I could, but I don't have a very old Xcode around)



---

archive/issue_comments_145653.json:
```json
{
    "body": "Changing author from \"\" to \"Dmitrii Pasechnik\"",
    "created_at": "2011-05-06T07:25:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11280#issuecomment-145653",
    "user": "https://github.com/jdemeyer"
}
```

Changing author from "" to "Dmitrii Pasechnik"



---

archive/issue_comments_145654.json:
```json
{
    "body": "<a id='comment:8'></a>\nDoesn't break anything on OS X 10.4 PPC.\n\n```\n$ uname -a\nDarwin moufang.ugent.be 8.11.0 Darwin Kernel Version 8.11.0: Wed Oct 10 18:26:00 PDT 2007; root:xnu-792.24.17~1/RELEASE_PPC Power Macintosh powerpc\n$ xcodebuild -version\nComponent versions: DevToolsCore-762.0; DevToolsSupport-764.0\n```",
    "created_at": "2011-05-06T07:25:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11280#issuecomment-145654",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>
Doesn't break anything on OS X 10.4 PPC.

```
$ uname -a
Darwin moufang.ugent.be 8.11.0 Darwin Kernel Version 8.11.0: Wed Oct 10 18:26:00 PDT 2007; root:xnu-792.24.17~1/RELEASE_PPC Power Macintosh powerpc
$ xcodebuild -version
Component versions: DevToolsCore-762.0; DevToolsSupport-764.0
```



---

archive/issue_comments_145655.json:
```json
{
    "body": "<a id='comment:9'></a>\nIf this Xcode version checking is performed, then the version of prereq needs to be incremented to 0.9, otherwise we are going to have different code with the same version number. That means creating a new tar file (prereq-0.8.tar), and changing the TARGET at the top of prereq-0.9-install to:\n\n```\nTARGET=prereq-0.9\n```\n\nAlso, I think the bit of code following:\n\n```\n    if [ $XCODE_VERS_MAJOR -gt 2 ]; then\n        echo \"You are using XCode version \" $XCODE_VERS\n        echo \"WARNING: You are strongly advised to install Apple's latest XCode 3,\"\n        echo \"unless you already have it. You can download this from \"\n        echo \"http://developer.apple.com/xcode/\"\n    fi\n```\n\nshould make it clear **not** to install Xcode 4. Although the message says to use the latest Xcode 3, someone reading it is likely to interpret that as to just upgrade. \n\nAlso, why use the -e option to sed? That's for when you want to specify the name of a script. If you put the script inline, as you have done here, the -e can be removed. \n\nDave",
    "created_at": "2011-05-06T09:10:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11280#issuecomment-145655",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:9'></a>
If this Xcode version checking is performed, then the version of prereq needs to be incremented to 0.9, otherwise we are going to have different code with the same version number. That means creating a new tar file (prereq-0.8.tar), and changing the TARGET at the top of prereq-0.9-install to:

```
TARGET=prereq-0.9
```

Also, I think the bit of code following:

```
    if [ $XCODE_VERS_MAJOR -gt 2 ]; then
        echo "You are using XCode version " $XCODE_VERS
        echo "WARNING: You are strongly advised to install Apple's latest XCode 3,"
        echo "unless you already have it. You can download this from "
        echo "http://developer.apple.com/xcode/"
    fi
```

should make it clear **not** to install Xcode 4. Although the message says to use the latest Xcode 3, someone reading it is likely to interpret that as to just upgrade. 

Also, why use the -e option to sed? That's for when you want to specify the name of a script. If you put the script inline, as you have done here, the -e can be removed. 

Dave



---

archive/issue_comments_145656.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-05-06T09:10:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11280#issuecomment-145656",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_145657.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [drkirkby](#comment%3A9):\n> Also, why use the -e option to sed? That's for when you want to specify the name of a script. If you put the script inline, as you have done here, the -e can be removed. \n\n\nSorry Dave, you're wrong here (you are confusing with `-f`).  `-e` is meant exactly for inline scripts.  It is an option with one argument, namely the script to be executed.  I agree that it is redundant in this situation, but the usage is correct.",
    "created_at": "2011-05-06T09:14:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11280#issuecomment-145657",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>
Replying to [drkirkby](#comment%3A9):
> Also, why use the -e option to sed? That's for when you want to specify the name of a script. If you put the script inline, as you have done here, the -e can be removed. 


Sorry Dave, you're wrong here (you are confusing with `-f`).  `-e` is meant exactly for inline scripts.  It is an option with one argument, namely the script to be executed.  I agree that it is redundant in this situation, but the usage is correct.



---

archive/issue_comments_145658.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [jdemeyer](#comment%3A10):\n> Replying to [drkirkby](#comment%3A9):\n> > Also, why use the -e option to sed? That's for when you want to specify the name of a script. If you put the script inline, as you have done here, the -e can be removed. \n\n> \n> Sorry Dave, you're wrong here (you are confusing with `-f`). \n\n\nYes, I was.\n\n> `-e` is meant exactly for inline scripts.  It is an option with one argument, namely the script to be executed.  I agree that it is redundant in this situation, but the usage is correct.\n\n\nAgreed, but it can still be removed. It's pointless having it.",
    "created_at": "2011-05-06T09:17:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11280#issuecomment-145658",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:11'></a>
Replying to [jdemeyer](#comment%3A10):
> Replying to [drkirkby](#comment%3A9):
> > Also, why use the -e option to sed? That's for when you want to specify the name of a script. If you put the script inline, as you have done here, the -e can be removed. 

> 
> Sorry Dave, you're wrong here (you are confusing with `-f`). 


Yes, I was.

> `-e` is meant exactly for inline scripts.  It is an option with one argument, namely the script to be executed.  I agree that it is redundant in this situation, but the usage is correct.


Agreed, but it can still be removed. It's pointless having it.



---

archive/issue_comments_145659.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [drkirkby](#comment%3A9):\n> If this Xcode version checking is performed, then the version of prereq needs to be incremented to 0.9, otherwise we are going to have different code with the same version number. That means creating a new tar file (prereq-0.8.tar),\n\n\nThe new tar file should be prereq-0.9.tar of course and not prereq-0.8.tar as I stated. \n\nDave",
    "created_at": "2011-05-06T09:22:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11280#issuecomment-145659",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:12'></a>
Replying to [drkirkby](#comment%3A9):
> If this Xcode version checking is performed, then the version of prereq needs to be incremented to 0.9, otherwise we are going to have different code with the same version number. That means creating a new tar file (prereq-0.8.tar),


The new tar file should be prereq-0.9.tar of course and not prereq-0.8.tar as I stated. 

Dave



---

archive/issue_comments_145660.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [drkirkby](#comment%3A12):\n> Replying to [drkirkby](#comment%3A9):\n> > If this Xcode version checking is performed, then the version of prereq needs to be incremented to 0.9, otherwise we are going to have different code with the same version number. That means creating a new tar file (prereq-0.8.tar),\n\n> \n> The new tar file should be prereq-0.9.tar of course and not prereq-0.8.tar as I stated. \n> \n> Dave \n\n\nWell, I don't follow the 0.9 vs 0.8 question. I really have no idea what you are talking about, in this respect.\nPlease explain if I need to adjust the patch.\n\nI'll fix the point that \"latest\" must mean \"latest, but not Xcode 4\", that's easy.\n\nDima",
    "created_at": "2011-05-06T10:40:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11280#issuecomment-145660",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:13'></a>
Replying to [drkirkby](#comment%3A12):
> Replying to [drkirkby](#comment%3A9):
> > If this Xcode version checking is performed, then the version of prereq needs to be incremented to 0.9, otherwise we are going to have different code with the same version number. That means creating a new tar file (prereq-0.8.tar),

> 
> The new tar file should be prereq-0.9.tar of course and not prereq-0.8.tar as I stated. 
> 
> Dave 


Well, I don't follow the 0.9 vs 0.8 question. I really have no idea what you are talking about, in this respect.
Please explain if I need to adjust the patch.

I'll fix the point that "latest" must mean "latest, but not Xcode 4", that's easy.

Dima



---

archive/issue_comments_145661.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2011-05-06T10:40:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11280#issuecomment-145661",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_comments_145662.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [dimpase](#comment%3A13):\n\n> Well, I don't follow the 0.9 vs 0.8 question. I really have no idea what you are talking about, in this respect.\n> Please explain if I need to adjust the patch.\n> \n> I'll fix the point that \"latest\" must mean \"latest, but not Xcode 4\", that's easy.\n> \n> Dima\n\n\nDima,\n\nThe way Sage checks it's prerequisites is not my idea of a good way, but this is how it works:\n\n* There's an executable shell script `$SAGE_ROOT/spkg/base/prereq-0.8-install` \n* There's a tar file in `$SAGE_ROOT/spkg/base/prereq-0.8.tar`\n* When `$SAGE_ROOT/spkg/base/prereq-0.8-install` executes, it extracts the contents of  `$SAGE_ROOT/spkg/base/prereq-0.8.tar`. That tar file has a \"`configure`\" script generated by autoconf. The \"`configure`\" script  then executes and does some other tests that are not in the `$SAGE_ROOT/spkg/base/prereq-0.8-install`. \n\nYou are editing a script (currently prereq-0.8-install). Once edited, the version number of that script needs to be incremented, like one does whenever one makes changes to software. The most obvious name in this case would appear to be rename that script to prereq-0.9-install. (Since it under revision control, that needs to be done in Mercurial)\n\nThe top of the script has a name hard-coded. That will need the obvious edit. \n\ni.e. change\n\n```\nTARGET=prereq-0.8\n```\nto\n\n```\nTARGET=prereq-0.9\n```\n\nThe script opens a tar file - if you look down lower you can see the line:\n\n```\ntar mxvf \"../base/$TARGET.tar\"\n```\n\nSo when you change the TARGET, the script will try to open a tar with a different name. \n\nSo basically\n\n```\n$ tar xf prereq-0.8.tar\n$ mv prereq-0.8 prereq-0.9\n$ tar cf prereq-0.9.tar prereq-0.9\n$ rm prereq-0.8.tar\n```\nThen make your changes to the script prereq-0.8-install, rename it to prereq-0.9-install, then use Mercurial to rename the prereq-0.8-install script. I don't know how to do that, though I suspect it is something like\n\n```\n$ hg rename prereq-0.8-install prereq-0.9-install\n```\n\nbut you will need to check that. You don't need to rename the tar file in Mercurial as that's listed in .hgignore. \n\nSo basically you need to ensure that \n* The script has its version incremented - 0.9 is fine by me.\n* The TARGET at the top of the script needs to have the version changed too. \n* A tar file needs to be created which also has 0.9 in the name. \n\n\nBTW, if you want to close another bug (#8566) you can delete the character \"m\" from the line\n\n```\ntar mxvf \"../base/$TARGET.tar\"\n```\n\nas that has caused portability issues for a minimal Linux system (slitaz linux), and serves no useful purpose in Sage. \n\nIt's an unusual process this script. I did not design it, and I don't like it. (Personally I would have used autoconf at the top level to create a \"`configure`\" script, which itself creates \"`Makefile`\". Then we could work like 50% of the open-source UNIX programs around which all use autoconf/automake, rather than be in the other 50% which each have their own unique ways. \n\nDave",
    "created_at": "2011-05-06T11:34:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11280#issuecomment-145662",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:14'></a>
Replying to [dimpase](#comment%3A13):

> Well, I don't follow the 0.9 vs 0.8 question. I really have no idea what you are talking about, in this respect.
> Please explain if I need to adjust the patch.
> 
> I'll fix the point that "latest" must mean "latest, but not Xcode 4", that's easy.
> 
> Dima


Dima,

The way Sage checks it's prerequisites is not my idea of a good way, but this is how it works:

* There's an executable shell script `$SAGE_ROOT/spkg/base/prereq-0.8-install` 
* There's a tar file in `$SAGE_ROOT/spkg/base/prereq-0.8.tar`
* When `$SAGE_ROOT/spkg/base/prereq-0.8-install` executes, it extracts the contents of  `$SAGE_ROOT/spkg/base/prereq-0.8.tar`. That tar file has a "`configure`" script generated by autoconf. The "`configure`" script  then executes and does some other tests that are not in the `$SAGE_ROOT/spkg/base/prereq-0.8-install`. 

You are editing a script (currently prereq-0.8-install). Once edited, the version number of that script needs to be incremented, like one does whenever one makes changes to software. The most obvious name in this case would appear to be rename that script to prereq-0.9-install. (Since it under revision control, that needs to be done in Mercurial)

The top of the script has a name hard-coded. That will need the obvious edit. 

i.e. change

```
TARGET=prereq-0.8
```
to

```
TARGET=prereq-0.9
```

The script opens a tar file - if you look down lower you can see the line:

```
tar mxvf "../base/$TARGET.tar"
```

So when you change the TARGET, the script will try to open a tar with a different name. 

So basically

```
$ tar xf prereq-0.8.tar
$ mv prereq-0.8 prereq-0.9
$ tar cf prereq-0.9.tar prereq-0.9
$ rm prereq-0.8.tar
```
Then make your changes to the script prereq-0.8-install, rename it to prereq-0.9-install, then use Mercurial to rename the prereq-0.8-install script. I don't know how to do that, though I suspect it is something like

```
$ hg rename prereq-0.8-install prereq-0.9-install
```

but you will need to check that. You don't need to rename the tar file in Mercurial as that's listed in .hgignore. 

So basically you need to ensure that 
* The script has its version incremented - 0.9 is fine by me.
* The TARGET at the top of the script needs to have the version changed too. 
* A tar file needs to be created which also has 0.9 in the name. 


BTW, if you want to close another bug (#8566) you can delete the character "m" from the line

```
tar mxvf "../base/$TARGET.tar"
```

as that has caused portability issues for a minimal Linux system (slitaz linux), and serves no useful purpose in Sage. 

It's an unusual process this script. I did not design it, and I don't like it. (Personally I would have used autoconf at the top level to create a "`configure`" script, which itself creates "`Makefile`". Then we could work like 50% of the open-source UNIX programs around which all use autoconf/automake, rather than be in the other 50% which each have their own unique ways. 

Dave



---

archive/issue_comments_145663.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2011-05-06T12:16:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11280#issuecomment-145663",
    "user": "https://github.com/kcrisman"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_145664.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [logix](#comment%3A4):\n> Replying to [dimpase](#comment%3A3):\n> > One can, I suppose, just do\n> > \n> > ```\n> > if [ $XCODE_VERS_MAJOR = \"\" ]; then\n> >    XCODE_VERS_MAJOR=\"2\"\n> > fi\n> > ```\n\n> \n> Well, technically in this case we might even be seeing XCode 1, but I suppose that that check will do in practice - at least if your check works with even the oldest XCode 3.x versions.\n> \n>   \n> > OK, you can't build Sage with XCode 2, anyway, right?\n> > So this also should be checked and the installation should exit, isn't it?\n\n> \n> The last time I tried, it worked, but that was almost a year ago (Sage 4.4.3).  I haven't tried since then, but I'll see if I manage to do so within the next couple of days.\n\n\nXCode 2.4.1 worked just fine up through 4.7.alpha5 (and probably the problems I'm having with rc1 are unrelated to XCode/gcc), and 2.5 is the last one available for OS X 10.4.  I think that this needs to be changed to indicate that.",
    "created_at": "2011-05-06T12:16:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11280#issuecomment-145664",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:15'></a>
Replying to [logix](#comment%3A4):
> Replying to [dimpase](#comment%3A3):
> > One can, I suppose, just do
> > 
> > ```
> > if [ $XCODE_VERS_MAJOR = "" ]; then
> >    XCODE_VERS_MAJOR="2"
> > fi
> > ```

> 
> Well, technically in this case we might even be seeing XCode 1, but I suppose that that check will do in practice - at least if your check works with even the oldest XCode 3.x versions.
> 
>   
> > OK, you can't build Sage with XCode 2, anyway, right?
> > So this also should be checked and the installation should exit, isn't it?

> 
> The last time I tried, it worked, but that was almost a year ago (Sage 4.4.3).  I haven't tried since then, but I'll see if I manage to do so within the next couple of days.


XCode 2.4.1 worked just fine up through 4.7.alpha5 (and probably the problems I'm having with rc1 are unrelated to XCode/gcc), and 2.5 is the last one available for OS X 10.4.  I think that this needs to be changed to indicate that.



---

archive/issue_comments_145665.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-05-06T12:16:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11280#issuecomment-145665",
    "user": "https://github.com/kcrisman"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_145666.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,2 +1,4 @@\n Currently, XCode 4 (namely, version 4.0.1) produces a Sage executable that crashes on startup. Here we patch prereqs to guard against it.\n Please see http://groups.google.com/group/sage-devel/browse_thread/thread/54e9c5216ad6451f for more details.\n+\n+This patch also takes care of #8566.\n``````\n",
    "created_at": "2011-05-06T16:55:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11280#issuecomment-145666",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,2 +1,4 @@
 Currently, XCode 4 (namely, version 4.0.1) produces a Sage executable that crashes on startup. Here we patch prereqs to guard against it.
 Please see http://groups.google.com/group/sage-devel/browse_thread/thread/54e9c5216ad6451f for more details.
+
+This patch also takes care of #8566.
``````




---

archive/issue_comments_145667.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2011-05-06T18:02:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11280#issuecomment-145667",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_comments_145668.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [drkirkby](#comment%3A14):\n\nDave, \n\nI followed your explanations and created a patch that replaces the current prereq-0.8-install with the\nnew prereq-0.9-install.\nI however did not understand whether I am also supposed to post the updated tar file.\n\nI also cannot figure out how to make the patch respect executable permissions of prereq-0.9-install.",
    "created_at": "2011-05-06T18:02:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11280#issuecomment-145668",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:18'></a>
Replying to [drkirkby](#comment%3A14):

Dave, 

I followed your explanations and created a patch that replaces the current prereq-0.8-install with the
new prereq-0.9-install.
I however did not understand whether I am also supposed to post the updated tar file.

I also cannot figure out how to make the patch respect executable permissions of prereq-0.9-install.



---

archive/issue_comments_145669.json:
```json
{
    "body": "Attachment [trac_11280_xcode4unsupported.patch](tarball://root/attachments/some-uuid/ticket11280/trac_11280_xcode4unsupported.patch) by @dimpase created at 2011-05-06 19:07:10\n\nexport with --git to record file permissions",
    "created_at": "2011-05-06T19:07:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11280#issuecomment-145669",
    "user": "https://github.com/dimpase"
}
```

Attachment [trac_11280_xcode4unsupported.patch](tarball://root/attachments/some-uuid/ticket11280/trac_11280_xcode4unsupported.patch) by @dimpase created at 2011-05-06 19:07:10

export with --git to record file permissions



---

archive/issue_comments_145670.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [dimpase](#comment%3A18):\n\n> I also cannot figure out how to make the patch respect executable permissions of prereq-0.9-install.\n\n\nsorted out this (needed to do hg export --git ...) The updated patch should respect this.",
    "created_at": "2011-05-06T19:08:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11280#issuecomment-145670",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:19'></a>
Replying to [dimpase](#comment%3A18):

> I also cannot figure out how to make the patch respect executable permissions of prereq-0.9-install.


sorted out this (needed to do hg export --git ...) The updated patch should respect this.



---

archive/issue_comments_145671.json:
```json
{
    "body": "<a id='comment:20'></a>\nWow that was a lot more than I was expecting - nice.\n\nQuestion:\n\n```\nif [ $XCODE_VERS_MAJOR -gt 2 ]; then \n        echo \"You are using XCode version \" $XCODE_VERS \n        echo \"WARNING: You are strongly advised to install Apple's latest XCode 3,\" \n        echo \"unless you already have it. You can download this from \" \n        echo \"http://developer.apple.com/xcode/\" \n        echo \"Sage will NOT work with XCode 4!\" \n```\nAre you trying to trip this warning for !XCode 3 as well, just as a warning to anyone who is potentially interested in upgrading, or to someone who doesn't have the latest 3.x?  I assume this is the case, just checking.",
    "created_at": "2011-05-06T19:19:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11280#issuecomment-145671",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:20'></a>
Wow that was a lot more than I was expecting - nice.

Question:

```
if [ $XCODE_VERS_MAJOR -gt 2 ]; then 
        echo "You are using XCode version " $XCODE_VERS 
        echo "WARNING: You are strongly advised to install Apple's latest XCode 3," 
        echo "unless you already have it. You can download this from " 
        echo "http://developer.apple.com/xcode/" 
        echo "Sage will NOT work with XCode 4!" 
```
Are you trying to trip this warning for !XCode 3 as well, just as a warning to anyone who is potentially interested in upgrading, or to someone who doesn't have the latest 3.x?  I assume this is the case, just checking.



---

archive/issue_comments_145672.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [dimpase](#comment%3A18):\n> Replying to [drkirkby](#comment%3A14):\n> \n> Dave, \n> \n> I followed your explanations and created a patch that replaces the current prereq-0.8-install with the\n> new prereq-0.9-install.\n> I however did not understand whether I am also supposed to post the updated tar file.\n\n\nYes, you do. Since it will be quite large, its probably best if you just provide a link to it. \n\nThen a reviewer should be able to drop the new tar file in place, delete the old tar file and apply the patch. \n\n> I also cannot figure out how to make the patch respect executable permissions of prereq-0.9-install.\n\n\nFrom what I later read, you have sorted that out. \n\nI suggest you provide a link to the tar file and then mark this for review. I don't have OS X myself, but I can look through the changes. \n\nDave",
    "created_at": "2011-05-07T00:58:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11280#issuecomment-145672",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:21'></a>
Replying to [dimpase](#comment%3A18):
> Replying to [drkirkby](#comment%3A14):
> 
> Dave, 
> 
> I followed your explanations and created a patch that replaces the current prereq-0.8-install with the
> new prereq-0.9-install.
> I however did not understand whether I am also supposed to post the updated tar file.


Yes, you do. Since it will be quite large, its probably best if you just provide a link to it. 

Then a reviewer should be able to drop the new tar file in place, delete the old tar file and apply the patch. 

> I also cannot figure out how to make the patch respect executable permissions of prereq-0.9-install.


From what I later read, you have sorted that out. 

I suggest you provide a link to the tar file and then mark this for review. I don't have OS X myself, but I can look through the changes. 

Dave



---

archive/issue_comments_145673.json:
```json
{
    "body": "Changing reviewer from \"\" to \"David Kirkby\"",
    "created_at": "2011-05-07T00:58:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11280#issuecomment-145673",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Changing reviewer from "" to "David Kirkby"



---

archive/issue_comments_145674.json:
```json
{
    "body": "<a id='comment:22'></a>\nOK, here comes the updated thing, ready to be tested.",
    "created_at": "2011-05-07T04:40:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11280#issuecomment-145674",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:22'></a>
OK, here comes the updated thing, ready to be tested.



---

archive/issue_comments_145675.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,3 +2,14 @@\n Please see http://groups.google.com/group/sage-devel/browse_thread/thread/54e9c5216ad6451f for more details.\n \n This patch also takes care of #8566.\n+\n+The patch should be applied in SAGEROOT/spkg/base, using hg import\n+In same directory, one should place \n+http://boxen.math.washington.edu/home/dima/patches/prereq-0.9.tar\n+(and remove prereq-0.8.tar; prereq-0.9/ is an exact copy of prereq-0.8/, only \n+renamed)\n+\n+PS. If you want to test this in existing Sage installation, you can start \n+../../sage -sh in SAGEROOT/spkg/base, untar prereq-0.9.tar, and start ./prereq-0.9-install\n+\n+\n``````\n",
    "created_at": "2011-05-07T04:40:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11280#issuecomment-145675",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,3 +2,14 @@
 Please see http://groups.google.com/group/sage-devel/browse_thread/thread/54e9c5216ad6451f for more details.
 
 This patch also takes care of #8566.
+
+The patch should be applied in SAGEROOT/spkg/base, using hg import
+In same directory, one should place 
+http://boxen.math.washington.edu/home/dima/patches/prereq-0.9.tar
+(and remove prereq-0.8.tar; prereq-0.9/ is an exact copy of prereq-0.8/, only 
+renamed)
+
+PS. If you want to test this in existing Sage installation, you can start 
+../../sage -sh in SAGEROOT/spkg/base, untar prereq-0.9.tar, and start ./prereq-0.9-install
+
+
``````




---

archive/issue_comments_145676.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2011-05-07T04:40:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11280#issuecomment-145676",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_145677.json:
```json
{
    "body": "<a id='comment:23'></a>\nThis looks good to me. I can't test it on an OS X system with the different Xcode versions, so I'm relying on the assumption that the method for determinding the version is OK on Os X. But the script has a new version number, has the right permissions and extracts the right tar file. \n\nDave",
    "created_at": "2011-05-07T13:49:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11280#issuecomment-145677",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:23'></a>
This looks good to me. I can't test it on an OS X system with the different Xcode versions, so I'm relying on the assumption that the method for determinding the version is OK on Os X. But the script has a new version number, has the right permissions and extracts the right tar file. 

Dave



---

archive/issue_comments_145678.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-05-07T13:49:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11280#issuecomment-145678",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_042402.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-05-08T12:24:48Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11280",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11280#event-42402"
}
```



---

archive/issue_comments_145679.json:
```json
{
    "body": "Changing merged from \"\" to \"sage-4.7.rc2\"",
    "created_at": "2011-05-08T12:24:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11280#issuecomment-145679",
    "user": "https://github.com/jdemeyer"
}
```

Changing merged from "" to "sage-4.7.rc2"



---

archive/issue_comments_145680.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-05-08T12:24:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11280#issuecomment-145680",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_145681.json:
```json
{
    "body": "<a id='comment:25'></a>\nAs a result of this closure, #8566 can be marked as closed and fixed. \n\nDave",
    "created_at": "2011-05-09T08:44:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11280#issuecomment-145681",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:25'></a>
As a result of this closure, #8566 can be marked as closed and fixed. 

Dave
