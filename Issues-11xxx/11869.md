# Issue 11869: Horrible bug in number field conversion

archive/issues_011697.json:
```json
{
    "assignees": [
        "https://github.com/loefflerd"
    ],
    "body": "\n```\n----------------------------------------------------------------------\n| Sage Version 4.7.1, Release Date: 2011-08-11                       |\n| Type notebook() for the GUI, and license() for information.        |\n----------------------------------------------------------------------\nsage: K.<a> = NumberField(x^3+x+1)\nsage: L.<b> = NumberField(x^3+2*x+2)\nsage: K(b)\na\n```\n\nDepends on #11873\nDepends on #11876\n\nCC:  @simon-king-jena\n\nComponent: **number fields**\n\nAuthor: **Jeroen Demeyer**\n\nReviewer: **Marco Streng**\n\nMerged: **sage-4.8.alpha0**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/11869_\n\n",
    "closed_at": "2011-10-20T09:21:08Z",
    "created_at": "2011-09-29T12:13:25Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20number%20fields",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/c%3A%20coercion"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Horrible bug in number field conversion",
    "type": "issue",
    "updated_at": "2011-11-03T16:18:10Z",
    "url": "https://github.com/sagemath/sage/issues/11869",
    "user": "https://github.com/jdemeyer"
}
```

```
----------------------------------------------------------------------
| Sage Version 4.7.1, Release Date: 2011-08-11                       |
| Type notebook() for the GUI, and license() for information.        |
----------------------------------------------------------------------
sage: K.<a> = NumberField(x^3+x+1)
sage: L.<b> = NumberField(x^3+2*x+2)
sage: K(b)
a
```

Depends on #11873
Depends on #11876

CC:  @simon-king-jena

Component: **number fields**

Author: **Jeroen Demeyer**

Reviewer: **Marco Streng**

Merged: **sage-4.8.alpha0**

_Issue created by migration from https://trac.sagemath.org/ticket/11869_





---

archive/issue_events_160508.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-09-29T12:13:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "milestone_number": null,
    "milestone_title": "sage-4.7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11869#event-160508"
}
```



---

archive/issue_events_160509.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-09-29T12:13:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20number%20fields",
    "label_color": "0000ff",
    "label_name": "c: number fields",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11869#event-160509"
}
```



---

archive/issue_events_160510.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-09-29T12:13:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11869#event-160510"
}
```



---

archive/issue_events_160511.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-09-29T12:13:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11869#event-160511"
}
```



---

archive/issue_events_160512.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-09-29T12:13:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20coercion",
    "label_color": "eeeeee",
    "label_name": "c: coercion",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11869#event-160512"
}
```



---

archive/issue_events_160513.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2011-09-29T12:13:25Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "subject": "https://github.com/jdemeyer",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11869#event-160513"
}
```



---

archive/issue_comments_124186.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nI am working on a patch...",
    "created_at": "2011-09-29T12:38:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11869#issuecomment-124186",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:1" align="right">comment:1</div>

I am working on a patch...



---

archive/issue_comments_124187.json:
```json
{
    "body": "Dependencies: **#11870**",
    "created_at": "2011-09-29T13:49:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11869#issuecomment-124187",
    "user": "https://github.com/jdemeyer"
}
```

Dependencies: **#11870**



---

archive/issue_comments_124188.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nIn the process of working on this ticket, I discovered #11870, #11872, #11873.",
    "created_at": "2011-09-29T17:07:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11869#issuecomment-124188",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:3" align="right">comment:3</div>

In the process of working on this ticket, I discovered #11870, #11872, #11873.



---

archive/issue_events_160514.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-09-29T17:08:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11869#event-160514"
}
```



---

archive/issue_comments_124189.json:
```json
{
    "body": "Work Issues: **p-adic embeddings, problems with #11873**",
    "created_at": "2011-09-29T17:08:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11869#issuecomment-124189",
    "user": "https://github.com/jdemeyer"
}
```

Work Issues: **p-adic embeddings, problems with #11873**



---

archive/issue_events_160515.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-09-29T17:08:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11869#event-160515"
}
```



---

archive/issue_events_160516.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-09-29T17:08:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11869#event-160516"
}
```



---

archive/issue_comments_124190.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nFrom the patch:\n\n```\nIf the number fields ``x.parent()`` and ``self`` have an \nembedding in the same field, then those embeddings are used to \ndetermine the correct conversion.  If no such compatible \nembeddings are given, then some possible conversion of ``x`` \ninto ``self`` is given.  This means a non-canonical element of \n``self`` with the same minimal polynomial as ``x``.\n```\nIs that second bit absolutely necessary? I think this is horrible. Throwing an error would be much preferable. With this, it would be possible to have two fields K and L, elements a,b in K and have\n`L(a+b)` not equal to `L(a)+L(b)`. That looks like something that is going to be a perpetual source of problems and hard-to-find bugs.",
    "created_at": "2011-09-29T19:18:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11869#issuecomment-124190",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:6" align="right">comment:6</div>

From the patch:

```
If the number fields ``x.parent()`` and ``self`` have an 
embedding in the same field, then those embeddings are used to 
determine the correct conversion.  If no such compatible 
embeddings are given, then some possible conversion of ``x`` 
into ``self`` is given.  This means a non-canonical element of 
``self`` with the same minimal polynomial as ``x``.
```
Is that second bit absolutely necessary? I think this is horrible. Throwing an error would be much preferable. With this, it would be possible to have two fields K and L, elements a,b in K and have
`L(a+b)` not equal to `L(a)+L(b)`. That looks like something that is going to be a perpetual source of problems and hard-to-find bugs.



---

archive/issue_comments_124191.json:
```json
{
    "body": "Changed dependencies from **#11870** to **#11873**",
    "created_at": "2011-09-29T21:04:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11869#issuecomment-124191",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#11870** to **#11873**



---

archive/issue_comments_124192.json:
```json
{
    "body": "Changed work issues from **p-adic embeddings, problems with #11873** to **more examples**",
    "created_at": "2011-09-29T21:04:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11869#issuecomment-124192",
    "user": "https://github.com/jdemeyer"
}
```

Changed work issues from **p-adic embeddings, problems with #11873** to **more examples**



---

archive/issue_comments_124193.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@nbruin](#comment:6):\n> Is that second bit absolutely necessary? I think this is horrible. Throwing an error would be much preferable. With this, it would be possible to have two fields K and L, elements a,b in K and have\n> `L(a+b)` not equal to `L(a)+L(b)`. That looks like something that is going to be a perpetual source of problems and hard-to-find bugs.\n\nAll this should be fixed now.",
    "created_at": "2011-09-29T21:08:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11869#issuecomment-124193",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@nbruin](#comment:6):
> Is that second bit absolutely necessary? I think this is horrible. Throwing an error would be much preferable. With this, it would be possible to have two fields K and L, elements a,b in K and have
> `L(a+b)` not equal to `L(a)+L(b)`. That looks like something that is going to be a perpetual source of problems and hard-to-find bugs.

All this should be fixed now.



---

archive/issue_events_160517.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-09-29T22:55:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11869#event-160517"
}
```



---

archive/issue_events_160518.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-09-29T22:55:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11869#event-160518"
}
```



---

archive/issue_comments_124194.json:
```json
{
    "body": "Changed work issues from **more examples** to none",
    "created_at": "2011-09-29T22:55:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11869#issuecomment-124194",
    "user": "https://github.com/jdemeyer"
}
```

Changed work issues from **more examples** to none



---

archive/issue_comments_124195.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\n\n```\nsage: K.<a> = NumberField(x^2-5)\nsage: L, phi = K.subfield(-a)\nsage: phi(L.gen())\n-a\nsage: K(L.gen())\na\n```\nOf course the second one must equal the first one or raise an error.",
    "created_at": "2011-09-30T08:09:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11869#issuecomment-124195",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:10" align="right">comment:10</div>


```
sage: K.<a> = NumberField(x^2-5)
sage: L, phi = K.subfield(-a)
sage: phi(L.gen())
-a
sage: K(L.gen())
a
```
Of course the second one must equal the first one or raise an error.



---

archive/issue_events_160519.json:
```json
{
    "actor": "https://github.com/mstreng",
    "created_at": "2011-09-30T08:09:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11869#event-160519"
}
```



---

archive/issue_events_160520.json:
```json
{
    "actor": "https://github.com/mstreng",
    "created_at": "2011-09-30T08:09:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11869#event-160520"
}
```



---

archive/issue_comments_124196.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nIn the case of my example above, there is a preferred embedding of L into K, but your patch does not find it.\n\nIn general, even if there really is no preferred embedding of L into K, then just choosing one will still lead to trouble, as you'll get non-commuting diagrams of embeddings. Instead of just choosing an embedding, I strongly think you must raise an error (but other people may say warning, as David did on sage-nt). This could be discussed on the mailing list.",
    "created_at": "2011-09-30T08:24:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11869#issuecomment-124196",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:11" align="right">comment:11</div>

In the case of my example above, there is a preferred embedding of L into K, but your patch does not find it.

In general, even if there really is no preferred embedding of L into K, then just choosing one will still lead to trouble, as you'll get non-commuting diagrams of embeddings. Instead of just choosing an embedding, I strongly think you must raise an error (but other people may say warning, as David did on sage-nt). This could be discussed on the mailing list.



---

archive/issue_comments_124197.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@mstreng](#comment:11):\n> In the case of my example above, there is a preferred embedding of L into K, but your patch does not find it.\n\nMy patch does not find it because Sage does not *store* it, see #11876.",
    "created_at": "2011-09-30T08:29:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11869#issuecomment-124197",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@mstreng](#comment:11):
> In the case of my example above, there is a preferred embedding of L into K, but your patch does not find it.

My patch does not find it because Sage does not *store* it, see #11876.



---

archive/issue_comments_124198.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@mstreng](#comment:11):\n> In general, even if there really is no preferred embedding of L into K, then just choosing one will still lead to trouble, as you'll get non-commuting diagrams of embeddings.\n\nSo may I paraphrase your proposal as follows:\nIf the element *x* to be converted is not in `QQ` and the fields have no compatible embeddings, then `raise ValueError`?",
    "created_at": "2011-09-30T08:42:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11869#issuecomment-124198",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@mstreng](#comment:11):
> In general, even if there really is no preferred embedding of L into K, then just choosing one will still lead to trouble, as you'll get non-commuting diagrams of embeddings.

So may I paraphrase your proposal as follows:
If the element *x* to be converted is not in `QQ` and the fields have no compatible embeddings, then `raise ValueError`?



---

archive/issue_comments_124199.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@jdemeyer](#comment:13):\n> So may I paraphrase your proposal as follows:\n> If the element *x* to be converted is not in `QQ` and the fields have no compatible embeddings, then `raise ValueError`?\n\nYes.",
    "created_at": "2011-09-30T08:45:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11869#issuecomment-124199",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@jdemeyer](#comment:13):
> So may I paraphrase your proposal as follows:
> If the element *x* to be converted is not in `QQ` and the fields have no compatible embeddings, then `raise ValueError`?

Yes.



---

archive/issue_comments_124200.json:
```json
{
    "body": "Changed dependencies from **#11873** to **#11873, #11876**",
    "created_at": "2011-09-30T09:26:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11869#issuecomment-124200",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#11873** to **#11873, #11876**



---

archive/issue_events_160521.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-09-30T10:21:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11869#event-160521"
}
```



---

archive/issue_events_160522.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-09-30T10:21:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11869#event-160522"
}
```



---

archive/issue_comments_124201.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nDone (raising `TypeError` if no embeddings are found).  For subfields, it needs the patch from #11876.",
    "created_at": "2011-09-30T10:21:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11869#issuecomment-124201",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:16" align="right">comment:16</div>

Done (raising `TypeError` if no embeddings are found).  For subfields, it needs the patch from #11876.



---

archive/issue_comments_124202.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nThanks, I hope to look at the patch soon.\n\nIn the mean time: maybe the message \"TypeError: No compatible embedding found for conversion\" becomes clearer if you add the word \"natural\" or \"preferred\", and perhaps add the fields to the message, i.e., append \"from %s to %s\" % (....)",
    "created_at": "2011-09-30T10:37:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11869#issuecomment-124202",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:17" align="right">comment:17</div>

Thanks, I hope to look at the patch soon.

In the mean time: maybe the message "TypeError: No compatible embedding found for conversion" becomes clearer if you add the word "natural" or "preferred", and perhaps add the fields to the message, i.e., append "from %s to %s" % (....)



---

archive/issue_comments_124203.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nDone, error message changed.",
    "created_at": "2011-09-30T10:51:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11869#issuecomment-124203",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:18" align="right">comment:18</div>

Done, error message changed.



---

archive/issue_comments_124204.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nThere is one doctest error:\n\n```\nsage -t -long \"devel/sage/sage/rings/residue_field.pyx\"\n**********************************************************************\nFile \"/usr/local/src/sage-4.7.2.alpha2/devel/sage/sage/rings/residue_field.pyx\", line 522:\n    sage: RL(OK.1)\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/local/src/sage-4.7.2.alpha2/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/usr/local/src/sage-4.7.2.alpha2/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/usr/local/src/sage-4.7.2.alpha2/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_5[22]>\", line 1, in <module>\n        RL(OK.gen(1))###line 522:\n    sage: RL(OK.1)\n      File \"parent.pyx\", line 941, in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:7102)\n      File \"coerce_maps.pyx\", line 82, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3254)\n      File \"coerce_maps.pyx\", line 77, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3157)\n      File \"residue_field.pyx\", line 1360, in sage.rings.residue_field.ResidueFiniteField_prime_modn._element_constructor_ (sage/rings/residue_field.c:11389)\n      File \"residue_field.pyx\", line 545, in sage.rings.residue_field.ResidueField_generic._element_constructor_ (sage/rings/residue_field.c:6293)\n    TypeError: cannot coerce <type 'sage.rings.number_field.number_field_element.OrderElement_absolute'>\n**********************************************************************\n```",
    "created_at": "2011-09-30T13:00:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11869#issuecomment-124204",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:19" align="right">comment:19</div>

There is one doctest error:

```
sage -t -long "devel/sage/sage/rings/residue_field.pyx"
**********************************************************************
File "/usr/local/src/sage-4.7.2.alpha2/devel/sage/sage/rings/residue_field.pyx", line 522:
    sage: RL(OK.1)
Exception raised:
    Traceback (most recent call last):
      File "/usr/local/src/sage-4.7.2.alpha2/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/usr/local/src/sage-4.7.2.alpha2/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/usr/local/src/sage-4.7.2.alpha2/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_5[22]>", line 1, in <module>
        RL(OK.gen(1))###line 522:
    sage: RL(OK.1)
      File "parent.pyx", line 941, in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:7102)
      File "coerce_maps.pyx", line 82, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3254)
      File "coerce_maps.pyx", line 77, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3157)
      File "residue_field.pyx", line 1360, in sage.rings.residue_field.ResidueFiniteField_prime_modn._element_constructor_ (sage/rings/residue_field.c:11389)
      File "residue_field.pyx", line 545, in sage.rings.residue_field.ResidueField_generic._element_constructor_ (sage/rings/residue_field.c:6293)
    TypeError: cannot coerce <type 'sage.rings.number_field.number_field_element.OrderElement_absolute'>
**********************************************************************
```



---

archive/issue_comments_124205.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nI simply removed the failing test because it makes assumptions which are no longer valid.  Also, the result of the test is mathematically anyway.",
    "created_at": "2011-09-30T13:35:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11869#issuecomment-124205",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:20" align="right">comment:20</div>

I simply removed the failing test because it makes assumptions which are no longer valid.  Also, the result of the test is mathematically anyway.



---

archive/issue_comments_124206.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nI recall some discussion on sage-nt going into that example (introduced in #8800 together with the \"Horrible bug\"). I'm CC'ing its author.",
    "created_at": "2011-09-30T14:50:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11869#issuecomment-124206",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:21" align="right">comment:21</div>

I recall some discussion on sage-nt going into that example (introduced in #8800 together with the "Horrible bug"). I'm CC'ing its author.



---

archive/issue_events_160523.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2011-10-01T08:54:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11869#event-160523"
}
```



---

archive/issue_events_160524.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2011-10-01T08:54:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11869#event-160524"
}
```



---

archive/issue_comments_124207.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nAttachment: **[11869.patch.gz](https://github.com/sagemath/sage/files/ticket11869/11869.patch.gz)**\n\nI am a bit  confused: In the keywords, you name it \"coercion\". But in your example, you just talk about conversion. If it really is a coercion (please check: Does that conversion happens implicitly?) then I agree it is a bug.\n\nOtherwise, I'd say that a conversion that is not a coercion is allowed to do arbitrary nasty stuff (such as `ZZ(GF(2)(1))` returning the integer 1).",
    "created_at": "2011-10-01T08:54:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11869#issuecomment-124207",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:22" align="right">comment:22</div>

Attachment: **[11869.patch.gz](https://github.com/sagemath/sage/files/ticket11869/11869.patch.gz)**

I am a bit  confused: In the keywords, you name it "coercion". But in your example, you just talk about conversion. If it really is a coercion (please check: Does that conversion happens implicitly?) then I agree it is a bug.

Otherwise, I'd say that a conversion that is not a coercion is allowed to do arbitrary nasty stuff (such as `ZZ(GF(2)(1))` returning the integer 1).



---

archive/issue_comments_124208.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@simon-king-jena](#comment:22):\n> I am a bit  confused: In the keywords, you name it \"coercion\". But in your example, you just talk about conversion. If it really is a coercion (please check: Does that conversion happens implicitly?) then I agree it is a bug.\n\nIt certainly *used to be* a stupid \"conversion\".\n\nMy patch actually implements something which is much closer to coercion.  Essentially, it is coercion on *subfields* of the given number fields.  Suppose I have two number fields `L1` and `L2` sharing a common subfield `K`.  Even if there is no coercion map from `L1` to `L2`, there is a coercion between the subfields `K` of `L1` and `K` of `L2`.",
    "created_at": "2011-10-01T10:39:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11869#issuecomment-124208",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@simon-king-jena](#comment:22):
> I am a bit  confused: In the keywords, you name it "coercion". But in your example, you just talk about conversion. If it really is a coercion (please check: Does that conversion happens implicitly?) then I agree it is a bug.

It certainly *used to be* a stupid "conversion".

My patch actually implements something which is much closer to coercion.  Essentially, it is coercion on *subfields* of the given number fields.  Suppose I have two number fields `L1` and `L2` sharing a common subfield `K`.  Even if there is no coercion map from `L1` to `L2`, there is a coercion between the subfields `K` of `L1` and `K` of `L2`.



---

archive/issue_events_160525.json:
```json
{
    "actor": "https://github.com/mstreng",
    "created_at": "2011-10-05T16:40:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11869#event-160525"
}
```



---

archive/issue_events_160526.json:
```json
{
    "actor": "https://github.com/mstreng",
    "created_at": "2011-10-05T16:40:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11869#event-160526"
}
```



---

archive/issue_comments_124209.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nI'm satisfied with the patch, and all tests pass. In the sage-nt discussion, it seems that most number field users want to disallow senseless conversions. And all the time-consuming computation happens after the point where I would have given up with an Error. So I'd like to give this a positive review.",
    "created_at": "2011-10-05T16:40:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11869#issuecomment-124209",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:24" align="right">comment:24</div>

I'm satisfied with the patch, and all tests pass. In the sage-nt discussion, it seems that most number field users want to disallow senseless conversions. And all the time-consuming computation happens after the point where I would have given up with an Error. So I'd like to give this a positive review.



---

archive/issue_comments_124210.json:
```json
{
    "body": "Author: **Jeroen Demeyer**",
    "created_at": "2011-10-05T16:40:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11869#issuecomment-124210",
    "user": "https://github.com/mstreng"
}
```

Author: **Jeroen Demeyer**



---

archive/issue_comments_124211.json:
```json
{
    "body": "Reviewer: **Marco Streng**",
    "created_at": "2011-10-05T16:40:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11869#issuecomment-124211",
    "user": "https://github.com/mstreng"
}
```

Reviewer: **Marco Streng**



---

archive/issue_events_160527.json:
```json
{
    "actor": "https://github.com/mstreng",
    "created_at": "2011-10-06T20:54:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11869#event-160527"
}
```



---

archive/issue_events_160528.json:
```json
{
    "actor": "https://github.com/mstreng",
    "created_at": "2011-10-06T20:54:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11869#event-160528"
}
```



---

archive/issue_events_160529.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-06T21:21:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "milestone_number": null,
    "milestone_title": "sage-4.7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11869#event-160529"
}
```



---

archive/issue_events_160530.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-06T21:21:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "milestone_number": null,
    "milestone_title": "sage-4.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11869#event-160530"
}
```



---

archive/issue_events_160531.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-20T09:21:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11869#event-160531"
}
```



---

archive/issue_events_160532.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-20T09:21:08Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11869#event-160532"
}
```



---

archive/issue_comments_124212.json:
```json
{
    "body": "Merged: **sage-4.7.3.alpha0**",
    "created_at": "2011-10-20T09:21:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11869#issuecomment-124212",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-4.7.3.alpha0**



---

archive/issue_comments_124213.json:
```json
{
    "body": "Milestone sage-4.7.3 deleted",
    "created_at": "2011-11-03T16:14:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11869#issuecomment-124213",
    "user": "https://github.com/jdemeyer"
}
```

Milestone sage-4.7.3 deleted



---

archive/issue_events_160533.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-11-03T16:14:43Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "milestone_number": null,
    "milestone_title": "sage-4.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11869#event-160533"
}
```



---

archive/issue_events_160534.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-11-03T16:18:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "milestone_number": null,
    "milestone_title": "sage-4.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11869#event-160534"
}
```



---

archive/issue_comments_124214.json:
```json
{
    "body": "Changed merged from **sage-4.7.3.alpha0** to **sage-4.8.alpha0**",
    "created_at": "2011-11-03T16:18:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11869",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11869#issuecomment-124214",
    "user": "https://github.com/jdemeyer"
}
```

Changed merged from **sage-4.7.3.alpha0** to **sage-4.8.alpha0**
