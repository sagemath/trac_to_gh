# Issue 11653: desolve failed to solve an ODE whose solution implies integration limits

archive/issues_011481.json:
```json
{
    "body": "Assignee: @burcin\n\nCC:  @kcrisman @nbruin\n\nKeywords: maxima, at, desolve\n\nWhen trying to solve a simple ODE whose rhs contains a function, Sage fails to interpret the Maxima output if this contains integration limits.\n\n## A minimal example\n\n```\nsage: x=var('x') # independent variable\nsage: v=function('v', x) # dependent variable\n```\nif we now define a custom square pulse function\n\n```python\ndef pulse(tonset, tdur, amp):\n    \"\"\"\n    returns a square pulse as a function of x, f(x) \n    the pulse is defined as follows:  \n    t onset -- start of pulse  \n    tdur   -- duration of pulse  \n    amp    -- amplitude of pulse \n    \"\"\"\n\n    f(x)= amp*(sign(x-tonset)/2-sign(x-tonset-tdur)/2)\n    return f\n```\nnow we create a pulse function\n\n```\nsage: mypulse = pulse(tonset=5, tdur=5, amp=2)\n```\nand define differential equation\n\n```\nsage: dvdx = diff(v, x)-x -mypulse == 0 # mypulse(x) is function\n```\nTo get the evolution of v we can use **desolve**\n\n```\nmyvolt = desolve(de=dvdx, ivar=x, dvar=v, ics=[0,0])\n```\nThe error message is:\n\n```python\nTypeError: \nunable to make sense of Maxima expression \n'v(x)=-(2*(at(integrate(signum(x-5)-signum(x-13),x),[x=0,v(x)=0]))-2*int\\egrate(signum(x-5)-signum(x-13),x)-x^2)/2' \nin Sage\n```\n\ndesolve_laplace leads to similar error:\n\n```\nsage: desolve(de=dvdx, ivar=x, dvar=v, ics=[0,0])\n```\n\n```python\nTypeError: \nunable to make sense of Maxima expression \n'ilt(((laplace(signum(x-5),x,?g2733)-laplace(signum(x-13),x,?g2733)+v(0)\\ )*?g2733^2+1)/?g2733^3,?g2733,x)' \nin Sage\n```\n\nAccording to Nils Bruin, the problem is that Maxima 'at' function. As described in Ticket #385, this can be a problem with the implementation of 'at' for SR.\n\n## Expressions that work\nAnd adding the **sign** function to the differential function does not affect the solution.\n\n```\nsage: dvdx = diff(v, x)-v -sign(x) == 0 \nsage: desolve(de=dvdx, ivar=x, dvar=v) \nsage: (c + integrate(e^(-x)*sgn(x), x))*e^x\n```\n\nHowever, adding initial conditions produces an output that Sage is not able to evaluate\n\n```\nsage: desolve(de = dvdx, ivar=x, dvar=v, ics=[0,0])\n```\n\nThe output is:\n\n```python\nTypeError: \nunable to make sense of Maxima expression \n'v(x)=e^x*integrate(e^-x*signum(x),x)-e^x*(at(integrate(e^-x*signum(x),x),[x=0,v(x)=0]))'\n in Sage\n\n```\n\nI guess Sage is not able to interpret the integrations limits prompted by Maxima (e.g [t=0,v(t)=0]). \n\nDetailed information (and a more realistic example) can be found here: http://groups.google.com/group/sage-support/browse_thread/thread/8cc67d39510faca2\n\nIssue created by migration from https://trac.sagemath.org/ticket/11653\n\n",
    "created_at": "2011-08-05T21:19:47Z",
    "labels": [
        "component: calculus",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "desolve failed to solve an ODE whose solution implies integration limits",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11653",
    "user": "https://trac.sagemath.org/admin/accounts/users/JGuzman"
}
```
Assignee: @burcin

CC:  @kcrisman @nbruin

Keywords: maxima, at, desolve

When trying to solve a simple ODE whose rhs contains a function, Sage fails to interpret the Maxima output if this contains integration limits.

## A minimal example

```
sage: x=var('x') # independent variable
sage: v=function('v', x) # dependent variable
```
if we now define a custom square pulse function

```python
def pulse(tonset, tdur, amp):
    """
    returns a square pulse as a function of x, f(x) 
    the pulse is defined as follows:  
    t onset -- start of pulse  
    tdur   -- duration of pulse  
    amp    -- amplitude of pulse 
    """

    f(x)= amp*(sign(x-tonset)/2-sign(x-tonset-tdur)/2)
    return f
```
now we create a pulse function

```
sage: mypulse = pulse(tonset=5, tdur=5, amp=2)
```
and define differential equation

```
sage: dvdx = diff(v, x)-x -mypulse == 0 # mypulse(x) is function
```
To get the evolution of v we can use **desolve**

```
myvolt = desolve(de=dvdx, ivar=x, dvar=v, ics=[0,0])
```
The error message is:

```python
TypeError: 
unable to make sense of Maxima expression 
'v(x)=-(2*(at(integrate(signum(x-5)-signum(x-13),x),[x=0,v(x)=0]))-2*int\egrate(signum(x-5)-signum(x-13),x)-x^2)/2' 
in Sage
```

desolve_laplace leads to similar error:

```
sage: desolve(de=dvdx, ivar=x, dvar=v, ics=[0,0])
```

```python
TypeError: 
unable to make sense of Maxima expression 
'ilt(((laplace(signum(x-5),x,?g2733)-laplace(signum(x-13),x,?g2733)+v(0)\ )*?g2733^2+1)/?g2733^3,?g2733,x)' 
in Sage
```

According to Nils Bruin, the problem is that Maxima 'at' function. As described in Ticket #385, this can be a problem with the implementation of 'at' for SR.

## Expressions that work
And adding the **sign** function to the differential function does not affect the solution.

```
sage: dvdx = diff(v, x)-v -sign(x) == 0 
sage: desolve(de=dvdx, ivar=x, dvar=v) 
sage: (c + integrate(e^(-x)*sgn(x), x))*e^x
```

However, adding initial conditions produces an output that Sage is not able to evaluate

```
sage: desolve(de = dvdx, ivar=x, dvar=v, ics=[0,0])
```

The output is:

```python
TypeError: 
unable to make sense of Maxima expression 
'v(x)=e^x*integrate(e^-x*signum(x),x)-e^x*(at(integrate(e^-x*signum(x),x),[x=0,v(x)=0]))'
 in Sage

```

I guess Sage is not able to interpret the integrations limits prompted by Maxima (e.g [t=0,v(t)=0]). 

Detailed information (and a more realistic example) can be found here: http://groups.google.com/group/sage-support/browse_thread/thread/8cc67d39510faca2

Issue created by migration from https://trac.sagemath.org/ticket/11653





---

archive/issue_comments_128072.json:
```json
{
    "body": "Changing keywords from \"\" to \"maxima, at, desolve\".",
    "created_at": "2011-08-05T22:48:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11653#issuecomment-128072",
    "user": "https://trac.sagemath.org/admin/accounts/users/JGuzman"
}
```

Changing keywords from "" to "maxima, at, desolve".



---

archive/issue_comments_128073.json:
```json
{
    "body": "Thanks, Jose!  Just a few pointers:\n\n* You can use some formatting to do stuff here.  There are links on the main Trac page, but the most useful one is putting code examples in triples { braces.\n* The 'author' is the author of the patch.  You are the reporter :) though perhaps also the eventual author as well!",
    "created_at": "2011-08-06T02:09:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11653#issuecomment-128073",
    "user": "https://github.com/kcrisman"
}
```

Thanks, Jose!  Just a few pointers:

* You can use some formatting to do stuff here.  There are links on the main Trac page, but the most useful one is putting code examples in triples { braces.
* The 'author' is the author of the patch.  You are the reporter :) though perhaps also the eventual author as well!



---

archive/issue_comments_128074.json:
```json
{
    "body": "As to the ticket, see the sage-support thread in question.  The essential problem is that in `laplace` and `taylor` we take the answer from Maxima and send it to SR, which does parse the `at` correctly via the Maxima string thingie in calculus/calculus.py, but in the `desolve_*` functions we just coerce to `.sage()`, which does not.  Probably changing this would fix it.",
    "created_at": "2011-08-06T02:14:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11653#issuecomment-128074",
    "user": "https://github.com/kcrisman"
}
```

As to the ticket, see the sage-support thread in question.  The essential problem is that in `laplace` and `taylor` we take the answer from Maxima and send it to SR, which does parse the `at` correctly via the Maxima string thingie in calculus/calculus.py, but in the `desolve_*` functions we just coerce to `.sage()`, which does not.  Probably changing this would fix it.



---

archive/issue_comments_128075.json:
```json
{
    "body": "I re-formatted the text according to kcrisman (thanks a lot for the suggestion!). I will have a look to the code soon. I am looking forward to implement it. If I understood correctly, the only thing to do is to make desolve_* take the answer from Maxima to SR.",
    "created_at": "2011-08-06T08:15:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11653#issuecomment-128075",
    "user": "https://trac.sagemath.org/admin/accounts/users/JGuzman"
}
```

I re-formatted the text according to kcrisman (thanks a lot for the suggestion!). I will have a look to the code soon. I am looking forward to implement it. If I understood correctly, the only thing to do is to make desolve_* take the answer from Maxima to SR.



---

archive/issue_comments_128076.json:
```json
{
    "body": "Changing assignee from @burcin to JGuzman.",
    "created_at": "2011-08-07T15:32:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11653#issuecomment-128076",
    "user": "https://trac.sagemath.org/admin/accounts/users/JGuzman"
}
```

Changing assignee from @burcin to JGuzman.



---

archive/issue_comments_128077.json:
```json
{
    "body": "I changed the summary to delimit the error more carefully. Additional,   a more detailed explanation is given of cases in which Sage is able to interpret Maxima output. I guess, the problem is that Sage is not able to interpret the integration limits prompted by the maxima expression.",
    "created_at": "2011-08-07T15:32:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11653#issuecomment-128077",
    "user": "https://trac.sagemath.org/admin/accounts/users/JGuzman"
}
```

I changed the summary to delimit the error more carefully. Additional,   a more detailed explanation is given of cases in which Sage is able to interpret Maxima output. I guess, the problem is that Sage is not able to interpret the integration limits prompted by the maxima expression.



---

archive/issue_comments_128078.json:
```json
{
    "body": "Changing assignee from JGuzman to @burcin.",
    "created_at": "2011-08-07T15:39:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11653#issuecomment-128078",
    "user": "https://trac.sagemath.org/admin/accounts/users/JGuzman"
}
```

Changing assignee from JGuzman to @burcin.



---

archive/issue_comments_128079.json:
```json
{
    "body": "Change owner to burcin (I do not know why it changed last time !), and change the typesetting of TypeError",
    "created_at": "2011-08-07T15:39:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11653#issuecomment-128079",
    "user": "https://trac.sagemath.org/admin/accounts/users/JGuzman"
}
```

Change owner to burcin (I do not know why it changed last time !), and change the typesetting of TypeError



---

archive/issue_comments_128080.json:
```json
{
    "body": "There are several issues here, actually, so it may take a bit to solve this.  We are apparently translating several things wrongly by not going through SR, but then there is also the 'general' variable `?g2733` which I remember being still undealt with... probably won't be fixed immediately :( just because of time constraints.",
    "created_at": "2011-08-08T13:08:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11653",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11653#issuecomment-128080",
    "user": "https://github.com/kcrisman"
}
```

There are several issues here, actually, so it may take a bit to solve this.  We are apparently translating several things wrongly by not going through SR, but then there is also the 'general' variable `?g2733` which I remember being still undealt with... probably won't be fixed immediately :( just because of time constraints.



---

archive/issue_events_030596.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11653",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11653#event-30596"
}
```



---

archive/issue_events_030597.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11653",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11653#event-30597"
}
```



---

archive/issue_events_030598.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11653",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11653#event-30598"
}
```



---

archive/issue_events_030599.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11653",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11653#event-30599"
}
```



---

archive/issue_events_030600.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11653",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11653#event-30600"
}
```



---

archive/issue_events_030601.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11653",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11653#event-30601"
}
```



---

archive/issue_events_030602.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11653",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11653#event-30602"
}
```
