# Issue 11842: substitute_function doesn't work as expected in many cases

archive/issues_011670.json:
```json
{
    "body": "I'm working on polynomial interpolation at the moment, and these are starting to hurt. Most of them have workarounds, but there don't seem to be any for the expressions involving derivatives.\n\nI've also tried with subs() and the like, but one step at a time.\n\n```\nfrom sage.all import *\n\n\n# 1. Fails.\nx = var('x')\nf = function('f', x)\ng = function('g', x)\np = f\nprint p.substitute_function(f, g) # Outputs \"f(x)\"\n\n\n\n# 2. Fails.\nx = var('x')\nf = function('f')\ng = function('g')\np = f(x)\nprint p.substitute_function(f(x), g(x)) # Outputs \"f(x)\"\n\n\n\n# 3. Works.\nx = var('x')\nf = function('f')\ng = function('g')\np = f(x)\nprint p.substitute_function(f, g) # Outputs \"g(x)\"\n\n\n\n# 4. Fails.\nx = var('x')\nf = function('f')\ng = function('g')\np = f(1)\nprint p.substitute_function(f(1), g(1)) # Outputs \"f(1)\"\n\n\n\n# 5. Works.\nx = var('x')\nf = function('f')\ng = function('g')\np = f(1)\nprint p.substitute_function(f, g) # Outputs \"g(1)\"\n\n\n\n# 6. Fails.\nx = var('x')\nf = function('f', x)\ng = function('g', x)\np = f.diff()\nprint p.substitute_function(f, g) # Outputs \"D[0](f)(x)\"\n\n\n\n# 7. Fails.\nx = var('x')\nf = function('f', x)\ng = function('g', x)\np = f.diff()\nprint p.substitute_function(f(x), g(x)) # Outputs \"D[0](f)(x)\"\n\n\n\n# 8. Works.\nx = var('x')\nf = function('f')\ng = function('g')\np = f(x).diff()\nprint p.substitute_function(f, g) # Outputs \"D[0](g)(x)\"\n\n\n\n# 9. Fails.\nx = var('x')\nf = function('f')\ng = function('g')\np = f(x).diff()(1)\nprint p.substitute_function(f(x).diff(), g(x).diff()) # Outputs \"D[0](f)(1)\"\n\n\n\n# 10. Works..\nx = var('x')\nf = function('f')\ng = function('g')\np = f(x).diff()(1)\nprint p.substitute_function(f, g) # Prints D[0](g)(1).\n```\n\n**Assignee:** @burcin\n\n**Reviewer:** Burcin Erocal\n\n**Resolution:** duplicate\n\nIssue created by migration from https://trac.sagemath.org/ticket/11842\n\n",
    "closed_at": "2012-02-16T21:30:26Z",
    "created_at": "2011-09-24T01:59:58Z",
    "labels": [
        "component: symbolics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "substitute_function doesn't work as expected in many cases",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11842",
    "user": "https://github.com/orlitzky"
}
```
I'm working on polynomial interpolation at the moment, and these are starting to hurt. Most of them have workarounds, but there don't seem to be any for the expressions involving derivatives.

I've also tried with subs() and the like, but one step at a time.

```
from sage.all import *


# 1. Fails.
x = var('x')
f = function('f', x)
g = function('g', x)
p = f
print p.substitute_function(f, g) # Outputs "f(x)"



# 2. Fails.
x = var('x')
f = function('f')
g = function('g')
p = f(x)
print p.substitute_function(f(x), g(x)) # Outputs "f(x)"



# 3. Works.
x = var('x')
f = function('f')
g = function('g')
p = f(x)
print p.substitute_function(f, g) # Outputs "g(x)"



# 4. Fails.
x = var('x')
f = function('f')
g = function('g')
p = f(1)
print p.substitute_function(f(1), g(1)) # Outputs "f(1)"



# 5. Works.
x = var('x')
f = function('f')
g = function('g')
p = f(1)
print p.substitute_function(f, g) # Outputs "g(1)"



# 6. Fails.
x = var('x')
f = function('f', x)
g = function('g', x)
p = f.diff()
print p.substitute_function(f, g) # Outputs "D[0](f)(x)"



# 7. Fails.
x = var('x')
f = function('f', x)
g = function('g', x)
p = f.diff()
print p.substitute_function(f(x), g(x)) # Outputs "D[0](f)(x)"



# 8. Works.
x = var('x')
f = function('f')
g = function('g')
p = f(x).diff()
print p.substitute_function(f, g) # Outputs "D[0](g)(x)"



# 9. Fails.
x = var('x')
f = function('f')
g = function('g')
p = f(x).diff()(1)
print p.substitute_function(f(x).diff(), g(x).diff()) # Outputs "D[0](f)(1)"



# 10. Works..
x = var('x')
f = function('f')
g = function('g')
p = f(x).diff()(1)
print p.substitute_function(f, g) # Prints D[0](g)(1).
```

**Assignee:** @burcin

**Reviewer:** Burcin Erocal

**Resolution:** duplicate

Issue created by migration from https://trac.sagemath.org/ticket/11842





---

archive/issue_comments_167201.json:
```json
{
    "body": "<a id='comment:1'></a>\nIt looks like I accidentally duped #6480 here.",
    "created_at": "2012-01-03T22:47:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11842",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11842#issuecomment-167201",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:1'></a>
It looks like I accidentally duped #6480 here.



---

archive/issue_events_036884.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2012-01-03T22:47:57Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11842",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11842#event-36884"
}
```



---

archive/issue_comments_167202.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2012-02-08T11:36:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11842",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11842#issuecomment-167202",
    "user": "https://github.com/burcin"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_167203.json:
```json
{
    "body": "**Reviewer:** Burcin Erocal",
    "created_at": "2012-02-08T11:36:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11842",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11842#issuecomment-167203",
    "user": "https://github.com/burcin"
}
```

**Reviewer:** Burcin Erocal



---

archive/issue_comments_167204.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2012-02-08T11:36:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11842",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11842#issuecomment-167204",
    "user": "https://github.com/burcin"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_events_036885.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-02-16T21:30:26Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11842",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11842#event-36885"
}
```



---

archive/issue_comments_167205.json:
```json
{
    "body": "**Resolution:** duplicate",
    "created_at": "2012-02-16T21:30:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11842",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11842#issuecomment-167205",
    "user": "https://github.com/jdemeyer"
}
```

**Resolution:** duplicate



---

archive/issue_comments_167206.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -24,7 +24,7 @@\n \n \n \n-# 3. Fails.\n+# 3. Works.\n x = var('x')\n f = function('f')\n g = function('g')\n@@ -92,5 +92,5 @@\n f = function('f')\n g = function('g')\n p = f(x).diff()(1)\n-print p.substitute_function(f, g) # Crashes.\n+print p.substitute_function(f, g) # Works, prints D[0](g)(1).\n ```\n``````\n",
    "created_at": "2013-05-15T17:38:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11842",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11842#issuecomment-167206",
    "user": "https://github.com/orlitzky"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -24,7 +24,7 @@
 
 
 
-# 3. Fails.
+# 3. Works.
 x = var('x')
 f = function('f')
 g = function('g')
@@ -92,5 +92,5 @@
 f = function('f')
 g = function('g')
 p = f(x).diff()(1)
-print p.substitute_function(f, g) # Crashes.
+print p.substitute_function(f, g) # Works, prints D[0](g)(1).
 ```
``````




---

archive/issue_comments_167207.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -87,10 +87,10 @@\n \n \n \n-# 10. Fails.\n+# 10. Works..\n x = var('x')\n f = function('f')\n g = function('g')\n p = f(x).diff()(1)\n-print p.substitute_function(f, g) # Works, prints D[0](g)(1).\n+print p.substitute_function(f, g) # Prints D[0](g)(1).\n ```\n``````\n",
    "created_at": "2013-05-15T17:38:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11842",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11842#issuecomment-167207",
    "user": "https://github.com/orlitzky"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -87,10 +87,10 @@
 
 
 
-# 10. Fails.
+# 10. Works..
 x = var('x')
 f = function('f')
 g = function('g')
 p = f(x).diff()(1)
-print p.substitute_function(f, g) # Works, prints D[0](g)(1).
+print p.substitute_function(f, g) # Prints D[0](g)(1).
 ```
``````

