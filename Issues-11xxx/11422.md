# Issue 11422: modular subgroups

archive/issues_011250.json:
```json
{
    "assignees": [
        "https://github.com/videlec"
    ],
    "body": "<div id=\"comment:0\"></div>\n\nThis ticket aims to extend capability of the class `ArithmeticSubgroup_Permutation` in `sage.modular.arithgroup_perm`. This is now possible to deal with any subgroup of `SL(2,Z)` and many new methods are available (in particular equality of subgroups, conjugacy problem, ...)\n\nI reimplement the method `todd_coxeter` of `sage.modular.arithgroup.arithgroup_generic` to be faster and with more output.\n\nI also created a test file for arithmetic subgroup.\n\nSee details and documentation in the patch.\n\n---\n\nApply\n1. [attachment: trac_11422-sl2z_subgroups.patch](https://github.com/sagemath/sage/files/ticket11422/trac_11422-sl2z_subgroups.patch.gz)\n2. [attachment: trac_11422-reviewerfix.patch](https://github.com/sagemath/sage/files/ticket11422/trac_11422-reviewerfix.patch.gz)\n3. [attachment: trac_11422_unpicklefix.patch](https://github.com/sagemath/sage/files/ticket11422/trac_11422_unpicklefix.patch.gz)\nto the Sage library.\n\n\nDepends on #10334\nDepends on #10335\n\nComponent: **modular forms**\n\nKeywords: **group, arithmetic, linear group, sl**\n\nAuthor: **Vincent Delecroix**\n\nReviewer: **David Loeffler**\n\nMerged: **sage-4.7.2.alpha3**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/11422_\n\n",
    "closed_at": "2011-09-27T17:43:46Z",
    "created_at": "2011-06-02T21:04:30Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20modular%20forms",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/c%3A%20modular%20forms"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.7.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "modular subgroups",
    "type": "issue",
    "updated_at": "2011-09-27T17:43:46Z",
    "url": "https://github.com/sagemath/sage/issues/11422",
    "user": "https://github.com/videlec"
}
```
<div id="comment:0"></div>

This ticket aims to extend capability of the class `ArithmeticSubgroup_Permutation` in `sage.modular.arithgroup_perm`. This is now possible to deal with any subgroup of `SL(2,Z)` and many new methods are available (in particular equality of subgroups, conjugacy problem, ...)

I reimplement the method `todd_coxeter` of `sage.modular.arithgroup.arithgroup_generic` to be faster and with more output.

I also created a test file for arithmetic subgroup.

See details and documentation in the patch.

---

Apply
1. [attachment: trac_11422-sl2z_subgroups.patch](https://github.com/sagemath/sage/files/ticket11422/trac_11422-sl2z_subgroups.patch.gz)
2. [attachment: trac_11422-reviewerfix.patch](https://github.com/sagemath/sage/files/ticket11422/trac_11422-reviewerfix.patch.gz)
3. [attachment: trac_11422_unpicklefix.patch](https://github.com/sagemath/sage/files/ticket11422/trac_11422_unpicklefix.patch.gz)
to the Sage library.


Depends on #10334
Depends on #10335

Component: **modular forms**

Keywords: **group, arithmetic, linear group, sl**

Author: **Vincent Delecroix**

Reviewer: **David Loeffler**

Merged: **sage-4.7.2.alpha3**

_Issue created by migration from https://trac.sagemath.org/ticket/11422_





---

archive/issue_events_150490.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2011-06-02T21:04:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "milestone_number": null,
    "milestone_title": "sage-4.7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11422#event-150490"
}
```



---

archive/issue_events_150491.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2011-06-02T21:04:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11422#event-150491"
}
```



---

archive/issue_events_150492.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2011-06-02T21:04:30Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "subject": "https://github.com/videlec",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11422#event-150492"
}
```



---

archive/issue_events_150493.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2011-06-02T21:24:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20modular%20forms",
    "label_color": "0000ff",
    "label_name": "c: modular forms",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11422#event-150493"
}
```



---

archive/issue_events_150494.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2011-06-02T21:24:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11422#event-150494"
}
```



---

archive/issue_events_150495.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2011-06-03T13:39:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11422#event-150495"
}
```



---

archive/issue_comments_115558.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,7 @@\n-This ticket aims to extends capability of the class ArithmeticSubgroup_Permutation in sage.modular.arithgroup_perm. This is now possible to deal with any subgroup of `SL(2,Z)`.\n+This ticket aims to extend capability of the class ArithmeticSubgroup_Permutation in sage.modular.arithgroup_perm. This is now possible to deal with any subgroup of `SL(2,Z)` and many new methods are available (in particular equality of subgroups, conjugacy problem, ...)\n \n-See details in the patch.\n+I reimplement the method todd_coxeter of sage.modular.arithgroup.arithgroup_generic to be faster and with more output.\n+\n+I also created a test file for arithmetic subgroup.\n+\n+See details and documentation in the patch.\n``````\n",
    "created_at": "2011-06-03T13:39:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11422#issuecomment-115558",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,7 @@
-This ticket aims to extends capability of the class ArithmeticSubgroup_Permutation in sage.modular.arithgroup_perm. This is now possible to deal with any subgroup of `SL(2,Z)`.
+This ticket aims to extend capability of the class ArithmeticSubgroup_Permutation in sage.modular.arithgroup_perm. This is now possible to deal with any subgroup of `SL(2,Z)` and many new methods are available (in particular equality of subgroups, conjugacy problem, ...)
 
-See details in the patch.
+I reimplement the method todd_coxeter of sage.modular.arithgroup.arithgroup_generic to be faster and with more output.
+
+I also created a test file for arithmetic subgroup.
+
+See details and documentation in the patch.
``````




---

archive/issue_comments_115559.json:
```json
{
    "body": "Changed keywords from none to **group, arithmetic, linear group, sl**",
    "created_at": "2011-06-03T13:39:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11422#issuecomment-115559",
    "user": "https://github.com/videlec"
}
```

Changed keywords from none to **group, arithmetic, linear group, sl**



---

archive/issue_comments_115560.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,3 +5,5 @@\n I also created a test file for arithmetic subgroup.\n \n See details and documentation in the patch.\n+\n+depends on #10334\n``````\n",
    "created_at": "2011-06-03T13:43:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11422#issuecomment-115560",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,3 +5,5 @@
 I also created a test file for arithmetic subgroup.
 
 See details and documentation in the patch.
+
+depends on #10334
``````




---

archive/issue_comments_115561.json:
```json
{
    "body": "Work Issues: **doctest failures**",
    "created_at": "2011-07-04T14:20:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11422#issuecomment-115561",
    "user": "https://github.com/loefflerd"
}
```

Work Issues: **doctest failures**



---

archive/issue_comments_115562.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nThis looks great -- I always meant to do some more work on this but never got around to it, and you are clearly much better equipped to do so than I. Sadly there are masses of doctest failures (48 of them on a clean 4.7.1.alpha3 build with just your patch applied).  Almost all of them look like this:\n\n```\nTypeError: cycle_tuples() takes no keyword arguments\n```\n\nAlso, some gripes:\n\n- The English is a bit ropey in some of the docstrings (e.g. \"vue\", \"canonic\").\n\n- Some more explanation of what a few of the functions are doing would be nice -- e.g. what is canonical about the canonical labels?",
    "created_at": "2011-07-04T14:20:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11422#issuecomment-115562",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:4" align="right">comment:4</div>

This looks great -- I always meant to do some more work on this but never got around to it, and you are clearly much better equipped to do so than I. Sadly there are masses of doctest failures (48 of them on a clean 4.7.1.alpha3 build with just your patch applied).  Almost all of them look like this:

```
TypeError: cycle_tuples() takes no keyword arguments
```

Also, some gripes:

- The English is a bit ropey in some of the docstrings (e.g. "vue", "canonic").

- Some more explanation of what a few of the functions are doing would be nice -- e.g. what is canonical about the canonical labels?



---

archive/issue_events_150496.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2011-07-04T14:20:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11422#event-150496"
}
```



---

archive/issue_events_150497.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2011-07-04T14:20:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11422#event-150497"
}
```



---

archive/issue_comments_115563.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,4 +6,4 @@\n \n See details and documentation in the patch.\n \n-depends on #10334\n+depends on #10334, #10335\n``````\n",
    "created_at": "2011-07-05T19:05:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11422#issuecomment-115563",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,4 +6,4 @@
 
 See details and documentation in the patch.
 
-depends on #10334
+depends on #10334, #10335
``````




---

archive/issue_comments_115564.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nHello,\n\nThanks for starting to look at this.\n\nReplying to [@loefflerd](#comment%3A4):\n> This looks great -- I always meant to do some more work on this but never got around to it, and you are clearly much better equipped to do so than I. Sadly there are masses of doctest failures (48 of them on a clean 4.7.1.alpha3 build with just your patch applied).  Almost all of them look like this:\n> \n> ```\n> TypeError: cycle_tuples() takes no keyword arguments\n> ```\n\nThere was a dependancy problem with #10335 which is now in the description.\n\n> Also, some gripes:\n> \n> - The English is a bit ropey in some of the docstrings (e.g. \"vue\", \"canonic\").\n\nI'm not a native speaker and it's not easy to find where the errors are. In the new version I will post in few minutes, I have tried to be attentive to the language.\n \n> - Some more explanation of what a few of the functions are doing would be nice -- e.g. what is canonical about the canonical labels?\n\nCould you be more precise ? In the new version, I expanded some of the documentations (especially the canonical labels).",
    "created_at": "2011-07-05T19:08:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11422#issuecomment-115564",
    "user": "https://github.com/videlec"
}
```

<div id="comment:6" align="right">comment:6</div>

Hello,

Thanks for starting to look at this.

Replying to [@loefflerd](#comment%3A4):
> This looks great -- I always meant to do some more work on this but never got around to it, and you are clearly much better equipped to do so than I. Sadly there are masses of doctest failures (48 of them on a clean 4.7.1.alpha3 build with just your patch applied).  Almost all of them look like this:
> 
> ```
> TypeError: cycle_tuples() takes no keyword arguments
> ```

There was a dependancy problem with #10335 which is now in the description.

> Also, some gripes:
> 
> - The English is a bit ropey in some of the docstrings (e.g. "vue", "canonic").

I'm not a native speaker and it's not easy to find where the errors are. In the new version I will post in few minutes, I have tried to be attentive to the language.
 
> - Some more explanation of what a few of the functions are doing would be nice -- e.g. what is canonical about the canonical labels?

Could you be more precise ? In the new version, I expanded some of the documentations (especially the canonical labels).



---

archive/issue_comments_115565.json:
```json
{
    "body": "Changed work issues from **doctest failures** to none",
    "created_at": "2011-07-05T19:32:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11422#issuecomment-115565",
    "user": "https://github.com/videlec"
}
```

Changed work issues from **doctest failures** to none



---

archive/issue_events_150498.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2011-07-05T19:32:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11422#event-150498"
}
```



---

archive/issue_events_150499.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2011-07-05T19:32:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11422#event-150499"
}
```



---

archive/issue_events_150500.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2011-07-06T10:47:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11422#event-150500"
}
```



---

archive/issue_events_150501.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2011-07-06T10:47:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11422#event-150501"
}
```



---

archive/issue_comments_115566.json:
```json
{
    "body": "Work Issues: **corrections to docstrings**",
    "created_at": "2011-07-06T10:47:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11422#issuecomment-115566",
    "user": "https://github.com/loefflerd"
}
```

Work Issues: **corrections to docstrings**



---

archive/issue_comments_115567.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nOK, I downloaded #10335 and its prerequisites and it works fine now. \n\nAlgorithm comments: \n\n- For permutation subgroups, almost all calculations are done with a relabelled version, but this is generated anew every time! I'd suggest:\n\n  - having a flag that remembers whether the group is already canonically labelled,\n\n  - when that's not the case, caching the canonically labelled version.\n\n- At line 1019 of `arithgroup.py`, if check is True, won't this cause the check code to be run *twice*?\n\nCorrections to docstrings:\n\nIn `arithgroup_generic.py`:\n\n- The docstring for the todd_coxeter method is a bit vague: I'd suggest that you specify a bit more precisely what the lists `l` and `s` mean. \"The action of the parabolic elements\" is misleading; you mean the action of the specific parabolic element ` [[1, 1],[0,1]] `.\n\n- It is disrespectful to Todd and Coxeter to write their names in lowercase, as you do in the docstring for `as_permutation_group` -- better to write \"This uses Todd-Coxeter enumeration\".\n\nIn `arithgroup_perm.py`:\n\n- \"point of vue\" --> \"point of view\" in the module docstring (as I pointed out above)\n\n- Again in that docstring, you make it sound like all four of L, R, S2 and S3 are needed to generate the modular group -- explain that the \"three couples which are of main interest\" are of interest because each pair of elements generates the whole group.\n\n- The \"todo\" list will look bizzarre: some LaTeX formatting is needed for the second item\n\n- Line 328: \"generator\" --> \"generators\"\n\n- Line 630 \"numerotation\" --> \"numbering\"\n\n- 640: \"defines\" --> \"define\", \"renumerote\" --> \"renumber\" (the nonexistent word \"numerote\" appears twice more in the next few lines)\n\n- 744: \"Returns the smallest label among rooted label\" -- do you seriously expect that anyone will have the foggiest clue what this means?\n\n- 749: \"canonic\" --> \"canonical\". This occurs all over the place. Fix them all.\n\n- 810: needs more explanation of what the argument j0 does.\n\n- 812: \"renumerotation\" --> \"renumbering\" again.\n\n- 908: \"does not permutes\" --> \"does not permute\"\n\n- 947: \"at the first times\" --> \"at the first time\"\n\nThat's as far as I've got so far -- other duties call.",
    "created_at": "2011-07-06T10:47:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11422#issuecomment-115567",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:8" align="right">comment:8</div>

OK, I downloaded #10335 and its prerequisites and it works fine now. 

Algorithm comments: 

- For permutation subgroups, almost all calculations are done with a relabelled version, but this is generated anew every time! I'd suggest:

  - having a flag that remembers whether the group is already canonically labelled,

  - when that's not the case, caching the canonically labelled version.

- At line 1019 of `arithgroup.py`, if check is True, won't this cause the check code to be run *twice*?

Corrections to docstrings:

In `arithgroup_generic.py`:

- The docstring for the todd_coxeter method is a bit vague: I'd suggest that you specify a bit more precisely what the lists `l` and `s` mean. "The action of the parabolic elements" is misleading; you mean the action of the specific parabolic element ` [[1, 1],[0,1]] `.

- It is disrespectful to Todd and Coxeter to write their names in lowercase, as you do in the docstring for `as_permutation_group` -- better to write "This uses Todd-Coxeter enumeration".

In `arithgroup_perm.py`:

- "point of vue" --> "point of view" in the module docstring (as I pointed out above)

- Again in that docstring, you make it sound like all four of L, R, S2 and S3 are needed to generate the modular group -- explain that the "three couples which are of main interest" are of interest because each pair of elements generates the whole group.

- The "todo" list will look bizzarre: some LaTeX formatting is needed for the second item

- Line 328: "generator" --> "generators"

- Line 630 "numerotation" --> "numbering"

- 640: "defines" --> "define", "renumerote" --> "renumber" (the nonexistent word "numerote" appears twice more in the next few lines)

- 744: "Returns the smallest label among rooted label" -- do you seriously expect that anyone will have the foggiest clue what this means?

- 749: "canonic" --> "canonical". This occurs all over the place. Fix them all.

- 810: needs more explanation of what the argument j0 does.

- 812: "renumerotation" --> "renumbering" again.

- 908: "does not permutes" --> "does not permute"

- 947: "at the first times" --> "at the first time"

That's as far as I've got so far -- other duties call.



---

archive/issue_comments_115568.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nThanks for the detailed report.\n\n \n> Algorithm comments: \n> \n> - For permutation subgroups, almost all calculations are done with a relabelled version, but this is generated anew every time! I'd suggest:\n> \n>   - having a flag that remembers whether the group is already canonically labelled,\n> \n>   - when that's not the case, caching the canonically labelled version.\n\nTotally right. I choose to add an attribute _canonical_label_group when the group with canonical renumbering has been computed.\n \n> - At line 1019 of `arithgroup.py`, if check is True, won't this cause the check code to be run *twice*?\n\nI don't think so. The function `__call__` is called only once, the `__contains__` method does not call the constructor and the `__init__` method of ArithmeticSubgroupElement does not care about wheter or not the element is in the subgroup \"parent\" given as argument.\n\n> Corrections to docstrings:\n\nI made the corrections.",
    "created_at": "2011-07-06T14:27:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11422#issuecomment-115568",
    "user": "https://github.com/videlec"
}
```

<div id="comment:9" align="right">comment:9</div>

Thanks for the detailed report.

 
> Algorithm comments: 
> 
> - For permutation subgroups, almost all calculations are done with a relabelled version, but this is generated anew every time! I'd suggest:
> 
>   - having a flag that remembers whether the group is already canonically labelled,
> 
>   - when that's not the case, caching the canonically labelled version.

Totally right. I choose to add an attribute _canonical_label_group when the group with canonical renumbering has been computed.
 
> - At line 1019 of `arithgroup.py`, if check is True, won't this cause the check code to be run *twice*?

I don't think so. The function `__call__` is called only once, the `__contains__` method does not call the constructor and the `__init__` method of ArithmeticSubgroupElement does not care about wheter or not the element is in the subgroup "parent" given as argument.

> Corrections to docstrings:

I made the corrections.



---

archive/issue_comments_115569.json:
```json
{
    "body": "Changed work issues from **corrections to docstrings** to none",
    "created_at": "2011-07-06T14:27:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11422#issuecomment-115569",
    "user": "https://github.com/videlec"
}
```

Changed work issues from **corrections to docstrings** to none



---

archive/issue_events_150502.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2011-07-06T14:27:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11422#event-150502"
}
```



---

archive/issue_events_150503.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2011-07-06T14:27:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11422#event-150503"
}
```



---

archive/issue_comments_115570.json:
```json
{
    "body": "Work Issues: **amusing typo bug**",
    "created_at": "2011-07-06T20:32:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11422#issuecomment-115570",
    "user": "https://github.com/loefflerd"
}
```

Work Issues: **amusing typo bug**



---

archive/issue_comments_115571.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@videlec](#comment%3A9):\n> > Algorithm comments: \n> > \n> > - For permutation subgroups, almost all calculations are done with a relabelled version, but this is generated anew every time! I'd suggest:\n> > \n> >   - having a flag that remembers whether the group is already canonically labelled,\n> > \n> >   - when that's not the case, caching the canonically labelled version.\n> \n> \n> Totally right. I choose to add an attribute _canonical_label_group when the group with canonical renumbering has been computed.\n\nThere is an amusingly subtle bug here.\n\nAt line 769, the code sets the attribute `_canonical_labelel_group`, which is clearly a typo. This means that a subsequent hasattr check for `_canonical_label_group` returns False, leading to the following:\n\n```\nsage: S2 = \"(1,2)(3,4)(5,6)\"\nsage: S3 = \"(1,3,5)(2,4,6)\"\nsage: G = ArithmeticSubgroup_Permutation(S2=S2,S3=S3)\nsage: H = G.relabel(inplace=False)\nsage: G.has_canonical_labels()\nFalse\n```\n\nI don't think this is what you intended, is it?\n\nThe reason I said it's complicated is that naming the method `\"has_canonical_labels\"` is slightly misleading. I would have assumed that `\"G.has_canonical_labels() == True\"` means that the labels G is using are the canonical ones. Although it's not what you intended, the typo has meant that the function is now *almost* doing what I feel the name suggests it should do! (\"Almost\" because it might return False in some cases even if the labels actually are the canonical ones.)\n\nI would advocate correcting the typo at line 769 but also changing the `has_canonical_labels` function so it does what I said, i.e. so returns True if and only if `self._canonical_rooted_labels() == range(self.index())`, with a docstring to match.\n\n> > - At line 1019 of `arithgroup.py`, if check is True, won't this cause the check code to be run *twice*?\n> \n> \n> I don't think so. \n\nYou're right, of course; sorry.",
    "created_at": "2011-07-06T20:32:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11422#issuecomment-115571",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@videlec](#comment%3A9):
> > Algorithm comments: 
> > 
> > - For permutation subgroups, almost all calculations are done with a relabelled version, but this is generated anew every time! I'd suggest:
> > 
> >   - having a flag that remembers whether the group is already canonically labelled,
> > 
> >   - when that's not the case, caching the canonically labelled version.
> 
> 
> Totally right. I choose to add an attribute _canonical_label_group when the group with canonical renumbering has been computed.

There is an amusingly subtle bug here.

At line 769, the code sets the attribute `_canonical_labelel_group`, which is clearly a typo. This means that a subsequent hasattr check for `_canonical_label_group` returns False, leading to the following:

```
sage: S2 = "(1,2)(3,4)(5,6)"
sage: S3 = "(1,3,5)(2,4,6)"
sage: G = ArithmeticSubgroup_Permutation(S2=S2,S3=S3)
sage: H = G.relabel(inplace=False)
sage: G.has_canonical_labels()
False
```

I don't think this is what you intended, is it?

The reason I said it's complicated is that naming the method `"has_canonical_labels"` is slightly misleading. I would have assumed that `"G.has_canonical_labels() == True"` means that the labels G is using are the canonical ones. Although it's not what you intended, the typo has meant that the function is now *almost* doing what I feel the name suggests it should do! ("Almost" because it might return False in some cases even if the labels actually are the canonical ones.)

I would advocate correcting the typo at line 769 but also changing the `has_canonical_labels` function so it does what I said, i.e. so returns True if and only if `self._canonical_rooted_labels() == range(self.index())`, with a docstring to match.

> > - At line 1019 of `arithgroup.py`, if check is True, won't this cause the check code to be run *twice*?
> 
> 
> I don't think so. 

You're right, of course; sorry.



---

archive/issue_events_150504.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2011-07-06T20:32:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11422#event-150504"
}
```



---

archive/issue_events_150505.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2011-07-06T20:32:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11422#event-150505"
}
```



---

archive/issue_comments_115572.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@loefflerd](#comment%3A10):\n> Replying to [@videlec](#comment%3A9):\n> > > Algorithm comments: \n> > > \n> > > - For permutation subgroups, almost all calculations are done with a relabelled version, but this is generated anew every time! I'd suggest:\n> > > \n> > >   - having a flag that remembers whether the group is already canonically labelled,\n> > > \n> > >   - when that's not the case, caching the canonically labelled version.\n> > \n> > \n> > Totally right. I choose to add an attribute _canonical_label_group when the group with canonical renumbering has been computed.\n> \n> \n> There is an amusingly subtle bug here.\n> \n\nHopefully, you find that crazy bug! Thanks! I had a supplementary doctest for this method.\n\n> \n> I would advocate correcting the typo at line 769 but also changing the `has_canonical_labels` function so it does what I said, i.e. so returns True if and only if `self._canonical_rooted_labels() == range(self.index())`, with a docstring to match.\n>\n>\n\nI removed the function has_canonical_labels which is not useful at all.",
    "created_at": "2011-07-06T21:50:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11422#issuecomment-115572",
    "user": "https://github.com/videlec"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@loefflerd](#comment%3A10):
> Replying to [@videlec](#comment%3A9):
> > > Algorithm comments: 
> > > 
> > > - For permutation subgroups, almost all calculations are done with a relabelled version, but this is generated anew every time! I'd suggest:
> > > 
> > >   - having a flag that remembers whether the group is already canonically labelled,
> > > 
> > >   - when that's not the case, caching the canonically labelled version.
> > 
> > 
> > Totally right. I choose to add an attribute _canonical_label_group when the group with canonical renumbering has been computed.
> 
> 
> There is an amusingly subtle bug here.
> 

Hopefully, you find that crazy bug! Thanks! I had a supplementary doctest for this method.

> 
> I would advocate correcting the typo at line 769 but also changing the `has_canonical_labels` function so it does what I said, i.e. so returns True if and only if `self._canonical_rooted_labels() == range(self.index())`, with a docstring to match.
>
>

I removed the function has_canonical_labels which is not useful at all.



---

archive/issue_comments_115573.json:
```json
{
    "body": "Attachment: **[trac_11422-sl2z_subgroups.patch.gz](https://github.com/sagemath/sage/files/ticket11422/trac_11422-sl2z_subgroups.patch.gz)**",
    "created_at": "2011-07-06T21:51:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11422#issuecomment-115573",
    "user": "https://github.com/videlec"
}
```

Attachment: **[trac_11422-sl2z_subgroups.patch.gz](https://github.com/sagemath/sage/files/ticket11422/trac_11422-sl2z_subgroups.patch.gz)**



---

archive/issue_events_150506.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2011-07-06T21:51:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11422#event-150506"
}
```



---

archive/issue_events_150507.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2011-07-06T21:51:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11422#event-150507"
}
```



---

archive/issue_comments_115574.json:
```json
{
    "body": "Changed work issues from **amusing typo bug** to none",
    "created_at": "2011-07-06T21:51:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11422#issuecomment-115574",
    "user": "https://github.com/videlec"
}
```

Changed work issues from **amusing typo bug** to none



---

archive/issue_comments_115575.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nExcellent -- good stuff. Positive review. Sadly this is probably too late for 4.7.1, but it should get into 4.7.2.\n\n(Now I will have to rebase #5048, and not for the first time. I should stop giving positive reviews to patches that conflict with my own ;-) )",
    "created_at": "2011-07-06T22:04:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11422#issuecomment-115575",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:13" align="right">comment:13</div>

Excellent -- good stuff. Positive review. Sadly this is probably too late for 4.7.1, but it should get into 4.7.2.

(Now I will have to rebase #5048, and not for the first time. I should stop giving positive reviews to patches that conflict with my own ;-) )



---

archive/issue_events_150508.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2011-07-06T22:04:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11422#event-150508"
}
```



---

archive/issue_events_150509.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2011-07-06T22:04:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11422#event-150509"
}
```



---

archive/issue_comments_115576.json:
```json
{
    "body": "Reviewer: **David Loeffler**",
    "created_at": "2011-07-06T22:04:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11422#issuecomment-115576",
    "user": "https://github.com/loefflerd"
}
```

Reviewer: **David Loeffler**



---

archive/issue_events_150510.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-07-07T09:40:26Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "milestone_number": null,
    "milestone_title": "sage-4.7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11422#event-150510"
}
```



---

archive/issue_events_150511.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-07-07T09:40:26Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "milestone_number": null,
    "milestone_title": "sage-4.7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11422#event-150511"
}
```



---

archive/issue_comments_115577.json:
```json
{
    "body": "Dependencies: **#10334, #10335**",
    "created_at": "2011-07-07T09:41:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11422#issuecomment-115577",
    "user": "https://github.com/jdemeyer"
}
```

Dependencies: **#10334, #10335**



---

archive/issue_comments_115578.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,5 +5,3 @@\n I also created a test file for arithmetic subgroup.\n \n See details and documentation in the patch.\n-\n-depends on #10334, #10335\n``````\n",
    "created_at": "2011-07-07T09:41:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11422#issuecomment-115578",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,5 +5,3 @@
 I also created a test file for arithmetic subgroup.
 
 See details and documentation in the patch.
-
-depends on #10334, #10335
``````




---

archive/issue_events_150512.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2011-07-14T18:05:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11422#event-150512"
}
```



---

archive/issue_events_150513.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2011-07-14T18:05:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11422#event-150513"
}
```



---

archive/issue_comments_115579.json:
```json
{
    "body": "Work Issues: **to_even_subgroup problem**",
    "created_at": "2011-07-14T18:05:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11422#issuecomment-115579",
    "user": "https://github.com/loefflerd"
}
```

Work Issues: **to_even_subgroup problem**



---

archive/issue_comments_115580.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nHang on, there's something wrong with `to_even_subgroup`.\n\n```\nsage: H = ArithmeticSubgroup_Permutation(S2 = '(1,4,11,14)(2,7,12,17)(3,5,13,15)(6,9,16,19)(8,10,18,20)', S3 = '(1,2,3,11,12,13)(4,5,6,14,15,16)(7,8,9,17,18,19)(10,20)')\nsage: G = H.to_even_subgroup()\nsage: H.is_subgroup(G)\nFalse\n```",
    "created_at": "2011-07-14T18:05:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11422#issuecomment-115580",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:16" align="right">comment:16</div>

Hang on, there's something wrong with `to_even_subgroup`.

```
sage: H = ArithmeticSubgroup_Permutation(S2 = '(1,4,11,14)(2,7,12,17)(3,5,13,15)(6,9,16,19)(8,10,18,20)', S3 = '(1,2,3,11,12,13)(4,5,6,14,15,16)(7,8,9,17,18,19)(10,20)')
sage: G = H.to_even_subgroup()
sage: H.is_subgroup(G)
False
```



---

archive/issue_comments_115581.json:
```json
{
    "body": "Attachment: **[trac_11422-reviewerfix.patch.gz](https://github.com/sagemath/sage/files/ticket11422/trac_11422-reviewerfix.patch.gz)**\n\napply over previous patch",
    "created_at": "2011-07-14T18:23:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11422#issuecomment-115581",
    "user": "https://github.com/loefflerd"
}
```

Attachment: **[trac_11422-reviewerfix.patch.gz](https://github.com/sagemath/sage/files/ticket11422/trac_11422-reviewerfix.patch.gz)**

apply over previous patch



---

archive/issue_events_150514.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2011-07-14T18:25:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11422#event-150514"
}
```



---

archive/issue_events_150515.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2011-07-14T18:25:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11422#event-150515"
}
```



---

archive/issue_comments_115582.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nHere's a patch. The problem was the use of a python set type: you can certainly enumerate sets, but you shouldn't expect the enumeration order to be consistent! I changed the code slightly to use lists, combining two loops into one.\n\nVincent: if you're happy with my change, you can restore the positive review.",
    "created_at": "2011-07-14T18:25:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11422#issuecomment-115582",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:17" align="right">comment:17</div>

Here's a patch. The problem was the use of a python set type: you can certainly enumerate sets, but you shouldn't expect the enumeration order to be consistent! I changed the code slightly to use lists, combining two loops into one.

Vincent: if you're happy with my change, you can restore the positive review.



---

archive/issue_events_150516.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2011-07-14T20:09:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11422#event-150516"
}
```



---

archive/issue_events_150517.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2011-07-14T20:09:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11422#event-150517"
}
```



---

archive/issue_comments_115583.json:
```json
{
    "body": "Changed work issues from **to_even_subgroup problem** to none",
    "created_at": "2011-07-14T20:09:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11422#issuecomment-115583",
    "user": "https://github.com/videlec"
}
```

Changed work issues from **to_even_subgroup problem** to none



---

archive/issue_comments_115584.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@loefflerd](#comment%3A17):\n> Here's a patch. The problem was the use of a python set type: you can certainly enumerate sets, but you shouldn't expect the enumeration order to be consistent! I changed the code slightly to use lists, combining two loops into one.\n> \n> Vincent: if you're happy with my change, you can restore the positive review.\n\nThanks for debugging (it seems that you're using the code... cool!).",
    "created_at": "2011-07-14T20:09:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11422#issuecomment-115584",
    "user": "https://github.com/videlec"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@loefflerd](#comment%3A17):
> Here's a patch. The problem was the use of a python set type: you can certainly enumerate sets, but you shouldn't expect the enumeration order to be consistent! I changed the code slightly to use lists, combining two loops into one.
> 
> Vincent: if you're happy with my change, you can restore the positive review.

Thanks for debugging (it seems that you're using the code... cool!).



---

archive/issue_events_150518.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2011-07-21T20:38:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11422#event-150518"
}
```



---

archive/issue_events_150519.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2011-07-21T20:38:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11422#event-150519"
}
```



---

archive/issue_comments_115585.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nHang on, this isn't good:\n\n```\nsage -t -long -force_lib \"devel/sage/sage/structure/sage_object.pyx\"\n**********************************************************************\nFile \"/storage/masiao/sage-4.7.1.alpha4/devel/sage/sage/structure/sage_object.pyx\", line 1077:\n    sage: sage.structure.sage_object.unpickle_all()  # (4s on sage.math, 2011)\nExpected:\n    Successfully unpickled ... objects.\n    Failed to unpickle 0 objects.\nGot: \n     * unpickle failure: load('/home/masiao/.sage/temp/selmer/23062/dir_2/pickle_jar/_class__sage_modular_arithgroup_arithgroup_perm_ArithmeticSubgroup_Permutation__.sobj')\n    Failed:\n    _class__sage_modular_arithgroup_arithgroup_perm_ArithmeticSubgroup_Permutation__.sobj\n    Successfully unpickled 586 objects.\n    Failed to unpickle 1 objects.\n**********************************************************************\n1 items had failures:\n   1 of   7 in __main__.example_25\n***Test Failed*** 1 failures.\nFor whitespace errors, see the file /home/masiao/.sage//tmp/.doctest_sage_object.py\n         [8.2 s]\n```\n\nThis is because ` sage.modular.arithgroup.arithgroup_perm.ArithmeticSubgroup_Permutation` was a class before and is now a factory function, so Python doesn't know how to unpickle pickled objects of that class.",
    "created_at": "2011-07-21T20:38:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11422#issuecomment-115585",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:19" align="right">comment:19</div>

Hang on, this isn't good:

```
sage -t -long -force_lib "devel/sage/sage/structure/sage_object.pyx"
**********************************************************************
File "/storage/masiao/sage-4.7.1.alpha4/devel/sage/sage/structure/sage_object.pyx", line 1077:
    sage: sage.structure.sage_object.unpickle_all()  # (4s on sage.math, 2011)
Expected:
    Successfully unpickled ... objects.
    Failed to unpickle 0 objects.
Got: 
     * unpickle failure: load('/home/masiao/.sage/temp/selmer/23062/dir_2/pickle_jar/_class__sage_modular_arithgroup_arithgroup_perm_ArithmeticSubgroup_Permutation__.sobj')
    Failed:
    _class__sage_modular_arithgroup_arithgroup_perm_ArithmeticSubgroup_Permutation__.sobj
    Successfully unpickled 586 objects.
    Failed to unpickle 1 objects.
**********************************************************************
1 items had failures:
   1 of   7 in __main__.example_25
***Test Failed*** 1 failures.
For whitespace errors, see the file /home/masiao/.sage//tmp/.doctest_sage_object.py
         [8.2 s]
```

This is because ` sage.modular.arithgroup.arithgroup_perm.ArithmeticSubgroup_Permutation` was a class before and is now a factory function, so Python doesn't know how to unpickle pickled objects of that class.



---

archive/issue_comments_115586.json:
```json
{
    "body": "Attachment: **[trac_11422_unpicklefix.patch.gz](https://github.com/sagemath/sage/files/ticket11422/trac_11422_unpicklefix.patch.gz)**\n\napply over the two preceding patches",
    "created_at": "2011-07-30T12:15:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11422#issuecomment-115586",
    "user": "https://github.com/loefflerd"
}
```

Attachment: **[trac_11422_unpicklefix.patch.gz](https://github.com/sagemath/sage/files/ticket11422/trac_11422_unpicklefix.patch.gz)**

apply over the two preceding patches



---

archive/issue_events_150520.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2011-07-30T12:17:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11422#event-150520"
}
```



---

archive/issue_events_150521.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2011-07-30T12:17:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11422#event-150521"
}
```



---

archive/issue_comments_115587.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nIt turns out the unpickling problems can be sorted out by ensuring that ` sage.modular.arithgroup.arithgroup_perm.ArithmeticSubgroup_Permutation ` can be called with two positional arguments corresponding to L and R. All tests now pass on my system.",
    "created_at": "2011-07-30T12:17:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11422#issuecomment-115587",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:20" align="right">comment:20</div>

It turns out the unpickling problems can be sorted out by ensuring that ` sage.modular.arithgroup.arithgroup_perm.ArithmeticSubgroup_Permutation ` can be called with two positional arguments corresponding to L and R. All tests now pass on my system.



---

archive/issue_comments_115588.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@loefflerd](#comment%3A20):\n> It turns out the unpickling problems can be sorted out by ensuring that ` sage.modular.arithgroup.arithgroup_perm.ArithmeticSubgroup_Permutation ` can be called with two positional arguments corresponding to L and R. All tests now pass on my system.\n\nAll tests and backward compatibility with pickling also pass on my computer. I put a positive review.",
    "created_at": "2011-08-03T17:02:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11422#issuecomment-115588",
    "user": "https://github.com/videlec"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@loefflerd](#comment%3A20):
> It turns out the unpickling problems can be sorted out by ensuring that ` sage.modular.arithgroup.arithgroup_perm.ArithmeticSubgroup_Permutation ` can be called with two positional arguments corresponding to L and R. All tests now pass on my system.

All tests and backward compatibility with pickling also pass on my computer. I put a positive review.



---

archive/issue_events_150522.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2011-08-03T17:02:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11422#event-150522"
}
```



---

archive/issue_events_150523.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2011-08-03T17:02:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11422#event-150523"
}
```



---

archive/issue_events_150524.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-08-16T12:36:04Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "milestone_number": null,
    "milestone_title": "sage-4.7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11422#event-150524"
}
```



---

archive/issue_events_150525.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-08-16T12:36:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "label": "https://github.com/sagemath/sage/labels/pending",
    "label_color": "008080",
    "label_name": "pending",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11422#event-150525"
}
```



---

archive/issue_events_150526.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2011-09-22T15:22:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "milestone_number": null,
    "milestone_title": "sage-4.7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11422#event-150526"
}
```



---

archive/issue_events_150527.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2011-09-22T15:22:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "label": "https://github.com/sagemath/sage/labels/pending",
    "label_color": "008080",
    "label_name": "pending",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11422#event-150527"
}
```



---

archive/issue_comments_115589.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,7 +1,16 @@\n-This ticket aims to extend capability of the class ArithmeticSubgroup_Permutation in sage.modular.arithgroup_perm. This is now possible to deal with any subgroup of `SL(2,Z)` and many new methods are available (in particular equality of subgroups, conjugacy problem, ...)\n+This ticket aims to extend capability of the class `ArithmeticSubgroup_Permutation` in `sage.modular.arithgroup_perm`. This is now possible to deal with any subgroup of `SL(2,Z)` and many new methods are available (in particular equality of subgroups, conjugacy problem, ...)\n \n-I reimplement the method todd_coxeter of sage.modular.arithgroup.arithgroup_generic to be faster and with more output.\n+I reimplement the method `todd_coxeter` of `sage.modular.arithgroup.arithgroup_generic` to be faster and with more output.\n \n I also created a test file for arithmetic subgroup.\n \n See details and documentation in the patch.\n+\n+---\n+\n+Apply\n+1. [attachment: trac_11422-sl2z_subgroups.patch](https://github.com/sagemath/sage/files/ticket11422/trac_11422-sl2z_subgroups.patch.gz)\n+2. [attachment: trac_11422-reviewerfix.patch](https://github.com/sagemath/sage/files/ticket11422/trac_11422-reviewerfix.patch.gz)\n+3. [attachment: trac_11422_unpicklefix.patch](https://github.com/sagemath/sage/files/ticket11422/trac_11422_unpicklefix.patch.gz)\n+to the Sage library.\n+\n``````\n",
    "created_at": "2011-09-23T12:08:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11422#issuecomment-115589",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,7 +1,16 @@
-This ticket aims to extend capability of the class ArithmeticSubgroup_Permutation in sage.modular.arithgroup_perm. This is now possible to deal with any subgroup of `SL(2,Z)` and many new methods are available (in particular equality of subgroups, conjugacy problem, ...)
+This ticket aims to extend capability of the class `ArithmeticSubgroup_Permutation` in `sage.modular.arithgroup_perm`. This is now possible to deal with any subgroup of `SL(2,Z)` and many new methods are available (in particular equality of subgroups, conjugacy problem, ...)
 
-I reimplement the method todd_coxeter of sage.modular.arithgroup.arithgroup_generic to be faster and with more output.
+I reimplement the method `todd_coxeter` of `sage.modular.arithgroup.arithgroup_generic` to be faster and with more output.
 
 I also created a test file for arithmetic subgroup.
 
 See details and documentation in the patch.
+
+---
+
+Apply
+1. [attachment: trac_11422-sl2z_subgroups.patch](https://github.com/sagemath/sage/files/ticket11422/trac_11422-sl2z_subgroups.patch.gz)
+2. [attachment: trac_11422-reviewerfix.patch](https://github.com/sagemath/sage/files/ticket11422/trac_11422-reviewerfix.patch.gz)
+3. [attachment: trac_11422_unpicklefix.patch](https://github.com/sagemath/sage/files/ticket11422/trac_11422_unpicklefix.patch.gz)
+to the Sage library.
+
``````




---

archive/issue_comments_115590.json:
```json
{
    "body": "Merged: **sage-4.7.2.alpha3**",
    "created_at": "2011-09-27T17:43:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11422#issuecomment-115590",
    "user": "https://github.com/nexttime"
}
```

Merged: **sage-4.7.2.alpha3**



---

archive/issue_events_150528.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-09-27T17:43:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11422#event-150528"
}
```



---

archive/issue_events_150529.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-09-27T17:43:46Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/11422",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11422#event-150529"
}
```
