# Issue 11313: Animated GIF plots should repaint bgcolor after each frame

archive/issues_011141.json:
```json
{
    "body": "As title. ImageMagick should be called with `-dispose Background`, because when you create an animation, Sage first creates a bunch of frames, then uses ImageMagick to make an animated GIF out of them. If the frames are not all the same size, then ImageMagick determines the minimum size for the final GIF in which it is possible to accommodate all the frames. The default behavior is to simply draw frame `n` over frame `n-1` without erasing frame `n-1`. When frame `n`'s image is smaller than frame `n-1`'s image, however, you get garbage in frame `n` outside the borders of the original image used to create frame `n`.\n\nBefore:\n\n![](http://i.imgur.com/N8XRV.gif)\n\nAfter:\n\n![](http://i.imgur.com/DpjS2.gif)\n\nThe above image was produced by the following code:\n\n```python\nt = var('t')\n\ndef frame(theta):\n    r = 2\n    x = r*(t - sin(t))\n    y = r*(1 - cos(t))\n\n    plot = parametric_plot((x, y), (t,0,theta), rgbcolor=hue(0.6))\n    krug = circle((2*theta, r), r)\n    tocka = point((r*(theta - sin(theta)), r*(1 - cos(theta))), pointsize=30, color='red')\n    return plot+krug+tocka;\n\nanimacija = animate([frame(x) for x in srange(0.1, 5*pi, 0.1)])\n\nanimacija.show(delay=10, iterations=0)\n```\n\n(Thanks to user `v-v` on Freenode.)\n\n---\n\nApply [attachment:trac_11313-imagemagick-options.patch](https://github.com/sagemath/sage/files/ticket11313/trac_11313-imagemagick-options.patch) to `$SAGE_ROOT/devel/sage`.\n\n**Assignee:** @jasongrout, @williamstein\n\n**Keywords:** plot, animate, imagemagick\n\n**Author:** Keshav Kini\n\n**Reviewer:** John Palmieri\n\n**Merged:** sage-5.0.beta1\n\nIssue created by migration from https://trac.sagemath.org/ticket/11313\n\n",
    "closed_at": "2012-01-18T08:14:04Z",
    "created_at": "2011-05-08T11:51:05Z",
    "labels": [
        "component: graphics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.0",
    "title": "Animated GIF plots should repaint bgcolor after each frame",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/11313",
    "user": "https://github.com/kini"
}
```
As title. ImageMagick should be called with `-dispose Background`, because when you create an animation, Sage first creates a bunch of frames, then uses ImageMagick to make an animated GIF out of them. If the frames are not all the same size, then ImageMagick determines the minimum size for the final GIF in which it is possible to accommodate all the frames. The default behavior is to simply draw frame `n` over frame `n-1` without erasing frame `n-1`. When frame `n`'s image is smaller than frame `n-1`'s image, however, you get garbage in frame `n` outside the borders of the original image used to create frame `n`.

Before:

![](http://i.imgur.com/N8XRV.gif)

After:

![](http://i.imgur.com/DpjS2.gif)

The above image was produced by the following code:

```python
t = var('t')

def frame(theta):
    r = 2
    x = r*(t - sin(t))
    y = r*(1 - cos(t))

    plot = parametric_plot((x, y), (t,0,theta), rgbcolor=hue(0.6))
    krug = circle((2*theta, r), r)
    tocka = point((r*(theta - sin(theta)), r*(1 - cos(theta))), pointsize=30, color='red')
    return plot+krug+tocka;

animacija = animate([frame(x) for x in srange(0.1, 5*pi, 0.1)])

animacija.show(delay=10, iterations=0)
```

(Thanks to user `v-v` on Freenode.)

---

Apply [attachment:trac_11313-imagemagick-options.patch](https://github.com/sagemath/sage/files/ticket11313/trac_11313-imagemagick-options.patch) to `$SAGE_ROOT/devel/sage`.

**Assignee:** @jasongrout, @williamstein

**Keywords:** plot, animate, imagemagick

**Author:** Keshav Kini

**Reviewer:** John Palmieri

**Merged:** sage-5.0.beta1

Issue created by migration from https://trac.sagemath.org/ticket/11313





---

archive/issue_events_088713.json:
```json
{
    "actor": "https://github.com/kini",
    "created_at": "2011-05-08T11:59:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11313#event-88713"
}
```



---

archive/issue_comments_115698.json:
```json
{
    "body": "**Author:** Keshav Kini",
    "created_at": "2011-05-08T11:59:51Z",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-115698",
    "user": "https://github.com/kini"
}
```

**Author:** Keshav Kini



---

archive/issue_comments_115699.json:
```json
{
    "body": "<a id='comment:1'></a>\nAny ideas on how to doctest this? Doesn't really seem possible, on first glance anyway...",
    "created_at": "2011-05-08T11:59:51Z",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-115699",
    "user": "https://github.com/kini"
}
```

<a id='comment:1'></a>
Any ideas on how to doctest this? Doesn't really seem possible, on first glance anyway...



---

archive/issue_comments_115700.json:
```json
{
    "body": "**Description changed:**\n``````diff\n\n``````\n",
    "created_at": "2011-05-08T12:39:41Z",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-115700",
    "user": "https://github.com/kini"
}
```

**Description changed:**
``````diff

``````




---

archive/issue_comments_115701.json:
```json
{
    "body": "<a id='comment:3'></a>\nDoes this slow anything down?  `animate` is already on the slow side...",
    "created_at": "2011-06-23T03:40:15Z",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-115701",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:3'></a>
Does this slow anything down?  `animate` is already on the slow side...



---

archive/issue_comments_115702.json:
```json
{
    "body": "<a id='comment:4'></a>\nThis is a defect, not an enhancement, ticket, so I don't consider potential slowdown to be a problem with the patch. That aside, ImageMagick is written in C and is pretty fast. If `animate` is slow it's probably because Sage needs to create every frame separately before using ImageMagick to put them together. I doubt this patch introduces any slowdowns.\n\nTo elaborate on what makes this a defect: when you create an animation, Sage first creates a bunch of frames, then uses ImageMagick to make an animated GIF out of them. If the frames are not all the same size, then ImageMagick determines the minimum size for the final GIF in which it is possible to accommodate all the frames. The default behavior is to simply draw frame `n` over frame `n-1` without erasing frame `n-1`. When frame `n`'s image is smaller than frame `n-1`'s image, however, you get garbage in frame 'n' outside the borders of the original image used to create frame 'n'.",
    "created_at": "2011-06-23T05:01:01Z",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-115702",
    "user": "https://github.com/kini"
}
```

<a id='comment:4'></a>
This is a defect, not an enhancement, ticket, so I don't consider potential slowdown to be a problem with the patch. That aside, ImageMagick is written in C and is pretty fast. If `animate` is slow it's probably because Sage needs to create every frame separately before using ImageMagick to put them together. I doubt this patch introduces any slowdowns.

To elaborate on what makes this a defect: when you create an animation, Sage first creates a bunch of frames, then uses ImageMagick to make an animated GIF out of them. If the frames are not all the same size, then ImageMagick determines the minimum size for the final GIF in which it is possible to accommodate all the frames. The default behavior is to simply draw frame `n` over frame `n-1` without erasing frame `n-1`. When frame `n`'s image is smaller than frame `n-1`'s image, however, you get garbage in frame 'n' outside the borders of the original image used to create frame 'n'.



---

archive/issue_comments_115703.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-As title. ImageMagick should be called with `-dispose Background`.\n+As title. ImageMagick should be called with `-dispose Background`, because when you create an animation, Sage first creates a bunch of frames, then uses ImageMagick? to make an animated GIF out of them. If the frames are not all the same size, then ImageMagick? determines the minimum size for the final GIF in which it is possible to accommodate all the frames. The default behavior is to simply draw frame n over frame n-1 without erasing frame n-1. When frame n's image is smaller than frame n-1's image, however, you get garbage in frame 'n' outside the borders of the original image used to create frame 'n'.\n``````\n",
    "created_at": "2011-06-23T21:58:12Z",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-115703",
    "user": "https://github.com/kini"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1 @@
-As title. ImageMagick should be called with `-dispose Background`.
+As title. ImageMagick should be called with `-dispose Background`, because when you create an animation, Sage first creates a bunch of frames, then uses ImageMagick? to make an animated GIF out of them. If the frames are not all the same size, then ImageMagick? determines the minimum size for the final GIF in which it is possible to accommodate all the frames. The default behavior is to simply draw frame n over frame n-1 without erasing frame n-1. When frame n's image is smaller than frame n-1's image, however, you get garbage in frame 'n' outside the borders of the original image used to create frame 'n'.
``````




---

archive/issue_comments_115704.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-As title. ImageMagick should be called with `-dispose Background`, because when you create an animation, Sage first creates a bunch of frames, then uses ImageMagick? to make an animated GIF out of them. If the frames are not all the same size, then ImageMagick? determines the minimum size for the final GIF in which it is possible to accommodate all the frames. The default behavior is to simply draw frame n over frame n-1 without erasing frame n-1. When frame n's image is smaller than frame n-1's image, however, you get garbage in frame 'n' outside the borders of the original image used to create frame 'n'.\n+As title. ImageMagick should be called with `-dispose Background`, because when you create an animation, Sage first creates a bunch of frames, then uses ImageMagick to make an animated GIF out of them. If the frames are not all the same size, then ImageMagick determines the minimum size for the final GIF in which it is possible to accommodate all the frames. The default behavior is to simply draw frame n over frame n-1 without erasing frame n-1. When frame n's image is smaller than frame n-1's image, however, you get garbage in frame 'n' outside the borders of the original image used to create frame 'n'.\n``````\n",
    "created_at": "2011-06-23T21:58:42Z",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-115704",
    "user": "https://github.com/kini"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1 @@
-As title. ImageMagick should be called with `-dispose Background`, because when you create an animation, Sage first creates a bunch of frames, then uses ImageMagick? to make an animated GIF out of them. If the frames are not all the same size, then ImageMagick? determines the minimum size for the final GIF in which it is possible to accommodate all the frames. The default behavior is to simply draw frame n over frame n-1 without erasing frame n-1. When frame n's image is smaller than frame n-1's image, however, you get garbage in frame 'n' outside the borders of the original image used to create frame 'n'.
+As title. ImageMagick should be called with `-dispose Background`, because when you create an animation, Sage first creates a bunch of frames, then uses ImageMagick to make an animated GIF out of them. If the frames are not all the same size, then ImageMagick determines the minimum size for the final GIF in which it is possible to accommodate all the frames. The default behavior is to simply draw frame n over frame n-1 without erasing frame n-1. When frame n's image is smaller than frame n-1's image, however, you get garbage in frame 'n' outside the borders of the original image used to create frame 'n'.
``````




---

archive/issue_comments_115705.json:
```json
{
    "body": "<a id='comment:7'></a>\nSorry about the spam...",
    "created_at": "2011-06-23T21:59:41Z",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-115705",
    "user": "https://github.com/kini"
}
```

<a id='comment:7'></a>
Sorry about the spam...



---

archive/issue_comments_115706.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-As title. ImageMagick should be called with `-dispose Background`, because when you create an animation, Sage first creates a bunch of frames, then uses ImageMagick to make an animated GIF out of them. If the frames are not all the same size, then ImageMagick determines the minimum size for the final GIF in which it is possible to accommodate all the frames. The default behavior is to simply draw frame n over frame n-1 without erasing frame n-1. When frame n's image is smaller than frame n-1's image, however, you get garbage in frame 'n' outside the borders of the original image used to create frame 'n'.\n+As title. ImageMagick should be called with `-dispose Background`, because when you create an animation, Sage first creates a bunch of frames, then uses ImageMagick to make an animated GIF out of them. If the frames are not all the same size, then ImageMagick determines the minimum size for the final GIF in which it is possible to accommodate all the frames. The default behavior is to simply draw frame `n` over frame `n-1` without erasing frame `n-1`. When frame `n`'s image is smaller than frame `n-1`'s image, however, you get garbage in frame `n` outside the borders of the original image used to create frame `n`.\n``````\n",
    "created_at": "2011-06-23T21:59:41Z",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-115706",
    "user": "https://github.com/kini"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1 @@
-As title. ImageMagick should be called with `-dispose Background`, because when you create an animation, Sage first creates a bunch of frames, then uses ImageMagick to make an animated GIF out of them. If the frames are not all the same size, then ImageMagick determines the minimum size for the final GIF in which it is possible to accommodate all the frames. The default behavior is to simply draw frame n over frame n-1 without erasing frame n-1. When frame n's image is smaller than frame n-1's image, however, you get garbage in frame 'n' outside the borders of the original image used to create frame 'n'.
+As title. ImageMagick should be called with `-dispose Background`, because when you create an animation, Sage first creates a bunch of frames, then uses ImageMagick to make an animated GIF out of them. If the frames are not all the same size, then ImageMagick determines the minimum size for the final GIF in which it is possible to accommodate all the frames. The default behavior is to simply draw frame `n` over frame `n-1` without erasing frame `n-1`. When frame `n`'s image is smaller than frame `n-1`'s image, however, you get garbage in frame `n` outside the borders of the original image used to create frame `n`.
``````




---

archive/issue_comments_115707.json:
```json
{
    "body": "<a id='comment:8'></a>\nCan you provide code which illustrates the problem (before the patch) and its solution (after)?",
    "created_at": "2011-07-23T17:09:05Z",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-115707",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:8'></a>
Can you provide code which illustrates the problem (before the patch) and its solution (after)?



---

archive/issue_comments_115708.json:
```json
{
    "body": "<a id='comment:9'></a>\nHmm, I've lost track of the code which demonstrated this problem (the code was originally posted on a pastebin by a user on IRC in May). While I wait for a response to the message I sent that user, here's an image showing what animate() currently does with that code:\n\n![](http://i.imgur.com/ppmZ8.gif)",
    "created_at": "2011-07-24T23:59:33Z",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-115708",
    "user": "https://github.com/kini"
}
```

<a id='comment:9'></a>
Hmm, I've lost track of the code which demonstrated this problem (the code was originally posted on a pastebin by a user on IRC in May). While I wait for a response to the message I sent that user, here's an image showing what animate() currently does with that code:

![](http://i.imgur.com/ppmZ8.gif)



---

archive/issue_comments_115709.json:
```json
{
    "body": "<a id='comment:10'></a>\nHere we are:\n\n```python\nt = var('t')\n\ndef frame(theta):\n    r = 2\n    x = r*(t - sin(t))\n    y = r*(1 - cos(t))\n\n    plot = parametric_plot((x, y), (t,0,theta), rgbcolor=hue(0.6))\n    krug = circle((2*theta, r), r)\n    tocka = point((r*(theta - sin(theta)), r*(1 - cos(theta))), pointsize=30, color='red')\n    return plot+krug+tocka;\n\nanimacija = animate([frame(x) for x in srange(0.1, 5*pi, 0.1)])\n\nanimacija.show(delay=10, iterations=0)\n```\n\nCredit to user `v-v` on freenode. This produces the image shown above on Sage 4.7 (for example on sagenb.org). My local alpha2 (old, I know...) does something kind of alarming... I'll test with the latest dev version once I get it built.",
    "created_at": "2011-07-25T17:25:02Z",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-115709",
    "user": "https://github.com/kini"
}
```

<a id='comment:10'></a>
Here we are:

```python
t = var('t')

def frame(theta):
    r = 2
    x = r*(t - sin(t))
    y = r*(1 - cos(t))

    plot = parametric_plot((x, y), (t,0,theta), rgbcolor=hue(0.6))
    krug = circle((2*theta, r), r)
    tocka = point((r*(theta - sin(theta)), r*(1 - cos(theta))), pointsize=30, color='red')
    return plot+krug+tocka;

animacija = animate([frame(x) for x in srange(0.1, 5*pi, 0.1)])

animacija.show(delay=10, iterations=0)
```

Credit to user `v-v` on freenode. This produces the image shown above on Sage 4.7 (for example on sagenb.org). My local alpha2 (old, I know...) does something kind of alarming... I'll test with the latest dev version once I get it built.



---

archive/issue_comments_115710.json:
```json
{
    "body": "<a id='comment:11'></a>\nMinor point: the patch doesn't apply cleanly to Sage 4.7.1.rc0, but that's easy to fix.  More importantly, with Safari 5.1 on a Mac, the area which is no longer part of the picture displays as a black box.  On Firefox or Chrome, it's white (or maybe the default background color?), but it looks bad on Safari.  I don't know if this is a bug in how Safari displays animated gifs or if we can avoid it somehow.",
    "created_at": "2011-07-25T18:32:43Z",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-115710",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:11'></a>
Minor point: the patch doesn't apply cleanly to Sage 4.7.1.rc0, but that's easy to fix.  More importantly, with Safari 5.1 on a Mac, the area which is no longer part of the picture displays as a black box.  On Firefox or Chrome, it's white (or maybe the default background color?), but it looks bad on Safari.  I don't know if this is a bug in how Safari displays animated gifs or if we can avoid it somehow.



---

archive/issue_events_088714.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2011-07-25T18:32:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11313#event-88714"
}
```



---

archive/issue_events_088715.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2011-07-25T18:32:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11313#event-88715"
}
```



---

archive/issue_comments_115711.json:
```json
{
    "body": "<a id='comment:12'></a>\nThe \"something kind of alarming\" appears to be caused by #11170 - the GIF blows up in filesize by a factor of 50 and the aspect ratio is destroyed. I'll cross-post to that ticket...\n\nAs for Safari, no idea. I'll look into it.",
    "created_at": "2011-08-04T07:42:45Z",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-115711",
    "user": "https://github.com/kini"
}
```

<a id='comment:12'></a>
The "something kind of alarming" appears to be caused by #11170 - the GIF blows up in filesize by a factor of 50 and the aspect ratio is destroyed. I'll cross-post to that ticket...

As for Safari, no idea. I'll look into it.



---

archive/issue_comments_115712.json:
```json
{
    "body": "<a id='comment:13'></a>\nI'm going to rebase this on #11650 / 4.8.alpha1 .\n\nRegarding Safari's behavior, I found [this](https://bugs.webkit.org/show_bug.cgi?id=15990), which links to some internal Apple bug tracker which I cannot access. Can we assume this is Safari's problem?",
    "created_at": "2011-11-18T05:43:45Z",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-115712",
    "user": "https://github.com/kini"
}
```

<a id='comment:13'></a>
I'm going to rebase this on #11650 / 4.8.alpha1 .

Regarding Safari's behavior, I found [this](https://bugs.webkit.org/show_bug.cgi?id=15990), which links to some internal Apple bug tracker which I cannot access. Can we assume this is Safari's problem?



---

archive/issue_comments_115713.json:
```json
{
    "body": "<a id='comment:14'></a>\nNow that #11650 is in, here's a rebase on sage 4.8.alpha6.\n\nHow the above GIF looks after the patch:\n\n![](http://i.imgur.com/DpjS2.gif)\n\nOn [the imgur page](http://imgur.com/DpjS2) you can see how the GIF's transparency and non-white backgrounds interact. Compare with [the old behavior](http://imgur.com/ppmZ8).",
    "created_at": "2012-01-13T16:40:26Z",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-115713",
    "user": "https://github.com/kini"
}
```

<a id='comment:14'></a>
Now that #11650 is in, here's a rebase on sage 4.8.alpha6.

How the above GIF looks after the patch:

![](http://i.imgur.com/DpjS2.gif)

On [the imgur page](http://imgur.com/DpjS2) you can see how the GIF's transparency and non-white backgrounds interact. Compare with [the old behavior](http://imgur.com/ppmZ8).



---

archive/issue_events_088716.json:
```json
{
    "actor": "https://github.com/kini",
    "created_at": "2012-01-13T16:52:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11313#event-88716"
}
```



---

archive/issue_events_088717.json:
```json
{
    "actor": "https://github.com/kini",
    "created_at": "2012-01-13T16:52:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11313#event-88717"
}
```



---

archive/issue_comments_115714.json:
```json
{
    "body": "<a id='comment:15'></a>\nWhoops, the \"before\" image is a bit different now in sage 4.8.alpha6 than it was when I posted [comment:9]. See the description for the updated GIF.",
    "created_at": "2012-01-13T16:52:15Z",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-115714",
    "user": "https://github.com/kini"
}
```

<a id='comment:15'></a>
Whoops, the "before" image is a bit different now in sage 4.8.alpha6 than it was when I posted [comment:9]. See the description for the updated GIF.



---

archive/issue_comments_115715.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,35 @@\n As title. ImageMagick should be called with `-dispose Background`, because when you create an animation, Sage first creates a bunch of frames, then uses ImageMagick to make an animated GIF out of them. If the frames are not all the same size, then ImageMagick determines the minimum size for the final GIF in which it is possible to accommodate all the frames. The default behavior is to simply draw frame `n` over frame `n-1` without erasing frame `n-1`. When frame `n`'s image is smaller than frame `n-1`'s image, however, you get garbage in frame `n` outside the borders of the original image used to create frame `n`.\n+\n+Before:\n+\n+![](http://i.imgur.com/N8XRV.gif)\n+\n+After:\n+\n+![](http://i.imgur.com/DpjS2.gif)\n+\n+The above image was produced by the following code:\n+\n+```python\n+t = var('t')\n+\n+def frame(theta):\n+    r = 2\n+    x = r*(t - sin(t))\n+    y = r*(1 - cos(t))\n+\n+    plot = parametric_plot((x, y), (t,0,theta), rgbcolor=hue(0.6))\n+    krug = circle((2*theta, r), r)\n+    tocka = point((r*(theta - sin(theta)), r*(1 - cos(theta))), pointsize=30, color='red')\n+    return plot+krug+tocka;\n+\n+animacija = animate([frame(x) for x in srange(0.1, 5*pi, 0.1)])\n+\n+animacija.show(delay=10, iterations=0)\n+```\n+\n+(Thanks to user `v-v` on Freenode.)\n+\n+---\n+\n+Apply [attachment:trac_11313-imagemagick-options.patch](https://github.com/sagemath/sage/files/ticket11313/trac_11313-imagemagick-options.patch) to `$SAGE_ROOT/devel/sage`.\n``````\n",
    "created_at": "2012-01-13T16:52:15Z",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-115715",
    "user": "https://github.com/kini"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,35 @@
 As title. ImageMagick should be called with `-dispose Background`, because when you create an animation, Sage first creates a bunch of frames, then uses ImageMagick to make an animated GIF out of them. If the frames are not all the same size, then ImageMagick determines the minimum size for the final GIF in which it is possible to accommodate all the frames. The default behavior is to simply draw frame `n` over frame `n-1` without erasing frame `n-1`. When frame `n`'s image is smaller than frame `n-1`'s image, however, you get garbage in frame `n` outside the borders of the original image used to create frame `n`.
+
+Before:
+
+![](http://i.imgur.com/N8XRV.gif)
+
+After:
+
+![](http://i.imgur.com/DpjS2.gif)
+
+The above image was produced by the following code:
+
+```python
+t = var('t')
+
+def frame(theta):
+    r = 2
+    x = r*(t - sin(t))
+    y = r*(1 - cos(t))
+
+    plot = parametric_plot((x, y), (t,0,theta), rgbcolor=hue(0.6))
+    krug = circle((2*theta, r), r)
+    tocka = point((r*(theta - sin(theta)), r*(1 - cos(theta))), pointsize=30, color='red')
+    return plot+krug+tocka;
+
+animacija = animate([frame(x) for x in srange(0.1, 5*pi, 0.1)])
+
+animacija.show(delay=10, iterations=0)
+```
+
+(Thanks to user `v-v` on Freenode.)
+
+---
+
+Apply [attachment:trac_11313-imagemagick-options.patch](https://github.com/sagemath/sage/files/ticket11313/trac_11313-imagemagick-options.patch) to `$SAGE_ROOT/devel/sage`.
``````




---

archive/issue_comments_115716.json:
```json
{
    "body": "<a id='comment:16'></a>\nThis looks good to me.  By the way, where is this syntax for defining strings\n\n```python\ns = ('abc' 'def')\n```\ndocumented?",
    "created_at": "2012-01-13T22:17:42Z",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-115716",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:16'></a>
This looks good to me.  By the way, where is this syntax for defining strings

```python
s = ('abc' 'def')
```
documented?



---

archive/issue_events_088718.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-01-13T22:17:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11313#event-88718"
}
```



---

archive/issue_events_088719.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-01-13T22:17:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11313#event-88719"
}
```



---

archive/issue_events_088720.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-01-13T22:17:42Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "milestone": "sage-4.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11313#event-88720"
}
```



---

archive/issue_events_088721.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-01-13T22:17:42Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "milestone": "sage-5.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11313#event-88721"
}
```



---

archive/issue_comments_115717.json:
```json
{
    "body": "**Reviewer:** John Palmieri",
    "created_at": "2012-01-13T22:17:42Z",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-115717",
    "user": "https://github.com/jhpalmieri"
}
```

**Reviewer:** John Palmieri



---

archive/issue_comments_115718.json:
```json
{
    "body": "<a id='comment:17'></a>\n[Here](http://docs.python.org/reference/lexical_analysis.html#string-literal-concatenation) is the relevant section of the Python docs. Actually,\n\n```python\ns = 'abc' 'def'\n```\n\nworks too, but the parentheses in the patch force a line continuation.\n\nThanks for the review!",
    "created_at": "2012-01-13T22:35:26Z",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-115718",
    "user": "https://github.com/kini"
}
```

<a id='comment:17'></a>
[Here](http://docs.python.org/reference/lexical_analysis.html#string-literal-concatenation) is the relevant section of the Python docs. Actually,

```python
s = 'abc' 'def'
```

works too, but the parentheses in the patch force a line continuation.

Thanks for the review!



---

archive/issue_comments_115719.json:
```json
{
    "body": "apply to $SAGE_ROOT/devel/sage",
    "created_at": "2012-01-16T20:26:22Z",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-115719",
    "user": "https://github.com/jdemeyer"
}
```

apply to $SAGE_ROOT/devel/sage



---

archive/attachments_014826.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_11313-imagemagick-options.patch",
    "asset_url": "tarball://root/attachments/ticket11313/trac_11313-imagemagick-options.patch",
    "created_at": "2012-01-16T20:26:40Z",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket11313/trac_11313-imagemagick-options.patch",
    "user": "https://github.com/jdemeyer"
}
```



---

archive/issue_comments_115720.json:
```json
{
    "body": "<a id='comment:18'></a>\nAttachment [trac_11313-imagemagick-options.patch](https://github.com/sagemath/sage/files/ticket11313/trac_11313-imagemagick-options.patch) by @jdemeyer created at 2012-01-16 20:26:40\n\nChanged commit message.",
    "created_at": "2012-01-16T20:26:40Z",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-115720",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:18'></a>
Attachment [trac_11313-imagemagick-options.patch](https://github.com/sagemath/sage/files/ticket11313/trac_11313-imagemagick-options.patch) by @jdemeyer created at 2012-01-16 20:26:40

Changed commit message.



---

archive/issue_comments_115721.json:
```json
{
    "body": "<a id='comment:19'></a>\nWait, what? So now we're *not* putting the trac ticket number in the commit message? Hmm, I didn't realize that. Thanks for the heads up.",
    "created_at": "2012-01-17T05:03:33Z",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-115721",
    "user": "https://github.com/kini"
}
```

<a id='comment:19'></a>
Wait, what? So now we're *not* putting the trac ticket number in the commit message? Hmm, I didn't realize that. Thanks for the heads up.



---

archive/issue_comments_115722.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [kini](#comment%3A19):\n> Wait, what? So now we're *not* putting the trac ticket number in the commit message? Hmm, I didn't realize that. Thanks for the heads up.\n\n\nFunny how in the beginning when I was release manager, I had to convince everybody to put ticket numbers in the commit message and quite a few didn't do it (or worse: put the wrong ticket number).  Since sage-4.7, the ticket numbers are added automatically but it seems that now, more people than before are actually adding the ticket number.",
    "created_at": "2012-01-17T07:41:37Z",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-115722",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'></a>
Replying to [kini](#comment%3A19):
> Wait, what? So now we're *not* putting the trac ticket number in the commit message? Hmm, I didn't realize that. Thanks for the heads up.


Funny how in the beginning when I was release manager, I had to convince everybody to put ticket numbers in the commit message and quite a few didn't do it (or worse: put the wrong ticket number).  Since sage-4.7, the ticket numbers are added automatically but it seems that now, more people than before are actually adding the ticket number.



---

archive/issue_comments_115723.json:
```json
{
    "body": "<a id='comment:21'></a>\nOf course, the best way would be to have people make commits to the tree, and then close the ticket with a reference to the commit, rather than making the commit upon release, when the ticket has been closed already. But for that I guess we need to implement the github-based sage --push/pull workflow Robert Bradshaw suggested, or something similar.\n\nBy the way, why not just check whether the ticket number is already in the commit message and not add it again if so?",
    "created_at": "2012-01-17T10:47:50Z",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-115723",
    "user": "https://github.com/kini"
}
```

<a id='comment:21'></a>
Of course, the best way would be to have people make commits to the tree, and then close the ticket with a reference to the commit, rather than making the commit upon release, when the ticket has been closed already. But for that I guess we need to implement the github-based sage --push/pull workflow Robert Bradshaw suggested, or something similar.

By the way, why not just check whether the ticket number is already in the commit message and not add it again if so?



---

archive/issue_comments_115724.json:
```json
{
    "body": "<a id='comment:22'></a>\nReplying to [kini](#comment%3A21):\n> By the way, why not just check whether the ticket number is already in the commit message and not add it again if so?\n\n\nWhen this was discussed on sage-devel (please don't ask me to find the thread again), somebody suggested that having a uniform format\n\n```\nTrac #54321: change foo to bar\n```\ncould be useful for scripts.  I would find a version of \"hg blame\" with ticket numbers quite interesting.  If somebody would implement this, then the standard-format ticket numbers would certainly be useful.",
    "created_at": "2012-01-17T11:05:41Z",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-115724",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'></a>
Replying to [kini](#comment%3A21):
> By the way, why not just check whether the ticket number is already in the commit message and not add it again if so?


When this was discussed on sage-devel (please don't ask me to find the thread again), somebody suggested that having a uniform format

```
Trac #54321: change foo to bar
```
could be useful for scripts.  I would find a version of "hg blame" with ticket numbers quite interesting.  If somebody would implement this, then the standard-format ticket numbers would certainly be useful.



---

archive/issue_comments_115725.json:
```json
{
    "body": "**Merged:** sage-5.0.beta1",
    "created_at": "2012-01-18T08:14:04Z",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-115725",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.0.beta1



---

archive/issue_events_088722.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-01-18T08:14:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11313#event-88722"
}
```



---

archive/issue_events_088723.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-01-18T08:14:04Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11313#event-88723"
}
```
