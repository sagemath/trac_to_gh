# Issue 11313: Animated GIF plots should repaint bgcolor after each frame

archive/issues_011141.json:
```json
{
    "assignees": [
        "https://github.com/jasongrout",
        "https://github.com/williamstein"
    ],
    "body": "<div id=\"comment:0\"></div>\n\nAs title. ImageMagick should be called with `-dispose Background`, because when you create an animation, Sage first creates a bunch of frames, then uses ImageMagick to make an animated GIF out of them. If the frames are not all the same size, then ImageMagick determines the minimum size for the final GIF in which it is possible to accommodate all the frames. The default behavior is to simply draw frame `n` over frame `n-1` without erasing frame `n-1`. When frame `n`'s image is smaller than frame `n-1`'s image, however, you get garbage in frame `n` outside the borders of the original image used to create frame `n`.\n\nBefore:\n\n![](http://i.imgur.com/N8XRV.gif)\n\nAfter:\n\n![](http://i.imgur.com/DpjS2.gif)\n\nThe above image was produced by the following code:\n\n```python\nt = var('t')\n\ndef frame(theta):\n    r = 2\n    x = r*(t - sin(t))\n    y = r*(1 - cos(t))\n\n    plot = parametric_plot((x, y), (t,0,theta), rgbcolor=hue(0.6))\n    krug = circle((2*theta, r), r)\n    tocka = point((r*(theta - sin(theta)), r*(1 - cos(theta))), pointsize=30, color='red')\n    return plot+krug+tocka;\n\nanimacija = animate([frame(x) for x in srange(0.1, 5*pi, 0.1)])\n\nanimacija.show(delay=10, iterations=0)\n```\n\n(Thanks to user `v-v` on Freenode.)\n\n---\n\nApply [attachment: trac_11313-imagemagick-options.patch](https://github.com/sagemath/sage/files/ticket11313/trac_11313-imagemagick-options.patch.gz) to `$SAGE_ROOT/devel/sage`.\n\nComponent: **graphics**\n\nKeywords: **plot, animate, imagemagick**\n\nAuthor: **Keshav Kini**\n\nReviewer: **John Palmieri**\n\nMerged: **sage-5.0.beta1**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/11313_\n\n",
    "closed_at": "2012-01-18T08:14:04Z",
    "created_at": "2011-05-08T11:51:05Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20graphics",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Animated GIF plots should repaint bgcolor after each frame",
    "type": "issue",
    "updated_at": "2012-01-18T08:14:04Z",
    "url": "https://github.com/sagemath/sage/issues/11313",
    "user": "https://github.com/kini"
}
```
<div id="comment:0"></div>

As title. ImageMagick should be called with `-dispose Background`, because when you create an animation, Sage first creates a bunch of frames, then uses ImageMagick to make an animated GIF out of them. If the frames are not all the same size, then ImageMagick determines the minimum size for the final GIF in which it is possible to accommodate all the frames. The default behavior is to simply draw frame `n` over frame `n-1` without erasing frame `n-1`. When frame `n`'s image is smaller than frame `n-1`'s image, however, you get garbage in frame `n` outside the borders of the original image used to create frame `n`.

Before:

![](http://i.imgur.com/N8XRV.gif)

After:

![](http://i.imgur.com/DpjS2.gif)

The above image was produced by the following code:

```python
t = var('t')

def frame(theta):
    r = 2
    x = r*(t - sin(t))
    y = r*(1 - cos(t))

    plot = parametric_plot((x, y), (t,0,theta), rgbcolor=hue(0.6))
    krug = circle((2*theta, r), r)
    tocka = point((r*(theta - sin(theta)), r*(1 - cos(theta))), pointsize=30, color='red')
    return plot+krug+tocka;

animacija = animate([frame(x) for x in srange(0.1, 5*pi, 0.1)])

animacija.show(delay=10, iterations=0)
```

(Thanks to user `v-v` on Freenode.)

---

Apply [attachment: trac_11313-imagemagick-options.patch](https://github.com/sagemath/sage/files/ticket11313/trac_11313-imagemagick-options.patch.gz) to `$SAGE_ROOT/devel/sage`.

Component: **graphics**

Keywords: **plot, animate, imagemagick**

Author: **Keshav Kini**

Reviewer: **John Palmieri**

Merged: **sage-5.0.beta1**

_Issue created by migration from https://trac.sagemath.org/ticket/11313_





---

archive/issue_events_148632.json:
```json
{
    "actor": "https://github.com/kini",
    "created_at": "2011-05-08T11:51:05Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "milestone_number": null,
    "milestone_title": "sage-4.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11313#event-148632"
}
```



---

archive/issue_events_148633.json:
```json
{
    "actor": "https://github.com/kini",
    "created_at": "2011-05-08T11:51:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20graphics",
    "label_color": "0000ff",
    "label_name": "c: graphics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11313#event-148633"
}
```



---

archive/issue_events_148634.json:
```json
{
    "actor": "https://github.com/kini",
    "created_at": "2011-05-08T11:51:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11313#event-148634"
}
```



---

archive/issue_events_148635.json:
```json
{
    "actor": "https://github.com/kini",
    "created_at": "2011-05-08T11:51:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11313#event-148635"
}
```



---

archive/issue_events_148636.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2011-05-08T11:51:05Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "subject": "https://github.com/kini",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11313#event-148636"
}
```



---

archive/issue_events_148637.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2011-05-08T11:51:05Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "subject": "https://github.com/kini",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11313#event-148637"
}
```



---

archive/issue_events_148638.json:
```json
{
    "actor": "https://github.com/kini",
    "created_at": "2011-05-08T11:59:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11313#event-148638"
}
```



---

archive/issue_comments_113597.json:
```json
{
    "body": "Author: **Keshav Kini**",
    "created_at": "2011-05-08T11:59:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-113597",
    "user": "https://github.com/kini"
}
```

Author: **Keshav Kini**



---

archive/issue_comments_113598.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nAny ideas on how to doctest this? Doesn't really seem possible, on first glance anyway...",
    "created_at": "2011-05-08T11:59:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-113598",
    "user": "https://github.com/kini"
}
```

<div id="comment:1" align="right">comment:1</div>

Any ideas on how to doctest this? Doesn't really seem possible, on first glance anyway...



---

archive/issue_comments_113599.json:
```json
{
    "body": "Description changed:\n``````diff\n\n``````\n",
    "created_at": "2011-05-08T12:39:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-113599",
    "user": "https://github.com/kini"
}
```

Description changed:
``````diff

``````




---

archive/issue_comments_113600.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nDoes this slow anything down?  `animate` is already on the slow side...",
    "created_at": "2011-06-23T03:40:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-113600",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:3" align="right">comment:3</div>

Does this slow anything down?  `animate` is already on the slow side...



---

archive/issue_comments_113601.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nThis is a defect, not an enhancement, ticket, so I don't consider potential slowdown to be a problem with the patch. That aside, ImageMagick is written in C and is pretty fast. If `animate` is slow it's probably because Sage needs to create every frame separately before using ImageMagick to put them together. I doubt this patch introduces any slowdowns.\n\nTo elaborate on what makes this a defect: when you create an animation, Sage first creates a bunch of frames, then uses ImageMagick to make an animated GIF out of them. If the frames are not all the same size, then ImageMagick determines the minimum size for the final GIF in which it is possible to accommodate all the frames. The default behavior is to simply draw frame `n` over frame `n-1` without erasing frame `n-1`. When frame `n`'s image is smaller than frame `n-1`'s image, however, you get garbage in frame 'n' outside the borders of the original image used to create frame 'n'.",
    "created_at": "2011-06-23T05:01:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-113601",
    "user": "https://github.com/kini"
}
```

<div id="comment:4" align="right">comment:4</div>

This is a defect, not an enhancement, ticket, so I don't consider potential slowdown to be a problem with the patch. That aside, ImageMagick is written in C and is pretty fast. If `animate` is slow it's probably because Sage needs to create every frame separately before using ImageMagick to put them together. I doubt this patch introduces any slowdowns.

To elaborate on what makes this a defect: when you create an animation, Sage first creates a bunch of frames, then uses ImageMagick to make an animated GIF out of them. If the frames are not all the same size, then ImageMagick determines the minimum size for the final GIF in which it is possible to accommodate all the frames. The default behavior is to simply draw frame `n` over frame `n-1` without erasing frame `n-1`. When frame `n`'s image is smaller than frame `n-1`'s image, however, you get garbage in frame 'n' outside the borders of the original image used to create frame 'n'.



---

archive/issue_comments_113602.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-As title. ImageMagick should be called with `-dispose Background`.\n+As title. ImageMagick should be called with `-dispose Background`, because when you create an animation, Sage first creates a bunch of frames, then uses ImageMagick? to make an animated GIF out of them. If the frames are not all the same size, then ImageMagick? determines the minimum size for the final GIF in which it is possible to accommodate all the frames. The default behavior is to simply draw frame n over frame n-1 without erasing frame n-1. When frame n's image is smaller than frame n-1's image, however, you get garbage in frame 'n' outside the borders of the original image used to create frame 'n'.\n``````\n",
    "created_at": "2011-06-23T21:58:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-113602",
    "user": "https://github.com/kini"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-As title. ImageMagick should be called with `-dispose Background`.
+As title. ImageMagick should be called with `-dispose Background`, because when you create an animation, Sage first creates a bunch of frames, then uses ImageMagick? to make an animated GIF out of them. If the frames are not all the same size, then ImageMagick? determines the minimum size for the final GIF in which it is possible to accommodate all the frames. The default behavior is to simply draw frame n over frame n-1 without erasing frame n-1. When frame n's image is smaller than frame n-1's image, however, you get garbage in frame 'n' outside the borders of the original image used to create frame 'n'.
``````




---

archive/issue_comments_113603.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-As title. ImageMagick should be called with `-dispose Background`, because when you create an animation, Sage first creates a bunch of frames, then uses ImageMagick? to make an animated GIF out of them. If the frames are not all the same size, then ImageMagick? determines the minimum size for the final GIF in which it is possible to accommodate all the frames. The default behavior is to simply draw frame n over frame n-1 without erasing frame n-1. When frame n's image is smaller than frame n-1's image, however, you get garbage in frame 'n' outside the borders of the original image used to create frame 'n'.\n+As title. ImageMagick should be called with `-dispose Background`, because when you create an animation, Sage first creates a bunch of frames, then uses ImageMagick to make an animated GIF out of them. If the frames are not all the same size, then ImageMagick determines the minimum size for the final GIF in which it is possible to accommodate all the frames. The default behavior is to simply draw frame n over frame n-1 without erasing frame n-1. When frame n's image is smaller than frame n-1's image, however, you get garbage in frame 'n' outside the borders of the original image used to create frame 'n'.\n``````\n",
    "created_at": "2011-06-23T21:58:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-113603",
    "user": "https://github.com/kini"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-As title. ImageMagick should be called with `-dispose Background`, because when you create an animation, Sage first creates a bunch of frames, then uses ImageMagick? to make an animated GIF out of them. If the frames are not all the same size, then ImageMagick? determines the minimum size for the final GIF in which it is possible to accommodate all the frames. The default behavior is to simply draw frame n over frame n-1 without erasing frame n-1. When frame n's image is smaller than frame n-1's image, however, you get garbage in frame 'n' outside the borders of the original image used to create frame 'n'.
+As title. ImageMagick should be called with `-dispose Background`, because when you create an animation, Sage first creates a bunch of frames, then uses ImageMagick to make an animated GIF out of them. If the frames are not all the same size, then ImageMagick determines the minimum size for the final GIF in which it is possible to accommodate all the frames. The default behavior is to simply draw frame n over frame n-1 without erasing frame n-1. When frame n's image is smaller than frame n-1's image, however, you get garbage in frame 'n' outside the borders of the original image used to create frame 'n'.
``````




---

archive/issue_comments_113604.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nSorry about the spam...",
    "created_at": "2011-06-23T21:59:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-113604",
    "user": "https://github.com/kini"
}
```

<div id="comment:7" align="right">comment:7</div>

Sorry about the spam...



---

archive/issue_comments_113605.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-As title. ImageMagick should be called with `-dispose Background`, because when you create an animation, Sage first creates a bunch of frames, then uses ImageMagick to make an animated GIF out of them. If the frames are not all the same size, then ImageMagick determines the minimum size for the final GIF in which it is possible to accommodate all the frames. The default behavior is to simply draw frame n over frame n-1 without erasing frame n-1. When frame n's image is smaller than frame n-1's image, however, you get garbage in frame 'n' outside the borders of the original image used to create frame 'n'.\n+As title. ImageMagick should be called with `-dispose Background`, because when you create an animation, Sage first creates a bunch of frames, then uses ImageMagick to make an animated GIF out of them. If the frames are not all the same size, then ImageMagick determines the minimum size for the final GIF in which it is possible to accommodate all the frames. The default behavior is to simply draw frame `n` over frame `n-1` without erasing frame `n-1`. When frame `n`'s image is smaller than frame `n-1`'s image, however, you get garbage in frame `n` outside the borders of the original image used to create frame `n`.\n``````\n",
    "created_at": "2011-06-23T21:59:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-113605",
    "user": "https://github.com/kini"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-As title. ImageMagick should be called with `-dispose Background`, because when you create an animation, Sage first creates a bunch of frames, then uses ImageMagick to make an animated GIF out of them. If the frames are not all the same size, then ImageMagick determines the minimum size for the final GIF in which it is possible to accommodate all the frames. The default behavior is to simply draw frame n over frame n-1 without erasing frame n-1. When frame n's image is smaller than frame n-1's image, however, you get garbage in frame 'n' outside the borders of the original image used to create frame 'n'.
+As title. ImageMagick should be called with `-dispose Background`, because when you create an animation, Sage first creates a bunch of frames, then uses ImageMagick to make an animated GIF out of them. If the frames are not all the same size, then ImageMagick determines the minimum size for the final GIF in which it is possible to accommodate all the frames. The default behavior is to simply draw frame `n` over frame `n-1` without erasing frame `n-1`. When frame `n`'s image is smaller than frame `n-1`'s image, however, you get garbage in frame `n` outside the borders of the original image used to create frame `n`.
``````




---

archive/issue_comments_113606.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nCan you provide code which illustrates the problem (before the patch) and its solution (after)?",
    "created_at": "2011-07-23T17:09:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-113606",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:8" align="right">comment:8</div>

Can you provide code which illustrates the problem (before the patch) and its solution (after)?



---

archive/issue_comments_113607.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nHmm, I've lost track of the code which demonstrated this problem (the code was originally posted on a pastebin by a user on IRC in May). While I wait for a response to the message I sent that user, here's an image showing what animate() currently does with that code:\n\n![](http://i.imgur.com/ppmZ8.gif)",
    "created_at": "2011-07-24T23:59:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-113607",
    "user": "https://github.com/kini"
}
```

<div id="comment:9" align="right">comment:9</div>

Hmm, I've lost track of the code which demonstrated this problem (the code was originally posted on a pastebin by a user on IRC in May). While I wait for a response to the message I sent that user, here's an image showing what animate() currently does with that code:

![](http://i.imgur.com/ppmZ8.gif)



---

archive/issue_comments_113608.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nHere we are:\n\n```python\nt = var('t')\n\ndef frame(theta):\n    r = 2\n    x = r*(t - sin(t))\n    y = r*(1 - cos(t))\n\n    plot = parametric_plot((x, y), (t,0,theta), rgbcolor=hue(0.6))\n    krug = circle((2*theta, r), r)\n    tocka = point((r*(theta - sin(theta)), r*(1 - cos(theta))), pointsize=30, color='red')\n    return plot+krug+tocka;\n\nanimacija = animate([frame(x) for x in srange(0.1, 5*pi, 0.1)])\n\nanimacija.show(delay=10, iterations=0)\n```\n\nCredit to user `v-v` on freenode. This produces the image shown above on Sage 4.7 (for example on sagenb.org). My local alpha2 (old, I know...) does something kind of alarming... I'll test with the latest dev version once I get it built.",
    "created_at": "2011-07-25T17:25:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-113608",
    "user": "https://github.com/kini"
}
```

<div id="comment:10" align="right">comment:10</div>

Here we are:

```python
t = var('t')

def frame(theta):
    r = 2
    x = r*(t - sin(t))
    y = r*(1 - cos(t))

    plot = parametric_plot((x, y), (t,0,theta), rgbcolor=hue(0.6))
    krug = circle((2*theta, r), r)
    tocka = point((r*(theta - sin(theta)), r*(1 - cos(theta))), pointsize=30, color='red')
    return plot+krug+tocka;

animacija = animate([frame(x) for x in srange(0.1, 5*pi, 0.1)])

animacija.show(delay=10, iterations=0)
```

Credit to user `v-v` on freenode. This produces the image shown above on Sage 4.7 (for example on sagenb.org). My local alpha2 (old, I know...) does something kind of alarming... I'll test with the latest dev version once I get it built.



---

archive/issue_comments_113609.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nMinor point: the patch doesn't apply cleanly to Sage 4.7.1.rc0, but that's easy to fix.  More importantly, with Safari 5.1 on a Mac, the area which is no longer part of the picture displays as a black box.  On Firefox or Chrome, it's white (or maybe the default background color?), but it looks bad on Safari.  I don't know if this is a bug in how Safari displays animated gifs or if we can avoid it somehow.",
    "created_at": "2011-07-25T18:32:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-113609",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:11" align="right">comment:11</div>

Minor point: the patch doesn't apply cleanly to Sage 4.7.1.rc0, but that's easy to fix.  More importantly, with Safari 5.1 on a Mac, the area which is no longer part of the picture displays as a black box.  On Firefox or Chrome, it's white (or maybe the default background color?), but it looks bad on Safari.  I don't know if this is a bug in how Safari displays animated gifs or if we can avoid it somehow.



---

archive/issue_events_148639.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2011-07-25T18:32:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11313#event-148639"
}
```



---

archive/issue_events_148640.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2011-07-25T18:32:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11313#event-148640"
}
```



---

archive/issue_comments_113610.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nThe \"something kind of alarming\" appears to be caused by #11170 - the GIF blows up in filesize by a factor of 50 and the aspect ratio is destroyed. I'll cross-post to that ticket...\n\nAs for Safari, no idea. I'll look into it.",
    "created_at": "2011-08-04T07:42:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-113610",
    "user": "https://github.com/kini"
}
```

<div id="comment:12" align="right">comment:12</div>

The "something kind of alarming" appears to be caused by #11170 - the GIF blows up in filesize by a factor of 50 and the aspect ratio is destroyed. I'll cross-post to that ticket...

As for Safari, no idea. I'll look into it.



---

archive/issue_comments_113611.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nI'm going to rebase this on #11650 / 4.8.alpha1 .\n\nRegarding Safari's behavior, I found [this](https://bugs.webkit.org/show_bug.cgi?id=15990), which links to some internal Apple bug tracker which I cannot access. Can we assume this is Safari's problem?",
    "created_at": "2011-11-18T05:43:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-113611",
    "user": "https://github.com/kini"
}
```

<div id="comment:13" align="right">comment:13</div>

I'm going to rebase this on #11650 / 4.8.alpha1 .

Regarding Safari's behavior, I found [this](https://bugs.webkit.org/show_bug.cgi?id=15990), which links to some internal Apple bug tracker which I cannot access. Can we assume this is Safari's problem?



---

archive/issue_comments_113612.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nNow that #11650 is in, here's a rebase on sage 4.8.alpha6.\n\nHow the above GIF looks after the patch:\n\n![](http://i.imgur.com/DpjS2.gif)\n\nOn [the imgur page](http://imgur.com/DpjS2) you can see how the GIF's transparency and non-white backgrounds interact. Compare with [the old behavior](http://imgur.com/ppmZ8).",
    "created_at": "2012-01-13T16:40:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-113612",
    "user": "https://github.com/kini"
}
```

<div id="comment:14" align="right">comment:14</div>

Now that #11650 is in, here's a rebase on sage 4.8.alpha6.

How the above GIF looks after the patch:

![](http://i.imgur.com/DpjS2.gif)

On [the imgur page](http://imgur.com/DpjS2) you can see how the GIF's transparency and non-white backgrounds interact. Compare with [the old behavior](http://imgur.com/ppmZ8).



---

archive/issue_events_148641.json:
```json
{
    "actor": "https://github.com/kini",
    "created_at": "2012-01-13T16:52:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11313#event-148641"
}
```



---

archive/issue_events_148642.json:
```json
{
    "actor": "https://github.com/kini",
    "created_at": "2012-01-13T16:52:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11313#event-148642"
}
```



---

archive/issue_comments_113613.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nWhoops, the \"before\" image is a bit different now in sage 4.8.alpha6 than it was when I posted [comment:9]. See the description for the updated GIF.",
    "created_at": "2012-01-13T16:52:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-113613",
    "user": "https://github.com/kini"
}
```

<div id="comment:15" align="right">comment:15</div>

Whoops, the "before" image is a bit different now in sage 4.8.alpha6 than it was when I posted [comment:9]. See the description for the updated GIF.



---

archive/issue_comments_113614.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,35 @@\n As title. ImageMagick should be called with `-dispose Background`, because when you create an animation, Sage first creates a bunch of frames, then uses ImageMagick to make an animated GIF out of them. If the frames are not all the same size, then ImageMagick determines the minimum size for the final GIF in which it is possible to accommodate all the frames. The default behavior is to simply draw frame `n` over frame `n-1` without erasing frame `n-1`. When frame `n`'s image is smaller than frame `n-1`'s image, however, you get garbage in frame `n` outside the borders of the original image used to create frame `n`.\n+\n+Before:\n+\n+![](http://i.imgur.com/N8XRV.gif)\n+\n+After:\n+\n+![](http://i.imgur.com/DpjS2.gif)\n+\n+The above image was produced by the following code:\n+\n+```python\n+t = var('t')\n+\n+def frame(theta):\n+    r = 2\n+    x = r*(t - sin(t))\n+    y = r*(1 - cos(t))\n+\n+    plot = parametric_plot((x, y), (t,0,theta), rgbcolor=hue(0.6))\n+    krug = circle((2*theta, r), r)\n+    tocka = point((r*(theta - sin(theta)), r*(1 - cos(theta))), pointsize=30, color='red')\n+    return plot+krug+tocka;\n+\n+animacija = animate([frame(x) for x in srange(0.1, 5*pi, 0.1)])\n+\n+animacija.show(delay=10, iterations=0)\n+```\n+\n+(Thanks to user `v-v` on Freenode.)\n+\n+---\n+\n+Apply [attachment: trac_11313-imagemagick-options.patch](https://github.com/sagemath/sage/files/ticket11313/trac_11313-imagemagick-options.patch.gz) to `$SAGE_ROOT/devel/sage`.\n``````\n",
    "created_at": "2012-01-13T16:52:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-113614",
    "user": "https://github.com/kini"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,35 @@
 As title. ImageMagick should be called with `-dispose Background`, because when you create an animation, Sage first creates a bunch of frames, then uses ImageMagick to make an animated GIF out of them. If the frames are not all the same size, then ImageMagick determines the minimum size for the final GIF in which it is possible to accommodate all the frames. The default behavior is to simply draw frame `n` over frame `n-1` without erasing frame `n-1`. When frame `n`'s image is smaller than frame `n-1`'s image, however, you get garbage in frame `n` outside the borders of the original image used to create frame `n`.
+
+Before:
+
+![](http://i.imgur.com/N8XRV.gif)
+
+After:
+
+![](http://i.imgur.com/DpjS2.gif)
+
+The above image was produced by the following code:
+
+```python
+t = var('t')
+
+def frame(theta):
+    r = 2
+    x = r*(t - sin(t))
+    y = r*(1 - cos(t))
+
+    plot = parametric_plot((x, y), (t,0,theta), rgbcolor=hue(0.6))
+    krug = circle((2*theta, r), r)
+    tocka = point((r*(theta - sin(theta)), r*(1 - cos(theta))), pointsize=30, color='red')
+    return plot+krug+tocka;
+
+animacija = animate([frame(x) for x in srange(0.1, 5*pi, 0.1)])
+
+animacija.show(delay=10, iterations=0)
+```
+
+(Thanks to user `v-v` on Freenode.)
+
+---
+
+Apply [attachment: trac_11313-imagemagick-options.patch](https://github.com/sagemath/sage/files/ticket11313/trac_11313-imagemagick-options.patch.gz) to `$SAGE_ROOT/devel/sage`.
``````




---

archive/issue_comments_113615.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nThis looks good to me.  By the way, where is this syntax for defining strings\n\n```python\ns = ('abc' 'def')\n```\ndocumented?",
    "created_at": "2012-01-13T22:17:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-113615",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:16" align="right">comment:16</div>

This looks good to me.  By the way, where is this syntax for defining strings

```python
s = ('abc' 'def')
```
documented?



---

archive/issue_events_148643.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-01-13T22:17:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11313#event-148643"
}
```



---

archive/issue_events_148644.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-01-13T22:17:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11313#event-148644"
}
```



---

archive/issue_events_148645.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-01-13T22:17:42Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "milestone_number": null,
    "milestone_title": "sage-4.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11313#event-148645"
}
```



---

archive/issue_events_148646.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-01-13T22:17:42Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "milestone_number": null,
    "milestone_title": "sage-5.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11313#event-148646"
}
```



---

archive/issue_comments_113616.json:
```json
{
    "body": "Reviewer: **John Palmieri**",
    "created_at": "2012-01-13T22:17:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-113616",
    "user": "https://github.com/jhpalmieri"
}
```

Reviewer: **John Palmieri**



---

archive/issue_comments_113617.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\n[Here](http://docs.python.org/reference/lexical_analysis.html#string-literal-concatenation) is the relevant section of the Python docs. Actually,\n\n```python\ns = 'abc' 'def'\n```\n\nworks too, but the parentheses in the patch force a line continuation.\n\nThanks for the review!",
    "created_at": "2012-01-13T22:35:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-113617",
    "user": "https://github.com/kini"
}
```

<div id="comment:17" align="right">comment:17</div>

[Here](http://docs.python.org/reference/lexical_analysis.html#string-literal-concatenation) is the relevant section of the Python docs. Actually,

```python
s = 'abc' 'def'
```

works too, but the parentheses in the patch force a line continuation.

Thanks for the review!



---

archive/issue_comments_113618.json:
```json
{
    "body": "apply to $SAGE_ROOT/devel/sage",
    "created_at": "2012-01-16T20:26:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-113618",
    "user": "https://github.com/jdemeyer"
}
```

apply to $SAGE_ROOT/devel/sage



---

archive/issue_comments_113619.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nAttachment: **[trac_11313-imagemagick-options.patch.gz](https://github.com/sagemath/sage/files/ticket11313/trac_11313-imagemagick-options.patch.gz)**\n\nChanged commit message.",
    "created_at": "2012-01-16T20:26:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-113619",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:18" align="right">comment:18</div>

Attachment: **[trac_11313-imagemagick-options.patch.gz](https://github.com/sagemath/sage/files/ticket11313/trac_11313-imagemagick-options.patch.gz)**

Changed commit message.



---

archive/issue_comments_113620.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nWait, what? So now we're *not* putting the trac ticket number in the commit message? Hmm, I didn't realize that. Thanks for the heads up.",
    "created_at": "2012-01-17T05:03:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-113620",
    "user": "https://github.com/kini"
}
```

<div id="comment:19" align="right">comment:19</div>

Wait, what? So now we're *not* putting the trac ticket number in the commit message? Hmm, I didn't realize that. Thanks for the heads up.



---

archive/issue_comments_113621.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@kini](#comment%3A19):\n> Wait, what? So now we're *not* putting the trac ticket number in the commit message? Hmm, I didn't realize that. Thanks for the heads up.\n\nFunny how in the beginning when I was release manager, I had to convince everybody to put ticket numbers in the commit message and quite a few didn't do it (or worse: put the wrong ticket number).  Since sage-4.7, the ticket numbers are added automatically but it seems that now, more people than before are actually adding the ticket number.",
    "created_at": "2012-01-17T07:41:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-113621",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@kini](#comment%3A19):
> Wait, what? So now we're *not* putting the trac ticket number in the commit message? Hmm, I didn't realize that. Thanks for the heads up.

Funny how in the beginning when I was release manager, I had to convince everybody to put ticket numbers in the commit message and quite a few didn't do it (or worse: put the wrong ticket number).  Since sage-4.7, the ticket numbers are added automatically but it seems that now, more people than before are actually adding the ticket number.



---

archive/issue_comments_113622.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nOf course, the best way would be to have people make commits to the tree, and then close the ticket with a reference to the commit, rather than making the commit upon release, when the ticket has been closed already. But for that I guess we need to implement the github-based sage --push/pull workflow Robert Bradshaw suggested, or something similar.\n\nBy the way, why not just check whether the ticket number is already in the commit message and not add it again if so?",
    "created_at": "2012-01-17T10:47:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-113622",
    "user": "https://github.com/kini"
}
```

<div id="comment:21" align="right">comment:21</div>

Of course, the best way would be to have people make commits to the tree, and then close the ticket with a reference to the commit, rather than making the commit upon release, when the ticket has been closed already. But for that I guess we need to implement the github-based sage --push/pull workflow Robert Bradshaw suggested, or something similar.

By the way, why not just check whether the ticket number is already in the commit message and not add it again if so?



---

archive/issue_comments_113623.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@kini](#comment%3A21):\n> By the way, why not just check whether the ticket number is already in the commit message and not add it again if so?\n\nWhen this was discussed on sage-devel (please don't ask me to find the thread again), somebody suggested that having a uniform format\n\n```\nTrac #54321: change foo to bar\n```\ncould be useful for scripts.  I would find a version of \"hg blame\" with ticket numbers quite interesting.  If somebody would implement this, then the standard-format ticket numbers would certainly be useful.",
    "created_at": "2012-01-17T11:05:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-113623",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@kini](#comment%3A21):
> By the way, why not just check whether the ticket number is already in the commit message and not add it again if so?

When this was discussed on sage-devel (please don't ask me to find the thread again), somebody suggested that having a uniform format

```
Trac #54321: change foo to bar
```
could be useful for scripts.  I would find a version of "hg blame" with ticket numbers quite interesting.  If somebody would implement this, then the standard-format ticket numbers would certainly be useful.



---

archive/issue_comments_113624.json:
```json
{
    "body": "Merged: **sage-5.0.beta1**",
    "created_at": "2012-01-18T08:14:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11313#issuecomment-113624",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.0.beta1**



---

archive/issue_events_148647.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-01-18T08:14:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11313#event-148647"
}
```



---

archive/issue_events_148648.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-01-18T08:14:04Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/11313",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11313#event-148648"
}
```
