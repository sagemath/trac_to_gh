# Issue 11785: exp(I*pi*n).simplify_exp() doesn't simplify

archive/issues_011613.json:
```json
{
    "assignees": [],
    "body": "At https://groups.google.com/d/topic/sage-support/Pkn1o1kAcyE/discussion I noted that currently (4.7.1 and 4.7.2.alpha2), we have this:\n\n```\nsage: n = var('n')\nsage: assume(n, 'integer')\nsage: exp(I*n*pi).simplify_exp()\ne^(I*pi*n)\n```\nI was really hoping for `cos(pi*n)`, or `(-1)^n`. \n\nIf you are serious about asking Maxima, it will simplify it, though:\n\n```\nsage: A = exp(I*pi*n)\nsage: A.maxima_methods().rectform()\n(-1)^n\n```\n\nWe should somehow wrap rectform or make it easier to access. At a minimum, we should add something to the documentation to mention this possibility.\n\nDepends on #13061\n\nAssignee: **@burcin**\n\nCC:  @kcrisman @orlitzky\n\nKeywords: **maxima symbolics exponentials sd40.5**\n\nBranch/Commit: **[2fb52ed](https://github.com/sagemath/sagetrac-mirror/commit/2fb52ed22e39c63908bb612bb91ca9fd4126f477)**\n\nReviewer: **Ralf Stephan**\n\nAuthor: **Michael Orlitzky**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/11785_\n\n",
    "closed_at": "2014-02-20T23:17:01Z",
    "created_at": "2011-09-09T00:10:17Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20symbolics",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "exp(I*pi*n).simplify_exp() doesn't simplify",
    "type": "issue",
    "updated_at": "2014-02-20T23:17:01Z",
    "url": "https://github.com/sagemath/sage/issues/11785",
    "user": "https://github.com/dandrake"
}
```
At https://groups.google.com/d/topic/sage-support/Pkn1o1kAcyE/discussion I noted that currently (4.7.1 and 4.7.2.alpha2), we have this:

```
sage: n = var('n')
sage: assume(n, 'integer')
sage: exp(I*n*pi).simplify_exp()
e^(I*pi*n)
```
I was really hoping for `cos(pi*n)`, or `(-1)^n`. 

If you are serious about asking Maxima, it will simplify it, though:

```
sage: A = exp(I*pi*n)
sage: A.maxima_methods().rectform()
(-1)^n
```

We should somehow wrap rectform or make it easier to access. At a minimum, we should add something to the documentation to mention this possibility.

Depends on #13061

Assignee: **@burcin**

CC:  @kcrisman @orlitzky

Keywords: **maxima symbolics exponentials sd40.5**

Branch/Commit: **[2fb52ed](https://github.com/sagemath/sagetrac-mirror/commit/2fb52ed22e39c63908bb612bb91ca9fd4126f477)**

Reviewer: **Ralf Stephan**

Author: **Michael Orlitzky**

_Issue created by migration from https://trac.sagemath.org/ticket/11785_





---

archive/issue_events_144763.json:
```json
{
    "actor": "https://github.com/dandrake",
    "created_at": "2011-09-09T00:10:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11785",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11785#event-144763"
}
```



---

archive/issue_events_144764.json:
```json
{
    "actor": "https://github.com/dandrake",
    "created_at": "2011-09-09T00:10:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11785",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20symbolics",
    "label_color": "0000ff",
    "label_name": "component: symbolics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11785#event-144764"
}
```



---

archive/issue_events_144765.json:
```json
{
    "actor": "https://github.com/dandrake",
    "created_at": "2011-09-09T00:10:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11785",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11785#event-144765"
}
```



---

archive/issue_events_144766.json:
```json
{
    "actor": "https://github.com/dandrake",
    "created_at": "2011-09-09T00:10:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11785",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11785#event-144766"
}
```



---

archive/issue_comments_125247.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nThis is sort of a work-in-progress, but I'd appreciate comments on the approach.",
    "created_at": "2012-03-27T18:48:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11785",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11785#issuecomment-125247",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:2" align="right">Comment 2</div>

This is sort of a work-in-progress, but I'd appreciate comments on the approach.



---

archive/issue_events_144767.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2012-03-27T18:48:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11785",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11785#event-144767"
}
```



---

archive/issue_comments_125248.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nHmm.  Maybe for a first try we should just provide `simplify_rectform` or something more felicitously named regardless for now, and then discuss elsewhere whether it's useful to add this parameter.  I'm not sure that string length is a good measure of complexity, though I'm not sure I have a better idea (other than total number of vertices of the expression tree, I suppose).  In Maxima I don't think they do this, they just assume the user is smart enough to tell if it's simpler.  As long as this isn't in the default simplification (not to reopen the `simplify_full` issue!), we might not want to open up a whole new file of complexity of a symbolic expression without input from experts in such things.\n\nWhat do you think?  I do like having this available, Dan isn't the first to ask.  There are also some custom methods on some other ticket for pretty comprehensive dealing with the trig-complex issue, I can't remember where it is and don't have time to find it, though.  You might want to do some snooping on sage-devel archives or on Trac for these.",
    "created_at": "2012-03-27T20:12:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11785",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11785#issuecomment-125248",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:3" align="right">Comment 3</div>

Hmm.  Maybe for a first try we should just provide `simplify_rectform` or something more felicitously named regardless for now, and then discuss elsewhere whether it's useful to add this parameter.  I'm not sure that string length is a good measure of complexity, though I'm not sure I have a better idea (other than total number of vertices of the expression tree, I suppose).  In Maxima I don't think they do this, they just assume the user is smart enough to tell if it's simpler.  As long as this isn't in the default simplification (not to reopen the `simplify_full` issue!), we might not want to open up a whole new file of complexity of a symbolic expression without input from experts in such things.

What do you think?  I do like having this available, Dan isn't the first to ask.  There are also some custom methods on some other ticket for pretty comprehensive dealing with the trig-complex issue, I can't remember where it is and don't have time to find it, though.  You might want to do some snooping on sage-devel archives or on Trac for these.



---

archive/issue_comments_125249.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nI tried it without the complexity measure first, but this function has a tendency to make expressions *more* complicated. If we're ever going to use it in e.g. `full_simplify()`, we need to be a little more selective about which results we accept.\n\nIt turns out, string length is actually a pretty good measure.\n\nI implemented something close to the number of vertices in the expression tree:\n\n```\nfrom types import ListType\n\ndef flatten_list(l):\n   result = []\n\n   for item in l:\n      if isinstance(item, ListType):\n         result += flatten_list(item)\n      else:\n         result += [item]\n\n   return result\n\ndef flatten_operands(operands):\n   return operands + [flatten_operands(g.operands()) for g in operands]\n\ndef all_operands(expr):\n    return flatten_list(flatten_operands(expr.operands()))\n```\n\nand then tried the `len(all_operands(expr))` complexity measure. It also works, but is much much much slower and doesn't seem \"better\" than string length really. We could add that to the `complexity_measures` module as an option, but the dumb solution seems to work too.\n\n(The way that I'm testing, by the way, is to replace `simplify()` with `simplify_rect()` and watch the failing doctests. Many of them are promising.)\n\nAdmittedly adding a new module just for this feels like overkill, but the alternatives weren't too appealing:\n\n* Default to `lambda x: len(str(x))`\n* Default to `None`, and use the string length in that case. Requires the user to pass `lambda x: 1` to force the simplification (we'd also have to use less-than-or-equal-to in the function body).\n* Remove the measure altogether; this usually wasn't a simplification.\n\nDown the line, `simplify_full()` could potentially try `simplify_foo()` with *every* complexity measure, and return the expression that's simplest according to the measure you gave `simplify_full()`.",
    "created_at": "2012-03-27T20:57:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11785",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11785#issuecomment-125249",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:4" align="right">Comment 4</div>

I tried it without the complexity measure first, but this function has a tendency to make expressions *more* complicated. If we're ever going to use it in e.g. `full_simplify()`, we need to be a little more selective about which results we accept.

It turns out, string length is actually a pretty good measure.

I implemented something close to the number of vertices in the expression tree:

```
from types import ListType

def flatten_list(l):
   result = []

   for item in l:
      if isinstance(item, ListType):
         result += flatten_list(item)
      else:
         result += [item]

   return result

def flatten_operands(operands):
   return operands + [flatten_operands(g.operands()) for g in operands]

def all_operands(expr):
    return flatten_list(flatten_operands(expr.operands()))
```

and then tried the `len(all_operands(expr))` complexity measure. It also works, but is much much much slower and doesn't seem "better" than string length really. We could add that to the `complexity_measures` module as an option, but the dumb solution seems to work too.

(The way that I'm testing, by the way, is to replace `simplify()` with `simplify_rect()` and watch the failing doctests. Many of them are promising.)

Admittedly adding a new module just for this feels like overkill, but the alternatives weren't too appealing:

* Default to `lambda x: len(str(x))`
* Default to `None`, and use the string length in that case. Requires the user to pass `lambda x: 1` to force the simplification (we'd also have to use less-than-or-equal-to in the function body).
* Remove the measure altogether; this usually wasn't a simplification.

Down the line, `simplify_full()` could potentially try `simplify_foo()` with *every* complexity measure, and return the expression that's simplest according to the measure you gave `simplify_full()`.



---

archive/issue_comments_125250.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nInteresting, and good longer-range ideas.\n\nApropos slowness, that might be worth testing anyway for this.  `full_simplify` is probably really slow, but testing two different strings like this could make it really slow (not that that is done here).  The \"down the line\" would probably be super-slow for that reason.\n\nAlso, along the lines of plotting and William's recent email complaining about how 2D plotting got away from not caring about the backend, it might be worth thinking about how to allow a number of backends for simplification as well...  just a thought.",
    "created_at": "2012-03-28T02:28:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11785",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11785#issuecomment-125250",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:5" align="right">Comment 5</div>

Interesting, and good longer-range ideas.

Apropos slowness, that might be worth testing anyway for this.  `full_simplify` is probably really slow, but testing two different strings like this could make it really slow (not that that is done here).  The "down the line" would probably be super-slow for that reason.

Also, along the lines of plotting and William's recent email complaining about how 2D plotting got away from not caring about the backend, it might be worth thinking about how to allow a number of backends for simplification as well...  just a thought.



---

archive/issue_comments_125251.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nFailing doctest (looks like a typo, should be complexity_measure**s**):\n\n```\nFile \"/home/patchbot/sage-5.0.beta3/devel/sage-11785/sage/symbolic/complexity_measures.py\", line 30:\n    sage: from sage.symbolic.complexity_measure import string_length\nException raised:\n    Traceback (most recent call last):\n      File \"/home/patchbot/sage-5.0.beta3/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/home/patchbot/sage-5.0.beta3/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/home/patchbot/sage-5.0.beta3/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_1[2]>\", line 1, in <module>\n        from sage.symbolic.complexity_measure import string_length###line 30:\n    sage: from sage.symbolic.complexity_measure import string_length\n    ImportError: No module named complexity_measure\n**********************************************************************",
    "created_at": "2012-04-06T10:33:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11785",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11785#issuecomment-125251",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:6" align="right">Comment 6</div>

Failing doctest (looks like a typo, should be complexity_measure**s**):

```
File "/home/patchbot/sage-5.0.beta3/devel/sage-11785/sage/symbolic/complexity_measures.py", line 30:
    sage: from sage.symbolic.complexity_measure import string_length
Exception raised:
    Traceback (most recent call last):
      File "/home/patchbot/sage-5.0.beta3/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/home/patchbot/sage-5.0.beta3/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/home/patchbot/sage-5.0.beta3/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_1[2]>", line 1, in <module>
        from sage.symbolic.complexity_measure import string_length###line 30:
    sage: from sage.symbolic.complexity_measure import string_length
    ImportError: No module named complexity_measure
**********************************************************************



---

archive/issue_events_144768.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2012-04-06T10:33:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11785",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11785#event-144768"
}
```



---

archive/issue_events_144769.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2012-04-06T10:33:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11785",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11785#event-144769"
}
```



---

archive/issue_comments_125252.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nWhoops, that was a last-minute change to match the naming of groups,rings, etc. I fixed the 's' and renamed the method to `simplify_rectform()` per comment 3.",
    "created_at": "2012-04-06T15:57:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11785",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11785#issuecomment-125252",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:8" align="right">Comment 8</div>

Whoops, that was a last-minute change to match the naming of groups,rings, etc. I fixed the 's' and renamed the method to `simplify_rectform()` per comment 3.



---

archive/issue_events_144770.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2012-04-06T15:57:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11785",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11785#event-144770"
}
```



---

archive/issue_events_144771.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2012-04-06T15:57:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11785",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11785#event-144771"
}
```



---

archive/issue_comments_125253.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\nI will ask some other people about the complexity measure stuff, but I think your default is reversed: for anyone who knows a little Maxima, they will expect something like `simplify_rectform()` to actually return what Maxima's `rectform` returns -- but the default *isn't* to do that. \n\nHere's my proposal: by default, call Maxima's `rectform` and return that. Don't import anything from `complexity_measures.py` by default, but include documentation showing the user how to import that and use it in the keyword argument. \n\n(Also, how hard is it to count the number of operands in an expression? It's just `len`, right? If it isn't too hard, perhaps the documentation could show how to use that as a complexity measure.)",
    "created_at": "2012-05-28T22:08:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11785",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11785#issuecomment-125253",
    "user": "https://github.com/dandrake"
}
```

<div id="comment:9" align="right">Comment 9</div>

I will ask some other people about the complexity measure stuff, but I think your default is reversed: for anyone who knows a little Maxima, they will expect something like `simplify_rectform()` to actually return what Maxima's `rectform` returns -- but the default *isn't* to do that. 

Here's my proposal: by default, call Maxima's `rectform` and return that. Don't import anything from `complexity_measures.py` by default, but include documentation showing the user how to import that and use it in the keyword argument. 

(Also, how hard is it to count the number of operands in an expression? It's just `len`, right? If it isn't too hard, perhaps the documentation could show how to use that as a complexity measure.)



---

archive/issue_events_144772.json:
```json
{
    "actor": "https://github.com/dandrake",
    "created_at": "2012-05-28T22:08:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11785",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11785#event-144772"
}
```



---

archive/issue_events_144773.json:
```json
{
    "actor": "https://github.com/dandrake",
    "created_at": "2012-05-28T22:08:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11785",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11785#event-144773"
}
```



---

archive/issue_comments_125254.json:
```json
{
    "body": "Changed keywords from **maxima symbolics exponentials** to **maxima symbolics exponentials sd40.5**",
    "created_at": "2012-05-28T22:08:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11785",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11785#issuecomment-125254",
    "user": "https://github.com/dandrake"
}
```

Changed keywords from **maxima symbolics exponentials** to **maxima symbolics exponentials sd40.5**



---

archive/issue_comments_125255.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\nReplying to [@dandrake](#comment%3A9):\n> I will ask some other people about the complexity measure stuff, but I think your default is reversed: for anyone who knows a little Maxima, they will expect something like `simplify_rectform()` to actually return what Maxima's `rectform` returns -- but the default *isn't* to do that. \n> \n> Here's my proposal: by default, call Maxima's `rectform` and return that. Don't import anything from `complexity_measures.py` by default, but include documentation showing the user how to import that and use it in the keyword argument. \n\n\nBut why introduce a default that's not useful? Unless you're setting up a toy example to show what `rectform` does, most expressions will be made uglier. Maxima's `rectform()` isn't labeled a simplification; if we're going to call it one, I think it should simplify.\n\nIf we call it a simplification and have it only do `rectform()` by default, we're essentially requiring the user to both read the docs and pass `make_it_work=True` on every invocation.\n\n\nHow many of our users are there that,\n\na. Know maxima **and** are familiar with its `rectform()` **and** don't know about expr.maxima_methods().rectform() **and** would expect `simplify_rectform()` to *just* call `rectform()`?\nb. Use `simplify_foo()` and just want their expressions to get simpler.\n\nI suspect (b) dwarfs (a).\n\nI wouldn't mind if we just called it `Expression.rectform()` and documented what it does, but I also don't think that it would be as useful.\n\n\n\n\n> (Also, how hard is it to count the number of operands in an expression? It's just `len`, right? If it isn't too hard, perhaps the documentation could show how to use that as a complexity measure.)\n\n\n\n\nIt depends on how thorough you want to be. A simple `len(expr)` will return the number of top-level operands. If you want to count all operands at any level, you either have to recurse (as I did), or know some shortcut.\n\nThe former doesn't work well because you can have,\n\n```\nsage: f = huge_expression1 + huge_expression2\nsage: len(f)\n2\n```\n\nThe latter works comparably to the string length, but was slow as dirt (my implementation is lame). It could probably be improved, though. I would definitely include this if some pynac magic can speed it up.",
    "created_at": "2012-05-28T23:04:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11785",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11785#issuecomment-125255",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:10" align="right">Comment 10</div>

Replying to [@dandrake](#comment%3A9):
> I will ask some other people about the complexity measure stuff, but I think your default is reversed: for anyone who knows a little Maxima, they will expect something like `simplify_rectform()` to actually return what Maxima's `rectform` returns -- but the default *isn't* to do that. 
> 
> Here's my proposal: by default, call Maxima's `rectform` and return that. Don't import anything from `complexity_measures.py` by default, but include documentation showing the user how to import that and use it in the keyword argument. 


But why introduce a default that's not useful? Unless you're setting up a toy example to show what `rectform` does, most expressions will be made uglier. Maxima's `rectform()` isn't labeled a simplification; if we're going to call it one, I think it should simplify.

If we call it a simplification and have it only do `rectform()` by default, we're essentially requiring the user to both read the docs and pass `make_it_work=True` on every invocation.


How many of our users are there that,

a. Know maxima **and** are familiar with its `rectform()` **and** don't know about expr.maxima_methods().rectform() **and** would expect `simplify_rectform()` to *just* call `rectform()`?
b. Use `simplify_foo()` and just want their expressions to get simpler.

I suspect (b) dwarfs (a).

I wouldn't mind if we just called it `Expression.rectform()` and documented what it does, but I also don't think that it would be as useful.




> (Also, how hard is it to count the number of operands in an expression? It's just `len`, right? If it isn't too hard, perhaps the documentation could show how to use that as a complexity measure.)




It depends on how thorough you want to be. A simple `len(expr)` will return the number of top-level operands. If you want to count all operands at any level, you either have to recurse (as I did), or know some shortcut.

The former doesn't work well because you can have,

```
sage: f = huge_expression1 + huge_expression2
sage: len(f)
2
```

The latter works comparably to the string length, but was slow as dirt (my implementation is lame). It could probably be improved, though. I would definitely include this if some pynac magic can speed it up.



---

archive/issue_comments_125256.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\nPerhaps it would help to abstract out something.  From discussing with Dan, it sounds like you actually agree more than you think.\n* Those who want a command that simplifies definitely want the current version, or at least something like it.\n* Those who use something with the word `rectform` in it will expect something with right angles.\n\nCould we have two functions, then?  \n1. Something with `simplify_foo` where `foo` is something that implies `e^(pi*i*n)` will look very simple with `n` an integer but `e^(i*x)` doesn't change?\n2. Something that allows people to access `rectform` without using `maxima_methods`?  (I think that the group of folks who would like this is not insignificant, since a lot of people don't know Maxima when coming to Sage but definitely want this sort of symbolic stuff.)\n\nThoughts are welcome.",
    "created_at": "2012-05-29T02:44:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11785",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11785#issuecomment-125256",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:11" align="right">Comment 11</div>

Perhaps it would help to abstract out something.  From discussing with Dan, it sounds like you actually agree more than you think.
* Those who want a command that simplifies definitely want the current version, or at least something like it.
* Those who use something with the word `rectform` in it will expect something with right angles.

Could we have two functions, then?  
1. Something with `simplify_foo` where `foo` is something that implies `e^(pi*i*n)` will look very simple with `n` an integer but `e^(i*x)` doesn't change?
2. Something that allows people to access `rectform` without using `maxima_methods`?  (I think that the group of folks who would like this is not insignificant, since a lot of people don't know Maxima when coming to Sage but definitely want this sort of symbolic stuff.)

Thoughts are welcome.



---

archive/issue_comments_125257.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">Comment 12</div>\n\nReplying to [@kcrisman](#comment%3A11):\n> Perhaps it would help to abstract out something.  From discussing with Dan, it sounds like you actually agree more than you think.\n> * Those who want a command that simplifies definitely want the current version, or at least something like it.\n> * Those who use something with the word `rectform` in it will expect something with right angles.\n> \n> Could we have two functions, then?  \n> 1. Something with `simplify_foo` where `foo` is something that implies `e^(pi*i*n)` will look very simple with `n` an integer but `e^(i*x)` doesn't change?\n> 2. Something that allows people to access `rectform` without using `maxima_methods`?  (I think that the group of folks who would like this is not insignificant, since a lot of people don't know Maxima when coming to Sage but definitely want this sort of symbolic stuff.)\n> \n> Thoughts are welcome.\n\nSure, I'll create another ticket for adding `Expression.rectform` (that one should be an easy review) and implement `simplify_rectform()` in terms of that. I'll try to do it later today.",
    "created_at": "2012-05-29T13:24:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11785",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11785#issuecomment-125257",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:12" align="right">Comment 12</div>

Replying to [@kcrisman](#comment%3A11):
> Perhaps it would help to abstract out something.  From discussing with Dan, it sounds like you actually agree more than you think.
> * Those who want a command that simplifies definitely want the current version, or at least something like it.
> * Those who use something with the word `rectform` in it will expect something with right angles.
> 
> Could we have two functions, then?  
> 1. Something with `simplify_foo` where `foo` is something that implies `e^(pi*i*n)` will look very simple with `n` an integer but `e^(i*x)` doesn't change?
> 2. Something that allows people to access `rectform` without using `maxima_methods`?  (I think that the group of folks who would like this is not insignificant, since a lot of people don't know Maxima when coming to Sage but definitely want this sort of symbolic stuff.)
> 
> Thoughts are welcome.

Sure, I'll create another ticket for adding `Expression.rectform` (that one should be an easy review) and implement `simplify_rectform()` in terms of that. I'll try to do it later today.



---

archive/issue_comments_125258.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nThere's a patch up at #13061 adding plain `rectform()`, so I'll rebase this one off that.",
    "created_at": "2012-05-29T17:57:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11785",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11785#issuecomment-125258",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:13" align="right">Comment 13</div>

There's a patch up at #13061 adding plain `rectform()`, so I'll rebase this one off that.



---

archive/issue_comments_125259.json:
```json
{
    "body": "Dependencies: **#13061**",
    "created_at": "2012-05-29T17:57:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11785",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11785#issuecomment-125259",
    "user": "https://github.com/orlitzky"
}
```

Dependencies: **#13061**



---

archive/issue_comments_125260.json:
```json
{
    "body": "Attachment: **[sage-trac_11785.patch.gz](https://github.com/sagemath/sage/files/ticket11785/sage-trac_11785.patch.gz)**\n\nUpdated patch based on Expression.rectform()",
    "created_at": "2012-05-29T19:02:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11785",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11785#issuecomment-125260",
    "user": "https://github.com/orlitzky"
}
```

Attachment: **[sage-trac_11785.patch.gz](https://github.com/sagemath/sage/files/ticket11785/sage-trac_11785.patch.gz)**

Updated patch based on Expression.rectform()



---

archive/issue_events_144774.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2012-05-29T19:03:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11785",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11785#event-144774"
}
```



---

archive/issue_events_144775.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2012-05-29T19:03:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11785",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11785#event-144775"
}
```



---

archive/issue_comments_125261.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\nOk, patch is updated.",
    "created_at": "2012-05-29T19:03:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11785",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11785#issuecomment-125261",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:14" align="right">Comment 14</div>

Ok, patch is updated.



---

archive/issue_comments_125262.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\nPlease fill in your real name as Author.",
    "created_at": "2012-07-27T20:41:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11785",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11785#issuecomment-125262",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:15" align="right">Comment 15</div>

Please fill in your real name as Author.



---

archive/issue_comments_125263.json:
```json
{
    "body": "Author: **Michael Orlitzky**",
    "created_at": "2012-07-30T15:16:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11785",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11785#issuecomment-125263",
    "user": "https://github.com/orlitzky"
}
```

Author: **Michael Orlitzky**



---

archive/issue_events_144776.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11785",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11785#event-144776"
}
```



---

archive/issue_events_144777.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11785",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11785#event-144777"
}
```



---

archive/issue_events_144778.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11785",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11785#event-144778"
}
```



---

archive/issue_events_144779.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11785",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11785#event-144779"
}
```



---

archive/issue_comments_125264.json:
```json
{
    "body": "Branch: **[u/rws/ticket/11785](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/ticket/11785)**",
    "created_at": "2014-02-15T16:14:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11785",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11785#issuecomment-125264",
    "user": "https://github.com/rwst"
}
```

Branch: **[u/rws/ticket/11785](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/ticket/11785)**



---

archive/issue_comments_125265.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">Comment 20</div>\n\nRebased and changed doctest output order so it tests OK.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/accb798f68dbcd0e7f2b24654b8728c2746170fc\">accb798</a></td><td><code>Trac #11785: Provide an interface to Maxima's rectform().</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b2001c09f8407c6b256e7d49e67e449ef8cbc78c\">b2001c0</a></td><td><code>trac #11785: reviewers patch: change doctest expected string ordering</code></td></tr></table>\n",
    "created_at": "2014-02-15T16:16:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11785",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11785#issuecomment-125265",
    "user": "https://github.com/rwst"
}
```

<div id="comment:20" align="right">Comment 20</div>

Rebased and changed doctest output order so it tests OK.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/accb798f68dbcd0e7f2b24654b8728c2746170fc">accb798</a></td><td><code>Trac #11785: Provide an interface to Maxima's rectform().</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b2001c09f8407c6b256e7d49e67e449ef8cbc78c">b2001c0</a></td><td><code>trac #11785: reviewers patch: change doctest expected string ordering</code></td></tr></table>




---

archive/issue_events_144780.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-02-15T16:16:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11785",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11785#event-144780"
}
```



---

archive/issue_events_144781.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-02-15T16:16:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11785",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11785#event-144781"
}
```



---

archive/issue_comments_125266.json:
```json
{
    "body": "Commit: **[b2001c0](https://github.com/sagemath/sagetrac-mirror/commit/b2001c09f8407c6b256e7d49e67e449ef8cbc78c)**",
    "created_at": "2014-02-15T16:16:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11785",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11785#issuecomment-125266",
    "user": "https://github.com/rwst"
}
```

Commit: **[b2001c0](https://github.com/sagemath/sagetrac-mirror/commit/b2001c09f8407c6b256e7d49e67e449ef8cbc78c)**



---

archive/issue_comments_125267.json:
```json
{
    "body": "Reviewer: **Ralf Stephan**",
    "created_at": "2014-02-15T16:16:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11785",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11785#issuecomment-125267",
    "user": "https://github.com/rwst"
}
```

Reviewer: **Ralf Stephan**



---

archive/issue_events_144782.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2014-02-20T17:25:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11785",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11785#event-144782"
}
```



---

archive/issue_events_144783.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2014-02-20T17:25:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11785",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11785#event-144783"
}
```



---

archive/issue_comments_125268.json:
```json
{
    "body": "Changed commit from **[b2001c0](https://github.com/sagemath/sagetrac-mirror/commit/b2001c09f8407c6b256e7d49e67e449ef8cbc78c)** to **[2fb52ed](https://github.com/sagemath/sagetrac-mirror/commit/2fb52ed22e39c63908bb612bb91ca9fd4126f477)**",
    "created_at": "2014-02-20T17:25:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11785",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11785#issuecomment-125268",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[b2001c0](https://github.com/sagemath/sagetrac-mirror/commit/b2001c09f8407c6b256e7d49e67e449ef8cbc78c)** to **[2fb52ed](https://github.com/sagemath/sagetrac-mirror/commit/2fb52ed22e39c63908bb612bb91ca9fd4126f477)**



---

archive/issue_comments_125269.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">Comment 21</div>\n\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2fb52ed22e39c63908bb612bb91ca9fd4126f477\">2fb52ed</a></td><td><code>Merge branch 'develop' into ticket/11785</code></td></tr></table>\n",
    "created_at": "2014-02-20T17:25:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11785",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11785#issuecomment-125269",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21" align="right">Comment 21</div>

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2fb52ed22e39c63908bb612bb91ca9fd4126f477">2fb52ed</a></td><td><code>Merge branch 'develop' into ticket/11785</code></td></tr></table>




---

archive/issue_events_144784.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-02-20T17:45:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11785",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11785#event-144784"
}
```



---

archive/issue_events_144785.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-02-20T17:45:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11785",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11785#event-144785"
}
```



---

archive/issue_comments_125270.json:
```json
{
    "body": "Changed branch from **[u/rws/ticket/11785](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/ticket/11785)** to **[2fb52ed](https://github.com/sagemath/sagetrac-mirror/commit/2fb52ed22e39c63908bb612bb91ca9fd4126f477)**",
    "created_at": "2014-02-20T23:17:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11785",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11785#issuecomment-125270",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/rws/ticket/11785](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/ticket/11785)** to **[2fb52ed](https://github.com/sagemath/sagetrac-mirror/commit/2fb52ed22e39c63908bb612bb91ca9fd4126f477)**



---

archive/issue_events_144786.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-02-20T23:17:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11785",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11785#event-144786"
}
```



---

archive/issue_events_144787.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "7456692d3ebf6047317265f547d3e3390a4796af",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2014-02-20T23:17:01Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/11785",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11785#event-144787"
}
```
