# Issue 11908: Fix tree plotting again

archive/issues_011736.json:
```json
{
    "body": "I wrote some code that produces fairly nice-looking tree plots in #6747, and, I might point out, worked great.  For some reason, this was obliterated in #7004 with code that almost does the right thing, but fails to draw the tree crossing-free with high probability.\n\nThe easy thing is to add a parameter `shuffle` to `GenericGraph.layout_ranked`, so `GenericGraph.layout_tree` could just call `return self.layout_ranked(heights_dict,shuffle=False)` to avoid the (somewhat baffling) behavior of shuffling the vertices along the heights.  IMHO, the default should be to not shuffle... but the primary focus of this ticket is to fix the damned tree plots.  Again.\n\nMy preference is to bring back my code from #6747, since the results are pretty, and I find the \"shrink-wrapped\" look of layout_ranked to be incomprehensible for large-ish trees.  A good compromise is to add options: layout = \"tree\", \"tree:hang\", \"tree:shrinkwrap\", \"tree:circle\", etc.\n\nNote to reviewers:  look at the plots produced in the doctests before giving a positive review.\n\nApply:\n\n* [attachment:trac_11908-fc.patch]\n* [attachment:trac_11908-rev.patch]\n\nAssignee: jason, ncohen, rlm\n\nCC:  @nthiery @videlec @nathanncohen\n\nKeywords: tree, plot\n\nReviewer: Nathann Cohen\n\nAuthor: Fr\u00e9d\u00e9ric Chapoton\n\nMerged: sage-5.10.beta3\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/11908\n\n",
    "closed_at": "2013-05-13T13:26:13Z",
    "created_at": "2011-10-08T19:37:23Z",
    "labels": [
        "component: graph theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.10",
    "title": "Fix tree plotting again",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11908",
    "user": "https://trac.sagemath.org/admin/accounts/users/boothby"
}
```
I wrote some code that produces fairly nice-looking tree plots in #6747, and, I might point out, worked great.  For some reason, this was obliterated in #7004 with code that almost does the right thing, but fails to draw the tree crossing-free with high probability.

The easy thing is to add a parameter `shuffle` to `GenericGraph.layout_ranked`, so `GenericGraph.layout_tree` could just call `return self.layout_ranked(heights_dict,shuffle=False)` to avoid the (somewhat baffling) behavior of shuffling the vertices along the heights.  IMHO, the default should be to not shuffle... but the primary focus of this ticket is to fix the damned tree plots.  Again.

My preference is to bring back my code from #6747, since the results are pretty, and I find the "shrink-wrapped" look of layout_ranked to be incomprehensible for large-ish trees.  A good compromise is to add options: layout = "tree", "tree:hang", "tree:shrinkwrap", "tree:circle", etc.

Note to reviewers:  look at the plots produced in the doctests before giving a positive review.

Apply:

* [attachment:trac_11908-fc.patch]
* [attachment:trac_11908-rev.patch]

Assignee: jason, ncohen, rlm

CC:  @nthiery @videlec @nathanncohen

Keywords: tree, plot

Reviewer: Nathann Cohen

Author: Frédéric Chapoton

Merged: sage-5.10.beta3

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/11908





---

archive/issue_comments_133221.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-05-06T19:20:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11908#issuecomment-133221",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_133222.json:
```json
{
    "body": "<a id='comment:1'></a>hello there, here is a patch, needs review !",
    "created_at": "2013-05-06T19:20:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11908#issuecomment-133222",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>hello there, here is a patch, needs review !



---

archive/issue_comments_133223.json:
```json
{
    "body": "<a id='comment:3'></a>Hellooooooo Frederic !\n\nLooks like your patch does not apply cleanly on 5.10.beta1. This being said, what do you want to achieve with this patch ? What are the bad properties of the current implementation that you want to fix (I really have no idea, I never used that code) ? Do you want the drawing to be planar, for instance (no edge crossings) ?\n\nNathann",
    "created_at": "2013-05-07T16:45:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11908#issuecomment-133223",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:3'></a>Hellooooooo Frederic !

Looks like your patch does not apply cleanly on 5.10.beta1. This being said, what do you want to achieve with this patch ? What are the bad properties of the current implementation that you want to fix (I really have no idea, I never used that code) ? Do you want the drawing to be planar, for instance (no edge crossings) ?

Nathann



---

archive/issue_comments_133224.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-05-07T16:45:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11908#issuecomment-133224",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_133225.json:
```json
{
    "body": "<a id='comment:4'></a>Oh, and what about using \"g.center()\" as the root when none is provided ? It should minimize the tree's height.\n\nNathann",
    "created_at": "2013-05-07T16:50:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11908#issuecomment-133225",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:4'></a>Oh, and what about using "g.center()" as the root when none is provided ? It should minimize the tree's height.

Nathann



---

archive/issue_comments_133226.json:
```json
{
    "body": "<a id='comment:5'></a>Yes, the main aim is to have a drawing of a tree without crossings. With the current algorithm, this is not the case\n\n```\ng = graphs.RandomTree(80)\ng.plot(layout='tree')\n```\ngives a very messy picture, which does not look like a tree at all.\n\nThanks for the idea of using the center, I will take care of that as soon as I can do the rebase.",
    "created_at": "2013-05-07T19:44:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11908#issuecomment-133226",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:5'></a>Yes, the main aim is to have a drawing of a tree without crossings. With the current algorithm, this is not the case

```
g = graphs.RandomTree(80)
g.plot(layout='tree')
```
gives a very messy picture, which does not look like a tree at all.

Thanks for the idea of using the center, I will take care of that as soon as I can do the rebase.



---

archive/issue_comments_133227.json:
```json
{
    "body": "<a id='comment:6'></a>here is a rebased patch on 5.10.beta1\n\nI have used the idea of the center as default root",
    "created_at": "2013-05-08T09:32:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11908#issuecomment-133227",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:6'></a>here is a rebased patch on 5.10.beta1

I have used the idea of the center as default root



---

archive/issue_comments_133228.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-05-08T09:32:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11908#issuecomment-133228",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_133229.json:
```json
{
    "body": "Changing keywords from \"\" to \"tree, plot\".",
    "created_at": "2013-05-08T09:33:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11908#issuecomment-133229",
    "user": "https://github.com/fchapoton"
}
```

Changing keywords from "" to "tree, plot".



---

archive/issue_comments_133230.json:
```json
{
    "body": "<a id='comment:8'></a>(while testing the patch)\n\nAhahahah. Yeah, it is indeed considerably better than what we currently have `:-D`\n\nNathann",
    "created_at": "2013-05-08T10:20:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11908#issuecomment-133230",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:8'></a>(while testing the patch)

Ahahahah. Yeah, it is indeed considerably better than what we currently have `:-D`

Nathann



---

archive/issue_comments_133231.json:
```json
{
    "body": "<a id='comment:9'></a>one moment please, I have to correct a typo in the doc",
    "created_at": "2013-05-08T10:21:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11908#issuecomment-133231",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:9'></a>one moment please, I have to correct a typo in the doc



---

archive/issue_comments_133232.json:
```json
{
    "body": "<a id='comment:10'></a>Attachment [trac_11908-fc.patch](tarball://root/attachments/some-uuid/ticket11908/trac_11908-fc.patch) by @fchapoton created at 2013-05-08 10:23:22\n\ntypo corrected, done",
    "created_at": "2013-05-08T10:23:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11908#issuecomment-133232",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:10'></a>Attachment [trac_11908-fc.patch](tarball://root/attachments/some-uuid/ticket11908/trac_11908-fc.patch) by @fchapoton created at 2013-05-08 10:23:22

typo corrected, done



---

archive/issue_comments_133233.json:
```json
{
    "body": "<a id='comment:11'></a>Two questions while I read and try too understand the algorithm.\n\n* Why don't you treat the orientation up/down as you do right/left, i.e. at the end of the algorithm ?\n\n* Why is `obstruction[y] = max(x+1, obstruction[y]) ` not `max(x+dx, obstruction[y])` ? You probably have a nice reason for that, as the plot are very pretty `:-)`\n\nNathann",
    "created_at": "2013-05-08T10:43:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11908#issuecomment-133233",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:11'></a>Two questions while I read and try too understand the algorithm.

* Why don't you treat the orientation up/down as you do right/left, i.e. at the end of the algorithm ?

* Why is `obstruction[y] = max(x+1, obstruction[y]) ` not `max(x+dx, obstruction[y])` ? You probably have a nice reason for that, as the plot are very pretty `:-)`

Nathann



---

archive/issue_comments_133234.json:
```json
{
    "body": "<a id='comment:12'></a>* Well, this is not my algorithm, it comes directly from Tom Boothby's code in #6747. I have not tried to understand how it works.\n\n* I have introduced right and left orientations, in a simple-minded way. Maybe one can refactor the code.",
    "created_at": "2013-05-08T10:47:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11908#issuecomment-133234",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:12'></a>* Well, this is not my algorithm, it comes directly from Tom Boothby's code in #6747. I have not tried to understand how it works.

* I have introduced right and left orientations, in a simple-minded way. Maybe one can refactor the code.



---

archive/issue_comments_133235.json:
```json
{
    "body": "<a id='comment:13'></a>Attachment [trac_11908-rev.patch](tarball://root/attachments/some-uuid/ticket11908/trac_11908-rev.patch) by @nathanncohen created at 2013-05-08 12:02:49\n\nHellooooooooooooo !\n\nIt took me some time to understand it, but it's done. I added comments, to help the next one who will have to read that.\n\nIf you agree with those changes, you can set the ticket to `positive_review` ! Nice layout `:-)`\n\nNathann",
    "created_at": "2013-05-08T12:02:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11908#issuecomment-133235",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:13'></a>Attachment [trac_11908-rev.patch](tarball://root/attachments/some-uuid/ticket11908/trac_11908-rev.patch) by @nathanncohen created at 2013-05-08 12:02:49

Hellooooooooooooo !

It took me some time to understand it, but it's done. I added comments, to help the next one who will have to read that.

If you agree with those changes, you can set the ticket to `positive_review` ! Nice layout `:-)`

Nathann



---

archive/issue_comments_133236.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-05-08T13:05:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11908#issuecomment-133236",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_133237.json:
```json
{
    "body": "<a id='comment:14'></a>ok, looks good to me. Positive review.",
    "created_at": "2013-05-08T13:05:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11908#issuecomment-133237",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:14'></a>ok, looks good to me. Positive review.



---

archive/issue_comments_133238.json:
```json
{
    "body": "<a id='comment:15'></a>Sorry to pipe up now... but can one of you add in the following test, or something similar?\n\n```\n    sage: T = graphs.RandomTree(1000)\n    sage: T.plot(layout='tree',save_pos=True)\n    sage: T.is_drawn_free_of_edge_crossings()\n    True\n```",
    "created_at": "2013-05-09T16:46:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11908#issuecomment-133238",
    "user": "https://trac.sagemath.org/admin/accounts/users/boothby"
}
```

<a id='comment:15'></a>Sorry to pipe up now... but can one of you add in the following test, or something similar?

```
    sage: T = graphs.RandomTree(1000)
    sage: T.plot(layout='tree',save_pos=True)
    sage: T.is_drawn_free_of_edge_crossings()
    True
```



---

archive/issue_comments_133239.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-05-09T16:46:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11908#issuecomment-133239",
    "user": "https://trac.sagemath.org/admin/accounts/users/boothby"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_133240.json:
```json
{
    "body": "Attachment [trac_11908-more_test.patch](tarball://root/attachments/some-uuid/ticket11908/trac_11908-more_test.patch) by @fchapoton created at 2013-05-09 17:49:37",
    "created_at": "2013-05-09T17:49:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11908#issuecomment-133240",
    "user": "https://github.com/fchapoton"
}
```

Attachment [trac_11908-more_test.patch](tarball://root/attachments/some-uuid/ticket11908/trac_11908-more_test.patch) by @fchapoton created at 2013-05-09 17:49:37



---

archive/issue_comments_133241.json:
```json
{
    "body": "<a id='comment:16'></a>ok, done. If you are satisfied, please consider putting back the positive review.",
    "created_at": "2013-05-09T17:50:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11908#issuecomment-133241",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:16'></a>ok, done. If you are satisfied, please consider putting back the positive review.



---

archive/issue_comments_133242.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-05-09T17:50:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11908#issuecomment-133242",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_133243.json:
```json
{
    "body": "<a id='comment:17'></a>This is exactly the thing asked for, so I think you are safe in setting it to positive review as long as patchbot agrees...",
    "created_at": "2013-05-09T19:21:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11908#issuecomment-133243",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:17'></a>This is exactly the thing asked for, so I think you are safe in setting it to positive review as long as patchbot agrees...



---

archive/issue_comments_133244.json:
```json
{
    "body": "<a id='comment:18'></a>Green light !\n\nNathann",
    "created_at": "2013-05-10T06:55:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11908#issuecomment-133244",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:18'></a>Green light !

Nathann



---

archive/issue_comments_133245.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-05-10T06:55:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11908#issuecomment-133245",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_133246.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-05-13T13:26:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11908",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11908#issuecomment-133246",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_031482.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-13T13:26:13Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11908",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11908#event-31482"
}
```
