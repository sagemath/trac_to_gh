# Issue 11772: improving error reporting of random_matrix, and bug fixing

archive/issues_011600.json:
```json
{
    "body": "The error message of the call to random_matrix(QQ, 4, 8, rank=5) is quite cryptic.\nIt should be easy to check that the rank is greater than min(nrows,ncols) and throw a ValueError with a meaningful message.\n\nA patch, which also fixes a similar small fly in random_subspaces_matrix, is attached.\nThe cumulative patch incorporates more doctests, the fix for rank==1 problem described in the comments, and puts a cup on the number of iterations in various while loops, so that they fail meaningfully.\n\n**Apply**:\n1.  [attachment:trac_11772.3.patch]\n2.  [attachment:trac_11772-reviewer.patch]\n\n\nAssignee: jason, was\n\nCC:  @rbeezer\n\nReviewer: Rob Beezer\n\nAuthor: Dmitrii Pasechnik\n\nMerged: sage-5.12.beta4\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/11772\n\n",
    "closed_at": "2013-08-28T06:51:59Z",
    "created_at": "2011-09-01T16:11:43Z",
    "labels": [
        "component: linear algebra"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.12",
    "title": "improving error reporting of random_matrix, and bug fixing",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11772",
    "user": "https://github.com/dimpase"
}
```
The error message of the call to random_matrix(QQ, 4, 8, rank=5) is quite cryptic.
It should be easy to check that the rank is greater than min(nrows,ncols) and throw a ValueError with a meaningful message.

A patch, which also fixes a similar small fly in random_subspaces_matrix, is attached.
The cumulative patch incorporates more doctests, the fix for rank==1 problem described in the comments, and puts a cup on the number of iterations in various while loops, so that they fail meaningfully.

**Apply**:
1.  [attachment:trac_11772.3.patch]
2.  [attachment:trac_11772-reviewer.patch]


Assignee: jason, was

CC:  @rbeezer

Reviewer: Rob Beezer

Author: Dmitrii Pasechnik

Merged: sage-5.12.beta4

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/11772





---

archive/issue_comments_160109.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-09-01T16:33:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11772#issuecomment-160109",
    "user": "https://github.com/dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_160110.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,7 +1,7 @@\n The error message of the call to random_matrix(QQ, 4, 8, rank=5) is quite cryptic.\n It should be easy to check that the rank is greater than min(nrows,ncols) and throw a ValueError with a meaningful message.\n \n-(patch is coming soon)\n+A patch, which also fixes a similar small fly in random_subspaces_matrix, is attached.\n \n Comment: 1\n \n``````\n",
    "created_at": "2011-09-01T16:33:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11772#issuecomment-160110",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,7 +1,7 @@
 The error message of the call to random_matrix(QQ, 4, 8, rank=5) is quite cryptic.
 It should be easy to check that the rank is greater than min(nrows,ncols) and throw a ValueError with a meaningful message.
 
-(patch is coming soon)
+A patch, which also fixes a similar small fly in random_subspaces_matrix, is attached.
 
 Comment: 1
 
``````




---

archive/issue_comments_160111.json:
```json
{
    "body": "Attachment [trac_11772-v2.patch](tarball://root/attachments/some-uuid/ticket11772/trac_11772-v2.patch) by @rbeezer created at 2011-09-02 02:26:21",
    "created_at": "2011-09-02T02:26:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11772#issuecomment-160111",
    "user": "https://github.com/rbeezer"
}
```

Attachment [trac_11772-v2.patch](tarball://root/attachments/some-uuid/ticket11772/trac_11772-v2.patch) by @rbeezer created at 2011-09-02 02:26:21



---

archive/issue_comments_160112.json:
```json
{
    "body": "Attachment [trac_11772-doctests.patch](tarball://root/attachments/some-uuid/ticket11772/trac_11772-doctests.patch) by @rbeezer created at 2011-09-02 02:26:31",
    "created_at": "2011-09-02T02:26:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11772#issuecomment-160112",
    "user": "https://github.com/rbeezer"
}
```

Attachment [trac_11772-doctests.patch](tarball://root/attachments/some-uuid/ticket11772/trac_11772-doctests.patch) by @rbeezer created at 2011-09-02 02:26:31



---

archive/issue_comments_160113.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,11 @@\n+The error message of the call to random_matrix(QQ, 4, 8, rank=5) is quite cryptic.\n+It should be easy to check that the rank is greater than min(nrows,ncols) and throw a ValueError with a meaningful message.\n \n+A patch, which also fixes a similar small fly in random_subspaces_matrix, is attached.\n+\n+**Apply**:\n+1.  [attachment:trac_11772-v2.patch]\n+2.  [attachment:trac_11772-doctests.patch]\n \n Comment: 1\n \n``````\n",
    "created_at": "2011-09-02T02:32:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11772#issuecomment-160113",
    "user": "https://github.com/rbeezer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,11 @@
+The error message of the call to random_matrix(QQ, 4, 8, rank=5) is quite cryptic.
+It should be easy to check that the rank is greater than min(nrows,ncols) and throw a ValueError with a meaningful message.
 
+A patch, which also fixes a similar small fly in random_subspaces_matrix, is attached.
+
+**Apply**:
+1.  [attachment:trac_11772-v2.patch]
+2.  [attachment:trac_11772-doctests.patch]
 
 Comment: 1
 
``````




---

archive/issue_comments_160114.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Rob Beezer\"",
    "created_at": "2011-09-02T02:32:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11772#issuecomment-160114",
    "user": "https://github.com/rbeezer"
}
```

Changing reviewer from "" to "Rob Beezer"



---

archive/issue_comments_160115.json:
```json
{
    "body": "<a id='comment:3'></a>v2-patch is Dima's original, but with a Trac number in the commit message.\n\nThere was one doctest failure on the subspace routine (the fly), since `None` is an allowed value for the rank, and it seems `None < 0` is `True`.  I moved a hunk of code that checks the `rank=None` case to happen early, and removed a pointless else-clause.\n\nI like doctests that exercise error-conditions, so I added 3 new doctests.  Original patch is a positive review from me, whoever wants to review my patch (Dima?) can flip this whole ticket to positive review if my patch is OK.",
    "created_at": "2011-09-02T02:32:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11772#issuecomment-160115",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:3'></a>v2-patch is Dima's original, but with a Trac number in the commit message.

There was one doctest failure on the subspace routine (the fly), since `None` is an allowed value for the rank, and it seems `None < 0` is `True`.  I moved a hunk of code that checks the `rank=None` case to happen early, and removed a pointless else-clause.

I like doctests that exercise error-conditions, so I added 3 new doctests.  Original patch is a positive review from me, whoever wants to review my patch (Dima?) can flip this whole ticket to positive review if my patch is OK.



---

archive/issue_comments_160116.json:
```json
{
    "body": "<a id='comment:4'></a>there is at least one more problem with the code in random_echelonizable_matrix\n\n```\nsage: random_matrix( QQ, 3, 3, algorithm='echelonizable', rank=1,\n                          upper_bound=60)\n---------------------------------------------------------------------------\nUnboundLocalError                         Traceback (most recent call last)\n\n/Users/dima/<ipython console> in <module>()\n\n/usr/local/src/sage/current/local/lib/python2.6/site-packages/sage/matrix/constructor.pyc in random_matrix(ring, nrows, ncols, algorithm, *args, **kwds)\n   1250         return random_rref_matrix(parent, *args, **kwds)\n   1251     elif algorithm == 'echelonizable':\n-> 1252         return random_echelonizable_matrix(parent, *args, **kwds)\n   1253     elif algorithm == 'diagonalizable':\n   1254         return random_diagonalizable_matrix(parent, *args, **kwds)\n\n/usr/local/src/sage/current/local/lib/python2.6/site-packages/sage/matrix/constructor.pyc in random_echelonizable_matrix(parent, rank, upper_bound)\n   2995                         matrix_copy=matrix.with_added_multiple_of_row(row_index,matrix.pivot_rows()[pivots],randint(-5,5))\n   2996                         # Range for scalar multiples determined experimentally.\n-> 2997                     if max(map(abs,matrix_copy.list()))<upper_bound:\n   2998                     # Continue if the the largest entry after a row operation is within the bound.\n   2999                         matrix=matrix_copy\n\nUnboundLocalError: local variable 'matrix_copy' referenced before assignment\nsage: \n```",
    "created_at": "2011-09-02T03:14:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11772#issuecomment-160116",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'></a>there is at least one more problem with the code in random_echelonizable_matrix

```
sage: random_matrix( QQ, 3, 3, algorithm='echelonizable', rank=1,
                          upper_bound=60)
---------------------------------------------------------------------------
UnboundLocalError                         Traceback (most recent call last)

/Users/dima/<ipython console> in <module>()

/usr/local/src/sage/current/local/lib/python2.6/site-packages/sage/matrix/constructor.pyc in random_matrix(ring, nrows, ncols, algorithm, *args, **kwds)
   1250         return random_rref_matrix(parent, *args, **kwds)
   1251     elif algorithm == 'echelonizable':
-> 1252         return random_echelonizable_matrix(parent, *args, **kwds)
   1253     elif algorithm == 'diagonalizable':
   1254         return random_diagonalizable_matrix(parent, *args, **kwds)

/usr/local/src/sage/current/local/lib/python2.6/site-packages/sage/matrix/constructor.pyc in random_echelonizable_matrix(parent, rank, upper_bound)
   2995                         matrix_copy=matrix.with_added_multiple_of_row(row_index,matrix.pivot_rows()[pivots],randint(-5,5))
   2996                         # Range for scalar multiples determined experimentally.
-> 2997                     if max(map(abs,matrix_copy.list()))<upper_bound:
   2998                     # Continue if the the largest entry after a row operation is within the bound.
   2999                         matrix=matrix_copy

UnboundLocalError: local variable 'matrix_copy' referenced before assignment
sage: 
```



---

archive/issue_comments_160117.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-09-02T03:14:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11772#issuecomment-160117",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_160118.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:4 dimpase]:\n> there is at least one more problem with the code in random_echelonizable_matrix\n\n\nI've used the function *all the time* the past year, so that is indeed a surprise.  Looks like it is just the `rank=1` case, based on very limited testing.\n\nHow would you like to proceed?",
    "created_at": "2011-09-02T03:51:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11772#issuecomment-160118",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:6'></a>Replying to [comment:4 dimpase]:
> there is at least one more problem with the code in random_echelonizable_matrix


I've used the function *all the time* the past year, so that is indeed a surprise.  Looks like it is just the `rank=1` case, based on very limited testing.

How would you like to proceed?



---

archive/issue_comments_160119.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:6 rbeezer]:\n> Replying to [comment:4 dimpase]:\n> > there is at least one more problem with the code in random_echelonizable_matrix\n\n> \n> I've used the function *all the time* the past year, so that is indeed a surprise.  Looks like it is just the `rank=1` case, based on very limited testing.\n> \n> How would you like to proceed?\n\n\nthe function in question has in general quite suspiciously looking code: e.g. it has\n\n```\nif upper_bound==None:\n            upper_bound=50\n            size=False\n```\nbut then, when `size==False`, `upper_bound` is not used; that whole `size` thing can (and should, in a clearly written code) be replaced by if-else...\n\nMy understanding of the code is that it first gets `matrix` of specified `rank`, and then uses it to create the\nresult, of the same `rank`, but taking random vectors of the row space of `matrix`.\nWIth the `upper_bound` set (and `size==True`, I don't even see how it always succeeds to terminate!\nIf I set `upper_bound=4`, I run into cases that look non-terminating. E.g. try running\n\n```\n for i in range(100):\n    rk=randint(2,13)\n    print rk,i\n    m = random_matrix( QQ, 13, 13, algorithm='echelonizable', rank=rk,   upper_bound=4)\n```\nI bet it will never finish, or at least I usually see it printing only 1 row of output, and then basically going into\nan infinite loop. It seems that `matrix` itself should have well-controlled absolute values of entries, to begin with, \nbut it's not done.\n\nI'd say this has either to be re-done, or scrapped...",
    "created_at": "2011-09-02T05:41:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11772#issuecomment-160119",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:7'></a>Replying to [comment:6 rbeezer]:
> Replying to [comment:4 dimpase]:
> > there is at least one more problem with the code in random_echelonizable_matrix

> 
> I've used the function *all the time* the past year, so that is indeed a surprise.  Looks like it is just the `rank=1` case, based on very limited testing.
> 
> How would you like to proceed?


the function in question has in general quite suspiciously looking code: e.g. it has

```
if upper_bound==None:
            upper_bound=50
            size=False
```
but then, when `size==False`, `upper_bound` is not used; that whole `size` thing can (and should, in a clearly written code) be replaced by if-else...

My understanding of the code is that it first gets `matrix` of specified `rank`, and then uses it to create the
result, of the same `rank`, but taking random vectors of the row space of `matrix`.
WIth the `upper_bound` set (and `size==True`, I don't even see how it always succeeds to terminate!
If I set `upper_bound=4`, I run into cases that look non-terminating. E.g. try running

```
 for i in range(100):
    rk=randint(2,13)
    print rk,i
    m = random_matrix( QQ, 13, 13, algorithm='echelonizable', rank=rk,   upper_bound=4)
```
I bet it will never finish, or at least I usually see it printing only 1 row of output, and then basically going into
an infinite loop. It seems that `matrix` itself should have well-controlled absolute values of entries, to begin with, 
but it's not done.

I'd say this has either to be re-done, or scrapped...



---

archive/issue_comments_160120.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:7 dimpase]:\n> I'd say this has either to be re-done, or scrapped...\n\n\nand there are sound mathematical reasons behind this, too. E.g. if you ask for a random rank k matrix of size kxn, with small entries, this already means that you need to sample in a hypercube, and I leave it for people with better working knowledge of this range of problems to figure out how to go about it.\nFor instance, if you impose upper_bound=1, you have just 3^n choices of vectors, and I don't know which proportion of k-subsets of such vectors will correspond to linearly independent ones, nor what uniformly(?) random such a subset should be...\n\nThe current code is just a dirty hack, and it should at least have a limit on the number of tries done before giving up!",
    "created_at": "2011-09-02T06:11:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11772#issuecomment-160120",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:8'></a>Replying to [comment:7 dimpase]:
> I'd say this has either to be re-done, or scrapped...


and there are sound mathematical reasons behind this, too. E.g. if you ask for a random rank k matrix of size kxn, with small entries, this already means that you need to sample in a hypercube, and I leave it for people with better working knowledge of this range of problems to figure out how to go about it.
For instance, if you impose upper_bound=1, you have just 3^n choices of vectors, and I don't know which proportion of k-subsets of such vectors will correspond to linearly independent ones, nor what uniformly(?) random such a subset should be...

The current code is just a dirty hack, and it should at least have a limit on the number of tries done before giving up!



---

archive/issue_comments_160121.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:7 dimpase]:\n\nI agree with your reservations - this routine should have some safeguards and could probably be cleaned-up quite a bit.  I also find it very useful, even as is.  It can sometimes take a second or two to finish, but with reasonable inputs, it seems to always finish, and produce useful output.\n\nIf you ask for `upper_bound=1`, then I think you get what you deserve.  ;-)\n\n> I'd say this has either to be re-done, or scrapped...\n\n\nSo I would definitely like to see this feature kept - in other words, I would like to see the interface stay stable, with changes to the code.  I'd be happy with throwing an exception after some number of attempts.\n\nI'm taking a break from most Sage work for a few weeks to get caught up on other things, so won't be able to address this immediately.\n\nRob",
    "created_at": "2011-09-03T02:43:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11772#issuecomment-160121",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:9'></a>Replying to [comment:7 dimpase]:

I agree with your reservations - this routine should have some safeguards and could probably be cleaned-up quite a bit.  I also find it very useful, even as is.  It can sometimes take a second or two to finish, but with reasonable inputs, it seems to always finish, and produce useful output.

If you ask for `upper_bound=1`, then I think you get what you deserve.  ;-)

> I'd say this has either to be re-done, or scrapped...


So I would definitely like to see this feature kept - in other words, I would like to see the interface stay stable, with changes to the code.  I'd be happy with throwing an exception after some number of attempts.

I'm taking a break from most Sage work for a few weeks to get caught up on other things, so won't be able to address this immediately.

Rob



---

archive/issue_comments_160122.json:
```json
{
    "body": "cumulative for -v2, -doctests, and more changes",
    "created_at": "2011-09-04T14:52:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11772#issuecomment-160122",
    "user": "https://github.com/dimpase"
}
```

cumulative for -v2, -doctests, and more changes



---

archive/issue_comments_160123.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,11 @@\n+The error message of the call to random_matrix(QQ, 4, 8, rank=5) is quite cryptic.\n+It should be easy to check that the rank is greater than min(nrows,ncols) and throw a ValueError with a meaningful message.\n+\n+A patch, which also fixes a similar small fly in random_subspaces_matrix, is attached.\n+The cumulative patch incorporates more doctests, the fix for rank==1 problem described in the comments, and puts a cup on the number of iterations in various while loops, so that they fail meaningfully.\n+\n+**Apply**:\n+1.  [attachment:trac_11772.patch]\n \n \n Comment: 1\n``````\n",
    "created_at": "2011-09-04T14:56:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11772#issuecomment-160123",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,11 @@
+The error message of the call to random_matrix(QQ, 4, 8, rank=5) is quite cryptic.
+It should be easy to check that the rank is greater than min(nrows,ncols) and throw a ValueError with a meaningful message.
+
+A patch, which also fixes a similar small fly in random_subspaces_matrix, is attached.
+The cumulative patch incorporates more doctests, the fix for rank==1 problem described in the comments, and puts a cup on the number of iterations in various while loops, so that they fail meaningfully.
+
+**Apply**:
+1.  [attachment:trac_11772.patch]
 
 
 Comment: 1
``````




---

archive/issue_comments_160124.json:
```json
{
    "body": "<a id='comment:10'></a>Attachment [trac_11772.patch](tarball://root/attachments/some-uuid/ticket11772/trac_11772.patch) by @dimpase created at 2011-09-04 14:56:05",
    "created_at": "2011-09-04T14:56:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11772#issuecomment-160124",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:10'></a>Attachment [trac_11772.patch](tarball://root/attachments/some-uuid/ticket11772/trac_11772.patch) by @dimpase created at 2011-09-04 14:56:05



---

archive/issue_comments_160125.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-09-04T14:56:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11772#issuecomment-160125",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_160126.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [comment:9 rbeezer]:\n> Replying to [comment:7 dimpase]:\n> \n> I agree with your reservations - this routine should have some safeguards and could probably be cleaned-up quite a bit.  I also find it very useful, even as is.  It can sometimes take a second or two to finish, but with reasonable inputs, it seems to always finish, and produce useful output.\n> \n> If you ask for `upper_bound=1`, then I think you get what you deserve.  ;-)\n\n\nour servers don't deserve being trashed by 120 undergrads, running never ending loops, executing seemingly innocent Sage commands. :)\n\n> \n> > I'd say this has either to be re-done, or scrapped...\n\n> \n> So I would definitely like to see this feature kept - in other words, I would like to see the interface stay stable, with changes to the code.  I'd be happy with throwing an exception after some number of attempts.\n> \n> I'm taking a break from most Sage work for a few weeks to get caught up on other things, so won't be able to address this immediately.\n> \n\n\nI've bitten the bullet and hopefully fixed all the shortcomings we discussed, added throwing exceptions, etc. Please review soon. :-)\n\n> Rob\n\n>",
    "created_at": "2011-09-04T15:02:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11772#issuecomment-160126",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:11'></a>Replying to [comment:9 rbeezer]:
> Replying to [comment:7 dimpase]:
> 
> I agree with your reservations - this routine should have some safeguards and could probably be cleaned-up quite a bit.  I also find it very useful, even as is.  It can sometimes take a second or two to finish, but with reasonable inputs, it seems to always finish, and produce useful output.
> 
> If you ask for `upper_bound=1`, then I think you get what you deserve.  ;-)


our servers don't deserve being trashed by 120 undergrads, running never ending loops, executing seemingly innocent Sage commands. :)

> 
> > I'd say this has either to be re-done, or scrapped...

> 
> So I would definitely like to see this feature kept - in other words, I would like to see the interface stay stable, with changes to the code.  I'd be happy with throwing an exception after some number of attempts.
> 
> I'm taking a break from most Sage work for a few weeks to get caught up on other things, so won't be able to address this immediately.
> 


I've bitten the bullet and hopefully fixed all the shortcomings we discussed, added throwing exceptions, etc. Please review soon. :-)

> Rob

>



---

archive/issue_comments_160127.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:11 dimpase]:\n> I've bitten the bullet and hopefully fixed all the shortcomings we discussed, added throwing exceptions, etc. Please review soon. :-)\n\n\nDima - thanks for biting the bullet!  Long weekend here in the US, and I'm offline for a couple days, but I will get at this very soon.  First-look looks good.\n\nRob",
    "created_at": "2011-09-04T15:13:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11772#issuecomment-160127",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:12'></a>Replying to [comment:11 dimpase]:
> I've bitten the bullet and hopefully fixed all the shortcomings we discussed, added throwing exceptions, etc. Please review soon. :-)


Dima - thanks for biting the bullet!  Long weekend here in the US, and I'm offline for a couple days, but I will get at this very soon.  First-look looks good.

Rob



---

archive/issue_comments_160128.json:
```json
{
    "body": "<a id='comment:13'></a>Apply trac_11772.patch\n\n(for the patchbot). Any movement on this one?",
    "created_at": "2012-03-11T11:36:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11772#issuecomment-160128",
    "user": "https://github.com/loefflerd"
}
```

<a id='comment:13'></a>Apply trac_11772.patch

(for the patchbot). Any movement on this one?



---

archive/issue_comments_160129.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:13 davidloeffler]:\n> Apply trac_11772.patch\n> \n> (for the patchbot). Any movement on this one?\n\n\nIMHO the ball is in Rob's court. Rob?",
    "created_at": "2012-03-11T12:11:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11772#issuecomment-160129",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:14'></a>Replying to [comment:13 davidloeffler]:
> Apply trac_11772.patch
> 
> (for the patchbot). Any movement on this one?


IMHO the ball is in Rob's court. Rob?



---

archive/issue_comments_160130.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-03-11T14:27:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11772#issuecomment-160130",
    "user": "https://github.com/loefflerd"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_160131.json:
```json
{
    "body": "<a id='comment:15'></a>According to the patchbot, the patch does not apply under either current release (4.8) or current dev (5.0.beta7).",
    "created_at": "2012-03-11T14:27:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11772#issuecomment-160131",
    "user": "https://github.com/loefflerd"
}
```

<a id='comment:15'></a>According to the patchbot, the patch does not apply under either current release (4.8) or current dev (5.0.beta7).



---

archive/issue_comments_160132.json:
```json
{
    "body": "<a id='comment:16'></a>Replying to [comment:14 dimpase]:\n> IMHO the ball is in Rob's court. Rob?\n\n\nYes, ball is in my court.  So are lots of other balls.  ;-)\n\nI have not forgotten this one, but for months now have not been in a position to get too into Sage work.  I use this routine all the time, and it never fails me.  That is not an excuse, it should be fixed as Dima has noticed, but it has not been a high-priority item for me.\n\nDavid - thanks for bumping some tickets - I see I have another one to address with Sequence and I think Jeroen bumped another one on some RDF/CDF stuff a few weeks ago.\n\nRob",
    "created_at": "2012-03-11T16:58:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11772#issuecomment-160132",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:16'></a>Replying to [comment:14 dimpase]:
> IMHO the ball is in Rob's court. Rob?


Yes, ball is in my court.  So are lots of other balls.  ;-)

I have not forgotten this one, but for months now have not been in a position to get too into Sage work.  I use this routine all the time, and it never fails me.  That is not an excuse, it should be fixed as Dima has noticed, but it has not been a high-priority item for me.

David - thanks for bumping some tickets - I see I have another one to address with Sequence and I think Jeroen bumped another one on some RDF/CDF stuff a few weeks ago.

Rob



---

archive/issue_comments_160133.json:
```json
{
    "body": "<a id='comment:17'></a>Replying to [comment:16 rbeezer]:\n> Replying to [comment:14 dimpase]:\n> > IMHO the ball is in Rob's court. Rob?\n\n> \n> Yes, ball is in my court.  So are lots of other balls.  ;-)\n> \n> I have not forgotten this one, but for months now have not been in a position to get too into Sage work.  I use this routine all the time, and it never fails me.  That is not an excuse, it should be fixed as Dima has noticed, but it has not been a high-priority item for me.\n> \n\n\nI'll ask a student to rebase. I have negative amount of time available, it seems :)",
    "created_at": "2012-03-11T17:02:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11772#issuecomment-160133",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:17'></a>Replying to [comment:16 rbeezer]:
> Replying to [comment:14 dimpase]:
> > IMHO the ball is in Rob's court. Rob?

> 
> Yes, ball is in my court.  So are lots of other balls.  ;-)
> 
> I have not forgotten this one, but for months now have not been in a position to get too into Sage work.  I use this routine all the time, and it never fails me.  That is not an excuse, it should be fixed as Dima has noticed, but it has not been a high-priority item for me.
> 


I'll ask a student to rebase. I have negative amount of time available, it seems :)



---

archive/issue_comments_160134.json:
```json
{
    "body": "This patch needs work",
    "created_at": "2012-03-12T03:40:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11772#issuecomment-160134",
    "user": "https://github.com/kini"
}
```

This patch needs work



---

archive/issue_comments_160135.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,11 @@\n+The error message of the call to random_matrix(QQ, 4, 8, rank=5) is quite cryptic.\n+It should be easy to check that the rank is greater than min(nrows,ncols) and throw a ValueError with a meaningful message.\n+\n+A patch, which also fixes a similar small fly in random_subspaces_matrix, is attached.\n+The cumulative patch incorporates more doctests, the fix for rank==1 problem described in the comments, and puts a cup on the number of iterations in various while loops, so that they fail meaningfully.\n+\n+**Apply**:\n+1.  [attachment:trac_11772.2.patch]\n \n \n Comment: 1\n``````\n",
    "created_at": "2012-03-12T03:43:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11772#issuecomment-160135",
    "user": "https://github.com/kini"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,11 @@
+The error message of the call to random_matrix(QQ, 4, 8, rank=5) is quite cryptic.
+It should be easy to check that the rank is greater than min(nrows,ncols) and throw a ValueError with a meaningful message.
+
+A patch, which also fixes a similar small fly in random_subspaces_matrix, is attached.
+The cumulative patch incorporates more doctests, the fix for rank==1 problem described in the comments, and puts a cup on the number of iterations in various while loops, so that they fail meaningfully.
+
+**Apply**:
+1.  [attachment:trac_11772.2.patch]
 
 
 Comment: 1
``````




---

archive/issue_comments_160136.json:
```json
{
    "body": "<a id='comment:18'></a>Attachment [trac_11772.2.patch](tarball://root/attachments/some-uuid/ticket11772/trac_11772.2.patch) by @kini created at 2012-03-12 03:43:46\n\nI couldn't find any revision onto which the patch actually applied, so I tried to rebase it manually. Please check for errors.\n\nAlso, Dima, please remove your print statements and commented out lines... the patch also needs some work in the PEP-8 department, but then again the whole file does, it looks like. I fixed what I could in the function Rob touched.",
    "created_at": "2012-03-12T03:43:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11772#issuecomment-160136",
    "user": "https://github.com/kini"
}
```

<a id='comment:18'></a>Attachment [trac_11772.2.patch](tarball://root/attachments/some-uuid/ticket11772/trac_11772.2.patch) by @kini created at 2012-03-12 03:43:46

I couldn't find any revision onto which the patch actually applied, so I tried to rebase it manually. Please check for errors.

Also, Dima, please remove your print statements and commented out lines... the patch also needs some work in the PEP-8 department, but then again the whole file does, it looks like. I fixed what I could in the function Rob touched.



---

archive/issue_events_030963.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11772",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11772#event-30963"
}
```



---

archive/issue_comments_160137.json:
```json
{
    "body": "Attachment [trac_11772.3.patch](tarball://root/attachments/some-uuid/ticket11772/trac_11772.3.patch) by @rbeezer created at 2013-08-21 22:02:29\n\nRebase on 5.11",
    "created_at": "2013-08-21T22:02:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11772#issuecomment-160137",
    "user": "https://github.com/rbeezer"
}
```

Attachment [trac_11772.3.patch](tarball://root/attachments/some-uuid/ticket11772/trac_11772.3.patch) by @rbeezer created at 2013-08-21 22:02:29

Rebase on 5.11



---

archive/issue_comments_160138.json:
```json
{
    "body": "<a id='comment:20'></a>I've made a trivial rebase for Sage 5.11 of the \".2\" consolidated patch, now named \".3\".\n\nI put Dima's name on it, since all of the significant code contributions are his.  \n\nI am working on a review and will definitely add a reviewer patch.",
    "created_at": "2013-08-21T22:04:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11772#issuecomment-160138",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:20'></a>I've made a trivial rebase for Sage 5.11 of the ".2" consolidated patch, now named ".3".

I put Dima's name on it, since all of the significant code contributions are his.  

I am working on a review and will definitely add a reviewer patch.



---

archive/issue_comments_160139.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,11 @@\n+The error message of the call to random_matrix(QQ, 4, 8, rank=5) is quite cryptic.\n+It should be easy to check that the rank is greater than min(nrows,ncols) and throw a ValueError with a meaningful message.\n+\n+A patch, which also fixes a similar small fly in random_subspaces_matrix, is attached.\n+The cumulative patch incorporates more doctests, the fix for rank==1 problem described in the comments, and puts a cup on the number of iterations in various while loops, so that they fail meaningfully.\n+\n+**Apply**:\n+1.  [attachment:trac_11772.3.patch]\n \n \n Comment: 1\n``````\n",
    "created_at": "2013-08-21T22:05:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11772#issuecomment-160139",
    "user": "https://github.com/rbeezer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,11 @@
+The error message of the call to random_matrix(QQ, 4, 8, rank=5) is quite cryptic.
+It should be easy to check that the rank is greater than min(nrows,ncols) and throw a ValueError with a meaningful message.
+
+A patch, which also fixes a similar small fly in random_subspaces_matrix, is attached.
+The cumulative patch incorporates more doctests, the fix for rank==1 problem described in the comments, and puts a cup on the number of iterations in various while loops, so that they fail meaningfully.
+
+**Apply**:
+1.  [attachment:trac_11772.3.patch]
 
 
 Comment: 1
``````




---

archive/issue_comments_160140.json:
```json
{
    "body": "Attachment [trac_11772-reviewer.patch](tarball://root/attachments/some-uuid/ticket11772/trac_11772-reviewer.patch) by @rbeezer created at 2013-08-21 23:23:51\n\nApply on top of \".3\" patch",
    "created_at": "2013-08-21T23:23:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11772#issuecomment-160140",
    "user": "https://github.com/rbeezer"
}
```

Attachment [trac_11772-reviewer.patch](tarball://root/attachments/some-uuid/ticket11772/trac_11772-reviewer.patch) by @rbeezer created at 2013-08-21 23:23:51

Apply on top of ".3" patch



---

archive/issue_comments_160141.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-08-21T23:26:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11772#issuecomment-160141",
    "user": "https://github.com/rbeezer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_160142.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,12 @@\n+The error message of the call to random_matrix(QQ, 4, 8, rank=5) is quite cryptic.\n+It should be easy to check that the rank is greater than min(nrows,ncols) and throw a ValueError with a meaningful message.\n+\n+A patch, which also fixes a similar small fly in random_subspaces_matrix, is attached.\n+The cumulative patch incorporates more doctests, the fix for rank==1 problem described in the comments, and puts a cup on the number of iterations in various while loops, so that they fail meaningfully.\n+\n+**Apply**:\n+1.  [attachment:trac_11772.3.patch]\n+2.  [attachment:trac_11772-reviewer.patch]\n \n \n Comment: 1\n``````\n",
    "created_at": "2013-08-21T23:26:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11772#issuecomment-160142",
    "user": "https://github.com/rbeezer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,12 @@
+The error message of the call to random_matrix(QQ, 4, 8, rank=5) is quite cryptic.
+It should be easy to check that the rank is greater than min(nrows,ncols) and throw a ValueError with a meaningful message.
+
+A patch, which also fixes a similar small fly in random_subspaces_matrix, is attached.
+The cumulative patch incorporates more doctests, the fix for rank==1 problem described in the comments, and puts a cup on the number of iterations in various while loops, so that they fail meaningfully.
+
+**Apply**:
+1.  [attachment:trac_11772.3.patch]
+2.  [attachment:trac_11772-reviewer.patch]
 
 
 Comment: 1
``````




---

archive/issue_comments_160143.json:
```json
{
    "body": "<a id='comment:22'></a>Reviewer patch:\n\n1.  Removed debugging print statements.\n2.  Code for sanity tests on inputs from the very first \"v2\" patch were missing, so the corresponding doctests were failing.  Code has been restored, doctests function properly now.\n3.  Passed `max_tries` through the unimodular routine, since it has an `upper_bound` keyword.\n\nWeBWorK homework system can now query the Sage cell server.  The `random_matrix()` function is very appealing, but it absolutely must return every time or some poor undergrad will just get a system hang rather than a homework exercise.  So I have added three prominent warnings about requesting upper bounds.\n\nI need to fix the randomness in these functions, see #10122.  GSL is to blame, and I have a working fix.  Then the doctests will need a total overhaul, so I'm tempted to do some other things here (document `max_tries`) but want that to wait.\n\nI'm fine with Dima's code contributions.\n\nDima - I apologize for sitting on this for such a very long time.  If you like my changes/contributions, would you flip this to positive review?  If so, then I will build more onto it on other tickets.\n\nRob",
    "created_at": "2013-08-21T23:26:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11772#issuecomment-160143",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:22'></a>Reviewer patch:

1.  Removed debugging print statements.
2.  Code for sanity tests on inputs from the very first "v2" patch were missing, so the corresponding doctests were failing.  Code has been restored, doctests function properly now.
3.  Passed `max_tries` through the unimodular routine, since it has an `upper_bound` keyword.

WeBWorK homework system can now query the Sage cell server.  The `random_matrix()` function is very appealing, but it absolutely must return every time or some poor undergrad will just get a system hang rather than a homework exercise.  So I have added three prominent warnings about requesting upper bounds.

I need to fix the randomness in these functions, see #10122.  GSL is to blame, and I have a working fix.  Then the doctests will need a total overhaul, so I'm tempted to do some other things here (document `max_tries`) but want that to wait.

I'm fine with Dima's code contributions.

Dima - I apologize for sitting on this for such a very long time.  If you like my changes/contributions, would you flip this to positive review?  If so, then I will build more onto it on other tickets.

Rob



---

archive/issue_comments_160144.json:
```json
{
    "body": "Changing author from \"\" to \"Dmitrii Pasechnik\"",
    "created_at": "2013-08-21T23:26:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11772#issuecomment-160144",
    "user": "https://github.com/rbeezer"
}
```

Changing author from "" to "Dmitrii Pasechnik"



---

archive/issue_comments_160145.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-08-22T04:02:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11772#issuecomment-160145",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_160146.json:
```json
{
    "body": "<a id='comment:24'></a>Thanks, Dima!  You are much more conscientious than me.  ;-)\n\nI'll try to get my GSL-random-seed patch up sometime tomorrow night.  Busy all day tomorrow.\n\nRob",
    "created_at": "2013-08-22T05:13:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11772#issuecomment-160146",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:24'></a>Thanks, Dima!  You are much more conscientious than me.  ;-)

I'll try to get my GSL-random-seed patch up sometime tomorrow night.  Busy all day tomorrow.

Rob



---

archive/issue_comments_160147.json:
```json
{
    "body": "<a id='comment:25'></a>Replying to [comment:24 rbeezer]:\n> Thanks, Dima!  You are much more conscientious than me.  ;-)\n\nno, if you ask me to referee a paper, I might sit on it for a year easily...\n\nGood that this patch didn't bitrot completely :\u2013)\n\nDima",
    "created_at": "2013-08-22T06:00:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11772#issuecomment-160147",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:25'></a>Replying to [comment:24 rbeezer]:
> Thanks, Dima!  You are much more conscientious than me.  ;-)

no, if you ask me to referee a paper, I might sit on it for a year easily...

Good that this patch didn't bitrot completely :–)

Dima



---

archive/issue_events_030964.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-28T06:51:59Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11772",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11772#event-30964"
}
```



---

archive/issue_comments_160148.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-08-28T06:51:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11772#issuecomment-160148",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_160149.json:
```json
{
    "body": "Changing merged from \"\" to \"sage-5.12.beta4\"",
    "created_at": "2013-08-28T06:51:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11772",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11772#issuecomment-160149",
    "user": "https://github.com/jdemeyer"
}
```

Changing merged from "" to "sage-5.12.beta4"
