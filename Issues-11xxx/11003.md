# Issue 11003: Improve support for lazy_import inside classes

archive/issues_010916.json:
```json
{
    "body": "Currently, one can do:\n\n```\n    sage: class foo(object):\n    ...       bar = LazyImport('sage.bar', 'bar')\n    sage: foo.bar\n    bar\n```\n\nand this works (assuming sage.bar.bar exists of course). As a\nsyntactic sugar, it would be nice to have lazy_import work as well, if\npossible with the automatic back-insertion of the object into the\nclass after the actual import occurred:\n\n```\n    sage: class foo(object):\n    ...       lazy_import('sage.bar', 'bar')\n    sage: type(foo.bar)\n    <type 'sage.misc.lazy_import.LazyImport'>\n    sage: foo.bar\n    bar\n    sage: type(foo.bar)\n    <type 'bar_type>\n```\n\n**Apply:** [attachment:trac_11003-folded.patch]\n\n**Assignee:** @jasongrout\n\n**CC:**  @rishikesha @jasongrout @rlmill rbradshaw\n\n**Keywords:** Cernay2012\n\n**Author:** Mike Hansen\n\n**Reviewer:** Nicolas M. Thi\u00e9ry, Florent Hivert\n\n**Merged:** sage-5.0.beta4\n\nIssue created by migration from https://trac.sagemath.org/ticket/11003\n\n",
    "closed_at": "2012-02-14T14:19:57Z",
    "created_at": "2011-03-23T23:05:02Z",
    "labels": [
        "component: misc",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.0",
    "title": "Improve support for lazy_import inside classes",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/11003",
    "user": "https://github.com/nthiery"
}
```
Currently, one can do:

```
    sage: class foo(object):
    ...       bar = LazyImport('sage.bar', 'bar')
    sage: foo.bar
    bar
```

and this works (assuming sage.bar.bar exists of course). As a
syntactic sugar, it would be nice to have lazy_import work as well, if
possible with the automatic back-insertion of the object into the
class after the actual import occurred:

```
    sage: class foo(object):
    ...       lazy_import('sage.bar', 'bar')
    sage: type(foo.bar)
    <type 'sage.misc.lazy_import.LazyImport'>
    sage: foo.bar
    bar
    sage: type(foo.bar)
    <type 'bar_type>
```

**Apply:** [attachment:trac_11003-folded.patch]

**Assignee:** @jasongrout

**CC:**  @rishikesha @jasongrout @rlmill rbradshaw

**Keywords:** Cernay2012

**Author:** Mike Hansen

**Reviewer:** Nicolas M. Thiéry, Florent Hivert

**Merged:** sage-5.0.beta4

Issue created by migration from https://trac.sagemath.org/ticket/11003





---

archive/issue_comments_110414.json:
```json
{
    "body": "<a id='comment:1'></a>\nI think this should be good, but the only thing I have questions about is the switch from `f_globals` to `f_locals`.",
    "created_at": "2011-06-13T07:36:51Z",
    "issue": "https://github.com/sagemath/sage/issues/11003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11003#issuecomment-110414",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:1'></a>
I think this should be good, but the only thing I have questions about is the switch from `f_globals` to `f_locals`.



---

archive/issue_comments_110415.json:
```json
{
    "body": "**Author:** Mike Hansen",
    "created_at": "2011-06-13T07:36:51Z",
    "issue": "https://github.com/sagemath/sage/issues/11003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11003#issuecomment-110415",
    "user": "https://github.com/mwhansen"
}
```

**Author:** Mike Hansen



---

archive/issue_events_085957.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2011-06-13T07:36:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11003",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11003#event-85957"
}
```



---

archive/issue_comments_110416.json:
```json
{
    "body": "<a id='comment:2'></a>\nThanks Mike!\n\nWhat's the rationale for not always walking through the whole mro?\n\nI would suggest to replace ``walk_owner_namespaces=False* by ``owner=None*.\n\nOtherwise, this looks overall looks good. I have no clue at this point about the f_globals vs f_locals point though.\n\nCheers,\n                       Nicolas",
    "created_at": "2011-06-13T10:23:48Z",
    "issue": "https://github.com/sagemath/sage/issues/11003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11003#issuecomment-110416",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:2'></a>
Thanks Mike!

What's the rationale for not always walking through the whole mro?

I would suggest to replace ``walk_owner_namespaces=False* by ``owner=None*.

Otherwise, this looks overall looks good. I have no clue at this point about the f_globals vs f_locals point though.

Cheers,
                       Nicolas



---

archive/issue_events_085958.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2011-06-13T10:23:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11003",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11003#event-85958"
}
```



---

archive/issue_events_085959.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2011-06-13T10:23:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11003",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11003#event-85959"
}
```



---

archive/issue_comments_110417.json:
```json
{
    "body": "<a id='comment:3'></a>\nReplying to [nthiery](#comment%3A2):\n> What's the rationale for not always walking through the whole mro?\n\n\nDo you mean the break?",
    "created_at": "2011-06-13T10:35:35Z",
    "issue": "https://github.com/sagemath/sage/issues/11003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11003#issuecomment-110417",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:3'></a>
Replying to [nthiery](#comment%3A2):
> What's the rationale for not always walking through the whole mro?


Do you mean the break?



---

archive/issue_comments_110418.json:
```json
{
    "body": "<a id='comment:4'></a>\nReplying to [mhansen](#comment%3A3):\n> Replying to [nthiery](#comment%3A2):\n> > What's the rationale for not always walking through the whole mro?\n\n> \n> Do you mean the break?\n\n\nSorry, I should have been more explicit. It's about the using `owner.__bases__' rather than ``owner.__mro__''.\n\nBy the way, what about using ``owner.mro()'' to respect encapsulation? Speed is not an issue here, right?",
    "created_at": "2011-06-13T11:04:19Z",
    "issue": "https://github.com/sagemath/sage/issues/11003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11003#issuecomment-110418",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:4'></a>
Replying to [mhansen](#comment%3A3):
> Replying to [nthiery](#comment%3A2):
> > What's the rationale for not always walking through the whole mro?

> 
> Do you mean the break?


Sorry, I should have been more explicit. It's about the using `owner.__bases__' rather than ``owner.__mro__''.

By the way, what about using ``owner.mro()'' to respect encapsulation? Speed is not an issue here, right?



---

archive/issue_events_085960.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2011-06-13T11:43:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11003",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11003#event-85960"
}
```



---

archive/issue_events_085961.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2011-06-13T11:43:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11003",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11003#event-85961"
}
```



---

archive/issue_comments_110419.json:
```json
{
    "body": "<a id='comment:5'></a>\nI've updated the patch to fix these two issues.",
    "created_at": "2011-06-13T11:43:43Z",
    "issue": "https://github.com/sagemath/sage/issues/11003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11003#issuecomment-110419",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:5'></a>
I've updated the patch to fix these two issues.



---

archive/issue_events_085962.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2011-06-13T14:45:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11003",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11003#event-85962"
}
```



---

archive/issue_events_085963.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2011-06-13T14:45:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11003",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11003#event-85963"
}
```



---

archive/issue_comments_110420.json:
```json
{
    "body": "<a id='comment:6'></a>\nThanks! \n\nIt seems the builtin inspect.mro should do the job of supporting both old style and new style classes. Also, just for test-completeness, could you add a test with a lazy imported method in a super class of a class?\n\nCheers,\n             Nicolas",
    "created_at": "2011-06-13T14:45:23Z",
    "issue": "https://github.com/sagemath/sage/issues/11003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11003#issuecomment-110420",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:6'></a>
Thanks! 

It seems the builtin inspect.mro should do the job of supporting both old style and new style classes. Also, just for test-completeness, could you add a test with a lazy imported method in a super class of a class?

Cheers,
             Nicolas



---

archive/attachments_014455.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_11003.patch",
    "asset_url": "tarball://root/attachments/ticket11003/trac_11003.patch",
    "created_at": "2011-06-13T15:20:23Z",
    "issue": "https://github.com/sagemath/sage/issues/11003",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket11003/trac_11003.patch",
    "user": "https://github.com/mwhansen"
}
```



---

archive/issue_comments_110421.json:
```json
{
    "body": "Attachment [trac_11003.patch](https://github.com/sagemath/sage/files/ticket11003/trac_11003.patch) by @mwhansen created at 2011-06-13 15:20:23",
    "created_at": "2011-06-13T15:20:23Z",
    "issue": "https://github.com/sagemath/sage/issues/11003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11003#issuecomment-110421",
    "user": "https://github.com/mwhansen"
}
```

Attachment [trac_11003.patch](https://github.com/sagemath/sage/files/ticket11003/trac_11003.patch) by @mwhansen created at 2011-06-13 15:20:23



---

archive/issue_comments_110422.json:
```json
{
    "body": "<a id='comment:7'></a>\n`inspect.getmro()` was what I was looking for and couldn't find last night.  Thanks.",
    "created_at": "2011-06-13T15:21:01Z",
    "issue": "https://github.com/sagemath/sage/issues/11003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11003#issuecomment-110422",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:7'></a>
`inspect.getmro()` was what I was looking for and couldn't find last night.  Thanks.



---

archive/issue_events_085964.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2011-06-13T15:21:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11003",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11003#event-85964"
}
```



---

archive/issue_events_085965.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2011-06-13T15:21:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11003",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11003#event-85965"
}
```



---

archive/issue_comments_110423.json:
```json
{
    "body": "<a id='comment:8'></a>\nHi Mike!\n\nI just pushed a little reviewer's patch on the Sage-Combinat queue. If you are happy with it, please fold, post, and set a positive review on my behalf.\n\nCheers,\n               Nicolas",
    "created_at": "2011-06-13T17:51:42Z",
    "issue": "https://github.com/sagemath/sage/issues/11003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11003#issuecomment-110423",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:8'></a>
Hi Mike!

I just pushed a little reviewer's patch on the Sage-Combinat queue. If you are happy with it, please fold, post, and set a positive review on my behalf.

Cheers,
               Nicolas



---

archive/issue_comments_110424.json:
```json
{
    "body": "**Reviewer:** Nicolas M. Thi\u00e9ry",
    "created_at": "2011-06-13T17:51:42Z",
    "issue": "https://github.com/sagemath/sage/issues/11003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11003#issuecomment-110424",
    "user": "https://github.com/nthiery"
}
```

**Reviewer:** Nicolas M. Thiéry



---

archive/issue_comments_110425.json:
```json
{
    "body": "<a id='comment:9'></a>\nRobert Bradshaw is here, and we're going to discuss the `f_globals` to `f_locals` change.",
    "created_at": "2011-06-13T17:54:21Z",
    "issue": "https://github.com/sagemath/sage/issues/11003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11003#issuecomment-110425",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:9'></a>
Robert Bradshaw is here, and we're going to discuss the `f_globals` to `f_locals` change.



---

archive/issue_comments_110426.json:
```json
{
    "body": "<a id='comment:10'></a>\nHi!\n\nReplying to [mhansen](#comment%3A9):\n> Robert Bradshaw is here, and we're going to discuss the `f_globals` to `f_locals` change.\n\n\nWhat was the result of this discussion?\n\nShall we get this patch in?\n\nCheers,\n                          Nicolas",
    "created_at": "2012-01-27T16:29:23Z",
    "issue": "https://github.com/sagemath/sage/issues/11003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11003#issuecomment-110426",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:10'></a>
Hi!

Replying to [mhansen](#comment%3A9):
> Robert Bradshaw is here, and we're going to discuss the `f_globals` to `f_locals` change.


What was the result of this discussion?

Shall we get this patch in?

Cheers,
                          Nicolas



---

archive/attachments_014456.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_11003-folded.patch",
    "asset_url": "tarball://root/attachments/ticket11003/trac_11003-folded.patch",
    "created_at": "2012-02-06T15:02:33Z",
    "issue": "https://github.com/sagemath/sage/issues/11003",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket11003/trac_11003-folded.patch",
    "user": "https://github.com/hivert"
}
```



---

archive/issue_comments_110427.json:
```json
{
    "body": "Attachment [trac_11003-folded.patch](https://github.com/sagemath/sage/files/ticket11003/trac_11003-folded.patch) by @hivert created at 2012-02-06 15:02:33",
    "created_at": "2012-02-06T15:02:33Z",
    "issue": "https://github.com/sagemath/sage/issues/11003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11003#issuecomment-110427",
    "user": "https://github.com/hivert"
}
```

Attachment [trac_11003-folded.patch](https://github.com/sagemath/sage/files/ticket11003/trac_11003-folded.patch) by @hivert created at 2012-02-06 15:02:33



---

archive/issue_events_085966.json:
```json
{
    "actor": "https://github.com/hivert",
    "created_at": "2012-02-06T15:03:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11003",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11003#event-85966"
}
```



---

archive/issue_events_085967.json:
```json
{
    "actor": "https://github.com/hivert",
    "created_at": "2012-02-06T15:03:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11003",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11003#event-85967"
}
```



---

archive/issue_comments_110428.json:
```json
{
    "body": "<a id='comment:11'></a>\n> I just pushed a little reviewer's patch on the Sage-Combinat queue. If you are happy with it, please fold, post, and set a positive review on my behalf.\n\n\nI'm ok with the review patch. => Positive review.",
    "created_at": "2012-02-06T15:03:59Z",
    "issue": "https://github.com/sagemath/sage/issues/11003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11003#issuecomment-110428",
    "user": "https://github.com/hivert"
}
```

<a id='comment:11'></a>
> I just pushed a little reviewer's patch on the Sage-Combinat queue. If you are happy with it, please fold, post, and set a positive review on my behalf.


I'm ok with the review patch. => Positive review.



---

archive/issue_comments_110429.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -23,3 +23,4 @@\n     <type 'bar_type>\n ```\n \n+**Apply:** [attachment:trac_11003-folded.patch]\n``````\n",
    "created_at": "2012-02-06T15:05:48Z",
    "issue": "https://github.com/sagemath/sage/issues/11003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11003#issuecomment-110429",
    "user": "https://github.com/hivert"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -23,3 +23,4 @@
     <type 'bar_type>
 ```
 
+**Apply:** [attachment:trac_11003-folded.patch]
``````




---

archive/issue_comments_110430.json:
```json
{
    "body": "**Changing reviewer** from \"Nicolas M. Thi\u00e9ry\" to \"Nicolas M. Thi\u00e9ry, Florent Hivert\".",
    "created_at": "2012-02-06T15:05:48Z",
    "issue": "https://github.com/sagemath/sage/issues/11003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11003#issuecomment-110430",
    "user": "https://github.com/hivert"
}
```

**Changing reviewer** from "Nicolas M. Thiéry" to "Nicolas M. Thiéry, Florent Hivert".



---

archive/issue_events_085968.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2012-02-08T01:23:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11003",
    "milestone": "sage-5.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11003#event-85968"
}
```



---

archive/issue_comments_110431.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"Cernay2012\".",
    "created_at": "2012-02-08T01:23:21Z",
    "issue": "https://github.com/sagemath/sage/issues/11003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11003#issuecomment-110431",
    "user": "https://github.com/nthiery"
}
```

**Changing keywords** from "" to "Cernay2012".



---

archive/issue_events_085969.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-02-14T14:19:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11003",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11003#event-85969"
}
```



---

archive/issue_events_085970.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-02-14T14:19:57Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/11003",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11003#event-85970"
}
```



---

archive/issue_comments_110432.json:
```json
{
    "body": "**Merged:** sage-5.0.beta4",
    "created_at": "2012-02-14T14:19:57Z",
    "issue": "https://github.com/sagemath/sage/issues/11003",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11003#issuecomment-110432",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.0.beta4
