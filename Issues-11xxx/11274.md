# Issue 11274: Cholesky matrix decomposition breaks over the rationals

archive/issues_011102.json:
```json
{
    "body": "The matrix E is clearly symmetric, and by looking at its eigenvalues and the determinants of principal submatrices it is clearly positive definite.  \n\n```\nsage: E = matrix(QQ, [[2, 1], [1, 1]])\nsage: E.is_symmetric()\nTrue\nsage: E.eigenvalues()\n[0.3819660112501051?, 2.618033988749895?]\nsage: E.det()\n1\nsage: E.cholesky_decomposition()\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n\n<snip>\n\nValueError: The input matrix was not symmetric and positive definite\n```\n\nAt best the error message is misleading.  \n\nThe try/except block needs to be more careful.  It should be checking if square roots are contained in the base ring, or it should first convert to an algebraically closed field, or something like that.\n\nIn this example, the error is raised because the square root of a rational is not again a rational, when I think the test should be if the argument to the square root is negative.\n\nPerhaps for `QQ`, the base ring should be promoted to the Real Algebraic Field, `AA`.\n\n**Depends**:  #12966, #13018\n\n**Apply**:\n1. [attachment:trac_11274-cache-indefinite-factors-v1.patch]\n2. [attachment:trac_11274-exact-cholesky-v1.patch]\n3. [attachment:trac_11274-exact-cholesky-two-by-two.patch]\n\n**Assignee:** @jasongrout, @williamstein\n\n**CC:**  @dandrake @novoselt\n\n**Keywords:** sd40.5\n\n**Reviewer:** Dan Drake\n\n**Author:** Rob Beezer\n\n**Merged:** sage-5.1.beta5\n\n**Dependencies:** #12966, #13018\n\nIssue created by migration from https://trac.sagemath.org/ticket/11274\n\n",
    "closed_at": "2012-06-18T10:23:00Z",
    "created_at": "2011-04-28T23:47:56Z",
    "labels": [
        "component: linear algebra",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.1",
    "title": "Cholesky matrix decomposition breaks over the rationals",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11274",
    "user": "https://github.com/rbeezer"
}
```
The matrix E is clearly symmetric, and by looking at its eigenvalues and the determinants of principal submatrices it is clearly positive definite.  

```
sage: E = matrix(QQ, [[2, 1], [1, 1]])
sage: E.is_symmetric()
True
sage: E.eigenvalues()
[0.3819660112501051?, 2.618033988749895?]
sage: E.det()
1
sage: E.cholesky_decomposition()
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)

<snip>

ValueError: The input matrix was not symmetric and positive definite
```

At best the error message is misleading.  

The try/except block needs to be more careful.  It should be checking if square roots are contained in the base ring, or it should first convert to an algebraically closed field, or something like that.

In this example, the error is raised because the square root of a rational is not again a rational, when I think the test should be if the argument to the square root is negative.

Perhaps for `QQ`, the base ring should be promoted to the Real Algebraic Field, `AA`.

**Depends**:  #12966, #13018

**Apply**:
1. [attachment:trac_11274-cache-indefinite-factors-v1.patch]
2. [attachment:trac_11274-exact-cholesky-v1.patch]
3. [attachment:trac_11274-exact-cholesky-two-by-two.patch]

**Assignee:** @jasongrout, @williamstein

**CC:**  @dandrake @novoselt

**Keywords:** sd40.5

**Reviewer:** Dan Drake

**Author:** Rob Beezer

**Merged:** sage-5.1.beta5

**Dependencies:** #12966, #13018

Issue created by migration from https://trac.sagemath.org/ticket/11274





---

archive/attachments_014772.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_11274-exact-cholesky-draft1.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket11274/trac_11274-exact-cholesky-draft1.patch",
    "created_at": "2012-05-27T03:48:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11274",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/rbeezer"
}
```



---

archive/issue_comments_115106.json:
```json
{
    "body": "Safe-keeping",
    "created_at": "2012-05-27T03:48:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11274#issuecomment-115106",
    "user": "https://github.com/rbeezer"
}
```

Safe-keeping



---

archive/issue_comments_115107.json:
```json
{
    "body": "**Author:** Rob Beezer",
    "created_at": "2012-05-27T03:54:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11274#issuecomment-115107",
    "user": "https://github.com/rbeezer"
}
```

**Author:** Rob Beezer



---

archive/issue_comments_115108.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -24,3 +24,5 @@\n In this example, the error is raised because the square root of a rational is not again a rational, when I think the test should be if the argument to the square root is negative.\n \n Perhaps for `QQ`, the base ring should be promoted to the Real Algebraic Field, `AA`.\n+\n+**Depends**:  #12966, #13018\n``````\n",
    "created_at": "2012-05-27T03:54:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11274#issuecomment-115108",
    "user": "https://github.com/rbeezer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -24,3 +24,5 @@
 In this example, the error is raised because the square root of a rational is not again a rational, when I think the test should be if the argument to the square root is negative.
 
 Perhaps for `QQ`, the base ring should be promoted to the Real Algebraic Field, `AA`.
+
+**Depends**:  #12966, #13018
``````




---

archive/issue_comments_115109.json:
```json
{
    "body": "<a id='comment:1'></a>\n*  Caching indefinite factorization seems to be ready to go.\n*  Exact Cholesky decomposition is working - tested on simple examples, but needs documentation.\n*  Cholesky overall needs a brutal refactoring, the existing situation is a **total mess.**",
    "created_at": "2012-05-27T03:54:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11274#issuecomment-115109",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:1'></a>
*  Caching indefinite factorization seems to be ready to go.
*  Exact Cholesky decomposition is working - tested on simple examples, but needs documentation.
*  Cholesky overall needs a brutal refactoring, the existing situation is a **total mess.**



---

archive/issue_comments_115110.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"sd40.5\".",
    "created_at": "2012-05-27T03:54:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11274#issuecomment-115110",
    "user": "https://github.com/rbeezer"
}
```

**Changing keywords** from "" to "sd40.5".



---

archive/issue_comments_115111.json:
```json
{
    "body": "**Dependencies:** #12966, #13018",
    "created_at": "2012-05-27T03:54:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11274#issuecomment-115111",
    "user": "https://github.com/rbeezer"
}
```

**Dependencies:** #12966, #13018



---

archive/issue_comments_115112.json:
```json
{
    "body": "<a id='comment:2'></a>\nPositive review to attachment:trac_11274-cache-indefinite-factors-v1.patch.",
    "created_at": "2012-05-27T05:43:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11274#issuecomment-115112",
    "user": "https://github.com/dandrake"
}
```

<a id='comment:2'></a>
Positive review to attachment:trac_11274-cache-indefinite-factors-v1.patch.



---

archive/attachments_014773.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_11274-exact-cholesky-v1.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket11274/trac_11274-exact-cholesky-v1.patch",
    "created_at": "2012-05-27T22:32:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11274",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/rbeezer"
}
```



---

archive/issue_comments_115113.json:
```json
{
    "body": "<a id='comment:3'></a>\n\"v1\" patch implements Cholesky decomposition for matrices over exact rings, based on the indefinite factorization routines.\n\nThis is named `cholesky()` in preparation for its un-deprecation.  A **total cleanup** of the **total mess** will be the next task/ticket.",
    "created_at": "2012-05-27T22:32:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11274#issuecomment-115113",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:3'></a>
"v1" patch implements Cholesky decomposition for matrices over exact rings, based on the indefinite factorization routines.

This is named `cholesky()` in preparation for its un-deprecation.  A **total cleanup** of the **total mess** will be the next task/ticket.



---

archive/issue_comments_115114.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -26,3 +26,7 @@\n Perhaps for `QQ`, the base ring should be promoted to the Real Algebraic Field, `AA`.\n \n **Depends**:  #12966, #13018\n+\n+**Apply**:\n+1. [attachment:trac_11274-cache-indefinite-factors-v1.patch]\n+2. [attachment:trac_11274-exact-cholesky-v1.patch]\n``````\n",
    "created_at": "2012-05-27T22:32:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11274#issuecomment-115114",
    "user": "https://github.com/rbeezer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -26,3 +26,7 @@
 Perhaps for `QQ`, the base ring should be promoted to the Real Algebraic Field, `AA`.
 
 **Depends**:  #12966, #13018
+
+**Apply**:
+1. [attachment:trac_11274-cache-indefinite-factors-v1.patch]
+2. [attachment:trac_11274-exact-cholesky-v1.patch]
``````




---

archive/issue_events_088283.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2012-05-27T22:32:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/11274",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11274#event-88283"
}
```



---

archive/issue_comments_115115.json:
```json
{
    "body": "<a id='comment:4'></a>\nThe exact Cholesky decomposition looks good. The only thing we might want is to add in the example from the description of the ticket (which now works) but the documentation is quite thorough, so it seems very unlikely that the little 2x2 case will fail with the tests we have.\n\nRuntime for random matrices over the rationals is fine; 100x100 matrices finish in about 6.2 seconds on my machine.\n\nPositive review to trac_11274-exact-cholesky-v1.patch.\n\nApply trac_11274-cache-indefinite-factors-v1.patch and \ntrac_11274-exact-cholesky-v1.patch",
    "created_at": "2012-05-28T17:46:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11274#issuecomment-115115",
    "user": "https://github.com/dandrake"
}
```

<a id='comment:4'></a>
The exact Cholesky decomposition looks good. The only thing we might want is to add in the example from the description of the ticket (which now works) but the documentation is quite thorough, so it seems very unlikely that the little 2x2 case will fail with the tests we have.

Runtime for random matrices over the rationals is fine; 100x100 matrices finish in about 6.2 seconds on my machine.

Positive review to trac_11274-exact-cholesky-v1.patch.

Apply trac_11274-cache-indefinite-factors-v1.patch and 
trac_11274-exact-cholesky-v1.patch



---

archive/issue_events_088284.json:
```json
{
    "actor": "https://github.com/dandrake",
    "created_at": "2012-05-28T17:46:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/11274",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11274#event-88284"
}
```



---

archive/issue_events_088285.json:
```json
{
    "actor": "https://github.com/dandrake",
    "created_at": "2012-05-28T17:46:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/11274",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11274#event-88285"
}
```



---

archive/issue_comments_115116.json:
```json
{
    "body": "**Reviewer:** Dan Drake",
    "created_at": "2012-05-28T17:46:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11274#issuecomment-115116",
    "user": "https://github.com/dandrake"
}
```

**Reviewer:** Dan Drake



---

archive/issue_events_088286.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2012-05-28T19:26:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/11274",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11274#event-88286"
}
```



---

archive/issue_events_088287.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2012-05-28T19:26:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/11274",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11274#event-88287"
}
```



---

archive/attachments_014774.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_11274-exact-cholesky-two-by-two.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket11274/trac_11274-exact-cholesky-two-by-two.patch",
    "created_at": "2012-05-28T19:26:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11274",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/rbeezer"
}
```



---

archive/issue_comments_115117.json:
```json
{
    "body": "<a id='comment:5'></a>\n\"two-by-two\" patch adds the motivational 2 x 2 example and fixed three doctest formatting mistakes.",
    "created_at": "2012-05-28T19:26:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11274#issuecomment-115117",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:5'></a>
"two-by-two" patch adds the motivational 2 x 2 example and fixed three doctest formatting mistakes.



---

archive/issue_events_088288.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2012-05-28T19:28:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/11274",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11274#event-88288"
}
```



---

archive/issue_events_088289.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2012-05-28T19:28:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/11274",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11274#event-88289"
}
```



---

archive/issue_comments_115118.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -30,3 +30,4 @@\n **Apply**:\n 1. [attachment:trac_11274-cache-indefinite-factors-v1.patch]\n 2. [attachment:trac_11274-exact-cholesky-v1.patch]\n+3. [attachment:trac_11274-exact-cholesky-two-by-two.patch]\n``````\n",
    "created_at": "2012-05-28T19:28:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11274#issuecomment-115118",
    "user": "https://github.com/rbeezer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -30,3 +30,4 @@
 **Apply**:
 1. [attachment:trac_11274-cache-indefinite-factors-v1.patch]
 2. [attachment:trac_11274-exact-cholesky-v1.patch]
+3. [attachment:trac_11274-exact-cholesky-two-by-two.patch]
``````




---

archive/issue_events_088290.json:
```json
{
    "actor": "https://github.com/dandrake",
    "created_at": "2012-05-29T02:08:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/11274",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11274#event-88290"
}
```



---

archive/issue_events_088291.json:
```json
{
    "actor": "https://github.com/dandrake",
    "created_at": "2012-05-29T02:08:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/11274",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11274#event-88291"
}
```



---

archive/issue_comments_115119.json:
```json
{
    "body": "<a id='comment:7'></a>\nThe extra 2x2 example is nice. Positive review.\n\nApply trac_11274-cache-indefinite-factors-v1.patch  trac_11274-exact-cholesky-v1.patch  trac_11274-exact-cholesky-two-by-two.patch",
    "created_at": "2012-05-29T02:08:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11274#issuecomment-115119",
    "user": "https://github.com/dandrake"
}
```

<a id='comment:7'></a>
The extra 2x2 example is nice. Positive review.

Apply trac_11274-cache-indefinite-factors-v1.patch  trac_11274-exact-cholesky-v1.patch  trac_11274-exact-cholesky-two-by-two.patch



---

archive/issue_comments_115120.json:
```json
{
    "body": "**Merged:** sage-5.1.beta5",
    "created_at": "2012-06-18T10:23:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11274#issuecomment-115120",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.1.beta5



---

archive/issue_events_088292.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-06-18T10:23:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/11274",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11274#event-88292"
}
```



---

archive/issue_events_088293.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-06-18T10:23:00Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11274",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11274#event-88293"
}
```
