# Issue 11812: traceback with load and attach of .sage files

archive/issues_011640.json:
```json
{
    "assignees": [
        "https://github.com/jasongrout"
    ],
    "body": "<div id=\"comment:0\"></div>\n\nWhen debugging code that is loaded into or attached to a Sage session from a .sage file,\nthe tracebacks are not very informative: they refer to <string> instead\nof to the file name, and give no line numbers or code snippets. This\nmakes it hard to find out where the error is.\n\nThe patch fixes this for attach, but not for load (because of efficiency reasons).\n\nApply [attachment: 11812.3.patch](https://github.com/sagemath/sage/files/ticket11812/11812.3.patch.gz)\n\n---\n\nExample:\n\nSuppose I have some files loaded with \"load\" or \"attach\", and one of them is a .sage file with\n\n```\nclass Bar():\n     def function_with_common_name(self):\n         # lots of lines of code\n         1/0\n         # lots of lines of code\n\n# other classes that also have functions named function_with_common_name\n\ndef foo():\n     # lots of lines of code\n     a = Bar()\n     a.function_with_common_name()\n     # lots of lines of code\n```\n\nNow I do\n\n```\nsage: foo()\n---------------------------------------------------------------------------\nZeroDivisionError                         Traceback (most recent call last)\n\n/home/marco/<ipython console> in <module>()\n\n/home/marco/<string> in foo()\n\n/home/marco/<string> in function_with_common_name(self)\n\n/usr/local/sage/sage-4.6.2/local/lib/python2.6/site-packages/sage/structure/element.so\nin sage.structure.element.RingElement.__div__\n(sage/structure/element.c:11981)()\n\n/usr/local/sage/sage-4.6.2/local/lib/python2.6/site-packages/sage/rings/integer.so\nin sage.rings.integer.Integer._div_ (sage/rings/integer.c:11944)()\n\n/usr/local/sage/sage-4.6.2/local/lib/python2.6/site-packages/sage/rings/integer_ring.so\nin sage.rings.integer_ring.IntegerRing_class._div\n(sage/rings/integer_ring.c:5142)()\n\nZeroDivisionError: Rational division by zero\n```\n\nThen to find the bug using this traceback, I would need to search my\nfiles to find all functions named \"function_with_common_name\" that are\ncalled from functions named \"foo\" for a line that could cause a division\nby zero... \n\nMore details:\n[http://groups.google.com/group/sage-devel/browse_thread/thread/761f69944e21efd4](http://groups.google.com/group/sage-devel/browse_thread/thread/761f69944e21efd4)\n\n\nCC:  @sagetrac-johanbosman\n\nComponent: **misc**\n\nKeywords: **load attach traceback**\n\nAuthor: **Marco Streng**\n\nReviewer: **Johan Bosman**\n\nMerged: **sage-4.8.alpha0**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/11812_\n\n",
    "closed_at": "2011-10-19T18:52:48Z",
    "created_at": "2011-09-18T09:12:00Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "traceback with load and attach of .sage files",
    "type": "issue",
    "updated_at": "2014-11-21T10:26:37Z",
    "url": "https://github.com/sagemath/sage/issues/11812",
    "user": "https://github.com/mstreng"
}
```
<div id="comment:0"></div>

When debugging code that is loaded into or attached to a Sage session from a .sage file,
the tracebacks are not very informative: they refer to <string> instead
of to the file name, and give no line numbers or code snippets. This
makes it hard to find out where the error is.

The patch fixes this for attach, but not for load (because of efficiency reasons).

Apply [attachment: 11812.3.patch](https://github.com/sagemath/sage/files/ticket11812/11812.3.patch.gz)

---

Example:

Suppose I have some files loaded with "load" or "attach", and one of them is a .sage file with

```
class Bar():
     def function_with_common_name(self):
         # lots of lines of code
         1/0
         # lots of lines of code

# other classes that also have functions named function_with_common_name

def foo():
     # lots of lines of code
     a = Bar()
     a.function_with_common_name()
     # lots of lines of code
```

Now I do

```
sage: foo()
---------------------------------------------------------------------------
ZeroDivisionError                         Traceback (most recent call last)

/home/marco/<ipython console> in <module>()

/home/marco/<string> in foo()

/home/marco/<string> in function_with_common_name(self)

/usr/local/sage/sage-4.6.2/local/lib/python2.6/site-packages/sage/structure/element.so
in sage.structure.element.RingElement.__div__
(sage/structure/element.c:11981)()

/usr/local/sage/sage-4.6.2/local/lib/python2.6/site-packages/sage/rings/integer.so
in sage.rings.integer.Integer._div_ (sage/rings/integer.c:11944)()

/usr/local/sage/sage-4.6.2/local/lib/python2.6/site-packages/sage/rings/integer_ring.so
in sage.rings.integer_ring.IntegerRing_class._div
(sage/rings/integer_ring.c:5142)()

ZeroDivisionError: Rational division by zero
```

Then to find the bug using this traceback, I would need to search my
files to find all functions named "function_with_common_name" that are
called from functions named "foo" for a line that could cause a division
by zero... 

More details:
[http://groups.google.com/group/sage-devel/browse_thread/thread/761f69944e21efd4](http://groups.google.com/group/sage-devel/browse_thread/thread/761f69944e21efd4)


CC:  @sagetrac-johanbosman

Component: **misc**

Keywords: **load attach traceback**

Author: **Marco Streng**

Reviewer: **Johan Bosman**

Merged: **sage-4.8.alpha0**

_Issue created by migration from https://trac.sagemath.org/ticket/11812_





---

archive/issue_events_157336.json:
```json
{
    "actor": "https://github.com/mstreng",
    "created_at": "2011-09-18T09:12:00Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "milestone_number": null,
    "milestone_title": "sage-4.7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11812#event-157336"
}
```



---

archive/issue_events_157337.json:
```json
{
    "actor": "https://github.com/mstreng",
    "created_at": "2011-09-18T09:12:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11812#event-157337"
}
```



---

archive/issue_events_157338.json:
```json
{
    "actor": "https://github.com/mstreng",
    "created_at": "2011-09-18T09:12:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11812#event-157338"
}
```



---

archive/issue_events_157339.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2011-09-18T09:12:00Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "subject": "https://github.com/mstreng",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11812#event-157339"
}
```



---

archive/issue_comments_123397.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -50,7 +50,12 @@\n ZeroDivisionError: Rational division by zero\n ```\n \n-The cause of the problem was pinpointed by Cornado PLG and he gives the following fix:\n+Then to find the bug using this traceback, I would need to search my\n+files to find all functions named \"function_with_common_name\" that are\n+called from functions named \"foo\" for a line that could cause a division\n+by zero... \n+\n+The cause of the problem was pinpointed by Conrado PLG and he gives the following fix:\n \n Search preparser.py for `elif fpath.endswith('.sage')` and change to the code below:\n \n@@ -63,6 +68,24 @@\n         execfile(fpath + '.py', globals) \n ```\n \n+After that change, the traceback contains the information that I want:\n+\n+```\n+/Users/marcostreng/tmp/foo.sage.py in foo()\n+     10 def foo():\n+     11      # lots of lines of code\n+     12      a = Bar()\n+---> 13      a.function_with_common_name()\n+     14      # lots of lines of code\n+\n+/Users/marcostreng/tmp/foo.sage.py in function_with_common_name(self)\n+      3      def function_with_common_name(self):\n+      4          # lots of lines of code\n+----> 5          _sage_const_1 /_sage_const_0 \n+      6          # lots of lines of code\n+      7 \n+```\n+\n For an explanation of why this works, and for a discussion of what would be the best way to fix this, see\n [http://groups.google.com/group/sage-devel/browse_thread/thread/761f69944e21efd4](http://groups.google.com/group/sage-devel/browse_thread/thread/761f69944e21efd4)\n \n``````\n",
    "created_at": "2011-09-18T09:26:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11812#issuecomment-123397",
    "user": "https://github.com/mstreng"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -50,7 +50,12 @@
 ZeroDivisionError: Rational division by zero
 ```
 
-The cause of the problem was pinpointed by Cornado PLG and he gives the following fix:
+Then to find the bug using this traceback, I would need to search my
+files to find all functions named "function_with_common_name" that are
+called from functions named "foo" for a line that could cause a division
+by zero... 
+
+The cause of the problem was pinpointed by Conrado PLG and he gives the following fix:
 
 Search preparser.py for `elif fpath.endswith('.sage')` and change to the code below:
 
@@ -63,6 +68,24 @@
         execfile(fpath + '.py', globals) 
 ```
 
+After that change, the traceback contains the information that I want:
+
+```
+/Users/marcostreng/tmp/foo.sage.py in foo()
+     10 def foo():
+     11      # lots of lines of code
+     12      a = Bar()
+---> 13      a.function_with_common_name()
+     14      # lots of lines of code
+
+/Users/marcostreng/tmp/foo.sage.py in function_with_common_name(self)
+      3      def function_with_common_name(self):
+      4          # lots of lines of code
+----> 5          _sage_const_1 /_sage_const_0 
+      6          # lots of lines of code
+      7 
+```
+
 For an explanation of why this works, and for a discussion of what would be the best way to fix this, see
 [http://groups.google.com/group/sage-devel/browse_thread/thread/761f69944e21efd4](http://groups.google.com/group/sage-devel/browse_thread/thread/761f69944e21efd4)
 
``````




---

archive/issue_comments_123398.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -89,3 +89,6 @@\n For an explanation of why this works, and for a discussion of what would be the best way to fix this, see\n [http://groups.google.com/group/sage-devel/browse_thread/thread/761f69944e21efd4](http://groups.google.com/group/sage-devel/browse_thread/thread/761f69944e21efd4)\n \n+Of course a patch should also include a doctest to prevent all this from happening again.\n+\n+\n``````\n",
    "created_at": "2011-09-18T14:09:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11812#issuecomment-123398",
    "user": "https://github.com/mstreng"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -89,3 +89,6 @@
 For an explanation of why this works, and for a discussion of what would be the best way to fix this, see
 [http://groups.google.com/group/sage-devel/browse_thread/thread/761f69944e21efd4](http://groups.google.com/group/sage-devel/browse_thread/thread/761f69944e21efd4)
 
+Of course a patch should also include a doctest to prevent all this from happening again.
+
+
``````




---

archive/issue_comments_123399.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,6 +2,10 @@\n the tracebacks are not very informative: they refer to <string> instead\n of to the file name, and give no line numbers or code snippets. This\n makes it hard to find out where the error is.\n+\n+The patch fixes this for attach, but not for load (because of efficiency reasons).\n+\n+Apply [attachment: trac_11812-traceback_attach.patch](https://github.com/sagemath/sage/files/ticket11812/trac_11812-traceback_attach.patch.gz)\n \n Example:\n \n@@ -55,40 +59,6 @@\n called from functions named \"foo\" for a line that could cause a division\n by zero... \n \n-The cause of the problem was pinpointed by Conrado PLG and he gives the following fix:\n-\n-Search preparser.py for `elif fpath.endswith('.sage')` and change to the code below:\n-\n-```\n-    elif fpath.endswith('.sage'):\n-        s = preparse_file(open(fpath).read())\n-        f = open(fpath + '.py', 'w')\n-        f.write(s)\n-        f.close()\n-        execfile(fpath + '.py', globals) \n-```\n-\n-After that change, the traceback contains the information that I want:\n-\n-```\n-/Users/marcostreng/tmp/foo.sage.py in foo()\n-     10 def foo():\n-     11      # lots of lines of code\n-     12      a = Bar()\n----> 13      a.function_with_common_name()\n-     14      # lots of lines of code\n-\n-/Users/marcostreng/tmp/foo.sage.py in function_with_common_name(self)\n-      3      def function_with_common_name(self):\n-      4          # lots of lines of code\n-----> 5          _sage_const_1 /_sage_const_0 \n-      6          # lots of lines of code\n-      7 \n-```\n-\n-For an explanation of why this works, and for a discussion of what would be the best way to fix this, see\n+More details:\n [http://groups.google.com/group/sage-devel/browse_thread/thread/761f69944e21efd4](http://groups.google.com/group/sage-devel/browse_thread/thread/761f69944e21efd4)\n \n-Of course a patch should also include a doctest to prevent all this from happening again.\n-\n-\n``````\n",
    "created_at": "2011-09-22T14:35:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11812#issuecomment-123399",
    "user": "https://github.com/mstreng"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,6 +2,10 @@
 the tracebacks are not very informative: they refer to <string> instead
 of to the file name, and give no line numbers or code snippets. This
 makes it hard to find out where the error is.
+
+The patch fixes this for attach, but not for load (because of efficiency reasons).
+
+Apply [attachment: trac_11812-traceback_attach.patch](https://github.com/sagemath/sage/files/ticket11812/trac_11812-traceback_attach.patch.gz)
 
 Example:
 
@@ -55,40 +59,6 @@
 called from functions named "foo" for a line that could cause a division
 by zero... 
 
-The cause of the problem was pinpointed by Conrado PLG and he gives the following fix:
-
-Search preparser.py for `elif fpath.endswith('.sage')` and change to the code below:
-
-```
-    elif fpath.endswith('.sage'):
-        s = preparse_file(open(fpath).read())
-        f = open(fpath + '.py', 'w')
-        f.write(s)
-        f.close()
-        execfile(fpath + '.py', globals) 
-```
-
-After that change, the traceback contains the information that I want:
-
-```
-/Users/marcostreng/tmp/foo.sage.py in foo()
-     10 def foo():
-     11      # lots of lines of code
-     12      a = Bar()
----> 13      a.function_with_common_name()
-     14      # lots of lines of code
-
-/Users/marcostreng/tmp/foo.sage.py in function_with_common_name(self)
-      3      def function_with_common_name(self):
-      4          # lots of lines of code
-----> 5          _sage_const_1 /_sage_const_0 
-      6          # lots of lines of code
-      7 
-```
-
-For an explanation of why this works, and for a discussion of what would be the best way to fix this, see
+More details:
 [http://groups.google.com/group/sage-devel/browse_thread/thread/761f69944e21efd4](http://groups.google.com/group/sage-devel/browse_thread/thread/761f69944e21efd4)
 
-Of course a patch should also include a doctest to prevent all this from happening again.
-
-
``````




---

archive/issue_comments_123400.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nAttachment: **[trac_11812-traceback_attach.patch.gz](https://github.com/sagemath/sage/files/ticket11812/trac_11812-traceback_attach.patch.gz)**",
    "created_at": "2011-09-22T14:35:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11812#issuecomment-123400",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:3" align="right">comment:3</div>

Attachment: **[trac_11812-traceback_attach.patch.gz](https://github.com/sagemath/sage/files/ticket11812/trac_11812-traceback_attach.patch.gz)**



---

archive/issue_comments_123401.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nAll tests passed on sage 4.7",
    "created_at": "2011-09-22T15:37:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11812#issuecomment-123401",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:4" align="right">comment:4</div>

All tests passed on sage 4.7



---

archive/issue_events_157340.json:
```json
{
    "actor": "https://github.com/mstreng",
    "created_at": "2011-09-22T15:37:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11812#event-157340"
}
```



---

archive/issue_events_157341.json:
```json
{
    "actor": "https://github.com/mstreng",
    "created_at": "2011-09-22T19:06:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11812#event-157341"
}
```



---

archive/issue_events_157342.json:
```json
{
    "actor": "https://github.com/mstreng",
    "created_at": "2011-09-22T19:06:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11812#event-157342"
}
```



---

archive/issue_comments_123402.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nJudging from the patchbot results, it doesn't seem to work after all.\n\nWhat exactly does spawn('sage') do? It always started a Sage session of the same Sage version and the same Sage installation when I tried it out (it was not in the PATH, but it was in the working directory). Maybe it doesn't work on all machines or it depends on the working directory?\n\nAny idea of how to do these tests so that they succeed with patch and fail without?",
    "created_at": "2011-09-22T19:06:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11812#issuecomment-123402",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:5" align="right">comment:5</div>

Judging from the patchbot results, it doesn't seem to work after all.

What exactly does spawn('sage') do? It always started a Sage session of the same Sage version and the same Sage installation when I tried it out (it was not in the PATH, but it was in the working directory). Maybe it doesn't work on all machines or it depends on the working directory?

Any idea of how to do these tests so that they succeed with patch and fail without?



---

archive/issue_comments_123403.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nonly apply 11812.patch",
    "created_at": "2011-10-07T14:56:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11812#issuecomment-123403",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:6" align="right">comment:6</div>

only apply 11812.patch



---

archive/issue_comments_123404.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,7 +5,9 @@\n \n The patch fixes this for attach, but not for load (because of efficiency reasons).\n \n-Apply [attachment: trac_11812-traceback_attach.patch](https://github.com/sagemath/sage/files/ticket11812/trac_11812-traceback_attach.patch.gz)\n+Apply [attachment: 11812.patch](https://github.com/sagemath/sage/files/ticket11812/11812.patch.gz)\n+\n+---\n \n Example:\n \n``````\n",
    "created_at": "2011-10-07T14:56:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11812#issuecomment-123404",
    "user": "https://github.com/mstreng"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,7 +5,9 @@
 
 The patch fixes this for attach, but not for load (because of efficiency reasons).
 
-Apply [attachment: trac_11812-traceback_attach.patch](https://github.com/sagemath/sage/files/ticket11812/trac_11812-traceback_attach.patch.gz)
+Apply [attachment: 11812.patch](https://github.com/sagemath/sage/files/ticket11812/11812.patch.gz)
+
+---
 
 Example:
 
``````




---

archive/issue_events_157343.json:
```json
{
    "actor": "https://github.com/mstreng",
    "created_at": "2011-10-07T14:56:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11812#event-157343"
}
```



---

archive/issue_events_157344.json:
```json
{
    "actor": "https://github.com/mstreng",
    "created_at": "2011-10-07T14:56:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11812#event-157344"
}
```



---

archive/issue_comments_123405.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nA few minor issues:\n\n* `if preparse_to_file == None:` should be `if preparse_to_file `**`is`**` None:`.\n\n* There's some mark-up missing in the docstrings (also in parts you didn't add).\n \n* In docstrings, Python identifiers (constants, function and variable names etc.) and the like should be enclosed in double backticks (<code>\\`\\`name\\`\\`</code>, which means Courier / typewriter font); <code>\\`name\\`</code> in contrast yields typesetting in *math* mode.\n\n\n\n\nI'm not sure what your problem with doctests involving tracebacks exactly was; we have a couple of such tests (not needing to call `sage` or use the `PExpect` interface); they just look slightly different to what you get in a real Sage session.\n\nYou can also use continuation lines in examples and doctests by the way, but again they're (currently still) a bit different such that you cannot directly paste them from a Sage session, i.e., you have to use the Python form instead of Sage's (cf. #10458).",
    "created_at": "2011-10-10T02:59:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11812#issuecomment-123405",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:7" align="right">comment:7</div>

A few minor issues:

* `if preparse_to_file == None:` should be `if preparse_to_file `**`is`**` None:`.

* There's some mark-up missing in the docstrings (also in parts you didn't add).
 
* In docstrings, Python identifiers (constants, function and variable names etc.) and the like should be enclosed in double backticks (<code>\`\`name\`\`</code>, which means Courier / typewriter font); <code>\`name\`</code> in contrast yields typesetting in *math* mode.




I'm not sure what your problem with doctests involving tracebacks exactly was; we have a couple of such tests (not needing to call `sage` or use the `PExpect` interface); they just look slightly different to what you get in a real Sage session.

You can also use continuation lines in examples and doctests by the way, but again they're (currently still) a bit different such that you cannot directly paste them from a Sage session, i.e., you have to use the Python form instead of Sage's (cf. #10458).



---

archive/issue_comments_123406.json:
```json
{
    "body": "simpler patch: fixes the problem without adding complicated new doctests",
    "created_at": "2011-10-10T10:30:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11812#issuecomment-123406",
    "user": "https://github.com/mstreng"
}
```

simpler patch: fixes the problem without adding complicated new doctests



---

archive/issue_comments_123407.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nAttachment: **[11812.patch.gz](https://github.com/sagemath/sage/files/ticket11812/11812.patch.gz)**\n\nReplying to [@nexttime](#comment%3A7):\n> * `if preparse_to_file == None:` should be `if preparse_to_file `**`is`**` None:`.\n> * There's some mark-up missing in the docstrings (also in parts you didn't add).\n\nThanks, all corrected (I think).\n\n> * In docstrings, Python identifiers (constants, function and variable names etc.) and the like should be enclosed in double backticks (<code>\\`\\`name\\`\\`</code>, which means Courier / typewriter font); <code>\\`name\\`</code> in contrast yields typesetting in *math* mode.\n\nNot sure what you mean: I don't see where in this docstring single backticks are or should be used. I did add some double backticks though.\n\n\n> I'm not sure what your problem with doctests involving tracebacks exactly was; we have a couple of such tests (not needing to call `sage` or use the `PExpect` interface); they just look slightly different to what you get in a real Sage session.\n\nThe problem with the doctest is that I couldn't create a test that really checks whether #11812 was fixed:\n\n* The content of the traceback in the example `sage: attach('myfile.sage')` on line 1573 of [attachment: trac_11812-traceback_attach.patch](https://github.com/sagemath/sage/files/ticket11812/trac_11812-traceback_attach.patch.gz) is ignored in doctests according to [this link](http://docs.python.org/library/doctest.html#what-about-exceptions). And indeed, that example passes the doctests even with #11812 not applied.\n\n* The test with pexpect in that attachment seemed to work on my computer, but doesn't really, according to [patchbot](http://patchbot.sagemath.org/log/11812/linux/ubuntu/hardy/sage.math.washington.edu/2011-09-22%2008:56:39%20-0700). The problem is that I don't quite understand which sage installation is used in this test.\n\nSo I had to remove the test. As the example isn't tested anyway, I decided to keep things simple by removing that as well and adding a few explanatory comments to the code.",
    "created_at": "2011-10-10T10:54:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11812#issuecomment-123407",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:8" align="right">comment:8</div>

Attachment: **[11812.patch.gz](https://github.com/sagemath/sage/files/ticket11812/11812.patch.gz)**

Replying to [@nexttime](#comment%3A7):
> * `if preparse_to_file == None:` should be `if preparse_to_file `**`is`**` None:`.
> * There's some mark-up missing in the docstrings (also in parts you didn't add).

Thanks, all corrected (I think).

> * In docstrings, Python identifiers (constants, function and variable names etc.) and the like should be enclosed in double backticks (<code>\`\`name\`\`</code>, which means Courier / typewriter font); <code>\`name\`</code> in contrast yields typesetting in *math* mode.

Not sure what you mean: I don't see where in this docstring single backticks are or should be used. I did add some double backticks though.


> I'm not sure what your problem with doctests involving tracebacks exactly was; we have a couple of such tests (not needing to call `sage` or use the `PExpect` interface); they just look slightly different to what you get in a real Sage session.

The problem with the doctest is that I couldn't create a test that really checks whether #11812 was fixed:

* The content of the traceback in the example `sage: attach('myfile.sage')` on line 1573 of [attachment: trac_11812-traceback_attach.patch](https://github.com/sagemath/sage/files/ticket11812/trac_11812-traceback_attach.patch.gz) is ignored in doctests according to [this link](http://docs.python.org/library/doctest.html#what-about-exceptions). And indeed, that example passes the doctests even with #11812 not applied.

* The test with pexpect in that attachment seemed to work on my computer, but doesn't really, according to [patchbot](http://patchbot.sagemath.org/log/11812/linux/ubuntu/hardy/sage.math.washington.edu/2011-09-22%2008:56:39%20-0700). The problem is that I don't quite understand which sage installation is used in this test.

So I had to remove the test. As the example isn't tested anyway, I decided to keep things simple by removing that as well and adding a few explanatory comments to the code.



---

archive/issue_comments_123408.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI would like to remind the patchbot to apply 11812.patch only.",
    "created_at": "2011-10-10T10:55:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11812#issuecomment-123408",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:9" align="right">comment:9</div>

I would like to remind the patchbot to apply 11812.patch only.



---

archive/issue_events_157345.json:
```json
{
    "actor": "https://github.com/mstreng",
    "created_at": "2011-10-13T10:53:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11812#event-157345"
}
```



---

archive/issue_events_157346.json:
```json
{
    "actor": "https://github.com/mstreng",
    "created_at": "2011-10-13T10:53:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11812#event-157346"
}
```



---

archive/issue_comments_123409.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nOops, this patch works only from the moment you attach the file until the moment it changes: if I change my file in another terminal, and then do `sage: foo()` again, it gets reloaded without good tracebacks.",
    "created_at": "2011-10-13T10:53:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11812#issuecomment-123409",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:10" align="right">comment:10</div>

Oops, this patch works only from the moment you attach the file until the moment it changes: if I change my file in another terminal, and then do `sage: foo()` again, it gets reloaded without good tracebacks.



---

archive/issue_comments_123410.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nI'm writing a new patch.\n\nUnrelated to that, see also #11925.",
    "created_at": "2011-10-15T09:06:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11812#issuecomment-123410",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:11" align="right">comment:11</div>

I'm writing a new patch.

Unrelated to that, see also #11925.



---

archive/issue_comments_123411.json:
```json
{
    "body": "Attachment: **[11812.2.patch.gz](https://github.com/sagemath/sage/files/ticket11812/11812.2.patch.gz)**",
    "created_at": "2011-10-16T13:45:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11812#issuecomment-123411",
    "user": "https://github.com/mstreng"
}
```

Attachment: **[11812.2.patch.gz](https://github.com/sagemath/sage/files/ticket11812/11812.2.patch.gz)**



---

archive/issue_comments_123412.json:
```json
{
    "body": "Author: **Marco Streng**",
    "created_at": "2011-10-16T13:47:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11812#issuecomment-123412",
    "user": "https://github.com/mstreng"
}
```

Author: **Marco Streng**



---

archive/issue_comments_123413.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nNew patch that does work. Apply 11812.3.patch only.\n(testing now)",
    "created_at": "2011-10-16T13:47:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11812#issuecomment-123413",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:12" align="right">comment:12</div>

New patch that does work. Apply 11812.3.patch only.
(testing now)



---

archive/issue_comments_123414.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,7 +5,7 @@\n \n The patch fixes this for attach, but not for load (because of efficiency reasons).\n \n-Apply [attachment: 11812.patch](https://github.com/sagemath/sage/files/ticket11812/11812.patch.gz)\n+Apply [attachment: 11812.3.patch](https://github.com/sagemath/sage/files/ticket11812/11812.3.patch.gz)\n \n ---\n \n``````\n",
    "created_at": "2011-10-16T13:47:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11812#issuecomment-123414",
    "user": "https://github.com/mstreng"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,7 +5,7 @@
 
 The patch fixes this for attach, but not for load (because of efficiency reasons).
 
-Apply [attachment: 11812.patch](https://github.com/sagemath/sage/files/ticket11812/11812.patch.gz)
+Apply [attachment: 11812.3.patch](https://github.com/sagemath/sage/files/ticket11812/11812.3.patch.gz)
 
 ---
 
``````




---

archive/issue_comments_123415.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nAttachment: **[11812.3.patch.gz](https://github.com/sagemath/sage/files/ticket11812/11812.3.patch.gz)**\n\nAll tests pass!!",
    "created_at": "2011-10-16T16:25:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11812#issuecomment-123415",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:13" align="right">comment:13</div>

Attachment: **[11812.3.patch.gz](https://github.com/sagemath/sage/files/ticket11812/11812.3.patch.gz)**

All tests pass!!



---

archive/issue_events_157347.json:
```json
{
    "actor": "https://github.com/mstreng",
    "created_at": "2011-10-16T16:25:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11812#event-157347"
}
```



---

archive/issue_events_157348.json:
```json
{
    "actor": "https://github.com/mstreng",
    "created_at": "2011-10-16T16:25:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11812#event-157348"
}
```



---

archive/issue_events_157349.json:
```json
{
    "actor": "https://github.com/sagetrac-johanbosman",
    "created_at": "2011-10-17T12:42:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11812#event-157349"
}
```



---

archive/issue_events_157350.json:
```json
{
    "actor": "https://github.com/sagetrac-johanbosman",
    "created_at": "2011-10-17T12:42:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11812#event-157350"
}
```



---

archive/issue_comments_123416.json:
```json
{
    "body": "Reviewer: **Johan Bosman**",
    "created_at": "2011-10-17T12:42:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11812#issuecomment-123416",
    "user": "https://github.com/sagetrac-johanbosman"
}
```

Reviewer: **Johan Bosman**



---

archive/issue_comments_123417.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nLooks good. ;).",
    "created_at": "2011-10-17T12:42:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11812#issuecomment-123417",
    "user": "https://github.com/sagetrac-johanbosman"
}
```

<div id="comment:14" align="right">comment:14</div>

Looks good. ;).



---

archive/issue_events_157351.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-17T13:14:04Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "milestone_number": null,
    "milestone_title": "sage-4.7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11812#event-157351"
}
```



---

archive/issue_events_157352.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-17T13:14:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "milestone_number": null,
    "milestone_title": "sage-4.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11812#event-157352"
}
```



---

archive/issue_comments_123418.json:
```json
{
    "body": "Changed keywords from none to **load attach traceback**",
    "created_at": "2011-10-18T08:57:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11812#issuecomment-123418",
    "user": "https://github.com/mstreng"
}
```

Changed keywords from none to **load attach traceback**



---

archive/issue_comments_123419.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@sagetrac-johanbosman](#comment%3A14):\n\nThanks!",
    "created_at": "2011-10-18T08:57:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11812#issuecomment-123419",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@sagetrac-johanbosman](#comment%3A14):

Thanks!



---

archive/issue_comments_123420.json:
```json
{
    "body": "Merged: **sage-4.7.3.alpha0**",
    "created_at": "2011-10-19T18:52:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11812#issuecomment-123420",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-4.7.3.alpha0**



---

archive/issue_events_157353.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-19T18:52:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11812#event-157353"
}
```



---

archive/issue_events_157354.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-19T18:52:48Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11812#event-157354"
}
```



---

archive/issue_events_157355.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-11-03T16:14:43Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "milestone_number": null,
    "milestone_title": "sage-4.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11812#event-157355"
}
```



---

archive/issue_comments_123421.json:
```json
{
    "body": "Milestone sage-4.7.3 deleted",
    "created_at": "2011-11-03T16:14:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11812#issuecomment-123421",
    "user": "https://github.com/jdemeyer"
}
```

Milestone sage-4.7.3 deleted



---

archive/issue_comments_123422.json:
```json
{
    "body": "Changed merged from **sage-4.7.3.alpha0** to **sage-4.8.alpha0**",
    "created_at": "2011-11-03T16:17:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11812#issuecomment-123422",
    "user": "https://github.com/jdemeyer"
}
```

Changed merged from **sage-4.7.3.alpha0** to **sage-4.8.alpha0**



---

archive/issue_events_157356.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-11-03T16:17:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "milestone_number": null,
    "milestone_title": "sage-4.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11812#event-157356"
}
```



---

archive/issue_comments_123423.json:
```json
{
    "body": "Replying to [@mstreng](https://github.com/sagemath/sage/issues/11812#comment:0):\n> The patch fixes this for attach, but not for load (because of efficiency reasons).\n\nWhat exactly are these \"efficiency reasons\"? Are people really executing `load` or `attach` in tight loops? I think that one should **always** have good tracebacks, so I would always use temporary files.",
    "created_at": "2014-11-20T18:32:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11812#issuecomment-123423",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [@mstreng](https://github.com/sagemath/sage/issues/11812#comment:0):
> The patch fixes this for attach, but not for load (because of efficiency reasons).

What exactly are these "efficiency reasons"? Are people really executing `load` or `attach` in tight loops? I think that one should **always** have good tracebacks, so I would always use temporary files.



---

archive/issue_comments_123424.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@jdemeyer](#comment%3A20):\n> Replying to [@mstreng](https://github.com/sagemath/sage/issues/11812#comment:0):\n> > The patch fixes this for attach, but not for load (because of efficiency reasons).\n> \n> \n> What exactly are these \"efficiency reasons\"?\n\nWith a temporary file, there is a good traceback, but working with files can be slow. When precompiling in memory, it is faster, but that is not implemented in a way that yields good tracebacks.\n\n> Are people really executing `load` or `attach` in tight loops?\n\nI can't imagine that anyone would do that.\n\n> I think that one should **always** have good tracebacks, so I would always use temporary files.\n\nI completely agree. However, it seemed during the original discussion that I was the only one who always wanted good tracebacks. And someone made the switch to memory on purpose, for efficiency reasons.",
    "created_at": "2014-11-21T07:50:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11812#issuecomment-123424",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@jdemeyer](#comment%3A20):
> Replying to [@mstreng](https://github.com/sagemath/sage/issues/11812#comment:0):
> > The patch fixes this for attach, but not for load (because of efficiency reasons).
> 
> 
> What exactly are these "efficiency reasons"?

With a temporary file, there is a good traceback, but working with files can be slow. When precompiling in memory, it is faster, but that is not implemented in a way that yields good tracebacks.

> Are people really executing `load` or `attach` in tight loops?

I can't imagine that anyone would do that.

> I think that one should **always** have good tracebacks, so I would always use temporary files.

I completely agree. However, it seemed during the original discussion that I was the only one who always wanted good tracebacks. And someone made the switch to memory on purpose, for efficiency reasons.



---

archive/issue_comments_123425.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@mstreng](#comment%3A21):\n> With a temporary file, there is a good traceback, but working with files can be slow. When precompiling in memory, it is faster, but that is not implemented in a way that yields good tracebacks.\n\nI am thinking about #71 and it *might* be possible to have a traceback for a preparsed-in-memory file by re-preparsing the file when showing the traceback. I still have to check if that actually works.\n\n> And someone made the switch to memory on purpose\n\nIndeed.\n\n> for efficiency reasons.\n\nThat's not clear to me, maybe it was just to simplify the code?",
    "created_at": "2014-11-21T09:35:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11812#issuecomment-123425",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@mstreng](#comment%3A21):
> With a temporary file, there is a good traceback, but working with files can be slow. When precompiling in memory, it is faster, but that is not implemented in a way that yields good tracebacks.

I am thinking about #71 and it *might* be possible to have a traceback for a preparsed-in-memory file by re-preparsing the file when showing the traceback. I still have to check if that actually works.

> And someone made the switch to memory on purpose

Indeed.

> for efficiency reasons.

That's not clear to me, maybe it was just to simplify the code?



---

archive/issue_comments_123426.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@jdemeyer](#comment%3A22):\n> I am thinking about #71 and it *might* be possible to have a traceback for a preparsed-in-memory file by re-preparsing the file when showing the traceback. I still have to check if that actually works.\n\nSounds good.\n\nAnyway, to get good tracebacks by default also for load, all you need to do is change\n\n```\nload_debug_mode = False \nattach_debug_mode = True \n```\nboth to `True` in sage/misc/preparser.py, except that the name `debug_mode` is a bit confusing when it is the default.\n\n> maybe it was just to simplify the code?\n\nSimplifying and improving the code was indeed the purpose of #7514, where the switch to memory was made. The efficiency reason for the switch to memory was suggested to me by various people, not including the author of #7514.",
    "created_at": "2014-11-21T10:26:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11812#issuecomment-123426",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@jdemeyer](#comment%3A22):
> I am thinking about #71 and it *might* be possible to have a traceback for a preparsed-in-memory file by re-preparsing the file when showing the traceback. I still have to check if that actually works.

Sounds good.

Anyway, to get good tracebacks by default also for load, all you need to do is change

```
load_debug_mode = False 
attach_debug_mode = True 
```
both to `True` in sage/misc/preparser.py, except that the name `debug_mode` is a bit confusing when it is the default.

> maybe it was just to simplify the code?

Simplifying and improving the code was indeed the purpose of #7514, where the switch to memory was made. The efficiency reason for the switch to memory was suggested to me by various people, not including the author of #7514.
