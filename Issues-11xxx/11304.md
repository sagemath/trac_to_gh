# Issue 11304: Problems with S-class groups of number fields

archive/issues_011132.json:
```json
{
    "body": "There are some serious problems at present with the code for S-class groups.  They only emerge when the class groups is\u00a0non-cyclic.  For example,\n\n```\nsage: K.<a> = QuadraticField(-105)\nsage: C = K.class_group(); C\nClass group of order 8 with structure C2 x C2 x C2 of Number Field in a with defining polynomial x^2 + 105\nsage: S = (K.ideal(11, a + 7),)\nsage: K.S_class_group(S)\nTraceback (most recent call last):\n...\nIndexError: Argument length (= 3) must be 2.\n```\nThis problem arises when the class group and the S-class group have differing numbers of generators.  It arises essentially because generators of S-class groups are created as `FractionalIdealClass` elements rather than `SFractionalIdealClass` elements.\n\nBut there is a more serious problem.  The Pari data for the S-class group which we failed to construct above can be obtained as\n\n```\nsage: SC_data = K._S_class_group_and_units(S)[1]; SC_data\n[(Fractional ideal (10, a + 5), 2, 10), (Fractional ideal (6, a + 3), 2, 6)]\n```\nso that if\n\n```\nsage: P, Q = [u[0] for u in SC_data]\n```\nthe S-classes of the ideals `P` and `Q` (each of order 2) generate the S-class group.  However,\n\n```\nsage: P._S_ideal_class_log(S)\n[0, 0]\n```\nwhich cannot be correct.\n\n**Assignee:** @loefflerd\n\n**CC:**  @jdemeyer @JohnCremona @rlmill\n\n**Keywords:** S-class groups\n\n**Author:** Francis Clarke\n\n**Reviewer:** John Cremona\n\n**Merged:** sage-4.7.2.alpha1\n\nIssue created by migration from https://trac.sagemath.org/ticket/11304\n\n",
    "closed_at": "2011-08-03T14:38:00Z",
    "created_at": "2011-05-06T08:40:19Z",
    "labels": [
        "component: number fields",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7.2",
    "title": "Problems with S-class groups of number fields",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11304",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```
There are some serious problems at present with the code for S-class groups.  They only emerge when the class groups isÂ non-cyclic.  For example,

```
sage: K.<a> = QuadraticField(-105)
sage: C = K.class_group(); C
Class group of order 8 with structure C2 x C2 x C2 of Number Field in a with defining polynomial x^2 + 105
sage: S = (K.ideal(11, a + 7),)
sage: K.S_class_group(S)
Traceback (most recent call last):
...
IndexError: Argument length (= 3) must be 2.
```
This problem arises when the class group and the S-class group have differing numbers of generators.  It arises essentially because generators of S-class groups are created as `FractionalIdealClass` elements rather than `SFractionalIdealClass` elements.

But there is a more serious problem.  The Pari data for the S-class group which we failed to construct above can be obtained as

```
sage: SC_data = K._S_class_group_and_units(S)[1]; SC_data
[(Fractional ideal (10, a + 5), 2, 10), (Fractional ideal (6, a + 3), 2, 6)]
```
so that if

```
sage: P, Q = [u[0] for u in SC_data]
```
the S-classes of the ideals `P` and `Q` (each of order 2) generate the S-class group.  However,

```
sage: P._S_ideal_class_log(S)
[0, 0]
```
which cannot be correct.

**Assignee:** @loefflerd

**CC:**  @jdemeyer @JohnCremona @rlmill

**Keywords:** S-class groups

**Author:** Francis Clarke

**Reviewer:** John Cremona

**Merged:** sage-4.7.2.alpha1

Issue created by migration from https://trac.sagemath.org/ticket/11304





---

archive/attachments_014805.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_11304_S_class_groups.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket11304/trac_11304_S_class_groups.patch",
    "created_at": "2011-06-03T07:44:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11304",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```



---

archive/issue_comments_142898.json:
```json
{
    "body": "apply after patches from #11234",
    "created_at": "2011-06-03T07:44:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11304#issuecomment-142898",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

apply after patches from #11234



---

archive/issue_comments_142899.json:
```json
{
    "body": "**Author:** Francis Clarke",
    "created_at": "2011-06-03T07:51:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11304#issuecomment-142899",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

**Author:** Francis Clarke



---

archive/issue_comments_142900.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2011-06-03T07:51:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11304#issuecomment-142900",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_142901.json:
```json
{
    "body": "<a id='comment:1'></a>\nThe patch rectifies the defects.  It also incorporates enhancements for both class groups and S-class groups.\n\nIn particular:\n\nThe computation of S-class groups is made faster when the ideals in S are all principal.\n\nThe computation of ideal_class_logs is speeded up by setting a pari flag.\n\nThe code for S-class groups is made more compatible with that for class groups.",
    "created_at": "2011-06-03T07:51:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11304#issuecomment-142901",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

<a id='comment:1'></a>
The patch rectifies the defects.  It also incorporates enhancements for both class groups and S-class groups.

In particular:

The computation of S-class groups is made faster when the ideals in S are all principal.

The computation of ideal_class_logs is speeded up by setting a pari flag.

The code for S-class groups is made more compatible with that for class groups.



---

archive/issue_comments_142902.json:
```json
{
    "body": "<a id='comment:2'></a>\nLooks good to me, and applies fine to 4.7.1.alpha1 and all tests pass.\n\nI've added rlm to the CC list since I think he implemented this originally, and hope he'll take a look too.",
    "created_at": "2011-06-03T13:52:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11304#issuecomment-142902",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:2'></a>
Looks good to me, and applies fine to 4.7.1.alpha1 and all tests pass.

I've added rlm to the CC list since I think he implemented this originally, and hope he'll take a look too.



---

archive/issue_comments_142903.json:
```json
{
    "body": "<a id='comment:3'></a>\nReplying to [cremona](#comment%3A2):\n> Looks good to me, and applies fine to 4.7.1.alpha1 and all tests pass.\n> \n> I've added rlm to the CC list since I think he implemented this originally, and hope he'll take a look too.\n\n\nAs Robert doesn't seem to reply, do you want to give this a positive review, or have someone else review it too?",
    "created_at": "2011-07-04T22:24:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11304#issuecomment-142903",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:3'></a>
Replying to [cremona](#comment%3A2):
> Looks good to me, and applies fine to 4.7.1.alpha1 and all tests pass.
> 
> I've added rlm to the CC list since I think he implemented this originally, and hope he'll take a look too.


As Robert doesn't seem to reply, do you want to give this a positive review, or have someone else review it too?



---

archive/issue_comments_142904.json:
```json
{
    "body": "<a id='comment:4'></a>\nLet's give it a positive review, since I clearly thought it deserved that 5 weeks ago!\nMarco, you can add your name as reviewer if appropriate.",
    "created_at": "2011-07-05T16:04:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11304#issuecomment-142904",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:4'></a>
Let's give it a positive review, since I clearly thought it deserved that 5 weeks ago!
Marco, you can add your name as reviewer if appropriate.



---

archive/issue_comments_142905.json:
```json
{
    "body": "**Reviewer:** John Cremona",
    "created_at": "2011-07-05T16:04:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11304#issuecomment-142905",
    "user": "https://github.com/JohnCremona"
}
```

**Reviewer:** John Cremona



---

archive/issue_comments_142906.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2011-07-05T16:04:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11304#issuecomment-142906",
    "user": "https://github.com/JohnCremona"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_events_035023.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-07-06T12:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11304",
    "milestone": "sage-4.7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11304#event-35023"
}
```



---

archive/issue_comments_142907.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [mstreng](#comment%3A3):\n> Replying to [cremona](#comment%3A2):\n> > Looks good to me, and applies fine to 4.7.1.alpha1 and all tests pass.\n> > \n> > I've added rlm to the CC list since I think he implemented this originally, and hope he'll take a look too.\n\n> \n> As Robert doesn't seem to reply, do you want to give this a positive review, or have someone else review it too?\n\n\nSorry for the delay, but I can add that the changes here look good to me too.",
    "created_at": "2011-07-24T06:07:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11304#issuecomment-142907",
    "user": "https://github.com/rlmill"
}
```

<a id='comment:6'></a>
Replying to [mstreng](#comment%3A3):
> Replying to [cremona](#comment%3A2):
> > Looks good to me, and applies fine to 4.7.1.alpha1 and all tests pass.
> > 
> > I've added rlm to the CC list since I think he implemented this originally, and hope he'll take a look too.

> 
> As Robert doesn't seem to reply, do you want to give this a positive review, or have someone else review it too?


Sorry for the delay, but I can add that the changes here look good to me too.



---

archive/issue_events_035024.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-08-03T14:38:00Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11304",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11304#event-35024"
}
```



---

archive/issue_comments_142908.json:
```json
{
    "body": "**Merged:** sage-4.7.2.alpha1",
    "created_at": "2011-08-03T14:38:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11304",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11304#issuecomment-142908",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-4.7.2.alpha1
