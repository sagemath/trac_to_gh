# Issue 11630: Local data of elliptic curves should not do any global work

archive/issues_011458.json:
```json
{
    "body": "... unless asked to do so.\n\nI am talking about the line 687 in sage.scheme.elliptic_curves_ell_local_data  which reads\n\n```\n        principal_flag = P.is_principal()\n        if principal_flag:\n            pi = P.gens_reduced()[0]\n            verbose(\"P is principal, generator pi = %s\"%pi, t, 1)\n        else:\n            pi = K.uniformizer(P, 'positive')\n            verbose(\"P is not principal, uniformizer pi = %s\"%pi, t, 1)\n```\n\nWhile it can be useful, especially when one wants a global minimal model, it is often very harmful. If the class group of the field is huge or difficult to compute, one will not be able to determine the fibres of the Neron model, simply because of this line.\n\nOne should add a switch which is by default set to use the second case and only if needed to the first case.\n\nOf course, in an ideal world Tate's algorithm should be implemented for any elliptic curve over a local field, rather than a number field.\n\nCC:  @JohnCremona\n\nKeywords: Tate's algorithm\n\nReviewer: John Cremona\n\nAuthor: Chris Wuthrich\n\nBranch: u/wuthrich/ticket/11630\n\nCommit: d2d345764892fceb13f037d63adb9bd837ea6fde\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/11630\n\n",
    "closed_at": "2014-01-05T06:54:09Z",
    "created_at": "2011-07-26T14:14:50Z",
    "labels": [
        "component: elliptic curves",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.1",
    "title": "Local data of elliptic curves should not do any global work",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11630",
    "user": "https://github.com/categorie"
}
```
... unless asked to do so.

I am talking about the line 687 in sage.scheme.elliptic_curves_ell_local_data  which reads

```
        principal_flag = P.is_principal()
        if principal_flag:
            pi = P.gens_reduced()[0]
            verbose("P is principal, generator pi = %s"%pi, t, 1)
        else:
            pi = K.uniformizer(P, 'positive')
            verbose("P is not principal, uniformizer pi = %s"%pi, t, 1)
```

While it can be useful, especially when one wants a global minimal model, it is often very harmful. If the class group of the field is huge or difficult to compute, one will not be able to determine the fibres of the Neron model, simply because of this line.

One should add a switch which is by default set to use the second case and only if needed to the first case.

Of course, in an ideal world Tate's algorithm should be implemented for any elliptic curve over a local field, rather than a number field.

CC:  @JohnCremona

Keywords: Tate's algorithm

Reviewer: John Cremona

Author: Chris Wuthrich

Branch: u/wuthrich/ticket/11630

Commit: d2d345764892fceb13f037d63adb9bd837ea6fde

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/11630





---

archive/issue_comments_162023.json:
```json
{
    "body": "<a id='comment:1'></a>\nThat is a sensible suggestion, and if you write a patch I'll review it!  Ideally I would like the code to say \"if you know that P is principal and have a generator, the use it, otherwise...\", but I suppose that is what the uniformizer function might do anyway.\n\nI think that even if we did have a version for Tate's algorithm which applied directly to an elliptic curve over a local field, I would still want a global version -- which used generators of prime ideals for fields of class number 1 at least!",
    "created_at": "2011-07-26T14:21:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-162023",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:1'></a>
That is a sensible suggestion, and if you write a patch I'll review it!  Ideally I would like the code to say "if you know that P is principal and have a generator, the use it, otherwise...", but I suppose that is what the uniformizer function might do anyway.

I think that even if we did have a version for Tate's algorithm which applied directly to an elliptic curve over a local field, I would still want a global version -- which used generators of prime ideals for fields of class number 1 at least!



---

archive/issue_comments_162024.json:
```json
{
    "body": "Changing author from \"\" to \"Chris Wuthrich\"",
    "created_at": "2011-07-29T15:55:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-162024",
    "user": "https://github.com/categorie"
}
```

Changing author from "" to "Chris Wuthrich"



---

archive/issue_comments_162025.json:
```json
{
    "body": "<a id='comment:2'></a>\nThis patch does what I suggested + it also changes global_minimal_model. This function was only implemented when the class number was 1, now it tries to change to a global minimal model in any field.\n\nThe patch should be applied after #11540.",
    "created_at": "2011-07-29T15:55:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-162025",
    "user": "https://github.com/categorie"
}
```

<a id='comment:2'></a>
This patch does what I suggested + it also changes global_minimal_model. This function was only implemented when the class number was 1, now it tries to change to a global minimal model in any field.

The patch should be applied after #11540.



---

archive/issue_comments_162026.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-07-29T15:55:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-162026",
    "user": "https://github.com/categorie"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_162027.json:
```json
{
    "body": "Changing reviewer from \"\" to \"John Cremona\"",
    "created_at": "2011-07-31T13:49:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-162027",
    "user": "https://github.com/JohnCremona"
}
```

Changing reviewer from "" to "John Cremona"



---

archive/issue_comments_162028.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-07-31T13:49:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-162028",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_162029.json:
```json
{
    "body": "<a id='comment:3'></a>\nFirst a technical point:  the patch does not apply to 4.7.1.rc1+#11540.  Since 4.7.1 is almost out could you rebase the patch to the latest release candidate?\n\nI'll test more after that.  Meanwhile I am not sure that the logic is correct in the new, more general, global_minimal_model() function.  Are you assuming that the is a global minimal modell iff after replacing with a local minimal model at every relevant prime, one after the other, the result is minimal at all primes?  I'm sure that is not right.  On my (infinitely long) to-do list is a function that determines whether there is a global minimal model for any curve, which comes down to computing a certain ideal and testing if it is principal; if so then (using a generator for that ideal) one can find the minimal model.  That should be done, but not on this ticket.",
    "created_at": "2011-07-31T13:49:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-162029",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:3'></a>
First a technical point:  the patch does not apply to 4.7.1.rc1+#11540.  Since 4.7.1 is almost out could you rebase the patch to the latest release candidate?

I'll test more after that.  Meanwhile I am not sure that the logic is correct in the new, more general, global_minimal_model() function.  Are you assuming that the is a global minimal modell iff after replacing with a local minimal model at every relevant prime, one after the other, the result is minimal at all primes?  I'm sure that is not right.  On my (infinitely long) to-do list is a function that determines whether there is a global minimal model for any curve, which comes down to computing a certain ideal and testing if it is principal; if so then (using a generator for that ideal) one can find the minimal model.  That should be done, but not on this ticket.



---

archive/issue_comments_162030.json:
```json
{
    "body": "Changing work_issues from \"\" to \"rebase to 4.7.1\"",
    "created_at": "2011-07-31T13:49:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-162030",
    "user": "https://github.com/JohnCremona"
}
```

Changing work_issues from "" to "rebase to 4.7.1"



---

archive/issue_comments_162031.json:
```json
{
    "body": "<a id='comment:4'></a>\nThanks, John, for the quick review and for spotting my stupid error. In fact all I really wanted was that global minimal models are recognised when they are, but that was a bad idea. I agree with your comments and with your suggestion to open another ticket for this. This is ticket #11697 .\n\nI will rebase it today, hopefully, and delete the relevant passages. (Sorry, but I have decided quite a while ago not to work with intermediate versions anymore, but now 4.7.1 is here.)",
    "created_at": "2011-08-17T15:39:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-162031",
    "user": "https://github.com/categorie"
}
```

<a id='comment:4'></a>
Thanks, John, for the quick review and for spotting my stupid error. In fact all I really wanted was that global minimal models are recognised when they are, but that was a bad idea. I agree with your comments and with your suggestion to open another ticket for this. This is ticket #11697 .

I will rebase it today, hopefully, and delete the relevant passages. (Sorry, but I have decided quite a while ago not to work with intermediate versions anymore, but now 4.7.1 is here.)



---

archive/issue_comments_162032.json:
```json
{
    "body": "Remove assignee @JohnCremona.",
    "created_at": "2011-08-17T15:39:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-162032",
    "user": "https://github.com/categorie"
}
```

Remove assignee @JohnCremona.



---

archive/issue_comments_162033.json:
```json
{
    "body": "<a id='comment:5'></a>\nOk. I rebased it and I removed the changes in `global_minimal_model`.\nThe patch should be applied after #11540.",
    "created_at": "2011-08-18T09:29:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-162033",
    "user": "https://github.com/categorie"
}
```

<a id='comment:5'></a>
Ok. I rebased it and I removed the changes in `global_minimal_model`.
The patch should be applied after #11540.



---

archive/issue_comments_162034.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-08-18T09:29:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-162034",
    "user": "https://github.com/categorie"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_162035.json:
```json
{
    "body": "<a id='comment:6'></a>\nThe patch still applies to 4.7.2.",
    "created_at": "2011-11-17T17:00:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-162035",
    "user": "https://github.com/categorie"
}
```

<a id='comment:6'></a>
The patch still applies to 4.7.2.



---

archive/issue_comments_162036.json:
```json
{
    "body": "Changing reviewer from \"John Cremona\" to \"John Cremona, PatchBot\"",
    "created_at": "2012-03-11T16:48:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-162036",
    "user": "https://github.com/loefflerd"
}
```

Changing reviewer from "John Cremona" to "John Cremona, PatchBot"



---

archive/issue_comments_162037.json:
```json
{
    "body": "<a id='comment:7'></a>\nThe patch does not apply to 4.8 or to 5.0.beta7, according to the patchbot.",
    "created_at": "2012-03-11T16:48:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-162037",
    "user": "https://github.com/loefflerd"
}
```

<a id='comment:7'></a>
The patch does not apply to 4.8 or to 5.0.beta7, according to the patchbot.



---

archive/issue_comments_162038.json:
```json
{
    "body": "Changing work_issues from \"rebase to 4.7.1\" to \"rebase to 5.0\"",
    "created_at": "2012-03-11T16:48:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-162038",
    "user": "https://github.com/loefflerd"
}
```

Changing work_issues from "rebase to 4.7.1" to "rebase to 5.0"



---

archive/issue_comments_162039.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-03-11T16:48:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-162039",
    "user": "https://github.com/loefflerd"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_162040.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-05-04T20:46:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-162040",
    "user": "https://github.com/categorie"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_162041.json:
```json
{
    "body": "<a id='comment:8'></a>\nI rebased the patch. I exported it after appying #12509 and #13953, but maybe that is no problem.\n\nThe new patch includes a lot of deletion of trailing white space in the two edited files. Not sure that this is desired.",
    "created_at": "2013-05-04T20:46:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-162041",
    "user": "https://github.com/categorie"
}
```

<a id='comment:8'></a>
I rebased the patch. I exported it after appying #12509 and #13953, but maybe that is no problem.

The new patch includes a lot of deletion of trailing white space in the two edited files. Not sure that this is desired.



---

archive/issue_comments_162042.json:
```json
{
    "body": "exported against 5.9",
    "created_at": "2013-05-14T10:16:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-162042",
    "user": "https://github.com/categorie"
}
```

exported against 5.9



---

archive/issue_comments_162043.json:
```json
{
    "body": "<a id='comment:9'></a>\nAttachment [trac_11630_localize_tates_algorithm.patch](tarball://root/attachments/some-uuid/ticket11630/trac_11630_localize_tates_algorithm.patch) by @categorie created at 2013-05-14 16:24:40\n\nI have removed the whitespaces. This patch should apply to 5.9 + #12509.",
    "created_at": "2013-05-14T16:24:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-162043",
    "user": "https://github.com/categorie"
}
```

<a id='comment:9'></a>
Attachment [trac_11630_localize_tates_algorithm.patch](tarball://root/attachments/some-uuid/ticket11630/trac_11630_localize_tates_algorithm.patch) by @categorie created at 2013-05-14 16:24:40

I have removed the whitespaces. This patch should apply to 5.9 + #12509.



---

archive/issue_events_036114.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11630#event-36114"
}
```



---

archive/issue_comments_162044.json:
```json
{
    "body": "Changing branch from \"\" to \"u/wuthrich/ticket/11630\"",
    "created_at": "2013-12-22T22:16:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-162044",
    "user": "https://github.com/categorie"
}
```

Changing branch from "" to "u/wuthrich/ticket/11630"



---

archive/issue_comments_162045.json:
```json
{
    "body": "<a id='comment:12'></a>\nThat is my first use of the new git-stuff. I hope I did the right thing.\n\nI simply rebased the patch. It is ready for a review.\n\n---\nNew commits:\n|                                                                                                         |                                |\n|---------------------------------------------------------------------------------------------------------|--------------------------------|\n|[d2d3457](https://github.com/sagemath/sagetrac-mirror/commit/d2d3457)|`trac: #11630. Further changes.`|\n|[1775e28](https://github.com/sagemath/sagetrac-mirror/commit/1775e28)|`trac 11630: tate's algorithm should avoid global computations unless asked to do so`|",
    "created_at": "2013-12-22T22:22:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-162045",
    "user": "https://github.com/categorie"
}
```

<a id='comment:12'></a>
That is my first use of the new git-stuff. I hope I did the right thing.

I simply rebased the patch. It is ready for a review.

---
New commits:
|                                                                                                         |                                |
|---------------------------------------------------------------------------------------------------------|--------------------------------|
|[d2d3457](https://github.com/sagemath/sagetrac-mirror/commit/d2d3457)|`trac: #11630. Further changes.`|
|[1775e28](https://github.com/sagemath/sagetrac-mirror/commit/1775e28)|`trac 11630: tate's algorithm should avoid global computations unless asked to do so`|



---

archive/issue_comments_162046.json:
```json
{
    "body": "Changing commit from \"\" to \"d2d345764892fceb13f037d63adb9bd837ea6fde\"",
    "created_at": "2013-12-22T22:22:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-162046",
    "user": "https://github.com/categorie"
}
```

Changing commit from "" to "d2d345764892fceb13f037d63adb9bd837ea6fde"



---

archive/issue_comments_162047.json:
```json
{
    "body": "<a id='comment:13'></a>\nI have put this onto my to-do list to attempt my first git-style review, but in view of the season do not promise to do it in the next few days.\n[8 days later]\nUnder review!",
    "created_at": "2013-12-22T22:50:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-162047",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:13'></a>
I have put this onto my to-do list to attempt my first git-style review, but in view of the season do not promise to do it in the next few days.
[8 days later]
Under review!



---

archive/issue_comments_162048.json:
```json
{
    "body": "<a id='comment:14'></a>\nI am giving this a positive review despite the patchbot's red blob.",
    "created_at": "2013-12-30T16:32:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-162048",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:14'></a>
I am giving this a positive review despite the patchbot's red blob.



---

archive/issue_comments_162049.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-12-30T16:32:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-162049",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_162050.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-01-05T06:54:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-162050",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_036115.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-01-05T06:54:09Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11630#event-36115"
}
```



---

archive/issue_comments_162051.json:
```json
{
    "body": "Changing reviewer from \"John Cremona, PatchBot\" to \"John Cremona\"",
    "created_at": "2014-02-03T14:12:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-162051",
    "user": "https://github.com/jdemeyer"
}
```

Changing reviewer from "John Cremona, PatchBot" to "John Cremona"



---

archive/issue_comments_162052.json:
```json
{
    "body": "Changing work_issues from \"rebase to 5.0\" to \"\"",
    "created_at": "2014-02-03T14:12:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-162052",
    "user": "https://github.com/jdemeyer"
}
```

Changing work_issues from "rebase to 5.0" to ""
