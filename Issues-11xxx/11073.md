# Issue 11073: remove the spkg/base repo!

archive/issues_010953.json:
```json
{
    "body": "Given the creation of the Sage root repo (see #9433), the repository in `SAGE_ROOT/spkg/base` should be combined with it.\n\n1) apply [attachment:11073_root_hgignore.patch] to the root repo\n\n2)\n\n```\ncd $SAGE_ROOT/spkg/base\nrm -rf .hg* stdint.h_Solaris9 sage-*\nhg add *-install README.txt\nmkdir ../bin\nmv *.py sage-* *.sh text-* ../bin\ncd ../bin\ncp -p $SAGE_ROOT/local/bin/sage-env .\ncp -p $SAGE_ROOT/local/bin/sage-spkg .\ncp -p $SAGE_ROOT/local/bin/sage-sage sage\nhg add . *\nhg commit -m \"Trac #11073: Move base repository to root repository\"\n```\n\n4) apply [attachment:11073_root_after.patch] and [attachment:11073_prereq_install.patch] to the root repository.\n\n5)\n\n```\ncd $SAGE_ROOT/local/bin\nhg remove sage-env sage-spkg sage-sage\nhg commit -m \"Trac #11073: Move various scripts to spkg/bin\"\n```\n\n5) apply [attachment:11073_scripts.patch] to the scripts repo\n\n6) apply [attachment:11073_sagelib_misc.patch] to the main Sage repo.\n\n7) apply [attachment:11073_extcode.patch] to `data/extcode`.\n\nThe file `stdint.h_Solaris9` is not used and therefore deleted.  `sage-env`, `sage-spkg` and `sage-sage` (renamed to `sage`) are moved to `spkg/bin`, `sage-make_relative` to scripts (`local/bin`).\n\nThe script `sage-sage` is renamed to `spkg/bin/sage` and `$SAGE_ROOT` is no longer put in the $PATH, such that running \"sage\" after `sage-env` will run `$SAGE_ROOT/spkg/bin/sage`.\n\nFixes #10970 (do not generate `pipestatus`), see also #12102 (make `bzip2` a standard package) and #12206 (install `sage_scripts` earlier), #12311 (stop copying testcc.sh and testcxx.sh).\n\nAssignee: @jdemeyer\n\nCC:  @jdemeyer @kini @nexttime @williamstein\n\nKeywords: scripts base hg\n\nResolution: fixed\n\nDependencies: sage-4.8.alpha6\n\nAuthor: Volker Braun, Jeroen Demeyer\n\nReviewer: John Palmieri, William Stein\n\nMerged: sage-5.0.beta0\n\nIssue created by migration from https://trac.sagemath.org/ticket/11073\n\n",
    "closed_at": "2012-01-22T13:11:58Z",
    "created_at": "2011-03-28T19:52:55Z",
    "labels": [
        "component: build",
        "blocker"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.0",
    "title": "remove the spkg/base repo!",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11073",
    "user": "https://github.com/jhpalmieri"
}
```
Given the creation of the Sage root repo (see #9433), the repository in `SAGE_ROOT/spkg/base` should be combined with it.

1) apply [attachment:11073_root_hgignore.patch] to the root repo

2)

```
cd $SAGE_ROOT/spkg/base
rm -rf .hg* stdint.h_Solaris9 sage-*
hg add *-install README.txt
mkdir ../bin
mv *.py sage-* *.sh text-* ../bin
cd ../bin
cp -p $SAGE_ROOT/local/bin/sage-env .
cp -p $SAGE_ROOT/local/bin/sage-spkg .
cp -p $SAGE_ROOT/local/bin/sage-sage sage
hg add . *
hg commit -m "Trac #11073: Move base repository to root repository"
```

4) apply [attachment:11073_root_after.patch] and [attachment:11073_prereq_install.patch] to the root repository.

5)

```
cd $SAGE_ROOT/local/bin
hg remove sage-env sage-spkg sage-sage
hg commit -m "Trac #11073: Move various scripts to spkg/bin"
```

5) apply [attachment:11073_scripts.patch] to the scripts repo

6) apply [attachment:11073_sagelib_misc.patch] to the main Sage repo.

7) apply [attachment:11073_extcode.patch] to `data/extcode`.

The file `stdint.h_Solaris9` is not used and therefore deleted.  `sage-env`, `sage-spkg` and `sage-sage` (renamed to `sage`) are moved to `spkg/bin`, `sage-make_relative` to scripts (`local/bin`).

The script `sage-sage` is renamed to `spkg/bin/sage` and `$SAGE_ROOT` is no longer put in the $PATH, such that running "sage" after `sage-env` will run `$SAGE_ROOT/spkg/bin/sage`.

Fixes #10970 (do not generate `pipestatus`), see also #12102 (make `bzip2` a standard package) and #12206 (install `sage_scripts` earlier), #12311 (stop copying testcc.sh and testcxx.sh).

Assignee: @jdemeyer

CC:  @jdemeyer @kini @nexttime @williamstein

Keywords: scripts base hg

Resolution: fixed

Dependencies: sage-4.8.alpha6

Author: Volker Braun, Jeroen Demeyer

Reviewer: John Palmieri, William Stein

Merged: sage-5.0.beta0

Issue created by migration from https://trac.sagemath.org/ticket/11073





---

archive/issue_comments_143048.json:
```json
{
    "body": "<a id='comment:1'></a>I will take care of removing `spkg/base/sage-check-64` in sage-4.7.alpha3.",
    "created_at": "2011-03-28T20:02:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143048",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:1'></a>I will take care of removing `spkg/base/sage-check-64` in sage-4.7.alpha3.



---

archive/issue_comments_143049.json:
```json
{
    "body": "<a id='comment:2'></a>I never realised this was this duplication - it is clearly very stupid. If nothing else, copies could be replaced with links, but it would be better to do away with the repository if possible. \n\nIf the repositories can be merged, then I think that's a good idea. I don't like the idea of having a repository as a suppository of another - I think it would just add unnecessary complications. From reading about the [subrepositories](http://mercurial.selenic.com/wiki/Subrepository), I don't feel they are designed to address a need we have.",
    "created_at": "2011-03-28T21:48:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143049",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:2'></a>I never realised this was this duplication - it is clearly very stupid. If nothing else, copies could be replaced with links, but it would be better to do away with the repository if possible. 

If the repositories can be merged, then I think that's a good idea. I don't like the idea of having a repository as a suppository of another - I think it would just add unnecessary complications. From reading about the [subrepositories](http://mercurial.selenic.com/wiki/Subrepository), I don't feel they are designed to address a need we have.



---

archive/issue_comments_143050.json:
```json
{
    "body": "<a id='comment:3'></a>From what I understand of such things, using subrepositories is a huge mess. The \"proper\" usage case of a subrepository is basically what the `src/` directory inside an spkg is - i.e. a repository that is bolted on but comes from some \"upstream\" place. When you commit changes to your repository, if you've modified anything in the subrepository, it automatically commits to the subrepository too (or at least tortoisehg does on windows, if I recall correctly from when I was messing with this stuff a year ago or so), allowing you to send changesets upstream with `hg push` or what-have-you, and when someone pulls from your repository, their mercurial pulls the latest version of its subrepository from the upstream URL rather than from your copy of it, I think. Though we sage developers have a pretty non-standard mercurial workflow - nobody ever pulls from anywhere, really - so I don't know how much this matters. Still, as drkirkby says, it would just needlessly complicate matters.\n\n**tl;dr** I too support merging the repositories or getting rid of one of them over maintaining one as a subrepository of the other.",
    "created_at": "2011-04-03T05:53:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143050",
    "user": "https://github.com/kini"
}
```

<a id='comment:3'></a>From what I understand of such things, using subrepositories is a huge mess. The "proper" usage case of a subrepository is basically what the `src/` directory inside an spkg is - i.e. a repository that is bolted on but comes from some "upstream" place. When you commit changes to your repository, if you've modified anything in the subrepository, it automatically commits to the subrepository too (or at least tortoisehg does on windows, if I recall correctly from when I was messing with this stuff a year ago or so), allowing you to send changesets upstream with `hg push` or what-have-you, and when someone pulls from your repository, their mercurial pulls the latest version of its subrepository from the upstream URL rather than from your copy of it, I think. Though we sage developers have a pretty non-standard mercurial workflow - nobody ever pulls from anywhere, really - so I don't know how much this matters. Still, as drkirkby says, it would just needlessly complicate matters.

**tl;dr** I too support merging the repositories or getting rid of one of them over maintaining one as a subrepository of the other.



---

archive/issue_events_028718.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-04-12T13:15:28Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "milestone": "sage-4.7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11073#event-28718"
}
```



---

archive/issue_comments_143051.json:
```json
{
    "body": "Changing priority from minor to blocker.",
    "created_at": "2011-04-12T13:15:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143051",
    "user": "https://github.com/jdemeyer"
}
```

Changing priority from minor to blocker.



---

archive/issue_comments_143052.json:
```json
{
    "body": "<a id='comment:6'></a>Dave: in the base repository, can you explain what the files stdint.h_Solaris9, testcc.sh, and testcxx.sh are for?  I know what the last two do, but are they actually used anywhere?  I can't find any reference to them in SAGE_ROOT/local/bin or SAGE_ROOT/spkg.  Are they called by various spkg-install files?\n\nRight now, testcc.sh and testcxx.sh are copied (by the file spkg/install) to SAGE_ROOT/local/bin. If we're doing away with the base repository, should they be tracked in the Sage root repository or the scripts repository?  Since they're scripts which might be useful in general, the scripts repo might make sense.  But if they're only used in the installation process -- I don't know where they're used -- maybe the root repo makes sense.  Any opinions?",
    "created_at": "2011-04-12T19:26:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143052",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:6'></a>Dave: in the base repository, can you explain what the files stdint.h_Solaris9, testcc.sh, and testcxx.sh are for?  I know what the last two do, but are they actually used anywhere?  I can't find any reference to them in SAGE_ROOT/local/bin or SAGE_ROOT/spkg.  Are they called by various spkg-install files?

Right now, testcc.sh and testcxx.sh are copied (by the file spkg/install) to SAGE_ROOT/local/bin. If we're doing away with the base repository, should they be tracked in the Sage root repository or the scripts repository?  Since they're scripts which might be useful in general, the scripts repo might make sense.  But if they're only used in the installation process -- I don't know where they're used -- maybe the root repo makes sense.  Any opinions?



---

archive/issue_comments_143053.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [jhpalmieri](#comment%3A6):\n> Dave: in the base repository, can you explain what the files stdint.h_Solaris9, testcc.sh, and testcxx.sh are for?  I know what the last two do, but are they actually used anywhere?  I can't find any reference to them in SAGE_ROOT/local/bin or SAGE_ROOT/spkg.  Are they called by various spkg-install files?\n\n\nI'm not aware of what stdint.h_Solaris9 was supposed to do. I think Micheal added that. It's pretty dumb, as it forces a long to be 4 bytes with:\n\n```\ntypedef unsigned long       int_fast32_t;\n```\n\nwhich is obviously invalid on 64-bit builds. I recall having to create a ticket to stop including that file, as it was screwing up attempts to build Sage 64-bit on Solaris. \n\nGiven Solaris 10 came out in 2005, I don't think there's much point in worrying about Solaris 9 anyway.\n\nAs such, I think that stdint.h_Solaris9 should be deleted and if there is any issues it creates, we fix them. But I don't think it will create any problems. \n\nThe testcc.sh and testcxx.sh scripts are used in a few .spkg files. There's several .spkg files which have tests for the compilers, which would be much simplified if replaced by those scripts. \n\n> Right now, testcc.sh and testcxx.sh are copied (by the file spkg/install) to SAGE_ROOT/local/bin. If we're doing away with the base repository, should they be tracked in the Sage root repository or the scripts repository?  Since they're scripts which might be useful in general, the scripts repo might make sense.  But if they're only used in the installation process -- I don't know where they're used -- maybe the root repo makes sense.  Any opinions?\n\n\nI think the scrips repository will be ok. If nothing else, it is consistent with much of the rest of Sage. I don't think either of those scripts gets used before the sage-scripts package is installed, but I'm not 100% sure on that.",
    "created_at": "2011-04-12T23:20:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143053",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:7'></a>Replying to [jhpalmieri](#comment%3A6):
> Dave: in the base repository, can you explain what the files stdint.h_Solaris9, testcc.sh, and testcxx.sh are for?  I know what the last two do, but are they actually used anywhere?  I can't find any reference to them in SAGE_ROOT/local/bin or SAGE_ROOT/spkg.  Are they called by various spkg-install files?


I'm not aware of what stdint.h_Solaris9 was supposed to do. I think Micheal added that. It's pretty dumb, as it forces a long to be 4 bytes with:

```
typedef unsigned long       int_fast32_t;
```

which is obviously invalid on 64-bit builds. I recall having to create a ticket to stop including that file, as it was screwing up attempts to build Sage 64-bit on Solaris. 

Given Solaris 10 came out in 2005, I don't think there's much point in worrying about Solaris 9 anyway.

As such, I think that stdint.h_Solaris9 should be deleted and if there is any issues it creates, we fix them. But I don't think it will create any problems. 

The testcc.sh and testcxx.sh scripts are used in a few .spkg files. There's several .spkg files which have tests for the compilers, which would be much simplified if replaced by those scripts. 

> Right now, testcc.sh and testcxx.sh are copied (by the file spkg/install) to SAGE_ROOT/local/bin. If we're doing away with the base repository, should they be tracked in the Sage root repository or the scripts repository?  Since they're scripts which might be useful in general, the scripts repo might make sense.  But if they're only used in the installation process -- I don't know where they're used -- maybe the root repo makes sense.  Any opinions?


I think the scrips repository will be ok. If nothing else, it is consistent with much of the rest of Sage. I don't think either of those scripts gets used before the sage-scripts package is installed, but I'm not 100% sure on that.



---

archive/issue_comments_143054.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [drkirkby](#comment%3A7):\n> It's pretty dumb, as it forces a long to be 4 bytes with:\n> \n> \n> ```\n> typedef unsigned long       int_fast32_t;\n> ```\n> \n> which is obviously invalid on 64-bit builds.\n\n\nIt is invalid, but not for the reason you state.\n\nThe problem is that `int_fast32_t` is supposed to be **signed**, while `unsigned long` is **unsigned**.  As for size, the type `int_fast32_t` is required to be *at least* 32 bits, not *exactly* 32 bits, so the following would be correct, both on 32-bit and 64-bit machines:\n\n```\ntypedef long            int_fast32_t;\n```\n\nIn fact, on my 64-bit Linux laptop, the types `int_fast16_t` and `int_fast32_t` are `typedef`ed to be 64-bit `long`s.",
    "created_at": "2011-04-13T07:41:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143054",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>Replying to [drkirkby](#comment%3A7):
> It's pretty dumb, as it forces a long to be 4 bytes with:
> 
> 
> ```
> typedef unsigned long       int_fast32_t;
> ```
> 
> which is obviously invalid on 64-bit builds.


It is invalid, but not for the reason you state.

The problem is that `int_fast32_t` is supposed to be **signed**, while `unsigned long` is **unsigned**.  As for size, the type `int_fast32_t` is required to be *at least* 32 bits, not *exactly* 32 bits, so the following would be correct, both on 32-bit and 64-bit machines:

```
typedef long            int_fast32_t;
```

In fact, on my 64-bit Linux laptop, the types `int_fast16_t` and `int_fast32_t` are `typedef`ed to be 64-bit `long`s.



---

archive/issue_comments_143055.json:
```json
{
    "body": "<a id='comment:9'></a>I tried grepping through all of the spkgs and the rest of Sage.  I find no mention of stdint.h_Solaris9, so I think we should delete it.  testcxx.sh doesn't get used anywhere, but it could be useful, so we'll keep it.  testcc.sh gets used in the spkg-install file for libm4ri, so if we add testcc.sh to the scripts repo, then we need to make sure that the scripts spkg is a prerequisite for libm4ri.",
    "created_at": "2011-04-13T14:22:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143055",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:9'></a>I tried grepping through all of the spkgs and the rest of Sage.  I find no mention of stdint.h_Solaris9, so I think we should delete it.  testcxx.sh doesn't get used anywhere, but it could be useful, so we'll keep it.  testcc.sh gets used in the spkg-install file for libm4ri, so if we add testcc.sh to the scripts repo, then we need to make sure that the scripts spkg is a prerequisite for libm4ri.



---

archive/issue_comments_143056.json:
```json
{
    "body": "<a id='comment:10'></a>Regarding the files sage-env, sage-make_relative, and sage-spkg: these are currently in the scripts repo (and it makes a lot of sense for them to be there), but they get used in the Sage build process right from the start.  (There have been complaints about the role of sage-make_relative, and those might have some validity to them, but this is not the ticket to deal with that.)  Right now, the script sage-sdist copies them from the scripts repo to the base directory so they're in the right place in a new source distribution.  One of the first things that spkg/install does is to copy them back to local/bin/ so they're in the right place to be executed.\n\nSo: what should be done with these?  Move them to root repo and put links to them in local/bin?  That seems to make a lot of sense, but it doesn't feel right for some reason.  Any other ideas?",
    "created_at": "2011-04-13T16:20:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143056",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:10'></a>Regarding the files sage-env, sage-make_relative, and sage-spkg: these are currently in the scripts repo (and it makes a lot of sense for them to be there), but they get used in the Sage build process right from the start.  (There have been complaints about the role of sage-make_relative, and those might have some validity to them, but this is not the ticket to deal with that.)  Right now, the script sage-sdist copies them from the scripts repo to the base directory so they're in the right place in a new source distribution.  One of the first things that spkg/install does is to copy them back to local/bin/ so they're in the right place to be executed.

So: what should be done with these?  Move them to root repo and put links to them in local/bin?  That seems to make a lot of sense, but it doesn't feel right for some reason.  Any other ideas?



---

archive/issue_comments_143057.json:
```json
{
    "body": "<a id='comment:11'></a>Assuming I understand correctly what is going on here, why don't we keep them in local/bin and copy them to spkg/base during the -sdist process without putting the copies under revision control? spkg/install will copy them back to local/bin when building a new sage installation from source, but once we install the scripts repo, they will sync with the copy we keep under revision control in local/bin anyway. If we take `hg merge` out of local/bin/sage-spkg-install and put in `hg update -C` instead, which I think is a good idea, then we have even less to worry about.",
    "created_at": "2011-04-14T03:11:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143057",
    "user": "https://github.com/kini"
}
```

<a id='comment:11'></a>Assuming I understand correctly what is going on here, why don't we keep them in local/bin and copy them to spkg/base during the -sdist process without putting the copies under revision control? spkg/install will copy them back to local/bin when building a new sage installation from source, but once we install the scripts repo, they will sync with the copy we keep under revision control in local/bin anyway. If we take `hg merge` out of local/bin/sage-spkg-install and put in `hg update -C` instead, which I think is a good idea, then we have even less to worry about.



---

archive/issue_comments_143058.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [jhpalmieri](#comment%3A10):\n> Move them to root repo and put links to them in local/bin?  That seems to make a lot of sense, but it doesn't feel right for some reason.\n\n\nIf feels right to me...",
    "created_at": "2011-04-14T07:18:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143058",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>Replying to [jhpalmieri](#comment%3A10):
> Move them to root repo and put links to them in local/bin?  That seems to make a lot of sense, but it doesn't feel right for some reason.


If feels right to me...



---

archive/issue_comments_143059.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [jdemeyer](#comment%3A8):\n> Replying to [drkirkby](#comment%3A7):\n> > It's pretty dumb, as it forces a long to be 4 bytes with:\n> > \n> > \n> > ```\n> > typedef unsigned long       int_fast32_t;\n> > ```\n> > \n> > which is obviously invalid on 64-bit builds.\n\n> \n> It is invalid, but not for the reason you state.\n> \n> The problem is that `int_fast32_t` is supposed to be **signed**, while `unsigned long` is **unsigned**.  As for size, the type `int_fast32_t` is required to be *at least* 32 bits, not *exactly* 32 bits, so the following would be correct, both on 32-bit and 64-bit machines:\n> \n> ```\n> typedef long            int_fast32_t;\n> ```\n\n\nOn Solaris the int_fast_32 remains at 32-bits, even on 64-bit code, so what actually caused Sage to fail to compile was certainly the size rather than the sign. \n\nThat little bit of header file was included in Sage well after Sage built reliably 32-bit. It was only when I tried a 64-bit build of Sage that this became a problem. (I think a 64-bit Sage on Solaris is looking further away now, as we don't have a good solution for making sure modules are initialized properly before anything is imported from them.)\n\n## Test program\n\n```\ndrkirkby@laptop:~$ cat test.c\n#include <stdio.h>\n#include <stdlib.h>\n#include <sys/int_types.h>\n\nint main() {\n  printf(\"sizeof(int)=%d\\n\",sizeof(int));\n  printf(\"sizeof(long)=%d\\n\",sizeof(long));\n  printf(\"sizeof(int_fast32_t)=%d\\n\",sizeof(int_fast32_t));\n  exit(0);\n}\n```\n## Create a 32-bit executable and execute it\n\n```\ndrkirkby@laptop:~$ gcc  test.c\ndrkirkby@laptop:~$ ./a.out\nsizeof(int)=4\nsizeof(long)=4\nsizeof(int_fast32_t)=4\n```\n## Create a 64-bit executable and execute it\n\n```\ndrkirkby@laptop:~$ gcc  -m64 test.c\ndrkirkby@laptop:~$ ./a.out\nsizeof(int)=4\nsizeof(long)=8\nsizeof(int_fast32_t)=4\n```\n\n> In fact, on my 64-bit Linux laptop, the types `int_fast16_t` and `int_fast32_t` are `typedef`ed to be 64-bit `long`s.\n\n\nAs you can see, that's not so on Solaris, int_fast32_t remains 32-bits, even in 64-bit code. \n\nI recall using a Cray Y-MP with Unicos, where\n\n```\nsizeof(char)=1\nsizeof(short)=8\nsizeof(int)=8\nsizeof(long)=8\n```\nThe Cray is the only system I've come across where shorts are 64-bit. That tripped me up, as some code I'd written assumed shorts were 2 bytes. \n\nDave",
    "created_at": "2011-04-14T08:47:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143059",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:13'></a>Replying to [jdemeyer](#comment%3A8):
> Replying to [drkirkby](#comment%3A7):
> > It's pretty dumb, as it forces a long to be 4 bytes with:
> > 
> > 
> > ```
> > typedef unsigned long       int_fast32_t;
> > ```
> > 
> > which is obviously invalid on 64-bit builds.

> 
> It is invalid, but not for the reason you state.
> 
> The problem is that `int_fast32_t` is supposed to be **signed**, while `unsigned long` is **unsigned**.  As for size, the type `int_fast32_t` is required to be *at least* 32 bits, not *exactly* 32 bits, so the following would be correct, both on 32-bit and 64-bit machines:
> 
> ```
> typedef long            int_fast32_t;
> ```


On Solaris the int_fast_32 remains at 32-bits, even on 64-bit code, so what actually caused Sage to fail to compile was certainly the size rather than the sign. 

That little bit of header file was included in Sage well after Sage built reliably 32-bit. It was only when I tried a 64-bit build of Sage that this became a problem. (I think a 64-bit Sage on Solaris is looking further away now, as we don't have a good solution for making sure modules are initialized properly before anything is imported from them.)

## Test program

```
drkirkby@laptop:~$ cat test.c
#include <stdio.h>
#include <stdlib.h>
#include <sys/int_types.h>

int main() {
  printf("sizeof(int)=%d\n",sizeof(int));
  printf("sizeof(long)=%d\n",sizeof(long));
  printf("sizeof(int_fast32_t)=%d\n",sizeof(int_fast32_t));
  exit(0);
}
```
## Create a 32-bit executable and execute it

```
drkirkby@laptop:~$ gcc  test.c
drkirkby@laptop:~$ ./a.out
sizeof(int)=4
sizeof(long)=4
sizeof(int_fast32_t)=4
```
## Create a 64-bit executable and execute it

```
drkirkby@laptop:~$ gcc  -m64 test.c
drkirkby@laptop:~$ ./a.out
sizeof(int)=4
sizeof(long)=8
sizeof(int_fast32_t)=4
```

> In fact, on my 64-bit Linux laptop, the types `int_fast16_t` and `int_fast32_t` are `typedef`ed to be 64-bit `long`s.


As you can see, that's not so on Solaris, int_fast32_t remains 32-bits, even in 64-bit code. 

I recall using a Cray Y-MP with Unicos, where

```
sizeof(char)=1
sizeof(short)=8
sizeof(int)=8
sizeof(long)=8
```
The Cray is the only system I've come across where shorts are 64-bit. That tripped me up, as some code I'd written assumed shorts were 2 bytes. 

Dave



---

archive/issue_comments_143060.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [jhpalmieri](#comment%3A9):\n>  testcc.sh gets used in the spkg-install file for libm4ri, so if we add testcc.sh to the scripts repo, then we need to make sure that the scripts spkg is a prerequisite for libm4ri.\n\n\nHaving thought about this more, I think it would be better if they were in the root repository. \n\nThere are lots of bits of code in Sage which are testing if the compilers are Sun or GNU. Those bits could be dramatically simplified by using the `testcc.sh` and `testcxx.sh` scripts. Look in rubiks for example. There are probably 20 or more spkg-install scripts which are using some test for the Sun compiler in one form or another. I've just never got around to re-writing them to use those scripts, but long-term it would be more sensible to remove a lot of things from numerous spkg-install scripts and use the more portable and robust scripts. \n\nAs such, I think it might be better if those scripts were available early on, which would be achieved by having them in the root repository.",
    "created_at": "2011-04-14T09:12:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143060",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:14'></a>Replying to [jhpalmieri](#comment%3A9):
>  testcc.sh gets used in the spkg-install file for libm4ri, so if we add testcc.sh to the scripts repo, then we need to make sure that the scripts spkg is a prerequisite for libm4ri.


Having thought about this more, I think it would be better if they were in the root repository. 

There are lots of bits of code in Sage which are testing if the compilers are Sun or GNU. Those bits could be dramatically simplified by using the `testcc.sh` and `testcxx.sh` scripts. Look in rubiks for example. There are probably 20 or more spkg-install scripts which are using some test for the Sun compiler in one form or another. I've just never got around to re-writing them to use those scripts, but long-term it would be more sensible to remove a lot of things from numerous spkg-install scripts and use the more portable and robust scripts. 

As such, I think it might be better if those scripts were available early on, which would be achieved by having them in the root repository.



---

archive/issue_comments_143061.json:
```json
{
    "body": "<a id='comment:15'></a>Copying files between root and scripts repositories is horrible. We can't make relative symlinks from `$SAGE_LOCAL` to `$SAGE_ROOT` since they might be unrelated directories. I think the best solution is to have small shell scripts in the scripts repository that call the script in the sage root repository. It seems that this is only `sage-env` and the `testcc.sh`, `testcxx.sh` scripts.\n\nPatch instructions:\n\n1) remove everything but the tar archives from spkg/base\n\n```\ncd $SAGE_ROOT/spkg/base\nrm -rf .hg *-install README.txt sage-* test*sh stdint.h_Solaris9\n```\n\n2) apply trac_11073_remove_base_repo.patch to the root repo\n\n3) apply trac_11073_stop_copying_stuff.patch to the root repo\n\n4) apply trac_11073_stubs_for_base.patch to the scripts repo\n\nSome notes about files formerly in the spkg/base repository:\n* `stdint.h_Solaris9`: deleted\n* `sage-spkg`: deleted from sage_scripts, should live in sage_root only. \n* `sage-env`: replaced by stub in sage_scripts. \n* `testcc.sh`, `testcxx.sh`: replaced by stub in sage_scripts\n* `sage-make_relative`: was a Python script, but base doesn't have Python yet ?!?. Deleted.",
    "created_at": "2011-05-30T03:07:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143061",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:15'></a>Copying files between root and scripts repositories is horrible. We can't make relative symlinks from `$SAGE_LOCAL` to `$SAGE_ROOT` since they might be unrelated directories. I think the best solution is to have small shell scripts in the scripts repository that call the script in the sage root repository. It seems that this is only `sage-env` and the `testcc.sh`, `testcxx.sh` scripts.

Patch instructions:

1) remove everything but the tar archives from spkg/base

```
cd $SAGE_ROOT/spkg/base
rm -rf .hg *-install README.txt sage-* test*sh stdint.h_Solaris9
```

2) apply trac_11073_remove_base_repo.patch to the root repo

3) apply trac_11073_stop_copying_stuff.patch to the root repo

4) apply trac_11073_stubs_for_base.patch to the scripts repo

Some notes about files formerly in the spkg/base repository:
* `stdint.h_Solaris9`: deleted
* `sage-spkg`: deleted from sage_scripts, should live in sage_root only. 
* `sage-env`: replaced by stub in sage_scripts. 
* `testcc.sh`, `testcxx.sh`: replaced by stub in sage_scripts
* `sage-make_relative`: was a Python script, but base doesn't have Python yet ?!?. Deleted.



---

archive/issue_comments_143062.json:
```json
{
    "body": "Changing author from \"\" to \"Volker Braun\"",
    "created_at": "2011-05-30T03:07:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143062",
    "user": "https://github.com/vbraun"
}
```

Changing author from "" to "Volker Braun"



---

archive/issue_comments_143063.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-05-30T03:17:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143063",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_143064.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,12 +1,21 @@\n-Given the creation of the Sage root repo (see #9433), perhaps the repository in SAGE_ROOT/spkg/base should be combined with it.  See [this page](http://mercurial.selenic.com/wiki/MergingUnrelatedRepositories) for one way to merge Mercurial repositories; another option would be to keep the base repo as a [subrepository](http://mercurial.selenic.com/wiki/Subrepository) of the root repo.\n+Given the creation of the Sage root repo (see #9433), the repository in `SAGE_ROOT/spkg/base` should be combined with it.\n \n-Is there a good way to avoid the current duplication between SAGE_ROOT/local/bin and SAGE_ROOT/spkg/base?  Right now, both contain identical copies of the scripts sage-env, sage-spkg, and sage-make_relative, courtesy of the sage-sdist script, but if the copies somehow get out of sync, then building from scratch tends to break.\n-\n-One small issue which should be fixed regardless: from SAGE_ROOT:\n+1) remove everything but the tar archives from spkg/base\n \n ```\n-$ cd spkg/base\n-$ hg status\n-? sage-check-64\n+cd $SAGE_ROOT/spkg/base\n+rm -rf .hg .hgignore *-install README.txt sage-* test*sh stdint.h_Solaris9\n ```\n-The script sage-check-64 should be removed from this directory.  (It was added, but .hgignore wasn't modified, when #10303 was merged, and then it wasn't removed when #10303 was backed out.)\n+\n+2) apply [attachment:trac_11073_remove_base_repo.patch] to the root repo\n+\n+3) apply [attachment:trac_11073_stop_copying_stuff.patch] to the root repo\n+\n+4) apply [attachment:trac_11073_stubs_for_base.patch] to the scripts repo\n+\n+Some notes about files formerly in the spkg/base repository:\n+* `stdint.h_Solaris9`: deleted\n+* `sage-spkg`: deleted from sage_scripts, should live in sage_root only.\n+* `sage-env`: replaced by stub in sage_scripts.\n+* `testcc.sh`, `testcxx.sh`: replaced by stub in sage_scripts\n+* `sage-make_relative`: was a Python script, but base doesn't have Python yet ?!?. Deleted.\n``````\n",
    "created_at": "2011-05-30T16:11:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143064",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,12 +1,21 @@
-Given the creation of the Sage root repo (see #9433), perhaps the repository in SAGE_ROOT/spkg/base should be combined with it.  See [this page](http://mercurial.selenic.com/wiki/MergingUnrelatedRepositories) for one way to merge Mercurial repositories; another option would be to keep the base repo as a [subrepository](http://mercurial.selenic.com/wiki/Subrepository) of the root repo.
+Given the creation of the Sage root repo (see #9433), the repository in `SAGE_ROOT/spkg/base` should be combined with it.
 
-Is there a good way to avoid the current duplication between SAGE_ROOT/local/bin and SAGE_ROOT/spkg/base?  Right now, both contain identical copies of the scripts sage-env, sage-spkg, and sage-make_relative, courtesy of the sage-sdist script, but if the copies somehow get out of sync, then building from scratch tends to break.
-
-One small issue which should be fixed regardless: from SAGE_ROOT:
+1) remove everything but the tar archives from spkg/base
 
 ```
-$ cd spkg/base
-$ hg status
-? sage-check-64
+cd $SAGE_ROOT/spkg/base
+rm -rf .hg .hgignore *-install README.txt sage-* test*sh stdint.h_Solaris9
 ```
-The script sage-check-64 should be removed from this directory.  (It was added, but .hgignore wasn't modified, when #10303 was merged, and then it wasn't removed when #10303 was backed out.)
+
+2) apply [attachment:trac_11073_remove_base_repo.patch] to the root repo
+
+3) apply [attachment:trac_11073_stop_copying_stuff.patch] to the root repo
+
+4) apply [attachment:trac_11073_stubs_for_base.patch] to the scripts repo
+
+Some notes about files formerly in the spkg/base repository:
+* `stdint.h_Solaris9`: deleted
+* `sage-spkg`: deleted from sage_scripts, should live in sage_root only.
+* `sage-env`: replaced by stub in sage_scripts.
+* `testcc.sh`, `testcxx.sh`: replaced by stub in sage_scripts
+* `sage-make_relative`: was a Python script, but base doesn't have Python yet ?!?. Deleted.
``````




---

archive/issue_comments_143065.json:
```json
{
    "body": "<a id='comment:17'></a>Forgot to delete `SAGE_ROOT/spkg/base/.hgignore`, instructions moved to ticket description so they can be edited.",
    "created_at": "2011-05-30T16:11:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143065",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:17'></a>Forgot to delete `SAGE_ROOT/spkg/base/.hgignore`, instructions moved to ticket description so they can be edited.



---

archive/issue_comments_143066.json:
```json
{
    "body": "Attachment [trac_11073_stubs_for_base.patch](tarball://root/attachments/some-uuid/ticket11073/trac_11073_stubs_for_base.patch) by @vbraun created at 2011-05-30 19:31:51\n\nUpdated patch",
    "created_at": "2011-05-30T19:31:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143066",
    "user": "https://github.com/vbraun"
}
```

Attachment [trac_11073_stubs_for_base.patch](tarball://root/attachments/some-uuid/ticket11073/trac_11073_stubs_for_base.patch) by @vbraun created at 2011-05-30 19:31:51

Updated patch



---

archive/issue_comments_143067.json:
```json
{
    "body": "Updated patch",
    "created_at": "2011-05-30T19:32:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143067",
    "user": "https://github.com/vbraun"
}
```

Updated patch



---

archive/issue_comments_143068.json:
```json
{
    "body": "Attachment [trac_11073_remove_base_repo.patch](tarball://root/attachments/some-uuid/ticket11073/trac_11073_remove_base_repo.patch) by @vbraun created at 2011-05-30 19:32:12\n\nUpdated patch",
    "created_at": "2011-05-30T19:32:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143068",
    "user": "https://github.com/vbraun"
}
```

Attachment [trac_11073_remove_base_repo.patch](tarball://root/attachments/some-uuid/ticket11073/trac_11073_remove_base_repo.patch) by @vbraun created at 2011-05-30 19:32:12

Updated patch



---

archive/issue_comments_143069.json:
```json
{
    "body": "<a id='comment:18'></a>Updated for Sage-4.7.1.alpha1",
    "created_at": "2011-05-30T19:32:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143069",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:18'></a>Updated for Sage-4.7.1.alpha1



---

archive/issue_comments_143070.json:
```json
{
    "body": "<a id='comment:19'></a>Upgrading doesn't work, the sage_root repository is upgraded near the end of the upgrade process since the spkg depends on mercurial...",
    "created_at": "2011-05-31T13:04:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143070",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:19'></a>Upgrading doesn't work, the sage_root repository is upgraded near the end of the upgrade process since the spkg depends on mercurial...



---

archive/issue_comments_143071.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-05-31T13:04:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143071",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_143072.json:
```json
{
    "body": "<a id='comment:21'></a>Replying to [vbraun](#comment%3A15):\n>   * `sage-make_relative`: was a Python script, but base doesn't have Python yet ?!?. Deleted.\n\n\nFor the record: This funny [...] script is called from `sage-spkg`:\n\n```sh\n...\necho \"Making Sage/Python scripts relocatable...\"\n\ncd \"$SAGE_LOCAL\"/bin\n./sage-make_relative\n\necho \"Finished installing $PKG_NAME.spkg\" \n\n# It's OK if the above fails -- in fact it will until Python\n# itself gets installed. That's fine. \nexit 0   \n```",
    "created_at": "2011-07-03T18:04:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143072",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:21'></a>Replying to [vbraun](#comment%3A15):
>   * `sage-make_relative`: was a Python script, but base doesn't have Python yet ?!?. Deleted.


For the record: This funny [...] script is called from `sage-spkg`:

```sh
...
echo "Making Sage/Python scripts relocatable..."

cd "$SAGE_LOCAL"/bin
./sage-make_relative

echo "Finished installing $PKG_NAME.spkg" 

# It's OK if the above fails -- in fact it will until Python
# itself gets installed. That's fine. 
exit 0   
```



---

archive/issue_comments_143073.json:
```json
{
    "body": "<a id='comment:22'></a>Any more news here? I'm about to submit a patch to #3052 that adds files to the spkg/base repo :(",
    "created_at": "2011-08-11T01:58:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143073",
    "user": "https://github.com/kini"
}
```

<a id='comment:22'></a>Any more news here? I'm about to submit a patch to #3052 that adds files to the spkg/base repo :(



---

archive/issue_comments_143074.json:
```json
{
    "body": "<a id='comment:24'></a>See #10970 for a somewhat related ticket (at least the discussion there touches on similar issues with the Sage root repo).",
    "created_at": "2011-08-11T16:38:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143074",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:24'></a>See #10970 for a somewhat related ticket (at least the discussion there touches on similar issues with the Sage root repo).



---

archive/issue_comments_143075.json:
```json
{
    "body": "<a id='comment:25'></a>Replying to [leif](#comment%3A21):\n> Replying to [vbraun](#comment%3A15):\n> >   * `sage-make_relative`: was a Python script, but base doesn't have Python yet ?!?. Deleted.\n \n> \n> For the record: This funny [...] script is called from `sage-spkg`:\n\n{{{#!sh\n...\necho \"Making Sage/Python scripts relocatable...\"\n\ncd \"$SAGE_LOCAL\"/bin\n./sage-make_relative\n\necho \"Finished installing $PKG_NAME.spkg\" \n\n# It's OK if the above fails -- in fact it will until Python\n# itself gets installed. That's fine. \nexit 0   \n}}}\n\nI recall having changed this (such that `sage-make_relative` only gets called if Sage's Python is already installed), but it's not yet in 4.7.2, and I don't recall the ticket.\n\nAnyway, `sage-make_relative` itself should be present from the beginning, although we could do the same thing (and a bit smarter) directly in `sage-spkg`, AFAIK the only script from where it's used.",
    "created_at": "2011-11-06T01:34:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143075",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:25'></a>Replying to [leif](#comment%3A21):
> Replying to [vbraun](#comment%3A15):
> >   * `sage-make_relative`: was a Python script, but base doesn't have Python yet ?!?. Deleted.
 
> 
> For the record: This funny [...] script is called from `sage-spkg`:

{{{#!sh
...
echo "Making Sage/Python scripts relocatable..."

cd "$SAGE_LOCAL"/bin
./sage-make_relative

echo "Finished installing $PKG_NAME.spkg" 

# It's OK if the above fails -- in fact it will until Python
# itself gets installed. That's fine. 
exit 0   
}}}

I recall having changed this (such that `sage-make_relative` only gets called if Sage's Python is already installed), but it's not yet in 4.7.2, and I don't recall the ticket.

Anyway, `sage-make_relative` itself should be present from the beginning, although we could do the same thing (and a bit smarter) directly in `sage-spkg`, AFAIK the only script from where it's used.



---

archive/issue_comments_143076.json:
```json
{
    "body": "<a id='comment:26'></a>Replying to [leif](#comment%3A25):\n> I recall having changed this (such that `sage-make_relative` only gets called if Sage's Python is already installed), but it's not yet in 4.7.2, and I don't recall the ticket.\n\n\nAh, #9992, merged into Sage 4.8.alpha0, formerly known as 4.7.3.alpha0.",
    "created_at": "2011-11-06T01:42:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143076",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:26'></a>Replying to [leif](#comment%3A25):
> I recall having changed this (such that `sage-make_relative` only gets called if Sage's Python is already installed), but it's not yet in 4.7.2, and I don't recall the ticket.


Ah, #9992, merged into Sage 4.8.alpha0, formerly known as 4.7.3.alpha0.



---

archive/issue_comments_143077.json:
```json
{
    "body": "<a id='comment:27'></a>Simpler solution instead of making stubs in `SAGE_ROOT/local/bin`:\n1. Create a new directory `SAGE_ROOT/spkg/bin`\n2. Put `sage-env`, `sage-spkg`,... there and not in `sage_scripts`, nor stubs in `sage_scripts`\n3. In `sage-env`, add `SAGE_ROOT/spkg/bin` to the path\n4. Make `sage-sage` and `sage-spkg` find the new `sage-env`",
    "created_at": "2011-11-30T11:12:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143077",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:27'></a>Simpler solution instead of making stubs in `SAGE_ROOT/local/bin`:
1. Create a new directory `SAGE_ROOT/spkg/bin`
2. Put `sage-env`, `sage-spkg`,... there and not in `sage_scripts`, nor stubs in `sage_scripts`
3. In `sage-env`, add `SAGE_ROOT/spkg/bin` to the path
4. Make `sage-sage` and `sage-spkg` find the new `sage-env`



---

archive/issue_comments_143078.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -18,4 +18,6 @@\n * `sage-spkg`: deleted from sage_scripts, should live in sage_root only.\n * `sage-env`: replaced by stub in sage_scripts.\n * `testcc.sh`, `testcxx.sh`: replaced by stub in sage_scripts\n-* `sage-make_relative`: was a Python script, but base doesn't have Python yet ?!?. Deleted.\n+* `sage-make_relative`: ???\n+\n+See also #12102 (make bzip2 a standard package)\n``````\n",
    "created_at": "2011-11-30T11:12:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143078",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -18,4 +18,6 @@
 * `sage-spkg`: deleted from sage_scripts, should live in sage_root only.
 * `sage-env`: replaced by stub in sage_scripts.
 * `testcc.sh`, `testcxx.sh`: replaced by stub in sage_scripts
-* `sage-make_relative`: was a Python script, but base doesn't have Python yet ?!?. Deleted.
+* `sage-make_relative`: ???
+
+See also #12102 (make bzip2 a standard package)
``````




---

archive/issue_comments_143079.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,17 +1,23 @@\n Given the creation of the Sage root repo (see #9433), the repository in `SAGE_ROOT/spkg/base` should be combined with it.\n \n-1) remove everything but the tar archives from spkg/base\n+1) apply [attachment:11073_root.patch] to the root repo\n+\n+2)\n \n ```\n cd $SAGE_ROOT/spkg/base\n-rm -rf .hg .hgignore *-install README.txt sage-* test*sh stdint.h_Solaris9\n+rm -rf .hg* stdint.h_Solaris9\n+hg add *-install\n+mkdir ../bin\n+mv *.py sage-* *.sh text-* ../bin\n+cd ../bin\n+hg add . *\n+hg commit -m \"Trac #11073: Move base repository to root repository\"\n ```\n \n-2) apply [attachment:trac_11073_remove_base_repo.patch] to the root repo\n+4) apply [attachment:trac_11073_stop_copying_stuff.patch] to the root repo\n \n-3) apply [attachment:trac_11073_stop_copying_stuff.patch] to the root repo\n-\n-4) apply [attachment:trac_11073_stubs_for_base.patch] to the scripts repo\n+5) apply [attachment:trac_11073_stubs_for_base.patch] to the scripts repo\n \n Some notes about files formerly in the spkg/base repository:\n * `stdint.h_Solaris9`: deleted\n``````\n",
    "created_at": "2011-11-30T15:34:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143079",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,17 +1,23 @@
 Given the creation of the Sage root repo (see #9433), the repository in `SAGE_ROOT/spkg/base` should be combined with it.
 
-1) remove everything but the tar archives from spkg/base
+1) apply [attachment:11073_root.patch] to the root repo
+
+2)
 
 ```
 cd $SAGE_ROOT/spkg/base
-rm -rf .hg .hgignore *-install README.txt sage-* test*sh stdint.h_Solaris9
+rm -rf .hg* stdint.h_Solaris9
+hg add *-install
+mkdir ../bin
+mv *.py sage-* *.sh text-* ../bin
+cd ../bin
+hg add . *
+hg commit -m "Trac #11073: Move base repository to root repository"
 ```
 
-2) apply [attachment:trac_11073_remove_base_repo.patch] to the root repo
+4) apply [attachment:trac_11073_stop_copying_stuff.patch] to the root repo
 
-3) apply [attachment:trac_11073_stop_copying_stuff.patch] to the root repo
-
-4) apply [attachment:trac_11073_stubs_for_base.patch] to the scripts repo
+5) apply [attachment:trac_11073_stubs_for_base.patch] to the scripts repo
 
 Some notes about files formerly in the spkg/base repository:
 * `stdint.h_Solaris9`: deleted
``````




---

archive/issue_comments_143080.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -7,7 +7,7 @@\n ```\n cd $SAGE_ROOT/spkg/base\n rm -rf .hg* stdint.h_Solaris9\n-hg add *-install\n+hg add *-install README.txt\n mkdir ../bin\n mv *.py sage-* *.sh text-* ../bin\n cd ../bin\n@@ -19,11 +19,6 @@\n \n 5) apply [attachment:trac_11073_stubs_for_base.patch] to the scripts repo\n \n-Some notes about files formerly in the spkg/base repository:\n-* `stdint.h_Solaris9`: deleted\n-* `sage-spkg`: deleted from sage_scripts, should live in sage_root only.\n-* `sage-env`: replaced by stub in sage_scripts.\n-* `testcc.sh`, `testcxx.sh`: replaced by stub in sage_scripts\n-* `sage-make_relative`: ???\n+The file `stdint.h_Solaris9` is not used and therefore deleted.\n \n See also #12102 (make bzip2 a standard package)\n``````\n",
    "created_at": "2011-11-30T15:36:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143080",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -7,7 +7,7 @@
 ```
 cd $SAGE_ROOT/spkg/base
 rm -rf .hg* stdint.h_Solaris9
-hg add *-install
+hg add *-install README.txt
 mkdir ../bin
 mv *.py sage-* *.sh text-* ../bin
 cd ../bin
@@ -19,11 +19,6 @@
 
 5) apply [attachment:trac_11073_stubs_for_base.patch] to the scripts repo
 
-Some notes about files formerly in the spkg/base repository:
-* `stdint.h_Solaris9`: deleted
-* `sage-spkg`: deleted from sage_scripts, should live in sage_root only.
-* `sage-env`: replaced by stub in sage_scripts.
-* `testcc.sh`, `testcxx.sh`: replaced by stub in sage_scripts
-* `sage-make_relative`: ???
+The file `stdint.h_Solaris9` is not used and therefore deleted.
 
 See also #12102 (make bzip2 a standard package)
``````




---

archive/issue_comments_143081.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -15,9 +15,17 @@\n hg commit -m \"Trac #11073: Move base repository to root repository\"\n ```\n \n-4) apply [attachment:trac_11073_stop_copying_stuff.patch] to the root repo\n+4) apply [attachment:11073_stop_copying_stuff.v2.patch] to the root repo\n \n-5) apply [attachment:trac_11073_stubs_for_base.patch] to the scripts repo\n+5)\n+\n+```\n+cd $SAGE_ROOT/local/bin\n+hg remove sage-env sage-make_relative sage-spkg\n+hg commit -m \"Trac #11073: Move various scripts to spkg/bin\"\n+```\n+\n+5) apply [attachment:11073_scripts.patch] to the scripts repo\n \n The file `stdint.h_Solaris9` is not used and therefore deleted.\n \n``````\n",
    "created_at": "2011-11-30T15:51:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143081",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -15,9 +15,17 @@
 hg commit -m "Trac #11073: Move base repository to root repository"
 ```
 
-4) apply [attachment:trac_11073_stop_copying_stuff.patch] to the root repo
+4) apply [attachment:11073_stop_copying_stuff.v2.patch] to the root repo
 
-5) apply [attachment:trac_11073_stubs_for_base.patch] to the scripts repo
+5)
+
+```
+cd $SAGE_ROOT/local/bin
+hg remove sage-env sage-make_relative sage-spkg
+hg commit -m "Trac #11073: Move various scripts to spkg/bin"
+```
+
+5) apply [attachment:11073_scripts.patch] to the scripts repo
 
 The file `stdint.h_Solaris9` is not used and therefore deleted.
 
``````




---

archive/issue_comments_143082.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -15,7 +15,7 @@\n hg commit -m \"Trac #11073: Move base repository to root repository\"\n ```\n \n-4) apply [attachment:11073_stop_copying_stuff.v2.patch] to the root repo\n+4) apply [attachment:11073_root_part2.patch] to the root repo\n \n 5)\n \n``````\n",
    "created_at": "2011-11-30T16:03:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143082",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -15,7 +15,7 @@
 hg commit -m "Trac #11073: Move base repository to root repository"
 ```
 
-4) apply [attachment:11073_stop_copying_stuff.v2.patch] to the root repo
+4) apply [attachment:11073_root_part2.patch] to the root repo
 
 5)
 
``````




---

archive/issue_events_028719.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-12-02T10:13:06Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "milestone": "sage-4.7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11073#event-28719"
}
```



---

archive/issue_events_028720.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-12-02T10:13:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "milestone": "sage-5.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11073#event-28720"
}
```



---

archive/issue_comments_143083.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2011-12-02T10:13:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143083",
    "user": "https://github.com/jdemeyer"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_143084.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -7,9 +7,9 @@\n ```\n cd $SAGE_ROOT/spkg/base\n rm -rf .hg* stdint.h_Solaris9\n-hg add *-install README.txt\n mkdir ../bin\n mv *.py sage-* *.sh text-* ../bin\n+hg add *\n cd ../bin\n hg add . *\n hg commit -m \"Trac #11073: Move base repository to root repository\"\n``````\n",
    "created_at": "2011-12-02T10:13:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143084",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -7,9 +7,9 @@
 ```
 cd $SAGE_ROOT/spkg/base
 rm -rf .hg* stdint.h_Solaris9
-hg add *-install README.txt
 mkdir ../bin
 mv *.py sage-* *.sh text-* ../bin
+hg add *
 cd ../bin
 hg add . *
 hg commit -m "Trac #11073: Move base repository to root repository"
``````




---

archive/issue_comments_143085.json:
```json
{
    "body": "Changing assignee from GeorgSWeber to @jdemeyer.",
    "created_at": "2011-12-02T10:13:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143085",
    "user": "https://github.com/jdemeyer"
}
```

Changing assignee from GeorgSWeber to @jdemeyer.



---

archive/issue_comments_143086.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -7,9 +7,9 @@\n ```\n cd $SAGE_ROOT/spkg/base\n rm -rf .hg* stdint.h_Solaris9\n+hg add *-install README.txt\n mkdir ../bin\n mv *.py sage-* *.sh text-* ../bin\n-hg add *\n cd ../bin\n hg add . *\n hg commit -m \"Trac #11073: Move base repository to root repository\"\n``````\n",
    "created_at": "2011-12-02T10:14:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143086",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -7,9 +7,9 @@
 ```
 cd $SAGE_ROOT/spkg/base
 rm -rf .hg* stdint.h_Solaris9
+hg add *-install README.txt
 mkdir ../bin
 mv *.py sage-* *.sh text-* ../bin
-hg add *
 cd ../bin
 hg add . *
 hg commit -m "Trac #11073: Move base repository to root repository"
``````




---

archive/issue_comments_143087.json:
```json
{
    "body": "Changing work_issues from \"\" to \"Fix sage -sdist to copy spkg/base/*.tar*\"",
    "created_at": "2011-12-02T10:20:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143087",
    "user": "https://github.com/jdemeyer"
}
```

Changing work_issues from "" to "Fix sage -sdist to copy spkg/base/*.tar*"



---

archive/issue_comments_143088.json:
```json
{
    "body": "Changing author from \"Volker Braun\" to \"Volker Braun, Jeroen Demeyer\"",
    "created_at": "2011-12-02T10:20:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143088",
    "user": "https://github.com/jdemeyer"
}
```

Changing author from "Volker Braun" to "Volker Braun, Jeroen Demeyer"



---

archive/issue_comments_143089.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#12057\"",
    "created_at": "2011-12-02T14:21:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143089",
    "user": "https://github.com/jdemeyer"
}
```

Changing dependencies from "" to "#12057"



---

archive/issue_comments_143090.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -15,7 +15,7 @@\n hg commit -m \"Trac #11073: Move base repository to root repository\"\n ```\n \n-4) apply [attachment:11073_root_part2.patch] to the root repo\n+4) apply [attachment:11073_root_after.patch] to the root repo\n \n 5)\n \n``````\n",
    "created_at": "2011-12-06T10:12:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143090",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -15,7 +15,7 @@
 hg commit -m "Trac #11073: Move base repository to root repository"
 ```
 
-4) apply [attachment:11073_root_part2.patch] to the root repo
+4) apply [attachment:11073_root_after.patch] to the root repo
 
 5)
 
``````




---

archive/issue_comments_143091.json:
```json
{
    "body": "Changing work_issues from \"Fix sage -sdist to copy spkg/base/*.tar*\" to \"Fix upgrading\"",
    "created_at": "2011-12-06T10:12:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143091",
    "user": "https://github.com/jdemeyer"
}
```

Changing work_issues from "Fix sage -sdist to copy spkg/base/*.tar*" to "Fix upgrading"



---

archive/issue_comments_143092.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -29,4 +29,4 @@\n \n The file `stdint.h_Solaris9` is not used and therefore deleted.\n \n-See also #12102 (make bzip2 a standard package)\n+See also #10970 (do not generate `pipestatus`), #12102 (make `bzip2` a standard package)\n``````\n",
    "created_at": "2011-12-06T10:16:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143092",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -29,4 +29,4 @@
 
 The file `stdint.h_Solaris9` is not used and therefore deleted.
 
-See also #12102 (make bzip2 a standard package)
+See also #10970 (do not generate `pipestatus`), #12102 (make `bzip2` a standard package)
``````




---

archive/issue_comments_143093.json:
```json
{
    "body": "<a id='comment:38'></a>In root-spkg-install, line 18, from [attachment:11073_root_after.patch], should the last character be deleted?\n\n```\nrm -rf .hg* json_bundle.py stdint.h_Solaris9 sage-* text-* *.sh ) \n```",
    "created_at": "2011-12-06T18:07:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143093",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:38'></a>In root-spkg-install, line 18, from [attachment:11073_root_after.patch], should the last character be deleted?

```
rm -rf .hg* json_bundle.py stdint.h_Solaris9 sage-* text-* *.sh ) 
```



---

archive/issue_comments_143094.json:
```json
{
    "body": "<a id='comment:39'></a>Replying to [jhpalmieri](#comment%3A38):\n> In root-spkg-install, line 18, from [attachment:11073_root_after.patch], should the last character be deleted?\n> \n> ```\n> rm -rf .hg* json_bundle.py stdint.h_Solaris9 sage-* text-* *.sh ) \n> ```\n\nYes, thanks.\n\nI believe this ticket is almost ready, it builds and tests fine, sdist and bdist work.  The main thing still left to do is to test upgrading.",
    "created_at": "2011-12-06T19:39:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143094",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:39'></a>Replying to [jhpalmieri](#comment%3A38):
> In root-spkg-install, line 18, from [attachment:11073_root_after.patch], should the last character be deleted?
> 
> ```
> rm -rf .hg* json_bundle.py stdint.h_Solaris9 sage-* text-* *.sh ) 
> ```

Yes, thanks.

I believe this ticket is almost ready, it builds and tests fine, sdist and bdist work.  The main thing still left to do is to test upgrading.



---

archive/issue_comments_143095.json:
```json
{
    "body": "<a id='comment:40'></a>Can anybody here please review #12122: it adds a short doctest that `sage-make_relative` is functional.  I created it while working on this ticket because at some point `sage-make_relative` broke without me realizing it.",
    "created_at": "2011-12-06T21:06:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143095",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:40'></a>Can anybody here please review #12122: it adds a short doctest that `sage-make_relative` is functional.  I created it while working on this ticket because at some point `sage-make_relative` broke without me realizing it.



---

archive/issue_comments_143096.json:
```json
{
    "body": "<a id='comment:41'></a>Upgrading to sage-4.7.2 failed because of trying to \"hg merge\" on top of a hg-untracked file:\n\n```\n****************************************************\nnothing changed\npulling from /mnt/usb1/scratch/jdemeyer/sage-4.7.2/spkg/build/sage_root-4.8.alpha3-remove-base\nsearching for changes\nadding changesets\nadding manifests\nadding file changes\nadded 17 changesets with 40 changes to 21 files (+1 heads)\n(run 'hg heads' to see heads, 'hg merge' to merge)\nabort: untracked file in working directory differs from file in requested revision: 'spkg/bin/sage-env'\nnothing changed\nabort: crosses branches (merge branches or use --check to force update)\n'hg update' failed\n\nreal    0m0.922s\nuser    0m0.610s\nsys     0m0.260s\nsage: An error occurred while installing sage_root-4.8.alpha3-remove-base\n```",
    "created_at": "2011-12-08T22:42:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143096",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:41'></a>Upgrading to sage-4.7.2 failed because of trying to "hg merge" on top of a hg-untracked file:

```
****************************************************
nothing changed
pulling from /mnt/usb1/scratch/jdemeyer/sage-4.7.2/spkg/build/sage_root-4.8.alpha3-remove-base
searching for changes
adding changesets
adding manifests
adding file changes
added 17 changesets with 40 changes to 21 files (+1 heads)
(run 'hg heads' to see heads, 'hg merge' to merge)
abort: untracked file in working directory differs from file in requested revision: 'spkg/bin/sage-env'
nothing changed
abort: crosses branches (merge branches or use --check to force update)
'hg update' failed

real    0m0.922s
user    0m0.610s
sys     0m0.260s
sage: An error occurred while installing sage_root-4.8.alpha3-remove-base
```



---

archive/issue_comments_143097.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -15,7 +15,7 @@\n hg commit -m \"Trac #11073: Move base repository to root repository\"\n ```\n \n-4) apply [attachment:11073_root_after.patch] to the root repo\n+4) apply [attachment:11073_root_after.patch] and [attachment:11073_root_part2.patch] to the root repo\n \n 5)\n \n``````\n",
    "created_at": "2011-12-08T22:44:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143097",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -15,7 +15,7 @@
 hg commit -m "Trac #11073: Move base repository to root repository"
 ```
 
-4) apply [attachment:11073_root_after.patch] to the root repo
+4) apply [attachment:11073_root_after.patch] and [attachment:11073_root_part2.patch] to the root repo
 
 5)
 
``````




---

archive/issue_comments_143098.json:
```json
{
    "body": "Changing dependencies from \"#12057\" to \"#12057, #12128\"",
    "created_at": "2011-12-09T13:50:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143098",
    "user": "https://github.com/jdemeyer"
}
```

Changing dependencies from "#12057" to "#12057, #12128"



---

archive/issue_comments_143099.json:
```json
{
    "body": "<a id='comment:44'></a>Wow, I just realized that the base repo was never actually updated on upgrade.  We cannot retro-actively fix the `sage-update` script of previous Sage versions to fix this.  So this is going to remain.",
    "created_at": "2011-12-09T23:47:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143099",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:44'></a>Wow, I just realized that the base repo was never actually updated on upgrade.  We cannot retro-actively fix the `sage-update` script of previous Sage versions to fix this.  So this is going to remain.



---

archive/issue_comments_143100.json:
```json
{
    "body": "Attachment [11073_prereq_install.patch](tarball://root/attachments/some-uuid/ticket11073/11073_prereq_install.patch) by @jdemeyer created at 2011-12-10 00:06:52",
    "created_at": "2011-12-10T00:06:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143100",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [11073_prereq_install.patch](tarball://root/attachments/some-uuid/ticket11073/11073_prereq_install.patch) by @jdemeyer created at 2011-12-10 00:06:52



---

archive/issue_comments_143101.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -15,7 +15,7 @@\n hg commit -m \"Trac #11073: Move base repository to root repository\"\n ```\n \n-4) apply [attachment:11073_root_after.patch] and [attachment:11073_root_part2.patch] to the root repo\n+4) apply [attachment:11073_root_after.patch] and [attachment:11073_prereq_install.patch] to the root repository.\n \n 5)\n \n``````\n",
    "created_at": "2011-12-10T00:07:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143101",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -15,7 +15,7 @@
 hg commit -m "Trac #11073: Move base repository to root repository"
 ```
 
-4) apply [attachment:11073_root_after.patch] and [attachment:11073_root_part2.patch] to the root repo
+4) apply [attachment:11073_root_after.patch] and [attachment:11073_prereq_install.patch] to the root repository.
 
 5)
 
``````




---

archive/issue_comments_143102.json:
```json
{
    "body": "<a id='comment:46'></a>Replying to [jdemeyer](#comment%3A44):\n> Wow, I just realized that the base repo was never actually updated on upgrade.  We cannot retro-actively fix the `sage-update` script of previous Sage versions to fix this.  So this is going to remain.\n\n\nI'm not sure what you mean.  We can modify the `sage-update` script: it gets run twice during the upgrade process, so it will be modified the second time through, so we might be able to make relevant changes there.  But upgrading seems complicated to me, and I've made mistakes trying to modify the update script before.",
    "created_at": "2011-12-10T06:52:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143102",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:46'></a>Replying to [jdemeyer](#comment%3A44):
> Wow, I just realized that the base repo was never actually updated on upgrade.  We cannot retro-actively fix the `sage-update` script of previous Sage versions to fix this.  So this is going to remain.


I'm not sure what you mean.  We can modify the `sage-update` script: it gets run twice during the upgrade process, so it will be modified the second time through, so we might be able to make relevant changes there.  But upgrading seems complicated to me, and I've made mistakes trying to modify the update script before.



---

archive/issue_comments_143103.json:
```json
{
    "body": "<a id='comment:47'></a>There is no compelling need to upgrade the `base` packages: an old bzip2 and old prereq (which only does some checks AFAIK) should do just fine.\n\nBut yes, we *could* do it, I didn't realize that `sage-upgrade` was run twice.",
    "created_at": "2011-12-10T09:59:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143103",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:47'></a>There is no compelling need to upgrade the `base` packages: an old bzip2 and old prereq (which only does some checks AFAIK) should do just fine.

But yes, we *could* do it, I didn't realize that `sage-upgrade` was run twice.



---

archive/issue_comments_143104.json:
```json
{
    "body": "<a id='comment:48'></a>I succesfully:\n1. built from scratch, testlong\n2. create sdist, build from that, testlong\n3. create bdist, testlong\n4. upgrade from sage-4.5, testlong\n5. upgrade from sage-4.7.2, testlong\n\nEverything worked.",
    "created_at": "2011-12-10T10:46:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143104",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:48'></a>I succesfully:
1. built from scratch, testlong
2. create sdist, build from that, testlong
3. create bdist, testlong
4. upgrade from sage-4.5, testlong
5. upgrade from sage-4.7.2, testlong

Everything worked.



---

archive/issue_comments_143105.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-12-10T10:46:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143105",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_143106.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -29,4 +29,4 @@\n \n The file `stdint.h_Solaris9` is not used and therefore deleted.\n \n-See also #10970 (do not generate `pipestatus`), #12102 (make `bzip2` a standard package)\n+Fixes #10970 (do not generate `pipestatus`), see also #12102 (make `bzip2` a standard package)\n``````\n",
    "created_at": "2011-12-10T10:51:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143106",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -29,4 +29,4 @@
 
 The file `stdint.h_Solaris9` is not used and therefore deleted.
 
-See also #10970 (do not generate `pipestatus`), #12102 (make `bzip2` a standard package)
+Fixes #10970 (do not generate `pipestatus`), see also #12102 (make `bzip2` a standard package)
``````




---

archive/issue_comments_143107.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-12-11T11:57:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143107",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_143108.json:
```json
{
    "body": "Changing work_issues from \"Fix upgrading\" to \"Rebase to sage-4.8.alpha4\"",
    "created_at": "2011-12-11T11:57:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143108",
    "user": "https://github.com/jdemeyer"
}
```

Changing work_issues from "Fix upgrading" to "Rebase to sage-4.8.alpha4"



---

archive/issue_comments_143109.json:
```json
{
    "body": "Changing work_issues from \"Rebase to sage-4.8.alpha4\" to \"Rebase to sage-4.8.alpha5\"",
    "created_at": "2011-12-11T11:58:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143109",
    "user": "https://github.com/jdemeyer"
}
```

Changing work_issues from "Rebase to sage-4.8.alpha4" to "Rebase to sage-4.8.alpha5"



---

archive/issue_comments_143110.json:
```json
{
    "body": "<a id='comment:52'></a>I see no reason to keep `sage-make_relative` in the root repo.  It would be perfectly fine to keep it only in the scripts repo.\n\nThis would break relocating a Sage install **during** installation, but I don't think that's a problem...",
    "created_at": "2011-12-14T21:24:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143110",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:52'></a>I see no reason to keep `sage-make_relative` in the root repo.  It would be perfectly fine to keep it only in the scripts repo.

This would break relocating a Sage install **during** installation, but I don't think that's a problem...



---

archive/issue_comments_143111.json:
```json
{
    "body": "Changing work_issues from \"Rebase to sage-4.8.alpha5\" to \"Rebase to #12016\"",
    "created_at": "2011-12-14T21:24:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143111",
    "user": "https://github.com/jdemeyer"
}
```

Changing work_issues from "Rebase to sage-4.8.alpha5" to "Rebase to #12016"



---

archive/issue_comments_143112.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -21,7 +21,7 @@\n \n ```\n cd $SAGE_ROOT/local/bin\n-hg remove sage-env sage-make_relative sage-spkg\n+hg remove sage-env sage-spkg\n hg commit -m \"Trac #11073: Move various scripts to spkg/bin\"\n ```\n \n``````\n",
    "created_at": "2011-12-14T21:24:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143112",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -21,7 +21,7 @@
 
 ```
 cd $SAGE_ROOT/local/bin
-hg remove sage-env sage-make_relative sage-spkg
+hg remove sage-env sage-spkg
 hg commit -m "Trac #11073: Move various scripts to spkg/bin"
 ```
 
``````




---

archive/issue_comments_143113.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,11 +6,13 @@\n \n ```\n cd $SAGE_ROOT/spkg/base\n-rm -rf .hg* stdint.h_Solaris9\n+rm -rf .hg* stdint.h_Solaris9 sage-*\n hg add *-install README.txt\n mkdir ../bin\n mv *.py sage-* *.sh text-* ../bin\n cd ../bin\n+cp -p $SAGE_ROOT/local/bin/sage-env .\n+cp -p $SAGE_ROOT/local/bin/sage-spkg .\n hg add . *\n hg commit -m \"Trac #11073: Move base repository to root repository\"\n ```\n``````\n",
    "created_at": "2011-12-14T21:30:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143113",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,11 +6,13 @@
 
 ```
 cd $SAGE_ROOT/spkg/base
-rm -rf .hg* stdint.h_Solaris9
+rm -rf .hg* stdint.h_Solaris9 sage-*
 hg add *-install README.txt
 mkdir ../bin
 mv *.py sage-* *.sh text-* ../bin
 cd ../bin
+cp -p $SAGE_ROOT/local/bin/sage-env .
+cp -p $SAGE_ROOT/local/bin/sage-spkg .
 hg add . *
 hg commit -m "Trac #11073: Move base repository to root repository"
 ```
``````




---

archive/issue_comments_143114.json:
```json
{
    "body": "Changing dependencies from \"#12057, #12128\" to \"sage-4.8.alpha4 + #12016\"",
    "created_at": "2011-12-15T22:11:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143114",
    "user": "https://github.com/jdemeyer"
}
```

Changing dependencies from "#12057, #12128" to "sage-4.8.alpha4 + #12016"



---

archive/issue_comments_143115.json:
```json
{
    "body": "Changing work_issues from \"Rebase to #12016\" to \"\"",
    "created_at": "2011-12-15T22:11:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143115",
    "user": "https://github.com/jdemeyer"
}
```

Changing work_issues from "Rebase to #12016" to ""



---

archive/issue_comments_143116.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -29,6 +29,6 @@\n \n 5) apply [attachment:11073_scripts.patch] to the scripts repo\n \n-The file `stdint.h_Solaris9` is not used and therefore deleted.\n+The file `stdint.h_Solaris9` is not used and therefore deleted.  `sage-env` and `sage-spkg` are moved to `spkg/bin` and `sage-make_relative` to scripts (`local/bin`).\n \n Fixes #10970 (do not generate `pipestatus`), see also #12102 (make `bzip2` a standard package)\n``````\n",
    "created_at": "2011-12-15T22:11:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143116",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -29,6 +29,6 @@
 
 5) apply [attachment:11073_scripts.patch] to the scripts repo
 
-The file `stdint.h_Solaris9` is not used and therefore deleted.
+The file `stdint.h_Solaris9` is not used and therefore deleted.  `sage-env` and `sage-spkg` are moved to `spkg/bin` and `sage-make_relative` to scripts (`local/bin`).
 
 Fixes #10970 (do not generate `pipestatus`), see also #12102 (make `bzip2` a standard package)
``````




---

archive/issue_comments_143117.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-12-15T22:11:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143117",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_143118.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -31,4 +31,4 @@\n \n The file `stdint.h_Solaris9` is not used and therefore deleted.  `sage-env` and `sage-spkg` are moved to `spkg/bin` and `sage-make_relative` to scripts (`local/bin`).\n \n-Fixes #10970 (do not generate `pipestatus`), see also #12102 (make `bzip2` a standard package)\n+Fixes #10970 (do not generate `pipestatus`), see also #12102 (make `bzip2` a standard package) and #12206 (install `sage_scripts` earlier).\n``````\n",
    "created_at": "2011-12-20T23:14:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143118",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -31,4 +31,4 @@
 
 The file `stdint.h_Solaris9` is not used and therefore deleted.  `sage-env` and `sage-spkg` are moved to `spkg/bin` and `sage-make_relative` to scripts (`local/bin`).
 
-Fixes #10970 (do not generate `pipestatus`), see also #12102 (make `bzip2` a standard package)
+Fixes #10970 (do not generate `pipestatus`), see also #12102 (make `bzip2` a standard package) and #12206 (install `sage_scripts` earlier).
``````




---

archive/issue_comments_143119.json:
```json
{
    "body": "<a id='comment:57'></a>Because of the discussion at #12206: any objections to moving `$SAGE_LOCAL/bin/sage-sage` to `$SAGE_ROOT/spkg/bin/sage` (or some other file in the root repo)?",
    "created_at": "2011-12-20T23:17:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143119",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:57'></a>Because of the discussion at #12206: any objections to moving `$SAGE_LOCAL/bin/sage-sage` to `$SAGE_ROOT/spkg/bin/sage` (or some other file in the root repo)?



---

archive/issue_comments_143120.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-12-21T10:12:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143120",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_143121.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -13,6 +13,7 @@\n cd ../bin\n cp -p $SAGE_ROOT/local/bin/sage-env .\n cp -p $SAGE_ROOT/local/bin/sage-spkg .\n+cp -p $SAGE_ROOT/local/bin/sage-sage sage\n hg add . *\n hg commit -m \"Trac #11073: Move base repository to root repository\"\n ```\n@@ -29,6 +30,8 @@\n \n 5) apply [attachment:11073_scripts.patch] to the scripts repo\n \n-The file `stdint.h_Solaris9` is not used and therefore deleted.  `sage-env` and `sage-spkg` are moved to `spkg/bin` and `sage-make_relative` to scripts (`local/bin`).\n+The file `stdint.h_Solaris9` is not used and therefore deleted.  `sage-env`, `sage-spkg` and `sage-sage` (renamed to `sage`) are moved to `spkg/bin`, `sage-make_relative` to scripts (`local/bin`).\n+\n+The script `sage-sage` is renamed to `spkg/bin/sage` and `$SAGE_ROOT` is no longer put in the $PATH, such that running \"sage\" after `sage-env` will run `$SAGE_ROOT/spkg/bin/sage`.\n \n Fixes #10970 (do not generate `pipestatus`), see also #12102 (make `bzip2` a standard package) and #12206 (install `sage_scripts` earlier).\n``````\n",
    "created_at": "2011-12-21T10:12:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143121",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -13,6 +13,7 @@
 cd ../bin
 cp -p $SAGE_ROOT/local/bin/sage-env .
 cp -p $SAGE_ROOT/local/bin/sage-spkg .
+cp -p $SAGE_ROOT/local/bin/sage-sage sage
 hg add . *
 hg commit -m "Trac #11073: Move base repository to root repository"
 ```
@@ -29,6 +30,8 @@
 
 5) apply [attachment:11073_scripts.patch] to the scripts repo
 
-The file `stdint.h_Solaris9` is not used and therefore deleted.  `sage-env` and `sage-spkg` are moved to `spkg/bin` and `sage-make_relative` to scripts (`local/bin`).
+The file `stdint.h_Solaris9` is not used and therefore deleted.  `sage-env`, `sage-spkg` and `sage-sage` (renamed to `sage`) are moved to `spkg/bin`, `sage-make_relative` to scripts (`local/bin`).
+
+The script `sage-sage` is renamed to `spkg/bin/sage` and `$SAGE_ROOT` is no longer put in the $PATH, such that running "sage" after `sage-env` will run `$SAGE_ROOT/spkg/bin/sage`.
 
 Fixes #10970 (do not generate `pipestatus`), see also #12102 (make `bzip2` a standard package) and #12206 (install `sage_scripts` earlier).
``````




---

archive/issue_comments_143122.json:
```json
{
    "body": "Changing work_issues from \"\" to \"move sage-sage\"",
    "created_at": "2011-12-21T10:12:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143122",
    "user": "https://github.com/jdemeyer"
}
```

Changing work_issues from "" to "move sage-sage"



---

archive/issue_comments_143123.json:
```json
{
    "body": "Changing dependencies from \"sage-4.8.alpha4 + #12016\" to \"sage-4.8.alpha4 + #12016 + #11704\"",
    "created_at": "2011-12-21T10:37:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143123",
    "user": "https://github.com/jdemeyer"
}
```

Changing dependencies from "sage-4.8.alpha4 + #12016" to "sage-4.8.alpha4 + #12016 + #11704"



---

archive/issue_comments_143124.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -30,6 +30,8 @@\n \n 5) apply [attachment:11073_scripts.patch] to the scripts repo\n \n+6) apply [attachment:11073_sagelib_misc.patch] to the main Sage repo.\n+\n The file `stdint.h_Solaris9` is not used and therefore deleted.  `sage-env`, `sage-spkg` and `sage-sage` (renamed to `sage`) are moved to `spkg/bin`, `sage-make_relative` to scripts (`local/bin`).\n \n The script `sage-sage` is renamed to `spkg/bin/sage` and `$SAGE_ROOT` is no longer put in the $PATH, such that running \"sage\" after `sage-env` will run `$SAGE_ROOT/spkg/bin/sage`.\n``````\n",
    "created_at": "2011-12-21T10:50:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143124",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -30,6 +30,8 @@
 
 5) apply [attachment:11073_scripts.patch] to the scripts repo
 
+6) apply [attachment:11073_sagelib_misc.patch] to the main Sage repo.
+
 The file `stdint.h_Solaris9` is not used and therefore deleted.  `sage-env`, `sage-spkg` and `sage-sage` (renamed to `sage`) are moved to `spkg/bin`, `sage-make_relative` to scripts (`local/bin`).
 
 The script `sage-sage` is renamed to `spkg/bin/sage` and `$SAGE_ROOT` is no longer put in the $PATH, such that running "sage" after `sage-env` will run `$SAGE_ROOT/spkg/bin/sage`.
``````




---

archive/issue_comments_143125.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -24,7 +24,7 @@\n \n ```\n cd $SAGE_ROOT/local/bin\n-hg remove sage-env sage-spkg\n+hg remove sage-env sage-spkg sage-sage\n hg commit -m \"Trac #11073: Move various scripts to spkg/bin\"\n ```\n \n``````\n",
    "created_at": "2011-12-21T10:50:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143125",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -24,7 +24,7 @@
 
 ```
 cd $SAGE_ROOT/local/bin
-hg remove sage-env sage-spkg
+hg remove sage-env sage-spkg sage-sage
 hg commit -m "Trac #11073: Move various scripts to spkg/bin"
 ```
 
``````




---

archive/issue_comments_143126.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-12-24T01:24:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143126",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_143127.json:
```json
{
    "body": "<a id='comment:62'></a>Now that `sage-sage` is moved to `spkg/bin/sage`, the commands `sage -sh` and `sage -i ...` work immediately, directly from the extracted source tarball.  So this makes #12206 obsolete.",
    "created_at": "2011-12-24T01:24:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143127",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:62'></a>Now that `sage-sage` is moved to `spkg/bin/sage`, the commands `sage -sh` and `sage -i ...` work immediately, directly from the extracted source tarball.  So this makes #12206 obsolete.



---

archive/issue_comments_143128.json:
```json
{
    "body": "Changing dependencies from \"sage-4.8.alpha4 + #12016 + #11704\" to \"sage-4.8.alpha5 + #11704\"",
    "created_at": "2011-12-24T01:24:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143128",
    "user": "https://github.com/jdemeyer"
}
```

Changing dependencies from "sage-4.8.alpha4 + #12016 + #11704" to "sage-4.8.alpha5 + #11704"



---

archive/issue_comments_143129.json:
```json
{
    "body": "Changing work_issues from \"move sage-sage\" to \"\"",
    "created_at": "2011-12-24T01:24:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143129",
    "user": "https://github.com/jdemeyer"
}
```

Changing work_issues from "move sage-sage" to ""



---

archive/issue_comments_143130.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-01-02T20:50:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143130",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_143131.json:
```json
{
    "body": "Changing dependencies from \"sage-4.8.alpha5 + #11704\" to \"sage-4.8.alpha6\"",
    "created_at": "2012-01-02T20:57:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143131",
    "user": "https://github.com/jdemeyer"
}
```

Changing dependencies from "sage-4.8.alpha5 + #11704" to "sage-4.8.alpha6"



---

archive/issue_comments_143132.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-01-09T22:48:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143132",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_143133.json:
```json
{
    "body": "<a id='comment:65'></a>Needs review (again).",
    "created_at": "2012-01-09T22:48:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143133",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:65'></a>Needs review (again).



---

archive/issue_comments_143134.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n Given the creation of the Sage root repo (see #9433), the repository in `SAGE_ROOT/spkg/base` should be combined with it.\n \n-1) apply [attachment:11073_root.patch] to the root repo\n+1) apply [attachment:11073_root_hgignore.patch] to the root repo\n \n 2)\n \n``````\n",
    "created_at": "2012-01-13T16:51:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143134",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 Given the creation of the Sage root repo (see #9433), the repository in `SAGE_ROOT/spkg/base` should be combined with it.
 
-1) apply [attachment:11073_root.patch] to the root repo
+1) apply [attachment:11073_root_hgignore.patch] to the root repo
 
 2)
 
``````




---

archive/issue_comments_143135.json:
```json
{
    "body": "<a id='comment:66'></a>Attachment [11073_root_hgignore.patch](tarball://root/attachments/some-uuid/ticket11073/11073_root_hgignore.patch) by @jdemeyer created at 2012-01-13 16:51:02\n\nAdd `spkg/base/prereq-0.7-install` and `spkg/base/prereq-0.8-install` to `.hgignore` for upgrades from old Sage versions.",
    "created_at": "2012-01-13T16:51:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143135",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:66'></a>Attachment [11073_root_hgignore.patch](tarball://root/attachments/some-uuid/ticket11073/11073_root_hgignore.patch) by @jdemeyer created at 2012-01-13 16:51:02

Add `spkg/base/prereq-0.7-install` and `spkg/base/prereq-0.8-install` to `.hgignore` for upgrades from old Sage versions.



---

archive/issue_comments_143136.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-01-15T09:30:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143136",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_143137.json:
```json
{
    "body": "<a id='comment:67'></a>Because of #12311, we should still copy `testcc.sh` and `testcxx.sh` to `$SAGE_LOCAL/bin`.  This can then truly be fixed in #12311.",
    "created_at": "2012-01-15T09:30:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143137",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:67'></a>Because of #12311, we should still copy `testcc.sh` and `testcxx.sh` to `$SAGE_LOCAL/bin`.  This can then truly be fixed in #12311.



---

archive/issue_comments_143138.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -36,4 +36,4 @@\n \n The script `sage-sage` is renamed to `spkg/bin/sage` and `$SAGE_ROOT` is no longer put in the $PATH, such that running \"sage\" after `sage-env` will run `$SAGE_ROOT/spkg/bin/sage`.\n \n-Fixes #10970 (do not generate `pipestatus`), see also #12102 (make `bzip2` a standard package) and #12206 (install `sage_scripts` earlier).\n+Fixes #10970 (do not generate `pipestatus`), see also #12102 (make `bzip2` a standard package) and #12206 (install `sage_scripts` earlier), #12311 (stop copying testcc.sh and testcxx.sh).\n``````\n",
    "created_at": "2012-01-15T09:33:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143138",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -36,4 +36,4 @@
 
 The script `sage-sage` is renamed to `spkg/bin/sage` and `$SAGE_ROOT` is no longer put in the $PATH, such that running "sage" after `sage-env` will run `$SAGE_ROOT/spkg/bin/sage`.
 
-Fixes #10970 (do not generate `pipestatus`), see also #12102 (make `bzip2` a standard package) and #12206 (install `sage_scripts` earlier).
+Fixes #10970 (do not generate `pipestatus`), see also #12102 (make `bzip2` a standard package) and #12206 (install `sage_scripts` earlier), #12311 (stop copying testcc.sh and testcxx.sh).
``````




---

archive/issue_comments_143139.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-01-15T09:44:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143139",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_143140.json:
```json
{
    "body": "<a id='comment:70'></a>Upgrading from sage-4.4.4 failed gracefully, as expected.\n\nDoubly-upgrading sage-4.4.4 -> sage-4.8.rc0 -> sage-5.0.prealpha2 worked fine.",
    "created_at": "2012-01-16T19:48:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143140",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:70'></a>Upgrading from sage-4.4.4 failed gracefully, as expected.

Doubly-upgrading sage-4.4.4 -> sage-4.8.rc0 -> sage-5.0.prealpha2 worked fine.



---

archive/issue_comments_143141.json:
```json
{
    "body": "<a id='comment:71'></a>Needs work: as pointed out by was on sage-devel, the Makefile still refers to local/bin/sage-env in a few places.",
    "created_at": "2012-01-17T02:14:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143141",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:71'></a>Needs work: as pointed out by was on sage-devel, the Makefile still refers to local/bin/sage-env in a few places.



---

archive/issue_comments_143142.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-01-17T07:48:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143142",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_143143.json:
```json
{
    "body": "<a id='comment:72'></a>I couldn't find that sage-devel post, but you're right.  How could I miss that?",
    "created_at": "2012-01-17T07:48:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143143",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:72'></a>I couldn't find that sage-devel post, but you're right.  How could I miss that?



---

archive/issue_comments_143144.json:
```json
{
    "body": "<a id='comment:73'></a>Okay, I did a grep of `sage-env`, `sage-sage` and `sage-spkg` in the whole Sage tree, including spkgs.  The following are fixed now:\n\n* Top-level `Makefile`\n* `data/extcode/sage/ext/mac-app/start-sage.sh`\n* `devel/sage/doc/en/developer/coding_in_python.rst`\n\nThere is a remaining reference in a **comment** in the `cliquer` spkg (can be fixed in #12311) and in **comments** in the R spkg (should be taken of in #9906).",
    "created_at": "2012-01-17T08:15:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143144",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:73'></a>Okay, I did a grep of `sage-env`, `sage-sage` and `sage-spkg` in the whole Sage tree, including spkgs.  The following are fixed now:

* Top-level `Makefile`
* `data/extcode/sage/ext/mac-app/start-sage.sh`
* `devel/sage/doc/en/developer/coding_in_python.rst`

There is a remaining reference in a **comment** in the `cliquer` spkg (can be fixed in #12311) and in **comments** in the R spkg (should be taken of in #9906).



---

archive/issue_comments_143145.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -32,6 +32,8 @@\n \n 6) apply [attachment:11073_sagelib_misc.patch] to the main Sage repo.\n \n+7) apply [attachment:11073_extcode.patch] to `data/extcode`.\n+\n The file `stdint.h_Solaris9` is not used and therefore deleted.  `sage-env`, `sage-spkg` and `sage-sage` (renamed to `sage`) are moved to `spkg/bin`, `sage-make_relative` to scripts (`local/bin`).\n \n The script `sage-sage` is renamed to `spkg/bin/sage` and `$SAGE_ROOT` is no longer put in the $PATH, such that running \"sage\" after `sage-env` will run `$SAGE_ROOT/spkg/bin/sage`.\n``````\n",
    "created_at": "2012-01-17T08:22:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143145",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -32,6 +32,8 @@
 
 6) apply [attachment:11073_sagelib_misc.patch] to the main Sage repo.
 
+7) apply [attachment:11073_extcode.patch] to `data/extcode`.
+
 The file `stdint.h_Solaris9` is not used and therefore deleted.  `sage-env`, `sage-spkg` and `sage-sage` (renamed to `sage`) are moved to `spkg/bin`, `sage-make_relative` to scripts (`local/bin`).
 
 The script `sage-sage` is renamed to `spkg/bin/sage` and `$SAGE_ROOT` is no longer put in the $PATH, such that running "sage" after `sage-env` will run `$SAGE_ROOT/spkg/bin/sage`.
``````




---

archive/issue_comments_143146.json:
```json
{
    "body": "<a id='comment:74'></a>Attachment [11073_sagelib_misc.patch](tarball://root/attachments/some-uuid/ticket11073/11073_sagelib_misc.patch) by @jdemeyer created at 2012-01-17 08:22:15",
    "created_at": "2012-01-17T08:22:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143146",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:74'></a>Attachment [11073_sagelib_misc.patch](tarball://root/attachments/some-uuid/ticket11073/11073_sagelib_misc.patch) by @jdemeyer created at 2012-01-17 08:22:15



---

archive/issue_comments_143147.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-01-17T08:26:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143147",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_143148.json:
```json
{
    "body": "<a id='comment:76'></a>Replying to [jdemeyer](#comment%3A73):\n> Okay, I did a grep of `sage-env`, `sage-sage` and `sage-spkg` in the whole Sage tree, including spkgs.  The following are fixed now:\n> \n> * Top-level `Makefile`\n> * `data/extcode/sage/ext/mac-app/start-sage.sh`\n\n\nSo for positive review, I guess someone would have to build the Mac app and make sure it functions properly.",
    "created_at": "2012-01-17T14:56:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143148",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:76'></a>Replying to [jdemeyer](#comment%3A73):
> Okay, I did a grep of `sage-env`, `sage-sage` and `sage-spkg` in the whole Sage tree, including spkgs.  The following are fixed now:
> 
> * Top-level `Makefile`
> * `data/extcode/sage/ext/mac-app/start-sage.sh`


So for positive review, I guess someone would have to build the Mac app and make sure it functions properly.



---

archive/issue_comments_143149.json:
```json
{
    "body": "<a id='comment:77'></a>I will have the buildbot build a \"Mac app\" for the *unreleased* sage-5.0.beta1, which includes the latest version of this ticket.",
    "created_at": "2012-01-17T16:12:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143149",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:77'></a>I will have the buildbot build a "Mac app" for the *unreleased* sage-5.0.beta1, which includes the latest version of this ticket.



---

archive/issue_comments_143150.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-01-18T17:14:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143150",
    "user": "https://github.com/williamstein"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_143151.json:
```json
{
    "body": "<a id='comment:78'></a>COMMENTS:\n\n1. In this code (and anything similar?):\n\n```\n        17\tcd \"$SAGE_ROOT/spkg/base\" \n \t18\trm -rf .hg* json_bundle.py stdint.h_Solaris9 sage-* text-* *.sh \n```\ncan we have an error check after the cd, before \"rm -rf\", since if something went wrong (even a control-c at the wrong moment, or the spkg/base directory is already gone!), then the \"rm -rf\" *will* cause some serious pain, e.g., deleting the .hg repo from SAGE_ROOT.   Any time I see an \"rm -rf\" in a script I'm very paranoid.  This is the sort of situation where Python would be better.  \n\n2. Many people -- e.g., me on the seemingly dozens of machines I have Sage installed on -- will have a \"sage\" script that is from before this patch.  That script will *not* be upgraded when we upgrade our Sage install, since that script is in local/bin/ (say), not in `SAGE_ROOT` (and it need not be a symlink).  That older script explicitly calls \"local/bin/sage-sage\", so it will now be totally broken, since this ticket deletes sage-sage.     For this reason, I think it is absolutely essential that sage-sage not be deleted.  The sage-sage script needs to remain, but could either be a 1-liner that calls `$SAGE_ROOT/spkg/bin/sage` *or* it could produce a nice useful error message explaining that the user must update their sage script by copying over the one from SAGE_ROOT, and edit the path, or create a symbolic link. \n\n3. As far as I can tell, I'm happy with everything else about the new scripts added 33 hours ago.  They fix the issue I reported on sage-devel.",
    "created_at": "2012-01-18T17:14:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143151",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:78'></a>COMMENTS:

1. In this code (and anything similar?):

```
        17	cd "$SAGE_ROOT/spkg/base" 
 	18	rm -rf .hg* json_bundle.py stdint.h_Solaris9 sage-* text-* *.sh 
```
can we have an error check after the cd, before "rm -rf", since if something went wrong (even a control-c at the wrong moment, or the spkg/base directory is already gone!), then the "rm -rf" *will* cause some serious pain, e.g., deleting the .hg repo from SAGE_ROOT.   Any time I see an "rm -rf" in a script I'm very paranoid.  This is the sort of situation where Python would be better.  

2. Many people -- e.g., me on the seemingly dozens of machines I have Sage installed on -- will have a "sage" script that is from before this patch.  That script will *not* be upgraded when we upgrade our Sage install, since that script is in local/bin/ (say), not in `SAGE_ROOT` (and it need not be a symlink).  That older script explicitly calls "local/bin/sage-sage", so it will now be totally broken, since this ticket deletes sage-sage.     For this reason, I think it is absolutely essential that sage-sage not be deleted.  The sage-sage script needs to remain, but could either be a 1-liner that calls `$SAGE_ROOT/spkg/bin/sage` *or* it could produce a nice useful error message explaining that the user must update their sage script by copying over the one from SAGE_ROOT, and edit the path, or create a symbolic link. 

3. As far as I can tell, I'm happy with everything else about the new scripts added 33 hours ago.  They fix the issue I reported on sage-devel.



---

archive/issue_comments_143152.json:
```json
{
    "body": "<a id='comment:79'></a>Replying to [was](#comment%3A78):\n> COMMENTS:\n> \n> 1. In this code (and anything similar?):\n> \n> ```\n>         17\tcd \"$SAGE_ROOT/spkg/base\" \n>  \t18\trm -rf .hg* json_bundle.py stdint.h_Solaris9 sage-* text-* *.sh \n> ```\n> can we have an error check after the cd\n\nGood point!",
    "created_at": "2012-01-18T19:50:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143152",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:79'></a>Replying to [was](#comment%3A78):
> COMMENTS:
> 
> 1. In this code (and anything similar?):
> 
> ```
>         17	cd "$SAGE_ROOT/spkg/base" 
>  	18	rm -rf .hg* json_bundle.py stdint.h_Solaris9 sage-* text-* *.sh 
> ```
> can we have an error check after the cd

Good point!



---

archive/issue_comments_143153.json:
```json
{
    "body": "<a id='comment:80'></a>Replying to [was](#comment%3A78):\n> For this reason, I think it is absolutely essential that sage-sage not be deleted.  The sage-sage script needs to remain, but could either be a 1-liner that calls `$SAGE_ROOT/spkg/bin/sage` *or* it could produce a nice useful error message explaining that the user must update their sage script by copying over the one from SAGE_ROOT, and edit the path, or create a symbolic link. \n\n\nAlso a good point.  I would go for a warning with explanation and then\n\n```\nexec \"$SAGE_ROOT/spkg/bin/sage\" \"$@\"\n```",
    "created_at": "2012-01-18T19:55:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143153",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:80'></a>Replying to [was](#comment%3A78):
> For this reason, I think it is absolutely essential that sage-sage not be deleted.  The sage-sage script needs to remain, but could either be a 1-liner that calls `$SAGE_ROOT/spkg/bin/sage` *or* it could produce a nice useful error message explaining that the user must update their sage script by copying over the one from SAGE_ROOT, and edit the path, or create a symbolic link. 


Also a good point.  I would go for a warning with explanation and then

```
exec "$SAGE_ROOT/spkg/bin/sage" "$@"
```



---

archive/issue_comments_143154.json:
```json
{
    "body": "<a id='comment:81'></a>William or somebody else with OS X 10.6: please test the Mac App at\n[http://boxen.math.washington.edu/home/buildbot/binaries/sage/sage-5.0.beta1-OSX-64bit-10.6-x86_64-Darwin-app.dmg](http://boxen.math.washington.edu/home/buildbot/binaries/sage/sage-5.0.beta1-OSX-64bit-10.6-x86_64-Darwin-app.dmg)\nThe point is really to test whether the \"App\" part works, not to \"make (p)test(long)\" or anything.",
    "created_at": "2012-01-18T19:56:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143154",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:81'></a>William or somebody else with OS X 10.6: please test the Mac App at
[http://boxen.math.washington.edu/home/buildbot/binaries/sage/sage-5.0.beta1-OSX-64bit-10.6-x86_64-Darwin-app.dmg](http://boxen.math.washington.edu/home/buildbot/binaries/sage/sage-5.0.beta1-OSX-64bit-10.6-x86_64-Darwin-app.dmg)
The point is really to test whether the "App" part works, not to "make (p)test(long)" or anything.



---

archive/issue_comments_143155.json:
```json
{
    "body": "<a id='comment:82'></a>I'm testing the app bundle right now...",
    "created_at": "2012-01-18T19:59:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143155",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:82'></a>I'm testing the app bundle right now...



---

archive/issue_comments_143156.json:
```json
{
    "body": "<a id='comment:83'></a>Replying to [was](#comment%3A78):\n> or the spkg/base directory is already gone!\n\nJust to clarify: we never remove the `spkg/base` directory.  Things like `prereq-0.9-install` would still live  in that directory, but now as part of the root repository.\n\n> This is the sort of situation where Python would be better.\n\nOr `set -e`, see my sage-devel post.",
    "created_at": "2012-01-18T20:06:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143156",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:83'></a>Replying to [was](#comment%3A78):
> or the spkg/base directory is already gone!

Just to clarify: we never remove the `spkg/base` directory.  Things like `prereq-0.9-install` would still live  in that directory, but now as part of the root repository.

> This is the sort of situation where Python would be better.

Or `set -e`, see my sage-devel post.



---

archive/issue_comments_143157.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-01-18T21:14:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143157",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_143158.json:
```json
{
    "body": "<a id='comment:84'></a>Attachment [11073_root_after.patch](tarball://root/attachments/some-uuid/ticket11073/11073_root_after.patch) by @jdemeyer created at 2012-01-18 21:14:15\n\nWilliam, I implemented the changes you asked.  I solved the \"cd\" followed by \"rm -rf\" problem by using \"cd && rm\".  I also made this change in an unrelated part of `sage-bdist`.",
    "created_at": "2012-01-18T21:14:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143158",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:84'></a>Attachment [11073_root_after.patch](tarball://root/attachments/some-uuid/ticket11073/11073_root_after.patch) by @jdemeyer created at 2012-01-18 21:14:15

William, I implemented the changes you asked.  I solved the "cd" followed by "rm -rf" problem by using "cd && rm".  I also made this change in an unrelated part of `sage-bdist`.



---

archive/issue_comments_143159.json:
```json
{
    "body": "Attachment [11073_scripts.patch](tarball://root/attachments/some-uuid/ticket11073/11073_scripts.patch) by @jdemeyer created at 2012-01-18 21:14:27",
    "created_at": "2012-01-18T21:14:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143159",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [11073_scripts.patch](tarball://root/attachments/some-uuid/ticket11073/11073_scripts.patch) by @jdemeyer created at 2012-01-18 21:14:27



---

archive/issue_comments_143160.json:
```json
{
    "body": "<a id='comment:85'></a>The app bundle *almost* works (on OS X 10.7 even), but does not quite.  Basically it goes to this URL:\n\n```\nhttp://localhost:0/new_worksheet\n```\nand\n\n```\nhttp://localhost:0\n```\nThis of course does not work at all.  Changing the 0 to 8000 works.  Everything else seems to work fine though. \n\nI'm happy with your change for \"rm -rf\".  If the port got fixed (to 8000), I think this should get a positive review.",
    "created_at": "2012-01-18T23:27:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143160",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:85'></a>The app bundle *almost* works (on OS X 10.7 even), but does not quite.  Basically it goes to this URL:

```
http://localhost:0/new_worksheet
```
and

```
http://localhost:0
```
This of course does not work at all.  Changing the 0 to 8000 works.  Everything else seems to work fine though. 

I'm happy with your change for "rm -rf".  If the port got fixed (to 8000), I think this should get a positive review.



---

archive/issue_comments_143161.json:
```json
{
    "body": "<a id='comment:86'></a>I think it looks good, too.",
    "created_at": "2012-01-18T23:47:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143161",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:86'></a>I think it looks good, too.



---

archive/issue_comments_143162.json:
```json
{
    "body": "<a id='comment:87'></a>Replying to [was](#comment%3A85):\n> The app bundle *almost* works (on OS X 10.7 even), but does not quite.  Basically it goes to this URL:\n> \n> ```\n> http://localhost:0/new_worksheet\n> ```\n> and\n> \n> ```\n> http://localhost:0\n> ```\n> This of course does not work at all.\n\nIs this a regression due to this ticket?  Looks unlikely to me.",
    "created_at": "2012-01-19T08:14:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143162",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:87'></a>Replying to [was](#comment%3A85):
> The app bundle *almost* works (on OS X 10.7 even), but does not quite.  Basically it goes to this URL:
> 
> ```
> http://localhost:0/new_worksheet
> ```
> and
> 
> ```
> http://localhost:0
> ```
> This of course does not work at all.

Is this a regression due to this ticket?  Looks unlikely to me.



---

archive/issue_comments_143163.json:
```json
{
    "body": "<a id='comment:88'></a>Replying to [was](#comment%3A85):\n> The app bundle *almost* works (on OS X 10.7 even), but does not quite.  Basically it goes to this URL:\n> \n> ```\n> http://localhost:0/new_worksheet\n> ```\n> and\n> \n> ```\n> http://localhost:0\n> ```\n> This of course does not work at all.\n\nDoes `sage -n` from the command-line work?",
    "created_at": "2012-01-19T10:07:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143163",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:88'></a>Replying to [was](#comment%3A85):
> The app bundle *almost* works (on OS X 10.7 even), but does not quite.  Basically it goes to this URL:
> 
> ```
> http://localhost:0/new_worksheet
> ```
> and
> 
> ```
> http://localhost:0
> ```
> This of course does not work at all.

Does `sage -n` from the command-line work?



---

archive/issue_comments_143164.json:
```json
{
    "body": "<a id='comment:89'></a>Does the 4.8.rc0 Mac App work:\n[http://boxen.math.washington.edu/home/buildbot/binaries/sage/sage-4.8.rc0-OSX-64bit-10.6-x86_64-Darwin-app.dmg](http://boxen.math.washington.edu/home/buildbot/binaries/sage/sage-4.8.rc0-OSX-64bit-10.6-x86_64-Darwin-app.dmg)",
    "created_at": "2012-01-19T10:54:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143164",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:89'></a>Does the 4.8.rc0 Mac App work:
[http://boxen.math.washington.edu/home/buildbot/binaries/sage/sage-4.8.rc0-OSX-64bit-10.6-x86_64-Darwin-app.dmg](http://boxen.math.washington.edu/home/buildbot/binaries/sage/sage-4.8.rc0-OSX-64bit-10.6-x86_64-Darwin-app.dmg)



---

archive/issue_comments_143165.json:
```json
{
    "body": "<a id='comment:90'></a>> Does sage -n from the command-line work?\n\n\nYes, perfectly.",
    "created_at": "2012-01-19T16:44:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143165",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:90'></a>> Does sage -n from the command-line work?


Yes, perfectly.



---

archive/issue_comments_143166.json:
```json
{
    "body": "<a id='comment:91'></a>Replying to [jdemeyer](#comment%3A89):\n> Does the 4.8.rc0 Mac App work:\n> [http://boxen.math.washington.edu/home/buildbot/binaries/sage/sage-4.8.rc0-OSX-64bit-10.6-x86_64-Darwin-app.dmg](http://boxen.math.washington.edu/home/buildbot/binaries/sage/sage-4.8.rc0-OSX-64bit-10.6-x86_64-Darwin-app.dmg)\n\n\nYes, it appears to work perfectly.",
    "created_at": "2012-01-19T17:16:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143166",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:91'></a>Replying to [jdemeyer](#comment%3A89):
> Does the 4.8.rc0 Mac App work:
> [http://boxen.math.washington.edu/home/buildbot/binaries/sage/sage-4.8.rc0-OSX-64bit-10.6-x86_64-Darwin-app.dmg](http://boxen.math.washington.edu/home/buildbot/binaries/sage/sage-4.8.rc0-OSX-64bit-10.6-x86_64-Darwin-app.dmg)


Yes, it appears to work perfectly.



---

archive/issue_comments_143167.json:
```json
{
    "body": "<a id='comment:92'></a>Replying to [was](#comment%3A85):\n> The app bundle *almost* works (on OS X 10.7 even), but does not quite.\n\n\nI'd like to test this out, too. Can you explain what you mean by the app bundle?  Do you mean \"sage --bdist ...\" with \"SAGE_APP_BUNDLE=yes\" on a Mac?",
    "created_at": "2012-01-20T00:50:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143167",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:92'></a>Replying to [was](#comment%3A85):
> The app bundle *almost* works (on OS X 10.7 even), but does not quite.


I'd like to test this out, too. Can you explain what you mean by the app bundle?  Do you mean "sage --bdist ..." with "SAGE_APP_BUNDLE=yes" on a Mac?



---

archive/issue_comments_143168.json:
```json
{
    "body": "<a id='comment:93'></a>> I'd like to test this out, too. Can you explain what you mean by the app bundle?  Do you mean \"sage --bdist ...\" with \"SAGE_APP_BUNDLE=yes\" on a Mac?\n\nYes.",
    "created_at": "2012-01-20T01:37:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143168",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:93'></a>> I'd like to test this out, too. Can you explain what you mean by the app bundle?  Do you mean "sage --bdist ..." with "SAGE_APP_BUNDLE=yes" on a Mac?

Yes.



---

archive/issue_comments_143169.json:
```json
{
    "body": "<a id='comment:94'></a>When I use the app bundle, I see this in the log file:\n\n```\n/Users/palmieri/Desktop/Sage-5.0.pa1.app/Contents/Resources/start-sage.sh: line 41: ./local/bin/sage-env: No such file or directory\n```\nI wonder if there should be a place-holder script local/bin/sage-env which runs spkg/bin/sage-env.  Otherwise, the file `SAGE_ROOT/data/extcode/sage/ext/mac-app/start-sage.sh` will have to be changed. \n\nI do not see the wrong port, though: I see `8000`, not `0`.",
    "created_at": "2012-01-20T04:20:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143169",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:94'></a>When I use the app bundle, I see this in the log file:

```
/Users/palmieri/Desktop/Sage-5.0.pa1.app/Contents/Resources/start-sage.sh: line 41: ./local/bin/sage-env: No such file or directory
```
I wonder if there should be a place-holder script local/bin/sage-env which runs spkg/bin/sage-env.  Otherwise, the file `SAGE_ROOT/data/extcode/sage/ext/mac-app/start-sage.sh` will have to be changed. 

I do not see the wrong port, though: I see `8000`, not `0`.



---

archive/issue_comments_143170.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-01-20T04:20:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143170",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_143171.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-01-20T08:25:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143171",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_143172.json:
```json
{
    "body": "<a id='comment:95'></a>Replying to [jhpalmieri](#comment%3A94):\n> The file `SAGE_ROOT/data/extcode/sage/ext/mac-app/start-sage.sh` will have to be changed.\n\nI fixed precisely that error in [attachment:11073_extcode.patch].  I assume you have an older version without that patch?",
    "created_at": "2012-01-20T08:25:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143172",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:95'></a>Replying to [jhpalmieri](#comment%3A94):
> The file `SAGE_ROOT/data/extcode/sage/ext/mac-app/start-sage.sh` will have to be changed.

I fixed precisely that error in [attachment:11073_extcode.patch].  I assume you have an older version without that patch?



---

archive/issue_comments_143173.json:
```json
{
    "body": "<a id='comment:96'></a>Mac App testers: please test\n[http://boxen.math.washington.edu/home/buildbot/binaries/sage/sage-5.0.prealpha3-OSX-64bit-10.6-x86_64-Darwin-app.dmg](http://boxen.math.washington.edu/home/buildbot/binaries/sage/sage-5.0.prealpha3-OSX-64bit-10.6-x86_64-Darwin-app.dmg)\n\nThis includes the latest version of this ticket.",
    "created_at": "2012-01-20T08:26:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143173",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:96'></a>Mac App testers: please test
[http://boxen.math.washington.edu/home/buildbot/binaries/sage/sage-5.0.prealpha3-OSX-64bit-10.6-x86_64-Darwin-app.dmg](http://boxen.math.washington.edu/home/buildbot/binaries/sage/sage-5.0.prealpha3-OSX-64bit-10.6-x86_64-Darwin-app.dmg)

This includes the latest version of this ticket.



---

archive/issue_comments_143174.json:
```json
{
    "body": "<a id='comment:97'></a>If it's just the Mac App holding us back, I would prefer to have this ticket set to positive_review.  The best way to further test this ticket is to merge it in sage-5.0.beta0.  Any small remaining issues can still be fixed in later betas.",
    "created_at": "2012-01-20T09:16:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143174",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:97'></a>If it's just the Mac App holding us back, I would prefer to have this ticket set to positive_review.  The best way to further test this ticket is to merge it in sage-5.0.beta0.  Any small remaining issues can still be fixed in later betas.



---

archive/issue_comments_143175.json:
```json
{
    "body": "Changing reviewer from \"\" to \"John Palmieri, William Stein\"",
    "created_at": "2012-01-20T09:16:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143175",
    "user": "https://github.com/jdemeyer"
}
```

Changing reviewer from "" to "John Palmieri, William Stein"



---

archive/issue_comments_143176.json:
```json
{
    "body": "<a id='comment:98'></a>Replying to [jdemeyer](#comment%3A96):\n> Mac App testers: please test\n> [http://boxen.math.washington.edu/home/buildbot/binaries/sage/sage-5.0.prealpha3-OSX-64bit-10.6-x86_64-Darwin-app.dmg](http://boxen.math.washington.edu/home/buildbot/binaries/sage/sage-5.0.prealpha3-OSX-64bit-10.6-x86_64-Darwin-app.dmg)\n> \n> This includes the latest version of this ticket.\n\n\nIt worked for me, but only after I realized that I could no longer use an older external sage distribution because of the `local/bin/sage-env` to `spkg/bin/sage-env` change.  I think we should load `spkg/bin/sage-env` or if it doesn't exist then source `local/bin/sage-env`.  Of course I'm probably the only one who uses external sage distributions so I won't insist. :-)",
    "created_at": "2012-01-20T11:39:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143176",
    "user": "https://github.com/gvol"
}
```

<a id='comment:98'></a>Replying to [jdemeyer](#comment%3A96):
> Mac App testers: please test
> [http://boxen.math.washington.edu/home/buildbot/binaries/sage/sage-5.0.prealpha3-OSX-64bit-10.6-x86_64-Darwin-app.dmg](http://boxen.math.washington.edu/home/buildbot/binaries/sage/sage-5.0.prealpha3-OSX-64bit-10.6-x86_64-Darwin-app.dmg)
> 
> This includes the latest version of this ticket.


It worked for me, but only after I realized that I could no longer use an older external sage distribution because of the `local/bin/sage-env` to `spkg/bin/sage-env` change.  I think we should load `spkg/bin/sage-env` or if it doesn't exist then source `local/bin/sage-env`.  Of course I'm probably the only one who uses external sage distributions so I won't insist. :-)



---

archive/issue_comments_143177.json:
```json
{
    "body": "<a id='comment:99'></a>Replying to [iandrus](#comment%3A98):\n> It worked for me, but only after I realized that I could no longer use an older external sage distribution\n\nWhat's an \"external sage distribution\"?",
    "created_at": "2012-01-20T12:41:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143177",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:99'></a>Replying to [iandrus](#comment%3A98):
> It worked for me, but only after I realized that I could no longer use an older external sage distribution

What's an "external sage distribution"?



---

archive/issue_comments_143178.json:
```json
{
    "body": "<a id='comment:100'></a>Replying to [jdemeyer](#comment%3A99):\n> Replying to [iandrus](#comment%3A98):\n> > It worked for me, but only after I realized that I could no longer use an older external sage distribution\n\n> What's an \"external sage distribution\"?\n\nSorry for being unclear.  You can point the app at any sage directory you want (SAGE_ROOT) instead of the one built in.   I do this since when I build a new app for development I don't want to copy sage into it.  It also allows me to upgrade sage independently of Sage.app.  \n\nSo I had told it to use an unpatched sage 4.7.2 which won't work.",
    "created_at": "2012-01-20T14:12:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143178",
    "user": "https://github.com/gvol"
}
```

<a id='comment:100'></a>Replying to [jdemeyer](#comment%3A99):
> Replying to [iandrus](#comment%3A98):
> > It worked for me, but only after I realized that I could no longer use an older external sage distribution

> What's an "external sage distribution"?

Sorry for being unclear.  You can point the app at any sage directory you want (SAGE_ROOT) instead of the one built in.   I do this since when I build a new app for development I don't want to copy sage into it.  It also allows me to upgrade sage independently of Sage.app.  

So I had told it to use an unpatched sage 4.7.2 which won't work.



---

archive/issue_comments_143179.json:
```json
{
    "body": "<a id='comment:1'></a>iandrus: If that's what you do, I don't find it a problem that the Apps for sage-4.x and sage-5.x are incompatible.",
    "created_at": "2012-01-20T14:22:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143179",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:1'></a>iandrus: If that's what you do, I don't find it a problem that the Apps for sage-4.x and sage-5.x are incompatible.



---

archive/issue_comments_143180.json:
```json
{
    "body": "<a id='comment:2'></a>I think it's very nice to be able to point the app at any Sage directory.  It seems easy to avoid breaking that feature, so if not here, then we should have a follow-up ticket which tries `spkg/bin/sage-env` and if that doesn't exist, then it uses `local/bin/sage-env`.  Can we just do something like this?\n\n```diff\ndiff --git a/sage/ext/mac-app/start-sage.sh b/sage/ext/mac-app/start-sage.sh\n--- a/sage/ext/mac-app/start-sage.sh\n+++ b/sage/ext/mac-app/start-sage.sh\n@@ -38,7 +38,8 @@ cd /tmp/sage-mac-app || exit 1\n \n # Set (i.e. \"source\") SAGE_ROOT and all the other environment settings\n echo Setting environment variables >> \"$SAGE_LOG\"\n-. ./spkg/bin/sage-env >> \"$SAGE_LOG\" 2>> \"$SAGE_LOG\"\n+. ./spkg/bin/sage-env >> \"$SAGE_LOG\" 2>> \"$SAGE_LOG\" || \\\n+. ./local/bin/sage-env >> \"$SAGE_LOG\" 2>> \"$SAGE_LOG\"\n export SAGE_ROOT\n \n # Mac OS X app bundles are *intended* to be moved around, and/or given away\n```\nShould we fix this here or on a followup?\n\njdemeyer: you're right, I missed that patch.  I read it and thought it made sense, but then forgot about it and didn't apply it.",
    "created_at": "2012-01-20T17:52:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143180",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:2'></a>I think it's very nice to be able to point the app at any Sage directory.  It seems easy to avoid breaking that feature, so if not here, then we should have a follow-up ticket which tries `spkg/bin/sage-env` and if that doesn't exist, then it uses `local/bin/sage-env`.  Can we just do something like this?

```diff
diff --git a/sage/ext/mac-app/start-sage.sh b/sage/ext/mac-app/start-sage.sh
--- a/sage/ext/mac-app/start-sage.sh
+++ b/sage/ext/mac-app/start-sage.sh
@@ -38,7 +38,8 @@ cd /tmp/sage-mac-app || exit 1
 
 # Set (i.e. "source") SAGE_ROOT and all the other environment settings
 echo Setting environment variables >> "$SAGE_LOG"
-. ./spkg/bin/sage-env >> "$SAGE_LOG" 2>> "$SAGE_LOG"
+. ./spkg/bin/sage-env >> "$SAGE_LOG" 2>> "$SAGE_LOG" || \
+. ./local/bin/sage-env >> "$SAGE_LOG" 2>> "$SAGE_LOG"
 export SAGE_ROOT
 
 # Mac OS X app bundles are *intended* to be moved around, and/or given away
```
Should we fix this here or on a followup?

jdemeyer: you're right, I missed that patch.  I read it and thought it made sense, but then forgot about it and didn't apply it.



---

archive/issue_comments_143181.json:
```json
{
    "body": "<a id='comment:3'></a>OKay, new extcode patch for the Mac App, totally untested (I don't have a Mac).",
    "created_at": "2012-01-20T22:36:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143181",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>OKay, new extcode patch for the Mac App, totally untested (I don't have a Mac).



---

archive/issue_comments_143182.json:
```json
{
    "body": "<a id='comment:4'></a>Attachment [11073_extcode.patch](tarball://root/attachments/some-uuid/ticket11073/11073_extcode.patch) by @jhpalmieri created at 2012-01-21 02:30:26\n\nThis works for me.  With an old version of Sage, a message about spkg/bin/sage-env not existing still shows up, but the server starts anyway, as it should.\n\nAny objections to giving this a positive review?",
    "created_at": "2012-01-21T02:30:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143182",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:4'></a>Attachment [11073_extcode.patch](tarball://root/attachments/some-uuid/ticket11073/11073_extcode.patch) by @jhpalmieri created at 2012-01-21 02:30:26

This works for me.  With an old version of Sage, a message about spkg/bin/sage-env not existing still shows up, but the server starts anyway, as it should.

Any objections to giving this a positive review?



---

archive/issue_comments_143183.json:
```json
{
    "body": "Changing merged from \"\" to \"sage-5.0.beta0\"",
    "created_at": "2012-01-22T13:11:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143183",
    "user": "https://github.com/jdemeyer"
}
```

Changing merged from "" to "sage-5.0.beta0"



---

archive/issue_comments_143184.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-01-22T13:11:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143184",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_143185.json:
```json
{
    "body": "<a id='comment:5'></a>Let's give this positive_review and release sage-5.0.beta0.",
    "created_at": "2012-01-22T13:11:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11073#issuecomment-143185",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>Let's give this positive_review and release sage-5.0.beta0.



---

archive/issue_events_028721.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-01-22T13:11:58Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11073",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11073#event-28721"
}
```
