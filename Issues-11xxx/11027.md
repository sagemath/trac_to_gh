# Issue 11027: Schur matrix decomposition over RDF/CDF

archive/issues_010931.json:
```json
{
    "body": "Wraps the  `schur()` function from `SciPy`.\n\n**Apply:**\n1. [attachment:trac_11027-schur-decomposition-v3.patch](https://github.com/sagemath/sage/files/ticket11027/trac_11027-schur-decomposition-v3.patch)\n2. [attachment:trac_11027-schur-decomposition-doctest-v2.patch](https://github.com/sagemath/sage/files/ticket11027/trac_11027-schur-decomposition-doctest-v2.patch)\n\n\n**Assignee:** @jasongrout, @williamstein\n\n**CC:**  @jasongrout @kcrisman\n\n**Author:** Rob Beezer\n\n**Reviewer:** Martin Raum, John Palmieri, Jeroen Demeyer\n\n**Merged:** sage-4.7.1.alpha3\n\nIssue created by migration from https://trac.sagemath.org/ticket/11027\n\n",
    "closed_at": "2011-06-16T07:24:06Z",
    "created_at": "2011-03-25T06:30:13Z",
    "labels": [
        "component: linear algebra",
        "minor",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.7.1",
    "title": "Schur matrix decomposition over RDF/CDF",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/11027",
    "user": "https://github.com/rbeezer"
}
```
Wraps the  `schur()` function from `SciPy`.

**Apply:**
1. [attachment:trac_11027-schur-decomposition-v3.patch](https://github.com/sagemath/sage/files/ticket11027/trac_11027-schur-decomposition-v3.patch)
2. [attachment:trac_11027-schur-decomposition-doctest-v2.patch](https://github.com/sagemath/sage/files/ticket11027/trac_11027-schur-decomposition-doctest-v2.patch)


**Assignee:** @jasongrout, @williamstein

**CC:**  @jasongrout @kcrisman

**Author:** Rob Beezer

**Reviewer:** Martin Raum, John Palmieri, Jeroen Demeyer

**Merged:** sage-4.7.1.alpha3

Issue created by migration from https://trac.sagemath.org/ticket/11027





---

archive/issue_comments_110878.json:
```json
{
    "body": "**Reviewer:** Martin Raum",
    "created_at": "2011-03-26T00:57:57Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11027#issuecomment-110878",
    "user": "https://trac.sagemath.org/admin/accounts/users/mraum"
}
```

**Reviewer:** Martin Raum



---

archive/attachments_015011.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_11027-schur-decomposition.patch",
    "asset_url": "tarball://root/attachments/ticket11027/trac_11027-schur-decomposition.patch",
    "created_at": "2011-03-26T00:57:57Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket11027/trac_11027-schur-decomposition.patch",
    "user": "https://trac.sagemath.org/admin/accounts/users/mraum"
}
```



---

archive/issue_comments_110879.json:
```json
{
    "body": "<a id='comment:1'></a>\n**Attachment:** [trac_11027-schur-decomposition.patch](https://github.com/sagemath/sage/files/ticket11027/trac_11027-schur-decomposition.patch)\n\nSome discussion is necessary: As a doctest I get\n\n```\nExpected:\n    [   0.006 - 0.001*I  0.0425 + 0.1018*I -0.6446 + 0.2201*I  0.3981 + 0.6045*I]\n    [  0.0875 - 0.005*I  0.1984 + 0.5537*I -0.5022 + 0.1944*I -0.3414 - 0.4896*I]\n    [ 0.3572 - 0.0159*I   0.2444 + 0.685*I  0.4499 - 0.1643*I  0.1983 + 0.2728*I]\n    [  0.929 - 0.0377*I   -0.111 - 0.317*I  -0.1212 + 0.044*I -0.0466 - 0.0627*I]\nGot:\n    [   0.006 - 0.001*I  0.0283 + 0.1066*I -0.6784 + 0.0611*I  0.3686 + 0.6229*I]\n    [  0.0875 - 0.005*I  0.1216 + 0.5755*I  -0.534 + 0.0699*I -0.3175 - 0.5055*I]\n    [ 0.3572 - 0.0159*I  0.1494 + 0.7118*I    0.476 - 0.053*I    0.185 + 0.282*I]\n    [  0.929 - 0.0377*I  -0.067 - 0.3291*I -0.1282 + 0.0141*I -0.0435 - 0.0649*I]\n**********************************************************************\nFile \"/scratch/mraum/sagedev/devel/sage-dev/sage/matrix/matrix_double_dense.pyx\", line 1382:\n    sage: T.round(4)\nExpected:\n    [  30.7332 + 4648.5418*I  -2342.252 + 767.2915*I -477.0197 - 1460.6287*I  -532.7363 + 318.6099*I]\n    [                      0    -0.1841 - 159.0576*I      151.3315 + 0.458*I    -15.2369 - 67.0242*I]\n    [                      0                       0      -0.5239 + 11.158*I       6.2073 - 1.1208*I]\n    [                      0                       0                       0      -0.0252 - 0.6422*I]\nGot:\n    [  30.7332 + 4648.5418*I  -2424.5875 + 443.008*I -117.3203 - 1532.0639*I  -547.4078 + 292.6858*I]\n    [                      0    -0.1841 - 159.0576*I    150.4761 + 16.0737*I    -21.0591 - 65.4288*I]\n    [                      0                       0      -0.5239 + 11.158*I       5.8811 - 2.2803*I]\n    [                      0                       0                       0      -0.0252 - 0.6422*I]\n```\n\nMathematica gives:\n\n```\nIn[1]:= m = m = Table[Table[0.0 + i + 4 * j, {i, 0, 3}], {j, 0, 3}] + Table[Table[(i + 4 * j)^3 * I, {i, 0, 3}], {j, 0, 3}]\n\nOut[1]= {{0., 1. + 1. I, 2. + 8. I, 3. + 27. I}, \n \n>    {4. + 64. I, 5. + 125. I, 6. + 216. I, 7. + 343. I}, \n \n>    {8. + 512. I, 9. + 729. I, 10. + 1000. I, 11. + 1331. I}, \n \n>    {12. + 1728. I, 13. + 2197. I, 14. + 2744. I, 15. + 3375. I}}\n\nIn[2]:= {matU, matT} = SchurDecomposition[m]\n\nOut[2]= {{{0.0060036 - 0.000979619 I, -0.0373719 + 0.10381 I, \n \n>      -0.0166147 + 0.680909 I, 0.370437 + 0.621815 I}, \n \n>     {0.0875304 - 0.00504818 I, -0.227102 + 0.542591 I, \n \n>      0.0085438 + 0.538502 I, -0.318925 - 0.504541 I}, \n \n>     {0.357191 - 0.0158906 I, -0.281727 + 0.670563 I, \n \n>      0.0016419 - 0.478947 I, 0.185814 + 0.281457 I}, \n \n>     {0.928988 - 0.0376762 I, 0.131963 - 0.308882 I, \n \n>      -0.000646133 + 0.128983 I, -0.0436872 - 0.064763 I}}, \n \n>    {{30.7332 + 4648.54 I, -2246.55 - 1013.86 I, -1535.45 - 58.1104 I, \n \n>      -546.563 + 294.26 I}, {0. + 0. I, -0.184122 - 159.058 I, \n \n>      -56.6912 - 140.312 I, -54.6402 - 41.6996 I}, \n \n>     {0. + 0. I, 0. + 0. I, -0.523917 + 11.158 I, 2.95198 + 5.57432 I}, \n \n>     {0. + 0. I, 0. + 0. I, 0. + 0. I, -0.0251565 - 0.642223 I}}}\n```\n\nThat is three different results, probably depending on the machine you run it on.",
    "created_at": "2011-03-26T00:57:57Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11027#issuecomment-110879",
    "user": "https://trac.sagemath.org/admin/accounts/users/mraum"
}
```

<a id='comment:1'></a>
**Attachment:** [trac_11027-schur-decomposition.patch](https://github.com/sagemath/sage/files/ticket11027/trac_11027-schur-decomposition.patch)

Some discussion is necessary: As a doctest I get

```
Expected:
    [   0.006 - 0.001*I  0.0425 + 0.1018*I -0.6446 + 0.2201*I  0.3981 + 0.6045*I]
    [  0.0875 - 0.005*I  0.1984 + 0.5537*I -0.5022 + 0.1944*I -0.3414 - 0.4896*I]
    [ 0.3572 - 0.0159*I   0.2444 + 0.685*I  0.4499 - 0.1643*I  0.1983 + 0.2728*I]
    [  0.929 - 0.0377*I   -0.111 - 0.317*I  -0.1212 + 0.044*I -0.0466 - 0.0627*I]
Got:
    [   0.006 - 0.001*I  0.0283 + 0.1066*I -0.6784 + 0.0611*I  0.3686 + 0.6229*I]
    [  0.0875 - 0.005*I  0.1216 + 0.5755*I  -0.534 + 0.0699*I -0.3175 - 0.5055*I]
    [ 0.3572 - 0.0159*I  0.1494 + 0.7118*I    0.476 - 0.053*I    0.185 + 0.282*I]
    [  0.929 - 0.0377*I  -0.067 - 0.3291*I -0.1282 + 0.0141*I -0.0435 - 0.0649*I]
**********************************************************************
File "/scratch/mraum/sagedev/devel/sage-dev/sage/matrix/matrix_double_dense.pyx", line 1382:
    sage: T.round(4)
Expected:
    [  30.7332 + 4648.5418*I  -2342.252 + 767.2915*I -477.0197 - 1460.6287*I  -532.7363 + 318.6099*I]
    [                      0    -0.1841 - 159.0576*I      151.3315 + 0.458*I    -15.2369 - 67.0242*I]
    [                      0                       0      -0.5239 + 11.158*I       6.2073 - 1.1208*I]
    [                      0                       0                       0      -0.0252 - 0.6422*I]
Got:
    [  30.7332 + 4648.5418*I  -2424.5875 + 443.008*I -117.3203 - 1532.0639*I  -547.4078 + 292.6858*I]
    [                      0    -0.1841 - 159.0576*I    150.4761 + 16.0737*I    -21.0591 - 65.4288*I]
    [                      0                       0      -0.5239 + 11.158*I       5.8811 - 2.2803*I]
    [                      0                       0                       0      -0.0252 - 0.6422*I]
```

Mathematica gives:

```
In[1]:= m = m = Table[Table[0.0 + i + 4 * j, {i, 0, 3}], {j, 0, 3}] + Table[Table[(i + 4 * j)^3 * I, {i, 0, 3}], {j, 0, 3}]

Out[1]= {{0., 1. + 1. I, 2. + 8. I, 3. + 27. I}, 
 
>    {4. + 64. I, 5. + 125. I, 6. + 216. I, 7. + 343. I}, 
 
>    {8. + 512. I, 9. + 729. I, 10. + 1000. I, 11. + 1331. I}, 
 
>    {12. + 1728. I, 13. + 2197. I, 14. + 2744. I, 15. + 3375. I}}

In[2]:= {matU, matT} = SchurDecomposition[m]

Out[2]= {{{0.0060036 - 0.000979619 I, -0.0373719 + 0.10381 I, 
 
>      -0.0166147 + 0.680909 I, 0.370437 + 0.621815 I}, 
 
>     {0.0875304 - 0.00504818 I, -0.227102 + 0.542591 I, 
 
>      0.0085438 + 0.538502 I, -0.318925 - 0.504541 I}, 
 
>     {0.357191 - 0.0158906 I, -0.281727 + 0.670563 I, 
 
>      0.0016419 - 0.478947 I, 0.185814 + 0.281457 I}, 
 
>     {0.928988 - 0.0376762 I, 0.131963 - 0.308882 I, 
 
>      -0.000646133 + 0.128983 I, -0.0436872 - 0.064763 I}}, 
 
>    {{30.7332 + 4648.54 I, -2246.55 - 1013.86 I, -1535.45 - 58.1104 I, 
 
>      -546.563 + 294.26 I}, {0. + 0. I, -0.184122 - 159.058 I, 
 
>      -56.6912 - 140.312 I, -54.6402 - 41.6996 I}, 
 
>     {0. + 0. I, 0. + 0. I, -0.523917 + 11.158 I, 2.95198 + 5.57432 I}, 
 
>     {0. + 0. I, 0. + 0. I, 0. + 0. I, -0.0251565 - 0.642223 I}}}
```

That is three different results, probably depending on the machine you run it on.



---

archive/issue_events_086165.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mraum",
    "created_at": "2011-03-26T00:57:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11027#event-86165"
}
```



---

archive/issue_comments_110880.json:
```json
{
    "body": "<a id='comment:2'></a>\nReplying to [mraum](#comment%3A1):\n> Some discussion is necessary\n\nDefinitely!  That is disturbing.  I don't know if `SciPy` has a random element, or it is that platform dependent.\n\nThis decomposition is not unique (mathematically).  I cannot determine if `SciPy` is suppose to return the same result across platforms.  I'll dig deeper.\n\nIn any event, your three examples all seem correct, in that the diagonals of T all have the eigenvalues of the matrix.  Run in Sage, the doctests should have checked all the key properties (unitary, upper-triangular, decomposition).\n\nDid you check Mathematica's result for unitary and decomposition?\n\nRob",
    "created_at": "2011-03-27T05:54:55Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11027#issuecomment-110880",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:2'></a>
Replying to [mraum](#comment%3A1):
> Some discussion is necessary

Definitely!  That is disturbing.  I don't know if `SciPy` has a random element, or it is that platform dependent.

This decomposition is not unique (mathematically).  I cannot determine if `SciPy` is suppose to return the same result across platforms.  I'll dig deeper.

In any event, your three examples all seem correct, in that the diagonals of T all have the eigenvalues of the matrix.  Run in Sage, the doctests should have checked all the key properties (unitary, upper-triangular, decomposition).

Did you check Mathematica's result for unitary and decomposition?

Rob



---

archive/issue_comments_110881.json:
```json
{
    "body": "<a id='comment:3'></a>\n\n```python\nA = matrix(RDF, [[-7., 5., 11., -4., 13.],\n                 [-11., -3., 11., 8., -19.],\n                 [-6., 3., -5., 0., -12.],\n                 [-4., -12., -14., 8., -8.],\n                 [11., 0., 9., 6., 10.]])\nQ, T = A.schur(base_ring=CDF)\nT.round(4)\n```\n\nUnknown hardware, etc\n\nhttp://abel.ee.ucla.edu/cvxopt/userguide/lapack.html\n\n```\n[ 5.67e+00+j1.69e+01 -2.13e+01+j2.85e+00  1.40e+00+j5.88e+00 -4.19e+00+j2.05e-01  3.19e+00-j1.01e+01]\n[ 0.00e+00-j0.00e+00  5.67e+00-j1.69e+01  1.09e+01+j5.93e-01 -3.29e+00-j1.26e+00 -1.26e+01+j7.80e+00]\n[ 0.00e+00-j0.00e+00  0.00e+00-j0.00e+00  1.27e+01+j3.43e-17 -6.83e+00+j2.18e+00  5.31e+00-j1.69e+00]\n[ 0.00e+00-j0.00e+00  0.00e+00-j0.00e+00  0.00e+00-j0.00e+00 -1.31e+01-j0.00e+00 -2.60e-01-j0.00e+00]\n[ 0.00e+00-j0.00e+00  0.00e+00-j0.00e+00  0.00e+00-j0.00e+00  0.00e+00-j0.00e+00 -7.86e+00-j0.00e+00]\n```\n\nsage-4.7.alpha2, sage.math\n\n```\n[ 5.6668 - 16.9373*I  -8.6458 + 7.8734*I -7.1561 + 14.5703*I    5.7811 + 2.688*I  -8.5999 - 5.1071*I]\n[                  0  5.6668 + 16.9373*I -10.0921 + 9.9632*I  -1.5618 - 5.8776*I   7.4924 + 8.7084*I]\n[                  0                   0             12.6587    1.6512 + 1.049*I  11.1778 + 4.4387*I]\n[                  0                   0                   0             -13.136  -0.1856 + 0.0353*I]\n[                  0                   0                   0                   0             -7.8563]\n```\n\nsage4.7.alpha2, Intel i7-2600\n\n```\n[ 5.6668 - 16.9373*I  -8.6458 + 7.8734*I -7.1561 + 14.5703*I    5.7811 + 2.688*I  -8.5999 - 5.1071*I]\n[                  0  5.6668 + 16.9373*I -10.0921 + 9.9632*I  -1.5618 - 5.8776*I   7.4924 + 8.7084*I]\n[                  0                   0             12.6587    1.6512 + 1.049*I  11.1778 + 4.4387*I]\n[                  0                   0                   0             -13.136  -0.1856 + 0.0353*I]\n[                  0                   0                   0                   0             -7.8563]\n```\n\nMathematica 6.0, sage.math\n\n```\n{\n{5.66679 - 16.9373 I, -10.6919 + 4.73528 I,        -7.15609 + 14.5703 I,        5.84829 + 2.53856 I,        -8.59995 - 5.10712 I},\n{0. + 0. I,            5.66679 + 16.9373 I,        -6.42363 + 12.6433 I,       -3.46984 - 4.99463 I,         9.86177 + 5.89218 I},\n{0. + 0. I,                      0. + 0. I,  12.6587 + 1.16017 10^-15 I,         1.67762 + 1.0062 I,          11.1778 + 4.4386 I},\n{0. + 0. I,                      0. + 0. I,                   0. + 0. I, -13.136 + 5.90551 10^-16 I,     -0.186487 + 0.0305276 I},\n{0. + 0. I,                      0. + 0. I,                   0. + 0. I,                  0. + 0. I, -7.85626 + 1.08747 10^-17 I}\n}\n```\n\nResults test out as correct (did not have a unitary matrix for the first example), but obvious variability.  The failing doctest has a large condition number (~1000), but so does another test which is not failing.  Notice that super-diagonal starts to agree at the right side.\n\nIt would be easy to fix doctests, by focusing on what the matrices should *do*, not on what they *are*.  The eigenvalues could be stripped from the diagonal of the upper-triangular matrix to test as a list, since they should not vary.\n\nThis function seems too useful elsewhere (testing Hermitian, normal, etc) to abandon it.  Thoughts on moving forward?  We could\n\n*  Abandon failing test.\n\n*  Fix tests to concentrate on properties and not on uniqueness.\n\n*  Solicit testing on sage-devel to see how variable this is across systems and processors.",
    "created_at": "2011-03-30T20:41:12Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11027#issuecomment-110881",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:3'></a>

```python
A = matrix(RDF, [[-7., 5., 11., -4., 13.],
                 [-11., -3., 11., 8., -19.],
                 [-6., 3., -5., 0., -12.],
                 [-4., -12., -14., 8., -8.],
                 [11., 0., 9., 6., 10.]])
Q, T = A.schur(base_ring=CDF)
T.round(4)
```

Unknown hardware, etc

http://abel.ee.ucla.edu/cvxopt/userguide/lapack.html

```
[ 5.67e+00+j1.69e+01 -2.13e+01+j2.85e+00  1.40e+00+j5.88e+00 -4.19e+00+j2.05e-01  3.19e+00-j1.01e+01]
[ 0.00e+00-j0.00e+00  5.67e+00-j1.69e+01  1.09e+01+j5.93e-01 -3.29e+00-j1.26e+00 -1.26e+01+j7.80e+00]
[ 0.00e+00-j0.00e+00  0.00e+00-j0.00e+00  1.27e+01+j3.43e-17 -6.83e+00+j2.18e+00  5.31e+00-j1.69e+00]
[ 0.00e+00-j0.00e+00  0.00e+00-j0.00e+00  0.00e+00-j0.00e+00 -1.31e+01-j0.00e+00 -2.60e-01-j0.00e+00]
[ 0.00e+00-j0.00e+00  0.00e+00-j0.00e+00  0.00e+00-j0.00e+00  0.00e+00-j0.00e+00 -7.86e+00-j0.00e+00]
```

sage-4.7.alpha2, sage.math

```
[ 5.6668 - 16.9373*I  -8.6458 + 7.8734*I -7.1561 + 14.5703*I    5.7811 + 2.688*I  -8.5999 - 5.1071*I]
[                  0  5.6668 + 16.9373*I -10.0921 + 9.9632*I  -1.5618 - 5.8776*I   7.4924 + 8.7084*I]
[                  0                   0             12.6587    1.6512 + 1.049*I  11.1778 + 4.4387*I]
[                  0                   0                   0             -13.136  -0.1856 + 0.0353*I]
[                  0                   0                   0                   0             -7.8563]
```

sage4.7.alpha2, Intel i7-2600

```
[ 5.6668 - 16.9373*I  -8.6458 + 7.8734*I -7.1561 + 14.5703*I    5.7811 + 2.688*I  -8.5999 - 5.1071*I]
[                  0  5.6668 + 16.9373*I -10.0921 + 9.9632*I  -1.5618 - 5.8776*I   7.4924 + 8.7084*I]
[                  0                   0             12.6587    1.6512 + 1.049*I  11.1778 + 4.4387*I]
[                  0                   0                   0             -13.136  -0.1856 + 0.0353*I]
[                  0                   0                   0                   0             -7.8563]
```

Mathematica 6.0, sage.math

```
{
{5.66679 - 16.9373 I, -10.6919 + 4.73528 I,        -7.15609 + 14.5703 I,        5.84829 + 2.53856 I,        -8.59995 - 5.10712 I},
{0. + 0. I,            5.66679 + 16.9373 I,        -6.42363 + 12.6433 I,       -3.46984 - 4.99463 I,         9.86177 + 5.89218 I},
{0. + 0. I,                      0. + 0. I,  12.6587 + 1.16017 10^-15 I,         1.67762 + 1.0062 I,          11.1778 + 4.4386 I},
{0. + 0. I,                      0. + 0. I,                   0. + 0. I, -13.136 + 5.90551 10^-16 I,     -0.186487 + 0.0305276 I},
{0. + 0. I,                      0. + 0. I,                   0. + 0. I,                  0. + 0. I, -7.85626 + 1.08747 10^-17 I}
}
```

Results test out as correct (did not have a unitary matrix for the first example), but obvious variability.  The failing doctest has a large condition number (~1000), but so does another test which is not failing.  Notice that super-diagonal starts to agree at the right side.

It would be easy to fix doctests, by focusing on what the matrices should *do*, not on what they *are*.  The eigenvalues could be stripped from the diagonal of the upper-triangular matrix to test as a list, since they should not vary.

This function seems too useful elsewhere (testing Hermitian, normal, etc) to abandon it.  Thoughts on moving forward?  We could

*  Abandon failing test.

*  Fix tests to concentrate on properties and not on uniqueness.

*  Solicit testing on sage-devel to see how variable this is across systems and processors.



---

archive/issue_comments_110882.json:
```json
{
    "body": "<a id='comment:5'></a>\nI wouldn't support abandoning the test. But of cause it tests something, that is not guaranteed by the (mathematical) definitions.\nMy suggestion is:\n1) Emphasize in the documentation that the decomposition cannot be assumed to be unique. In particular, it can even vary on different machines.\n2) Actually the crucial: U is unitary, A is upper tridiagonal, the eigenvalues are in \"right\" order.\n3) One can also test the Frobenius norm. That's not very deep, but it is a further invariant for the nilpotent part of A.\n\nYour thoughts?",
    "created_at": "2011-03-30T21:22:04Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11027#issuecomment-110882",
    "user": "https://trac.sagemath.org/admin/accounts/users/mraum"
}
```

<a id='comment:5'></a>
I wouldn't support abandoning the test. But of cause it tests something, that is not guaranteed by the (mathematical) definitions.
My suggestion is:
1) Emphasize in the documentation that the decomposition cannot be assumed to be unique. In particular, it can even vary on different machines.
2) Actually the crucial: U is unitary, A is upper tridiagonal, the eigenvalues are in "right" order.
3) One can also test the Frobenius norm. That's not very deep, but it is a further invariant for the nilpotent part of A.

Your thoughts?



---

archive/issue_comments_110883.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [rbeezer](#comment%3A3):\n\n> *  Fix tests to concentrate on properties and not on uniqueness.\n\n+1\n\n> *  Solicit testing on sage-devel to see how variable this is across systems and processors.\n\nAlso, you might write to the scipy list and ask how much variability we should expect on different platforms.",
    "created_at": "2011-03-30T21:29:59Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11027#issuecomment-110883",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:6'></a>
Replying to [rbeezer](#comment%3A3):

> *  Fix tests to concentrate on properties and not on uniqueness.

+1

> *  Solicit testing on sage-devel to see how variable this is across systems and processors.

Also, you might write to the scipy list and ask how much variability we should expect on different platforms.



---

archive/issue_comments_110884.json:
```json
{
    "body": "<a id='comment:7'></a>\nHi Martin and Jason,\n\nThanks - those are all great suggestions.  I'll probably get back to this tomorrow.\n\nRob",
    "created_at": "2011-03-30T22:06:41Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11027#issuecomment-110884",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:7'></a>
Hi Martin and Jason,

Thanks - those are all great suggestions.  I'll probably get back to this tomorrow.

Rob



---

archive/issue_events_086166.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2011-03-31T19:03:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11027#event-86166"
}
```



---

archive/issue_events_086167.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2011-03-31T19:03:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11027#event-86167"
}
```



---

archive/issue_comments_110885.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n Wraps the  `schur()` function from `SciPy`.\n+\n+Apply trac_11027-schur-decomposition-v2.patch\n``````\n",
    "created_at": "2011-03-31T19:03:58Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11027#issuecomment-110885",
    "user": "https://github.com/rbeezer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,3 @@
 Wraps the  `schur()` function from `SciPy`.
+
+Apply trac_11027-schur-decomposition-v2.patch
``````




---

archive/attachments_015012.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_11027-schur-decomposition-v2.patch",
    "asset_url": "tarball://root/attachments/ticket11027/trac_11027-schur-decomposition-v2.patch",
    "created_at": "2011-03-31T19:03:58Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket11027/trac_11027-schur-decomposition-v2.patch",
    "user": "https://github.com/rbeezer"
}
```



---

archive/issue_comments_110886.json:
```json
{
    "body": "<a id='comment:8'></a>\n**Attachment:** [trac_11027-schur-decomposition-v2.patch](https://github.com/sagemath/sage/files/ticket11027/trac_11027-schur-decomposition-v2.patch)\n\nv2 patch adjusts the tests to not rely on exact values in the unitary matrix, nor above the diagonal in the upper-triangular matrix.  It adds a few more checks on the diagonal entries, which are the eigenvalues of the matrix.  There are also a couple of new checks on the 2-norm of the similar matrices, one for the real case and one for the complex case.\n\nThis passes tests on my desktop (Ubuntu, i7-2600) and on sage.math.\n\nJason - would you mind testing this on a Mac before we turn it loose?\n\nRob",
    "created_at": "2011-03-31T19:03:58Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11027#issuecomment-110886",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:8'></a>
**Attachment:** [trac_11027-schur-decomposition-v2.patch](https://github.com/sagemath/sage/files/ticket11027/trac_11027-schur-decomposition-v2.patch)

v2 patch adjusts the tests to not rely on exact values in the unitary matrix, nor above the diagonal in the upper-triangular matrix.  It adds a few more checks on the diagonal entries, which are the eigenvalues of the matrix.  There are also a couple of new checks on the 2-norm of the similar matrices, one for the real case and one for the complex case.

This passes tests on my desktop (Ubuntu, i7-2600) and on sage.math.

Jason - would you mind testing this on a Mac before we turn it loose?

Rob



---

archive/issue_events_086168.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mraum",
    "created_at": "2011-04-01T01:08:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11027#event-86168"
}
```



---

archive/issue_events_086169.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mraum",
    "created_at": "2011-04-01T01:08:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11027#event-86169"
}
```



---

archive/issue_comments_110887.json:
```json
{
    "body": "<a id='comment:9'></a>\nThat's very good. And now all tests pass.\n\nI just noticed, and include this as a comment: Shouldn't we think of Rstyfying the matrix_double_dense file? Currently all your nice documentation doesn't show up in the reference manual. In particular, the schur method, that is somewhat unique to this class, won't be advertised.",
    "created_at": "2011-04-01T01:08:27Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11027#issuecomment-110887",
    "user": "https://trac.sagemath.org/admin/accounts/users/mraum"
}
```

<a id='comment:9'></a>
That's very good. And now all tests pass.

I just noticed, and include this as a comment: Shouldn't we think of Rstyfying the matrix_double_dense file? Currently all your nice documentation doesn't show up in the reference manual. In particular, the schur method, that is somewhat unique to this class, won't be advertised.



---

archive/issue_comments_110888.json:
```json
{
    "body": "**Author:** Rob Beezer",
    "created_at": "2011-04-01T01:08:27Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11027#issuecomment-110888",
    "user": "https://trac.sagemath.org/admin/accounts/users/mraum"
}
```

**Author:** Rob Beezer



---

archive/issue_comments_110889.json:
```json
{
    "body": "<a id='comment:10'></a>\nThanks, Martin!  Yes, I went through this whole file once, but then started changing and adding whole routines and realized I was walking all over my formatting changes/updates.  So I thought it would be best to wait just a little bit.\n\nOnce changes settle down I *will* go through and do some documentation (and minor code) clean-up and add this to the docs.  It'll go up on #8046 once it happens.  I've been checking my new documentation in the notebook as I go, so it should all format properly.\n\n(I may add an exact Schur method, just for instructional use.)",
    "created_at": "2011-04-01T01:22:47Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11027#issuecomment-110889",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:10'></a>
Thanks, Martin!  Yes, I went through this whole file once, but then started changing and adding whole routines and realized I was walking all over my formatting changes/updates.  So I thought it would be best to wait just a little bit.

Once changes settle down I *will* go through and do some documentation (and minor code) clean-up and add this to the docs.  It'll go up on #8046 once it happens.  I've been checking my new documentation in the notebook as I go, so it should all format properly.

(I may add an exact Schur method, just for instructional use.)



---

archive/issue_events_086170.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-04-05T11:59:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11027#event-86170"
}
```



---

archive/issue_events_086171.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-04-05T11:59:20Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11027#event-86171"
}
```



---

archive/issue_comments_110890.json:
```json
{
    "body": "**Merged:** sage-4.7.alpha4",
    "created_at": "2011-04-05T11:59:20Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11027#issuecomment-110890",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-4.7.alpha4



---

archive/issue_comments_110891.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [rbeezer](#comment%3A8):\n> Jason - would you mind testing this on a Mac before we turn it loose?\n\nIt looks like this didn't happen, and I'm getting doctest failures.  On a Mac (OS X 10.6.7, Intel):\n\n```\nFile \"/Applications/sage_builds/clean/sage-4.7.alpha4/devel/sage-main/sage/matrix/matrix_double_dense.pyx\", line 1538:\n    sage: T.round(4)\nExpected:\n    [-13.5698      0.0      0.0      0.0]\n    [     0.0  -0.8508     -0.0     -0.0]\n    [     0.0      0.0   7.7664      0.0]\n    [     0.0      0.0      0.0  11.6542]\nGot:\n    [-13.5698      0.0      0.0      0.0]\n    [     0.0  -0.8508      0.0      0.0]\n    [     0.0      0.0   7.7664      0.0]\n    [     0.0      0.0      0.0  11.6542]\n```\nOn t2.math.washington.edu (Solaris on sparc):\n\n```\n\nFile \"/scratch/palmieri/clean/sage-4.7.alpha4/devel/sage/sage/matrix/matrix_double_dense.pyx\", line 1538:\n    sage: T.round(4)\nExpected:\n    [-13.5698      0.0      0.0      0.0]\n    [     0.0  -0.8508     -0.0     -0.0]\n    [     0.0      0.0   7.7664      0.0]\n    [     0.0      0.0      0.0  11.6542]\nGot:\n    [-13.5698      0.0      0.0      0.0]\n    [     0.0  -0.8508      0.0     -0.0]\n    [     0.0      0.0   7.7664     -0.0]\n    [     0.0      0.0      0.0  11.6542]\n```",
    "created_at": "2011-04-11T18:54:09Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11027#issuecomment-110891",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:12'></a>
Replying to [rbeezer](#comment%3A8):
> Jason - would you mind testing this on a Mac before we turn it loose?

It looks like this didn't happen, and I'm getting doctest failures.  On a Mac (OS X 10.6.7, Intel):

```
File "/Applications/sage_builds/clean/sage-4.7.alpha4/devel/sage-main/sage/matrix/matrix_double_dense.pyx", line 1538:
    sage: T.round(4)
Expected:
    [-13.5698      0.0      0.0      0.0]
    [     0.0  -0.8508     -0.0     -0.0]
    [     0.0      0.0   7.7664      0.0]
    [     0.0      0.0      0.0  11.6542]
Got:
    [-13.5698      0.0      0.0      0.0]
    [     0.0  -0.8508      0.0      0.0]
    [     0.0      0.0   7.7664      0.0]
    [     0.0      0.0      0.0  11.6542]
```
On t2.math.washington.edu (Solaris on sparc):

```

File "/scratch/palmieri/clean/sage-4.7.alpha4/devel/sage/sage/matrix/matrix_double_dense.pyx", line 1538:
    sage: T.round(4)
Expected:
    [-13.5698      0.0      0.0      0.0]
    [     0.0  -0.8508     -0.0     -0.0]
    [     0.0      0.0   7.7664      0.0]
    [     0.0      0.0      0.0  11.6542]
Got:
    [-13.5698      0.0      0.0      0.0]
    [     0.0  -0.8508      0.0     -0.0]
    [     0.0      0.0   7.7664     -0.0]
    [     0.0      0.0      0.0  11.6542]
```



---

archive/issue_comments_110892.json:
```json
{
    "body": "<a id='comment:13'></a>\nUnmerging this in sage-4.7.alpha5...",
    "created_at": "2011-04-11T19:13:19Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11027#issuecomment-110892",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>
Unmerging this in sage-4.7.alpha5...



---

archive/issue_comments_110893.json:
```json
{
    "body": "**Changing merged** from \"sage-4.7.alpha4\" to \"\".",
    "created_at": "2011-04-11T19:13:19Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11027#issuecomment-110893",
    "user": "https://github.com/jdemeyer"
}
```

**Changing merged** from "sage-4.7.alpha4" to "".



---

archive/issue_events_086172.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-04-11T19:13:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11027#event-86172"
}
```



---

archive/issue_comments_110894.json:
```json
{
    "body": "<a id='comment:15'></a>\nOn OpenSolaris 06/2009 (quad core Xeon):\n\n```\nFile \"/export/home/drkirkby/sage-4.7.alpha4/devel/sage/sage/matrix/matrix_double_dense.pyx\", line 1538:\n    sage: T.round(4)\nExpected:\n    [-13.5698      0.0      0.0      0.0]\n    [     0.0  -0.8508     -0.0     -0.0]\n    [     0.0      0.0   7.7664      0.0]\n    [     0.0      0.0      0.0  11.6542]\nGot:\n    [-13.5698      0.0      0.0      0.0]\n    [     0.0  -0.8508      0.0     -0.0]\n    [     0.0      0.0   7.7664      0.0]\n    [     0.0      0.0      0.0  11.6542]\n**********************************************************************\n```",
    "created_at": "2011-04-11T19:29:55Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11027#issuecomment-110894",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

<a id='comment:15'></a>
On OpenSolaris 06/2009 (quad core Xeon):

```
File "/export/home/drkirkby/sage-4.7.alpha4/devel/sage/sage/matrix/matrix_double_dense.pyx", line 1538:
    sage: T.round(4)
Expected:
    [-13.5698      0.0      0.0      0.0]
    [     0.0  -0.8508     -0.0     -0.0]
    [     0.0      0.0   7.7664      0.0]
    [     0.0      0.0      0.0  11.6542]
Got:
    [-13.5698      0.0      0.0      0.0]
    [     0.0  -0.8508      0.0     -0.0]
    [     0.0      0.0   7.7664      0.0]
    [     0.0      0.0      0.0  11.6542]
**********************************************************************
```



---

archive/issue_comments_110895.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [jhpalmieri](#comment%3A12):\n> Replying to [rbeezer](#comment%3A8):\n> > Jason - would you mind testing this on a Mac before we turn it loose?\n\n> \n> It looks like this didn't happen, and I'm getting doctest failures.  On a Mac (OS X 10.6.7, Intel):\n\nThanks, John and Dave.\n\nI'm more concerned about #10837, so if you see those variable results, please let me know about that.\n\nJohn - I have an account on Skynet, so I should do some testing there, I see.  Do you have any pointers to etiquette/practices there?  Do I build in my home directory?  Should I \"nice\" things or limit the number of cores?\n\nRob",
    "created_at": "2011-04-11T19:49:03Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11027#issuecomment-110895",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:16'></a>
Replying to [jhpalmieri](#comment%3A12):
> Replying to [rbeezer](#comment%3A8):
> > Jason - would you mind testing this on a Mac before we turn it loose?

> 
> It looks like this didn't happen, and I'm getting doctest failures.  On a Mac (OS X 10.6.7, Intel):

Thanks, John and Dave.

I'm more concerned about #10837, so if you see those variable results, please let me know about that.

John - I have an account on Skynet, so I should do some testing there, I see.  Do you have any pointers to etiquette/practices there?  Do I build in my home directory?  Should I "nice" things or limit the number of cores?

Rob



---

archive/issue_comments_110896.json:
```json
{
    "body": "<a id='comment:17'></a>\nSome clarification of how this got into sage-4.7.alpha4: when I build a new Sage alpha release, it is tested on the buildbot which tests on many machines, including (most of) the Skynet machines.  So this doctest problems did show up.  However, in my original sage-4.7.alpha4, I also had #10837 and I mistook those doctest failures to come from #10837 instead.  So I unmerged #10837 and went ahead to release sage-4.7.alpha4 without testing again.  Experience shows that testing again after unmerging a patch from a candidate alpha is usually not necessary and only slows down things.  In this case, it would have caught the errors from #11027.\n\nLong story short: even if you don't test yourself, a patch will not get in a final Sage release if it fails doctests on Skynet.",
    "created_at": "2011-04-11T20:29:11Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11027#issuecomment-110896",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>
Some clarification of how this got into sage-4.7.alpha4: when I build a new Sage alpha release, it is tested on the buildbot which tests on many machines, including (most of) the Skynet machines.  So this doctest problems did show up.  However, in my original sage-4.7.alpha4, I also had #10837 and I mistook those doctest failures to come from #10837 instead.  So I unmerged #10837 and went ahead to release sage-4.7.alpha4 without testing again.  Experience shows that testing again after unmerging a patch from a candidate alpha is usually not necessary and only slows down things.  In this case, it would have caught the errors from #11027.

Long story short: even if you don't test yourself, a patch will not get in a final Sage release if it fails doctests on Skynet.



---

archive/issue_comments_110897.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [jdemeyer](#comment%3A17):\n> Some clarification of how this got into sage-4.7.alpha4: \n\nThanks, Jeroen.  No problems here.\n\nI'd misunderstood and thought #10837 was in as well, so this helped clear that up for me.\n\nI just need to get into the habit of testing on a wider variety of platforms if I'm going to tackle these numerical procedures.  sage.math, of course, but I should add `SkyNet` to my repertoire also.\n\nSorry for the trouble - I should have realized these -0.0 entries were a bad sign.\n\nAs always, thanks for all your careful work as release manager.\n\nRob",
    "created_at": "2011-04-12T03:47:38Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11027#issuecomment-110897",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:18'></a>
Replying to [jdemeyer](#comment%3A17):
> Some clarification of how this got into sage-4.7.alpha4: 

Thanks, Jeroen.  No problems here.

I'd misunderstood and thought #10837 was in as well, so this helped clear that up for me.

I just need to get into the habit of testing on a wider variety of platforms if I'm going to tackle these numerical procedures.  sage.math, of course, but I should add `SkyNet` to my repertoire also.

Sorry for the trouble - I should have realized these -0.0 entries were a bad sign.

As always, thanks for all your careful work as release manager.

Rob



---

archive/issue_comments_110898.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [rbeezer](#comment%3A16):\n> John - I have an account on Skynet, so I should do some testing there, I see.  Do you have any pointers to etiquette/practices there?  Do I build in my home directory?  Should I \"nice\" things or limit the number of cores?\n\nIgnore the request, John. I think I have found my way.  Maybe.\n\nRob",
    "created_at": "2011-04-12T04:01:24Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11027#issuecomment-110898",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:19'></a>
Replying to [rbeezer](#comment%3A16):
> John - I have an account on Skynet, so I should do some testing there, I see.  Do you have any pointers to etiquette/practices there?  Do I build in my home directory?  Should I "nice" things or limit the number of cores?

Ignore the request, John. I think I have found my way.  Maybe.

Rob



---

archive/issue_comments_110899.json:
```json
{
    "body": "<a id='comment:20'></a>\nWell, it looks like this was just carelessness on my part, and not any kind of platform-variability problem.  On other doctests, which seem to pass for the various testers, I have code like\n\n```\nsage: T = T.zero_at(1.0e-12).change_ring(RDF)\nsage: T.round(6)\n```\n\nThe first line was missing on this one problem test - the doctest patch just adds in such a line.  Likely a cut/paste when there should have been a copy/paste.\n\nWith the new patch, this passes tests on my 64-bit Ubuntu machine and on sage.math.  I'm in the process of testing on `SkyNet/cleo`.  I'm confident this fix should be OK, but \"once burned, twice shy.\"\n\nThis is ready for review, but I'd like to have the cleo result before it gets flipped to positive review.",
    "created_at": "2011-04-12T05:11:47Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11027#issuecomment-110899",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:20'></a>
Well, it looks like this was just carelessness on my part, and not any kind of platform-variability problem.  On other doctests, which seem to pass for the various testers, I have code like

```
sage: T = T.zero_at(1.0e-12).change_ring(RDF)
sage: T.round(6)
```

The first line was missing on this one problem test - the doctest patch just adds in such a line.  Likely a cut/paste when there should have been a copy/paste.

With the new patch, this passes tests on my 64-bit Ubuntu machine and on sage.math.  I'm in the process of testing on `SkyNet/cleo`.  I'm confident this fix should be OK, but "once burned, twice shy."

This is ready for review, but I'd like to have the cleo result before it gets flipped to positive review.



---

archive/issue_events_086173.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2011-04-12T05:11:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11027#event-86173"
}
```



---

archive/issue_events_086174.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2011-04-12T05:11:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11027#event-86174"
}
```



---

archive/issue_comments_110900.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,6 @@\n Wraps the  `schur()` function from `SciPy`.\n \n-Apply trac_11027-schur-decomposition-v2.patch\n+**Apply:**\n+1. [attachment:trac_11027-schur-decomposition-v2.patch](https://github.com/sagemath/sage/files/ticket11027/trac_11027-schur-decomposition-v2.patch)\n+2. [attachment:trac_11027-schur-decomposition-doctest.patch](https://github.com/sagemath/sage/files/ticket11027/trac_11027-schur-decomposition-doctest.patch)\n+\n``````\n",
    "created_at": "2011-04-12T05:11:47Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11027#issuecomment-110900",
    "user": "https://github.com/rbeezer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,6 @@
 Wraps the  `schur()` function from `SciPy`.
 
-Apply trac_11027-schur-decomposition-v2.patch
+**Apply:**
+1. [attachment:trac_11027-schur-decomposition-v2.patch](https://github.com/sagemath/sage/files/ticket11027/trac_11027-schur-decomposition-v2.patch)
+2. [attachment:trac_11027-schur-decomposition-doctest.patch](https://github.com/sagemath/sage/files/ticket11027/trac_11027-schur-decomposition-doctest.patch)
+
``````




---

archive/issue_comments_110901.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [rbeezer](#comment%3A20):\n> This is ready for review, but I'd like to have the cleo result before it gets flipped to positive review.\n\nI couldn't get Sage past building PARI on cleo, and this seems to be a problem with a few tickets floating around, and I didn't see a quick fix (ie one I could understand).  So I'm going to abandon that and let the buildbots do any further checks.  As mentioned, i'm pretty confident about this fixing the problem, across platforms.\n\nIt's a one-line patch, and this decomposition will be *really* useful for lots of checks (like Hermitian, unitary, etc), so this is ready to go for a review.",
    "created_at": "2011-04-13T00:31:15Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11027#issuecomment-110901",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:21'></a>
Replying to [rbeezer](#comment%3A20):
> This is ready for review, but I'd like to have the cleo result before it gets flipped to positive review.

I couldn't get Sage past building PARI on cleo, and this seems to be a problem with a few tickets floating around, and I didn't see a quick fix (ie one I could understand).  So I'm going to abandon that and let the buildbots do any further checks.  As mentioned, i'm pretty confident about this fixing the problem, across platforms.

It's a one-line patch, and this decomposition will be *really* useful for lots of checks (like Hermitian, unitary, etc), so this is ready to go for a review.



---

archive/issue_comments_110902.json:
```json
{
    "body": "<a id='comment:22'></a>\nHi Rob,\n\nI think it's going to have to be more than a one-line patch, maybe three or four lines: in addition to adding the call to `zero_at`, the matrix entries in the doctest which are currently `-0.0` need to be changed to `0.0`, don't they?",
    "created_at": "2011-04-13T01:16:40Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11027#issuecomment-110902",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:22'></a>
Hi Rob,

I think it's going to have to be more than a one-line patch, maybe three or four lines: in addition to adding the call to `zero_at`, the matrix entries in the doctest which are currently `-0.0` need to be changed to `0.0`, don't they?



---

archive/issue_events_086175.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2011-04-13T01:16:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11027#event-86175"
}
```



---

archive/issue_events_086176.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2011-04-13T01:16:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11027#event-86176"
}
```



---

archive/issue_comments_110903.json:
```json
{
    "body": "<a id='comment:23'></a>\nReplying to [jhpalmieri](#comment%3A22):\n> Hi Rob,\n> \n> I think it's going to have to be more than a one-line patch, maybe three or four lines: in addition to adding the call to `zero_at`, the matrix entries in the doctest which are currently `-0.0` need to be changed to `0.0`, don't they? \n\nAargh!  Yes, of course.  I think I was doctesting the wrong file since I've had my head into matrix2.pyx heavily the past few days.\n\nI'll get it right in the morning.  Thanks for the gentle correction.\n\nRob",
    "created_at": "2011-04-13T06:06:43Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11027#issuecomment-110903",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:23'></a>
Replying to [jhpalmieri](#comment%3A22):
> Hi Rob,
> 
> I think it's going to have to be more than a one-line patch, maybe three or four lines: in addition to adding the call to `zero_at`, the matrix entries in the doctest which are currently `-0.0` need to be changed to `0.0`, don't they? 

Aargh!  Yes, of course.  I think I was doctesting the wrong file since I've had my head into matrix2.pyx heavily the past few days.

I'll get it right in the morning.  Thanks for the gentle correction.

Rob



---

archive/attachments_015013.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_11027-schur-decomposition-doctest.patch",
    "asset_url": "tarball://root/attachments/ticket11027/trac_11027-schur-decomposition-doctest.patch",
    "created_at": "2011-04-13T17:04:48Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket11027/trac_11027-schur-decomposition-doctest.patch",
    "user": "https://github.com/rbeezer"
}
```



---

archive/issue_comments_110904.json:
```json
{
    "body": "**Attachment:** [trac_11027-schur-decomposition-doctest.patch](https://github.com/sagemath/sage/files/ticket11027/trac_11027-schur-decomposition-doctest.patch)",
    "created_at": "2011-04-13T17:04:48Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11027#issuecomment-110904",
    "user": "https://github.com/rbeezer"
}
```

**Attachment:** [trac_11027-schur-decomposition-doctest.patch](https://github.com/sagemath/sage/files/ticket11027/trac_11027-schur-decomposition-doctest.patch)



---

archive/issue_comments_110905.json:
```json
{
    "body": "<a id='comment:24'></a>\nI've replaced the \"doctest\" patch with a new one.  With two lines now.",
    "created_at": "2011-04-13T17:06:48Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11027#issuecomment-110905",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:24'></a>
I've replaced the "doctest" patch with a new one.  With two lines now.



---

archive/issue_events_086177.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2011-04-13T17:06:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11027#event-86177"
}
```



---

archive/issue_events_086178.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2011-04-13T17:06:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11027#event-86178"
}
```



---

archive/issue_comments_110906.json:
```json
{
    "body": "**Changing reviewer** from \"Martin Raum\" to \"Martin Raum, John Palmieri\".",
    "created_at": "2011-04-13T18:48:57Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11027#issuecomment-110906",
    "user": "https://github.com/jhpalmieri"
}
```

**Changing reviewer** from "Martin Raum" to "Martin Raum, John Palmieri".



---

archive/issue_events_086179.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2011-04-13T18:48:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11027#event-86179"
}
```



---

archive/issue_events_086180.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2011-04-13T18:48:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11027#event-86180"
}
```



---

archive/issue_comments_110907.json:
```json
{
    "body": "<a id='comment:25'></a>\nThis now works on Solaris, OS X, sage.math.",
    "created_at": "2011-04-13T18:48:57Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11027#issuecomment-110907",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:25'></a>
This now works on Solaris, OS X, sage.math.



---

archive/issue_events_086181.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-04-13T18:51:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "milestone": "sage-4.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11027#event-86181"
}
```



---

archive/issue_events_086182.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-04-13T18:51:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "milestone": "sage-4.7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11027#event-86182"
}
```



---

archive/issue_comments_110908.json:
```json
{
    "body": "<a id='comment:27'></a>\nReplying to [jhpalmieri](#comment%3A25):\n> This now works on Solaris, OS X, sage.math.\n\nHi John,\n\nThanks for sticking with this mess and the extra testing.  It'll be a valuable one to have - I had not appreciated how useful this is.  \n\nI've been looking at making an exact version for instructional purposes as well.\n\nRob",
    "created_at": "2011-04-14T04:24:47Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11027#issuecomment-110908",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:27'></a>
Replying to [jhpalmieri](#comment%3A25):
> This now works on Solaris, OS X, sage.math.

Hi John,

Thanks for sticking with this mess and the extra testing.  It'll be a valuable one to have - I had not appreciated how useful this is.  

I've been looking at making an exact version for instructional purposes as well.

Rob



---

archive/issue_comments_110909.json:
```json
{
    "body": "**Merged:** sage-4.7.1.alpha0",
    "created_at": "2011-04-14T07:20:02Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11027#issuecomment-110909",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-4.7.1.alpha0



---

archive/issue_events_086183.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-04-14T07:20:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11027#event-86183"
}
```



---

archive/issue_events_086184.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-04-14T07:20:02Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11027#event-86184"
}
```



---

archive/issue_comments_110910.json:
```json
{
    "body": "<a id='comment:29'></a>\nAttempting to appease the buildbot's prerequisites for #10848.\n\nApply trac_11027-schur-decomposition-v2.patch, trac_11027-schur-decomposition-doctest.patch",
    "created_at": "2011-04-19T00:10:58Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11027#issuecomment-110910",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:29'></a>
Attempting to appease the buildbot's prerequisites for #10848.

Apply trac_11027-schur-decomposition-v2.patch, trac_11027-schur-decomposition-doctest.patch



---

archive/attachments_015014.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_11027-schur-decomposition-v3.patch",
    "asset_url": "tarball://root/attachments/ticket11027/trac_11027-schur-decomposition-v3.patch",
    "created_at": "2011-05-24T10:21:09Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket11027/trac_11027-schur-decomposition-v3.patch",
    "user": "https://github.com/jdemeyer"
}
```



---

archive/issue_comments_110911.json:
```json
{
    "body": "**Attachment:** [trac_11027-schur-decomposition-v3.patch](https://github.com/sagemath/sage/files/ticket11027/trac_11027-schur-decomposition-v3.patch)\n\nPatch rebased to sage-4.7",
    "created_at": "2011-05-24T10:21:09Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11027#issuecomment-110911",
    "user": "https://github.com/jdemeyer"
}
```

**Attachment:** [trac_11027-schur-decomposition-v3.patch](https://github.com/sagemath/sage/files/ticket11027/trac_11027-schur-decomposition-v3.patch)

Patch rebased to sage-4.7



---

archive/issue_comments_110912.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n Wraps the  `schur()` function from `SciPy`.\n \n **Apply:**\n-1. [attachment:trac_11027-schur-decomposition-v2.patch](https://github.com/sagemath/sage/files/ticket11027/trac_11027-schur-decomposition-v2.patch)\n+1. [attachment:trac_11027-schur-decomposition-v3.patch](https://github.com/sagemath/sage/files/ticket11027/trac_11027-schur-decomposition-v3.patch)\n 2. [attachment:trac_11027-schur-decomposition-doctest.patch](https://github.com/sagemath/sage/files/ticket11027/trac_11027-schur-decomposition-doctest.patch)\n \n``````\n",
    "created_at": "2011-05-24T10:21:27Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11027#issuecomment-110912",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 Wraps the  `schur()` function from `SciPy`.
 
 **Apply:**
-1. [attachment:trac_11027-schur-decomposition-v2.patch](https://github.com/sagemath/sage/files/ticket11027/trac_11027-schur-decomposition-v2.patch)
+1. [attachment:trac_11027-schur-decomposition-v3.patch](https://github.com/sagemath/sage/files/ticket11027/trac_11027-schur-decomposition-v3.patch)
 2. [attachment:trac_11027-schur-decomposition-doctest.patch](https://github.com/sagemath/sage/files/ticket11027/trac_11027-schur-decomposition-doctest.patch)
 
``````




---

archive/issue_comments_110913.json:
```json
{
    "body": "<a id='comment:31'></a>\nOS X 10.4 PPC returns eigenvalues in a different order:\n\n```\nsage -t -long \"devel/sage/sage/matrix/matrix_double_dense.pyx\"\n**********************************************************************\nFile \"/Users/jdemeyer/sage-4.7.1.alpha0/devel/sage/sage/matrix/matrix_double_dense.pyx\", line 1571:\n    sage: A.eigenvalues()\nExpected:\n    [-0.789... + 2.336...*I, -0.789... - 2.336...*I, -5.710... + 8.382...*I, -5.710... - 8.382...*I]\nGot:\n    [-5.71017354352 + 8.38264062467*I, -5.71017354352 - 8.38264062467*I, -0.789826456477 + 2.33693044103*I, -0.789826456477 - 2.33693044103*I]\n**********************************************************************\n```",
    "created_at": "2011-05-26T09:06:21Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11027#issuecomment-110913",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:31'></a>
OS X 10.4 PPC returns eigenvalues in a different order:

```
sage -t -long "devel/sage/sage/matrix/matrix_double_dense.pyx"
**********************************************************************
File "/Users/jdemeyer/sage-4.7.1.alpha0/devel/sage/sage/matrix/matrix_double_dense.pyx", line 1571:
    sage: A.eigenvalues()
Expected:
    [-0.789... + 2.336...*I, -0.789... - 2.336...*I, -5.710... + 8.382...*I, -5.710... - 8.382...*I]
Got:
    [-5.71017354352 + 8.38264062467*I, -5.71017354352 - 8.38264062467*I, -0.789826456477 + 2.33693044103*I, -0.789826456477 - 2.33693044103*I]
**********************************************************************
```



---

archive/issue_comments_110914.json:
```json
{
    "body": "**Changing merged** from \"sage-4.7.1.alpha0\" to \"\".",
    "created_at": "2011-05-26T09:06:21Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11027#issuecomment-110914",
    "user": "https://github.com/jdemeyer"
}
```

**Changing merged** from "sage-4.7.1.alpha0" to "".



---

archive/issue_events_086185.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-05-26T09:06:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11027#event-86185"
}
```



---

archive/issue_events_086186.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-05-26T09:07:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11027#event-86186"
}
```



---

archive/issue_events_086187.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-05-26T09:07:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11027#event-86187"
}
```



---

archive/issue_comments_110915.json:
```json
{
    "body": "<a id='comment:34'></a>\n*ping* any ideas?",
    "created_at": "2011-06-08T12:12:41Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11027#issuecomment-110915",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:34'></a>
*ping* any ideas?



---

archive/issue_comments_110916.json:
```json
{
    "body": "<a id='comment:35'></a>\nReplying to [jdemeyer](#comment%3A34):\n> *ping* any ideas?\n\nHi Jeroen.  Thanks for the interest.\n\nIdeas?  Lots:\n\n(a) Doctesting this numerical stuff is hard.\n\n(b) We should not be relying on Apple's vector libraries.\n\n(c) Organizing Sage Days 31 has me distracted.\n\nBut seriously,\n\n(i) I've thinking about taking on eigenvalues and eigenvectors, generally.  There is a lot of inconsistency floating around.  Ordering eigenvalues would be one thing to tackle.  Which is the real reason I have not moved on this one.\n\n(ii) Doctest in question is about verifying the 2x2 blocks along the diagonal of the real Schur decomposition.  It would probably be better to not force the eigenvalues of the 2x2 blocks to match the usual Sage output, and instead just sort the \"plain\" eigenvalues to match the sorted list from the 2x2 blocks.  That would be an easy fix.\n\n(iii) The ordering of eigenvalues under \"old\" OS X might need to be investigated separately and fixed up.  On Linux and Sage 4.7 I get:\n\n```\nsage: A = matrix(RDF, 4, 4, [[1, 0, -3, -1],\n...                          [4, -16, -7, 0],\n...                          [1, 21, 1, -2],\n...                          [26, -1, -2, 1]])\nsage: A.eigenvalues()\n[-0.789826456477 + 2.33693044103*I, -0.789826456477 - 2.33693044103*I, -5.71017354352 + 8.38264062467*I, -5.71017354352 - 8.38264062467*I]\n```\n\nwhich is different from what you are reporting on OS X 10.4 PPC.  Probably happening at the `NumPy` level or further down.\n\nI'll likely make the change mentioned above in a few days, perhaps while at Sage Days.  On vacation at the moment.\n\nRob",
    "created_at": "2011-06-10T00:46:31Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11027#issuecomment-110916",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:35'></a>
Replying to [jdemeyer](#comment%3A34):
> *ping* any ideas?

Hi Jeroen.  Thanks for the interest.

Ideas?  Lots:

(a) Doctesting this numerical stuff is hard.

(b) We should not be relying on Apple's vector libraries.

(c) Organizing Sage Days 31 has me distracted.

But seriously,

(i) I've thinking about taking on eigenvalues and eigenvectors, generally.  There is a lot of inconsistency floating around.  Ordering eigenvalues would be one thing to tackle.  Which is the real reason I have not moved on this one.

(ii) Doctest in question is about verifying the 2x2 blocks along the diagonal of the real Schur decomposition.  It would probably be better to not force the eigenvalues of the 2x2 blocks to match the usual Sage output, and instead just sort the "plain" eigenvalues to match the sorted list from the 2x2 blocks.  That would be an easy fix.

(iii) The ordering of eigenvalues under "old" OS X might need to be investigated separately and fixed up.  On Linux and Sage 4.7 I get:

```
sage: A = matrix(RDF, 4, 4, [[1, 0, -3, -1],
...                          [4, -16, -7, 0],
...                          [1, 21, 1, -2],
...                          [26, -1, -2, 1]])
sage: A.eigenvalues()
[-0.789826456477 + 2.33693044103*I, -0.789826456477 - 2.33693044103*I, -5.71017354352 + 8.38264062467*I, -5.71017354352 - 8.38264062467*I]
```

which is different from what you are reporting on OS X 10.4 PPC.  Probably happening at the `NumPy` level or further down.

I'll likely make the change mentioned above in a few days, perhaps while at Sage Days.  On vacation at the moment.

Rob



---

archive/attachments_015015.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_11027-schur-decomposition-doctest-v2.patch",
    "asset_url": "tarball://root/attachments/ticket11027/trac_11027-schur-decomposition-doctest-v2.patch",
    "created_at": "2011-06-10T02:05:13Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket11027/trac_11027-schur-decomposition-doctest-v2.patch",
    "user": "https://github.com/rbeezer"
}
```



---

archive/issue_comments_110917.json:
```json
{
    "body": "**Attachment:** [trac_11027-schur-decomposition-doctest-v2.patch](https://github.com/sagemath/sage/files/ticket11027/trac_11027-schur-decomposition-doctest-v2.patch)",
    "created_at": "2011-06-10T02:05:13Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11027#issuecomment-110917",
    "user": "https://github.com/rbeezer"
}
```

**Attachment:** [trac_11027-schur-decomposition-doctest-v2.patch](https://github.com/sagemath/sage/files/ticket11027/trac_11027-schur-decomposition-doctest-v2.patch)



---

archive/issue_comments_110918.json:
```json
{
    "body": "<a id='comment:36'></a>\nI've made the change mentioned in (ii) above, and incorporated it into the \"doctest\" patch, which is now version 2.\n\nDoctest works properly under Linux and conveys the same information as before.  It should be more platform-independent, so hopefully it'll perform OK on OSX PPC.",
    "created_at": "2011-06-10T02:08:15Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11027#issuecomment-110918",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:36'></a>
I've made the change mentioned in (ii) above, and incorporated it into the "doctest" patch, which is now version 2.

Doctest works properly under Linux and conveys the same information as before.  It should be more platform-independent, so hopefully it'll perform OK on OSX PPC.



---

archive/issue_events_086188.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2011-06-10T02:08:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11027#event-86188"
}
```



---

archive/issue_events_086189.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2011-06-10T02:08:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11027#event-86189"
}
```



---

archive/issue_comments_110919.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,5 +2,5 @@\n \n **Apply:**\n 1. [attachment:trac_11027-schur-decomposition-v3.patch](https://github.com/sagemath/sage/files/ticket11027/trac_11027-schur-decomposition-v3.patch)\n-2. [attachment:trac_11027-schur-decomposition-doctest.patch](https://github.com/sagemath/sage/files/ticket11027/trac_11027-schur-decomposition-doctest.patch)\n+2. [attachment:trac_11027-schur-decomposition-doctest-v2.patch](https://github.com/sagemath/sage/files/ticket11027/trac_11027-schur-decomposition-doctest-v2.patch)\n \n``````\n",
    "created_at": "2011-06-10T02:08:15Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11027#issuecomment-110919",
    "user": "https://github.com/rbeezer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,5 +2,5 @@
 
 **Apply:**
 1. [attachment:trac_11027-schur-decomposition-v3.patch](https://github.com/sagemath/sage/files/ticket11027/trac_11027-schur-decomposition-v3.patch)
-2. [attachment:trac_11027-schur-decomposition-doctest.patch](https://github.com/sagemath/sage/files/ticket11027/trac_11027-schur-decomposition-doctest.patch)
+2. [attachment:trac_11027-schur-decomposition-doctest-v2.patch](https://github.com/sagemath/sage/files/ticket11027/trac_11027-schur-decomposition-doctest-v2.patch)
 
``````




---

archive/issue_comments_110920.json:
```json
{
    "body": "<a id='comment:37'></a>\nReplying to [rbeezer](#comment%3A35):\n> Replying to [jdemeyer](#comment%3A34):\n> > *ping* any ideas?\n\n> \n> Hi Jeroen.  Thanks for the interest.\n\nTo be honest, I am not particularly interested in this patch.  I just think it would be a pity to lose this work.  There are already too many tickets which are 90% finished, let this not become one of them.",
    "created_at": "2011-06-10T08:32:14Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11027#issuecomment-110920",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:37'></a>
Replying to [rbeezer](#comment%3A35):
> Replying to [jdemeyer](#comment%3A34):
> > *ping* any ideas?

> 
> Hi Jeroen.  Thanks for the interest.

To be honest, I am not particularly interested in this patch.  I just think it would be a pity to lose this work.  There are already too many tickets which are 90% finished, let this not become one of them.



---

archive/issue_comments_110921.json:
```json
{
    "body": "<a id='comment:38'></a>\nReplying to [jdemeyer](#comment%3A37):\n> I just think it would be a pity to lose this work.  There are already too many tickets which are 90% finished, let this not become one of them.\n\nThat qualifies as interest.  ;-)  I may be slow, but rarely give up.  Except for #10765.\n\nPatchbot gives this a green light.  What it really needs is a test run on OS X 10.4 PPC.  Anybody willing (and able)?",
    "created_at": "2011-06-12T03:23:36Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11027#issuecomment-110921",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:38'></a>
Replying to [jdemeyer](#comment%3A37):
> I just think it would be a pity to lose this work.  There are already too many tickets which are 90% finished, let this not become one of them.

That qualifies as interest.  ;-)  I may be slow, but rarely give up.  Except for #10765.

Patchbot gives this a green light.  What it really needs is a test run on OS X 10.4 PPC.  Anybody willing (and able)?



---

archive/issue_comments_110922.json:
```json
{
    "body": "<a id='comment:40'></a>\nReplying to [rbeezer](#comment%3A38):\n> What it really needs is a test run on OS X 10.4 PPC.  Anybody willing (and able)?\n\nIt works on OS X 10.4 PPC.",
    "created_at": "2011-06-15T15:30:02Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11027#issuecomment-110922",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:40'></a>
Replying to [rbeezer](#comment%3A38):
> What it really needs is a test run on OS X 10.4 PPC.  Anybody willing (and able)?

It works on OS X 10.4 PPC.



---

archive/issue_comments_110923.json:
```json
{
    "body": "<a id='comment:41'></a>\nReplying to [jdemeyer](#comment%3A40):\n> It works on OS X 10.4 PPC.\n\nThanks very much, Jeroen!\n\nI think this is all ready for somebody to give it a (quick) positive review.  Hint, hint.  ;-)",
    "created_at": "2011-06-15T21:10:11Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11027#issuecomment-110923",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:41'></a>
Replying to [jdemeyer](#comment%3A40):
> It works on OS X 10.4 PPC.

Thanks very much, Jeroen!

I think this is all ready for somebody to give it a (quick) positive review.  Hint, hint.  ;-)



---

archive/issue_comments_110924.json:
```json
{
    "body": "<a id='comment:42'></a>\nOkay, I have looked at [attachment:trac_11027-schur-decomposition-doctest-v2.patch](https://github.com/sagemath/sage/files/ticket11027/trac_11027-schur-decomposition-doctest-v2.patch) and it makes sense.  In fact, the new patch is cleaner than the old one.  Since the main patch is already positively reviewed, this gives... positive_review!",
    "created_at": "2011-06-15T21:21:34Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11027#issuecomment-110924",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:42'></a>
Okay, I have looked at [attachment:trac_11027-schur-decomposition-doctest-v2.patch](https://github.com/sagemath/sage/files/ticket11027/trac_11027-schur-decomposition-doctest-v2.patch) and it makes sense.  In fact, the new patch is cleaner than the old one.  Since the main patch is already positively reviewed, this gives... positive_review!



---

archive/issue_comments_110925.json:
```json
{
    "body": "**Changing reviewer** from \"Martin Raum, John Palmieri\" to \"Martin Raum, John Palmieri, Jeroen Demeyer\".",
    "created_at": "2011-06-15T21:21:34Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11027#issuecomment-110925",
    "user": "https://github.com/jdemeyer"
}
```

**Changing reviewer** from "Martin Raum, John Palmieri" to "Martin Raum, John Palmieri, Jeroen Demeyer".



---

archive/issue_events_086190.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-06-15T21:21:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11027#event-86190"
}
```



---

archive/issue_events_086191.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-06-15T21:21:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11027#event-86191"
}
```



---

archive/issue_comments_110926.json:
```json
{
    "body": "**Merged:** sage-4.7.1.alpha3",
    "created_at": "2011-06-16T07:24:06Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11027#issuecomment-110926",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-4.7.1.alpha3



---

archive/issue_events_086192.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-06-16T07:24:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11027#event-86192"
}
```



---

archive/issue_events_086193.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-06-16T07:24:06Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11027#event-86193"
}
```



---

archive/issue_comments_110927.json:
```json
{
    "body": "<a id='comment:44'></a>\nReplying to [jdemeyer](#comment%3A42):\n>  this gives... positive_review!\n\nJeroen - thanks for finishing this one off.  (And for your interest!)",
    "created_at": "2011-06-16T13:38:45Z",
    "issue": "https://github.com/sagemath/sage/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11027#issuecomment-110927",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:44'></a>
Replying to [jdemeyer](#comment%3A42):
>  this gives... positive_review!

Jeroen - thanks for finishing this one off.  (And for your interest!)
