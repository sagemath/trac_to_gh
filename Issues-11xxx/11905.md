# Issue 11905: Implement division_field() for elliptic curves

archive/issues_011733.json:
```json
{
    "body": "`sage/schemes/elliptic_curves/gal_reps.py` has code to compute a splitting field, but that clearly does not belong to elliptic curves. This is used to compute the division field. We should use the new `splitting_field()` function from #2217 to implement this. We should make it work also over number fields.\n\nAssignee: @JohnCremona\n\nCC:  @JohnCremona\n\nReviewer: John Cremona\n\nAuthor: Jeroen Demeyer\n\nBranch: u/jdemeyer/ticket/11905\n\nDependencies: #2217, #15626, #11271\n\nCommit: bb388718023f3eaeec59d97673152996c53f9efb\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/11905\n\n",
    "closed_at": "2014-01-07T07:20:27Z",
    "created_at": "2011-10-07T13:45:59Z",
    "labels": [
        "component: elliptic curves"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.1",
    "title": "Implement division_field() for elliptic curves",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11905",
    "user": "https://github.com/jdemeyer"
}
```
`sage/schemes/elliptic_curves/gal_reps.py` has code to compute a splitting field, but that clearly does not belong to elliptic curves. This is used to compute the division field. We should use the new `splitting_field()` function from #2217 to implement this. We should make it work also over number fields.

Assignee: @JohnCremona

CC:  @JohnCremona

Reviewer: John Cremona

Author: Jeroen Demeyer

Branch: u/jdemeyer/ticket/11905

Dependencies: #2217, #15626, #11271

Commit: bb388718023f3eaeec59d97673152996c53f9efb

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/11905





---

archive/issue_comments_133160.json:
```json
{
    "body": "Changing component from number fields to elliptic curves.",
    "created_at": "2011-11-07T16:38:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11905",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11905#issuecomment-133160",
    "user": "https://github.com/jdemeyer"
}
```

Changing component from number fields to elliptic curves.



---

archive/issue_comments_133161.json:
```json
{
    "body": "Changing assignee from @loefflerd to @JohnCremona.",
    "created_at": "2011-11-07T16:38:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11905",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11905#issuecomment-133161",
    "user": "https://github.com/jdemeyer"
}
```

Changing assignee from @loefflerd to @JohnCremona.



---

archive/issue_comments_133162.json:
```json
{
    "body": "<a id='comment:4'></a>Thanks for spotting and changing this. One could even argue that the division field should be available to all elliptic curves, not just the ones over QQ. But this could be changed later.",
    "created_at": "2011-11-08T14:30:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11905",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11905#issuecomment-133162",
    "user": "https://github.com/categorie"
}
```

<a id='comment:4'></a>Thanks for spotting and changing this. One could even argue that the division field should be available to all elliptic curves, not just the ones over QQ. But this could be changed later.



---

archive/issue_comments_133163.json:
```json
{
    "body": "<a id='comment:5'></a>This is still very much work in progress by the way.",
    "created_at": "2011-11-08T14:32:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11905",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11905#issuecomment-133163",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>This is still very much work in progress by the way.



---

archive/issue_comments_133164.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:4 wuthrich]:\n> Thanks for spotting and changing this. One could even argue that the division field should be available to all elliptic curves, not just the ones over QQ. But this could be changed later.\n\n\nI can easily do number fields, very general fields would be harder.",
    "created_at": "2011-11-10T11:32:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11905",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11905#issuecomment-133164",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>Replying to [comment:4 wuthrich]:
> Thanks for spotting and changing this. One could even argue that the division field should be available to all elliptic curves, not just the ones over QQ. But this could be changed later.


I can easily do number fields, very general fields would be harder.



---

archive/issue_comments_133165.json:
```json
{
    "body": "Attachment [11905_splitting_field.patch](tarball://root/attachments/some-uuid/ticket11905/11905_splitting_field.patch) by @jdemeyer created at 2011-11-10 16:25:39",
    "created_at": "2011-11-10T16:25:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11905",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11905#issuecomment-133165",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [11905_splitting_field.patch](tarball://root/attachments/some-uuid/ticket11905/11905_splitting_field.patch) by @jdemeyer created at 2011-11-10 16:25:39



---

archive/issue_events_031472.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11905",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11905#event-31472"
}
```



---

archive/issue_comments_133166.json:
```json
{
    "body": "<a id='comment:9'></a>#2217 is ready for review",
    "created_at": "2013-11-04T20:28:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11905",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11905#issuecomment-133166",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:9'></a>#2217 is ready for review



---

archive/issue_comments_133167.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Recent commits:",
    "created_at": "2014-01-03T17:06:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11905",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11905#issuecomment-133167",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Recent commits:



---

archive/issue_comments_133168.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Recent commits:",
    "created_at": "2014-01-03T22:00:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11905",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11905#issuecomment-133168",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Recent commits:



---

archive/issue_comments_133169.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Recent commits:",
    "created_at": "2014-01-03T22:17:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11905",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11905#issuecomment-133169",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Recent commits:



---

archive/issue_comments_133170.json:
```json
{
    "body": "<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Recent commits:",
    "created_at": "2014-01-03T22:44:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11905",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11905#issuecomment-133170",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Recent commits:



---

archive/issue_comments_133171.json:
```json
{
    "body": "<a id='comment:19'></a>I know that this is not yet marked as ready for review, but I did look at the code anyway.  One minor remark:  after adjoining all the x-coordinates of the p-division points, *either* you have the full division field already, i.e. you have all the y-coordinates, *or* you have none, i.e. you have none of the y-coordinates.  This could be used, possibly, to simplify that last part of the division field code.  But it is not clear to me that there is a quicker way of determining that final quadratic extension than picking any of the x-coordinates of a p-division point and solving for y.",
    "created_at": "2014-01-05T13:57:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11905",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11905#issuecomment-133171",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:19'></a>I know that this is not yet marked as ready for review, but I did look at the code anyway.  One minor remark:  after adjoining all the x-coordinates of the p-division points, *either* you have the full division field already, i.e. you have all the y-coordinates, *or* you have none, i.e. you have none of the y-coordinates.  This could be used, possibly, to simplify that last part of the division field code.  But it is not clear to me that there is a quicker way of determining that final quadratic extension than picking any of the x-coordinates of a p-division point and solving for y.



---

archive/issue_comments_133172.json:
```json
{
    "body": "<a id='comment:20'></a>Replying to [comment:19 cremona]:\n> I know that this is not yet marked as ready for review, but I did look at the code anyway.  One minor remark:  after adjoining all the x-coordinates of the p-division points, *either* you have the full division field already, i.e. you have all the y-coordinates, *or* you have none, i.e. you have none of the y-coordinates.  This could be used, possibly, to simplify that last part of the division field code.  But it is not clear to me that there is a quicker way of determining that final quadratic extension than picking any of the x-coordinates of a p-division point and solving for y.\n\nNot that I don't believe you, but do you have a reference for this? At least I could add it as a comment in the code.",
    "created_at": "2014-01-05T16:17:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11905",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11905#issuecomment-133172",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'></a>Replying to [comment:19 cremona]:
> I know that this is not yet marked as ready for review, but I did look at the code anyway.  One minor remark:  after adjoining all the x-coordinates of the p-division points, *either* you have the full division field already, i.e. you have all the y-coordinates, *or* you have none, i.e. you have none of the y-coordinates.  This could be used, possibly, to simplify that last part of the division field code.  But it is not clear to me that there is a quicker way of determining that final quadratic extension than picking any of the x-coordinates of a p-division point and solving for y.

Not that I don't believe you, but do you have a reference for this? At least I could add it as a comment in the code.



---

archive/issue_comments_133173.json:
```json
{
    "body": "<a id='comment:21'></a>Replying to [comment:20 jdemeyer]:\n> Replying to [comment:19 cremona]:\n> > I know that this is not yet marked as ready for review, but I did look at the code anyway.  One minor remark:  after adjoining all the x-coordinates of the p-division points, *either* you have the full division field already, i.e. you have all the y-coordinates, *or* you have none, i.e. you have none of the y-coordinates.  This could be used, possibly, to simplify that last part of the division field code.  But it is not clear to me that there is a quicker way of determining that final quadratic extension than picking any of the x-coordinates of a p-division point and solving for y.\n\n> Not that I don't believe you, but do you have a reference for this? At least I could add it as a comment in the code.\n\nProof.   For all P in E[p] and all Galois autos sigma (of K-bar over K) we have sigma(P)=+/-P since x(sigma(P))=sigma(x(P))=x(P).  Let P1, P2 be a basis for E[p].  For each sigma we have sigma(P1)=+/-P1 and sigma(P2)=+/-P2 and the signs are the *same* otherwise sigma(P1+P2) could not equal either +(P1+P2) or -(P1+P2).  So the image of sigma in the mod p Galois representation is either the identity or minus the identity.  In the first case, sigma fixes all points in E[p], in the second case it negates all of them.  So if the Galois rep is not trivial, its image has order 2 and its kernel cuts out a quadratic extension, say L/K.  In the latter case the non-trivial element sigma of Gal(L/K) maps to -1 which means that sigma(P)=-P for *all* P in E[p].\n\nI don't know a reference!",
    "created_at": "2014-01-05T16:56:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11905",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11905#issuecomment-133173",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:21'></a>Replying to [comment:20 jdemeyer]:
> Replying to [comment:19 cremona]:
> > I know that this is not yet marked as ready for review, but I did look at the code anyway.  One minor remark:  after adjoining all the x-coordinates of the p-division points, *either* you have the full division field already, i.e. you have all the y-coordinates, *or* you have none, i.e. you have none of the y-coordinates.  This could be used, possibly, to simplify that last part of the division field code.  But it is not clear to me that there is a quicker way of determining that final quadratic extension than picking any of the x-coordinates of a p-division point and solving for y.

> Not that I don't believe you, but do you have a reference for this? At least I could add it as a comment in the code.

Proof.   For all P in E[p] and all Galois autos sigma (of K-bar over K) we have sigma(P)=+/-P since x(sigma(P))=sigma(x(P))=x(P).  Let P1, P2 be a basis for E[p].  For each sigma we have sigma(P1)=+/-P1 and sigma(P2)=+/-P2 and the signs are the *same* otherwise sigma(P1+P2) could not equal either +(P1+P2) or -(P1+P2).  So the image of sigma in the mod p Galois representation is either the identity or minus the identity.  In the first case, sigma fixes all points in E[p], in the second case it negates all of them.  So if the Galois rep is not trivial, its image has order 2 and its kernel cuts out a quadratic extension, say L/K.  In the latter case the non-trivial element sigma of Gal(L/K) maps to -1 which means that sigma(P)=-P for *all* P in E[p].

I don't know a reference!



---

archive/issue_comments_133174.json:
```json
{
    "body": "<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-01-05T22:35:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11905",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11905#issuecomment-133174",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_133175.json:
```json
{
    "body": "<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-01-05T22:36:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11905",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11905#issuecomment-133175",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_133176.json:
```json
{
    "body": "<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-01-05T22:40:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11905",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11905#issuecomment-133176",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_133177.json:
```json
{
    "body": "<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-01-05T23:31:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11905",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11905#issuecomment-133177",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_133178.json:
```json
{
    "body": "<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-01-05T23:36:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11905",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11905#issuecomment-133178",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_133179.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-01-05T23:36:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11905",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11905#issuecomment-133179",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_133180.json:
```json
{
    "body": "<a id='comment:28'></a>Note that only [05c57d2](http://git.sagemath.org/sage.git/commit/?id=05c57d2a031f34ac4d95ca5a13448c92206f0f41) needs to be reviewed.",
    "created_at": "2014-01-06T08:29:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11905",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11905#issuecomment-133180",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:28'></a>Note that only [05c57d2](http://git.sagemath.org/sage.git/commit/?id=05c57d2a031f34ac4d95ca5a13448c92206f0f41) needs to be reviewed.



---

archive/issue_comments_133181.json:
```json
{
    "body": "<a id='comment:30'></a>Looking good!  Can we have an example where the X-division field equals the division field, i.e. where the final step is not necessary?  And also an example (from the ones you give) showing that the splitting field of the division polynomial has half the degree of the division field?  I think that this would be instructive to see in the reference manual.  I see that in the code for the final step you again call splitting field with a quadratic; very efficient!\n\nI think it says a lot for the good way in which you implemented splitting fields that this now becomes so simple!",
    "created_at": "2014-01-06T10:26:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11905",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11905#issuecomment-133181",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:30'></a>Looking good!  Can we have an example where the X-division field equals the division field, i.e. where the final step is not necessary?  And also an example (from the ones you give) showing that the splitting field of the division polynomial has half the degree of the division field?  I think that this would be instructive to see in the reference manual.  I see that in the code for the final step you again call splitting field with a quadratic; very efficient!

I think it says a lot for the good way in which you implemented splitting fields that this now becomes so simple!



---

archive/issue_comments_133182.json:
```json
{
    "body": "<a id='comment:31'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-06T12:39:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11905",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11905#issuecomment-133182",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:31'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_133183.json:
```json
{
    "body": "<a id='comment:32'></a>I was expecting to be able to pull the new commit on top of the old one, but that failed (merge conflict I think).  I just deleted the branch I had and made a new one.\n\nThanks for the new example, which do exactly what I wanted.  I read through the code again, and like it, and tested all of Sage with this commit as well as some of my own examples.",
    "created_at": "2014-01-06T14:47:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11905",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11905#issuecomment-133183",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:32'></a>I was expecting to be able to pull the new commit on top of the old one, but that failed (merge conflict I think).  I just deleted the branch I had and made a new one.

Thanks for the new example, which do exactly what I wanted.  I read through the code again, and like it, and tested all of Sage with this commit as well as some of my own examples.



---

archive/issue_comments_133184.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-01-06T14:47:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11905",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11905#issuecomment-133184",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_133185.json:
```json
{
    "body": "<a id='comment:33'></a>Thanks again for the quick review!",
    "created_at": "2014-01-06T16:34:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11905",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11905#issuecomment-133185",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:33'></a>Thanks again for the quick review!



---

archive/issue_comments_133186.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-01-07T07:20:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11905",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11905#issuecomment-133186",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_031473.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-01-07T07:20:27Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11905",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11905#event-31473"
}
```
