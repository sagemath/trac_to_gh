# Issue 11530: Conversion of finite field elements to PARI disregards characteristic and mangles "Mod"

archive/issues_011358.json:
```json
{
    "body": "```\nsage: F.<d> = GF(3^2)\nsage: d._pari_()\nMod(d, Mod(1, 3)*d^2 + Mod(2, 3)*d + Mod(2, 3))\nsage: d._pari_init_(\"m\")\n'Mom(m, Mom(1, 3)*m^2 + Mom(2, 3)*m + Mom(2, 3))'\nsage: d._pari_init_(\"p\")\n'Mop(p, Mop(1, 3)*p^2 + Mop(2, 3)*p + Mop(2, 3))'\nsage: d._pari_init_(\"b\")\n'Mob(b, Mob(1, 3)*b^2 + Mob(2, 3)*b + Mob(2, 3))'\n```\n\nMore care needs to be taken with a search and replace, maybe it should come earlier in `sage.rings.finite_rings.element_givaro.FiniteField_givaroElement._pari_init_`.\n\n**Apply:**\n1.  [attachment:11530_pari_init-v5.patch]\n\nAssignee: @aghitza\n\nKeywords: _pari_init_, variable name, finite field\n\nResolution: fixed\n\nAuthor: Simon King, Rob Beezer\n\nReviewer: Jeroen Demeyer\n\nMerged: sage-4.7.2.alpha0\n\nIssue created by migration from https://trac.sagemath.org/ticket/11530\n\n",
    "closed_at": "2011-07-24T11:17:22Z",
    "created_at": "2011-06-21T20:09:47Z",
    "labels": [
        "component: algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7.2",
    "title": "Conversion of finite field elements to PARI disregards characteristic and mangles \"Mod\"",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11530",
    "user": "https://github.com/rbeezer"
}
```
```
sage: F.<d> = GF(3^2)
sage: d._pari_()
Mod(d, Mod(1, 3)*d^2 + Mod(2, 3)*d + Mod(2, 3))
sage: d._pari_init_("m")
'Mom(m, Mom(1, 3)*m^2 + Mom(2, 3)*m + Mom(2, 3))'
sage: d._pari_init_("p")
'Mop(p, Mop(1, 3)*p^2 + Mop(2, 3)*p + Mop(2, 3))'
sage: d._pari_init_("b")
'Mob(b, Mob(1, 3)*b^2 + Mob(2, 3)*b + Mob(2, 3))'
```

More care needs to be taken with a search and replace, maybe it should come earlier in `sage.rings.finite_rings.element_givaro.FiniteField_givaroElement._pari_init_`.

**Apply:**
1.  [attachment:11530_pari_init-v5.patch]

Assignee: @aghitza

Keywords: _pari_init_, variable name, finite field

Resolution: fixed

Author: Simon King, Rob Beezer

Reviewer: Jeroen Demeyer

Merged: sage-4.7.2.alpha0

Issue created by migration from https://trac.sagemath.org/ticket/11530





---

archive/issue_comments_132575.json:
```json
{
    "body": "<a id='comment:1'></a>My patch completely avoids the string replacement.\n\nIf a variable name is given, it replaces `self.parent()._finite_field_ext_pari_modulus_as_str()` by `repr(self.parent().modulus()._pari_with_name(var))`, and `self.polynomial()` allows to change the variable name as well, so, I use `self.polynomial(var)` instead.\n\nOf course I added a test, and the tests of `sage/rings/finite_rings/element_givaro.pyx` pass. I didn't run full tests, yet, but I think it is ready for review.",
    "created_at": "2011-06-22T06:14:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-132575",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:1'></a>My patch completely avoids the string replacement.

If a variable name is given, it replaces `self.parent()._finite_field_ext_pari_modulus_as_str()` by `repr(self.parent().modulus()._pari_with_name(var))`, and `self.polynomial()` allows to change the variable name as well, so, I use `self.polynomial(var)` instead.

Of course I added a test, and the tests of `sage/rings/finite_rings/element_givaro.pyx` pass. I didn't run full tests, yet, but I think it is ready for review.



---

archive/issue_comments_132576.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-06-22T06:14:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-132576",
    "user": "https://github.com/simon-king-jena"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_132577.json:
```json
{
    "body": "Changing keywords from \"\" to \"_pari_init_, variable name, finite field\".",
    "created_at": "2011-06-22T06:14:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-132577",
    "user": "https://github.com/simon-king-jena"
}
```

Changing keywords from "" to "_pari_init_, variable name, finite field".



---

archive/issue_comments_132578.json:
```json
{
    "body": "Attachment [11530_pari_init.patch](tarball://root/attachments/some-uuid/ticket11530/11530_pari_init.patch) by @simon-king-jena created at 2011-06-22 06:32:45\n\nDo _pari_init_ without string replacement",
    "created_at": "2011-06-22T06:32:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-132578",
    "user": "https://github.com/simon-king-jena"
}
```

Attachment [11530_pari_init.patch](tarball://root/attachments/some-uuid/ticket11530/11530_pari_init.patch) by @simon-king-jena created at 2011-06-22 06:32:45

Do _pari_init_ without string replacement



---

archive/issue_comments_132579.json:
```json
{
    "body": "<a id='comment:2'></a>The correct patch is only posted *now*: Previously, I had forgotten to commit my changes. So, please reload my patch if you had downloaded it before reading these lines...",
    "created_at": "2011-06-22T06:35:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-132579",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:2'></a>The correct patch is only posted *now*: Previously, I had forgotten to commit my changes. So, please reload my patch if you had downloaded it before reading these lines...



---

archive/issue_comments_132580.json:
```json
{
    "body": "<a id='comment:3'></a>Annoying:\n\n```\nsage: F.<d> = GF(127^3)\nsage: d._pari_()\nMod(Mod(1, 127)*a, Mod(1, 127)*a^3 + Mod(3, 127)*a + Mod(124, 127))\nsage: d._pari_init_(\"x\")\nTraceback (most recent call last)\n\n/usr/local/src/sage-4.7.1.alpha3/<ipython console> in <module>()\n\nTypeError: _pari_init_() takes exactly 1 argument (2 given)\n```\n\nPatch looks good to me, though (still need to test).",
    "created_at": "2011-06-22T07:09:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-132580",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>Annoying:

```
sage: F.<d> = GF(127^3)
sage: d._pari_()
Mod(Mod(1, 127)*a, Mod(1, 127)*a^3 + Mod(3, 127)*a + Mod(124, 127))
sage: d._pari_init_("x")
Traceback (most recent call last)

/usr/local/src/sage-4.7.1.alpha3/<ipython console> in <module>()

TypeError: _pari_init_() takes exactly 1 argument (2 given)
```

Patch looks good to me, though (still need to test).



---

archive/issue_comments_132581.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [comment:3 jdemeyer]:\n> Annoying:\n\n\nIndeed. So, should we take care of non-Givaro finite field elements as well? Here or on a different ticket?\n\nCheers,\nSimon",
    "created_at": "2011-06-22T07:20:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-132581",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:5'></a>Replying to [comment:3 jdemeyer]:
> Annoying:


Indeed. So, should we take care of non-Givaro finite field elements as well? Here or on a different ticket?

Cheers,
Simon



---

archive/issue_comments_132582.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:5 SimonKing]:\n> Indeed. So, should we take care of non-Givaro finite field elements as well? Here or on a different ticket?\n\n\nThere is also a _finite_field_ext_pari_modulus_as_str() method for the NTL finite fields of characteristic 2, which in my patch was just as easy to fix.  Not sure why Jeroen's error shows up for order 127^3.  My patch does string replacement, but passes all long tests.\n\nHave to go for a bit, I'll post more details in a few hours, but right now I'd say a second ticket is probably not needed.\n\nRob",
    "created_at": "2011-06-22T15:41:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-132582",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:6'></a>Replying to [comment:5 SimonKing]:
> Indeed. So, should we take care of non-Givaro finite field elements as well? Here or on a different ticket?


There is also a _finite_field_ext_pari_modulus_as_str() method for the NTL finite fields of characteristic 2, which in my patch was just as easy to fix.  Not sure why Jeroen's error shows up for order 127^3.  My patch does string replacement, but passes all long tests.

Have to go for a bit, I'll post more details in a few hours, but right now I'd say a second ticket is probably not needed.

Rob



---

archive/issue_comments_132583.json:
```json
{
    "body": "<a id='comment:7'></a>Appears \"big\" fields do not have a _finite_field_ext_pari_modulus_as_str() method at all.\n\nI have a tweak to Simon's patch that may be just a bit cleaner and work for all fields.  In a bit.",
    "created_at": "2011-06-22T15:50:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-132583",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:7'></a>Appears "big" fields do not have a _finite_field_ext_pari_modulus_as_str() method at all.

I have a tweak to Simon's patch that may be just a bit cleaner and work for all fields.  In a bit.



---

archive/issue_comments_132584.json:
```json
{
    "body": "Simon's patch, with minor modifications",
    "created_at": "2011-06-22T18:43:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-132584",
    "user": "https://github.com/rbeezer"
}
```

Simon's patch, with minor modifications



---

archive/issue_comments_132585.json:
```json
{
    "body": "<a id='comment:8'></a>Attachment [11530_pari_init-v2.patch](tarball://root/attachments/some-uuid/ticket11530/11530_pari_init-v2.patch) by @rbeezer created at 2011-06-22 18:52:23\n\nv2 patch is a tweak of Simon's nice patch.  Passes all tests in sage/rings.  I think this will allow totally removing the two versions of `_finite_field_ext_pari_modulus_as_str()`.  I am going to test the removal with a test of the full Sage library.\n\nWithout search and replace, we get a 2x speedup.  I have not posted my search/replace patch since it seems useless now.\n\nTimings, all in microseconds, of the two commands below.\n\n```\nsage: F.<a>=GF(3^5)\nsage: a._pari_init_()\nsage: a._pari_init_('b')\n\n                        var=None       var='b'\n4.7 status quo            779            780\nRob search/replace        782            787\nSimon                     781            381\nSimon + Rob (v2)          369            381\n```\n\nSo it appears better coding will get us speed improvements.  Imagine that!",
    "created_at": "2011-06-22T18:52:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-132585",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:8'></a>Attachment [11530_pari_init-v2.patch](tarball://root/attachments/some-uuid/ticket11530/11530_pari_init-v2.patch) by @rbeezer created at 2011-06-22 18:52:23

v2 patch is a tweak of Simon's nice patch.  Passes all tests in sage/rings.  I think this will allow totally removing the two versions of `_finite_field_ext_pari_modulus_as_str()`.  I am going to test the removal with a test of the full Sage library.

Without search and replace, we get a 2x speedup.  I have not posted my search/replace patch since it seems useless now.

Timings, all in microseconds, of the two commands below.

```
sage: F.<a>=GF(3^5)
sage: a._pari_init_()
sage: a._pari_init_('b')

                        var=None       var='b'
4.7 status quo            779            780
Rob search/replace        782            787
Simon                     781            381
Simon + Rob (v2)          369            381
```

So it appears better coding will get us speed improvements.  Imagine that!



---

archive/issue_comments_132586.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:3 jdemeyer]:\n> Annoying:\n> \n> ```\n> sage: F.<d> = GF(127^3)\n> sage: d._pari_()\n> Mod(Mod(1, 127)*a, Mod(1, 127)*a^3 + Mod(3, 127)*a + Mod(124, 127))\n> sage: d._pari_init_(\"x\")\n> Traceback (most recent call last)\n> \n> /usr/local/src/sage-4.7.1.alpha3/<ipython console> in <module>()\n> \n> TypeError: _pari_init_() takes exactly 1 argument (2 given)\n> ```\n\n\nThe `_pari_init_()` method of `sage.rings.finite_rings.element_ext_pari.FiniteField_ext_pariElement` is not designed to take a new variable.  Should it be?\n\nI found this problem originally when trying to factor a polynomial with coefficients from `GF(3^5)`.  It looks to me like a factorization of a polynomial over `GF(127^3)` takes a different path, since the polynomial is of a different type, and therefore does not call `_pari_init_()` to change a variable name.\n\nIs this failure a non-issue?",
    "created_at": "2011-06-22T18:58:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-132586",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:9'></a>Replying to [comment:3 jdemeyer]:
> Annoying:
> 
> ```
> sage: F.<d> = GF(127^3)
> sage: d._pari_()
> Mod(Mod(1, 127)*a, Mod(1, 127)*a^3 + Mod(3, 127)*a + Mod(124, 127))
> sage: d._pari_init_("x")
> Traceback (most recent call last)
> 
> /usr/local/src/sage-4.7.1.alpha3/<ipython console> in <module>()
> 
> TypeError: _pari_init_() takes exactly 1 argument (2 given)
> ```


The `_pari_init_()` method of `sage.rings.finite_rings.element_ext_pari.FiniteField_ext_pariElement` is not designed to take a new variable.  Should it be?

I found this problem originally when trying to factor a polynomial with coefficients from `GF(3^5)`.  It looks to me like a factorization of a polynomial over `GF(127^3)` takes a different path, since the polynomial is of a different type, and therefore does not call `_pari_init_()` to change a variable name.

Is this failure a non-issue?



---

archive/issue_comments_132587.json:
```json
{
    "body": "<a id='comment:10'></a>With v2 patch, and both instances of `_finite_field_ext_pari_modulus_as_str()` commented-out, all long tests pass.\n\n(a) Does the v2 patch look acceptable?  It is uniformly faster and seems to fix the original problem.\n\n(b) Do we need to address Jeroen's annoyance above?\n\n(c) Should we trash both `_finite_field_ext_pari_modulus_as_str()`?\n\nI can manufacture a final patch, with Simon's name on it, if desired.  We could then call on Jeroen for a review.\n\nRob",
    "created_at": "2011-06-22T19:51:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-132587",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:10'></a>With v2 patch, and both instances of `_finite_field_ext_pari_modulus_as_str()` commented-out, all long tests pass.

(a) Does the v2 patch look acceptable?  It is uniformly faster and seems to fix the original problem.

(b) Do we need to address Jeroen's annoyance above?

(c) Should we trash both `_finite_field_ext_pari_modulus_as_str()`?

I can manufacture a final patch, with Simon's name on it, if desired.  We could then call on Jeroen for a review.

Rob



---

archive/issue_comments_132588.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [comment:10 rbeezer]:\n> I can manufacture a final patch, with Simon's name on it, if desired.  We could then call on Jeroen for a review.\n\n\nYes, please. I am currently unable to work.",
    "created_at": "2011-06-23T15:06:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-132588",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:11'></a>Replying to [comment:10 rbeezer]:
> I can manufacture a final patch, with Simon's name on it, if desired.  We could then call on Jeroen for a review.


Yes, please. I am currently unable to work.



---

archive/issue_comments_132589.json:
```json
{
    "body": "Attachment [11530_pari_init-v3.patch](tarball://root/attachments/some-uuid/ticket11530/11530_pari_init-v3.patch) by @rbeezer created at 2011-06-23 22:38:57",
    "created_at": "2011-06-23T22:38:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-132589",
    "user": "https://github.com/rbeezer"
}
```

Attachment [11530_pari_init-v3.patch](tarball://root/attachments/some-uuid/ticket11530/11530_pari_init-v3.patch) by @rbeezer created at 2011-06-23 22:38:57



---

archive/issue_comments_132590.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:11 SimonKing]:\n> Yes, please. I am currently unable to work.\n\n\nDone in v3 patch.  Patch has Simon's name on it, but I've added myself as an author.  \n\nHighlights:\n\n1.  Some expansion of the docstring - trying to be sure to test fields of characteristic 2 and elements that are not just the generator alone.\n2.  Eliminated two versions of `_finite_field_ext_pari_modulus_as_str()` since they are not needed and comments indicate they are not even very desirable.\n\nPatch passes all long tests on 4.7.1.alpha2.\n\nRob",
    "created_at": "2011-06-23T22:46:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-132590",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:12'></a>Replying to [comment:11 SimonKing]:
> Yes, please. I am currently unable to work.


Done in v3 patch.  Patch has Simon's name on it, but I've added myself as an author.  

Highlights:

1.  Some expansion of the docstring - trying to be sure to test fields of characteristic 2 and elements that are not just the generator alone.
2.  Eliminated two versions of `_finite_field_ext_pari_modulus_as_str()` since they are not needed and comments indicate they are not even very desirable.

Patch passes all long tests on 4.7.1.alpha2.

Rob



---

archive/issue_comments_132591.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -12,6 +12,9 @@\n \n More care needs to be taken with a search and replace, maybe it should come earlier in \\`sage.rings.finite_rings.element_givaro.FiniteField_givaroElement._pari_init_\\`.\n \n+**Apply:**\n+1.  [attachment:11530_pari_init-v3.patch]\n+\n Comment: 1\n \n Summary: PARI initialization of finite field elements mangles Mod\n```\n",
    "created_at": "2011-06-23T22:47:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-132591",
    "user": "https://github.com/rbeezer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -12,6 +12,9 @@
 
 More care needs to be taken with a search and replace, maybe it should come earlier in \`sage.rings.finite_rings.element_givaro.FiniteField_givaroElement._pari_init_\`.
 
+**Apply:**
+1.  [attachment:11530_pari_init-v3.patch]
+
 Comment: 1
 
 Summary: PARI initialization of finite field elements mangles Mod
```




---

archive/issue_comments_132592.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-06-24T14:07:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-132592",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_132593.json:
```json
{
    "body": "<a id='comment:14'></a>Wny not make lines 370--371 more consistent and write\n\n```\ng = str(self.parent().modulus()._pari_with_name(var))\nf = str(self.polynomial()._pari_with_name(var))\n```\n\nI guess you could even omit the \"str()\" since that will be done anyway in the formatting on line 372.",
    "created_at": "2011-06-24T14:07:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-132593",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'></a>Wny not make lines 370--371 more consistent and write

```
g = str(self.parent().modulus()._pari_with_name(var))
f = str(self.polynomial()._pari_with_name(var))
```

I guess you could even omit the "str()" since that will be done anyway in the formatting on line 372.



---

archive/issue_comments_132594.json:
```json
{
    "body": "Attachment [11530_pari_init-v4.patch](tarball://root/attachments/some-uuid/ticket11530/11530_pari_init-v4.patch) by @rbeezer created at 2011-06-24 18:13:29",
    "created_at": "2011-06-24T18:13:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-132594",
    "user": "https://github.com/rbeezer"
}
```

Attachment [11530_pari_init-v4.patch](tarball://root/attachments/some-uuid/ticket11530/11530_pari_init-v4.patch) by @rbeezer created at 2011-06-24 18:13:29



---

archive/issue_comments_132595.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,19 @@\n+\\`\\`\\`\n+sage: F.<d> = GF(3^2)\n+sage: d._pari_()\n+Mod(d, Mod(1, 3)*d^2 + Mod(2, 3)*d + Mod(2, 3))\n+sage: d._pari_init_(\"m\")\n+'Mom(m, Mom(1, 3)*m^2 + Mom(2, 3)*m + Mom(2, 3))'\n+sage: d._pari_init_(\"p\")\n+'Mop(p, Mop(1, 3)*p^2 + Mop(2, 3)*p + Mop(2, 3))'\n+sage: d._pari_init_(\"b\")\n+'Mob(b, Mob(1, 3)*b^2 + Mob(2, 3)*b + Mob(2, 3))'\n+\\`\\`\\`\n \n+More care needs to be taken with a search and replace, maybe it should come earlier in \\`sage.rings.finite_rings.element_givaro.FiniteField_givaroElement._pari_init_\\`.\n+\n+**Apply:**\n+1.  [attachment:11530_pari_init-v4.patch]\n \n Comment: 1\n \n```\n",
    "created_at": "2011-06-24T18:19:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-132595",
    "user": "https://github.com/rbeezer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,19 @@
+\`\`\`
+sage: F.<d> = GF(3^2)
+sage: d._pari_()
+Mod(d, Mod(1, 3)*d^2 + Mod(2, 3)*d + Mod(2, 3))
+sage: d._pari_init_("m")
+'Mom(m, Mom(1, 3)*m^2 + Mom(2, 3)*m + Mom(2, 3))'
+sage: d._pari_init_("p")
+'Mop(p, Mop(1, 3)*p^2 + Mop(2, 3)*p + Mop(2, 3))'
+sage: d._pari_init_("b")
+'Mob(b, Mob(1, 3)*b^2 + Mob(2, 3)*b + Mob(2, 3))'
+\`\`\`
 
+More care needs to be taken with a search and replace, maybe it should come earlier in \`sage.rings.finite_rings.element_givaro.FiniteField_givaroElement._pari_init_\`.
+
+**Apply:**
+1.  [attachment:11530_pari_init-v4.patch]
 
 Comment: 1
 
```




---

archive/issue_comments_132596.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-06-24T18:19:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-132596",
    "user": "https://github.com/rbeezer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_132597.json:
```json
{
    "body": "<a id='comment:15'></a>Good idea, Jeroen.  `self.polynomial()._pari_with_name(var)` hits the coefficients of an element with a `Mod`, so the behavior changes.  Perhaps not a problem, but also perhaps not worth the risk either.  Makes a couple of other doctests fail, but maybe just for `_pari_` for finite field elements.\n\nTherefore the v4 patch basically just strips the `str()` and `repr()` and lets the `format()` take care of string formatting.  Passes all tests in sage/rings.\n\nI will run long tests in the next 12 hours when my machine is free, but I think it is safe to review now, and I'll post about long tests either way.",
    "created_at": "2011-06-24T18:19:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-132597",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:15'></a>Good idea, Jeroen.  `self.polynomial()._pari_with_name(var)` hits the coefficients of an element with a `Mod`, so the behavior changes.  Perhaps not a problem, but also perhaps not worth the risk either.  Makes a couple of other doctests fail, but maybe just for `_pari_` for finite field elements.

Therefore the v4 patch basically just strips the `str()` and `repr()` and lets the `format()` take care of string formatting.  Passes all tests in sage/rings.

I will run long tests in the next 12 hours when my machine is free, but I think it is safe to review now, and I'll post about long tests either way.



---

archive/issue_comments_132598.json:
```json
{
    "body": "<a id='comment:16'></a>Replying to [comment:15 rbeezer]:\n> Good idea, Jeroen.  `self.polynomial()._pari_with_name(var)` hits the coefficients of an element with a `Mod`, so the behavior changes.\n\n\nWow, nice catch!\n\nThe current behaviour is totally wrong, the coefficients **must** be hit by a `Mod`, otherwise we can get wrong results!  I remember fixing another instance of this bug (#10486).",
    "created_at": "2011-06-24T19:58:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-132598",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>Replying to [comment:15 rbeezer]:
> Good idea, Jeroen.  `self.polynomial()._pari_with_name(var)` hits the coefficients of an element with a `Mod`, so the behavior changes.


Wow, nice catch!

The current behaviour is totally wrong, the coefficients **must** be hit by a `Mod`, otherwise we can get wrong results!  I remember fixing another instance of this bug (#10486).



---

archive/issue_comments_132599.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-06-24T19:58:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-132599",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_132600.json:
```json
{
    "body": "<a id='comment:17'></a>OK, I'll make it so, and fix about 4 doctests (and perhaps more code fixes will become obvious via the failing doctests).\n\nI haven't spent enough time with this code to know that the coefficients *must* be hit by Mod - thanks for the advice.\n\nProbably have something up this evening (Seattle time).",
    "created_at": "2011-06-24T20:28:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-132600",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:17'></a>OK, I'll make it so, and fix about 4 doctests (and perhaps more code fixes will become obvious via the failing doctests).

I haven't spent enough time with this code to know that the coefficients *must* be hit by Mod - thanks for the advice.

Probably have something up this evening (Seattle time).



---

archive/issue_comments_132601.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,19 @@\n+\\`\\`\\`\n+sage: F.<d> = GF(3^2)\n+sage: d._pari_()\n+Mod(d, Mod(1, 3)*d^2 + Mod(2, 3)*d + Mod(2, 3))\n+sage: d._pari_init_(\"m\")\n+'Mom(m, Mom(1, 3)*m^2 + Mom(2, 3)*m + Mom(2, 3))'\n+sage: d._pari_init_(\"p\")\n+'Mop(p, Mop(1, 3)*p^2 + Mop(2, 3)*p + Mop(2, 3))'\n+sage: d._pari_init_(\"b\")\n+'Mob(b, Mob(1, 3)*b^2 + Mob(2, 3)*b + Mob(2, 3))'\n+\\`\\`\\`\n \n+More care needs to be taken with a search and replace, maybe it should come earlier in \\`sage.rings.finite_rings.element_givaro.FiniteField_givaroElement._pari_init_\\`.\n+\n+**Apply:**\n+1.  [attachment:11530_pari_init-v5.patch]\n \n Comment: 1\n \n```\n",
    "created_at": "2011-06-25T00:37:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-132601",
    "user": "https://github.com/rbeezer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,19 @@
+\`\`\`
+sage: F.<d> = GF(3^2)
+sage: d._pari_()
+Mod(d, Mod(1, 3)*d^2 + Mod(2, 3)*d + Mod(2, 3))
+sage: d._pari_init_("m")
+'Mom(m, Mom(1, 3)*m^2 + Mom(2, 3)*m + Mom(2, 3))'
+sage: d._pari_init_("p")
+'Mop(p, Mop(1, 3)*p^2 + Mop(2, 3)*p + Mop(2, 3))'
+sage: d._pari_init_("b")
+'Mob(b, Mob(1, 3)*b^2 + Mob(2, 3)*b + Mob(2, 3))'
+\`\`\`
 
+More care needs to be taken with a search and replace, maybe it should come earlier in \`sage.rings.finite_rings.element_givaro.FiniteField_givaroElement._pari_init_\`.
+
+**Apply:**
+1.  [attachment:11530_pari_init-v5.patch]
 
 Comment: 1
 
```




---

archive/issue_comments_132602.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-06-25T00:37:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-132602",
    "user": "https://github.com/rbeezer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_132603.json:
```json
{
    "body": "<a id='comment:18'></a>Attachment [11530_pari_init-v5.patch](tarball://root/attachments/some-uuid/ticket11530/11530_pari_init-v5.patch) by @rbeezer created at 2011-06-25 00:37:08\n\nv5 patch:\n\nConsistent commands, as suggested.\n\nDead code removal (\"modulus_as_str\" routines).\n\nCorrected doctests.\n\nUpgraded docstrings.\n\nPasses tests in sage/rings.\n\nWill likely run full tests over dinner and report back.",
    "created_at": "2011-06-25T00:37:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-132603",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:18'></a>Attachment [11530_pari_init-v5.patch](tarball://root/attachments/some-uuid/ticket11530/11530_pari_init-v5.patch) by @rbeezer created at 2011-06-25 00:37:08

v5 patch:

Consistent commands, as suggested.

Dead code removal ("modulus_as_str" routines).

Corrected doctests.

Upgraded docstrings.

Passes tests in sage/rings.

Will likely run full tests over dinner and report back.



---

archive/issue_comments_132604.json:
```json
{
    "body": "<a id='comment:19'></a>Passes all long tests, so should be all ready for review.",
    "created_at": "2011-06-25T01:55:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-132604",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:19'></a>Passes all long tests, so should be all ready for review.



---

archive/issue_events_030129.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-06-25T08:38:05Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "milestone": "sage-4.7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11530#event-30129"
}
```



---

archive/issue_comments_132605.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-06-25T08:38:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-132605",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_132606.json:
```json
{
    "body": "<a id='comment:20'></a>The new code looks good, the results are what they should be.  There are sufficiently many example.  I will thrust you on the \"Passes all long tests\" part.",
    "created_at": "2011-06-25T08:38:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-132606",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'></a>The new code looks good, the results are what they should be.  There are sufficiently many example.  I will thrust you on the "Passes all long tests" part.



---

archive/issue_comments_132607.json:
```json
{
    "body": "<a id='comment:21'></a>Replying to [comment:20 jdemeyer]:\n> The new code looks good, the results are what they should be.  There are sufficiently many example.  I will thrust you on the \"Passes all long tests\" part.\n\n\nThanks, Jeroen, for your help on this one.",
    "created_at": "2011-06-25T14:37:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-132607",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:21'></a>Replying to [comment:20 jdemeyer]:
> The new code looks good, the results are what they should be.  There are sufficiently many example.  I will thrust you on the "Passes all long tests" part.


Thanks, Jeroen, for your help on this one.



---

archive/issue_events_030130.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-07-24T11:17:22Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11530#event-30130"
}
```



---

archive/issue_comments_132608.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-07-24T11:17:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-132608",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
