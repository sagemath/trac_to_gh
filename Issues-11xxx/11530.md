# Issue 11530: Conversion of finite field elements to PARI disregards characteristic and mangles "Mod"

archive/issues_011358.json:
```json
{
    "body": "\n```\nsage: F.<d> = GF(3^2)\nsage: d._pari_()\nMod(d, Mod(1, 3)*d^2 + Mod(2, 3)*d + Mod(2, 3))\nsage: d._pari_init_(\"m\")\n'Mom(m, Mom(1, 3)*m^2 + Mom(2, 3)*m + Mom(2, 3))'\nsage: d._pari_init_(\"p\")\n'Mop(p, Mop(1, 3)*p^2 + Mop(2, 3)*p + Mop(2, 3))'\nsage: d._pari_init_(\"b\")\n'Mob(b, Mob(1, 3)*b^2 + Mob(2, 3)*b + Mob(2, 3))'\n```\n\nMore care needs to be taken with a search and replace, maybe it should come earlier in `sage.rings.finite_rings.element_givaro.FiniteField_givaroElement._pari_init_`.\n\n**Apply:**\n1.  [attachment:11530_pari_init-v5.patch]\n\n**Assignee:** @aghitza\n\n**Keywords:** _pari_init_, variable name, finite field\n\n**Author:** Simon King, Rob Beezer\n\n**Reviewer:** Jeroen Demeyer\n\n**Merged:** sage-4.7.2.alpha0\n\nIssue created by migration from https://trac.sagemath.org/ticket/11530\n\n",
    "closed_at": "2011-07-24T11:17:22Z",
    "created_at": "2011-06-21T20:09:47Z",
    "labels": [
        "component: algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7.2",
    "title": "Conversion of finite field elements to PARI disregards characteristic and mangles \"Mod\"",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11530",
    "user": "https://github.com/rbeezer"
}
```

```
sage: F.<d> = GF(3^2)
sage: d._pari_()
Mod(d, Mod(1, 3)*d^2 + Mod(2, 3)*d + Mod(2, 3))
sage: d._pari_init_("m")
'Mom(m, Mom(1, 3)*m^2 + Mom(2, 3)*m + Mom(2, 3))'
sage: d._pari_init_("p")
'Mop(p, Mop(1, 3)*p^2 + Mop(2, 3)*p + Mop(2, 3))'
sage: d._pari_init_("b")
'Mob(b, Mob(1, 3)*b^2 + Mob(2, 3)*b + Mob(2, 3))'
```

More care needs to be taken with a search and replace, maybe it should come earlier in `sage.rings.finite_rings.element_givaro.FiniteField_givaroElement._pari_init_`.

**Apply:**
1.  [attachment:11530_pari_init-v5.patch]

**Assignee:** @aghitza

**Keywords:** _pari_init_, variable name, finite field

**Author:** Simon King, Rob Beezer

**Reviewer:** Jeroen Demeyer

**Merged:** sage-4.7.2.alpha0

Issue created by migration from https://trac.sagemath.org/ticket/11530





---

archive/issue_comments_121285.json:
```json
{
    "body": "**Author:** Simon King",
    "created_at": "2011-06-22T06:14:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-121285",
    "user": "https://github.com/simon-king-jena"
}
```

**Author:** Simon King



---

archive/issue_comments_121286.json:
```json
{
    "body": "<a id='comment:1'></a>\nMy patch completely avoids the string replacement.\n\nIf a variable name is given, it replaces `self.parent()._finite_field_ext_pari_modulus_as_str()` by `repr(self.parent().modulus()._pari_with_name(var))`, and `self.polynomial()` allows to change the variable name as well, so, I use `self.polynomial(var)` instead.\n\nOf course I added a test, and the tests of `sage/rings/finite_rings/element_givaro.pyx` pass. I didn't run full tests, yet, but I think it is ready for review.",
    "created_at": "2011-06-22T06:14:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-121286",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:1'></a>
My patch completely avoids the string replacement.

If a variable name is given, it replaces `self.parent()._finite_field_ext_pari_modulus_as_str()` by `repr(self.parent().modulus()._pari_with_name(var))`, and `self.polynomial()` allows to change the variable name as well, so, I use `self.polynomial(var)` instead.

Of course I added a test, and the tests of `sage/rings/finite_rings/element_givaro.pyx` pass. I didn't run full tests, yet, but I think it is ready for review.



---

archive/issue_events_093422.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2011-06-22T06:14:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11530#event-93422"
}
```



---

archive/issue_comments_121287.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"_pari_init_, variable name, finite field\".",
    "created_at": "2011-06-22T06:14:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-121287",
    "user": "https://github.com/simon-king-jena"
}
```

**Changing keywords** from "" to "_pari_init_, variable name, finite field".



---

archive/attachments_015200.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "11530_pari_init.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket11530/11530_pari_init.patch",
    "created_at": "2011-06-22T06:32:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/simon-king-jena"
}
```



---

archive/issue_comments_121288.json:
```json
{
    "body": "Do `_pari_init_` without string replacement",
    "created_at": "2011-06-22T06:32:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-121288",
    "user": "https://github.com/simon-king-jena"
}
```

Do `_pari_init_` without string replacement



---

archive/issue_comments_121289.json:
```json
{
    "body": "<a id='comment:2'></a>\nThe correct patch is only posted *now*: Previously, I had forgotten to commit my changes. So, please reload my patch if you had downloaded it before reading these lines...",
    "created_at": "2011-06-22T06:35:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-121289",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:2'></a>
The correct patch is only posted *now*: Previously, I had forgotten to commit my changes. So, please reload my patch if you had downloaded it before reading these lines...



---

archive/issue_comments_121290.json:
```json
{
    "body": "**Reviewer:** Jeroen Demeyer",
    "created_at": "2011-06-22T07:09:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-121290",
    "user": "https://github.com/jdemeyer"
}
```

**Reviewer:** Jeroen Demeyer



---

archive/issue_comments_121291.json:
```json
{
    "body": "<a id='comment:3'></a>\nAnnoying:\n\n```\nsage: F.<d> = GF(127^3)\nsage: d._pari_()\nMod(Mod(1, 127)*a, Mod(1, 127)*a^3 + Mod(3, 127)*a + Mod(124, 127))\nsage: d._pari_init_(\"x\")\nTraceback (most recent call last)\n\n/usr/local/src/sage-4.7.1.alpha3/<ipython console> in <module>()\n\nTypeError: _pari_init_() takes exactly 1 argument (2 given)\n```\n\nPatch looks good to me, though (still need to test).",
    "created_at": "2011-06-22T07:09:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-121291",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>
Annoying:

```
sage: F.<d> = GF(127^3)
sage: d._pari_()
Mod(Mod(1, 127)*a, Mod(1, 127)*a^3 + Mod(3, 127)*a + Mod(124, 127))
sage: d._pari_init_("x")
Traceback (most recent call last)

/usr/local/src/sage-4.7.1.alpha3/<ipython console> in <module>()

TypeError: _pari_init_() takes exactly 1 argument (2 given)
```

Patch looks good to me, though (still need to test).



---

archive/issue_events_093423.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-06-22T07:15:59Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "rename": {
        "from": "PARI initialization of finite field elements mangles Mod",
        "to": "Conversion of Givaro finite field element to PARI mangles Mod"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11530#event-93423"
}
```



---

archive/issue_comments_121292.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [jdemeyer](#comment%3A3):\n> Annoying:\n\n\nIndeed. So, should we take care of non-Givaro finite field elements as well? Here or on a different ticket?\n\nCheers,\nSimon",
    "created_at": "2011-06-22T07:20:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-121292",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:5'></a>
Replying to [jdemeyer](#comment%3A3):
> Annoying:


Indeed. So, should we take care of non-Givaro finite field elements as well? Here or on a different ticket?

Cheers,
Simon



---

archive/issue_comments_121293.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [SimonKing](#comment%3A5):\n> Indeed. So, should we take care of non-Givaro finite field elements as well? Here or on a different ticket?\n\n\nThere is also a _finite_field_ext_pari_modulus_as_str() method for the NTL finite fields of characteristic 2, which in my patch was just as easy to fix.  Not sure why Jeroen's error shows up for order 127^3.  My patch does string replacement, but passes all long tests.\n\nHave to go for a bit, I'll post more details in a few hours, but right now I'd say a second ticket is probably not needed.\n\nRob",
    "created_at": "2011-06-22T15:41:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-121293",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:6'></a>
Replying to [SimonKing](#comment%3A5):
> Indeed. So, should we take care of non-Givaro finite field elements as well? Here or on a different ticket?


There is also a _finite_field_ext_pari_modulus_as_str() method for the NTL finite fields of characteristic 2, which in my patch was just as easy to fix.  Not sure why Jeroen's error shows up for order 127^3.  My patch does string replacement, but passes all long tests.

Have to go for a bit, I'll post more details in a few hours, but right now I'd say a second ticket is probably not needed.

Rob



---

archive/issue_comments_121294.json:
```json
{
    "body": "<a id='comment:7'></a>\nAppears \"big\" fields do not have a _finite_field_ext_pari_modulus_as_str() method at all.\n\nI have a tweak to Simon's patch that may be just a bit cleaner and work for all fields.  In a bit.",
    "created_at": "2011-06-22T15:50:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-121294",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:7'></a>
Appears "big" fields do not have a _finite_field_ext_pari_modulus_as_str() method at all.

I have a tweak to Simon's patch that may be just a bit cleaner and work for all fields.  In a bit.



---

archive/issue_comments_121295.json:
```json
{
    "body": "Simon's patch, with minor modifications",
    "created_at": "2011-06-22T18:43:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-121295",
    "user": "https://github.com/rbeezer"
}
```

Simon's patch, with minor modifications



---

archive/attachments_015201.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "11530_pari_init-v2.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket11530/11530_pari_init-v2.patch",
    "created_at": "2011-06-22T18:52:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/rbeezer"
}
```



---

archive/issue_comments_121296.json:
```json
{
    "body": "<a id='comment:8'></a>\nv2 patch is a tweak of Simon's nice patch.  Passes all tests in sage/rings.  I think this will allow totally removing the two versions of `_finite_field_ext_pari_modulus_as_str()`.  I am going to test the removal with a test of the full Sage library.\n\nWithout search and replace, we get a 2x speedup.  I have not posted my search/replace patch since it seems useless now.\n\nTimings, all in microseconds, of the two commands below.\n\n```\nsage: F.<a>=GF(3^5)\nsage: a._pari_init_()\nsage: a._pari_init_('b')\n\n                        var=None       var='b'\n4.7 status quo            779            780\nRob search/replace        782            787\nSimon                     781            381\nSimon + Rob (v2)          369            381\n```\n\nSo it appears better coding will get us speed improvements.  Imagine that!",
    "created_at": "2011-06-22T18:52:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-121296",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:8'></a>
v2 patch is a tweak of Simon's nice patch.  Passes all tests in sage/rings.  I think this will allow totally removing the two versions of `_finite_field_ext_pari_modulus_as_str()`.  I am going to test the removal with a test of the full Sage library.

Without search and replace, we get a 2x speedup.  I have not posted my search/replace patch since it seems useless now.

Timings, all in microseconds, of the two commands below.

```
sage: F.<a>=GF(3^5)
sage: a._pari_init_()
sage: a._pari_init_('b')

                        var=None       var='b'
4.7 status quo            779            780
Rob search/replace        782            787
Simon                     781            381
Simon + Rob (v2)          369            381
```

So it appears better coding will get us speed improvements.  Imagine that!



---

archive/issue_events_093424.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2011-06-22T18:52:23Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "rename": {
        "from": "Conversion of Givaro finite field element to PARI mangles Mod",
        "to": "Conversion of finite field elements to PARI mangles Mod"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11530#event-93424"
}
```



---

archive/issue_comments_121297.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [jdemeyer](#comment%3A3):\n> Annoying:\n> \n> ```\n> sage: F.<d> = GF(127^3)\n> sage: d._pari_()\n> Mod(Mod(1, 127)*a, Mod(1, 127)*a^3 + Mod(3, 127)*a + Mod(124, 127))\n> sage: d._pari_init_(\"x\")\n> Traceback (most recent call last)\n> \n> /usr/local/src/sage-4.7.1.alpha3/<ipython console> in <module>()\n> \n> TypeError: _pari_init_() takes exactly 1 argument (2 given)\n> ```\n\n\nThe `_pari_init_()` method of `sage.rings.finite_rings.element_ext_pari.FiniteField_ext_pariElement` is not designed to take a new variable.  Should it be?\n\nI found this problem originally when trying to factor a polynomial with coefficients from `GF(3^5)`.  It looks to me like a factorization of a polynomial over `GF(127^3)` takes a different path, since the polynomial is of a different type, and therefore does not call `_pari_init_()` to change a variable name.\n\nIs this failure a non-issue?",
    "created_at": "2011-06-22T18:58:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-121297",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:9'></a>
Replying to [jdemeyer](#comment%3A3):
> Annoying:
> 
> ```
> sage: F.<d> = GF(127^3)
> sage: d._pari_()
> Mod(Mod(1, 127)*a, Mod(1, 127)*a^3 + Mod(3, 127)*a + Mod(124, 127))
> sage: d._pari_init_("x")
> Traceback (most recent call last)
> 
> /usr/local/src/sage-4.7.1.alpha3/<ipython console> in <module>()
> 
> TypeError: _pari_init_() takes exactly 1 argument (2 given)
> ```


The `_pari_init_()` method of `sage.rings.finite_rings.element_ext_pari.FiniteField_ext_pariElement` is not designed to take a new variable.  Should it be?

I found this problem originally when trying to factor a polynomial with coefficients from `GF(3^5)`.  It looks to me like a factorization of a polynomial over `GF(127^3)` takes a different path, since the polynomial is of a different type, and therefore does not call `_pari_init_()` to change a variable name.

Is this failure a non-issue?



---

archive/issue_comments_121298.json:
```json
{
    "body": "<a id='comment:10'></a>\nWith v2 patch, and both instances of `_finite_field_ext_pari_modulus_as_str()` commented-out, all long tests pass.\n\n(a) Does the v2 patch look acceptable?  It is uniformly faster and seems to fix the original problem.\n\n(b) Do we need to address Jeroen's annoyance above?\n\n(c) Should we trash both `_finite_field_ext_pari_modulus_as_str()`?\n\nI can manufacture a final patch, with Simon's name on it, if desired.  We could then call on Jeroen for a review.\n\nRob",
    "created_at": "2011-06-22T19:51:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-121298",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:10'></a>
With v2 patch, and both instances of `_finite_field_ext_pari_modulus_as_str()` commented-out, all long tests pass.

(a) Does the v2 patch look acceptable?  It is uniformly faster and seems to fix the original problem.

(b) Do we need to address Jeroen's annoyance above?

(c) Should we trash both `_finite_field_ext_pari_modulus_as_str()`?

I can manufacture a final patch, with Simon's name on it, if desired.  We could then call on Jeroen for a review.

Rob



---

archive/issue_comments_121299.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [rbeezer](#comment%3A10):\n> I can manufacture a final patch, with Simon's name on it, if desired.  We could then call on Jeroen for a review.\n\n\nYes, please. I am currently unable to work.",
    "created_at": "2011-06-23T15:06:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-121299",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:11'></a>
Replying to [rbeezer](#comment%3A10):
> I can manufacture a final patch, with Simon's name on it, if desired.  We could then call on Jeroen for a review.


Yes, please. I am currently unable to work.



---

archive/attachments_015202.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "11530_pari_init-v3.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket11530/11530_pari_init-v3.patch",
    "created_at": "2011-06-23T22:38:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/rbeezer"
}
```



---

archive/issue_comments_121300.json:
```json
{
    "body": "",
    "created_at": "2011-06-23T22:38:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-121300",
    "user": "https://github.com/rbeezer"
}
```





---

archive/issue_comments_121301.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [SimonKing](#comment%3A11):\n> Yes, please. I am currently unable to work.\n\n\nDone in v3 patch.  Patch has Simon's name on it, but I've added myself as an author.  \n\nHighlights:\n\n1.  Some expansion of the docstring - trying to be sure to test fields of characteristic 2 and elements that are not just the generator alone.\n2.  Eliminated two versions of `_finite_field_ext_pari_modulus_as_str()` since they are not needed and comments indicate they are not even very desirable.\n\nPatch passes all long tests on 4.7.1.alpha2.\n\nRob",
    "created_at": "2011-06-23T22:46:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-121301",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:12'></a>
Replying to [SimonKing](#comment%3A11):
> Yes, please. I am currently unable to work.


Done in v3 patch.  Patch has Simon's name on it, but I've added myself as an author.  

Highlights:

1.  Some expansion of the docstring - trying to be sure to test fields of characteristic 2 and elements that are not just the generator alone.
2.  Eliminated two versions of `_finite_field_ext_pari_modulus_as_str()` since they are not needed and comments indicate they are not even very desirable.

Patch passes all long tests on 4.7.1.alpha2.

Rob



---

archive/issue_comments_121302.json:
```json
{
    "body": "**Changing author** from \"Simon King\" to \"Simon King, Rob Beezer\".",
    "created_at": "2011-06-23T22:46:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-121302",
    "user": "https://github.com/rbeezer"
}
```

**Changing author** from "Simon King" to "Simon King, Rob Beezer".



---

archive/issue_comments_121303.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -13,4 +13,5 @@\n \n More care needs to be taken with a search and replace, maybe it should come earlier in `sage.rings.finite_rings.element_givaro.FiniteField_givaroElement._pari_init_`.\n \n-\n+**Apply:**\n+1.  [attachment:11530_pari_init-v3.patch]\n``````\n",
    "created_at": "2011-06-23T22:47:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-121303",
    "user": "https://github.com/rbeezer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -13,4 +13,5 @@
 
 More care needs to be taken with a search and replace, maybe it should come earlier in `sage.rings.finite_rings.element_givaro.FiniteField_givaroElement._pari_init_`.
 
-
+**Apply:**
+1.  [attachment:11530_pari_init-v3.patch]
``````




---

archive/issue_events_093425.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-06-24T14:07:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11530#event-93425"
}
```



---

archive/issue_events_093426.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-06-24T14:07:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11530#event-93426"
}
```



---

archive/issue_comments_121304.json:
```json
{
    "body": "<a id='comment:14'></a>\nWny not make lines 370--371 more consistent and write\n\n```\ng = str(self.parent().modulus()._pari_with_name(var))\nf = str(self.polynomial()._pari_with_name(var))\n```\n\nI guess you could even omit the \"str()\" since that will be done anyway in the formatting on line 372.",
    "created_at": "2011-06-24T14:07:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-121304",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'></a>
Wny not make lines 370--371 more consistent and write

```
g = str(self.parent().modulus()._pari_with_name(var))
f = str(self.polynomial()._pari_with_name(var))
```

I guess you could even omit the "str()" since that will be done anyway in the formatting on line 372.



---

archive/attachments_015203.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "11530_pari_init-v4.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket11530/11530_pari_init-v4.patch",
    "created_at": "2011-06-24T18:13:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/rbeezer"
}
```



---

archive/issue_comments_121305.json:
```json
{
    "body": "",
    "created_at": "2011-06-24T18:13:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-121305",
    "user": "https://github.com/rbeezer"
}
```





---

archive/issue_comments_121306.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -14,4 +14,4 @@\n More care needs to be taken with a search and replace, maybe it should come earlier in `sage.rings.finite_rings.element_givaro.FiniteField_givaroElement._pari_init_`.\n \n **Apply:**\n-1.  [attachment:11530_pari_init-v3.patch]\n+1.  [attachment:11530_pari_init-v4.patch]\n``````\n",
    "created_at": "2011-06-24T18:19:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-121306",
    "user": "https://github.com/rbeezer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -14,4 +14,4 @@
 More care needs to be taken with a search and replace, maybe it should come earlier in `sage.rings.finite_rings.element_givaro.FiniteField_givaroElement._pari_init_`.
 
 **Apply:**
-1.  [attachment:11530_pari_init-v3.patch]
+1.  [attachment:11530_pari_init-v4.patch]
``````




---

archive/issue_events_093427.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2011-06-24T18:19:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11530#event-93427"
}
```



---

archive/issue_events_093428.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2011-06-24T18:19:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11530#event-93428"
}
```



---

archive/issue_comments_121307.json:
```json
{
    "body": "<a id='comment:15'></a>\nGood idea, Jeroen.  `self.polynomial()._pari_with_name(var)` hits the coefficients of an element with a `Mod`, so the behavior changes.  Perhaps not a problem, but also perhaps not worth the risk either.  Makes a couple of other doctests fail, but maybe just for `_pari_` for finite field elements.\n\nTherefore the v4 patch basically just strips the `str()` and `repr()` and lets the `format()` take care of string formatting.  Passes all tests in sage/rings.\n\nI will run long tests in the next 12 hours when my machine is free, but I think it is safe to review now, and I'll post about long tests either way.",
    "created_at": "2011-06-24T18:19:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-121307",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:15'></a>
Good idea, Jeroen.  `self.polynomial()._pari_with_name(var)` hits the coefficients of an element with a `Mod`, so the behavior changes.  Perhaps not a problem, but also perhaps not worth the risk either.  Makes a couple of other doctests fail, but maybe just for `_pari_` for finite field elements.

Therefore the v4 patch basically just strips the `str()` and `repr()` and lets the `format()` take care of string formatting.  Passes all tests in sage/rings.

I will run long tests in the next 12 hours when my machine is free, but I think it is safe to review now, and I'll post about long tests either way.



---

archive/issue_comments_121308.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [rbeezer](#comment%3A15):\n> Good idea, Jeroen.  `self.polynomial()._pari_with_name(var)` hits the coefficients of an element with a `Mod`, so the behavior changes.\n\n\nWow, nice catch!\n\nThe current behaviour is totally wrong, the coefficients **must** be hit by a `Mod`, otherwise we can get wrong results!  I remember fixing another instance of this bug (#10486).",
    "created_at": "2011-06-24T19:58:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-121308",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>
Replying to [rbeezer](#comment%3A15):
> Good idea, Jeroen.  `self.polynomial()._pari_with_name(var)` hits the coefficients of an element with a `Mod`, so the behavior changes.


Wow, nice catch!

The current behaviour is totally wrong, the coefficients **must** be hit by a `Mod`, otherwise we can get wrong results!  I remember fixing another instance of this bug (#10486).



---

archive/issue_events_093429.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-06-24T19:58:43Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "rename": {
        "from": "Conversion of finite field elements to PARI mangles Mod",
        "to": "Conversion of finite field elements to PARI disregards characteristic and mangles \"Mod\""
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11530#event-93429"
}
```



---

archive/issue_events_093430.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-06-24T19:58:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11530#event-93430"
}
```



---

archive/issue_events_093431.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-06-24T19:58:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11530#event-93431"
}
```



---

archive/issue_comments_121309.json:
```json
{
    "body": "<a id='comment:17'></a>\nOK, I'll make it so, and fix about 4 doctests (and perhaps more code fixes will become obvious via the failing doctests).\n\nI haven't spent enough time with this code to know that the coefficients *must* be hit by Mod - thanks for the advice.\n\nProbably have something up this evening (Seattle time).",
    "created_at": "2011-06-24T20:28:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-121309",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:17'></a>
OK, I'll make it so, and fix about 4 doctests (and perhaps more code fixes will become obvious via the failing doctests).

I haven't spent enough time with this code to know that the coefficients *must* be hit by Mod - thanks for the advice.

Probably have something up this evening (Seattle time).



---

archive/issue_comments_121310.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -14,4 +14,4 @@\n More care needs to be taken with a search and replace, maybe it should come earlier in `sage.rings.finite_rings.element_givaro.FiniteField_givaroElement._pari_init_`.\n \n **Apply:**\n-1.  [attachment:11530_pari_init-v4.patch]\n+1.  [attachment:11530_pari_init-v5.patch]\n``````\n",
    "created_at": "2011-06-25T00:37:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-121310",
    "user": "https://github.com/rbeezer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -14,4 +14,4 @@
 More care needs to be taken with a search and replace, maybe it should come earlier in `sage.rings.finite_rings.element_givaro.FiniteField_givaroElement._pari_init_`.
 
 **Apply:**
-1.  [attachment:11530_pari_init-v4.patch]
+1.  [attachment:11530_pari_init-v5.patch]
``````




---

archive/issue_events_093432.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2011-06-25T00:37:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11530#event-93432"
}
```



---

archive/issue_events_093433.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2011-06-25T00:37:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11530#event-93433"
}
```



---

archive/attachments_015204.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "11530_pari_init-v5.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket11530/11530_pari_init-v5.patch",
    "created_at": "2011-06-25T00:37:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/rbeezer"
}
```



---

archive/issue_comments_121311.json:
```json
{
    "body": "<a id='comment:18'></a>\nv5 patch:\n\nConsistent commands, as suggested.\n\nDead code removal (\"modulus_as_str\" routines).\n\nCorrected doctests.\n\nUpgraded docstrings.\n\nPasses tests in sage/rings.\n\nWill likely run full tests over dinner and report back.",
    "created_at": "2011-06-25T00:37:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-121311",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:18'></a>
v5 patch:

Consistent commands, as suggested.

Dead code removal ("modulus_as_str" routines).

Corrected doctests.

Upgraded docstrings.

Passes tests in sage/rings.

Will likely run full tests over dinner and report back.



---

archive/issue_comments_121312.json:
```json
{
    "body": "<a id='comment:19'></a>\nPasses all long tests, so should be all ready for review.",
    "created_at": "2011-06-25T01:55:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-121312",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:19'></a>
Passes all long tests, so should be all ready for review.



---

archive/issue_events_093434.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-06-25T08:38:05Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "milestone": "sage-4.7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11530#event-93434"
}
```



---

archive/issue_events_093435.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-06-25T08:38:05Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "milestone": "sage-4.7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11530#event-93435"
}
```



---

archive/issue_events_093436.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-06-25T08:38:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11530#event-93436"
}
```



---

archive/issue_events_093437.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-06-25T08:38:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11530#event-93437"
}
```



---

archive/issue_comments_121313.json:
```json
{
    "body": "<a id='comment:20'></a>\nThe new code looks good, the results are what they should be.  There are sufficiently many example.  I will thrust you on the \"Passes all long tests\" part.",
    "created_at": "2011-06-25T08:38:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-121313",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'></a>
The new code looks good, the results are what they should be.  There are sufficiently many example.  I will thrust you on the "Passes all long tests" part.



---

archive/issue_comments_121314.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [jdemeyer](#comment%3A20):\n> The new code looks good, the results are what they should be.  There are sufficiently many example.  I will thrust you on the \"Passes all long tests\" part.\n\n\nThanks, Jeroen, for your help on this one.",
    "created_at": "2011-06-25T14:37:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-121314",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:21'></a>
Replying to [jdemeyer](#comment%3A20):
> The new code looks good, the results are what they should be.  There are sufficiently many example.  I will thrust you on the "Passes all long tests" part.


Thanks, Jeroen, for your help on this one.



---

archive/issue_events_093438.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-07-24T11:17:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11530#event-93438"
}
```



---

archive/issue_events_093439.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-07-24T11:17:22Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11530#event-93439"
}
```



---

archive/issue_comments_121315.json:
```json
{
    "body": "**Merged:** sage-4.7.2.alpha0",
    "created_at": "2011-07-24T11:17:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11530",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11530#issuecomment-121315",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-4.7.2.alpha0
