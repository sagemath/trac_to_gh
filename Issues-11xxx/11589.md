# Issue 11589: faster zero matrix creation

archive/issues_011417.json:
```json
{
    "assignees": [
        "https://github.com/jasongrout",
        "https://github.com/williamstein"
    ],
    "body": "Currently, we perform a matrix copy whenever we create a new zero matrix. This is undesirable for two reasons:\n\n* it is slower than creating a new matrix from scratch for some matrices\n* it eats up RAM (we create two instead of one matrix)\n\nSee also the discussion on [sage-devel]:\nhttp://groups.google.com/group/sage-devel/browse_thread/thread/478fb19ecb724be0\n\nApply all three patches.\n\nCC:  @simon-king-jena\n\nComponent: **linear algebra**\n\nAuthor: **Martin Albrecht, Simon King**\n\nReviewer: **Simon King, Martin Albrecht**\n\nMerged: **sage-4.7.2.alpha1**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/11589_\n\n",
    "closed_at": "2011-08-02T19:47:01Z",
    "created_at": "2011-07-11T20:16:50Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20linear%20algebra",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.7.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "faster zero matrix creation",
    "type": "issue",
    "updated_at": "2011-08-02T19:47:01Z",
    "url": "https://github.com/sagemath/sage/issues/11589",
    "user": "https://github.com/malb"
}
```
Currently, we perform a matrix copy whenever we create a new zero matrix. This is undesirable for two reasons:

* it is slower than creating a new matrix from scratch for some matrices
* it eats up RAM (we create two instead of one matrix)

See also the discussion on [sage-devel]:
http://groups.google.com/group/sage-devel/browse_thread/thread/478fb19ecb724be0

Apply all three patches.

CC:  @simon-king-jena

Component: **linear algebra**

Author: **Martin Albrecht, Simon King**

Reviewer: **Simon King, Martin Albrecht**

Merged: **sage-4.7.2.alpha1**

_Issue created by migration from https://trac.sagemath.org/ticket/11589_





---

archive/issue_events_155781.json:
```json
{
    "actor": "https://github.com/malb",
    "created_at": "2011-07-11T20:16:50Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11589",
    "milestone_number": null,
    "milestone_title": "sage-4.7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11589#event-155781"
}
```



---

archive/issue_events_155782.json:
```json
{
    "actor": "https://github.com/malb",
    "created_at": "2011-07-11T20:16:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11589",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20linear%20algebra",
    "label_color": "0000ff",
    "label_name": "c: linear algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11589#event-155782"
}
```



---

archive/issue_events_155783.json:
```json
{
    "actor": "https://github.com/malb",
    "created_at": "2011-07-11T20:16:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11589",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11589#event-155783"
}
```



---

archive/issue_events_155784.json:
```json
{
    "actor": "https://github.com/malb",
    "created_at": "2011-07-11T20:16:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11589",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11589#event-155784"
}
```



---

archive/issue_events_155785.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2011-07-11T20:16:50Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/11589",
    "subject": "https://github.com/malb",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11589#event-155785"
}
```



---

archive/issue_events_155786.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2011-07-11T20:16:50Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/11589",
    "subject": "https://github.com/malb",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11589#event-155786"
}
```



---

archive/issue_comments_118883.json:
```json
{
    "body": "Author: **Martin Albrecht, Simon King**",
    "created_at": "2011-07-11T20:44:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11589#issuecomment-118883",
    "user": "https://github.com/malb"
}
```

Author: **Martin Albrecht, Simon King**



---

archive/issue_comments_118884.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nTimings on my machine:\n\n**with patch**\n\n```python\nsage: for n in (50,500,1000): timeit('A=matrix(GF(2),%d,%d)'%(n,n))\n....: \n625 loops, best of 3: 104 \u00b5s per loop\n625 loops, best of 3: 108 \u00b5s per loop\n625 loops, best of 3: 115 \u00b5s per loop\n\nsage: for n in (50,500,1000): timeit('A=matrix(GF(3),%d,%d)'%(n,n))\n....: \n625 loops, best of 3: 100 \u00b5s per loop\n625 loops, best of 3: 448 \u00b5s per loop\n125 loops, best of 3: 1.65 ms per loop\n```\n\n**without patch**\n\n```python\nsage: for n in (50,500,1000): timeit('A=matrix(GF(2),%d,%d)'%(n,n))\n....: \n625 loops, best of 3: 97.6 \u00b5s per loop\n625 loops, best of 3: 108 \u00b5s per loop\n625 loops, best of 3: 128 \u00b5s per loop\n\nsage: for n in (50,500,1000): timeit('A=matrix(GF(3),%d,%d)'%(n,n))\n....: \n625 loops, best of 3: 94.1 \u00b5s per loop\n625 loops, best of 3: 502 \u00b5s per loop\n125 loops, best of 3: 2.48 ms per loop\nsage: \n\n```",
    "created_at": "2011-07-11T20:44:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11589#issuecomment-118884",
    "user": "https://github.com/malb"
}
```

<div id="comment:1" align="right">comment:1</div>

Timings on my machine:

**with patch**

```python
sage: for n in (50,500,1000): timeit('A=matrix(GF(2),%d,%d)'%(n,n))
....: 
625 loops, best of 3: 104 µs per loop
625 loops, best of 3: 108 µs per loop
625 loops, best of 3: 115 µs per loop

sage: for n in (50,500,1000): timeit('A=matrix(GF(3),%d,%d)'%(n,n))
....: 
625 loops, best of 3: 100 µs per loop
625 loops, best of 3: 448 µs per loop
125 loops, best of 3: 1.65 ms per loop
```

**without patch**

```python
sage: for n in (50,500,1000): timeit('A=matrix(GF(2),%d,%d)'%(n,n))
....: 
625 loops, best of 3: 97.6 µs per loop
625 loops, best of 3: 108 µs per loop
625 loops, best of 3: 128 µs per loop

sage: for n in (50,500,1000): timeit('A=matrix(GF(3),%d,%d)'%(n,n))
....: 
625 loops, best of 3: 94.1 µs per loop
625 loops, best of 3: 502 µs per loop
125 loops, best of 3: 2.48 ms per loop
sage: 

```



---

archive/issue_comments_118885.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nHi Martin,\n\nThank you for creating the patch!\n\nI don't like that the timings became a little slower for small matrices. We should try to find out why that happens.\n\nI think we should use calloc *only* when the argument `entries` is not a list. Namely, *if* it is a list then the matrix will be initialised by direct assignments anyway. Hence, in that case there is no need to initialise with calloc.\n\nDid you carefully determine the threshold for which calloc becomes faster than copying? Or is \"nrows, ncols > 100\" just a guess?\n\nCheers,\n\nSimon",
    "created_at": "2011-07-11T21:32:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11589#issuecomment-118885",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:2" align="right">comment:2</div>

Hi Martin,

Thank you for creating the patch!

I don't like that the timings became a little slower for small matrices. We should try to find out why that happens.

I think we should use calloc *only* when the argument `entries` is not a list. Namely, *if* it is a list then the matrix will be initialised by direct assignments anyway. Hence, in that case there is no need to initialise with calloc.

Did you carefully determine the threshold for which calloc becomes faster than copying? Or is "nrows, ncols > 100" just a guess?

Cheers,

Simon



---

archive/issue_comments_118886.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nReplying to [@simon-king-jena](#comment:2):\n> I don't like that the timings became a little slower for small matrices. We should try to find out why that happens.\n\nWe'll also have to do more careful timings to establish there really was a regression. I'm not 100% sure it's not a fluke.\n\n> I think we should use calloc *only* when the argument `entries` is not a list. Namely, *if* it is a list then the matrix will be initialised by direct assignments anyway. Hence, in that case there is no need to initialise with calloc.\n\nGood point.\n\n> Did you carefully determine the threshold for which calloc becomes faster than copying? Or is \"nrows, ncols > 100\" just a guess?\n\nAn educated guess, i.e. I did look at some timings but it's not carefully tuned (and probably machine dependent).",
    "created_at": "2011-07-11T22:10:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11589#issuecomment-118886",
    "user": "https://github.com/malb"
}
```

<div id="comment:3" align="right">comment:3</div>

Replying to [@simon-king-jena](#comment:2):
> I don't like that the timings became a little slower for small matrices. We should try to find out why that happens.

We'll also have to do more careful timings to establish there really was a regression. I'm not 100% sure it's not a fluke.

> I think we should use calloc *only* when the argument `entries` is not a list. Namely, *if* it is a list then the matrix will be initialised by direct assignments anyway. Hence, in that case there is no need to initialise with calloc.

Good point.

> Did you carefully determine the threshold for which calloc becomes faster than copying? Or is "nrows, ncols > 100" just a guess?

An educated guess, i.e. I did look at some timings but it's not carefully tuned (and probably machine dependent).



---

archive/issue_comments_118887.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nAttachment: **[trac_11589.patch.gz](https://github.com/sagemath/sage/files/ticket11589/trac_11589.patch.gz)**\n\nI updated the patch to use malloc() if entries is no list.",
    "created_at": "2011-07-11T22:11:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11589#issuecomment-118887",
    "user": "https://github.com/malb"
}
```

<div id="comment:4" align="right">comment:4</div>

Attachment: **[trac_11589.patch.gz](https://github.com/sagemath/sage/files/ticket11589/trac_11589.patch.gz)**

I updated the patch to use malloc() if entries is no list.



---

archive/issue_comments_118888.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nReplying to [@malb](#comment:4):\n> I updated the patch to use malloc() if entries is no list.\n\nYou mean: Use malloc *if* (and only if) it is a list. At least that is what you do in the patch (and coincides with what I had done as well).",
    "created_at": "2011-07-11T23:20:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11589#issuecomment-118888",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:5" align="right">comment:5</div>

Replying to [@malb](#comment:4):
> I updated the patch to use malloc() if entries is no list.

You mean: Use malloc *if* (and only if) it is a list. At least that is what you do in the patch (and coincides with what I had done as well).



---

archive/issue_comments_118889.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nSorry, yes ... where's my head",
    "created_at": "2011-07-11T23:50:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11589#issuecomment-118889",
    "user": "https://github.com/malb"
}
```

<div id="comment:6" align="right">comment:6</div>

Sorry, yes ... where's my head



---

archive/issue_comments_118890.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nHi Martin,\n\nI have a guess why the patch isn't as quick as it should be: It is the line\n\n```\n    return self.__matrix_class(self, 0, coerce=coerce, copy=copy) \n```\nIf you pass the value 0, then the matrix is initialised as a diagonal matrix with 0 on the diagonal -- which means that time is wasted by initialising the diagonal twice.\n\nBetter would be to pass `self, None, coerce=coerce, copy=copy`. I will change that and then do some tests, concerning the threshold and also concerning other base rings.",
    "created_at": "2011-07-12T07:35:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11589#issuecomment-118890",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:7" align="right">comment:7</div>

Hi Martin,

I have a guess why the patch isn't as quick as it should be: It is the line

```
    return self.__matrix_class(self, 0, coerce=coerce, copy=copy) 
```
If you pass the value 0, then the matrix is initialised as a diagonal matrix with 0 on the diagonal -- which means that time is wasted by initialising the diagonal twice.

Better would be to pass `self, None, coerce=coerce, copy=copy`. I will change that and then do some tests, concerning the threshold and also concerning other base rings.



---

archive/issue_comments_118891.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nI was wrong in assuming that `entries=0` would provoke a second initialisation of the diagonal.\n\nHowever, using None as default argument does have a tiny advantage: The test `if entries is None or entries==0` is a tad faster if it is actually None.\n\nWith `entries=None` as default in the `__call__` method of matrix spaces, timings do improve, and I obtain a threshold `nrows==ncols==40`: For larger matrices, over GF(p) with p>2, creation from scratch is faster, while for smaller matrices copying is faster.\n\nHowever, with the original patch, I find a big surprise: Over GF(2), copying is *always* faster! For GF(p), p>2, I can confirm your statement that the threshold seems to be around 100.\n\nThere is one problem with default `entries=None`, though: Some matrix classes (used for matrices over the reals or symbolics) don't accept `entries=None`. So, their init methods should be adapted as well.\n\nQuestion: Is it worth it?\n\nUsing None, I obtain for example:\n\n```\nsage: timeit(\"M = matrix(GF(2),30,30)\", number=10000)\n10000 loops, best of 3: 105 \u00b5s per loop\nsage: timeit(\"M = matrix(GF(2),300,300)\", number=10000)\n10000 loops, best of 3: 107 \u00b5s per loop\nsage: timeit(\"M = matrix(GF(3),30,30)\", number=10000)\n10000 loops, best of 3: 102 \u00b5s per loop\nsage: timeit(\"M = matrix(GF(3),300,300)\", number=10000)\n10000 loops, best of 3: 210 \u00b5s per loop\n```\n\nUsing 0, I obtain:\n\n```\nsage: timeit(\"M = matrix(GF(2),30,30)\", number=10000)\n10000 loops, best of 3: 113 \u00b5s per loop\nsage: timeit(\"M = matrix(GF(2),300,300)\", number=10000)\n10000 loops, best of 3: 123 \u00b5s per loop\nsage: timeit(\"M = matrix(GF(3),30,30)\", number=10000)\n10000 loops, best of 3: 102 \u00b5s per loop\nsage: timeit(\"M = matrix(GF(3),300,300)\", number=10000)\n10000 loops, best of 3: 215 \u00b5s per loop\n```\n\nThe difference is small, but it seems quite reproducible (not flaky) for me. So, my suggestion is to go through the matrix classes and allow `entries=None`.",
    "created_at": "2011-07-12T09:32:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11589#issuecomment-118891",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:8" align="right">comment:8</div>

I was wrong in assuming that `entries=0` would provoke a second initialisation of the diagonal.

However, using None as default argument does have a tiny advantage: The test `if entries is None or entries==0` is a tad faster if it is actually None.

With `entries=None` as default in the `__call__` method of matrix spaces, timings do improve, and I obtain a threshold `nrows==ncols==40`: For larger matrices, over GF(p) with p>2, creation from scratch is faster, while for smaller matrices copying is faster.

However, with the original patch, I find a big surprise: Over GF(2), copying is *always* faster! For GF(p), p>2, I can confirm your statement that the threshold seems to be around 100.

There is one problem with default `entries=None`, though: Some matrix classes (used for matrices over the reals or symbolics) don't accept `entries=None`. So, their init methods should be adapted as well.

Question: Is it worth it?

Using None, I obtain for example:

```
sage: timeit("M = matrix(GF(2),30,30)", number=10000)
10000 loops, best of 3: 105 µs per loop
sage: timeit("M = matrix(GF(2),300,300)", number=10000)
10000 loops, best of 3: 107 µs per loop
sage: timeit("M = matrix(GF(3),30,30)", number=10000)
10000 loops, best of 3: 102 µs per loop
sage: timeit("M = matrix(GF(3),300,300)", number=10000)
10000 loops, best of 3: 210 µs per loop
```

Using 0, I obtain:

```
sage: timeit("M = matrix(GF(2),30,30)", number=10000)
10000 loops, best of 3: 113 µs per loop
sage: timeit("M = matrix(GF(2),300,300)", number=10000)
10000 loops, best of 3: 123 µs per loop
sage: timeit("M = matrix(GF(3),30,30)", number=10000)
10000 loops, best of 3: 102 µs per loop
sage: timeit("M = matrix(GF(3),300,300)", number=10000)
10000 loops, best of 3: 215 µs per loop
```

The difference is small, but it seems quite reproducible (not flaky) for me. So, my suggestion is to go through the matrix classes and allow `entries=None`.



---

archive/issue_comments_118892.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI made all matrices accept \"None\" as an argument.\n\nI tried to determine the threshold for copying versus creating a zero matrix, using the following test function:\n\n```\nsage: def tests(R):\n....:     BetterCopy = []\n....:     for d in srange(10,511,20):\n....:         MS = MatrixSpace(R,d)\n....:         MS._copy_zero = True\n....:         globals()['d'] = d\n....:         globals()['R'] = R\n....:         TCopy = timeit.eval(\"M = matrix(R,d,d)\",number=1000)\n....:         MS._copy_zero = False\n....:         TNoCopy = timeit.eval(\"M = matrix(R,d,d)\",number=1000)\n....:         if TCopy.stats[3] < TNoCopy.stats[3]:\n....:             BetterCopy.append((d,TCopy,TNoCopy))\n....:     return BetterCopy\n....: \n```\n\nIt turns out that with both patches applied, copying is not a good idea over GF(2) and over the rationals:\n\n```\nsage: tests(GF(2))\n[]\nsage: tests(QQ)\n[]\n```\nNote that I observed that the memory consumption for the test over the rationals constantly increased: Perhaps there is a memory leak.\n\nHowever, in all other cases I studied, copying was better, for matrices of up to 30 rows and columns:\n\n```\nsage: tests(GF(3))\n[(10, 1000 loops, best of 3: 48.2 \u00b5s per loop, 1000 loops, best of 3: 49 \u00b5s per loop), (30, 1000 loops, best of 3: 50 \u00b5s per loop, 1000 loops, best of 3: 50.9 \u00b5s per loop)]\nsage: tests(GF(1019))\n[(10, 1000 loops, best of 3: 48.3 \u00b5s per loop, 1000 loops, best of 3: 49.2 \u00b5s per loop)]\nsage: tests(GF(625,'a'))\n[(10, 1000 loops, best of 3: 45.1 \u00b5s per loop, 1000 loops, best of 3: 63.1 \u00b5s per loop), (30, 1000 loops, best of 3: 62.9 \u00b5s per loop, 1000 loops, best of 3: 68 \u00b5s per loop), (230, 1000 loops, best of 3: 1.15 ms per loop, 1000 loops, best of 3: 367 \u00b5s per loop), (250, 1000 loops, best of 3: 1.35 ms per loop, 1000 loops, best of 3: 423 \u00b5s per loop), (270, 1000 loops, best of 3: 1.71 ms per loop, 1000 loops, best of 3: 618 \u00b5s per loop), (290, 1000 loops, best of 3: 1.95 ms per loop, 1000 loops, best of 3: 701 \u00b5s per loop), (310, 1000 loops, best of 3: 2.23 ms per loop, 1000 loops, best of 3: 791 \u00b5s per loop), (330, 1000 loops, best of 3: 2.52 ms per loop, 1000 loops, best of 3: 883 \u00b5s per loop), (350, 1000 loops, best of 3: 2.82 ms per loop, 1000 loops, best of 3: 988 \u00b5s per loop)]\nsage: tests(ZZ)\n[(10, 625 loops, best of 3: 48.6 \u00b5s per loop, 625 loops, best of 3: 56.5 \u00b5s per loop), (30, 625 loops, best of 3: 111 \u00b5s per loop, 625 loops, best of 3: 118 \u00b5s per loop), (50, 625 loops, best of 3: 230 \u00b5s per loop, 625 loops, best of 3: 235 \u00b5s per loop)]\n```\n\nTherefore, I modified the threshold in `_copy_zero` a bit. There is no special case for `Matrix_modn_dense`, but for `Matrix_rational_dense`.\n\nHere are timings similar to the ones you did above (adding another test case).\n\nWith both patches:\n\n```\nsage: for n in (50,500,1000): timeit('A=matrix(GF(2),%d,%d)'%(n,n))\n....: \n625 loops, best of 3: 105 \u00b5s per loop\n625 loops, best of 3: 108 \u00b5s per loop\n625 loops, best of 3: 116 \u00b5s per loop\nsage: for n in (50,500,1000): timeit('A=matrix(GF(3),%d,%d)'%(n,n))\n....: \n625 loops, best of 3: 103 \u00b5s per loop\n625 loops, best of 3: 403 \u00b5s per loop\n625 loops, best of 3: 1.3 ms per loop\nsage: for n in (50,500,1000): timeit('A=matrix(GF(625,\"a\"),%d,%d)'%(n,n))\n....: \n625 loops, best of 3: 198 \u00b5s per loop\n125 loops, best of 3: 1.97 ms per loop\n125 loops, best of 3: 7.29 ms per loop\n```\n\nWithout patches:\n\n```\nsage: for n in (50,500,1000): timeit('A=matrix(GF(2),%d,%d)'%(n,n))\n....: \n625 loops, best of 3: 108 \u00b5s per loop\n625 loops, best of 3: 116 \u00b5s per loop\n625 loops, best of 3: 137 \u00b5s per loop\nsage: for n in (50,500,1000): timeit('A=matrix(GF(3),%d,%d)'%(n,n))\n....: \n625 loops, best of 3: 103 \u00b5s per loop\n625 loops, best of 3: 566 \u00b5s per loop\n125 loops, best of 3: 2.46 ms per loop\nsage: for n in (50,500,1000): timeit('A=matrix(GF(625,\"a\"),%d,%d)'%(n,n))\n....: \n625 loops, best of 3: 225 \u00b5s per loop\n125 loops, best of 3: 5.95 ms per loop\n25 loops, best of 3: 22.9 ms per loop\n```\n\nSo, with both patches applied, the timings consistently improve.\n\n**__Reviewing__**\n\nI am not sure how the reviewing should be done, as we are both authors. Do you think it is ok if I review the first patch and you review the second patch? I need to run all long doctests, though; so far, I only did the tests in sage/matrix.\n\n**__TODO__**\n\nOn a different ticket, the potential memory leak for rational dense matrices should be studied.\n\nI recall that in some arithmetic routines of matrices, zero matrices are created at the beginning. I am not sure whether that is done \"the official way\" or by *always* copying a zero matrix, but I think it was the latter. That might be worth while to fix as well.",
    "created_at": "2011-07-12T10:43:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11589#issuecomment-118892",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:9" align="right">comment:9</div>

I made all matrices accept "None" as an argument.

I tried to determine the threshold for copying versus creating a zero matrix, using the following test function:

```
sage: def tests(R):
....:     BetterCopy = []
....:     for d in srange(10,511,20):
....:         MS = MatrixSpace(R,d)
....:         MS._copy_zero = True
....:         globals()['d'] = d
....:         globals()['R'] = R
....:         TCopy = timeit.eval("M = matrix(R,d,d)",number=1000)
....:         MS._copy_zero = False
....:         TNoCopy = timeit.eval("M = matrix(R,d,d)",number=1000)
....:         if TCopy.stats[3] < TNoCopy.stats[3]:
....:             BetterCopy.append((d,TCopy,TNoCopy))
....:     return BetterCopy
....: 
```

It turns out that with both patches applied, copying is not a good idea over GF(2) and over the rationals:

```
sage: tests(GF(2))
[]
sage: tests(QQ)
[]
```
Note that I observed that the memory consumption for the test over the rationals constantly increased: Perhaps there is a memory leak.

However, in all other cases I studied, copying was better, for matrices of up to 30 rows and columns:

```
sage: tests(GF(3))
[(10, 1000 loops, best of 3: 48.2 µs per loop, 1000 loops, best of 3: 49 µs per loop), (30, 1000 loops, best of 3: 50 µs per loop, 1000 loops, best of 3: 50.9 µs per loop)]
sage: tests(GF(1019))
[(10, 1000 loops, best of 3: 48.3 µs per loop, 1000 loops, best of 3: 49.2 µs per loop)]
sage: tests(GF(625,'a'))
[(10, 1000 loops, best of 3: 45.1 µs per loop, 1000 loops, best of 3: 63.1 µs per loop), (30, 1000 loops, best of 3: 62.9 µs per loop, 1000 loops, best of 3: 68 µs per loop), (230, 1000 loops, best of 3: 1.15 ms per loop, 1000 loops, best of 3: 367 µs per loop), (250, 1000 loops, best of 3: 1.35 ms per loop, 1000 loops, best of 3: 423 µs per loop), (270, 1000 loops, best of 3: 1.71 ms per loop, 1000 loops, best of 3: 618 µs per loop), (290, 1000 loops, best of 3: 1.95 ms per loop, 1000 loops, best of 3: 701 µs per loop), (310, 1000 loops, best of 3: 2.23 ms per loop, 1000 loops, best of 3: 791 µs per loop), (330, 1000 loops, best of 3: 2.52 ms per loop, 1000 loops, best of 3: 883 µs per loop), (350, 1000 loops, best of 3: 2.82 ms per loop, 1000 loops, best of 3: 988 µs per loop)]
sage: tests(ZZ)
[(10, 625 loops, best of 3: 48.6 µs per loop, 625 loops, best of 3: 56.5 µs per loop), (30, 625 loops, best of 3: 111 µs per loop, 625 loops, best of 3: 118 µs per loop), (50, 625 loops, best of 3: 230 µs per loop, 625 loops, best of 3: 235 µs per loop)]
```

Therefore, I modified the threshold in `_copy_zero` a bit. There is no special case for `Matrix_modn_dense`, but for `Matrix_rational_dense`.

Here are timings similar to the ones you did above (adding another test case).

With both patches:

```
sage: for n in (50,500,1000): timeit('A=matrix(GF(2),%d,%d)'%(n,n))
....: 
625 loops, best of 3: 105 µs per loop
625 loops, best of 3: 108 µs per loop
625 loops, best of 3: 116 µs per loop
sage: for n in (50,500,1000): timeit('A=matrix(GF(3),%d,%d)'%(n,n))
....: 
625 loops, best of 3: 103 µs per loop
625 loops, best of 3: 403 µs per loop
625 loops, best of 3: 1.3 ms per loop
sage: for n in (50,500,1000): timeit('A=matrix(GF(625,"a"),%d,%d)'%(n,n))
....: 
625 loops, best of 3: 198 µs per loop
125 loops, best of 3: 1.97 ms per loop
125 loops, best of 3: 7.29 ms per loop
```

Without patches:

```
sage: for n in (50,500,1000): timeit('A=matrix(GF(2),%d,%d)'%(n,n))
....: 
625 loops, best of 3: 108 µs per loop
625 loops, best of 3: 116 µs per loop
625 loops, best of 3: 137 µs per loop
sage: for n in (50,500,1000): timeit('A=matrix(GF(3),%d,%d)'%(n,n))
....: 
625 loops, best of 3: 103 µs per loop
625 loops, best of 3: 566 µs per loop
125 loops, best of 3: 2.46 ms per loop
sage: for n in (50,500,1000): timeit('A=matrix(GF(625,"a"),%d,%d)'%(n,n))
....: 
625 loops, best of 3: 225 µs per loop
125 loops, best of 3: 5.95 ms per loop
25 loops, best of 3: 22.9 ms per loop
```

So, with both patches applied, the timings consistently improve.

**__Reviewing__**

I am not sure how the reviewing should be done, as we are both authors. Do you think it is ok if I review the first patch and you review the second patch? I need to run all long doctests, though; so far, I only did the tests in sage/matrix.

**__TODO__**

On a different ticket, the potential memory leak for rational dense matrices should be studied.

I recall that in some arithmetic routines of matrices, zero matrices are created at the beginning. I am not sure whether that is done "the official way" or by *always* copying a zero matrix, but I think it was the latter. That might be worth while to fix as well.



---

archive/issue_events_155787.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2011-07-12T10:43:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11589",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11589#event-155787"
}
```



---

archive/issue_comments_118893.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nPS: It seems to me that several doc tests from sage/matrix are considerably faster with the patches. I hope that can be confirmed.",
    "created_at": "2011-07-12T10:48:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11589#issuecomment-118893",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:10" align="right">comment:10</div>

PS: It seems to me that several doc tests from sage/matrix are considerably faster with the patches. I hope that can be confirmed.



---

archive/issue_comments_118894.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@simon-king-jena](#comment:9):\n> I made all matrices accept \"None\" as an argument.\n\nCool, you are fast!\n \n> **__Reviewing__**\n> \n> I am not sure how the reviewing should be done, as we are both authors. Do you think it is ok if I review the first patch and you review the second patch? I need to run all long doctests, though; so far, I only did the tests in sage/matrix.\n\nYes, as far as I know it's okay if we cross-review. So I'll take a look at your patch.",
    "created_at": "2011-07-12T10:52:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11589#issuecomment-118894",
    "user": "https://github.com/malb"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@simon-king-jena](#comment:9):
> I made all matrices accept "None" as an argument.

Cool, you are fast!
 
> **__Reviewing__**
> 
> I am not sure how the reviewing should be done, as we are both authors. Do you think it is ok if I review the first patch and you review the second patch? I need to run all long doctests, though; so far, I only did the tests in sage/matrix.

Yes, as far as I know it's okay if we cross-review. So I'll take a look at your patch.



---

archive/issue_comments_118895.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nHere are timings on my machine (Macbook Pro, i7):\n\n__no patch__\n\n```python\nsage: for n in (50,500,1000): timeit('A=matrix(GF(2),%d,%d)'%(n,n))\n....: \n625 loops, best of 3: 98.1 \u00b5s per loop\n625 loops, best of 3: 115 \u00b5s per loop\n625 loops, best of 3: 130 \u00b5s per loop\n\nsage: for n in (50,500,1000): timeit('A=matrix(GF(3),%d,%d)'%(n,n))\n....: \n625 loops, best of 3: 93.3 \u00b5s per loop\n625 loops, best of 3: 538 \u00b5s per loop\n125 loops, best of 3: 2.41 ms per loop\n\nsage: for n in (50,500,1000): timeit('A=matrix(GF(625,\"a\"),%d,%d)'%(n,n))\n....: \n625 loops, best of 3: 189 \u00b5s per loop\n125 loops, best of 3: 3.7 ms per loop\n25 loops, best of 3: 14.1 ms per loop\n```\n\n__first only__\n\n```python\nsage: for n in (50,500,1000): timeit('A=matrix(GF(2),%d,%d)'%(n,n))\n....: \n625 loops, best of 3: 104 \u00b5s per loop\n625 loops, best of 3: 108 \u00b5s per loop\n625 loops, best of 3: 112 \u00b5s per loop\n\nsage: for n in (50,500,1000): timeit('A=matrix(GF(3),%d,%d)'%(n,n))\n....: \n625 loops, best of 3: 95.5 \u00b5s per loop\n625 loops, best of 3: 442 \u00b5s per loop\n625 loops, best of 3: 1.48 ms per loop\n\nsage: for n in (50,500,1000): timeit('A=matrix(GF(625,\"a\"),%d,%d)'%(n,n))\n....: \n625 loops, best of 3: 184 \u00b5s per loop\n125 loops, best of 3: 3.7 ms per loop\n25 loops, best of 3: 13.8 ms per loop\n```\n\n__with both__\n\n```python\nsage: for n in (50,500,1000): timeit('A=matrix(GF(2),%d,%d)'%(n,n))\n....: \n625 loops, best of 3: 94.5 \u00b5s per loop\n625 loops, best of 3: 98.9 \u00b5s per loop\n625 loops, best of 3: 108 \u00b5s per loop\n\nsage: for n in (50,500,1000): timeit('A=matrix(GF(3),%d,%d)'%(n,n))\n....: \n625 loops, best of 3: 95 \u00b5s per loop\n625 loops, best of 3: 438 \u00b5s per loop\n625 loops, best of 3: 1.49 ms per loop\n\nsage: for n in (50,500,1000): timeit('A=matrix(GF(625,\"a\"),%d,%d)'%(n,n))\n....: \n625 loops, best of 3: 176 \u00b5s per loop\n125 loops, best of 3: 1.74 ms per loop\n125 loops, best of 3: 6.24 ms per loop\n```\n\nMy take: it's definitely faster for large-ish matrices and undecided for small matrices, i.e. my timings for 50x50 are rather unstable.",
    "created_at": "2011-07-12T11:26:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11589#issuecomment-118895",
    "user": "https://github.com/malb"
}
```

<div id="comment:12" align="right">comment:12</div>

Here are timings on my machine (Macbook Pro, i7):

__no patch__

```python
sage: for n in (50,500,1000): timeit('A=matrix(GF(2),%d,%d)'%(n,n))
....: 
625 loops, best of 3: 98.1 µs per loop
625 loops, best of 3: 115 µs per loop
625 loops, best of 3: 130 µs per loop

sage: for n in (50,500,1000): timeit('A=matrix(GF(3),%d,%d)'%(n,n))
....: 
625 loops, best of 3: 93.3 µs per loop
625 loops, best of 3: 538 µs per loop
125 loops, best of 3: 2.41 ms per loop

sage: for n in (50,500,1000): timeit('A=matrix(GF(625,"a"),%d,%d)'%(n,n))
....: 
625 loops, best of 3: 189 µs per loop
125 loops, best of 3: 3.7 ms per loop
25 loops, best of 3: 14.1 ms per loop
```

__first only__

```python
sage: for n in (50,500,1000): timeit('A=matrix(GF(2),%d,%d)'%(n,n))
....: 
625 loops, best of 3: 104 µs per loop
625 loops, best of 3: 108 µs per loop
625 loops, best of 3: 112 µs per loop

sage: for n in (50,500,1000): timeit('A=matrix(GF(3),%d,%d)'%(n,n))
....: 
625 loops, best of 3: 95.5 µs per loop
625 loops, best of 3: 442 µs per loop
625 loops, best of 3: 1.48 ms per loop

sage: for n in (50,500,1000): timeit('A=matrix(GF(625,"a"),%d,%d)'%(n,n))
....: 
625 loops, best of 3: 184 µs per loop
125 loops, best of 3: 3.7 ms per loop
25 loops, best of 3: 13.8 ms per loop
```

__with both__

```python
sage: for n in (50,500,1000): timeit('A=matrix(GF(2),%d,%d)'%(n,n))
....: 
625 loops, best of 3: 94.5 µs per loop
625 loops, best of 3: 98.9 µs per loop
625 loops, best of 3: 108 µs per loop

sage: for n in (50,500,1000): timeit('A=matrix(GF(3),%d,%d)'%(n,n))
....: 
625 loops, best of 3: 95 µs per loop
625 loops, best of 3: 438 µs per loop
625 loops, best of 3: 1.49 ms per loop

sage: for n in (50,500,1000): timeit('A=matrix(GF(625,"a"),%d,%d)'%(n,n))
....: 
625 loops, best of 3: 176 µs per loop
125 loops, best of 3: 1.74 ms per loop
125 loops, best of 3: 6.24 ms per loop
```

My take: it's definitely faster for large-ish matrices and undecided for small matrices, i.e. my timings for 50x50 are rather unstable.



---

archive/issue_comments_118896.json:
```json
{
    "body": "Some fine tuning for the creation of zero matrices",
    "created_at": "2011-07-12T12:02:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11589#issuecomment-118896",
    "user": "https://github.com/simon-king-jena"
}
```

Some fine tuning for the creation of zero matrices



---

archive/issue_comments_118897.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nAttachment: **[trac_11589_copy_vs_creation_of_zero.patch.gz](https://github.com/sagemath/sage/files/ticket11589/trac_11589_copy_vs_creation_of_zero.patch.gz)**\n\nSorry, I had to replace my patch, since apparently I forgot to change the doctests of _copy_zero. Actually, the new patch version adds some tests, as there is now a special case for matrices over the rationals.\n\nFWIW, with the old patch version all long tests except matrix_space.py pass, and with the new patch version (that only fixes the failing doctest) matrix_space.py passes as well.",
    "created_at": "2011-07-12T12:04:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11589#issuecomment-118897",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:13" align="right">comment:13</div>

Attachment: **[trac_11589_copy_vs_creation_of_zero.patch.gz](https://github.com/sagemath/sage/files/ticket11589/trac_11589_copy_vs_creation_of_zero.patch.gz)**

Sorry, I had to replace my patch, since apparently I forgot to change the doctests of _copy_zero. Actually, the new patch version adds some tests, as there is now a special case for matrices over the rationals.

FWIW, with the old patch version all long tests except matrix_space.py pass, and with the new patch version (that only fixes the failing doctest) matrix_space.py passes as well.



---

archive/issue_comments_118898.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@simon-king-jena](#comment:9):\n> I recall that in some arithmetic routines of matrices, zero matrices are created at the beginning. I am not sure whether that is done \"the official way\" or by *always* copying a zero matrix, but I think it was the latter. That might be worth while to fix as well.\n\nI found it. It is the `_multiply_strassen` method in `matrix2.pyx`, which says:\n\n```\n        if self.is_sparse():\n            output = self.matrix_space(self._nrows, right._ncols, sparse = True)(0)\n        else:\n            output = self.matrix_space(self._nrows, right._ncols, sparse = False).zero_matrix().__copy__()\n```\n\nI think that ought to be improved, but that would better be on another ticket.",
    "created_at": "2011-07-12T13:00:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11589#issuecomment-118898",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@simon-king-jena](#comment:9):
> I recall that in some arithmetic routines of matrices, zero matrices are created at the beginning. I am not sure whether that is done "the official way" or by *always* copying a zero matrix, but I think it was the latter. That might be worth while to fix as well.

I found it. It is the `_multiply_strassen` method in `matrix2.pyx`, which says:

```
        if self.is_sparse():
            output = self.matrix_space(self._nrows, right._ncols, sparse = True)(0)
        else:
            output = self.matrix_space(self._nrows, right._ncols, sparse = False).zero_matrix().__copy__()
```

I think that ought to be improved, but that would better be on another ticket.



---

archive/issue_comments_118899.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nI added a third patch, that applies the faster way of creating a zero matrix to `_multiply_strassen`. With the third patch, all tests from sage/matrix still pass. I have no benchmark that shows a noticeable difference to the old behaviour. But I think it won't hurt to use an optimised procedure for the creation of a zero matrix, rather than to hard-wire the copying of a zero matrix in the current version of _multiply_strassen.\n\nI think that the third patch is small enough to be discussed here. However, note that there already is an open ticket on improving matrix multiplication: #8096. There is no activity for 16 months now! I think it would be worth while to invest some work there. It seems to me that a part of the issues of that old ticket are already resolved.\n\nConcerning reviews: I believe that the first patch is fine, and I give it a positive review. I have already mentioned that the tests pass, and the improvement of the timings (in particular when the second patch is added) is clear.",
    "created_at": "2011-07-12T13:38:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11589#issuecomment-118899",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:15" align="right">comment:15</div>

I added a third patch, that applies the faster way of creating a zero matrix to `_multiply_strassen`. With the third patch, all tests from sage/matrix still pass. I have no benchmark that shows a noticeable difference to the old behaviour. But I think it won't hurt to use an optimised procedure for the creation of a zero matrix, rather than to hard-wire the copying of a zero matrix in the current version of _multiply_strassen.

I think that the third patch is small enough to be discussed here. However, note that there already is an open ticket on improving matrix multiplication: #8096. There is no activity for 16 months now! I think it would be worth while to invest some work there. It seems to me that a part of the issues of that old ticket are already resolved.

Concerning reviews: I believe that the first patch is fine, and I give it a positive review. I have already mentioned that the tests pass, and the improvement of the timings (in particular when the second patch is added) is clear.



---

archive/issue_events_155788.json:
```json
{
    "actor": "https://github.com/malb",
    "created_at": "2011-07-12T15:50:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11589",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11589#event-155788"
}
```



---

archive/issue_events_155789.json:
```json
{
    "actor": "https://github.com/malb",
    "created_at": "2011-07-12T15:50:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11589",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11589#event-155789"
}
```



---

archive/issue_comments_118900.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\n> Concerning reviews: I believe that the first patch is fine, and I give it a positive review. I have already mentioned that the tests pass, and the improvement of the timings (in particular when the second patch is added) is clear.\n\nI give your two patches a positive review as well.",
    "created_at": "2011-07-12T15:50:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11589#issuecomment-118900",
    "user": "https://github.com/malb"
}
```

<div id="comment:16" align="right">comment:16</div>

> Concerning reviews: I believe that the first patch is fine, and I give it a positive review. I have already mentioned that the tests pass, and the improvement of the timings (in particular when the second patch is added) is clear.

I give your two patches a positive review as well.



---

archive/issue_comments_118901.json:
```json
{
    "body": "Reviewer: **Simon King, Martin Albrecht**",
    "created_at": "2011-07-12T15:50:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11589#issuecomment-118901",
    "user": "https://github.com/malb"
}
```

Reviewer: **Simon King, Martin Albrecht**



---

archive/issue_comments_118902.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nNote that the patch for Strassen-Winograd multiplication at #11610 benefits from the patches here as well, because many matrix spaces are created during the iteration.",
    "created_at": "2011-07-18T21:29:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11589#issuecomment-118902",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:17" align="right">comment:17</div>

Note that the patch for Strassen-Winograd multiplication at #11610 benefits from the patches here as well, because many matrix spaces are created during the iteration.



---

archive/issue_events_155790.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-07-28T10:48:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11589",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11589#event-155790"
}
```



---

archive/issue_events_155791.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-07-28T10:48:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11589",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11589#event-155791"
}
```



---

archive/issue_comments_118903.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nPlease state which patches have to be applied...",
    "created_at": "2011-07-28T10:48:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11589#issuecomment-118903",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:18" align="right">comment:18</div>

Please state which patches have to be applied...



---

archive/issue_comments_118904.json:
```json
{
    "body": "Use the mecanisms from the preceding patches in Strassen multiplication",
    "created_at": "2011-07-28T11:19:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11589#issuecomment-118904",
    "user": "https://github.com/simon-king-jena"
}
```

Use the mecanisms from the preceding patches in Strassen multiplication



---

archive/issue_comments_118905.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nAttachment: **[trac_11589_apply_zero_creation_to_strassen.patch.gz](https://github.com/sagemath/sage/files/ticket11589/trac_11589_apply_zero_creation_to_strassen.patch.gz)**\n\nReplying to [@jdemeyer](#comment:18):\n> Please state which patches have to be applied...\n\nIf nothing is stated then, I thought, *all* patches are to be applied.\n\nI used the occasion to replace the third patch: A commit message was missing.",
    "created_at": "2011-07-28T11:21:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11589#issuecomment-118905",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:19" align="right">comment:19</div>

Attachment: **[trac_11589_apply_zero_creation_to_strassen.patch.gz](https://github.com/sagemath/sage/files/ticket11589/trac_11589_apply_zero_creation_to_strassen.patch.gz)**

Replying to [@jdemeyer](#comment:18):
> Please state which patches have to be applied...

If nothing is stated then, I thought, *all* patches are to be applied.

I used the occasion to replace the third patch: A commit message was missing.



---

archive/issue_events_155792.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2011-07-28T11:21:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11589",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11589#event-155792"
}
```



---

archive/issue_events_155793.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2011-07-28T11:21:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11589",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11589#event-155793"
}
```



---

archive/issue_events_155794.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2011-07-28T11:21:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11589",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11589#event-155794"
}
```



---

archive/issue_events_155795.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2011-07-28T11:21:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11589",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11589#event-155795"
}
```



---

archive/issue_comments_118906.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\n... and back to positive review.",
    "created_at": "2011-07-28T11:21:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11589#issuecomment-118906",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:20" align="right">comment:20</div>

... and back to positive review.



---

archive/issue_comments_118907.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,5 +4,6 @@\n * it eats up RAM (we create two instead of one matrix)\n \n See also the discussion on [sage-devel]:\n+http://groups.google.com/group/sage-devel/browse_thread/thread/478fb19ecb724be0\n \n-http://groups.google.com/group/sage-devel/browse_thread/thread/478fb19ecb724be0\n+Apply all three patches.\n``````\n",
    "created_at": "2011-07-28T16:51:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11589#issuecomment-118907",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,5 +4,6 @@
 * it eats up RAM (we create two instead of one matrix)
 
 See also the discussion on [sage-devel]:
+http://groups.google.com/group/sage-devel/browse_thread/thread/478fb19ecb724be0
 
-http://groups.google.com/group/sage-devel/browse_thread/thread/478fb19ecb724be0
+Apply all three patches.
``````




---

archive/issue_comments_118908.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@simon-king-jena](#comment:19):\n> If nothing is stated then, I thought, *all* patches are to be applied.\n\nFor safety, I prefer not to make any such assumptions.  In the few cases where it is unclear (like here), I prefer simply asking.",
    "created_at": "2011-07-28T16:51:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11589#issuecomment-118908",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@simon-king-jena](#comment:19):
> If nothing is stated then, I thought, *all* patches are to be applied.

For safety, I prefer not to make any such assumptions.  In the few cases where it is unclear (like here), I prefer simply asking.



---

archive/issue_events_155796.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-08-02T19:47:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11589",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11589#event-155796"
}
```



---

archive/issue_events_155797.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-08-02T19:47:01Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/11589",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11589#event-155797"
}
```



---

archive/issue_comments_118909.json:
```json
{
    "body": "Merged: **sage-4.7.2.alpha1**",
    "created_at": "2011-08-02T19:47:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11589#issuecomment-118909",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-4.7.2.alpha1**
