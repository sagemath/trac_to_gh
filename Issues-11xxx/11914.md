# Issue 11914: `sage -n` fails when current directory is $SAGE_ROOT/devel/sage

archive/issues_011742.json:
```json
{
    "assignees": [],
    "body": "Traceback as follows:\n\n```\nfs@zhenghe /opt/sage/devel/sage $ ../../sage -n\n----------------------------------------------------------------------\n| Sage Version 4.7.2.alpha3, Release Date: 2011-09-28                |\n| Type notebook() for the GUI, and license() for information.        |\n----------------------------------------------------------------------\n**********************************************************************\n*                                                                    *\n* Warning: this is a prerelease version, and it may be unstable.     *\n*                                                                    *\n**********************************************************************\n\nPlease wait while the Sage Notebook server starts...\nTraceback (most recent call last):\n  File \"/opt/sage/local/bin/sage-notebook\", line 9, in <module>\n    from sage.server.notebook.all import notebook\n  File \"/opt/sage-4.7.2.alpha3/devel/sage-main/sage/server/notebook/all.py\", line 22, in <module>\n    from sagenb.notebook.all import *\n  File \"/opt/sage/devel/sagenb/sagenb/notebook/all.py\", line 18, in <module>\n    from interact import interact, input_box, slider, range_slider, selector, checkbox, input_grid, text_control, color_selector\n  File \"/opt/sage/devel/sagenb/sagenb/notebook/interact.py\", line 158, in <module>\n    from sage.misc.cachefunc import cached_method\n  File \"/opt/sage-4.7.2.alpha3/devel/sage-main/sage/misc/cachefunc.py\", line 22, in <module>\n    from function_mangling import ArgumentFixer\nImportError: No module named function_mangling\nfs@zhenghe /opt/sage/devel/sage $ \n```\n\nppurka suggests prepending `$SAGE_ROOT/devel/sage/build/sage/` to `PYTHONPATH` in `sage-env`. This indeed works, but I'm not sure what else it might break. Advice?\n\n---\n\nRelated: #10192 (SageNB is broken if \"`.`\" is *explicitly* contained in `PYTHONPATH` **during installation** of it.)\n\n---\n\nApply [attachment: trac_11914-sage-env-pythonpath.patch](https://github.com/sagemath/sage/files/ticket11914/trac_11914-sage-env-pythonpath.patch.gz) to `$SAGE_ROOT/local/bin`\n\nCC:  @ppurka @nexttime\n\nComponent: **scripts**\n\nKeywords: **notebook SageNB startup, crash, sage-env PYTHONPATH**\n\nAuthor: **Leif Leonhardy**\n\nReviewer: **Keshav Kini, John Palmieri**\n\nMerged: **sage-4.8.alpha0**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/11914_\n\n",
    "closed_at": "2011-10-17T07:58:18Z",
    "created_at": "2011-10-11T11:44:03Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20scripts",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "`sage -n` fails when current directory is $SAGE_ROOT/devel/sage",
    "type": "issue",
    "updated_at": "2011-11-03T16:19:27Z",
    "url": "https://github.com/sagemath/sage/issues/11914",
    "user": "https://github.com/kini"
}
```
Traceback as follows:

```
fs@zhenghe /opt/sage/devel/sage $ ../../sage -n
----------------------------------------------------------------------
| Sage Version 4.7.2.alpha3, Release Date: 2011-09-28                |
| Type notebook() for the GUI, and license() for information.        |
----------------------------------------------------------------------
**********************************************************************
*                                                                    *
* Warning: this is a prerelease version, and it may be unstable.     *
*                                                                    *
**********************************************************************

Please wait while the Sage Notebook server starts...
Traceback (most recent call last):
  File "/opt/sage/local/bin/sage-notebook", line 9, in <module>
    from sage.server.notebook.all import notebook
  File "/opt/sage-4.7.2.alpha3/devel/sage-main/sage/server/notebook/all.py", line 22, in <module>
    from sagenb.notebook.all import *
  File "/opt/sage/devel/sagenb/sagenb/notebook/all.py", line 18, in <module>
    from interact import interact, input_box, slider, range_slider, selector, checkbox, input_grid, text_control, color_selector
  File "/opt/sage/devel/sagenb/sagenb/notebook/interact.py", line 158, in <module>
    from sage.misc.cachefunc import cached_method
  File "/opt/sage-4.7.2.alpha3/devel/sage-main/sage/misc/cachefunc.py", line 22, in <module>
    from function_mangling import ArgumentFixer
ImportError: No module named function_mangling
fs@zhenghe /opt/sage/devel/sage $ 
```

ppurka suggests prepending `$SAGE_ROOT/devel/sage/build/sage/` to `PYTHONPATH` in `sage-env`. This indeed works, but I'm not sure what else it might break. Advice?

---

Related: #10192 (SageNB is broken if "`.`" is *explicitly* contained in `PYTHONPATH` **during installation** of it.)

---

Apply [attachment: trac_11914-sage-env-pythonpath.patch](https://github.com/sagemath/sage/files/ticket11914/trac_11914-sage-env-pythonpath.patch.gz) to `$SAGE_ROOT/local/bin`

CC:  @ppurka @nexttime

Component: **scripts**

Keywords: **notebook SageNB startup, crash, sage-env PYTHONPATH**

Author: **Leif Leonhardy**

Reviewer: **Keshav Kini, John Palmieri**

Merged: **sage-4.8.alpha0**

_Issue created by migration from https://trac.sagemath.org/ticket/11914_





---

archive/issue_events_159154.json:
```json
{
    "actor": "https://github.com/kini",
    "created_at": "2011-10-11T11:44:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11914",
    "milestone_number": null,
    "milestone_title": "sage-4.7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11914#event-159154"
}
```



---

archive/issue_events_159155.json:
```json
{
    "actor": "https://github.com/kini",
    "created_at": "2011-10-11T11:44:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11914",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20scripts",
    "label_color": "0000b0",
    "label_name": "c: scripts",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11914#event-159155"
}
```



---

archive/issue_events_159156.json:
```json
{
    "actor": "https://github.com/kini",
    "created_at": "2011-10-11T11:44:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11914",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11914#event-159156"
}
```



---

archive/issue_events_159157.json:
```json
{
    "actor": "https://github.com/kini",
    "created_at": "2011-10-11T11:44:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11914",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11914#event-159157"
}
```



---

archive/issue_comments_125606.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nTo clarify, it seems that Python is trying to load the sage library from `$SAGE_ROOT/devel/sage/sage/` (which equals `./sage/` in this context) rather than from `$SAGE_ROOT/devel/sage/build/sage/`, thus ppurka's `PYTHONPATH` fix.",
    "created_at": "2011-10-11T11:50:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11914#issuecomment-125606",
    "user": "https://github.com/kini"
}
```

<div id="comment:2" align="right">comment:2</div>

To clarify, it seems that Python is trying to load the sage library from `$SAGE_ROOT/devel/sage/sage/` (which equals `./sage/` in this context) rather than from `$SAGE_ROOT/devel/sage/build/sage/`, thus ppurka's `PYTHONPATH` fix.



---

archive/issue_comments_125607.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nReplying to [@kini](#comment%3A2):\n> To clarify, it seems that Python is trying to load the sage library from `$SAGE_ROOT/devel/sage/sage/` (which equals `./sage/` in this context) rather than from `$SAGE_ROOT/devel/sage/build/sage/`, thus ppurka's `PYTHONPATH` fix.\n\nThe subdirectory `./sage` was my guess...",
    "created_at": "2011-10-11T13:44:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11914#issuecomment-125607",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:3" align="right">comment:3</div>

Replying to [@kini](#comment%3A2):
> To clarify, it seems that Python is trying to load the sage library from `$SAGE_ROOT/devel/sage/sage/` (which equals `./sage/` in this context) rather than from `$SAGE_ROOT/devel/sage/build/sage/`, thus ppurka's `PYTHONPATH` fix.

The subdirectory `./sage` was my guess...



---

archive/issue_comments_125608.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nReplying to [@nexttime](#comment%3A3):\n> Replying to [@kini](#comment%3A2):\n> > To clarify, it seems that Python is trying to load the sage library from `$SAGE_ROOT/devel/sage/sage/` (which equals `./sage/` in this context) rather than from `$SAGE_ROOT/devel/sage/build/sage/`, thus ppurka's `PYTHONPATH` fix.\n\n> \n> The subdirectory `./sage` was my guess...\n\n```sh\n$ cd $SAGE_ROOT\n$ (mkdir -p tmp/sage/sage && cd tmp/sage && ../../sage -n)\n```\n\nin contrast works for me.",
    "created_at": "2011-10-11T14:39:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11914#issuecomment-125608",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:4" align="right">comment:4</div>

Replying to [@nexttime](#comment%3A3):
> Replying to [@kini](#comment%3A2):
> > To clarify, it seems that Python is trying to load the sage library from `$SAGE_ROOT/devel/sage/sage/` (which equals `./sage/` in this context) rather than from `$SAGE_ROOT/devel/sage/build/sage/`, thus ppurka's `PYTHONPATH` fix.

> 
> The subdirectory `./sage` was my guess...

```sh
$ cd $SAGE_ROOT
$ (mkdir -p tmp/sage/sage && cd tmp/sage && ../../sage -n)
```

in contrast works for me.



---

archive/issue_comments_125609.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nReplying to [@nexttime](#comment%3A4):\n> ` #!sh $ cd $SAGE_ROOT $ (mkdir -p tmp/sage/sage && cd tmp/sage && ../../sage -n) ` in contrast works for me.\n\nBut the following doesn't work:\n\n```\ncd Installations/sage-4.7/tmp\nln -s ../devel/sage/sage .\n../sage -n\n```",
    "created_at": "2011-10-12T03:20:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11914#issuecomment-125609",
    "user": "https://github.com/ppurka"
}
```

<div id="comment:5" align="right">comment:5</div>

Replying to [@nexttime](#comment%3A4):
> ` #!sh $ cd $SAGE_ROOT $ (mkdir -p tmp/sage/sage && cd tmp/sage && ../../sage -n) ` in contrast works for me.

But the following doesn't work:

```
cd Installations/sage-4.7/tmp
ln -s ../devel/sage/sage .
../sage -n
```



---

archive/issue_comments_125610.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nIf I delete the file `SAGE_ROOT/devel/sage/sage/__init__.py` (and the corresponding .pyc file if present), then I don't see this problem.  Should that file be autogenerated (as `SAGE_ROOT/local/lib/python/site-packages/sage/__init__.py`, say by the `install` script in devel/sage) when necessary?  Or is that a bad, or a too complicated, idea?",
    "created_at": "2011-10-12T03:53:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11914#issuecomment-125610",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:6" align="right">comment:6</div>

If I delete the file `SAGE_ROOT/devel/sage/sage/__init__.py` (and the corresponding .pyc file if present), then I don't see this problem.  Should that file be autogenerated (as `SAGE_ROOT/local/lib/python/site-packages/sage/__init__.py`, say by the `install` script in devel/sage) when necessary?  Or is that a bad, or a too complicated, idea?



---

archive/issue_comments_125611.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nBut `$SAGE_ROOT/local/lib/python/site-packages/sage` is a symlink to `$SAGE_ROOT/local/lib/python/site-packages/../../../../devel/sage/build/sage`, which already contains an `__init__.py`. Or am I misunderstanding what you propose to do?",
    "created_at": "2011-10-12T04:01:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11914#issuecomment-125611",
    "user": "https://github.com/kini"
}
```

<div id="comment:7" align="right">comment:7</div>

But `$SAGE_ROOT/local/lib/python/site-packages/sage` is a symlink to `$SAGE_ROOT/local/lib/python/site-packages/../../../../devel/sage/build/sage`, which already contains an `__init__.py`. Or am I misunderstanding what you propose to do?



---

archive/issue_comments_125612.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nNever mind, I guess you mean we should remove `__init__.py` from `$SAGE_ROOT/devel/sage/sage`. I don't think this is a good idea, as it *is* part of the Sage library.",
    "created_at": "2011-10-12T04:02:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11914#issuecomment-125612",
    "user": "https://github.com/kini"
}
```

<div id="comment:8" align="right">comment:8</div>

Never mind, I guess you mean we should remove `__init__.py` from `$SAGE_ROOT/devel/sage/sage`. I don't think this is a good idea, as it *is* part of the Sage library.



---

archive/issue_comments_125613.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nOr perhaps this patch to the script sage-notebook:\n\n```diff\ndiff --git a/sage-notebook b/sage-notebook\n--- a/sage-notebook\n+++ b/sage-notebook\n@@ -2,6 +2,13 @@\n \n import os, sys, socket\n \n+CUR=os.path.abspath(os.curdir)\n+if os.path.samefile(CUR, os.path.join(os.environ['SAGE_ROOT'], 'devel', 'sage')):\n+    try:\n+        sys.path.remove(CUR)\n+    except ValueError:\n+        pass\n+\n print open(os.environ['SAGE_ROOT'] + '/local/bin/sage-banner').read()\n \n print \"Please wait while the Sage Notebook server starts...\"\n```\nThis looks safer than my first suggestion, although it could be a bit more refined: search sys.path not just for CUR, but for anything which is equivalent to CUR.",
    "created_at": "2011-10-12T04:04:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11914#issuecomment-125613",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:9" align="right">comment:9</div>

Or perhaps this patch to the script sage-notebook:

```diff
diff --git a/sage-notebook b/sage-notebook
--- a/sage-notebook
+++ b/sage-notebook
@@ -2,6 +2,13 @@
 
 import os, sys, socket
 
+CUR=os.path.abspath(os.curdir)
+if os.path.samefile(CUR, os.path.join(os.environ['SAGE_ROOT'], 'devel', 'sage')):
+    try:
+        sys.path.remove(CUR)
+    except ValueError:
+        pass
+
 print open(os.environ['SAGE_ROOT'] + '/local/bin/sage-banner').read()
 
 print "Please wait while the Sage Notebook server starts..."
```
This looks safer than my first suggestion, although it could be a bit more refined: search sys.path not just for CUR, but for anything which is equivalent to CUR.



---

archive/issue_comments_125614.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nThat raises the question of whether we want to fix this too:\n\n```\nfs@zhenghe ~ $ mkdir sage\nfs@zhenghe ~ $ touch sage/__init__.py\nfs@zhenghe ~ $ sage -n\n----------------------------------------------------------------------\n| Sage Version 4.7.2.alpha3, Release Date: 2011-09-28                |\n| Type notebook() for the GUI, and license() for information.        |\n----------------------------------------------------------------------\n**********************************************************************\n*                                                                    *\n* Warning: this is a prerelease version, and it may be unstable.     *\n*                                                                    *\n**********************************************************************\n\nPlease wait while the Sage Notebook server starts...\nTraceback (most recent call last):\n  File \"/opt/sage/local/bin/sage-notebook\", line 9, in <module>\n    from sage.server.notebook.all import notebook\nImportError: No module named server.notebook.all\n```",
    "created_at": "2011-10-12T04:12:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11914#issuecomment-125614",
    "user": "https://github.com/kini"
}
```

<div id="comment:10" align="right">comment:10</div>

That raises the question of whether we want to fix this too:

```
fs@zhenghe ~ $ mkdir sage
fs@zhenghe ~ $ touch sage/__init__.py
fs@zhenghe ~ $ sage -n
----------------------------------------------------------------------
| Sage Version 4.7.2.alpha3, Release Date: 2011-09-28                |
| Type notebook() for the GUI, and license() for information.        |
----------------------------------------------------------------------
**********************************************************************
*                                                                    *
* Warning: this is a prerelease version, and it may be unstable.     *
*                                                                    *
**********************************************************************

Please wait while the Sage Notebook server starts...
Traceback (most recent call last):
  File "/opt/sage/local/bin/sage-notebook", line 9, in <module>
    from sage.server.notebook.all import notebook
ImportError: No module named server.notebook.all
```



---

archive/issue_comments_125615.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nPffffffff...\n\nHow about this:\n\n```diff\ndiff --git a/sage-env b/sage-env\n--- a/sage-env\n+++ b/sage-env\n@@ -186,7 +186,12 @@\n fi\n \n if [ -d \"$SAGE_ROOT/local/lib/python\" ]; then\n-    PYTHONPATH=\"$SAGE_PATH:$SAGE_ROOT/local/lib/python\"   && export PYTHONPATH\n+    if [ -n \"$SAGE_PATH\" ]; then\n+        PYTHONPATH=\"$SAGE_PATH:$SAGE_ROOT/local/lib/python\"\n+    else\n+        PYTHONPATH=\"$SAGE_ROOT/local/lib/python\"\n+    fi\n+    export PYTHONPATH\n     PYTHONHOME=\"$SAGE_ROOT/local\" && export PYTHONHOME\n fi\n \n```\n\nWe could make it more nice of course.\n\nThis disturbed me for a while now...",
    "created_at": "2011-10-12T04:17:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11914#issuecomment-125615",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:11" align="right">comment:11</div>

Pffffffff...

How about this:

```diff
diff --git a/sage-env b/sage-env
--- a/sage-env
+++ b/sage-env
@@ -186,7 +186,12 @@
 fi
 
 if [ -d "$SAGE_ROOT/local/lib/python" ]; then
-    PYTHONPATH="$SAGE_PATH:$SAGE_ROOT/local/lib/python"   && export PYTHONPATH
+    if [ -n "$SAGE_PATH" ]; then
+        PYTHONPATH="$SAGE_PATH:$SAGE_ROOT/local/lib/python"
+    else
+        PYTHONPATH="$SAGE_ROOT/local/lib/python"
+    fi
+    export PYTHONPATH
     PYTHONHOME="$SAGE_ROOT/local" && export PYTHONHOME
 fi
 
```

We could make it more nice of course.

This disturbed me for a while now...



---

archive/issue_comments_125616.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@nexttime](#comment%3A11):\n> We could make it more nice of course.\n\nLike this for example:\n\n```diff\ndiff --git a/sage-env b/sage-env\n--- a/sage-env\n+++ b/sage-env\n@@ -186,8 +186,13 @@\n fi\n \n if [ -d \"$SAGE_ROOT/local/lib/python\" ]; then\n-    PYTHONPATH=\"$SAGE_PATH:$SAGE_ROOT/local/lib/python\"   && export PYTHONPATH\n-    PYTHONHOME=\"$SAGE_ROOT/local\" && export PYTHONHOME\n+    PYTHONPATH=\"$SAGE_ROOT/local/lib/python\"\n+    if [ -n \"$SAGE_PATH\" ]; then\n+        PYTHONPATH=\"$SAGE_PATH:$PYTHONPATH\"\n+    fi\n+    PYTHONHOME=\"$SAGE_ROOT/local\"\n+    export PYTHONPATH\n+    export PYTHONHOME\n fi\n \n if [ -z \"${SAGE_ORIG_LD_LIBRARY_PATH_SET}\" ]; then\n```",
    "created_at": "2011-10-12T04:23:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11914#issuecomment-125616",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@nexttime](#comment%3A11):
> We could make it more nice of course.

Like this for example:

```diff
diff --git a/sage-env b/sage-env
--- a/sage-env
+++ b/sage-env
@@ -186,8 +186,13 @@
 fi
 
 if [ -d "$SAGE_ROOT/local/lib/python" ]; then
-    PYTHONPATH="$SAGE_PATH:$SAGE_ROOT/local/lib/python"   && export PYTHONPATH
-    PYTHONHOME="$SAGE_ROOT/local" && export PYTHONHOME
+    PYTHONPATH="$SAGE_ROOT/local/lib/python"
+    if [ -n "$SAGE_PATH" ]; then
+        PYTHONPATH="$SAGE_PATH:$PYTHONPATH"
+    fi
+    PYTHONHOME="$SAGE_ROOT/local"
+    export PYTHONPATH
+    export PYTHONHOME
 fi
 
 if [ -z "${SAGE_ORIG_LD_LIBRARY_PATH_SET}" ]; then
```



---

archive/issue_comments_125617.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\n(I don't know what potentially weird shells might source `sage-env`, otherwise I'd use `export FOO=\"bar\"` or `export FOO BAR` etc.)",
    "created_at": "2011-10-12T04:26:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11914#issuecomment-125617",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:13" align="right">comment:13</div>

(I don't know what potentially weird shells might source `sage-env`, otherwise I'd use `export FOO="bar"` or `export FOO BAR` etc.)



---

archive/issue_comments_125618.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nWhat, seriously!? The cause of this is just the colon at the beginning of `PYTHONPATH`? Well then your solution is simple and obviously the correct way to fix this, it seems to me.",
    "created_at": "2011-10-12T04:28:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11914#issuecomment-125618",
    "user": "https://github.com/kini"
}
```

<div id="comment:14" align="right">comment:14</div>

What, seriously!? The cause of this is just the colon at the beginning of `PYTHONPATH`? Well then your solution is simple and obviously the correct way to fix this, it seems to me.



---

archive/issue_comments_125619.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@kini](#comment%3A14):\n> What, seriously!? The cause of this is just the colon at the beginning of `PYTHONPATH`? Well then your solution is simple and obviously the correct way to fix this, it seems to me.\n\nPython interprets the empty entry as the current working directory (\"`.`\").",
    "created_at": "2011-10-12T04:30:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11914#issuecomment-125619",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@kini](#comment%3A14):
> What, seriously!? The cause of this is just the colon at the beginning of `PYTHONPATH`? Well then your solution is simple and obviously the correct way to fix this, it seems to me.

Python interprets the empty entry as the current working directory ("`.`").



---

archive/issue_comments_125620.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@nexttime](#comment%3A13):\n> (I don't know what potentially weird shells might source `sage-env`, otherwise I'd use `export FOO=\"bar\"` or `export FOO BAR` etc.)\n\nIs sage-env even called from anywhere outside Sage scripts? It seems weird that all the sage scripts are called as `#!/usr/bin/env bash` but the scripts themselves are not written (most of the time) as bash scripts. It should probably be like the `$SAGE_ROOT/sage` script should be POSIX shell compatible and then the rest should be proper bash scripts, since they anyway invoke bash. It will make the scripts nicer and easier to read.\n\nThanks for the PYTHONPATH fix. Didn't know that empty paths resolve to current directory.",
    "created_at": "2011-10-12T05:33:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11914#issuecomment-125620",
    "user": "https://github.com/ppurka"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@nexttime](#comment%3A13):
> (I don't know what potentially weird shells might source `sage-env`, otherwise I'd use `export FOO="bar"` or `export FOO BAR` etc.)

Is sage-env even called from anywhere outside Sage scripts? It seems weird that all the sage scripts are called as `#!/usr/bin/env bash` but the scripts themselves are not written (most of the time) as bash scripts. It should probably be like the `$SAGE_ROOT/sage` script should be POSIX shell compatible and then the rest should be proper bash scripts, since they anyway invoke bash. It will make the scripts nicer and easier to read.

Thanks for the PYTHONPATH fix. Didn't know that empty paths resolve to current directory.



---

archive/issue_comments_125621.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nIf they are mostly written as POSIX-compatible, why not just go all the way and make them all call `sh` instead, and remove bashisms? But this is getting off topic, I think...\n\nI'll make an hg patch out of leif's diff.",
    "created_at": "2011-10-12T05:42:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11914#issuecomment-125621",
    "user": "https://github.com/kini"
}
```

<div id="comment:17" align="right">comment:17</div>

If they are mostly written as POSIX-compatible, why not just go all the way and make them all call `sh` instead, and remove bashisms? But this is getting off topic, I think...

I'll make an hg patch out of leif's diff.



---

archive/issue_comments_125622.json:
```json
{
    "body": "apply to $SAGE_ROOT/local/bin",
    "created_at": "2011-10-12T05:43:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11914#issuecomment-125622",
    "user": "https://github.com/kini"
}
```

apply to $SAGE_ROOT/local/bin



---

archive/issue_comments_125623.json:
```json
{
    "body": "Author: **Leif Leonhardy**",
    "created_at": "2011-10-12T05:45:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11914#issuecomment-125623",
    "user": "https://github.com/kini"
}
```

Author: **Leif Leonhardy**



---

archive/issue_comments_125624.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nAttachment: **[trac_11914-sage-env-pythonpath.patch.gz](https://github.com/sagemath/sage/files/ticket11914/trac_11914-sage-env-pythonpath.patch.gz)**",
    "created_at": "2011-10-12T05:45:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11914#issuecomment-125624",
    "user": "https://github.com/kini"
}
```

<div id="comment:18" align="right">comment:18</div>

Attachment: **[trac_11914-sage-env-pythonpath.patch.gz](https://github.com/sagemath/sage/files/ticket11914/trac_11914-sage-env-pythonpath.patch.gz)**



---

archive/issue_events_159158.json:
```json
{
    "actor": "https://github.com/kini",
    "created_at": "2011-10-12T05:45:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11914",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11914#event-159158"
}
```



---

archive/issue_comments_125625.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -29,3 +29,7 @@\n ```\n \n ppurka suggests prepending `$SAGE_ROOT/devel/sage/build/sage/` to `PYTHONPATH` in `sage-env`. This indeed works, but I'm not sure what else it might break. Advice?\n+\n+---\n+\n+Apply [attachment: trac_11914-sage-env-pythonpath.patch](https://github.com/sagemath/sage/files/ticket11914/trac_11914-sage-env-pythonpath.patch.gz) to `$SAGE_ROOT/local/bin`\n``````\n",
    "created_at": "2011-10-12T05:45:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11914#issuecomment-125625",
    "user": "https://github.com/kini"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -29,3 +29,7 @@
 ```
 
 ppurka suggests prepending `$SAGE_ROOT/devel/sage/build/sage/` to `PYTHONPATH` in `sage-env`. This indeed works, but I'm not sure what else it might break. Advice?
+
+---
+
+Apply [attachment: trac_11914-sage-env-pythonpath.patch](https://github.com/sagemath/sage/files/ticket11914/trac_11914-sage-env-pythonpath.patch.gz) to `$SAGE_ROOT/local/bin`
``````




---

archive/issue_comments_125626.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nI'll leave formal review to others who know shell scripting better than I, but it looks fine to me, fwiw.",
    "created_at": "2011-10-12T05:45:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11914#issuecomment-125626",
    "user": "https://github.com/kini"
}
```

<div id="comment:19" align="right">comment:19</div>

I'll leave formal review to others who know shell scripting better than I, but it looks fine to me, fwiw.



---

archive/issue_comments_125627.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@kini](#comment%3A17):\n> If they are mostly written as POSIX-compatible, why not just go all the way and make them all call `sh` instead, and remove bashisms? But this is getting off topic, I think...\n\nHmmm.  In principle we should avoid bashisms whenever possible.  (One of the very few exceptions would IMHO be `set -o pipefail`, which is supported by bashs >=3.0, but we still officially require just 2.04 since this version is shipped with MacOS X 10.4 [which is a mess to support anyway], <flame> and its users are incapable of installing a more recent version </flame>.)\n\nThe main reason we use `bash` is that we can to some extent rely on it being functional; there are too many broken Bourne shells, or at least `/bin/sh`ells.\n\n\n\n\n> I'll make an hg patch out of leif's diff.\n\nNice service, thanks.\n\nI just wonder how many parts of Sage (unconsciously exploiting it) break if we fix this bug.",
    "created_at": "2011-10-12T05:58:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11914#issuecomment-125627",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@kini](#comment%3A17):
> If they are mostly written as POSIX-compatible, why not just go all the way and make them all call `sh` instead, and remove bashisms? But this is getting off topic, I think...

Hmmm.  In principle we should avoid bashisms whenever possible.  (One of the very few exceptions would IMHO be `set -o pipefail`, which is supported by bashs >=3.0, but we still officially require just 2.04 since this version is shipped with MacOS X 10.4 [which is a mess to support anyway], <flame> and its users are incapable of installing a more recent version </flame>.)

The main reason we use `bash` is that we can to some extent rely on it being functional; there are too many broken Bourne shells, or at least `/bin/sh`ells.




> I'll make an hg patch out of leif's diff.

Nice service, thanks.

I just wonder how many parts of Sage (unconsciously exploiting it) break if we fix this bug.



---

archive/issue_comments_125628.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nWell, I'll run a doctest, though I doubt this will catch anything relevant...",
    "created_at": "2011-10-12T08:26:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11914#issuecomment-125628",
    "user": "https://github.com/kini"
}
```

<div id="comment:21" align="right">comment:21</div>

Well, I'll run a doctest, though I doubt this will catch anything relevant...



---

archive/issue_comments_125629.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nI don't think anything should break because the following two commands returned no output:\n\n```\n...lations/sage-4.7.2 [130] > LC_ALL=\"C\" grep -re 'from [^\\.]+[[:space:]]+import' *\n...allations/sage-4.7.2 [1] > LC_ALL=\"C\" grep -re '^[[:space:]]+import [^\\.]+' *\n...allations/sage-4.7.2 [1] > \n```",
    "created_at": "2011-10-12T08:51:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11914#issuecomment-125629",
    "user": "https://github.com/ppurka"
}
```

<div id="comment:22" align="right">comment:22</div>

I don't think anything should break because the following two commands returned no output:

```
...lations/sage-4.7.2 [130] > LC_ALL="C" grep -re 'from [^\.]+[[:space:]]+import' *
...allations/sage-4.7.2 [1] > LC_ALL="C" grep -re '^[[:space:]]+import [^\.]+' *
...allations/sage-4.7.2 [1] > 
```



---

archive/issue_comments_125630.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nNeglect above post. Really weird. It should have returned some output.",
    "created_at": "2011-10-12T08:55:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11914#issuecomment-125630",
    "user": "https://github.com/ppurka"
}
```

<div id="comment:23" align="right">comment:23</div>

Neglect above post. Really weird. It should have returned some output.



---

archive/issue_comments_125631.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nAll tests pass on `sage.math.washington.edu`, as expected.",
    "created_at": "2011-10-12T09:06:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11914#issuecomment-125631",
    "user": "https://github.com/kini"
}
```

<div id="comment:24" align="right">comment:24</div>

All tests pass on `sage.math.washington.edu`, as expected.



---

archive/issue_comments_125632.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nAdded a reference to #10192.",
    "created_at": "2011-10-13T11:10:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11914#issuecomment-125632",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:25" align="right">comment:25</div>

Added a reference to #10192.



---

archive/issue_comments_125633.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -32,4 +32,8 @@\n \n ---\n \n+Related: #10192 (SageNB is broken if \"`.`\" is *explicitly* contained in `PYTHONPATH` **during installation** of it.)\n+\n+---\n+\n Apply [attachment: trac_11914-sage-env-pythonpath.patch](https://github.com/sagemath/sage/files/ticket11914/trac_11914-sage-env-pythonpath.patch.gz) to `$SAGE_ROOT/local/bin`\n``````\n",
    "created_at": "2011-10-13T11:10:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11914#issuecomment-125633",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -32,4 +32,8 @@
 
 ---
 
+Related: #10192 (SageNB is broken if "`.`" is *explicitly* contained in `PYTHONPATH` **during installation** of it.)
+
+---
+
 Apply [attachment: trac_11914-sage-env-pythonpath.patch](https://github.com/sagemath/sage/files/ticket11914/trac_11914-sage-env-pythonpath.patch.gz) to `$SAGE_ROOT/local/bin`
``````




---

archive/issue_comments_125634.json:
```json
{
    "body": "Changed keywords from **startup, crash, sage-env** to **notebook SageNB startup, crash, sage-env PYTHONPATH**",
    "created_at": "2011-10-13T11:14:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11914#issuecomment-125634",
    "user": "https://github.com/nexttime"
}
```

Changed keywords from **startup, crash, sage-env** to **notebook SageNB startup, crash, sage-env PYTHONPATH**



---

archive/issue_events_159159.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2011-10-14T18:45:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11914",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11914#event-159159"
}
```



---

archive/issue_events_159160.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2011-10-14T18:45:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11914",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11914#event-159160"
}
```



---

archive/issue_comments_125635.json:
```json
{
    "body": "Reviewer: **Keshav Kini, John Palmieri**",
    "created_at": "2011-10-14T18:45:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11914#issuecomment-125635",
    "user": "https://github.com/jhpalmieri"
}
```

Reviewer: **Keshav Kini, John Palmieri**



---

archive/issue_events_159161.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-16T15:41:29Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11914",
    "milestone_number": null,
    "milestone_title": "sage-4.7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11914#event-159161"
}
```



---

archive/issue_events_159162.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-16T15:41:29Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11914",
    "milestone_number": null,
    "milestone_title": "sage-4.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11914#event-159162"
}
```



---

archive/issue_comments_125636.json:
```json
{
    "body": "Merged: **sage-4.7.3.alpha0**",
    "created_at": "2011-10-17T07:58:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11914#issuecomment-125636",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-4.7.3.alpha0**



---

archive/issue_events_159163.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-17T07:58:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11914",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11914#event-159163"
}
```



---

archive/issue_events_159164.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-17T07:58:18Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/11914",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11914#event-159164"
}
```



---

archive/issue_comments_125637.json:
```json
{
    "body": "Milestone sage-4.7.3 deleted",
    "created_at": "2011-11-03T16:14:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11914#issuecomment-125637",
    "user": "https://github.com/jdemeyer"
}
```

Milestone sage-4.7.3 deleted



---

archive/issue_events_159165.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-11-03T16:14:43Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11914",
    "milestone_number": null,
    "milestone_title": "sage-4.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11914#event-159165"
}
```



---

archive/issue_comments_125638.json:
```json
{
    "body": "Changed merged from **sage-4.7.3.alpha0** to **sage-4.8.alpha0**",
    "created_at": "2011-11-03T16:19:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11914#issuecomment-125638",
    "user": "https://github.com/jdemeyer"
}
```

Changed merged from **sage-4.7.3.alpha0** to **sage-4.8.alpha0**



---

archive/issue_events_159166.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-11-03T16:19:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11914",
    "milestone_number": null,
    "milestone_title": "sage-4.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11914#event-159166"
}
```
