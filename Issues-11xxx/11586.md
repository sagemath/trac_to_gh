# Issue 11586: bug in p-adic extension norm method

archive/issues_011414.json:
```json
{
    "body": "```\nR.<x> = QQ[]\nf = x^2 + 3*x + 1\nK = Qp(7)\nM.<a> = K.extension(f)\nM(7).norm()\n```\nThe above outputs `1 + O(7^20)`, which is completely wrong.  The norm should be `7^2 + O(7^20)`, I think -- anyways, it should be divisible by 7. \n\nThe problem is that the actual code for the norm, which ones sees by typing `a.norm??` assumes that the generator for M is in fact a generator for the maximal ideal of the ring of integers.  However, this assumption is just completely false. \n\nTyping `a.norm???` we see\n\n```\n...\n    norm_of_uniformizer = (-1)**self.parent().degree() * self.parent().defining_polynomial()[0]\n    if self.valuation() == 0:\n        return self.parent().ground_ring()(self.unit_part().matrix_mod_pn().det())\n    else:\n        return self.parent().ground_ring()(self.unit_part().matrix_mod_pn().det()) * norm_of_uniformizer**self.valuation()\n```    \n\nThe above is wrong as mentioned above.  Moreover, it is nonoptimal in that norm_of_uniformizer is computed but never used in the case when `self.valuation()==0`.\n\nThis bug caused some confusion when computing with p-adic L-series for a research paper...\n\n---\n\nApply [attachment:11586.patch] to the Sage library.\n\n\nAssignee: @roed314\n\nKeywords: padic\n\nReviewer: Jennifer Balakrishnan\n\nAuthor: David Roe\n\nMerged: sage-5.0.beta10\n\nDependencies: #8241\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/11586\n\n",
    "closed_at": "2012-03-23T15:19:21Z",
    "created_at": "2011-07-11T11:04:02Z",
    "labels": [
        "component: padics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.0",
    "title": "bug in p-adic extension norm method",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11586",
    "user": "https://github.com/williamstein"
}
```
```
R.<x> = QQ[]
f = x^2 + 3*x + 1
K = Qp(7)
M.<a> = K.extension(f)
M(7).norm()
```
The above outputs `1 + O(7^20)`, which is completely wrong.  The norm should be `7^2 + O(7^20)`, I think -- anyways, it should be divisible by 7. 

The problem is that the actual code for the norm, which ones sees by typing `a.norm??` assumes that the generator for M is in fact a generator for the maximal ideal of the ring of integers.  However, this assumption is just completely false. 

Typing `a.norm???` we see

```
...
    norm_of_uniformizer = (-1)**self.parent().degree() * self.parent().defining_polynomial()[0]
    if self.valuation() == 0:
        return self.parent().ground_ring()(self.unit_part().matrix_mod_pn().det())
    else:
        return self.parent().ground_ring()(self.unit_part().matrix_mod_pn().det()) * norm_of_uniformizer**self.valuation()
```    

The above is wrong as mentioned above.  Moreover, it is nonoptimal in that norm_of_uniformizer is computed but never used in the case when `self.valuation()==0`.

This bug caused some confusion when computing with p-adic L-series for a research paper...

---

Apply [attachment:11586.patch] to the Sage library.


Assignee: @roed314

Keywords: padic

Reviewer: Jennifer Balakrishnan

Author: David Roe

Merged: sage-5.0.beta10

Dependencies: #8241

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/11586





---

archive/issue_comments_155162.json:
```json
{
    "body": "Attachment [11586.patch](tarball://root/attachments/some-uuid/ticket11586/11586.patch) by @roed314 created at 2011-07-13 06:18:44",
    "created_at": "2011-07-13T06:18:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11586#issuecomment-155162",
    "user": "https://github.com/roed314"
}
```

Attachment [11586.patch](tarball://root/attachments/some-uuid/ticket11586/11586.patch) by @roed314 created at 2011-07-13 06:18:44



---

archive/issue_comments_155163.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-07-13T06:20:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11586#issuecomment-155163",
    "user": "https://github.com/roed314"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_155164.json:
```json
{
    "body": "Changing author from \"\" to \"David Roe\"",
    "created_at": "2011-07-13T06:20:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11586#issuecomment-155164",
    "user": "https://github.com/roed314"
}
```

Changing author from "" to "David Roe"



---

archive/issue_comments_155165.json:
```json
{
    "body": "Changing keywords from \"\" to \"padic\".",
    "created_at": "2011-07-13T06:20:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11586#issuecomment-155165",
    "user": "https://github.com/roed314"
}
```

Changing keywords from "" to "padic".



---

archive/issue_comments_155166.json:
```json
{
    "body": "Changing dependencies from \"\" to \"8241\"",
    "created_at": "2011-07-13T06:20:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11586#issuecomment-155166",
    "user": "https://github.com/roed314"
}
```

Changing dependencies from "" to "8241"



---

archive/issue_comments_155167.json:
```json
{
    "body": "<a id='comment:1'></a>Sorry about that.  The attached patch should fix the problem (note that you need to apply #8241 first).",
    "created_at": "2011-07-13T06:20:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11586#issuecomment-155167",
    "user": "https://github.com/roed314"
}
```

<a id='comment:1'></a>Sorry about that.  The attached patch should fix the problem (note that you need to apply #8241 first).



---

archive/issue_comments_155168.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-08-24T19:09:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11586#issuecomment-155168",
    "user": "https://github.com/jbalakrishnan"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_155169.json:
```json
{
    "body": "<a id='comment:2'></a>Great; this fixes the bug. All tests pass!",
    "created_at": "2011-08-24T19:09:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11586#issuecomment-155169",
    "user": "https://github.com/jbalakrishnan"
}
```

<a id='comment:2'></a>Great; this fixes the bug. All tests pass!



---

archive/issue_comments_155170.json:
```json
{
    "body": "Changing dependencies from \"8241\" to \"#8241\"",
    "created_at": "2011-08-24T22:01:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11586#issuecomment-155170",
    "user": "https://github.com/jdemeyer"
}
```

Changing dependencies from "8241" to "#8241"



---

archive/issue_comments_155171.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Jennifer Balakrishnan\"",
    "created_at": "2011-08-24T22:01:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11586#issuecomment-155171",
    "user": "https://github.com/jdemeyer"
}
```

Changing reviewer from "" to "Jennifer Balakrishnan"



---

archive/issue_comments_155172.json:
```json
{
    "body": "<a id='comment:4'></a>Make someone review #8241...",
    "created_at": "2011-09-08T14:37:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11586#issuecomment-155172",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:4'></a>Make someone review #8241...



---

archive/issue_comments_155173.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -24,6 +24,11 @@\n \n This bug caused some confusion when computing with p-adic L-series for a research paper...\n \n+---\n+\n+Apply [attachment:http://11586.patch] to the Sage library.\n+\n+\n Issue created by migration from https://trac.sagemath.org/ticket/11586\n \n \n``````\n",
    "created_at": "2011-09-08T14:37:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11586#issuecomment-155173",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -24,6 +24,11 @@
 
 This bug caused some confusion when computing with p-adic L-series for a research paper...
 
+---
+
+Apply [attachment:http://11586.patch] to the Sage library.
+
+
 Issue created by migration from https://trac.sagemath.org/ticket/11586
 
 
``````




---

archive/issue_comments_155174.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,32 @@\n+```\n+R.<x> = QQ[]\n+f = x^2 + 3*x + 1\n+K = Qp(7)\n+M.<a> = K.extension(f)\n+M(7).norm()\n+```\n+The above outputs `1 + O(7^20)`, which is completely wrong.  The norm should be `7^2 + O(7^20)`, I think -- anyways, it should be divisible by 7. \n+\n+The problem is that the actual code for the norm, which ones sees by typing `a.norm??` assumes that the generator for M is in fact a generator for the maximal ideal of the ring of integers.  However, this assumption is just completely false. \n+\n+Typing `a.norm???` we see\n+\n+```\n+...\n+    norm_of_uniformizer = (-1)**self.parent().degree() * self.parent().defining_polynomial()[0]\n+    if self.valuation() == 0:\n+        return self.parent().ground_ring()(self.unit_part().matrix_mod_pn().det())\n+    else:\n+        return self.parent().ground_ring()(self.unit_part().matrix_mod_pn().det()) * norm_of_uniformizer**self.valuation()\n+```    \n+\n+The above is wrong as mentioned above.  Moreover, it is nonoptimal in that norm_of_uniformizer is computed but never used in the case when `self.valuation()==0`.\n+\n+This bug caused some confusion when computing with p-adic L-series for a research paper...\n+\n+---\n+\n+Apply [attachment:11586.patch] to the Sage library.\n \n \n Issue created by migration from https://trac.sagemath.org/ticket/11586\n``````\n",
    "created_at": "2011-09-08T14:38:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11586#issuecomment-155174",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,32 @@
+```
+R.<x> = QQ[]
+f = x^2 + 3*x + 1
+K = Qp(7)
+M.<a> = K.extension(f)
+M(7).norm()
+```
+The above outputs `1 + O(7^20)`, which is completely wrong.  The norm should be `7^2 + O(7^20)`, I think -- anyways, it should be divisible by 7. 
+
+The problem is that the actual code for the norm, which ones sees by typing `a.norm??` assumes that the generator for M is in fact a generator for the maximal ideal of the ring of integers.  However, this assumption is just completely false. 
+
+Typing `a.norm???` we see
+
+```
+...
+    norm_of_uniformizer = (-1)**self.parent().degree() * self.parent().defining_polynomial()[0]
+    if self.valuation() == 0:
+        return self.parent().ground_ring()(self.unit_part().matrix_mod_pn().det())
+    else:
+        return self.parent().ground_ring()(self.unit_part().matrix_mod_pn().det()) * norm_of_uniformizer**self.valuation()
+```    
+
+The above is wrong as mentioned above.  Moreover, it is nonoptimal in that norm_of_uniformizer is computed but never used in the case when `self.valuation()==0`.
+
+This bug caused some confusion when computing with p-adic L-series for a research paper...
+
+---
+
+Apply [attachment:11586.patch] to the Sage library.
 
 
 Issue created by migration from https://trac.sagemath.org/ticket/11586
``````




---

archive/issue_events_030389.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2011-09-19T09:47:59Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11586",
    "milestone": "sage-pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11586#event-30389"
}
```



---

archive/issue_comments_155175.json:
```json
{
    "body": "<a id='comment:6'></a>Isn't this what we have a milestone \"sage-pending\" for?",
    "created_at": "2011-09-19T09:47:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11586#issuecomment-155175",
    "user": "https://github.com/loefflerd"
}
```

<a id='comment:6'></a>Isn't this what we have a milestone "sage-pending" for?



---

archive/issue_comments_155176.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:6 davidloeffler]:\n> Isn't this what we have a milestone \"sage-pending\" for?\n\n\nI personally don't use \"sage-pending\" for *that* situation, since my script does dependency checking, so won't attempt to merge it, but considers it for inclusion, i.e., I'll see that it has positive review, and all of its dependencies with their state.\n\nMy interpretation (or use) of \"sage-pending\" is to postpone tickets for *other* reasons, so I currently only see that they're postponed, and don't consider them further.\n\nI thought this was the original intent, to have some \"formal\" way to plan which tickets get merged when during management of a specific release, also since we don't have milestones for devel releases.",
    "created_at": "2011-09-19T14:10:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11586#issuecomment-155176",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:7'></a>Replying to [comment:6 davidloeffler]:
> Isn't this what we have a milestone "sage-pending" for?


I personally don't use "sage-pending" for *that* situation, since my script does dependency checking, so won't attempt to merge it, but considers it for inclusion, i.e., I'll see that it has positive review, and all of its dependencies with their state.

My interpretation (or use) of "sage-pending" is to postpone tickets for *other* reasons, so I currently only see that they're postponed, and don't consider them further.

I thought this was the original intent, to have some "formal" way to plan which tickets get merged when during management of a specific release, also since we don't have milestones for devel releases.



---

archive/issue_events_030390.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-21T14:15:51Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11586",
    "milestone": "sage-pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11586#event-30390"
}
```



---

archive/issue_events_030391.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-21T14:15:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11586",
    "milestone": "sage-5.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11586#event-30391"
}
```



---

archive/issue_comments_155177.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-03-23T15:19:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11586#issuecomment-155177",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_155178.json:
```json
{
    "body": "Changing merged from \"\" to \"sage-5.0.beta10\"",
    "created_at": "2012-03-23T15:19:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11586",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11586#issuecomment-155178",
    "user": "https://github.com/jdemeyer"
}
```

Changing merged from "" to "sage-5.0.beta10"



---

archive/issue_events_030392.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-23T15:19:21Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11586",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11586#event-30392"
}
```
