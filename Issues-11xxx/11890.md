# Issue 11890: Sage cannot factor polynomials over number fields with unfactorable discriminant

archive/issues_011718.json:
```json
{
    "body": "Let `K` be a number field with a discriminant which cannot be factored.  Let `f` be a polynomial in `K[x]`.  Then Sage is unable to factor `f` because it calls PARI's `nfinit()` on `K`:\n\n```\nsage: p = next_prime(10^50); q = next_prime(10^51)\nsage: K = QuadraticField(p*q)\nsage: x = polygen(K); factor(x^2+1)\n[... takes a very long time ...]\n```\n\nThe solution is to call `nfinit()` with the defining polynomial when the discriminant cannot be factored.  If that fails, fall back to `factornf()`.\n\nSee also #10910.\n\n**Apply** [attachment:11890_rebased.patch], [attachment:11890_try_nffactor.patch] and [attachment:11890_reviewer.patch].\n\nAssignee: @loefflerd\n\nKeywords: nffactor PARI nfinit pari_nf\n\nResolution: fixed\n\nDependencies: #11891, #11130\n\nAuthor: Jeroen Demeyer\n\nReviewer: Luis Felipe Tabera Alonso\n\nMerged: sage-4.8.alpha1\n\nIssue created by migration from https://trac.sagemath.org/ticket/11890\n\n",
    "closed_at": "2011-11-07T10:12:30Z",
    "created_at": "2011-10-03T08:40:43Z",
    "labels": [
        "component: number fields"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.8",
    "title": "Sage cannot factor polynomials over number fields with unfactorable discriminant",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11890",
    "user": "https://github.com/jdemeyer"
}
```
Let `K` be a number field with a discriminant which cannot be factored.  Let `f` be a polynomial in `K[x]`.  Then Sage is unable to factor `f` because it calls PARI's `nfinit()` on `K`:

```
sage: p = next_prime(10^50); q = next_prime(10^51)
sage: K = QuadraticField(p*q)
sage: x = polygen(K); factor(x^2+1)
[... takes a very long time ...]
```

The solution is to call `nfinit()` with the defining polynomial when the discriminant cannot be factored.  If that fails, fall back to `factornf()`.

See also #10910.

**Apply** [attachment:11890_rebased.patch], [attachment:11890_try_nffactor.patch] and [attachment:11890_reviewer.patch].

Assignee: @loefflerd

Keywords: nffactor PARI nfinit pari_nf

Resolution: fixed

Dependencies: #11891, #11130

Author: Jeroen Demeyer

Reviewer: Luis Felipe Tabera Alonso

Merged: sage-4.8.alpha1

Issue created by migration from https://trac.sagemath.org/ticket/11890





---

archive/issue_comments_162708.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,7 +4,10 @@\n sage: p = next_prime(10^50); q = next_prime(10^51)\n sage: K = QuadraticField(p*q)\n sage: x = polygen(K); factor(x^2+1)\n+[... takes a very long time ...]\n ```\n+\n+The solution is to avoid calling `nfinit()`.\n \n Comment: 1\n \n``````\n",
    "created_at": "2011-10-03T10:16:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11890#issuecomment-162708",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,7 +4,10 @@
 sage: p = next_prime(10^50); q = next_prime(10^51)
 sage: K = QuadraticField(p*q)
 sage: x = polygen(K); factor(x^2+1)
+[... takes a very long time ...]
 ```
+
+The solution is to avoid calling `nfinit()`.
 
 Comment: 1
 
``````




---

archive/issue_comments_162709.json:
```json
{
    "body": "Changing author from \"\" to \"Jeroen Demeyer\"",
    "created_at": "2011-10-04T15:42:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11890#issuecomment-162709",
    "user": "https://github.com/jdemeyer"
}
```

Changing author from "" to "Jeroen Demeyer"



---

archive/issue_comments_162710.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#11891\"",
    "created_at": "2011-10-04T15:42:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11890#issuecomment-162710",
    "user": "https://github.com/jdemeyer"
}
```

Changing dependencies from "" to "#11891"



---

archive/issue_comments_162711.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,13 @@\n+Let `K` be a number field with a discriminant which cannot be factored.  Let `f` be a polynomial in `K[x]`.  Then Sage is unable to factor `f` because it calls PARI's `nfinit()` on `K`:\n \n+```\n+sage: p = next_prime(10^50); q = next_prime(10^51)\n+sage: K = QuadraticField(p*q)\n+sage: x = polygen(K); factor(x^2+1)\n+[... takes a very long time ...]\n+```\n+\n+The solution is to avoid calling `nfinit()` and use `factornf()` instead when the discriminant cannot be factored.\n \n Comment: 1\n \n``````\n",
    "created_at": "2011-10-04T16:34:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11890#issuecomment-162711",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,13 @@
+Let `K` be a number field with a discriminant which cannot be factored.  Let `f` be a polynomial in `K[x]`.  Then Sage is unable to factor `f` because it calls PARI's `nfinit()` on `K`:
 
+```
+sage: p = next_prime(10^50); q = next_prime(10^51)
+sage: K = QuadraticField(p*q)
+sage: x = polygen(K); factor(x^2+1)
+[... takes a very long time ...]
+```
+
+The solution is to avoid calling `nfinit()` and use `factornf()` instead when the discriminant cannot be factored.
 
 Comment: 1
 
``````




---

archive/issue_comments_162712.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-10-04T16:34:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11890#issuecomment-162712",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_162713.json:
```json
{
    "body": "<a id='comment:3'></a>Attachment [11890.patch](tarball://root/attachments/some-uuid/ticket11890/11890.patch) by @jdemeyer created at 2011-10-04 16:34:36",
    "created_at": "2011-10-04T16:34:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11890#issuecomment-162713",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>Attachment [11890.patch](tarball://root/attachments/some-uuid/ticket11890/11890.patch) by @jdemeyer created at 2011-10-04 16:34:36



---

archive/issue_comments_162714.json:
```json
{
    "body": "Changing dependencies from \"#11891\" to \"#11891, #11130\"",
    "created_at": "2011-10-04T19:18:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11890#issuecomment-162714",
    "user": "https://github.com/jdemeyer"
}
```

Changing dependencies from "#11891" to "#11891, #11130"



---

archive/issue_comments_162715.json:
```json
{
    "body": "<a id='comment:5'></a>Jeroen,\n\nThis ticket is a duplicate of #10910\n\nIn that ticket I presented another approach. I still use nffactor but do not use nfinit UNLESS nfinit has already been computed and cached. A couple of comments regarding both approaches:\n\n- Now we do not need nfinit for nffactor. So we can use either nffactor or factornf at will.\n- In most cases nffactor will be faster than factornf (I should give numbers to sustain that though).\n- My patch also work for non-integral generators.\n- But my patch fails in your example with a PariError exception: precision too low.\n\nI have to investigate this error. It might be a Pari bug or there are instances where we really need factornf.",
    "created_at": "2011-10-05T13:44:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11890#issuecomment-162715",
    "user": "https://github.com/lftabera"
}
```

<a id='comment:5'></a>Jeroen,

This ticket is a duplicate of #10910

In that ticket I presented another approach. I still use nffactor but do not use nfinit UNLESS nfinit has already been computed and cached. A couple of comments regarding both approaches:

- Now we do not need nfinit for nffactor. So we can use either nffactor or factornf at will.
- In most cases nffactor will be faster than factornf (I should give numbers to sustain that though).
- My patch also work for non-integral generators.
- But my patch fails in your example with a PariError exception: precision too low.

I have to investigate this error. It might be a Pari bug or there are instances where we really need factornf.



---

archive/issue_comments_162716.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:5 lftabera]:\n>  - But my patch fails in your example with a PariError exception: precision too low.\n\n\nThis is exactly the reason why I am using `factornf` instead of `nffactor`: `nffactor` somehow computes a partial `nfinit` structure which does some floating-point stuff.  Apparently, the floating-point precision is not sufficient in the example.",
    "created_at": "2011-10-05T13:59:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11890#issuecomment-162716",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>Replying to [comment:5 lftabera]:
>  - But my patch fails in your example with a PariError exception: precision too low.


This is exactly the reason why I am using `factornf` instead of `nffactor`: `nffactor` somehow computes a partial `nfinit` structure which does some floating-point stuff.  Apparently, the floating-point precision is not sufficient in the example.



---

archive/issue_comments_162717.json:
```json
{
    "body": "<a id='comment:7'></a>Then, we need to be smarter. My experience tells that when nffactor is slower than factornf is for a small relative amount while the other way around is false.\n\nDoing a couple of examples suggest that the PariError appears quite soon.\n\n```\nsage: K=NumberField(x^20+ZZ[x].random_element(19,10**20),'a')[x]\nsage: f=K.random_element(50)\nsage: g=K.random_element(50)\nsage: F=f*g\n```\n\nIn the above exameple, with my patch, the PariError appears after 6 s. I have not yet computed the factorization of the polynomial with factornf but I claim that it will be quite hard to compute. Pari will use Trager's trick, that means that it will perform gcd's of polynomials in K. And Pari is not very good at it, cf. #8558\n\nWe need to figure out which method use, one option is the following:\n\n- If nfinit structure is already known, use (or try) nfffactor(nfinit,f)\n- If nfinit is not computed, try nffactor\n- If the above fails, use factornf.\n\nAnother alternative is to use one algorithm or the other depending on the discriminant of the field if that is the relevant data for the PariError.\n\nWe may even consider implementing our own Trager's ticket (but that should be in another ticket, after #8558 is merged).\n\nI am not yet sure what is the best way to proceed. I also feel that there should be a way for allowing the user to override the algorithm to use. But factor does not allow optional arguments and I do not want to mess the rest of univariate rings.",
    "created_at": "2011-10-05T15:45:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11890#issuecomment-162717",
    "user": "https://github.com/lftabera"
}
```

<a id='comment:7'></a>Then, we need to be smarter. My experience tells that when nffactor is slower than factornf is for a small relative amount while the other way around is false.

Doing a couple of examples suggest that the PariError appears quite soon.

```
sage: K=NumberField(x^20+ZZ[x].random_element(19,10**20),'a')[x]
sage: f=K.random_element(50)
sage: g=K.random_element(50)
sage: F=f*g
```

In the above exameple, with my patch, the PariError appears after 6 s. I have not yet computed the factorization of the polynomial with factornf but I claim that it will be quite hard to compute. Pari will use Trager's trick, that means that it will perform gcd's of polynomials in K. And Pari is not very good at it, cf. #8558

We need to figure out which method use, one option is the following:

- If nfinit structure is already known, use (or try) nfffactor(nfinit,f)
- If nfinit is not computed, try nffactor
- If the above fails, use factornf.

Another alternative is to use one algorithm or the other depending on the discriminant of the field if that is the relevant data for the PariError.

We may even consider implementing our own Trager's ticket (but that should be in another ticket, after #8558 is merged).

I am not yet sure what is the best way to proceed. I also feel that there should be a way for allowing the user to override the algorithm to use. But factor does not allow optional arguments and I do not want to mess the rest of univariate rings.



---

archive/issue_comments_162718.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:7 lftabera]:\n> We need to figure out which method use, one option is the following:\n> \n> - If nfinit structure is already known, use (or try) nfffactor(nfinit,f)\n> - If nfinit is not computed, try nffactor\n> - If the above fails, use factornf.\nAgreed.  Except that we really should do `nfinit()` if the discriminant is easy.\n\n> I am not yet sure what is the best way to proceed. I also feel that there should be a way for allowing the user to override the algorithm to use.\n\nWhy?  If one algorithm is clearly better than another, why complicate things with extra arguments?",
    "created_at": "2011-10-05T17:29:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11890#issuecomment-162718",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>Replying to [comment:7 lftabera]:
> We need to figure out which method use, one option is the following:
> 
> - If nfinit structure is already known, use (or try) nfffactor(nfinit,f)
> - If nfinit is not computed, try nffactor
> - If the above fails, use factornf.
Agreed.  Except that we really should do `nfinit()` if the discriminant is easy.

> I am not yet sure what is the best way to proceed. I also feel that there should be a way for allowing the user to override the algorithm to use.

Why?  If one algorithm is clearly better than another, why complicate things with extra arguments?



---

archive/issue_comments_162719.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-10-05T17:29:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11890#issuecomment-162719",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_162720.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,17 @@\n+Let `K` be a number field with a discriminant which cannot be factored.  Let `f` be a polynomial in `K[x]`.  Then Sage is unable to factor `f` because it calls PARI's `nfinit()` on `K`:\n \n+```\n+sage: p = next_prime(10^50); q = next_prime(10^51)\n+sage: K = QuadraticField(p*q)\n+sage: x = polygen(K); factor(x^2+1)\n+[... takes a very long time ...]\n+```\n+\n+The solution is to call `nfinit()` with the defining polynomial when the discriminant cannot be factored.  If that fails, fall back to `factornf()`.\n+\n+See also #10910.\n+\n+**Apply** [attachment:11890.patch] and [attachment:11890_try_nffactor.patch].\n \n Comment: 1\n \n``````\n",
    "created_at": "2011-10-05T18:44:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11890#issuecomment-162720",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,17 @@
+Let `K` be a number field with a discriminant which cannot be factored.  Let `f` be a polynomial in `K[x]`.  Then Sage is unable to factor `f` because it calls PARI's `nfinit()` on `K`:
 
+```
+sage: p = next_prime(10^50); q = next_prime(10^51)
+sage: K = QuadraticField(p*q)
+sage: x = polygen(K); factor(x^2+1)
+[... takes a very long time ...]
+```
+
+The solution is to call `nfinit()` with the defining polynomial when the discriminant cannot be factored.  If that fails, fall back to `factornf()`.
+
+See also #10910.
+
+**Apply** [attachment:11890.patch] and [attachment:11890_try_nffactor.patch].
 
 Comment: 1
 
``````




---

archive/issue_comments_162721.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-10-05T18:44:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11890#issuecomment-162721",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_162722.json:
```json
{
    "body": "Attachment [11890_reviewer.patch](tarball://root/attachments/some-uuid/ticket11890/11890_reviewer.patch) by @lftabera created at 2011-10-11 07:44:59",
    "created_at": "2011-10-11T07:44:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11890#issuecomment-162722",
    "user": "https://github.com/lftabera"
}
```

Attachment [11890_reviewer.patch](tarball://root/attachments/some-uuid/ticket11890/11890_reviewer.patch) by @lftabera created at 2011-10-11 07:44:59



---

archive/issue_comments_162723.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,17 @@\n+Let `K` be a number field with a discriminant which cannot be factored.  Let `f` be a polynomial in `K[x]`.  Then Sage is unable to factor `f` because it calls PARI's `nfinit()` on `K`:\n \n+```\n+sage: p = next_prime(10^50); q = next_prime(10^51)\n+sage: K = QuadraticField(p*q)\n+sage: x = polygen(K); factor(x^2+1)\n+[... takes a very long time ...]\n+```\n+\n+The solution is to call `nfinit()` with the defining polynomial when the discriminant cannot be factored.  If that fails, fall back to `factornf()`.\n+\n+See also #10910.\n+\n+**Apply** [attachment:11890.patch], [attachment:11890_try_nffactor.patch] and [attachment:11890_reviewer.patch].\n \n Comment: 1\n \n``````\n",
    "created_at": "2011-10-11T07:53:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11890#issuecomment-162723",
    "user": "https://github.com/lftabera"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,17 @@
+Let `K` be a number field with a discriminant which cannot be factored.  Let `f` be a polynomial in `K[x]`.  Then Sage is unable to factor `f` because it calls PARI's `nfinit()` on `K`:
 
+```
+sage: p = next_prime(10^50); q = next_prime(10^51)
+sage: K = QuadraticField(p*q)
+sage: x = polygen(K); factor(x^2+1)
+[... takes a very long time ...]
+```
+
+The solution is to call `nfinit()` with the defining polynomial when the discriminant cannot be factored.  If that fails, fall back to `factornf()`.
+
+See also #10910.
+
+**Apply** [attachment:11890.patch], [attachment:11890_try_nffactor.patch] and [attachment:11890_reviewer.patch].
 
 Comment: 1
 
``````




---

archive/issue_comments_162724.json:
```json
{
    "body": "<a id='comment:10'></a>The solution here to test the use of nffactor is more elegant than in #10910 and with these patches there are no known failing cases. All doctest pases on sage-4.7.2-alpha3 + #11130 + #11891\n\nI give a positive review to Jeroen's patches but I add a patch that needs review with a couple of things:\n\n-On a complicated case we show that the discriminant is not fully factored by trial division.\n\n-The second example is a test case that shows that we really need the new version of Pari in #11130 this case will fail with older versions of Pari (See Pari bug pari bug #1207)",
    "created_at": "2011-10-11T07:53:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11890#issuecomment-162724",
    "user": "https://github.com/lftabera"
}
```

<a id='comment:10'></a>The solution here to test the use of nffactor is more elegant than in #10910 and with these patches there are no known failing cases. All doctest pases on sage-4.7.2-alpha3 + #11130 + #11891

I give a positive review to Jeroen's patches but I add a patch that needs review with a couple of things:

-On a complicated case we show that the discriminant is not fully factored by trial division.

-The second example is a test case that shows that we really need the new version of Pari in #11130 this case will fail with older versions of Pari (See Pari bug pari bug #1207)



---

archive/issue_comments_162725.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Luis Felipe Tabera Alonso\"",
    "created_at": "2011-10-11T07:53:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11890#issuecomment-162725",
    "user": "https://github.com/lftabera"
}
```

Changing reviewer from "" to "Luis Felipe Tabera Alonso"



---

archive/issue_comments_162726.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-10-11T08:10:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11890#issuecomment-162726",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_162727.json:
```json
{
    "body": "<a id='comment:11'></a>Reviewer patch looks good to me.  Thanks!\n\nFor those interested: the PARI bug is [http://pari.math.u-bordeaux.fr/cgi-bin/bugreport.cgi?bug=1207](http://pari.math.u-bordeaux.fr/cgi-bin/bugreport.cgi?bug=1207)",
    "created_at": "2011-10-11T08:10:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11890#issuecomment-162727",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>Reviewer patch looks good to me.  Thanks!

For those interested: the PARI bug is [http://pari.math.u-bordeaux.fr/cgi-bin/bugreport.cgi?bug=1207](http://pari.math.u-bordeaux.fr/cgi-bin/bugreport.cgi?bug=1207)



---

archive/issue_events_031423.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-22T16:49:33Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11890",
    "milestone": "sage-pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11890#event-31423"
}
```



---

archive/issue_comments_162728.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,17 @@\n+Let `K` be a number field with a discriminant which cannot be factored.  Let `f` be a polynomial in `K[x]`.  Then Sage is unable to factor `f` because it calls PARI's `nfinit()` on `K`:\n \n+```\n+sage: p = next_prime(10^50); q = next_prime(10^51)\n+sage: K = QuadraticField(p*q)\n+sage: x = polygen(K); factor(x^2+1)\n+[... takes a very long time ...]\n+```\n+\n+The solution is to call `nfinit()` with the defining polynomial when the discriminant cannot be factored.  If that fails, fall back to `factornf()`.\n+\n+See also #10910.\n+\n+**Apply** [attachment:11890_rebased.patch], [attachment:11890_try_nffactor.patch] and [attachment:11890_reviewer.patch].\n \n Comment: 1\n \n``````\n",
    "created_at": "2011-10-30T20:25:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11890#issuecomment-162728",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,17 @@
+Let `K` be a number field with a discriminant which cannot be factored.  Let `f` be a polynomial in `K[x]`.  Then Sage is unable to factor `f` because it calls PARI's `nfinit()` on `K`:
 
+```
+sage: p = next_prime(10^50); q = next_prime(10^51)
+sage: K = QuadraticField(p*q)
+sage: x = polygen(K); factor(x^2+1)
+[... takes a very long time ...]
+```
+
+The solution is to call `nfinit()` with the defining polynomial when the discriminant cannot be factored.  If that fails, fall back to `factornf()`.
+
+See also #10910.
+
+**Apply** [attachment:11890_rebased.patch], [attachment:11890_try_nffactor.patch] and [attachment:11890_reviewer.patch].
 
 Comment: 1
 
``````




---

archive/issue_comments_162729.json:
```json
{
    "body": "<a id='comment:13'></a>Attachment [11890_rebased.patch](tarball://root/attachments/some-uuid/ticket11890/11890_rebased.patch) by @jdemeyer created at 2011-10-30 20:25:18\n\nTrivial rebase.",
    "created_at": "2011-10-30T20:25:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11890#issuecomment-162729",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>Attachment [11890_rebased.patch](tarball://root/attachments/some-uuid/ticket11890/11890_rebased.patch) by @jdemeyer created at 2011-10-30 20:25:18

Trivial rebase.



---

archive/issue_events_031424.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-11-03T09:10:18Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11890",
    "milestone": "sage-pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11890#event-31424"
}
```



---

archive/issue_comments_162730.json:
```json
{
    "body": "Milestone sage-4.7.3 deleted",
    "created_at": "2011-11-03T16:14:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11890#issuecomment-162730",
    "user": "https://github.com/jdemeyer"
}
```

Milestone sage-4.7.3 deleted



---

archive/issue_comments_162731.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-11-07T10:12:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11890#issuecomment-162731",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_031425.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-11-07T10:12:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11890",
    "milestone": "sage-4.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11890#event-31425"
}
```



---

archive/issue_events_031426.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-11-07T10:12:30Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11890",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11890#event-31426"
}
```



---

archive/issue_comments_162732.json:
```json
{
    "body": "Changing merged from \"\" to \"sage-4.8.alpha1\"",
    "created_at": "2011-11-07T10:12:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11890#issuecomment-162732",
    "user": "https://github.com/jdemeyer"
}
```

Changing merged from "" to "sage-4.8.alpha1"
