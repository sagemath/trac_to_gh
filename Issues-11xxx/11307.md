# Issue 11307: L rel. number field, E/L ell. curve, P in E(L), 'P in E.base_ring()' -> AttributeError

archive/issues_011135.json:
```json
{
    "body": "The following code gives an `AttributeError` where it should probably return False.\n\n```\nK = QuadraticField(2, 't')\nL = K.extension(x^2 + x + 1, 'u')\nE = EllipticCurve([1,0]).base_extend(L)\nE([0,0]) in E.base_ring()\n```\nThis gives the following output:\n\n```\nAttributeError                            Traceback (most recent call last)\n\n<ipython console> in <module>()\n\nsage-4.6/local/lib/python2.6/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__contains__ (sage/structure/parent.c:6635)()\n\nsage-4.6/local/lib/python2.6/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:6462)()\n\nsage-4.6/local/lib/python2.6/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3118)()\n\nsage-4.6/local/lib/python2.6/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3021)()\n\nsage-4.6/local/lib/python2.6/site-packages/sage/rings/number_field/number_field.pyc in _element_constructor_(self, x)\n   1106                 result += x[i]*self.gen(0)**i\n   1107             return result\n-> 1108         return self._coerce_non_number_field_element_in(x)\n   1109 \n   1110     def _coerce_from_str(self, x):\n\nsage-4.6/local/lib/python2.6/site-packages/sage/rings/number_field/number_field_rel.pyc in _coerce_non_number_field_element_in(self, x)\n    964             return self._element_class(self, f(self.gen()).polynomial() )\n    965         else:\n--> 966             return self._element_class(self, x._rational_())\n    967 \n    968     def _coerce_map_from_(self, R):\n\nsage-4.6/local/lib/python2.6/site-packages/sage/structure/element.so in sage.structure.element.Element.__getattr__ (sage/structure/element.c:2666)()\n\nsage-4.6/local/lib/python2.6/site-packages/sage/structure/parent.so in sage.structure.parent.getattr_from_other_class (sage/structure/parent.c:2840)()\n\nsage-4.6/local/lib/python2.6/site-packages/sage/structure/parent.so in sage.structure.parent.raise_attribute_error (sage/structure/parent.c:2638)()\n\nAttributeError: 'EllipticCurvePoint_number_field' object has no attribute '_rational_'\n```\nThe same code, but with base_extend(K) instead of base_extend(L), simply returns False, as expected.\n\nAssignee: @JohnCremona\n\nResolution: fixed\n\nAuthor: Francis Clarke\n\nReviewer: Marco Streng\n\nMerged: sage-4.7.1.alpha4\n\nIssue created by migration from https://trac.sagemath.org/ticket/11307\n\n",
    "closed_at": "2011-06-15T15:25:04Z",
    "created_at": "2011-05-06T13:49:05Z",
    "labels": [
        "component: number fields",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7.1",
    "title": "L rel. number field, E/L ell. curve, P in E(L), 'P in E.base_ring()' -> AttributeError",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11307",
    "user": "https://github.com/pjbruin"
}
```
The following code gives an `AttributeError` where it should probably return False.

```
K = QuadraticField(2, 't')
L = K.extension(x^2 + x + 1, 'u')
E = EllipticCurve([1,0]).base_extend(L)
E([0,0]) in E.base_ring()
```
This gives the following output:

```
AttributeError                            Traceback (most recent call last)

<ipython console> in <module>()

sage-4.6/local/lib/python2.6/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__contains__ (sage/structure/parent.c:6635)()

sage-4.6/local/lib/python2.6/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:6462)()

sage-4.6/local/lib/python2.6/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3118)()

sage-4.6/local/lib/python2.6/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3021)()

sage-4.6/local/lib/python2.6/site-packages/sage/rings/number_field/number_field.pyc in _element_constructor_(self, x)
   1106                 result += x[i]*self.gen(0)**i
   1107             return result
-> 1108         return self._coerce_non_number_field_element_in(x)
   1109 
   1110     def _coerce_from_str(self, x):

sage-4.6/local/lib/python2.6/site-packages/sage/rings/number_field/number_field_rel.pyc in _coerce_non_number_field_element_in(self, x)
    964             return self._element_class(self, f(self.gen()).polynomial() )
    965         else:
--> 966             return self._element_class(self, x._rational_())
    967 
    968     def _coerce_map_from_(self, R):

sage-4.6/local/lib/python2.6/site-packages/sage/structure/element.so in sage.structure.element.Element.__getattr__ (sage/structure/element.c:2666)()

sage-4.6/local/lib/python2.6/site-packages/sage/structure/parent.so in sage.structure.parent.getattr_from_other_class (sage/structure/parent.c:2840)()

sage-4.6/local/lib/python2.6/site-packages/sage/structure/parent.so in sage.structure.parent.raise_attribute_error (sage/structure/parent.c:2638)()

AttributeError: 'EllipticCurvePoint_number_field' object has no attribute '_rational_'
```
The same code, but with base_extend(K) instead of base_extend(L), simply returns False, as expected.

Assignee: @JohnCremona

Resolution: fixed

Author: Francis Clarke

Reviewer: Marco Streng

Merged: sage-4.7.1.alpha4

Issue created by migration from https://trac.sagemath.org/ticket/11307





---

archive/issue_comments_128130.json:
```json
{
    "body": "<a id='comment:1'></a>This is nothing specifically to do with elliptic curves.  For example\n\n```\nsage: K.<t> = QuadraticField(2)\nsage: L.<u> = K.extension(x^2 + x + 1)\nsage: K in K\nFalse\nsage: K in L\nTraceback (most recent call last):\n...\nAttributeError: 'NumberField_quadratic_with_category' object has no attribute '_rational_'\n```\nThe difference is that while for an absolute number field `K` a `TypeError` is raised by `K(z)` for an object `z` which cannot be converted into an element of `K`, an `AttributeError` is raised by `L(z)`.  However `sage.structure.parent.Parent.__contains__` filters out (returning `False`) only `TypeError` and `ValueError`.",
    "created_at": "2011-05-07T08:53:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11307#issuecomment-128130",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

<a id='comment:1'></a>This is nothing specifically to do with elliptic curves.  For example

```
sage: K.<t> = QuadraticField(2)
sage: L.<u> = K.extension(x^2 + x + 1)
sage: K in K
False
sage: K in L
Traceback (most recent call last):
...
AttributeError: 'NumberField_quadratic_with_category' object has no attribute '_rational_'
```
The difference is that while for an absolute number field `K` a `TypeError` is raised by `K(z)` for an object `z` which cannot be converted into an element of `K`, an `AttributeError` is raised by `L(z)`.  However `sage.structure.parent.Parent.__contains__` filters out (returning `False`) only `TypeError` and `ValueError`.



---

archive/issue_comments_128131.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-The following code gives an AttributeError where it should probably return False.\n+The following code gives an \\`AttributeError\\` where it should probably return False.\n \n \\`\\`\\`\n K = QuadraticField(2, 't')\n@@ -6,7 +6,6 @@\n E = EllipticCurve([1,0]).base_extend(L)\n E([0,0]) in E.base_ring()\n \\`\\`\\`\n-\n This gives the following output:\n \n \\`\\`\\`\n@@ -44,7 +43,6 @@\n \n AttributeError: 'EllipticCurvePoint_number_field' object has no attribute '_rational_'\n \\`\\`\\`\n-\n The same code, but with base_extend(K) instead of base_extend(L), simply returns False, as expected.\n \n Comment: 1\n```\n",
    "created_at": "2011-05-07T08:53:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11307#issuecomment-128131",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,4 @@
-The following code gives an AttributeError where it should probably return False.
+The following code gives an \`AttributeError\` where it should probably return False.
 
 \`\`\`
 K = QuadraticField(2, 't')
@@ -6,7 +6,6 @@
 E = EllipticCurve([1,0]).base_extend(L)
 E([0,0]) in E.base_ring()
 \`\`\`
-
 This gives the following output:
 
 \`\`\`
@@ -44,7 +43,6 @@
 
 AttributeError: 'EllipticCurvePoint_number_field' object has no attribute '_rational_'
 \`\`\`
-
 The same code, but with base_extend(K) instead of base_extend(L), simply returns False, as expected.
 
 Comment: 1
```




---

archive/issue_comments_128132.json:
```json
{
    "body": "Attachment [trac_11307_number_field_coercion.patch](tarball://root/attachments/some-uuid/ticket11307/trac_11307_number_field_coercion.patch) by fwclarke created at 2011-05-07 09:26:50",
    "created_at": "2011-05-07T09:26:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11307#issuecomment-128132",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

Attachment [trac_11307_number_field_coercion.patch](tarball://root/attachments/some-uuid/ticket11307/trac_11307_number_field_coercion.patch) by fwclarke created at 2011-05-07 09:26:50



---

archive/issue_comments_128133.json:
```json
{
    "body": "<a id='comment:2'></a>The attached patch fixes the problem by making the relative version of `_coerce_non_number_field_element_in` behave more like the one for absolute number fields when it is faced with an element that it cannot understand.",
    "created_at": "2011-05-07T09:32:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11307#issuecomment-128133",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

<a id='comment:2'></a>The attached patch fixes the problem by making the relative version of `_coerce_non_number_field_element_in` behave more like the one for absolute number fields when it is faced with an element that it cannot understand.



---

archive/issue_comments_128134.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-05-07T09:32:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11307#issuecomment-128134",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_128135.json:
```json
{
    "body": "Changing component from elliptic curves to number fields.",
    "created_at": "2011-05-07T09:32:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11307#issuecomment-128135",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

Changing component from elliptic curves to number fields.



---

archive/issue_comments_128136.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-06-09T10:25:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11307#issuecomment-128136",
    "user": "https://github.com/mstreng"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_029289.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-06-15T15:25:04Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11307",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11307#event-29289"
}
```



---

archive/issue_comments_128137.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-06-15T15:25:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11307#issuecomment-128137",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
