# Issue 11666: Upgrade MPFR to 3.1.0

archive/issues_011494.json:
```json
{
    "assignees": [
        "https://github.com/nexttime"
    ],
    "body": "Our current MPFR spkg is fairly old (based on **MPFR 2.4.2**), and upgrading it to the latest [stable] upstream release is now on the [high-priority wishlist](http://wiki.sagemath.org/days32/wishlist).\n\nUse\u00a0http://perso.telecom-paristech.fr/~flori/sage/mpfr-3.1.0.p0.spkg\n\nApply:\n\n* [attachment: trac_11666_remove_random_hack.patch](https://github.com/sagemath/sage/files/ticket11666/trac_11666_remove_random_hack.patch.gz)\n* [attachment: trac_11666_reduce_precision_max.patch](https://github.com/sagemath/sage/files/ticket11666/trac_11666_reduce_precision_max.patch.gz)\n* [attachment: trac_11666_fix_random_doctests.patch](https://github.com/sagemath/sage/files/ticket11666/trac_11666_fix_random_doctests.patch.gz)\n\nDepends on #12171\nDepends on #12548\n\nCC:  @jpflori @zimmermann6\n\nKeywords: **sd36 sd32 MPFR spkg wishlist sd35.5**\n\nComponent: **packages: standard**\n\nAuthor: **Mike Hansen, Jean-Pierre Flori, Volker Braun**\n\nReviewer: **Paul Zimmermann, Jean-Pierre Flori, Volker Braun, Jeroen Demeyer**\n\nUpstream: **Fixed upstream, but not in a stable release.**\n\nMerged: **sage-5.0.beta7**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/11666_\n\n",
    "closed_at": "2012-03-04T21:19:40Z",
    "created_at": "2011-08-08T17:37:32Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Upgrade MPFR to 3.1.0",
    "type": "issue",
    "updated_at": "2012-03-04T21:19:40Z",
    "url": "https://github.com/sagemath/sage/issues/11666",
    "user": "https://github.com/nexttime"
}
```
Our current MPFR spkg is fairly old (based on **MPFR 2.4.2**), and upgrading it to the latest [stable] upstream release is now on the [high-priority wishlist](http://wiki.sagemath.org/days32/wishlist).

UseÂ http://perso.telecom-paristech.fr/~flori/sage/mpfr-3.1.0.p0.spkg

Apply:

* [attachment: trac_11666_remove_random_hack.patch](https://github.com/sagemath/sage/files/ticket11666/trac_11666_remove_random_hack.patch.gz)
* [attachment: trac_11666_reduce_precision_max.patch](https://github.com/sagemath/sage/files/ticket11666/trac_11666_reduce_precision_max.patch.gz)
* [attachment: trac_11666_fix_random_doctests.patch](https://github.com/sagemath/sage/files/ticket11666/trac_11666_fix_random_doctests.patch.gz)

Depends on #12171
Depends on #12548

CC:  @jpflori @zimmermann6

Keywords: **sd36 sd32 MPFR spkg wishlist sd35.5**

Component: **packages: standard**

Author: **Mike Hansen, Jean-Pierre Flori, Volker Braun**

Reviewer: **Paul Zimmermann, Jean-Pierre Flori, Volker Braun, Jeroen Demeyer**

Upstream: **Fixed upstream, but not in a stable release.**

Merged: **sage-5.0.beta7**

_Issue created by migration from https://trac.sagemath.org/ticket/11666_





---

archive/issue_events_154805.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-08-08T17:37:32Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "milestone_number": null,
    "milestone_title": "sage-5.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11666#event-154805"
}
```



---

archive/issue_events_154806.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-08-08T17:37:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
    "label_color": "0000b0",
    "label_name": "c: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11666#event-154806"
}
```



---

archive/issue_events_154807.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-08-08T17:37:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11666#event-154807"
}
```



---

archive/issue_events_154808.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-08-08T17:37:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11666#event-154808"
}
```



---

archive/issue_comments_120204.json:
```json
{
    "body": "Changed keywords from **MPFR spkg wishlist** to **sd32 MPFR spkg wishlist**",
    "created_at": "2011-08-24T23:36:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120204",
    "user": "https://github.com/williamstein"
}
```

Changed keywords from **MPFR spkg wishlist** to **sd32 MPFR spkg wishlist**



---

archive/issue_events_154809.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-09-18T01:47:31Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "subject": "https://github.com/nexttime",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11666#event-154809"
}
```



---

archive/issue_events_154810.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-09-18T01:47:31Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "title_is": "Upgrade MPFR to 3.0.1 + upstream patches or later (3.1.0)",
    "title_was": "Upgrade MPFR to 3.0.1 + upstream patches",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11666#event-154810"
}
```



---

archive/issue_comments_120205.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,8 +1,38 @@\n-Our current MPFR spkg is fairly old (based on MPFR 2.4.2), and upgrading it to the latest [stable] upstream release is now on the [\"high-priority wishlist\"](http://wiki.sagemath.org/days32/wishlist).\n+Our current MPFR spkg is fairly old (based on **MPFR 2.4.2**), and upgrading it to the latest [stable] upstream release is now on the [\"high-priority wishlist\"](http://wiki.sagemath.org/days32/wishlist).\n \n `spkg-install` also needs a major rewrite, e.g. to make use of (some of) GMP's / MPIR's build flags.\n \n-I think I'll provide a new spkg in the next days (weekend, say).\n+*\"I think I'll provide a new spkg in the next days (next weekend, say).\"* [This unfortunately became a moving target; still on my high priority list though...]\n \n-MPFR 3.0.1 was released on April 4th 2011; there are already some [additional upstream patches](http://www.mpfr.org/mpfr-current/allpatches) for that version; see http://www.mpfr.org/mpfr-current/ .\n+---\n \n+**MPFR 3.0.1** was released on April 4th 2011; there are already some [additional upstream patches](http://www.mpfr.org/mpfr-current/allpatches) for that version; see [http://www.mpfr.org/mpfr-current/](http://www.mpfr.org/mpfr-current/).\n+\n+---\n+\n+Yet **MPFR 3.1.0** is on the way, planned to be released September 30th (unless problems should occur).\n+\n+ == Changes from versions 3.0.* to version 3.1.0: ==\n+\n+- The MPFR source has been reorganized.\n+- Dropped `ansi2knr` support.\n+- TLS support is now detected automatically. If TLS is supported, MPFR is built as thread safe by default. To disable TLS explicitly, configure MPFR with `--disable-thread-safe`.\n+- New `--enable-gmp-internals` `configure` option to use GMP's undocumented functions (not from the public API). Note that library versioning is not guaranteed to work if this option is used.\n+- The `mpfr_urandom()` and `mpfr_urandomb()` functions now return identical values on processors with different word size (assuming the same random seed, and since the GMP random generator does not depend itself on the word size, cf. [http://gmplib.org/list-archives/gmp-devel/2010-September/001642.html](http://gmplib.org/list-archives/gmp-devel/2010-September/001642.html)).\n+- The `mpfr_add_one_ulp()` and `mpfr_sub_one_ulp()` macros (which are obsolete and no more documented) will be removed in a future release.\n+- Speed improvement for the `mpfr_sqr()` and `mpfr_div()` functions using Mulders' algorithm. As a consequence, other functions using those routines are also faster.\n+- Much faster formatted output (`mpfr_printf()`, etc.) with `%Rg` and similar.\n+- The `--with-gmp-build` `configure` option can now be used when the GMP source directory and the GMP build directory are different (without having to copy header files manually as before).\n+- New functions `mpfr_buildopt_tune_case()`, `mpfr_frexp()`, `mpfr_grandom()` and `mpfr_z_sub()`.\n+- New division-by-zero exception (flag) and associated functions.\n+- The `mpfr.h` header can be included several times, while still supporting optional functions (see Section \"Headers and Libraries\" in the manual).\n+- Updated tuning parameters.\n+- Improved MPFR manual.\n+- MPFR tests: `libtool` no longer generates wrapper scripts with `make check` (so that running the tests under `valgrind` or `gdb` is easier).\n+- Bug fixes.\n+\n+   Note: The `mpfr_subnormalize()` implementation up to MPFR 3.0.0 did not change the flags. In particular, it did not follow the generic rule concerning the inexact flag (and no special behavior was specified). The case of the underflow flag was more a lack of specification.\n+\n+\n+Tarballs of the current **release candidate** (rc1) are available in various formats (regarding the compression method); a bzipped one can be found [here](http://boxen.math.washington.edu/home/leif/Sage/spkgs/upstream/mpfr-3.1.0-rc1.tar.bz2) (`sage.math`) or [here](http://www.mpfr.org/mpfr-3.1.0/mpfr-3.1.0-rc1.tar.bz2) (upstream).\n+\n``````\n",
    "created_at": "2011-09-18T01:47:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120205",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,8 +1,38 @@
-Our current MPFR spkg is fairly old (based on MPFR 2.4.2), and upgrading it to the latest [stable] upstream release is now on the ["high-priority wishlist"](http://wiki.sagemath.org/days32/wishlist).
+Our current MPFR spkg is fairly old (based on **MPFR 2.4.2**), and upgrading it to the latest [stable] upstream release is now on the ["high-priority wishlist"](http://wiki.sagemath.org/days32/wishlist).
 
 `spkg-install` also needs a major rewrite, e.g. to make use of (some of) GMP's / MPIR's build flags.
 
-I think I'll provide a new spkg in the next days (weekend, say).
+*"I think I'll provide a new spkg in the next days (next weekend, say)."* [This unfortunately became a moving target; still on my high priority list though...]
 
-MPFR 3.0.1 was released on April 4th 2011; there are already some [additional upstream patches](http://www.mpfr.org/mpfr-current/allpatches) for that version; see http://www.mpfr.org/mpfr-current/ .
+---
 
+**MPFR 3.0.1** was released on April 4th 2011; there are already some [additional upstream patches](http://www.mpfr.org/mpfr-current/allpatches) for that version; see [http://www.mpfr.org/mpfr-current/](http://www.mpfr.org/mpfr-current/).
+
+---
+
+Yet **MPFR 3.1.0** is on the way, planned to be released September 30th (unless problems should occur).
+
+ == Changes from versions 3.0.* to version 3.1.0: ==
+
+- The MPFR source has been reorganized.
+- Dropped `ansi2knr` support.
+- TLS support is now detected automatically. If TLS is supported, MPFR is built as thread safe by default. To disable TLS explicitly, configure MPFR with `--disable-thread-safe`.
+- New `--enable-gmp-internals` `configure` option to use GMP's undocumented functions (not from the public API). Note that library versioning is not guaranteed to work if this option is used.
+- The `mpfr_urandom()` and `mpfr_urandomb()` functions now return identical values on processors with different word size (assuming the same random seed, and since the GMP random generator does not depend itself on the word size, cf. [http://gmplib.org/list-archives/gmp-devel/2010-September/001642.html](http://gmplib.org/list-archives/gmp-devel/2010-September/001642.html)).
+- The `mpfr_add_one_ulp()` and `mpfr_sub_one_ulp()` macros (which are obsolete and no more documented) will be removed in a future release.
+- Speed improvement for the `mpfr_sqr()` and `mpfr_div()` functions using Mulders' algorithm. As a consequence, other functions using those routines are also faster.
+- Much faster formatted output (`mpfr_printf()`, etc.) with `%Rg` and similar.
+- The `--with-gmp-build` `configure` option can now be used when the GMP source directory and the GMP build directory are different (without having to copy header files manually as before).
+- New functions `mpfr_buildopt_tune_case()`, `mpfr_frexp()`, `mpfr_grandom()` and `mpfr_z_sub()`.
+- New division-by-zero exception (flag) and associated functions.
+- The `mpfr.h` header can be included several times, while still supporting optional functions (see Section "Headers and Libraries" in the manual).
+- Updated tuning parameters.
+- Improved MPFR manual.
+- MPFR tests: `libtool` no longer generates wrapper scripts with `make check` (so that running the tests under `valgrind` or `gdb` is easier).
+- Bug fixes.
+
+   Note: The `mpfr_subnormalize()` implementation up to MPFR 3.0.0 did not change the flags. In particular, it did not follow the generic rule concerning the inexact flag (and no special behavior was specified). The case of the underflow flag was more a lack of specification.
+
+
+Tarballs of the current **release candidate** (rc1) are available in various formats (regarding the compression method); a bzipped one can be found [here](http://boxen.math.washington.edu/home/leif/Sage/spkgs/upstream/mpfr-3.1.0-rc1.tar.bz2) (`sage.math`) or [here](http://www.mpfr.org/mpfr-3.1.0/mpfr-3.1.0-rc1.tar.bz2) (upstream).
+
``````




---

archive/issue_comments_120206.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nThe second release candidate is out:\n\n [...] The main changes since this first release candidate are:\n \n- Fixed `--enable-gmp-internals`.\n- Handle the special cases in `mpfr_cmp_q()` and `mpfr_cmp_f()` (fixing the problem with the `erange` flag in particular).\n- Added `mpfr_buildopt_gmpinternals_p()` function.\n- MPFR manual update and minor corrections.\n\n Here's a second release candidate. As there should not be new platform-specific problems, the final release is delayed by a few days only.\n\n [...] \n\n http://www.mpfr.org/mpfr-3.1.0/mpfr-3.1.0-rc2.tar.bz2 \n\n [...] \n\n\n The MD5's: \n\n [...] \n\n `6ba48c87687959d5e68cd695686257f4  mpfr-3.1.0-rc2.tar.bz2` \n\n [...] \n\n\n [...]\n\n\nFinal release now scheduled for October 3rd.",
    "created_at": "2011-09-22T17:07:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120206",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:4" align="right">comment:4</div>

The second release candidate is out:

 [...] The main changes since this first release candidate are:
 
- Fixed `--enable-gmp-internals`.
- Handle the special cases in `mpfr_cmp_q()` and `mpfr_cmp_f()` (fixing the problem with the `erange` flag in particular).
- Added `mpfr_buildopt_gmpinternals_p()` function.
- MPFR manual update and minor corrections.

 Here's a second release candidate. As there should not be new platform-specific problems, the final release is delayed by a few days only.

 [...] 

 http://www.mpfr.org/mpfr-3.1.0/mpfr-3.1.0-rc2.tar.bz2 

 [...] 


 The MD5's: 

 [...] 

 `6ba48c87687959d5e68cd695686257f4  mpfr-3.1.0-rc2.tar.bz2` 

 [...] 


 [...]


Final release now scheduled for October 3rd.



---

archive/issue_comments_120207.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -34,5 +34,5 @@\n    Note: The `mpfr_subnormalize()` implementation up to MPFR 3.0.0 did not change the flags. In particular, it did not follow the generic rule concerning the inexact flag (and no special behavior was specified). The case of the underflow flag was more a lack of specification.\n \n \n-Tarballs of the current **release candidate** (rc1) are available in various formats (regarding the compression method); a bzipped one can be found [here](http://boxen.math.washington.edu/home/leif/Sage/spkgs/upstream/mpfr-3.1.0-rc1.tar.bz2) (`sage.math`) or [here](http://www.mpfr.org/mpfr-3.1.0/mpfr-3.1.0-rc1.tar.bz2) (upstream).\n+Tarballs of the current **release candidate** (rc2) are available in various formats (regarding the compression method); a bzipped one can be found [here](http://boxen.math.washington.edu/home/leif/Sage/spkgs/upstream/mpfr-3.1.0-rc2.tar.bz2) (`sage.math`) or [here](http://www.mpfr.org/mpfr-3.1.0/mpfr-3.1.0-rc2.tar.bz2) (upstream).\n \n``````\n",
    "created_at": "2011-09-22T17:07:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120207",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -34,5 +34,5 @@
    Note: The `mpfr_subnormalize()` implementation up to MPFR 3.0.0 did not change the flags. In particular, it did not follow the generic rule concerning the inexact flag (and no special behavior was specified). The case of the underflow flag was more a lack of specification.
 
 
-Tarballs of the current **release candidate** (rc1) are available in various formats (regarding the compression method); a bzipped one can be found [here](http://boxen.math.washington.edu/home/leif/Sage/spkgs/upstream/mpfr-3.1.0-rc1.tar.bz2) (`sage.math`) or [here](http://www.mpfr.org/mpfr-3.1.0/mpfr-3.1.0-rc1.tar.bz2) (upstream).
+Tarballs of the current **release candidate** (rc2) are available in various formats (regarding the compression method); a bzipped one can be found [here](http://boxen.math.washington.edu/home/leif/Sage/spkgs/upstream/mpfr-3.1.0-rc2.tar.bz2) (`sage.math`) or [here](http://www.mpfr.org/mpfr-3.1.0/mpfr-3.1.0-rc2.tar.bz2) (upstream).
 
``````




---

archive/issue_comments_120208.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -10,7 +10,7 @@\n \n ---\n \n-Yet **MPFR 3.1.0** is on the way, planned to be released September 30th (unless problems should occur).\n+**MPFR 3.1.0** [has been released October 3rd 2011](http://www.mpfr.org/mpfr-3.1.0/).\n \n  == Changes from versions 3.0.* to version 3.1.0: ==\n \n@@ -34,5 +34,5 @@\n    Note: The `mpfr_subnormalize()` implementation up to MPFR 3.0.0 did not change the flags. In particular, it did not follow the generic rule concerning the inexact flag (and no special behavior was specified). The case of the underflow flag was more a lack of specification.\n \n \n-Tarballs of the current **release candidate** (rc2) are available in various formats (regarding the compression method); a bzipped one can be found [here](http://boxen.math.washington.edu/home/leif/Sage/spkgs/upstream/mpfr-3.1.0-rc2.tar.bz2) (`sage.math`) or [here](http://www.mpfr.org/mpfr-3.1.0/mpfr-3.1.0-rc2.tar.bz2) (upstream).\n+Tarballs are available in various formats (regarding the compression method); a bzipped one can be found [here](http://www.mpfr.org/mpfr-3.1.0/mpfr-3.1.0.tar.bz2) (upstream).\n \n``````\n",
    "created_at": "2011-10-03T22:05:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120208",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -10,7 +10,7 @@
 
 ---
 
-Yet **MPFR 3.1.0** is on the way, planned to be released September 30th (unless problems should occur).
+**MPFR 3.1.0** [has been released October 3rd 2011](http://www.mpfr.org/mpfr-3.1.0/).
 
  == Changes from versions 3.0.* to version 3.1.0: ==
 
@@ -34,5 +34,5 @@
    Note: The `mpfr_subnormalize()` implementation up to MPFR 3.0.0 did not change the flags. In particular, it did not follow the generic rule concerning the inexact flag (and no special behavior was specified). The case of the underflow flag was more a lack of specification.
 
 
-Tarballs of the current **release candidate** (rc2) are available in various formats (regarding the compression method); a bzipped one can be found [here](http://boxen.math.washington.edu/home/leif/Sage/spkgs/upstream/mpfr-3.1.0-rc2.tar.bz2) (`sage.math`) or [here](http://www.mpfr.org/mpfr-3.1.0/mpfr-3.1.0-rc2.tar.bz2) (upstream).
+Tarballs are available in various formats (regarding the compression method); a bzipped one can be found [here](http://www.mpfr.org/mpfr-3.1.0/mpfr-3.1.0.tar.bz2) (upstream).
 
``````




---

archive/issue_comments_120209.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nThe final MPFR 3.1.0 has been released today.\n\nSee the description for links.",
    "created_at": "2011-10-03T22:05:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120209",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:5" align="right">comment:5</div>

The final MPFR 3.1.0 has been released today.

See the description for links.



---

archive/issue_comments_120210.json:
```json
{
    "body": "Dependencies: **12171**",
    "created_at": "2011-12-17T10:53:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120210",
    "user": "https://github.com/mwhansen"
}
```

Dependencies: **12171**



---

archive/issue_comments_120211.json:
```json
{
    "body": "Author: **Mike Hansen**",
    "created_at": "2011-12-17T10:53:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120211",
    "user": "https://github.com/mwhansen"
}
```

Author: **Mike Hansen**



---

archive/issue_events_154811.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2011-12-17T10:53:53Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "title_is": "Upgrade MPFR to 3.1.0",
    "title_was": "Upgrade MPFR to 3.0.1 + upstream patches or later (3.1.0)",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11666#event-154811"
}
```



---

archive/issue_comments_120212.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nI have an spkg at http://sage.math.washington.edu/mpfr-3.1.0.spkg.  This is needed for flint2.",
    "created_at": "2011-12-17T11:02:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120212",
    "user": "https://github.com/mwhansen"
}
```

<div id="comment:7" align="right">comment:7</div>

I have an spkg at http://sage.math.washington.edu/mpfr-3.1.0.spkg.  This is needed for flint2.



---

archive/issue_events_154812.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2011-12-17T11:02:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11666#event-154812"
}
```



---

archive/issue_comments_120213.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nShouldn't the dependency be the other way around? That is mpfi needs mpfr rather than mpfr needs mpfi? Have you tested this on a 32bit OS?",
    "created_at": "2011-12-17T18:55:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120213",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:8" align="right">comment:8</div>

Shouldn't the dependency be the other way around? That is mpfi needs mpfr rather than mpfr needs mpfi? Have you tested this on a 32bit OS?



---

archive/issue_comments_120214.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nThis version of MPFI should work with both versions of MPFR.  However, the old version of MPFI will not work with the new version of MPFI.\n\nI haven't tested it on a 32bit OS.  This was primarily just so we could build flint2 in Sage.",
    "created_at": "2011-12-17T18:59:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120214",
    "user": "https://github.com/mwhansen"
}
```

<div id="comment:9" align="right">comment:9</div>

This version of MPFI should work with both versions of MPFR.  However, the old version of MPFI will not work with the new version of MPFI.

I haven't tested it on a 32bit OS.  This was primarily just so we could build flint2 in Sage.



---

archive/issue_comments_120215.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nI wonder why comment [comment:8] speaks about MPFI. Also, upstream (MPFR) we have seen several\nproblems with the `--enable-thread-safe` option which is now enabled by default. Unless needed\nfor Sage, my advice would be to configure MPFR with `--disable-thread-safe`.\n\nPaul",
    "created_at": "2011-12-18T19:25:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120215",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:11" align="right">comment:11</div>

I wonder why comment [comment:8] speaks about MPFI. Also, upstream (MPFR) we have seen several
problems with the `--enable-thread-safe` option which is now enabled by default. Unless needed
for Sage, my advice would be to configure MPFR with `--disable-thread-safe`.

Paul



---

archive/issue_events_154813.json:
```json
{
    "actor": "https://github.com/zimmermann6",
    "created_at": "2011-12-18T19:26:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11666#event-154813"
}
```



---

archive/issue_events_154814.json:
```json
{
    "actor": "https://github.com/zimmermann6",
    "created_at": "2011-12-18T19:26:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11666#event-154814"
}
```



---

archive/issue_comments_120216.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nthe url from comment [comment:7] does not work.\n\nPaul",
    "created_at": "2011-12-18T19:26:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120216",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:12" align="right">comment:12</div>

the url from comment [comment:7] does not work.

Paul



---

archive/issue_comments_120217.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@zimmermann6](#comment:11):\n> I wonder why comment [comment:8] speaks about MPFI. Also, upstream (MPFR) we have seen several\n> problems with the `--enable-thread-safe` option which is now enabled by default. Unless needed\n> for Sage, my advice would be to configure MPFR with `--disable-thread-safe`.\n> \n\nI spoke about mpfi because this ticket is marked as depending on #12171 which is upgrading mpfi. My understanding of the dependency field is that it means that you need #12171 for this ticket. This is silly and should be the other way around.\n\nI think comment 9 has not been written with a clear mind. \n\nI asked about test on 32bit machine because of this [ https://github.com/cschwan/sage-on-gentoo/issues/13].",
    "created_at": "2011-12-18T21:05:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120217",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@zimmermann6](#comment:11):
> I wonder why comment [comment:8] speaks about MPFI. Also, upstream (MPFR) we have seen several
> problems with the `--enable-thread-safe` option which is now enabled by default. Unless needed
> for Sage, my advice would be to configure MPFR with `--disable-thread-safe`.
> 

I spoke about mpfi because this ticket is marked as depending on #12171 which is upgrading mpfi. My understanding of the dependency field is that it means that you need #12171 for this ticket. This is silly and should be the other way around.

I think comment 9 has not been written with a clear mind. 

I asked about test on 32bit machine because of this [ https://github.com/cschwan/sage-on-gentoo/issues/13].



---

archive/issue_comments_120218.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nThe spkg is actually at http://sage.math.washington.edu/home/mhansen/mpfr-3.1.0.spkg\n\nLet me clarify the MPFI issue since I must have been too tired when I tried before.  If we were to just install this version of MPFR, the current MPFI (1.3.4) will fail to build since it uses something which has been removed/moved in the new version of MPFR.  If the new version of MPFI works with both the old and new versions of MPFR.  So, if we want to actually include this package in Sage, we have to have the new version of MPFI in first.  This is the reason I listed the MPFI ticket as a dependency of this one.",
    "created_at": "2011-12-19T10:56:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120218",
    "user": "https://github.com/mwhansen"
}
```

<div id="comment:14" align="right">comment:14</div>

The spkg is actually at http://sage.math.washington.edu/home/mhansen/mpfr-3.1.0.spkg

Let me clarify the MPFI issue since I must have been too tired when I tried before.  If we were to just install this version of MPFR, the current MPFI (1.3.4) will fail to build since it uses something which has been removed/moved in the new version of MPFR.  If the new version of MPFI works with both the old and new versions of MPFR.  So, if we want to actually include this package in Sage, we have to have the new version of MPFI in first.  This is the reason I listed the MPFI ticket as a dependency of this one.



---

archive/issue_comments_120219.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nYou are making sense now. I indeed remember making a patch for mpfi-1.4 to build against mpfr-3.x in gentoo, it would apply to 1.3.4 as well I think. Anyway there are a number of things to fix as far as I can see because of the inclusion of these two.",
    "created_at": "2011-12-19T18:21:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120219",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:15" align="right">comment:15</div>

You are making sense now. I indeed remember making a patch for mpfi-1.4 to build against mpfr-3.x in gentoo, it would apply to 1.3.4 as well I think. Anyway there are a number of things to fix as far as I can see because of the inclusion of these two.



---

archive/issue_comments_120220.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nSome thoughts about the spkg-install script:\n\n* It sets some CFLAGS and others itself, is it needed? does not mpfr look for the gmp header and pumps from there if possible? and should we take advantage of this (as in done for mpir where spkg-install look at what mpir chooses if CFLAGS et al. are empty)?\n* Is the patch for Solaris stuff still needed? (see #6453) -> at least the code in mpn_exp.c did not change in mpfr 3.1.0, so I guess it has to be included to support outdated Solaris systems where memset is buggy?\n* It always runs the test suite, whether SAGE_CHECK is set (then it is ran twice...) or not (then just once), is there still a good reason for doing so? It seems that such a behavior was also present in the MPIR spkg but was removed (see #9522 and !#8664)\n* make should be replaced by $MAKE in spkg-check",
    "created_at": "2012-01-08T12:28:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120220",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:16" align="right">comment:16</div>

Some thoughts about the spkg-install script:

* It sets some CFLAGS and others itself, is it needed? does not mpfr look for the gmp header and pumps from there if possible? and should we take advantage of this (as in done for mpir where spkg-install look at what mpir chooses if CFLAGS et al. are empty)?
* Is the patch for Solaris stuff still needed? (see #6453) -> at least the code in mpn_exp.c did not change in mpfr 3.1.0, so I guess it has to be included to support outdated Solaris systems where memset is buggy?
* It always runs the test suite, whether SAGE_CHECK is set (then it is ran twice...) or not (then just once), is there still a good reason for doing so? It seems that such a behavior was also present in the MPIR spkg but was removed (see #9522 and !#8664)
* make should be replaced by $MAKE in spkg-check



---

archive/issue_comments_120221.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\n> It sets some CFLAGS and others itself, is it needed? \n\nas a developer of MPFR I strongly recommend to let MPFR choose the same CC and CFLAGS as GMP\n(they are read in gmp.h). Since we do this for MPFR, this greatly improved the portability of\nMPFR on different platforms with different compilers, in particuler it solves the ABI=32 vs ABI=64\nissues.\n\n> Is the patch for Solaris stuff still needed?\n\nI guess yes, since this was a bug in the Solaris kernel.\n\nPaul",
    "created_at": "2012-01-08T21:08:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120221",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:17" align="right">comment:17</div>

> It sets some CFLAGS and others itself, is it needed? 

as a developer of MPFR I strongly recommend to let MPFR choose the same CC and CFLAGS as GMP
(they are read in gmp.h). Since we do this for MPFR, this greatly improved the portability of
MPFR on different platforms with different compilers, in particuler it solves the ABI=32 vs ABI=64
issues.

> Is the patch for Solaris stuff still needed?

I guess yes, since this was a bug in the Solaris kernel.

Paul



---

archive/issue_comments_120222.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nI've tested this spkg on top of #12171 on my 64-bit laptop (Core 2 Duo): all doctests pass.\n\nPaul",
    "created_at": "2012-01-08T23:01:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120222",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:18" align="right">comment:18</div>

I've tested this spkg on top of #12171 on my 64-bit laptop (Core 2 Duo): all doctests pass.

Paul



---

archive/issue_comments_120223.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@zimmermann6](#comment:18):\n> I've tested this spkg on top of #12171 on my 64-bit laptop (Core 2 Duo): all doctests pass.\n> \n\nYes 64bit is fine as far as I can tell. It's 32bit that's the trouble - both linux and OS X [10.5.8], don't know about other like solaris or cygwin.",
    "created_at": "2012-01-09T00:35:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120223",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@zimmermann6](#comment:18):
> I've tested this spkg on top of #12171 on my 64-bit laptop (Core 2 Duo): all doctests pass.
> 

Yes 64bit is fine as far as I can tell. It's 32bit that's the trouble - both linux and OS X [10.5.8], don't know about other like solaris or cygwin.



---

archive/issue_comments_120224.json:
```json
{
    "body": "Changed keywords from **sd32 MPFR spkg wishlist** to **sd32 MPFR spkg wishlist sd35.5**",
    "created_at": "2012-01-09T08:06:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120224",
    "user": "https://github.com/zimmermann6"
}
```

Changed keywords from **sd32 MPFR spkg wishlist** to **sd32 MPFR spkg wishlist sd35.5**



---

archive/issue_comments_120225.json:
```json
{
    "body": "Reviewer: **Paul Zimmermann**",
    "created_at": "2012-01-09T08:12:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120225",
    "user": "https://github.com/zimmermann6"
}
```

Reviewer: **Paul Zimmermann**



---

archive/issue_comments_120226.json:
```json
{
    "body": "Changed dependencies from **12171** to **#12171**",
    "created_at": "2012-01-09T08:12:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120226",
    "user": "https://github.com/zimmermann6"
}
```

Changed dependencies from **12171** to **#12171**



---

archive/issue_comments_120227.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\non a 32-bit Pentium 4, after applying #12171 and importing this spkg, I get when I start Sage:\n\n```\nImportError: /localdisk/tmp/sage-4.7.2/local/lib/libmpfi.so.0: undefined symbol: mpfr_add_d\nError importing ipy_profile_sage - perhaps you should run %upgrade?\nWARNING: Loading of ipy_profile_sage failed.\n```\nMaybe I should first import this spkg then that of MPFI?\n\nPaul",
    "created_at": "2012-01-09T08:12:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120227",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:21" align="right">comment:21</div>

on a 32-bit Pentium 4, after applying #12171 and importing this spkg, I get when I start Sage:

```
ImportError: /localdisk/tmp/sage-4.7.2/local/lib/libmpfi.so.0: undefined symbol: mpfr_add_d
Error importing ipy_profile_sage - perhaps you should run %upgrade?
WARNING: Loading of ipy_profile_sage failed.
```
Maybe I should first import this spkg then that of MPFI?

Paul



---

archive/issue_comments_120228.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nStill about the spkg itself:\n\n* Is there any reason to \"unset RM\"? it says it messes with libtool while running \"make check\". I do not see this restriction in the MPIR package, or the MPFI one e.g. Is this for a specific architecture? Is this really needed? I guess this is fixed by #3537\n* MAKE is set back to make before running \"make install\" (and then \"make check\" in the original package), any undocumented reason?\n\nI'll test all of this on my system but if someone can point me to the relevant info, I'd be grateful, Google wans not that helpful.",
    "created_at": "2012-01-09T08:32:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120228",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:22" align="right">comment:22</div>

Still about the spkg itself:

* Is there any reason to "unset RM"? it says it messes with libtool while running "make check". I do not see this restriction in the MPIR package, or the MPFI one e.g. Is this for a specific architecture? Is this really needed? I guess this is fixed by #3537
* MAKE is set back to make before running "make install" (and then "make check" in the original package), any undocumented reason?

I'll test all of this on my system but if someone can point me to the relevant info, I'd be grateful, Google wans not that helpful.



---

archive/issue_comments_120229.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nI've put an updated package implementing my remarks, mainly using the mpir spkg-install file, I've also updated the description and license info.\n\nIt can be found at\n\nhttp://perso.telecom-paristech.fr/sage/mpfr-3.1.0.spkg\n\nIt seems to do what it should, and uccessfully built and rand MPFR test suite on a \"usual\" intel 64 bit system, not any idea if I broke anything for more exotic architectures. Did not ran sage test suite either.",
    "created_at": "2012-01-09T10:30:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120229",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:23" align="right">comment:23</div>

I've put an updated package implementing my remarks, mainly using the mpir spkg-install file, I've also updated the description and license info.

It can be found at

http://perso.telecom-paristech.fr/sage/mpfr-3.1.0.spkg

It seems to do what it should, and uccessfully built and rand MPFR test suite on a "usual" intel 64 bit system, not any idea if I broke anything for more exotic architectures. Did not ran sage test suite either.



---

archive/issue_comments_120230.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@jpflori](#comment:23):\n> It can be found at\n> \n> http://perso.telecom-paristech.fr/sage/mpfr-3.1.0.spkg\n\nI do get a 301 to http://perso.telecom-paristech.fr/~sage/mpfr-3.1.0.spkg and that gives a 404.",
    "created_at": "2012-01-09T22:01:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120230",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@jpflori](#comment:23):
> It can be found at
> 
> http://perso.telecom-paristech.fr/sage/mpfr-3.1.0.spkg

I do get a 301 to http://perso.telecom-paristech.fr/~sage/mpfr-3.1.0.spkg and that gives a 404.



---

archive/issue_comments_120231.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReplying to [@jpflori](#comment:22):\n> Still about the spkg itself:\n> \n> * Is there any reason to \"unset RM\"? it says it messes with libtool while running \"make check\". I do not see this restriction in the MPIR package, or the MPFI one e.g. Is this for a specific architecture? Is this really needed? I guess this is fixed by #3537.\n\nUnsetting `RM` is safe, but meanwhile a bit redundant.  Newer autotools use `$RM` instead of `rm -f` (or `$RM -f`), so tend to fail if `RM` happens to be set to (just) `rm`.\n\n\n\n\n> * MAKE is set back to make before running \"make install\" (and then \"make check\" in the original package), any undocumented reason?\n\nI'm pretty sure that's a relict from when people didn't know how to properly disable *parallel* `make`.  If in doubt, use `$MAKE -j1 install` etc.",
    "created_at": "2012-01-09T22:11:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120231",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:25" align="right">comment:25</div>

Replying to [@jpflori](#comment:22):
> Still about the spkg itself:
> 
> * Is there any reason to "unset RM"? it says it messes with libtool while running "make check". I do not see this restriction in the MPIR package, or the MPFI one e.g. Is this for a specific architecture? Is this really needed? I guess this is fixed by #3537.

Unsetting `RM` is safe, but meanwhile a bit redundant.  Newer autotools use `$RM` instead of `rm -f` (or `$RM -f`), so tend to fail if `RM` happens to be set to (just) `rm`.




> * MAKE is set back to make before running "make install" (and then "make check" in the original package), any undocumented reason?

I'm pretty sure that's a relict from when people didn't know how to properly disable *parallel* `make`.  If in doubt, use `$MAKE -j1 install` etc.



---

archive/issue_comments_120232.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nSorry, this should be http://perso.telecom-paristech.fr/~flori/sage/mpfr-3.1.0.spkg",
    "created_at": "2012-01-09T22:13:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120232",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:26" align="right">comment:26</div>

Sorry, this should be http://perso.telecom-paristech.fr/~flori/sage/mpfr-3.1.0.spkg



---

archive/issue_comments_120233.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [@zimmermann6](#comment:21):\n> Maybe I should first import this spkg then that of MPFI?\n\nSince MPFI depends on MPFR (and MPIR), you have to rebuild MPFI after upgrading one of the latter.\n\nIf you have enough time (and/or the machine is fast enough), you can copy new/updated spkgs into `$SAGE_ROOT/spkg/standard/` and run\n\n```sh\n$ env SAGE_UPGRADING=yes make build\n```\nafterwards.  That way all dependent packages automatically get rebuilt, which can take some time.\n\n(Unfortunately there are also a couple of stupid transitive dependencies; e.g. ATLAS gets rebuilt if you update readline -- just because ATLAS now has an `spkg-install` file written in Python, and Python depends on readline...  So a lot of rebuilds performed by `make` aren't really necessary.)",
    "created_at": "2012-01-09T22:28:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120233",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [@zimmermann6](#comment:21):
> Maybe I should first import this spkg then that of MPFI?

Since MPFI depends on MPFR (and MPIR), you have to rebuild MPFI after upgrading one of the latter.

If you have enough time (and/or the machine is fast enough), you can copy new/updated spkgs into `$SAGE_ROOT/spkg/standard/` and run

```sh
$ env SAGE_UPGRADING=yes make build
```
afterwards.  That way all dependent packages automatically get rebuilt, which can take some time.

(Unfortunately there are also a couple of stupid transitive dependencies; e.g. ATLAS gets rebuilt if you update readline -- just because ATLAS now has an `spkg-install` file written in Python, and Python depends on readline...  So a lot of rebuilds performed by `make` aren't really necessary.)



---

archive/issue_comments_120234.json:
```json
{
    "body": "Work Issues: **fails on 32-bit**",
    "created_at": "2012-01-10T12:02:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120234",
    "user": "https://github.com/zimmermann6"
}
```

Work Issues: **fails on 32-bit**



---

archive/issue_comments_120235.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nI tried importing the MPFI spkg+patches (#12171) and that spkg on top of 4.8.alpha6 on a 32-bit\nPentium 4 and got the following failures:\n\n```\nsage -t  \"devel/sage-main/sage/matrix/matrix_mpolynomial_dense.pyx\"\nsage -t  \"devel/sage-main/sage/matrix/constructor.py\"\nsage -t  \"devel/sage-main/sage/matrix/matrix2.pyx\"\nsage -t  \"devel/sage-main/sage/misc/randstate.pyx\"\nsage -t  \"devel/sage-main/sage/modules/free_module_element.pyx\"\nsage -t  \"devel/sage-main/sage/rings/real_mpfi.pyx\"\nsage -t  \"devel/sage-main/sage/rings/complex_field.py\"\nsage -t  \"devel/sage-main/sage/rings/complex_interval_field.py\"\nsage -t  \"devel/sage-main/sage/rings/real_mpfr.pyx\" # Killed/crashed\nsage -t  \"devel/sage-main/sage/schemes/elliptic_curves/ell_rational_field.py\"\n```\nPaul",
    "created_at": "2012-01-10T12:02:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120235",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:28" align="right">comment:28</div>

I tried importing the MPFI spkg+patches (#12171) and that spkg on top of 4.8.alpha6 on a 32-bit
Pentium 4 and got the following failures:

```
sage -t  "devel/sage-main/sage/matrix/matrix_mpolynomial_dense.pyx"
sage -t  "devel/sage-main/sage/matrix/constructor.py"
sage -t  "devel/sage-main/sage/matrix/matrix2.pyx"
sage -t  "devel/sage-main/sage/misc/randstate.pyx"
sage -t  "devel/sage-main/sage/modules/free_module_element.pyx"
sage -t  "devel/sage-main/sage/rings/real_mpfi.pyx"
sage -t  "devel/sage-main/sage/rings/complex_field.py"
sage -t  "devel/sage-main/sage/rings/complex_interval_field.py"
sage -t  "devel/sage-main/sage/rings/real_mpfr.pyx" # Killed/crashed
sage -t  "devel/sage-main/sage/schemes/elliptic_curves/ell_rational_field.py"
```
Paul



---

archive/issue_comments_120236.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nthe failures are most likely due to the fact that the `mpfr_urandom` and `mpfr_urandomb`\nreturn identical values on processors with different word size in MPFR 3.1.0\n(see http://www.mpfr.org/mpfr-3.1.0/#changes).\n\nThe bad news is that this will need changing the doctests.\n\nThe good news is that we won't need any more different doctests on 32-bit and 64-bit\n(assuming the MPIR random generator is independent of the word size).\n\nPaul Zimmermann",
    "created_at": "2012-01-10T12:41:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120236",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:29" align="right">comment:29</div>

the failures are most likely due to the fact that the `mpfr_urandom` and `mpfr_urandomb`
return identical values on processors with different word size in MPFR 3.1.0
(see http://www.mpfr.org/mpfr-3.1.0/#changes).

The bad news is that this will need changing the doctests.

The good news is that we won't need any more different doctests on 32-bit and 64-bit
(assuming the MPIR random generator is independent of the word size).

Paul Zimmermann



---

archive/issue_comments_120237.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nFor the record, Mike's spkg and my updated one both need to be rebased on top of #12131.\n\nI'll take care of that later.",
    "created_at": "2012-01-12T10:18:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120237",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:30" align="right">comment:30</div>

For the record, Mike's spkg and my updated one both need to be rebased on top of #12131.

I'll take care of that later.



---

archive/issue_comments_120238.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nYou can finally find a rebased spkg where I discarded some stuff involving ABI which previously made sage print that it was building for 32 bits, whereas it actually had no effect, and which is rebased on #12131 at the usual address:\n\nhttp://perso.telecom-paristech.fr/~flori/sage/mpfr-3.1.0.spkg\n\nI guess the issue with doctests is the last step before \"needs review\"",
    "created_at": "2012-01-23T17:35:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120238",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:31" align="right">comment:31</div>

You can finally find a rebased spkg where I discarded some stuff involving ABI which previously made sage print that it was building for 32 bits, whereas it actually had no effect, and which is rebased on #12131 at the usual address:

http://perso.telecom-paristech.fr/~flori/sage/mpfr-3.1.0.spkg

I guess the issue with doctests is the last step before "needs review"



---

archive/issue_comments_120239.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,38 +1,30 @@\n-Our current MPFR spkg is fairly old (based on **MPFR 2.4.2**), and upgrading it to the latest [stable] upstream release is now on the [\"high-priority wishlist\"](http://wiki.sagemath.org/days32/wishlist).\n+Our current MPFR spkg is fairly old (based on **MPFR 2.4.2**), and upgrading it to the latest [stable] upstream release is now on the [high-priority wishlist](http://wiki.sagemath.org/days32/wishlist).\n \n-`spkg-install` also needs a major rewrite, e.g. to make use of (some of) GMP's / MPIR's build flags.\n-\n-*\"I think I'll provide a new spkg in the next days (next weekend, say).\"* [This unfortunately became a moving target; still on my high priority list though...]\n+Use http://perso.telecom-paristech.fr/~flori/sage/mpfr-3.1.0.spkg\n \n ---\n-\n **MPFR 3.0.1** was released on April 4th 2011; there are already some [additional upstream patches](http://www.mpfr.org/mpfr-current/allpatches) for that version; see [http://www.mpfr.org/mpfr-current/](http://www.mpfr.org/mpfr-current/).\n \n ---\n-\n **MPFR 3.1.0** [has been released October 3rd 2011](http://www.mpfr.org/mpfr-3.1.0/).\n \n- == Changes from versions 3.0.* to version 3.1.0: ==\n-\n-- The MPFR source has been reorganized.\n-- Dropped `ansi2knr` support.\n-- TLS support is now detected automatically. If TLS is supported, MPFR is built as thread safe by default. To disable TLS explicitly, configure MPFR with `--disable-thread-safe`.\n-- New `--enable-gmp-internals` `configure` option to use GMP's undocumented functions (not from the public API). Note that library versioning is not guaranteed to work if this option is used.\n-- The `mpfr_urandom()` and `mpfr_urandomb()` functions now return identical values on processors with different word size (assuming the same random seed, and since the GMP random generator does not depend itself on the word size, cf. [http://gmplib.org/list-archives/gmp-devel/2010-September/001642.html](http://gmplib.org/list-archives/gmp-devel/2010-September/001642.html)).\n-- The `mpfr_add_one_ulp()` and `mpfr_sub_one_ulp()` macros (which are obsolete and no more documented) will be removed in a future release.\n-- Speed improvement for the `mpfr_sqr()` and `mpfr_div()` functions using Mulders' algorithm. As a consequence, other functions using those routines are also faster.\n-- Much faster formatted output (`mpfr_printf()`, etc.) with `%Rg` and similar.\n-- The `--with-gmp-build` `configure` option can now be used when the GMP source directory and the GMP build directory are different (without having to copy header files manually as before).\n-- New functions `mpfr_buildopt_tune_case()`, `mpfr_frexp()`, `mpfr_grandom()` and `mpfr_z_sub()`.\n-- New division-by-zero exception (flag) and associated functions.\n-- The `mpfr.h` header can be included several times, while still supporting optional functions (see Section \"Headers and Libraries\" in the manual).\n-- Updated tuning parameters.\n-- Improved MPFR manual.\n-- MPFR tests: `libtool` no longer generates wrapper scripts with `make check` (so that running the tests under `valgrind` or `gdb` is easier).\n-- Bug fixes.\n-\n-   Note: The `mpfr_subnormalize()` implementation up to MPFR 3.0.0 did not change the flags. In particular, it did not follow the generic rule concerning the inexact flag (and no special behavior was specified). The case of the underflow flag was more a lack of specification.\n-\n+## Changes from versions 3.0.* to version 3.1.0:\n+* The MPFR source has been reorganized.\n+* Dropped `ansi2knr` support.\n+* TLS support is now detected automatically. If TLS is supported, MPFR is built as thread safe by default. To disable TLS explicitly, configure MPFR with `--disable-thread-safe`.\n+* New `--enable-gmp-internals` `configure` option to use GMP's undocumented functions (not from the public API). Note that library versioning is not guaranteed to work if this option is used.\n+* The `mpfr_urandom()` and `mpfr_urandomb()` functions now return identical values on processors with different word size (assuming the same random seed, and since the GMP random generator does not depend itself on the word size, cf. [http://gmplib.org/list-archives/gmp-devel/2010-September/001642.html](http://gmplib.org/list-archives/gmp-devel/2010-September/001642.html)).\n+* The `mpfr_add_one_ulp()` and `mpfr_sub_one_ulp()` macros (which are obsolete and no more documented) will be removed in a future release.\n+* Speed improvement for the `mpfr_sqr()` and `mpfr_div()` functions using Mulders' algorithm. As a consequence, other functions using those routines are also faster.\n+* Much faster formatted output (`mpfr_printf()`, etc.) with `%Rg` and similar.\n+* The `--with-gmp-build` `configure` option can now be used when the GMP source directory and the GMP build directory are different (without having to copy header files manually as before).\n+* New functions `mpfr_buildopt_tune_case()`, `mpfr_frexp()`, `mpfr_grandom()` and `mpfr_z_sub()`.\n+* New division-by-zero exception (flag) and associated functions.\n+* The `mpfr.h` header can be included several times, while still supporting optional functions (see Section \"Headers and Libraries\" in the manual).\n+* Updated tuning parameters.\n+* Improved MPFR manual.\n+* MPFR tests: `libtool` no longer generates wrapper scripts with `make check` (so that running the tests under `valgrind` or `gdb` is easier).\n+* Bug fixes.\n+ Note: The `mpfr_subnormalize()` implementation up to MPFR 3.0.0 did not change the flags. In particular, it did not follow the generic rule concerning the inexact flag (and no special behavior was specified). The case of the underflow flag was more a lack of specification.\n \n Tarballs are available in various formats (regarding the compression method); a bzipped one can be found [here](http://www.mpfr.org/mpfr-3.1.0/mpfr-3.1.0.tar.bz2) (upstream).\n-\n``````\n",
    "created_at": "2012-01-23T17:35:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120239",
    "user": "https://github.com/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,38 +1,30 @@
-Our current MPFR spkg is fairly old (based on **MPFR 2.4.2**), and upgrading it to the latest [stable] upstream release is now on the ["high-priority wishlist"](http://wiki.sagemath.org/days32/wishlist).
+Our current MPFR spkg is fairly old (based on **MPFR 2.4.2**), and upgrading it to the latest [stable] upstream release is now on the [high-priority wishlist](http://wiki.sagemath.org/days32/wishlist).
 
-`spkg-install` also needs a major rewrite, e.g. to make use of (some of) GMP's / MPIR's build flags.
-
-*"I think I'll provide a new spkg in the next days (next weekend, say)."* [This unfortunately became a moving target; still on my high priority list though...]
+Use http://perso.telecom-paristech.fr/~flori/sage/mpfr-3.1.0.spkg
 
 ---
-
 **MPFR 3.0.1** was released on April 4th 2011; there are already some [additional upstream patches](http://www.mpfr.org/mpfr-current/allpatches) for that version; see [http://www.mpfr.org/mpfr-current/](http://www.mpfr.org/mpfr-current/).
 
 ---
-
 **MPFR 3.1.0** [has been released October 3rd 2011](http://www.mpfr.org/mpfr-3.1.0/).
 
- == Changes from versions 3.0.* to version 3.1.0: ==
-
-- The MPFR source has been reorganized.
-- Dropped `ansi2knr` support.
-- TLS support is now detected automatically. If TLS is supported, MPFR is built as thread safe by default. To disable TLS explicitly, configure MPFR with `--disable-thread-safe`.
-- New `--enable-gmp-internals` `configure` option to use GMP's undocumented functions (not from the public API). Note that library versioning is not guaranteed to work if this option is used.
-- The `mpfr_urandom()` and `mpfr_urandomb()` functions now return identical values on processors with different word size (assuming the same random seed, and since the GMP random generator does not depend itself on the word size, cf. [http://gmplib.org/list-archives/gmp-devel/2010-September/001642.html](http://gmplib.org/list-archives/gmp-devel/2010-September/001642.html)).
-- The `mpfr_add_one_ulp()` and `mpfr_sub_one_ulp()` macros (which are obsolete and no more documented) will be removed in a future release.
-- Speed improvement for the `mpfr_sqr()` and `mpfr_div()` functions using Mulders' algorithm. As a consequence, other functions using those routines are also faster.
-- Much faster formatted output (`mpfr_printf()`, etc.) with `%Rg` and similar.
-- The `--with-gmp-build` `configure` option can now be used when the GMP source directory and the GMP build directory are different (without having to copy header files manually as before).
-- New functions `mpfr_buildopt_tune_case()`, `mpfr_frexp()`, `mpfr_grandom()` and `mpfr_z_sub()`.
-- New division-by-zero exception (flag) and associated functions.
-- The `mpfr.h` header can be included several times, while still supporting optional functions (see Section "Headers and Libraries" in the manual).
-- Updated tuning parameters.
-- Improved MPFR manual.
-- MPFR tests: `libtool` no longer generates wrapper scripts with `make check` (so that running the tests under `valgrind` or `gdb` is easier).
-- Bug fixes.
-
-   Note: The `mpfr_subnormalize()` implementation up to MPFR 3.0.0 did not change the flags. In particular, it did not follow the generic rule concerning the inexact flag (and no special behavior was specified). The case of the underflow flag was more a lack of specification.
-
+## Changes from versions 3.0.* to version 3.1.0:
+* The MPFR source has been reorganized.
+* Dropped `ansi2knr` support.
+* TLS support is now detected automatically. If TLS is supported, MPFR is built as thread safe by default. To disable TLS explicitly, configure MPFR with `--disable-thread-safe`.
+* New `--enable-gmp-internals` `configure` option to use GMP's undocumented functions (not from the public API). Note that library versioning is not guaranteed to work if this option is used.
+* The `mpfr_urandom()` and `mpfr_urandomb()` functions now return identical values on processors with different word size (assuming the same random seed, and since the GMP random generator does not depend itself on the word size, cf. [http://gmplib.org/list-archives/gmp-devel/2010-September/001642.html](http://gmplib.org/list-archives/gmp-devel/2010-September/001642.html)).
+* The `mpfr_add_one_ulp()` and `mpfr_sub_one_ulp()` macros (which are obsolete and no more documented) will be removed in a future release.
+* Speed improvement for the `mpfr_sqr()` and `mpfr_div()` functions using Mulders' algorithm. As a consequence, other functions using those routines are also faster.
+* Much faster formatted output (`mpfr_printf()`, etc.) with `%Rg` and similar.
+* The `--with-gmp-build` `configure` option can now be used when the GMP source directory and the GMP build directory are different (without having to copy header files manually as before).
+* New functions `mpfr_buildopt_tune_case()`, `mpfr_frexp()`, `mpfr_grandom()` and `mpfr_z_sub()`.
+* New division-by-zero exception (flag) and associated functions.
+* The `mpfr.h` header can be included several times, while still supporting optional functions (see Section "Headers and Libraries" in the manual).
+* Updated tuning parameters.
+* Improved MPFR manual.
+* MPFR tests: `libtool` no longer generates wrapper scripts with `make check` (so that running the tests under `valgrind` or `gdb` is easier).
+* Bug fixes.
+ Note: The `mpfr_subnormalize()` implementation up to MPFR 3.0.0 did not change the flags. In particular, it did not follow the generic rule concerning the inexact flag (and no special behavior was specified). The case of the underflow flag was more a lack of specification.
 
 Tarballs are available in various formats (regarding the compression method); a bzipped one can be found [here](http://www.mpfr.org/mpfr-3.1.0/mpfr-3.1.0.tar.bz2) (upstream).
-
``````




---

archive/issue_comments_120240.json:
```json
{
    "body": "Changed work issues from **fails on 32-bit** to **failing doctests for 32 bits**",
    "created_at": "2012-01-23T17:35:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120240",
    "user": "https://github.com/jpflori"
}
```

Changed work issues from **fails on 32-bit** to **failing doctests for 32 bits**



---

archive/issue_comments_120241.json:
```json
{
    "body": "Changed author from **Mike Hansen** to **Mike Hansen, Jean-Pierre Flori**",
    "created_at": "2012-01-23T17:35:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120241",
    "user": "https://github.com/jpflori"
}
```

Changed author from **Mike Hansen** to **Mike Hansen, Jean-Pierre Flori**



---

archive/issue_comments_120242.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nI guess my last package should be rebased on #12366 which has been merged into 5.beta4.\n\nPaul, any news on the doctests problems ?",
    "created_at": "2012-02-16T08:09:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120242",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:32" align="right">comment:32</div>

I guess my last package should be rebased on #12366 which has been merged into 5.beta4.

Paul, any news on the doctests problems ?



---

archive/issue_comments_120243.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nI will check the doctests on cicero (skynet) but I guess the issue is still there, since nothing was changed. I will try to make a patch (but since I'm in holidays, it might take some time).\n\nPaul",
    "created_at": "2012-02-16T11:34:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120243",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:33" align="right">comment:33</div>

I will check the doctests on cicero (skynet) but I guess the issue is still there, since nothing was changed. I will try to make a patch (but since I'm in holidays, it might take some time).

Paul



---

archive/issue_comments_120244.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nI tried this patch (with dependencies) on top of Sage 4.8 and got several doctests failures:\n\n```\n        sage -t  devel/sage-11666/sage/schemes/elliptic_curves/ell_rational_field.py # 2 doctests failed\n        sage -t  devel/sage-11666/sage/schemes/elliptic_curves/heegner.py # 2 doctests failed\n        sage -t  devel/sage-11666/sage/matrix/matrix2.pyx # 3 doctests failed\n        sage -t  devel/sage-11666/sage/combinat/partition.py # 30 doctests failed\n        sage -t  devel/sage-11666/sage/calculus/calculus.py # 7 doctests failed\n        sage -t  devel/sage-11666/sage/misc/randstate.pyx # 13 doctests failed\n        sage -t  devel/sage-11666/sage/misc/misc.py # 1 doctests failed\n        sage -t  devel/sage-11666/sage/modules/free_module_element.pyx # 2 doctests failed\n        sage -t  devel/sage-11666/sage/rings/real_mpfr.pyx # 12 doctests failed\n        sage -t  devel/sage-11666/sage/matrix/constructor.py # 2 doctests failed\n        sage -t  devel/sage-11666/sage/combinat/sloane_functions.py # 5 doctests failed\n        sage -t  devel/sage-11666/sage/misc/cachefunc.py # 14 doctests failed\n        sage -t  devel/sage-11666/sage/combinat/combinat.py # 1 doctests failed\n        sage -t  devel/sage-11666/sage/libs/fplll/fplll.pyx # Killed/crashed\n        sage -t  devel/sage-11666/sage/combinat/species/species.py # 3 doctests failed\n        sage -t  devel/sage-11666/sage/combinat/species/sum_species.py # 3 doctests failed\n        sage -t  devel/sage-11666/sage/combinat/species/permutation_species.py # 3 doctests failed\n        sage -t  devel/sage-11666/sage/sets/disjoint_union_enumerated_sets.py # 8 doctests failed\n        sage -t  devel/sage-11666/sage/matrix/matrix_mpolynomial_dense.pyx # 2 doctests failed\n        sage -t  devel/sage-11666/sage/combinat/species/partition_species.py # 4 doctests failed\n        sage -t  devel/sage-11666/sage/combinat/species/product_species.py # 2 doctests failed\n        sage -t  devel/sage-11666/sage/rings/complex_field.py # 4 doctests failed\n        sage -t  devel/sage-11666/sage/rings/complex_interval_field.py # 3 doctests failed\n        sage -t  devel/sage-11666/sage/combinat/partitions.pyx # 1 doctests failed\n        sage -t  devel/sage-11666/sage/rings/real_mpfi.pyx # 5 doctests failed\n```\nCan someone reproduce that?\n\nPaul",
    "created_at": "2012-02-16T16:31:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120244",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:34" align="right">comment:34</div>

I tried this patch (with dependencies) on top of Sage 4.8 and got several doctests failures:

```
        sage -t  devel/sage-11666/sage/schemes/elliptic_curves/ell_rational_field.py # 2 doctests failed
        sage -t  devel/sage-11666/sage/schemes/elliptic_curves/heegner.py # 2 doctests failed
        sage -t  devel/sage-11666/sage/matrix/matrix2.pyx # 3 doctests failed
        sage -t  devel/sage-11666/sage/combinat/partition.py # 30 doctests failed
        sage -t  devel/sage-11666/sage/calculus/calculus.py # 7 doctests failed
        sage -t  devel/sage-11666/sage/misc/randstate.pyx # 13 doctests failed
        sage -t  devel/sage-11666/sage/misc/misc.py # 1 doctests failed
        sage -t  devel/sage-11666/sage/modules/free_module_element.pyx # 2 doctests failed
        sage -t  devel/sage-11666/sage/rings/real_mpfr.pyx # 12 doctests failed
        sage -t  devel/sage-11666/sage/matrix/constructor.py # 2 doctests failed
        sage -t  devel/sage-11666/sage/combinat/sloane_functions.py # 5 doctests failed
        sage -t  devel/sage-11666/sage/misc/cachefunc.py # 14 doctests failed
        sage -t  devel/sage-11666/sage/combinat/combinat.py # 1 doctests failed
        sage -t  devel/sage-11666/sage/libs/fplll/fplll.pyx # Killed/crashed
        sage -t  devel/sage-11666/sage/combinat/species/species.py # 3 doctests failed
        sage -t  devel/sage-11666/sage/combinat/species/sum_species.py # 3 doctests failed
        sage -t  devel/sage-11666/sage/combinat/species/permutation_species.py # 3 doctests failed
        sage -t  devel/sage-11666/sage/sets/disjoint_union_enumerated_sets.py # 8 doctests failed
        sage -t  devel/sage-11666/sage/matrix/matrix_mpolynomial_dense.pyx # 2 doctests failed
        sage -t  devel/sage-11666/sage/combinat/species/partition_species.py # 4 doctests failed
        sage -t  devel/sage-11666/sage/combinat/species/product_species.py # 2 doctests failed
        sage -t  devel/sage-11666/sage/rings/complex_field.py # 4 doctests failed
        sage -t  devel/sage-11666/sage/rings/complex_interval_field.py # 3 doctests failed
        sage -t  devel/sage-11666/sage/combinat/partitions.pyx # 1 doctests failed
        sage -t  devel/sage-11666/sage/rings/real_mpfi.pyx # 5 doctests failed
```
Can someone reproduce that?

Paul



---

archive/issue_comments_120245.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nI've begun the test suite. Here are my failures on a Debian amd64 experimental system (on intel core i7) :\n\n```\nThe following tests failed:\n\n\tsage -t  -force_lib devel/sage/sage/modular/modsym/ambient.py # 0 doctests failed\n\tsage -t  -force_lib devel/sage/sage/modular/hecke/hecke_operator.py # 0 doctests failed\n\tsage -t  -force_lib devel/sage/sage/modular/hecke/ambient_module.py # 0 doctests failed\n\tsage -t  -force_lib devel/sage/sage/modules/free_module_element.pyx # 2 doctests failed\n\tsage -t  -force_lib devel/sage/sage/matrix/matrix_mpolynomial_dense.pyx # 2 doctests failed\n\tsage -t  -force_lib devel/sage/sage/matrix/constructor.py # 2 doctests failed\n\tsage -t  -force_lib devel/sage/sage/matrix/matrix2.pyx # 3 doctests failed\n\tsage -t  -force_lib devel/sage/sage/rings/real_mpfi.pyx # 5 doctests failed\n\tsage -t  -force_lib devel/sage/sage/rings/complex_field.py # 4 doctests failed\n\tsage -t  -force_lib devel/sage/sage/rings/real_mpfr.pyx # 12 doctests failed\n\tsage -t  -force_lib devel/sage/sage/rings/complex_interval_field.py # 3 doctests failed\n\tsage -t  -force_lib devel/sage/sage/tests/cmdline.py # 4 doctests failed\n\tsage -t  -force_lib devel/sage/sage/misc/randstate.pyx # 13 doctests failed\n\tsage -t  -force_lib devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py # 2 doctests failed\n\n```\nI'll have a look at them tomorrow.\n\nSome of them at least are just changes in random output (e. g. real_mpfr and real_mpfi)",
    "created_at": "2012-02-16T22:30:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120245",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:35" align="right">comment:35</div>

I've begun the test suite. Here are my failures on a Debian amd64 experimental system (on intel core i7) :

```
The following tests failed:

	sage -t  -force_lib devel/sage/sage/modular/modsym/ambient.py # 0 doctests failed
	sage -t  -force_lib devel/sage/sage/modular/hecke/hecke_operator.py # 0 doctests failed
	sage -t  -force_lib devel/sage/sage/modular/hecke/ambient_module.py # 0 doctests failed
	sage -t  -force_lib devel/sage/sage/modules/free_module_element.pyx # 2 doctests failed
	sage -t  -force_lib devel/sage/sage/matrix/matrix_mpolynomial_dense.pyx # 2 doctests failed
	sage -t  -force_lib devel/sage/sage/matrix/constructor.py # 2 doctests failed
	sage -t  -force_lib devel/sage/sage/matrix/matrix2.pyx # 3 doctests failed
	sage -t  -force_lib devel/sage/sage/rings/real_mpfi.pyx # 5 doctests failed
	sage -t  -force_lib devel/sage/sage/rings/complex_field.py # 4 doctests failed
	sage -t  -force_lib devel/sage/sage/rings/real_mpfr.pyx # 12 doctests failed
	sage -t  -force_lib devel/sage/sage/rings/complex_interval_field.py # 3 doctests failed
	sage -t  -force_lib devel/sage/sage/tests/cmdline.py # 4 doctests failed
	sage -t  -force_lib devel/sage/sage/misc/randstate.pyx # 13 doctests failed
	sage -t  -force_lib devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py # 2 doctests failed

```
I'll have a look at them tomorrow.

Some of them at least are just changes in random output (e. g. real_mpfr and real_mpfi)



---

archive/issue_comments_120246.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nSome other look more problematic:\n\n```\nsage -t  -force_lib devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py\n  ***   Warning: new stack size = 1003360 (0.957 Mbytes).\n  ***   Warning: new stack size = 1003360 (0.957 Mbytes).\nSaturation index bound = 265\nWARNING: saturation at primes p > 97 will not be done;  \npoints may be unsaturated at primes between 97 and index bound\nFailed to saturate MW basis at primes [ ]\nSaturation index bound = 265\nWARNING: saturation at primes p > 199 will not be done;  \npoints may be unsaturated at primes between 199 and index bound\nFailed to saturate MW basis at primes [ ]\nAfter 10 attempts at enlargement, giving up!\n--points not proved 2-saturated,\n2-saturation failed!\nFailed to saturate MW basis at primes [ 2 ]\n2 After 10 attempts at enlargement, giving up!\n--points not proved 2-saturated,\n2-saturation failed!\nFailed to saturate MW basis at primes [ 2 ]\n\n```\nMaybe because I did not rebuild Pari spkg?\n\nApart from running sage -b I just forced rebuild of libfplll before the above make ptest (because of lack of time).\n\nI'll properly rebuild everything tomorrow and rerun the testsuite.",
    "created_at": "2012-02-16T22:33:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120246",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:36" align="right">comment:36</div>

Some other look more problematic:

```
sage -t  -force_lib devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py
  ***   Warning: new stack size = 1003360 (0.957 Mbytes).
  ***   Warning: new stack size = 1003360 (0.957 Mbytes).
Saturation index bound = 265
WARNING: saturation at primes p > 97 will not be done;  
points may be unsaturated at primes between 97 and index bound
Failed to saturate MW basis at primes [ ]
Saturation index bound = 265
WARNING: saturation at primes p > 199 will not be done;  
points may be unsaturated at primes between 199 and index bound
Failed to saturate MW basis at primes [ ]
After 10 attempts at enlargement, giving up!
--points not proved 2-saturated,
2-saturation failed!
Failed to saturate MW basis at primes [ 2 ]
2 After 10 attempts at enlargement, giving up!
--points not proved 2-saturated,
2-saturation failed!
Failed to saturate MW basis at primes [ 2 ]

```
Maybe because I did not rebuild Pari spkg?

Apart from running sage -b I just forced rebuild of libfplll before the above make ptest (because of lack of time).

I'll properly rebuild everything tomorrow and rerun the testsuite.



---

archive/issue_comments_120247.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nNevermind, the above is potentially just verbosity and not related to the actual errors\n\n```\nFile \"/home/jp/boulot/sage/sage-4.8/devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py\", line 2921:\n    sage: 2 * E.elliptic_exponential(z)\nExpected:\n    (2.04119347066305 - 1.10251372205166*I : 2.23105000976838 - 2.69795281735238*I : 1.00000000000000)\nGot:\n    (-1.52184235874404 - 0.0581413944316544*I : 0.948655866506124 - 0.0381469928565030*I : 1.00000000000000)\n**********************************************************************\nFile \"/home/jp/boulot/sage/sage-4.8/devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py\", line 2923:\n    sage: E.elliptic_exponential(2 * z)\nExpected:\n    (2.04119347066305 - 1.10251372205167*I : 2.23105000976839 - 2.69795281735236*I : 1.00000000000000)\nGot:\n    (-1.52184235874404 - 0.0581413944316562*I : 0.948655866506128 - 0.0381469928565034*I : 1.00000000000000)\n**********************************************************************\n\n```\nAnd the line above defining z implies random so...",
    "created_at": "2012-02-16T22:40:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120247",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:37" align="right">comment:37</div>

Nevermind, the above is potentially just verbosity and not related to the actual errors

```
File "/home/jp/boulot/sage/sage-4.8/devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py", line 2921:
    sage: 2 * E.elliptic_exponential(z)
Expected:
    (2.04119347066305 - 1.10251372205166*I : 2.23105000976838 - 2.69795281735238*I : 1.00000000000000)
Got:
    (-1.52184235874404 - 0.0581413944316544*I : 0.948655866506124 - 0.0381469928565030*I : 1.00000000000000)
**********************************************************************
File "/home/jp/boulot/sage/sage-4.8/devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py", line 2923:
    sage: E.elliptic_exponential(2 * z)
Expected:
    (2.04119347066305 - 1.10251372205167*I : 2.23105000976839 - 2.69795281735236*I : 1.00000000000000)
Got:
    (-1.52184235874404 - 0.0581413944316562*I : 0.948655866506128 - 0.0381469928565034*I : 1.00000000000000)
**********************************************************************

```
And the line above defining z implies random so...



---

archive/issue_comments_120248.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nOn a different system (Debian amd64 experimental on an intel QuadCore2) I get\n\n```\nThe following tests failed:\n\n\tsage -t  -force_lib devel/sage/sage/modules/free_module_element.pyx # 2 doctests failed\n\tsage -t  -force_lib devel/sage/sage/rings/real_mpfi.pyx # 5 doctests failed\n\tsage -t  -force_lib devel/sage/sage/rings/real_mpfr.pyx # 12 doctests failed\n\tsage -t  -force_lib devel/sage/sage/rings/complex_interval_field.py # 3 doctests failed\n\tsage -t  -force_lib devel/sage/sage/rings/complex_field.py # 4 doctests failed\n\tsage -t  -force_lib devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py # 2 doctests failed\n\tsage -t  -force_lib devel/sage/sage/matrix/constructor.py # 2 doctests failed\n\tsage -t  -force_lib devel/sage/sage/matrix/matrix2.pyx # 3 doctests failed\n\tsage -t  -force_lib devel/sage/sage/matrix/matrix_mpolynomial_dense.pyx # 2 doctests failed\n\tsage -t  -force_lib devel/sage/sage/misc/randstate.pyx # 13 doctests failed\n----------------------------------------------------------------------\n\n```\nThis also is on top of 4.8, but I could not launch sage before also rebuilding MPIR which was not necessary on the other system.",
    "created_at": "2012-02-17T11:59:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120248",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:38" align="right">comment:38</div>

On a different system (Debian amd64 experimental on an intel QuadCore2) I get

```
The following tests failed:

	sage -t  -force_lib devel/sage/sage/modules/free_module_element.pyx # 2 doctests failed
	sage -t  -force_lib devel/sage/sage/rings/real_mpfi.pyx # 5 doctests failed
	sage -t  -force_lib devel/sage/sage/rings/real_mpfr.pyx # 12 doctests failed
	sage -t  -force_lib devel/sage/sage/rings/complex_interval_field.py # 3 doctests failed
	sage -t  -force_lib devel/sage/sage/rings/complex_field.py # 4 doctests failed
	sage -t  -force_lib devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py # 2 doctests failed
	sage -t  -force_lib devel/sage/sage/matrix/constructor.py # 2 doctests failed
	sage -t  -force_lib devel/sage/sage/matrix/matrix2.pyx # 3 doctests failed
	sage -t  -force_lib devel/sage/sage/matrix/matrix_mpolynomial_dense.pyx # 2 doctests failed
	sage -t  -force_lib devel/sage/sage/misc/randstate.pyx # 13 doctests failed
----------------------------------------------------------------------

```
This also is on top of 4.8, but I could not launch sage before also rebuilding MPIR which was not necessary on the other system.



---

archive/issue_comments_120249.json:
```json
{
    "body": "Changed work issues from **failing doctests for 32 bits** to **correct doctests**",
    "created_at": "2012-02-17T12:10:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120249",
    "user": "https://github.com/jpflori"
}
```

Changed work issues from **failing doctests for 32 bits** to **correct doctests**



---

archive/issue_comments_120250.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nReplying to [@zimmermann6](#comment:28):\n\n> I tried importing the MPFI spkg+patches (#12171) and that spkg on top of 4.8.alpha6 on a 32-bit Pentium 4 and got the following failures: ` sage -t  \"devel/sage-main/sage/matrix/matrix_mpolynomial_dense.pyx\" sage -t  \"devel/sage-main/sage/matrix/constructor.py\" sage -t  \"devel/sage-main/sage/matrix/matrix2.pyx\" sage -t  \"devel/sage-main/sage/misc/randstate.pyx\" sage -t  \"devel/sage-main/sage/modules/free_module_element.pyx\" sage -t  \"devel/sage-main/sage/rings/real_mpfi.pyx\" sage -t  \"devel/sage-main/sage/rings/complex_field.py\" sage -t  \"devel/sage-main/sage/rings/complex_interval_field.py\" sage -t  \"devel/sage-main/sage/rings/real_mpfr.pyx\" # Killed/crashed sage -t  \"devel/sage-main/sage/schemes/elliptic_curves/ell_rational_field.py\" ` Paul\n\nMy last failures happen in the same files as what you posted some time ago and are always involving some random function.\n\nAs you posted later, this should be because MPFR changed its behavior.\n\nI'll post a patch fixing the doctest, but cannot test it on a 32 bits computer (nor exotic architectures), so I'll leave that to someone else.\n\nThe question is whether this change of behavior is actually a problem ?\n\nIf someone saved old stuff with a given random seed, or something like that, its results will not be reproducible... I do not really feel concerned about that.\n\nIf someone could also test the spkg on sunos, solaris, apple or other exotic oses/cpus combinations, that would be more than welcome.",
    "created_at": "2012-02-17T12:10:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120250",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:39" align="right">comment:39</div>

Replying to [@zimmermann6](#comment:28):

> I tried importing the MPFI spkg+patches (#12171) and that spkg on top of 4.8.alpha6 on a 32-bit Pentium 4 and got the following failures: ` sage -t  "devel/sage-main/sage/matrix/matrix_mpolynomial_dense.pyx" sage -t  "devel/sage-main/sage/matrix/constructor.py" sage -t  "devel/sage-main/sage/matrix/matrix2.pyx" sage -t  "devel/sage-main/sage/misc/randstate.pyx" sage -t  "devel/sage-main/sage/modules/free_module_element.pyx" sage -t  "devel/sage-main/sage/rings/real_mpfi.pyx" sage -t  "devel/sage-main/sage/rings/complex_field.py" sage -t  "devel/sage-main/sage/rings/complex_interval_field.py" sage -t  "devel/sage-main/sage/rings/real_mpfr.pyx" # Killed/crashed sage -t  "devel/sage-main/sage/schemes/elliptic_curves/ell_rational_field.py" ` Paul

My last failures happen in the same files as what you posted some time ago and are always involving some random function.

As you posted later, this should be because MPFR changed its behavior.

I'll post a patch fixing the doctest, but cannot test it on a 32 bits computer (nor exotic architectures), so I'll leave that to someone else.

The question is whether this change of behavior is actually a problem ?

If someone saved old stuff with a given random seed, or something like that, its results will not be reproducible... I do not really feel concerned about that.

If someone could also test the spkg on sunos, solaris, apple or other exotic oses/cpus combinations, that would be more than welcome.



---

archive/issue_comments_120251.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nAfter rebuilding mpir and atlas (which was screwed) on my core i7 setup, here is what I get\n\n```\n----------------------------------------------------------------------\nThe temporary doctesting directory\n   /home/jp/.sage/tmp/jp_x220-9822\nwas not removed: it is not empty, presumably because doctests\nfailed or doctesting was interrupted.\n\n----------------------------------------------------------------------\n\nThe following tests failed:\n\n\tsage -t  -force_lib devel/sage/sage/modular/modsym/space.py # 0 doctests failed\n\tsage -t  -force_lib devel/sage/sage/modules/free_module_element.pyx # 2 doctests failed\n\tsage -t  -force_lib devel/sage/sage/matrix/matrix_mpolynomial_dense.pyx # 2 doctests failed\n\tsage -t  -force_lib devel/sage/sage/matrix/constructor.py # 2 doctests failed\n\tsage -t  -force_lib devel/sage/sage/matrix/matrix2.pyx # 3 doctests failed\n\tsage -t  -force_lib devel/sage/sage/rings/real_mpfi.pyx # 5 doctests failed\n\tsage -t  -force_lib devel/sage/sage/rings/complex_field.py # 4 doctests failed\n\tsage -t  -force_lib devel/sage/sage/rings/real_mpfr.pyx # 12 doctests failed\n\tsage -t  -force_lib devel/sage/sage/rings/complex_interval_field.py # 3 doctests failed\n\tsage -t  -force_lib devel/sage/sage/tests/cmdline.py # 4 doctests failed\n\tsage -t  -force_lib devel/sage/sage/misc/randstate.pyx # 13 doctests failed\n\tsage -t  -force_lib devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py # 2 doctests failed\n\n```\nI guess something went wrong with that installation because the failing doctest in cmdline.pyx really look strange.",
    "created_at": "2012-02-17T17:43:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120251",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:40" align="right">comment:40</div>

After rebuilding mpir and atlas (which was screwed) on my core i7 setup, here is what I get

```
----------------------------------------------------------------------
The temporary doctesting directory
   /home/jp/.sage/tmp/jp_x220-9822
was not removed: it is not empty, presumably because doctests
failed or doctesting was interrupted.

----------------------------------------------------------------------

The following tests failed:

	sage -t  -force_lib devel/sage/sage/modular/modsym/space.py # 0 doctests failed
	sage -t  -force_lib devel/sage/sage/modules/free_module_element.pyx # 2 doctests failed
	sage -t  -force_lib devel/sage/sage/matrix/matrix_mpolynomial_dense.pyx # 2 doctests failed
	sage -t  -force_lib devel/sage/sage/matrix/constructor.py # 2 doctests failed
	sage -t  -force_lib devel/sage/sage/matrix/matrix2.pyx # 3 doctests failed
	sage -t  -force_lib devel/sage/sage/rings/real_mpfi.pyx # 5 doctests failed
	sage -t  -force_lib devel/sage/sage/rings/complex_field.py # 4 doctests failed
	sage -t  -force_lib devel/sage/sage/rings/real_mpfr.pyx # 12 doctests failed
	sage -t  -force_lib devel/sage/sage/rings/complex_interval_field.py # 3 doctests failed
	sage -t  -force_lib devel/sage/sage/tests/cmdline.py # 4 doctests failed
	sage -t  -force_lib devel/sage/sage/misc/randstate.pyx # 13 doctests failed
	sage -t  -force_lib devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py # 2 doctests failed

```
I guess something went wrong with that installation because the failing doctest in cmdline.pyx really look strange.



---

archive/issue_comments_120252.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nReplying to [@nexttime](#comment:27):\n> If you have enough time (and/or the machine is fast enough), you can copy new/updated spkgs into `$SAGE_ROOT/spkg/standard/` and run\n> \n> ```sh\n> $ env SAGE_UPGRADING=yes make build\n> ```\n> afterwards.  That way all dependent packages automatically get rebuilt, which can take some time.\n\nshould I rename new packages with the old name? Or keep the new name?\nFor example Sage 4.8 contains `mpfi-1.3.4-cvs20071125.p9.spkg`. Should I put\n`mpfi-1.5.1.spkg` aside this one, or rename it?\n\nPaul",
    "created_at": "2012-02-17T20:11:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120252",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:41" align="right">comment:41</div>

Replying to [@nexttime](#comment:27):
> If you have enough time (and/or the machine is fast enough), you can copy new/updated spkgs into `$SAGE_ROOT/spkg/standard/` and run
> 
> ```sh
> $ env SAGE_UPGRADING=yes make build
> ```
> afterwards.  That way all dependent packages automatically get rebuilt, which can take some time.

should I rename new packages with the old name? Or keep the new name?
For example Sage 4.8 contains `mpfi-1.3.4-cvs20071125.p9.spkg`. Should I put
`mpfi-1.5.1.spkg` aside this one, or rename it?

Paul



---

archive/issue_comments_120253.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nI just ran the doctests on cicero (skynet) with vanilla 4.8 and all of them pass.\n\nPaul",
    "created_at": "2012-02-20T17:06:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120253",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:42" align="right">comment:42</div>

I just ran the doctests on cicero (skynet) with vanilla 4.8 and all of them pass.

Paul



---

archive/issue_comments_120254.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nJust to confirm my above statements, on a third amd64 ubuntu system, I get the same errors as above, except the two \"strange\" ones, i.e. cmdline.py and space.py.",
    "created_at": "2012-02-21T08:20:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120254",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:43" align="right">comment:43</div>

Just to confirm my above statements, on a third amd64 ubuntu system, I get the same errors as above, except the two "strange" ones, i.e. cmdline.py and space.py.



---

archive/issue_comments_120255.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nAnd those last tests were on top sage-5.0.beta4",
    "created_at": "2012-02-21T08:29:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120255",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:44" align="right">comment:44</div>

And those last tests were on top sage-5.0.beta4



---

archive/issue_comments_120256.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nI've had a look at the random MPFR real number generation code and there was indeed a \"hack\" for 32 bits systems before which requested more bits (31 from randstate doc, although real_mpfr says 32) from MPIR to get an equivalent MPFR behavior. Although, if I force sage to do the same on my 64 bits system (just adding a call to rstate.c_random() unconditionally in real_mpfr), I do not get what 32 bits (and 64 bits) systems used to return (nor what my 64 bits system now return which was to expect).\n\nPaul, I'm confused by your last message. By vanilla 4.8, do you mean vanilla+this ticket and dependencies? If that's the case, and I somehow understand correctly the random generation stuff of MPIR and MPFR which should both be hardware independent now, the change I made above should give me a similar behavior as you on a 32 bits system and get no doctest failures.\n\nFor example the last failing test in real_mpfr used to give\n\n```\n0.979095507956490\n\n```\nWith this ticket and dependencies, I get (on all of my 64 systems)\n\n```\n-0.616678906367394\n\n```\nWith the additional call to c_random() I get (on all of my 64 systems)\n\n```\n0.681934947736557\n```",
    "created_at": "2012-02-21T09:54:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120256",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:45" align="right">comment:45</div>

I've had a look at the random MPFR real number generation code and there was indeed a "hack" for 32 bits systems before which requested more bits (31 from randstate doc, although real_mpfr says 32) from MPIR to get an equivalent MPFR behavior. Although, if I force sage to do the same on my 64 bits system (just adding a call to rstate.c_random() unconditionally in real_mpfr), I do not get what 32 bits (and 64 bits) systems used to return (nor what my 64 bits system now return which was to expect).

Paul, I'm confused by your last message. By vanilla 4.8, do you mean vanilla+this ticket and dependencies? If that's the case, and I somehow understand correctly the random generation stuff of MPIR and MPFR which should both be hardware independent now, the change I made above should give me a similar behavior as you on a 32 bits system and get no doctest failures.

For example the last failing test in real_mpfr used to give

```
0.979095507956490

```
With this ticket and dependencies, I get (on all of my 64 systems)

```
-0.616678906367394

```
With the additional call to c_random() I get (on all of my 64 systems)

```
0.681934947736557
```



---

archive/issue_comments_120257.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\n> Paul, I'm confused by your last message. By vanilla 4.8, do you mean vanilla+this ticket and dependencies? \n\nno, I just meant vanilla 4.8. This was just to make sure that potential failing doctests did not fail before this patch.\n\nNow with #12171 all doctests still pass (with one timeout even with `-long`,\nfor a test taking more than half an hour).\n\nI'll now try with this spkg.\n\nPaul",
    "created_at": "2012-02-21T11:09:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120257",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:46" align="right">comment:46</div>

> Paul, I'm confused by your last message. By vanilla 4.8, do you mean vanilla+this ticket and dependencies? 

no, I just meant vanilla 4.8. This was just to make sure that potential failing doctests did not fail before this patch.

Now with #12171 all doctests still pass (with one timeout even with `-long`,
for a test taking more than half an hour).

I'll now try with this spkg.

Paul



---

archive/issue_comments_120258.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nReplying to [@zimmermann6](#comment:46):\n\n> no, I just meant vanilla 4.8. This was just to make sure that potential failing doctests did not fail before this patch.\n\nThat's good news for the tests I ran above. I guess the piece of hack in real_mpfr should now be removed. Could you try running the tests with and without the c_random() stuff in real_mpfr and post the values you get for the last failing (I guess it will fail as well) in real_mpfr (on 32 bits I mean)?\n\nThe bad news is that we won't be able (or it will be very hackish???) to reproduce the previous behavior of Sage, thus breaking all use code depending on the deterministic behavior of PRNG.",
    "created_at": "2012-02-21T11:31:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120258",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:47" align="right">comment:47</div>

Replying to [@zimmermann6](#comment:46):

> no, I just meant vanilla 4.8. This was just to make sure that potential failing doctests did not fail before this patch.

That's good news for the tests I ran above. I guess the piece of hack in real_mpfr should now be removed. Could you try running the tests with and without the c_random() stuff in real_mpfr and post the values you get for the last failing (I guess it will fail as well) in real_mpfr (on 32 bits I mean)?

The bad news is that we won't be able (or it will be very hackish???) to reproduce the previous behavior of Sage, thus breaking all use code depending on the deterministic behavior of PRNG.



---

archive/issue_comments_120259.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\n> Could you try running the tests with and without the c_random() stuff in real_mpfr [...]\n\nok, I'll first run the tests with the attached spkg. Currently running\n`env SAGE_UPGRADING=yes make build`, this will take some time since cicero is slow.\n\nPaul",
    "created_at": "2012-02-21T11:50:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120259",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:48" align="right">comment:48</div>

> Could you try running the tests with and without the c_random() stuff in real_mpfr [...]

ok, I'll first run the tests with the attached spkg. Currently running
`env SAGE_UPGRADING=yes make build`, this will take some time since cicero is slow.

Paul



---

archive/issue_comments_120260.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nJean-Pierre,\n\n> I've had a look at the random MPFR real number generation code and there was indeed a \"hack\" for 32 bits systems before which requested more bits (31 from randstate doc, although real_mpfr says 32) from MPIR to get an equivalent MPFR behavior. Although, if I force sage to do the same on my 64 bits system (just adding a call to rstate.c_random() unconditionally in real_mpfr), I do not get what 32 bits (and 64 bits) systems used to return (nor what my 64 bits system now return which was to expect).\n\nthis is expected. If you add the call to `rstate.c_random()` unconditionally,\nthen on 64-bit systems you will draw 64 extra random bits when the precision mod 64 is between 1 and 32, whereas on 32-bit systems you will draw only 32 extra random bits.\n\nIn fact, since version 3.1.0, MPFR leaves the GMP random generator in the same state,\nwhatever the number of bits per limb. See changeset 7133 from MPFR, and\nhttp://gmplib.org/list-archives/gmp-devel/2010-September/001642.html. Thus the fix is\nsimply to remove the \"gross hack\" at lines 930-942 in real_mpfr.pyx.\n\nPaul",
    "created_at": "2012-02-21T12:15:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120260",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:49" align="right">comment:49</div>

Jean-Pierre,

> I've had a look at the random MPFR real number generation code and there was indeed a "hack" for 32 bits systems before which requested more bits (31 from randstate doc, although real_mpfr says 32) from MPIR to get an equivalent MPFR behavior. Although, if I force sage to do the same on my 64 bits system (just adding a call to rstate.c_random() unconditionally in real_mpfr), I do not get what 32 bits (and 64 bits) systems used to return (nor what my 64 bits system now return which was to expect).

this is expected. If you add the call to `rstate.c_random()` unconditionally,
then on 64-bit systems you will draw 64 extra random bits when the precision mod 64 is between 1 and 32, whereas on 32-bit systems you will draw only 32 extra random bits.

In fact, since version 3.1.0, MPFR leaves the GMP random generator in the same state,
whatever the number of bits per limb. See changeset 7133 from MPFR, and
http://gmplib.org/list-archives/gmp-devel/2010-September/001642.html. Thus the fix is
simply to remove the "gross hack" at lines 930-942 in real_mpfr.pyx.

Paul



---

archive/issue_comments_120261.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nFrom what i saw in randstate, c_random calls gmp_urandomb_ui(self.gmp_state, 31).\n\nSo this has different behaviors on the gmp rand internal state on 32 and 64 bits ?\n\nI expected that it didn't, so that adding a call to c_random() even on 64 bits (just to see, I don't plan on integrating it to Sage, removing the hack is indeed the right solution) would produce identical behaviors on 32 and 64 bits, whence my request for you to test it (in fact with the hack and without it, not with a call to c_random added, on 32 bits).\n\nI also had little hope that it could revert the real PNRG to its previous behavior for a given seed (in order not to break existing code, outside Sage source tree I mean).\n\nAnyway, if the mpfr code changed, its completely understandable that the random output changes, even with the same seed, so this is hopeless and not really harmful (to me at least).\n\nAnyway, if you confirm that you get the same values that I get (with no call to c_random at all, ie without the hackish section only running on 32 bits currently), I'll post patches to remove the hack section and correct the doctests.\n",
    "created_at": "2012-02-21T12:37:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120261",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:50" align="right">comment:50</div>

From what i saw in randstate, c_random calls gmp_urandomb_ui(self.gmp_state, 31).

So this has different behaviors on the gmp rand internal state on 32 and 64 bits ?

I expected that it didn't, so that adding a call to c_random() even on 64 bits (just to see, I don't plan on integrating it to Sage, removing the hack is indeed the right solution) would produce identical behaviors on 32 and 64 bits, whence my request for you to test it (in fact with the hack and without it, not with a call to c_random added, on 32 bits).

I also had little hope that it could revert the real PNRG to its previous behavior for a given seed (in order not to break existing code, outside Sage source tree I mean).

Anyway, if the mpfr code changed, its completely understandable that the random output changes, even with the same seed, so this is hopeless and not really harmful (to me at least).

Anyway, if you confirm that you get the same values that I get (with no call to c_random at all, ie without the hackish section only running on 32 bits currently), I'll post patches to remove the hack section and correct the doctests.




---

archive/issue_comments_120262.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\n> From what i saw in randstate, c_random calls gmp_urandomb_ui(self.gmp_state, 31).\n> So this has different behaviors on the gmp rand internal state on 32 and 64 bits ?\n\nno it shouldn't. But beware that Sage uses MPIR, not GMP. We should check that MPIR\ngives the same behaviour for the random state on 32-bit and 64-bit processors.\n\nI'll tell you what I get as soon as `make build` finished...\n\nPaul",
    "created_at": "2012-02-21T12:52:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120262",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:51" align="right">comment:51</div>

> From what i saw in randstate, c_random calls gmp_urandomb_ui(self.gmp_state, 31).
> So this has different behaviors on the gmp rand internal state on 32 and 64 bits ?

no it shouldn't. But beware that Sage uses MPIR, not GMP. We should check that MPIR
gives the same behaviour for the random state on 32-bit and 64-bit processors.

I'll tell you what I get as soon as `make build` finished...

Paul



---

archive/issue_comments_120263.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nThe files randbui.c where gmp_urandomb_ui is defined are similar in GMP (5.04) and MPIR (2.1.3.p9 in Sage).\n\nThey only call _gmp_rand defined in gmp-impl.h which looks quite similar as well (in fact I saw no diff but did not check completely, there could be some black magic somewhere deep enough).\n\nFrom what I see in integer_ring.pyx and more specifically in the _randomize_mpz function where c_random is called as well, there is no different sections for 32 and 64 bits, nor different doctest in randstate.pyx (only rgp from Pari does change), so I guess it is not that unsafe to assume that MPIR behaves the same for both.",
    "created_at": "2012-02-21T13:15:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120263",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:52" align="right">comment:52</div>

The files randbui.c where gmp_urandomb_ui is defined are similar in GMP (5.04) and MPIR (2.1.3.p9 in Sage).

They only call _gmp_rand defined in gmp-impl.h which looks quite similar as well (in fact I saw no diff but did not check completely, there could be some black magic somewhere deep enough).

From what I see in integer_ring.pyx and more specifically in the _randomize_mpz function where c_random is called as well, there is no different sections for 32 and 64 bits, nor different doctest in randstate.pyx (only rgp from Pari does change), so I guess it is not that unsafe to assume that MPIR behaves the same for both.



---

archive/issue_comments_120264.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nJean-Pierre,\n\nthe test of `real_mpfr` failed with a Segmentation fault on cicero. However I get\nthe following with the \"gross hack\" on cicero (32-bit Pentium 4):\n\n```\n\n----------------------------------------------------------------------\n| Sage Version 4.8, Release Date: 2012-01-20                         |\n| Type notebook() for the GUI, and license() for information.        |\n----------------------------------------------------------------------\nsage: R=RealField(65)\nsage: set_random_seed(42)\nsage: R.random_element()\n0.9396630990748764761\nsage: R.random_element()\n0.2987261287446042432\n```\nand without the \"gross hack\":\n\n```\n\n----------------------------------------------------------------------\n| Sage Version 4.8, Release Date: 2012-01-20                         |\n| Type notebook() for the GUI, and license() for information.        |\n----------------------------------------------------------------------\nsage: R=RealField(65)\nsage: set_random_seed(42)\nsage: R.random_element()\n0.7846023201112678858\nsage: R.random_element()\n0.3289891249716495404\n```\nYou should be able to reproduce the later on a 64-bit machine.\n\nPaul",
    "created_at": "2012-02-21T16:58:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120264",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:53" align="right">comment:53</div>

Jean-Pierre,

the test of `real_mpfr` failed with a Segmentation fault on cicero. However I get
the following with the "gross hack" on cicero (32-bit Pentium 4):

```

----------------------------------------------------------------------
| Sage Version 4.8, Release Date: 2012-01-20                         |
| Type notebook() for the GUI, and license() for information.        |
----------------------------------------------------------------------
sage: R=RealField(65)
sage: set_random_seed(42)
sage: R.random_element()
0.9396630990748764761
sage: R.random_element()
0.2987261287446042432
```
and without the "gross hack":

```

----------------------------------------------------------------------
| Sage Version 4.8, Release Date: 2012-01-20                         |
| Type notebook() for the GUI, and license() for information.        |
----------------------------------------------------------------------
sage: R=RealField(65)
sage: set_random_seed(42)
sage: R.random_element()
0.7846023201112678858
sage: R.random_element()
0.3289891249716495404
```
You should be able to reproduce the later on a 64-bit machine.

Paul



---

archive/issue_comments_120265.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nIndeed.\n\nWhen forcing the call to c_random(), I get\n\n```\n----------------------------------------------------------------------\n| Sage Version 4.8, Release Date: 2012-01-20                         |\n| Type notebook() for the GUI, and license() for information.        |\n----------------------------------------------------------------------\nLoading Sage library. Current Mercurial branch is: mpfr\nsage: R=RealField(65)\nsage: set_random_seed(42)\nsage: R.random_element()\n0.9396630990748764761\nsage: R.random_element()\n0.2987261287446042432\n\n```\nAnd with \"normal\" behavior:\n\n```\n----------------------------------------------------------------------\n| Sage Version 4.8, Release Date: 2012-01-20                         |\n| Type notebook() for the GUI, and license() for information.        |\n----------------------------------------------------------------------\nLoading Sage library. Current Mercurial branch is: mpfr\nsage: R=RealField(65)    \nsage: set_random_seed(42)\nsage: R.random_element() \n0.7846023201112678858\nsage: R.random_element() \n0.3289891249716495404\n\n```\nSo everything looks fine, except for the segfault you got.\n\nHopefully, I'll provide patches for removing the hackish section and fixing the doctests tomorrow.",
    "created_at": "2012-02-21T17:04:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120265",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:54" align="right">comment:54</div>

Indeed.

When forcing the call to c_random(), I get

```
----------------------------------------------------------------------
| Sage Version 4.8, Release Date: 2012-01-20                         |
| Type notebook() for the GUI, and license() for information.        |
----------------------------------------------------------------------
Loading Sage library. Current Mercurial branch is: mpfr
sage: R=RealField(65)
sage: set_random_seed(42)
sage: R.random_element()
0.9396630990748764761
sage: R.random_element()
0.2987261287446042432

```
And with "normal" behavior:

```
----------------------------------------------------------------------
| Sage Version 4.8, Release Date: 2012-01-20                         |
| Type notebook() for the GUI, and license() for information.        |
----------------------------------------------------------------------
Loading Sage library. Current Mercurial branch is: mpfr
sage: R=RealField(65)    
sage: set_random_seed(42)
sage: R.random_element() 
0.7846023201112678858
sage: R.random_element() 
0.3289891249716495404

```
So everything looks fine, except for the segfault you got.

Hopefully, I'll provide patches for removing the hackish section and fixing the doctests tomorrow.



---

archive/issue_comments_120266.json:
```json
{
    "body": "Changed keywords from **sd32 MPFR spkg wishlist sd35.5** to **sd36 sd32 MPFR spkg wishlist sd35.5**",
    "created_at": "2012-02-21T19:19:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120266",
    "user": "https://github.com/vbraun"
}
```

Changed keywords from **sd32 MPFR spkg wishlist sd35.5** to **sd36 sd32 MPFR spkg wishlist sd35.5**



---

archive/issue_comments_120267.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nWe want to work on the FLINT update at Sage Days 36 so I'll give this a try. I have access to a i7-920 running Linux i386 so it would be easy to test.",
    "created_at": "2012-02-21T19:19:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120267",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:55" align="right">comment:55</div>

We want to work on the FLINT update at Sage Days 36 so I'll give this a try. I have access to a i7-920 running Linux i386 so it would be easy to test.



---

archive/issue_comments_120268.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">comment:56</div>\n\nThe segfault is from \n\n```\nsage: R = RealField(2147483647)\n```\nbecause MPFR contains code like\n\n```\n        _srcs  = (_srcprec  + GMP_NUMB_BITS-1)/GMP_NUMB_BITS;         \n        _dests = (_destprec + GMP_NUMB_BITS-1)/GMP_NUMB_BITS - _srcs; \n```\nThis gives an int overflow when `prec=INT_MAX`, and soon after as segfault because the buffer sizes are wrong.",
    "created_at": "2012-02-21T21:53:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120268",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:56" align="right">comment:56</div>

The segfault is from 

```
sage: R = RealField(2147483647)
```
because MPFR contains code like

```
        _srcs  = (_srcprec  + GMP_NUMB_BITS-1)/GMP_NUMB_BITS;         
        _dests = (_destprec + GMP_NUMB_BITS-1)/GMP_NUMB_BITS - _srcs; 
```
This gives an int overflow when `prec=INT_MAX`, and soon after as segfault because the buffer sizes are wrong.



---

archive/issue_comments_120269.json:
```json
{
    "body": "Initial patch",
    "created_at": "2012-02-21T23:49:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120269",
    "user": "https://github.com/vbraun"
}
```

Initial patch



---

archive/issue_comments_120270.json:
```json
{
    "body": "Attachment: **[trac_11666_remove_random_hack.patch.gz](https://github.com/sagemath/sage/files/ticket11666/trac_11666_remove_random_hack.patch.gz)**\n\nInitial patch",
    "created_at": "2012-02-21T23:49:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120270",
    "user": "https://github.com/vbraun"
}
```

Attachment: **[trac_11666_remove_random_hack.patch.gz](https://github.com/sagemath/sage/files/ticket11666/trac_11666_remove_random_hack.patch.gz)**

Initial patch



---

archive/issue_comments_120271.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">comment:57</div>\n\nAttachment: **[trac_11666_fix_random_doctests.patch.gz](https://github.com/sagemath/sage/files/ticket11666/trac_11666_fix_random_doctests.patch.gz)**\n\nI think the easiest solution is to limit the maximal precision in Sage to be slightly below 32-bit INT_MAX. The attached patches do that.",
    "created_at": "2012-02-21T23:51:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120271",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:57" align="right">comment:57</div>

Attachment: **[trac_11666_fix_random_doctests.patch.gz](https://github.com/sagemath/sage/files/ticket11666/trac_11666_fix_random_doctests.patch.gz)**

I think the easiest solution is to limit the maximal precision in Sage to be slightly below 32-bit INT_MAX. The attached patches do that.



---

archive/issue_comments_120272.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,29 +2,8 @@\n \n Use http://perso.telecom-paristech.fr/~flori/sage/mpfr-3.1.0.spkg\n \n----\n-**MPFR 3.0.1** was released on April 4th 2011; there are already some [additional upstream patches](http://www.mpfr.org/mpfr-current/allpatches) for that version; see [http://www.mpfr.org/mpfr-current/](http://www.mpfr.org/mpfr-current/).\n+Apply:\n+* [attachment: trac_11666_remove_random_hack.patch](https://github.com/sagemath/sage/files/ticket11666/trac_11666_remove_random_hack.patch.gz)\n+* [attachment: trac_11666_reduce_precision_max.patch](https://github.com/sagemath/sage/files/ticket11666/trac_11666_reduce_precision_max.patch.gz)\n+* [attachment: trac_11666_fix_random_doctests.patch](https://github.com/sagemath/sage/files/ticket11666/trac_11666_fix_random_doctests.patch.gz)\n \n----\n-**MPFR 3.1.0** [has been released October 3rd 2011](http://www.mpfr.org/mpfr-3.1.0/).\n-\n-## Changes from versions 3.0.* to version 3.1.0:\n-* The MPFR source has been reorganized.\n-* Dropped `ansi2knr` support.\n-* TLS support is now detected automatically. If TLS is supported, MPFR is built as thread safe by default. To disable TLS explicitly, configure MPFR with `--disable-thread-safe`.\n-* New `--enable-gmp-internals` `configure` option to use GMP's undocumented functions (not from the public API). Note that library versioning is not guaranteed to work if this option is used.\n-* The `mpfr_urandom()` and `mpfr_urandomb()` functions now return identical values on processors with different word size (assuming the same random seed, and since the GMP random generator does not depend itself on the word size, cf. [http://gmplib.org/list-archives/gmp-devel/2010-September/001642.html](http://gmplib.org/list-archives/gmp-devel/2010-September/001642.html)).\n-* The `mpfr_add_one_ulp()` and `mpfr_sub_one_ulp()` macros (which are obsolete and no more documented) will be removed in a future release.\n-* Speed improvement for the `mpfr_sqr()` and `mpfr_div()` functions using Mulders' algorithm. As a consequence, other functions using those routines are also faster.\n-* Much faster formatted output (`mpfr_printf()`, etc.) with `%Rg` and similar.\n-* The `--with-gmp-build` `configure` option can now be used when the GMP source directory and the GMP build directory are different (without having to copy header files manually as before).\n-* New functions `mpfr_buildopt_tune_case()`, `mpfr_frexp()`, `mpfr_grandom()` and `mpfr_z_sub()`.\n-* New division-by-zero exception (flag) and associated functions.\n-* The `mpfr.h` header can be included several times, while still supporting optional functions (see Section \"Headers and Libraries\" in the manual).\n-* Updated tuning parameters.\n-* Improved MPFR manual.\n-* MPFR tests: `libtool` no longer generates wrapper scripts with `make check` (so that running the tests under `valgrind` or `gdb` is easier).\n-* Bug fixes.\n- Note: The `mpfr_subnormalize()` implementation up to MPFR 3.0.0 did not change the flags. In particular, it did not follow the generic rule concerning the inexact flag (and no special behavior was specified). The case of the underflow flag was more a lack of specification.\n-\n-Tarballs are available in various formats (regarding the compression method); a bzipped one can be found [here](http://www.mpfr.org/mpfr-3.1.0/mpfr-3.1.0.tar.bz2) (upstream).\n``````\n",
    "created_at": "2012-02-21T23:51:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120272",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,29 +2,8 @@
 
 Use http://perso.telecom-paristech.fr/~flori/sage/mpfr-3.1.0.spkg
 
----
-**MPFR 3.0.1** was released on April 4th 2011; there are already some [additional upstream patches](http://www.mpfr.org/mpfr-current/allpatches) for that version; see [http://www.mpfr.org/mpfr-current/](http://www.mpfr.org/mpfr-current/).
+Apply:
+* [attachment: trac_11666_remove_random_hack.patch](https://github.com/sagemath/sage/files/ticket11666/trac_11666_remove_random_hack.patch.gz)
+* [attachment: trac_11666_reduce_precision_max.patch](https://github.com/sagemath/sage/files/ticket11666/trac_11666_reduce_precision_max.patch.gz)
+* [attachment: trac_11666_fix_random_doctests.patch](https://github.com/sagemath/sage/files/ticket11666/trac_11666_fix_random_doctests.patch.gz)
 
----
-**MPFR 3.1.0** [has been released October 3rd 2011](http://www.mpfr.org/mpfr-3.1.0/).
-
-## Changes from versions 3.0.* to version 3.1.0:
-* The MPFR source has been reorganized.
-* Dropped `ansi2knr` support.
-* TLS support is now detected automatically. If TLS is supported, MPFR is built as thread safe by default. To disable TLS explicitly, configure MPFR with `--disable-thread-safe`.
-* New `--enable-gmp-internals` `configure` option to use GMP's undocumented functions (not from the public API). Note that library versioning is not guaranteed to work if this option is used.
-* The `mpfr_urandom()` and `mpfr_urandomb()` functions now return identical values on processors with different word size (assuming the same random seed, and since the GMP random generator does not depend itself on the word size, cf. [http://gmplib.org/list-archives/gmp-devel/2010-September/001642.html](http://gmplib.org/list-archives/gmp-devel/2010-September/001642.html)).
-* The `mpfr_add_one_ulp()` and `mpfr_sub_one_ulp()` macros (which are obsolete and no more documented) will be removed in a future release.
-* Speed improvement for the `mpfr_sqr()` and `mpfr_div()` functions using Mulders' algorithm. As a consequence, other functions using those routines are also faster.
-* Much faster formatted output (`mpfr_printf()`, etc.) with `%Rg` and similar.
-* The `--with-gmp-build` `configure` option can now be used when the GMP source directory and the GMP build directory are different (without having to copy header files manually as before).
-* New functions `mpfr_buildopt_tune_case()`, `mpfr_frexp()`, `mpfr_grandom()` and `mpfr_z_sub()`.
-* New division-by-zero exception (flag) and associated functions.
-* The `mpfr.h` header can be included several times, while still supporting optional functions (see Section "Headers and Libraries" in the manual).
-* Updated tuning parameters.
-* Improved MPFR manual.
-* MPFR tests: `libtool` no longer generates wrapper scripts with `make check` (so that running the tests under `valgrind` or `gdb` is easier).
-* Bug fixes.
- Note: The `mpfr_subnormalize()` implementation up to MPFR 3.0.0 did not change the flags. In particular, it did not follow the generic rule concerning the inexact flag (and no special behavior was specified). The case of the underflow flag was more a lack of specification.
-
-Tarballs are available in various formats (regarding the compression method); a bzipped one can be found [here](http://www.mpfr.org/mpfr-3.1.0/mpfr-3.1.0.tar.bz2) (upstream).
``````




---

archive/issue_comments_120273.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">comment:58</div>\n\nReported upstream at https://gforge.inria.fr/tracker/index.php?func=detail&aid=13918&group_id=136&atid=619",
    "created_at": "2012-02-22T00:29:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120273",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:58" align="right">comment:58</div>

Reported upstream at https://gforge.inria.fr/tracker/index.php?func=detail&aid=13918&group_id=136&atid=619



---

archive/issue_events_154815.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2012-02-22T00:29:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11666#event-154815"
}
```



---

archive/issue_events_154816.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2012-02-22T00:29:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11666#event-154816"
}
```



---

archive/issue_comments_120274.json:
```json
{
    "body": "Upstream: **Reported upstream. Little or no feedback.**",
    "created_at": "2012-02-22T00:29:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120274",
    "user": "https://github.com/vbraun"
}
```

Upstream: **Reported upstream. Little or no feedback.**



---

archive/issue_comments_120275.json:
```json
{
    "body": "Changed upstream from **Reported upstream. Little or no feedback.** to **Reported upstream. Developers acknowledge bug.**",
    "created_at": "2012-02-22T04:49:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120275",
    "user": "https://github.com/vbraun"
}
```

Changed upstream from **Reported upstream. Little or no feedback.** to **Reported upstream. Developers acknowledge bug.**



---

archive/issue_comments_120276.json:
```json
{
    "body": "Changed author from **Mike Hansen, Jean-Pierre Flori** to **Mike Hansen, Jean-Pierre Flori, Volker Braun**",
    "created_at": "2012-02-22T04:49:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120276",
    "user": "https://github.com/vbraun"
}
```

Changed author from **Mike Hansen, Jean-Pierre Flori** to **Mike Hansen, Jean-Pierre Flori, Volker Braun**



---

archive/issue_comments_120277.json:
```json
{
    "body": "Changed work issues from **correct doctests** to none",
    "created_at": "2012-02-22T04:49:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120277",
    "user": "https://github.com/vbraun"
}
```

Changed work issues from **correct doctests** to none



---

archive/issue_comments_120278.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">comment:59</div>\n\nI ran the doctests on 32-bit and 64-bit machines and they work.",
    "created_at": "2012-02-22T04:49:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120278",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:59" align="right">comment:59</div>

I ran the doctests on 32-bit and 64-bit machines and they work.



---

archive/issue_comments_120279.json:
```json
{
    "body": "Work Issues: **rebase on #12366**",
    "created_at": "2012-02-22T08:32:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120279",
    "user": "https://github.com/jpflori"
}
```

Work Issues: **rebase on #12366**



---

archive/issue_comments_120280.json:
```json
{
    "body": "Changed reviewer from **Paul Zimmermann** to **Paul Zimmermann, Jean-Pierre Flori**",
    "created_at": "2012-02-22T08:32:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120280",
    "user": "https://github.com/jpflori"
}
```

Changed reviewer from **Paul Zimmermann** to **Paul Zimmermann, Jean-Pierre Flori**



---

archive/issue_comments_120281.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">comment:60</div>\n\nAs I commented above, the current package needs to be rebased on #12366.\n\nI'm doing it right now. I'll also fix the MPFI package so everything can finally be merged.\n\nI had a look at your patches and have nothing to say :) So once I upload the new spkg, I guess it will be positive_review.",
    "created_at": "2012-02-22T08:32:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120281",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:60" align="right">comment:60</div>

As I commented above, the current package needs to be rebased on #12366.

I'm doing it right now. I'll also fix the MPFI package so everything can finally be merged.

I had a look at your patches and have nothing to say :) So once I upload the new spkg, I guess it will be positive_review.



---

archive/issue_events_154817.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2012-02-22T08:32:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11666#event-154817"
}
```



---

archive/issue_events_154818.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2012-02-22T08:32:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11666#event-154818"
}
```



---

archive/issue_events_154819.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2012-02-22T10:27:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11666#event-154819"
}
```



---

archive/issue_events_154820.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2012-02-22T10:27:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11666#event-154820"
}
```



---

archive/issue_comments_120282.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">comment:61</div>\n\nUpdated spkg is available at [http://perso.telecom-paristech.fr/~flori/sage/mpfr-3.1.0.p0.spkg](http://perso.telecom-paristech.fr/%7Eflori/sage/mpfr-3.1.0.spkg)",
    "created_at": "2012-02-22T10:27:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120282",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:61" align="right">comment:61</div>

Updated spkg is available at [http://perso.telecom-paristech.fr/~flori/sage/mpfr-3.1.0.p0.spkg](http://perso.telecom-paristech.fr/%7Eflori/sage/mpfr-3.1.0.spkg)



---

archive/issue_comments_120283.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,9 +1,9 @@\n Our current MPFR spkg is fairly old (based on **MPFR 2.4.2**), and upgrading it to the latest [stable] upstream release is now on the [high-priority wishlist](http://wiki.sagemath.org/days32/wishlist).\n \n-Use http://perso.telecom-paristech.fr/~flori/sage/mpfr-3.1.0.spkg\n+Use [http://perso.telecom-paristech.fr/~flori/sage/mpfr-3.1.0.p0.spkg](http://perso.telecom-paristech.fr/~flori/sage/mpfr-3.1.0.spkg)\n \n Apply:\n+\n * [attachment: trac_11666_remove_random_hack.patch](https://github.com/sagemath/sage/files/ticket11666/trac_11666_remove_random_hack.patch.gz)\n * [attachment: trac_11666_reduce_precision_max.patch](https://github.com/sagemath/sage/files/ticket11666/trac_11666_reduce_precision_max.patch.gz)\n * [attachment: trac_11666_fix_random_doctests.patch](https://github.com/sagemath/sage/files/ticket11666/trac_11666_fix_random_doctests.patch.gz)\n-\n``````\n",
    "created_at": "2012-02-22T10:27:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120283",
    "user": "https://github.com/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,9 +1,9 @@
 Our current MPFR spkg is fairly old (based on **MPFR 2.4.2**), and upgrading it to the latest [stable] upstream release is now on the [high-priority wishlist](http://wiki.sagemath.org/days32/wishlist).
 
-Use http://perso.telecom-paristech.fr/~flori/sage/mpfr-3.1.0.spkg
+Use [http://perso.telecom-paristech.fr/~flori/sage/mpfr-3.1.0.p0.spkg](http://perso.telecom-paristech.fr/~flori/sage/mpfr-3.1.0.spkg)
 
 Apply:
+
 * [attachment: trac_11666_remove_random_hack.patch](https://github.com/sagemath/sage/files/ticket11666/trac_11666_remove_random_hack.patch.gz)
 * [attachment: trac_11666_reduce_precision_max.patch](https://github.com/sagemath/sage/files/ticket11666/trac_11666_reduce_precision_max.patch.gz)
 * [attachment: trac_11666_fix_random_doctests.patch](https://github.com/sagemath/sage/files/ticket11666/trac_11666_fix_random_doctests.patch.gz)
-
``````




---

archive/issue_comments_120284.json:
```json
{
    "body": "Changed work issues from **rebase on #12366** to none",
    "created_at": "2012-02-22T10:27:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120284",
    "user": "https://github.com/jpflori"
}
```

Changed work issues from **rebase on #12366** to none



---

archive/issue_comments_120285.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">comment:62</div>\n\nThe above link doesn't point to the right file when clicked...\n\n[http://perso.telecom-paristech.fr/~flori/sage/mpfr-3.1.0.p0.spkg](http://perso.telecom-paristech.fr/%7Eflori/sage/mpfr-3.1.0.p0.spkg)\n\nThis one should be ok.",
    "created_at": "2012-02-22T10:28:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120285",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:62" align="right">comment:62</div>

The above link doesn't point to the right file when clicked...

[http://perso.telecom-paristech.fr/~flori/sage/mpfr-3.1.0.p0.spkg](http://perso.telecom-paristech.fr/%7Eflori/sage/mpfr-3.1.0.p0.spkg)

This one should be ok.



---

archive/issue_comments_120286.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n Our current MPFR spkg is fairly old (based on **MPFR 2.4.2**), and upgrading it to the latest [stable] upstream release is now on the [high-priority wishlist](http://wiki.sagemath.org/days32/wishlist).\n \n-Use [http://perso.telecom-paristech.fr/~flori/sage/mpfr-3.1.0.p0.spkg](http://perso.telecom-paristech.fr/~flori/sage/mpfr-3.1.0.spkg)\n+Use\u00a0http://perso.telecom-paristech.fr/~flori/sage/mpfr-3.1.0.p0.spkg\n \n Apply:\n \n``````\n",
    "created_at": "2012-02-22T10:28:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120286",
    "user": "https://github.com/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 Our current MPFR spkg is fairly old (based on **MPFR 2.4.2**), and upgrading it to the latest [stable] upstream release is now on the [high-priority wishlist](http://wiki.sagemath.org/days32/wishlist).
 
-Use [http://perso.telecom-paristech.fr/~flori/sage/mpfr-3.1.0.p0.spkg](http://perso.telecom-paristech.fr/~flori/sage/mpfr-3.1.0.spkg)
+UseÂ http://perso.telecom-paristech.fr/~flori/sage/mpfr-3.1.0.p0.spkg
 
 Apply:
 
``````




---

archive/issue_comments_120287.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">comment:63</div>\n\nAll test passed on my amd64 system.\n\nIf someone could have a final look at the updated spkg, I guess this can be finally set as positive_review.",
    "created_at": "2012-02-22T11:36:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120287",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:63" align="right">comment:63</div>

All test passed on my amd64 system.

If someone could have a final look at the updated spkg, I guess this can be finally set as positive_review.



---

archive/issue_comments_120288.json:
```json
{
    "body": "<div id=\"comment:64\" align=\"right\">comment:64</div>\n\nThe Solaris patch is applied to the wrong directory, it is currenty doing `cp ../patches/mpn_exp.c mpn_exp.c` but if you want to overwrite the MPFR source then you should do `cp ../patches/mpn_exp.c src/mpn_exp.c` (there is a `src/src` directory in MPFR-3.1.0, this was just `src/` in the old MPFR). Can you fix this as well?",
    "created_at": "2012-02-22T19:58:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120288",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:64" align="right">comment:64</div>

The Solaris patch is applied to the wrong directory, it is currenty doing `cp ../patches/mpn_exp.c mpn_exp.c` but if you want to overwrite the MPFR source then you should do `cp ../patches/mpn_exp.c src/mpn_exp.c` (there is a `src/src` directory in MPFR-3.1.0, this was just `src/` in the old MPFR). Can you fix this as well?



---

archive/issue_events_154821.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2012-02-22T19:58:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11666#event-154821"
}
```



---

archive/issue_events_154822.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2012-02-22T19:58:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11666#event-154822"
}
```



---

archive/issue_events_154823.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2012-02-22T19:59:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11666#event-154823"
}
```



---

archive/issue_events_154824.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2012-02-22T19:59:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11666#event-154824"
}
```



---

archive/issue_comments_120289.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">comment:65</div>\n\nToo fast with positive review ;-)",
    "created_at": "2012-02-22T19:59:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120289",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:65" align="right">comment:65</div>

Too fast with positive review ;-)



---

archive/issue_comments_120290.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">comment:66</div>\n\nI wonder why some random tests still differ between 32-bit and 64-bit computers.\nIs there any reason?\n\nPaul",
    "created_at": "2012-02-23T08:17:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120290",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:66" align="right">comment:66</div>

I wonder why some random tests still differ between 32-bit and 64-bit computers.
Is there any reason?

Paul



---

archive/issue_comments_120291.json:
```json
{
    "body": "<div id=\"comment:67\" align=\"right\">comment:67</div>\n\nI tried the patches on top of Sage 4.8 (after #12171) but the 2nd and 3rd failed to apply:\n\n```\n\nsage: hg_sage.import_patch(\"trac_11666_reduce_precision_max.patch\")\ncd \"/home/zimmerma/sage-4.8/devel/sage\" && sage --hg import   \"/home/zimmerma/sage-4.8/trac_11666_reduce_precision_max.patch\"\napplying /home/zimmerma/sage-4.8/trac_11666_reduce_precision_max.patch\npatching file sage/rings/real_mpfr.pyx\nHunk #1 FAILED at 183\n1 out of 1 hunks FAILED -- saving rejects to file sage/rings/real_mpfr.pyx.rej\nabort: patch failed to apply\n```\nand\n\n```\n\nsage: hg_sage.import_patch(\"trac_11666_fix_random_doctests.patch\") \ncd \"/home/zimmerma/sage-4.8/devel/sage\" && sage --hg import   \"/home/zimmerma/sage-4.8/trac_11666_fix_random_doctests.patch\"\napplying /home/zimmerma/sage-4.8/trac_11666_fix_random_doctests.patch\npatching file sage/misc/randstate.pyx\nHunk #1 FAILED at 54\nHunk #2 FAILED at 85\nHunk #3 FAILED at 221\nHunk #4 FAILED at 233\nHunk #5 FAILED at 254\nHunk #6 FAILED at 276\n6 out of 6 hunks FAILED -- saving rejects to file sage/misc/randstate.pyx.rej\nabort: patch failed to apply\n```\nPaul",
    "created_at": "2012-02-23T08:24:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120291",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:67" align="right">comment:67</div>

I tried the patches on top of Sage 4.8 (after #12171) but the 2nd and 3rd failed to apply:

```

sage: hg_sage.import_patch("trac_11666_reduce_precision_max.patch")
cd "/home/zimmerma/sage-4.8/devel/sage" && sage --hg import   "/home/zimmerma/sage-4.8/trac_11666_reduce_precision_max.patch"
applying /home/zimmerma/sage-4.8/trac_11666_reduce_precision_max.patch
patching file sage/rings/real_mpfr.pyx
Hunk #1 FAILED at 183
1 out of 1 hunks FAILED -- saving rejects to file sage/rings/real_mpfr.pyx.rej
abort: patch failed to apply
```
and

```

sage: hg_sage.import_patch("trac_11666_fix_random_doctests.patch") 
cd "/home/zimmerma/sage-4.8/devel/sage" && sage --hg import   "/home/zimmerma/sage-4.8/trac_11666_fix_random_doctests.patch"
applying /home/zimmerma/sage-4.8/trac_11666_fix_random_doctests.patch
patching file sage/misc/randstate.pyx
Hunk #1 FAILED at 54
Hunk #2 FAILED at 85
Hunk #3 FAILED at 221
Hunk #4 FAILED at 233
Hunk #5 FAILED at 254
Hunk #6 FAILED at 276
6 out of 6 hunks FAILED -- saving rejects to file sage/misc/randstate.pyx.rej
abort: patch failed to apply
```
Paul



---

archive/issue_comments_120292.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">comment:68</div>\n\nReplying to [zimmerma](https://github.com/sagemath/sage/issues/11666#comment:66):\n\n\n> I wonder why some random tests still differ between 32-bit and 64-bit computers. Is there any reason? Paul\n\nYou mean in randstate.pyx? I guess that Pari RNG does not behaves the  same on 32 and 64 bits. The other tests (MPIR, MPFR, GAP, NTL, Python)  looks the same to me, but i might have missed something.\n\nThe spkg at the usual address is updated, if someone could test that the patch now applies on Solaris :) \n\nFor Paul: the Sage patches of the ticker did apply for me on top of 5.0.beta4",
    "created_at": "2012-02-23T08:27:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120292",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:68" align="right">comment:68</div>

Replying to [zimmerma](https://github.com/sagemath/sage/issues/11666#comment:66):


> I wonder why some random tests still differ between 32-bit and 64-bit computers. Is there any reason? Paul

You mean in randstate.pyx? I guess that Pari RNG does not behaves the  same on 32 and 64 bits. The other tests (MPIR, MPFR, GAP, NTL, Python)  looks the same to me, but i might have missed something.

The spkg at the usual address is updated, if someone could test that the patch now applies on Solaris :) 

For Paul: the Sage patches of the ticker did apply for me on top of 5.0.beta4



---

archive/issue_events_154825.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2012-02-23T08:27:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11666#event-154825"
}
```



---

archive/issue_events_154826.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2012-02-23T08:27:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11666#event-154826"
}
```



---

archive/issue_comments_120293.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">comment:69</div>\n\nwe decided in the MPFR development version to decrease the maximal value of the precision from 256, i.e., it is now 2<sup>31</sup>-257. You might want to do the same in Sage, so that upgrading to future MPFR versions will not cause any problem.\n\nPaul",
    "created_at": "2012-02-23T16:17:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120293",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:69" align="right">comment:69</div>

we decided in the MPFR development version to decrease the maximal value of the precision from 256, i.e., it is now 2<sup>31</sup>-257. You might want to do the same in Sage, so that upgrading to future MPFR versions will not cause any problem.

Paul



---

archive/issue_comments_120294.json:
```json
{
    "body": "Updated patch to limit precision at 2**31-257 Updated patch to limit precision at 2**31-257 Updated patch to limit precision at 2**31-257",
    "created_at": "2012-02-23T18:13:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120294",
    "user": "https://github.com/vbraun"
}
```

Updated patch to limit precision at 2**31-257 Updated patch to limit precision at 2**31-257 Updated patch to limit precision at 2**31-257



---

archive/issue_comments_120295.json:
```json
{
    "body": "<div id=\"comment:70\" align=\"right\">comment:70</div>\n\nAttachment: **[trac_11666_reduce_precision_max.patch.gz](https://github.com/sagemath/sage/files/ticket11666/trac_11666_reduce_precision_max.patch.gz)**\n\nLooks good. I'm happy to give the spkg a positive review. Nothing changed in `mpn_exp.c` except the file location, so I don't foresee any Solaris issues.\n\nI've implemented Paul's suggestion about the precision limit, which was the only reviewer complaint. So I'll take it that everyone agrees with positive review ;-)\n\nPatches apply cleanly against sage-5.0.alpha4 and alpha5.",
    "created_at": "2012-02-23T18:28:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120295",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:70" align="right">comment:70</div>

Attachment: **[trac_11666_reduce_precision_max.patch.gz](https://github.com/sagemath/sage/files/ticket11666/trac_11666_reduce_precision_max.patch.gz)**

Looks good. I'm happy to give the spkg a positive review. Nothing changed in `mpn_exp.c` except the file location, so I don't foresee any Solaris issues.

I've implemented Paul's suggestion about the precision limit, which was the only reviewer complaint. So I'll take it that everyone agrees with positive review ;-)

Patches apply cleanly against sage-5.0.alpha4 and alpha5.



---

archive/issue_comments_120296.json:
```json
{
    "body": "Changed reviewer from **Paul Zimmermann, Jean-Pierre Flori** to **Paul Zimmermann, Jean-Pierre Flori, Volker Braun**",
    "created_at": "2012-02-23T18:28:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120296",
    "user": "https://github.com/vbraun"
}
```

Changed reviewer from **Paul Zimmermann, Jean-Pierre Flori** to **Paul Zimmermann, Jean-Pierre Flori, Volker Braun**



---

archive/issue_events_154827.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2012-02-23T18:28:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11666#event-154827"
}
```



---

archive/issue_events_154828.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2012-02-23T18:28:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11666#event-154828"
}
```



---

archive/issue_events_154829.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-02-23T20:14:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11666#event-154829"
}
```



---

archive/issue_events_154830.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-02-23T20:14:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11666#event-154830"
}
```



---

archive/issue_comments_120297.json:
```json
{
    "body": "Changed dependencies from **#12171** to **#12171, #12548**",
    "created_at": "2012-02-23T20:14:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120297",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#12171** to **#12171, #12548**



---

archive/issue_comments_120298.json:
```json
{
    "body": "<div id=\"comment:71\" align=\"right\">comment:71</div>\n\nSorry for the trouble, but this should be rebased to #12548.",
    "created_at": "2012-02-23T20:14:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120298",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:71" align="right">comment:71</div>

Sorry for the trouble, but this should be rebased to #12548.



---

archive/issue_events_154831.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2012-02-25T10:39:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11666#event-154831"
}
```



---

archive/issue_events_154832.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2012-02-25T10:39:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11666#event-154832"
}
```



---

archive/issue_comments_120299.json:
```json
{
    "body": "<div id=\"comment:72\" align=\"right\">comment:72</div>\n\nHere you go.\n\nSame address as usual.",
    "created_at": "2012-02-25T10:39:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120299",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:72" align="right">comment:72</div>

Here you go.

Same address as usual.



---

archive/issue_comments_120300.json:
```json
{
    "body": "<div id=\"comment:73\" align=\"right\">comment:73</div>\n\n`SPKG.txt` refers incorrectly to `mpfr-3.1.0.p1`, it should be `.p0`",
    "created_at": "2012-02-25T14:47:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120300",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:73" align="right">comment:73</div>

`SPKG.txt` refers incorrectly to `mpfr-3.1.0.p1`, it should be `.p0`



---

archive/issue_events_154833.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-02-25T14:47:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11666#event-154833"
}
```



---

archive/issue_events_154834.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-02-25T14:47:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11666#event-154834"
}
```



---

archive/issue_events_154835.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2012-02-25T14:51:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11666#event-154835"
}
```



---

archive/issue_events_154836.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2012-02-25T14:51:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11666#event-154836"
}
```



---

archive/issue_comments_120301.json:
```json
{
    "body": "<div id=\"comment:74\" align=\"right\">comment:74</div>\n\nCorrected.",
    "created_at": "2012-02-25T14:51:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120301",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:74" align="right">comment:74</div>

Corrected.



---

archive/issue_events_154837.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2012-02-25T20:42:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11666#event-154837"
}
```



---

archive/issue_events_154838.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2012-02-25T20:42:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11666#event-154838"
}
```



---

archive/issue_comments_120302.json:
```json
{
    "body": "Changed reviewer from **Paul Zimmermann, Jean-Pierre Flori, Volker Braun** to **Paul Zimmermann, Jean-Pierre Flori, Volker Braun, Jeroen Demeyer**",
    "created_at": "2012-02-25T20:42:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120302",
    "user": "https://github.com/vbraun"
}
```

Changed reviewer from **Paul Zimmermann, Jean-Pierre Flori, Volker Braun** to **Paul Zimmermann, Jean-Pierre Flori, Volker Braun, Jeroen Demeyer**



---

archive/issue_comments_120303.json:
```json
{
    "body": "<div id=\"comment:75\" align=\"right\">comment:75</div>\n\nLooks good!",
    "created_at": "2012-02-25T20:42:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120303",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:75" align="right">comment:75</div>

Looks good!



---

archive/issue_comments_120304.json:
```json
{
    "body": "<div id=\"comment:76\" align=\"right\">comment:76</div>\n\nI'm not sure my advice in comment [comment:11] to configure MPFR with `-disable-thread-safe` was taken into account. This might cause problems on various systems, see for example\nhttp://www.loria.fr/~zimmerma/software/compilerbugs.html\n\nIn addition, I'm not sure MPFR can be used as multi-thread within Sage.\n\nPaul",
    "created_at": "2012-02-26T22:19:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120304",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:76" align="right">comment:76</div>

I'm not sure my advice in comment [comment:11] to configure MPFR with `-disable-thread-safe` was taken into account. This might cause problems on various systems, see for example
http://www.loria.fr/~zimmerma/software/compilerbugs.html

In addition, I'm not sure MPFR can be used as multi-thread within Sage.

Paul



---

archive/issue_comments_120305.json:
```json
{
    "body": "<div id=\"comment:77\" align=\"right\">comment:77</div>\n\nNo, I did not. I just started on top of Mikes package which came before your comment and I don't remmeber that MPFR includes that flag by default. Ill send a new package tomorrow if you think that's needed. Too late for today.",
    "created_at": "2012-02-26T22:41:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120305",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:77" align="right">comment:77</div>

No, I did not. I just started on top of Mikes package which came before your comment and I don't remmeber that MPFR includes that flag by default. Ill send a new package tomorrow if you think that's needed. Too late for today.



---

archive/issue_events_154839.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2012-02-26T22:43:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11666#event-154839"
}
```



---

archive/issue_events_154840.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2012-02-26T22:43:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11666#event-154840"
}
```



---

archive/issue_comments_120306.json:
```json
{
    "body": "<div id=\"comment:78\" align=\"right\">comment:78</div>\n\nI'm pretty sure we don't use multithreading with MPFR so we can just pass `--disable-thread-safe` to configure. I'll be happy to review it tomorrow ;-)",
    "created_at": "2012-02-26T22:43:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120306",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:78" align="right">comment:78</div>

I'm pretty sure we don't use multithreading with MPFR so we can just pass `--disable-thread-safe` to configure. I'll be happy to review it tomorrow ;-)



---

archive/issue_comments_120307.json:
```json
{
    "body": "Changed upstream from **Reported upstream. Developers acknowledge bug.** to **Fixed upstream, but not in a stable release.**",
    "created_at": "2012-02-26T22:43:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120307",
    "user": "https://github.com/vbraun"
}
```

Changed upstream from **Reported upstream. Developers acknowledge bug.** to **Fixed upstream, but not in a stable release.**



---

archive/issue_comments_120308.json:
```json
{
    "body": "<div id=\"comment:79\" align=\"right\">comment:79</div>\n\nJean-Pierre, the `-disable-thread-safe` is not needed, but since Sage does not use\nmultithreading with MPFR, and given the poor support of multithreading by some compilers and operating systems, I recommend disabling thread local storage.\n\nPaul",
    "created_at": "2012-02-27T07:54:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120308",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:79" align="right">comment:79</div>

Jean-Pierre, the `-disable-thread-safe` is not needed, but since Sage does not use
multithreading with MPFR, and given the poor support of multithreading by some compilers and operating systems, I recommend disabling thread local storage.

Paul



---

archive/issue_events_154841.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2012-02-27T10:04:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11666#event-154841"
}
```



---

archive/issue_events_154842.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2012-02-27T10:04:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11666#event-154842"
}
```



---

archive/issue_comments_120309.json:
```json
{
    "body": "<div id=\"comment:80\" align=\"right\">comment:80</div>\n\nSPKG updated at the same address.",
    "created_at": "2012-02-27T10:04:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120309",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:80" align="right">comment:80</div>

SPKG updated at the same address.



---

archive/issue_comments_120310.json:
```json
{
    "body": "<div id=\"comment:81\" align=\"right\">comment:81</div>\n\nIs there anything preventing this from getting positive review ?\n\nThe package address did not change, so I've not updated the ticket description.",
    "created_at": "2012-03-02T14:41:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120310",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:81" align="right">comment:81</div>

Is there anything preventing this from getting positive review ?

The package address did not change, so I've not updated the ticket description.



---

archive/issue_comments_120311.json:
```json
{
    "body": "<div id=\"comment:82\" align=\"right\">comment:82</div>\n\nHere is a review of `trac_11666_spkg.patch`:\nthere are small typos in `SPKG.txt`, which were already there before:\n`coment` should be `comment`,\n`occured` should be `occurred`,\n`reccommened` should be `recommended`.\n\nApart from that, the more important would be to test the modified spkg.\n\nIf this was already tested by the buildbot, then I will give a positive review.\n\nPaul Zimmermann",
    "created_at": "2012-03-02T16:17:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120311",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:82" align="right">comment:82</div>

Here is a review of `trac_11666_spkg.patch`:
there are small typos in `SPKG.txt`, which were already there before:
`coment` should be `comment`,
`occured` should be `occurred`,
`reccommened` should be `recommended`.

Apart from that, the more important would be to test the modified spkg.

If this was already tested by the buildbot, then I will give a positive review.

Paul Zimmermann



---

archive/issue_comments_120312.json:
```json
{
    "body": "<div id=\"comment:83\" align=\"right\">comment:83</div>\n\nFrom http://wiki.sagemath.org/buildbot it seems that the patchbot does not feel concerned by automatically testing spkg and I have no idea how to use Sage facilities to perform automatically such tests. I even think I have no account on the needed machines, so I cannot take care of launching automated tests.\n\nAnyway, I'll take the typos into account tomorrow and update the spkg.",
    "created_at": "2012-03-02T17:04:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120312",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:83" align="right">comment:83</div>

From http://wiki.sagemath.org/buildbot it seems that the patchbot does not feel concerned by automatically testing spkg and I have no idea how to use Sage facilities to perform automatically such tests. I even think I have no account on the needed machines, so I cannot take care of launching automated tests.

Anyway, I'll take the typos into account tomorrow and update the spkg.



---

archive/issue_comments_120313.json:
```json
{
    "body": "Work Issues: **typos**",
    "created_at": "2012-03-02T17:04:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120313",
    "user": "https://github.com/jpflori"
}
```

Work Issues: **typos**



---

archive/issue_events_154843.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2012-03-02T17:04:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11666#event-154843"
}
```



---

archive/issue_events_154844.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2012-03-02T17:04:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11666#event-154844"
}
```



---

archive/issue_events_154845.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2012-03-02T17:16:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11666#event-154845"
}
```



---

archive/issue_events_154846.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2012-03-02T17:16:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11666#event-154846"
}
```



---

archive/issue_comments_120314.json:
```json
{
    "body": "<div id=\"comment:84\" align=\"right\">comment:84</div>\n\nIn fact I had some time right now and corrected the typos.\n\nThe package is at the same address as before.",
    "created_at": "2012-03-02T17:16:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120314",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:84" align="right">comment:84</div>

In fact I had some time right now and corrected the typos.

The package is at the same address as before.



---

archive/issue_comments_120315.json:
```json
{
    "body": "Attachment: **[trac_11666_spkg.patch.gz](https://github.com/sagemath/sage/files/ticket11666/trac_11666_spkg.patch.gz)**\n\nspkg diff, for review only",
    "created_at": "2012-03-02T17:17:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120315",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[trac_11666_spkg.patch.gz](https://github.com/sagemath/sage/files/ticket11666/trac_11666_spkg.patch.gz)**

spkg diff, for review only



---

archive/issue_comments_120316.json:
```json
{
    "body": "<div id=\"comment:85\" align=\"right\">comment:85</div>\n\nReplying to [@jpflori](#comment:83):\n> From http://wiki.sagemath.org/buildbot it seems that the patchbot does not feel concerned by automatically testing spkg and I have no idea how to use Sage facilities to perform automatically such tests. I even think I have no account on the needed machines, so I cannot take care of launching automated tests.\n\nYes, there is currently no way to automatically test spkgs.",
    "created_at": "2012-03-02T21:35:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120316",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:85" align="right">comment:85</div>

Replying to [@jpflori](#comment:83):
> From http://wiki.sagemath.org/buildbot it seems that the patchbot does not feel concerned by automatically testing spkg and I have no idea how to use Sage facilities to perform automatically such tests. I even think I have no account on the needed machines, so I cannot take care of launching automated tests.

Yes, there is currently no way to automatically test spkgs.



---

archive/issue_comments_120317.json:
```json
{
    "body": "<div id=\"comment:86\" align=\"right\">comment:86</div>\n\nThe current workflow is positive review -> release manage tests beta on build bot. While the authors should of course test patches, you don't have to test it on every supported machine to give a positive review.\n\nWe did test it on 32 and 6-bit machines which is the most likely source of errors. Specifics for other systems were not changed so its likely that it'll continue to work. I'll give the spell-checked SPKG.txt my positive review.",
    "created_at": "2012-03-02T22:17:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120317",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:86" align="right">comment:86</div>

The current workflow is positive review -> release manage tests beta on build bot. While the authors should of course test patches, you don't have to test it on every supported machine to give a positive review.

We did test it on 32 and 6-bit machines which is the most likely source of errors. Specifics for other systems were not changed so its likely that it'll continue to work. I'll give the spell-checked SPKG.txt my positive review.



---

archive/issue_events_154847.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2012-03-02T22:17:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11666#event-154847"
}
```



---

archive/issue_events_154848.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2012-03-02T22:17:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11666#event-154848"
}
```



---

archive/issue_comments_120318.json:
```json
{
    "body": "<div id=\"comment:87\" align=\"right\">comment:87</div>\n\nReplying to [@vbraun](#comment:86):\n> We did test it on 32 and 6-bit machines which is the most likely source of errors.\n\nAgreed.  My impression from Paul Zimmermann's comment was that it hadn't been tested at all.",
    "created_at": "2012-03-03T13:50:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120318",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:87" align="right">comment:87</div>

Replying to [@vbraun](#comment:86):
> We did test it on 32 and 6-bit machines which is the most likely source of errors.

Agreed.  My impression from Paul Zimmermann's comment was that it hadn't been tested at all.



---

archive/issue_comments_120319.json:
```json
{
    "body": "<div id=\"comment:88\" align=\"right\">comment:88</div>\n\nReplying to [@vbraun](#comment:86):\n> We did test it on [...] 6-bit machines\n\nImpressive!",
    "created_at": "2012-03-03T13:50:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120319",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:88" align="right">comment:88</div>

Replying to [@vbraun](#comment:86):
> We did test it on [...] 6-bit machines

Impressive!



---

archive/issue_comments_120320.json:
```json
{
    "body": "Changed work issues from **typos** to none",
    "created_at": "2012-03-04T21:14:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120320",
    "user": "https://github.com/jdemeyer"
}
```

Changed work issues from **typos** to none



---

archive/issue_events_154849.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-04T21:19:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11666#event-154849"
}
```



---

archive/issue_events_154850.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-04T21:19:40Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11666#event-154850"
}
```



---

archive/issue_comments_120321.json:
```json
{
    "body": "Merged: **sage-5.0.beta7**",
    "created_at": "2012-03-04T21:19:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11666",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11666#issuecomment-120321",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.0.beta7**
