# Issue 11920: Sympow needs to disable fused-multiply-add and should create datafiles

archive/issues_011748.json:
```json
{
    "assignees": [],
    "body": "See #11226 and [http://gcc.gnu.org/bugzilla/show_bug.cgi?id=48823](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=48823).\n\nFor sympow, we need to use the compiler option `-ffp-contract=on`, `-mno-fused-madd` or `-ffloat-store` (if the compiler supports it).\n\nSympow should also create its datafiles, see #5155.\n\n**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/sympow-1.018.1.p11.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/sympow-1.018.1.p11.spkg)\n\n**CC:**  @nexttime\n\n**Author:** Jeroen Demeyer\n\n**Reviewer:** Leif Leonhardy, Volker Braun\n\n**Upstream:** None of the above - read trac for reasoning.\n\n**Merged:** sage-5.0.beta3\n\nIssue created by migration from https://trac.sagemath.org/ticket/11920\n\n",
    "closed_at": "2012-02-07T13:21:32Z",
    "created_at": "2011-10-13T20:09:10Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Sympow needs to disable fused-multiply-add and should create datafiles",
    "type": "issue",
    "updated_at": "2012-02-07T13:21:32Z",
    "url": "https://github.com/sagemath/sage/issues/11920",
    "user": "https://github.com/jdemeyer"
}
```
See #11226 and [http://gcc.gnu.org/bugzilla/show_bug.cgi?id=48823](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=48823).

For sympow, we need to use the compiler option `-ffp-contract=on`, `-mno-fused-madd` or `-ffloat-store` (if the compiler supports it).

Sympow should also create its datafiles, see #5155.

**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/sympow-1.018.1.p11.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/sympow-1.018.1.p11.spkg)

**CC:**  @nexttime

**Author:** Jeroen Demeyer

**Reviewer:** Leif Leonhardy, Volker Braun

**Upstream:** None of the above - read trac for reasoning.

**Merged:** sage-5.0.beta3

Issue created by migration from https://trac.sagemath.org/ticket/11920





---

archive/issue_events_135745.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-13T20:09:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "milestone_number": null,
    "milestone_title": "sage-5.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11920#event-135745"
}
```



---

archive/issue_events_135746.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-13T20:09:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
    "label_color": "08517b",
    "label_name": "component: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11920#event-135746"
}
```



---

archive/issue_events_135747.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-13T20:09:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "008080",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11920#event-135747"
}
```



---

archive/issue_comments_127945.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-See #11226 and [http://boxen.math.washington.edu/home/jdemeyer/spkg/sympow-1.018.1.p9.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/sympow-1.018.1.p9.spkg).\n+See #11226 and [http://gcc.gnu.org/bugzilla/show_bug.cgi?id=48823](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=48823).\n \n For sympow, we need to use the compiler option {{{-ffp-contract=on\n }}} (if the compiler supports it).\n``````\n",
    "created_at": "2011-10-13T20:09:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11920#issuecomment-127945",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-See #11226 and [http://boxen.math.washington.edu/home/jdemeyer/spkg/sympow-1.018.1.p9.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/sympow-1.018.1.p9.spkg).
+See #11226 and [http://gcc.gnu.org/bugzilla/show_bug.cgi?id=48823](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=48823).
 
 For sympow, we need to use the compiler option {{{-ffp-contract=on
 }}} (if the compiler supports it).
``````




---

archive/issue_comments_127946.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,3 @@\n See #11226 and [http://gcc.gnu.org/bugzilla/show_bug.cgi?id=48823](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=48823).\n \n-For sympow, we need to use the compiler option {{{-ffp-contract=on\n-}}} (if the compiler supports it).\n+For sympow, we need to use the compiler option -ffp-contract=on (if the compiler supports it).\n``````\n",
    "created_at": "2011-10-13T20:10:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11920#issuecomment-127946",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,3 @@
 See #11226 and [http://gcc.gnu.org/bugzilla/show_bug.cgi?id=48823](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=48823).
 
-For sympow, we need to use the compiler option {{{-ffp-contract=on
-}}} (if the compiler supports it).
+For sympow, we need to use the compiler option -ffp-contract=on (if the compiler supports it).
``````




---

archive/issue_events_135748.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-17T18:59:29Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "milestone_number": null,
    "milestone_title": "sage-4.7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11920#event-135748"
}
```



---

archive/issue_events_135749.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-17T18:59:29Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "milestone_number": null,
    "milestone_title": "sage-4.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11920#event-135749"
}
```



---

archive/issue_events_135750.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-17T18:59:29Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "rename": {
        "from": "Sympow needs to specify -ffp-contract=on",
        "to": "Sympow needs specify -ffp-contract=on and should create datafiles"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11920#event-135750"
}
```



---

archive/issue_comments_127947.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n See #11226 and [http://gcc.gnu.org/bugzilla/show_bug.cgi?id=48823](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=48823).\n \n For sympow, we need to use the compiler option -ffp-contract=on (if the compiler supports it).\n+\n+Sympow should also create its datafiles, see #5155.\n``````\n",
    "created_at": "2011-10-17T19:01:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11920#issuecomment-127947",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
 See #11226 and [http://gcc.gnu.org/bugzilla/show_bug.cgi?id=48823](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=48823).
 
 For sympow, we need to use the compiler option -ffp-contract=on (if the compiler supports it).
+
+Sympow should also create its datafiles, see #5155.
``````




---

archive/issue_comments_127948.json:
```json
{
    "body": "**Upstream:** None of the above - read trac for reasoning.",
    "created_at": "2011-10-17T20:00:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11920#issuecomment-127948",
    "user": "https://github.com/jdemeyer"
}
```

**Upstream:** None of the above - read trac for reasoning.



---

archive/issue_comments_127949.json:
```json
{
    "body": "<a id='comment:6'>**Comment 6:**</a>\nNot reported upstream because **upstream project is dead** (we should probably have this as an option in the \"Upstream\" field).",
    "created_at": "2011-10-17T20:00:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11920#issuecomment-127949",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'>**Comment 6:**</a>
Not reported upstream because **upstream project is dead** (we should probably have this as an option in the "Upstream" field).



---

archive/issue_comments_127950.json:
```json
{
    "body": "<a id='comment:7'>**Comment 7:**</a>\nTested on Core2, pentium4, ia64 with fairly recent versions of gcc.",
    "created_at": "2011-10-19T21:08:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11920#issuecomment-127950",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'>**Comment 7:**</a>
Tested on Core2, pentium4, ia64 with fairly recent versions of gcc.



---

archive/issue_events_135751.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-19T21:08:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11920#event-135751"
}
```



---

archive/issue_comments_127951.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -3,3 +3,5 @@\n For sympow, we need to use the compiler option -ffp-contract=on (if the compiler supports it).\n \n Sympow should also create its datafiles, see #5155.\n+\n+**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/sympow-1.018.1.p10.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/sympow-1.018.1.p10.spkg)\n``````\n",
    "created_at": "2011-10-19T21:08:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11920#issuecomment-127951",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -3,3 +3,5 @@
 For sympow, we need to use the compiler option -ffp-contract=on (if the compiler supports it).
 
 Sympow should also create its datafiles, see #5155.
+
+**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/sympow-1.018.1.p10.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/sympow-1.018.1.p10.spkg)
``````




---

archive/issue_comments_127952.json:
```json
{
    "body": "**Author:** Jeroen Demeyer",
    "created_at": "2011-10-19T21:08:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11920#issuecomment-127952",
    "user": "https://github.com/jdemeyer"
}
```

**Author:** Jeroen Demeyer



---

archive/issue_comments_127953.json:
```json
{
    "body": "<a id='comment:8'>**Comment 8:**</a>\nsympow-1.018.1.p10.spkg compiles on my ARM box.",
    "created_at": "2011-10-29T18:57:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11920#issuecomment-127953",
    "user": "https://github.com/sagetrac-Snark"
}
```

<a id='comment:8'>**Comment 8:**</a>
sympow-1.018.1.p10.spkg compiles on my ARM box.



---

archive/issue_comments_127954.json:
```json
{
    "body": "<a id='comment:9'>**Comment 9:**</a>\nWith GCC versions prior to 4.6, you might have to specify e.g. `-fno-fused-madd` instead on some platforms, so you could also check whether that's supported and use it in case it is.\n\n[Although it's not immediately clear to me whether that's desirable at all; with (fused) multiply-accumulate, the results are *more* accurate than without.  They'll of course frequently differ slightly from what you get *with* strict IEEE 754 compliance.]\n\n\n\n\n`spkg-install`  should use `$MAKE` instead of `make`.\n\n`$SAGE_LOCAL` should be quoted in the generated script.\n\nThere are a few typos in the comments, e.g. *\"default mode of operat**ion**\"* and   *\"prec**is**ion\"* (instead of *\"precion\"*).",
    "created_at": "2011-10-31T03:14:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11920#issuecomment-127954",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:9'>**Comment 9:**</a>
With GCC versions prior to 4.6, you might have to specify e.g. `-fno-fused-madd` instead on some platforms, so you could also check whether that's supported and use it in case it is.

[Although it's not immediately clear to me whether that's desirable at all; with (fused) multiply-accumulate, the results are *more* accurate than without.  They'll of course frequently differ slightly from what you get *with* strict IEEE 754 compliance.]




`spkg-install`  should use `$MAKE` instead of `make`.

`$SAGE_LOCAL` should be quoted in the generated script.

There are a few typos in the comments, e.g. *"default mode of operat**ion**"* and   *"prec**is**ion"* (instead of *"precion"*).



---

archive/issue_comments_127955.json:
```json
{
    "body": "<a id='comment:10'>**Comment 10:**</a>\nP.S.:\n\n```\nLinux silius 2.6.32.46-0.3-ppc64 #1 SMP 2011-09-29 17:49:31 +0200 ppc64 ppc64 ppc64 GNU/Linux\n****************************************************\n****************************************************\nCC Version\ngcc -v\nUsing built-in specs.\nTarget: powerpc64-unknown-linux-gnu\nConfigured with: ../gcc-4.4.6/configure -v --prefix=/home/leif/local/silius/ --program-suffix=-4.4.6 --enable-languages=c,c++,fortran --enable-plugins --enable-lto --enable-gold --enable-version-specific-runtime-libs --with-cpu=power7 --with-tune=power7 --with-gmp=/home/leif/local/silius/ --with-mpfr=/home/leif/local/silius/ --with-mpc=/home/leif/local/silius/\nThread model: posix\ngcc version 4.4.6 (GCC) \n****************************************************\npatching file Configure\npatching file generate.c\npatching file fpu.c\nThe double precision of your FPU is 105 bits.\nThe Quad Double library used by SYMPOW assumes IEEE-754 double precision\nnumbers with exactly 53 bits in the mantissa (64 bits in total).\n\nUnfortunately, we currently have no workaround for your system.\nRunning SYMPOW will surely fail. Please report this problem to\nsage-devel (http://groups.google.com/group/sage-devel),\nmentioning in particular your operating system, processor type\nand compiler version (run gcc --version).\n```",
    "created_at": "2011-10-31T03:29:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11920#issuecomment-127955",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:10'>**Comment 10:**</a>
P.S.:

```
Linux silius 2.6.32.46-0.3-ppc64 #1 SMP 2011-09-29 17:49:31 +0200 ppc64 ppc64 ppc64 GNU/Linux
****************************************************
****************************************************
CC Version
gcc -v
Using built-in specs.
Target: powerpc64-unknown-linux-gnu
Configured with: ../gcc-4.4.6/configure -v --prefix=/home/leif/local/silius/ --program-suffix=-4.4.6 --enable-languages=c,c++,fortran --enable-plugins --enable-lto --enable-gold --enable-version-specific-runtime-libs --with-cpu=power7 --with-tune=power7 --with-gmp=/home/leif/local/silius/ --with-mpfr=/home/leif/local/silius/ --with-mpc=/home/leif/local/silius/
Thread model: posix
gcc version 4.4.6 (GCC) 
****************************************************
patching file Configure
patching file generate.c
patching file fpu.c
The double precision of your FPU is 105 bits.
The Quad Double library used by SYMPOW assumes IEEE-754 double precision
numbers with exactly 53 bits in the mantissa (64 bits in total).

Unfortunately, we currently have no workaround for your system.
Running SYMPOW will surely fail. Please report this problem to
sage-devel (http://groups.google.com/group/sage-devel),
mentioning in particular your operating system, processor type
and compiler version (run gcc --version).
```



---

archive/issue_comments_127956.json:
```json
{
    "body": "**Reviewer:** Leif Leonhardy",
    "created_at": "2011-10-31T03:37:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11920#issuecomment-127956",
    "user": "https://github.com/nexttime"
}
```

**Reviewer:** Leif Leonhardy



---

archive/issue_comments_127957.json:
```json
{
    "body": "<a id='comment:11'>**Comment 11:**</a>\nWith `-mno-fused-add`, it builds.  (I get *\"The double precision of your FPU is 53 bits.\"*)",
    "created_at": "2011-10-31T03:37:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11920#issuecomment-127957",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:11'>**Comment 11:**</a>
With `-mno-fused-add`, it builds.  (I get *"The double precision of your FPU is 53 bits."*)



---

archive/issue_events_135752.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-10-31T03:37:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11920#event-135752"
}
```



---

archive/issue_events_135753.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-10-31T03:37:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11920#event-135753"
}
```



---

archive/issue_comments_127958.json:
```json
{
    "body": "<a id='comment:12'>**Comment 12:**</a>\nReplying to [@nexttime](#comment%3A9):\n> With GCC versions prior to 4.6, you might have to specify e.g. `-fno-fused-madd` [...]\n\nNote that it's of course `-m`, not `-f`.",
    "created_at": "2011-10-31T03:41:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11920#issuecomment-127958",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:12'>**Comment 12:**</a>
Replying to [@nexttime](#comment%3A9):
> With GCC versions prior to 4.6, you might have to specify e.g. `-fno-fused-madd` [...]

Note that it's of course `-m`, not `-f`.



---

archive/issue_comments_127959.json:
```json
{
    "body": "<a id='comment:13'>**Comment 13:**</a>\nFWIW, both with the p9 (with `-O3`, and **without** `-mno-fused-madd`, which is AFAIK the default) and with the p10 (with `-mno-fused-madd`) all (long) tests in\n\n `sage/lfunctions/sympow.py`\n\npass.  So you should probably change your check to detect whether the doubles are 64-bit / have a 53-bit mantissa.\n\n\nOnly the optional ones fail (differently); one has to compute extra data (with PARI/GP) for these anyway.  With the p10 I get:\n\n```\nsage -t -long -optional \"devel/sage/sage/lfunctions/sympow.py\"\n**********************************************************************\nFile \".../sage/lfunctions/sympow.py\", line 127:\n    sage: a = sympow.L(EllipticCurve('11a'), 2, 16); a   # optional\nExpected:\n    '1.057599244590958E+00'\nGot:\n    '-4.967915042710588E+11'\n**********************************************************************\nFile \".../sage/lfunctions/sympow.py\", line 129:\n    sage: RR(a)                    # optional -- requires precomputations\nExpected:\n    1.05759924459096\nGot:\n    -4.96791504271059e11\n**********************************************************************\n1 items had failures:\n   2 of   5 in __main__.example_4\n***Test Failed*** 2 failures.\nFor whitespace errors, see the file /home/leif/.sage//tmp/sympow_52568.py\n\t [12.7 s]\n```\n\nFairly loud noise... :-)\n\n(Might be that the data in the \"manually\" computed file is just wrong.)",
    "created_at": "2011-10-31T04:30:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11920#issuecomment-127959",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:13'>**Comment 13:**</a>
FWIW, both with the p9 (with `-O3`, and **without** `-mno-fused-madd`, which is AFAIK the default) and with the p10 (with `-mno-fused-madd`) all (long) tests in

 `sage/lfunctions/sympow.py`

pass.  So you should probably change your check to detect whether the doubles are 64-bit / have a 53-bit mantissa.


Only the optional ones fail (differently); one has to compute extra data (with PARI/GP) for these anyway.  With the p10 I get:

```
sage -t -long -optional "devel/sage/sage/lfunctions/sympow.py"
**********************************************************************
File ".../sage/lfunctions/sympow.py", line 127:
    sage: a = sympow.L(EllipticCurve('11a'), 2, 16); a   # optional
Expected:
    '1.057599244590958E+00'
Got:
    '-4.967915042710588E+11'
**********************************************************************
File ".../sage/lfunctions/sympow.py", line 129:
    sage: RR(a)                    # optional -- requires precomputations
Expected:
    1.05759924459096
Got:
    -4.96791504271059e11
**********************************************************************
1 items had failures:
   2 of   5 in __main__.example_4
***Test Failed*** 2 failures.
For whitespace errors, see the file /home/leif/.sage//tmp/sympow_52568.py
	 [12.7 s]
```

Fairly loud noise... :-)

(Might be that the data in the "manually" computed file is just wrong.)



---

archive/issue_comments_127960.json:
```json
{
    "body": "<a id='comment:14'>**Comment 14:**</a>\nReplying to [@nexttime](#comment%3A13):\n> FWIW, both with the p9 (with `-O3`, and **without** `-mno-fused-madd`, which is AFAIK the default) and with the p10 (with `-mno-fused-madd`) all (long) tests in\n> \n>  `sage/lfunctions/sympow.py`\n> \n> pass.  So you should probably change your check to detect whether the doubles are 64-bit / have a 53-bit mantissa.\n\nWith the p9 (and **with** `-mfused-add`):\n\n```sh\n$ time env SAGE_TEST_ITER=20 ./sage -tp 1 -long devel/sage/sage/lfunctions/sympow.py \nTesting that Sage starts...\nYes, Sage starts.\nGlobal iterations: 1\nFile iterations: 20\nNo long cached timings exist; will create for successful files.\nDoctesting 1 file using 1 thread\nsage -t -long devel/sage/sage/lfunctions/sympow.py\n\t [10.2 s]\n \n----------------------------------------------------------------------\nAll tests passed!\nTimings have been updated.\nTotal time for all tests: 232.1 seconds\n\nreal\t3m54.484s\nuser\t3m39.864s\nsys\t0m11.631s\n```\n\nWith the p10:\n\n```sh\n$ time env SAGE_TEST_ITER=20 ./sage -tp 1 -long devel/sage/sage/lfunctions/sympow.py \nTesting that Sage starts...\nYes, Sage starts.\nGlobal iterations: 1\nFile iterations: 20\nUsing long cached timings to run longest doctests first.\nDoctesting 1 file using 1 thread\nsage -t -long devel/sage/sage/lfunctions/sympow.py\n\t [11.4 s]\n \n----------------------------------------------------------------------\nAll tests passed!\nTimings have been updated.\nTotal time for all tests: 238.5 seconds\n\nreal\t4m0.566s\nuser\t3m44.169s\nsys\t0m11.777s\n```\n\n(Both packages compiled with `-O3 -march=power7 -mtune=power7`.)",
    "created_at": "2011-10-31T04:56:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11920#issuecomment-127960",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:14'>**Comment 14:**</a>
Replying to [@nexttime](#comment%3A13):
> FWIW, both with the p9 (with `-O3`, and **without** `-mno-fused-madd`, which is AFAIK the default) and with the p10 (with `-mno-fused-madd`) all (long) tests in
> 
>  `sage/lfunctions/sympow.py`
> 
> pass.  So you should probably change your check to detect whether the doubles are 64-bit / have a 53-bit mantissa.

With the p9 (and **with** `-mfused-add`):

```sh
$ time env SAGE_TEST_ITER=20 ./sage -tp 1 -long devel/sage/sage/lfunctions/sympow.py 
Testing that Sage starts...
Yes, Sage starts.
Global iterations: 1
File iterations: 20
No long cached timings exist; will create for successful files.
Doctesting 1 file using 1 thread
sage -t -long devel/sage/sage/lfunctions/sympow.py
	 [10.2 s]
 
----------------------------------------------------------------------
All tests passed!
Timings have been updated.
Total time for all tests: 232.1 seconds

real	3m54.484s
user	3m39.864s
sys	0m11.631s
```

With the p10:

```sh
$ time env SAGE_TEST_ITER=20 ./sage -tp 1 -long devel/sage/sage/lfunctions/sympow.py 
Testing that Sage starts...
Yes, Sage starts.
Global iterations: 1
File iterations: 20
Using long cached timings to run longest doctests first.
Doctesting 1 file using 1 thread
sage -t -long devel/sage/sage/lfunctions/sympow.py
	 [11.4 s]
 
----------------------------------------------------------------------
All tests passed!
Timings have been updated.
Total time for all tests: 238.5 seconds

real	4m0.566s
user	3m44.169s
sys	0m11.777s
```

(Both packages compiled with `-O3 -march=power7 -mtune=power7`.)



---

archive/issue_comments_127961.json:
```json
{
    "body": "<a id='comment:15'>**Comment 15:**</a>\nReplying to [@nexttime](#comment%3A9):\n> With GCC versions prior to 4.6, you might have to specify e.g. `-fno-fused-madd` instead on some platforms, so you could also check whether that's supported and use it in case it is.\n\nGood point, I will add that flag.\n\n> [Although it's not immediately clear to me whether that's desirable at all; with (fused) multiply-accumulate, the results are *more* accurate than without.  They'll of course frequently differ slightly from what you get *with* strict IEEE 754 compliance.]\n\nThis is certainly desirable.  SYMPOW really requires strict IEEE-754 compliance, anything *more* precise is bad.",
    "created_at": "2011-10-31T09:12:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11920#issuecomment-127961",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'>**Comment 15:**</a>
Replying to [@nexttime](#comment%3A9):
> With GCC versions prior to 4.6, you might have to specify e.g. `-fno-fused-madd` instead on some platforms, so you could also check whether that's supported and use it in case it is.

Good point, I will add that flag.

> [Although it's not immediately clear to me whether that's desirable at all; with (fused) multiply-accumulate, the results are *more* accurate than without.  They'll of course frequently differ slightly from what you get *with* strict IEEE 754 compliance.]

This is certainly desirable.  SYMPOW really requires strict IEEE-754 compliance, anything *more* precise is bad.



---

archive/issue_comments_127962.json:
```json
{
    "body": "<a id='comment:16'>**Comment 16:**</a>\nReplying to [@nexttime](#comment%3A13):\n> FWIW, both with the p9 (with `-O3`, and **without** `-mno-fused-madd`, which is AFAIK the default) and with the p10 (with `-mno-fused-madd`) all (long) tests in\n> \n>  `sage/lfunctions/sympow.py`\n> \n> pass.\n\nThe fact that all tests pass, does not necessarily mean that SYMPOW is operating correctly.  It has been shown that SYMPOW sometimes computes incorrect results when fused-madd is used.  I agree, this was with gcc 4.6.0 on ia64, not gcc 4.4.6 on powerpc, but still...",
    "created_at": "2011-10-31T09:18:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11920#issuecomment-127962",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'>**Comment 16:**</a>
Replying to [@nexttime](#comment%3A13):
> FWIW, both with the p9 (with `-O3`, and **without** `-mno-fused-madd`, which is AFAIK the default) and with the p10 (with `-mno-fused-madd`) all (long) tests in
> 
>  `sage/lfunctions/sympow.py`
> 
> pass.

The fact that all tests pass, does not necessarily mean that SYMPOW is operating correctly.  It has been shown that SYMPOW sometimes computes incorrect results when fused-madd is used.  I agree, this was with gcc 4.6.0 on ia64, not gcc 4.4.6 on powerpc, but still...



---

archive/issue_comments_127963.json:
```json
{
    "body": "Diff for the new Sympow spkg, for review only",
    "created_at": "2011-10-31T14:15:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11920#issuecomment-127963",
    "user": "https://github.com/jdemeyer"
}
```

Diff for the new Sympow spkg, for review only



---

archive/issue_comments_127964.json:
```json
{
    "body": "<a id='comment:17'>**Comment 17:**</a>\n**Attachment:** [sympow-1.018.1.p9-p10.diff.gz](https://github.com/sagemath/sage/files/ticket11920/sympow-1.018.1.p9-p10.diff.gz)\n\nNew spkg, builds correctly on `silius`, both with gcc 4.6.1 and with gcc 4.3.4.  Needs review.",
    "created_at": "2011-10-31T14:15:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11920#issuecomment-127964",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'>**Comment 17:**</a>
**Attachment:** [sympow-1.018.1.p9-p10.diff.gz](https://github.com/sagemath/sage/files/ticket11920/sympow-1.018.1.p9-p10.diff.gz)

New spkg, builds correctly on `silius`, both with gcc 4.6.1 and with gcc 4.3.4.  Needs review.



---

archive/issue_events_135754.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-31T14:15:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11920#event-135754"
}
```



---

archive/issue_events_135755.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-31T14:15:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11920#event-135755"
}
```



---

archive/issue_comments_127965.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n See #11226 and [http://gcc.gnu.org/bugzilla/show_bug.cgi?id=48823](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=48823).\n \n-For sympow, we need to use the compiler option -ffp-contract=on (if the compiler supports it).\n+For sympow, we need to use the compiler option `-ffp-contract=on` or `-mno-fused-madd` (if the compiler supports it).\n \n Sympow should also create its datafiles, see #5155.\n \n``````\n",
    "created_at": "2011-10-31T14:19:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11920#issuecomment-127965",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 See #11226 and [http://gcc.gnu.org/bugzilla/show_bug.cgi?id=48823](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=48823).
 
-For sympow, we need to use the compiler option -ffp-contract=on (if the compiler supports it).
+For sympow, we need to use the compiler option `-ffp-contract=on` or `-mno-fused-madd` (if the compiler supports it).
 
 Sympow should also create its datafiles, see #5155.
 
``````




---

archive/issue_events_135756.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-31T14:19:26Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "rename": {
        "from": "Sympow needs specify -ffp-contract=on and should create datafiles",
        "to": "Sympow needs to disable fused-multiply-add and should create datafiles"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11920#event-135756"
}
```



---

archive/issue_comments_127966.json:
```json
{
    "body": "<a id='comment:19'>**Comment 19:**</a>\nThe new spkg does give harmless deprecation warnings on newer gcc versions.  Should I add the flag `-Wno-deprecated`?",
    "created_at": "2011-10-31T14:22:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11920#issuecomment-127966",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:19'>**Comment 19:**</a>
The new spkg does give harmless deprecation warnings on newer gcc versions.  Should I add the flag `-Wno-deprecated`?



---

archive/issue_comments_127967.json:
```json
{
    "body": "<a id='comment:20'>**Comment 20:**</a>\nReplying to [@jdemeyer](#comment%3A19):\n> The new spkg does give harmless deprecation warnings on newer gcc versions.  Should I add the flag `-Wno-deprecated`?\n\nWhy?  Because upstream died and nobody is going to fix the code?\n\nIMHO it's better to not suppress such warnings, even though they might confuse or annoy users.  (It's ok to suppress some other warnings, e.g. for Cython-generated files when you're 100% sure that GCC is just not smart enough to deduce that they're non-issues.  But in most cases, one should avoid the warnings by changing the code.)",
    "created_at": "2011-10-31T20:58:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11920#issuecomment-127967",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:20'>**Comment 20:**</a>
Replying to [@jdemeyer](#comment%3A19):
> The new spkg does give harmless deprecation warnings on newer gcc versions.  Should I add the flag `-Wno-deprecated`?

Why?  Because upstream died and nobody is going to fix the code?

IMHO it's better to not suppress such warnings, even though they might confuse or annoy users.  (It's ok to suppress some other warnings, e.g. for Cython-generated files when you're 100% sure that GCC is just not smart enough to deduce that they're non-issues.  But in most cases, one should avoid the warnings by changing the code.)



---

archive/issue_events_135757.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-11-03T16:14:43Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "milestone_number": null,
    "milestone_title": "sage-4.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11920#event-135757"
}
```



---

archive/issue_comments_127968.json:
```json
{
    "body": "Milestone sage-4.7.3 deleted",
    "created_at": "2011-11-03T16:14:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11920#issuecomment-127968",
    "user": "https://github.com/jdemeyer"
}
```

Milestone sage-4.7.3 deleted



---

archive/issue_comments_127969.json:
```json
{
    "body": "<a id='comment:22'>**Comment 22:**</a>\nI happen to be at a conference with Mark Watkins (sympow author) for the next 5 days.  Is there anything useful I can ask him?",
    "created_at": "2012-01-15T21:39:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11920#issuecomment-127969",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:22'>**Comment 22:**</a>
I happen to be at a conference with Mark Watkins (sympow author) for the next 5 days.  Is there anything useful I can ask him?



---

archive/issue_events_135758.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2012-01-15T21:39:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "milestone_number": null,
    "milestone_title": "sage-5.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11920#event-135758"
}
```



---

archive/issue_comments_127970.json:
```json
{
    "body": "<a id='comment:23'>**Comment 23:**</a>\nWhat is required of a reviewer?  I have no idea what is going on with these gcc issues.  But I successfully built the spkg on 4.8.alpha6 on a 64-bit ubuntu machine;  and not being sure what the relevant things to test are I am testing sage/schemes/elliptic_curves since I know that some sympow is used in there.\n\nBut I may be wasting my time since this is not the kind of machine on which there were problems, and the gcc version is 4.3.3.",
    "created_at": "2012-01-15T21:46:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11920#issuecomment-127970",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:23'>**Comment 23:**</a>
What is required of a reviewer?  I have no idea what is going on with these gcc issues.  But I successfully built the spkg on 4.8.alpha6 on a 64-bit ubuntu machine;  and not being sure what the relevant things to test are I am testing sage/schemes/elliptic_curves since I know that some sympow is used in there.

But I may be wasting my time since this is not the kind of machine on which there were problems, and the gcc version is 4.3.3.



---

archive/issue_comments_127971.json:
```json
{
    "body": "<a id='comment:24'>**Comment 24:**</a>\nReplying to [@JohnCremona](#comment%3A23):\n> What is required of a reviewer?  I have no idea what is going on with these gcc issues.  But I successfully built the spkg on 4.8.alpha6 on a 64-bit ubuntu machine;  and not being sure what the relevant things to test are I am testing sage/schemes/elliptic_curves since I know that some sympow is used in there.\n> \n> But I may be wasting my time since this is not the kind of machine on which there were problems, and the gcc version is 4.3.3.\n\nWell, in addition to the platforms where Sympow previously *caused* trouble (those with [optional] non-standard floating-point and/or MAC/FMA instructions), the new spkg should also (still) work on more common platforms, so testing it on the latter doesn't hurt either.\n\nPerhaps you could give more details w.r.t. the processor and your Ubuntu version; GCC 4.3.3 smells like Ubuntu 9.04.  Otherwise -- if your time allows -- you could run a full test (`ptestlong`) with a recent Sage version and the new spkg here.\n\nAccording to `deps`, only the Sage library depends on Sympow, so you don't have to rebuild any other spkgs.  (You could do a `./sage -ba-force` after installing the new spkg, but this shouldn't be necessary.)\n\n\n\n\nI don't think there's anything we (at least me) could or should ask Mark, but Jeroen will know better.",
    "created_at": "2012-01-15T22:17:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11920#issuecomment-127971",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:24'>**Comment 24:**</a>
Replying to [@JohnCremona](#comment%3A23):
> What is required of a reviewer?  I have no idea what is going on with these gcc issues.  But I successfully built the spkg on 4.8.alpha6 on a 64-bit ubuntu machine;  and not being sure what the relevant things to test are I am testing sage/schemes/elliptic_curves since I know that some sympow is used in there.
> 
> But I may be wasting my time since this is not the kind of machine on which there were problems, and the gcc version is 4.3.3.

Well, in addition to the platforms where Sympow previously *caused* trouble (those with [optional] non-standard floating-point and/or MAC/FMA instructions), the new spkg should also (still) work on more common platforms, so testing it on the latter doesn't hurt either.

Perhaps you could give more details w.r.t. the processor and your Ubuntu version; GCC 4.3.3 smells like Ubuntu 9.04.  Otherwise -- if your time allows -- you could run a full test (`ptestlong`) with a recent Sage version and the new spkg here.

According to `deps`, only the Sage library depends on Sympow, so you don't have to rebuild any other spkgs.  (You could do a `./sage -ba-force` after installing the new spkg, but this shouldn't be necessary.)




I don't think there's anything we (at least me) could or should ask Mark, but Jeroen will know better.



---

archive/issue_comments_127972.json:
```json
{
    "body": "<a id='comment:25'>**Comment 25:**</a>\nP.S.: I can perhaps (re-)review the new spkg tomorrow evening; I'm not sure whether there've been changes since I last looked at it.",
    "created_at": "2012-01-15T22:21:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11920#issuecomment-127972",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:25'>**Comment 25:**</a>
P.S.: I can perhaps (re-)review the new spkg tomorrow evening; I'm not sure whether there've been changes since I last looked at it.



---

archive/issue_comments_127973.json:
```json
{
    "body": "<a id='comment:26'>**Comment 26:**</a>\nReplying to [@nexttime](#comment%3A24):\n> According to `deps`, only the Sage library depends on Sympow, so you don't have to rebuild any other spkgs.  (You could do a `./sage -ba-force` after installing the new spkg, but this shouldn't be necessary.)\n\nAccording to deps, nothing depends on sympow ; see my recent mail to the sage-devel mailing-list where I'm surprised by the many roots of the dependency graph.",
    "created_at": "2012-01-16T07:04:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11920#issuecomment-127973",
    "user": "https://github.com/sagetrac-Snark"
}
```

<a id='comment:26'>**Comment 26:**</a>
Replying to [@nexttime](#comment%3A24):
> According to `deps`, only the Sage library depends on Sympow, so you don't have to rebuild any other spkgs.  (You could do a `./sage -ba-force` after installing the new spkg, but this shouldn't be necessary.)

According to deps, nothing depends on sympow ; see my recent mail to the sage-devel mailing-list where I'm surprised by the many roots of the dependency graph.



---

archive/issue_comments_127974.json:
```json
{
    "body": "<a id='comment:27'>**Comment 27:**</a>\nReplying to [Snark](#comment%3A26):\n> Replying to [@nexttime](#comment%3A24):\n> > According to `deps`, only the Sage library depends on Sympow, so you don't have to rebuild any other spkgs.  (You could do a `./sage -ba-force` after installing the new spkg, but this shouldn't be necessary.)\n\n> \n> According to deps, nothing depends on sympow ; see my recent mail to the sage-devel mailing-list where I'm surprised by the many roots of the dependency graph.\n\nDoesn't really surprise me... ;-)\n\n\nAt least target `all` (which is the real root of the dependency graph) depends on Sympow, and the Sage library *does use* the Sympow executable, so could or *should*<sup>TM</sup> depend on it (although there's no need to rebuild the library upon a change/update of Sympow, but `sage -b` usually doesn't do much anyway).",
    "created_at": "2012-01-16T19:32:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11920#issuecomment-127974",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:27'>**Comment 27:**</a>
Replying to [Snark](#comment%3A26):
> Replying to [@nexttime](#comment%3A24):
> > According to `deps`, only the Sage library depends on Sympow, so you don't have to rebuild any other spkgs.  (You could do a `./sage -ba-force` after installing the new spkg, but this shouldn't be necessary.)

> 
> According to deps, nothing depends on sympow ; see my recent mail to the sage-devel mailing-list where I'm surprised by the many roots of the dependency graph.

Doesn't really surprise me... ;-)


At least target `all` (which is the real root of the dependency graph) depends on Sympow, and the Sage library *does use* the Sympow executable, so could or *should*<sup>TM</sup> depend on it (although there's no need to rebuild the library upon a change/update of Sympow, but `sage -b` usually doesn't do much anyway).



---

archive/issue_comments_127975.json:
```json
{
    "body": "<a id='comment:28'>**Comment 28:**</a>\nReplying to [Snark](#comment%3A26):\n> According to deps, nothing depends on sympow ;\n\nTrue, no package depends on Sympow and the Sage library doesn't depend on Sympow in the sense that building it (`./sage -b`) doesn't need Sympow.  But of course, the Sage runtime needs Sympow.",
    "created_at": "2012-01-16T19:50:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11920#issuecomment-127975",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:28'>**Comment 28:**</a>
Replying to [Snark](#comment%3A26):
> According to deps, nothing depends on sympow ;

True, no package depends on Sympow and the Sage library doesn't depend on Sympow in the sense that building it (`./sage -b`) doesn't need Sympow.  But of course, the Sage runtime needs Sympow.



---

archive/issue_comments_127976.json:
```json
{
    "body": "<a id='comment:29'>**Comment 29:**</a>\nThanks for your remarks -- I can't help but notice two things:\n1. this question is crucial when one wants to work on cross-compilation, as a build-time dep must be built for the host and a runtime for the target!\n2. this bug report might not be the most appropriate place for this ;-)",
    "created_at": "2012-01-16T20:00:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11920#issuecomment-127976",
    "user": "https://github.com/sagetrac-Snark"
}
```

<a id='comment:29'>**Comment 29:**</a>
Thanks for your remarks -- I can't help but notice two things:
1. this question is crucial when one wants to work on cross-compilation, as a build-time dep must be built for the host and a runtime for the target!
2. this bug report might not be the most appropriate place for this ;-)



---

archive/issue_comments_127977.json:
```json
{
    "body": "<a id='comment:30'>**Comment 30:**</a>\nReplying to [@nexttime](#comment%3A25):\n> P.S.: I can perhaps (re-)review the new spkg tomorrow evening; I'm not sure whether there've been changes since I last looked at it.\n\nAt first glance looks ok, modulo some cosmetic inconsistencies and the like (in `spkg-install`):\n\n* Indentation\n* \"Sympow\" vs. \"sympow\" vs. \"SYMPOW\"; `SPKG.txt` (mostly) uses the latter.\n* Not all error messages are redirected to stderr.\n* Some error messages don't start with \"`Error`\" (and don't contain the word elsewhere).\n* Superfluous `if [ -d $FOO ]; then rm -rf $FOO; fi` (instead of just `rm -rf $FOO`) etc.\n* The viral trailing semicolon in\n\n```sh\n   echo \"SAGE_LOCAL undefined ... exiting\";\n```\n* A few typos (either *\"[fused] multiply-a**d**d instructions\"* or *\"multiply-and**-add**...\"* -- also without a hyphen before *\"instructions\"*; *\"almost surely on a**n** x86 system\"*, ...?)\n\nA little more relevant:\n\n* To go triple safe, you could add `-fno-fast-math` to your `FLAG` list.\n* `$SCRIPT` (which contains `$SAGE_LOCAL`) should be quoted near the end of `spkg-install`; perhaps also `$file`, which in contrast just depends on Sympow['s data file names], not a user setting.\n* The generated script should perhaps test `$SAGE_LOCAL` to give a meaningful error message in case it is undefined.\n* `if [ ! -f \"$TARGET/sympow\" ] ...` could be `if [ ! -x \"$TARGET/sympow\" ] ...`.\n\n\n\n\nI cannot (re)test this much; will probably do on cleo, perhaps silius, and some \"unaffected\" systems; interesting would also be newer Intel CPUs with AVX, although the early Sandy Bridges (for example) do not support multiply-accumulate IIRC.\n\nI also haven't looked at the new C code recently, assuming it hasn't changed since I last did (a few month ago).",
    "created_at": "2012-01-16T20:39:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11920#issuecomment-127977",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:30'>**Comment 30:**</a>
Replying to [@nexttime](#comment%3A25):
> P.S.: I can perhaps (re-)review the new spkg tomorrow evening; I'm not sure whether there've been changes since I last looked at it.

At first glance looks ok, modulo some cosmetic inconsistencies and the like (in `spkg-install`):

* Indentation
* "Sympow" vs. "sympow" vs. "SYMPOW"; `SPKG.txt` (mostly) uses the latter.
* Not all error messages are redirected to stderr.
* Some error messages don't start with "`Error`" (and don't contain the word elsewhere).
* Superfluous `if [ -d $FOO ]; then rm -rf $FOO; fi` (instead of just `rm -rf $FOO`) etc.
* The viral trailing semicolon in

```sh
   echo "SAGE_LOCAL undefined ... exiting";
```
* A few typos (either *"[fused] multiply-a**d**d instructions"* or *"multiply-and**-add**..."* -- also without a hyphen before *"instructions"*; *"almost surely on a**n** x86 system"*, ...?)

A little more relevant:

* To go triple safe, you could add `-fno-fast-math` to your `FLAG` list.
* `$SCRIPT` (which contains `$SAGE_LOCAL`) should be quoted near the end of `spkg-install`; perhaps also `$file`, which in contrast just depends on Sympow['s data file names], not a user setting.
* The generated script should perhaps test `$SAGE_LOCAL` to give a meaningful error message in case it is undefined.
* `if [ ! -f "$TARGET/sympow" ] ...` could be `if [ ! -x "$TARGET/sympow" ] ...`.




I cannot (re)test this much; will probably do on cleo, perhaps silius, and some "unaffected" systems; interesting would also be newer Intel CPUs with AVX, although the early Sandy Bridges (for example) do not support multiply-accumulate IIRC.

I also haven't looked at the new C code recently, assuming it hasn't changed since I last did (a few month ago).



---

archive/issue_comments_127978.json:
```json
{
    "body": "<a id='comment:31'>**Comment 31:**</a>\nReplying to [@nexttime](#comment%3A30):\n> I cannot (re)test this much; will probably do on cleo [...]\n\n```\n...\nLinux cleo 2.6.18-128.1.1.el5 #1 SMP Mon Jan 26 13:57:09 EST 2009 ia64 ia64 ia64 GNU/Linux\nDeleting directories from past builds of previous/current versions of sympow-1.018.1.p10\nExtracting package /home/leif/Sage/spkgs/sympow-1.018.1.p10.spkg ...\n-rw-r--r-- 1 leif sage 2212655 Oct 31 07:15 /home/leif/Sage/spkgs/sympow-1.018.1.p10.spkg\nFinished extraction\n****************************************************\nHost system\nuname -a:\nLinux cleo 2.6.18-128.1.1.el5 #1 SMP Mon Jan 26 13:57:09 EST 2009 ia64 ia64 ia64 GNU/Linux\n****************************************************\n****************************************************\nCC Version\ngcc -v\nUsing built-in specs.\nTarget: ia64-redhat-linux\nConfigured with: ../configure --prefix=/usr --mandir=/usr/share/man --infodir=/usr/share/info --enable-shared --enable-threads=posix --enable-checking=release --with-system-zlib --enable-__cxa_atexit --disable-libunwind-exceptions --enable-libgcj-multifile --enable-languages=c,c++,objc,obj-c++,java,fortran,ada --enable-java-awt=gtk --disable-dssi --enable-plugin --with-java-home=/usr/lib/jvm/java-1.4.2-gcj-1.4.2.0/jre --host=ia64-redhat-linux\nThread model: posix\ngcc version 4.1.2 20080704 (Red Hat 4.1.2-44)\n****************************************************\npatching file Configure\npatching file generate.c\npatching file fpu.c\nThe double precision of your FPU is 105 bits.\nThe Quad Double library used by SYMPOW assumes IEEE-754 double precision\nnumbers with exactly 53 bits in the mantissa (64 bits in total).\n\nUnfortunately, we currently have no workaround for your system.\nRunning SYMPOW will almost certainly fail on some inputs.\nPlease report this problem to\nsage-devel (http://groups.google.com/group/sage-devel),\nmentioning in particular your operating system, processor type\nand compiler version (run gcc --version).\n\nreal\t0m1.626s\nuser\t0m0.128s\nsys\t0m0.072s\n************************************************************************\nError installing package sympow-1.018.1.p10\n************************************************************************\n...\nleif@cleo:~/Sage/release/build/cleo/sage-4.8.rc0-gcc-4.2.1> echo $CFLAGS \n-O3 -g -fno-strict-aliasing\n```\n\nI think older GCCs (>= 4.0.1 or 4.2.1) should be supported as well, especially on platforms like this.  Haven't tracked down what exactly goes wrong...\n\n\n\n\nOoops, just noticed John C. infected me: Ignore the prompt / directory name -- it's of course GCC **4.1.2**, not 4.2.1.  Do we want to support this version (on Itanium)?",
    "created_at": "2012-01-17T19:42:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11920#issuecomment-127978",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:31'>**Comment 31:**</a>
Replying to [@nexttime](#comment%3A30):
> I cannot (re)test this much; will probably do on cleo [...]

```
...
Linux cleo 2.6.18-128.1.1.el5 #1 SMP Mon Jan 26 13:57:09 EST 2009 ia64 ia64 ia64 GNU/Linux
Deleting directories from past builds of previous/current versions of sympow-1.018.1.p10
Extracting package /home/leif/Sage/spkgs/sympow-1.018.1.p10.spkg ...
-rw-r--r-- 1 leif sage 2212655 Oct 31 07:15 /home/leif/Sage/spkgs/sympow-1.018.1.p10.spkg
Finished extraction
****************************************************
Host system
uname -a:
Linux cleo 2.6.18-128.1.1.el5 #1 SMP Mon Jan 26 13:57:09 EST 2009 ia64 ia64 ia64 GNU/Linux
****************************************************
****************************************************
CC Version
gcc -v
Using built-in specs.
Target: ia64-redhat-linux
Configured with: ../configure --prefix=/usr --mandir=/usr/share/man --infodir=/usr/share/info --enable-shared --enable-threads=posix --enable-checking=release --with-system-zlib --enable-__cxa_atexit --disable-libunwind-exceptions --enable-libgcj-multifile --enable-languages=c,c++,objc,obj-c++,java,fortran,ada --enable-java-awt=gtk --disable-dssi --enable-plugin --with-java-home=/usr/lib/jvm/java-1.4.2-gcj-1.4.2.0/jre --host=ia64-redhat-linux
Thread model: posix
gcc version 4.1.2 20080704 (Red Hat 4.1.2-44)
****************************************************
patching file Configure
patching file generate.c
patching file fpu.c
The double precision of your FPU is 105 bits.
The Quad Double library used by SYMPOW assumes IEEE-754 double precision
numbers with exactly 53 bits in the mantissa (64 bits in total).

Unfortunately, we currently have no workaround for your system.
Running SYMPOW will almost certainly fail on some inputs.
Please report this problem to
sage-devel (http://groups.google.com/group/sage-devel),
mentioning in particular your operating system, processor type
and compiler version (run gcc --version).

real	0m1.626s
user	0m0.128s
sys	0m0.072s
************************************************************************
Error installing package sympow-1.018.1.p10
************************************************************************
...
leif@cleo:~/Sage/release/build/cleo/sage-4.8.rc0-gcc-4.2.1> echo $CFLAGS 
-O3 -g -fno-strict-aliasing
```

I think older GCCs (>= 4.0.1 or 4.2.1) should be supported as well, especially on platforms like this.  Haven't tracked down what exactly goes wrong...




Ooops, just noticed John C. infected me: Ignore the prompt / directory name -- it's of course GCC **4.1.2**, not 4.2.1.  Do we want to support this version (on Itanium)?



---

archive/issue_comments_127979.json:
```json
{
    "body": "<a id='comment:32'>**Comment 32:**</a>\nReplying to [@nexttime](#comment%3A31):\n> \n\n```\n...\n************************************************************************\nError installing package sympow-1.018.1.p10\n************************************************************************\n...\nleif@cleo:~/Sage/release/build/cleo/sage-4.8.rc0-gcc-4.2.1> echo $CFLAGS \n-O3 -g -fno-strict-aliasing\n```\n\nMore detailed:\n\n```\n...\ngcc -v\nUsing built-in specs.\nTarget: ia64-redhat-linux\nConfigured with: ../configure --prefix=/usr --mandir=/usr/share/man --infodir=/usr/share/info --enable-shared --enable-threads=posix --enable-checking=release --with-system-zlib --enable-__cxa_atexit --disable-libunwind-exceptions --enable-libgcj-multifile --enable-languages=c,c++,objc,obj-c++,java,fortran,ada --enable-java-awt=gtk --disable-dssi --enable-plugin --with-java-home=/usr/lib/jvm/java-1.4.2-gcj-1.4.2.0/jre --host=ia64-redhat-linux\nThread model: posix\ngcc version 4.1.2 20080704 (Red Hat 4.1.2-44)\n****************************************************\npatching file Configure\npatching file generate.c\npatching file fpu.c\n\nInitial CFLAGS='-O3 -g -fno-strict-aliasing'\nTesting '-ffp-contract=on': ...not recognized (compilation failed)\nTesting '-mno-fused-madd': ...not recognized (compilation failed)\nTesting '-mfpmath=sse': ...not recognized (compilation failed)\nTesting '-mpc64': ...not recognized (compilation failed)\nAccumulated CFLAGS='-O3 -g -fno-strict-aliasing'\n\nThe double precision of your FPU is 105 bits.\nThe Quad Double library used by SYMPOW assumes IEEE-754 double precision\nnumbers with exactly 53 bits in the mantissa (64 bits in total).\n\nUnfortunately, we currently have no workaround for your system.\nRunning SYMPOW will almost certainly fail on some inputs.\n...\n```",
    "created_at": "2012-01-17T21:01:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11920#issuecomment-127979",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:32'>**Comment 32:**</a>
Replying to [@nexttime](#comment%3A31):
> 

```
...
************************************************************************
Error installing package sympow-1.018.1.p10
************************************************************************
...
leif@cleo:~/Sage/release/build/cleo/sage-4.8.rc0-gcc-4.2.1> echo $CFLAGS 
-O3 -g -fno-strict-aliasing
```

More detailed:

```
...
gcc -v
Using built-in specs.
Target: ia64-redhat-linux
Configured with: ../configure --prefix=/usr --mandir=/usr/share/man --infodir=/usr/share/info --enable-shared --enable-threads=posix --enable-checking=release --with-system-zlib --enable-__cxa_atexit --disable-libunwind-exceptions --enable-libgcj-multifile --enable-languages=c,c++,objc,obj-c++,java,fortran,ada --enable-java-awt=gtk --disable-dssi --enable-plugin --with-java-home=/usr/lib/jvm/java-1.4.2-gcj-1.4.2.0/jre --host=ia64-redhat-linux
Thread model: posix
gcc version 4.1.2 20080704 (Red Hat 4.1.2-44)
****************************************************
patching file Configure
patching file generate.c
patching file fpu.c

Initial CFLAGS='-O3 -g -fno-strict-aliasing'
Testing '-ffp-contract=on': ...not recognized (compilation failed)
Testing '-mno-fused-madd': ...not recognized (compilation failed)
Testing '-mfpmath=sse': ...not recognized (compilation failed)
Testing '-mpc64': ...not recognized (compilation failed)
Accumulated CFLAGS='-O3 -g -fno-strict-aliasing'

The double precision of your FPU is 105 bits.
The Quad Double library used by SYMPOW assumes IEEE-754 double precision
numbers with exactly 53 bits in the mantissa (64 bits in total).

Unfortunately, we currently have no workaround for your system.
Running SYMPOW will almost certainly fail on some inputs.
...
```



---

archive/issue_events_135759.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2012-01-17T21:31:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11920#event-135759"
}
```



---

archive/issue_events_135760.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2012-01-17T21:31:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11920#event-135760"
}
```



---

archive/issue_comments_127980.json:
```json
{
    "body": "<a id='comment:33'>**Comment 33:**</a>\nReplying to [@nexttime](#comment%3A32):\n> More detailed:\n\n\n```\n...\ngcc -v\nUsing built-in specs.\nTarget: ia64-redhat-linux\nConfigured with: ../configure --prefix=/usr --mandir=/usr/share/man --infodir=/usr/share/info --enable-shared --enable-threads=posix --enable-checking=release --with-system-zlib --enable-__cxa_atexit --disable-libunwind-exceptions --enable-libgcj-multifile --enable-languages=c,c++,objc,obj-c++,java,fortran,ada --enable-java-awt=gtk --disable-dssi --enable-plugin --with-java-home=/usr/lib/jvm/java-1.4.2-gcj-1.4.2.0/jre --host=ia64-redhat-linux\nThread model: posix\ngcc version 4.1.2 20080704 (Red Hat 4.1.2-44)\n****************************************************\npatching file Configure\npatching file generate.c\npatching file fpu.c\n \nInitial CFLAGS='-O3 -g -fno-strict-aliasing'\nTesting '-ffp-contract=on': ...not recognized (compilation failed)\nTesting '-mno-fused-madd': ...not recognized (compilation failed)\nTesting '-mfpmath=sse': ...not recognized (compilation failed)\nTesting '-mpc64': ...not recognized (compilation failed)\nAccumulated CFLAGS='-O3 -g -fno-strict-aliasing'\n\nThe double precision of your FPU is 105 bits.\nThe Quad Double library used by SYMPOW assumes IEEE-754 double precision\nnumbers with exactly 53 bits in the mantissa (64 bits in total).\n\nUnfortunately, we currently have no workaround for your system.\nRunning SYMPOW will almost certainly fail on some inputs.\n...\n```\n\n\nIn this case `-ffloat-store` helps (`-fno-fast-math` doesn't):\n\n```\n...\npatching file Configure\npatching file generate.c\npatching file fpu.c\n\nInitial CFLAGS='-O3 -g -fno-strict-aliasing'\nTesting '-ffp-contract=on': ...not recognized (compilation failed)\nTesting '-mno-fused-madd': ...not recognized (compilation failed)\nTesting '-mfpmath=sse': ...not recognized (compilation failed)\nTesting '-mpc64': ...not recognized (compilation failed)\nTesting '-ffloat-store': ...compiles ...runs (exit code 0)\nTesting '-fno-fast-math': ...compiles ...runs (exit code 0)\nAccumulated CFLAGS='-O3 -g -fno-strict-aliasing -ffloat-store -fno-fast-math'\n\nThe double precision of your FPU is 53 bits.\n...\n```",
    "created_at": "2012-01-17T21:31:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11920#issuecomment-127980",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:33'>**Comment 33:**</a>
Replying to [@nexttime](#comment%3A32):
> More detailed:


```
...
gcc -v
Using built-in specs.
Target: ia64-redhat-linux
Configured with: ../configure --prefix=/usr --mandir=/usr/share/man --infodir=/usr/share/info --enable-shared --enable-threads=posix --enable-checking=release --with-system-zlib --enable-__cxa_atexit --disable-libunwind-exceptions --enable-libgcj-multifile --enable-languages=c,c++,objc,obj-c++,java,fortran,ada --enable-java-awt=gtk --disable-dssi --enable-plugin --with-java-home=/usr/lib/jvm/java-1.4.2-gcj-1.4.2.0/jre --host=ia64-redhat-linux
Thread model: posix
gcc version 4.1.2 20080704 (Red Hat 4.1.2-44)
****************************************************
patching file Configure
patching file generate.c
patching file fpu.c
 
Initial CFLAGS='-O3 -g -fno-strict-aliasing'
Testing '-ffp-contract=on': ...not recognized (compilation failed)
Testing '-mno-fused-madd': ...not recognized (compilation failed)
Testing '-mfpmath=sse': ...not recognized (compilation failed)
Testing '-mpc64': ...not recognized (compilation failed)
Accumulated CFLAGS='-O3 -g -fno-strict-aliasing'

The double precision of your FPU is 105 bits.
The Quad Double library used by SYMPOW assumes IEEE-754 double precision
numbers with exactly 53 bits in the mantissa (64 bits in total).

Unfortunately, we currently have no workaround for your system.
Running SYMPOW will almost certainly fail on some inputs.
...
```


In this case `-ffloat-store` helps (`-fno-fast-math` doesn't):

```
...
patching file Configure
patching file generate.c
patching file fpu.c

Initial CFLAGS='-O3 -g -fno-strict-aliasing'
Testing '-ffp-contract=on': ...not recognized (compilation failed)
Testing '-mno-fused-madd': ...not recognized (compilation failed)
Testing '-mfpmath=sse': ...not recognized (compilation failed)
Testing '-mpc64': ...not recognized (compilation failed)
Testing '-ffloat-store': ...compiles ...runs (exit code 0)
Testing '-fno-fast-math': ...compiles ...runs (exit code 0)
Accumulated CFLAGS='-O3 -g -fno-strict-aliasing -ffloat-store -fno-fast-math'

The double precision of your FPU is 53 bits.
...
```



---

archive/issue_events_135761.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-01-19T16:13:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11920#event-135761"
}
```



---

archive/issue_events_135762.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-01-19T16:13:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11920#event-135762"
}
```



---

archive/issue_comments_127981.json:
```json
{
    "body": "<a id='comment:34'>**Comment 34:**</a>\nleif: I took care of most of your comments.  It now uses \"-ffloat-store\" if needed.",
    "created_at": "2012-01-19T16:13:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11920#issuecomment-127981",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:34'>**Comment 34:**</a>
leif: I took care of most of your comments.  It now uses "-ffloat-store" if needed.



---

archive/issue_comments_127982.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,7 +1,7 @@\n See #11226 and [http://gcc.gnu.org/bugzilla/show_bug.cgi?id=48823](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=48823).\n \n-For sympow, we need to use the compiler option `-ffp-contract=on` or `-mno-fused-madd` (if the compiler supports it).\n+For sympow, we need to use the compiler option `-ffp-contract=on`, `-mno-fused-madd` or `-ffloat-store` (if the compiler supports it).\n \n Sympow should also create its datafiles, see #5155.\n \n-**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/sympow-1.018.1.p10.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/sympow-1.018.1.p10.spkg)\n+**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/sympow-1.018.1.p11.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/sympow-1.018.1.p11.spkg)\n``````\n",
    "created_at": "2012-01-19T16:13:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11920#issuecomment-127982",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,7 +1,7 @@
 See #11226 and [http://gcc.gnu.org/bugzilla/show_bug.cgi?id=48823](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=48823).
 
-For sympow, we need to use the compiler option `-ffp-contract=on` or `-mno-fused-madd` (if the compiler supports it).
+For sympow, we need to use the compiler option `-ffp-contract=on`, `-mno-fused-madd` or `-ffloat-store` (if the compiler supports it).
 
 Sympow should also create its datafiles, see #5155.
 
-**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/sympow-1.018.1.p10.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/sympow-1.018.1.p10.spkg)
+**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/sympow-1.018.1.p11.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/sympow-1.018.1.p11.spkg)
``````




---

archive/issue_comments_127983.json:
```json
{
    "body": "**Attachment:** [sympow-1.018.1.p10-p11.diff.gz](https://github.com/sagemath/sage/files/ticket11920/sympow-1.018.1.p10-p11.diff.gz)\n\nDiff for the sympow spkg p10 -> p11, for review only",
    "created_at": "2012-01-19T16:14:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11920#issuecomment-127983",
    "user": "https://github.com/jdemeyer"
}
```

**Attachment:** [sympow-1.018.1.p10-p11.diff.gz](https://github.com/sagemath/sage/files/ticket11920/sympow-1.018.1.p10-p11.diff.gz)

Diff for the sympow spkg p10 -> p11, for review only



---

archive/issue_comments_127984.json:
```json
{
    "body": "<a id='comment:35'>**Comment 35:**</a>\nleif, could you please review?",
    "created_at": "2012-01-21T23:49:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11920#issuecomment-127984",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:35'>**Comment 35:**</a>
leif, could you please review?



---

archive/issue_comments_127985.json:
```json
{
    "body": "<a id='comment:36'>**Comment 36:**</a>\nReplying to [@jdemeyer](#comment%3A35):\n> leif, could you please review?\n\nI'm *\"at it*\"<sup>TM</sup> (already took a brief look); will yet take some time, hopefully later today...",
    "created_at": "2012-01-22T09:26:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11920#issuecomment-127985",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:36'>**Comment 36:**</a>
Replying to [@jdemeyer](#comment%3A35):
> leif, could you please review?

I'm *"at it*"<sup>TM</sup> (already took a brief look); will yet take some time, hopefully later today...



---

archive/issue_comments_127986.json:
```json
{
    "body": "<a id='comment:37'>**Comment 37:**</a>\nReplying to [@nexttime](#comment%3A36):\n> I'm *\"at it*\"<sup>TM</sup> (already took a brief look); will yet take some time, hopefully later today...\n\n\nP.S.: FWIW, now of course also builds and passes tests on cleo with GCC 4.1.2.",
    "created_at": "2012-01-22T09:28:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11920#issuecomment-127986",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:37'>**Comment 37:**</a>
Replying to [@nexttime](#comment%3A36):
> I'm *"at it*"<sup>TM</sup> (already took a brief look); will yet take some time, hopefully later today...


P.S.: FWIW, now of course also builds and passes tests on cleo with GCC 4.1.2.



---

archive/issue_comments_127987.json:
```json
{
    "body": "<a id='comment:38'>**Comment 38:**</a>\nI wonder if we should try `-ffloat-store` before \"resorting\" to `-fno-fast-math` (which, depending on the platform, disables a lot), but I don't really have an idea w.r.t. the performance impact.",
    "created_at": "2012-01-22T09:35:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11920#issuecomment-127987",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:38'>**Comment 38:**</a>
I wonder if we should try `-ffloat-store` before "resorting" to `-fno-fast-math` (which, depending on the platform, disables a lot), but I don't really have an idea w.r.t. the performance impact.



---

archive/issue_comments_127988.json:
```json
{
    "body": "<a id='comment:39'>**Comment 39:**</a>\n`-fno-fast-math` is clearly an option we want in all cases.  The opposite `-ffast-math` makes code not IEEE compliant.",
    "created_at": "2012-01-22T10:03:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11920#issuecomment-127988",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:39'>**Comment 39:**</a>
`-fno-fast-math` is clearly an option we want in all cases.  The opposite `-ffast-math` makes code not IEEE compliant.



---

archive/issue_comments_127989.json:
```json
{
    "body": "<a id='comment:40'>**Comment 40:**</a>\nLooks good to me.\n\nIncidentally, did you look at the sympow source? Do you have an opinion on how easy it would be to replace their troublesome quad math implementation with libquadmath?",
    "created_at": "2012-02-04T19:49:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11920#issuecomment-127989",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:40'>**Comment 40:**</a>
Looks good to me.

Incidentally, did you look at the sympow source? Do you have an opinion on how easy it would be to replace their troublesome quad math implementation with libquadmath?



---

archive/issue_comments_127990.json:
```json
{
    "body": "**Changing reviewer** from \"Leif Leonhardy\" to \"Leif Leonhardy, Volker Braun\".",
    "created_at": "2012-02-04T19:49:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11920#issuecomment-127990",
    "user": "https://github.com/vbraun"
}
```

**Changing reviewer** from "Leif Leonhardy" to "Leif Leonhardy, Volker Braun".



---

archive/issue_events_135763.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2012-02-04T19:49:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11920#event-135763"
}
```



---

archive/issue_events_135764.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2012-02-04T19:49:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11920#event-135764"
}
```



---

archive/issue_comments_127991.json:
```json
{
    "body": "<a id='comment:41'>**Comment 41:**</a>\nReplying to [@vbraun](#comment%3A40):\n> Looks good to me.\n> \n> Incidentally, did you look at the sympow source?\n\nNo.\n\n> Do you have an opinion on how easy it would be to replace their troublesome quad math implementation with libquadmath? \n\nI think libquadmath does something different from SYMPOW's \"quad double\".  libquadmath implements [Quadruple precision numbers](http://en.wikipedia.org/wiki/Quadruple_precision) (113 bits) whereas SYMPOW's quad double implements something like 4*53 = 212 bits of precision.\n\nAnyway, I don't think it's that troublesome, once you understand that it needs IEEE-compliants doubles.\n\nThanks for the review!",
    "created_at": "2012-02-06T08:33:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11920#issuecomment-127991",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:41'>**Comment 41:**</a>
Replying to [@vbraun](#comment%3A40):
> Looks good to me.
> 
> Incidentally, did you look at the sympow source?

No.

> Do you have an opinion on how easy it would be to replace their troublesome quad math implementation with libquadmath? 

I think libquadmath does something different from SYMPOW's "quad double".  libquadmath implements [Quadruple precision numbers](http://en.wikipedia.org/wiki/Quadruple_precision) (113 bits) whereas SYMPOW's quad double implements something like 4*53 = 212 bits of precision.

Anyway, I don't think it's that troublesome, once you understand that it needs IEEE-compliants doubles.

Thanks for the review!



---

archive/issue_events_135765.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-02-07T13:21:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11920#event-135765"
}
```



---

archive/issue_events_135766.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-02-07T13:21:32Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11920#event-135766"
}
```



---

archive/issue_comments_127992.json:
```json
{
    "body": "**Merged:** sage-5.0.beta3",
    "created_at": "2012-02-07T13:21:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11920",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11920#issuecomment-127992",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.0.beta3
