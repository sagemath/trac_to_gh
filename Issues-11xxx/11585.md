# Issue 11585: Make deprecated_function_alias print the whole module path when it differs from the original

archive/issues_011413.json:
```json
{
    "body": "Currently\n\n```\nsage: from sage.misc.misc import deprecated_function_alias\nsage: a = deprecated_function_alias(sqrt, \"Version ?\")\nsage: a(5)\n...\nDeprecationWarning: (Since Version ?) a is deprecated. Please use sqrt instead.\nsqrt(5)\n```\n\nwhich is misleading because the user would expect to find `sqrt` in the same module as `a`.\n\nWith this patch\n\n```\nsage: from sage.misc.misc import deprecated_function_alias\nsage: a = deprecated_function_alias(sqrt, \"Version ?\")\nsage: a(5)\n...\nDeprecationWarning: (Since Version ?) a is deprecated. Please use sage.functions.other.sqrt instead.\nsqrt(5)\n```\n\nThere's no change in deprecating methods.\n\n\n**Apply:**\n1.  [attachment:trac_11585_deprecated_function_alias-rc2.patch]\n\n\n**Assignee:** @hivert\n\n**CC:**  @hivert\n\n**Keywords:** deprecation\n\n**Reviewer:** Rob Beezer\n\n**Author:** Luca De Feo, Florent Hivert\n\n**Merged:** sage-5.0.beta10\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/11585\n\n",
    "closed_at": "2012-03-23T15:19:12Z",
    "created_at": "2011-07-11T05:38:20Z",
    "labels": [
        "component: misc",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.0",
    "title": "Make deprecated_function_alias print the whole module path when it differs from the original",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11585",
    "user": "https://github.com/defeo"
}
```
Currently

```
sage: from sage.misc.misc import deprecated_function_alias
sage: a = deprecated_function_alias(sqrt, "Version ?")
sage: a(5)
...
DeprecationWarning: (Since Version ?) a is deprecated. Please use sqrt instead.
sqrt(5)
```

which is misleading because the user would expect to find `sqrt` in the same module as `a`.

With this patch

```
sage: from sage.misc.misc import deprecated_function_alias
sage: a = deprecated_function_alias(sqrt, "Version ?")
sage: a(5)
...
DeprecationWarning: (Since Version ?) a is deprecated. Please use sage.functions.other.sqrt instead.
sqrt(5)
```

There's no change in deprecating methods.


**Apply:**
1.  [attachment:trac_11585_deprecated_function_alias-rc2.patch]


**Assignee:** @hivert

**CC:**  @hivert

**Keywords:** deprecation

**Reviewer:** Rob Beezer

**Author:** Luca De Feo, Florent Hivert

**Merged:** sage-5.0.beta10

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/11585





---

archive/issue_comments_160883.json:
```json
{
    "body": "Attachment [trac_11585_depracted_function_alias.patch](tarball://root/attachments/some-uuid/ticket11585/trac_11585_depracted_function_alias.patch) by @defeo created at 2011-07-11 17:05:38",
    "created_at": "2011-07-11T17:05:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-160883",
    "user": "https://github.com/defeo"
}
```

Attachment [trac_11585_depracted_function_alias.patch](tarball://root/attachments/some-uuid/ticket11585/trac_11585_depracted_function_alias.patch) by @defeo created at 2011-07-11 17:05:38



---

archive/issue_comments_160884.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2011-07-11T17:06:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-160884",
    "user": "https://github.com/defeo"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_160885.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -8,6 +8,9 @@\n DeprecationWarning: (Since Version ?) a is deprecated. Please use sqrt instead.\n sqrt(5)\n ```\n+\n+**Apply:**\n+1.  [attachment:trac_11585_depracted_function_alias.patch]\n \n which is misleading because the user would expect to find `sqrt` in the same module as `a`.\n \n``````\n",
    "created_at": "2011-07-11T20:24:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-160885",
    "user": "https://github.com/rbeezer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -8,6 +8,9 @@
 DeprecationWarning: (Since Version ?) a is deprecated. Please use sqrt instead.
 sqrt(5)
 ```
+
+**Apply:**
+1.  [attachment:trac_11585_depracted_function_alias.patch]
 
 which is misleading because the user would expect to find `sqrt` in the same module as `a`.
 
``````




---

archive/issue_comments_160886.json:
```json
{
    "body": "**Reviewer:** Rob Beezer",
    "created_at": "2011-07-11T20:24:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-160886",
    "user": "https://github.com/rbeezer"
}
```

**Reviewer:** Rob Beezer



---

archive/issue_comments_160887.json:
```json
{
    "body": "<a id='comment:2'></a>\nLooks good.  Passes long tests on 4.7.1.alpha3.  I've cc'ed Florent Hivert in case he wants to add anything.  I've also added an \"Apply\" section to the description for the release manager.\n\nTwo minor formatting items need attention.\n\n\nLine 2287: `Trac #11585::`\n\nYou need a blank line after the double-colon to make the verbatim text format properly.\n\nYou can test documentation via  `sage -docbuild reference html` after a fresh build (`sage -b`) and then viewing the resulting HTML file.\n\n\nLine 2299:\n\n```\nif module is None: module_name = '__main__'\nelse: module_name = module.__name__\n```\n\nshould be formatted as\n\n```\nif module is None:\n    module_name = '__main__'\nelse:\n    module_name = module.__name__\n```\n\nSee http://www.sagemath.org/doc/developer/conventions.html\n\nwhich references:  http://www.python.org/dev/peps/pep-0008/\n\n(look shortly after \"Compound statements\")",
    "created_at": "2011-07-11T20:24:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-160887",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:2'></a>
Looks good.  Passes long tests on 4.7.1.alpha3.  I've cc'ed Florent Hivert in case he wants to add anything.  I've also added an "Apply" section to the description for the release manager.

Two minor formatting items need attention.


Line 2287: `Trac #11585::`

You need a blank line after the double-colon to make the verbatim text format properly.

You can test documentation via  `sage -docbuild reference html` after a fresh build (`sage -b`) and then viewing the resulting HTML file.


Line 2299:

```
if module is None: module_name = '__main__'
else: module_name = module.__name__
```

should be formatted as

```
if module is None:
    module_name = '__main__'
else:
    module_name = module.__name__
```

See http://www.sagemath.org/doc/developer/conventions.html

which references:  http://www.python.org/dev/peps/pep-0008/

(look shortly after "Compound statements")



---

archive/issue_comments_160888.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2011-07-11T20:24:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-160888",
    "user": "https://github.com/rbeezer"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_160889.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -10,7 +10,7 @@\n ```\n \n **Apply:**\n-1.  [attachment:trac_11585_depracted_function_alias.patch]\n+1.  [attachment:trac_11585_deprecated_function_alias.patch]\n \n which is misleading because the user would expect to find `sqrt` in the same module as `a`.\n \n``````\n",
    "created_at": "2011-07-11T20:59:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-160889",
    "user": "https://github.com/defeo"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -10,7 +10,7 @@
 ```
 
 **Apply:**
-1.  [attachment:trac_11585_depracted_function_alias.patch]
+1.  [attachment:trac_11585_deprecated_function_alias.patch]
 
 which is misleading because the user would expect to find `sqrt` in the same module as `a`.
 
``````




---

archive/issue_comments_160890.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2011-07-11T20:59:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-160890",
    "user": "https://github.com/defeo"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_160891.json:
```json
{
    "body": "<a id='comment:3'></a>\nAttachment [trac_11585_deprecated_function_alias.patch](tarball://root/attachments/some-uuid/ticket11585/trac_11585_deprecated_function_alias.patch) by @defeo created at 2011-07-11 20:59:58\n\nModified as requested by rbeezer. Apply second patch only (sorry for the mispelling in the first patch).",
    "created_at": "2011-07-11T20:59:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-160891",
    "user": "https://github.com/defeo"
}
```

<a id='comment:3'></a>
Attachment [trac_11585_deprecated_function_alias.patch](tarball://root/attachments/some-uuid/ticket11585/trac_11585_deprecated_function_alias.patch) by @defeo created at 2011-07-11 20:59:58

Modified as requested by rbeezer. Apply second patch only (sorry for the mispelling in the first patch).



---

archive/issue_comments_160892.json:
```json
{
    "body": "<a id='comment:4'></a>\nLuca,\n\nLooks good - thanks for the improvement.\n\nI am going to switch this to positive review, but Florent Hivert should feel free to get in on this just in case he sees something.\n\nRob",
    "created_at": "2011-07-11T21:37:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-160892",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:4'></a>
Luca,

Looks good - thanks for the improvement.

I am going to switch this to positive review, but Florent Hivert should feel free to get in on this just in case he sees something.

Rob



---

archive/issue_comments_160893.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2011-07-11T21:37:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-160893",
    "user": "https://github.com/rbeezer"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_160894.json:
```json
{
    "body": "<a id='comment:5'></a>\nI've no particular comments concerning this patch. We should start to actually remove deprecated things from sage, but this is another problem. Ready to go.\n\nFlorent",
    "created_at": "2011-07-13T08:33:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-160894",
    "user": "https://github.com/hivert"
}
```

<a id='comment:5'></a>
I've no particular comments concerning this patch. We should start to actually remove deprecated things from sage, but this is another problem. Ready to go.

Florent



---

archive/issue_comments_160895.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -8,9 +8,6 @@\n DeprecationWarning: (Since Version ?) a is deprecated. Please use sqrt instead.\n sqrt(5)\n ```\n-\n-**Apply:**\n-1.  [attachment:trac_11585_deprecated_function_alias.patch]\n \n which is misleading because the user would expect to find `sqrt` in the same module as `a`.\n \n@@ -26,3 +23,8 @@\n ```\n \n There's no change in deprecating methods.\n+\n+\n+**Apply:**\n+1.  [attachment:trac_11585_deprecated_function_alias.patch]\n+\n``````\n",
    "created_at": "2011-07-13T08:33:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-160895",
    "user": "https://github.com/hivert"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -8,9 +8,6 @@
 DeprecationWarning: (Since Version ?) a is deprecated. Please use sqrt instead.
 sqrt(5)
 ```
-
-**Apply:**
-1.  [attachment:trac_11585_deprecated_function_alias.patch]
 
 which is misleading because the user would expect to find `sqrt` in the same module as `a`.
 
@@ -26,3 +23,8 @@
 ```
 
 There's no change in deprecating methods.
+
+
+**Apply:**
+1.  [attachment:trac_11585_deprecated_function_alias.patch]
+
``````




---

archive/issue_comments_160896.json:
```json
{
    "body": "<a id='comment:6'></a>\nThis needs to be rebased to sage-4.7.1.rc1",
    "created_at": "2011-07-28T10:56:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-160896",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>
This needs to be rebased to sage-4.7.1.rc1



---

archive/issue_comments_160897.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2011-07-28T10:56:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-160897",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_160898.json:
```json
{
    "body": "Rebased against rc1",
    "created_at": "2011-07-28T23:57:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-160898",
    "user": "https://github.com/defeo"
}
```

Rebased against rc1



---

archive/issue_comments_160899.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -26,5 +26,5 @@\n \n \n **Apply:**\n-1.  [attachment:trac_11585_deprecated_function_alias.patch]\n+1.  [attachment:trac_11585_deprecated_function_alias+rc1.patch]\n \n``````\n",
    "created_at": "2011-07-28T23:58:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-160899",
    "user": "https://github.com/defeo"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -26,5 +26,5 @@
 
 
 **Apply:**
-1.  [attachment:trac_11585_deprecated_function_alias.patch]
+1.  [attachment:trac_11585_deprecated_function_alias+rc1.patch]
 
``````




---

archive/issue_comments_160900.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2011-07-28T23:58:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-160900",
    "user": "https://github.com/defeo"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_160901.json:
```json
{
    "body": "<a id='comment:7'></a>\nAttachment [trac_11585_deprecated_function_alias+rc1.patch](tarball://root/attachments/some-uuid/ticket11585/trac_11585_deprecated_function_alias+rc1.patch) by @defeo created at 2011-07-28 23:58:06",
    "created_at": "2011-07-28T23:58:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-160901",
    "user": "https://github.com/defeo"
}
```

<a id='comment:7'></a>
Attachment [trac_11585_deprecated_function_alias+rc1.patch](tarball://root/attachments/some-uuid/ticket11585/trac_11585_deprecated_function_alias+rc1.patch) by @defeo created at 2011-07-28 23:58:06



---

archive/issue_comments_160902.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2011-07-29T07:19:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-160902",
    "user": "https://github.com/hivert"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_160903.json:
```json
{
    "body": "**Changing reviewer** from \"Rob Beezer\" to \"Rob Beezer, Florent Hivert\".",
    "created_at": "2011-07-29T07:19:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-160903",
    "user": "https://github.com/hivert"
}
```

**Changing reviewer** from "Rob Beezer" to "Rob Beezer, Florent Hivert".



---

archive/issue_comments_160904.json:
```json
{
    "body": "<a id='comment:8'></a>\nIf you just rebased the patch, you are allowed to put a positive review yourself. Anyway, I made a short re-review and found it Ok.\n\nFlorent",
    "created_at": "2011-07-29T07:19:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-160904",
    "user": "https://github.com/hivert"
}
```

<a id='comment:8'></a>
If you just rebased the patch, you are allowed to put a positive review yourself. Anyway, I made a short re-review and found it Ok.

Florent



---

archive/issue_events_035982.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-08-03T14:38:15Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11585#event-35982"
}
```



---

archive/issue_comments_160905.json:
```json
{
    "body": "**Merged:** sage-4.7.2.alpha1",
    "created_at": "2011-08-03T14:38:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-160905",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-4.7.2.alpha1



---

archive/issue_comments_160906.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2011-08-03T14:38:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-160906",
    "user": "https://github.com/jdemeyer"
}
```

**Resolution:** fixed



---

archive/issue_comments_160907.json:
```json
{
    "body": "<a id='comment:10'></a>\nThis patch greatly increases the Sage startup time.  On `sage.math.washington.edu`, before the patch it is roughly 1.4s and after the patch 2.2s.",
    "created_at": "2011-08-17T12:31:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-160907",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>
This patch greatly increases the Sage startup time.  On `sage.math.washington.edu`, before the patch it is roughly 1.4s and after the patch 2.2s.



---

archive/issue_comments_160908.json:
```json
{
    "body": "**Changing status** from closed to new.",
    "created_at": "2011-08-17T12:31:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-160908",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from closed to new.



---

archive/issue_comments_160909.json:
```json
{
    "body": "**Resolution changed** from fixed to .",
    "created_at": "2011-08-17T12:31:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-160909",
    "user": "https://github.com/jdemeyer"
}
```

**Resolution changed** from fixed to .



---

archive/issue_comments_160910.json:
```json
{
    "body": "**Changing merged** from \"sage-4.7.2.alpha1\" to \"\".",
    "created_at": "2011-08-17T12:31:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-160910",
    "user": "https://github.com/jdemeyer"
}
```

**Changing merged** from "sage-4.7.2.alpha1" to "".



---

archive/issue_comments_160911.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2011-08-17T12:32:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-160911",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_160912.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2011-08-17T12:33:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-160912",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_160913.json:
```json
{
    "body": "**Work_Issues:** startuptime",
    "created_at": "2011-08-17T12:33:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-160913",
    "user": "https://github.com/jdemeyer"
}
```

**Work_Issues:** startuptime



---

archive/issue_comments_160914.json:
```json
{
    "body": "<a id='comment:13'></a>\nOuch! This single line is responsible for it:\n\n```\nmodule = inspect.getmodule(inspect.stack()[1][0])\n```\n\nIn fact, there's about 40 calls to `deprecated_function_alias` in 4.7.1.rc2; on my laptop:\n\n```\nsage: import inspect\nsage: timeit('inspect.stack()[1][0]')\n25 loops, best of 3: 18.4 ms per loop\n```\n\nThe fact is, I don't know how to obtain the name of the module where the call to `deprecated_function_alias` happened without inspecting the stack. Any ideas?",
    "created_at": "2011-08-17T21:58:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-160914",
    "user": "https://github.com/defeo"
}
```

<a id='comment:13'></a>
Ouch! This single line is responsible for it:

```
module = inspect.getmodule(inspect.stack()[1][0])
```

In fact, there's about 40 calls to `deprecated_function_alias` in 4.7.1.rc2; on my laptop:

```
sage: import inspect
sage: timeit('inspect.stack()[1][0]')
25 loops, best of 3: 18.4 ms per loop
```

The fact is, I don't know how to obtain the name of the module where the call to `deprecated_function_alias` happened without inspecting the stack. Any ideas?



---

archive/issue_comments_160915.json:
```json
{
    "body": "<a id='comment:14'></a>\n> The fact is, I don't know how to obtain the name of the module where the call to `deprecated_function_alias` happened without inspecting the stack. Any ideas?\n\n\nI don't have to investigate further now but I think you don't need the full stack but only the top of it. Using \n\n```\ninspect.getframeinfo(sys._getframe(1),1)\n```\nshould be much faster...",
    "created_at": "2012-03-15T12:05:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-160915",
    "user": "https://github.com/hivert"
}
```

<a id='comment:14'></a>
> The fact is, I don't know how to obtain the name of the module where the call to `deprecated_function_alias` happened without inspecting the stack. Any ideas?


I don't have to investigate further now but I think you don't need the full stack but only the top of it. Using 

```
inspect.getframeinfo(sys._getframe(1),1)
```
should be much faster...



---

archive/issue_comments_160916.json:
```json
{
    "body": "<a id='comment:15'></a>\nHere is what I think is a good solution `inspect.currentframe(1)` does the\nsame as `inspect.stack()[1][0]` only 400 time faster:\n\n```\nsage: import inspect\nsage: inspect.getmodule(inspect.stack()[1][0]) == inspect.getmodule(inspect.currentframe(1))\nTrue\nsage: timeit('inspect.getmodule(inspect.stack()[1][0])')\n25 loops, best of 3: 15.6 ms per loop\nsage: timeit('inspect.getmodule(inspect.currentframe(1))')\n625 loops, best of 3: 40.7 \u00b5s per loop\n```\nI'm updating the patch accordingly.\n\nFlorent",
    "created_at": "2012-03-15T13:25:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-160916",
    "user": "https://github.com/hivert"
}
```

<a id='comment:15'></a>
Here is what I think is a good solution `inspect.currentframe(1)` does the
same as `inspect.stack()[1][0]` only 400 time faster:

```
sage: import inspect
sage: inspect.getmodule(inspect.stack()[1][0]) == inspect.getmodule(inspect.currentframe(1))
True
sage: timeit('inspect.getmodule(inspect.stack()[1][0])')
25 loops, best of 3: 15.6 ms per loop
sage: timeit('inspect.getmodule(inspect.currentframe(1))')
625 loops, best of 3: 40.7 Âµs per loop
```
I'm updating the patch accordingly.

Florent



---

archive/issue_comments_160917.json:
```json
{
    "body": "**Remove assignee** @jasongrout.",
    "created_at": "2012-03-15T13:25:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-160917",
    "user": "https://github.com/hivert"
}
```

**Remove assignee** @jasongrout.



---

archive/issue_comments_160918.json:
```json
{
    "body": "<a id='comment:16'></a>\nUnfortunately, the problem is not with the stack:\n\nBefore any patch:\n\n```\nsage.all: 0.987 (None)\n```\nAfter the rc1 patch\n\n```\nsage.all: 1.805 (None)\n```\nAfter the rc2 patch\n\n```\nsage.all: 1.692 (None)\n```\nIt's better but still too much.\n\nFlorent",
    "created_at": "2012-03-15T13:39:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-160918",
    "user": "https://github.com/hivert"
}
```

<a id='comment:16'></a>
Unfortunately, the problem is not with the stack:

Before any patch:

```
sage.all: 0.987 (None)
```
After the rc1 patch

```
sage.all: 1.805 (None)
```
After the rc2 patch

```
sage.all: 1.692 (None)
```
It's better but still too much.

Florent



---

archive/issue_comments_160919.json:
```json
{
    "body": "<a id='comment:17'></a>\nGot it !!! We don't need the module but only its name. One can get it using the filename of the code which is currently executed. Here is the diff\n\n```diff\ndiff --git a/sage/misc/misc.py b/sage/misc/misc.py\n--- a/sage/misc/misc.py\n+++ b/sage/misc/misc.py\n@@ -2387,11 +2387,10 @@ def deprecated_function_alias(func, vers\n      - Florent Hivert (2009-11-23), with the help of Mike Hansen.\n      - Luca De Feo (2011-07-11), printing the full module path when different from old path\n     \"\"\"\n-    module = inspect.getmodule(inspect.currentframe(1))\n-    if module is None:\n+    module_name = inspect.getmodulename(\n+        inspect.currentframe(1).f_code.co_filename)\n+    if module_name is None:\n         module_name = '__main__'\n-    else:\n-        module_name = module.__name__\n     return DeprecatedFunctionAlias(func, version, module_name)\n```\n\nThe new startup time is ok !\n\n```\nsage.all: 0.962 (None)\n```\n\nPlease review.\n\nFlorent",
    "created_at": "2012-03-15T14:00:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-160919",
    "user": "https://github.com/hivert"
}
```

<a id='comment:17'></a>
Got it !!! We don't need the module but only its name. One can get it using the filename of the code which is currently executed. Here is the diff

```diff
diff --git a/sage/misc/misc.py b/sage/misc/misc.py
--- a/sage/misc/misc.py
+++ b/sage/misc/misc.py
@@ -2387,11 +2387,10 @@ def deprecated_function_alias(func, vers
      - Florent Hivert (2009-11-23), with the help of Mike Hansen.
      - Luca De Feo (2011-07-11), printing the full module path when different from old path
     """
-    module = inspect.getmodule(inspect.currentframe(1))
-    if module is None:
+    module_name = inspect.getmodulename(
+        inspect.currentframe(1).f_code.co_filename)
+    if module_name is None:
         module_name = '__main__'
-    else:
-        module_name = module.__name__
     return DeprecatedFunctionAlias(func, version, module_name)
```

The new startup time is ok !

```
sage.all: 0.962 (None)
```

Please review.

Florent



---

archive/issue_comments_160920.json:
```json
{
    "body": "**Changing reviewer** from \"Rob Beezer, Florent Hivert\" to \"Rob Beezer\".",
    "created_at": "2012-03-15T14:00:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-160920",
    "user": "https://github.com/hivert"
}
```

**Changing reviewer** from "Rob Beezer, Florent Hivert" to "Rob Beezer".



---

archive/issue_comments_160921.json:
```json
{
    "body": "**Changing author** from \"Luca De Feo\" to \"Luca De Feo, Florent Hivert\".",
    "created_at": "2012-03-15T14:00:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-160921",
    "user": "https://github.com/hivert"
}
```

**Changing author** from "Luca De Feo" to "Luca De Feo, Florent Hivert".



---

archive/issue_comments_160922.json:
```json
{
    "body": "<a id='comment:18'></a>\nAttachment [trac_11585_deprecated_function_alias-rc2.patch](tarball://root/attachments/some-uuid/ticket11585/trac_11585_deprecated_function_alias-rc2.patch) by @hivert created at 2012-03-15 14:03:39",
    "created_at": "2012-03-15T14:03:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-160922",
    "user": "https://github.com/hivert"
}
```

<a id='comment:18'></a>
Attachment [trac_11585_deprecated_function_alias-rc2.patch](tarball://root/attachments/some-uuid/ticket11585/trac_11585_deprecated_function_alias-rc2.patch) by @hivert created at 2012-03-15 14:03:39



---

archive/issue_comments_160923.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2012-03-15T14:03:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-160923",
    "user": "https://github.com/hivert"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_160924.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -26,5 +26,5 @@\n \n \n **Apply:**\n-1.  [attachment:trac_11585_deprecated_function_alias+rc1.patch]\n+1.  [attachment:trac_11585_deprecated_function_alias-rc2.patch]\n \n``````\n",
    "created_at": "2012-03-15T14:03:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-160924",
    "user": "https://github.com/hivert"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -26,5 +26,5 @@
 
 
 **Apply:**
-1.  [attachment:trac_11585_deprecated_function_alias+rc1.patch]
+1.  [attachment:trac_11585_deprecated_function_alias-rc2.patch]
 
``````




---

archive/issue_comments_160925.json:
```json
{
    "body": "**Set assignee** to @hivert.",
    "created_at": "2012-03-15T14:03:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-160925",
    "user": "https://github.com/hivert"
}
```

**Set assignee** to @hivert.



---

archive/issue_comments_160926.json:
```json
{
    "body": "<a id='comment:20'></a>\nThanks for sorting this out, Florent.\n\nI tried it: it solves the startup issue and all tests pass. Can I give positive review, or shall we ask someone else to review it?\n\nLuca",
    "created_at": "2012-03-16T00:17:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-160926",
    "user": "https://github.com/defeo"
}
```

<a id='comment:20'></a>
Thanks for sorting this out, Florent.

I tried it: it solves the startup issue and all tests pass. Can I give positive review, or shall we ask someone else to review it?

Luca



---

archive/issue_comments_160927.json:
```json
{
    "body": "<a id='comment:21'></a>\n> I tried it: it solves the startup issue and all tests pass. Can I give positive review, or shall we ask someone else to review it?\n\n\nSure you can. Your code has already been reviewed twice so it is Ok to go. Given that, only my change has to be reviewed, it could be done by person which is not me. I think you are the perfect person to do that. So please set the positive review if you think my change is Ok.",
    "created_at": "2012-03-16T07:53:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-160927",
    "user": "https://github.com/hivert"
}
```

<a id='comment:21'></a>
> I tried it: it solves the startup issue and all tests pass. Can I give positive review, or shall we ask someone else to review it?


Sure you can. Your code has already been reviewed twice so it is Ok to go. Given that, only my change has to be reviewed, it could be done by person which is not me. I think you are the perfect person to do that. So please set the positive review if you think my change is Ok.



---

archive/issue_comments_160928.json:
```json
{
    "body": "**Changing work_issues** from \"startuptime\" to \"\".",
    "created_at": "2012-03-16T07:53:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-160928",
    "user": "https://github.com/hivert"
}
```

**Changing work_issues** from "startuptime" to "".



---

archive/issue_comments_160929.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2012-03-16T09:27:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-160929",
    "user": "https://github.com/defeo"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_events_035983.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-23T15:19:12Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11585#event-35983"
}
```



---

archive/issue_comments_160930.json:
```json
{
    "body": "**Merged:** sage-5.0.beta10",
    "created_at": "2012-03-23T15:19:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-160930",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.0.beta10



---

archive/issue_comments_160931.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2012-03-23T15:19:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11585",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11585#issuecomment-160931",
    "user": "https://github.com/jdemeyer"
}
```

**Resolution:** fixed
