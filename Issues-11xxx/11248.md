# Issue 11248: SVD matrix decomposition may return a non-invertible "unitary" matrix

archive/issues_011076.json:
```json
{
    "assignees": [
        "https://github.com/jasongrout",
        "https://github.com/williamstein"
    ],
    "body": "On one particular configuration (Mac, gcc 4.2.1) it appears the `NumPy` SVD matrix decomposition is returning a matrix that is not unitary, contrary to what the documentation says (and the properties the decomposition should have).  Note Sage does a conjugate-transpose on the `NumPy` version of V, but since this is the inverse of a unitary matrix, it has no bearing on the check below.  The fault with V below is a column of zeros.  Rephrasing the previous comment, a row of zeros would be equally bad (not invertible, for starters).\n\nConfiguration info and example below from Samuel Lelievre, and a repeat of the matrix from the failing doctest introduced at #10863.  Note V has a final column of all zeros.\n\nOriginating failure - discussion begins at:\nhttp://groups.google.com/group/sage-release/msg/d29ce3e4f9da5cda\n\nDocumentation of wrapped SVD:\nhttp://docs.scipy.org/doc/scipy/reference/generated/scipy.linalg.svd.html#scipy.linalg.svd\n\nSemi-related, semi-confusing documentation discussion:  #9011\n\n```\n$ date -u \"+Date: %F %T Z\"\nDate: 2011-04-24 11:04:00 Z\n$ uname -a\nDarwin U 9.8.0 Darwin Kernel Version 9.8.0: Wed Jul 15 16:55:01 PDT 2009; root:xnu-1228.15.4~1/RELEASE_I386 i386\n$ gcc -v\nUsing built-in specs.\nTarget: i686-apple-darwin9\nConfigured with: /var/tmp/gcc_42/gcc_42-5577~1/src/configure --disable-checking --enable-werror --prefix=/usr --mandir=/usr/share/man --enable-languages=c,objc,c++,obj-c++ --program-transform-name=/^[cg][^.-]*$/s/$/-4.2/ --with-slibdir=/usr/lib --build=i686-apple-darwin9 --with-gxx-include-dir=/usr/include/c++/4.0.0 --host=i686-apple-darwin9 --target=i686-apple-darwin9\nThread model: posix\ngcc version 4.2.1 (Apple Inc. build 5577)\n$ cd /Applications/sage-4.7.alpha5\n$ ./sage\n----------------------------------------------------------------------\n| Sage Version 4.7.alpha5, Release Date: 2011-04-19                  |\n| Type notebook() for the GUI, and license() for information.        |\n----------------------------------------------------------------------\n**********************************************************************\n*                                                                    *\n* Warning: this is a prerelease version, and it may be unstable.     *\n*                                                                    *\n**********************************************************************\nsage: sage: A = matrix(CDF, [[   1 - I,   -3*I,  -2 + I,        1, -2 + 3*I],\n....: ...                    [   1 - I, -2 + I, 1 + 4*I,        0,    2 + I],\n....: ...                    [      -1, -5 + I,  -2 + I,    1 + I, -5 - 4*I],\n....: ...                    [-2 + 4*I,  2 - I, 8 - 4*I,  1 - 8*I,  3 - 2*I]])\nsage: sage: U, S, V = A.SVD()\nsage: sage: U\n[                       -0.19814141337                       -0.308971396837                       -0.660350071544                        -0.65514459416]\n[   -0.101309655406 + 0.221246759763*I    0.0281679782559 + 0.228038474533*I      0.21409853948 + 0.537850297688*I     -0.198443898186 - 0.71658226052*I]\n[   -0.269917087381 - 0.133290918508*I     0.854014906857 - 0.285615383107*I    -0.257796142317 + 0.167969516429*I -0.0612822342421 + 0.00570675954826*I]\n[     0.891629724122 + 0.12609891898*I      0.117076865049 - 0.16467268911*I     -0.330988290968 + 0.15681453211*I   0.00874000243566 - 0.118536816828*I]\nsage: sage: S\n[14.7392195065             0             0             0             0]\n[            0 8.03673751296             0             0             0]\n[            0             0 5.55372875787             0             0]\n[            0             0             0 2.07902750599             0]\nsage: sage: V\n[ -0.103780564012 - 0.255347993379*I -0.280673753855 + 0.0116823968595*I    0.10136055387 + 0.168166900035*I  -0.272892623178 - 0.660772348871*I                                   0]\n[ 0.223710700338 + 0.0776561565738*I  -0.495868002873 - 0.130571095626*I   0.134650496144 - 0.696875952139*I     0.0617790230965 - 0.254643364*I                                   0]\n[  0.557366391081 + 0.402764608049*I  0.144327862917 - 0.0880357525471*I  0.197092307875 + 0.0349722541821*I  -0.520505493072 - 0.063071740502*I                                   0]\n[-0.0487482425143 + 0.501774390263*I  0.210767926924 - 0.0457509105016*I  -0.420560914497 - 0.371880987879*I 0.118475810204 + 0.00883691841234*I                                   0]\n[  0.320257848046 + 0.195842789503*I   -0.192207323094 + 0.73899332378*I   0.287600691016 + 0.140461871207*I  0.357713836525 + 0.0571998104689*I                                   0]\nsage: sage: U.conjugate().transpose()*U\n[               1.0 - 1.38777878078e-17*I  1.38777878078e-17 + 2.94902990916e-17*I                     -1.11022302463e-16*I                      1.32055824609e-16*I]\n[ 1.38777878078e-17 - 2.77555756156e-17*I                1.0 - 1.04083408559e-17*I  4.85722573274e-17 + 3.46944695195e-17*I  2.32236105346e-16 + 4.92227786308e-17*I]\n[                     1.11022302463e-16*I  4.85722573274e-17 - 1.38777878078e-17*I                1.0 - 6.93889390391e-18*I -4.38017677684e-17 + 6.17995238317e-17*I]\n[                     -1.2490009027e-16*I  2.32236105346e-16 - 4.85722573274e-17*I -4.38017677684e-17 - 5.55111512313e-17*I                1.0 - 1.17093834628e-17*I]\nsage: sage: V.conjugate().transpose()*V\n[               1.0 + 1.38777878078e-17*I  -8.32667268469e-17 + 2.8449465006e-16*I  1.38777878078e-16 - 1.45716771982e-16*I -1.94289029309e-16 + 1.38777878078e-17*I                                        0]\n[-8.32667268469e-17 - 2.77555756156e-16*I                                      1.0 -7.56339435526e-16 + 1.38777878078e-16*I  5.55111512313e-17 - 1.66533453694e-16*I                                        0]\n[ 1.38777878078e-16 + 1.17961196366e-16*I -7.56339435526e-16 - 1.28369537222e-16*I                1.0 + 6.93889390391e-18*I -3.88578058619e-16 + 4.16333634234e-17*I                                        0]\n[-1.94289029309e-16 - 1.04083408559e-17*I  5.55111512313e-17 + 1.99493199737e-16*I -3.88578058619e-16 - 2.08166817117e-17*I                1.0 - 6.93889390391e-18*I                                        0]\n[                                       0                                        0                                        0                                        0                                        0]\n```\n\n\nCC:  @slel\n\nComponent: **linear algebra**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/11248_\n\n",
    "created_at": "2011-04-24T21:36:26Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20linear%20algebra",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "SVD matrix decomposition may return a non-invertible \"unitary\" matrix",
    "type": "issue",
    "updated_at": "2022-12-29T01:28:25Z",
    "url": "https://github.com/sagemath/sage/issues/11248",
    "user": "https://github.com/rbeezer"
}
```
On one particular configuration (Mac, gcc 4.2.1) it appears the `NumPy` SVD matrix decomposition is returning a matrix that is not unitary, contrary to what the documentation says (and the properties the decomposition should have).  Note Sage does a conjugate-transpose on the `NumPy` version of V, but since this is the inverse of a unitary matrix, it has no bearing on the check below.  The fault with V below is a column of zeros.  Rephrasing the previous comment, a row of zeros would be equally bad (not invertible, for starters).

Configuration info and example below from Samuel Lelievre, and a repeat of the matrix from the failing doctest introduced at #10863.  Note V has a final column of all zeros.

Originating failure - discussion begins at:
http://groups.google.com/group/sage-release/msg/d29ce3e4f9da5cda

Documentation of wrapped SVD:
http://docs.scipy.org/doc/scipy/reference/generated/scipy.linalg.svd.html#scipy.linalg.svd

Semi-related, semi-confusing documentation discussion:  #9011

```
$ date -u "+Date: %F %T Z"
Date: 2011-04-24 11:04:00 Z
$ uname -a
Darwin U 9.8.0 Darwin Kernel Version 9.8.0: Wed Jul 15 16:55:01 PDT 2009; root:xnu-1228.15.4~1/RELEASE_I386 i386
$ gcc -v
Using built-in specs.
Target: i686-apple-darwin9
Configured with: /var/tmp/gcc_42/gcc_42-5577~1/src/configure --disable-checking --enable-werror --prefix=/usr --mandir=/usr/share/man --enable-languages=c,objc,c++,obj-c++ --program-transform-name=/^[cg][^.-]*$/s/$/-4.2/ --with-slibdir=/usr/lib --build=i686-apple-darwin9 --with-gxx-include-dir=/usr/include/c++/4.0.0 --host=i686-apple-darwin9 --target=i686-apple-darwin9
Thread model: posix
gcc version 4.2.1 (Apple Inc. build 5577)
$ cd /Applications/sage-4.7.alpha5
$ ./sage
----------------------------------------------------------------------
| Sage Version 4.7.alpha5, Release Date: 2011-04-19                  |
| Type notebook() for the GUI, and license() for information.        |
----------------------------------------------------------------------
**********************************************************************
*                                                                    *
* Warning: this is a prerelease version, and it may be unstable.     *
*                                                                    *
**********************************************************************
sage: sage: A = matrix(CDF, [[   1 - I,   -3*I,  -2 + I,        1, -2 + 3*I],
....: ...                    [   1 - I, -2 + I, 1 + 4*I,        0,    2 + I],
....: ...                    [      -1, -5 + I,  -2 + I,    1 + I, -5 - 4*I],
....: ...                    [-2 + 4*I,  2 - I, 8 - 4*I,  1 - 8*I,  3 - 2*I]])
sage: sage: U, S, V = A.SVD()
sage: sage: U
[                       -0.19814141337                       -0.308971396837                       -0.660350071544                        -0.65514459416]
[   -0.101309655406 + 0.221246759763*I    0.0281679782559 + 0.228038474533*I      0.21409853948 + 0.537850297688*I     -0.198443898186 - 0.71658226052*I]
[   -0.269917087381 - 0.133290918508*I     0.854014906857 - 0.285615383107*I    -0.257796142317 + 0.167969516429*I -0.0612822342421 + 0.00570675954826*I]
[     0.891629724122 + 0.12609891898*I      0.117076865049 - 0.16467268911*I     -0.330988290968 + 0.15681453211*I   0.00874000243566 - 0.118536816828*I]
sage: sage: S
[14.7392195065             0             0             0             0]
[            0 8.03673751296             0             0             0]
[            0             0 5.55372875787             0             0]
[            0             0             0 2.07902750599             0]
sage: sage: V
[ -0.103780564012 - 0.255347993379*I -0.280673753855 + 0.0116823968595*I    0.10136055387 + 0.168166900035*I  -0.272892623178 - 0.660772348871*I                                   0]
[ 0.223710700338 + 0.0776561565738*I  -0.495868002873 - 0.130571095626*I   0.134650496144 - 0.696875952139*I     0.0617790230965 - 0.254643364*I                                   0]
[  0.557366391081 + 0.402764608049*I  0.144327862917 - 0.0880357525471*I  0.197092307875 + 0.0349722541821*I  -0.520505493072 - 0.063071740502*I                                   0]
[-0.0487482425143 + 0.501774390263*I  0.210767926924 - 0.0457509105016*I  -0.420560914497 - 0.371880987879*I 0.118475810204 + 0.00883691841234*I                                   0]
[  0.320257848046 + 0.195842789503*I   -0.192207323094 + 0.73899332378*I   0.287600691016 + 0.140461871207*I  0.357713836525 + 0.0571998104689*I                                   0]
sage: sage: U.conjugate().transpose()*U
[               1.0 - 1.38777878078e-17*I  1.38777878078e-17 + 2.94902990916e-17*I                     -1.11022302463e-16*I                      1.32055824609e-16*I]
[ 1.38777878078e-17 - 2.77555756156e-17*I                1.0 - 1.04083408559e-17*I  4.85722573274e-17 + 3.46944695195e-17*I  2.32236105346e-16 + 4.92227786308e-17*I]
[                     1.11022302463e-16*I  4.85722573274e-17 - 1.38777878078e-17*I                1.0 - 6.93889390391e-18*I -4.38017677684e-17 + 6.17995238317e-17*I]
[                     -1.2490009027e-16*I  2.32236105346e-16 - 4.85722573274e-17*I -4.38017677684e-17 - 5.55111512313e-17*I                1.0 - 1.17093834628e-17*I]
sage: sage: V.conjugate().transpose()*V
[               1.0 + 1.38777878078e-17*I  -8.32667268469e-17 + 2.8449465006e-16*I  1.38777878078e-16 - 1.45716771982e-16*I -1.94289029309e-16 + 1.38777878078e-17*I                                        0]
[-8.32667268469e-17 - 2.77555756156e-16*I                                      1.0 -7.56339435526e-16 + 1.38777878078e-16*I  5.55111512313e-17 - 1.66533453694e-16*I                                        0]
[ 1.38777878078e-16 + 1.17961196366e-16*I -7.56339435526e-16 - 1.28369537222e-16*I                1.0 + 6.93889390391e-18*I -3.88578058619e-16 + 4.16333634234e-17*I                                        0]
[-1.94289029309e-16 - 1.04083408559e-17*I  5.55111512313e-17 + 1.99493199737e-16*I -3.88578058619e-16 - 2.08166817117e-17*I                1.0 - 6.93889390391e-18*I                                        0]
[                                       0                                        0                                        0                                        0                                        0]
```


CC:  @slel

Component: **linear algebra**

_Issue created by migration from https://trac.sagemath.org/ticket/11248_





---

archive/issue_events_147582.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2011-04-24T21:36:26Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11248#event-147582"
}
```



---

archive/issue_events_147583.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2011-04-24T21:36:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20linear%20algebra",
    "label_color": "0000ff",
    "label_name": "c: linear algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11248#event-147583"
}
```



---

archive/issue_events_147584.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2011-04-24T21:36:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11248#event-147584"
}
```



---

archive/issue_events_147585.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2011-04-24T21:36:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11248#event-147585"
}
```



---

archive/issue_events_147586.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2011-04-24T21:36:26Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "subject": "https://github.com/rbeezer",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11248#event-147586"
}
```



---

archive/issue_events_147587.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2011-04-24T21:36:26Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "subject": "https://github.com/rbeezer",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11248#event-147587"
}
```



---

archive/issue_comments_112580.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,9 @@\n On one particular configuration (Mac, gcc 4.2.1) it appears the `NumPy` SVD matrix decomposition is returning a matrix that is not unitary, contrary to what the documentation says (and the properties the decomposition should have).  Note Sage does a conjugate-transpose on the `NumPy` version of V, but since this is the inverse of a unitary matrix, it has no bearing on the check below.  The fault with V below is a column of zeros.  Rephrasing the previous comment, a row of zeros would be equally bad (not invertible, for starters).\n \n Configuration info and example below from Samuel Lelievre, and a repeat of the matrix from the failing doctest introduced at #10863.  Note V has a final column of all zeros.\n+\n+Originating failure - discussion begins at:\n+http://groups.google.com/group/sage-release/msg/d29ce3e4f9da5cda\n \n Documentation of wrapped SVD:\n http://docs.scipy.org/doc/scipy/reference/generated/scipy.linalg.svd.html#scipy.linalg.svd\n``````\n",
    "created_at": "2011-04-24T21:42:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11248#issuecomment-112580",
    "user": "https://github.com/rbeezer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,9 @@
 On one particular configuration (Mac, gcc 4.2.1) it appears the `NumPy` SVD matrix decomposition is returning a matrix that is not unitary, contrary to what the documentation says (and the properties the decomposition should have).  Note Sage does a conjugate-transpose on the `NumPy` version of V, but since this is the inverse of a unitary matrix, it has no bearing on the check below.  The fault with V below is a column of zeros.  Rephrasing the previous comment, a row of zeros would be equally bad (not invertible, for starters).
 
 Configuration info and example below from Samuel Lelievre, and a repeat of the matrix from the failing doctest introduced at #10863.  Note V has a final column of all zeros.
+
+Originating failure - discussion begins at:
+http://groups.google.com/group/sage-release/msg/d29ce3e4f9da5cda
 
 Documentation of wrapped SVD:
 http://docs.scipy.org/doc/scipy/reference/generated/scipy.linalg.svd.html#scipy.linalg.svd
``````




---

archive/issue_comments_112581.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nSamuel,\n\nHere's something you could try to see how prevalent this problem is.  Copy this command and just run it repeatedly in Sage, with an up-arrow to get it back from the history.  If it prints `False`, then the matrix it prints is a failure for the SVD.\n\nIf failures are rare, you can capture the matrix causing it.\n\nIf you get lots of failures then maybe reduce the dimensions (4 and 8) down to something even smaller to find a minimal example.\n\n```\nA = (random_matrix(ZZ, 4, 8) + I*random_matrix(ZZ, 4, 8)); B = A.change_ring(CDF); U,S,V = B.SVD(); A; print; (U.is_unitary() and V.is_unitary())\n```\n\nI'm going to try to write a pure numpy version of this.  But Easter Dinner first, I think.\n\nRob",
    "created_at": "2011-04-24T22:03:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11248#issuecomment-112581",
    "user": "https://github.com/rbeezer"
}
```

<div id="comment:2" align="right">comment:2</div>

Samuel,

Here's something you could try to see how prevalent this problem is.  Copy this command and just run it repeatedly in Sage, with an up-arrow to get it back from the history.  If it prints `False`, then the matrix it prints is a failure for the SVD.

If failures are rare, you can capture the matrix causing it.

If you get lots of failures then maybe reduce the dimensions (4 and 8) down to something even smaller to find a minimal example.

```
A = (random_matrix(ZZ, 4, 8) + I*random_matrix(ZZ, 4, 8)); B = A.change_ring(CDF); U,S,V = B.SVD(); A; print; (U.is_unitary() and V.is_unitary())
```

I'm going to try to write a pure numpy version of this.  But Easter Dinner first, I think.

Rob



---

archive/issue_comments_112582.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nHi Samuel,\n\nPure numpy/scipy with the same matrix causing the doctest failure.  Start Sage with\n\n```\nsage -python\n```\n\nwhich should give you a `>>>` prompt.  Paste in the code block below.  If it goes as expected, I'd expect now a final row of zeros in the `VH` matrix.  If so, I'll report it to the numpy discussion list, I guess.  If not, then Sage's manipulations of the results may be at fault.\n\nThanks,\nRob\n\n```\nimport numpy\nimport scipy.linalg\nA = numpy.array( [[1 - 1j,     -3j, -2 + 1j,      1, -2 + 3j],\n                 [ 1 - 1j, -2 + 1j,  1 + 4j,      0,  2 + 1j],\n                 [     -1, -5 + 1j, -2 + 1j, 1 + 1j, -5 - 4j],\n                 [-2 + 4j,  2 - 1j,  8 - 4j, 1 - 8j,  3 - 2j]])\nU, S, VH = scipy.linalg.svd(A)\nVH\nnumpy.dot(VH, VH.conj().T)\n```",
    "created_at": "2011-04-25T00:58:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11248#issuecomment-112582",
    "user": "https://github.com/rbeezer"
}
```

<div id="comment:3" align="right">comment:3</div>

Hi Samuel,

Pure numpy/scipy with the same matrix causing the doctest failure.  Start Sage with

```
sage -python
```

which should give you a `>>>` prompt.  Paste in the code block below.  If it goes as expected, I'd expect now a final row of zeros in the `VH` matrix.  If so, I'll report it to the numpy discussion list, I guess.  If not, then Sage's manipulations of the results may be at fault.

Thanks,
Rob

```
import numpy
import scipy.linalg
A = numpy.array( [[1 - 1j,     -3j, -2 + 1j,      1, -2 + 3j],
                 [ 1 - 1j, -2 + 1j,  1 + 4j,      0,  2 + 1j],
                 [     -1, -5 + 1j, -2 + 1j, 1 + 1j, -5 - 4j],
                 [-2 + 4j,  2 - 1j,  8 - 4j, 1 - 8j,  3 - 2j]])
U, S, VH = scipy.linalg.svd(A)
VH
numpy.dot(VH, VH.conj().T)
```



---

archive/issue_comments_112583.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nHi Rob,\nHi Samuel,\n\nI just tested the lines Rob gave and I also get the final column of zeros.\n\nS\u00e9bastien\n\n```\nslabbe@pol ~ $ uname -a\nDarwin pol 9.8.0 Darwin Kernel Version 9.8.0: Wed Jul 15 16:55:01 PDT 2009; root:xnu-1228.15.4~1/RELEASE_I386 i386 i386 MacBook5,1 Darwin\n\nslabbe@pol ~ $ gcc -v\nUsing built-in specs.\nTarget: i686-apple-darwin9\nConfigured with: /var/tmp/gcc/gcc-5493~1/src/configure --disable-checking -enable-werror --prefix=/usr --mandir=/share/man --enable-languages=c,objc,c++,obj-c++ --program-transform-name=/^[cg][^.-]*$/s/$/-4.0/ --with-gxx-include-dir=/include/c++/4.0.0 --with-slibdir=/usr/lib --build=i686-apple-darwin9 --with-arch=apple --with-tune=generic --host=i686-apple-darwin9 --target=i686-apple-darwin9\nThread model: posix\ngcc version 4.0.1 (Apple Inc. build 5493)\n\nslabbe@pol ~ $ sage --version\nSage Version 4.6.2, Release Date: 2011-02-25\n\nslabbe@pol ~ $ sage -python\nPython 2.6.4 (r264:75706, Mar  7 2011, 10:43:40) \n[GCC 4.0.1 (Apple Inc. build 5493)] on darwin\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n>>> \n>>> \n>>> import numpy\n>>> import scipy.linalg\n>>> A = numpy.array( [[1 - 1j,     -3j, -2 + 1j,      1, -2 + 3j],\n...                  [ 1 - 1j, -2 + 1j,  1 + 4j,      0,  2 + 1j],\n...                  [     -1, -5 + 1j, -2 + 1j, 1 + 1j, -5 - 4j],\n...                  [-2 + 4j,  2 - 1j,  8 - 4j, 1 - 8j,  3 - 2j]])\n>>> U, S, VH = scipy.linalg.svd(A)\n>>> VH\narray([[-0.10378056+0.25534799j,  0.22371070-0.07765616j,\n         0.55736639-0.40276461j, -0.04874824-0.50177439j,\n         0.32025785-0.19584279j],\n       [-0.28067375-0.0116824j , -0.49586800+0.1305711j ,\n         0.14432786+0.08803575j,  0.21076793+0.04575091j,\n        -0.19220732-0.73899332j],\n       [ 0.10136055-0.1681669j ,  0.13465050+0.69687595j,\n         0.19709231-0.03497225j, -0.42056091+0.37188099j,\n         0.28760069-0.14046187j],\n       [-0.27289262+0.66077235j,  0.06177902+0.25464336j,\n        -0.52050549+0.06307174j,  0.11847581-0.00883692j,\n         0.35771384-0.05719981j],\n       [ 0.00000000+0.j        ,  0.00000000+0.j        ,\n         0.00000000+0.j        ,  0.00000000+0.j        ,  0.00000000+0.j        ]])\n>>> numpy.dot(VH, VH.conj().T)\narray([[  1.00000000e+00 +1.38777878e-17j,\n         -8.32667268e-17 +2.84494650e-16j,\n          1.38777878e-16 -1.45716772e-16j,\n         -1.94289029e-16 +1.38777878e-17j,\n          0.00000000e+00 +0.00000000e+00j],\n       [ -8.32667268e-17 -2.77555756e-16j,\n          1.00000000e+00 +0.00000000e+00j,\n         -7.56339436e-16 +1.38777878e-16j,\n          5.55111512e-17 -1.66533454e-16j,\n          0.00000000e+00 +0.00000000e+00j],\n       [  1.38777878e-16 +1.17961196e-16j,\n         -7.56339436e-16 -1.28369537e-16j,\n          1.00000000e+00 +6.93889390e-18j,\n         -3.88578059e-16 +4.16333634e-17j,\n          0.00000000e+00 +0.00000000e+00j],\n       [ -1.94289029e-16 -1.04083409e-17j,\n          5.55111512e-17 +1.99493200e-16j,\n         -3.88578059e-16 -2.08166817e-17j,\n          1.00000000e+00 -6.93889390e-18j,\n          0.00000000e+00 +0.00000000e+00j],\n       [  0.00000000e+00 +0.00000000e+00j,\n          0.00000000e+00 +0.00000000e+00j,\n          0.00000000e+00 +0.00000000e+00j,\n          0.00000000e+00 +0.00000000e+00j,\n          0.00000000e+00 +0.00000000e+00j]])\n>>>  \n```",
    "created_at": "2011-04-25T01:39:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11248#issuecomment-112583",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:4" align="right">comment:4</div>

Hi Rob,
Hi Samuel,

I just tested the lines Rob gave and I also get the final column of zeros.

Sébastien

```
slabbe@pol ~ $ uname -a
Darwin pol 9.8.0 Darwin Kernel Version 9.8.0: Wed Jul 15 16:55:01 PDT 2009; root:xnu-1228.15.4~1/RELEASE_I386 i386 i386 MacBook5,1 Darwin

slabbe@pol ~ $ gcc -v
Using built-in specs.
Target: i686-apple-darwin9
Configured with: /var/tmp/gcc/gcc-5493~1/src/configure --disable-checking -enable-werror --prefix=/usr --mandir=/share/man --enable-languages=c,objc,c++,obj-c++ --program-transform-name=/^[cg][^.-]*$/s/$/-4.0/ --with-gxx-include-dir=/include/c++/4.0.0 --with-slibdir=/usr/lib --build=i686-apple-darwin9 --with-arch=apple --with-tune=generic --host=i686-apple-darwin9 --target=i686-apple-darwin9
Thread model: posix
gcc version 4.0.1 (Apple Inc. build 5493)

slabbe@pol ~ $ sage --version
Sage Version 4.6.2, Release Date: 2011-02-25

slabbe@pol ~ $ sage -python
Python 2.6.4 (r264:75706, Mar  7 2011, 10:43:40) 
[GCC 4.0.1 (Apple Inc. build 5493)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>> 
>>> 
>>> import numpy
>>> import scipy.linalg
>>> A = numpy.array( [[1 - 1j,     -3j, -2 + 1j,      1, -2 + 3j],
...                  [ 1 - 1j, -2 + 1j,  1 + 4j,      0,  2 + 1j],
...                  [     -1, -5 + 1j, -2 + 1j, 1 + 1j, -5 - 4j],
...                  [-2 + 4j,  2 - 1j,  8 - 4j, 1 - 8j,  3 - 2j]])
>>> U, S, VH = scipy.linalg.svd(A)
>>> VH
array([[-0.10378056+0.25534799j,  0.22371070-0.07765616j,
         0.55736639-0.40276461j, -0.04874824-0.50177439j,
         0.32025785-0.19584279j],
       [-0.28067375-0.0116824j , -0.49586800+0.1305711j ,
         0.14432786+0.08803575j,  0.21076793+0.04575091j,
        -0.19220732-0.73899332j],
       [ 0.10136055-0.1681669j ,  0.13465050+0.69687595j,
         0.19709231-0.03497225j, -0.42056091+0.37188099j,
         0.28760069-0.14046187j],
       [-0.27289262+0.66077235j,  0.06177902+0.25464336j,
        -0.52050549+0.06307174j,  0.11847581-0.00883692j,
         0.35771384-0.05719981j],
       [ 0.00000000+0.j        ,  0.00000000+0.j        ,
         0.00000000+0.j        ,  0.00000000+0.j        ,  0.00000000+0.j        ]])
>>> numpy.dot(VH, VH.conj().T)
array([[  1.00000000e+00 +1.38777878e-17j,
         -8.32667268e-17 +2.84494650e-16j,
          1.38777878e-16 -1.45716772e-16j,
         -1.94289029e-16 +1.38777878e-17j,
          0.00000000e+00 +0.00000000e+00j],
       [ -8.32667268e-17 -2.77555756e-16j,
          1.00000000e+00 +0.00000000e+00j,
         -7.56339436e-16 +1.38777878e-16j,
          5.55111512e-17 -1.66533454e-16j,
          0.00000000e+00 +0.00000000e+00j],
       [  1.38777878e-16 +1.17961196e-16j,
         -7.56339436e-16 -1.28369537e-16j,
          1.00000000e+00 +6.93889390e-18j,
         -3.88578059e-16 +4.16333634e-17j,
          0.00000000e+00 +0.00000000e+00j],
       [ -1.94289029e-16 -1.04083409e-17j,
          5.55111512e-17 +1.99493200e-16j,
         -3.88578059e-16 -2.08166817e-17j,
          1.00000000e+00 -6.93889390e-18j,
          0.00000000e+00 +0.00000000e+00j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j]])
>>>  
```



---

archive/issue_comments_112584.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nThanks, S\u00e9bastien!  Very interesting and useful.  If I get a similar result from Samuel, I'll know which way to go with this.\n\nIf you want to try the Sage (long) one-line command above and see how prevalent this is, that would also be very helpful.\n\nI can't get any failures on my Linux install.\n\nRob",
    "created_at": "2011-04-25T02:06:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11248#issuecomment-112584",
    "user": "https://github.com/rbeezer"
}
```

<div id="comment:5" align="right">comment:5</div>

Thanks, Sébastien!  Very interesting and useful.  If I get a similar result from Samuel, I'll know which way to go with this.

If you want to try the Sage (long) one-line command above and see how prevalent this is, that would also be very helpful.

I can't get any failures on my Linux install.

Rob



---

archive/issue_comments_112585.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\n> If you want to try the Sage (long) one-line command above and see how prevalent this is, that would also be very helpful.\n\nI just ran the one-liner thousands of time and always get True:\n\n```\nsage: for _ in range(1000):\n    A = (random_matrix(ZZ, 4, 8) + I*random_matrix(ZZ, 4, 8)); B = A.change_ring(CDF); U,S,V = B.SVD();\n    if not (U.is_unitary() and V.is_unitary()):\n        print A\n....:         \nsage:\n```\n\nI also tried dimensions 8 by 16. Do you want me to test something else?\n\nS\u00e9bastien",
    "created_at": "2011-04-25T02:45:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11248#issuecomment-112585",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:6" align="right">comment:6</div>

> If you want to try the Sage (long) one-line command above and see how prevalent this is, that would also be very helpful.

I just ran the one-liner thousands of time and always get True:

```
sage: for _ in range(1000):
    A = (random_matrix(ZZ, 4, 8) + I*random_matrix(ZZ, 4, 8)); B = A.change_ring(CDF); U,S,V = B.SVD();
    if not (U.is_unitary() and V.is_unitary()):
        print A
....:         
sage:
```

I also tried dimensions 8 by 16. Do you want me to test something else?

Sébastien



---

archive/issue_comments_112586.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@seblabbe](#comment:6):\n> I just ran the one-liner thousands of time and always get True:\n\nVery curious!  I do not recall there being anything special about the example I built for the doctest, so I would think maybe there would be some failures on machines with \"problems.\"\n\n> I also tried dimensions 8 by 16. Do you want me to test something else?\n\nThere was not really anything special about 4 x 8, just wanted the dimensions to be different from each other.  One failing example is 4 by 5.  Could you try 1000 random 4 x 5's?\n\nIf you do get failures, than maybe try 3 x 4, or 5 x 6, or 5 x 4, or ....\n\nAt this point, I really do not have any idea where the problem may be and it would be good to send a real precise report to the numpy/scipy group.\n\nRob",
    "created_at": "2011-04-25T03:17:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11248#issuecomment-112586",
    "user": "https://github.com/rbeezer"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@seblabbe](#comment:6):
> I just ran the one-liner thousands of time and always get True:

Very curious!  I do not recall there being anything special about the example I built for the doctest, so I would think maybe there would be some failures on machines with "problems."

> I also tried dimensions 8 by 16. Do you want me to test something else?

There was not really anything special about 4 x 8, just wanted the dimensions to be different from each other.  One failing example is 4 by 5.  Could you try 1000 random 4 x 5's?

If you do get failures, than maybe try 3 x 4, or 5 x 6, or 5 x 4, or ....

At this point, I really do not have any idea where the problem may be and it would be good to send a real precise report to the numpy/scipy group.

Rob



---

archive/issue_comments_112587.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nI ran the one-liner test a little bit more systematically. It all depends on\nthe dimensions: 4 x 8 always work and 4 x 5 never work. For i,j < 10, here are\nthe dimensions i x j that never work : 3 x 4, 4 x 5, 5 x 6, 5 x 7, 6 x 7, 6 x\n8, 6 x 9, 7 x 8, 7 x 9, 8 x 9. Hence, the smallest examples I can get are\ndimension 3 x 4. Here are some of them even if listing them is stupid since\nit looks to be broken for every 3 x 4 matrices:\n\n```\n[\n[ 2*I - 2 -6*I + 1    I + 1        1]  \n[      -1    I + 1     -2*I        2]  \n[    -101   -I - 1      3*I        1], \n\n[-2*I - 5       -I      2*I -3*I + 1]  \n[       5 -3*I + 1   -I - 1        0]  \n[  -I - 1        I        I       -I], \n\n[-5*I + 3   -I + 1        0  2*I + 8]  \n[       I       -I    I + 1    I - 1]  \n[ 2*I + 1        0    I + 4       -I], \n\n[-2*I - 2   -I + 2       -I  -I + 14]  \n[  -I - 2       15   -I + 1  2*I - 3]  \n[14*I - 1      2*I -I + 169       -I], \n\n[-2*I - 5       10     -3*I  -I - 19]  \n[   I - 2  2*I - 4   -I - 1   -I + 1]  \n[  -I - 3 -3*I - 1       -2    I + 1]  \n]\n```",
    "created_at": "2011-04-25T03:40:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11248#issuecomment-112587",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:8" align="right">comment:8</div>

I ran the one-liner test a little bit more systematically. It all depends on
the dimensions: 4 x 8 always work and 4 x 5 never work. For i,j < 10, here are
the dimensions i x j that never work : 3 x 4, 4 x 5, 5 x 6, 5 x 7, 6 x 7, 6 x
8, 6 x 9, 7 x 8, 7 x 9, 8 x 9. Hence, the smallest examples I can get are
dimension 3 x 4. Here are some of them even if listing them is stupid since
it looks to be broken for every 3 x 4 matrices:

```
[
[ 2*I - 2 -6*I + 1    I + 1        1]  
[      -1    I + 1     -2*I        2]  
[    -101   -I - 1      3*I        1], 

[-2*I - 5       -I      2*I -3*I + 1]  
[       5 -3*I + 1   -I - 1        0]  
[  -I - 1        I        I       -I], 

[-5*I + 3   -I + 1        0  2*I + 8]  
[       I       -I    I + 1    I - 1]  
[ 2*I + 1        0    I + 4       -I], 

[-2*I - 2   -I + 2       -I  -I + 14]  
[  -I - 2       15   -I + 1  2*I - 3]  
[14*I - 1      2*I -I + 169       -I], 

[-2*I - 5       10     -3*I  -I - 19]  
[   I - 2  2*I - 4   -I - 1   -I + 1]  
[  -I - 3 -3*I - 1       -2    I + 1]  
]
```



---

archive/issue_comments_112588.json:
```json
{
    "body": "The augmented oneliner code.",
    "created_at": "2011-04-25T03:52:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11248#issuecomment-112588",
    "user": "https://github.com/seblabbe"
}
```

The augmented oneliner code.



---

archive/issue_comments_112589.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nAttachment: **[11248.sage.gz](https://github.com/sagemath/sage/files/ticket11248/11248.sage.gz)**\n\nReplying to [@seblabbe](#comment:8):\n> I ran the one-liner test a little bit more systematically. \n\nPerfect.  Thanks!  \n\n(I keep thinking I can go and try something, and then realize it probably won't fail on my machine.)\n\nThe other thing to do would be try a 3 x 4 in pure numpy so there is no Sage involved, then I would say it is a numpy + compiler problem, though I guess Sage could be building something wrong.\n\nYou could mimic the pure numpy above - just take a failing Sage example and replace the complex part by something of the form `6j`.\n\nRob",
    "created_at": "2011-04-25T03:55:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11248#issuecomment-112589",
    "user": "https://github.com/rbeezer"
}
```

<div id="comment:9" align="right">comment:9</div>

Attachment: **[11248.sage.gz](https://github.com/sagemath/sage/files/ticket11248/11248.sage.gz)**

Replying to [@seblabbe](#comment:8):
> I ran the one-liner test a little bit more systematically. 

Perfect.  Thanks!  

(I keep thinking I can go and try something, and then realize it probably won't fail on my machine.)

The other thing to do would be try a 3 x 4 in pure numpy so there is no Sage involved, then I would say it is a numpy + compiler problem, though I guess Sage could be building something wrong.

You could mimic the pure numpy above - just take a failing Sage example and replace the complex part by something of the form `6j`.

Rob



---

archive/issue_comments_112590.json:
```json
{
    "body": "Attachment: **[broken.png](https://github.com/sagemath/sage/files/ticket11248/broken.png)**\n\nThe points (i,j) if i x j is broken",
    "created_at": "2011-04-25T03:57:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11248#issuecomment-112590",
    "user": "https://github.com/seblabbe"
}
```

Attachment: **[broken.png](https://github.com/sagemath/sage/files/ticket11248/broken.png)**

The points (i,j) if i x j is broken



---

archive/issue_comments_112591.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\n> (I keep thinking I can go and try something, and then realize it probably won't fail on my machine.)\n\n:)\n \n> The other thing to do would be try a 3 x 4 in pure numpy so there is no Sage involved, then I would say it is a numpy + compiler problem, though I guess Sage could be building something wrong.\n\nHere it is.\n\nPasted:\n\n```\nimport numpy                                           \nimport scipy.linalg                                    \nA = numpy.array( [[1 - 1j,     -3j, -2 + 1j, -2 + 3j], \n                 [ 1 - 1j, -2 + 1j,  1 + 4j,  2 + 1j], \n                 [-2 + 4j,  2 - 1j,  8 - 4j,  3 - 2j]])\nU, S, VH = scipy.linalg.svd(A)                         \nVH                                                     \nnumpy.dot(VH, VH.conj().T)                             \n```\n\nObtained:\n\n```\nslabbe@pol ~/Documents/Projets/11248 $ sage -python\nPython 2.6.4 (r264:75706, Mar  7 2011, 10:43:40) \n[GCC 4.0.1 (Apple Inc. build 5493)] on darwin\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n>>> \n>>> import numpy\n>>> import scipy.linalg\n>>> A = numpy.array( [[1 - 1j,     -3j, -2 + 1j, -2 + 3j],\n...                  [ 1 - 1j, -2 + 1j,  1 + 4j,  2 + 1j],\n...                  [-2 + 4j,  2 - 1j,  8 - 4j,  3 - 2j]])\n>>> U, S, VH = scipy.linalg.svd(A)\n>>> VH\narray([[-0.24117245+0.26396396j,  0.19140641+0.08267184j,\n         0.76910439-0.2828064j ,  0.30223564-0.25659388j],\n       [-0.14415028+0.25977119j,  0.22860092-0.71406845j,\n         0.13962359+0.01965114j, -0.16011713+0.55142459j],\n       [ 0.44760366-0.70135903j, -0.02761036-0.17046482j,\n         0.45504603-0.15137939j, -0.20818489+0.06784049j],\n       [ 0.00000000+0.j        ,  0.00000000+0.j        ,\n         0.00000000+0.j        ,  0.00000000+0.j        ]])\n>>> numpy.dot(VH, VH.conj().T)\narray([[  1.00000000e+00 -1.38777878e-17j,\n          8.32667268e-17 +6.24500451e-17j,\n          1.38777878e-17 +5.55111512e-17j,\n          0.00000000e+00 +0.00000000e+00j],\n       [  8.32667268e-17 -5.55111512e-17j,\n          1.00000000e+00 +1.38777878e-17j,\n          5.55111512e-17 +1.11022302e-16j,\n          0.00000000e+00 +0.00000000e+00j],\n       [  1.38777878e-17 -5.89805982e-17j,\n          5.55111512e-17 -1.14491749e-16j,\n          1.00000000e+00 +1.56125113e-17j,\n          0.00000000e+00 +0.00000000e+00j],\n       [  0.00000000e+00 +0.00000000e+00j,\n          0.00000000e+00 +0.00000000e+00j,\n          0.00000000e+00 +0.00000000e+00j,\n          0.00000000e+00 +0.00000000e+00j]])\n>>> \n```",
    "created_at": "2011-04-25T04:10:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11248#issuecomment-112591",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:10" align="right">comment:10</div>

> (I keep thinking I can go and try something, and then realize it probably won't fail on my machine.)

:)
 
> The other thing to do would be try a 3 x 4 in pure numpy so there is no Sage involved, then I would say it is a numpy + compiler problem, though I guess Sage could be building something wrong.

Here it is.

Pasted:

```
import numpy                                           
import scipy.linalg                                    
A = numpy.array( [[1 - 1j,     -3j, -2 + 1j, -2 + 3j], 
                 [ 1 - 1j, -2 + 1j,  1 + 4j,  2 + 1j], 
                 [-2 + 4j,  2 - 1j,  8 - 4j,  3 - 2j]])
U, S, VH = scipy.linalg.svd(A)                         
VH                                                     
numpy.dot(VH, VH.conj().T)                             
```

Obtained:

```
slabbe@pol ~/Documents/Projets/11248 $ sage -python
Python 2.6.4 (r264:75706, Mar  7 2011, 10:43:40) 
[GCC 4.0.1 (Apple Inc. build 5493)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>> 
>>> import numpy
>>> import scipy.linalg
>>> A = numpy.array( [[1 - 1j,     -3j, -2 + 1j, -2 + 3j],
...                  [ 1 - 1j, -2 + 1j,  1 + 4j,  2 + 1j],
...                  [-2 + 4j,  2 - 1j,  8 - 4j,  3 - 2j]])
>>> U, S, VH = scipy.linalg.svd(A)
>>> VH
array([[-0.24117245+0.26396396j,  0.19140641+0.08267184j,
         0.76910439-0.2828064j ,  0.30223564-0.25659388j],
       [-0.14415028+0.25977119j,  0.22860092-0.71406845j,
         0.13962359+0.01965114j, -0.16011713+0.55142459j],
       [ 0.44760366-0.70135903j, -0.02761036-0.17046482j,
         0.45504603-0.15137939j, -0.20818489+0.06784049j],
       [ 0.00000000+0.j        ,  0.00000000+0.j        ,
         0.00000000+0.j        ,  0.00000000+0.j        ]])
>>> numpy.dot(VH, VH.conj().T)
array([[  1.00000000e+00 -1.38777878e-17j,
          8.32667268e-17 +6.24500451e-17j,
          1.38777878e-17 +5.55111512e-17j,
          0.00000000e+00 +0.00000000e+00j],
       [  8.32667268e-17 -5.55111512e-17j,
          1.00000000e+00 +1.38777878e-17j,
          5.55111512e-17 +1.11022302e-16j,
          0.00000000e+00 +0.00000000e+00j],
       [  1.38777878e-17 -5.89805982e-17j,
          5.55111512e-17 -1.14491749e-16j,
          1.00000000e+00 +1.56125113e-17j,
          0.00000000e+00 +0.00000000e+00j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j]])
>>> 
```



---

archive/issue_comments_112592.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@seblabbe](#comment:10):\n> Here it is.\n\nThanks again.  The PNG is great.  ;-)\n\nMaybe Samuel will add more evidence overnight.  I'll send something up to the numpy folks in the morning - I think I'm going to call it a night now.\n\nRob",
    "created_at": "2011-04-25T04:26:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11248#issuecomment-112592",
    "user": "https://github.com/rbeezer"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@seblabbe](#comment:10):
> Here it is.

Thanks again.  The PNG is great.  ;-)

Maybe Samuel will add more evidence overnight.  I'll send something up to the numpy folks in the morning - I think I'm going to call it a night now.

Rob



---

archive/issue_comments_112593.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@rbeezer](#comment:11):\n\nI tried the one-liner in Sage a few times and got True all the time.\n\nHere is what I get with the numpy/scipy in 'sage -python'.\n\n```\n$ date -u \"+Date: %F %T Z\"\nDate: 2011-04-25 10:00:46 Z\n$ uname -a\nDarwin U 9.8.0 Darwin Kernel Version 9.8.0: Wed Jul 15 16:55:01 PDT 2009; root:xnu-1228.15.4~1/RELEASE_I386 i386\n$ gcc -v\nUsing built-in specs.\nTarget: i686-apple-darwin9\nConfigured with: /var/tmp/gcc_42/gcc_42-5577~1/src/configure --disable-checking --enable-werror --prefix=/usr --mandir=/usr/share/man --enable-languages=c,objc,c++,obj-c++ --program-transform-name=/^[cg][^.-]*$/s/$/-4.2/ --with-slibdir=/usr/lib --build=i686-apple-darwin9 --with-gxx-include-dir=/usr/include/c++/4.0.0 --host=i686-apple-darwin9 --target=i686-apple-darwin9\nThread model: posix\ngcc version 4.2.1 (Apple Inc. build 5577)\n$ alias sage='/Applications/sage-4.7.alpha5/sage'\n$ sage -python\nPython 2.6.4 (r264:75706, Apr 22 2011, 11:05:07) \n[GCC 4.2.1 (Apple Inc. build 5577)] on darwin\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n>>> import numpy\n>>> import scipy.linalg\n>>> A = numpy.array( [[1 - 1j,     -3j, -2 + 1j,      1, -2 + 3j],\n...                  [ 1 - 1j, -2 + 1j,  1 + 4j,      0,  2 + 1j],\n...                  [     -1, -5 + 1j, -2 + 1j, 1 + 1j, -5 - 4j],\n...                  [-2 + 4j,  2 - 1j,  8 - 4j, 1 - 8j,  3 - 2j]])\n>>> U, S, VH = scipy.linalg.svd(A)\n>>> VH\narray([[-0.10378056+0.25534799j,  0.22371070-0.07765616j,\n         0.55736639-0.40276461j, -0.04874824-0.50177439j,\n         0.32025785-0.19584279j],\n       [-0.28067375-0.0116824j , -0.49586800+0.1305711j ,\n         0.14432786+0.08803575j,  0.21076793+0.04575091j,\n        -0.19220732-0.73899332j],\n       [ 0.10136055-0.1681669j ,  0.13465050+0.69687595j,\n         0.19709231-0.03497225j, -0.42056091+0.37188099j,\n         0.28760069-0.14046187j],\n       [-0.27289262+0.66077235j,  0.06177902+0.25464336j,\n        -0.52050549+0.06307174j,  0.11847581-0.00883692j,\n         0.35771384-0.05719981j],\n       [ 0.00000000+0.j        ,  0.00000000+0.j        ,\n         0.00000000+0.j        ,  0.00000000+0.j        ,  0.00000000+0.j        ]])\n>>> numpy.dot(VH, VH.conj().T)\narray([[  1.00000000e+00 +1.38777878e-17j,\n         -8.32667268e-17 +2.84494650e-16j,\n          1.38777878e-16 -1.45716772e-16j,\n         -1.94289029e-16 +1.38777878e-17j,\n          0.00000000e+00 +0.00000000e+00j],\n       [ -8.32667268e-17 -2.77555756e-16j,\n          1.00000000e+00 +0.00000000e+00j,\n         -7.56339436e-16 +1.38777878e-16j,\n          5.55111512e-17 -1.66533454e-16j,\n          0.00000000e+00 +0.00000000e+00j],\n       [  1.38777878e-16 +1.17961196e-16j,\n         -7.56339436e-16 -1.28369537e-16j,\n          1.00000000e+00 +6.93889390e-18j,\n         -3.88578059e-16 +4.16333634e-17j,\n          0.00000000e+00 +0.00000000e+00j],\n       [ -1.94289029e-16 -1.04083409e-17j,\n          5.55111512e-17 +1.99493200e-16j,\n         -3.88578059e-16 -2.08166817e-17j,\n          1.00000000e+00 -6.93889390e-18j,\n          0.00000000e+00 +0.00000000e+00j],\n       [  0.00000000e+00 +0.00000000e+00j,\n          0.00000000e+00 +0.00000000e+00j,\n          0.00000000e+00 +0.00000000e+00j,\n          0.00000000e+00 +0.00000000e+00j,\n          0.00000000e+00 +0.00000000e+00j]])\n>>> \n\n```\n\nSamuel",
    "created_at": "2011-04-25T10:12:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11248#issuecomment-112593",
    "user": "https://github.com/slel"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@rbeezer](#comment:11):

I tried the one-liner in Sage a few times and got True all the time.

Here is what I get with the numpy/scipy in 'sage -python'.

```
$ date -u "+Date: %F %T Z"
Date: 2011-04-25 10:00:46 Z
$ uname -a
Darwin U 9.8.0 Darwin Kernel Version 9.8.0: Wed Jul 15 16:55:01 PDT 2009; root:xnu-1228.15.4~1/RELEASE_I386 i386
$ gcc -v
Using built-in specs.
Target: i686-apple-darwin9
Configured with: /var/tmp/gcc_42/gcc_42-5577~1/src/configure --disable-checking --enable-werror --prefix=/usr --mandir=/usr/share/man --enable-languages=c,objc,c++,obj-c++ --program-transform-name=/^[cg][^.-]*$/s/$/-4.2/ --with-slibdir=/usr/lib --build=i686-apple-darwin9 --with-gxx-include-dir=/usr/include/c++/4.0.0 --host=i686-apple-darwin9 --target=i686-apple-darwin9
Thread model: posix
gcc version 4.2.1 (Apple Inc. build 5577)
$ alias sage='/Applications/sage-4.7.alpha5/sage'
$ sage -python
Python 2.6.4 (r264:75706, Apr 22 2011, 11:05:07) 
[GCC 4.2.1 (Apple Inc. build 5577)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>> import numpy
>>> import scipy.linalg
>>> A = numpy.array( [[1 - 1j,     -3j, -2 + 1j,      1, -2 + 3j],
...                  [ 1 - 1j, -2 + 1j,  1 + 4j,      0,  2 + 1j],
...                  [     -1, -5 + 1j, -2 + 1j, 1 + 1j, -5 - 4j],
...                  [-2 + 4j,  2 - 1j,  8 - 4j, 1 - 8j,  3 - 2j]])
>>> U, S, VH = scipy.linalg.svd(A)
>>> VH
array([[-0.10378056+0.25534799j,  0.22371070-0.07765616j,
         0.55736639-0.40276461j, -0.04874824-0.50177439j,
         0.32025785-0.19584279j],
       [-0.28067375-0.0116824j , -0.49586800+0.1305711j ,
         0.14432786+0.08803575j,  0.21076793+0.04575091j,
        -0.19220732-0.73899332j],
       [ 0.10136055-0.1681669j ,  0.13465050+0.69687595j,
         0.19709231-0.03497225j, -0.42056091+0.37188099j,
         0.28760069-0.14046187j],
       [-0.27289262+0.66077235j,  0.06177902+0.25464336j,
        -0.52050549+0.06307174j,  0.11847581-0.00883692j,
         0.35771384-0.05719981j],
       [ 0.00000000+0.j        ,  0.00000000+0.j        ,
         0.00000000+0.j        ,  0.00000000+0.j        ,  0.00000000+0.j        ]])
>>> numpy.dot(VH, VH.conj().T)
array([[  1.00000000e+00 +1.38777878e-17j,
         -8.32667268e-17 +2.84494650e-16j,
          1.38777878e-16 -1.45716772e-16j,
         -1.94289029e-16 +1.38777878e-17j,
          0.00000000e+00 +0.00000000e+00j],
       [ -8.32667268e-17 -2.77555756e-16j,
          1.00000000e+00 +0.00000000e+00j,
         -7.56339436e-16 +1.38777878e-16j,
          5.55111512e-17 -1.66533454e-16j,
          0.00000000e+00 +0.00000000e+00j],
       [  1.38777878e-16 +1.17961196e-16j,
         -7.56339436e-16 -1.28369537e-16j,
          1.00000000e+00 +6.93889390e-18j,
         -3.88578059e-16 +4.16333634e-17j,
          0.00000000e+00 +0.00000000e+00j],
       [ -1.94289029e-16 -1.04083409e-17j,
          5.55111512e-17 +1.99493200e-16j,
         -3.88578059e-16 -2.08166817e-17j,
          1.00000000e+00 -6.93889390e-18j,
          0.00000000e+00 +0.00000000e+00j],
       [  0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j,
          0.00000000e+00 +0.00000000e+00j]])
>>> 

```

Samuel



---

archive/issue_comments_112594.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nHere is what I heard back from the `NumPy` discussion list:\n\n\"The Numpy routine is a very thin wrapper of LAPACK's ZGESDD, and probably \ncannot have any bugs of this kind, so the problem is most likely with the \nLAPACK and BLAS libraries you use. You will probably be able to reproduce \nthe problem also with an equivalent Fortran/C snippet calling LAPACK \ndirectly.\n\nProblems like this in BLAS/LAPACK are somewhat difficult to track. You \ncould try switching to another BLAS library (or, if you use ATLAS, \ncompile it differently) and checking if the problem disappears.\"\n\nI also found a FORTRAN example, coincidentally a 3 x 4:\nhttp://software.intel.com/sites/products/documentation/hpc/mkl/lapack/mkl_lapack_examples/zgesdd_ex.f.htm\n\nOtherwise, I think this one is now beyond me.",
    "created_at": "2011-04-25T20:21:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11248#issuecomment-112594",
    "user": "https://github.com/rbeezer"
}
```

<div id="comment:13" align="right">comment:13</div>

Here is what I heard back from the `NumPy` discussion list:

"The Numpy routine is a very thin wrapper of LAPACK's ZGESDD, and probably 
cannot have any bugs of this kind, so the problem is most likely with the 
LAPACK and BLAS libraries you use. You will probably be able to reproduce 
the problem also with an equivalent Fortran/C snippet calling LAPACK 
directly.

Problems like this in BLAS/LAPACK are somewhat difficult to track. You 
could try switching to another BLAS library (or, if you use ATLAS, 
compile it differently) and checking if the problem disappears."

I also found a FORTRAN example, coincidentally a 3 x 4:
http://software.intel.com/sites/products/documentation/hpc/mkl/lapack/mkl_lapack_examples/zgesdd_ex.f.htm

Otherwise, I think this one is now beyond me.



---

archive/issue_comments_112595.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\n> Otherwise, I think this one is now beyond me.\n\nSo, does this means it is beyond Sage? I mean, should a fix be made in Sage or should it be done upstream?",
    "created_at": "2011-04-25T23:41:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11248#issuecomment-112595",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:14" align="right">comment:14</div>

> Otherwise, I think this one is now beyond me.

So, does this means it is beyond Sage? I mean, should a fix be made in Sage or should it be done upstream?



---

archive/issue_comments_112596.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\n> I also found a FORTRAN example, coincidentally a 3 x 4:\n> http://software.intel.com/sites/products/documentation/hpc/mkl/lapack/mkl_lapack_examples/zgesdd_ex.f.htm\n> \n\nDo you mean this is a FORTRAN example that shows the problem, or one that just happens to be FORTRAN?  I'd be happy to check this as well if you give me something to cut and paste.  And tell me how to compile it if I have to do that :)",
    "created_at": "2011-04-26T02:26:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11248#issuecomment-112596",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:15" align="right">comment:15</div>

> I also found a FORTRAN example, coincidentally a 3 x 4:
> http://software.intel.com/sites/products/documentation/hpc/mkl/lapack/mkl_lapack_examples/zgesdd_ex.f.htm
> 

Do you mean this is a FORTRAN example that shows the problem, or one that just happens to be FORTRAN?  I'd be happy to check this as well if you give me something to cut and paste.  And tell me how to compile it if I have to do that :)



---

archive/issue_comments_112597.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@seblabbe](#comment:14):\n> So, does this means it is beyond Sage? I mean, should a fix be made in Sage or should it be done upstream?\n\nIts beyond me, as in - its beyond my knowledge.  \n\nI do not think the true source of the error has been located.  It is not Sage library code.  It appears in numpy, which wraps the LAPACK function ZGESDD.  But I do not understand the relationships between LAPACK, ATLAS and BLAS, and especially on the Mac.  Palmieri says ATLAS on the mac is \"system supplied.\"  It still could be the Sage build that does something wrong.\n\nSo somebody else is going to have to carry this one forward.  Samuel has some ideas.",
    "created_at": "2011-04-26T02:53:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11248#issuecomment-112597",
    "user": "https://github.com/rbeezer"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@seblabbe](#comment:14):
> So, does this means it is beyond Sage? I mean, should a fix be made in Sage or should it be done upstream?

Its beyond me, as in - its beyond my knowledge.  

I do not think the true source of the error has been located.  It is not Sage library code.  It appears in numpy, which wraps the LAPACK function ZGESDD.  But I do not understand the relationships between LAPACK, ATLAS and BLAS, and especially on the Mac.  Palmieri says ATLAS on the mac is "system supplied."  It still could be the Sage build that does something wrong.

So somebody else is going to have to carry this one forward.  Samuel has some ideas.



---

archive/issue_comments_112598.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@kcrisman](#comment:15):\n> Do you mean this is a FORTRAN example that shows the problem, or one that just happens to be FORTRAN?  I'd be happy to check this as well if you give me something to cut and paste.  And tell me how to compile it if I have to do that :)\n\nThis is a FORTRAN example that calls the problem function and with a 3 x 4 matrix, which is a problematic size.  So it might fail.  But you need to have a configuration that is failing already, or it is not really of much use.\n\nAnd I have no idea how to compile it, run it, find the right libraries, etc.",
    "created_at": "2011-04-26T02:55:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11248#issuecomment-112598",
    "user": "https://github.com/rbeezer"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@kcrisman](#comment:15):
> Do you mean this is a FORTRAN example that shows the problem, or one that just happens to be FORTRAN?  I'd be happy to check this as well if you give me something to cut and paste.  And tell me how to compile it if I have to do that :)

This is a FORTRAN example that calls the problem function and with a 3 x 4 matrix, which is a problematic size.  So it might fail.  But you need to have a configuration that is failing already, or it is not really of much use.

And I have no idea how to compile it, run it, find the right libraries, etc.



---

archive/issue_comments_112599.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nHere are instructions Francois Bissey once sent me for building a Sage without LAPACK (which worked fine for me on a Linux system).  You need to unpack the numpy spkg, make the edit suggested below and roll up the spkg with a patch-level one greater (filename and directory name).  Then install `sage -i` the new package.  I then did the `sage -b` he suggests, IIRC.\n\nExperiment:  Build an LAPACK-less Sage and see if the error persists, or not.\n\n---\n\nI am not 100% certain that it will work as python automagic is quite strong.\nIn Numpy's spkg-install add the following line \nexport {ATLAS,PTATLAS,BLAS,LAPACK,MKL}=None\nbetween\nunset CFLAGS\nand \npython setup.py install ${NUMPY_FCONFIG}\n\nActually you could throw the ${NUMPY_FCONFIG} bit because it is only\nused for lapack (which is a fortran library at heart, although I suspect\nnumpy uses clapack from ATLAS on finding it).\nYou rebuild numpy the usual way. Because numpy header and library are used\nin quite a few place a \"sage -b\" is probably a good idea, but it would \npossibly work without.",
    "created_at": "2011-04-26T03:10:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11248#issuecomment-112599",
    "user": "https://github.com/rbeezer"
}
```

<div id="comment:18" align="right">comment:18</div>

Here are instructions Francois Bissey once sent me for building a Sage without LAPACK (which worked fine for me on a Linux system).  You need to unpack the numpy spkg, make the edit suggested below and roll up the spkg with a patch-level one greater (filename and directory name).  Then install `sage -i` the new package.  I then did the `sage -b` he suggests, IIRC.

Experiment:  Build an LAPACK-less Sage and see if the error persists, or not.

---

I am not 100% certain that it will work as python automagic is quite strong.
In Numpy's spkg-install add the following line 
export {ATLAS,PTATLAS,BLAS,LAPACK,MKL}=None
between
unset CFLAGS
and 
python setup.py install ${NUMPY_FCONFIG}

Actually you could throw the ${NUMPY_FCONFIG} bit because it is only
used for lapack (which is a fortran library at heart, although I suspect
numpy uses clapack from ATLAS on finding it).
You rebuild numpy the usual way. Because numpy header and library are used
in quite a few place a "sage -b" is probably a good idea, but it would 
possibly work without.



---

archive/issue_comments_112600.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@rbeezer](#comment:16):\n> Replying to [@seblabbe](#comment:14):\n> > So, does this means it is beyond Sage? I mean, should a fix be made in Sage or should it be done upstream?\n\n> \n> Its beyond me, as in - its beyond my knowledge.  \n> \n> I do not think the true source of the error has been located.  It is not Sage library code.  It appears in numpy, which wraps the LAPACK function ZGESDD.  But I do not understand the relationships between LAPACK, ATLAS and BLAS, and especially on the Mac.  Palmieri says ATLAS on the mac is \"system supplied.\"  It still could be the Sage build that does something wrong.\n> \n\nLet me try to shed some light. There are 3 libraries: BLAS also sometimes f77BLAS,\nCBLAS and LAPACK. BLAS and LAPACK are standard libraries which means they have a defined interface and behavior. Anyone can create an implementation of Blas or Lapack, it has to conform to a standard.\nf77blas is a fortran implementation cblas a C implementation. Blas is low level.\nLapack is a higher level library and is fortran based. It uses f77blas functions.\n\nAtlas is a particular implementation of cblas, it also provides a f77blas implementation. It is highly optimized by autotunning (if all goes right). Furthermore if you provide the netlib reference lapack implementation it can produce an optimized lapack library based on some of its optimized blas algorithm.\n[http://math-atlas.sourceforge.net/devel/atlas_devel/atlas_devel.html#SECTION00060000000000000000](http://math-atlas.sourceforge.net/devel/atlas_devel/atlas_devel.html#SECTION00060000000000000000)\n\nOf course lapack also has to link to f77blas, if you have a subtle problem there it will appear in lapack.",
    "created_at": "2011-04-26T09:56:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11248#issuecomment-112600",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@rbeezer](#comment:16):
> Replying to [@seblabbe](#comment:14):
> > So, does this means it is beyond Sage? I mean, should a fix be made in Sage or should it be done upstream?

> 
> Its beyond me, as in - its beyond my knowledge.  
> 
> I do not think the true source of the error has been located.  It is not Sage library code.  It appears in numpy, which wraps the LAPACK function ZGESDD.  But I do not understand the relationships between LAPACK, ATLAS and BLAS, and especially on the Mac.  Palmieri says ATLAS on the mac is "system supplied."  It still could be the Sage build that does something wrong.
> 

Let me try to shed some light. There are 3 libraries: BLAS also sometimes f77BLAS,
CBLAS and LAPACK. BLAS and LAPACK are standard libraries which means they have a defined interface and behavior. Anyone can create an implementation of Blas or Lapack, it has to conform to a standard.
f77blas is a fortran implementation cblas a C implementation. Blas is low level.
Lapack is a higher level library and is fortran based. It uses f77blas functions.

Atlas is a particular implementation of cblas, it also provides a f77blas implementation. It is highly optimized by autotunning (if all goes right). Furthermore if you provide the netlib reference lapack implementation it can produce an optimized lapack library based on some of its optimized blas algorithm.
[http://math-atlas.sourceforge.net/devel/atlas_devel/atlas_devel.html#SECTION00060000000000000000](http://math-atlas.sourceforge.net/devel/atlas_devel/atlas_devel.html#SECTION00060000000000000000)

Of course lapack also has to link to f77blas, if you have a subtle problem there it will appear in lapack.



---

archive/issue_comments_112601.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nI'm seeing if it is easy to whip up a quick C program that calls the OSX Accelerate framework ZGESDD function.  IIRC, that is what John meant by \"system-supplied\".",
    "created_at": "2011-04-26T13:32:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11248#issuecomment-112601",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:20" align="right">comment:20</div>

I'm seeing if it is easy to whip up a quick C program that calls the OSX Accelerate framework ZGESDD function.  IIRC, that is what John meant by "system-supplied".



---

archive/issue_comments_112602.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nI just want to report that my PPC OS X 10.4 machine finished doctests over our long weekend, and indeed \n\n```\n        sage: V.is_unitary()\nExpected: \n        True\nGot:\n        False\n```",
    "created_at": "2011-04-26T14:00:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11248#issuecomment-112602",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:21" align="right">comment:21</div>

I just want to report that my PPC OS X 10.4 machine finished doctests over our long weekend, and indeed 

```
        sage: V.is_unitary()
Expected: 
        True
Got:
        False
```



---

archive/issue_comments_112603.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nCan you doing the following:\n\n1. Put the code at http://software.intel.com/sites/products/documentation/hpc/mkl/lapack/mkl_lapack_examples/zgesdd_ex.c.htm in a file called `test_zgesdd.c`\n2. On the command line, compile this file with `gcc test_zgesdd.c -o test_zgesdd -framework Accelerate`\n3. Run the program: `./test_zgesdd` and post the result.  This uses the system zgesdd to compute a 3x4 SVD.\n\nNumpy by default uses a different option of zgesdd, though.  To test that, change the first argument of zgesdd from \"Singular Vectors\" to \"A\".  Then run the program again.\n\nI think those are correct instructions.",
    "created_at": "2011-04-26T14:53:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11248#issuecomment-112603",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:22" align="right">comment:22</div>

Can you doing the following:

1. Put the code at http://software.intel.com/sites/products/documentation/hpc/mkl/lapack/mkl_lapack_examples/zgesdd_ex.c.htm in a file called `test_zgesdd.c`
2. On the command line, compile this file with `gcc test_zgesdd.c -o test_zgesdd -framework Accelerate`
3. Run the program: `./test_zgesdd` and post the result.  This uses the system zgesdd to compute a 3x4 SVD.

Numpy by default uses a different option of zgesdd, though.  To test that, change the first argument of zgesdd from "Singular Vectors" to "A".  Then run the program again.

I think those are correct instructions.



---

archive/issue_comments_112604.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\n\n```\nLast login: Thu Apr 21 15:18:29 on ttyp4\nWelcome to Darwin!\nDasher-03:~ student$ cd Desktop/\nDasher-03:~/Desktop student$ gcc test_zgesdd.c -o test_zgesdd -framework Accelerate\nDasher-03:~/Desktop student$ ./test_zgesdd \n ZGESDD Example Program Results\n\n Singular values\n  21.76  16.60   3.97\n\n Left singular vectors (stored columnwise)\n (  0.55,  0.00) (  0.76,  0.00) ( -0.34,  0.00)\n ( -0.04, -0.15) (  0.27, -0.23) (  0.55, -0.74)\n (  0.81,  0.12) ( -0.52, -0.14) (  0.13, -0.11)\n\n Right singular vectors (stored rowwise)\n (  0.23,  0.21) (  0.37,  0.39) (  0.24,  0.33) ( -0.56, -0.37)\n ( -0.58,  0.40) (  0.11,  0.17) (  0.60, -0.27) (  0.16,  0.06)\n (  0.60,  0.12) ( -0.19,  0.30) (  0.39,  0.20) (  0.45,  0.31)\n```\nWith the change\n\n```\nDasher-03:~/Desktop student$ gcc test_zgesdd1.c -o test_zgesdd1 -framework Accelerate\nDasher-03:~/Desktop student$ ./test_zgesdd1 \n ZGESDD Example Program Results\n\n Singular values\n  21.76  16.60   3.97\n\n Left singular vectors (stored columnwise)\n (  0.55,  0.00) (  0.76,  0.00) ( -0.34,  0.00)\n ( -0.04, -0.15) (  0.27, -0.23) (  0.55, -0.74)\n (  0.81,  0.12) ( -0.52, -0.14) (  0.13, -0.11)\n\n Right singular vectors (stored rowwise)\n (  0.23,  0.21) (  0.37,  0.39) (  0.24,  0.33) ( -0.56, -0.37)\n ( -0.58,  0.40) (  0.11,  0.17) (  0.60, -0.27) (  0.16,  0.06)\n (  0.60,  0.12) ( -0.19,  0.30) (  0.39,  0.20) (  0.45,  0.31)\n```",
    "created_at": "2011-04-26T15:19:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11248#issuecomment-112604",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:23" align="right">comment:23</div>


```
Last login: Thu Apr 21 15:18:29 on ttyp4
Welcome to Darwin!
Dasher-03:~ student$ cd Desktop/
Dasher-03:~/Desktop student$ gcc test_zgesdd.c -o test_zgesdd -framework Accelerate
Dasher-03:~/Desktop student$ ./test_zgesdd 
 ZGESDD Example Program Results

 Singular values
  21.76  16.60   3.97

 Left singular vectors (stored columnwise)
 (  0.55,  0.00) (  0.76,  0.00) ( -0.34,  0.00)
 ( -0.04, -0.15) (  0.27, -0.23) (  0.55, -0.74)
 (  0.81,  0.12) ( -0.52, -0.14) (  0.13, -0.11)

 Right singular vectors (stored rowwise)
 (  0.23,  0.21) (  0.37,  0.39) (  0.24,  0.33) ( -0.56, -0.37)
 ( -0.58,  0.40) (  0.11,  0.17) (  0.60, -0.27) (  0.16,  0.06)
 (  0.60,  0.12) ( -0.19,  0.30) (  0.39,  0.20) (  0.45,  0.31)
```
With the change

```
Dasher-03:~/Desktop student$ gcc test_zgesdd1.c -o test_zgesdd1 -framework Accelerate
Dasher-03:~/Desktop student$ ./test_zgesdd1 
 ZGESDD Example Program Results

 Singular values
  21.76  16.60   3.97

 Left singular vectors (stored columnwise)
 (  0.55,  0.00) (  0.76,  0.00) ( -0.34,  0.00)
 ( -0.04, -0.15) (  0.27, -0.23) (  0.55, -0.74)
 (  0.81,  0.12) ( -0.52, -0.14) (  0.13, -0.11)

 Right singular vectors (stored rowwise)
 (  0.23,  0.21) (  0.37,  0.39) (  0.24,  0.33) ( -0.56, -0.37)
 ( -0.58,  0.40) (  0.11,  0.17) (  0.60, -0.27) (  0.16,  0.06)
 (  0.60,  0.12) ( -0.19,  0.30) (  0.39,  0.20) (  0.45,  0.31)
```



---

archive/issue_comments_112605.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nI guess we need to make one more change to the program to print out the last row of V**H.  Here is my patch to the program:\n\n```\n\n--- test_zgesdd.c.orig\t2011-04-26 11:12:41.000000000 -0500\n+++ test_zgesdd.c\t2011-04-26 11:13:26.000000000 -0500\n@@ -105,14 +105,15 @@\n         };\n         /* Executable statements */\n         printf( \" ZGESDD Example Program Results\\n\" );\n+\tprint_matrix(\"Original Matrix\", m, n, a, LDA);\n         /* Query and allocate the optimal workspace */\n         lwork = -1;\n-        zgesdd( \"Singular vectors\", &m, &n, a, &lda, s, u, &ldu, vt, &ldvt, &wkopt,\n+        zgesdd( \"A\", &m, &n, a, &lda, s, u, &ldu, vt, &ldvt, &wkopt,\n          &lwork, rwork, iwork, &info );\n         lwork = (int)wkopt.re;\n         work = (dcomplex*)malloc( lwork*sizeof(dcomplex) );\n         /* Compute SVD */\n-        zgesdd( \"Singular vectors\", &m, &n, a, &lda, s, u, &ldu, vt, &ldvt, work,\n+        zgesdd( \"A\", &m, &n, a, &lda, s, u, &ldu, vt, &ldvt, work,\n          &lwork, rwork, iwork, &info );\n         /* Check for convergence */\n         if( info > 0 ) {\n@@ -124,7 +125,7 @@\n         /* Print left singular vectors */\n         print_matrix( \"Left singular vectors (stored columnwise)\", m, m, u, ldu );\n         /* Print right singular vectors */\n-        print_matrix( \"Right singular vectors (stored rowwise)\", m, n, vt, ldvt );\n+        print_matrix( \"Right singular vectors (stored rowwise)\", n, n, vt, ldvt );\n         /* Free workspace */\n         free( (void*)work );\n         exit( 0 );\n```\n\nNotice that I changed the `print_matrix` call to print out n rows, instead of m rows (that's the first argument after the string).\n\nSo: for someone that had a problem with numpy, could you run the example program:\n\n1. Copy http://software.intel.com/sites/products/documentation/hpc/mkl/lapack/mkl_lapack_examples/zgesdd_ex.c.htm to a file `test_zgesdd.c`\n\n2. Apply the patch above\n\n3. Compile with `gcc test_zgesdd.c -o test_zgesdd -framework Accelerate`\n\n4. Run: `./test_zgesdd`\n\nThen compare the resulting matrices with your output for the following input to `sage -python`\n\n```\nI=1j\nimport numpy\na=numpy.asarray([( -5.40+ I*  7.40), (  6.00+ I*  6.38), (  9.91+ I*  0.16), ( -5.28+ I* -4.16),   (  1.09+ I*  1.55), (  2.60+ I*  0.07), (  3.98+ I* -5.26), (  2.03+ I*  1.11),   (  9.88+ I*  1.91), (  4.92+ I*  6.31), ( -2.11+ I*  7.39), ( -9.81+ I* -8.98)],dtype=complex).reshape(3,4)\nnumpy.linalg.svd(a)\n```",
    "created_at": "2011-04-26T16:18:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11248#issuecomment-112605",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:24" align="right">comment:24</div>

I guess we need to make one more change to the program to print out the last row of V**H.  Here is my patch to the program:

```

--- test_zgesdd.c.orig	2011-04-26 11:12:41.000000000 -0500
+++ test_zgesdd.c	2011-04-26 11:13:26.000000000 -0500
@@ -105,14 +105,15 @@
         };
         /* Executable statements */
         printf( " ZGESDD Example Program Results\n" );
+	print_matrix("Original Matrix", m, n, a, LDA);
         /* Query and allocate the optimal workspace */
         lwork = -1;
-        zgesdd( "Singular vectors", &m, &n, a, &lda, s, u, &ldu, vt, &ldvt, &wkopt,
+        zgesdd( "A", &m, &n, a, &lda, s, u, &ldu, vt, &ldvt, &wkopt,
          &lwork, rwork, iwork, &info );
         lwork = (int)wkopt.re;
         work = (dcomplex*)malloc( lwork*sizeof(dcomplex) );
         /* Compute SVD */
-        zgesdd( "Singular vectors", &m, &n, a, &lda, s, u, &ldu, vt, &ldvt, work,
+        zgesdd( "A", &m, &n, a, &lda, s, u, &ldu, vt, &ldvt, work,
          &lwork, rwork, iwork, &info );
         /* Check for convergence */
         if( info > 0 ) {
@@ -124,7 +125,7 @@
         /* Print left singular vectors */
         print_matrix( "Left singular vectors (stored columnwise)", m, m, u, ldu );
         /* Print right singular vectors */
-        print_matrix( "Right singular vectors (stored rowwise)", m, n, vt, ldvt );
+        print_matrix( "Right singular vectors (stored rowwise)", n, n, vt, ldvt );
         /* Free workspace */
         free( (void*)work );
         exit( 0 );
```

Notice that I changed the `print_matrix` call to print out n rows, instead of m rows (that's the first argument after the string).

So: for someone that had a problem with numpy, could you run the example program:

1. Copy http://software.intel.com/sites/products/documentation/hpc/mkl/lapack/mkl_lapack_examples/zgesdd_ex.c.htm to a file `test_zgesdd.c`

2. Apply the patch above

3. Compile with `gcc test_zgesdd.c -o test_zgesdd -framework Accelerate`

4. Run: `./test_zgesdd`

Then compare the resulting matrices with your output for the following input to `sage -python`

```
I=1j
import numpy
a=numpy.asarray([( -5.40+ I*  7.40), (  6.00+ I*  6.38), (  9.91+ I*  0.16), ( -5.28+ I* -4.16),   (  1.09+ I*  1.55), (  2.60+ I*  0.07), (  3.98+ I* -5.26), (  2.03+ I*  1.11),   (  9.88+ I*  1.91), (  4.92+ I*  6.31), ( -2.11+ I*  7.39), ( -9.81+ I* -8.98)],dtype=complex).reshape(3,4)
numpy.linalg.svd(a)
```



---

archive/issue_comments_112606.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nNumpy:\n\n```\nDasher-03:~/Desktop/sage-4.7.alpha5 student$ ./sage -python\nPython 2.6.4 (r264:75706, Apr 20 2011, 11:28:06) \n[GCC 4.0.1 (Apple Computer, Inc. build 5367)] on darwin\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n>>> I=1j\n>>> import numpy\n>>> a=numpy.asarray([( -5.40+ I*  7.40), (  6.00+ I*  6.38), (  9.91+ I*  0.16), ( -5.28+ I* -4.16),   (  1.09+ I*  1.55), (  2.60+ I*  0.07), (  3.98+ I* -5.26), (  2.03+ I*  1.11),   (  9.88+ I*  1.91), (  4.92+ I*  6.31), ( -2.11+ I*  7.39), ( -9.81+ I* -8.98)],dtype=complex).reshape(3,4)\n>>> numpy.linalg.svd(a)\n(array([[ 0.54742764+0.j        ,  0.76302168+0.j        , -0.34368721+0.j        ],\n       [-0.03507684-0.15148438j,  0.27097680-0.22637514j,\n         0.54572628-0.74386208j],\n       [ 0.81299016+0.12325614j, -0.52311095-0.13956616j,\n         0.13357577-0.1135282j ]]), array([ 21.75519279,  16.59545017,   3.97327576]), array([[ 0.23160531+0.20669796j,  0.36590896+0.3864613j ,\n         0.24259328+0.32833854j, -0.56133932-0.37233547j],\n       [-0.57911906+0.40329699j,  0.10921398+0.17242422j,\n         0.59673801-0.27492812j,  0.15998810+0.05510835j],\n       [ 0.60420072+0.12337134j, -0.18988750+0.29722068j,\n         0.39210635+0.19697635j,  0.45451433+0.31015037j],\n       [ 0.00000000+0.j        ,  0.00000000+0.j        ,\n         0.00000000+0.j        , -0.00000000+0.j        ]]))\n```\nOld program:\n\n```\nDasher-03:~/Desktop student$ ./test_zgesdd ZGESDD Example Program Results\n\n Original Matrix\n ( -5.40,  7.40) (  6.00,  6.38) (  9.91,  0.16) ( -5.28, -4.16)\n (  1.09,  1.55) (  2.60,  0.07) (  3.98, -5.26) (  2.03,  1.11)\n (  9.88,  1.91) (  4.92,  6.31) ( -2.11,  7.39) ( -9.81, -8.98)\n\n Singular values\n  21.76  16.60   3.97\n\n Left singular vectors (stored columnwise)\n (  0.55,  0.00) (  0.76,  0.00) ( -0.34,  0.00)\n ( -0.04, -0.15) (  0.27, -0.23) (  0.55, -0.74)\n (  0.81,  0.12) ( -0.52, -0.14) (  0.13, -0.11)\n\n Right singular vectors (stored rowwise)\n (  0.23,  0.21) (  0.37,  0.39) (  0.24,  0.33) ( -0.56, -0.37)\n ( -0.58,  0.40) (  0.11,  0.17) (  0.60, -0.27) (  0.16,  0.06)\n (  0.60,  0.12) ( -0.19,  0.30) (  0.39,  0.20) (  0.45,  0.31)\n (  0.00, -0.00) ( -2.00, -0.00) (  0.00, -0.00) (  0.00,  0.00)\n```\nProgram using 'A':\n\n```\nDasher-03:~/Desktop student$ ./test_zgesdd1  ZGESDD Example Program Results\n\n Original Matrix\n ( -5.40,  7.40) (  6.00,  6.38) (  9.91,  0.16) ( -5.28, -4.16)\n (  1.09,  1.55) (  2.60,  0.07) (  3.98, -5.26) (  2.03,  1.11)\n (  9.88,  1.91) (  4.92,  6.31) ( -2.11,  7.39) ( -9.81, -8.98)\n\n Singular values\n  21.76  16.60   3.97\n\n Left singular vectors (stored columnwise)\n (  0.55,  0.00) (  0.76,  0.00) ( -0.34,  0.00)\n ( -0.04, -0.15) (  0.27, -0.23) (  0.55, -0.74)\n (  0.81,  0.12) ( -0.52, -0.14) (  0.13, -0.11)\n\n Right singular vectors (stored rowwise)\n (  0.23,  0.21) (  0.37,  0.39) (  0.24,  0.33) ( -0.56, -0.37)\n ( -0.58,  0.40) (  0.11,  0.17) (  0.60, -0.27) (  0.16,  0.06)\n (  0.60,  0.12) ( -0.19,  0.30) (  0.39,  0.20) (  0.45,  0.31)\n (  0.00,  0.00) (  0.00,  0.00) (  0.00,  0.00) ( -0.00,  0.00)\n```\nI see a single change in the last row, but of course that's enough.  \n\nBy the way, does that mean there a bug in the thing at the Intel site?",
    "created_at": "2011-04-26T16:28:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11248#issuecomment-112606",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:25" align="right">comment:25</div>

Numpy:

```
Dasher-03:~/Desktop/sage-4.7.alpha5 student$ ./sage -python
Python 2.6.4 (r264:75706, Apr 20 2011, 11:28:06) 
[GCC 4.0.1 (Apple Computer, Inc. build 5367)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>> I=1j
>>> import numpy
>>> a=numpy.asarray([( -5.40+ I*  7.40), (  6.00+ I*  6.38), (  9.91+ I*  0.16), ( -5.28+ I* -4.16),   (  1.09+ I*  1.55), (  2.60+ I*  0.07), (  3.98+ I* -5.26), (  2.03+ I*  1.11),   (  9.88+ I*  1.91), (  4.92+ I*  6.31), ( -2.11+ I*  7.39), ( -9.81+ I* -8.98)],dtype=complex).reshape(3,4)
>>> numpy.linalg.svd(a)
(array([[ 0.54742764+0.j        ,  0.76302168+0.j        , -0.34368721+0.j        ],
       [-0.03507684-0.15148438j,  0.27097680-0.22637514j,
         0.54572628-0.74386208j],
       [ 0.81299016+0.12325614j, -0.52311095-0.13956616j,
         0.13357577-0.1135282j ]]), array([ 21.75519279,  16.59545017,   3.97327576]), array([[ 0.23160531+0.20669796j,  0.36590896+0.3864613j ,
         0.24259328+0.32833854j, -0.56133932-0.37233547j],
       [-0.57911906+0.40329699j,  0.10921398+0.17242422j,
         0.59673801-0.27492812j,  0.15998810+0.05510835j],
       [ 0.60420072+0.12337134j, -0.18988750+0.29722068j,
         0.39210635+0.19697635j,  0.45451433+0.31015037j],
       [ 0.00000000+0.j        ,  0.00000000+0.j        ,
         0.00000000+0.j        , -0.00000000+0.j        ]]))
```
Old program:

```
Dasher-03:~/Desktop student$ ./test_zgesdd ZGESDD Example Program Results

 Original Matrix
 ( -5.40,  7.40) (  6.00,  6.38) (  9.91,  0.16) ( -5.28, -4.16)
 (  1.09,  1.55) (  2.60,  0.07) (  3.98, -5.26) (  2.03,  1.11)
 (  9.88,  1.91) (  4.92,  6.31) ( -2.11,  7.39) ( -9.81, -8.98)

 Singular values
  21.76  16.60   3.97

 Left singular vectors (stored columnwise)
 (  0.55,  0.00) (  0.76,  0.00) ( -0.34,  0.00)
 ( -0.04, -0.15) (  0.27, -0.23) (  0.55, -0.74)
 (  0.81,  0.12) ( -0.52, -0.14) (  0.13, -0.11)

 Right singular vectors (stored rowwise)
 (  0.23,  0.21) (  0.37,  0.39) (  0.24,  0.33) ( -0.56, -0.37)
 ( -0.58,  0.40) (  0.11,  0.17) (  0.60, -0.27) (  0.16,  0.06)
 (  0.60,  0.12) ( -0.19,  0.30) (  0.39,  0.20) (  0.45,  0.31)
 (  0.00, -0.00) ( -2.00, -0.00) (  0.00, -0.00) (  0.00,  0.00)
```
Program using 'A':

```
Dasher-03:~/Desktop student$ ./test_zgesdd1  ZGESDD Example Program Results

 Original Matrix
 ( -5.40,  7.40) (  6.00,  6.38) (  9.91,  0.16) ( -5.28, -4.16)
 (  1.09,  1.55) (  2.60,  0.07) (  3.98, -5.26) (  2.03,  1.11)
 (  9.88,  1.91) (  4.92,  6.31) ( -2.11,  7.39) ( -9.81, -8.98)

 Singular values
  21.76  16.60   3.97

 Left singular vectors (stored columnwise)
 (  0.55,  0.00) (  0.76,  0.00) ( -0.34,  0.00)
 ( -0.04, -0.15) (  0.27, -0.23) (  0.55, -0.74)
 (  0.81,  0.12) ( -0.52, -0.14) (  0.13, -0.11)

 Right singular vectors (stored rowwise)
 (  0.23,  0.21) (  0.37,  0.39) (  0.24,  0.33) ( -0.56, -0.37)
 ( -0.58,  0.40) (  0.11,  0.17) (  0.60, -0.27) (  0.16,  0.06)
 (  0.60,  0.12) ( -0.19,  0.30) (  0.39,  0.20) (  0.45,  0.31)
 (  0.00,  0.00) (  0.00,  0.00) (  0.00,  0.00) ( -0.00,  0.00)
```
I see a single change in the last row, but of course that's enough.  

By the way, does that mean there a bug in the thing at the Intel site?



---

archive/issue_comments_112607.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nShort update: I've been posting my debugging to the numpy thread: http://mail.scipy.org/pipermail/numpy-discussion/2011-April/056099.html\n\nBasically, it appears that the Lapack docs only guarantee that the V matrix is unitary if the number of rows is >= number of columns in the zgesdd function, which is what numpy calls.  So I think numpy is making a mistake calling zgesdd and returning the results if rows < columns.  Instead, they should call zgesvd, which does return a unitary V, according to the Lapack docs.  Note: when I say V, I mean V**H or whatever is returned.",
    "created_at": "2011-04-26T16:30:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11248#issuecomment-112607",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:26" align="right">comment:26</div>

Short update: I've been posting my debugging to the numpy thread: http://mail.scipy.org/pipermail/numpy-discussion/2011-April/056099.html

Basically, it appears that the Lapack docs only guarantee that the V matrix is unitary if the number of rows is >= number of columns in the zgesdd function, which is what numpy calls.  So I think numpy is making a mistake calling zgesdd and returning the results if rows < columns.  Instead, they should call zgesvd, which does return a unitary V, according to the Lapack docs.  Note: when I say V, I mean V**H or whatever is returned.



---

archive/issue_comments_112608.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nkcrisman: no bug on the intel site.  We changed the zgesdd call to \"A\", so we needed to print out the full matrix to see the last vector.  I think you just confirmed that the \"problem\" is in Lapack.  Or rather, Lapack is behaving exactly as the docs say, but the problem is that numpy is assuming that the V matrix returned is a unitary matrix.  It is if rows>=cols, according to the docs, but if rows<cols, then the return V is not stated to be a unitary matrix.",
    "created_at": "2011-04-26T16:33:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11248#issuecomment-112608",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:27" align="right">comment:27</div>

kcrisman: no bug on the intel site.  We changed the zgesdd call to "A", so we needed to print out the full matrix to see the last vector.  I think you just confirmed that the "problem" is in Lapack.  Or rather, Lapack is behaving exactly as the docs say, but the problem is that numpy is assuming that the V matrix returned is a unitary matrix.  It is if rows>=cols, according to the docs, but if rows<cols, then the return V is not stated to be a unitary matrix.



---

archive/issue_comments_112609.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nKarl - glad to see you found a machine to experiment with!\n\nJason - I'm following the discussion on the numpy list as well.  Nice work.\n\nQuestion:  do we understand why this problem does not surface on new Macs, or on Linux?  Also, the evidence prior seems to indicate that the problem occurs with more rows than columns, but just when the number of rows is only slightly bigger than the number of columns.  Maybe it is just a question of a guarantee - the returned V *could* be unitary, but is not claimed to be.\n\nThanks for the detective work on this one.",
    "created_at": "2011-04-26T16:59:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11248#issuecomment-112609",
    "user": "https://github.com/rbeezer"
}
```

<div id="comment:28" align="right">comment:28</div>

Karl - glad to see you found a machine to experiment with!

Jason - I'm following the discussion on the numpy list as well.  Nice work.

Question:  do we understand why this problem does not surface on new Macs, or on Linux?  Also, the evidence prior seems to indicate that the problem occurs with more rows than columns, but just when the number of rows is only slightly bigger than the number of columns.  Maybe it is just a question of a guarantee - the returned V *could* be unitary, but is not claimed to be.

Thanks for the detective work on this one.



---

archive/issue_comments_112610.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nA suggestion from the numpy-discussion list about installing Numpy on OSX 10.5 to test.  Maybe with a binary installer this is very easy to try?\n\n\"If it is an Accelerate bug it got fixed on OS X 10.6. Below is the\noutput with both current master and 1.5.1. It may be worth checking\nthis on 10.5 with the binary Numpy installer from Sourceforge to make\nsure it's not the Sage build process causing this somehow.\"\n\nThe output he mentions is a confirmation that everything is OK on OSX 10.6 (I believe).",
    "created_at": "2011-04-26T17:38:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11248#issuecomment-112610",
    "user": "https://github.com/rbeezer"
}
```

<div id="comment:29" align="right">comment:29</div>

A suggestion from the numpy-discussion list about installing Numpy on OSX 10.5 to test.  Maybe with a binary installer this is very easy to try?

"If it is an Accelerate bug it got fixed on OS X 10.6. Below is the
output with both current master and 1.5.1. It may be worth checking
this on 10.5 with the binary Numpy installer from Sourceforge to make
sure it's not the Sage build process causing this somehow."

The output he mentions is a confirmation that everything is OK on OSX 10.6 (I believe).



---

archive/issue_comments_112611.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nThis is easy to try, but I can't do it because my system Python is 2.3 (!) and their binaries only support 2.5, 2.6, and 2.7 on this platform.  I suppose it would be possible to build it using the Python in Sage, or by downloading a newer Python and using that, but this could be a lot of work.\n\nI think Dima P. and Francois B. have access to some 10.5 machines, as would Marshall H.  Maybe one of them can do it easily?\n\nSince it was the C example that failed, I assume that which Fortran compiler is used is irrelevant?  (Since we provide different Fortran for different Macs.)",
    "created_at": "2011-04-26T19:26:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11248#issuecomment-112611",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:30" align="right">comment:30</div>

This is easy to try, but I can't do it because my system Python is 2.3 (!) and their binaries only support 2.5, 2.6, and 2.7 on this platform.  I suppose it would be possible to build it using the Python in Sage, or by downloading a newer Python and using that, but this could be a lot of work.

I think Dima P. and Francois B. have access to some 10.5 machines, as would Marshall H.  Maybe one of them can do it easily?

Since it was the C example that failed, I assume that which Fortran compiler is used is irrelevant?  (Since we provide different Fortran for different Macs.)



---

archive/issue_comments_112612.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nReplying to [@kcrisman](#comment:30):\n> This is easy to try, but I can't do it because my system Python is 2.3 (!)\n\nOuch.\n\n> I think Dima P. and Francois B. have access to some 10.5 machines, as would Marshall H.  Maybe one of them can do it easily?\n\nAnd Sebastian or Samuel who have given good evidence above.",
    "created_at": "2011-04-26T19:40:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11248#issuecomment-112612",
    "user": "https://github.com/rbeezer"
}
```

<div id="comment:31" align="right">comment:31</div>

Replying to [@kcrisman](#comment:30):
> This is easy to try, but I can't do it because my system Python is 2.3 (!)

Ouch.

> I think Dima P. and Francois B. have access to some 10.5 machines, as would Marshall H.  Maybe one of them can do it easily?

And Sebastian or Samuel who have given good evidence above.



---

archive/issue_comments_112613.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nReplying to [@rbeezer](#comment:29):\n> A suggestion from the numpy-discussion list about installing Numpy on OSX 10.5 to test.  Maybe with a binary installer this is very easy to try?\n> \n> \"If it is an Accelerate bug it got fixed on OS X 10.6. Below is the\n> output with both current master and 1.5.1. It may be worth checking\n> this on 10.5 with the binary Numpy installer from Sourceforge to make\n> sure it's not the Sage build process causing this somehow.\"\n> \n> The output he mentions is a confirmation that everything is OK on OSX 10.6 (I believe).\n\nI've been testing on OSX 10.6, and I also don't get a zero row from calling zgesdd directly from C.  \n\nI don't think it's necessary to test numpy on 10.5.  You've already tested that lapack itself is returning a zero row, which is what we think the problem is.",
    "created_at": "2011-04-26T19:54:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11248#issuecomment-112613",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:32" align="right">comment:32</div>

Replying to [@rbeezer](#comment:29):
> A suggestion from the numpy-discussion list about installing Numpy on OSX 10.5 to test.  Maybe with a binary installer this is very easy to try?
> 
> "If it is an Accelerate bug it got fixed on OS X 10.6. Below is the
> output with both current master and 1.5.1. It may be worth checking
> this on 10.5 with the binary Numpy installer from Sourceforge to make
> sure it's not the Sage build process causing this somehow."
> 
> The output he mentions is a confirmation that everything is OK on OSX 10.6 (I believe).

I've been testing on OSX 10.6, and I also don't get a zero row from calling zgesdd directly from C.  

I don't think it's necessary to test numpy on 10.5.  You've already tested that lapack itself is returning a zero row, which is what we think the problem is.



---

archive/issue_comments_112614.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nReplying to [@kcrisman](#comment:30):\n> This is easy to try, but I can't do it because my system Python is 2.3 (!) and their binaries only support 2.5, 2.6, and 2.7 on this platform.  I suppose it would be possible to build it using the Python in Sage, or by downloading a newer Python and using that, but this could be a lot of work.\n> \n> I think Dima P. and Francois B. have access to some 10.5 machines, as would Marshall H.  Maybe one of them can do it easily?\n\nI can give it a try later today.",
    "created_at": "2011-04-26T21:48:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11248#issuecomment-112614",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:33" align="right">comment:33</div>

Replying to [@kcrisman](#comment:30):
> This is easy to try, but I can't do it because my system Python is 2.3 (!) and their binaries only support 2.5, 2.6, and 2.7 on this platform.  I suppose it would be possible to build it using the Python in Sage, or by downloading a newer Python and using that, but this could be a lot of work.
> 
> I think Dima P. and Francois B. have access to some 10.5 machines, as would Marshall H.  Maybe one of them can do it easily?

I can give it a try later today.



---

archive/issue_comments_112615.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nI posted to the lapack forum about this problem that we're seeing in the Accelerate framework and they asked for more details.  Can people that see this problem with the SVD provide the following after checking:\n\n1. Download the text to this example program to `test_zgesdd.c`: http://software.intel.com/sites/products/documentation/hpc/mkl/lapack/mkl_lapack_examples/zgesdd_ex.c.htm\n\n2. Apply the patch found at: http://pastebin.com/cv6ChT4V (raw patch here: http://pastebin.com/raw.php?i=cv6ChT4V )\n\n3. Compile and run:\n\n```\ngcc test_zgesdd.c -o test_zgesdd -framework Accelerate\n./test_zgesdd\n```\n\nAnd post the output here, along with the OSX version number, gcc version number, maybe the output of `uname -a`,\n\n```\nsw_vers\nxcodebuild -version \ngcc --version\nuname -a\n```",
    "created_at": "2011-04-28T11:44:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11248#issuecomment-112615",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:34" align="right">comment:34</div>

I posted to the lapack forum about this problem that we're seeing in the Accelerate framework and they asked for more details.  Can people that see this problem with the SVD provide the following after checking:

1. Download the text to this example program to `test_zgesdd.c`: http://software.intel.com/sites/products/documentation/hpc/mkl/lapack/mkl_lapack_examples/zgesdd_ex.c.htm

2. Apply the patch found at: http://pastebin.com/cv6ChT4V (raw patch here: http://pastebin.com/raw.php?i=cv6ChT4V )

3. Compile and run:

```
gcc test_zgesdd.c -o test_zgesdd -framework Accelerate
./test_zgesdd
```

And post the output here, along with the OSX version number, gcc version number, maybe the output of `uname -a`,

```
sw_vers
xcodebuild -version 
gcc --version
uname -a
```



---

archive/issue_comments_112616.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nFYI, here is the post to the lapack forum: http://icl.cs.utk.edu/lapack-forum/viewtopic.php?f=2&t=2402",
    "created_at": "2011-04-28T11:46:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11248#issuecomment-112616",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:35" align="right">comment:35</div>

FYI, here is the post to the lapack forum: http://icl.cs.utk.edu/lapack-forum/viewtopic.php?f=2&t=2402



---

archive/issue_comments_112617.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nReplying to [@jasongrout](#comment:34):\n\nJason,\n\nMy setup:\n\n```\n$ sw_vers\nProductName:\tMac OS X\nProductVersion:\t10.5.8\nBuildVersion:\t9L31a\n$ xcodebuild -version\nXcode 3.1.4\nComponent versions: DevToolsCore-1204.0; DevToolsSupport-1186.0\nBuildVersion: 9M2809\n$ gcc --version\ni686-apple-darwin9-gcc-4.2.1 (GCC) 4.2.1 (Apple Inc. build 5577)\nCopyright (C) 2007 Free Software Foundation, Inc.\nThis is free software; see the source for copying conditions.  There is NO\nwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n\n$ uname -a\nDarwin U 9.8.0 Darwin Kernel Version 9.8.0: Wed Jul 15 16:55:01 PDT 2009; root:xnu-1228.15.4~1/RELEASE_I386 i386\n```\n\n\nI downloaded the example program to `test_zgesdd.c`,\nsaved it in `~/Desktop/test`, saved the content of\nhttp://pastebin.com/raw.php?i=cv6ChT4V (adding a\nnewline at the end) to a file named `patch.patch`,\nand ran\n\n```\ncd ~/Desktop/test/\npatch < patch.patch\ngcc test_zgesdd.c -o test_zgesdd -framework Accelerate\n./test_zgesdd\n```\n\nOutput:\n\n```\n$ patch < patch.patch\npatching file test_zgesdd.c\n$ gcc test_zgesdd.c -o test_zgesdd -framework Accelerate\n$ ./test_zgesdd\n ZGESDD Example Program Results\n\n Original Matrix\n ( -5.400000000,  7.400000000) (  6.000000000,  6.380000000) (  9.910000000,  0.160000000) ( -5.280000000, -4.160000000)\n (  1.090000000,  1.550000000) (  2.600000000,  0.070000000) (  3.980000000, -5.260000000) (  2.030000000,  1.110000000)\n (  9.880000000,  1.910000000) (  4.920000000,  6.310000000) ( -2.110000000,  7.390000000) ( -9.810000000, -8.980000000)\n\n Singular values\n  21.755192792  16.595450169   3.973275762\n\n Left singular vectors (stored columnwise)\n (  0.547427636,  0.000000000) (  0.763021682,  0.000000000) ( -0.343687207,  0.000000000)\n ( -0.035076841, -0.151484384) (  0.270976798, -0.226375144) (  0.545726276, -0.743862082)\n (  0.812990162,  0.123256143) ( -0.523110953, -0.139566162) (  0.133575771, -0.113528196)\n\n Right singular vectors (stored rowwise)\n (  0.231605313,  0.206697957) (  0.365908960,  0.386461298) (  0.242593279,  0.328338539) ( -0.561339324, -0.372335466)\n ( -0.579119055,  0.403296993) (  0.109213979,  0.172424216) (  0.596738013, -0.274928122) (  0.159988103,  0.055108351)\n (  0.604200724,  0.123371344) ( -0.189887497,  0.297220678) (  0.392106353,  0.196976354) (  0.454514329,  0.310150370)\n (  0.000000000,  0.000000000) (  0.000000000,  0.000000000) (  0.000000000,  0.000000000) (  0.000000000,  0.000000000)\n\n Last row entries of Right singular vectors (stored rowwise) are zero?\n True   True   True   True  \n$ \n```\n\nSamuel",
    "created_at": "2011-04-28T12:23:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11248#issuecomment-112617",
    "user": "https://github.com/slel"
}
```

<div id="comment:36" align="right">comment:36</div>

Replying to [@jasongrout](#comment:34):

Jason,

My setup:

```
$ sw_vers
ProductName:	Mac OS X
ProductVersion:	10.5.8
BuildVersion:	9L31a
$ xcodebuild -version
Xcode 3.1.4
Component versions: DevToolsCore-1204.0; DevToolsSupport-1186.0
BuildVersion: 9M2809
$ gcc --version
i686-apple-darwin9-gcc-4.2.1 (GCC) 4.2.1 (Apple Inc. build 5577)
Copyright (C) 2007 Free Software Foundation, Inc.
This is free software; see the source for copying conditions.  There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.

$ uname -a
Darwin U 9.8.0 Darwin Kernel Version 9.8.0: Wed Jul 15 16:55:01 PDT 2009; root:xnu-1228.15.4~1/RELEASE_I386 i386
```


I downloaded the example program to `test_zgesdd.c`,
saved it in `~/Desktop/test`, saved the content of
http://pastebin.com/raw.php?i=cv6ChT4V (adding a
newline at the end) to a file named `patch.patch`,
and ran

```
cd ~/Desktop/test/
patch < patch.patch
gcc test_zgesdd.c -o test_zgesdd -framework Accelerate
./test_zgesdd
```

Output:

```
$ patch < patch.patch
patching file test_zgesdd.c
$ gcc test_zgesdd.c -o test_zgesdd -framework Accelerate
$ ./test_zgesdd
 ZGESDD Example Program Results

 Original Matrix
 ( -5.400000000,  7.400000000) (  6.000000000,  6.380000000) (  9.910000000,  0.160000000) ( -5.280000000, -4.160000000)
 (  1.090000000,  1.550000000) (  2.600000000,  0.070000000) (  3.980000000, -5.260000000) (  2.030000000,  1.110000000)
 (  9.880000000,  1.910000000) (  4.920000000,  6.310000000) ( -2.110000000,  7.390000000) ( -9.810000000, -8.980000000)

 Singular values
  21.755192792  16.595450169   3.973275762

 Left singular vectors (stored columnwise)
 (  0.547427636,  0.000000000) (  0.763021682,  0.000000000) ( -0.343687207,  0.000000000)
 ( -0.035076841, -0.151484384) (  0.270976798, -0.226375144) (  0.545726276, -0.743862082)
 (  0.812990162,  0.123256143) ( -0.523110953, -0.139566162) (  0.133575771, -0.113528196)

 Right singular vectors (stored rowwise)
 (  0.231605313,  0.206697957) (  0.365908960,  0.386461298) (  0.242593279,  0.328338539) ( -0.561339324, -0.372335466)
 ( -0.579119055,  0.403296993) (  0.109213979,  0.172424216) (  0.596738013, -0.274928122) (  0.159988103,  0.055108351)
 (  0.604200724,  0.123371344) ( -0.189887497,  0.297220678) (  0.392106353,  0.196976354) (  0.454514329,  0.310150370)
 (  0.000000000,  0.000000000) (  0.000000000,  0.000000000) (  0.000000000,  0.000000000) (  0.000000000,  0.000000000)

 Last row entries of Right singular vectors (stored rowwise) are zero?
 True   True   True   True  
$ 
```

Samuel



---

archive/issue_comments_112618.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nThanks!  I posted your information here: http://icl.cs.utk.edu/lapack-forum/viewtopic.php?f=2&t=2402&p=6794",
    "created_at": "2011-04-28T12:49:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11248#issuecomment-112618",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:37" align="right">comment:37</div>

Thanks!  I posted your information here: http://icl.cs.utk.edu/lapack-forum/viewtopic.php?f=2&t=2402&p=6794



---

archive/issue_comments_112619.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nFound this, but mostly it seems to describe much older versions.  There is something about LAPACK and thread safety, but tests would have been rerun by themselves, and I would expect more spurious behavior if that was the problem.  So I don't see much here, but for the record.\n\nhttp://developer.apple.com/hardwaredrivers/ve/errata.html",
    "created_at": "2011-04-28T22:03:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11248#issuecomment-112619",
    "user": "https://github.com/rbeezer"
}
```

<div id="comment:38" align="right">comment:38</div>

Found this, but mostly it seems to describe much older versions.  There is something about LAPACK and thread safety, but tests would have been rerun by themselves, and I would expect more spurious behavior if that was the problem.  So I don't see much here, but for the record.

http://developer.apple.com/hardwaredrivers/ve/errata.html



---

archive/issue_comments_112620.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nCan somebody here please review **blocker** ticket #11277 (Temporarily disable the failing SVD doctest until #11248 is fixed).",
    "created_at": "2011-04-30T16:57:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11248#issuecomment-112620",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:39" align="right">comment:39</div>

Can somebody here please review **blocker** ticket #11277 (Temporarily disable the failing SVD doctest until #11248 is fixed).



---

archive/issue_comments_112621.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nReplying to [@jdemeyer](#comment:39):\n> Can somebody here please review **blocker** ticket #11277 (Temporarily disable the failing SVD doctest until #11248 is fixed).\n\nDone.\n\nOnce this ticket is resolved, we need tests here to catch the problem (one we know what it is exactly).",
    "created_at": "2011-04-30T17:26:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11248#issuecomment-112621",
    "user": "https://github.com/rbeezer"
}
```

<div id="comment:40" align="right">comment:40</div>

Replying to [@jdemeyer](#comment:39):
> Can somebody here please review **blocker** ticket #11277 (Temporarily disable the failing SVD doctest until #11248 is fixed).

Done.

Once this ticket is resolved, we need tests here to catch the problem (one we know what it is exactly).



---

archive/issue_comments_112622.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nShould have added thanks to Jeroen for putting together the patch to cripple the failing doctest.",
    "created_at": "2011-04-30T17:27:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11248#issuecomment-112622",
    "user": "https://github.com/rbeezer"
}
```

<div id="comment:41" align="right">comment:41</div>

Should have added thanks to Jeroen for putting together the patch to cripple the failing doctest.



---

archive/issue_comments_112623.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nReplying to [@jasongrout](#comment:34):\n\n> And post the output here, along with the OSX version number, gcc version number, maybe the output of `uname -a`,\n\nI just tested and also get the last line of zeros.\n\nMy info:\n\n```\nslabbe@pol ~/Documents/Projets/11248/test $ sw_vers \nProductName:\tMac OS X\nProductVersion:\t10.5.8\nBuildVersion:\t9L31a\nslabbe@pol ~/Documents/Projets/11248/test $ xcodebuild -version\nXcode 3.1.4\nComponent versions: DevToolsCore-1204.0; DevToolsSupport-1186.0\nBuildVersion: 9M2809\nslabbe@pol ~/Documents/Projets/11248/test $ gcc --version\ni686-apple-darwin9-gcc-4.0.1 (GCC) 4.0.1 (Apple Inc. build 5493)\nCopyright (C) 2005 Free Software Foundation, Inc.\nThis is free software; see the source for copying conditions.  There is NO\nwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n\nslabbe@pol ~/Documents/Projets/11248/test $ uname -a\nDarwin pol 9.8.0 Darwin Kernel Version 9.8.0: Wed Jul 15 16:55:01 PDT 2009; root:xnu-1228.15.4~1/RELEASE_I386 i386\n```\n\nOutput :\n\n```\n$ patch < a.patch\n(Stripping trailing CRs from patch.)\npatching file test_zgesdd.c\n$ gcc test_zgesdd.c -o test_zgesdd -framework Accelerate\n$ ls\na.patch\t\ttest_zgesdd*\ttest_zgesdd.c\n$ ./test_zgesdd \n ZGESDD Example Program Results\n\n Original Matrix\n ( -5.400000000,  7.400000000) (  6.000000000,  6.380000000) (  9.910000000,  0.160000000) ( -5.280000000, -4.160000000)\n (  1.090000000,  1.550000000) (  2.600000000,  0.070000000) (  3.980000000, -5.260000000) (  2.030000000,  1.110000000)\n (  9.880000000,  1.910000000) (  4.920000000,  6.310000000) ( -2.110000000,  7.390000000) ( -9.810000000, -8.980000000)\n\n Singular values\n  21.755192792  16.595450169   3.973275762\n\n Left singular vectors (stored columnwise)\n (  0.547427636,  0.000000000) (  0.763021682,  0.000000000) ( -0.343687207,  0.000000000)\n ( -0.035076841, -0.151484384) (  0.270976798, -0.226375144) (  0.545726276, -0.743862082)\n (  0.812990162,  0.123256143) ( -0.523110953, -0.139566162) (  0.133575771, -0.113528196)\n\n Right singular vectors (stored rowwise)\n (  0.231605313,  0.206697957) (  0.365908960,  0.386461298) (  0.242593279,  0.328338539) ( -0.561339324, -0.372335466)\n ( -0.579119055,  0.403296993) (  0.109213979,  0.172424216) (  0.596738013, -0.274928122) (  0.159988103,  0.055108351)\n (  0.604200724,  0.123371344) ( -0.189887497,  0.297220678) (  0.392106353,  0.196976354) (  0.454514329,  0.310150370)\n (  0.000000000,  0.000000000) (  0.000000000,  0.000000000) (  0.000000000,  0.000000000) (  0.000000000,  0.000000000)\n\n Last row entries of Right singular vectors (stored rowwise) are zero?\n True   True   True   True  \n\n```\n\nS\u00e9bastien",
    "created_at": "2011-05-04T15:41:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11248#issuecomment-112623",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:42" align="right">comment:42</div>

Replying to [@jasongrout](#comment:34):

> And post the output here, along with the OSX version number, gcc version number, maybe the output of `uname -a`,

I just tested and also get the last line of zeros.

My info:

```
slabbe@pol ~/Documents/Projets/11248/test $ sw_vers 
ProductName:	Mac OS X
ProductVersion:	10.5.8
BuildVersion:	9L31a
slabbe@pol ~/Documents/Projets/11248/test $ xcodebuild -version
Xcode 3.1.4
Component versions: DevToolsCore-1204.0; DevToolsSupport-1186.0
BuildVersion: 9M2809
slabbe@pol ~/Documents/Projets/11248/test $ gcc --version
i686-apple-darwin9-gcc-4.0.1 (GCC) 4.0.1 (Apple Inc. build 5493)
Copyright (C) 2005 Free Software Foundation, Inc.
This is free software; see the source for copying conditions.  There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.

slabbe@pol ~/Documents/Projets/11248/test $ uname -a
Darwin pol 9.8.0 Darwin Kernel Version 9.8.0: Wed Jul 15 16:55:01 PDT 2009; root:xnu-1228.15.4~1/RELEASE_I386 i386
```

Output :

```
$ patch < a.patch
(Stripping trailing CRs from patch.)
patching file test_zgesdd.c
$ gcc test_zgesdd.c -o test_zgesdd -framework Accelerate
$ ls
a.patch		test_zgesdd*	test_zgesdd.c
$ ./test_zgesdd 
 ZGESDD Example Program Results

 Original Matrix
 ( -5.400000000,  7.400000000) (  6.000000000,  6.380000000) (  9.910000000,  0.160000000) ( -5.280000000, -4.160000000)
 (  1.090000000,  1.550000000) (  2.600000000,  0.070000000) (  3.980000000, -5.260000000) (  2.030000000,  1.110000000)
 (  9.880000000,  1.910000000) (  4.920000000,  6.310000000) ( -2.110000000,  7.390000000) ( -9.810000000, -8.980000000)

 Singular values
  21.755192792  16.595450169   3.973275762

 Left singular vectors (stored columnwise)
 (  0.547427636,  0.000000000) (  0.763021682,  0.000000000) ( -0.343687207,  0.000000000)
 ( -0.035076841, -0.151484384) (  0.270976798, -0.226375144) (  0.545726276, -0.743862082)
 (  0.812990162,  0.123256143) ( -0.523110953, -0.139566162) (  0.133575771, -0.113528196)

 Right singular vectors (stored rowwise)
 (  0.231605313,  0.206697957) (  0.365908960,  0.386461298) (  0.242593279,  0.328338539) ( -0.561339324, -0.372335466)
 ( -0.579119055,  0.403296993) (  0.109213979,  0.172424216) (  0.596738013, -0.274928122) (  0.159988103,  0.055108351)
 (  0.604200724,  0.123371344) ( -0.189887497,  0.297220678) (  0.392106353,  0.196976354) (  0.454514329,  0.310150370)
 (  0.000000000,  0.000000000) (  0.000000000,  0.000000000) (  0.000000000,  0.000000000) (  0.000000000,  0.000000000)

 Last row entries of Right singular vectors (stored rowwise) are zero?
 True   True   True   True  

```

Sébastien



---

archive/issue_events_147588.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11248#event-147588"
}
```



---

archive/issue_events_147589.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11248#event-147589"
}
```



---

archive/issue_events_147590.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11248#event-147590"
}
```



---

archive/issue_events_147591.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11248#event-147591"
}
```



---

archive/issue_events_147592.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11248#event-147592"
}
```



---

archive/issue_events_147593.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11248#event-147593"
}
```



---

archive/issue_events_147594.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11248#event-147594"
}
```



---

archive/issue_events_147595.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11248#event-147595"
}
```



---

archive/issue_events_147596.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-12-29T01:28:25Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11248",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11248#event-147596"
}
```
