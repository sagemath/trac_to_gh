# Issue 11200: Add fibration check to FanMorphism

archive/issues_011030.json:
```json
{
    "assignees": [
        "https://github.com/sagetrac-mhampton"
    ],
    "body": "The main point of this ticket was to add `FanMorphism.is_fibration` method, but along the way injectivity, surjectivity, and splitting were added as well.\n\nI have also added several related methods and adjusted containment/embedding methods of fans to accommodate sublattices and make their behaviour more uniform: now cone containment check is an attempt to embed the given cone into the fan.\n\nI have also started using `@cached_method` decorator since it is convenient and its speed and documentation issues should be resolved in the near future. Note, however, that some methods of fans still should use manual cache since they need to preprocess arguments first.\n\nDepends on #10140\nDepends on #10882\n\nCC:  @vbraun\n\nKeywords: **toric**\n\nComponent: **geometry**\n\nAuthor: **Andrey Novoseltsev**\n\nReviewer: **Volker Braun**\n\nMerged: **sage-4.7.1.alpha3**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/11200_\n\n",
    "closed_at": "2011-06-08T20:54:35Z",
    "created_at": "2011-04-14T18:35:18Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20geometry",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.7.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Add fibration check to FanMorphism",
    "type": "issue",
    "updated_at": "2011-06-08T20:54:35Z",
    "url": "https://github.com/sagemath/sage/issues/11200",
    "user": "https://github.com/novoselt"
}
```
The main point of this ticket was to add `FanMorphism.is_fibration` method, but along the way injectivity, surjectivity, and splitting were added as well.

I have also added several related methods and adjusted containment/embedding methods of fans to accommodate sublattices and make their behaviour more uniform: now cone containment check is an attempt to embed the given cone into the fan.

I have also started using `@cached_method` decorator since it is convenient and its speed and documentation issues should be resolved in the near future. Note, however, that some methods of fans still should use manual cache since they need to preprocess arguments first.

Depends on #10140
Depends on #10882

CC:  @vbraun

Keywords: **toric**

Component: **geometry**

Author: **Andrey Novoseltsev**

Reviewer: **Volker Braun**

Merged: **sage-4.7.1.alpha3**

_Issue created by migration from https://trac.sagemath.org/ticket/11200_





---

archive/issue_events_148912.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2011-04-14T18:35:18Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11200",
    "milestone_number": null,
    "milestone_title": "sage-4.7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11200#event-148912"
}
```



---

archive/issue_events_148913.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2011-04-14T18:35:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11200",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20geometry",
    "label_color": "0000ff",
    "label_name": "c: geometry",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11200#event-148913"
}
```



---

archive/issue_events_148914.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2011-04-14T18:35:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11200",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11200#event-148914"
}
```



---

archive/issue_events_148915.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2011-04-14T18:35:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11200",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11200#event-148915"
}
```



---

archive/issue_events_148916.json:
```json
{
    "actor": "https://github.com/sagetrac-mhampton",
    "created_at": "2011-04-14T18:35:18Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/11200",
    "subject": "https://github.com/novoselt",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11200#event-148916"
}
```



---

archive/issue_events_148917.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2011-04-14T18:40:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11200",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11200#event-148917"
}
```



---

archive/issue_comments_111730.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,5 +3,3 @@\n I have also added several related methods and adjusted containment/embedding methods of fans to accommodate sublattices and make their behaviour more uniform: now cone containment check is an attempt to embed the given cone into the fan.\n \n I have also started using `@cached_method` decorator since it is convenient and its speed and documentation issues should be resolved in the near future. Note, however, that some methods of fans still should use manual cache since they need to preprocess arguments first.\n-\n-Depends on #10882.\n``````\n",
    "created_at": "2011-04-24T19:18:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11200",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11200#issuecomment-111730",
    "user": "https://github.com/novoselt"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,5 +3,3 @@
 I have also added several related methods and adjusted containment/embedding methods of fans to accommodate sublattices and make their behaviour more uniform: now cone containment check is an attempt to embed the given cone into the fan.
 
 I have also started using `@cached_method` decorator since it is convenient and its speed and documentation issues should be resolved in the near future. Note, however, that some methods of fans still should use manual cache since they need to preprocess arguments first.
-
-Depends on #10882.
``````




---

archive/issue_comments_111731.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nRebased on top of new #10882.",
    "created_at": "2011-04-24T19:18:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11200",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11200#issuecomment-111731",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:2" align="right">comment:2</div>

Rebased on top of new #10882.



---

archive/issue_comments_111732.json:
```json
{
    "body": "Dependencies: **#10140, #10882**",
    "created_at": "2011-04-24T19:18:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11200",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11200#issuecomment-111732",
    "user": "https://github.com/novoselt"
}
```

Dependencies: **#10140, #10882**



---

archive/issue_comments_111733.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nI like the functionality, but you need to check surjectivity of the map of toric varieties, not just the map of vector spaces. The `is_surjective()` method should do that but is broken:\n\n```\nsage: P1 = toric_varieties.P1()\nsage: A1 = toric_varieties.A1()\nsage: phi = FanMorphism(matrix([[1]]), A1.fan(), P1.fan())\nsage: phi.is_fibration()\nTrue\nsage: phi.is_surjective()\nTrue\n```\nBut thats neither a fibration nor a surjective map.",
    "created_at": "2011-05-05T12:50:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11200",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11200#issuecomment-111733",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:3" align="right">comment:3</div>

I like the functionality, but you need to check surjectivity of the map of toric varieties, not just the map of vector spaces. The `is_surjective()` method should do that but is broken:

```
sage: P1 = toric_varieties.P1()
sage: A1 = toric_varieties.A1()
sage: phi = FanMorphism(matrix([[1]]), A1.fan(), P1.fan())
sage: phi.is_fibration()
True
sage: phi.is_surjective()
True
```
But thats neither a fibration nor a surjective map.



---

archive/issue_comments_111734.json:
```json
{
    "body": "Reviewer: **Volker Braun**",
    "created_at": "2011-05-05T12:50:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11200",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11200#issuecomment-111734",
    "user": "https://github.com/vbraun"
}
```

Reviewer: **Volker Braun**



---

archive/issue_events_148918.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-05-05T12:50:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11200",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11200#event-148918"
}
```



---

archive/issue_events_148919.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-05-05T12:50:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11200",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11200#event-148919"
}
```



---

archive/issue_comments_111735.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nHmmm, I thought that it does check support surjection, will look into it.\n\nAs for `is_surjective`, it is wrong because it is inherited. I will add an appropriate toric implementation to this patch.",
    "created_at": "2011-05-05T15:28:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11200",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11200#issuecomment-111735",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:5" align="right">comment:5</div>

Hmmm, I thought that it does check support surjection, will look into it.

As for `is_surjective`, it is wrong because it is inherited. I will add an appropriate toric implementation to this patch.



---

archive/issue_events_148920.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2011-05-07T04:50:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11200",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11200#event-148920"
}
```



---

archive/issue_events_148921.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2011-05-07T04:50:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11200",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11200#event-148921"
}
```



---

archive/issue_comments_111736.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nHi Volker,\n\nI fixed the mistake you have found and wrote `is_surjective`.\n\nWhile I am at it, I also started writing `is_injective`, but it is a bit trickier: we want the lattice map to have index one in the saturation of its image (in Sage, conveniently, `self.matrix().index_in_saturation() == 1`) and for every (primitive) cone `tau` mapped to `sigma` the dimension of `tau` must be the same as the dimension of the intersection of `sigma` with the image lattice of the lattice map. To make this easier and potentially simplify life in the future with computing fibers of generic fan/toric morphisms, I am thinking of adding the following methods:\n\n1. `image_lattice` to be the sublattice generated by the image of the domain lattice.\n2. `image_fan` to be the intersection of the codomain fan with the image lattice.\n3. `image_restriction` to be the fan morphism from the original domain fan to the newly defined image fan.\n\nQuestion: how should we name these methods? It seems to me that `image_lattice` fits nicely with `kernel_lattice`, but two others may be quite confusing/misleading, i.e. `image_fan` may refer to the image of the domain fan in the image lattice. One possible solution is not to implement such a method at all as it may be accessed via\n\n```\nphi.image_restriction().codomain_fan()\n```\nAny thoughts on this and the name for the `image_restriction` map?",
    "created_at": "2011-05-07T04:50:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11200",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11200#issuecomment-111736",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:6" align="right">comment:6</div>

Hi Volker,

I fixed the mistake you have found and wrote `is_surjective`.

While I am at it, I also started writing `is_injective`, but it is a bit trickier: we want the lattice map to have index one in the saturation of its image (in Sage, conveniently, `self.matrix().index_in_saturation() == 1`) and for every (primitive) cone `tau` mapped to `sigma` the dimension of `tau` must be the same as the dimension of the intersection of `sigma` with the image lattice of the lattice map. To make this easier and potentially simplify life in the future with computing fibers of generic fan/toric morphisms, I am thinking of adding the following methods:

1. `image_lattice` to be the sublattice generated by the image of the domain lattice.
2. `image_fan` to be the intersection of the codomain fan with the image lattice.
3. `image_restriction` to be the fan morphism from the original domain fan to the newly defined image fan.

Question: how should we name these methods? It seems to me that `image_lattice` fits nicely with `kernel_lattice`, but two others may be quite confusing/misleading, i.e. `image_fan` may refer to the image of the domain fan in the image lattice. One possible solution is not to implement such a method at all as it may be accessed via

```
phi.image_restriction().codomain_fan()
```
Any thoughts on this and the name for the `image_restriction` map?



---

archive/issue_comments_111737.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nUpdate: actually, just `image` already does what I called `image_lattice` above, there is also `kernel` that seems to do `kernel_lattice` job, so maybe `image/kernel` are sufficient. Then the only issue is `image_restriction`!",
    "created_at": "2011-05-07T04:55:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11200",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11200#issuecomment-111737",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:7" align="right">comment:7</div>

Update: actually, just `image` already does what I called `image_lattice` above, there is also `kernel` that seems to do `kernel_lattice` job, so maybe `image/kernel` are sufficient. Then the only issue is `image_restriction`!



---

archive/issue_comments_111738.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nAnd there is also `restrict_codomain`, similar in spirit, although I probably want to cache this special \"natural\" restriction.",
    "created_at": "2011-05-07T04:57:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11200",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11200#issuecomment-111738",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:8" align="right">comment:8</div>

And there is also `restrict_codomain`, similar in spirit, although I probably want to cache this special "natural" restriction.



---

archive/issue_comments_111739.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nSince our naming theme is to use `method()` for the inherited method on vector spaces and `method_fan()` for the induced function of the fan, how about `restrict_domain_fan()` and `restrict_codomain_fan()`. The restriction to the image would then be \n\n```\nphi.restrict_codomain_fan( phi.image_fan() )\n```\nFor the restriction of the vector space map you have to use this construction as well, I think; as far as I can tell there is no method that restricts to the image in one go.\n\nAlso, I don't think `image_fan()` is overly confusing. After all, the fan is a collection of cones over `\\QQ`.\n\nFor injectivity you need to check that the index of each domain cone is one (Def 2.1.7 in HLY). Are you going to override the `FanMorphism.index()` method? I would have thought that this is a logical place to put this functionality.",
    "created_at": "2011-05-07T10:22:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11200",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11200#issuecomment-111739",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:9" align="right">comment:9</div>

Since our naming theme is to use `method()` for the inherited method on vector spaces and `method_fan()` for the induced function of the fan, how about `restrict_domain_fan()` and `restrict_codomain_fan()`. The restriction to the image would then be 

```
phi.restrict_codomain_fan( phi.image_fan() )
```
For the restriction of the vector space map you have to use this construction as well, I think; as far as I can tell there is no method that restricts to the image in one go.

Also, I don't think `image_fan()` is overly confusing. After all, the fan is a collection of cones over `\QQ`.

For injectivity you need to check that the index of each domain cone is one (Def 2.1.7 in HLY). Are you going to override the `FanMorphism.index()` method? I would have thought that this is a logical place to put this functionality.



---

archive/issue_comments_111740.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nYes, `phi.index(sigma)` is the way to go, I think, but having these indices equal to 1 is not enough (and they are all 1 if the linear map has index one in its image saturation). We also need \"relative stars\" to be trivial, so that in the notation of Proposition 2.1.4 in HLY `\\tld{O}_\\sigma` is a 1-to-1 cover and `F_\\sigma^c` is a singleton.\n\nGoing back to names, I will try to be more careful in the future with checking inherited methods, but it seems to me now that\n* `kernel_lattice` should be removed since `kernel` computes exactly the same thing using generic code.\n* `image_lattice` should not be implemented since `phi.image().saturation()` does what I want and plane `image()` is also of interest in the toric setting. (Currently, saturation will not return a toric sublattice, but it is easy to fix.)\n\nFor the factoring of the fan morphism `phi: Sigma ---> Sigma'` we (always) have the following sequence of fan maps:\n\n```\nSigma0 --0--> Sigma --1--> Sigma1 --2--> Sigma2 --3--> Sigma'\n```\nwhere `Sigma0` is the kernel fan, `Sigma1` is `phi(Sigma)` living in `phi(N_RR) \\cap N'`, and `Sigma2` is `phi(N_RR) \\cap Sigma'`. Map 1 is easy to construct as\n\n```\nFanMorphism(phi.matrix(), phi.domain_fan(), phi.image().saturation())\n```\nMaps 2 and 3 are basically given by identity matrix but there is currently no \"one line way\" to construct `Sigma2` which I want to add. Now what I was referring to, is that both `Sigma1` and `Sigma2` are natural candidates to be called `image_fan` since they are fans in the image of `phi` and perhaps `Sigma1` is more natural since it is literally the image fan of `Sigma` under `phi`.\n\nSince \"general\" restrictions of `phi` to other fans can be easily done using `FanMorphism` constructor directly, I am not sure there is any need in adding special methods to restrict (co)domain to a provided fan. So I think I am in favor of adding only, say, `restrict_to_image()` with no arguments which will be the composition of maps 1 and 2 in the diagram. The main job of this function will be, of course, efficient construction of `Sigma2` and once it is done all maps of the sequence can be easily constructed if needed.\n\nSummary of the proposal:\n1. remove `kernel_lattice` and use inherited `kernel` instead;\n2. tweak `saturation` to make `phi.image().saturation()` to return a toric sublattice;\n3. add `restrict_to_image` returning the map `Sigma ---> Sigma2`;\n4. let `phi.index(sigma)` take a cone as an argument and return its index in the sense of HLY.\n\nSounds good?",
    "created_at": "2011-05-07T20:26:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11200",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11200#issuecomment-111740",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:10" align="right">comment:10</div>

Yes, `phi.index(sigma)` is the way to go, I think, but having these indices equal to 1 is not enough (and they are all 1 if the linear map has index one in its image saturation). We also need "relative stars" to be trivial, so that in the notation of Proposition 2.1.4 in HLY `\tld{O}_\sigma` is a 1-to-1 cover and `F_\sigma^c` is a singleton.

Going back to names, I will try to be more careful in the future with checking inherited methods, but it seems to me now that
* `kernel_lattice` should be removed since `kernel` computes exactly the same thing using generic code.
* `image_lattice` should not be implemented since `phi.image().saturation()` does what I want and plane `image()` is also of interest in the toric setting. (Currently, saturation will not return a toric sublattice, but it is easy to fix.)

For the factoring of the fan morphism `phi: Sigma ---> Sigma'` we (always) have the following sequence of fan maps:

```
Sigma0 --0--> Sigma --1--> Sigma1 --2--> Sigma2 --3--> Sigma'
```
where `Sigma0` is the kernel fan, `Sigma1` is `phi(Sigma)` living in `phi(N_RR) \cap N'`, and `Sigma2` is `phi(N_RR) \cap Sigma'`. Map 1 is easy to construct as

```
FanMorphism(phi.matrix(), phi.domain_fan(), phi.image().saturation())
```
Maps 2 and 3 are basically given by identity matrix but there is currently no "one line way" to construct `Sigma2` which I want to add. Now what I was referring to, is that both `Sigma1` and `Sigma2` are natural candidates to be called `image_fan` since they are fans in the image of `phi` and perhaps `Sigma1` is more natural since it is literally the image fan of `Sigma` under `phi`.

Since "general" restrictions of `phi` to other fans can be easily done using `FanMorphism` constructor directly, I am not sure there is any need in adding special methods to restrict (co)domain to a provided fan. So I think I am in favor of adding only, say, `restrict_to_image()` with no arguments which will be the composition of maps 1 and 2 in the diagram. The main job of this function will be, of course, efficient construction of `Sigma2` and once it is done all maps of the sequence can be easily constructed if needed.

Summary of the proposal:
1. remove `kernel_lattice` and use inherited `kernel` instead;
2. tweak `saturation` to make `phi.image().saturation()` to return a toric sublattice;
3. add `restrict_to_image` returning the map `Sigma ---> Sigma2`;
4. let `phi.index(sigma)` take a cone as an argument and return its index in the sense of HLY.

Sounds good?



---

archive/issue_comments_111741.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nUpdate: 1 and 2 are easy and done, 3 is in principle also easy and done, but it does not yet work due to sublattice handling. So I am working on improving it. Ideally I want to be able to do in sublattices and quotient lattices everything that can be done in the ambient ones. Several steps in this direction were already done, this patch will make a few more ;-)",
    "created_at": "2011-05-17T05:32:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11200",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11200#issuecomment-111741",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:11" align="right">comment:11</div>

Update: 1 and 2 are easy and done, 3 is in principle also easy and done, but it does not yet work due to sublattice handling. So I am working on improving it. Ideally I want to be able to do in sublattices and quotient lattices everything that can be done in the ambient ones. Several steps in this direction were already done, this patch will make a few more ;-)



---

archive/issue_comments_111742.json:
```json
{
    "body": "Work Issues: **sublattice duals and action**",
    "created_at": "2011-05-17T05:32:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11200",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11200#issuecomment-111742",
    "user": "https://github.com/novoselt"
}
```

Work Issues: **sublattice duals and action**



---

archive/issue_comments_111743.json:
```json
{
    "body": "Changed work issues from **sublattice duals and action** to none",
    "created_at": "2011-05-18T21:41:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11200",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11200#issuecomment-111743",
    "user": "https://github.com/novoselt"
}
```

Changed work issues from **sublattice duals and action** to none



---

archive/issue_comments_111744.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-The main point of this ticket is to add `FanMorphism.is_fibration` method.\n+The main point of this ticket was to add `FanMorphism.is_fibration` method, but along the way injectivity, surjectivity, and splitting were added as well.\n \n I have also added several related methods and adjusted containment/embedding methods of fans to accommodate sublattices and make their behaviour more uniform: now cone containment check is an attempt to embed the given cone into the fan.\n \n``````\n",
    "created_at": "2011-05-18T21:41:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11200",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11200#issuecomment-111744",
    "user": "https://github.com/novoselt"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-The main point of this ticket is to add `FanMorphism.is_fibration` method.
+The main point of this ticket was to add `FanMorphism.is_fibration` method, but along the way injectivity, surjectivity, and splitting were added as well.
 
 I have also added several related methods and adjusted containment/embedding methods of fans to accommodate sublattices and make their behaviour more uniform: now cone containment check is an attempt to embed the given cone into the fan.
 
``````




---

archive/issue_comments_111745.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nOK, I propose this version for inclusion. I did not add `index(cone)` functionality as it is not necessary for the current methods and it would make sense only for those morphisms whose vector space map is surjective (there should be perhaps another `is_xxx` method to test for this, but I am not sure how to call it - `is_dense`?). Besides, someone else is likely to work on further description of fan morphism fibers and it will be a nice exercise to add cone indices ;-)\n\nI made a small change to `free_module`, but didn't yet test consequences on the whole library. I'll do it today and will fix any problems if there are any.",
    "created_at": "2011-05-18T21:41:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11200",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11200#issuecomment-111745",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:12" align="right">comment:12</div>

OK, I propose this version for inclusion. I did not add `index(cone)` functionality as it is not necessary for the current methods and it would make sense only for those morphisms whose vector space map is surjective (there should be perhaps another `is_xxx` method to test for this, but I am not sure how to call it - `is_dense`?). Besides, someone else is likely to work on further description of fan morphism fibers and it will be a nice exercise to add cone indices ;-)

I made a small change to `free_module`, but didn't yet test consequences on the whole library. I'll do it today and will fix any problems if there are any.



---

archive/issue_events_148922.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2011-05-18T21:41:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11200",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11200#event-148922"
}
```



---

archive/issue_events_148923.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2011-05-18T21:41:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11200",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11200#event-148923"
}
```



---

archive/issue_comments_111746.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nFixed a couple of typos in the documentation and removed \"not tested\" comment in the `kernel_fan` as it is now possible to construct its cone lattice.",
    "created_at": "2011-05-18T23:06:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11200",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11200#issuecomment-111746",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:13" align="right">comment:13</div>

Fixed a couple of typos in the documentation and removed "not tested" comment in the `kernel_fan` as it is now possible to construct its cone lattice.



---

archive/issue_comments_111747.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nWhile patchbot made a complete streetlight thinking that this patch get worse and worse, direct testing shows that all long tests pass on top of sage-4.7.rc2 with dependencies applied!",
    "created_at": "2011-05-19T00:23:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11200",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11200#issuecomment-111747",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:14" align="right">comment:14</div>

While patchbot made a complete streetlight thinking that this patch get worse and worse, direct testing shows that all long tests pass on top of sage-4.7.rc2 with dependencies applied!



---

archive/issue_comments_111748.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nLooks all good to me.\n\nJust a minor nitpick: I think that `is_splitting()` is very unintuitive. Does anyone besides HLY use that notation? How about we rename it to `is_bundle()` or at least make an alias?",
    "created_at": "2011-05-28T01:28:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11200",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11200#issuecomment-111748",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:15" align="right">comment:15</div>

Looks all good to me.

Just a minor nitpick: I think that `is_splitting()` is very unintuitive. Does anyone besides HLY use that notation? How about we rename it to `is_bundle()` or at least make an alias?



---

archive/issue_comments_111749.json:
```json
{
    "body": "Work Issues: **splitting ---> bundle**",
    "created_at": "2011-05-28T01:40:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11200",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11200#issuecomment-111749",
    "user": "https://github.com/novoselt"
}
```

Work Issues: **splitting ---> bundle**



---

archive/issue_comments_111750.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nThat was actually from \"Toric Varieties\" book. But I like `is_bundle` more, so I'll change it. Thanks for the suggestion!",
    "created_at": "2011-05-28T01:40:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11200",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11200#issuecomment-111750",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:16" align="right">comment:16</div>

That was actually from "Toric Varieties" book. But I like `is_bundle` more, so I'll change it. Thanks for the suggestion!



---

archive/issue_events_148924.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2011-05-28T01:40:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11200",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11200#event-148924"
}
```



---

archive/issue_events_148925.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2011-05-28T01:40:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11200",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11200#event-148925"
}
```



---

archive/issue_comments_111751.json:
```json
{
    "body": "Changed work issues from **splitting ---> bundle** to none",
    "created_at": "2011-05-28T02:19:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11200",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11200#issuecomment-111751",
    "user": "https://github.com/novoselt"
}
```

Changed work issues from **splitting ---> bundle** to none



---

archive/issue_comments_111752.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nDone!",
    "created_at": "2011-05-28T02:19:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11200",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11200#issuecomment-111752",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:17" align="right">comment:17</div>

Done!



---

archive/issue_events_148926.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2011-05-28T02:19:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11200",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11200#event-148926"
}
```



---

archive/issue_events_148927.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2011-05-28T02:19:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11200",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11200#event-148927"
}
```



---

archive/issue_comments_111753.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nNice!\n\nThe patch buildbot is confused about which patches from the dependency #10140 need to be applied. I tried to help the patch buildbot to figure it out but without success. All doctest pass on my machine.",
    "created_at": "2011-05-28T16:08:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11200",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11200#issuecomment-111753",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:18" align="right">comment:18</div>

Nice!

The patch buildbot is confused about which patches from the dependency #10140 need to be applied. I tried to help the patch buildbot to figure it out but without success. All doctest pass on my machine.



---

archive/issue_events_148928.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-05-28T16:08:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11200",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11200#event-148928"
}
```



---

archive/issue_events_148929.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-05-28T16:08:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11200",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11200#event-148929"
}
```



---

archive/issue_comments_111754.json:
```json
{
    "body": "Changed dependencies from **#10140, #10882** to **#10140, #10882, #9128**",
    "created_at": "2011-05-28T20:09:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11200",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11200#issuecomment-111754",
    "user": "https://github.com/vbraun"
}
```

Changed dependencies from **#10140, #10882** to **#10140, #10882, #9128**



---

archive/issue_comments_111755.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nThe documentation makes use of `:trac:...` sphinx tags and therefore depends on #9128.",
    "created_at": "2011-05-28T20:09:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11200",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11200#issuecomment-111755",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:19" align="right">comment:19</div>

The documentation makes use of `:trac:...` sphinx tags and therefore depends on #9128.



---

archive/issue_comments_111756.json:
```json
{
    "body": "Changed dependencies from **#10140, #10882, #9128** to **#10140, #10882**",
    "created_at": "2011-05-28T21:14:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11200",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11200#issuecomment-111756",
    "user": "https://github.com/novoselt"
}
```

Changed dependencies from **#10140, #10882, #9128** to **#10140, #10882**



---

archive/issue_comments_111757.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nAttachment: **[trac_11200_Add_fibration_check_to_FanMorphism.patch.gz](https://github.com/sagemath/sage/files/ticket11200/trac_11200_Add_fibration_check_to_FanMorphism.patch.gz)**\n\nNot anymore :-(\n\n#9128 has been around for a while and it has further dependencies, I'd rather not delay this ticket till they all are resolved...",
    "created_at": "2011-05-28T21:14:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11200",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11200#issuecomment-111757",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:20" align="right">comment:20</div>

Attachment: **[trac_11200_Add_fibration_check_to_FanMorphism.patch.gz](https://github.com/sagemath/sage/files/ticket11200/trac_11200_Add_fibration_check_to_FanMorphism.patch.gz)**

Not anymore :-(

#9128 has been around for a while and it has further dependencies, I'd rather not delay this ticket till they all are resolved...



---

archive/issue_comments_111758.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nGreat, ready to be included in any 4.7.1.alpha now!",
    "created_at": "2011-05-28T22:15:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11200",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11200#issuecomment-111758",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:21" align="right">comment:21</div>

Great, ready to be included in any 4.7.1.alpha now!



---

archive/issue_events_148930.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-06-08T20:54:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11200",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11200#event-148930"
}
```



---

archive/issue_events_148931.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-06-08T20:54:35Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/11200",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11200#event-148931"
}
```



---

archive/issue_comments_111759.json:
```json
{
    "body": "Merged: **sage-4.7.1.alpha3**",
    "created_at": "2011-06-08T20:54:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11200",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11200#issuecomment-111759",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-4.7.1.alpha3**
