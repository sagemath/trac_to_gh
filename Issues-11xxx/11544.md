# Issue 11544: Viewing matrices of algebraic numbers can take a long time

archive/issues_011372.json:
```json
{
    "body": "The following code leads to about a one minute hang for me (reproducibly in a fresh session).  Keshav Kini (via IRC) had the same experience.\n\n```\nsage: A = matrix(QQ, 4, 4, [1, 2, -2, 2, 1, 0, -1, -1, 0, -1, 1, 1, -1, 2, 1/2, 0])\nsage: e = A.eigenvalues()[3]\nsage: K = (A-e).kernel()\nsage: P = K.basis_matrix()\nsage: x = P.list()[3]\nsage: remap = {}\nsage: remap.has_key(x)\n```\n\nThis behavior hangs the creation of a string version of a matrix.  If you comment-out `sage/matrix/matrix0.pyx` at lines 1695-1696, the problem goes away.  To see the effect, run the first four lines of the code above and then just print P, with and without the two lines mentioned.\n\nI have a workaround in mind that may solve the problem in many cases.  Root issue is at #11543.\n\n**Apply:**\n1. [attachment:trac_11544-avoid-hash-of-matrix-entries-v2.patch]\n\n\nAssignee: jason, was\n\nResolution: fixed\n\nAuthor: Rob Beezer\n\nReviewer: Martin Raum\n\nMerged: sage-4.7.2.alpha3\n\nIssue created by migration from https://trac.sagemath.org/ticket/11544\n\n",
    "closed_at": "2011-09-17T04:53:04Z",
    "created_at": "2011-06-25T06:32:03Z",
    "labels": [
        "component: linear algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7.2",
    "title": "Viewing matrices of algebraic numbers can take a long time",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11544",
    "user": "https://github.com/rbeezer"
}
```
The following code leads to about a one minute hang for me (reproducibly in a fresh session).  Keshav Kini (via IRC) had the same experience.

```
sage: A = matrix(QQ, 4, 4, [1, 2, -2, 2, 1, 0, -1, -1, 0, -1, 1, 1, -1, 2, 1/2, 0])
sage: e = A.eigenvalues()[3]
sage: K = (A-e).kernel()
sage: P = K.basis_matrix()
sage: x = P.list()[3]
sage: remap = {}
sage: remap.has_key(x)
```

This behavior hangs the creation of a string version of a matrix.  If you comment-out `sage/matrix/matrix0.pyx` at lines 1695-1696, the problem goes away.  To see the effect, run the first four lines of the code above and then just print P, with and without the two lines mentioned.

I have a workaround in mind that may solve the problem in many cases.  Root issue is at #11543.

**Apply:**
1. [attachment:trac_11544-avoid-hash-of-matrix-entries-v2.patch]


Assignee: jason, was

Resolution: fixed

Author: Rob Beezer

Reviewer: Martin Raum

Merged: sage-4.7.2.alpha3

Issue created by migration from https://trac.sagemath.org/ticket/11544





---

archive/issue_comments_132776.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -6,7 +6,6 @@\n sage: K = (A-e).kernel()\n sage: P = K.basis_matrix()\n sage: x = P.list()[3]\n-sage: hash(x)\n sage: remap = {}\n sage: remap.has_key(x)\n ```\n@@ -15,6 +14,7 @@\n \n I have a workaround in mind that may solve the problem in many cases.  Root issue is at #11543.\n \n+\n Comment: 1\n \n Issue created by migration from https://trac.sagemath.org/ticket/11544\n```\n",
    "created_at": "2011-06-25T07:58:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11544",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11544#issuecomment-132776",
    "user": "https://github.com/rbeezer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -6,7 +6,6 @@
 sage: K = (A-e).kernel()
 sage: P = K.basis_matrix()
 sage: x = P.list()[3]
-sage: hash(x)
 sage: remap = {}
 sage: remap.has_key(x)
 ```
@@ -15,6 +14,7 @@
 
 I have a workaround in mind that may solve the problem in many cases.  Root issue is at #11543.
 
+
 Comment: 1
 
 Issue created by migration from https://trac.sagemath.org/ticket/11544
```




---

archive/issue_comments_132777.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-06-25T14:45:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11544",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11544#issuecomment-132777",
    "user": "https://github.com/rbeezer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_132778.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,21 @@\n+The following code leads to about a one minute hang for me (reproducibly in a fresh session).  Keshav Kini (via IRC) had the same experience.\n+\n+```\n+sage: A = matrix(QQ, 4, 4, [1, 2, -2, 2, 1, 0, -1, -1, 0, -1, 1, 1, -1, 2, 1/2, 0])\n+sage: e = A.eigenvalues()[3]\n+sage: K = (A-e).kernel()\n+sage: P = K.basis_matrix()\n+sage: x = P.list()[3]\n+sage: remap = {}\n+sage: remap.has_key(x)\n+```\n+\n+This behavior hangs the creation of a string version of a matrix.  If you comment-out `sage/matrix/matrix0.pyx` at lines 1695-1696, the problem goes away.  To see the effect, run the first four lines of the code above and then just print P, with and without the two lines mentioned.\n+\n+I have a workaround in mind that may solve the problem in many cases.  Root issue is at #11543.\n+\n+**Apply:**\n+1. [attachment:trac_11544-avoid-hash-of-matrix-entries.patch]\n \n \n Comment: 1\n```\n",
    "created_at": "2011-06-25T14:45:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11544",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11544#issuecomment-132778",
    "user": "https://github.com/rbeezer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,21 @@
+The following code leads to about a one minute hang for me (reproducibly in a fresh session).  Keshav Kini (via IRC) had the same experience.
+
+```
+sage: A = matrix(QQ, 4, 4, [1, 2, -2, 2, 1, 0, -1, -1, 0, -1, 1, 1, -1, 2, 1/2, 0])
+sage: e = A.eigenvalues()[3]
+sage: K = (A-e).kernel()
+sage: P = K.basis_matrix()
+sage: x = P.list()[3]
+sage: remap = {}
+sage: remap.has_key(x)
+```
+
+This behavior hangs the creation of a string version of a matrix.  If you comment-out `sage/matrix/matrix0.pyx` at lines 1695-1696, the problem goes away.  To see the effect, run the first four lines of the code above and then just print P, with and without the two lines mentioned.
+
+I have a workaround in mind that may solve the problem in many cases.  Root issue is at #11543.
+
+**Apply:**
+1. [attachment:trac_11544-avoid-hash-of-matrix-entries.patch]
 
 
 Comment: 1
```




---

archive/issue_comments_132779.json:
```json
{
    "body": "<a id='comment:2'></a>Attachment [trac_11544-avoid-hash-of-matrix-entries.patch](tarball://root/attachments/some-uuid/ticket11544/trac_11544-avoid-hash-of-matrix-entries.patch) by @rbeezer created at 2011-06-25 14:45:07",
    "created_at": "2011-06-25T14:45:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11544",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11544#issuecomment-132779",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:2'></a>Attachment [trac_11544-avoid-hash-of-matrix-entries.patch](tarball://root/attachments/some-uuid/ticket11544/trac_11544-avoid-hash-of-matrix-entries.patch) by @rbeezer created at 2011-06-25 14:45:07



---

archive/issue_comments_132780.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-06-26T03:51:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11544",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11544#issuecomment-132780",
    "user": "https://github.com/rbeezer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_132781.json:
```json
{
    "body": "<a id='comment:3'></a>I tested this for speed, but forgot to do even minimal doctests.\n\nIt affects a lot of QQbar output in minor ways, so several doctests need fixing.",
    "created_at": "2011-06-26T03:51:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11544",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11544#issuecomment-132781",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:3'></a>I tested this for speed, but forgot to do even minimal doctests.

It affects a lot of QQbar output in minor ways, so several doctests need fixing.



---

archive/issue_comments_132782.json:
```json
{
    "body": "Attachment [trac_11544-avoid-hash-of-matrix-entries-v2.patch](tarball://root/attachments/some-uuid/ticket11544/trac_11544-avoid-hash-of-matrix-entries-v2.patch) by @rbeezer created at 2011-07-11 23:07:47",
    "created_at": "2011-07-11T23:07:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11544",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11544#issuecomment-132782",
    "user": "https://github.com/rbeezer"
}
```

Attachment [trac_11544-avoid-hash-of-matrix-entries-v2.patch](tarball://root/attachments/some-uuid/ticket11544/trac_11544-avoid-hash-of-matrix-entries-v2.patch) by @rbeezer created at 2011-07-11 23:07:47



---

archive/issue_comments_132783.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,21 @@\n+The following code leads to about a one minute hang for me (reproducibly in a fresh session).  Keshav Kini (via IRC) had the same experience.\n+\n+```\n+sage: A = matrix(QQ, 4, 4, [1, 2, -2, 2, 1, 0, -1, -1, 0, -1, 1, 1, -1, 2, 1/2, 0])\n+sage: e = A.eigenvalues()[3]\n+sage: K = (A-e).kernel()\n+sage: P = K.basis_matrix()\n+sage: x = P.list()[3]\n+sage: remap = {}\n+sage: remap.has_key(x)\n+```\n+\n+This behavior hangs the creation of a string version of a matrix.  If you comment-out `sage/matrix/matrix0.pyx` at lines 1695-1696, the problem goes away.  To see the effect, run the first four lines of the code above and then just print P, with and without the two lines mentioned.\n+\n+I have a workaround in mind that may solve the problem in many cases.  Root issue is at #11543.\n+\n+**Apply:**\n+1. [attachment:trac_11544-avoid-hash-of-matrix-entries-v2.patch]\n \n \n Comment: 1\n```\n",
    "created_at": "2011-07-11T23:11:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11544",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11544#issuecomment-132783",
    "user": "https://github.com/rbeezer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,21 @@
+The following code leads to about a one minute hang for me (reproducibly in a fresh session).  Keshav Kini (via IRC) had the same experience.
+
+```
+sage: A = matrix(QQ, 4, 4, [1, 2, -2, 2, 1, 0, -1, -1, 0, -1, 1, 1, -1, 2, 1/2, 0])
+sage: e = A.eigenvalues()[3]
+sage: K = (A-e).kernel()
+sage: P = K.basis_matrix()
+sage: x = P.list()[3]
+sage: remap = {}
+sage: remap.has_key(x)
+```
+
+This behavior hangs the creation of a string version of a matrix.  If you comment-out `sage/matrix/matrix0.pyx` at lines 1695-1696, the problem goes away.  To see the effect, run the first four lines of the code above and then just print P, with and without the two lines mentioned.
+
+I have a workaround in mind that may solve the problem in many cases.  Root issue is at #11543.
+
+**Apply:**
+1. [attachment:trac_11544-avoid-hash-of-matrix-entries-v2.patch]
 
 
 Comment: 1
```




---

archive/issue_comments_132784.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-07-11T23:11:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11544",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11544#issuecomment-132784",
    "user": "https://github.com/rbeezer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_132785.json:
```json
{
    "body": "<a id='comment:4'></a>v2 patch includes doctest fixes.\n\nJust one line of code changes in sage/matrix/matrix0.pyx, the rest is documentation.\n\nPrevious behavior was to hash entries while printing, this caused the precision of an entry to increase, thus slightly greater precision in subsequent computed (printed) results.",
    "created_at": "2011-07-11T23:11:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11544",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11544#issuecomment-132785",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:4'></a>v2 patch includes doctest fixes.

Just one line of code changes in sage/matrix/matrix0.pyx, the rest is documentation.

Previous behavior was to hash entries while printing, this caused the precision of an entry to increase, thus slightly greater precision in subsequent computed (printed) results.



---

archive/issue_comments_132786.json:
```json
{
    "body": "<a id='comment:5'></a>This probably needs a bit more explanation.\n\nOne feature of #10627 is to replace specific matrix entries by a symbol.  To look up this translation in a dictionary, entries of a matrix are hashed.  For QQbar, this hash is expensive (#11543).\n\nThis patch prevents a look-up if the translation dictionary is empty.",
    "created_at": "2011-07-12T00:46:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11544",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11544#issuecomment-132786",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:5'></a>This probably needs a bit more explanation.

One feature of #10627 is to replace specific matrix entries by a symbol.  To look up this translation in a dictionary, entries of a matrix are hashed.  For QQbar, this hash is expensive (#11543).

This patch prevents a look-up if the translation dictionary is empty.



---

archive/issue_comments_132787.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-08-06T19:28:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11544",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11544#issuecomment-132787",
    "user": "https://trac.sagemath.org/admin/accounts/users/mraum"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_132788.json:
```json
{
    "body": "<a id='comment:6'></a>This gets a positive review as is.",
    "created_at": "2011-08-06T19:28:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11544",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11544#issuecomment-132788",
    "user": "https://trac.sagemath.org/admin/accounts/users/mraum"
}
```

<a id='comment:6'></a>This gets a positive review as is.



---

archive/issue_comments_132789.json:
```json
{
    "body": "<a id='comment:7'></a>Thanks, again!",
    "created_at": "2011-08-11T05:07:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11544",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11544#issuecomment-132789",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:7'></a>Thanks, again!



---

archive/issue_comments_132790.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-09-17T04:53:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11544",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11544#issuecomment-132790",
    "user": "https://github.com/nexttime"
}
```

Resolution: fixed



---

archive/issue_events_030202.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-09-17T04:53:04Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11544",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11544#event-30202"
}
```
