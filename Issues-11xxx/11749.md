# Issue 11749: Remove unneeded imports

archive/issues_011577.json:
```json
{
    "assignees": [],
    "body": "As a first step in simplifying the import hierarchy, remove obviously unused imports.\n\n---\n\nThe patch below is the result of applying Robert's original patch (which was based on Sage 4.7.1) to the (presumably) final version of Sage 4.7.2.alpha3, ignoring rejects, and with some manual corrections due to afterwards occurring import errors when trying to start up Sage or running `ptestlong`.\n\nThe current omissions will be dealt with on follow-up tickets.\n\n---\n\nApply only [attachment:trac_11749-remove_unneeded_imports-rebased_on_4.7.2.alpha3.reviewer.patch](https://github.com/sagemath/sage/files/ticket11749/trac_11749-remove_unneeded_imports-rebased_on_4.7.2.alpha3.reviewer.patch) to the Sage library.\n\n\n**CC:**  @nexttime @koffie\n\n**Author:** Robert Bradshaw\n\n**Reviewer:** Keshav Kini, Leif Leonhardy\n\n**Merged:** sage-4.7.2.alpha3\n\nIssue created by migration from https://trac.sagemath.org/ticket/11749\n\n",
    "closed_at": "2011-09-17T05:36:33Z",
    "created_at": "2011-08-26T06:17:23Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20performance",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.7.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Remove unneeded imports",
    "type": "issue",
    "updated_at": "2011-11-08T13:14:35Z",
    "url": "https://github.com/sagemath/sage/issues/11749",
    "user": "https://github.com/robertwb"
}
```
As a first step in simplifying the import hierarchy, remove obviously unused imports.

---

The patch below is the result of applying Robert's original patch (which was based on Sage 4.7.1) to the (presumably) final version of Sage 4.7.2.alpha3, ignoring rejects, and with some manual corrections due to afterwards occurring import errors when trying to start up Sage or running `ptestlong`.

The current omissions will be dealt with on follow-up tickets.

---

Apply only [attachment:trac_11749-remove_unneeded_imports-rebased_on_4.7.2.alpha3.reviewer.patch](https://github.com/sagemath/sage/files/ticket11749/trac_11749-remove_unneeded_imports-rebased_on_4.7.2.alpha3.reviewer.patch) to the Sage library.


**CC:**  @nexttime @koffie

**Author:** Robert Bradshaw

**Reviewer:** Keshav Kini, Leif Leonhardy

**Merged:** sage-4.7.2.alpha3

Issue created by migration from https://trac.sagemath.org/ticket/11749





---

archive/issue_events_133098.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2011-08-26T06:17:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "milestone_number": null,
    "milestone_title": "sage-4.7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11749#event-133098"
}
```



---

archive/issue_events_133099.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2011-08-26T06:17:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20performance",
    "label_color": "08517b",
    "label_name": "component: performance",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11749#event-133099"
}
```



---

archive/issue_events_133100.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2011-08-26T06:17:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "008080",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11749#event-133100"
}
```



---

archive/issue_events_133101.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2011-08-26T06:58:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11749#event-133101"
}
```



---

archive/issue_comments_124311.json:
```json
{
    "body": "<a id='comment:1'></a>\n**Attachment:** [11749-unneeded-imports.patch.gz](https://github.com/sagemath/sage/files/ticket11749/11749-unneeded-imports.patch.gz)",
    "created_at": "2011-08-26T06:58:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124311",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:1'></a>
**Attachment:** [11749-unneeded-imports.patch.gz](https://github.com/sagemath/sage/files/ticket11749/11749-unneeded-imports.patch.gz)



---

archive/issue_comments_124312.json:
```json
{
    "body": "<a id='comment:2'></a>\nI'm ptestlonging this on sage.math right now.",
    "created_at": "2011-08-26T06:59:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124312",
    "user": "https://github.com/kini"
}
```

<a id='comment:2'></a>
I'm ptestlonging this on sage.math right now.



---

archive/issue_comments_124313.json:
```json
{
    "body": "<a id='comment:3'></a>\nIncidentally how did you generate this patch?",
    "created_at": "2011-08-26T07:26:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124313",
    "user": "https://github.com/kini"
}
```

<a id='comment:3'></a>
Incidentally how did you generate this patch?



---

archive/issue_comments_124314.json:
```json
{
    "body": "**Author:** Robert Bradshaw",
    "created_at": "2011-08-26T07:50:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124314",
    "user": "https://github.com/kini"
}
```

**Author:** Robert Bradshaw



---

archive/issue_comments_124315.json:
```json
{
    "body": "<a id='comment:4'></a>\nptestlong passes! Before I mark this positive review I would like to know how you generated the patch, though. Just tracing imports and finding those which are not used?",
    "created_at": "2011-08-26T07:50:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124315",
    "user": "https://github.com/kini"
}
```

<a id='comment:4'></a>
ptestlong passes! Before I mark this positive review I would like to know how you generated the patch, though. Just tracing imports and finding those which are not used?



---

archive/issue_comments_124316.json:
```json
{
    "body": "**Reviewer:** Keshav Kini",
    "created_at": "2011-08-26T07:50:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124316",
    "user": "https://github.com/kini"
}
```

**Reviewer:** Keshav Kini



---

archive/issue_comments_124317.json:
```json
{
    "body": "<a id='comment:6'></a>\nReally nice! This patch will save a lot of disk space! :D",
    "created_at": "2011-08-26T08:31:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124317",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:6'></a>
Really nice! This patch will save a lot of disk space! :D



---

archive/issue_comments_124318.json:
```json
{
    "body": "<a id='comment:7'></a>\nI generated the patch with this code, plus a handful (less than a dozen) manual touch-ups where, e.g., symbols were used in eval() strings but not directly. \n\n```\nimport symtable\nimport ast\nimport re\n\nclass GlobalImports(ast.NodeVisitor):\n    \n    func_depth = 0\n    \n    def __init__(self):\n        self.modules = {}\n        self.names = {}\n        self.used = {}\n    \n    def visit_FunctionDef(self, node):\n        self.func_depth += 1\n        self.generic_visit(node)\n        self.func_depth -= 1\n        \n    def visit_Import(self, node):\n        if self.func_depth == 0:\n            for alias in node.names:\n                self.modules[alias.asname or alias.name] = alias.name\n    \n    def visit_ImportFrom(self, node):\n        if self.func_depth == 0:\n            for alias in node.names:\n                if alias.name != '*':\n                    self.names[alias.asname or alias.name] = (node.module, alias.name)\n    \n    def visit_Name(self, node):\n        self.used[node.id] = True\n\ndef list_unused(file, source=None):\n    source = source or open(file).read()\n    tree = ast.parse(source)\n    visitor = GlobalImports()\n    visitor.visit(tree)\n#    print visitor.modules\n#    print visitor.names\n#    print visitor.used\n    all = dict(visitor.modules)\n    all.update(visitor.names)\n    for name in all:\n        if name not in visitor.used:\n            if '.' in name:\n                if source.count(name) == 1:\n                    print \"Unused\", name\n            else:\n                print \"Unused\", name\n#    symtab = symtable. symtable(source, file, 'exec')\n#    return symtab\n\ndef extract_used(source):\n    visitor = GlobalImports()\n    tree = ast.parse(source)\n    visitor.visit(tree)\n    return visitor.used\n\ndef prune_unused_one(file, source=None):\n    if source is None:\n        source = open(file).read()\n    used = extract_used(source)\n    import_matcher = re.compile(r'(from (\\S+) import (.*))|(import (.*))').match\n    \n    bad_name = re.compile('[()#]').search\n    lines = source.split('\\n')\n    for lineno, line in enumerate(lines):\n        m = import_matcher(line)\n        if m:\n            g = m.groups()\n            if g[0]:\n                if g[1] == '__future__':\n                    continue\n                names = g[2].split(',')\n            else:\n                names = g[4].split(',')\n            #print names\n            for ix, name in enumerate(names):\n                name = name.strip()\n                if bad_name(name) or name in ('', '*', '\\\\'):\n                    continue\n                if ' as ' in name:\n                    name, alias = name.split(\" as \")\n                    name = name.strip()\n                    alias = alias.strip()\n                else:\n                    alias = name\n                if alias not in used:\n                    if \".\" in alias:\n                        unused = source.count(alias) == 1\n                    else:\n                        unused = True\n                    if unused:\n                        print \"Unused %s%s\" % (g[1] + \".\" if g[1] else \"\", name)\n                        names[ix] = None\n            if None in names:\n                new_names = \", \".join(name.strip() for name in names if name is not None)\n                #print names, \"->\", new_names\n                if new_names:\n                    if g[0]:\n                        lines[lineno] = \"from %s import %s\" % (g[1], new_names)\n                    else:\n                        lines[lineno] = \"import %s\" % new_names\n                else:\n                    lines[lineno] = None\n                \n    return \"\\n\".join(line for line in lines if line is not None)\n\ndef prune_unused_all(sage_root):\n    for root, dirs, files in os.walk('%s/devel/sage/sage/' % sage_root):\n        for file in files:\n            file = os.path.join(root, file)\n            if file.endswith('.py'):\n                if os.path.basename(file) in ('__init__.py', 'all.py', 'interpreter.py'):\n                    continue\n                source = open(file).read()\n                try:\n                    new_source = prune_unused_one(file, source)\n                    if new_source != source:\n                        ast.parse(new_source)\n                        print file\n                        open(file, 'w').write(new_source)\n                        r = os.system(\"%s/sage -b > /dev/null 2> /dev/null\" % sage_root)\n                        if r == 0:\n                            r = os.system(\"%s/sage -python -c 'import sage.all'\" % sage_root)\n                        if r != 0:\n                            print \"Failed!\"\n                            open(file, 'w').write(source)\n                        else:\n                            print \"Good!\"\n                except Exception, exn:\n                    print file, exn\n\n```\n\nThen \n\n```\nprune_unused_all('/Users/robertwb/sage/sage-4.7.1')\n```",
    "created_at": "2011-08-26T16:38:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124318",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:7'></a>
I generated the patch with this code, plus a handful (less than a dozen) manual touch-ups where, e.g., symbols were used in eval() strings but not directly. 

```
import symtable
import ast
import re

class GlobalImports(ast.NodeVisitor):
    
    func_depth = 0
    
    def __init__(self):
        self.modules = {}
        self.names = {}
        self.used = {}
    
    def visit_FunctionDef(self, node):
        self.func_depth += 1
        self.generic_visit(node)
        self.func_depth -= 1
        
    def visit_Import(self, node):
        if self.func_depth == 0:
            for alias in node.names:
                self.modules[alias.asname or alias.name] = alias.name
    
    def visit_ImportFrom(self, node):
        if self.func_depth == 0:
            for alias in node.names:
                if alias.name != '*':
                    self.names[alias.asname or alias.name] = (node.module, alias.name)
    
    def visit_Name(self, node):
        self.used[node.id] = True

def list_unused(file, source=None):
    source = source or open(file).read()
    tree = ast.parse(source)
    visitor = GlobalImports()
    visitor.visit(tree)
#    print visitor.modules
#    print visitor.names
#    print visitor.used
    all = dict(visitor.modules)
    all.update(visitor.names)
    for name in all:
        if name not in visitor.used:
            if '.' in name:
                if source.count(name) == 1:
                    print "Unused", name
            else:
                print "Unused", name
#    symtab = symtable. symtable(source, file, 'exec')
#    return symtab

def extract_used(source):
    visitor = GlobalImports()
    tree = ast.parse(source)
    visitor.visit(tree)
    return visitor.used

def prune_unused_one(file, source=None):
    if source is None:
        source = open(file).read()
    used = extract_used(source)
    import_matcher = re.compile(r'(from (\S+) import (.*))|(import (.*))').match
    
    bad_name = re.compile('[()#]').search
    lines = source.split('\n')
    for lineno, line in enumerate(lines):
        m = import_matcher(line)
        if m:
            g = m.groups()
            if g[0]:
                if g[1] == '__future__':
                    continue
                names = g[2].split(',')
            else:
                names = g[4].split(',')
            #print names
            for ix, name in enumerate(names):
                name = name.strip()
                if bad_name(name) or name in ('', '*', '\\'):
                    continue
                if ' as ' in name:
                    name, alias = name.split(" as ")
                    name = name.strip()
                    alias = alias.strip()
                else:
                    alias = name
                if alias not in used:
                    if "." in alias:
                        unused = source.count(alias) == 1
                    else:
                        unused = True
                    if unused:
                        print "Unused %s%s" % (g[1] + "." if g[1] else "", name)
                        names[ix] = None
            if None in names:
                new_names = ", ".join(name.strip() for name in names if name is not None)
                #print names, "->", new_names
                if new_names:
                    if g[0]:
                        lines[lineno] = "from %s import %s" % (g[1], new_names)
                    else:
                        lines[lineno] = "import %s" % new_names
                else:
                    lines[lineno] = None
                
    return "\n".join(line for line in lines if line is not None)

def prune_unused_all(sage_root):
    for root, dirs, files in os.walk('%s/devel/sage/sage/' % sage_root):
        for file in files:
            file = os.path.join(root, file)
            if file.endswith('.py'):
                if os.path.basename(file) in ('__init__.py', 'all.py', 'interpreter.py'):
                    continue
                source = open(file).read()
                try:
                    new_source = prune_unused_one(file, source)
                    if new_source != source:
                        ast.parse(new_source)
                        print file
                        open(file, 'w').write(new_source)
                        r = os.system("%s/sage -b > /dev/null 2> /dev/null" % sage_root)
                        if r == 0:
                            r = os.system("%s/sage -python -c 'import sage.all'" % sage_root)
                        if r != 0:
                            print "Failed!"
                            open(file, 'w').write(source)
                        else:
                            print "Good!"
                except Exception, exn:
                    print file, exn

```

Then 

```
prune_unused_all('/Users/robertwb/sage/sage-4.7.1')
```



---

archive/issue_comments_124319.json:
```json
{
    "body": "<a id='comment:8'></a>\nNice. Positive review from me.\n\nBTW for future reference you can syntax-highlight python code in trac comments by putting `#!python` on the first line of the raw content inside triple braces (see the main page of Sage trac which I added some examples of this to).",
    "created_at": "2011-08-26T21:10:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124319",
    "user": "https://github.com/kini"
}
```

<a id='comment:8'></a>
Nice. Positive review from me.

BTW for future reference you can syntax-highlight python code in trac comments by putting `#!python` on the first line of the raw content inside triple braces (see the main page of Sage trac which I added some examples of this to).



---

archive/issue_events_133102.json:
```json
{
    "actor": "https://github.com/kini",
    "created_at": "2011-08-26T21:10:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11749#event-133102"
}
```



---

archive/issue_events_133103.json:
```json
{
    "actor": "https://github.com/kini",
    "created_at": "2011-08-26T21:10:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11749#event-133103"
}
```



---

archive/issue_comments_124320.json:
```json
{
    "body": "**Changing reviewer** from \"Keshav Kini\" to \"Keshav Kini, Leif Leonhardy\".",
    "created_at": "2011-08-26T22:56:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124320",
    "user": "https://github.com/nexttime"
}
```

**Changing reviewer** from "Keshav Kini" to "Keshav Kini, Leif Leonhardy".



---

archive/issue_comments_124321.json:
```json
{
    "body": "<a id='comment:9'></a>\n*Ooops. I wrote this a few hours ago, but forgot to click the submit button.*\n\n\nReplying to [@robertwb](#comment%3A7):\n> I generated the patch with this code, plus a handful (less than a dozen) manual touch-ups where, e.g., symbols were used in eval() strings but not directly. \n\nOk, so it is rather conservative with the exception of `eval()` and friends.\n\nWe should perhaps especially inspect those files modified that have a low \"coverage\"(though I strongly doubt the doctests of others will cover most execution paths...).\n\n\nI think more sophisticated detection of superfluous imports can be left for follow-up tickets, just like the inclusion of Cython files.\n\nThe patch is certainly a big step forwards as is.\n\n---\n\nP.S.: I'm pretty sure Robert knows about trac's wiki markup for source code etc. ;)",
    "created_at": "2011-08-26T22:56:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124321",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:9'></a>
*Ooops. I wrote this a few hours ago, but forgot to click the submit button.*


Replying to [@robertwb](#comment%3A7):
> I generated the patch with this code, plus a handful (less than a dozen) manual touch-ups where, e.g., symbols were used in eval() strings but not directly. 

Ok, so it is rather conservative with the exception of `eval()` and friends.

We should perhaps especially inspect those files modified that have a low "coverage"(though I strongly doubt the doctests of others will cover most execution paths...).


I think more sophisticated detection of superfluous imports can be left for follow-up tickets, just like the inclusion of Cython files.

The patch is certainly a big step forwards as is.

---

P.S.: I'm pretty sure Robert knows about trac's wiki markup for source code etc. ;)



---

archive/issue_comments_124322.json:
```json
{
    "body": "<a id='comment:10'></a>\nI'm pretty sure Robert knows whatever I'm likely to say on trac, but hey :P someone reading might not know.",
    "created_at": "2011-08-26T23:12:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124322",
    "user": "https://github.com/kini"
}
```

<a id='comment:10'></a>
I'm pretty sure Robert knows whatever I'm likely to say on trac, but hey :P someone reading might not know.



---

archive/issue_comments_124323.json:
```json
{
    "body": "<a id='comment:12'></a>\nAttachment comments shouldn't hurt either... ;-)",
    "created_at": "2011-09-08T10:12:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124323",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:12'></a>
Attachment comments shouldn't hurt either... ;-)



---

archive/issue_comments_124324.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,6 @@\n-As a first step in simplifying the import hierarchy, remove obviously unused imports. \n+As a first step in simplifying the import hierarchy, remove obviously unused imports.\n+\n+---\n+\n+Apply [attachment:11749-unneeded-imports.patch](https://github.com/sagemath/sage/files/ticket11749/11749-unneeded-imports.patch) to the Sage library.\n+\n``````\n",
    "created_at": "2011-09-08T10:12:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124324",
    "user": "https://github.com/nexttime"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,6 @@
-As a first step in simplifying the import hierarchy, remove obviously unused imports. 
+As a first step in simplifying the import hierarchy, remove obviously unused imports.
+
+---
+
+Apply [attachment:11749-unneeded-imports.patch](https://github.com/sagemath/sage/files/ticket11749/11749-unneeded-imports.patch) to the Sage library.
+
``````




---

archive/issue_comments_124325.json:
```json
{
    "body": "<a id='comment:13'></a>\nWell, they do take time and screen real estate, and are 100% redundant when there's a single attached file to apply to the Sage library, but I won't complain too much :-).",
    "created_at": "2011-09-08T16:02:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124325",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:13'></a>
Well, they do take time and screen real estate, and are 100% redundant when there's a single attached file to apply to the Sage library, but I won't complain too much :-).



---

archive/issue_events_133104.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-09-12T10:57:55Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "milestone_number": null,
    "milestone_title": "sage-4.7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11749#event-133104"
}
```



---

archive/issue_events_133105.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-09-12T10:57:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "label": "https://github.com/sagemath/sage/labels/pending",
    "label_color": "008080",
    "label_name": "pending",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11749#event-133105"
}
```



---

archive/issue_comments_124326.json:
```json
{
    "body": "<a id='comment:14'></a>\n*Of course*<sup>TM</sup> this patch bomb doesn't apply after only a few other patches have been applied.\n\nShould we just merge those parts that do (changing the patch here later), and put the others onto a follow-up?",
    "created_at": "2011-09-12T10:57:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124326",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:14'></a>
*Of course*<sup>TM</sup> this patch bomb doesn't apply after only a few other patches have been applied.

Should we just merge those parts that do (changing the patch here later), and put the others onto a follow-up?



---

archive/issue_comments_124327.json:
```json
{
    "body": "<a id='comment:15'></a>\nYes, simply ignore the rejects when you merge it and post then to a follow-up. 99% of the changes are completely independent of each other, and otherwise this will never actually get in.",
    "created_at": "2011-09-13T04:28:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124327",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:15'></a>
Yes, simply ignore the rejects when you merge it and post then to a follow-up. 99% of the changes are completely independent of each other, and otherwise this will never actually get in.



---

archive/issue_events_133106.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2011-09-13T04:28:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "milestone_number": null,
    "milestone_title": "sage-4.7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11749#event-133106"
}
```



---

archive/issue_events_133107.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2011-09-13T04:28:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "label": "https://github.com/sagemath/sage/labels/pending",
    "label_color": "008080",
    "label_name": "pending",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11749#event-133107"
}
```



---

archive/issue_comments_124328.json:
```json
{
    "body": "<a id='comment:16'></a>\nAs the patch is more or less automatically generated, why not just merge it last? Generate a patch using Robert's code snippet above, inspect for less than a dozen manual fixes, and done. (Make sure of course to `hg qrefresh -U \"Robert Bradshaw <robertwb@math.washington.edu>\"` first :) ) Not sure how time consuming this manual inspection is, but maybe it's worth a shot? As opposed to losing some of the changes, I mean.",
    "created_at": "2011-09-13T04:44:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124328",
    "user": "https://github.com/kini"
}
```

<a id='comment:16'></a>
As the patch is more or less automatically generated, why not just merge it last? Generate a patch using Robert's code snippet above, inspect for less than a dozen manual fixes, and done. (Make sure of course to `hg qrefresh -U "Robert Bradshaw <robertwb@math.washington.edu>"` first :) ) Not sure how time consuming this manual inspection is, but maybe it's worth a shot? As opposed to losing some of the changes, I mean.



---

archive/issue_comments_124329.json:
```json
{
    "body": "<a id='comment:17'></a>\nManual inspection takes quite a while, and the patch is not entirely automatically generated. I'd rather see (the bulk of) this patch merged in sooner rather than later, and especially avoid playing some right-before-the-release gymnastics. The changes won't be lost--we can record what the rejects were and even re-run the script at a later date (which should be much faster and produce a much smaller, easier to inspect output).",
    "created_at": "2011-09-13T08:00:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124329",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:17'></a>
Manual inspection takes quite a while, and the patch is not entirely automatically generated. I'd rather see (the bulk of) this patch merged in sooner rather than later, and especially avoid playing some right-before-the-release gymnastics. The changes won't be lost--we can record what the rejects were and even re-run the script at a later date (which should be much faster and produce a much smaller, easier to inspect output).



---

archive/issue_comments_124330.json:
```json
{
    "body": "<a id='comment:18'></a>\nOh, OK then. Sounds good!",
    "created_at": "2011-09-13T08:02:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124330",
    "user": "https://github.com/kini"
}
```

<a id='comment:18'></a>
Oh, OK then. Sounds good!



---

archive/issue_comments_124331.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [@robertwb](#comment%3A17):\n> Manual inspection takes quite a while, and the patch is not entirely automatically generated. I'd rather see (the bulk of) this patch merged in sooner rather than later, and especially avoid playing some right-before-the-release gymnastics. The changes won't be lost--we can record what the rejects were and even re-run the script at a later date (which should be much faster and produce a much smaller, easier to inspect output).\n\nThat's what I intended; i.e., merge the patch as soon as I've sorted out which tickets are *really* ready to get merged into Sage 4.7.2.alpha3, replace the patch on this ticket by what actually applied, and put the rejects on a follow-up for the next (devel) release. There we can rerun the script on the then current release.\n\nI've only set it to \"sage-pending\" to back it out from my merge attempts, not to postpone it to another release.",
    "created_at": "2011-09-13T09:07:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124331",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:19'></a>
Replying to [@robertwb](#comment%3A17):
> Manual inspection takes quite a while, and the patch is not entirely automatically generated. I'd rather see (the bulk of) this patch merged in sooner rather than later, and especially avoid playing some right-before-the-release gymnastics. The changes won't be lost--we can record what the rejects were and even re-run the script at a later date (which should be much faster and produce a much smaller, easier to inspect output).

That's what I intended; i.e., merge the patch as soon as I've sorted out which tickets are *really* ready to get merged into Sage 4.7.2.alpha3, replace the patch on this ticket by what actually applied, and put the rejects on a follow-up for the next (devel) release. There we can rerun the script on the then current release.

I've only set it to "sage-pending" to back it out from my merge attempts, not to postpone it to another release.



---

archive/issue_comments_124332.json:
```json
{
    "body": "Reviewer patch. Robert's patch rebased on the \"final preliminary\" Sage 4.7.2.alpha3. Apply only this one.",
    "created_at": "2011-09-17T03:48:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124332",
    "user": "https://github.com/nexttime"
}
```

Reviewer patch. Robert's patch rebased on the "final preliminary" Sage 4.7.2.alpha3. Apply only this one.



---

archive/issue_comments_124333.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,5 +2,11 @@\n \n ---\n \n-Apply [attachment:11749-unneeded-imports.patch](https://github.com/sagemath/sage/files/ticket11749/11749-unneeded-imports.patch) to the Sage library.\n+The patch below is the result of applying Robert's original patch (which was based on Sage 4.7.1) to the (presumably) final version of Sage 4.7.2.alpha3, ignoring rejects, and with some manual corrections due to afterwards occurring import errors when trying to start up Sage or running `ptestlong`.\n \n+The current omissions will be dealt with on follow-up tickets.\n+\n+---\n+\n+Apply only [attachment:trac_11749-remove_unneeded_imports-rebased_on_4.7.2.alpha3.reviewer.patch](https://github.com/sagemath/sage/files/ticket11749/trac_11749-remove_unneeded_imports-rebased_on_4.7.2.alpha3.reviewer.patch) to the Sage library.\n+\n``````\n",
    "created_at": "2011-09-17T04:03:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124333",
    "user": "https://github.com/nexttime"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,5 +2,11 @@
 
 ---
 
-Apply [attachment:11749-unneeded-imports.patch](https://github.com/sagemath/sage/files/ticket11749/11749-unneeded-imports.patch) to the Sage library.
+The patch below is the result of applying Robert's original patch (which was based on Sage 4.7.1) to the (presumably) final version of Sage 4.7.2.alpha3, ignoring rejects, and with some manual corrections due to afterwards occurring import errors when trying to start up Sage or running `ptestlong`.
 
+The current omissions will be dealt with on follow-up tickets.
+
+---
+
+Apply only [attachment:trac_11749-remove_unneeded_imports-rebased_on_4.7.2.alpha3.reviewer.patch](https://github.com/sagemath/sage/files/ticket11749/trac_11749-remove_unneeded_imports-rebased_on_4.7.2.alpha3.reviewer.patch) to the Sage library.
+
``````




---

archive/issue_comments_124334.json:
```json
{
    "body": "<a id='comment:20'></a>\n**Attachment:** [trac_11749-remove_unneeded_imports-rebased_on_4.7.2.alpha3.reviewer.patch.gz](https://github.com/sagemath/sage/files/ticket11749/trac_11749-remove_unneeded_imports-rebased_on_4.7.2.alpha3.reviewer.patch.gz)\n\nFixed. :)",
    "created_at": "2011-09-17T04:03:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124334",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:20'></a>
**Attachment:** [trac_11749-remove_unneeded_imports-rebased_on_4.7.2.alpha3.reviewer.patch.gz](https://github.com/sagemath/sage/files/ticket11749/trac_11749-remove_unneeded_imports-rebased_on_4.7.2.alpha3.reviewer.patch.gz)

Fixed. :)



---

archive/issue_events_133108.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-09-17T05:36:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11749#event-133108"
}
```



---

archive/issue_events_133109.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-09-17T05:36:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11749#event-133109"
}
```



---

archive/issue_comments_124335.json:
```json
{
    "body": "**Merged:** sage-4.7.2.alpha3",
    "created_at": "2011-09-17T05:36:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124335",
    "user": "https://github.com/nexttime"
}
```

**Merged:** sage-4.7.2.alpha3



---

archive/issue_comments_124336.json:
```json
{
    "body": "<a id='comment:21'></a>\n**We shouldn't forget to open a follow-up.**\n\nI'll attach the logs later, either here or to another ticket in case someone opened one then...",
    "created_at": "2011-09-17T05:36:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124336",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:21'></a>
**We shouldn't forget to open a follow-up.**

I'll attach the logs later, either here or to another ticket in case someone opened one then...



---

archive/issue_comments_124337.json:
```json
{
    "body": "<a id='comment:22'></a>\nFollowup ticket is at #11811.",
    "created_at": "2011-09-17T05:49:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124337",
    "user": "https://github.com/kini"
}
```

<a id='comment:22'></a>
Followup ticket is at #11811.



---

archive/issue_comments_124338.json:
```json
{
    "body": "<a id='comment:23'></a>\nI understand the rationale for that patch, but I hope you realize that such patch bombs inflict a lot of rebasing work. I just spent half a day, if not more, rebasing the sage-combinat patch queue. Please, please let us know in advance about it next time. \n\nCheers,\n                                   Nicolas",
    "created_at": "2011-11-08T11:26:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124338",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:23'></a>
I understand the rationale for that patch, but I hope you realize that such patch bombs inflict a lot of rebasing work. I just spent half a day, if not more, rebasing the sage-combinat patch queue. Please, please let us know in advance about it next time. 

Cheers,
                                   Nicolas



---

archive/issue_comments_124339.json:
```json
{
    "body": "<a id='comment:24'></a>\nSorry Nicolas, I didn't know about your guys' hundreds of patches queue when I reviewed this ticket :( Next time I'll cc you to tickets I see with broad patches.",
    "created_at": "2011-11-08T12:41:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124339",
    "user": "https://github.com/kini"
}
```

<a id='comment:24'></a>
Sorry Nicolas, I didn't know about your guys' hundreds of patches queue when I reviewed this ticket :( Next time I'll cc you to tickets I see with broad patches.



---

archive/issue_comments_124340.json:
```json
{
    "body": "<a id='comment:25'></a>\nReplying to [@kini](#comment%3A24):\n> Sorry Nicolas, I didn't know about your guys' hundreds of patches queue when I reviewed this ticket :( Next time I'll cc you to tickets I see with broad patches.\n\nThanks!",
    "created_at": "2011-11-08T12:46:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124340",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:25'></a>
Replying to [@kini](#comment%3A24):
> Sorry Nicolas, I didn't know about your guys' hundreds of patches queue when I reviewed this ticket :( Next time I'll cc you to tickets I see with broad patches.

Thanks!



---

archive/issue_comments_124341.json:
```json
{
    "body": "<a id='comment:26'></a>\nDid you see the follow up of this ticket also Nicolas?  It's #11762 it also touches quite a lot, but it are just __init__.py files so it should not conflict a lot with your patch queue.",
    "created_at": "2011-11-08T13:14:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124341",
    "user": "https://github.com/koffie"
}
```

<a id='comment:26'></a>
Did you see the follow up of this ticket also Nicolas?  It's #11762 it also touches quite a lot, but it are just __init__.py files so it should not conflict a lot with your patch queue.
