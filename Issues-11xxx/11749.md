# Issue 11749: Remove unneeded imports

archive/issues_011577.json:
```json
{
    "assignees": [],
    "body": "As a first step in simplifying the import hierarchy, remove obviously unused imports.\n\n---\n\nThe patch below is the result of applying Robert's original patch (which was based on Sage 4.7.1) to the (presumably) final version of Sage 4.7.2.alpha3, ignoring rejects, and with some manual corrections due to afterwards occurring import errors when trying to start up Sage or running `ptestlong`.\n\nThe current omissions will be dealt with on follow-up tickets.\n\n---\n\nApply only [attachment: trac_11749-remove_unneeded_imports-rebased_on_4.7.2.alpha3.reviewer.patch](https://github.com/sagemath/sage/files/ticket11749/trac_11749-remove_unneeded_imports-rebased_on_4.7.2.alpha3.reviewer.patch.gz) to the Sage library.\n\n\nCC:  @nexttime @koffie\n\nAuthor: **Robert Bradshaw**\n\nReviewer: **Keshav Kini, Leif Leonhardy**\n\nMerged: **sage-4.7.2.alpha3**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/11749_\n\n",
    "closed_at": "2011-09-17T05:36:33Z",
    "created_at": "2011-08-26T06:17:23Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/performance",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.7.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Remove unneeded imports",
    "type": "issue",
    "updated_at": "2011-11-08T13:14:35Z",
    "url": "https://github.com/sagemath/sage/issues/11749",
    "user": "https://github.com/robertwb"
}
```
As a first step in simplifying the import hierarchy, remove obviously unused imports.

---

The patch below is the result of applying Robert's original patch (which was based on Sage 4.7.1) to the (presumably) final version of Sage 4.7.2.alpha3, ignoring rejects, and with some manual corrections due to afterwards occurring import errors when trying to start up Sage or running `ptestlong`.

The current omissions will be dealt with on follow-up tickets.

---

Apply only [attachment: trac_11749-remove_unneeded_imports-rebased_on_4.7.2.alpha3.reviewer.patch](https://github.com/sagemath/sage/files/ticket11749/trac_11749-remove_unneeded_imports-rebased_on_4.7.2.alpha3.reviewer.patch.gz) to the Sage library.


CC:  @nexttime @koffie

Author: **Robert Bradshaw**

Reviewer: **Keshav Kini, Leif Leonhardy**

Merged: **sage-4.7.2.alpha3**

_Issue created by migration from https://trac.sagemath.org/ticket/11749_





---

archive/issue_events_144186.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2011-08-26T06:17:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "milestone_number": null,
    "milestone_title": "sage-4.7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11749#event-144186"
}
```



---

archive/issue_events_144187.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2011-08-26T06:17:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "label": "https://github.com/sagemath/sage/labels/performance",
    "label_color": "696969",
    "label_name": "performance",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11749#event-144187"
}
```



---

archive/issue_events_144188.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2011-08-26T06:17:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11749#event-144188"
}
```



---

archive/issue_events_144189.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2011-08-26T06:17:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11749#event-144189"
}
```



---

archive/issue_events_144190.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2011-08-26T06:58:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11749#event-144190"
}
```



---

archive/issue_comments_124339.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">Comment 1</div>\n\nAttachment: **[11749-unneeded-imports.patch.gz](https://github.com/sagemath/sage/files/ticket11749/11749-unneeded-imports.patch.gz)**",
    "created_at": "2011-08-26T06:58:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124339",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:1" align="right">Comment 1</div>

Attachment: **[11749-unneeded-imports.patch.gz](https://github.com/sagemath/sage/files/ticket11749/11749-unneeded-imports.patch.gz)**



---

archive/issue_comments_124340.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nI'm ptestlonging this on sage.math right now.",
    "created_at": "2011-08-26T06:59:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124340",
    "user": "https://github.com/kini"
}
```

<div id="comment:2" align="right">Comment 2</div>

I'm ptestlonging this on sage.math right now.



---

archive/issue_comments_124341.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nIncidentally how did you generate this patch?",
    "created_at": "2011-08-26T07:26:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124341",
    "user": "https://github.com/kini"
}
```

<div id="comment:3" align="right">Comment 3</div>

Incidentally how did you generate this patch?



---

archive/issue_comments_124342.json:
```json
{
    "body": "Author: **Robert Bradshaw**",
    "created_at": "2011-08-26T07:50:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124342",
    "user": "https://github.com/kini"
}
```

Author: **Robert Bradshaw**



---

archive/issue_comments_124343.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nptestlong passes! Before I mark this positive review I would like to know how you generated the patch, though. Just tracing imports and finding those which are not used?",
    "created_at": "2011-08-26T07:50:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124343",
    "user": "https://github.com/kini"
}
```

<div id="comment:4" align="right">Comment 4</div>

ptestlong passes! Before I mark this positive review I would like to know how you generated the patch, though. Just tracing imports and finding those which are not used?



---

archive/issue_comments_124344.json:
```json
{
    "body": "Reviewer: **Keshav Kini**",
    "created_at": "2011-08-26T07:50:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124344",
    "user": "https://github.com/kini"
}
```

Reviewer: **Keshav Kini**



---

archive/issue_comments_124345.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nReally nice! This patch will save a lot of disk space! :D",
    "created_at": "2011-08-26T08:31:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124345",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:6" align="right">Comment 6</div>

Really nice! This patch will save a lot of disk space! :D



---

archive/issue_comments_124346.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nI generated the patch with this code, plus a handful (less than a dozen) manual touch-ups where, e.g., symbols were used in eval() strings but not directly. \n\n```\nimport symtable\nimport ast\nimport re\n\nclass GlobalImports(ast.NodeVisitor):\n    \n    func_depth = 0\n    \n    def __init__(self):\n        self.modules = {}\n        self.names = {}\n        self.used = {}\n    \n    def visit_FunctionDef(self, node):\n        self.func_depth += 1\n        self.generic_visit(node)\n        self.func_depth -= 1\n        \n    def visit_Import(self, node):\n        if self.func_depth == 0:\n            for alias in node.names:\n                self.modules[alias.asname or alias.name] = alias.name\n    \n    def visit_ImportFrom(self, node):\n        if self.func_depth == 0:\n            for alias in node.names:\n                if alias.name != '*':\n                    self.names[alias.asname or alias.name] = (node.module, alias.name)\n    \n    def visit_Name(self, node):\n        self.used[node.id] = True\n\ndef list_unused(file, source=None):\n    source = source or open(file).read()\n    tree = ast.parse(source)\n    visitor = GlobalImports()\n    visitor.visit(tree)\n#    print visitor.modules\n#    print visitor.names\n#    print visitor.used\n    all = dict(visitor.modules)\n    all.update(visitor.names)\n    for name in all:\n        if name not in visitor.used:\n            if '.' in name:\n                if source.count(name) == 1:\n                    print \"Unused\", name\n            else:\n                print \"Unused\", name\n#    symtab = symtable. symtable(source, file, 'exec')\n#    return symtab\n\ndef extract_used(source):\n    visitor = GlobalImports()\n    tree = ast.parse(source)\n    visitor.visit(tree)\n    return visitor.used\n\ndef prune_unused_one(file, source=None):\n    if source is None:\n        source = open(file).read()\n    used = extract_used(source)\n    import_matcher = re.compile(r'(from (\\S+) import (.*))|(import (.*))').match\n    \n    bad_name = re.compile('[()#]').search\n    lines = source.split('\\n')\n    for lineno, line in enumerate(lines):\n        m = import_matcher(line)\n        if m:\n            g = m.groups()\n            if g[0]:\n                if g[1] == '__future__':\n                    continue\n                names = g[2].split(',')\n            else:\n                names = g[4].split(',')\n            #print names\n            for ix, name in enumerate(names):\n                name = name.strip()\n                if bad_name(name) or name in ('', '*', '\\\\'):\n                    continue\n                if ' as ' in name:\n                    name, alias = name.split(\" as \")\n                    name = name.strip()\n                    alias = alias.strip()\n                else:\n                    alias = name\n                if alias not in used:\n                    if \".\" in alias:\n                        unused = source.count(alias) == 1\n                    else:\n                        unused = True\n                    if unused:\n                        print \"Unused %s%s\" % (g[1] + \".\" if g[1] else \"\", name)\n                        names[ix] = None\n            if None in names:\n                new_names = \", \".join(name.strip() for name in names if name is not None)\n                #print names, \"->\", new_names\n                if new_names:\n                    if g[0]:\n                        lines[lineno] = \"from %s import %s\" % (g[1], new_names)\n                    else:\n                        lines[lineno] = \"import %s\" % new_names\n                else:\n                    lines[lineno] = None\n                \n    return \"\\n\".join(line for line in lines if line is not None)\n\ndef prune_unused_all(sage_root):\n    for root, dirs, files in os.walk('%s/devel/sage/sage/' % sage_root):\n        for file in files:\n            file = os.path.join(root, file)\n            if file.endswith('.py'):\n                if os.path.basename(file) in ('__init__.py', 'all.py', 'interpreter.py'):\n                    continue\n                source = open(file).read()\n                try:\n                    new_source = prune_unused_one(file, source)\n                    if new_source != source:\n                        ast.parse(new_source)\n                        print file\n                        open(file, 'w').write(new_source)\n                        r = os.system(\"%s/sage -b > /dev/null 2> /dev/null\" % sage_root)\n                        if r == 0:\n                            r = os.system(\"%s/sage -python -c 'import sage.all'\" % sage_root)\n                        if r != 0:\n                            print \"Failed!\"\n                            open(file, 'w').write(source)\n                        else:\n                            print \"Good!\"\n                except Exception, exn:\n                    print file, exn\n\n```\n\nThen \n\n```\nprune_unused_all('/Users/robertwb/sage/sage-4.7.1')\n```",
    "created_at": "2011-08-26T16:38:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124346",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:7" align="right">Comment 7</div>

I generated the patch with this code, plus a handful (less than a dozen) manual touch-ups where, e.g., symbols were used in eval() strings but not directly. 

```
import symtable
import ast
import re

class GlobalImports(ast.NodeVisitor):
    
    func_depth = 0
    
    def __init__(self):
        self.modules = {}
        self.names = {}
        self.used = {}
    
    def visit_FunctionDef(self, node):
        self.func_depth += 1
        self.generic_visit(node)
        self.func_depth -= 1
        
    def visit_Import(self, node):
        if self.func_depth == 0:
            for alias in node.names:
                self.modules[alias.asname or alias.name] = alias.name
    
    def visit_ImportFrom(self, node):
        if self.func_depth == 0:
            for alias in node.names:
                if alias.name != '*':
                    self.names[alias.asname or alias.name] = (node.module, alias.name)
    
    def visit_Name(self, node):
        self.used[node.id] = True

def list_unused(file, source=None):
    source = source or open(file).read()
    tree = ast.parse(source)
    visitor = GlobalImports()
    visitor.visit(tree)
#    print visitor.modules
#    print visitor.names
#    print visitor.used
    all = dict(visitor.modules)
    all.update(visitor.names)
    for name in all:
        if name not in visitor.used:
            if '.' in name:
                if source.count(name) == 1:
                    print "Unused", name
            else:
                print "Unused", name
#    symtab = symtable. symtable(source, file, 'exec')
#    return symtab

def extract_used(source):
    visitor = GlobalImports()
    tree = ast.parse(source)
    visitor.visit(tree)
    return visitor.used

def prune_unused_one(file, source=None):
    if source is None:
        source = open(file).read()
    used = extract_used(source)
    import_matcher = re.compile(r'(from (\S+) import (.*))|(import (.*))').match
    
    bad_name = re.compile('[()#]').search
    lines = source.split('\n')
    for lineno, line in enumerate(lines):
        m = import_matcher(line)
        if m:
            g = m.groups()
            if g[0]:
                if g[1] == '__future__':
                    continue
                names = g[2].split(',')
            else:
                names = g[4].split(',')
            #print names
            for ix, name in enumerate(names):
                name = name.strip()
                if bad_name(name) or name in ('', '*', '\\'):
                    continue
                if ' as ' in name:
                    name, alias = name.split(" as ")
                    name = name.strip()
                    alias = alias.strip()
                else:
                    alias = name
                if alias not in used:
                    if "." in alias:
                        unused = source.count(alias) == 1
                    else:
                        unused = True
                    if unused:
                        print "Unused %s%s" % (g[1] + "." if g[1] else "", name)
                        names[ix] = None
            if None in names:
                new_names = ", ".join(name.strip() for name in names if name is not None)
                #print names, "->", new_names
                if new_names:
                    if g[0]:
                        lines[lineno] = "from %s import %s" % (g[1], new_names)
                    else:
                        lines[lineno] = "import %s" % new_names
                else:
                    lines[lineno] = None
                
    return "\n".join(line for line in lines if line is not None)

def prune_unused_all(sage_root):
    for root, dirs, files in os.walk('%s/devel/sage/sage/' % sage_root):
        for file in files:
            file = os.path.join(root, file)
            if file.endswith('.py'):
                if os.path.basename(file) in ('__init__.py', 'all.py', 'interpreter.py'):
                    continue
                source = open(file).read()
                try:
                    new_source = prune_unused_one(file, source)
                    if new_source != source:
                        ast.parse(new_source)
                        print file
                        open(file, 'w').write(new_source)
                        r = os.system("%s/sage -b > /dev/null 2> /dev/null" % sage_root)
                        if r == 0:
                            r = os.system("%s/sage -python -c 'import sage.all'" % sage_root)
                        if r != 0:
                            print "Failed!"
                            open(file, 'w').write(source)
                        else:
                            print "Good!"
                except Exception, exn:
                    print file, exn

```

Then 

```
prune_unused_all('/Users/robertwb/sage/sage-4.7.1')
```



---

archive/issue_comments_124347.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nNice. Positive review from me.\n\nBTW for future reference you can syntax-highlight python code in trac comments by putting `#!python` on the first line of the raw content inside triple braces (see the main page of Sage trac which I added some examples of this to).",
    "created_at": "2011-08-26T21:10:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124347",
    "user": "https://github.com/kini"
}
```

<div id="comment:8" align="right">Comment 8</div>

Nice. Positive review from me.

BTW for future reference you can syntax-highlight python code in trac comments by putting `#!python` on the first line of the raw content inside triple braces (see the main page of Sage trac which I added some examples of this to).



---

archive/issue_events_144191.json:
```json
{
    "actor": "https://github.com/kini",
    "created_at": "2011-08-26T21:10:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11749#event-144191"
}
```



---

archive/issue_events_144192.json:
```json
{
    "actor": "https://github.com/kini",
    "created_at": "2011-08-26T21:10:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11749#event-144192"
}
```



---

archive/issue_comments_124348.json:
```json
{
    "body": "Changed reviewer from **Keshav Kini** to **Keshav Kini, Leif Leonhardy**",
    "created_at": "2011-08-26T22:56:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124348",
    "user": "https://github.com/nexttime"
}
```

Changed reviewer from **Keshav Kini** to **Keshav Kini, Leif Leonhardy**



---

archive/issue_comments_124349.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\n*Ooops. I wrote this a few hours ago, but forgot to click the submit button.*\n\n\nReplying to [@robertwb](#comment%3A7):\n> I generated the patch with this code, plus a handful (less than a dozen) manual touch-ups where, e.g., symbols were used in eval() strings but not directly. \n\nOk, so it is rather conservative with the exception of `eval()` and friends.\n\nWe should perhaps especially inspect those files modified that have a low \"coverage\"(though I strongly doubt the doctests of others will cover most execution paths...).\n\n\nI think more sophisticated detection of superfluous imports can be left for follow-up tickets, just like the inclusion of Cython files.\n\nThe patch is certainly a big step forwards as is.\n\n---\n\nP.S.: I'm pretty sure Robert knows about trac's wiki markup for source code etc. ;)",
    "created_at": "2011-08-26T22:56:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124349",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:9" align="right">Comment 9</div>

*Ooops. I wrote this a few hours ago, but forgot to click the submit button.*


Replying to [@robertwb](#comment%3A7):
> I generated the patch with this code, plus a handful (less than a dozen) manual touch-ups where, e.g., symbols were used in eval() strings but not directly. 

Ok, so it is rather conservative with the exception of `eval()` and friends.

We should perhaps especially inspect those files modified that have a low "coverage"(though I strongly doubt the doctests of others will cover most execution paths...).


I think more sophisticated detection of superfluous imports can be left for follow-up tickets, just like the inclusion of Cython files.

The patch is certainly a big step forwards as is.

---

P.S.: I'm pretty sure Robert knows about trac's wiki markup for source code etc. ;)



---

archive/issue_comments_124350.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\nI'm pretty sure Robert knows whatever I'm likely to say on trac, but hey :P someone reading might not know.",
    "created_at": "2011-08-26T23:12:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124350",
    "user": "https://github.com/kini"
}
```

<div id="comment:10" align="right">Comment 10</div>

I'm pretty sure Robert knows whatever I'm likely to say on trac, but hey :P someone reading might not know.



---

archive/issue_comments_124351.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">Comment 12</div>\n\nAttachment comments shouldn't hurt either... ;-)",
    "created_at": "2011-09-08T10:12:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124351",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:12" align="right">Comment 12</div>

Attachment comments shouldn't hurt either... ;-)



---

archive/issue_comments_124352.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,6 @@\n-As a first step in simplifying the import hierarchy, remove obviously unused imports. \n+As a first step in simplifying the import hierarchy, remove obviously unused imports.\n+\n+---\n+\n+Apply [attachment: 11749-unneeded-imports.patch](https://github.com/sagemath/sage/files/ticket11749/11749-unneeded-imports.patch.gz) to the Sage library.\n+\n``````\n",
    "created_at": "2011-09-08T10:12:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124352",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,6 @@
-As a first step in simplifying the import hierarchy, remove obviously unused imports. 
+As a first step in simplifying the import hierarchy, remove obviously unused imports.
+
+---
+
+Apply [attachment: 11749-unneeded-imports.patch](https://github.com/sagemath/sage/files/ticket11749/11749-unneeded-imports.patch.gz) to the Sage library.
+
``````




---

archive/issue_comments_124353.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nWell, they do take time and screen real estate, and are 100% redundant when there's a single attached file to apply to the Sage library, but I won't complain too much :-).",
    "created_at": "2011-09-08T16:02:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124353",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:13" align="right">Comment 13</div>

Well, they do take time and screen real estate, and are 100% redundant when there's a single attached file to apply to the Sage library, but I won't complain too much :-).



---

archive/issue_events_144193.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-09-12T10:57:55Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "milestone_number": null,
    "milestone_title": "sage-4.7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11749#event-144193"
}
```



---

archive/issue_events_144194.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-09-12T10:57:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "label": "https://github.com/sagemath/sage/labels/pending",
    "label_color": "008080",
    "label_name": "pending",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11749#event-144194"
}
```



---

archive/issue_comments_124354.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\n*Of course*<sup>TM</sup> this patch bomb doesn't apply after only a few other patches have been applied.\n\nShould we just merge those parts that do (changing the patch here later), and put the others onto a follow-up?",
    "created_at": "2011-09-12T10:57:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124354",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:14" align="right">Comment 14</div>

*Of course*<sup>TM</sup> this patch bomb doesn't apply after only a few other patches have been applied.

Should we just merge those parts that do (changing the patch here later), and put the others onto a follow-up?



---

archive/issue_comments_124355.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\nYes, simply ignore the rejects when you merge it and post then to a follow-up. 99% of the changes are completely independent of each other, and otherwise this will never actually get in.",
    "created_at": "2011-09-13T04:28:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124355",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:15" align="right">Comment 15</div>

Yes, simply ignore the rejects when you merge it and post then to a follow-up. 99% of the changes are completely independent of each other, and otherwise this will never actually get in.



---

archive/issue_events_144195.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2011-09-13T04:28:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "milestone_number": null,
    "milestone_title": "sage-4.7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11749#event-144195"
}
```



---

archive/issue_events_144196.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2011-09-13T04:28:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "label": "https://github.com/sagemath/sage/labels/pending",
    "label_color": "008080",
    "label_name": "pending",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11749#event-144196"
}
```



---

archive/issue_comments_124356.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">Comment 16</div>\n\nAs the patch is more or less automatically generated, why not just merge it last? Generate a patch using Robert's code snippet above, inspect for less than a dozen manual fixes, and done. (Make sure of course to `hg qrefresh -U \"Robert Bradshaw <robertwb@math.washington.edu>\"` first :) ) Not sure how time consuming this manual inspection is, but maybe it's worth a shot? As opposed to losing some of the changes, I mean.",
    "created_at": "2011-09-13T04:44:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124356",
    "user": "https://github.com/kini"
}
```

<div id="comment:16" align="right">Comment 16</div>

As the patch is more or less automatically generated, why not just merge it last? Generate a patch using Robert's code snippet above, inspect for less than a dozen manual fixes, and done. (Make sure of course to `hg qrefresh -U "Robert Bradshaw <robertwb@math.washington.edu>"` first :) ) Not sure how time consuming this manual inspection is, but maybe it's worth a shot? As opposed to losing some of the changes, I mean.



---

archive/issue_comments_124357.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">Comment 17</div>\n\nManual inspection takes quite a while, and the patch is not entirely automatically generated. I'd rather see (the bulk of) this patch merged in sooner rather than later, and especially avoid playing some right-before-the-release gymnastics. The changes won't be lost--we can record what the rejects were and even re-run the script at a later date (which should be much faster and produce a much smaller, easier to inspect output).",
    "created_at": "2011-09-13T08:00:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124357",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:17" align="right">Comment 17</div>

Manual inspection takes quite a while, and the patch is not entirely automatically generated. I'd rather see (the bulk of) this patch merged in sooner rather than later, and especially avoid playing some right-before-the-release gymnastics. The changes won't be lost--we can record what the rejects were and even re-run the script at a later date (which should be much faster and produce a much smaller, easier to inspect output).



---

archive/issue_comments_124358.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">Comment 18</div>\n\nOh, OK then. Sounds good!",
    "created_at": "2011-09-13T08:02:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124358",
    "user": "https://github.com/kini"
}
```

<div id="comment:18" align="right">Comment 18</div>

Oh, OK then. Sounds good!



---

archive/issue_comments_124359.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">Comment 19</div>\n\nReplying to [@robertwb](#comment%3A17):\n> Manual inspection takes quite a while, and the patch is not entirely automatically generated. I'd rather see (the bulk of) this patch merged in sooner rather than later, and especially avoid playing some right-before-the-release gymnastics. The changes won't be lost--we can record what the rejects were and even re-run the script at a later date (which should be much faster and produce a much smaller, easier to inspect output).\n\nThat's what I intended; i.e., merge the patch as soon as I've sorted out which tickets are *really* ready to get merged into Sage 4.7.2.alpha3, replace the patch on this ticket by what actually applied, and put the rejects on a follow-up for the next (devel) release. There we can rerun the script on the then current release.\n\nI've only set it to \"sage-pending\" to back it out from my merge attempts, not to postpone it to another release.",
    "created_at": "2011-09-13T09:07:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124359",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:19" align="right">Comment 19</div>

Replying to [@robertwb](#comment%3A17):
> Manual inspection takes quite a while, and the patch is not entirely automatically generated. I'd rather see (the bulk of) this patch merged in sooner rather than later, and especially avoid playing some right-before-the-release gymnastics. The changes won't be lost--we can record what the rejects were and even re-run the script at a later date (which should be much faster and produce a much smaller, easier to inspect output).

That's what I intended; i.e., merge the patch as soon as I've sorted out which tickets are *really* ready to get merged into Sage 4.7.2.alpha3, replace the patch on this ticket by what actually applied, and put the rejects on a follow-up for the next (devel) release. There we can rerun the script on the then current release.

I've only set it to "sage-pending" to back it out from my merge attempts, not to postpone it to another release.



---

archive/issue_comments_124360.json:
```json
{
    "body": "Reviewer patch. Robert's patch rebased on the \"final preliminary\" Sage 4.7.2.alpha3. Apply only this one.",
    "created_at": "2011-09-17T03:48:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124360",
    "user": "https://github.com/nexttime"
}
```

Reviewer patch. Robert's patch rebased on the "final preliminary" Sage 4.7.2.alpha3. Apply only this one.



---

archive/issue_comments_124361.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,5 +2,11 @@\n \n ---\n \n-Apply [attachment: 11749-unneeded-imports.patch](https://github.com/sagemath/sage/files/ticket11749/11749-unneeded-imports.patch.gz) to the Sage library.\n+The patch below is the result of applying Robert's original patch (which was based on Sage 4.7.1) to the (presumably) final version of Sage 4.7.2.alpha3, ignoring rejects, and with some manual corrections due to afterwards occurring import errors when trying to start up Sage or running `ptestlong`.\n \n+The current omissions will be dealt with on follow-up tickets.\n+\n+---\n+\n+Apply only [attachment: trac_11749-remove_unneeded_imports-rebased_on_4.7.2.alpha3.reviewer.patch](https://github.com/sagemath/sage/files/ticket11749/trac_11749-remove_unneeded_imports-rebased_on_4.7.2.alpha3.reviewer.patch.gz) to the Sage library.\n+\n``````\n",
    "created_at": "2011-09-17T04:03:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124361",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,5 +2,11 @@
 
 ---
 
-Apply [attachment: 11749-unneeded-imports.patch](https://github.com/sagemath/sage/files/ticket11749/11749-unneeded-imports.patch.gz) to the Sage library.
+The patch below is the result of applying Robert's original patch (which was based on Sage 4.7.1) to the (presumably) final version of Sage 4.7.2.alpha3, ignoring rejects, and with some manual corrections due to afterwards occurring import errors when trying to start up Sage or running `ptestlong`.
 
+The current omissions will be dealt with on follow-up tickets.
+
+---
+
+Apply only [attachment: trac_11749-remove_unneeded_imports-rebased_on_4.7.2.alpha3.reviewer.patch](https://github.com/sagemath/sage/files/ticket11749/trac_11749-remove_unneeded_imports-rebased_on_4.7.2.alpha3.reviewer.patch.gz) to the Sage library.
+
``````




---

archive/issue_comments_124362.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">Comment 20</div>\n\nAttachment: **[trac_11749-remove_unneeded_imports-rebased_on_4.7.2.alpha3.reviewer.patch.gz](https://github.com/sagemath/sage/files/ticket11749/trac_11749-remove_unneeded_imports-rebased_on_4.7.2.alpha3.reviewer.patch.gz)**\n\nFixed. :)",
    "created_at": "2011-09-17T04:03:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124362",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:20" align="right">Comment 20</div>

Attachment: **[trac_11749-remove_unneeded_imports-rebased_on_4.7.2.alpha3.reviewer.patch.gz](https://github.com/sagemath/sage/files/ticket11749/trac_11749-remove_unneeded_imports-rebased_on_4.7.2.alpha3.reviewer.patch.gz)**

Fixed. :)



---

archive/issue_events_144197.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-09-17T05:36:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11749#event-144197"
}
```



---

archive/issue_events_144198.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-09-17T05:36:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11749#event-144198"
}
```



---

archive/issue_comments_124363.json:
```json
{
    "body": "Merged: **sage-4.7.2.alpha3**",
    "created_at": "2011-09-17T05:36:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124363",
    "user": "https://github.com/nexttime"
}
```

Merged: **sage-4.7.2.alpha3**



---

archive/issue_comments_124364.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">Comment 21</div>\n\n**We shouldn't forget to open a follow-up.**\n\nI'll attach the logs later, either here or to another ticket in case someone opened one then...",
    "created_at": "2011-09-17T05:36:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124364",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:21" align="right">Comment 21</div>

**We shouldn't forget to open a follow-up.**

I'll attach the logs later, either here or to another ticket in case someone opened one then...



---

archive/issue_comments_124365.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">Comment 22</div>\n\nFollowup ticket is at #11811.",
    "created_at": "2011-09-17T05:49:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124365",
    "user": "https://github.com/kini"
}
```

<div id="comment:22" align="right">Comment 22</div>

Followup ticket is at #11811.



---

archive/issue_comments_124366.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">Comment 23</div>\n\nI understand the rationale for that patch, but I hope you realize that such patch bombs inflict a lot of rebasing work. I just spent half a day, if not more, rebasing the sage-combinat patch queue. Please, please let us know in advance about it next time. \n\nCheers,\n                                   Nicolas",
    "created_at": "2011-11-08T11:26:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124366",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:23" align="right">Comment 23</div>

I understand the rationale for that patch, but I hope you realize that such patch bombs inflict a lot of rebasing work. I just spent half a day, if not more, rebasing the sage-combinat patch queue. Please, please let us know in advance about it next time. 

Cheers,
                                   Nicolas



---

archive/issue_comments_124367.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">Comment 24</div>\n\nSorry Nicolas, I didn't know about your guys' hundreds of patches queue when I reviewed this ticket :( Next time I'll cc you to tickets I see with broad patches.",
    "created_at": "2011-11-08T12:41:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124367",
    "user": "https://github.com/kini"
}
```

<div id="comment:24" align="right">Comment 24</div>

Sorry Nicolas, I didn't know about your guys' hundreds of patches queue when I reviewed this ticket :( Next time I'll cc you to tickets I see with broad patches.



---

archive/issue_comments_124368.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">Comment 25</div>\n\nReplying to [@kini](#comment%3A24):\n> Sorry Nicolas, I didn't know about your guys' hundreds of patches queue when I reviewed this ticket :( Next time I'll cc you to tickets I see with broad patches.\n\nThanks!",
    "created_at": "2011-11-08T12:46:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124368",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:25" align="right">Comment 25</div>

Replying to [@kini](#comment%3A24):
> Sorry Nicolas, I didn't know about your guys' hundreds of patches queue when I reviewed this ticket :( Next time I'll cc you to tickets I see with broad patches.

Thanks!



---

archive/issue_comments_124369.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">Comment 26</div>\n\nDid you see the follow up of this ticket also Nicolas?  It's #11762 it also touches quite a lot, but it are just __init__.py files so it should not conflict a lot with your patch queue.",
    "created_at": "2011-11-08T13:14:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11749",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11749#issuecomment-124369",
    "user": "https://github.com/koffie"
}
```

<div id="comment:26" align="right">Comment 26</div>

Did you see the follow up of this ticket also Nicolas?  It's #11762 it also touches quite a lot, but it are just __init__.py files so it should not conflict a lot with your patch queue.
