# Issue 11930: disallow non-smooth hyperelliptic curves, and let hyperelliptic curves know they are not singular

archive/issues_011758.json:
```json
{
    "body": "Hyperelliptic curves are smooth curves mathematically. These patches add a check for this to the constructor and implement `is_singular` to always return `False`\n\nExample\n\n```\nsage: R.<x> = PolynomialRing(GF(3))\nsage: H=HyperellipticCurve(x^5+1)\nsage: H.is_singular()\n# used to return True, now returns False\nsage: H.is_smooth()\n# used to return False, now returns True\nsage: HyperellipticCurve(x^5)\n# used to return a curve y^2 = x^5, now raises an error\n```\n\nApply\n\n* [attachment:11930d.patch]\n* [attachment:11930_is_singular2.patch]\n\n**Assignee:** @JohnCremona\n\n**CC:**  d.testa@warwick.ac.uk jpflori davideklund\n\n**Keywords:** hyperelliptic curve singular smooth sd35\n\n**Reviewer:** Marco Streng, Damiano Testa, David Eklund\n\n**Author:** Daniel Krenn, Marco Streng, Damiano Testa\n\n**Merged:** sage-5.1.beta2\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/11930\n\n",
    "closed_at": "2012-06-02T12:10:15Z",
    "created_at": "2011-10-17T14:12:59Z",
    "labels": [
        "component: elliptic curves",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.1",
    "title": "disallow non-smooth hyperelliptic curves, and let hyperelliptic curves know they are not singular",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11930",
    "user": "https://github.com/dkrenn"
}
```
Hyperelliptic curves are smooth curves mathematically. These patches add a check for this to the constructor and implement `is_singular` to always return `False`

Example

```
sage: R.<x> = PolynomialRing(GF(3))
sage: H=HyperellipticCurve(x^5+1)
sage: H.is_singular()
# used to return True, now returns False
sage: H.is_smooth()
# used to return False, now returns True
sage: HyperellipticCurve(x^5)
# used to return a curve y^2 = x^5, now raises an error
```

Apply

* [attachment:11930d.patch]
* [attachment:11930_is_singular2.patch]

**Assignee:** @JohnCremona

**CC:**  d.testa@warwick.ac.uk jpflori davideklund

**Keywords:** hyperelliptic curve singular smooth sd35

**Reviewer:** Marco Streng, Damiano Testa, David Eklund

**Author:** Daniel Krenn, Marco Streng, Damiano Testa

**Merged:** sage-5.1.beta2

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/11930





---

archive/issue_comments_169749.json:
```json
{
    "body": "<a id='comment:1'></a>\nThis is a good idea.  When we implemented the one-line test for nonsingularity of general curves over finite fields last year (after discovering to our surprise that it was not implemented) we did not think of this special case.  The generic is_singular() method is defined in sage/schemes/plane_curves/projective_curve.py as a method of class ProjectiveCurve_generic.  Your H is of a derived class, so it would be possible to write a different is_singular() method for that subclass.",
    "created_at": "2011-10-17T15:59:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169749",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:1'></a>
This is a good idea.  When we implemented the one-line test for nonsingularity of general curves over finite fields last year (after discovering to our surprise that it was not implemented) we did not think of this special case.  The generic is_singular() method is defined in sage/schemes/plane_curves/projective_curve.py as a method of class ProjectiveCurve_generic.  Your H is of a derived class, so it would be possible to write a different is_singular() method for that subclass.



---

archive/issue_comments_169750.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2011-11-02T14:49:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169750",
    "user": "https://github.com/dkrenn"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_169751.json:
```json
{
    "body": "<a id='comment:2'></a>\nAttachment [trac_11930_is_singular_hec.patch](tarball://root/attachments/some-uuid/ticket11930/trac_11930_is_singular_hec.patch) by @dkrenn created at 2011-11-02 14:49:51",
    "created_at": "2011-11-02T14:49:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169751",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:2'></a>
Attachment [trac_11930_is_singular_hec.patch](tarball://root/attachments/some-uuid/ticket11930/trac_11930_is_singular_hec.patch) by @dkrenn created at 2011-11-02 14:49:51



---

archive/issue_comments_169752.json:
```json
{
    "body": "**Author:** dkrenn",
    "created_at": "2011-11-04T17:25:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169752",
    "user": "https://github.com/dkrenn"
}
```

**Author:** dkrenn



---

archive/issue_comments_169753.json:
```json
{
    "body": "**Changing author** from \"dkrenn\" to \"Daniel Krenn\".",
    "created_at": "2011-11-04T17:31:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169753",
    "user": "https://github.com/dkrenn"
}
```

**Changing author** from "dkrenn" to "Daniel Krenn".



---

archive/issue_comments_169754.json:
```json
{
    "body": "<a id='comment:5'></a>\nThe cause is of course the computationally convenient, but mathematically inaccurate, ambient space. The curve is smooth and projective, but not in `P^2`:\n\n```\nsage: R.<x> = GF(3)[]\nsage: H = HyperellipticCurve(x^5+1)\nsage: H.ambient_space()\nProjective Space of dimension 2 over Finite Field of size 3\n```",
    "created_at": "2011-12-17T15:07:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169754",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:5'></a>
The cause is of course the computationally convenient, but mathematically inaccurate, ambient space. The curve is smooth and projective, but not in `P^2`:

```
sage: R.<x> = GF(3)[]
sage: H = HyperellipticCurve(x^5+1)
sage: H.ambient_space()
Projective Space of dimension 2 over Finite Field of size 3
```



---

archive/issue_comments_169755.json:
```json
{
    "body": "<a id='comment:6'></a>\nThere is a much faster way to get the same answer for fields of characteristic not 2:\n\n```\nsage: R.<x> = GF(3)[]\nsage: H = HyperellipticCurve(x^5+1)\nsage: timeit('H.is_singular()')\n125 loops, best of 3: 5.14 ms per loop\nsage: timeit('H.hyperelliptic_polynomials()[0].discriminant()!=0')\n625 loops, best of 3: 266 \u00b5s per loop\n```",
    "created_at": "2011-12-17T15:37:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169755",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:6'></a>
There is a much faster way to get the same answer for fields of characteristic not 2:

```
sage: R.<x> = GF(3)[]
sage: H = HyperellipticCurve(x^5+1)
sage: timeit('H.is_singular()')
125 loops, best of 3: 5.14 ms per loop
sage: timeit('H.hyperelliptic_polynomials()[0].discriminant()!=0')
625 loops, best of 3: 266 Âµs per loop
```



---

archive/issue_comments_169756.json:
```json
{
    "body": "**Changing keywords** from \"hyperelliptic curve, singular\" to \"hyperelliptic curve, singular, sd35\".",
    "created_at": "2011-12-18T15:16:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169756",
    "user": "https://github.com/mstreng"
}
```

**Changing keywords** from "hyperelliptic curve, singular" to "hyperelliptic curve, singular, sd35".



---

archive/issue_events_037233.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "rename": {
        "from": "function to check if hyperelliptitc curve is singular in the sense of hyperelliptic curves",
        "to": "function to check if hyperelliptic curve is singular in the sense of hyperelliptic curves"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11930#event-37233"
}
```



---

archive/issue_comments_169757.json:
```json
{
    "body": "<a id='comment:7'></a>\nDisagreement with Magma, there should still be some condition at infinity for this to be a nice hyperelliptic curve. We are now figuring out what that condition should be.\n\n```\nsage: P.<x> = GF(2)[]\nsage: H = HyperellipticCurve(x^6+1, 1)\nsage: H.is_singular()\nFalse\nsage: magma(H)\nTypeError: Error evaluating Magma code.\nRuntime error in 'HyperellipticCurve': Curve is singular at infinity\n```\n\nAlso, it seems from the code in HyperellipticCurve that some partial check for singularity is performed there. Should that be a full check or no check at all?",
    "created_at": "2011-12-18T15:16:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169757",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:7'></a>
Disagreement with Magma, there should still be some condition at infinity for this to be a nice hyperelliptic curve. We are now figuring out what that condition should be.

```
sage: P.<x> = GF(2)[]
sage: H = HyperellipticCurve(x^6+1, 1)
sage: H.is_singular()
False
sage: magma(H)
TypeError: Error evaluating Magma code.
Runtime error in 'HyperellipticCurve': Curve is singular at infinity
```

Also, it seems from the code in HyperellipticCurve that some partial check for singularity is performed there. Should that be a full check or no check at all?



---

archive/issue_comments_169758.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2011-12-18T15:16:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169758",
    "user": "https://github.com/mstreng"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_169759.json:
```json
{
    "body": "**Reviewer:** Marco Streng, Damiano Testa",
    "created_at": "2011-12-18T15:16:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169759",
    "user": "https://github.com/mstreng"
}
```

**Reviewer:** Marco Streng, Damiano Testa



---

archive/issue_comments_169760.json:
```json
{
    "body": "Attachment [11930_singular_hyperelliptic.patch](tarball://root/attachments/some-uuid/ticket11930/11930_singular_hyperelliptic.patch) by @mstreng created at 2011-12-18 20:35:42\n\nchange the constructor of hyperelliptic curve to check if the input makes sense",
    "created_at": "2011-12-18T20:35:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169760",
    "user": "https://github.com/mstreng"
}
```

Attachment [11930_singular_hyperelliptic.patch](tarball://root/attachments/some-uuid/ticket11930/11930_singular_hyperelliptic.patch) by @mstreng created at 2011-12-18 20:35:42

change the constructor of hyperelliptic curve to check if the input makes sense



---

archive/issue_comments_169761.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -6,8 +6,11 @@\n sage: H.is_singular()\n True\n ```\n-but `H` is a non-singular hyperelliptic curve. Although this is **not** an error, since all hyperelliptic curves, where the degree of the defining polynomial is at least 5, have a singularity at infinity. \n+but `H` is a non-singular hyperelliptic curve.\n \n-The term non-singular hyperelliptic curve is used to say that all finite points are non-singular. Therefore it would be nice to have a function that returns the (non-)singularity of the finite points of an hyperelliptic curve.\n+Hyperelliptic curves are smooth curves mathematically. In Sage, they are implemented as plane curves with a singularity at infinity, but that singularity can always be resolved.\n \n+Apply\n \n+* [attachment:11930_singular_hyperelliptic.patch]\n+* [attachment:11930_is_singular.patch]\n``````\n",
    "created_at": "2011-12-18T22:00:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169761",
    "user": "https://github.com/mstreng"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -6,8 +6,11 @@
 sage: H.is_singular()
 True
 ```
-but `H` is a non-singular hyperelliptic curve. Although this is **not** an error, since all hyperelliptic curves, where the degree of the defining polynomial is at least 5, have a singularity at infinity. 
+but `H` is a non-singular hyperelliptic curve.
 
-The term non-singular hyperelliptic curve is used to say that all finite points are non-singular. Therefore it would be nice to have a function that returns the (non-)singularity of the finite points of an hyperelliptic curve.
+Hyperelliptic curves are smooth curves mathematically. In Sage, they are implemented as plane curves with a singularity at infinity, but that singularity can always be resolved.
 
+Apply
 
+* [attachment:11930_singular_hyperelliptic.patch]
+* [attachment:11930_is_singular.patch]
``````




---

archive/issue_comments_169762.json:
```json
{
    "body": "**Changing author** from \"Daniel Krenn\" to \"Daniel Krenn, Marco Streng, Damiano Testa\".",
    "created_at": "2011-12-18T22:00:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169762",
    "user": "https://github.com/mstreng"
}
```

**Changing author** from "Daniel Krenn" to "Daniel Krenn, Marco Streng, Damiano Testa".



---

archive/issue_comments_169763.json:
```json
{
    "body": "**Work_Issues:** add singular examples to the documentation of the constructor, do some tests",
    "created_at": "2011-12-18T22:00:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169763",
    "user": "https://github.com/mstreng"
}
```

**Work_Issues:** add singular examples to the documentation of the constructor, do some tests



---

archive/issue_comments_169764.json:
```json
{
    "body": "<a id='comment:8'></a>\nApply 11930_singular_hyperelliptic.patch and 11930_is_singular.patch\n\nThe first of these patches (written by Damiano and I) adds tests to the HyperellipticCurve constructor. It tests whether the input polynomials f(x) and h(x) really make sense. In other words, it checks if there is some g such that, when f and h are homogenized wrt x to degrees 2g+2 and g+1 respectively, one gets a smooth projective curve. We compared it with the independent implementation in Magma, and the test turns out to be equivalent to Magma's test for all input polynomials over GF(2) and GF(3) where deg(f) is 5 or 6 and deg(h) <= 3.\n\nThe second patch is Daniel's function, but with a simpler algorithm that uses the fact that only smooth curves are constructed.",
    "created_at": "2011-12-18T22:00:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169764",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:8'></a>
Apply 11930_singular_hyperelliptic.patch and 11930_is_singular.patch

The first of these patches (written by Damiano and I) adds tests to the HyperellipticCurve constructor. It tests whether the input polynomials f(x) and h(x) really make sense. In other words, it checks if there is some g such that, when f and h are homogenized wrt x to degrees 2g+2 and g+1 respectively, one gets a smooth projective curve. We compared it with the independent implementation in Magma, and the test turns out to be equivalent to Magma's test for all input polynomials over GF(2) and GF(3) where deg(f) is 5 or 6 and deg(h) <= 3.

The second patch is Daniel's function, but with a simpler algorithm that uses the fact that only smooth curves are constructed.



---

archive/issue_comments_169765.json:
```json
{
    "body": "<a id='comment:9'></a>\nSee also #11800 and #11980",
    "created_at": "2011-12-18T22:16:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169765",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:9'></a>
See also #11800 and #11980



---

archive/issue_comments_169766.json:
```json
{
    "body": "Attachment [11930b.patch](tarball://root/attachments/some-uuid/ticket11930/11930b.patch) by @mstreng created at 2011-12-20 16:35:13\n\nnew version, fixes doctests",
    "created_at": "2011-12-20T16:35:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169766",
    "user": "https://github.com/mstreng"
}
```

Attachment [11930b.patch](tarball://root/attachments/some-uuid/ticket11930/11930b.patch) by @mstreng created at 2011-12-20 16:35:13

new version, fixes doctests



---

archive/issue_comments_169767.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -12,5 +12,5 @@\n \n Apply\n \n-* [attachment:11930_singular_hyperelliptic.patch]\n+* [attachment:11930b.patch]\n * [attachment:11930_is_singular.patch]\n``````\n",
    "created_at": "2011-12-20T16:36:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169767",
    "user": "https://github.com/mstreng"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -12,5 +12,5 @@
 
 Apply
 
-* [attachment:11930_singular_hyperelliptic.patch]
+* [attachment:11930b.patch]
 * [attachment:11930_is_singular.patch]
``````




---

archive/issue_comments_169768.json:
```json
{
    "body": "**Changing work_issues** from \"add singular examples to the documentation of the constructor, do some tests\" to \"make resultants work for more general fields\".",
    "created_at": "2011-12-20T16:36:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169768",
    "user": "https://github.com/mstreng"
}
```

**Changing work_issues** from "add singular examples to the documentation of the constructor, do some tests" to "make resultants work for more general fields".



---

archive/issue_comments_169769.json:
```json
{
    "body": "Attachment [resultant.py](tarball://root/attachments/some-uuid/ticket11930/resultant.py) by @mstreng created at 2011-12-20 16:37:16",
    "created_at": "2011-12-20T16:37:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169769",
    "user": "https://github.com/mstreng"
}
```

Attachment [resultant.py](tarball://root/attachments/some-uuid/ticket11930/resultant.py) by @mstreng created at 2011-12-20 16:37:16



---

archive/issue_comments_169770.json:
```json
{
    "body": "<a id='comment:11'></a>\napply 11930b.patch and 11930_is_singular.patch",
    "created_at": "2011-12-20T16:38:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169770",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:11'></a>
apply 11930b.patch and 11930_is_singular.patch



---

archive/issue_comments_169771.json:
```json
{
    "body": "<a id='comment:12'></a>\nMarco, I tried to apply this patch to 4.7.2 (this is needed to check #11800).\nHowever the example in the description still fails:\n\n```\n----------------------------------------------------------------------\n----------------------------------------------------------------------\nLoading Sage library. Current Mercurial branch is: 11800\nsage: R.<x> = PolynomialRing(GF(3))\nsage: H=HyperellipticCurve(x^5+1)\nsage: H.is_singular()\nTrue\n```\nPaul\n| Sage Version 4.7.2, Release Date: 2011-10-29                       |\n| Type notebook() for the GUI, and license() for information.        |",
    "created_at": "2011-12-24T11:37:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169771",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:12'></a>
Marco, I tried to apply this patch to 4.7.2 (this is needed to check #11800).
However the example in the description still fails:

```
----------------------------------------------------------------------
----------------------------------------------------------------------
Loading Sage library. Current Mercurial branch is: 11800
sage: R.<x> = PolynomialRing(GF(3))
sage: H=HyperellipticCurve(x^5+1)
sage: H.is_singular()
True
```
Paul
| Sage Version 4.7.2, Release Date: 2011-10-29                       |
| Type notebook() for the GUI, and license() for information.        |



---

archive/issue_comments_169772.json:
```json
{
    "body": "<a id='comment:13'></a>\nOops, sorry, yes. I wrote \"True\" in [attachment:11930_is_singular.patch] where it should have been \"False\".",
    "created_at": "2011-12-26T13:28:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169772",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:13'></a>
Oops, sorry, yes. I wrote "True" in [attachment:11930_is_singular.patch] where it should have been "False".



---

archive/issue_comments_169773.json:
```json
{
    "body": "**Changing work_issues** from \"make resultants work for more general fields\" to \"make resultants work for more general fields or (better) implement gcd for polynomial rings over fields and use that\".",
    "created_at": "2011-12-27T13:51:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169773",
    "user": "https://github.com/mstreng"
}
```

**Changing work_issues** from "make resultants work for more general fields" to "make resultants work for more general fields or (better) implement gcd for polynomial rings over fields and use that".



---

archive/issue_comments_169774.json:
```json
{
    "body": "<a id='comment:14'></a>\nI can finish this, but not in the next couple of weeks. If anyone wants to work on this, post to this ticket first.",
    "created_at": "2011-12-27T13:51:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169774",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:14'></a>
I can finish this, but not in the next couple of weeks. If anyone wants to work on this, post to this ticket first.



---

archive/issue_comments_169775.json:
```json
{
    "body": "disallow non-smooth hyperelliptic curves",
    "created_at": "2012-01-07T22:26:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169775",
    "user": "https://github.com/mstreng"
}
```

disallow non-smooth hyperelliptic curves



---

archive/issue_comments_169776.json:
```json
{
    "body": "Attachment [11930c.patch](tarball://root/attachments/some-uuid/ticket11930/11930c.patch) by @mstreng created at 2012-01-07 22:27:37\n\nis_singular always returns False for hyperelliptic curves",
    "created_at": "2012-01-07T22:27:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169776",
    "user": "https://github.com/mstreng"
}
```

Attachment [11930c.patch](tarball://root/attachments/some-uuid/ticket11930/11930c.patch) by @mstreng created at 2012-01-07 22:27:37

is_singular always returns False for hyperelliptic curves



---

archive/issue_comments_169777.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,16 +1,17 @@\n-We have\n+Hyperelliptic curves are smooth curves mathematically. These patches add a check for this to the constructor and implement `is_singular` to always return `False`\n+\n+Example\n \n ```\n sage: R.<x> = PolynomialRing(GF(3))\n sage: H=HyperellipticCurve(x^5+1)\n sage: H.is_singular()\n-True\n+# used to return True, now returns False\n+sage: H=HyperellipticCurve(x^5)\n+# used to return a curve y^2 = x^5, now raises an error\n ```\n-but `H` is a non-singular hyperelliptic curve.\n-\n-Hyperelliptic curves are smooth curves mathematically. In Sage, they are implemented as plane curves with a singularity at infinity, but that singularity can always be resolved.\n \n Apply\n \n-* [attachment:11930b.patch]\n+* [attachment:11930c.patch]\n * [attachment:11930_is_singular.patch]\n``````\n",
    "created_at": "2012-01-07T22:34:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169777",
    "user": "https://github.com/mstreng"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,16 +1,17 @@
-We have
+Hyperelliptic curves are smooth curves mathematically. These patches add a check for this to the constructor and implement `is_singular` to always return `False`
+
+Example
 
 ```
 sage: R.<x> = PolynomialRing(GF(3))
 sage: H=HyperellipticCurve(x^5+1)
 sage: H.is_singular()
-True
+# used to return True, now returns False
+sage: H=HyperellipticCurve(x^5)
+# used to return a curve y^2 = x^5, now raises an error
 ```
-but `H` is a non-singular hyperelliptic curve.
-
-Hyperelliptic curves are smooth curves mathematically. In Sage, they are implemented as plane curves with a singularity at infinity, but that singularity can always be resolved.
 
 Apply
 
-* [attachment:11930b.patch]
+* [attachment:11930c.patch]
 * [attachment:11930_is_singular.patch]
``````




---

archive/issue_comments_169778.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2012-01-07T22:34:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169778",
    "user": "https://github.com/mstreng"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_events_037234.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "rename": {
        "from": "function to check if hyperelliptic curve is singular in the sense of hyperelliptic curves",
        "to": "disallow non-smooth hyperelliptic curves, and let hyperelliptic curves know they are not singular"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11930#event-37234"
}
```



---

archive/issue_comments_169779.json:
```json
{
    "body": "<a id='comment:16'></a>\nAttachment [11930_is_singular.patch](tarball://root/attachments/some-uuid/ticket11930/11930_is_singular.patch) by @mstreng created at 2012-01-07 22:34:12",
    "created_at": "2012-01-07T22:34:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169779",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:16'></a>
Attachment [11930_is_singular.patch](tarball://root/attachments/some-uuid/ticket11930/11930_is_singular.patch) by @mstreng created at 2012-01-07 22:34:12



---

archive/issue_comments_169780.json:
```json
{
    "body": "**Changing work_issues** from \"make resultants work for more general fields or (better) implement gcd for polynomial rings over fields and use that\" to \"\".",
    "created_at": "2012-01-07T22:34:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169780",
    "user": "https://github.com/mstreng"
}
```

**Changing work_issues** from "make resultants work for more general fields or (better) implement gcd for polynomial rings over fields and use that" to "".



---

archive/issue_comments_169781.json:
```json
{
    "body": "<a id='comment:17'></a>\nTo check whether a polynomial has repeated roots, this patch uses both GCDs and resultants. It tries the GCD first, because that is fastest. If that fails, it tries the resultant.\n\nThe reason for needing both gcds and resultants is actually quite funny: Qp has no gcd currently implemented in Sage, while extensions of Qp have no resultants in Sage!\n\nWith 4.8.alpha4, I get\n\n```\nsage: P.<x> = Qp(5,7)[]\nsage: x.gcd(x)\n# AttributeError: 'Polynomial_padic_capped_relative_dense' object has no attribute 'gcd'\nsage: x.resultant(x)\n# 0\nsage: K.<a> = Qp(5,7).extension(x^2-5)\nsage: P.<x> = K[]\nsage: x.gcd(x)\n# (1 + O(a^14))*x\nsage: x.resultant(x)\n# TypeError: no conversion of this ring to a Singular ring defined\n```",
    "created_at": "2012-01-07T22:44:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169781",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:17'></a>
To check whether a polynomial has repeated roots, this patch uses both GCDs and resultants. It tries the GCD first, because that is fastest. If that fails, it tries the resultant.

The reason for needing both gcds and resultants is actually quite funny: Qp has no gcd currently implemented in Sage, while extensions of Qp have no resultants in Sage!

With 4.8.alpha4, I get

```
sage: P.<x> = Qp(5,7)[]
sage: x.gcd(x)
# AttributeError: 'Polynomial_padic_capped_relative_dense' object has no attribute 'gcd'
sage: x.resultant(x)
# 0
sage: K.<a> = Qp(5,7).extension(x^2-5)
sage: P.<x> = K[]
sage: x.gcd(x)
# (1 + O(a^14))*x
sage: x.resultant(x)
# TypeError: no conversion of this ring to a Singular ring defined
```



---

archive/issue_comments_169782.json:
```json
{
    "body": "**Changing keywords** from \"hyperelliptic curve, singular, sd35\" to \"hyperelliptic curve singular smooth sd35\".",
    "created_at": "2012-01-07T22:46:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169782",
    "user": "https://github.com/mstreng"
}
```

**Changing keywords** from "hyperelliptic curve, singular, sd35" to "hyperelliptic curve singular smooth sd35".



---

archive/issue_comments_169783.json:
```json
{
    "body": "<a id='comment:18'></a>\nPatch was written on top of 4.8.alpha4.\nApply 11930c.patch and 11930_is_singular.patch",
    "created_at": "2012-01-07T22:46:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169783",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:18'></a>
Patch was written on top of 4.8.alpha4.
Apply 11930c.patch and 11930_is_singular.patch



---

archive/issue_comments_169784.json:
```json
{
    "body": "<a id='comment:19'></a>\nI'm not happy with this:\n\n```\n \t51\t    .. NOTE:: \n \t52\t \n \t53\t        The words \"hyperelliptic curve\" are normally only used for curves of \n \t54\t        genus at least two, but this class allows more general smooth double \n \t55\t        covers of the projective line (conics and elliptic curves), even though \n \t56\t        the class is not meant for those and some outputs may be incorrect.\n```\nI don't think we can merge this if we know or suspect that it gives incorrect results! We should either raise an error in these cases, or check that the results that are returned are correct.",
    "created_at": "2012-03-13T00:02:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169784",
    "user": "https://github.com/loefflerd"
}
```

<a id='comment:19'></a>
I'm not happy with this:

```
 	51	    .. NOTE:: 
 	52	 
 	53	        The words "hyperelliptic curve" are normally only used for curves of 
 	54	        genus at least two, but this class allows more general smooth double 
 	55	        covers of the projective line (conics and elliptic curves), even though 
 	56	        the class is not meant for those and some outputs may be incorrect.
```
I don't think we can merge this if we know or suspect that it gives incorrect results! We should either raise an error in these cases, or check that the results that are returned are correct.



---

archive/issue_comments_169785.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2012-03-13T00:02:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169785",
    "user": "https://github.com/loefflerd"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_169786.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [davidloeffler](#comment%3A19):\n> I'm not happy with this:\n\n\n...\n\n> I don't think we can merge this if we know or suspect that it gives incorrect results! We should either raise an error in these cases, or check that the results that are returned are correct.\n\n\nHi David,\n\nThis \"NOTE\" is just a warning that we added about the code as it was. It is not about a change that we are making. We decided to leave support for conics and elliptic curves intact, as people may be running a loop over general double covers, or not care too much.\n\nRemoving support for conics and elliptic curves would be something for a discussion on sage-nt, and then a new ticket. I can remove this note if you'd like, and leave the rest of the patch as it is. Would that be an improvement?\n\nMarco",
    "created_at": "2012-03-13T06:40:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169786",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:20'></a>
Replying to [davidloeffler](#comment%3A19):
> I'm not happy with this:


...

> I don't think we can merge this if we know or suspect that it gives incorrect results! We should either raise an error in these cases, or check that the results that are returned are correct.


Hi David,

This "NOTE" is just a warning that we added about the code as it was. It is not about a change that we are making. We decided to leave support for conics and elliptic curves intact, as people may be running a loop over general double covers, or not care too much.

Removing support for conics and elliptic curves would be something for a discussion on sage-nt, and then a new ticket. I can remove this note if you'd like, and leave the rest of the patch as it is. Would that be an improvement?

Marco



---

archive/issue_comments_169787.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2012-03-20T06:55:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169787",
    "user": "https://github.com/mstreng"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_169788.json:
```json
{
    "body": "<a id='comment:22'></a>\nI tested this on Sage 4.8.\n\nThere is a method is_smooth() which can be applied to a hyperelliptic curve. With the patches applied:\n\n```\nsage: R.<x> = PolynomialRing(GF(3))\nsage: H=HyperellipticCurve(x^5+1)\nsage: H.is_singular()\nFalse\nsage: H.is_smooth()\nFalse\n```\n\nMaybe these two methods should give consistent results. The is_smooth() method seems to be defined in the class AlgebraicScheme_subscheme_projective in algebraic_scheme.py.",
    "created_at": "2012-05-04T22:57:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169788",
    "user": "https://trac.sagemath.org/admin/accounts/users/davideklund"
}
```

<a id='comment:22'></a>
I tested this on Sage 4.8.

There is a method is_smooth() which can be applied to a hyperelliptic curve. With the patches applied:

```
sage: R.<x> = PolynomialRing(GF(3))
sage: H=HyperellipticCurve(x^5+1)
sage: H.is_singular()
False
sage: H.is_smooth()
False
```

Maybe these two methods should give consistent results. The is_smooth() method seems to be defined in the class AlgebraicScheme_subscheme_projective in algebraic_scheme.py.



---

archive/issue_comments_169789.json:
```json
{
    "body": "**Changing reviewer** from \"Marco Streng, Damiano Testa\" to \"Marco Streng, Damiano Testa, David Eklund\".",
    "created_at": "2012-05-04T22:57:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169789",
    "user": "https://trac.sagemath.org/admin/accounts/users/davideklund"
}
```

**Changing reviewer** from "Marco Streng, Damiano Testa" to "Marco Streng, Damiano Testa, David Eklund".



---

archive/issue_comments_169790.json:
```json
{
    "body": "<a id='comment:23'></a>\nReplying to [davideklund](#comment%3A22):\n> Maybe these two methods should give consistent results.\n\n\nyes (go ahead)",
    "created_at": "2012-05-05T08:22:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169790",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:23'></a>
Replying to [davideklund](#comment%3A22):
> Maybe these two methods should give consistent results.


yes (go ahead)



---

archive/issue_comments_169791.json:
```json
{
    "body": "<a id='comment:24'></a>\nReplying to [mstreng](#comment%3A23):\n> Replying to [davideklund](#comment%3A22):\n> > Maybe these two methods should give consistent results.\n\n> \n> yes (go ahead)\n\n\n(to elaborate on this: I don't have time now, but yes, it would be good if is_smooth() always returns True for these curves)",
    "created_at": "2012-05-05T08:25:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169791",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:24'></a>
Replying to [mstreng](#comment%3A23):
> Replying to [davideklund](#comment%3A22):
> > Maybe these two methods should give consistent results.

> 
> yes (go ahead)


(to elaborate on this: I don't have time now, but yes, it would be good if is_smooth() always returns True for these curves)



---

archive/issue_comments_169792.json:
```json
{
    "body": "use this instead of 11930_is_singular.patch",
    "created_at": "2012-05-11T12:05:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169792",
    "user": "https://github.com/mstreng"
}
```

use this instead of 11930_is_singular.patch



---

archive/issue_comments_169793.json:
```json
{
    "body": "<a id='comment:25'></a>\nAttachment [11930_is_singular2.patch](tarball://root/attachments/some-uuid/ticket11930/11930_is_singular2.patch) by @mstreng created at 2012-05-11 12:08:26",
    "created_at": "2012-05-11T12:08:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169793",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:25'></a>
Attachment [11930_is_singular2.patch](tarball://root/attachments/some-uuid/ticket11930/11930_is_singular2.patch) by @mstreng created at 2012-05-11 12:08:26



---

archive/issue_comments_169794.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -7,11 +7,13 @@\n sage: H=HyperellipticCurve(x^5+1)\n sage: H.is_singular()\n # used to return True, now returns False\n-sage: H=HyperellipticCurve(x^5)\n+sage: H.is_smooth()\n+# used to return False, now returns True\n+sage: HyperellipticCurve(x^5)\n # used to return a curve y^2 = x^5, now raises an error\n ```\n \n Apply\n \n * [attachment:11930c.patch]\n-* [attachment:11930_is_singular.patch]\n+* [attachment:11930_is_singular2.patch]\n``````\n",
    "created_at": "2012-05-11T12:08:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169794",
    "user": "https://github.com/mstreng"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -7,11 +7,13 @@
 sage: H=HyperellipticCurve(x^5+1)
 sage: H.is_singular()
 # used to return True, now returns False
-sage: H=HyperellipticCurve(x^5)
+sage: H.is_smooth()
+# used to return False, now returns True
+sage: HyperellipticCurve(x^5)
 # used to return a curve y^2 = x^5, now raises an error
 ```
 
 Apply
 
 * [attachment:11930c.patch]
-* [attachment:11930_is_singular.patch]
+* [attachment:11930_is_singular2.patch]
``````




---

archive/issue_comments_169795.json:
```json
{
    "body": "<a id='comment:26'></a>\nReplying to [davideklund](#comment%3A22):\n> Maybe these two methods should give consistent results.\n\n\nThanks, they do now. So the ticket needs review again.",
    "created_at": "2012-05-11T21:43:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169795",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:26'></a>
Replying to [davideklund](#comment%3A22):
> Maybe these two methods should give consistent results.


Thanks, they do now. So the ticket needs review again.



---

archive/issue_comments_169796.json:
```json
{
    "body": "<a id='comment:27'></a>\nReplying to [mstreng](#comment%3A26):\n> Replying to [davideklund](#comment%3A22):\n> > Maybe these two methods should give consistent results.\n\n> \n> Thanks, they do now. So the ticket needs review again.\n\n\nOk, nice. I'm on it!",
    "created_at": "2012-05-13T16:04:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169796",
    "user": "https://trac.sagemath.org/admin/accounts/users/davideklund"
}
```

<a id='comment:27'></a>
Replying to [mstreng](#comment%3A26):
> Replying to [davideklund](#comment%3A22):
> > Maybe these two methods should give consistent results.

> 
> Thanks, they do now. So the ticket needs review again.


Ok, nice. I'm on it!



---

archive/issue_comments_169797.json:
```json
{
    "body": "<a id='comment:28'></a>\nApply 11930c.patch and 11930_is_singular2.patch",
    "created_at": "2012-05-13T16:13:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169797",
    "user": "https://trac.sagemath.org/admin/accounts/users/davideklund"
}
```

<a id='comment:28'></a>
Apply 11930c.patch and 11930_is_singular2.patch



---

archive/issue_comments_169798.json:
```json
{
    "body": "<a id='comment:29'></a>\nThese patches look good. I'll be back in a few days after having looked a bit more on the details.\n\nIn the meantime, here is a question/issue: when I apply 11930c.patch using Sage 5.0 (on OS X lion 10.7.3) I get the following:\n\n```\npatching file sage/schemes/hyperelliptic_curves/hyperelliptic_finite_field.py}}}\\\\\n{{{Hunk #8 succeeded at 653 with fuzz 1 (offset 95 lines).}}}\n\nI'm not sure what this means or how to get rid off the fuzz.",
    "created_at": "2012-05-17T20:12:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169798",
    "user": "https://trac.sagemath.org/admin/accounts/users/davideklund"
}
```

<a id='comment:29'></a>
These patches look good. I'll be back in a few days after having looked a bit more on the details.

In the meantime, here is a question/issue: when I apply 11930c.patch using Sage 5.0 (on OS X lion 10.7.3) I get the following:

```
patching file sage/schemes/hyperelliptic_curves/hyperelliptic_finite_field.py}}}\\
{{{Hunk #8 succeeded at 653 with fuzz 1 (offset 95 lines).}}}

I'm not sure what this means or how to get rid off the fuzz.



---

archive/issue_comments_169799.json:
```json
{
    "body": "<a id='comment:30'></a>\nReplying to [davideklund](#comment%3A29):\n> I'm not sure what this means or how to get rid off the fuzz.\n\n\nWhen applying the patch, mercurial will look for a certain block of code and replace it by another. The code to look for also has three surrounding unchanged lines on each side. Fuzz means that there is a slight mismatch in the surrounding code, due to changes in Sage between after I wrote the patch. More precisely, fuzz n means that a block can only be matched if the outermost n lines of the surrounding code are ignored. I've seen patches be rejected because of fuzz 2, but I think fuzz 1 is fine: there are still 2 lines unchanged around every patched line.\n\nIn this particular case, it means that a doctest nearby one of the changed doctests in hyperelliptic_finite_field.py has changed since I wrote the patch.\n\nTo get rid of the fuzz, the patch can be rebased (apply to latest version, then qrefresh and export), but I don't think it is necessary with fuzz 1.",
    "created_at": "2012-05-18T08:28:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169799",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:30'></a>
Replying to [davideklund](#comment%3A29):
> I'm not sure what this means or how to get rid off the fuzz.


When applying the patch, mercurial will look for a certain block of code and replace it by another. The code to look for also has three surrounding unchanged lines on each side. Fuzz means that there is a slight mismatch in the surrounding code, due to changes in Sage between after I wrote the patch. More precisely, fuzz n means that a block can only be matched if the outermost n lines of the surrounding code are ignored. I've seen patches be rejected because of fuzz 2, but I think fuzz 1 is fine: there are still 2 lines unchanged around every patched line.

In this particular case, it means that a doctest nearby one of the changed doctests in hyperelliptic_finite_field.py has changed since I wrote the patch.

To get rid of the fuzz, the patch can be rebased (apply to latest version, then qrefresh and export), but I don't think it is necessary with fuzz 1.



---

archive/issue_comments_169800.json:
```json
{
    "body": "<a id='comment:31'></a>\nReplying to [mstreng](#comment%3A30):\n\nOk. Thank you for that explanation.\n\n> Replying to [davideklund](#comment%3A29):\n> > I'm not sure what this means or how to get rid off the fuzz.\n\n> \n> When applying the patch, mercurial will look for a certain block of code and replace it by another. The code to look for also has three surrounding unchanged lines on each side. Fuzz means that there is a slight mismatch in the surrounding code, due to changes in Sage between after I wrote the patch. More precisely, fuzz n means that a block can only be matched if the outermost n lines of the surrounding code are ignored. I've seen patches be rejected because of fuzz 2, but I think fuzz 1 is fine: there are still 2 lines unchanged around every patched line.\n> \n> In this particular case, it means that a doctest nearby one of the changed doctests in hyperelliptic_finite_field.py has changed since I wrote the patch.\n> \n> To get rid of the fuzz, the patch can be rebased (apply to latest version, then qrefresh and export), but I don't think it is necessary with fuzz 1.\n\n>",
    "created_at": "2012-05-18T16:06:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169800",
    "user": "https://trac.sagemath.org/admin/accounts/users/davideklund"
}
```

<a id='comment:31'></a>
Replying to [mstreng](#comment%3A30):

Ok. Thank you for that explanation.

> Replying to [davideklund](#comment%3A29):
> > I'm not sure what this means or how to get rid off the fuzz.

> 
> When applying the patch, mercurial will look for a certain block of code and replace it by another. The code to look for also has three surrounding unchanged lines on each side. Fuzz means that there is a slight mismatch in the surrounding code, due to changes in Sage between after I wrote the patch. More precisely, fuzz n means that a block can only be matched if the outermost n lines of the surrounding code are ignored. I've seen patches be rejected because of fuzz 2, but I think fuzz 1 is fine: there are still 2 lines unchanged around every patched line.
> 
> In this particular case, it means that a doctest nearby one of the changed doctests in hyperelliptic_finite_field.py has changed since I wrote the patch.
> 
> To get rid of the fuzz, the patch can be rebased (apply to latest version, then qrefresh and export), but I don't think it is necessary with fuzz 1.

>



---

archive/issue_comments_169801.json:
```json
{
    "body": "<a id='comment:32'></a>\nHere are two more beginner questions related to these patches: \n\nI have a recurring doc-test failure (Sage 5.0 on Mac OS lion) so I can't really doc-test these patches locally without failures. But I interpret what the patch-bot has done on this ticket as sufficient for a positive review as far as doc-testing goes (it seems that all tests pass). Sounds reasonable?\n\nThe patch-bot's blue blob and the \"plug-in failed\" I believe is only about trailing white space, and therefore harmless. Sounds reasonable?",
    "created_at": "2012-05-18T16:21:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169801",
    "user": "https://trac.sagemath.org/admin/accounts/users/davideklund"
}
```

<a id='comment:32'></a>
Here are two more beginner questions related to these patches: 

I have a recurring doc-test failure (Sage 5.0 on Mac OS lion) so I can't really doc-test these patches locally without failures. But I interpret what the patch-bot has done on this ticket as sufficient for a positive review as far as doc-testing goes (it seems that all tests pass). Sounds reasonable?

The patch-bot's blue blob and the "plug-in failed" I believe is only about trailing white space, and therefore harmless. Sounds reasonable?



---

archive/issue_comments_169802.json:
```json
{
    "body": "<a id='comment:33'></a>\nReplying to [davideklund](#comment%3A32):\n> Here are two more beginner questions related to these patches: \n\n\nIt may be better to ask these in email or on the mailing lists, but I'll just answer them anyway.\n\n>\n> I have a recurring doc-test failure (Sage 5.0 on Mac OS lion) so I can't really doc-test these patches locally without failures. But I interpret what the patch-bot has done on this ticket as sufficient for a positive review as far as doc-testing goes (it seems that all tests pass). Sounds reasonable?\n\n\nI'm not sure whether just using the patchbot is ok. According to the [developer's guide](http://www.sagemath.org/doc/developer/walk_through.html#reviewing-a-patch), you are supposed to run the tests marked \"#long\" as well, and I don't see where the patchbot does this.\n\nAs for your failing tests, any tests that fail on an unpatched Sage can be safely ignored, they are not due to the patch.\n\n>\n> The patch-bot's blue blob and the \"plug-in failed\" I believe is only about trailing white space, and therefore harmless. Sounds reasonable?\n\n\nIn this particular case, it is ok.\n\nIn detail: it seems that many people are very annoyed by trailing whitespaces on non-empty lines (see [here](http://groups.google.com/group/sage-devel/browse_thread/thread/f6a783b3a52bfa5d/30809dba7cfb13dd)), hence don't want any new ones to be introduced. That's probably where the plugin came from in the first place. In any case, I just checked and this patch does not introduce any new trailing whitespaces on non-empty lines. I did change two lines that already had trailing whitespaces, which I didn't notice, so I did not remove them. That's where the plugin warning comes from.",
    "created_at": "2012-05-18T16:53:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169802",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:33'></a>
Replying to [davideklund](#comment%3A32):
> Here are two more beginner questions related to these patches: 


It may be better to ask these in email or on the mailing lists, but I'll just answer them anyway.

>
> I have a recurring doc-test failure (Sage 5.0 on Mac OS lion) so I can't really doc-test these patches locally without failures. But I interpret what the patch-bot has done on this ticket as sufficient for a positive review as far as doc-testing goes (it seems that all tests pass). Sounds reasonable?


I'm not sure whether just using the patchbot is ok. According to the [developer's guide](http://www.sagemath.org/doc/developer/walk_through.html#reviewing-a-patch), you are supposed to run the tests marked "#long" as well, and I don't see where the patchbot does this.

As for your failing tests, any tests that fail on an unpatched Sage can be safely ignored, they are not due to the patch.

>
> The patch-bot's blue blob and the "plug-in failed" I believe is only about trailing white space, and therefore harmless. Sounds reasonable?


In this particular case, it is ok.

In detail: it seems that many people are very annoyed by trailing whitespaces on non-empty lines (see [here](http://groups.google.com/group/sage-devel/browse_thread/thread/f6a783b3a52bfa5d/30809dba7cfb13dd)), hence don't want any new ones to be introduced. That's probably where the plugin came from in the first place. In any case, I just checked and this patch does not introduce any new trailing whitespaces on non-empty lines. I did change two lines that already had trailing whitespaces, which I didn't notice, so I did not remove them. That's where the plugin warning comes from.



---

archive/issue_comments_169803.json:
```json
{
    "body": "<a id='comment:34'></a>\nAll tests pass except one which fails on an unaltered Sage 5.0 (on OS X 10.7.3). \n\nThe failure was with \"rings/polynomial/pbori.pyx\" and the tests are not flagged # long time and so are covered by the tests run by the patchbot on this ticket.",
    "created_at": "2012-05-19T22:22:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169803",
    "user": "https://trac.sagemath.org/admin/accounts/users/davideklund"
}
```

<a id='comment:34'></a>
All tests pass except one which fails on an unaltered Sage 5.0 (on OS X 10.7.3). 

The failure was with "rings/polynomial/pbori.pyx" and the tests are not flagged # long time and so are covered by the tests run by the patchbot on this ticket.



---

archive/issue_comments_169804.json:
```json
{
    "body": "<a id='comment:35'></a>\nThis all looks good. If the other reviewers agree, we can change the status to positive review.\n\nI only have two small comments on the patches:\n\nAbout the example beginning with \"A hyperelliptic curve should not be given by polynomials of degree greater than `2g+2`, where `g` is the genus.\" I'm not sure I understand what this means. The genus of what? It is slightly unclear since I gather that in this example there is no hyperelliptic curve whose genus we could be referring to. Is it the genus of the desingularization of the corresponding plane curve? The way I view this, the equation `y^2+hy=f`, where `h=x^100` and `f=x<sup>6+1-h</sup>2/4` (appropriately homogenized with `z`) defines a curve in weighted projected space `P(1,100,1)` but that curve is singular at the point `(x,y,z)=(1,-1/2,0)`.\n\nAbout the example beginning \"Input with integer coefficients creates objects with the integers as base ring, but only checks smoothness over `QQ`, not `ZZ`\". Is this to be interpreted as saying that the example provided is not smooth as a scheme over `Spec(ZZ)`?",
    "created_at": "2012-05-20T04:39:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169804",
    "user": "https://trac.sagemath.org/admin/accounts/users/davideklund"
}
```

<a id='comment:35'></a>
This all looks good. If the other reviewers agree, we can change the status to positive review.

I only have two small comments on the patches:

About the example beginning with "A hyperelliptic curve should not be given by polynomials of degree greater than `2g+2`, where `g` is the genus." I'm not sure I understand what this means. The genus of what? It is slightly unclear since I gather that in this example there is no hyperelliptic curve whose genus we could be referring to. Is it the genus of the desingularization of the corresponding plane curve? The way I view this, the equation `y^2+hy=f`, where `h=x^100` and `f=x<sup>6+1-h</sup>2/4` (appropriately homogenized with `z`) defines a curve in weighted projected space `P(1,100,1)` but that curve is singular at the point `(x,y,z)=(1,-1/2,0)`.

About the example beginning "Input with integer coefficients creates objects with the integers as base ring, but only checks smoothness over `QQ`, not `ZZ`". Is this to be interpreted as saying that the example provided is not smooth as a scheme over `Spec(ZZ)`?



---

archive/issue_comments_169805.json:
```json
{
    "body": "<a id='comment:36'></a>\nReplying to [davideklund](#comment%3A35):\n> I only have two small comments on the patches:\n\n\nI don't want the documentation to be confusing, so I'll address your comments and post a new patch.\n\n> \n> About the example beginning with \"A hyperelliptic curve should not be given by polynomials of degree greater than `2g+2`, where `g` is the genus.\" I'm not sure I understand what this means. The genus of what? It is slightly unclear since I gather that in this example there is no hyperelliptic curve whose genus we could be referring to. Is it the genus of the desingularization of the corresponding plane curve?\n\n\nYes, I will explain that better.\n\n> The way I view this, the equation `y^2+hy=f`, where `h=x^100` and `f=x<sup>6+1-h</sup>2/4` (appropriately homogenized with `z`) defines a curve in weighted projected space `P(1,100,1)` but that curve is singular at the point `(x,y,z)=(1,-1/2,0)`.\n\n\nYes, and we should not allow that.\n\n> About the example beginning \"Input with integer coefficients creates objects with the integers as base ring, but only checks smoothness over `QQ`, not `ZZ`\". Is this to be interpreted as saying that the example provided is not smooth as a scheme over `Spec(ZZ)`?\n\n\nYes. But I see that Spec(ZZ) may confuse or scare people, so I will clarify this.",
    "created_at": "2012-05-21T08:05:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169805",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:36'></a>
Replying to [davideklund](#comment%3A35):
> I only have two small comments on the patches:


I don't want the documentation to be confusing, so I'll address your comments and post a new patch.

> 
> About the example beginning with "A hyperelliptic curve should not be given by polynomials of degree greater than `2g+2`, where `g` is the genus." I'm not sure I understand what this means. The genus of what? It is slightly unclear since I gather that in this example there is no hyperelliptic curve whose genus we could be referring to. Is it the genus of the desingularization of the corresponding plane curve?


Yes, I will explain that better.

> The way I view this, the equation `y^2+hy=f`, where `h=x^100` and `f=x<sup>6+1-h</sup>2/4` (appropriately homogenized with `z`) defines a curve in weighted projected space `P(1,100,1)` but that curve is singular at the point `(x,y,z)=(1,-1/2,0)`.


Yes, and we should not allow that.

> About the example beginning "Input with integer coefficients creates objects with the integers as base ring, but only checks smoothness over `QQ`, not `ZZ`". Is this to be interpreted as saying that the example provided is not smooth as a scheme over `Spec(ZZ)`?


Yes. But I see that Spec(ZZ) may confuse or scare people, so I will clarify this.



---

archive/issue_comments_169806.json:
```json
{
    "body": "replaces 11930c.patch: rebased on top of 5.0.beta14, removed trailing whitespaces, clarified examples",
    "created_at": "2012-05-21T09:35:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169806",
    "user": "https://github.com/mstreng"
}
```

replaces 11930c.patch: rebased on top of 5.0.beta14, removed trailing whitespaces, clarified examples



---

archive/issue_comments_169807.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -15,5 +15,5 @@\n \n Apply\n \n-* [attachment:11930c.patch]\n+* [attachment:11930d.patch]\n * [attachment:11930_is_singular2.patch]\n``````\n",
    "created_at": "2012-05-21T09:40:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169807",
    "user": "https://github.com/mstreng"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -15,5 +15,5 @@
 
 Apply
 
-* [attachment:11930c.patch]
+* [attachment:11930d.patch]
 * [attachment:11930_is_singular2.patch]
``````




---

archive/issue_comments_169808.json:
```json
{
    "body": "<a id='comment:37'></a>\nAttachment [11930d.patch](tarball://root/attachments/some-uuid/ticket11930/11930d.patch) by @mstreng created at 2012-05-21 09:40:45\n\nHere's a diff between the c and d patches, excluding changed line numbers and hashes:\n\n```\n< +    This class also allows curves of genus zero or one, which are stricly\n> +    This class also allows curves of genus zero or one, which are strictly\n126,127c126,130\n< +    A hyperelliptic curve should not be given by polynomials of degree greater\n< +    than `2g+2`, where `g` is the genus.::\n> +    The input for a (smooth) hyperelliptic curve of genus `g` should not\n> +    contain polynomials of degree greater than `2g+2`. In the following\n> +    example, the hyperelliptic curve has genus 2 and there exists a model\n> +    `y^2 = F` of degree 6, so the model `y^2 + yh = f` of degree 200 is not\n> +    allowed.::\n137c140\n< +        \n> +\n152c155,157\n< +    as base ring, but only checks smoothness over `QQ`, not `ZZ`::\n---\n> +    as base ring, but only checks smoothness over `\\QQ`, not over Spec(`\\ZZ`).\n> +    In other words, it is checked that the discriminant is non-zero, but it is\n> +    not checked whether the discriminant is a unit in `\\ZZ^*`.::\n155,156c160,161\n< +        sage: HyperellipticCurve(4*x^7+8*x+8)\n< +        Hyperelliptic Curve over Integer Ring defined by y^2 = 4*x^7 + 8*x + 8\n> +        sage: HyperellipticCurve(3*x^7+6*x+6)\n> +        Hyperelliptic Curve over Integer Ring defined by y^2 = 3*x^7 + 6*x + 6\n264c269\n< +            ValueError: curve is not smooth    \n> +            ValueError: curve is not smooth\n273c278\n< +            raise ValueError, \"curve is not smooth\"   \n> +            raise ValueError, \"curve is not smooth\"\n308c313\n<          #checking first that Cartier matrix is not already cached. Since it can be called by either Hasse_Witt or a_number\n>          #checking first that Cartier matrix is not already cached. Since\n```\n\nApply 11930d.patch and then 11930_is_singular2.patch",
    "created_at": "2012-05-21T09:40:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169808",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:37'></a>
Attachment [11930d.patch](tarball://root/attachments/some-uuid/ticket11930/11930d.patch) by @mstreng created at 2012-05-21 09:40:45

Here's a diff between the c and d patches, excluding changed line numbers and hashes:

```
< +    This class also allows curves of genus zero or one, which are stricly
> +    This class also allows curves of genus zero or one, which are strictly
126,127c126,130
< +    A hyperelliptic curve should not be given by polynomials of degree greater
< +    than `2g+2`, where `g` is the genus.::
> +    The input for a (smooth) hyperelliptic curve of genus `g` should not
> +    contain polynomials of degree greater than `2g+2`. In the following
> +    example, the hyperelliptic curve has genus 2 and there exists a model
> +    `y^2 = F` of degree 6, so the model `y^2 + yh = f` of degree 200 is not
> +    allowed.::
137c140
< +        
> +
152c155,157
< +    as base ring, but only checks smoothness over `QQ`, not `ZZ`::
---
> +    as base ring, but only checks smoothness over `\QQ`, not over Spec(`\ZZ`).
> +    In other words, it is checked that the discriminant is non-zero, but it is
> +    not checked whether the discriminant is a unit in `\ZZ^*`.::
155,156c160,161
< +        sage: HyperellipticCurve(4*x^7+8*x+8)
< +        Hyperelliptic Curve over Integer Ring defined by y^2 = 4*x^7 + 8*x + 8
> +        sage: HyperellipticCurve(3*x^7+6*x+6)
> +        Hyperelliptic Curve over Integer Ring defined by y^2 = 3*x^7 + 6*x + 6
264c269
< +            ValueError: curve is not smooth    
> +            ValueError: curve is not smooth
273c278
< +            raise ValueError, "curve is not smooth"   
> +            raise ValueError, "curve is not smooth"
308c313
<          #checking first that Cartier matrix is not already cached. Since it can be called by either Hasse_Witt or a_number
>          #checking first that Cartier matrix is not already cached. Since
```

Apply 11930d.patch and then 11930_is_singular2.patch



---

archive/issue_comments_169809.json:
```json
{
    "body": "<a id='comment:38'></a>\nReplying to [davideklund](#comment%3A35):\n> This all looks good. If the other reviewers agree, we can change the status to positive review.\n\n\nThe other reviewers are the authors of the current version, so you don't need to consult us (we are the ones who set this to \"needs review\" in the first place). If you agree with the new patch, you can set it to \"positive review\" yourself.",
    "created_at": "2012-05-21T09:42:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169809",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:38'></a>
Replying to [davideklund](#comment%3A35):
> This all looks good. If the other reviewers agree, we can change the status to positive review.


The other reviewers are the authors of the current version, so you don't need to consult us (we are the ones who set this to "needs review" in the first place). If you agree with the new patch, you can set it to "positive review" yourself.



---

archive/issue_comments_169810.json:
```json
{
    "body": "<a id='comment:39'></a>\nNice! Those extra comments in the examples really clarified things (for me at least).",
    "created_at": "2012-05-22T00:34:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169810",
    "user": "https://trac.sagemath.org/admin/accounts/users/davideklund"
}
```

<a id='comment:39'></a>
Nice! Those extra comments in the examples really clarified things (for me at least).



---

archive/issue_comments_169811.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2012-05-22T00:34:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169811",
    "user": "https://trac.sagemath.org/admin/accounts/users/davideklund"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_169812.json:
```json
{
    "body": "<a id='comment:40'></a>\nReplying to [davideklund](#comment%3A39).\n\nThanks!",
    "created_at": "2012-05-22T08:03:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169812",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:40'></a>
Replying to [davideklund](#comment%3A39).

Thanks!



---

archive/issue_comments_169813.json:
```json
{
    "body": "**Merged:** sage-5.1.beta2",
    "created_at": "2012-06-02T12:10:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169813",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.1.beta2



---

archive/issue_events_037235.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-06-02T12:10:15Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11930#event-37235"
}
```



---

archive/issue_comments_169814.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2012-06-02T12:10:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11930#issuecomment-169814",
    "user": "https://github.com/jdemeyer"
}
```

**Resolution:** fixed
