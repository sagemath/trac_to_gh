# Issue 11476: PartitionTuples.cardinality has problems

archive/issues_011304.json:
```json
{
    "body": "It works for smaller values.\n\n```\nsage: PartitionTuples(100,13).cardinality()\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n\n/Volumes/Scratch/Users/duser1/sage/<ipython console> in <module>()\n\n/Users/duser1/sage/local/lib/python2.6/site-packages/sage/combinat/partition.pyc in cardinality(self)\n   3183             185\n   3184         \"\"\"\n-> 3185         return ZZ(gp.eval('polcoeff(1/eta(x)^%s, %s, x)'%(self.k, self.n)))\n   3186 \n   3187 \n\n/Users/duser1/sage/local/lib/python2.6/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:6820)()\n\n/Users/duser1/sage/local/lib/python2.6/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3254)()\n\n/Users/duser1/sage/local/lib/python2.6/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3157)()\n\n/Users/duser1/sage/local/lib/python2.6/site-packages/sage/rings/integer.so in sage.rings.integer.Integer.__init__ (sage/rings/integer.c:7212)()\n\nTypeError: unable to convert x (=  ***   at top-level: polcoeff(1/eta(x)^13\n  ***                 ^--------------------\n  *** polcoeff: non existent component in truecoeff.) to an integer\nsage: \n\n```\n\n\nAs noted below, this turned out to just be an issue of increasing the precision in the pari function call. The attached patch fixes the problem:\n\n**Attach**  [attachment:trac_11476--fixing-partition-tuples_cardinality-am.patch]\n\nAssignee: sage-combinat\n\nCC:  sage-combinat\n\nKeywords: PartitionTuple, cardinality, beginner\n\nReviewer: Travis Scrimshaw\n\nAuthor: Andrew Mathas\n\nMerged: sage-5.5.beta2\n\nDependencies: #13072\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/11476\n\n",
    "closed_at": "2012-11-13T08:20:10Z",
    "created_at": "2011-06-14T12:39:53Z",
    "labels": [
        "component: combinatorics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.5",
    "title": "PartitionTuples.cardinality has problems",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11476",
    "user": "https://trac.sagemath.org/admin/accounts/users/pdehaye"
}
```
It works for smaller values.

```
sage: PartitionTuples(100,13).cardinality()
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)

/Volumes/Scratch/Users/duser1/sage/<ipython console> in <module>()

/Users/duser1/sage/local/lib/python2.6/site-packages/sage/combinat/partition.pyc in cardinality(self)
   3183             185
   3184         """
-> 3185         return ZZ(gp.eval('polcoeff(1/eta(x)^%s, %s, x)'%(self.k, self.n)))
   3186 
   3187 

/Users/duser1/sage/local/lib/python2.6/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:6820)()

/Users/duser1/sage/local/lib/python2.6/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3254)()

/Users/duser1/sage/local/lib/python2.6/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3157)()

/Users/duser1/sage/local/lib/python2.6/site-packages/sage/rings/integer.so in sage.rings.integer.Integer.__init__ (sage/rings/integer.c:7212)()

TypeError: unable to convert x (=  ***   at top-level: polcoeff(1/eta(x)^13
  ***                 ^--------------------
  *** polcoeff: non existent component in truecoeff.) to an integer
sage: 

```


As noted below, this turned out to just be an issue of increasing the precision in the pari function call. The attached patch fixes the problem:

**Attach**  [attachment:trac_11476--fixing-partition-tuples_cardinality-am.patch]

Assignee: sage-combinat

CC:  sage-combinat

Keywords: PartitionTuple, cardinality, beginner

Reviewer: Travis Scrimshaw

Author: Andrew Mathas

Merged: sage-5.5.beta2

Dependencies: #13072

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/11476





---

archive/issue_comments_152245.json:
```json
{
    "body": "<a id='comment:1'></a>This seems to be problem in the pari function call, or possibly a bug in pari. I have [emailed](http://pari.math.u-bordeaux.fr/archives/pari-dev-1209/msg00042.html) the pari development group to ask them about it. \n\nThis failure appears much earlier than the example above suggests:\n\n```\nsage: PartitionTuples(17,2).cardinality()\n...\nTypeError: unable to convert x (=  ***   at top-level: polcoeff(1/eta(x)^2,\n  ***                 ^--------------------\n  *** polcoeff: non existent component in truecoeff.) to an integer\n```\n\nIf you run pari natively you get the error more quickly:\n\n```\nDesktop: sage -gp\nGP/PARI CALCULATOR Version 2.5.2 (development git-b703ee3)\ni386 running darwin (x86-64/GMP-5.0.2 kernel) 64-bit version\ncompiled: Sep 12 2012, gcc-4.6.3 (GCC) \n(readline v6.2 enabled, extended help enabled)\n\nCopyright (C) 2000-2011 The PARI Group\n\nPARI/GP is free software, covered by the GNU General Public License, and comes WITHOUT ANY WARRANTY WHATSOEVER.\n\nType ? for help, \\q to quit.\nType ?12 for how to get moral (and possibly technical) support.\n\nparisize = 8000000, primelimit = 500509\n? polcoeff(1/eta(x)^2, 16, x)\n%1 = 5822\n? polcoeff(1/eta(x)^2, 17, x)\n  ***   at top-level: polcoeff(1/eta(x)^2,\n  ***                 ^--------------------\n  *** polcoeff: non existent component in truecoeff.\n  ***   Break loop: type 'break' to go back to GP\n```\n\nThis is a little surprising as the number of 2-tuples of partitions adding to 17 is 8470, which isn't that big.",
    "created_at": "2012-09-21T02:01:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11476#issuecomment-152245",
    "user": "https://github.com/AndrewAtLarge"
}
```

<a id='comment:1'></a>This seems to be problem in the pari function call, or possibly a bug in pari. I have [emailed](http://pari.math.u-bordeaux.fr/archives/pari-dev-1209/msg00042.html) the pari development group to ask them about it. 

This failure appears much earlier than the example above suggests:

```
sage: PartitionTuples(17,2).cardinality()
...
TypeError: unable to convert x (=  ***   at top-level: polcoeff(1/eta(x)^2,
  ***                 ^--------------------
  *** polcoeff: non existent component in truecoeff.) to an integer
```

If you run pari natively you get the error more quickly:

```
Desktop: sage -gp
GP/PARI CALCULATOR Version 2.5.2 (development git-b703ee3)
i386 running darwin (x86-64/GMP-5.0.2 kernel) 64-bit version
compiled: Sep 12 2012, gcc-4.6.3 (GCC) 
(readline v6.2 enabled, extended help enabled)

Copyright (C) 2000-2011 The PARI Group

PARI/GP is free software, covered by the GNU General Public License, and comes WITHOUT ANY WARRANTY WHATSOEVER.

Type ? for help, \q to quit.
Type ?12 for how to get moral (and possibly technical) support.

parisize = 8000000, primelimit = 500509
? polcoeff(1/eta(x)^2, 16, x)
%1 = 5822
? polcoeff(1/eta(x)^2, 17, x)
  ***   at top-level: polcoeff(1/eta(x)^2,
  ***                 ^--------------------
  *** polcoeff: non existent component in truecoeff.
  ***   Break loop: type 'break' to go back to GP
```

This is a little surprising as the number of 2-tuples of partitions adding to 17 is 8470, which isn't that big.



---

archive/issue_comments_152246.json:
```json
{
    "body": "<a id='comment:2'></a>I had a reply from Karim Belabas (UMR 5251) on pari-dev and it is just a matter of increasing the precision:\n\n```\n(08:12) gp > 1/eta(x)^2\n%1 = 1 + 2*x + 5*x^2 + 10*x^3 + 20*x^4 + 36*x^5 + 65*x^6 + 110*x^7 + 185*x^8 + 300*x^9 + 481*x^10 + 752*x^11 + 1165*x^12 + 1770*x^13 + 2665*x^14 + 3956*x^15 + 5822*x^16 + O(x^17)\n\nThe series precision is too low, so the 17-th coefficient is unknown. Use\n\n  1/eta(x + O(x^101))\n\nif you want to access its 100-th coefficient (for instance).\n\nCheers,\n\n    K.B.\n```\n\nI'll upload a patch shortly.",
    "created_at": "2012-09-21T10:29:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11476#issuecomment-152246",
    "user": "https://github.com/AndrewAtLarge"
}
```

<a id='comment:2'></a>I had a reply from Karim Belabas (UMR 5251) on pari-dev and it is just a matter of increasing the precision:

```
(08:12) gp > 1/eta(x)^2
%1 = 1 + 2*x + 5*x^2 + 10*x^3 + 20*x^4 + 36*x^5 + 65*x^6 + 110*x^7 + 185*x^8 + 300*x^9 + 481*x^10 + 752*x^11 + 1165*x^12 + 1770*x^13 + 2665*x^14 + 3956*x^15 + 5822*x^16 + O(x^17)

The series precision is too low, so the 17-th coefficient is unknown. Use

  1/eta(x + O(x^101))

if you want to access its 100-th coefficient (for instance).

Cheers,

    K.B.
```

I'll upload a patch shortly.



---

archive/issue_comments_152247.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-09-21T12:25:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11476#issuecomment-152247",
    "user": "https://github.com/AndrewAtLarge"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_152248.json:
```json
{
    "body": "Changing keywords from \"\" to \"PartitionTuple, cardinality\".",
    "created_at": "2012-09-21T12:25:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11476#issuecomment-152248",
    "user": "https://github.com/AndrewAtLarge"
}
```

Changing keywords from "" to "PartitionTuple, cardinality".



---

archive/issue_comments_152249.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#13072\"",
    "created_at": "2012-09-21T12:25:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11476#issuecomment-152249",
    "user": "https://github.com/AndrewAtLarge"
}
```

Changing dependencies from "" to "#13072"



---

archive/issue_comments_152250.json:
```json
{
    "body": "Changing author from \"\" to \"Andrew Mathas\"",
    "created_at": "2012-09-21T12:25:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11476#issuecomment-152250",
    "user": "https://github.com/AndrewAtLarge"
}
```

Changing author from "" to "Andrew Mathas"



---

archive/issue_comments_152251.json:
```json
{
    "body": "Changing keywords from \"PartitionTuple, cardinality\" to \"PartitionTuple, cardinality, beginner\".",
    "created_at": "2012-09-21T12:29:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11476#issuecomment-152251",
    "user": "https://github.com/AndrewAtLarge"
}
```

Changing keywords from "PartitionTuple, cardinality" to "PartitionTuple, cardinality, beginner".



---

archive/issue_comments_152252.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -29,6 +29,11 @@\n \n ```\n \n+\n+As noted below, this turned out to just be an issue of increasing the precision in the pari function call. The attached patch fixes the problem:\n+\n+**Attach**  [attachment:trac_11476--fixing-partition-tuples_cardinality-am.patch]\n+\n Comment: 1\n \n Issue created by migration from https://trac.sagemath.org/ticket/11476\n``````\n",
    "created_at": "2012-09-24T16:53:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11476#issuecomment-152252",
    "user": "https://github.com/AndrewAtLarge"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -29,6 +29,11 @@
 
 ```
 
+
+As noted below, this turned out to just be an issue of increasing the precision in the pari function call. The attached patch fixes the problem:
+
+**Attach**  [attachment:trac_11476--fixing-partition-tuples_cardinality-am.patch]
+
 Comment: 1
 
 Issue created by migration from https://trac.sagemath.org/ticket/11476
``````




---

archive/issue_comments_152253.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2012-10-13T15:51:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11476#issuecomment-152253",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw"



---

archive/issue_comments_152254.json:
```json
{
    "body": "<a id='comment:6'></a>Looks good, just do an automatic trac link `:trac:`11476`` in the doc.\n\nThanks.\n\nPS - Its somewhat entertaining to me to compute these huge numbers:\n\n```\nsage: PartitionTuples(162,120).cardinality()\n414170543784152902405501503878656556915420510510717572175693806227335527665907778197451415072951\n```",
    "created_at": "2012-10-13T15:51:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11476#issuecomment-152254",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:6'></a>Looks good, just do an automatic trac link `:trac:`11476`` in the doc.

Thanks.

PS - Its somewhat entertaining to me to compute these huge numbers:

```
sage: PartitionTuples(162,120).cardinality()
414170543784152902405501503878656556915420510510717572175693806227335527665907778197451415072951
```



---

archive/issue_comments_152255.json:
```json
{
    "body": "<a id='comment:7'></a>Thanks for catching this...it seems that the version in the queue did this properly but that I hadn't uploaded it here...fixed now.\n\nCheers,\nAndrew\n\nps. I didn't check any of these big numbers by hand:)",
    "created_at": "2012-10-14T13:15:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11476#issuecomment-152255",
    "user": "https://github.com/AndrewAtLarge"
}
```

<a id='comment:7'></a>Thanks for catching this...it seems that the version in the queue did this properly but that I hadn't uploaded it here...fixed now.

Cheers,
Andrew

ps. I didn't check any of these big numbers by hand:)



---

archive/issue_comments_152256.json:
```json
{
    "body": "<a id='comment:8'></a>Thanks! I'll double-check everything once #13072 is fixed up, but basically this is a positive review.",
    "created_at": "2012-10-15T00:14:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11476#issuecomment-152256",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:8'></a>Thanks! I'll double-check everything once #13072 is fixed up, but basically this is a positive review.



---

archive/issue_comments_152257.json:
```json
{
    "body": "<a id='comment:9'></a>I believe this needs to be rebased to remove the fuzz:\n\n```\nHunk #1 succeeded at 1626 with fuzz 1 (offset -1 lines)\n```\nbut good otherwise so I am setting it to a positive review.\n\nTravis",
    "created_at": "2012-10-19T22:58:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11476#issuecomment-152257",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:9'></a>I believe this needs to be rebased to remove the fuzz:

```
Hunk #1 succeeded at 1626 with fuzz 1 (offset -1 lines)
```
but good otherwise so I am setting it to a positive review.

Travis



---

archive/issue_comments_152258.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-10-19T22:58:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11476#issuecomment-152258",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_029866.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-10-23T07:23:12Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11476",
    "milestone": "sage-5.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11476#event-29866"
}
```



---

archive/issue_comments_152259.json:
```json
{
    "body": "Attachment [trac_11476--fixing-partition-tuples_cardinality-am.patch](tarball://root/attachments/some-uuid/ticket11476/trac_11476--fixing-partition-tuples_cardinality-am.patch) by @AndrewAtLarge created at 2012-10-31 06:38:57\n\nFixing fuzz in applying patch",
    "created_at": "2012-10-31T06:38:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11476#issuecomment-152259",
    "user": "https://github.com/AndrewAtLarge"
}
```

Attachment [trac_11476--fixing-partition-tuples_cardinality-am.patch](tarball://root/attachments/some-uuid/ticket11476/trac_11476--fixing-partition-tuples_cardinality-am.patch) by @AndrewAtLarge created at 2012-10-31 06:38:57

Fixing fuzz in applying patch



---

archive/issue_comments_152260.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-11-13T08:20:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11476#issuecomment-152260",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_029867.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-11-13T08:20:10Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11476",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11476#event-29867"
}
```



---

archive/issue_comments_152261.json:
```json
{
    "body": "Changing merged from \"\" to \"sage-5.5.beta2\"",
    "created_at": "2012-11-13T08:20:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11476#issuecomment-152261",
    "user": "https://github.com/jdemeyer"
}
```

Changing merged from "" to "sage-5.5.beta2"
