# Issue 11635: Ensure that libraries link to the shared version of NTL by default

archive/issues_011463.json:
```json
{
    "body": "In #11547, we added copying of several needed dlls on Cygwin.  However, in the meantime NTL had a fairly major update (#5731).\n\nFrom version 5.5, NTL provides a new build system using libtool (although libtool itself is not provided!) to generate shared libraries.\nOn Cygwin, libtool properly install the shared library as cygntl-?.dll in the bin directory and the import file as libntl.dll.a in the lib directory, together with a libtool file libntl.la and a static version of the library as libntl.a.\n\nIn particular, this ensures that the shared version is linked with by default because ld/gcc/g++ find the .dll.a file in the lib directory (which points to the dll file in the bin directory) before the .a file.\n\nMoreover, only moving the previously built libntl.dll to libntl.dll.a was not a solution.\nIndeed, the built file hardcoded its own build-time name into itself (as a DT_SONAME on linux), so that libraries linked to it (before or after renaming, does not matter) would in fact search for a file with the build time name... and fail.\n\n**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/ntl-5.5.2.p0.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/ntl-5.5.2.p0.spkg)\n\nThis spkg vastly simplifies the old spkg-install, uses the (slightly patched) upstream build system and includes its own version of libtool (or rather the tools needed to generate it on the fly).\n\n**CC:**  @mwhansen @dimpase jpflori @jdemeyer\n\n**Keywords:** cygwin ntl libtool spkg\n\n**Reviewer:** Karl-Dieter Crisman\n\n**Author:** Jean-Pierre Flori\n\n**Merged:** sage-5.6.beta3\n\nIssue created by migration from https://trac.sagemath.org/ticket/11635\n\n",
    "closed_at": "2013-01-07T20:55:52Z",
    "created_at": "2011-07-29T15:12:04Z",
    "labels": [
        "component: porting: cygwin",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.6",
    "title": "Ensure that libraries link to the shared version of NTL by default",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/11635",
    "user": "https://github.com/kcrisman"
}
```
In #11547, we added copying of several needed dlls on Cygwin.  However, in the meantime NTL had a fairly major update (#5731).

From version 5.5, NTL provides a new build system using libtool (although libtool itself is not provided!) to generate shared libraries.
On Cygwin, libtool properly install the shared library as cygntl-?.dll in the bin directory and the import file as libntl.dll.a in the lib directory, together with a libtool file libntl.la and a static version of the library as libntl.a.

In particular, this ensures that the shared version is linked with by default because ld/gcc/g++ find the .dll.a file in the lib directory (which points to the dll file in the bin directory) before the .a file.

Moreover, only moving the previously built libntl.dll to libntl.dll.a was not a solution.
Indeed, the built file hardcoded its own build-time name into itself (as a DT_SONAME on linux), so that libraries linked to it (before or after renaming, does not matter) would in fact search for a file with the build time name... and fail.

**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/ntl-5.5.2.p0.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/ntl-5.5.2.p0.spkg)

This spkg vastly simplifies the old spkg-install, uses the (slightly patched) upstream build system and includes its own version of libtool (or rather the tools needed to generate it on the fly).

**CC:**  @mwhansen @dimpase jpflori @jdemeyer

**Keywords:** cygwin ntl libtool spkg

**Reviewer:** Karl-Dieter Crisman

**Author:** Jean-Pierre Flori

**Merged:** sage-5.6.beta3

Issue created by migration from https://trac.sagemath.org/ticket/11635





---

archive/issue_comments_121910.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,6 +1,8 @@\n In #11547, we added copying of several needed dlls on Cygwin.  However, in the meantime NTL had a fairly major update (#5731).\n \n Based on this, this ticket splits off the NTL change from #11547 so that that ticket can get merged.  \n+\n+Spkg at [http://sage.math.washington.edu/home/kcrisman/ntl-5.5.2.p0.spkg](http://sage.math.washington.edu/home/kcrisman/ntl-5.5.2.p0.spkg).\n \n Here is the previous diff - presumably we would do the same thing if we can confirm it is still necessary, which is almost certainly the case.\n \n``````\n",
    "created_at": "2011-07-29T20:04:36Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121910",
    "user": "https://github.com/kcrisman"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,6 +1,8 @@
 In #11547, we added copying of several needed dlls on Cygwin.  However, in the meantime NTL had a fairly major update (#5731).
 
 Based on this, this ticket splits off the NTL change from #11547 so that that ticket can get merged.  
+
+Spkg at [http://sage.math.washington.edu/home/kcrisman/ntl-5.5.2.p0.spkg](http://sage.math.washington.edu/home/kcrisman/ntl-5.5.2.p0.spkg).
 
 Here is the previous diff - presumably we would do the same thing if we can confirm it is still necessary, which is almost certainly the case.
 
``````




---

archive/issue_comments_121911.json:
```json
{
    "body": "<a id='comment:1'></a>\nNew spkg at [http://sage.math.washington.edu/home/kcrisman/ntl-5.5.2.p0.spkg](http://sage.math.washington.edu/home/kcrisman/ntl-5.5.2.p0.spkg).  No guarantees on whether this works, or even is necessary (!) but I strongly suspect both.  You'll know it works if you do everything at #6743, including this, and then Sage has a segfault on startup.\n\nIn case there is any doubt that this is Cygwin-only:\n\n```\n    elif [ $UNAME = \"CYGWIN\" ]; then\n        # Cygwin\n        if [ \"$CYGPKG\" = \"yes\" ]; then\n            if [ -f /lib/libgmp.dll.a ]; then\n                ln -s /lib/libgmp.dll.a libgmp.a\n            else\n                # Added by William Stein on 2006-02-06 so that \n                # can build even if gmp is not built locally\n                # i.e., even if using a system-wide gmp.\n                # (though it has to be in /usr/lib, which is\n                # where it is for cygwin).\n                ln  -s /usr/lib/*gmp* .\n                ln  -s libgmp.dll.a libgmp.a\n            fi \n        else\n   \t    ln -s \"$SAGE_LOCAL/lib/libgmp.a\" .\n        fi\n\t$MAKE libntl.dll\n        if [ ! -f libntl.dll ]; then\n            echo \"Error creating ntl shared library.\"\n            exit 1\n        fi\n\tcp libntl.dll \"$SAGE_LOCAL/lib/libntl.dll.a\"\n\tcp libntl.dll \"$SAGE_LOCAL/lib/libntl.dll\"\n\tcp libntl.dll \"$SAGE_LOCAL/bin/libntl.dll.a\"\n\tcp libntl.dll \"$SAGE_LOCAL/bin/libntl.dll\"\n        if [ ! -f \"$SAGE_LOCAL/bin/libntl.dll.a\" ]; then\n            exit 1   # CRUCIAL that we have the dynamic link library\n        fi\n```",
    "created_at": "2011-07-29T20:04:36Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121911",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:1'></a>
New spkg at [http://sage.math.washington.edu/home/kcrisman/ntl-5.5.2.p0.spkg](http://sage.math.washington.edu/home/kcrisman/ntl-5.5.2.p0.spkg).  No guarantees on whether this works, or even is necessary (!) but I strongly suspect both.  You'll know it works if you do everything at #6743, including this, and then Sage has a segfault on startup.

In case there is any doubt that this is Cygwin-only:

```
    elif [ $UNAME = "CYGWIN" ]; then
        # Cygwin
        if [ "$CYGPKG" = "yes" ]; then
            if [ -f /lib/libgmp.dll.a ]; then
                ln -s /lib/libgmp.dll.a libgmp.a
            else
                # Added by William Stein on 2006-02-06 so that 
                # can build even if gmp is not built locally
                # i.e., even if using a system-wide gmp.
                # (though it has to be in /usr/lib, which is
                # where it is for cygwin).
                ln  -s /usr/lib/*gmp* .
                ln  -s libgmp.dll.a libgmp.a
            fi 
        else
   	    ln -s "$SAGE_LOCAL/lib/libgmp.a" .
        fi
	$MAKE libntl.dll
        if [ ! -f libntl.dll ]; then
            echo "Error creating ntl shared library."
            exit 1
        fi
	cp libntl.dll "$SAGE_LOCAL/lib/libntl.dll.a"
	cp libntl.dll "$SAGE_LOCAL/lib/libntl.dll"
	cp libntl.dll "$SAGE_LOCAL/bin/libntl.dll.a"
	cp libntl.dll "$SAGE_LOCAL/bin/libntl.dll"
        if [ ! -f "$SAGE_LOCAL/bin/libntl.dll.a" ]; then
            exit 1   # CRUCIAL that we have the dynamic link library
        fi
```



---

archive/issue_events_092640.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2011-07-29T20:04:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11635#event-92640"
}
```



---

archive/issue_comments_121912.json:
```json
{
    "body": "**Author:** Karl-Dieter Crisman",
    "created_at": "2011-07-29T20:04:36Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121912",
    "user": "https://github.com/kcrisman"
}
```

**Author:** Karl-Dieter Crisman



---

archive/issue_events_092641.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2011-08-01T14:15:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11635#event-92641"
}
```



---

archive/issue_events_092642.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2011-08-01T14:15:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11635#event-92642"
}
```



---

archive/issue_comments_121913.json:
```json
{
    "body": "<a id='comment:3'></a>\nInterestingly, the most recent alpha I tested all the Cygwin stuff on a few weeks ago already had NTL 5.5.2!  \n\n```\n$ ls spkg/installed\n<snip>\nntl-5.5.2\n<snip>\n```\nand it seemed to work fine (in the sense that it got to the Pari segfault when initializing).\n\nThat doesn't mean that later in the process things wouldn't happen, but at least for now this ticket can be lower priority, if it's needed at all, since we have to figure out how to get past that error first.",
    "created_at": "2011-08-01T14:15:58Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121913",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:3'></a>
Interestingly, the most recent alpha I tested all the Cygwin stuff on a few weeks ago already had NTL 5.5.2!  

```
$ ls spkg/installed
<snip>
ntl-5.5.2
<snip>
```
and it seemed to work fine (in the sense that it got to the Pari segfault when initializing).

That doesn't mean that later in the process things wouldn't happen, but at least for now this ticket can be lower priority, if it's needed at all, since we have to figure out how to get past that error first.



---

archive/issue_events_092643.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2011-08-02T16:32:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "label": "minor",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11635#event-92643"
}
```



---

archive/issue_comments_121914.json:
```json
{
    "body": "<a id='comment:5'></a>\nThis appears to be the same issue as #12104, which should probably be closed as a duplicate then.",
    "created_at": "2011-12-02T17:33:57Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121914",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:5'></a>
This appears to be the same issue as #12104, which should probably be closed as a duplicate then.



---

archive/issue_comments_121915.json:
```json
{
    "body": "<a id='comment:6'></a>\nSince [the 4.8.alpha3 spkg](http://sage.math.washington.edu/home/release/sage-4.8.alpha3/sage-4.8.alpha3/spkg/standard/) still is 5.5.2 with no patches, this spkg should still be valid to fix this.",
    "created_at": "2011-12-02T17:37:17Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121915",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:6'></a>
Since [the 4.8.alpha3 spkg](http://sage.math.washington.edu/home/release/sage-4.8.alpha3/sage-4.8.alpha3/spkg/standard/) still is 5.5.2 with no patches, this spkg should still be valid to fix this.



---

archive/issue_events_092644.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2011-12-03T03:59:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11635#event-92644"
}
```



---

archive/issue_events_092645.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2011-12-03T03:59:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11635#event-92645"
}
```



---

archive/issue_comments_121916.json:
```json
{
    "body": "<a id='comment:7'></a>\nOh, and no longer 'needs info', because #12104 shows that it's needed to start Sage.",
    "created_at": "2011-12-03T03:59:10Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121916",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:7'></a>
Oh, and no longer 'needs info', because #12104 shows that it's needed to start Sage.



---

archive/issue_comments_121917.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [kcrisman](#comment%3A7):\n> Oh, and no longer 'needs info', because #12104 shows that it's needed to start Sage.\n\nWhy does one need copies in local/bin ?\nAnd why does one need to copy rather than to create a symbolic link?",
    "created_at": "2011-12-03T06:36:14Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121917",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:8'></a>
Replying to [kcrisman](#comment%3A7):
> Oh, and no longer 'needs info', because #12104 shows that it's needed to start Sage.

Why does one need copies in local/bin ?
And why does one need to copy rather than to create a symbolic link?



---

archive/issue_events_092646.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2011-12-03T06:36:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11635#event-92646"
}
```



---

archive/issue_events_092647.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2011-12-03T06:36:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11635#event-92647"
}
```



---

archive/issue_comments_121918.json:
```json
{
    "body": "<a id='comment:9'></a>\n> > Oh, and no longer 'needs info', because #12104 shows that it's needed to start Sage.\n\n> \n> Why does one need copies in local/bin ?\n> And why does one need to copy rather than to create a symbolic link?\n\nNo idea!  I just copied models from other spkgs.  Feel free to only copy and/or make links where actually appropriate.  I have never claimed to be anything close to an expert; I've only focused on getting it to work by following other spkgs I've seen.  \n\nI would love to have this \"correct\" so that we never have to worry about it again.",
    "created_at": "2011-12-03T15:24:12Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121918",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:9'></a>
> > Oh, and no longer 'needs info', because #12104 shows that it's needed to start Sage.

> 
> Why does one need copies in local/bin ?
> And why does one need to copy rather than to create a symbolic link?

No idea!  I just copied models from other spkgs.  Feel free to only copy and/or make links where actually appropriate.  I have never claimed to be anything close to an expert; I've only focused on getting it to work by following other spkgs I've seen.  

I would love to have this "correct" so that we never have to worry about it again.



---

archive/issue_comments_121919.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [kcrisman](#comment%3A9):\n> > > Oh, and no longer 'needs info', because #12104 shows that it's needed to start Sage.\n\n> > \n> > Why does one need copies in local/bin ?\n> > And why does one need to copy rather than to create a symbolic link?\n\n> \n> No idea!  I just copied models from other spkgs.  Feel free to only copy and/or make links where actually appropriate.  I have never claimed to be anything close to an expert; I've only focused on getting it to work by following other spkgs I've seen.  \n> \n> I would love to have this \"correct\" so that we never have to worry about it again.\n\nThis might even be part of the problem at #9167.",
    "created_at": "2011-12-07T15:55:39Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121919",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:10'></a>
Replying to [kcrisman](#comment%3A9):
> > > Oh, and no longer 'needs info', because #12104 shows that it's needed to start Sage.

> > 
> > Why does one need copies in local/bin ?
> > And why does one need to copy rather than to create a symbolic link?

> 
> No idea!  I just copied models from other spkgs.  Feel free to only copy and/or make links where actually appropriate.  I have never claimed to be anything close to an expert; I've only focused on getting it to work by following other spkgs I've seen.  
> 
> I would love to have this "correct" so that we never have to worry about it again.

This might even be part of the problem at #9167.



---

archive/issue_comments_121920.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [kcrisman](#comment%3A9):\n> > > Oh, and no longer 'needs info', because #12104 shows that it's needed to start Sage.\n\n> > \n> > Why does one need copies in local/bin ?\n> > And why does one need to copy rather than to create a symbolic link?\n\nJust for posterity (addressing the comments at #12104, perhaps?), here is the rationale for naming it dll.a, from #9050.\n\n```\nThis is so that Cygwin will find the shared library before it finds the static library; otherwise, there are lots of segfaults in Sage under Cygwin\n```",
    "created_at": "2011-12-08T03:36:39Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121920",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:11'></a>
Replying to [kcrisman](#comment%3A9):
> > > Oh, and no longer 'needs info', because #12104 shows that it's needed to start Sage.

> > 
> > Why does one need copies in local/bin ?
> > And why does one need to copy rather than to create a symbolic link?

Just for posterity (addressing the comments at #12104, perhaps?), here is the rationale for naming it dll.a, from #9050.

```
This is so that Cygwin will find the shared library before it finds the static library; otherwise, there are lots of segfaults in Sage under Cygwin
```



---

archive/issue_comments_121921.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [kcrisman](#comment%3A11):\n> Replying to [kcrisman](#comment%3A9):\n> > > > Oh, and no longer 'needs info', because #12104 shows that it's needed to start Sage.\n\n> > > \n> > > Why does one need copies in local/bin ?\n> > > And why does one need to copy rather than to create a symbolic link?\n\n> \n> Just for posterity (addressing the comments at #12104, perhaps?), here is the rationale for naming it dll.a, from #9050.\n> \n> ```\n> This is so that Cygwin will find the shared library before it finds the static library; otherwise, there are lots of segfaults in Sage under Cygwin\n> ```\n\nthat means that only in the cases when both static and dynamic libraries are built, this is needed.\nIMHO there are not so many such cases among Sage spkg's.",
    "created_at": "2011-12-08T09:54:04Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121921",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:12'></a>
Replying to [kcrisman](#comment%3A11):
> Replying to [kcrisman](#comment%3A9):
> > > > Oh, and no longer 'needs info', because #12104 shows that it's needed to start Sage.

> > > 
> > > Why does one need copies in local/bin ?
> > > And why does one need to copy rather than to create a symbolic link?

> 
> Just for posterity (addressing the comments at #12104, perhaps?), here is the rationale for naming it dll.a, from #9050.
> 
> ```
> This is so that Cygwin will find the shared library before it finds the static library; otherwise, there are lots of segfaults in Sage under Cygwin
> ```

that means that only in the cases when both static and dynamic libraries are built, this is needed.
IMHO there are not so many such cases among Sage spkg's.



---

archive/issue_comments_121922.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [kcrisman](#comment%3A11):\n> Replying to [kcrisman](#comment%3A9):\n> > > > Oh, and no longer 'needs info', because #12104 shows that it's needed to start Sage.\n\n> > > \n> > > Why does one need copies in local/bin ?\n> > > And why does one need to copy rather than to create a symbolic link?\n\n> \n> Just for posterity (addressing the comments at #12104, perhaps?), here is the rationale for naming it dll.a, from #9050.\n> \n> ```\n> This is so that Cygwin will find the shared library before it finds the static library; otherwise, there are lots of segfaults in Sage under Cygwin\n> ```\n\nIMHO, this is, at best, a bad hack. In principle, *.dll.a files are import libraries for *.dll libaries, \nused by the linker to like against *.dll (i.e. dynamic libraries).\n\nSee [Buiding/using DLLs](http://www.cygwin.com/cygwin-ug-net/dll.html)",
    "created_at": "2011-12-09T05:11:54Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121922",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:13'></a>
Replying to [kcrisman](#comment%3A11):
> Replying to [kcrisman](#comment%3A9):
> > > > Oh, and no longer 'needs info', because #12104 shows that it's needed to start Sage.

> > > 
> > > Why does one need copies in local/bin ?
> > > And why does one need to copy rather than to create a symbolic link?

> 
> Just for posterity (addressing the comments at #12104, perhaps?), here is the rationale for naming it dll.a, from #9050.
> 
> ```
> This is so that Cygwin will find the shared library before it finds the static library; otherwise, there are lots of segfaults in Sage under Cygwin
> ```

IMHO, this is, at best, a bad hack. In principle, *.dll.a files are import libraries for *.dll libaries, 
used by the linker to like against *.dll (i.e. dynamic libraries).

See [Buiding/using DLLs](http://www.cygwin.com/cygwin-ug-net/dll.html)



---

archive/issue_comments_121923.json:
```json
{
    "body": "<a id='comment:14'></a>\n> > > > > Oh, and no longer 'needs info', because #12104 shows that it's needed to start Sage.\n\n> > > > \n> > > > Why does one need copies in local/bin ?\n> > > > And why does one need to copy rather than to create a symbolic link?\n\n> > \n> > Just for posterity (addressing the comments at #12104, perhaps?), here is the rationale for naming it dll.a, from #9050.\n> > \n> > ```\n> > This is so that Cygwin will find the shared library before it finds the static library; otherwise, there are lots of segfaults in Sage under Cygwin\n> > ```\n\n> \n> IMHO, this is, at best, a bad hack. In principle, *.dll.a files are import libraries for *.dll libaries, \n> used by the linker to like against *.dll (i.e. dynamic libraries).\n> \n\nWell, as I said in [comment:9](#comment%3A9), I would *more* than happy to have someone who actually knows what they are talking about to fix this and post a different spkg :) especially if it ended up fixing #9167.  Go for it!",
    "created_at": "2011-12-09T14:53:43Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121923",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:14'></a>
> > > > > Oh, and no longer 'needs info', because #12104 shows that it's needed to start Sage.

> > > > 
> > > > Why does one need copies in local/bin ?
> > > > And why does one need to copy rather than to create a symbolic link?

> > 
> > Just for posterity (addressing the comments at #12104, perhaps?), here is the rationale for naming it dll.a, from #9050.
> > 
> > ```
> > This is so that Cygwin will find the shared library before it finds the static library; otherwise, there are lots of segfaults in Sage under Cygwin
> > ```

> 
> IMHO, this is, at best, a bad hack. In principle, *.dll.a files are import libraries for *.dll libaries, 
> used by the linker to like against *.dll (i.e. dynamic libraries).
> 

Well, as I said in [comment:9](#comment%3A9), I would *more* than happy to have someone who actually knows what they are talking about to fix this and post a different spkg :) especially if it ended up fixing #9167.  Go for it!



---

archive/issue_comments_121924.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [kcrisman](#comment%3A11):\n> Replying to [kcrisman](#comment%3A9):\n> > > > Oh, and no longer 'needs info', because #12104 shows that it's needed to start Sage.\n\n> > > \n> > > Why does one need copies in local/bin ?\n> > > And why does one need to copy rather than to create a symbolic link?\n\n> \n> Just for posterity (addressing the comments at #12104, perhaps?), here is the rationale for naming it dll.a, from #9050.\n\n```\nThis is so that Cygwin will find the shared library before it finds the static library; otherwise, there are lots of segfaults in Sage under Cygwin\n```\n\nIt's probably OK to have \"real\" (i.e.  dynamic libs, not misnamed dll.a or other files) .dlls in local/bin/, and bad to have them in local/lib/. At least that's what a Cygwin-aware libtool will be doing.",
    "created_at": "2011-12-14T02:49:58Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121924",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:15'></a>
Replying to [kcrisman](#comment%3A11):
> Replying to [kcrisman](#comment%3A9):
> > > > Oh, and no longer 'needs info', because #12104 shows that it's needed to start Sage.

> > > 
> > > Why does one need copies in local/bin ?
> > > And why does one need to copy rather than to create a symbolic link?

> 
> Just for posterity (addressing the comments at #12104, perhaps?), here is the rationale for naming it dll.a, from #9050.

```
This is so that Cygwin will find the shared library before it finds the static library; otherwise, there are lots of segfaults in Sage under Cygwin
```

It's probably OK to have "real" (i.e.  dynamic libs, not misnamed dll.a or other files) .dlls in local/bin/, and bad to have them in local/lib/. At least that's what a Cygwin-aware libtool will be doing.



---

archive/issue_comments_121925.json:
```json
{
    "body": "<a id='comment:16'></a>\n> It's probably OK to have \"real\" (i.e.  dynamic libs, not misnamed dll.a or other files) .dlls in local/bin/, and bad to have them in local/lib/. At least that's what a Cygwin-aware libtool will be doing. \n\nCan you be more specific (if only so I can make a good spkg)?  Please check which of the following should be copied, which should be linked (with `ln -s`, or with other options?), and which are just horrible.  \n* lib/libntl.dll\n* lib/libntl.dll.a\n* bin/libntl.dll\n* bin/libntl.dll.a\nRecall that currently we also have \n* lib/libntl.a",
    "created_at": "2011-12-14T02:54:32Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121925",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:16'></a>
> It's probably OK to have "real" (i.e.  dynamic libs, not misnamed dll.a or other files) .dlls in local/bin/, and bad to have them in local/lib/. At least that's what a Cygwin-aware libtool will be doing. 

Can you be more specific (if only so I can make a good spkg)?  Please check which of the following should be copied, which should be linked (with `ln -s`, or with other options?), and which are just horrible.  
* lib/libntl.dll
* lib/libntl.dll.a
* bin/libntl.dll
* bin/libntl.dll.a
Recall that currently we also have 
* lib/libntl.a



---

archive/issue_comments_121926.json:
```json
{
    "body": "<a id='comment:17'></a>\nHere's something else potentially relevant.\n\n```\nUser 1@GC02635 /home/SageUser/sage-4.7.2\n$ ./sage -t -verbose devel/sage/sage/calculus/functional.py\ninit.sage does not exist ... creating\nsage -t -verbose \"devel/sage/sage/calculus/functional.py\"\nSetting permissions of DOT_SAGE directory so only you can read and write it.\n<snip LOTS of pretty much identical things>\n1564601 [main] python 3544 fork: child 3776 - died waiting for dll loading, errno 11\n1639139 [main] python 160 C:\\cygwin\\home\\SageUser\\sage-4.7.2\\local\\bin\\python.exe: *** fatal error - unable to remap C:\\cygwin\\home\\SageUser\\sage-4.7.2\\local\\lib\\libntl.dll to same address as parent: 0x19A40000 != 0x626C0000\nStack trace:\nFrame     Function  Args\n002093B8  6102796B  (002093B8, 00000000, 00000000, 00000000)\n002096A8  6102796B  (6117EC60, 00008000, 00000000, 61180977)\n0020A6D8  61004F1B  (611A7FAC, 6124A1B4, 19A40000, 626C0000)\nEnd of stack trace\n1642317 [main] python 3544 fork: child 160 - died waiting for dll loading, errno 11\nTraceback (most recent call last):\n  File \"../.sage/tmp/functional_3772.py\", line 6, in <module>\n    from sage.all_cmdline import *;\n  File \"/home/SageUser/sage-4.7.2/local/lib/python/site-packages/sage/all_cmdline.py\", line 14, in <module>\n    from sage.all import *\n<snip>\n  File \"/home/SageUser/sage-4.7.2/local/lib/python/site-packages/sage/rings/polynomial/multi_polynomial_ideal.py\", line 235, in <module>\n    from sage.interfaces.all import (singular as singular_default,\n  File \"/home/SageUser/sage-4.7.2/local/lib/python/site-packages/sage/interfaces/all.py\", line 8, in <module>\n    from gap import gap, gap_reset_workspace, gap_console, gap_version, is_GapElement, Gap\n  File \"/home/SageUser/sage-4.7.2/local/lib/python/site-packages/sage/interfaces/gap.py\", line 1188, in <module>\n    gap_reset_workspace(verbose=False)\n  File \"/home/SageUser/sage-4.7.2/local/lib/python/site-packages/sage/interfaces/gap.py\", line 1179, in gap_reset_workspace\n    g.save_workspace()\n  File \"/home/SageUser/sage-4.7.2/local/lib/python/site-packages/sage/interfaces/gap.py\", line 983, in save_workspace\n    self.eval('SaveWorkspace(\"%s\");'%WORKSPACE, allow_use_file=False)\n  File \"/home/SageUser/sage-4.7.2/local/lib/python/site-packages/sage/interfaces/gap.py\", line 374, in eval\n    result = Expect.eval(self, input_line, **kwds)\n  File \"/home/SageUser/sage-4.7.2/local/lib/python/site-packages/sage/interfaces/expect.py\", line 1039, in eval\n    for L in code.split('\\n') if L != ''])\n  File \"/home/SageUser/sage-4.7.2/local/lib/python/site-packages/sage/interfaces/gap.py\", line 476, in _eval_line\n    self._start()\n  File \"/home/SageUser/sage-4.7.2/local/lib/python/site-packages/sage/interfaces/gap.py\", line 913, in _start\n    raise RuntimeError, msg\nRuntimeError: Unable to start gap because the command 'gap -r -b -p -T -o 3900m /home/SageUser/sage-4.7.2/data//extcode/gap/sage.g' failed.\n\n         [11.4 s]\n\n----------------------------------------------------------------------\nThe following tests failed:\n\n\n        sage -t -verbose \"devel/sage/sage/calculus/functional.py\"\nTotal time for all tests: 11.7 seconds\n```",
    "created_at": "2011-12-14T03:30:40Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121926",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:17'></a>
Here's something else potentially relevant.

```
User 1@GC02635 /home/SageUser/sage-4.7.2
$ ./sage -t -verbose devel/sage/sage/calculus/functional.py
init.sage does not exist ... creating
sage -t -verbose "devel/sage/sage/calculus/functional.py"
Setting permissions of DOT_SAGE directory so only you can read and write it.
<snip LOTS of pretty much identical things>
1564601 [main] python 3544 fork: child 3776 - died waiting for dll loading, errno 11
1639139 [main] python 160 C:\cygwin\home\SageUser\sage-4.7.2\local\bin\python.exe: *** fatal error - unable to remap C:\cygwin\home\SageUser\sage-4.7.2\local\lib\libntl.dll to same address as parent: 0x19A40000 != 0x626C0000
Stack trace:
Frame     Function  Args
002093B8  6102796B  (002093B8, 00000000, 00000000, 00000000)
002096A8  6102796B  (6117EC60, 00008000, 00000000, 61180977)
0020A6D8  61004F1B  (611A7FAC, 6124A1B4, 19A40000, 626C0000)
End of stack trace
1642317 [main] python 3544 fork: child 160 - died waiting for dll loading, errno 11
Traceback (most recent call last):
  File "../.sage/tmp/functional_3772.py", line 6, in <module>
    from sage.all_cmdline import *;
  File "/home/SageUser/sage-4.7.2/local/lib/python/site-packages/sage/all_cmdline.py", line 14, in <module>
    from sage.all import *
<snip>
  File "/home/SageUser/sage-4.7.2/local/lib/python/site-packages/sage/rings/polynomial/multi_polynomial_ideal.py", line 235, in <module>
    from sage.interfaces.all import (singular as singular_default,
  File "/home/SageUser/sage-4.7.2/local/lib/python/site-packages/sage/interfaces/all.py", line 8, in <module>
    from gap import gap, gap_reset_workspace, gap_console, gap_version, is_GapElement, Gap
  File "/home/SageUser/sage-4.7.2/local/lib/python/site-packages/sage/interfaces/gap.py", line 1188, in <module>
    gap_reset_workspace(verbose=False)
  File "/home/SageUser/sage-4.7.2/local/lib/python/site-packages/sage/interfaces/gap.py", line 1179, in gap_reset_workspace
    g.save_workspace()
  File "/home/SageUser/sage-4.7.2/local/lib/python/site-packages/sage/interfaces/gap.py", line 983, in save_workspace
    self.eval('SaveWorkspace("%s");'%WORKSPACE, allow_use_file=False)
  File "/home/SageUser/sage-4.7.2/local/lib/python/site-packages/sage/interfaces/gap.py", line 374, in eval
    result = Expect.eval(self, input_line, **kwds)
  File "/home/SageUser/sage-4.7.2/local/lib/python/site-packages/sage/interfaces/expect.py", line 1039, in eval
    for L in code.split('\n') if L != ''])
  File "/home/SageUser/sage-4.7.2/local/lib/python/site-packages/sage/interfaces/gap.py", line 476, in _eval_line
    self._start()
  File "/home/SageUser/sage-4.7.2/local/lib/python/site-packages/sage/interfaces/gap.py", line 913, in _start
    raise RuntimeError, msg
RuntimeError: Unable to start gap because the command 'gap -r -b -p -T -o 3900m /home/SageUser/sage-4.7.2/data//extcode/gap/sage.g' failed.

         [11.4 s]

----------------------------------------------------------------------
The following tests failed:


        sage -t -verbose "devel/sage/sage/calculus/functional.py"
Total time for all tests: 11.7 seconds
```



---

archive/issue_comments_121927.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [kcrisman](#comment%3A17):\n> Here's something else potentially relevant.\n\nthe usual Cygwin fork() crap, no?",
    "created_at": "2011-12-14T03:37:11Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121927",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:18'></a>
Replying to [kcrisman](#comment%3A17):
> Here's something else potentially relevant.

the usual Cygwin fork() crap, no?



---

archive/issue_comments_121928.json:
```json
{
    "body": "<a id='comment:19'></a>\n> > Here's something else potentially relevant.\n\n> \n> the usual Cygwin fork() crap, no?\n\nI didn't think so, but apparently it was.  Sorry for that last bit o' noise.\n\nAny comments on which of the files above are \"correct\"?",
    "created_at": "2011-12-14T03:41:01Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121928",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:19'></a>
> > Here's something else potentially relevant.

> 
> the usual Cygwin fork() crap, no?

I didn't think so, but apparently it was.  Sorry for that last bit o' noise.

Any comments on which of the files above are "correct"?



---

archive/issue_comments_121929.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [kcrisman](#comment%3A19):\n> > > Here's something else potentially relevant.\n\n> > \n> > the usual Cygwin fork() crap, no?\n\n> \n> I didn't think so, but apparently it was.  Sorry for that last bit o' noise.\n> \n> Any comments on which of the files above are \"correct\"?\n\nIt would be good to find this out by looking at the working Python extensions in Sage --- what they do, how the files are built and named, etc. I think that also the information in [Autobook](http://sourceware.org/autobook/autobook/autobook_255.html#SEC255) is very relevant.\n\nBut I am afraid that we will also need to solve the fork() issue, which seems to mean eliminating the use of fork() in Python and Cython parts, at least. This is doable, but quite a lot of work...\n(unless an \u00fcberhacker fixes fork() directly in Cygwin \u2013\u2013\u2013 probably needs a lot of very delicate reverse engineering of Windows kernel; the fact that is has not yet been done speaks volumes :-( )...",
    "created_at": "2011-12-14T03:54:04Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121929",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:20'></a>
Replying to [kcrisman](#comment%3A19):
> > > Here's something else potentially relevant.

> > 
> > the usual Cygwin fork() crap, no?

> 
> I didn't think so, but apparently it was.  Sorry for that last bit o' noise.
> 
> Any comments on which of the files above are "correct"?

It would be good to find this out by looking at the working Python extensions in Sage --- what they do, how the files are built and named, etc. I think that also the information in [Autobook](http://sourceware.org/autobook/autobook/autobook_255.html#SEC255) is very relevant.

But I am afraid that we will also need to solve the fork() issue, which seems to mean eliminating the use of fork() in Python and Cython parts, at least. This is doable, but quite a lot of work...
(unless an überhacker fixes fork() directly in Cygwin ––– probably needs a lot of very delicate reverse engineering of Windows kernel; the fact that is has not yet been done speaks volumes :-( )...



---

archive/issue_events_092648.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2012-07-27T14:47:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11635#event-92648"
}
```



---

archive/issue_events_092649.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2012-07-27T14:47:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11635#event-92649"
}
```



---

archive/issue_comments_121930.json:
```json
{
    "body": "<a id='comment:21'></a>\nThis apparently is still needed, and someone who knows what they are talking about rediscovered it :)",
    "created_at": "2012-07-27T14:47:28Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121930",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:21'></a>
This apparently is still needed, and someone who knows what they are talking about rediscovered it :)



---

archive/issue_comments_121931.json:
```json
{
    "body": "<a id='comment:22'></a>\nI think the better solution would be to use the libtool build system the latest version of NTL propose.\n\nAnyway, I found it quite strange that csage.dll wants a file called libntl.dll although only a file called libntl.dll.a was available at link time.\nMaybe there is a kind of DT_SONAME hidden in the NTL shared library.",
    "created_at": "2012-08-03T15:55:48Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121931",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:22'></a>
I think the better solution would be to use the libtool build system the latest version of NTL propose.

Anyway, I found it quite strange that csage.dll wants a file called libntl.dll although only a file called libntl.dll.a was available at link time.
Maybe there is a kind of DT_SONAME hidden in the NTL shared library.



---

archive/issue_comments_121932.json:
```json
{
    "body": "<a id='comment:23'></a>\nThere is indeed a linbntl.dll string within the shared library, so that may be it.\nTry\nstrings libntl.dll | grep libntl.dll\n\nAnyway, using libtool should solves our problem.\nAt least I have previously built NTL properly with that on Cygwin and Linux.\nLet's hope it does not break on other systems.",
    "created_at": "2012-08-03T16:20:10Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121932",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:23'></a>
There is indeed a linbntl.dll string within the shared library, so that may be it.
Try
strings libntl.dll | grep libntl.dll

Anyway, using libtool should solves our problem.
At least I have previously built NTL properly with that on Cygwin and Linux.
Let's hope it does not break on other systems.



---

archive/issue_comments_121933.json:
```json
{
    "body": "<a id='comment:24'></a>\nProof of concept spkg available at\nhttp://perso.telecom-paristech.fr/~flori/sage/ntl-5.5.2.p0.spkg\n\nThe regenerated patches need to be split.\nI've removed quite all biuld hacks to only use the NTL build system.\nThis seems ok on Linux, I'll check Cygwin now.",
    "created_at": "2012-08-05T21:05:37Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121933",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:24'></a>
Proof of concept spkg available at
http://perso.telecom-paristech.fr/~flori/sage/ntl-5.5.2.p0.spkg

The regenerated patches need to be split.
I've removed quite all biuld hacks to only use the NTL build system.
This seems ok on Linux, I'll check Cygwin now.



---

archive/issue_comments_121934.json:
```json
{
    "body": "<a id='comment:25'></a>\nThe updated spkg depends on libtool (ok, this was somehow to be expected), which is not needed by any other part of Sage.\nToo bad.",
    "created_at": "2012-08-05T21:37:31Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121934",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:25'></a>
The updated spkg depends on libtool (ok, this was somehow to be expected), which is not needed by any other part of Sage.
Too bad.



---

archive/issue_events_092650.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/jpflori",
    "created_at": "2012-08-05T21:38:55Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "rename": {
        "from": "Copy needed dll file for NTL on Cygwin",
        "to": "Ensure that libraries link to the shared version of NTL by default"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11635#event-92650"
}
```



---

archive/issue_comments_121935.json:
```json
{
    "body": "<a id='comment:27'></a>\nAnd the spkg I posted needs to pass LDFLAGS=-no-undefined to NTL to be able to build a shared library on cygwin.",
    "created_at": "2012-08-06T08:00:46Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121935",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:27'></a>
And the spkg I posted needs to pass LDFLAGS=-no-undefined to NTL to be able to build a shared library on cygwin.



---

archive/issue_comments_121936.json:
```json
{
    "body": "<a id='comment:28'></a>\nThe spkg at http://perso.telecom-paristech.fr/~flori/sage/ntl-5.5.2.p0.spkg is cleaner, functional, but still depends on libtool being system-wide installed.",
    "created_at": "2012-08-06T16:45:32Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121936",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:28'></a>
The spkg at http://perso.telecom-paristech.fr/~flori/sage/ntl-5.5.2.p0.spkg is cleaner, functional, but still depends on libtool being system-wide installed.



---

archive/issue_comments_121937.json:
```json
{
    "body": "<a id='comment:29'></a>\nReplying to [jpflori](#comment%3A28):\n> The spkg at http://perso.telecom-paristech.fr/~flori/sage/ntl-5.5.2.p0.spkg is cleaner, functional, but still depends on libtool being system-wide installed.\n\nI am trying this spkg now. My build (with an older NTL) has finished, but I see exactly the same problem as reported on #12104.",
    "created_at": "2012-08-06T17:02:31Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121937",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:29'></a>
Replying to [jpflori](#comment%3A28):
> The spkg at http://perso.telecom-paristech.fr/~flori/sage/ntl-5.5.2.p0.spkg is cleaner, functional, but still depends on libtool being system-wide installed.

I am trying this spkg now. My build (with an older NTL) has finished, but I see exactly the same problem as reported on #12104.



---

archive/issue_comments_121938.json:
```json
{
    "body": "<a id='comment:30'></a>\nIt could be that some of your already build dlls are still linked with libntl.dll (which should still be inexistant if you did not copy it by hand earlier).\nYou can check that by cygchecking some of them, sage/rings/... should be good culprits or sage/libs/ntl....\nSo you should rebuild all these broken dlls.\nUnfortunately I'm not sure yet how to easily automagically make them rebuild (as sage -b will not).\nI'm currently seeing if touching sage/libs/ntl/decl.pxi is enough to trigger that rebuild.\nSome spkg depending on NTL may be broken as well...\n\nThe easiest solution would be to rebuild from scratch...",
    "created_at": "2012-08-06T17:07:14Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121938",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:30'></a>
It could be that some of your already build dlls are still linked with libntl.dll (which should still be inexistant if you did not copy it by hand earlier).
You can check that by cygchecking some of them, sage/rings/... should be good culprits or sage/libs/ntl....
So you should rebuild all these broken dlls.
Unfortunately I'm not sure yet how to easily automagically make them rebuild (as sage -b will not).
I'm currently seeing if touching sage/libs/ntl/decl.pxi is enough to trigger that rebuild.
Some spkg depending on NTL may be broken as well...

The easiest solution would be to rebuild from scratch...



---

archive/issue_comments_121939.json:
```json
{
    "body": "<a id='comment:31'></a>\nReplying to [dimpase](#comment%3A29):\n> Replying to [jpflori](#comment%3A28):\n> > The spkg at http://perso.telecom-paristech.fr/~flori/sage/ntl-5.5.2.p0.spkg is cleaner, functional, but still depends on libtool being system-wide installed.\n\n> \n> I am trying this spkg now. My build (with an older NTL) has finished, but I see exactly the same problem as reported on #12104.\n\nThe spkg does not build. It ends up with rather weird message:\n\n```\ng++: /usr/lib/gcc/i686-pc-cygwin/4.3.4/crtbegin.o: No such file or directory\ng++: /usr/lib/gcc/i686-pc-cygwin/4.3.4/crtend.o: No such file or directory\nmakefile:376: recipe for target `ntl.a' failed\nmake[1]: *** [ntl.a] Error 1\nmake[1]: Leaving directory `/usr/local/src/sage/sage-5.2/spkg/build/ntl-5.5.2.p0/src/src'\nmakefile:334: recipe for target `all' failed\nmake: *** [all] Error 2\nUnable to tune and build NTL.\n```\n\nAnd indeed, my gcc is 4.5.3, and I have stuff in `/usr/lib/gcc/i686-pc-cygwin/4.5.3/`, but no \n`/usr/lib/gcc/i686-pc-cygwin/4.3.4/`\n\nPlease see the log [here](http://boxen.math.washington.edu/home/dima/tmp/ntl-5.5.2.p0.log)",
    "created_at": "2012-08-06T17:17:51Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121939",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:31'></a>
Replying to [dimpase](#comment%3A29):
> Replying to [jpflori](#comment%3A28):
> > The spkg at http://perso.telecom-paristech.fr/~flori/sage/ntl-5.5.2.p0.spkg is cleaner, functional, but still depends on libtool being system-wide installed.

> 
> I am trying this spkg now. My build (with an older NTL) has finished, but I see exactly the same problem as reported on #12104.

The spkg does not build. It ends up with rather weird message:

```
g++: /usr/lib/gcc/i686-pc-cygwin/4.3.4/crtbegin.o: No such file or directory
g++: /usr/lib/gcc/i686-pc-cygwin/4.3.4/crtend.o: No such file or directory
makefile:376: recipe for target `ntl.a' failed
make[1]: *** [ntl.a] Error 1
make[1]: Leaving directory `/usr/local/src/sage/sage-5.2/spkg/build/ntl-5.5.2.p0/src/src'
makefile:334: recipe for target `all' failed
make: *** [all] Error 2
Unable to tune and build NTL.
```

And indeed, my gcc is 4.5.3, and I have stuff in `/usr/lib/gcc/i686-pc-cygwin/4.5.3/`, but no 
`/usr/lib/gcc/i686-pc-cygwin/4.3.4/`

Please see the log [here](http://boxen.math.washington.edu/home/dima/tmp/ntl-5.5.2.p0.log)



---

archive/issue_comments_121940.json:
```json
{
    "body": "<a id='comment:32'></a>\nThis is because the postinstall script from the Cygwin gcc4-core package is broken.\nI've posted additional details on the [CygwinPort](CygwinPort) page.\nYou'll have to tweak the /usr/bin/libtool file yourself for now, replacing 4.3.4 by 4.5.3 (or reinstalling version 4.3.4 of gcc4 package).",
    "created_at": "2012-08-06T17:21:19Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121940",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:32'></a>
This is because the postinstall script from the Cygwin gcc4-core package is broken.
I've posted additional details on the [CygwinPort](CygwinPort) page.
You'll have to tweak the /usr/bin/libtool file yourself for now, replacing 4.3.4 by 4.5.3 (or reinstalling version 4.3.4 of gcc4 package).



---

archive/issue_comments_121941.json:
```json
{
    "body": "<a id='comment:33'></a>\nBy the way, touching decl.pxi in sage/libs/ntl and then running \"sage -b\" seems to have fixed my install.\nAt least Sage starts now without import errors.",
    "created_at": "2012-08-06T17:23:35Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121941",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:33'></a>
By the way, touching decl.pxi in sage/libs/ntl and then running "sage -b" seems to have fixed my install.
At least Sage starts now without import errors.



---

archive/issue_comments_121942.json:
```json
{
    "body": "<a id='comment:34'></a>\nwrt to the libtool business - this doesn't become a Sage dependency though, right?  Or could one just make it a Cygwin one (that's ok)?  Sorry for being dense here.",
    "created_at": "2012-08-07T03:09:30Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121942",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:34'></a>
wrt to the libtool business - this doesn't become a Sage dependency though, right?  Or could one just make it a Cygwin one (that's ok)?  Sorry for being dense here.



---

archive/issue_comments_121943.json:
```json
{
    "body": "<a id='comment:35'></a>\nReplying to [jpflori](#comment%3A33):\n> By the way, touching decl.pxi in sage/libs/ntl and then running \"sage -b\" seems to have fixed my install.\n> At least Sage starts now without import errors.\n\nnot for me - I still needed to copy SAGELOCAL/bin/libntl.dll.a to SAGELOCAL/bin/libntl.dll to get past import errors.\n\nThen, the usual fork() problems on startup, and rebaseall does not help. I am afraid we're back to the root of the problem. I'll try to rebuild from scratch one more time, but this doesn't look good.",
    "created_at": "2012-08-07T03:18:45Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121943",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:35'></a>
Replying to [jpflori](#comment%3A33):
> By the way, touching decl.pxi in sage/libs/ntl and then running "sage -b" seems to have fixed my install.
> At least Sage starts now without import errors.

not for me - I still needed to copy SAGELOCAL/bin/libntl.dll.a to SAGELOCAL/bin/libntl.dll to get past import errors.

Then, the usual fork() problems on startup, and rebaseall does not help. I am afraid we're back to the root of the problem. I'll try to rebuild from scratch one more time, but this doesn't look good.



---

archive/issue_comments_121944.json:
```json
{
    "body": "<a id='comment:36'></a>\nReplying to [dimpase](#comment%3A35):\n> Replying to [jpflori](#comment%3A33):\n> > By the way, touching decl.pxi in sage/libs/ntl and then running \"sage -b\" seems to have fixed my install.\n> > At least Sage starts now without import errors.\n\n> not for me - I still needed to copy SAGELOCAL/bin/libntl.dll.a to SAGELOCAL/bin/libntl.dll to get past import errors.\n> \n> Then, the usual fork() problems on startup, and rebaseall does not help. I am afraid we're back to the root of the problem. I'll try to rebuild from scratch one more time, but this doesn't look good.\n\nI also rebuild some spkg, at least flint, don't remember exactly which ones, could you check every dll? Writing such a script would be less time consuming than rebuilding Sage from scratch (and I did not have to rebase by the way).\nIt would be really strange that some files still link to libntl.dll with a fresh instlal, as there is definitely no reference to such a file name with the new spkg, nor in other pieces of Sage.\n\nOnce again, I think that the problem before was just that there was some kind of DT_SONAME (which usually point to a \"real\" filename to use for a library at runtime) in the library buid by NTL.\nAs the library was originally build as libntl.dll, this DT_SONAME was set to libntl.dll, so even though the library was rename to libntl.dll.a after installing and so was found before the static archive when we link to NTL, at runtime the pieces of Sage linked to it would look to libntl.dll.\n\nWith the new spkg libntl.dll never sees the light of day, so there is no reason something else thinks it has ever existed, or will.\n\nAnd yes unfortunately, libtool is used on every platform, not only on Cygwin, the good point is that we use the upstream NTL build system rather than the one that was made only for Sage by Sage devs before it was more or less integrated with the help of the same people to NTL itself (although with a dependency on libtool).\nNevertheless, libtool should only be 4 text files, so I'm looking for a way to integrate it to the spkg right now.\nAnother solution is to continue with the Sage patched build system and add a proper linking line for Cygwin.",
    "created_at": "2012-08-07T06:51:31Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121944",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:36'></a>
Replying to [dimpase](#comment%3A35):
> Replying to [jpflori](#comment%3A33):
> > By the way, touching decl.pxi in sage/libs/ntl and then running "sage -b" seems to have fixed my install.
> > At least Sage starts now without import errors.

> not for me - I still needed to copy SAGELOCAL/bin/libntl.dll.a to SAGELOCAL/bin/libntl.dll to get past import errors.
> 
> Then, the usual fork() problems on startup, and rebaseall does not help. I am afraid we're back to the root of the problem. I'll try to rebuild from scratch one more time, but this doesn't look good.

I also rebuild some spkg, at least flint, don't remember exactly which ones, could you check every dll? Writing such a script would be less time consuming than rebuilding Sage from scratch (and I did not have to rebase by the way).
It would be really strange that some files still link to libntl.dll with a fresh instlal, as there is definitely no reference to such a file name with the new spkg, nor in other pieces of Sage.

Once again, I think that the problem before was just that there was some kind of DT_SONAME (which usually point to a "real" filename to use for a library at runtime) in the library buid by NTL.
As the library was originally build as libntl.dll, this DT_SONAME was set to libntl.dll, so even though the library was rename to libntl.dll.a after installing and so was found before the static archive when we link to NTL, at runtime the pieces of Sage linked to it would look to libntl.dll.

With the new spkg libntl.dll never sees the light of day, so there is no reason something else thinks it has ever existed, or will.

And yes unfortunately, libtool is used on every platform, not only on Cygwin, the good point is that we use the upstream NTL build system rather than the one that was made only for Sage by Sage devs before it was more or less integrated with the help of the same people to NTL itself (although with a dependency on libtool).
Nevertheless, libtool should only be 4 text files, so I'm looking for a way to integrate it to the spkg right now.
Another solution is to continue with the Sage patched build system and add a proper linking line for Cygwin.



---

archive/issue_comments_121945.json:
```json
{
    "body": "<a id='comment:37'></a>\nCould you run the following in your cygwin shell in a \"sage -sh\":\n\n```\nfor d in `find . -name *.dll`; do echo $d; cygcheck $d|grep \"not find\"; done\n```\nand try to rebuild the libs whining about libntl.dll.\n\nBy the way, on my system, some dlls from R complain about libR.dll...",
    "created_at": "2012-08-07T08:17:07Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121945",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:37'></a>
Could you run the following in your cygwin shell in a "sage -sh":

```
for d in `find . -name *.dll`; do echo $d; cygcheck $d|grep "not find"; done
```
and try to rebuild the libs whining about libntl.dll.

By the way, on my system, some dlls from R complain about libR.dll...



---

archive/issue_comments_121946.json:
```json
{
    "body": "<a id='comment:38'></a>\nTo actually 'find' the dlls of the Sage library, I had to 'cd'  to local/lib/python/site-packages/sage/",
    "created_at": "2012-08-07T08:20:22Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121946",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:38'></a>
To actually 'find' the dlls of the Sage library, I had to 'cd'  to local/lib/python/site-packages/sage/



---

archive/issue_comments_121947.json:
```json
{
    "body": "<a id='comment:39'></a>\nAnd that showed me that I need to rebuild eclib which still looks fro libntl.dll :)\n\nAnd that libs/lcalc/lcalc_Lfunction.dll looks for a libLfunction.so file.",
    "created_at": "2012-08-07T08:22:08Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121947",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:39'></a>
And that showed me that I need to rebuild eclib which still looks fro libntl.dll :)

And that libs/lcalc/lcalc_Lfunction.dll looks for a libLfunction.so file.



---

archive/issue_comments_121948.json:
```json
{
    "body": "<a id='comment:40'></a>\nSpkg updated to include libtool.\n\nOk on Linux, testing now on Cygwin.",
    "created_at": "2012-08-07T09:35:21Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121948",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:40'></a>
Spkg updated to include libtool.

Ok on Linux, testing now on Cygwin.



---

archive/issue_comments_121949.json:
```json
{
    "body": "<a id='comment:41'></a>\nIn fact the included libtool does not work well on Cygwin.\nFor some reason it decides to use gcc rather than g++ for the final linking and spits out a HUGE amount of undefined references to std::* stuffs.",
    "created_at": "2012-08-07T10:03:06Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121949",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:41'></a>
In fact the included libtool does not work well on Cygwin.
For some reason it decides to use gcc rather than g++ for the final linking and spits out a HUGE amount of undefined references to std::* stuffs.



---

archive/issue_comments_121950.json:
```json
{
    "body": "<a id='comment:42'></a>\nOk that's just a matter of adding -lstdc++ to the LDLIBS.",
    "created_at": "2012-08-07T10:11:59Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121950",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:42'></a>
Ok that's just a matter of adding -lstdc++ to the LDLIBS.



---

archive/issue_comments_121951.json:
```json
{
    "body": "<a id='comment:43'></a>\nReplying to [jpflori](#comment%3A42):\n> Ok that's just a matter of adding -lstdc++ to the LDLIBS.\n\nI'm doing the full rebuild. I even had to remove `/etc/rebase*` database and only then rebaseall, otherwise fork() errors kept popping up.\n\nPlease provide an updated ntl spkg.",
    "created_at": "2012-08-07T10:29:04Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121951",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:43'></a>
Replying to [jpflori](#comment%3A42):
> Ok that's just a matter of adding -lstdc++ to the LDLIBS.

I'm doing the full rebuild. I even had to remove `/etc/rebase*` database and only then rebaseall, otherwise fork() errors kept popping up.

Please provide an updated ntl spkg.



---

archive/issue_comments_121952.json:
```json
{
    "body": "<a id='comment:44'></a>\nReplying to [dimpase](#comment%3A35):\n> Replying to [jpflori](#comment%3A33):\n> > By the way, touching decl.pxi in sage/libs/ntl and then running \"sage -b\" seems to have fixed my install.\n> > At least Sage starts now without import errors.\n\n> not for me - I still needed to copy SAGELOCAL/bin/libntl.dll.a to SAGELOCAL/bin/libntl.dll to get past import errors.\n> \n> Then, the usual fork() problems on startup, and rebaseall does not help. I am afraid we're back to the root of the problem. I'll try to rebuild from scratch one more time, but this doesn't look good.\n\nThis might be due to the fact that I tried to follow your instruction to rebase everything in SAGEROOT rather than in SAGELOCAL, i.e. in SAGEROOT/local/, as I did before. In particular, there were dlls in devel/sage/build, which are not used, and this perhaps unnecessarily clogged up the address space.",
    "created_at": "2012-08-07T11:40:05Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121952",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:44'></a>
Replying to [dimpase](#comment%3A35):
> Replying to [jpflori](#comment%3A33):
> > By the way, touching decl.pxi in sage/libs/ntl and then running "sage -b" seems to have fixed my install.
> > At least Sage starts now without import errors.

> not for me - I still needed to copy SAGELOCAL/bin/libntl.dll.a to SAGELOCAL/bin/libntl.dll to get past import errors.
> 
> Then, the usual fork() problems on startup, and rebaseall does not help. I am afraid we're back to the root of the problem. I'll try to rebuild from scratch one more time, but this doesn't look good.

This might be due to the fact that I tried to follow your instruction to rebase everything in SAGEROOT rather than in SAGELOCAL, i.e. in SAGEROOT/local/, as I did before. In particular, there were dlls in devel/sage/build, which are not used, and this perhaps unnecessarily clogged up the address space.



---

archive/issue_comments_121953.json:
```json
{
    "body": "<a id='comment:45'></a>\nReplying to [jpflori](#comment%3A36):\n> Replying to [dimpase](#comment%3A35):\n> > Replying to [jpflori](#comment%3A33):\n> > > By the way, touching decl.pxi in sage/libs/ntl and then running \"sage -b\" seems to have fixed my install.\n\n> I also rebuild some spkg, at least flint, don't remember exactly which ones, could you check every dll? Writing such a script would be less time consuming than rebuilding Sage from scratch (and I did not have to rebase by the way).\n\nTo rebuild all spkgs that depend on NTL you can do\n\n```sh\n$ touch spkg/installed/ntl-*  # Of course not needed if you just (re)built it\n$ env SAGE_UPGRADING=yes make build\n```\n\nYou *may* still have to run `./sage -ba-force` afterwards; not sure whether `module_list.py` really covers all dependencies (on NTL in this case, but probably indirect dependencies as well).\n\nShould still be faster than rebuilding all from scratch... ;-)",
    "created_at": "2012-08-07T12:24:09Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121953",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:45'></a>
Replying to [jpflori](#comment%3A36):
> Replying to [dimpase](#comment%3A35):
> > Replying to [jpflori](#comment%3A33):
> > > By the way, touching decl.pxi in sage/libs/ntl and then running "sage -b" seems to have fixed my install.

> I also rebuild some spkg, at least flint, don't remember exactly which ones, could you check every dll? Writing such a script would be less time consuming than rebuilding Sage from scratch (and I did not have to rebase by the way).

To rebuild all spkgs that depend on NTL you can do

```sh
$ touch spkg/installed/ntl-*  # Of course not needed if you just (re)built it
$ env SAGE_UPGRADING=yes make build
```

You *may* still have to run `./sage -ba-force` afterwards; not sure whether `module_list.py` really covers all dependencies (on NTL in this case, but probably indirect dependencies as well).

Should still be faster than rebuilding all from scratch... ;-)



---

archive/issue_comments_121954.json:
```json
{
    "body": "<a id='comment:46'></a>\nThe one I just uploaded should be fine.\nIt builds ok on Linux, and I am testing it right now on Cygwin.",
    "created_at": "2012-08-07T12:26:26Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121954",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:46'></a>
The one I just uploaded should be fine.
It builds ok on Linux, and I am testing it right now on Cygwin.



---

archive/issue_comments_121955.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"cygwin ntl libtool spkg\".",
    "created_at": "2012-08-07T12:52:55Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121955",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

**Changing keywords** from "" to "cygwin ntl libtool spkg".



---

archive/issue_comments_121956.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,49 +1,13 @@\n In #11547, we added copying of several needed dlls on Cygwin.  However, in the meantime NTL had a fairly major update (#5731).\n \n-Based on this, this ticket splits off the NTL change from #11547 so that that ticket can get merged.  \n+From version 5.5, NTL provides a new build system using libtool (although libtool itself is not provided!) to generate shared libraries.\n+On Cygwin, libtool properly install the shared library as cygntl-?.dll in the bin directory and the import file as libntl.dll.a in the lib directory, together with a libtool file libntl.la and a static version of the library as libntl.a.\n \n-Spkg at [http://sage.math.washington.edu/home/kcrisman/ntl-5.5.2.p0.spkg](http://sage.math.washington.edu/home/kcrisman/ntl-5.5.2.p0.spkg).\n+In particular, this ensures that the shared version is linked with by default because ld/gcc/g++ find the .dll.a file in the lib directory (which points to the dll file in the bin directory) before the .a file.\n \n-Here is the previous diff - presumably we would do the same thing if we can confirm it is still necessary, which is almost certainly the case.\n+Moreover, only moving the previously built libntl.dll to libntl.dll.a was not a solution.\n+Indeed, the built file hardcoded its own build-time name into itself (as a DT_SONAME on linux), so that libraries linked to it (before or after renaming, does not matter) would in fact search for a file with the build time name... and fail.\n \n-```\n-diff -r 6cf0ce59b84a SPKG.txt\n---- a/SPKG.txt\tTue May 25 15:56:29 2010 -0700\n-+++ b/SPKG.txt\tTue Jun 28 22:44:18 2011 -0400\n-@@ -2,7 +2,10 @@\n- \n- == Description ==\n- \n--NTL is a high-performance, portable C++ library providing data structures and algorithms for manipulating signed, arbitrary length integers, and for vectors, matrices, and polynomials over the integers and over finite fields. \n-+NTL is a high-performance, portable C++ library providing data \n-+structures and algorithms for manipulating signed, arbitrary \n-+length integers, and for vectors, matrices, and polynomials over \n-+the integers and over finite fields. \n- \n- Website: http://www.shoup.net/ntl/\n- \n-@@ -27,6 +30,10 @@\n- \n- == Changelog ==\n- \n-+=== ntl-5.4.2.p13 (Karl-Dieter Crisman, June 28th 2011) ===\n-+ * Keep libntl.dll but also require libntl.dll.a on Cygwin.\n-+   This seems to be necessary for Sage to start - see #11547.\n-+\n- === ntl-5.4.2.p12 (Mike Hansen, May 25th 2010) ===\n-  * Rename libntl.dll to libntl.dll.a on Cygwin.  This is #9050.\n- \n-diff -r 6cf0ce59b84a spkg-install\n---- a/spkg-install\tTue May 25 15:56:29 2010 -0700\n-+++ b/spkg-install\tTue Jun 28 22:44:18 2011 -0400\n-@@ -120,7 +120,9 @@\n-             exit 1\n-         fi\n- \tcp libntl.dll \"$SAGE_LOCAL/lib/libntl.dll.a\"\n-+\tcp libntl.dll \"$SAGE_LOCAL/lib/libntl.dll\"\n- \tcp libntl.dll \"$SAGE_LOCAL/bin/libntl.dll.a\"\n-+\tcp libntl.dll \"$SAGE_LOCAL/bin/libntl.dll\"\n-         if [ ! -f \"$SAGE_LOCAL/bin/libntl.dll.a\" ]; then\n-             exit 1   # CRUCIAL that we have the dynamic link library\n-         fi\n-```\n+The spkg available at\n+http://perso.telecom-paristech.fr/~flori/sage/ntl-5.5.2.p0.spkg\n+vastly simplifies the old spkg-install, uses the (slightly patched) upstream build system and includes its own version of libtool (or rather the tools needed to generate it on the fly).\n``````\n",
    "created_at": "2012-08-07T12:52:55Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121956",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,49 +1,13 @@
 In #11547, we added copying of several needed dlls on Cygwin.  However, in the meantime NTL had a fairly major update (#5731).
 
-Based on this, this ticket splits off the NTL change from #11547 so that that ticket can get merged.  
+From version 5.5, NTL provides a new build system using libtool (although libtool itself is not provided!) to generate shared libraries.
+On Cygwin, libtool properly install the shared library as cygntl-?.dll in the bin directory and the import file as libntl.dll.a in the lib directory, together with a libtool file libntl.la and a static version of the library as libntl.a.
 
-Spkg at [http://sage.math.washington.edu/home/kcrisman/ntl-5.5.2.p0.spkg](http://sage.math.washington.edu/home/kcrisman/ntl-5.5.2.p0.spkg).
+In particular, this ensures that the shared version is linked with by default because ld/gcc/g++ find the .dll.a file in the lib directory (which points to the dll file in the bin directory) before the .a file.
 
-Here is the previous diff - presumably we would do the same thing if we can confirm it is still necessary, which is almost certainly the case.
+Moreover, only moving the previously built libntl.dll to libntl.dll.a was not a solution.
+Indeed, the built file hardcoded its own build-time name into itself (as a DT_SONAME on linux), so that libraries linked to it (before or after renaming, does not matter) would in fact search for a file with the build time name... and fail.
 
-```
-diff -r 6cf0ce59b84a SPKG.txt
---- a/SPKG.txt	Tue May 25 15:56:29 2010 -0700
-+++ b/SPKG.txt	Tue Jun 28 22:44:18 2011 -0400
-@@ -2,7 +2,10 @@
- 
- == Description ==
- 
--NTL is a high-performance, portable C++ library providing data structures and algorithms for manipulating signed, arbitrary length integers, and for vectors, matrices, and polynomials over the integers and over finite fields. 
-+NTL is a high-performance, portable C++ library providing data 
-+structures and algorithms for manipulating signed, arbitrary 
-+length integers, and for vectors, matrices, and polynomials over 
-+the integers and over finite fields. 
- 
- Website: http://www.shoup.net/ntl/
- 
-@@ -27,6 +30,10 @@
- 
- == Changelog ==
- 
-+=== ntl-5.4.2.p13 (Karl-Dieter Crisman, June 28th 2011) ===
-+ * Keep libntl.dll but also require libntl.dll.a on Cygwin.
-+   This seems to be necessary for Sage to start - see #11547.
-+
- === ntl-5.4.2.p12 (Mike Hansen, May 25th 2010) ===
-  * Rename libntl.dll to libntl.dll.a on Cygwin.  This is #9050.
- 
-diff -r 6cf0ce59b84a spkg-install
---- a/spkg-install	Tue May 25 15:56:29 2010 -0700
-+++ b/spkg-install	Tue Jun 28 22:44:18 2011 -0400
-@@ -120,7 +120,9 @@
-             exit 1
-         fi
- 	cp libntl.dll "$SAGE_LOCAL/lib/libntl.dll.a"
-+	cp libntl.dll "$SAGE_LOCAL/lib/libntl.dll"
- 	cp libntl.dll "$SAGE_LOCAL/bin/libntl.dll.a"
-+	cp libntl.dll "$SAGE_LOCAL/bin/libntl.dll"
-         if [ ! -f "$SAGE_LOCAL/bin/libntl.dll.a" ]; then
-             exit 1   # CRUCIAL that we have the dynamic link library
-         fi
-```
+The spkg available at
+http://perso.telecom-paristech.fr/~flori/sage/ntl-5.5.2.p0.spkg
+vastly simplifies the old spkg-install, uses the (slightly patched) upstream build system and includes its own version of libtool (or rather the tools needed to generate it on the fly).
``````




---

archive/issue_comments_121957.json:
```json
{
    "body": "**Changing author** from \"Karl-Dieter Crisman\" to \"Karl-Dieter Crisman, Jean-Pierre Flori\".",
    "created_at": "2012-08-07T12:52:55Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121957",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

**Changing author** from "Karl-Dieter Crisman" to "Karl-Dieter Crisman, Jean-Pierre Flori".



---

archive/issue_comments_121958.json:
```json
{
    "body": "<a id='comment:47'></a>\nOk, the latest spkg built correctly.\n\nAnyone wants to try on Mac OS? or Solaris?",
    "created_at": "2012-08-07T12:52:55Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121958",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:47'></a>
Ok, the latest spkg built correctly.

Anyone wants to try on Mac OS? or Solaris?



---

archive/issue_comments_121959.json:
```json
{
    "body": "<a id='comment:48'></a>\nReplying to [jpflori](#comment%3A47):\n> Ok, the latest spkg built correctly.\n> \n> Anyone wants to try on Mac OS? or Solaris?\n\nit works on MacOSX 10.6.8.",
    "created_at": "2012-08-07T13:05:30Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121959",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:48'></a>
Replying to [jpflori](#comment%3A47):
> Ok, the latest spkg built correctly.
> 
> Anyone wants to try on Mac OS? or Solaris?

it works on MacOSX 10.6.8.



---

archive/issue_comments_121960.json:
```json
{
    "body": "Replying to [ticket:11635 kcrisman]:\n> and includes its own version of libtool (or rather the tools needed to generate it on the fly).\n\nWhat does this mean?",
    "created_at": "2012-10-02T19:38:48Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121960",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:11635 kcrisman]:
> and includes its own version of libtool (or rather the tools needed to generate it on the fly).

What does this mean?



---

archive/issue_comments_121961.json:
```json
{
    "body": "<a id='comment:50'></a>\nAnyway, the spkg file gives me a 403 Forbidden error when trying to download it.",
    "created_at": "2012-10-02T19:40:03Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121961",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:50'></a>
Anyway, the spkg file gives me a 403 Forbidden error when trying to download it.



---

archive/issue_comments_121962.json:
```json
{
    "body": "**Work Issues:** HTTP 403",
    "created_at": "2012-10-02T19:40:03Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121962",
    "user": "https://github.com/jdemeyer"
}
```

**Work Issues:** HTTP 403



---

archive/issue_events_092651.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-10-02T19:40:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11635#event-92651"
}
```



---

archive/issue_events_092652.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-10-02T19:40:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11635#event-92652"
}
```



---

archive/issue_comments_121963.json:
```json
{
    "body": "<a id='comment:51'></a>\nperso.telecom-paristech.fr seems down (at least for my homepage).\nThe spkg is accessible at\nhttp://www.infres.enst.fr/~flori/sage/ntl-5.5.2.p0.spkg\n\nAnd by does not ship libtool, I really mean does not ship the machinery necessary to generate libtoolize, that is ltmain.sh et al. which is kind of non sense but is the case.",
    "created_at": "2012-10-02T20:01:11Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121963",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:51'></a>
perso.telecom-paristech.fr seems down (at least for my homepage).
The spkg is accessible at
http://www.infres.enst.fr/~flori/sage/ntl-5.5.2.p0.spkg

And by does not ship libtool, I really mean does not ship the machinery necessary to generate libtoolize, that is ltmain.sh et al. which is kind of non sense but is the case.



---

archive/issue_comments_121964.json:
```json
{
    "body": "**Changing work issues** from \"HTTP 403\" to \"\".",
    "created_at": "2012-10-02T20:01:11Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121964",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

**Changing work issues** from "HTTP 403" to "".



---

archive/issue_events_092653.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/jpflori",
    "created_at": "2012-10-02T20:01:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11635#event-92653"
}
```



---

archive/issue_events_092654.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/jpflori",
    "created_at": "2012-10-02T20:01:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11635#event-92654"
}
```



---

archive/issue_comments_121965.json:
```json
{
    "body": "<a id='comment:52'></a>\nReplying to [jpflori](#comment%3A51):\n> And by does not ship libtool, I really mean does not ship the machinery necessary to generate libtoolize, that is ltmain.sh et al. which is kind of non sense but is the case.\n\nI still don't quite understand what you mean, but I'll have a look some time...",
    "created_at": "2012-10-02T21:21:58Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121965",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:52'></a>
Replying to [jpflori](#comment%3A51):
> And by does not ship libtool, I really mean does not ship the machinery necessary to generate libtoolize, that is ltmain.sh et al. which is kind of non sense but is the case.

I still don't quite understand what you mean, but I'll have a look some time...



---

archive/issue_comments_121966.json:
```json
{
    "body": "<a id='comment:53'></a>\nI'll give it another try:\nSince version 5.5, NTL officially supports building a shared version of the library, but this require a system-wide installation of libtool(... be also aware that no other parts of autotools are used or required, there are only calls to \"libtool -mode=link ...\" in the Makefile, which is generated by a custom configure script):\nsee http://www.shoup.net/ntl/doc/tour-unix.html#shared\n\nThe Sage spkg was crafted before that new build system, and build shared libraries by patching the NTL old build system and defining custom targets.\n\nThe problem is that on Cygwin this patched build system installs a shared libntl.dll and static libntl.a and the .a files gets picked up by default by the linker when -lntl is passed, whereas we would want the .dll file to be picked.\nA previous proposed workaround was to copy libntl.dll.a to libntl.dll.a (.dll.a corresponds to import files and are picked up before .a files by the linker) but that's more of a hack than a real fix.\n\nSo we have to solution:\n- continue with our patched build system and modify the cygwin target to build a proper import file and install it with the shared .dll and static .a files\n- use NTL libtool based build system, but that requires to be able to include the needed piece to generate libtool (not libtoolize), that is ltmain.sh, install-sh, config.guess and config.sub as mentioned at http://www.gnu.org/software/libtool/manual/html_node/Distributing.html#Distributing (or to make a system-wide libtool a Sage dependency, which looks to be a bad idea).\nIIRC to use libtoolize to generate these 4 files would need some skeleton autotools project (i.e. a nearly empty configure.ac or Makefile.am and IIRC that's how I generated the four libtool files, just putting the strict minimal set of autotools macros in one of these two files).",
    "created_at": "2012-10-02T21:49:44Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121966",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:53'></a>
I'll give it another try:
Since version 5.5, NTL officially supports building a shared version of the library, but this require a system-wide installation of libtool(... be also aware that no other parts of autotools are used or required, there are only calls to "libtool -mode=link ..." in the Makefile, which is generated by a custom configure script):
see http://www.shoup.net/ntl/doc/tour-unix.html#shared

The Sage spkg was crafted before that new build system, and build shared libraries by patching the NTL old build system and defining custom targets.

The problem is that on Cygwin this patched build system installs a shared libntl.dll and static libntl.a and the .a files gets picked up by default by the linker when -lntl is passed, whereas we would want the .dll file to be picked.
A previous proposed workaround was to copy libntl.dll.a to libntl.dll.a (.dll.a corresponds to import files and are picked up before .a files by the linker) but that's more of a hack than a real fix.

So we have to solution:
- continue with our patched build system and modify the cygwin target to build a proper import file and install it with the shared .dll and static .a files
- use NTL libtool based build system, but that requires to be able to include the needed piece to generate libtool (not libtoolize), that is ltmain.sh, install-sh, config.guess and config.sub as mentioned at http://www.gnu.org/software/libtool/manual/html_node/Distributing.html#Distributing (or to make a system-wide libtool a Sage dependency, which looks to be a bad idea).
IIRC to use libtoolize to generate these 4 files would need some skeleton autotools project (i.e. a nearly empty configure.ac or Makefile.am and IIRC that's how I generated the four libtool files, just putting the strict minimal set of autotools macros in one of these two files).



---

archive/issue_comments_121967.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -8,6 +8,6 @@\n Moreover, only moving the previously built libntl.dll to libntl.dll.a was not a solution.\n Indeed, the built file hardcoded its own build-time name into itself (as a DT_SONAME on linux), so that libraries linked to it (before or after renaming, does not matter) would in fact search for a file with the build time name... and fail.\n \n-The spkg available at\n-http://perso.telecom-paristech.fr/~flori/sage/ntl-5.5.2.p0.spkg\n-vastly simplifies the old spkg-install, uses the (slightly patched) upstream build system and includes its own version of libtool (or rather the tools needed to generate it on the fly).\n+**spkg**: http://www.infres.enst.fr/~flori/sage/ntl-5.5.2.p0.spkg\n+\n+This spkg vastly simplifies the old spkg-install, uses the (slightly patched) upstream build system and includes its own version of libtool (or rather the tools needed to generate it on the fly).\n``````\n",
    "created_at": "2012-10-03T06:40:28Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121967",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -8,6 +8,6 @@
 Moreover, only moving the previously built libntl.dll to libntl.dll.a was not a solution.
 Indeed, the built file hardcoded its own build-time name into itself (as a DT_SONAME on linux), so that libraries linked to it (before or after renaming, does not matter) would in fact search for a file with the build time name... and fail.
 
-The spkg available at
-http://perso.telecom-paristech.fr/~flori/sage/ntl-5.5.2.p0.spkg
-vastly simplifies the old spkg-install, uses the (slightly patched) upstream build system and includes its own version of libtool (or rather the tools needed to generate it on the fly).
+**spkg**: http://www.infres.enst.fr/~flori/sage/ntl-5.5.2.p0.spkg
+
+This spkg vastly simplifies the old spkg-install, uses the (slightly patched) upstream build system and includes its own version of libtool (or rather the tools needed to generate it on the fly).
``````




---

archive/issue_comments_121968.json:
```json
{
    "body": "<a id='comment:55'></a>\nI don't know if I previously reported this, but this package works fine on Cygwin on XP, at least to the point that Sage starts and many doctests pass.",
    "created_at": "2012-10-08T14:40:43Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121968",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:55'></a>
I don't know if I previously reported this, but this package works fine on Cygwin on XP, at least to the point that Sage starts and many doctests pass.



---

archive/issue_comments_121969.json:
```json
{
    "body": "<a id='comment:56'></a>\nJP, what would you say needs still to be reviewed for this to be ready?",
    "created_at": "2012-12-06T02:29:09Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121969",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:56'></a>
JP, what would you say needs still to be reviewed for this to be ready?



---

archive/issue_comments_121970.json:
```json
{
    "body": "<a id='comment:57'></a>\nI guess someone else than me has to decide if my solution is correct, that is:\n* use a as less patched upstream build system as possible, and include some libtool related files which this system needs,\n* rather than use a completely custom one which only use some pieces of the upstream one.",
    "created_at": "2012-12-06T09:50:57Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121970",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:57'></a>
I guess someone else than me has to decide if my solution is correct, that is:
* use a as less patched upstream build system as possible, and include some libtool related files which this system needs,
* rather than use a completely custom one which only use some pieces of the upstream one.



---

archive/issue_comments_121971.json:
```json
{
    "body": "<a id='comment:58'></a>\nI can't review that piece, sadly.  I guess it would also be helpful to make sure this actually solves the Cygwin problem.  I still have to get Sage to start, forking problems, sigh...",
    "created_at": "2012-12-06T15:47:17Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121971",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:58'></a>
I can't review that piece, sadly.  I guess it would also be helpful to make sure this actually solves the Cygwin problem.  I still have to get Sage to start, forking problems, sigh...



---

archive/issue_comments_121972.json:
```json
{
    "body": "<a id='comment:59'></a>\nActually, now it does, magically.  Somehow installing cvxopt and sage-location resetting paths did the job.\n\nAs to the rest: I like the removed files (Debian and non-patches) and most of the patch file changes, though I can't speak for mfile.patch.  The changes in `spkg-check` seem right - why were those flags set anyway?  Things should have already been compiled by that point.  I would need some help in making sure that all the old stuff in `spkg-install` with respect to different soft links and so forth was no longer needed or handled by the `ntl_install()` function, but I assume it is.",
    "created_at": "2012-12-06T16:06:53Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121972",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:59'></a>
Actually, now it does, magically.  Somehow installing cvxopt and sage-location resetting paths did the job.

As to the rest: I like the removed files (Debian and non-patches) and most of the patch file changes, though I can't speak for mfile.patch.  The changes in `spkg-check` seem right - why were those flags set anyway?  Things should have already been compiled by that point.  I would need some help in making sure that all the old stuff in `spkg-install` with respect to different soft links and so forth was no longer needed or handled by the `ntl_install()` function, but I assume it is.



---

archive/issue_comments_121973.json:
```json
{
    "body": "<a id='comment:60'></a>\nThere is no need for soft links and/or copying files and/or renaming them.\n\nUsing libtool, the upstream build system install the following files on Cygwin:\n* lib/libntl.la (libtool magical file)\n* lib/libntl.dll.a (import file for the dynamic library)\n* lib/libntl.a (static archive)\n* bin/cygntl.dll (dynamic library)\n(some -<version> are surely missing here)\n\nWhen using -lntl, ld will find first libntl.dll.a and in the end link to the dynamic library cygntl.dll.\nThe only difference with linking directly to cygntl.dll (let's say by specifying its path rather than just -lntl) is that the linking will be a slower, but that's not really an issue, everything is already so slow on Cygwin, I don't think the difference is noticeable.\n\nOn other systems the difference in file installed are minimal and will surely go unnoticed and the shared library will still gets picked up first.",
    "created_at": "2012-12-06T16:21:36Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121973",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:60'></a>
There is no need for soft links and/or copying files and/or renaming them.

Using libtool, the upstream build system install the following files on Cygwin:
* lib/libntl.la (libtool magical file)
* lib/libntl.dll.a (import file for the dynamic library)
* lib/libntl.a (static archive)
* bin/cygntl.dll (dynamic library)
(some -<version> are surely missing here)

When using -lntl, ld will find first libntl.dll.a and in the end link to the dynamic library cygntl.dll.
The only difference with linking directly to cygntl.dll (let's say by specifying its path rather than just -lntl) is that the linking will be a slower, but that's not really an issue, everything is already so slow on Cygwin, I don't think the difference is noticeable.

On other systems the difference in file installed are minimal and will surely go unnoticed and the shared library will still gets picked up first.



---

archive/issue_comments_121974.json:
```json
{
    "body": "<a id='comment:61'></a>\nThis seems to be fine on Mac - relevant tests pass, if anything more quickly.\n\n```\n$ grep -r cygwin .\n<a whole bunch of libtool files and a more or less irrelevant reference in src/>\n```\nI mean, if the Sage library passes tests with this, I'm inclined to say let's get this **in**.    I still don't understand why upstream needs libtool to do its installing, but if that's a fairly standard solution in this kind of package then that should be okay too.[This is the Trac macro *Image* that was inherited from the migration called with arguments ())](https://trac.sagemath.org/wiki/WikiMacros#Image-macro)",
    "created_at": "2012-12-06T17:24:15Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121974",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:61'></a>
This seems to be fine on Mac - relevant tests pass, if anything more quickly.

```
$ grep -r cygwin .
<a whole bunch of libtool files and a more or less irrelevant reference in src/>
```
I mean, if the Sage library passes tests with this, I'm inclined to say let's get this **in**.    I still don't understand why upstream needs libtool to do its installing, but if that's a fairly standard solution in this kind of package then that should be okay too.[This is the Trac macro *Image* that was inherited from the migration called with arguments ())](https://trac.sagemath.org/wiki/WikiMacros#Image-macro)



---

archive/issue_comments_121975.json:
```json
{
    "body": "<a id='comment:62'></a>\nOkay, I can't give a 100% positive review because I know nothing about libtool, but using the upstream solution makes a heck of a lot more sense if we don't have to add any other dependencies and just a few files, and the pieces I *do* understand of it make sense.\n\nI built 5.5.rc0 with this on sage.math from scratch, and used `SAGE_UPGRADING=yes` on my Mac with this spkg in 5.4.rc2, and no doctest failures except on `sage/tests/startup.py` on sage.math, where it consistently seems to take 2.1 seconds, not less than 2 - but this was also true of a 5.4.rc1 build which didn't have this spkg, so it seems like there is just a heavy load there or something.  Coupled with its success on Cygwin, I am strongly inclined to give this positive review, modulo understanding libtool stuff.\n\nJeroen, do you get what JP is trying to do and can you give this positive review based on that part of the changes in the spkg?",
    "created_at": "2012-12-12T19:59:15Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121975",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:62'></a>
Okay, I can't give a 100% positive review because I know nothing about libtool, but using the upstream solution makes a heck of a lot more sense if we don't have to add any other dependencies and just a few files, and the pieces I *do* understand of it make sense.

I built 5.5.rc0 with this on sage.math from scratch, and used `SAGE_UPGRADING=yes` on my Mac with this spkg in 5.4.rc2, and no doctest failures except on `sage/tests/startup.py` on sage.math, where it consistently seems to take 2.1 seconds, not less than 2 - but this was also true of a 5.4.rc1 build which didn't have this spkg, so it seems like there is just a heavy load there or something.  Coupled with its success on Cygwin, I am strongly inclined to give this positive review, modulo understanding libtool stuff.

Jeroen, do you get what JP is trying to do and can you give this positive review based on that part of the changes in the spkg?



---

archive/issue_comments_121976.json:
```json
{
    "body": "**Reviewer:** Karl-Dieter Crisman",
    "created_at": "2012-12-12T19:59:15Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121976",
    "user": "https://github.com/kcrisman"
}
```

**Reviewer:** Karl-Dieter Crisman



---

archive/issue_comments_121977.json:
```json
{
    "body": "<a id='comment:63'></a>\n> Jeroen, do you get what JP is trying to do and can you give this positive review based on that part of the changes in the spkg?\n\nPing.  I almost think it would be better to just put this in and let the test farm find any problems; using upstream's tools seems logical.",
    "created_at": "2013-01-03T20:21:22Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121977",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:63'></a>
> Jeroen, do you get what JP is trying to do and can you give this positive review based on that part of the changes in the spkg?

Ping.  I almost think it would be better to just put this in and let the test farm find any problems; using upstream's tools seems logical.



---

archive/issue_events_092655.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-04T07:14:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11635#event-92655"
}
```



---

archive/issue_events_092656.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-04T07:14:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11635#event-92656"
}
```



---

archive/issue_comments_121978.json:
```json
{
    "body": "<a id='comment:64'></a>\nReplying to [kcrisman](#comment%3A63):\n> > Jeroen, do you get what JP is trying to do and can you give this positive review based on that part of the changes in the spkg?\n\n> \n> Ping.  I almost think it would be better to just put this in and let the test farm find any problems\n\nYou mean the Sage buildbot, right? In that case, just put the ticket to positive review if you are convinced that testing is the only thing remaining to be done.",
    "created_at": "2013-01-04T07:14:12Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121978",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:64'></a>
Replying to [kcrisman](#comment%3A63):
> > Jeroen, do you get what JP is trying to do and can you give this positive review based on that part of the changes in the spkg?

> 
> Ping.  I almost think it would be better to just put this in and let the test farm find any problems

You mean the Sage buildbot, right? In that case, just put the ticket to positive review if you are convinced that testing is the only thing remaining to be done.



---

archive/issue_comments_121979.json:
```json
{
    "body": "<a id='comment:65'></a>\nMinor comment: you should quote `$CUR` in `spkg-install`:\n\n```\ncd \"$CUR/src\"\n```",
    "created_at": "2013-01-04T07:52:50Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121979",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:65'></a>
Minor comment: you should quote `$CUR` in `spkg-install`:

```
cd "$CUR/src"
```



---

archive/issue_events_092657.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-04T07:52:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11635#event-92657"
}
```



---

archive/issue_events_092658.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-04T07:52:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11635#event-92658"
}
```



---

archive/issue_comments_121980.json:
```json
{
    "body": "<a id='comment:66'></a>\nAnd libtool should not be part of the Mercurial history, since it's just upstream files (similar to src).",
    "created_at": "2013-01-04T07:56:11Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121980",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:66'></a>
And libtool should not be part of the Mercurial history, since it's just upstream files (similar to src).



---

archive/issue_comments_121981.json:
```json
{
    "body": "<a id='comment:67'></a>\nThere is also a strange file `src/src/#mfile#` in the sources.\n\nI am preparing a new spkg.",
    "created_at": "2013-01-04T08:04:20Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121981",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:67'></a>
There is also a strange file `src/src/#mfile#` in the sources.

I am preparing a new spkg.



---

archive/issue_comments_121982.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -8,6 +8,6 @@\n Moreover, only moving the previously built libntl.dll to libntl.dll.a was not a solution.\n Indeed, the built file hardcoded its own build-time name into itself (as a DT_SONAME on linux), so that libraries linked to it (before or after renaming, does not matter) would in fact search for a file with the build time name... and fail.\n \n-**spkg**: http://www.infres.enst.fr/~flori/sage/ntl-5.5.2.p0.spkg\n+**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/ntl-5.5.2.p0.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/ntl-5.5.2.p0.spkg)\n \n This spkg vastly simplifies the old spkg-install, uses the (slightly patched) upstream build system and includes its own version of libtool (or rather the tools needed to generate it on the fly).\n``````\n",
    "created_at": "2013-01-04T08:10:24Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121982",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -8,6 +8,6 @@
 Moreover, only moving the previously built libntl.dll to libntl.dll.a was not a solution.
 Indeed, the built file hardcoded its own build-time name into itself (as a DT_SONAME on linux), so that libraries linked to it (before or after renaming, does not matter) would in fact search for a file with the build time name... and fail.
 
-**spkg**: http://www.infres.enst.fr/~flori/sage/ntl-5.5.2.p0.spkg
+**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/ntl-5.5.2.p0.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/ntl-5.5.2.p0.spkg)
 
 This spkg vastly simplifies the old spkg-install, uses the (slightly patched) upstream build system and includes its own version of libtool (or rather the tools needed to generate it on the fly).
``````




---

archive/issue_events_092659.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-04T08:10:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11635#event-92659"
}
```



---

archive/issue_events_092660.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-04T08:10:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11635#event-92660"
}
```



---

archive/issue_comments_121983.json:
```json
{
    "body": "Spkg diff, for review only.",
    "created_at": "2013-01-04T08:10:47Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121983",
    "user": "https://github.com/jdemeyer"
}
```

Spkg diff, for review only.



---

archive/attachments_015945.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "ntl-5.5.2.p0.diff",
    "asset_url": "tarball://root/attachments/ticket11635/ntl-5.5.2.p0.diff",
    "created_at": "2013-01-04T09:12:12Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket11635/ntl-5.5.2.p0.diff",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```



---

archive/issue_comments_121984.json:
```json
{
    "body": "<a id='comment:69'></a>\n**Attachment:** [ntl-5.5.2.p0.diff](https://github.com/sagemath/sage/files/ticket11635/ntl-5.5.2.p0.diff)\n\nThanks for improving the spkg.\nThe #mfile# is just some crap emacs must have produced.",
    "created_at": "2013-01-04T09:12:12Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121984",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:69'></a>
**Attachment:** [ntl-5.5.2.p0.diff](https://github.com/sagemath/sage/files/ticket11635/ntl-5.5.2.p0.diff)

Thanks for improving the spkg.
The #mfile# is just some crap emacs must have produced.



---

archive/issue_events_092661.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/jpflori",
    "created_at": "2013-01-04T09:12:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11635#event-92661"
}
```



---

archive/issue_events_092662.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/jpflori",
    "created_at": "2013-01-04T09:12:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11635#event-92662"
}
```



---

archive/issue_comments_121985.json:
```json
{
    "body": "<a id='comment:71'></a>\nSweet, I'll try this out on XP again right now.   Thanks",
    "created_at": "2013-01-04T14:22:39Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121985",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:71'></a>
Sweet, I'll try this out on XP again right now.   Thanks



---

archive/issue_comments_121986.json:
```json
{
    "body": "**Merged:** sage-5.6.beta3",
    "created_at": "2013-01-07T20:55:52Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121986",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.6.beta3



---

archive/issue_events_092663.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-07T20:55:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11635#event-92663"
}
```



---

archive/issue_events_092664.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-07T20:55:52Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11635#event-92664"
}
```



---

archive/issue_comments_121987.json:
```json
{
    "body": "**Changing author** from \"Karl-Dieter Crisman, Jean-Pierre Flori\" to \"Jean-Pierre Flori\".",
    "created_at": "2013-01-10T03:37:03Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121987",
    "user": "https://github.com/kcrisman"
}
```

**Changing author** from "Karl-Dieter Crisman, Jean-Pierre Flori" to "Jean-Pierre Flori".



---

archive/issue_comments_121988.json:
```json
{
    "body": "<a id='comment:73'></a>\nI think that my role as author was fairly limited in the final version, and presumably someone needs to have reviewed me in any case ;-)",
    "created_at": "2013-01-10T03:37:03Z",
    "issue": "https://github.com/sagemath/sage/issues/11635",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11635#issuecomment-121988",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:73'></a>
I think that my role as author was fairly limited in the final version, and presumably someone needs to have reviewed me in any case ;-)
