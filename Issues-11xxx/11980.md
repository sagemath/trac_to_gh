# Issue 11980: Improve naive point counting and implement zeta_function for hyperelliptic curves over finite fields

archive/issues_011808.json:
```json
{
    "body": "The following is not implemented (but can be done for hyperelliptic curves):\n\n```\nsage: P.<x> = PolynomialRing(GF(9,'a'))\nsage: H = HyperellipticCurve(x^5+x^2+1)\nsage: H.count_points(5)\nTraceback (most recent call last)\n...\nNotImplementedError: Point counting only implemented for schemes over prime fields\n```\nAlso, having a `count_points` for all cases, the Frobenius polynomial can be calculated. At the moment, this is calculated via `frobenius_matrix`, which is not always available:\n\n```\nsage: R.<t> = PolynomialRing(GF(8, 'a'))\nsage: H = HyperellipticCurve(t^5 + t + 2, t + 1)\nsage: H.frobenius_polynomial()\nTraceback (most recent call last):\n...\nNotImplementedError: only implemented for curves y^2 = f(x)\n```\n\nFurther, the zeta function can be calculated easily when the Frobenius polynomial is known.\n\nUse git branch.\n\nAssignee: @JohnCremona\n\nCC:  jantuitman minz @defeo @vbraun\n\nKeywords: sd35 hyperelliptic curve sd53\n\nBranch/Commit: c5b2f5d92936577e517f3a871e8f673727f33b10\n\nReviewer: Marco Streng, Volker Braun\n\nAuthor: Daniel Krenn, Jean-Pierre Flori\n\nDependencies: #15148\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/11980\n\n",
    "closed_at": "2014-07-17T00:01:15Z",
    "created_at": "2011-11-02T15:07:08Z",
    "labels": [
        "component: elliptic curves"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.3",
    "title": "Improve naive point counting and implement zeta_function for hyperelliptic curves over finite fields",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11980",
    "user": "https://github.com/dkrenn"
}
```
The following is not implemented (but can be done for hyperelliptic curves):

```
sage: P.<x> = PolynomialRing(GF(9,'a'))
sage: H = HyperellipticCurve(x^5+x^2+1)
sage: H.count_points(5)
Traceback (most recent call last)
...
NotImplementedError: Point counting only implemented for schemes over prime fields
```
Also, having a `count_points` for all cases, the Frobenius polynomial can be calculated. At the moment, this is calculated via `frobenius_matrix`, which is not always available:

```
sage: R.<t> = PolynomialRing(GF(8, 'a'))
sage: H = HyperellipticCurve(t^5 + t + 2, t + 1)
sage: H.frobenius_polynomial()
Traceback (most recent call last):
...
NotImplementedError: only implemented for curves y^2 = f(x)
```

Further, the zeta function can be calculated easily when the Frobenius polynomial is known.

Use git branch.

Assignee: @JohnCremona

CC:  jantuitman minz @defeo @vbraun

Keywords: sd35 hyperelliptic curve sd53

Branch/Commit: c5b2f5d92936577e517f3a871e8f673727f33b10

Reviewer: Marco Streng, Volker Braun

Author: Daniel Krenn, Jean-Pierre Flori

Dependencies: #15148

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/11980





---

archive/issue_comments_134805.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-11-02T15:09:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11980",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11980#issuecomment-134805",
    "user": "https://github.com/dkrenn"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_134806.json:
```json
{
    "body": "<a id='comment:1'></a>Attachment [trac_11980_count_points_frob_zeta.patch](tarball://root/attachments/some-uuid/ticket11980/trac_11980_count_points_frob_zeta.patch) by @dkrenn created at 2011-11-02 15:09:30",
    "created_at": "2011-11-02T15:09:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11980",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11980#issuecomment-134806",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:1'></a>Attachment [trac_11980_count_points_frob_zeta.patch](tarball://root/attachments/some-uuid/ticket11980/trac_11980_count_points_frob_zeta.patch) by @dkrenn created at 2011-11-02 15:09:30



---

archive/issue_comments_134807.json:
```json
{
    "body": "<a id='comment:4'></a>With the changes at #11930 it is no longer necessary to use is_singular, so that test could be removed.",
    "created_at": "2011-12-18T22:14:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11980",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11980#issuecomment-134807",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:4'></a>With the changes at #11930 it is no longer necessary to use is_singular, so that test could be removed.



---

archive/issue_comments_134808.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-12-18T22:14:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11980",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11980#issuecomment-134808",
    "user": "https://github.com/mstreng"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_134809.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd35 hyperelliptic curve\".",
    "created_at": "2012-01-03T09:37:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11980",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11980#issuecomment-134809",
    "user": "https://github.com/mstreng"
}
```

Changing keywords from "" to "sd35 hyperelliptic curve".



---

archive/issue_comments_134810.json:
```json
{
    "body": "<a id='comment:5'></a>In case f has even degree, the points at infinity are counted incorrectly by this patch. To get the correct characteristic polynomial of Frobenius, we must consider the smooth model of the curve. This is what you get when you desingularize at infinity. This smooth curve has 0, 1 or 2 points at infinity defined over the base field, so instead of just with 1, the count must start with 0, 1 or 2. (The count will not always agree with the count from the base class, as the base class thinks about the singular curve. See also #11800.)\n\nIn case `H : y^2 = f(x)` with degree(f) > 2, there are three cases:\n\n* degree(f) is odd: there is a unique point at infinity over the base field (a rational Weierstrass point at infinity)\n* degree(f) is even and its leading coefficient is a square: there are two points at infinity defined over the base field\n* degree(f) is even and its leading coefficient is not a square: there is no point at infinity defined over the base field (there are two points over a quadratic extension, and they are conjugate to each other)\n\nA similar list of cases can be written down in greater generality (including characteristic 2).\n\nAlternative to get the patch in quickly: raise an error if the curve is not of the form `y^2 = f(x)` with f of odd degree > 2.",
    "created_at": "2012-01-03T09:37:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11980",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11980#issuecomment-134810",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:5'></a>In case f has even degree, the points at infinity are counted incorrectly by this patch. To get the correct characteristic polynomial of Frobenius, we must consider the smooth model of the curve. This is what you get when you desingularize at infinity. This smooth curve has 0, 1 or 2 points at infinity defined over the base field, so instead of just with 1, the count must start with 0, 1 or 2. (The count will not always agree with the count from the base class, as the base class thinks about the singular curve. See also #11800.)

In case `H : y^2 = f(x)` with degree(f) > 2, there are three cases:

* degree(f) is odd: there is a unique point at infinity over the base field (a rational Weierstrass point at infinity)
* degree(f) is even and its leading coefficient is a square: there are two points at infinity defined over the base field
* degree(f) is even and its leading coefficient is not a square: there is no point at infinity defined over the base field (there are two points over a quadratic extension, and they are conjugate to each other)

A similar list of cases can be written down in greater generality (including characteristic 2).

Alternative to get the patch in quickly: raise an error if the curve is not of the form `y^2 = f(x)` with f of odd degree > 2.



---

archive/issue_events_031752.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11980",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11980#event-31752"
}
```



---

archive/issue_comments_134811.json:
```json
{
    "body": "Changing keywords from \"sd35 hyperelliptic curve\" to \"sd35 hyperelliptic curve sd53\".",
    "created_at": "2013-09-25T13:10:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11980",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11980#issuecomment-134811",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing keywords from "sd35 hyperelliptic curve" to "sd35 hyperelliptic curve sd53".



---

archive/issue_comments_134812.json:
```json
{
    "body": "<a id='comment:8'></a>See also #15148 where we are modifying count_points to actually use hypellfrob.\n(The ticket is not uptodte, I should be uploading there this afternoon hopefully.)",
    "created_at": "2013-09-25T13:10:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11980",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11980#issuecomment-134812",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:8'></a>See also #15148 where we are modifying count_points to actually use hypellfrob.
(The ticket is not uptodte, I should be uploading there this afternoon hopefully.)



---

archive/issue_comments_134813.json:
```json
{
    "body": "<a id='comment:9'></a>Ok, so Ive finished #15148, and after looking at what was I suggested here, I think what has to be done here, on top of #15148:\n* we should add the zeta_function method,\n* enhance the naive point counting I introduced in #15148 with some ideas from this ticket, namely replace my use of the extension method of finite fields by that of embeddings of a subfield into a super field using the Hom functor and the embedding it computes.",
    "created_at": "2013-09-26T17:08:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11980",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11980#issuecomment-134813",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:9'></a>Ok, so Ive finished #15148, and after looking at what was I suggested here, I think what has to be done here, on top of #15148:
* we should add the zeta_function method,
* enhance the naive point counting I introduced in #15148 with some ideas from this ticket, namely replace my use of the extension method of finite fields by that of embeddings of a subfield into a super field using the Hom functor and the embedding it computes.



---

archive/issue_comments_134814.json:
```json
{
    "body": "<a id='comment:10'></a>And I don't think this should depend on #15115 as it makes no use of the modification there.\nOk the current number of point is wrong, in the spirit of what is fixed in #15115, but in my code at #15148 it is right, so provided we base this ticket on top of #15148, the dependency on #15115 goes away.",
    "created_at": "2013-09-26T17:14:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11980",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11980#issuecomment-134814",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:10'></a>And I don't think this should depend on #15115 as it makes no use of the modification there.
Ok the current number of point is wrong, in the spirit of what is fixed in #15115, but in my code at #15148 it is right, so provided we base this ticket on top of #15148, the dependency on #15115 goes away.



---

archive/issue_comments_134815.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-09-27T16:48:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11980",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11980#issuecomment-134815",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_134816.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-09-27T16:54:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11980",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11980#issuecomment-134816",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_134817.json:
```json
{
    "body": "<a id='comment:15'></a>FYI, this still works fine without modifications after the merge of #15108 and the changes at #15148.",
    "created_at": "2013-12-25T17:15:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11980",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11980#issuecomment-134817",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:15'></a>FYI, this still works fine without modifications after the merge of #15108 and the changes at #15148.



---

archive/issue_events_031753.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11980",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11980#event-31753"
}
```



---

archive/issue_events_031754.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11980",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11980#event-31754"
}
```



---

archive/issue_comments_134818.json:
```json
{
    "body": "<a id='comment:17'></a>There are some failing doctests, see patchbot report.",
    "created_at": "2014-03-07T16:16:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11980",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11980#issuecomment-134818",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:17'></a>There are some failing doctests, see patchbot report.



---

archive/issue_comments_134819.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-03-07T16:16:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11980",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11980#issuecomment-134819",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_134820.json:
```json
{
    "body": "<a id='comment:18'></a>Did the patchbot actually managed to use the latest version?\n\nLast time I had a look at it it was stuck with an old comit, anyway, I'll give it a look tomorrow.",
    "created_at": "2014-03-10T22:35:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11980",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11980#issuecomment-134820",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:18'></a>Did the patchbot actually managed to use the latest version?

Last time I had a look at it it was stuck with an old comit, anyway, I'll give it a look tomorrow.



---

archive/issue_comments_134821.json:
```json
{
    "body": "<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-03-12T14:23:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11980",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11980#issuecomment-134821",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_134822.json:
```json
{
    "body": "<a id='comment:20'></a>I've merged the latest #15148 (hint: please review) and latest trac/develop (I don't know if the patchbot can make that alone, especially the former one using the dependencies field).\nNo problem in the schemes directory, I'm running the full long testsuite now.",
    "created_at": "2014-03-12T14:25:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11980",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11980#issuecomment-134822",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:20'></a>I've merged the latest #15148 (hint: please review) and latest trac/develop (I don't know if the patchbot can make that alone, especially the former one using the dependencies field).
No problem in the schemes directory, I'm running the full long testsuite now.



---

archive/issue_comments_134823.json:
```json
{
    "body": "<a id='comment:21'></a>I only got one error in ppl.pyx, but I fear it is unrelated.",
    "created_at": "2014-03-12T14:56:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11980",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11980#issuecomment-134823",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:21'></a>I only got one error in ppl.pyx, but I fear it is unrelated.



---

archive/issue_comments_134824.json:
```json
{
    "body": "<a id='comment:22'></a>And not reproducible...",
    "created_at": "2014-03-12T14:56:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11980",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11980#issuecomment-134824",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:22'></a>And not reproducible...



---

archive/issue_comments_134825.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-03-12T15:41:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11980",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11980#issuecomment-134825",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_134826.json:
```json
{
    "body": "<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-04-25T08:29:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11980",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11980#issuecomment-134826",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_031755.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11980",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11980#event-31755"
}
```



---

archive/issue_events_031756.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11980",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11980#event-31756"
}
```



---

archive/issue_comments_134827.json:
```json
{
    "body": "<a id='comment:27'></a>This looks good, as far as I can tell, but I am not competent to check that the new results are mathematically correct. I have made two tiny changes to the doc, and also taken the opportunity to run pyflakes on the changed file. Found three unused variable assignements. Two have been removed, the third one looks very suspect, so I have just added a comment besides it. I have also cleaned-up a little bit the code formatting around the suspect variable assignement.\n\n---\nNew commits:",
    "created_at": "2014-06-17T19:47:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11980",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11980#issuecomment-134827",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:27'></a>This looks good, as far as I can tell, but I am not competent to check that the new results are mathematically correct. I have made two tiny changes to the doc, and also taken the opportunity to run pyflakes on the changed file. Found three unused variable assignements. Two have been removed, the third one looks very suspect, so I have just added a comment besides it. I have also cleaned-up a little bit the code formatting around the suspect variable assignement.

---
New commits:



---

archive/issue_comments_134828.json:
```json
{
    "body": "<a id='comment:28'></a>IIRC there is no deep mathematics introduced here.\n\nJust need to use jacobi symbols to know how many ordinates go with an abscissa (0,1 or 2), the number of points at infinity (as here IIRC we're really computing the number of points on the desingularization of the curve).\n\nThe zeta funciton thing is just a very simple toy addition.",
    "created_at": "2014-07-07T13:43:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11980",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11980#issuecomment-134828",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:28'></a>IIRC there is no deep mathematics introduced here.

Just need to use jacobi symbols to know how many ordinates go with an abscissa (0,1 or 2), the number of points at infinity (as here IIRC we're really computing the number of points on the desingularization of the curve).

The zeta funciton thing is just a very simple toy addition.



---

archive/issue_events_031757.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-07-17T00:01:15Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11980",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11980#event-31757"
}
```



---

archive/issue_comments_134829.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-07-17T00:01:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11980",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11980#issuecomment-134829",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
