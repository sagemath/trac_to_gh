# Issue 11770: Add ability to detect CM number fields and take complex conjugate of their elements

archive/issues_011598.json:
```json
{
    "assignees": [],
    "body": "This ticket adds 3 functions to the NumberField class, 1 function to the RelativeNumberField class, and modifies 1 function of the NumberFieldElement class. For number fields, there's now a function that checks if self is a CM field, a function that returns the complex conjugation map of self (if self is contained in a CM field), and a function that finds the maximal totally real subfield of self. In the relative case, there's a function that checks if self is a CM extension. Finally, the conjugate function of NumberFieldElement is enhanced giving it the ability to compute the complex conjugate of any element in any totally real or CM field.\n\nApply [attachment: trac_11770_CM_field_functionality_v2.3.patch](https://github.com/sagemath/sage/files/ticket11770/trac_11770_CM_field_functionality_v2.3.patch.gz) then [attachment: trac_11770_reviewer.patch](https://github.com/sagemath/sage/files/ticket11770/trac_11770_reviewer.patch.gz) \n\nKeywords: **CM field**\n\nReviewer: **Francis Clarke, Jeroen Demeyer**\n\nAuthor: **Robert Harron**\n\nMerged: **sage-5.4.rc0**\n\nComponent: **number fields**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/11770_\n\n",
    "closed_at": "2012-09-28T07:47:09Z",
    "created_at": "2011-09-01T13:52:29Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20number%20fields",
        "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Add ability to detect CM number fields and take complex conjugate of their elements",
    "type": "issue",
    "updated_at": "2012-09-28T07:47:09Z",
    "url": "https://github.com/sagemath/sage/issues/11770",
    "user": "https://github.com/rharron"
}
```
This ticket adds 3 functions to the NumberField class, 1 function to the RelativeNumberField class, and modifies 1 function of the NumberFieldElement class. For number fields, there's now a function that checks if self is a CM field, a function that returns the complex conjugation map of self (if self is contained in a CM field), and a function that finds the maximal totally real subfield of self. In the relative case, there's a function that checks if self is a CM extension. Finally, the conjugate function of NumberFieldElement is enhanced giving it the ability to compute the complex conjugate of any element in any totally real or CM field.

Apply [attachment: trac_11770_CM_field_functionality_v2.3.patch](https://github.com/sagemath/sage/files/ticket11770/trac_11770_CM_field_functionality_v2.3.patch.gz) then [attachment: trac_11770_reviewer.patch](https://github.com/sagemath/sage/files/ticket11770/trac_11770_reviewer.patch.gz) 

Keywords: **CM field**

Reviewer: **Francis Clarke, Jeroen Demeyer**

Author: **Robert Harron**

Merged: **sage-5.4.rc0**

Component: **number fields**

_Issue created by migration from https://trac.sagemath.org/ticket/11770_





---

archive/issue_events_156612.json:
```json
{
    "actor": "https://github.com/rharron",
    "created_at": "2011-09-01T13:52:29Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "milestone_number": null,
    "milestone_title": "sage-5.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11770#event-156612"
}
```



---

archive/issue_events_156613.json:
```json
{
    "actor": "https://github.com/rharron",
    "created_at": "2011-09-01T13:52:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20number%20fields",
    "label_color": "0000ff",
    "label_name": "c: number fields",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11770#event-156613"
}
```



---

archive/issue_events_156614.json:
```json
{
    "actor": "https://github.com/rharron",
    "created_at": "2011-09-01T13:52:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
    "label_color": "ffe799",
    "label_name": "p: minor / 4",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11770#event-156614"
}
```



---

archive/issue_events_156615.json:
```json
{
    "actor": "https://github.com/rharron",
    "created_at": "2011-09-01T13:52:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11770#event-156615"
}
```



---

archive/issue_events_156616.json:
```json
{
    "actor": "https://github.com/rharron",
    "created_at": "2011-09-01T14:02:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11770#event-156616"
}
```



---

archive/issue_comments_122678.json:
```json
{
    "body": "Reviewer: **Francis Clarke**",
    "created_at": "2011-09-27T18:16:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11770#issuecomment-122678",
    "user": "https://github.com/sagetrac-fwclarke"
}
```

Reviewer: **Francis Clarke**



---

archive/issue_comments_122679.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nThis is a useful enhancement which seems to work well.  I have one suggestion for improving the code and a few minor niggles.\n\nIt seems to me that rather than computing the conjugate of elements of a CM field by doing a separate calculation for each element, it would be better to define the conjugation automorphism of the field.  The following draft code seems to do the job:\n\n```\n    def conjugation(self):\n        \"\"\"\n        Returns the conjugation automorphism for a CM field.\n        \"\"\"\n        if self.is_absolute(): \n            K = self\n        else:\n            K = self.absolute_field('z')\n        phi = [phi for F, phi, _ in K.subfields(K.degree()/2) if F.is_totally_real()][0]\n        K_rel = K.relativize(phi, 'z')\n        z0 = K_rel.gen()\n        z0_conj = -z0 - K_rel.defining_polynomial()[1]\n        z0_conj_abs = K_rel.structure()[0](z0_conj)\n        if self.is_absolute(): \n            return End(self)([z0_conj_abs])\n        else:\n            return End(self)(K.hom([K.structure()[0](z0_conj_abs)]))\n```\nThe above draft is, of course, lacking\n* doctests,\n* caching,\n* checking that `self` is  indeed a CM field, and \n* dealing with the special cases of totally real, quadratic and  cyclotomic fields.  \n\nIf `conjugation` is defined, `conjugate` could be defined as:\n\n```\n    def conjugate(self):\n        return self.parent().conjugation()(self)\n```\nA number of other, minor things:\n\nIn the docstring for `is_CM`\n\n```\n       The following is a non-cyclotomic CM field.\n       \n       ::\n           \n           sage: M.<a> = NumberField(x^4 - x^3 + x^2 - x + 1)\n```\nthe wording is a bit misleading since `M` is (isomorphic to) a cyclotomic field.\n\nThe lines\n\n```\n           sage: P.<y> = PolynomialRing(E_0)\n           sage: E.<b> = E_0.extension(P(y^2 + 1)) \n```\ncan be more simply written as\n\n```\n           sage: E.<b> = E_0.extension(x^2 + 1) \n```\nSimilarly for the `K.<j>` example in `conjugate`\n\nIn the code for `is_CM`, the lines\n\n```\n        try:\n            return self.__is_CM\n        except:\n            pass\n```\nought to be\n\n```\n        try:\n            return self.__is_CM\n        except Attribute_Error:\n            pass\n```\nsee  [Developer's Guide](http://www.sagemath.org/doc/developer/coding_in_python.html#exceptions).",
    "created_at": "2011-09-27T18:16:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11770#issuecomment-122679",
    "user": "https://github.com/sagetrac-fwclarke"
}
```

<div id="comment:2" align="right">comment:2</div>

This is a useful enhancement which seems to work well.  I have one suggestion for improving the code and a few minor niggles.

It seems to me that rather than computing the conjugate of elements of a CM field by doing a separate calculation for each element, it would be better to define the conjugation automorphism of the field.  The following draft code seems to do the job:

```
    def conjugation(self):
        """
        Returns the conjugation automorphism for a CM field.
        """
        if self.is_absolute(): 
            K = self
        else:
            K = self.absolute_field('z')
        phi = [phi for F, phi, _ in K.subfields(K.degree()/2) if F.is_totally_real()][0]
        K_rel = K.relativize(phi, 'z')
        z0 = K_rel.gen()
        z0_conj = -z0 - K_rel.defining_polynomial()[1]
        z0_conj_abs = K_rel.structure()[0](z0_conj)
        if self.is_absolute(): 
            return End(self)([z0_conj_abs])
        else:
            return End(self)(K.hom([K.structure()[0](z0_conj_abs)]))
```
The above draft is, of course, lacking
* doctests,
* caching,
* checking that `self` is  indeed a CM field, and 
* dealing with the special cases of totally real, quadratic and  cyclotomic fields.  

If `conjugation` is defined, `conjugate` could be defined as:

```
    def conjugate(self):
        return self.parent().conjugation()(self)
```
A number of other, minor things:

In the docstring for `is_CM`

```
       The following is a non-cyclotomic CM field.
       
       ::
           
           sage: M.<a> = NumberField(x^4 - x^3 + x^2 - x + 1)
```
the wording is a bit misleading since `M` is (isomorphic to) a cyclotomic field.

The lines

```
           sage: P.<y> = PolynomialRing(E_0)
           sage: E.<b> = E_0.extension(P(y^2 + 1)) 
```
can be more simply written as

```
           sage: E.<b> = E_0.extension(x^2 + 1) 
```
Similarly for the `K.<j>` example in `conjugate`

In the code for `is_CM`, the lines

```
        try:
            return self.__is_CM
        except:
            pass
```
ought to be

```
        try:
            return self.__is_CM
        except Attribute_Error:
            pass
```
see  [Developer's Guide](http://www.sagemath.org/doc/developer/coding_in_python.html#exceptions).



---

archive/issue_events_156617.json:
```json
{
    "actor": "https://github.com/sagetrac-fwclarke",
    "created_at": "2011-09-27T18:16:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11770#event-156617"
}
```



---

archive/issue_events_156618.json:
```json
{
    "actor": "https://github.com/sagetrac-fwclarke",
    "created_at": "2011-09-27T18:16:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11770#event-156618"
}
```



---

archive/issue_events_156619.json:
```json
{
    "actor": "https://github.com/rharron",
    "created_at": "2012-08-19T01:32:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11770#event-156619"
}
```



---

archive/issue_events_156620.json:
```json
{
    "actor": "https://github.com/rharron",
    "created_at": "2012-08-19T01:32:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11770#event-156620"
}
```



---

archive/issue_comments_122680.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nThanks to Francis Clarke for the review and comments. It's a great idea to have the complex conjugation map, so I've set it up that way. Also new is that I added a function is_CM_extension to the relative number field case, as well as a function maximal_totally_real_subfield to the number field class.",
    "created_at": "2012-08-19T01:32:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11770#issuecomment-122680",
    "user": "https://github.com/rharron"
}
```

<div id="comment:3" align="right">comment:3</div>

Thanks to Francis Clarke for the review and comments. It's a great idea to have the complex conjugation map, so I've set it up that way. Also new is that I added a function is_CM_extension to the relative number field case, as well as a function maximal_totally_real_subfield to the number field class.



---

archive/issue_comments_122681.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-This ticket adds a function to the NumberField class that checks if self is a CM field, and adds a function to the NumberFieldElement class giving the ability to compute the complex conjugate of an element in a totally real or CM field.\n+This ticket adds 3 functions to the NumberField class, 1 function to the RelativeNumberField class, and modifies 1 function of the NumberFieldElement class. For number fields, there's now a function that checks if self is a CM field, a function that returns the complex conjugation map of self (if self is contained in a CM field), and a function that finds the maximal totally real subfield of self. In the relative case, there's a function that checks if self is a CM extension. Finally, the conjugate function of NumberFieldElement is enhanced giving it the ability to compute the complex conjugate of any element in any totally real or CM field.\n``````\n",
    "created_at": "2012-08-19T01:32:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11770#issuecomment-122681",
    "user": "https://github.com/rharron"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-This ticket adds a function to the NumberField class that checks if self is a CM field, and adds a function to the NumberFieldElement class giving the ability to compute the complex conjugate of an element in a totally real or CM field.
+This ticket adds 3 functions to the NumberField class, 1 function to the RelativeNumberField class, and modifies 1 function of the NumberFieldElement class. For number fields, there's now a function that checks if self is a CM field, a function that returns the complex conjugation map of self (if self is contained in a CM field), and a function that finds the maximal totally real subfield of self. In the relative case, there's a function that checks if self is a CM extension. Finally, the conjugate function of NumberFieldElement is enhanced giving it the ability to compute the complex conjugate of any element in any totally real or CM field.
``````




---

archive/issue_comments_122682.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nVersion 2.1 of the patch fixes a problem in complex_conjugation where a number field was relativized with variable name 'a' (which raises an error when self has variable name 'a' as well). Oops! I didn't realize this would be a problem.",
    "created_at": "2012-08-19T04:53:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11770#issuecomment-122682",
    "user": "https://github.com/rharron"
}
```

<div id="comment:4" align="right">comment:4</div>

Version 2.1 of the patch fixes a problem in complex_conjugation where a number field was relativized with variable name 'a' (which raises an error when self has variable name 'a' as well). Oops! I didn't realize this would be a problem.



---

archive/issue_events_156621.json:
```json
{
    "actor": "https://github.com/sagetrac-fwclarke",
    "created_at": "2012-08-24T14:44:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11770#event-156621"
}
```



---

archive/issue_events_156622.json:
```json
{
    "actor": "https://github.com/sagetrac-fwclarke",
    "created_at": "2012-08-24T14:44:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11770#event-156622"
}
```



---

archive/issue_comments_122683.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nThe problem with naming relativized extensions is, of course, a (minor) bug in `relativize`.  But it is probably best left for now.\n\nThe code looks good, and doctests pass.  \n\nOne or two little things (all except the first are really questions of style):\n\n* The line break in lines 1933-34 of `number_field.py` introduces unwanted space (scroll across to see it):\n\n```\nsage:  NumberField(x^3 - 2, 'a').complex_conjugation()\nTraceback (most recent call last)\n...\nValueError: Complex conjugation is only well-defined for fields contained in CM                fields.\n```\n\n* At line 2038\n\n```\n        self.__max_tot_real_sub = self.subfield(zeta + zeta**(-1))\n```\n is simpler, and quicker except in small cases.\n\n* Lines 2052 to 2055 could more simply be replaced by\n\n```\n        for i in d.divisors()[1:]: \n```\n\n* I personally find doctests such as\n\n```\nsage: Q.<a> = NumberField(x - 1)\nsage: Q.is_CM() \nFalse \nsage: K.<i> = NumberField(x^2 + 1) \nsage: K.is_CM() \nTrue \nsage: L.<zeta20> = CyclotomicField(20) \nsage: L.is_CM() \nTrue \n```\n more readable as\n\n```\nsage: NumberField(x - 1, a).is_CM() \nFalse \nsage: NumberField(x^2 + 1, i).is_CM() \nTrue \nsage: CyclotomicField(20).is_CM() \nTrue \n```",
    "created_at": "2012-08-24T14:44:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11770#issuecomment-122683",
    "user": "https://github.com/sagetrac-fwclarke"
}
```

<div id="comment:5" align="right">comment:5</div>

The problem with naming relativized extensions is, of course, a (minor) bug in `relativize`.  But it is probably best left for now.

The code looks good, and doctests pass.  

One or two little things (all except the first are really questions of style):

* The line break in lines 1933-34 of `number_field.py` introduces unwanted space (scroll across to see it):

```
sage:  NumberField(x^3 - 2, 'a').complex_conjugation()
Traceback (most recent call last)
...
ValueError: Complex conjugation is only well-defined for fields contained in CM                fields.
```

* At line 2038

```
        self.__max_tot_real_sub = self.subfield(zeta + zeta**(-1))
```
 is simpler, and quicker except in small cases.

* Lines 2052 to 2055 could more simply be replaced by

```
        for i in d.divisors()[1:]: 
```

* I personally find doctests such as

```
sage: Q.<a> = NumberField(x - 1)
sage: Q.is_CM() 
False 
sage: K.<i> = NumberField(x^2 + 1) 
sage: K.is_CM() 
True 
sage: L.<zeta20> = CyclotomicField(20) 
sage: L.is_CM() 
True 
```
 more readable as

```
sage: NumberField(x - 1, a).is_CM() 
False 
sage: NumberField(x^2 + 1, i).is_CM() 
True 
sage: CyclotomicField(20).is_CM() 
True 
```



---

archive/issue_comments_122684.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI fixed the first two issues as suggested (for the second issue, I used that because that's how conjugate *currently* computes its answer for cyclotomic fields, but you're right taking the inverse is *significantly* quicker for large N). For the third issue, I've amended the code (what I had done was quite silly...) to use the list of divisors sorted in reverse order. For the final issue, I actually find it more readable the way I did it. To each their own I guess!",
    "created_at": "2012-08-24T17:38:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11770#issuecomment-122684",
    "user": "https://github.com/rharron"
}
```

<div id="comment:6" align="right">comment:6</div>

I fixed the first two issues as suggested (for the second issue, I used that because that's how conjugate *currently* computes its answer for cyclotomic fields, but you're right taking the inverse is *significantly* quicker for large N). For the third issue, I've amended the code (what I had done was quite silly...) to use the list of divisors sorted in reverse order. For the final issue, I actually find it more readable the way I did it. To each their own I guess!



---

archive/issue_events_156623.json:
```json
{
    "actor": "https://github.com/rharron",
    "created_at": "2012-08-24T17:38:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11770#event-156623"
}
```



---

archive/issue_events_156624.json:
```json
{
    "actor": "https://github.com/rharron",
    "created_at": "2012-08-24T17:38:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11770#event-156624"
}
```



---

archive/issue_comments_122685.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,4 @@\n This ticket adds 3 functions to the NumberField class, 1 function to the RelativeNumberField class, and modifies 1 function of the NumberFieldElement class. For number fields, there's now a function that checks if self is a CM field, a function that returns the complex conjugation map of self (if self is contained in a CM field), and a function that finds the maximal totally real subfield of self. In the relative case, there's a function that checks if self is a CM extension. Finally, the conjugate function of NumberFieldElement is enhanced giving it the ability to compute the complex conjugate of any element in any totally real or CM field.\n+\n+**Apply**\n+1. [attachment: trac_11770_CM_field_functionality_v2.2.patch]\n``````\n",
    "created_at": "2012-08-24T19:21:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11770#issuecomment-122685",
    "user": "https://github.com/sagetrac-fwclarke"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,4 @@
 This ticket adds 3 functions to the NumberField class, 1 function to the RelativeNumberField class, and modifies 1 function of the NumberFieldElement class. For number fields, there's now a function that checks if self is a CM field, a function that returns the complex conjugation map of self (if self is contained in a CM field), and a function that finds the maximal totally real subfield of self. In the relative case, there's a function that checks if self is a CM extension. Finally, the conjugate function of NumberFieldElement is enhanced giving it the ability to compute the complex conjugate of any element in any totally real or CM field.
+
+**Apply**
+1. [attachment: trac_11770_CM_field_functionality_v2.2.patch]
``````




---

archive/issue_events_156625.json:
```json
{
    "actor": "https://github.com/sagetrac-fwclarke",
    "created_at": "2012-08-24T19:21:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11770#event-156625"
}
```



---

archive/issue_events_156626.json:
```json
{
    "actor": "https://github.com/sagetrac-fwclarke",
    "created_at": "2012-08-24T19:21:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11770#event-156626"
}
```



---

archive/issue_comments_122686.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nIn great shape.  Positive review.",
    "created_at": "2012-08-24T19:21:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11770#issuecomment-122686",
    "user": "https://github.com/sagetrac-fwclarke"
}
```

<div id="comment:7" align="right">comment:7</div>

In great shape.  Positive review.



---

archive/issue_events_156627.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-08-24T20:37:02Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "milestone_number": null,
    "milestone_title": "sage-5.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11770#event-156627"
}
```



---

archive/issue_events_156628.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-08-24T20:37:02Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "milestone_number": null,
    "milestone_title": "sage-5.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11770#event-156628"
}
```



---

archive/issue_comments_122687.json:
```json
{
    "body": "Attachment: **[trac_11770_CM_field_functionality_v2.3.patch.gz](https://github.com/sagemath/sage/files/ticket11770/trac_11770_CM_field_functionality_v2.3.patch.gz)**\n\nChanged use of multiplicative_order in complex_conjugation as well!",
    "created_at": "2012-08-24T22:05:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11770#issuecomment-122687",
    "user": "https://github.com/rharron"
}
```

Attachment: **[trac_11770_CM_field_functionality_v2.3.patch.gz](https://github.com/sagemath/sage/files/ticket11770/trac_11770_CM_field_functionality_v2.3.patch.gz)**

Changed use of multiplicative_order in complex_conjugation as well!



---

archive/issue_comments_122688.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nOops! There was another use of zeta.multiplicative_order() in the complex_conjugation() function. I have now changed that in version 2.3. I don't know how to change this back to needs_review...",
    "created_at": "2012-08-24T22:08:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11770#issuecomment-122688",
    "user": "https://github.com/rharron"
}
```

<div id="comment:9" align="right">comment:9</div>

Oops! There was another use of zeta.multiplicative_order() in the complex_conjugation() function. I have now changed that in version 2.3. I don't know how to change this back to needs_review...



---

archive/issue_comments_122689.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@rharron](#comment%3A9):\n> Oops! There was another use of zeta.multiplicative_order() in the complex_conjugation() function. I have now changed that in version 2.3. I don't know how to change this back to needs_review...\n\nYes, I should have spotted this.  The positive review can, of course, stay (I think the way to \"needs review\" is via \"needs work\").  But I've altered the description to refer to version 2.3.",
    "created_at": "2012-08-25T10:29:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11770#issuecomment-122689",
    "user": "https://github.com/sagetrac-fwclarke"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@rharron](#comment%3A9):
> Oops! There was another use of zeta.multiplicative_order() in the complex_conjugation() function. I have now changed that in version 2.3. I don't know how to change this back to needs_review...

Yes, I should have spotted this.  The positive review can, of course, stay (I think the way to "needs review" is via "needs work").  But I've altered the description to refer to version 2.3.



---

archive/issue_comments_122690.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,3 @@\n This ticket adds 3 functions to the NumberField class, 1 function to the RelativeNumberField class, and modifies 1 function of the NumberFieldElement class. For number fields, there's now a function that checks if self is a CM field, a function that returns the complex conjugation map of self (if self is contained in a CM field), and a function that finds the maximal totally real subfield of self. In the relative case, there's a function that checks if self is a CM extension. Finally, the conjugate function of NumberFieldElement is enhanced giving it the ability to compute the complex conjugate of any element in any totally real or CM field.\n \n-**Apply**\n-1. [attachment: trac_11770_CM_field_functionality_v2.2.patch]\n+**apply** [attachment: trac_11770_CM_field_functionality_v2.3.patch](https://github.com/sagemath/sage/files/ticket11770/trac_11770_CM_field_functionality_v2.3.patch.gz)\n``````\n",
    "created_at": "2012-08-25T10:29:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11770#issuecomment-122690",
    "user": "https://github.com/sagetrac-fwclarke"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,3 @@
 This ticket adds 3 functions to the NumberField class, 1 function to the RelativeNumberField class, and modifies 1 function of the NumberFieldElement class. For number fields, there's now a function that checks if self is a CM field, a function that returns the complex conjugation map of self (if self is contained in a CM field), and a function that finds the maximal totally real subfield of self. In the relative case, there's a function that checks if self is a CM extension. Finally, the conjugate function of NumberFieldElement is enhanced giving it the ability to compute the complex conjugate of any element in any totally real or CM field.
 
-**Apply**
-1. [attachment: trac_11770_CM_field_functionality_v2.2.patch]
+**apply** [attachment: trac_11770_CM_field_functionality_v2.3.patch](https://github.com/sagemath/sage/files/ticket11770/trac_11770_CM_field_functionality_v2.3.patch.gz)
``````




---

archive/issue_comments_122691.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nThe patchbot appears to be attempting to apply not only v2.3 of the patch, but also the original patch from a year ago. Is there something that needs to be done about this?",
    "created_at": "2012-08-30T17:23:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11770#issuecomment-122691",
    "user": "https://github.com/rharron"
}
```

<div id="comment:11" align="right">comment:11</div>

The patchbot appears to be attempting to apply not only v2.3 of the patch, but also the original patch from a year ago. Is there something that needs to be done about this?



---

archive/issue_comments_122692.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nI've tried simplifying the directive in the description to put it in exactly the form specified in http://wiki.sagemath.org/buildbot  Perhaps this will work, but I worry about the statement there that \"[a]ny subsequently added patches will be (semi-intelligently) appended to the list.\"",
    "created_at": "2012-09-02T17:48:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11770#issuecomment-122692",
    "user": "https://github.com/sagetrac-fwclarke"
}
```

<div id="comment:12" align="right">comment:12</div>

I've tried simplifying the directive in the description to put it in exactly the form specified in http://wiki.sagemath.org/buildbot  Perhaps this will work, but I worry about the statement there that "[a]ny subsequently added patches will be (semi-intelligently) appended to the list."



---

archive/issue_comments_122693.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n This ticket adds 3 functions to the NumberField class, 1 function to the RelativeNumberField class, and modifies 1 function of the NumberFieldElement class. For number fields, there's now a function that checks if self is a CM field, a function that returns the complex conjugation map of self (if self is contained in a CM field), and a function that finds the maximal totally real subfield of self. In the relative case, there's a function that checks if self is a CM extension. Finally, the conjugate function of NumberFieldElement is enhanced giving it the ability to compute the complex conjugate of any element in any totally real or CM field.\n \n-**apply** [attachment: trac_11770_CM_field_functionality_v2.3.patch](https://github.com/sagemath/sage/files/ticket11770/trac_11770_CM_field_functionality_v2.3.patch.gz)\n+Apply trac_11770_CM_field_functionality_v2.3.patch\n``````\n",
    "created_at": "2012-09-02T17:48:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11770#issuecomment-122693",
    "user": "https://github.com/sagetrac-fwclarke"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 This ticket adds 3 functions to the NumberField class, 1 function to the RelativeNumberField class, and modifies 1 function of the NumberFieldElement class. For number fields, there's now a function that checks if self is a CM field, a function that returns the complex conjugation map of self (if self is contained in a CM field), and a function that finds the maximal totally real subfield of self. In the relative case, there's a function that checks if self is a CM extension. Finally, the conjugate function of NumberFieldElement is enhanced giving it the ability to compute the complex conjugate of any element in any totally real or CM field.
 
-**apply** [attachment: trac_11770_CM_field_functionality_v2.3.patch](https://github.com/sagemath/sage/files/ticket11770/trac_11770_CM_field_functionality_v2.3.patch.gz)
+Apply trac_11770_CM_field_functionality_v2.3.patch
``````




---

archive/issue_comments_122694.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\napply trac_11770_CM_field_functionality_v2.3.patch",
    "created_at": "2012-09-02T18:12:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11770#issuecomment-122694",
    "user": "https://github.com/rharron"
}
```

<div id="comment:13" align="right">comment:13</div>

apply trac_11770_CM_field_functionality_v2.3.patch



---

archive/issue_comments_122695.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nIt didn't seem to work, for some reason...\n\nApply trac_11770_CM_field_functionality_v2.3.patch",
    "created_at": "2012-09-02T21:10:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11770#issuecomment-122695",
    "user": "https://github.com/kini"
}
```

<div id="comment:14" align="right">comment:14</div>

It didn't seem to work, for some reason...

Apply trac_11770_CM_field_functionality_v2.3.patch



---

archive/issue_comments_122696.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nOK, it's still not working. I'll try deleting the first patch and see if that fixes it.",
    "created_at": "2012-09-02T21:10:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11770#issuecomment-122696",
    "user": "https://github.com/kini"
}
```

<div id="comment:15" align="right">comment:15</div>

OK, it's still not working. I'll try deleting the first patch and see if that fixes it.



---

archive/issue_comments_122697.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nThat seems to have done it. Now to wait for a patchbot to see it :)",
    "created_at": "2012-09-02T21:11:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11770#issuecomment-122697",
    "user": "https://github.com/kini"
}
```

<div id="comment:16" align="right">comment:16</div>

That seems to have done it. Now to wait for a patchbot to see it :)



---

archive/issue_comments_122698.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@kini](#comment%3A16):\n> That seems to have done it. Now to wait for a patchbot to see it :)\n\nLooks like that fixed it! Thanks!",
    "created_at": "2012-09-03T05:32:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11770#issuecomment-122698",
    "user": "https://github.com/rharron"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@kini](#comment%3A16):
> That seems to have done it. Now to wait for a patchbot to see it :)

Looks like that fixed it! Thanks!



---

archive/issue_comments_122699.json:
```json
{
    "body": "Merged: **sage-5.4.beta0**",
    "created_at": "2012-09-03T12:52:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11770#issuecomment-122699",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.4.beta0**



---

archive/issue_events_156629.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-09-03T12:52:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11770#event-156629"
}
```



---

archive/issue_events_156630.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-09-03T12:52:20Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11770#event-156630"
}
```



---

archive/issue_comments_122700.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nMy additional patch [attachment: 11770_long_time.patch](https://github.com/sagemath/sage/files/ticket11770/11770_long_time.patch.gz) needs review (just mention the review in the comments, don't change the status).",
    "created_at": "2012-09-21T09:20:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11770#issuecomment-122700",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:19" align="right">comment:19</div>

My additional patch [attachment: 11770_long_time.patch](https://github.com/sagemath/sage/files/ticket11770/11770_long_time.patch.gz) needs review (just mention the review in the comments, don't change the status).



---

archive/issue_comments_122701.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n This ticket adds 3 functions to the NumberField class, 1 function to the RelativeNumberField class, and modifies 1 function of the NumberFieldElement class. For number fields, there's now a function that checks if self is a CM field, a function that returns the complex conjugation map of self (if self is contained in a CM field), and a function that finds the maximal totally real subfield of self. In the relative case, there's a function that checks if self is a CM extension. Finally, the conjugate function of NumberFieldElement is enhanced giving it the ability to compute the complex conjugate of any element in any totally real or CM field.\n \n-Apply trac_11770_CM_field_functionality_v2.3.patch\n+Apply [trac_11770_CM_field_functionality_v2.3.patch] and [attachment: 11770_long_time.patch](https://github.com/sagemath/sage/files/ticket11770/11770_long_time.patch.gz)\n``````\n",
    "created_at": "2012-09-21T09:24:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11770#issuecomment-122701",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 This ticket adds 3 functions to the NumberField class, 1 function to the RelativeNumberField class, and modifies 1 function of the NumberFieldElement class. For number fields, there's now a function that checks if self is a CM field, a function that returns the complex conjugation map of self (if self is contained in a CM field), and a function that finds the maximal totally real subfield of self. In the relative case, there's a function that checks if self is a CM extension. Finally, the conjugate function of NumberFieldElement is enhanced giving it the ability to compute the complex conjugate of any element in any totally real or CM field.
 
-Apply trac_11770_CM_field_functionality_v2.3.patch
+Apply [trac_11770_CM_field_functionality_v2.3.patch] and [attachment: 11770_long_time.patch](https://github.com/sagemath/sage/files/ticket11770/11770_long_time.patch.gz)
``````




---

archive/issue_comments_122702.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n This ticket adds 3 functions to the NumberField class, 1 function to the RelativeNumberField class, and modifies 1 function of the NumberFieldElement class. For number fields, there's now a function that checks if self is a CM field, a function that returns the complex conjugation map of self (if self is contained in a CM field), and a function that finds the maximal totally real subfield of self. In the relative case, there's a function that checks if self is a CM extension. Finally, the conjugate function of NumberFieldElement is enhanced giving it the ability to compute the complex conjugate of any element in any totally real or CM field.\n \n-Apply [trac_11770_CM_field_functionality_v2.3.patch] and [attachment: 11770_long_time.patch](https://github.com/sagemath/sage/files/ticket11770/11770_long_time.patch.gz)\n+Apply [attachment: trac_11770_CM_field_functionality_v2.3.patch](https://github.com/sagemath/sage/files/ticket11770/trac_11770_CM_field_functionality_v2.3.patch.gz) and [attachment: 11770_long_time.patch](https://github.com/sagemath/sage/files/ticket11770/11770_long_time.patch.gz)\n``````\n",
    "created_at": "2012-09-24T06:42:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11770#issuecomment-122702",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 This ticket adds 3 functions to the NumberField class, 1 function to the RelativeNumberField class, and modifies 1 function of the NumberFieldElement class. For number fields, there's now a function that checks if self is a CM field, a function that returns the complex conjugation map of self (if self is contained in a CM field), and a function that finds the maximal totally real subfield of self. In the relative case, there's a function that checks if self is a CM extension. Finally, the conjugate function of NumberFieldElement is enhanced giving it the ability to compute the complex conjugate of any element in any totally real or CM field.
 
-Apply [trac_11770_CM_field_functionality_v2.3.patch] and [attachment: 11770_long_time.patch](https://github.com/sagemath/sage/files/ticket11770/11770_long_time.patch.gz)
+Apply [attachment: trac_11770_CM_field_functionality_v2.3.patch](https://github.com/sagemath/sage/files/ticket11770/trac_11770_CM_field_functionality_v2.3.patch.gz) and [attachment: 11770_long_time.patch](https://github.com/sagemath/sage/files/ticket11770/11770_long_time.patch.gz)
``````




---

archive/issue_comments_122703.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n This ticket adds 3 functions to the NumberField class, 1 function to the RelativeNumberField class, and modifies 1 function of the NumberFieldElement class. For number fields, there's now a function that checks if self is a CM field, a function that returns the complex conjugation map of self (if self is contained in a CM field), and a function that finds the maximal totally real subfield of self. In the relative case, there's a function that checks if self is a CM extension. Finally, the conjugate function of NumberFieldElement is enhanced giving it the ability to compute the complex conjugate of any element in any totally real or CM field.\n \n-Apply [attachment: trac_11770_CM_field_functionality_v2.3.patch](https://github.com/sagemath/sage/files/ticket11770/trac_11770_CM_field_functionality_v2.3.patch.gz) and [attachment: 11770_long_time.patch](https://github.com/sagemath/sage/files/ticket11770/11770_long_time.patch.gz)\n+Apply [attachment: trac_11770_CM_field_functionality_v2.3.patch](https://github.com/sagemath/sage/files/ticket11770/trac_11770_CM_field_functionality_v2.3.patch.gz) and [attachment: 11770_long_time.patch](https://github.com/sagemath/sage/files/ticket11770/11770_long_time.patch.gz) **(second patch needs review)**\n``````\n",
    "created_at": "2012-09-24T06:42:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11770#issuecomment-122703",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 This ticket adds 3 functions to the NumberField class, 1 function to the RelativeNumberField class, and modifies 1 function of the NumberFieldElement class. For number fields, there's now a function that checks if self is a CM field, a function that returns the complex conjugation map of self (if self is contained in a CM field), and a function that finds the maximal totally real subfield of self. In the relative case, there's a function that checks if self is a CM extension. Finally, the conjugate function of NumberFieldElement is enhanced giving it the ability to compute the complex conjugate of any element in any totally real or CM field.
 
-Apply [attachment: trac_11770_CM_field_functionality_v2.3.patch](https://github.com/sagemath/sage/files/ticket11770/trac_11770_CM_field_functionality_v2.3.patch.gz) and [attachment: 11770_long_time.patch](https://github.com/sagemath/sage/files/ticket11770/11770_long_time.patch.gz)
+Apply [attachment: trac_11770_CM_field_functionality_v2.3.patch](https://github.com/sagemath/sage/files/ticket11770/trac_11770_CM_field_functionality_v2.3.patch.gz) and [attachment: 11770_long_time.patch](https://github.com/sagemath/sage/files/ticket11770/11770_long_time.patch.gz) **(second patch needs review)**
``````




---

archive/issue_comments_122704.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@jdemeyer](#comment%3A19):\n> My additional patch [attachment: 11770_long_time.patch](https://github.com/sagemath/sage/files/ticket11770/11770_long_time.patch.gz) needs review\n\nI don't think this does the job.  The second example\n\n```\n        sage: d = a^253 \n        sage: (d+d.conjugate()).is_real_positive() \n```\n will take just as long if the first one isn't executed.  It's only quicker after the first because conjugation has been cached.\n\nBut computation of the conjugation automorphism can be greatly speeded up by a minor change.  What's taking the time is the following step:\n\n```\nsage: %timeit K.hom([a^-1])\n5 loops, best of 3: 29 s per loop\n```\nBut checking can be turned off, since we know that this does define an automorphism.  Thus\n\n```\nsage: %timeit K.hom([a^-1], check=False)\n125 loops, best of 3: 3.28 ms per loop\n```\nSeveral speed-ups of this kind occur in the patch to #10843 (still waiting a review).\n\nSo I conclude that the long-time patch is unnecessary, but that a minor change should be made in the new line 1926 of the definition of complex_conjugation.\n\n > (just mention the review in the comments, don't change the status).\n\nI haven't changed the status, but I believe that \"needs work\" is where it should be.",
    "created_at": "2012-09-24T12:46:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11770#issuecomment-122704",
    "user": "https://github.com/sagetrac-fwclarke"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@jdemeyer](#comment%3A19):
> My additional patch [attachment: 11770_long_time.patch](https://github.com/sagemath/sage/files/ticket11770/11770_long_time.patch.gz) needs review

I don't think this does the job.  The second example

```
        sage: d = a^253 
        sage: (d+d.conjugate()).is_real_positive() 
```
 will take just as long if the first one isn't executed.  It's only quicker after the first because conjugation has been cached.

But computation of the conjugation automorphism can be greatly speeded up by a minor change.  What's taking the time is the following step:

```
sage: %timeit K.hom([a^-1])
5 loops, best of 3: 29 s per loop
```
But checking can be turned off, since we know that this does define an automorphism.  Thus

```
sage: %timeit K.hom([a^-1], check=False)
125 loops, best of 3: 3.28 ms per loop
```
Several speed-ups of this kind occur in the patch to #10843 (still waiting a review).

So I conclude that the long-time patch is unnecessary, but that a minor change should be made in the new line 1926 of the definition of complex_conjugation.

 > (just mention the review in the comments, don't change the status).

I haven't changed the status, but I believe that "needs work" is where it should be.



---

archive/issue_comments_122705.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@sagetrac-fwclarke](#comment%3A23):\n> So I conclude that the long-time patch is unnecessary, but that a minor change should be made in the new line 1926 of the definition of complex_conjugation.\n\nCould you make that change, since you obviously understand what's going on in this patch.",
    "created_at": "2012-09-24T18:31:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11770#issuecomment-122705",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@sagetrac-fwclarke](#comment%3A23):
> So I conclude that the long-time patch is unnecessary, but that a minor change should be made in the new line 1926 of the definition of complex_conjugation.

Could you make that change, since you obviously understand what's going on in this patch.



---

archive/issue_comments_122706.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n This ticket adds 3 functions to the NumberField class, 1 function to the RelativeNumberField class, and modifies 1 function of the NumberFieldElement class. For number fields, there's now a function that checks if self is a CM field, a function that returns the complex conjugation map of self (if self is contained in a CM field), and a function that finds the maximal totally real subfield of self. In the relative case, there's a function that checks if self is a CM extension. Finally, the conjugate function of NumberFieldElement is enhanced giving it the ability to compute the complex conjugate of any element in any totally real or CM field.\n \n-Apply [attachment: trac_11770_CM_field_functionality_v2.3.patch](https://github.com/sagemath/sage/files/ticket11770/trac_11770_CM_field_functionality_v2.3.patch.gz) and [attachment: 11770_long_time.patch](https://github.com/sagemath/sage/files/ticket11770/11770_long_time.patch.gz) **(second patch needs review)**\n+Apply [attachment: trac_11770_CM_field_functionality_v2.3.patch](https://github.com/sagemath/sage/files/ticket11770/trac_11770_CM_field_functionality_v2.3.patch.gz)\n``````\n",
    "created_at": "2012-09-25T06:45:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11770#issuecomment-122706",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 This ticket adds 3 functions to the NumberField class, 1 function to the RelativeNumberField class, and modifies 1 function of the NumberFieldElement class. For number fields, there's now a function that checks if self is a CM field, a function that returns the complex conjugation map of self (if self is contained in a CM field), and a function that finds the maximal totally real subfield of self. In the relative case, there's a function that checks if self is a CM extension. Finally, the conjugate function of NumberFieldElement is enhanced giving it the ability to compute the complex conjugate of any element in any totally real or CM field.
 
-Apply [attachment: trac_11770_CM_field_functionality_v2.3.patch](https://github.com/sagemath/sage/files/ticket11770/trac_11770_CM_field_functionality_v2.3.patch.gz) and [attachment: 11770_long_time.patch](https://github.com/sagemath/sage/files/ticket11770/11770_long_time.patch.gz) **(second patch needs review)**
+Apply [attachment: trac_11770_CM_field_functionality_v2.3.patch](https://github.com/sagemath/sage/files/ticket11770/trac_11770_CM_field_functionality_v2.3.patch.gz)
``````




---

archive/issue_comments_122707.json:
```json
{
    "body": "Apply after trac_11770_CM_field_functionality_v2.3.patch",
    "created_at": "2012-09-25T10:51:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11770#issuecomment-122707",
    "user": "https://github.com/sagetrac-fwclarke"
}
```

Apply after trac_11770_CM_field_functionality_v2.3.patch



---

archive/issue_comments_122708.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nAttachment: **[trac_11770_reviewer.patch.gz](https://github.com/sagemath/sage/files/ticket11770/trac_11770_reviewer.patch.gz)**\n\nReplying to [@jdemeyer](#comment%3A24):\n> Could you make that change, since you obviously understand what's going on in this patch.\n\nNew patch, to be applied after the main one, speeds things up considerably.",
    "created_at": "2012-09-25T10:55:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11770#issuecomment-122708",
    "user": "https://github.com/sagetrac-fwclarke"
}
```

<div id="comment:26" align="right">comment:26</div>

Attachment: **[trac_11770_reviewer.patch.gz](https://github.com/sagemath/sage/files/ticket11770/trac_11770_reviewer.patch.gz)**

Replying to [@jdemeyer](#comment%3A24):
> Could you make that change, since you obviously understand what's going on in this patch.

New patch, to be applied after the main one, speeds things up considerably.



---

archive/issue_comments_122709.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n This ticket adds 3 functions to the NumberField class, 1 function to the RelativeNumberField class, and modifies 1 function of the NumberFieldElement class. For number fields, there's now a function that checks if self is a CM field, a function that returns the complex conjugation map of self (if self is contained in a CM field), and a function that finds the maximal totally real subfield of self. In the relative case, there's a function that checks if self is a CM extension. Finally, the conjugate function of NumberFieldElement is enhanced giving it the ability to compute the complex conjugate of any element in any totally real or CM field.\n \n-Apply [attachment: trac_11770_CM_field_functionality_v2.3.patch](https://github.com/sagemath/sage/files/ticket11770/trac_11770_CM_field_functionality_v2.3.patch.gz)\n+Apply [attachment: trac_11770_CM_field_functionality_v2.3.patch](https://github.com/sagemath/sage/files/ticket11770/trac_11770_CM_field_functionality_v2.3.patch.gz) then [attachment: trac_11770_reviewer.patch](https://github.com/sagemath/sage/files/ticket11770/trac_11770_reviewer.patch.gz) \n``````\n",
    "created_at": "2012-09-25T10:55:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11770#issuecomment-122709",
    "user": "https://github.com/sagetrac-fwclarke"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 This ticket adds 3 functions to the NumberField class, 1 function to the RelativeNumberField class, and modifies 1 function of the NumberFieldElement class. For number fields, there's now a function that checks if self is a CM field, a function that returns the complex conjugation map of self (if self is contained in a CM field), and a function that finds the maximal totally real subfield of self. In the relative case, there's a function that checks if self is a CM extension. Finally, the conjugate function of NumberFieldElement is enhanced giving it the ability to compute the complex conjugate of any element in any totally real or CM field.
 
-Apply [attachment: trac_11770_CM_field_functionality_v2.3.patch](https://github.com/sagemath/sage/files/ticket11770/trac_11770_CM_field_functionality_v2.3.patch.gz)
+Apply [attachment: trac_11770_CM_field_functionality_v2.3.patch](https://github.com/sagemath/sage/files/ticket11770/trac_11770_CM_field_functionality_v2.3.patch.gz) then [attachment: trac_11770_reviewer.patch](https://github.com/sagemath/sage/files/ticket11770/trac_11770_reviewer.patch.gz) 
``````




---

archive/issue_comments_122710.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nRe-opening this but with the intention of merging it back.",
    "created_at": "2012-09-26T07:34:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11770#issuecomment-122710",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:27" align="right">comment:27</div>

Re-opening this but with the intention of merging it back.



---

archive/issue_events_156631.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-09-26T07:34:19Z",
    "event": "reopened",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11770#event-156631"
}
```



---

archive/issue_comments_122711.json:
```json
{
    "body": "Changed merged from **sage-5.4.beta0** to none",
    "created_at": "2012-09-26T07:34:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11770#issuecomment-122711",
    "user": "https://github.com/jdemeyer"
}
```

Changed merged from **sage-5.4.beta0** to none



---

archive/issue_events_156632.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-09-26T07:34:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11770#event-156632"
}
```



---

archive/issue_events_156633.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-09-26T07:34:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11770#event-156633"
}
```



---

archive/issue_events_156634.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-09-26T07:34:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11770#event-156634"
}
```



---

archive/issue_comments_122712.json:
```json
{
    "body": "Changed reviewer from **Francis Clarke** to **Francis Clarke, Jeroen Demeyer**",
    "created_at": "2012-09-26T07:34:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11770#issuecomment-122712",
    "user": "https://github.com/jdemeyer"
}
```

Changed reviewer from **Francis Clarke** to **Francis Clarke, Jeroen Demeyer**



---

archive/issue_comments_122713.json:
```json
{
    "body": "Merged: **sage-5.4.rc0**",
    "created_at": "2012-09-28T07:47:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/11770#issuecomment-122713",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.4.rc0**



---

archive/issue_events_156635.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-09-28T07:47:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11770#event-156635"
}
```



---

archive/issue_events_156636.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-09-28T07:47:09Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/11770",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/11770#event-156636"
}
```
