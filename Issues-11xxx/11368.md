# Issue 11368: can't coerce pari to rational function field

archive/issues_011196.json:
```json
{
    "body": "The following fails\n\n```\nsage: R.<x,y> = PolynomialRing(QQ)\nsage: S = R.fraction_field()\nsage: S(pari((x+y)/y))\nTypeError: no canonical coercion from Fraction Field of Multivariate Polynomial Ring in x, y over Rational Field to Rational Field\n```\nHowever, if you replace (x+y)/y with x+y, it works (in other words, polynomials work but rational functions don't).\n\nAssignee: @robertwb\n\nCC:  @katestange\n\nKeywords: coercion pari rational fraction_field string\n\nReviewer: Marco Streng\n\nAuthor: Peter Bruin\n\nBranch: u/pbruin/11368-coerce_rational_function_field\n\nCommit: a9fcc831dca865c0adf7feceb8413d7dc7b5cf8c\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/11368\n\n",
    "closed_at": "2014-01-05T02:56:49Z",
    "created_at": "2011-05-23T04:12:19Z",
    "labels": [
        "component: coercion",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.1",
    "title": "can't coerce pari to rational function field",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11368",
    "user": "https://github.com/katestange"
}
```
The following fails

```
sage: R.<x,y> = PolynomialRing(QQ)
sage: S = R.fraction_field()
sage: S(pari((x+y)/y))
TypeError: no canonical coercion from Fraction Field of Multivariate Polynomial Ring in x, y over Rational Field to Rational Field
```
However, if you replace (x+y)/y with x+y, it works (in other words, polynomials work but rational functions don't).

Assignee: @robertwb

CC:  @katestange

Keywords: coercion pari rational fraction_field string

Reviewer: Marco Streng

Author: Peter Bruin

Branch: u/pbruin/11368-coerce_rational_function_field

Commit: a9fcc831dca865c0adf7feceb8413d7dc7b5cf8c

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/11368





---

archive/issue_comments_129595.json:
```json
{
    "body": "<a id='comment:1'></a>I think it is probably related that the following fails: (with R and S as above)\n\n```\nS('(x+y)/y')\n```\nwith the same error.  Again, polynomial coercion like\n\n```\nS('x+y')\n```\nsucceeds.  (If someone finds that this is a different problem, please put in a separate ticket, but I'm guessing it's related.)",
    "created_at": "2011-05-23T04:16:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11368#issuecomment-129595",
    "user": "https://github.com/katestange"
}
```

<a id='comment:1'></a>I think it is probably related that the following fails: (with R and S as above)

```
S('(x+y)/y')
```
with the same error.  Again, polynomial coercion like

```
S('x+y')
```
succeeds.  (If someone finds that this is a different problem, please put in a separate ticket, but I'm guessing it's related.)



---

archive/issue_comments_129596.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -8,7 +8,17 @@\n ```\n However, if you replace (x+y)/y with x+y, it works (in other words, polynomials work but rational functions don't).\n \n-Keywords: coercion pari rational fraction_field\n+I think it is probably related that the following fails: (with R and S as above)\n+\n+```\n+S('(x+y)/y')\n+```\n+with the same error.  Again, polynomial coercion like\n+\n+```\n+S('x+y')\n+```\n+succeeds.  (If someone finds that this is a different problem, please put in a separate ticket, but I'm guessing it's related.)\n \n Comment: 1\n \n```\n",
    "created_at": "2011-05-23T04:16:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11368#issuecomment-129596",
    "user": "https://github.com/katestange"
}
```

Description changed:
```diff
--- 
+++ 
@@ -8,7 +8,17 @@
 ```
 However, if you replace (x+y)/y with x+y, it works (in other words, polynomials work but rational functions don't).
 
-Keywords: coercion pari rational fraction_field
+I think it is probably related that the following fails: (with R and S as above)
+
+```
+S('(x+y)/y')
+```
+with the same error.  Again, polynomial coercion like
+
+```
+S('x+y')
+```
+succeeds.  (If someone finds that this is a different problem, please put in a separate ticket, but I'm guessing it's related.)
 
 Comment: 1
 
```




---

archive/issue_comments_129597.json:
```json
{
    "body": "Changing keywords from \"coercion pari rational fraction_field\" to \"coercion pari rational fraction_field string\".",
    "created_at": "2011-05-23T04:16:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11368#issuecomment-129597",
    "user": "https://github.com/katestange"
}
```

Changing keywords from "coercion pari rational fraction_field" to "coercion pari rational fraction_field string".



---

archive/issue_events_029517.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11368",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11368#event-29517"
}
```



---

archive/issue_comments_129598.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,12 @@\n+The following fails\n+\n+```\n+sage: R.<x,y> = PolynomialRing(QQ)\n+sage: S = R.fraction_field()\n+sage: S(pari((x+y)/y))\n+TypeError: no canonical coercion from Fraction Field of Multivariate Polynomial Ring in x, y over Rational Field to Rational Field \n+```\n+However, if you replace (x+y)/y with x+y, it works (in other words, polynomials work but rational functions don't).\n \n \n Comment: 1\n```\n",
    "created_at": "2013-10-30T16:41:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11368#issuecomment-129598",
    "user": "https://github.com/pjbruin"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,12 @@
+The following fails
+
+```
+sage: R.<x,y> = PolynomialRing(QQ)
+sage: S = R.fraction_field()
+sage: S(pari((x+y)/y))
+TypeError: no canonical coercion from Fraction Field of Multivariate Polynomial Ring in x, y over Rational Field to Rational Field 
+```
+However, if you replace (x+y)/y with x+y, it works (in other words, polynomials work but rational functions don't).
 
 
 Comment: 1
```




---

archive/issue_comments_129599.json:
```json
{
    "body": "<a id='comment:3'></a>In newer Sage  versions (for example 5.13.beta0), the example `S('(x+y)/y')` works correctly, but the original example (converting from PARI) still fails.",
    "created_at": "2013-10-30T16:41:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11368#issuecomment-129599",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:3'></a>In newer Sage  versions (for example 5.13.beta0), the example `S('(x+y)/y')` works correctly, but the original example (converting from PARI) still fails.



---

archive/issue_comments_129600.json:
```json
{
    "body": "<a id='comment:4'></a>The problem seems to be this:\n\n```\nsage: R.<x,y> = PolynomialRing(QQ)\nsage: a=pari((x+y)/y); a\n1/y*x + 1\nsage: a.numerator()\n1/y*x + 1\nsage: a.denominator()\n1\n```\nNote that the following does work:\n\n```\nsage: b=pari((x+y)/x); b\n(x + y)/x\nsage: b.numerator()\nx + y\nsage: b.denominator()\nx\n```\nNote also that the PARI types are different:\n\n```\nsage: a.type()\n't_POL'\nsage: b.type()\n't_RFRAC'\n```\nThis difference arises because PARI treats multivariate polynomials as iterated univariate polynomials.  To PARI, *a* lives in **Q**(*y*)[*x*], and *b* in Frac(**Q**[*y*][*x*]).\n\nThe solution is probably to convert PARI elements of type `t_POL` coefficientwise into *S*.",
    "created_at": "2013-12-20T14:19:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11368#issuecomment-129600",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:4'></a>The problem seems to be this:

```
sage: R.<x,y> = PolynomialRing(QQ)
sage: a=pari((x+y)/y); a
1/y*x + 1
sage: a.numerator()
1/y*x + 1
sage: a.denominator()
1
```
Note that the following does work:

```
sage: b=pari((x+y)/x); b
(x + y)/x
sage: b.numerator()
x + y
sage: b.denominator()
x
```
Note also that the PARI types are different:

```
sage: a.type()
't_POL'
sage: b.type()
't_RFRAC'
```
This difference arises because PARI treats multivariate polynomials as iterated univariate polynomials.  To PARI, *a* lives in **Q**(*y*)[*x*], and *b* in Frac(**Q**[*y*][*x*]).

The solution is probably to convert PARI elements of type `t_POL` coefficientwise into *S*.



---

archive/issue_comments_129601.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-12-20T17:45:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11368#issuecomment-129601",
    "user": "https://github.com/pjbruin"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_129602.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,12 @@\n+The following fails\n \n+```\n+sage: R.<x,y> = PolynomialRing(QQ)\n+sage: S = R.fraction_field()\n+sage: S(pari((x+y)/y))\n+TypeError: no canonical coercion from Fraction Field of Multivariate Polynomial Ring in x, y over Rational Field to Rational Field\n+```\n+However, if you replace (x+y)/y with x+y, it works (in other words, polynomials work but rational functions don't).\n \n Comment: 1\n \n```\n",
    "created_at": "2013-12-20T17:45:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11368#issuecomment-129602",
    "user": "https://github.com/pjbruin"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,12 @@
+The following fails
 
+```
+sage: R.<x,y> = PolynomialRing(QQ)
+sage: S = R.fraction_field()
+sage: S(pari((x+y)/y))
+TypeError: no canonical coercion from Fraction Field of Multivariate Polynomial Ring in x, y over Rational Field to Rational Field
+```
+However, if you replace (x+y)/y with x+y, it works (in other words, polynomials work but rational functions don't).
 
 Comment: 1
 
```




---

archive/issue_comments_129603.json:
```json
{
    "body": "<a id='comment:6'></a>I'll review this as my first git review.\n\n---\nNew commits:",
    "created_at": "2013-12-23T14:19:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11368#issuecomment-129603",
    "user": "https://github.com/mstreng"
}
```

<a id='comment:6'></a>I'll review this as my first git review.

---
New commits:



---

archive/issue_comments_129604.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-12-24T21:10:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11368#issuecomment-129604",
    "user": "https://github.com/mstreng"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_129605.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-01-05T02:56:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11368#issuecomment-129605",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_029518.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-01-05T02:56:49Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11368",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11368#event-29518"
}
```
