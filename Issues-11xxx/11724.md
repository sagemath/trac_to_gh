# Issue 11724: MPIR 2.x may fail to build on 32-bit operating systems

archive/issues_011724.json:
```json
{
    "body": "Assignee: @nexttime\n\nCC:  @nathanncohen @dandrake @strogdon @jdemeyer\n\nKeywords: ABI 64-bit CPU processor Linux -m32 MPN_PATH assembler error bad register lshift\n\nMPIR fails to build on **32-bit** operating systems running on **64-bit** processors if `CFLAGS` contain `-m32` and `ABI` is **not** set.\n\nThe simple solution is to set `ABI=32` in this case, which the new spkg now does (on Linux, where the issue occurred). It also sets `ABI=64` if the operating system supports it, and `ABI` isn't already set, and prints according messages.\n\n---\nUpstream report: [http://groups.google.com/group/mpir-devel/browse_thread/thread/46ccdc5dfc3485cd](http://groups.google.com/group/mpir-devel/browse_thread/thread/46ccdc5dfc3485cd)\n\n---\n**New spkg:** [http://boxen.math.washington.edu/home/jdemeyer/spkg/mpir-2.1.3.p6.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/mpir-2.1.3.p6.spkg)\n\nIssue created by migration from https://trac.sagemath.org/ticket/11896\n\n",
    "closed_at": "2011-10-14T09:40:56Z",
    "created_at": "2011-10-05T02:29:01Z",
    "labels": [
        "component: packages: standard",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.8",
    "title": "MPIR 2.x may fail to build on 32-bit operating systems",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11724",
    "user": "Nathann Cohen, Dan Drake, Steven Trogdon"
}
```
Assignee: @nexttime

CC:  @nathanncohen @dandrake @strogdon @jdemeyer

Keywords: ABI 64-bit CPU processor Linux -m32 MPN_PATH assembler error bad register lshift

MPIR fails to build on **32-bit** operating systems running on **64-bit** processors if `CFLAGS` contain `-m32` and `ABI` is **not** set.

The simple solution is to set `ABI=32` in this case, which the new spkg now does (on Linux, where the issue occurred). It also sets `ABI=64` if the operating system supports it, and `ABI` isn't already set, and prints according messages.

---
Upstream report: [http://groups.google.com/group/mpir-devel/browse_thread/thread/46ccdc5dfc3485cd](http://groups.google.com/group/mpir-devel/browse_thread/thread/46ccdc5dfc3485cd)

---
**New spkg:** [http://boxen.math.washington.edu/home/jdemeyer/spkg/mpir-2.1.3.p6.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/mpir-2.1.3.p6.spkg)

Issue created by migration from https://trac.sagemath.org/ticket/11896





---

archive/issue_comments_132744.json:
```json
{
    "body": "Would be nice if one of you could review this.\n\nFor testing, it should be sufficient to (try to) install the spkg with an arbitrary Sage version (of course installed on some 32-bit Linux running on a 64-bit processor):\n\n```sh\n$ unset ABI # We want to test that the spkg works *without* setting it.\n$ env SAGE_CHECK=yes ./sage -i http://sage.math.washington.edu/home/leif/Sage/spkgs/mpir-2.1.3.p5.spkg\n```\n\nAfter that, you should reinstall the original MPIR spkg from your Sage installation (with `./sage -f spkg/standard/mpir-<version>.spkg`) in case you used a Sage version prior to Sage 4.7.2.alpha3 (into which the MPIR 2.1.3.p4 spkg from #8664, the first 2.x version in Sage, was merged).\n\n(No need to uninstall it from Sage 4.7.2.alpha3 or if you happen to have already installed the MPIR 2.1.3.p4 spkg, the GMP-ECM 6.3.p2 spkg and the necessary patches from their tickets.)\n\nYou can of course in addition test the spkg on other (64-bit) platforms as well... :-)\n\nThanks!",
    "created_at": "2011-10-05T03:12:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11724#issuecomment-132744",
    "user": "https://github.com/nexttime"
}
```

Would be nice if one of you could review this.

For testing, it should be sufficient to (try to) install the spkg with an arbitrary Sage version (of course installed on some 32-bit Linux running on a 64-bit processor):

```sh
$ unset ABI # We want to test that the spkg works *without* setting it.
$ env SAGE_CHECK=yes ./sage -i http://sage.math.washington.edu/home/leif/Sage/spkgs/mpir-2.1.3.p5.spkg
```

After that, you should reinstall the original MPIR spkg from your Sage installation (with `./sage -f spkg/standard/mpir-<version>.spkg`) in case you used a Sage version prior to Sage 4.7.2.alpha3 (into which the MPIR 2.1.3.p4 spkg from #8664, the first 2.x version in Sage, was merged).

(No need to uninstall it from Sage 4.7.2.alpha3 or if you happen to have already installed the MPIR 2.1.3.p4 spkg, the GMP-ECM 6.3.p2 spkg and the necessary patches from their tickets.)

You can of course in addition test the spkg on other (64-bit) platforms as well... :-)

Thanks!



---

archive/issue_comments_132745.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-10-05T03:12:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11724#issuecomment-132745",
    "user": "https://github.com/nexttime"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_132746.json:
```json
{
    "body": "Attachment [mpir-2.1.3.p4-p5.diff](tarball://root/attachments/some-uuid/ticket11896/mpir-2.1.3.p4-p5.diff) by @nexttime created at 2011-10-05 03:18:45\n\nDiff between the p4 (from #8664) and the p5 spkg. For reference / review only.",
    "created_at": "2011-10-05T03:18:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11724#issuecomment-132746",
    "user": "https://github.com/nexttime"
}
```

Attachment [mpir-2.1.3.p4-p5.diff](tarball://root/attachments/some-uuid/ticket11896/mpir-2.1.3.p4-p5.diff) by @nexttime created at 2011-10-05 03:18:45

Diff between the p4 (from #8664) and the p5 spkg. For reference / review only.



---

archive/issue_comments_132747.json:
```json
{
    "body": "P.S.:\n\nI'll rebase the spkgs with newer upstream versions (see #11616) on this one when I find the time. I'll perhaps also provide an MPIR 2.1.**4**.p0 spkg based on this one which just adds a minor upstream fix (for a rare race condition which leads to an error during the installation).",
    "created_at": "2011-10-05T03:32:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11724#issuecomment-132747",
    "user": "https://github.com/nexttime"
}
```

P.S.:

I'll rebase the spkgs with newer upstream versions (see #11616) on this one when I find the time. I'll perhaps also provide an MPIR 2.1.**4**.p0 spkg based on this one which just adds a minor upstream fix (for a rare race condition which leads to an error during the installation).



---

archive/issue_comments_132748.json:
```json
{
    "body": "Oh, one more thing:\n\nI cannot test whether the GMP-ECM and MPFR spkgs have the same problem (since they use GMP's / MPIR's `CFLAGS`), i.e., also fail on such systems if `ABI` isn't set.\n\nIf you find the time, you could also check this by unsetting `ABI` and reinstalling them (with `./sage -f ...`).",
    "created_at": "2011-10-05T03:51:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11724#issuecomment-132748",
    "user": "https://github.com/nexttime"
}
```

Oh, one more thing:

I cannot test whether the GMP-ECM and MPFR spkgs have the same problem (since they use GMP's / MPIR's `CFLAGS`), i.e., also fail on such systems if `ABI` isn't set.

If you find the time, you could also check this by unsetting `ABI` and reinstalling them (with `./sage -f ...`).



---

archive/issue_comments_132749.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-10-05T04:53:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11724#issuecomment-132749",
    "user": "https://github.com/strogdon"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_132750.json:
```json
{
    "body": "Replying to [comment:3 leif]:\n\n> Oh, one more thing: I cannot test whether the GMP-ECM and MPFR spkgs have the same problem (since they use GMP's / MPIR's `CFLAGS`), i.e., also fail on such systems if `ABI` isn't set. If you find the time, you could also check this by unsetting `ABI` and reinstalling them (with `./sage -f ...`).\n\n\nThe new mpir spkg installs here on my 32-bit OS with 64-bit processor with ABI unset.\n\n```\nThe MPIR test suite passed successfully.\nNow cleaning up tmp files.\nMaking Sage/Python scripts relocatable...\nMaking script relocatable\nFinished installing mpir-2.1.3.p5.spkg\n```\nIt also installed on an amd64 to which I have access. The ECM and MPFR spkgs reinstalled correctly with ABI unset on both the 32-bit and amd64 machines. A positive review here.",
    "created_at": "2011-10-05T04:53:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11724#issuecomment-132750",
    "user": "https://github.com/strogdon"
}
```

Replying to [comment:3 leif]:

> Oh, one more thing: I cannot test whether the GMP-ECM and MPFR spkgs have the same problem (since they use GMP's / MPIR's `CFLAGS`), i.e., also fail on such systems if `ABI` isn't set. If you find the time, you could also check this by unsetting `ABI` and reinstalling them (with `./sage -f ...`).


The new mpir spkg installs here on my 32-bit OS with 64-bit processor with ABI unset.

```
The MPIR test suite passed successfully.
Now cleaning up tmp files.
Making Sage/Python scripts relocatable...
Making script relocatable
Finished installing mpir-2.1.3.p5.spkg
```
It also installed on an amd64 to which I have access. The ECM and MPFR spkgs reinstalled correctly with ABI unset on both the 32-bit and amd64 machines. A positive review here.



---

archive/issue_comments_132751.json:
```json
{
    "body": "Replying to [comment:5 strogdon]:\n> The new mpir spkg installs here on my 32-bit OS with 64-bit processor with ABI unset.\n> It also installed on an amd64 to which I have access. The ECM and MPFR spkgs reinstalled correctly with ABI unset on both the 32-bit and amd64 machines. A positive review here.\n\n\nSpeed reviewing, thanks!",
    "created_at": "2011-10-05T05:13:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11724#issuecomment-132751",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:5 strogdon]:
> The new mpir spkg installs here on my 32-bit OS with 64-bit processor with ABI unset.
> It also installed on an amd64 to which I have access. The ECM and MPFR spkgs reinstalled correctly with ABI unset on both the 32-bit and amd64 machines. A positive review here.


Speed reviewing, thanks!



---

archive/issue_comments_132752.json:
```json
{
    "body": "( it compiled perfectly here ! Thank you very much leif ! `:-D`)",
    "created_at": "2011-10-05T10:39:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11724#issuecomment-132752",
    "user": "https://github.com/nathanncohen"
}
```

( it compiled perfectly here ! Thank you very much leif ! `:-D`)



---

archive/issue_events_031454.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-05T12:18:55Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11724",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11724#event-31454"
}
```



---

archive/issue_comments_132753.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-10-05T12:18:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11724#issuecomment-132753",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_132754.json:
```json
{
    "body": "This **fails** to build on Itanium:\n\n```\nmpir-2.1.3.p5\nMachine:\nLinux iras 2.6.16.46-0.12-default #1 SMP Thu May 17 14:00:09 UTC 2007 ia64 ia64 ia64 GNU/Linux\nDeleting directories from past builds of previous/current versions of mpir-2.1.3.p5\nExtracting package /home/buildbot/build/sage/iras-1/iras_full/build/sage-4.7.2.alpha4/spkg/standard/mpir-2.1.3.p5.spkg ...\n-rw-r--r-- 1 buildbot sage 3759395 2011-10-04 22:36 /home/buildbot/build/sage/iras-1/iras_full/build/sage-4.7.2.alpha4/spkg/standard/mpir-2.1.3.p5.spkg\nFinished extraction\n****************************************************\nHost system\nuname -a:\nLinux iras 2.6.16.46-0.12-default #1 SMP Thu May 17 14:00:09 UTC 2007 ia64 ia64 ia64 GNU/Linux\n****************************************************\n****************************************************\nCC Version\ngcc -v\nUsing built-in specs.\nCOLLECT_GCC=gcc\nCOLLECT_LTO_WRAPPER=/usr/local/gcc-4.6.1/ia64-Linux-suse/libexec/gcc/ia64-unknown-linux-gnu/4.6.1/lto-wrapper\nTarget: ia64-unknown-linux-gnu\nConfigured with: /usr/local/gcc-4.6.1/src/gcc-4.6.1/configure --enable-languages=c,c++,fortran --with-gnu-as --with-as=/usr/local/binutils-2.21/ia64-Linux-suse-gcc-4.5.1/bin/as --with-gnu-ld --with-ld=/usr/local/binutils-2.21/ia64-Linux-suse-gcc-4.5.1/bin/ld --with-gmp=/usr/local/mpir-2.4.0/ia64-Linux-suse-gcc-4.6.0 --with-mpfr=/usr/local/mpfr-3.0.1/ia64-Linux-suse-mpir-2.4.0-gcc-4.6.0 --with-mpc=/usr/local/mpc-0.9/ia64-Linux-suse-mpir-2.4.0-mpfr-3.0.1-gcc-4.6.0 --prefix=/usr/local/gcc-4.6.1/ia64-Linux-suse\nThread model: posix\ngcc version 4.6.1 (GCC) \n****************************************************\nWarning: Building MPIR with SAGE_DEBUG=yes disables optimization.\nBuilding a 32-bit version of MPIR\nChecking what CFLAGS MPIR would use if they were empty...\nSettings required to properly build MPIR, taking into account SAGE_DEBUG etc.:\n  CFLAGS:   -g -O0\n  LDFLAGS:  -Wl,-z,noexecstack\n  ABI:     32\nSettings from the \"global\" environment:\n  CC:      gcc\n  CFLAGS:  \n  (CPPFLAGS, CXX and CXXFLAGS are listed below; these don't get modified.)\nUsing the spkg's (i.e. Sage's) default (plus mandatory) settings.\nFinally using the following settings:\n  CC=gcc\n  CFLAGS=   -g -O0\n  CPPFLAGS=\n  CXX=g++\n  CXXFLAGS=\n  LDFLAGS= -Wl,-z,noexecstack\n  ABI=32\n(These settings may still get overridden by 'configure' or Makefiles.)\nConfiguring MPIR with the following options:\n    --prefix=\"/home/buildbot/build/sage/iras-1/iras_full/build/sage-4.7.2.alpha4/local\" --enable-shared --enable-static --enable-gmpcompat --enable-cxx=yes \nYou can set MPIR_EXTRA_OPTS to pass additional parameters.\nchecking build system type... ia64-unknown-linux-gnu\nchecking host system type... ia64-unknown-linux-gnu\nchecking for a BSD-compatible install... /usr/bin/install -c\nchecking whether build environment is sane... yes\nchecking for a thread-safe mkdir -p... /bin/mkdir -p\nchecking for gawk... gawk\nchecking whether make -j4 sets $(MAKE)... yes\nchecking whether to enable maintainer-specific portions of Makefiles... no\nconfigure: error: ABI=32 is not among the following valid choices: 64\nError configuring MPIR. (See above for the options passed to it.)\n```",
    "created_at": "2011-10-10T07:37:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11724#issuecomment-132754",
    "user": "https://github.com/jdemeyer"
}
```

This **fails** to build on Itanium:

```
mpir-2.1.3.p5
Machine:
Linux iras 2.6.16.46-0.12-default #1 SMP Thu May 17 14:00:09 UTC 2007 ia64 ia64 ia64 GNU/Linux
Deleting directories from past builds of previous/current versions of mpir-2.1.3.p5
Extracting package /home/buildbot/build/sage/iras-1/iras_full/build/sage-4.7.2.alpha4/spkg/standard/mpir-2.1.3.p5.spkg ...
-rw-r--r-- 1 buildbot sage 3759395 2011-10-04 22:36 /home/buildbot/build/sage/iras-1/iras_full/build/sage-4.7.2.alpha4/spkg/standard/mpir-2.1.3.p5.spkg
Finished extraction
****************************************************
Host system
uname -a:
Linux iras 2.6.16.46-0.12-default #1 SMP Thu May 17 14:00:09 UTC 2007 ia64 ia64 ia64 GNU/Linux
****************************************************
****************************************************
CC Version
gcc -v
Using built-in specs.
COLLECT_GCC=gcc
COLLECT_LTO_WRAPPER=/usr/local/gcc-4.6.1/ia64-Linux-suse/libexec/gcc/ia64-unknown-linux-gnu/4.6.1/lto-wrapper
Target: ia64-unknown-linux-gnu
Configured with: /usr/local/gcc-4.6.1/src/gcc-4.6.1/configure --enable-languages=c,c++,fortran --with-gnu-as --with-as=/usr/local/binutils-2.21/ia64-Linux-suse-gcc-4.5.1/bin/as --with-gnu-ld --with-ld=/usr/local/binutils-2.21/ia64-Linux-suse-gcc-4.5.1/bin/ld --with-gmp=/usr/local/mpir-2.4.0/ia64-Linux-suse-gcc-4.6.0 --with-mpfr=/usr/local/mpfr-3.0.1/ia64-Linux-suse-mpir-2.4.0-gcc-4.6.0 --with-mpc=/usr/local/mpc-0.9/ia64-Linux-suse-mpir-2.4.0-mpfr-3.0.1-gcc-4.6.0 --prefix=/usr/local/gcc-4.6.1/ia64-Linux-suse
Thread model: posix
gcc version 4.6.1 (GCC) 
****************************************************
Warning: Building MPIR with SAGE_DEBUG=yes disables optimization.
Building a 32-bit version of MPIR
Checking what CFLAGS MPIR would use if they were empty...
Settings required to properly build MPIR, taking into account SAGE_DEBUG etc.:
  CFLAGS:   -g -O0
  LDFLAGS:  -Wl,-z,noexecstack
  ABI:     32
Settings from the "global" environment:
  CC:      gcc
  CFLAGS:  
  (CPPFLAGS, CXX and CXXFLAGS are listed below; these don't get modified.)
Using the spkg's (i.e. Sage's) default (plus mandatory) settings.
Finally using the following settings:
  CC=gcc
  CFLAGS=   -g -O0
  CPPFLAGS=
  CXX=g++
  CXXFLAGS=
  LDFLAGS= -Wl,-z,noexecstack
  ABI=32
(These settings may still get overridden by 'configure' or Makefiles.)
Configuring MPIR with the following options:
    --prefix="/home/buildbot/build/sage/iras-1/iras_full/build/sage-4.7.2.alpha4/local" --enable-shared --enable-static --enable-gmpcompat --enable-cxx=yes 
You can set MPIR_EXTRA_OPTS to pass additional parameters.
checking build system type... ia64-unknown-linux-gnu
checking host system type... ia64-unknown-linux-gnu
checking for a BSD-compatible install... /usr/bin/install -c
checking whether build environment is sane... yes
checking for a thread-safe mkdir -p... /bin/mkdir -p
checking for gawk... gawk
checking whether make -j4 sets $(MAKE)... yes
checking whether to enable maintainer-specific portions of Makefiles... no
configure: error: ABI=32 is not among the following valid choices: 64
Error configuring MPIR. (See above for the options passed to it.)
```



---

archive/issue_comments_132755.json:
```json
{
    "body": "The problem is that the `-m32`/`-m64` switches are not supported on every system.  So we should do the following:\n\n1. Try building and running with `-m64`.\n2. Try building and running with `-m32`.\n3. If *both* fail, fall back to the old behaviour (which was what?)",
    "created_at": "2011-10-10T08:13:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11724#issuecomment-132755",
    "user": "https://github.com/jdemeyer"
}
```

The problem is that the `-m32`/`-m64` switches are not supported on every system.  So we should do the following:

1. Try building and running with `-m64`.
2. Try building and running with `-m32`.
3. If *both* fail, fall back to the old behaviour (which was what?)



---

archive/issue_comments_132756.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2011-10-10T08:13:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11724#issuecomment-132756",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from closed to new.



---

archive/issue_events_031455.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-10T08:13:32Z",
    "event": "reopened",
    "issue": "https://github.com/sagemath/sagetest/issues/11724",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11724#event-31455"
}
```



---

archive/issue_comments_132757.json:
```json
{
    "body": "Resolution changed from fixed to ",
    "created_at": "2011-10-10T08:13:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11724#issuecomment-132757",
    "user": "https://github.com/jdemeyer"
}
```

Resolution changed from fixed to 



---

archive/issue_comments_132758.json:
```json
{
    "body": "The attached patch should fix the problem.  New spkg for testing: [http://boxen.math.washington.edu/home/jdemeyer/spkg/mpir-2.1.3.p6.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/mpir-2.1.3.p6.spkg)",
    "created_at": "2011-10-10T08:33:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11724#issuecomment-132758",
    "user": "https://github.com/jdemeyer"
}
```

The attached patch should fix the problem.  New spkg for testing: [http://boxen.math.washington.edu/home/jdemeyer/spkg/mpir-2.1.3.p6.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/mpir-2.1.3.p6.spkg)



---

archive/issue_comments_132759.json:
```json
{
    "body": "A much simpler solution is to set `CFLAG64=\"\"` on `ia64` (Itanium), then the first attempt (building and running a 64-bit executable) will succeed.",
    "created_at": "2011-10-10T12:46:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11724#issuecomment-132759",
    "user": "https://github.com/nexttime"
}
```

A much simpler solution is to set `CFLAG64=""` on `ia64` (Itanium), then the first attempt (building and running a 64-bit executable) will succeed.



---

archive/issue_comments_132760.json:
```json
{
    "body": "By the way, I'd say that's a GCC flaw; it should support `-m64` on Itanium as well since there it's just a redundant flag, as opposed to a conflicting or unsupported one.",
    "created_at": "2011-10-10T13:00:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11724#issuecomment-132760",
    "user": "https://github.com/nexttime"
}
```

By the way, I'd say that's a GCC flaw; it should support `-m64` on Itanium as well since there it's just a redundant flag, as opposed to a conflicting or unsupported one.



---

archive/issue_comments_132761.json:
```json
{
    "body": "Oh, it does have related options for HP-UX: :-)\n\n```\n       -milp32\n       -mlp64\n           Generate code for a 32-bit or 64-bit environment.  The 32-bit environment sets int,\n           long and pointer to 32 bits.  The 64-bit environment sets int to 32 bits and long and\n           pointer to 64 bits.  These are HP-UX specific flags.\n```",
    "created_at": "2011-10-10T13:08:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11724#issuecomment-132761",
    "user": "https://github.com/nexttime"
}
```

Oh, it does have related options for HP-UX: :-)

```
       -milp32
       -mlp64
           Generate code for a 32-bit or 64-bit environment.  The 32-bit environment sets int,
           long and pointer to 32 bits.  The 64-bit environment sets int to 32 bits and long and
           pointer to 64 bits.  These are HP-UX specific flags.
```



---

archive/issue_comments_132762.json:
```json
{
    "body": "Replying to [comment:14 leif]:\n> A much simpler solution is to set `CFLAG64=\"\"` on `ia64` (Itanium), then the first attempt (building and running a 64-bit executable) will succeed.\n\n\nMy patch doesn't do specific checking for Itanium, it will work on *any* compiler which does not support `-m32` and `-m64`.",
    "created_at": "2011-10-10T13:33:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11724#issuecomment-132762",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:14 leif]:
> A much simpler solution is to set `CFLAG64=""` on `ia64` (Itanium), then the first attempt (building and running a 64-bit executable) will succeed.


My patch doesn't do specific checking for Itanium, it will work on *any* compiler which does not support `-m32` and `-m64`.



---

archive/issue_comments_132763.json:
```json
{
    "body": "Replying to [comment:17 jdemeyer]:\n> Replying to [comment:14 leif]:\n> > A much simpler solution is to set `CFLAG64=\"\"` on `ia64` (Itanium), then the first attempt (building and running a 64-bit executable) will succeed.\n\n> \n> My patch doesn't do specific checking for Itanium, it will work on *any* compiler which does not support `-m32` and `-m64`.\n\n\nI'd factor out `-m32` though, i.e., use `$CFLAG32` in the second attempt and add\n\n```sh\nif [[ -z $CFLAG32 ]]; then\n    CFLAG32=-m32\nfi\n```\nor\n\n```sh\n: ${CFLAG32=-m32} # doesn't invalidate an empty setting (\"\")\n```\nor the like (at the top level), such that porting people can adapt it to whatever they need.",
    "created_at": "2011-10-10T13:42:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11724#issuecomment-132763",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:17 jdemeyer]:
> Replying to [comment:14 leif]:
> > A much simpler solution is to set `CFLAG64=""` on `ia64` (Itanium), then the first attempt (building and running a 64-bit executable) will succeed.

> 
> My patch doesn't do specific checking for Itanium, it will work on *any* compiler which does not support `-m32` and `-m64`.


I'd factor out `-m32` though, i.e., use `$CFLAG32` in the second attempt and add

```sh
if [[ -z $CFLAG32 ]]; then
    CFLAG32=-m32
fi
```
or

```sh
: ${CFLAG32=-m32} # doesn't invalidate an empty setting ("")
```
or the like (at the top level), such that porting people can adapt it to whatever they need.



---

archive/issue_comments_132764.json:
```json
{
    "body": "Alternatively, you could just set `ABI=64` (without any checks) on Itanium, which is reasonable as it doesn't (or at least we don't) support anything else on that.",
    "created_at": "2011-10-10T13:45:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11724#issuecomment-132764",
    "user": "https://github.com/nexttime"
}
```

Alternatively, you could just set `ABI=64` (without any checks) on Itanium, which is reasonable as it doesn't (or at least we don't) support anything else on that.



---

archive/issue_comments_132765.json:
```json
{
    "body": "(I originally intended to restrict the test / setting the ABI to x86 / x86_64 and ppc / ppc64 anyway... ;-) )",
    "created_at": "2011-10-10T13:47:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11724#issuecomment-132765",
    "user": "https://github.com/nexttime"
}
```

(I originally intended to restrict the test / setting the ABI to x86 / x86_64 and ppc / ppc64 anyway... ;-) )



---

archive/issue_comments_132766.json:
```json
{
    "body": "Changing priority from blocker to critical.",
    "created_at": "2011-10-11T07:36:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11724#issuecomment-132766",
    "user": "https://github.com/jdemeyer"
}
```

Changing priority from blocker to critical.



---

archive/issue_comments_132767.json:
```json
{
    "body": "New spkg which uses `$CFLAG32`, same location. Needs review.",
    "created_at": "2011-10-11T15:41:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11724#issuecomment-132767",
    "user": "https://github.com/jdemeyer"
}
```

New spkg which uses `$CFLAG32`, same location. Needs review.



---

archive/issue_comments_132768.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-10-11T15:41:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11724#issuecomment-132768",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_132769.json:
```json
{
    "body": "Replying to [comment:22 jdemeyer]:\n> New spkg which uses `$CFLAG32`, same location. Needs review.\n\n\n**Positive review**, although the comment\n\n```\n            # (Usually succeeds, unless e.g. a 32-bit CPU is explicitly selected by CFLAGS.)\n```\nreferred to *building*, not *running* a 64-bit executable, and the Changelog entry mentions `-m32` and `-m64` rather than `CFLAG32` and `CFLAG64`.\n\n\nTested with `SAGE_CHECK=yes` on Linux x86, x86_64 and ia64, with and without `{C,CPP,CXX}FLAGS` and `ABI` set.",
    "created_at": "2011-10-11T16:30:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11724#issuecomment-132769",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:22 jdemeyer]:
> New spkg which uses `$CFLAG32`, same location. Needs review.


**Positive review**, although the comment

```
            # (Usually succeeds, unless e.g. a 32-bit CPU is explicitly selected by CFLAGS.)
```
referred to *building*, not *running* a 64-bit executable, and the Changelog entry mentions `-m32` and `-m64` rather than `CFLAG32` and `CFLAG64`.


Tested with `SAGE_CHECK=yes` on Linux x86, x86_64 and ia64, with and without `{C,CPP,CXX}FLAGS` and `ABI` set.



---

archive/issue_comments_132770.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-10-11T16:30:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11724#issuecomment-132770",
    "user": "https://github.com/nexttime"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_132771.json:
```json
{
    "body": "Attachment [mpir-2.1.3.p5-p6.diff](tarball://root/attachments/some-uuid/ticket11896/mpir-2.1.3.p5-p6.diff) by @jdemeyer created at 2011-10-11 19:20:20\n\nReplying to [comment:23 leif]:\n> Replying to [comment:22 jdemeyer]:\n> > New spkg which uses `$CFLAG32`, same location. Needs review.\n\n> \n> **Positive review**, although the comment\n> \n> ```\n>             # (Usually succeeds, unless e.g. a 32-bit CPU is explicitly selected by CFLAGS.)\n> ```\n> referred to *building*, not *running* a 64-bit executable\n\nI think it is actually **more** correct to refer to *building and running* rather than just *building*.\n\n> the Changelog entry mentions `-m32` and `-m64` rather than `CFLAG32` and `CFLAG64`.\n\nFixed this.",
    "created_at": "2011-10-11T19:20:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11724#issuecomment-132771",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [mpir-2.1.3.p5-p6.diff](tarball://root/attachments/some-uuid/ticket11896/mpir-2.1.3.p5-p6.diff) by @jdemeyer created at 2011-10-11 19:20:20

Replying to [comment:23 leif]:
> Replying to [comment:22 jdemeyer]:
> > New spkg which uses `$CFLAG32`, same location. Needs review.

> 
> **Positive review**, although the comment
> 
> ```
>             # (Usually succeeds, unless e.g. a 32-bit CPU is explicitly selected by CFLAGS.)
> ```
> referred to *building*, not *running* a 64-bit executable

I think it is actually **more** correct to refer to *building and running* rather than just *building*.

> the Changelog entry mentions `-m32` and `-m64` rather than `CFLAG32` and `CFLAG64`.

Fixed this.



---

archive/issue_events_031456.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-10-14T09:40:56Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11724",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11724#event-31456"
}
```



---

archive/issue_comments_132772.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-10-14T09:40:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11724#issuecomment-132772",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_132773.json:
```json
{
    "body": "For what it's worth, this fails to build on the skynet machine silius. I get the same error message with p5 and p6:\n\n```\nBuilding a 64-bit version of MPIR\nChecking what CFLAGS MPIR would use if they were empty...\nSettings required to properly build MPIR, taking into account SAGE_DEBUG etc.:\n  CFLAGS:\n  LDFLAGS:  -Wl,-z,noexecstack\n  ABI:     64\nSettings from the \"global\" environment:\n  CC:      gcc\n  CFLAGS:\n  (CPPFLAGS, CXX and CXXFLAGS are listed below; these don't get modified.)\nUsing the spkg's (i.e. Sage's) default (plus mandatory) settings.\nFinally using the following settings:\n  CC=gcc\n  CFLAGS=  -g -O3\n  CPPFLAGS=\n  CXX=g++\n  CXXFLAGS=\n  LDFLAGS= -Wl,-z,noexecstack\n  ABI=64\n(These settings may still get overridden by 'configure' or Makefiles.)\nConfiguring MPIR with the following options:\n    --prefix=\"/home/palmieri/silius/sage-4.7.2.alpha4/local\" --enable-shared --enable-static --ena\\\nble-gmpcompat --enable-cxx=yes\nYou can set MPIR_EXTRA_OPTS to pass additional parameters.\nchecking build system type... power7-unknown-linux-gnu\nchecking host system type... power7-unknown-linux-gnu\nchecking for a BSD-compatible install... /usr/bin/install -c\nchecking whether build environment is sane... yes\nchecking for a thread-safe mkdir -p... /bin/mkdir -p\nchecking for gawk... gawk\nchecking whether make -j12 sets $(MAKE)... yes\nchecking whether to enable maintainer-specific portions of Makefiles... no\nconfigure: error: ABI=64 is not among the following valid choices: mode64 mode32 32\nError configuring MPIR. (See above for the options passed to it.)\n```",
    "created_at": "2011-10-29T18:16:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11724#issuecomment-132773",
    "user": "https://github.com/jhpalmieri"
}
```

For what it's worth, this fails to build on the skynet machine silius. I get the same error message with p5 and p6:

```
Building a 64-bit version of MPIR
Checking what CFLAGS MPIR would use if they were empty...
Settings required to properly build MPIR, taking into account SAGE_DEBUG etc.:
  CFLAGS:
  LDFLAGS:  -Wl,-z,noexecstack
  ABI:     64
Settings from the "global" environment:
  CC:      gcc
  CFLAGS:
  (CPPFLAGS, CXX and CXXFLAGS are listed below; these don't get modified.)
Using the spkg's (i.e. Sage's) default (plus mandatory) settings.
Finally using the following settings:
  CC=gcc
  CFLAGS=  -g -O3
  CPPFLAGS=
  CXX=g++
  CXXFLAGS=
  LDFLAGS= -Wl,-z,noexecstack
  ABI=64
(These settings may still get overridden by 'configure' or Makefiles.)
Configuring MPIR with the following options:
    --prefix="/home/palmieri/silius/sage-4.7.2.alpha4/local" --enable-shared --enable-static --ena\
ble-gmpcompat --enable-cxx=yes
You can set MPIR_EXTRA_OPTS to pass additional parameters.
checking build system type... power7-unknown-linux-gnu
checking host system type... power7-unknown-linux-gnu
checking for a BSD-compatible install... /usr/bin/install -c
checking whether build environment is sane... yes
checking for a thread-safe mkdir -p... /bin/mkdir -p
checking for gawk... gawk
checking whether make -j12 sets $(MAKE)... yes
checking whether to enable maintainer-specific portions of Makefiles... no
configure: error: ABI=64 is not among the following valid choices: mode64 mode32 32
Error configuring MPIR. (See above for the options passed to it.)
```



---

archive/issue_comments_132774.json:
```json
{
    "body": "Replying to [comment:26 jhpalmieri]:\n> For what it's worth, this fails to build on the skynet machine silius. I get the same error message with p5 and p6.\n\n\nOoops, I was pretty sure I also tested it there.  The p4 builds just fine.\n\nI'll prepare a follow-up spkg...",
    "created_at": "2011-10-29T20:24:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11724#issuecomment-132774",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:26 jhpalmieri]:
> For what it's worth, this fails to build on the skynet machine silius. I get the same error message with p5 and p6.


Ooops, I was pretty sure I also tested it there.  The p4 builds just fine.

I'll prepare a follow-up spkg...



---

archive/issue_comments_132775.json:
```json
{
    "body": "Replying to [comment:27 leif]:\n> Replying to [comment:26 jhpalmieri]:\n> > For what it's worth, this fails to build on the skynet machine silius. I get the same error message with p5 and p6.\n\n> \n> Ooops, I was pretty sure I also tested it there.  The p4 builds just fine.\n> \n> I'll prepare a follow-up spkg...\n\n\nNew spkg (p7) up on #11964, needs review.",
    "created_at": "2011-10-31T00:41:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11724#issuecomment-132775",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:27 leif]:
> Replying to [comment:26 jhpalmieri]:
> > For what it's worth, this fails to build on the skynet machine silius. I get the same error message with p5 and p6.

> 
> Ooops, I was pretty sure I also tested it there.  The p4 builds just fine.
> 
> I'll prepare a follow-up spkg...


New spkg (p7) up on #11964, needs review.



---

archive/issue_comments_132776.json:
```json
{
    "body": "Milestone sage-4.7.3 deleted",
    "created_at": "2011-11-03T16:14:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11724#issuecomment-132776",
    "user": "https://github.com/jdemeyer"
}
```

Milestone sage-4.7.3 deleted



---

archive/issue_events_031457.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-11-03T16:18:41Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11724",
    "milestone": "sage-4.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11724#event-31457"
}
```
