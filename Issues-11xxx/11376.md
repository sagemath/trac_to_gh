# Issue 11376: Remove the hardcoding of python version in setup.py and SConstruct to build sage_clib and sage itself

archive/issues_011204.json:
```json
{
    "body": "Currently to build sage (the spkg) four files are involved in major way:\n1. SConstuct to build sage-clib\n2. setup.py\n3. module_list.py\n4. sage/misc/cython.py\n\nThe last three to build the sage python extensions. setup.py, and SConstruct both have the version of python used hardcoded in them, module_list.py doesn't refer to the python version anywhere. cython.py mention the python version explicitly in doctest but smartly find the version used for building all by itself. \n\nIn this ticket I bring this smartness to SConstruct and setup.py. The advantage of doing this is that sage then can be build with either python-2.6 or 2.7 (and 3.x in the future) without patching. Of course it may still require patches to fix doctest and syntax in some parts - but you would be able to build sage in the first place without having to patch the build system. It has been found to be an impediment to testing in #9958.\n\nDepend: #11373\n\nApply:\n* [attachment:trac_11376-SConstruct.patch]\n* [attachment:trac_11376-setuppy.patch]\n* [attachment:trac_11376-msic_cythonpy-p2.patch]\n* [attachment:trac_11376-fix_cythonpy_doctest.patch]\n\nAssignee: GeorgSWeber\n\nCC:  @strogdon @nexttime\n\nResolution: fixed\n\nDependencies: #11373\n\nAuthor: Fran\u00e7ois Bissey\n\nReviewer: Mariah Lenox\n\nMerged: sage-4.7.2.alpha0\n\nIssue created by migration from https://trac.sagemath.org/ticket/11376\n\n",
    "closed_at": "2011-07-24T11:16:36Z",
    "created_at": "2011-05-25T01:12:06Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7.2",
    "title": "Remove the hardcoding of python version in setup.py and SConstruct to build sage_clib and sage itself",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11376",
    "user": "https://github.com/kiwifb"
}
```
Currently to build sage (the spkg) four files are involved in major way:
1. SConstuct to build sage-clib
2. setup.py
3. module_list.py
4. sage/misc/cython.py

The last three to build the sage python extensions. setup.py, and SConstruct both have the version of python used hardcoded in them, module_list.py doesn't refer to the python version anywhere. cython.py mention the python version explicitly in doctest but smartly find the version used for building all by itself. 

In this ticket I bring this smartness to SConstruct and setup.py. The advantage of doing this is that sage then can be build with either python-2.6 or 2.7 (and 3.x in the future) without patching. Of course it may still require patches to fix doctest and syntax in some parts - but you would be able to build sage in the first place without having to patch the build system. It has been found to be an impediment to testing in #9958.

Depend: #11373

Apply:
* [attachment:trac_11376-SConstruct.patch]
* [attachment:trac_11376-setuppy.patch]
* [attachment:trac_11376-msic_cythonpy-p2.patch]
* [attachment:trac_11376-fix_cythonpy_doctest.patch]

Assignee: GeorgSWeber

CC:  @strogdon @nexttime

Resolution: fixed

Dependencies: #11373

Author: François Bissey

Reviewer: Mariah Lenox

Merged: sage-4.7.2.alpha0

Issue created by migration from https://trac.sagemath.org/ticket/11376





---

archive/issue_comments_156004.json:
```json
{
    "body": "Attachment [trac_11376-build-sage_clib.patch](tarball://root/attachments/some-uuid/ticket11376/trac_11376-build-sage_clib.patch) by @kiwifb created at 2011-05-25 01:15:15\n\nRemove the python version hardcoding in SConstruct, remove debian cruft as well.",
    "created_at": "2011-05-25T01:15:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156004",
    "user": "https://github.com/kiwifb"
}
```

Attachment [trac_11376-build-sage_clib.patch](tarball://root/attachments/some-uuid/ticket11376/trac_11376-build-sage_clib.patch) by @kiwifb created at 2011-05-25 01:15:15

Remove the python version hardcoding in SConstruct, remove debian cruft as well.



---

archive/issue_comments_156005.json:
```json
{
    "body": "<a id='comment:1'></a>\nI also remove the Debian cruft from SConstruct and setup.py at the same time.",
    "created_at": "2011-05-25T01:16:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156005",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:1'></a>
I also remove the Debian cruft from SConstruct and setup.py at the same time.



---

archive/issue_comments_156006.json:
```json
{
    "body": "Author: Fran\u00e7ois Bissey",
    "created_at": "2011-05-25T01:16:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156006",
    "user": "https://github.com/kiwifb"
}
```

Author: François Bissey



---

archive/issue_comments_156007.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-05-25T01:23:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156007",
    "user": "https://github.com/kiwifb"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_156008.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-05-25T20:41:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156008",
    "user": "https://trac.sagemath.org/admin/accounts/users/mariah"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_156009.json:
```json
{
    "body": "<a id='comment:4'></a>\npatch [attachment:trac_11376-build-sage_clib.patch] failed to apply\nto sage-4.7.rc4:\n\n```\nsage: hg_sage.apply(\"/home/mariah/trac_11376-build-sage_clib.patch\")\ncd \"/home/mariah/sage/sage-4.7.rc4-x86_64-Linux-core2-fc/devel/sage\" && hg status\ncd \"/home/mariah/sage/sage-4.7.rc4-x86_64-Linux-core2-fc/devel/sage\" && hg status\ncd \"/home/mariah/sage/sage-4.7.rc4-x86_64-Linux-core2-fc/devel/sage\" && hg import   \"/home/mariah/trac_11376-build-sage_clib.patch\"\napplying /home/mariah/trac_11376-build-sage_clib.patch\npatching file c_lib/SConstruct\nHunk #3 FAILED at 133\n1 out of 3 hunks FAILED -- saving rejects to file c_lib/SConstruct.rej\nabort: patch failed to apply\nsage:\n```",
    "created_at": "2011-05-25T20:41:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156009",
    "user": "https://trac.sagemath.org/admin/accounts/users/mariah"
}
```

<a id='comment:4'></a>
patch [attachment:trac_11376-build-sage_clib.patch] failed to apply
to sage-4.7.rc4:

```
sage: hg_sage.apply("/home/mariah/trac_11376-build-sage_clib.patch")
cd "/home/mariah/sage/sage-4.7.rc4-x86_64-Linux-core2-fc/devel/sage" && hg status
cd "/home/mariah/sage/sage-4.7.rc4-x86_64-Linux-core2-fc/devel/sage" && hg status
cd "/home/mariah/sage/sage-4.7.rc4-x86_64-Linux-core2-fc/devel/sage" && hg import   "/home/mariah/trac_11376-build-sage_clib.patch"
applying /home/mariah/trac_11376-build-sage_clib.patch
patching file c_lib/SConstruct
Hunk #3 FAILED at 133
1 out of 3 hunks FAILED -- saving rejects to file c_lib/SConstruct.rej
abort: patch failed to apply
sage:
```



---

archive/issue_comments_156010.json:
```json
{
    "body": "<a id='comment:5'></a>\nThanks for looking at this Mariah. It doesn't apply because it was based on 4.7.1.alpha1. It was based on 4.7.1.alpha1 because of #11167 I cannot produce a patch that will work equally on 4.7.rc and 4.7.1.alpha. That's unfortunate but such is life. In fact I may have to rebase [attachment:trac_11376-build_setuppy.patch] because of #11373 in 4.7.1.alpha2.",
    "created_at": "2011-05-25T21:36:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156010",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:5'></a>
Thanks for looking at this Mariah. It doesn't apply because it was based on 4.7.1.alpha1. It was based on 4.7.1.alpha1 because of #11167 I cannot produce a patch that will work equally on 4.7.rc and 4.7.1.alpha. That's unfortunate but such is life. In fact I may have to rebase [attachment:trac_11376-build_setuppy.patch] because of #11373 in 4.7.1.alpha2.



---

archive/issue_comments_156011.json:
```json
{
    "body": "a version of this patch that works with 4.7.rc4",
    "created_at": "2011-05-25T21:45:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156011",
    "user": "https://github.com/kiwifb"
}
```

a version of this patch that works with 4.7.rc4



---

archive/issue_comments_156012.json:
```json
{
    "body": "<a id='comment:6'></a>\nAttachment [trac_11376-build-sage_clib-4.7.patch](tarball://root/attachments/some-uuid/ticket11376/trac_11376-build-sage_clib-4.7.patch) by @kiwifb created at 2011-05-25 21:46:36\n\nJust in case you still want to test it against 4.7.rc4 use this patch [attachment:trac_11376-build-sage_clib-4.7.patch] instead.",
    "created_at": "2011-05-25T21:46:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156012",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:6'></a>
Attachment [trac_11376-build-sage_clib-4.7.patch](tarball://root/attachments/some-uuid/ticket11376/trac_11376-build-sage_clib-4.7.patch) by @kiwifb created at 2011-05-25 21:46:36

Just in case you still want to test it against 4.7.rc4 use this patch [attachment:trac_11376-build-sage_clib-4.7.patch] instead.



---

archive/issue_comments_156013.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-05-26T13:15:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156013",
    "user": "https://trac.sagemath.org/admin/accounts/users/mariah"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_156014.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [fbissey](#comment%3A5):\n> Thanks for looking at this Mariah. It doesn't apply because it was based on 4.7.1.alpha1. \n\n\nApologies for the noise.  I did not realize that 4.7.1.alpha1 was out.  I have not seen any announcement of 4.7.1-alpha1 on sage-release.  Is there someplace I should be looking for such announcements?",
    "created_at": "2011-05-26T13:15:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156014",
    "user": "https://trac.sagemath.org/admin/accounts/users/mariah"
}
```

<a id='comment:7'></a>
Replying to [fbissey](#comment%3A5):
> Thanks for looking at this Mariah. It doesn't apply because it was based on 4.7.1.alpha1. 


Apologies for the noise.  I did not realize that 4.7.1.alpha1 was out.  I have not seen any announcement of 4.7.1-alpha1 on sage-release.  Is there someplace I should be looking for such announcements?



---

archive/issue_comments_156015.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [mariah](#comment%3A7):\n> Replying to [fbissey](#comment%3A5):\n> > Thanks for looking at this Mariah. It doesn't apply because it was based on 4.7.1.alpha1. \n\n> \n> Apologies for the noise.  I did not realize that 4.7.1.alpha1 was out.  I have not seen any announcement of 4.7.1-alpha1 on sage-release.  Is there someplace I should be looking for such announcements?\n\n\nNo apologies required. It isn't officially out but Jeroen  has \"prototypes\" alpha0, alpha1 and alpha2 already on [http://sage.math.washington.edu/home/release/](http://sage.math.washington.edu/home/release/).\nIt is a bit a pain to know that if you do something against 4.7.rc4 it will have to be put back to \"needs work\" once 4.7 is finally out and Jeroen officially announce the next alpha.",
    "created_at": "2011-05-26T13:41:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156015",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:8'></a>
Replying to [mariah](#comment%3A7):
> Replying to [fbissey](#comment%3A5):
> > Thanks for looking at this Mariah. It doesn't apply because it was based on 4.7.1.alpha1. 

> 
> Apologies for the noise.  I did not realize that 4.7.1.alpha1 was out.  I have not seen any announcement of 4.7.1-alpha1 on sage-release.  Is there someplace I should be looking for such announcements?


No apologies required. It isn't officially out but Jeroen  has "prototypes" alpha0, alpha1 and alpha2 already on [http://sage.math.washington.edu/home/release/](http://sage.math.washington.edu/home/release/).
It is a bit a pain to know that if you do something against 4.7.rc4 it will have to be put back to "needs work" once 4.7 is finally out and Jeroen officially announce the next alpha.



---

archive/issue_comments_156016.json:
```json
{
    "body": "<a id='comment:9'></a>\nI will add that it is perfectly acceptable to me if you want to leave this ticket for now and come back to it once a 4.7.1.alpha is released.",
    "created_at": "2011-05-26T19:11:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156016",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:9'></a>
I will add that it is perfectly acceptable to me if you want to leave this ticket for now and come back to it once a 4.7.1.alpha is released.



---

archive/issue_comments_156017.json:
```json
{
    "body": "<a id='comment:10'></a>\nNow that 4.7.1.alpha0 is released this ticket should be in a reviewable state.",
    "created_at": "2011-05-27T21:23:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156017",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:10'></a>
Now that 4.7.1.alpha0 is released this ticket should be in a reviewable state.



---

archive/issue_comments_156018.json:
```json
{
    "body": "Attachment [trac_11376-build_setuppy.patch](tarball://root/attachments/some-uuid/ticket11376/trac_11376-build_setuppy.patch) by @kiwifb created at 2011-05-27 22:16:16\n\nMake setup.py python version smart, remove debian cruft. (made dependent on #11373)",
    "created_at": "2011-05-27T22:16:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156018",
    "user": "https://github.com/kiwifb"
}
```

Attachment [trac_11376-build_setuppy.patch](tarball://root/attachments/some-uuid/ticket11376/trac_11376-build_setuppy.patch) by @kiwifb created at 2011-05-27 22:16:16

Make setup.py python version smart, remove debian cruft. (made dependent on #11373)



---

archive/issue_comments_156019.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -7,3 +7,9 @@\n The last three to build the sage python extensions. setup.py, and SConstruct both have the version of python used hardcoded in them, module_list.py doesn't refer to the python version anywhere. cython.py mention the python version explicitly in doctest but smartly find the version used for building all by itself. \n \n In this ticket I bring this smartness to SConstruct and setup.py. The advantage of doing this is that sage then can be build with either python-2.6 or 2.7 (and 3.x in the future) without patching. Of course it may still require patches to fix doctest and syntax in some parts - but you would be able to build sage in the first place without having to patch the build system. It has been found to be an impediment to testing in #9958.\n+\n+Depend: #11373\n+\n+Apply:\n+* [attachment:trac_11376-build-sage_clib.patch]\n+* [attachment:trac_11376-build_setuppy.patch]\n``````\n",
    "created_at": "2011-05-27T22:18:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156019",
    "user": "https://github.com/kiwifb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -7,3 +7,9 @@
 The last three to build the sage python extensions. setup.py, and SConstruct both have the version of python used hardcoded in them, module_list.py doesn't refer to the python version anywhere. cython.py mention the python version explicitly in doctest but smartly find the version used for building all by itself. 
 
 In this ticket I bring this smartness to SConstruct and setup.py. The advantage of doing this is that sage then can be build with either python-2.6 or 2.7 (and 3.x in the future) without patching. Of course it may still require patches to fix doctest and syntax in some parts - but you would be able to build sage in the first place without having to patch the build system. It has been found to be an impediment to testing in #9958.
+
+Depend: #11373
+
+Apply:
+* [attachment:trac_11376-build-sage_clib.patch]
+* [attachment:trac_11376-build_setuppy.patch]
``````




---

archive/issue_comments_156020.json:
```json
{
    "body": "<a id='comment:11'></a>\nDecided to avoid problem with #11373 so make it depend on it.",
    "created_at": "2011-05-27T22:18:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156020",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:11'></a>
Decided to avoid problem with #11373 so make it depend on it.



---

archive/issue_comments_156021.json:
```json
{
    "body": "<a id='comment:12'></a>\nThe python documentation for sys.version says \"Do not extract version information out of it, rather, use version_info and the functions provided by the platform module.\"  It looks to me as though you could use\n\n```\nplatform.python_version()  # gives '2.6.4'\nplatform.python_version().rstrip('.', 1)[0]  # gives '2.6'\nver = platform.python_version_tuple()  # gives ('2', '6', '4')\nver[0] + '.' + ver[1]  # gives '2.6'\n```\nor\n\n```\nver = sys.version_info\nstr(ver[0]) + '.' + str(ver[1])   # gives '2.6'\n```\nI'll take a look at the rest of the patches...",
    "created_at": "2011-06-01T19:59:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156021",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:12'></a>
The python documentation for sys.version says "Do not extract version information out of it, rather, use version_info and the functions provided by the platform module."  It looks to me as though you could use

```
platform.python_version()  # gives '2.6.4'
platform.python_version().rstrip('.', 1)[0]  # gives '2.6'
ver = platform.python_version_tuple()  # gives ('2', '6', '4')
ver[0] + '.' + ver[1]  # gives '2.6'
```
or

```
ver = sys.version_info
str(ver[0]) + '.' + str(ver[1])   # gives '2.6'
```
I'll take a look at the rest of the patches...



---

archive/issue_comments_156022.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [jhpalmieri](#comment%3A12):\n> The python documentation for sys.version says \"Do not extract version information out of it, rather, use version_info and the functions provided by the platform module.\"  It looks to me as though you could use\n> \n> ```\n> platform.python_version()  # gives '2.6.4'\n> platform.python_version().rstrip('.', 1)[0]  # gives '2.6'\n> ver = platform.python_version_tuple()  # gives ('2', '6', '4')\n> ver[0] + '.' + ver[1]  # gives '2.6'\n> ```\n> or\n> \n> ```\n> ver = sys.version_info\n> str(ver[0]) + '.' + str(ver[1])   # gives '2.6'\n> ```\n> I'll take a look at the rest of the patches...\n\n\nOK I will rewrite that then. It was purely a case of stealing code from somewhere else. Looks cool in misc/cython.py that will be useful here. I should bring cython.py in line too.",
    "created_at": "2011-06-01T21:57:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156022",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:13'></a>
Replying to [jhpalmieri](#comment%3A12):
> The python documentation for sys.version says "Do not extract version information out of it, rather, use version_info and the functions provided by the platform module."  It looks to me as though you could use
> 
> ```
> platform.python_version()  # gives '2.6.4'
> platform.python_version().rstrip('.', 1)[0]  # gives '2.6'
> ver = platform.python_version_tuple()  # gives ('2', '6', '4')
> ver[0] + '.' + ver[1]  # gives '2.6'
> ```
> or
> 
> ```
> ver = sys.version_info
> str(ver[0]) + '.' + str(ver[1])   # gives '2.6'
> ```
> I'll take a look at the rest of the patches...


OK I will rewrite that then. It was purely a case of stealing code from somewhere else. Looks cool in misc/cython.py that will be useful here. I should bring cython.py in line too.



---

archive/issue_comments_156023.json:
```json
{
    "body": "<a id='comment:14'></a>\nBy the way, I should have provided a link: see [http://docs.python.org/library/sys.html#sys.version](http://docs.python.org/library/sys.html#sys.version) for information about sys.version, and pointers to the other options.",
    "created_at": "2011-06-01T22:33:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156023",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:14'></a>
By the way, I should have provided a link: see [http://docs.python.org/library/sys.html#sys.version](http://docs.python.org/library/sys.html#sys.version) for information about sys.version, and pointers to the other options.



---

archive/issue_comments_156024.json:
```json
{
    "body": "<a id='comment:15'></a>\nNew version of patches all using the platform module. I also included sage/misc/cython.py to switch it from sys to platform. The cython patch in #9958 will be updated consequently.",
    "created_at": "2011-06-02T00:37:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156024",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:15'></a>
New version of patches all using the platform module. I also included sage/misc/cython.py to switch it from sys to platform. The cython patch in #9958 will be updated consequently.



---

archive/issue_comments_156025.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -11,5 +11,6 @@\n Depend: #11373\n \n Apply:\n-* [attachment:trac_11376-build-sage_clib.patch]\n-* [attachment:trac_11376-build_setuppy.patch]\n+* [attachment:trac_11376-SConstruct.patch]\n+* [attachment:trac_11376-setuppy.patch]\n+* [attachment:trac_11376-misc-cythonpy.patch]\n``````\n",
    "created_at": "2011-06-02T00:37:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156025",
    "user": "https://github.com/kiwifb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -11,5 +11,6 @@
 Depend: #11373
 
 Apply:
-* [attachment:trac_11376-build-sage_clib.patch]
-* [attachment:trac_11376-build_setuppy.patch]
+* [attachment:trac_11376-SConstruct.patch]
+* [attachment:trac_11376-setuppy.patch]
+* [attachment:trac_11376-misc-cythonpy.patch]
``````




---

archive/issue_comments_156026.json:
```json
{
    "body": "<a id='comment:16'></a>\nCan there ever be version numbers like '2.10'?  Choosing the first three characters of the version string seems riskier than removing everything starting from the second dot.",
    "created_at": "2011-06-02T05:06:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156026",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:16'></a>
Can there ever be version numbers like '2.10'?  Choosing the first three characters of the version string seems riskier than removing everything starting from the second dot.



---

archive/issue_comments_156027.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [jhpalmieri](#comment%3A16):\n> Can there ever be version numbers like '2.10'?  Choosing the first three characters of the version string seems riskier than removing everything starting from the second dot.\n\n\n2.10 in particular no. But your general point is valid. I will address this. Thanks for pointing this out.",
    "created_at": "2011-06-02T05:16:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156027",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:17'></a>
Replying to [jhpalmieri](#comment%3A16):
> Can there ever be version numbers like '2.10'?  Choosing the first three characters of the version string seems riskier than removing everything starting from the second dot.


2.10 in particular no. But your general point is valid. I will address this. Thanks for pointing this out.



---

archive/issue_comments_156028.json:
```json
{
    "body": "<a id='comment:18'></a>\nIt also looks like I made a big typo in the placement of a % in one of the patch as well. I'll get to it ASAP (about 4hours from now).",
    "created_at": "2011-06-02T05:27:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156028",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:18'></a>
It also looks like I made a big typo in the placement of a % in one of the patch as well. I'll get to it ASAP (about 4hours from now).



---

archive/issue_comments_156029.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -13,4 +13,4 @@\n Apply:\n * [attachment:trac_11376-SConstruct.patch]\n * [attachment:trac_11376-setuppy.patch]\n-* [attachment:trac_11376-misc-cythonpy.patch]\n+* [attachment:trac_11376-misc_cythonpy.patch]\n``````\n",
    "created_at": "2011-06-02T12:47:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156029",
    "user": "https://github.com/kiwifb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -13,4 +13,4 @@
 Apply:
 * [attachment:trac_11376-SConstruct.patch]
 * [attachment:trac_11376-setuppy.patch]
-* [attachment:trac_11376-misc-cythonpy.patch]
+* [attachment:trac_11376-misc_cythonpy.patch]
``````




---

archive/issue_comments_156030.json:
```json
{
    "body": "<a id='comment:19'></a>\nPatch updated to use .rstrip('.', 1)[0] as it was the quickest thing to do. Fixed the syntax errors in the setup.py patch as well.",
    "created_at": "2011-06-02T12:47:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156030",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:19'></a>
Patch updated to use .rstrip('.', 1)[0] as it was the quickest thing to do. Fixed the syntax errors in the setup.py patch as well.



---

archive/issue_comments_156031.json:
```json
{
    "body": "updated  20110603 #2",
    "created_at": "2011-06-02T19:42:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156031",
    "user": "https://github.com/kiwifb"
}
```

updated  20110603 #2



---

archive/issue_comments_156032.json:
```json
{
    "body": "Attachment [trac_11376-setuppy.patch](tarball://root/attachments/some-uuid/ticket11376/trac_11376-setuppy.patch) by @kiwifb created at 2011-06-02 19:43:49\n\nupdated  20110603 take 2",
    "created_at": "2011-06-02T19:43:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156032",
    "user": "https://github.com/kiwifb"
}
```

Attachment [trac_11376-setuppy.patch](tarball://root/attachments/some-uuid/ticket11376/trac_11376-setuppy.patch) by @kiwifb created at 2011-06-02 19:43:49

updated  20110603 take 2



---

archive/issue_comments_156033.json:
```json
{
    "body": "updated  20110603 take 2",
    "created_at": "2011-06-02T19:44:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156033",
    "user": "https://github.com/kiwifb"
}
```

updated  20110603 take 2



---

archive/issue_comments_156034.json:
```json
{
    "body": "<a id='comment:20'></a>\nAttachment [trac_11376-msic_cythonpy.patch](tarball://root/attachments/some-uuid/ticket11376/trac_11376-msic_cythonpy.patch) by @kiwifb created at 2011-06-02 19:46:36\n\nOK so I should have tested what John said before adopting it, even at half past midnight. He meant rsplit not rstrip.",
    "created_at": "2011-06-02T19:46:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156034",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:20'></a>
Attachment [trac_11376-msic_cythonpy.patch](tarball://root/attachments/some-uuid/ticket11376/trac_11376-msic_cythonpy.patch) by @kiwifb created at 2011-06-02 19:46:36

OK so I should have tested what John said before adopting it, even at half past midnight. He meant rsplit not rstrip.



---

archive/issue_comments_156035.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -13,4 +13,4 @@\n Apply:\n * [attachment:trac_11376-SConstruct.patch]\n * [attachment:trac_11376-setuppy.patch]\n-* [attachment:trac_11376-misc_cythonpy.patch]\n+* [attachment:trac_11376-msic_cythonpy.patch]\n``````\n",
    "created_at": "2011-06-02T19:46:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156035",
    "user": "https://github.com/kiwifb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -13,4 +13,4 @@
 Apply:
 * [attachment:trac_11376-SConstruct.patch]
 * [attachment:trac_11376-setuppy.patch]
-* [attachment:trac_11376-misc_cythonpy.patch]
+* [attachment:trac_11376-msic_cythonpy.patch]
``````




---

archive/issue_comments_156036.json:
```json
{
    "body": "Dependencies: #11373",
    "created_at": "2011-06-09T12:28:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156036",
    "user": "https://github.com/kiwifb"
}
```

Dependencies: #11373



---

archive/issue_comments_156037.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-06-14T13:10:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156037",
    "user": "https://trac.sagemath.org/admin/accounts/users/mariah"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_156038.json:
```json
{
    "body": "<a id='comment:22'></a>\nOn skynet/eno (x86_64-Linux-core2-fc), I applied the three patches to sage-4.7.1.alpha2, did 'sage -b', then 'make testlong'.  I got the following failure:\n\n```\neno% ./sage -t  -long -force_lib \"devel/sage/sage/misc/cython.py\"\nsage -t -long -force_lib \"devel/sage/sage/misc/cython.py\"   \n**********************************************************************\nFile \"/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/devel/sage/sage/misc/cython.py\", line 146:\n    sage: pyx_preparse(\"\")\nExpected:\n    ('\\ninclude \"interrupt.pxi\"  # ctrl-c interrupt block support\\ninclude \"stdsage.pxi\"  # ctrl-c interrupt block support\\n\\ninclude \"cdefs.pxi\"\\n',\n    ['mpfr',\n    'gmp',\n    'gmpxx',\n    'stdc++',\n    'pari',\n    'm',\n    'curvesntl',\n    'g0nntl',\n    'jcntl',\n    'rankntl',\n    'gsl',\n    '...blas',\n    ...,\n    'ntl',\n    'csage'],\n    ['.../local/include/csage/',\n    '.../local/include/',\n    '.../local/include/python2.6/',\n    '.../devel/sage/sage/ext/',\n    '.../devel/sage/',\n    '.../devel/sage/sage/gsl/'],\n    'c',\n    [])\nGot:\n    ('\\ninclude \"interrupt.pxi\"  # ctrl-c interrupt block support\\ninclude \"stdsage.pxi\"  # ctrl-c interrupt block support\\n\\ninclude \"cdefs.pxi\"\\n', ['mpfr', 'gmp', 'gmpxx', 'stdc++', 'pari', 'm', 'curvesntl', 'g0nntl', 'jcntl', 'rankntl', 'gsl', 'gslcblas', 'atlas', 'ntl', 'csage'], ['/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/local//include/csage/', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/local//include/', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/local//include/python2.6/', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/local//lib/python2.6/site-packages/numpy/core/include', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/devel/sage/sage/ext/', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/devel/sage/', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/devel/sage/sage/gsl/'], 'c', [])\n**********************************************************************\nFile \"/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/devel/sage/sage/misc/cython.py\", line 188:\n    sage: inc\nExpected:\n    ['bar',\n    '.../local/include/csage/',\n    '.../local/include/',\n    '.../local/include/python2.6/',\n    '.../devel/sage/sage/ext/',\n    '.../devel/sage/',\n    '.../devel/sage/sage/gsl/']\nGot:\n    ['bar', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/local//include/csage/', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/local//include/', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/local//include/python2.6/', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/local//lib/python2.6/site-packages/numpy/core/include', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/devel/sage/sage/ext/', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/devel/sage/', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/devel/sage/sage/gsl/']\n**********************************************************************\n1 items had failures:\n   2 of  10 in __main__.example_2\n```",
    "created_at": "2011-06-14T13:10:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156038",
    "user": "https://trac.sagemath.org/admin/accounts/users/mariah"
}
```

<a id='comment:22'></a>
On skynet/eno (x86_64-Linux-core2-fc), I applied the three patches to sage-4.7.1.alpha2, did 'sage -b', then 'make testlong'.  I got the following failure:

```
eno% ./sage -t  -long -force_lib "devel/sage/sage/misc/cython.py"
sage -t -long -force_lib "devel/sage/sage/misc/cython.py"   
**********************************************************************
File "/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/devel/sage/sage/misc/cython.py", line 146:
    sage: pyx_preparse("")
Expected:
    ('\ninclude "interrupt.pxi"  # ctrl-c interrupt block support\ninclude "stdsage.pxi"  # ctrl-c interrupt block support\n\ninclude "cdefs.pxi"\n',
    ['mpfr',
    'gmp',
    'gmpxx',
    'stdc++',
    'pari',
    'm',
    'curvesntl',
    'g0nntl',
    'jcntl',
    'rankntl',
    'gsl',
    '...blas',
    ...,
    'ntl',
    'csage'],
    ['.../local/include/csage/',
    '.../local/include/',
    '.../local/include/python2.6/',
    '.../devel/sage/sage/ext/',
    '.../devel/sage/',
    '.../devel/sage/sage/gsl/'],
    'c',
    [])
Got:
    ('\ninclude "interrupt.pxi"  # ctrl-c interrupt block support\ninclude "stdsage.pxi"  # ctrl-c interrupt block support\n\ninclude "cdefs.pxi"\n', ['mpfr', 'gmp', 'gmpxx', 'stdc++', 'pari', 'm', 'curvesntl', 'g0nntl', 'jcntl', 'rankntl', 'gsl', 'gslcblas', 'atlas', 'ntl', 'csage'], ['/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/local//include/csage/', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/local//include/', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/local//include/python2.6/', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/local//lib/python2.6/site-packages/numpy/core/include', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/devel/sage/sage/ext/', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/devel/sage/', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/devel/sage/sage/gsl/'], 'c', [])
**********************************************************************
File "/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/devel/sage/sage/misc/cython.py", line 188:
    sage: inc
Expected:
    ['bar',
    '.../local/include/csage/',
    '.../local/include/',
    '.../local/include/python2.6/',
    '.../devel/sage/sage/ext/',
    '.../devel/sage/',
    '.../devel/sage/sage/gsl/']
Got:
    ['bar', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/local//include/csage/', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/local//include/', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/local//include/python2.6/', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/local//lib/python2.6/site-packages/numpy/core/include', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/devel/sage/sage/ext/', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/devel/sage/', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/devel/sage/sage/gsl/']
**********************************************************************
1 items had failures:
   2 of  10 in __main__.example_2
```



---

archive/issue_comments_156039.json:
```json
{
    "body": "<a id='comment:23'></a>\nHi Mariah,\n\nI fixed this test as part of #9958 in [http://trac.sagemath.org/sage_trac/attachment/ticket/9958/trac_9958-fix-misc_cythonpy.patch](http://trac.sagemath.org/sage_trac/attachment/ticket/9958/trac_9958-fix-misc_cythonpy.patch) I thought it was appearing because of python-2.7.\n\nIf it shows up for you with python-2.6 it is strange that it didn't before the patch.\n\nIn any case if it shows up for you the above patch will have to be split and moved to this ticket. Just a few minutes.",
    "created_at": "2011-06-14T13:20:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156039",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:23'></a>
Hi Mariah,

I fixed this test as part of #9958 in [http://trac.sagemath.org/sage_trac/attachment/ticket/9958/trac_9958-fix-misc_cythonpy.patch](http://trac.sagemath.org/sage_trac/attachment/ticket/9958/trac_9958-fix-misc_cythonpy.patch) I thought it was appearing because of python-2.7.

If it shows up for you with python-2.6 it is strange that it didn't before the patch.

In any case if it shows up for you the above patch will have to be split and moved to this ticket. Just a few minutes.



---

archive/issue_comments_156040.json:
```json
{
    "body": "Attachment [trac_11376-fix_cythonpy_doctest.patch](tarball://root/attachments/some-uuid/ticket11376/trac_11376-fix_cythonpy_doctest.patch) by @kiwifb created at 2011-06-14 13:28:32\n\nfix the cython.py doctest for the appearance on numpy",
    "created_at": "2011-06-14T13:28:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156040",
    "user": "https://github.com/kiwifb"
}
```

Attachment [trac_11376-fix_cythonpy_doctest.patch](tarball://root/attachments/some-uuid/ticket11376/trac_11376-fix_cythonpy_doctest.patch) by @kiwifb created at 2011-06-14 13:28:32

fix the cython.py doctest for the appearance on numpy



---

archive/issue_comments_156041.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-06-14T13:29:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156041",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_156042.json:
```json
{
    "body": "<a id='comment:24'></a>\nOK new patch added.",
    "created_at": "2011-06-14T13:29:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156042",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:24'></a>
OK new patch added.



---

archive/issue_comments_156043.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -14,3 +14,4 @@\n * [attachment:trac_11376-SConstruct.patch]\n * [attachment:trac_11376-setuppy.patch]\n * [attachment:trac_11376-msic_cythonpy.patch]\n+* [attachment:trac_11376-fix_cythonpy_doctest.patch]\n``````\n",
    "created_at": "2011-06-14T13:29:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156043",
    "user": "https://github.com/kiwifb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -14,3 +14,4 @@
 * [attachment:trac_11376-SConstruct.patch]
 * [attachment:trac_11376-setuppy.patch]
 * [attachment:trac_11376-msic_cythonpy.patch]
+* [attachment:trac_11376-fix_cythonpy_doctest.patch]
``````




---

archive/issue_comments_156044.json:
```json
{
    "body": "<a id='comment:25'></a>\nWhat about the\u00a0\n\n/local//include/ \u00a0and \u00a0/local//lib/\n\nin the returned results? Could this also cause a failure? I'm seeing this also in failure of the cython.py test when the patches of\u00a0#9958\u00a0are applied. And the numpy fix is already in those patches.",
    "created_at": "2011-06-14T15:46:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156044",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:25'></a>
What about the 

/local//include/  and  /local//lib/

in the returned results? Could this also cause a failure? I'm seeing this also in failure of the cython.py test when the patches of #9958 are applied. And the numpy fix is already in those patches.



---

archive/issue_comments_156045.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-06-14T17:12:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156045",
    "user": "https://trac.sagemath.org/admin/accounts/users/mariah"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_156046.json:
```json
{
    "body": "<a id='comment:26'></a>\nOn skynet/eno (x86_64-Linux-core2-fc), I applied all four patches to sage-4.7.1.alpha1, did 'sage -b', but I still get the error \n\n```\nsage -t -long -force_lib \"devel/sage/sage/misc/cython.py\"   \n**********************************************************************\nFile \"/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/devel/sage/sage/misc/cython.py\", line 146:\n    sage: pyx_preparse(\"\")\nExpected:\n    ('\\ninclude \"interrupt.pxi\"  # ctrl-c interrupt block support\\ninclude \"stdsage.pxi\"  # ctrl-c interrupt block support\\n\\ninclude \"cdefs.pxi\"\\n',\n    ['mpfr',\n    'gmp',\n    'gmpxx',\n    'stdc++',\n    'pari',\n    'm',\n    'curvesntl',\n    'g0nntl',\n    'jcntl',\n    'rankntl',\n    'gsl',\n    '...blas',\n    ...,\n    'ntl',\n    'csage'],\n    ['.../local/include/csage/',\n    '.../local/include/',\n    '.../local/include/python2.6/',\n    '.../local/lib/python2.6/site-packages/numpy/core/include',\n    '.../devel/sage/sage/ext/',\n    '.../devel/sage/',\n    '.../devel/sage/sage/gsl/'],\n    'c',\n    [])\nGot:\n    ('\\ninclude \"interrupt.pxi\"  # ctrl-c interrupt block support\\ninclude \"stdsage.pxi\"  # ctrl-c interrupt block support\\n\\ninclude \"cdefs.pxi\"\\n', ['mpfr', 'gmp', 'gmpxx', 'stdc++', 'pari', 'm', 'curvesntl', 'g0nntl', 'jcntl', 'rankntl', 'gsl', 'gslcblas', 'atlas', 'ntl', 'csage'], ['/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/local//include/csage/', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/local//include/', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/local//include/python2.6/', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/local//lib/python2.6/site-packages/numpy/core/include', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/devel/sage/sage/ext/', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/devel/sage/', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/devel/sage/sage/gsl/'], 'c', [])\n**********************************************************************\nFile \"/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/devel/sage/sage/misc/cython.py\", line 189:\n    sage: inc\nExpected:\n    ['bar',\n    '.../local/include/csage/',\n    '.../local/include/',\n    '.../local/include/python2.6/',\n    '.../local/lib/python2.6/site-packages/numpy/core/include',\n    '.../devel/sage/sage/ext/',\n    '.../devel/sage/',\n    '.../devel/sage/sage/gsl/']\nGot:\n    ['bar', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/local//include/csage/', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/local//include/', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/local//include/python2.6/', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/local//lib/python2.6/site-packages/numpy/core/include', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/devel/sage/sage/ext/', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/devel/sage/', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/devel/sage/sage/gsl/']\n**********************************************************************\n1 items had failures:\n   2 of  10 in __main__.example_2\n***Test Failed*** 2 failures.\nFor whitespace errors, see the file /home/mariah/.sage//tmp/.doctest_cython.py\n         [4.7 s]\n \n----------------------------------------------------------------------\nThe following tests failed:\n```",
    "created_at": "2011-06-14T17:12:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156046",
    "user": "https://trac.sagemath.org/admin/accounts/users/mariah"
}
```

<a id='comment:26'></a>
On skynet/eno (x86_64-Linux-core2-fc), I applied all four patches to sage-4.7.1.alpha1, did 'sage -b', but I still get the error 

```
sage -t -long -force_lib "devel/sage/sage/misc/cython.py"   
**********************************************************************
File "/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/devel/sage/sage/misc/cython.py", line 146:
    sage: pyx_preparse("")
Expected:
    ('\ninclude "interrupt.pxi"  # ctrl-c interrupt block support\ninclude "stdsage.pxi"  # ctrl-c interrupt block support\n\ninclude "cdefs.pxi"\n',
    ['mpfr',
    'gmp',
    'gmpxx',
    'stdc++',
    'pari',
    'm',
    'curvesntl',
    'g0nntl',
    'jcntl',
    'rankntl',
    'gsl',
    '...blas',
    ...,
    'ntl',
    'csage'],
    ['.../local/include/csage/',
    '.../local/include/',
    '.../local/include/python2.6/',
    '.../local/lib/python2.6/site-packages/numpy/core/include',
    '.../devel/sage/sage/ext/',
    '.../devel/sage/',
    '.../devel/sage/sage/gsl/'],
    'c',
    [])
Got:
    ('\ninclude "interrupt.pxi"  # ctrl-c interrupt block support\ninclude "stdsage.pxi"  # ctrl-c interrupt block support\n\ninclude "cdefs.pxi"\n', ['mpfr', 'gmp', 'gmpxx', 'stdc++', 'pari', 'm', 'curvesntl', 'g0nntl', 'jcntl', 'rankntl', 'gsl', 'gslcblas', 'atlas', 'ntl', 'csage'], ['/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/local//include/csage/', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/local//include/', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/local//include/python2.6/', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/local//lib/python2.6/site-packages/numpy/core/include', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/devel/sage/sage/ext/', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/devel/sage/', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/devel/sage/sage/gsl/'], 'c', [])
**********************************************************************
File "/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/devel/sage/sage/misc/cython.py", line 189:
    sage: inc
Expected:
    ['bar',
    '.../local/include/csage/',
    '.../local/include/',
    '.../local/include/python2.6/',
    '.../local/lib/python2.6/site-packages/numpy/core/include',
    '.../devel/sage/sage/ext/',
    '.../devel/sage/',
    '.../devel/sage/sage/gsl/']
Got:
    ['bar', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/local//include/csage/', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/local//include/', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/local//include/python2.6/', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/local//lib/python2.6/site-packages/numpy/core/include', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/devel/sage/sage/ext/', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/devel/sage/', '/home/mariah/sage/sage-4.7.1.alpha2-x86_64-Linux-core2-fc-review-11376/devel/sage/sage/gsl/']
**********************************************************************
1 items had failures:
   2 of  10 in __main__.example_2
***Test Failed*** 2 failures.
For whitespace errors, see the file /home/mariah/.sage//tmp/.doctest_cython.py
         [4.7 s]
 
----------------------------------------------------------------------
The following tests failed:
```



---

archive/issue_comments_156047.json:
```json
{
    "body": "Attachment [trac_11376-msic_cythonpy-p2.patch](tarball://root/attachments/some-uuid/ticket11376/trac_11376-msic_cythonpy-p2.patch) by @kiwifb created at 2011-06-14 19:10:01\n\nPatch to misc/cython.py with the right number of slashes",
    "created_at": "2011-06-14T19:10:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156047",
    "user": "https://github.com/kiwifb"
}
```

Attachment [trac_11376-msic_cythonpy-p2.patch](tarball://root/attachments/some-uuid/ticket11376/trac_11376-msic_cythonpy-p2.patch) by @kiwifb created at 2011-06-14 19:10:01

Patch to misc/cython.py with the right number of slashes



---

archive/issue_comments_156048.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -13,5 +13,5 @@\n Apply:\n * [attachment:trac_11376-SConstruct.patch]\n * [attachment:trac_11376-setuppy.patch]\n-* [attachment:trac_11376-msic_cythonpy.patch]\n+* [attachment:trac_11376-msic_cythonpy-p2.patch]\n * [attachment:trac_11376-fix_cythonpy_doctest.patch]\n``````\n",
    "created_at": "2011-06-14T19:12:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156048",
    "user": "https://github.com/kiwifb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -13,5 +13,5 @@
 Apply:
 * [attachment:trac_11376-SConstruct.patch]
 * [attachment:trac_11376-setuppy.patch]
-* [attachment:trac_11376-msic_cythonpy.patch]
+* [attachment:trac_11376-msic_cythonpy-p2.patch]
 * [attachment:trac_11376-fix_cythonpy_doctest.patch]
``````




---

archive/issue_comments_156049.json:
```json
{
    "body": "<a id='comment:27'></a>\nThanks for pointing it out Steve I had missed it completely. We should have a uniform definition of SAGE_LOCAL, sometimes it has a final \"/\" and sometimes it doesn't. So I updated the misc_cythonpy patch to -p2. Hope we got everything now.",
    "created_at": "2011-06-14T19:12:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156049",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:27'></a>
Thanks for pointing it out Steve I had missed it completely. We should have a uniform definition of SAGE_LOCAL, sometimes it has a final "/" and sometimes it doesn't. So I updated the misc_cythonpy patch to -p2. Hope we got everything now.



---

archive/issue_comments_156050.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-06-14T19:12:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156050",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_156051.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-06-16T13:22:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156051",
    "user": "https://trac.sagemath.org/admin/accounts/users/mariah"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_156052.json:
```json
{
    "body": "<a id='comment:28'></a>\nApplied all patches to sage-4.7.1.alpha2, did 'sage -b', and 'make testlong'.  All tests passed.  Positive review!  (finally!)",
    "created_at": "2011-06-16T13:22:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156052",
    "user": "https://trac.sagemath.org/admin/accounts/users/mariah"
}
```

<a id='comment:28'></a>
Applied all patches to sage-4.7.1.alpha2, did 'sage -b', and 'make testlong'.  All tests passed.  Positive review!  (finally!)



---

archive/issue_comments_156053.json:
```json
{
    "body": "Reviewer: Mariah Lenox",
    "created_at": "2011-06-16T13:22:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156053",
    "user": "https://trac.sagemath.org/admin/accounts/users/mariah"
}
```

Reviewer: Mariah Lenox



---

archive/issue_events_035085.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-06-16T21:31:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "milestone": "sage-4.7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11376#event-35085"
}
```



---

archive/issue_comments_156054.json:
```json
{
    "body": "<a id='comment:30'></a>\nA little word of thanks, in the right bug this time (note to self don't do this again at 1:30am):\n\nThank you Mariah for the review. Thank you John for the suggestion to make it better. Thank you Steve for pointing the obvious.\n\nThank you all for making this reach this stage. Hopefully this will be in 4.7.2.alpha0.",
    "created_at": "2011-06-16T23:21:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156054",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:30'></a>
A little word of thanks, in the right bug this time (note to self don't do this again at 1:30am):

Thank you Mariah for the review. Thank you John for the suggestion to make it better. Thank you Steve for pointing the obvious.

Thank you all for making this reach this stage. Hopefully this will be in 4.7.2.alpha0.



---

archive/issue_comments_156055.json:
```json
{
    "body": "Merged: sage-4.7.2.alpha0",
    "created_at": "2011-07-24T11:16:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156055",
    "user": "https://github.com/jdemeyer"
}
```

Merged: sage-4.7.2.alpha0



---

archive/issue_events_035086.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-07-24T11:16:36Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11376#event-35086"
}
```



---

archive/issue_comments_156056.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-07-24T11:16:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11376#issuecomment-156056",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
