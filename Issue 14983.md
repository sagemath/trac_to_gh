# Issue 14983: Vector_modn_dense used for too large a modulus?

Issue created by migration from https://trac.sagemath.org/ticket/15220

Original creator: mmezzarobba

Original creation time: 2013-09-24 06:05:28

`sage.rings.finite_rings.integer_mod?` says that `IntegerMod_int64` "is used if the modulus is less than `2^{31}-1`".

Consider however a vector of elements of `GF(p)` with `p` between 2<sup>31</sup> and 2<sup>32</sup>:


```
sage: K = GF(3037000493)
sage: v = vector(K, [42])
sage: type(v)
<type 'sage.modules.vector_modn_dense.Vector_modn_dense'>
```


Then:

```
sage: type(v[0])
<type 'sage.rings.finite_rings.integer_mod.IntegerMod_int64'>
```

which breaks some operations:

```
sage: ~v[0]
---------------------------------------------------------------------------
ZeroDivisionError                         Traceback (most recent call last)
<ipython-input-5-43d86000256e> in <module>()
----> 1 ~v[Integer(0)]

/home/marc/co/sage/local/lib/python2.7/site-packages/sage/rings/finite_rings/integer_mod.so in sage.rings.finite_rings.integer_mod.IntegerMod_int64.__invert__ (sage/rings/finite_rings/integer_mod.c:29992)()

/home/marc/co/sage/local/lib/python2.7/site-packages/sage/rings/finite_rings/integer_mod.so in sage.rings.finite_rings.integer_mod.mod_inverse_int64 (sage/rings/finite_rings/integer_mod.c:30920)()

ZeroDivisionError: Inverse does not exist.
```


This does not happens with modular integers themselves:

```
sage: type(K(42))
<type 'sage.rings.finite_rings.integer_mod.IntegerMod_gmp'>
sage: ~K(42)
2241595602
```

Matrices do not seem affected either.

Things work fine with sage-5.8 on the same machine. This makes me suspect that the issue might have been introduced in aa83d6e996d552dfa871f510b1bc9af6f1127076 (#14627)â€”but I didn't check.


---

Comment by vbraun created at 2013-09-24 10:29:12

Initial patch


---

Comment by vbraun created at 2013-09-24 10:29:33

Changing priority from major to blocker.


---

Attachment


---

Comment by vbraun created at 2013-09-24 10:29:33

Changing status from new to needs_review.


---

Comment by vbraun created at 2013-09-24 10:31:01

Yes, this is from #14627. Would have been nice if there would have been doctests...

I think its pretty trivial fix so we should get that into the next Sage release.


---

Comment by mmezzarobba created at 2013-09-24 16:09:03

Changing status from needs_review to positive_review.


---

Comment by mmezzarobba created at 2013-09-24 16:09:03

Looks good to me--and solves my problem. Thanks!


---

Comment by jdemeyer created at 2013-10-01 07:18:24

Resolution: fixed
