# Issue 28699: Create tox plugin for running the sage doctester

Issue created by migration from https://trac.sagemath.org/ticket/28936

Original creator: mkoeppe

Original creation time: 2020-01-01 18:58:02

CC:  jdemeyer dimpase embray vdelecroix chapoton tscrim jmantysalo @tobiasdiez @kliem nthiery tornaria

`tox` seems to be the preferred interface for running tests - see for example https://github.com/pypa/setuptools/issues/931 (deprecation of `setup.py test`).

We should create a `tox` plugin (https://tox.readthedocs.io/en/latest/plugins.html)
- for testing `sagelib` (as an alternative to `sage -t`)
- for users' packages that depend on sage.


---

Comment by embray created at 2020-01-06 14:36:12

Replying to [ticket:28936 mkoeppe]:
> `tox` seems to be the preferred interface for running tests - see for example https://github.com/pypa/setuptools/issues/931 (deprecation of `setup.py test`).

I don't know what you mean by "preferred interface" here.  There isn't really any such thing as a preferred interface.  It's just being proposed here as a recommendation over `setup.py test`.  Sage doesn't use `setup.py test` anyways so there's nothing that needs to be "replaced" with a different interface if/when `setup.py` goes away.

The main advantage to tox is the ability to run a package's tests across multiple runtime environments (esp. different Python versions).  This isn't really possible currently with Sage; it would actually be very difficult to use tox in any sensible manner with Sage.

If someone wants to do this anyways I don't see the harm really, but I'm not sure what problem it would be solving.


---

Comment by mkoeppe created at 2020-01-11 05:36:03

Changing type from enhancement to task.


---

Comment by mkoeppe created at 2020-01-11 05:36:03

A first step:  #28987


---

Comment by mkoeppe created at 2020-01-13 01:42:22

Replying to [comment:3 embray]:
> Replying to [ticket:28936 mkoeppe]:
> The main advantage to tox is the ability to run a package's tests across multiple runtime environments (esp. different Python versions).  This isn't really possible currently with Sage; it would actually be very difficult to use tox in any sensible manner with Sage.

FWIW, I managed to use `tox` on top of the sage installation, see https://github.com/mkoeppe/sage-numerical-backends-gurobi/blob/master/tox.ini: The trick is to run `tox` with `sitepackages = true` and an `install_command` that installs into the user scheme. With this trick, after all, no new plugin for `tox` is needed to handle the sage environment.


---

Comment by mkoeppe created at 2020-01-13 02:03:46

I have broadened the ticket description.


---

Comment by mkoeppe created at 2020-04-14 06:38:06

pushing these forward to 9.2


---

Comment by mkoeppe created at 2021-05-10 17:42:09

Moving to 9.4, as 9.3 has been released.


---

Comment by @tobiasdiez created at 2021-05-27 21:57:13

What do you think about using [pytest-cov](https://pypi.org/project/pytest-cov/) for generating the test coverage report? The results can then be uploded to [codecov](https://about.codecov.io/) as part of the build process (github action). This gives a nice overview of the actual test coverage (i.e. code covered by tests) and could replace the sage-coverage scripts in the future.


---

Comment by mkoeppe created at 2021-05-28 00:00:06

+1 on investigating this. Myself I have no experience with the available tools (including the `sage-coverage` scripts even though I have fixed them up at least once). As usual, it's best to build a prototype and then demonstrate to the sage-devel community that it is useful.
