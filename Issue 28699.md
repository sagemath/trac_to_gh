# Issue 28699: Create tox plugin for running the sage doctester

archive/issues_028699.json:
```json
{
    "body": "CC:  @jdemeyer @dimpase @embray @videlec @fchapoton @tscrim @jm58660 @tobiasdiez @kliem @nthiery @tornaria\n\n`tox` seems to be the preferred interface for running tests - see for example https://github.com/pypa/setuptools/issues/931 (deprecation of `setup.py test`).\n\nWe should create a `tox` plugin (https://tox.readthedocs.io/en/latest/plugins.html)\n- for testing `sagelib` (as an alternative to `sage -t`)\n- for users' packages that depend on sage.\n\nIssue created by migration from https://trac.sagemath.org/ticket/28936\n\n",
    "created_at": "2020-01-01T18:58:02Z",
    "labels": [
        "component: doctest framework"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Create tox plugin for running the sage doctester",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28699",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @jdemeyer @dimpase @embray @videlec @fchapoton @tscrim @jm58660 @tobiasdiez @kliem @nthiery @tornaria

`tox` seems to be the preferred interface for running tests - see for example https://github.com/pypa/setuptools/issues/931 (deprecation of `setup.py test`).

We should create a `tox` plugin (https://tox.readthedocs.io/en/latest/plugins.html)
- for testing `sagelib` (as an alternative to `sage -t`)
- for users' packages that depend on sage.

Issue created by migration from https://trac.sagemath.org/ticket/28936





---

archive/issue_comments_404919.json:
```json
{
    "body": "Replying to [ticket:28936 mkoeppe]:\n> `tox` seems to be the preferred interface for running tests - see for example https://github.com/pypa/setuptools/issues/931 (deprecation of `setup.py test`).\n\nI don't know what you mean by \"preferred interface\" here.  There isn't really any such thing as a preferred interface.  It's just being proposed here as a recommendation over `setup.py test`.  Sage doesn't use `setup.py test` anyways so there's nothing that needs to be \"replaced\" with a different interface if/when `setup.py` goes away.\n\nThe main advantage to tox is the ability to run a package's tests across multiple runtime environments (esp. different Python versions).  This isn't really possible currently with Sage; it would actually be very difficult to use tox in any sensible manner with Sage.\n\nIf someone wants to do this anyways I don't see the harm really, but I'm not sure what problem it would be solving.",
    "created_at": "2020-01-06T14:36:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28699#issuecomment-404919",
    "user": "https://github.com/embray"
}
```

Replying to [ticket:28936 mkoeppe]:
> `tox` seems to be the preferred interface for running tests - see for example https://github.com/pypa/setuptools/issues/931 (deprecation of `setup.py test`).

I don't know what you mean by "preferred interface" here.  There isn't really any such thing as a preferred interface.  It's just being proposed here as a recommendation over `setup.py test`.  Sage doesn't use `setup.py test` anyways so there's nothing that needs to be "replaced" with a different interface if/when `setup.py` goes away.

The main advantage to tox is the ability to run a package's tests across multiple runtime environments (esp. different Python versions).  This isn't really possible currently with Sage; it would actually be very difficult to use tox in any sensible manner with Sage.

If someone wants to do this anyways I don't see the harm really, but I'm not sure what problem it would be solving.



---

archive/issue_comments_404920.json:
```json
{
    "body": "Changing type from enhancement to task.",
    "created_at": "2020-01-11T05:36:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28699#issuecomment-404920",
    "user": "https://github.com/mkoeppe"
}
```

Changing type from enhancement to task.



---

archive/issue_comments_404921.json:
```json
{
    "body": "A first step:  #28987",
    "created_at": "2020-01-11T05:36:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28699#issuecomment-404921",
    "user": "https://github.com/mkoeppe"
}
```

A first step:  #28987



---

archive/issue_comments_404922.json:
```json
{
    "body": "Replying to [comment:3 embray]:\n> Replying to [ticket:28936 mkoeppe]:\n> The main advantage to tox is the ability to run a package's tests across multiple runtime environments (esp. different Python versions).  This isn't really possible currently with Sage; it would actually be very difficult to use tox in any sensible manner with Sage.\n\nFWIW, I managed to use `tox` on top of the sage installation, see https://github.com/mkoeppe/sage-numerical-backends-gurobi/blob/master/tox.ini: The trick is to run `tox` with `sitepackages = true` and an `install_command` that installs into the user scheme. With this trick, after all, no new plugin for `tox` is needed to handle the sage environment.",
    "created_at": "2020-01-13T01:42:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28699#issuecomment-404922",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:3 embray]:
> Replying to [ticket:28936 mkoeppe]:
> The main advantage to tox is the ability to run a package's tests across multiple runtime environments (esp. different Python versions).  This isn't really possible currently with Sage; it would actually be very difficult to use tox in any sensible manner with Sage.

FWIW, I managed to use `tox` on top of the sage installation, see https://github.com/mkoeppe/sage-numerical-backends-gurobi/blob/master/tox.ini: The trick is to run `tox` with `sitepackages = true` and an `install_command` that installs into the user scheme. With this trick, after all, no new plugin for `tox` is needed to handle the sage environment.



---

archive/issue_comments_404923.json:
```json
{
    "body": "I have broadened the ticket description.",
    "created_at": "2020-01-13T02:03:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28699#issuecomment-404923",
    "user": "https://github.com/mkoeppe"
}
```

I have broadened the ticket description.



---

archive/issue_comments_404924.json:
```json
{
    "body": "pushing these forward to 9.2",
    "created_at": "2020-04-14T06:38:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28699#issuecomment-404924",
    "user": "https://github.com/mkoeppe"
}
```

pushing these forward to 9.2



---

archive/issue_comments_404925.json:
```json
{
    "body": "Moving to 9.4, as 9.3 has been released.",
    "created_at": "2021-05-10T17:42:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28699#issuecomment-404925",
    "user": "https://github.com/mkoeppe"
}
```

Moving to 9.4, as 9.3 has been released.



---

archive/issue_comments_404926.json:
```json
{
    "body": "What do you think about using [pytest-cov](https://pypi.org/project/pytest-cov/) for generating the test coverage report? The results can then be uploded to [codecov](https://about.codecov.io/) as part of the build process (github action). This gives a nice overview of the actual test coverage (i.e. code covered by tests) and could replace the sage-coverage scripts in the future.",
    "created_at": "2021-05-27T21:57:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28699#issuecomment-404926",
    "user": "https://github.com/tobiasdiez"
}
```

What do you think about using [pytest-cov](https://pypi.org/project/pytest-cov/) for generating the test coverage report? The results can then be uploded to [codecov](https://about.codecov.io/) as part of the build process (github action). This gives a nice overview of the actual test coverage (i.e. code covered by tests) and could replace the sage-coverage scripts in the future.



---

archive/issue_comments_404927.json:
```json
{
    "body": "+1 on investigating this. Myself I have no experience with the available tools (including the `sage-coverage` scripts even though I have fixed them up at least once). As usual, it's best to build a prototype and then demonstrate to the sage-devel community that it is useful.",
    "created_at": "2021-05-28T00:00:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28699#issuecomment-404927",
    "user": "https://github.com/mkoeppe"
}
```

+1 on investigating this. Myself I have no experience with the available tools (including the `sage-coverage` scripts even though I have fixed them up at least once). As usual, it's best to build a prototype and then demonstrate to the sage-devel community that it is useful.
