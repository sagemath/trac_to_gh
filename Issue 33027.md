# Issue 33027: some TypeError occurred in animate()

Issue created by migration from https://trac.sagemath.org/ticket/33264

Original creator: @umedoblock

Original creation time: 2022-01-31 21:55:31

CC:  slelievre mkoeppe

# I tried to run all of the EXAMPLE in [Animated plots](https://doc.sagemath.org/html/en/reference/plotting/sage/plot/animate.html)

## environment

```
macOS Monterey
Version 12.1
```



```
┌────────────────────────────────────────────────────────────────────┐
│ SageMath version 9.5.rc2, Release Date: 2022-01-16                 │
│ Using Python 3.9.9. Type "help()" for help.                        │
└────────────────────────────────────────────────────────────────────┘
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Warning: this is a prerelease version, and it may be unstable.     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
```


# Some TypeError occurred after run below EXAMPLES:

## TypeError1

```
sage: sage: sage: a = animate([plot(x^2 + n) for n in range(4)], ymin=0, ymax=4)
....:   
....:                                                                           
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-46-05cc8220246d> in <module>
----> 1 a = animate([plot(x**Integer(2) + n) for n in range(Integer(4))], ymin=Integer(0), ymax=Integer(4))

<ipython-input-46-05cc8220246d> in <listcomp>(.0)
----> 1 a = animate([plot(x**Integer(2) + n) for n in range(Integer(4))], ymin=Integer(0), ymax=Integer(4))

/private/var/tmp/sage-9.5-current/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/rings/integer.pyx in sage.rings.integer.Integer.__pow__ (build/cythonized/sage/rings/integer.c:14496)()
   2153             return coercion_model.bin_op(left, right, operator.pow)
   2154         # left is a non-Element: do the powering with a Python int
-> 2155         return left ** int(right)
   2156 
   2157     cpdef _pow_(self, other):

TypeError: unsupported operand type(s) for ** or pow(): 'function' and 'int'
```


## TypeError2

```
sage: sage: a = animate([sin(x + float(k)) for k in srange(0,2*pi,0.7)], 
....: ....:             xmin=0, xmax=2*pi, ymin=-1, ymax=1, figsize=[2,1])      
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-41-d043bfa4db4e> in <module>
----> 1 a = animate([sin(x + float(k)) for k in srange(Integer(0),Integer(2)*pi,RealNumber('0.7'))],
      2             xmin=Integer(0), xmax=Integer(2)*pi, ymin=-Integer(1), ymax=Integer(1), figsize=[Integer(2),Integer(1)])

<ipython-input-41-d043bfa4db4e> in <listcomp>(.0)
----> 1 a = animate([sin(x + float(k)) for k in srange(Integer(0),Integer(2)*pi,RealNumber('0.7'))],
      2             xmin=Integer(0), xmax=Integer(2)*pi, ymin=-Integer(1), ymax=Integer(1), figsize=[Integer(2),Integer(1)])

TypeError: unsupported operand type(s) for +: 'function' and 'float'
```


## TypeError3

```
sage: sage: a = animate([sin(x + float(k)) for k in srange(0,2*pi,0.7)], 
....: ....:                xmin=0, xmax=2*pi, figsize=[2,1])                    
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-44-65f74ffcfd6c> in <module>
----> 1 a = animate([sin(x + float(k)) for k in srange(Integer(0),Integer(2)*pi,RealNumber('0.7'))],
      2                xmin=Integer(0), xmax=Integer(2)*pi, figsize=[Integer(2),Integer(1)])

<ipython-input-44-65f74ffcfd6c> in <listcomp>(.0)
----> 1 a = animate([sin(x + float(k)) for k in srange(Integer(0),Integer(2)*pi,RealNumber('0.7'))],
      2                xmin=Integer(0), xmax=Integer(2)*pi, figsize=[Integer(2),Integer(1)])

TypeError: unsupported operand type(s) for +: 'function' and 'float'
```



---

Comment by slelievre created at 2022-02-01 12:22:53

Did you redefine `x` before that?

Try running `reset('x')` and running the examples again.


---

Comment by slelievre created at 2022-02-01 12:38:23

Changing status from new to needs_info.


---

Comment by slelievre created at 2022-02-01 12:38:23

All the examples work fine for me in a fresh Sage session

- using the Sage-macOS 9.5 prerelease
- or using Sage 9.5 final, built from source

If I first redefine `x` as a function, e.g.

```
sage: x = lambda t: t + 1
```

then the failures in the ticket description arise.

Resetting `x` to its starting value with

```
sage: reset('x')
```

solves the issues, and the examples work fine again.


---

Comment by slelievre created at 2022-02-01 12:38:23

Changing component from PLEASE CHANGE to graphics.


---

Comment by slelievre created at 2022-02-01 12:38:23

Changing type from PLEASE CHANGE to defect.


---

Comment by slelievre created at 2022-02-01 12:42:46

This seems like user error rather than a defect in Sage.

Propose to close as invalid.


---

Comment by slelievre created at 2022-02-01 12:42:46

Changing status from needs_info to needs_review.


---

Comment by @umedoblock created at 2022-02-01 16:16:46

Hello slelievre.

You said "redefine x" means below sentence ?


```
x = lambda t: cos(t)
```


If it's correct, I redefined.

I tried running reset('x') and running the examples again.

Then TypeError disappeared.

Thanks slelievre.

I'm a beginner of sagemath, so I have no idea how to recovery from TypeError.

And I couldn't run below sentence.

```
reset('x')
```


I believe that all of the sagemath beginner cannot recovery from TypeError.

Please change document of "make_image(frame, filename, **kwds)" in [Animated plots](https://doc.sagemath.org/html/en/reference/plotting/sage/plot/animate.html).

EXAMPLES:


```
from sage.plot.animate import Animation
class MyAnimation(Animation):
   def make_image(self, frame, filename, **kwds):
       P = parametric_plot(frame[0], frame[1], **frame[2])
       P.save_image(filename,**kwds)

t = var('t')

vvvvvvvvvvvvvvvvvvvv
x = lambda t: cos(t)
^^^^^^^^^^^^^^^^^^^^

y = lambda n,t: sin(t)/n
B = MyAnimation([([x(t), y(i+1,t)],(t,0,1), {'color':Color((1,0,i/4)), 'aspect_ratio':1, 'ymax':1}) for i in range(4)])

d = B.png(); v = os.listdir(d); v.sort(); v  # long time
['00000000.png', '00000001.png', '00000002.png', '00000003.png']
B.show()  # not tested

class MyAnimation(Animation):
   def make_image(self, frame, filename, **kwds):
       G = frame.plot()

G.set_axes_range(floor(G.xmin()),ceil(G.xmax()),floor(G.ymin()),ceil(G.ymax()))
       G.save_image(filename, **kwds)

B = MyAnimation([graphs.CompleteGraph(n) for n in range(7,11)], figsize=5)
d = B.png()
v = os.listdir(d); v.sort(); v
['00000000.png', '00000001.png', '00000002.png', '00000003.png']
B.show()  # not tested
```



---

Comment by mjo created at 2022-02-02 19:18:50

In gh-umedoblock's defense, our examples _do_ rely on some implicit magic, the symbolic variable `x` being automatically defined whenever sage starts or the doctest environment resets. I would much rather see us begin them all with `x = SR.var("x")` so that they're truly copy/paste-able, but I expect I'd be pelted with tomatoes if I proposed it.


---

Comment by slelievre created at 2022-02-02 19:25:38

Replying to [comment:5 mjo]:
> In gh-umedoblock's defense, our examples _do_ rely on some implicit magic, the symbolic variable `x` being automatically defined whenever sage starts or the doctest environment resets. I would much rather see us begin them all with `x = SR.var("x")` so that they're truly copy/paste-able [...]

Huge +1 from me.


---

Comment by mjo created at 2022-02-02 19:27:44

It looks like maybe there's a reason to propose this that won't make me look like a busybody: #32721


---

Comment by @umedoblock created at 2022-02-02 20:04:03

Do you irritate me ?

Sorry.

I insert `reset('x')` under `MyAnimation()`

And `animate()` doesn't raise `TypeError`.

So please insert `reset('x')` under `MyAnimation()`.


```
from sage.plot.animate import Animation
class MyAnimation(Animation):
    def make_image(self, frame, filename, **kwds):
        P = parametric_plot(frame[0], frame[1], **frame[2])
        P.save_image(filename,**kwds)

t = var('t')
x = lambda t: cos(t)
y = lambda n,t: sin(t)/n
B = MyAnimation([([x(t), y(i+1,t)],(t,0,1), {'color':Color((1,0,i/4)), 'aspect_ratio':1, 'ymax':1}) for i in range(4)])

vvvvvvvvvv
reset('x')
^^^^^^^^^^

d = B.png(); v = os.listdir(d); v.sort(); v  # long time
B.show()  # not tested

a = animate([plot(x^2 + n) for n in range(4)], ymin=0, ymax=4)
d = a.png(); v = os.listdir(d); v.sort(); v  # long time
```



---

Comment by slelievre created at 2022-02-02 21:51:39

Instead of `reset('x')`, you can also use `x = SR.var('x')`.

I agree many documentation examples would be improved
if they started with that.


---

Comment by slelievre created at 2022-02-02 21:51:39

Changing status from needs_review to needs_work.


---

Comment by @umedoblock created at 2022-02-03 04:52:22

Improved.

And works it.

Thanks slelieve and mjo.


```
from sage.plot.animate import Animation
class MyAnimation(Animation):
    def make_image(self, frame, filename, **kwds):
        P = parametric_plot(frame[0], frame[1], **frame[2])
        P.save_image(filename,**kwds)

t = var('t')
x = lambda t: cos(t)
y = lambda n,t: sin(t)/n
B = MyAnimation([([x(t), y(i+1,t)],(t,0,1), {'color':Color((1,0,i/4)), 'aspect_ratio':1, 'ymax':1}) for i in range(4)])

vvvvvvvvvvvvvvv
x = SR.var('x')
^^^^^^^^^^^^^^^

d = B.png(); v = os.listdir(d); v.sort(); v  # long time
B.show()  # not tested

a = animate([plot(x^2 + n) for n in range(4)], ymin=0, ymax=4)
d = a.png(); v = os.listdir(d); v.sort(); v  # long time
```



---

Comment by mjo created at 2022-02-03 13:55:17

One down, a million to go.
----
New commits:


---

Comment by mjo created at 2022-02-03 13:55:17

Changing status from needs_work to needs_review.


---

Comment by slelievre created at 2022-02-04 00:32:08

Changing status from needs_review to positive_review.


---

Comment by slelievre created at 2022-02-04 00:32:32

That will help!


---

Comment by slelievre created at 2022-02-04 00:53:51

Changing keywords from "" to "SR.var('x')".


---

Comment by vbraun created at 2022-02-16 23:57:14

Resolution: fixed
