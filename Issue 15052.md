# Issue 15052: Implement indexed monoids

archive/issues_015052.json:
```json
{
    "body": "Assignee: sage-combinat\n\nCC:  sage-combinat nthiery mshimo simonking\n\nImplements free (abelian) monoids whose generators are indexed by an arbitrary set. This also moves common code from `CombinatorialFreeModule` into a new class `sage.misc.indexed_generators.IndexedGenerators`. With this we can now create (noncommutative) polynomials whose generators are given by a combinatorial object.\n\nIssue created by migration from https://trac.sagemath.org/ticket/15289\n\n",
    "created_at": "2013-10-16T16:13:40Z",
    "labels": [
        "algebra",
        "major",
        "enhancement"
    ],
    "title": "Implement indexed monoids",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15052",
    "user": "tscrim"
}
```
Assignee: sage-combinat

CC:  sage-combinat nthiery mshimo simonking

Implements free (abelian) monoids whose generators are indexed by an arbitrary set. This also moves common code from `CombinatorialFreeModule` into a new class `sage.misc.indexed_generators.IndexedGenerators`. With this we can now create (noncommutative) polynomials whose generators are given by a combinatorial object.

Issue created by migration from https://trac.sagemath.org/ticket/15289





---

archive/issue_comments_192533.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-10-16T16:53:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192533",
    "user": "tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_192534.json:
```json
{
    "body": "Initial version. I might add a `_basis_keys` attribute to `CombinatorialFreeModule` for backwards compatibility...",
    "created_at": "2013-10-16T16:53:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192534",
    "user": "tscrim"
}
```

Initial version. I might add a `_basis_keys` attribute to `CombinatorialFreeModule` for backwards compatibility...



---

archive/issue_comments_192535.json:
```json
{
    "body": "Hi Travis,\n\nThanks for working on this feature! I'll try to look at it, but that won't be immediately. I would have thought we already had a ticket about that, but I might be wrong. For the record, here is a link to a discussion we had (a long time ago) about such features:\n\n https://groups.google.com/forum/#!searchin/sage-combinat-devel/CombinatorialFreeModule$20free$20monoid/sage-combinat-devel/EH8M6bWPylk/a-FG4uFQm7AJ\n\nThanks again!\n\nCheers,\n                                         Nicolas",
    "created_at": "2013-10-16T17:09:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192535",
    "user": "nthiery"
}
```

Hi Travis,

Thanks for working on this feature! I'll try to look at it, but that won't be immediately. I would have thought we already had a ticket about that, but I might be wrong. For the record, here is a link to a discussion we had (a long time ago) about such features:

 https://groups.google.com/forum/#!searchin/sage-combinat-devel/CombinatorialFreeModule$20free$20monoid/sage-combinat-devel/EH8M6bWPylk/a-FG4uFQm7AJ

Thanks again!

Cheers,
                                         Nicolas



---

archive/issue_comments_192536.json:
```json
{
    "body": "Hey Nicolas,\n\nI believe there is a ticket about making free abelian groups as `ZZ`-modules, and another one about converting between additive and multiplicative groups. However they currently don't apply to `CombinatorialFreeModule`, and none of the tickets on `CombinatorialFreeModule` would apply here as far as I remember.\n\nHere's a new version which gives a groups version so we can do Laurent polynomials. This is not are fancy as the discussion would like, but it serves my purposes for now.\n\nBest,\n\nTravis",
    "created_at": "2013-10-16T23:05:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192536",
    "user": "tscrim"
}
```

Hey Nicolas,

I believe there is a ticket about making free abelian groups as `ZZ`-modules, and another one about converting between additive and multiplicative groups. However they currently don't apply to `CombinatorialFreeModule`, and none of the tickets on `CombinatorialFreeModule` would apply here as far as I remember.

Here's a new version which gives a groups version so we can do Laurent polynomials. This is not are fancy as the discussion would like, but it serves my purposes for now.

Best,

Travis



---

archive/issue_comments_192537.json:
```json
{
    "body": "Here's with some more functionality additions. I did make one major change and made the iterator return `(generator, exp)`, as opposed to `(index, exp)` and similar to how `FreeMonoid` works.\n\nFrequently I'm finding myself calling `_sorted_items()`, but I'm needing to manipulate the indices of the generators. I'm wondering if we should make it into a public method (perhaps with a better name since there is no true sorting occurring when it is not free).",
    "created_at": "2013-10-23T01:49:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192537",
    "user": "tscrim"
}
```

Here's with some more functionality additions. I did make one major change and made the iterator return `(generator, exp)`, as opposed to `(index, exp)` and similar to how `FreeMonoid` works.

Frequently I'm finding myself calling `_sorted_items()`, but I'm needing to manipulate the indices of the generators. I'm wondering if we should make it into a public method (perhaps with a better name since there is no true sorting occurring when it is not free).



---

archive/issue_comments_192538.json:
```json
{
    "body": "Rebased to `5.13.beta2`.",
    "created_at": "2013-11-02T05:35:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192538",
    "user": "tscrim"
}
```

Rebased to `5.13.beta2`.



---

archive/issue_comments_192539.json:
```json
{
    "body": "Attachment",
    "created_at": "2013-11-02T21:19:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192539",
    "user": "tscrim"
}
```

Attachment



---

archive/issue_comments_192540.json:
```json
{
    "body": "Added git version.\n----\nNew commits:",
    "created_at": "2013-11-07T19:35:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192540",
    "user": "tscrim"
}
```

Added git version.
----
New commits:



---

archive/issue_comments_192541.json:
```json
{
    "body": "Changing keywords from \"\" to \"days54\".",
    "created_at": "2013-11-09T00:10:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192541",
    "user": "tscrim"
}
```

Changing keywords from "" to "days54".



---

archive/issue_comments_192542.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-12-03T19:41:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192542",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_192543.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-02-08T17:37:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192543",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_192544.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-02-11T21:37:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192544",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_192545.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-02-11T21:47:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192545",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_192546.json:
```json
{
    "body": "Hey Nicolas,\n\nFrom your comments on #15726, I've made the appropriate changes here.\n\n* All `Indexed*` now goes through `Free*`, but as a special case, I have `IndexedFreeAbelianGroup` as `FreeGroup(index_set=X, abelian=True)`. Should we do the same for `FreeMonoid`?\n\n* I want to leave `__pow__` alone since they are more specialized for the data structures.\n\n* The `__contains__`, are you suggesting putting it into `Parent`? If so, that might be a can of worms and should be done on another ticket.\n\n* I'd like to keep `IndexedFreeAbelianGroup` as multiplicative since I want to use them as a basis indexing set for polynomials.\n\n* Similarly, the comparisons are using lex ordering, so it gives a nice default order on terms when modeling polynomial rings with indexed generators.\n\nThank you for looking at this (and #15726). As always, I appreciate your wisdom and insight.\n\nBest,\n\nTravis\n----\nNew commits:",
    "created_at": "2014-02-11T21:54:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192546",
    "user": "tscrim"
}
```

Hey Nicolas,

From your comments on #15726, I've made the appropriate changes here.

* All `Indexed*` now goes through `Free*`, but as a special case, I have `IndexedFreeAbelianGroup` as `FreeGroup(index_set=X, abelian=True)`. Should we do the same for `FreeMonoid`?

* I want to leave `__pow__` alone since they are more specialized for the data structures.

* The `__contains__`, are you suggesting putting it into `Parent`? If so, that might be a can of worms and should be done on another ticket.

* I'd like to keep `IndexedFreeAbelianGroup` as multiplicative since I want to use them as a basis indexing set for polynomials.

* Similarly, the comparisons are using lex ordering, so it gives a nice default order on terms when modeling polynomial rings with indexed generators.

Thank you for looking at this (and #15726). As always, I appreciate your wisdom and insight.

Best,

Travis
----
New commits:



---

archive/issue_comments_192547.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-03-04T17:49:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192547",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_192548.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-03-13T05:24:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192548",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_192549.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-04-02T01:37:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192549",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_192550.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-04-09T01:55:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192550",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_192551.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-04-15T02:23:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192551",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_192552.json:
```json
{
    "body": "Replying to [comment:14 tscrim]:\n> From your comments on #15726, I've made the appropriate changes here.\n\nArgl, two months already ... sorry for lagging behind so much. I know\nhow painful it is to get suggestions late in the process when\neverything is in a clean state ...\n\n> * All `Indexed*` now goes through `Free*`,\n\nNice! Thanks!\n\n> but as a special case, I have `IndexedFreeAbelianGroup` as `FreeGroup(index_set=X, abelian=True)`. Should we do the same for `FreeMonoid`?\n\nIt would be nice to be consistent indeed, but I have no preference for\none idiom or the other. Maybe ask on sage-devel?\n\nBy the way, for this ticket or later, I have been desiring for a long\ntime to have some systematic idiom like:\n\n```\n    sage: Groups().free(index_set={...})\n    sage: CommutativeAdditiveGroups().free(index_set={...})\n    sage: Algebras(QQ).free(index_set={...})\n```\n\n\nThen we could remove all the Free* from the global name space.\n\n> * The `__contains__`, are you suggesting putting it into `Parent`?\n> If so, that might be a can of worms and should be done on another ticket.\n\nI was thinking of putting it in the categories, but you are right,\ngiven the mro `Parent.__contains__` will take over.\n\nIn fact do you have a specific reason to override\n`Parent.__contains__`? Granted, the policy implemented in\n`Parent.__contains__` is unsatisfactory (it's doing too much stuff to\nmy taste, in particular stuff that can potentially be costly). And\nfixing it could indeed be a can of worm. On the other hand, having\nmany parents define their own containment policy is unsatisfactory as\nwell.\n\n> * I'd like to keep `IndexedFreeAbelianGroup` as multiplicative since I want to use them as a basis indexing set for polynomials.\n\nIt's customary as well to index polynomials by exponent vectors in the\nadditive group `NN^n`. Actually I would tend to prefer it. But that's\nprobably something to ask on sage-devel.\n\n> * Similarly, the comparisons are using lex ordering, so it gives a nice default order on terms when modeling polynomial rings with indexed generators.\n\nAs long as it's easy to customize it, I guess that's fine.\n\nIn term of code review, what should I look at at this point? Were some\ncommits already reviewed, or should I just look at the diff w.r.t\ndevelop?\n\nCheers,\n                         Nicolas",
    "created_at": "2014-04-18T15:49:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192552",
    "user": "nthiery"
}
```

Replying to [comment:14 tscrim]:
> From your comments on #15726, I've made the appropriate changes here.

Argl, two months already ... sorry for lagging behind so much. I know
how painful it is to get suggestions late in the process when
everything is in a clean state ...

> * All `Indexed*` now goes through `Free*`,

Nice! Thanks!

> but as a special case, I have `IndexedFreeAbelianGroup` as `FreeGroup(index_set=X, abelian=True)`. Should we do the same for `FreeMonoid`?

It would be nice to be consistent indeed, but I have no preference for
one idiom or the other. Maybe ask on sage-devel?

By the way, for this ticket or later, I have been desiring for a long
time to have some systematic idiom like:

```
    sage: Groups().free(index_set={...})
    sage: CommutativeAdditiveGroups().free(index_set={...})
    sage: Algebras(QQ).free(index_set={...})
```


Then we could remove all the Free* from the global name space.

> * The `__contains__`, are you suggesting putting it into `Parent`?
> If so, that might be a can of worms and should be done on another ticket.

I was thinking of putting it in the categories, but you are right,
given the mro `Parent.__contains__` will take over.

In fact do you have a specific reason to override
`Parent.__contains__`? Granted, the policy implemented in
`Parent.__contains__` is unsatisfactory (it's doing too much stuff to
my taste, in particular stuff that can potentially be costly). And
fixing it could indeed be a can of worm. On the other hand, having
many parents define their own containment policy is unsatisfactory as
well.

> * I'd like to keep `IndexedFreeAbelianGroup` as multiplicative since I want to use them as a basis indexing set for polynomials.

It's customary as well to index polynomials by exponent vectors in the
additive group `NN^n`. Actually I would tend to prefer it. But that's
probably something to ask on sage-devel.

> * Similarly, the comparisons are using lex ordering, so it gives a nice default order on terms when modeling polynomial rings with indexed generators.

As long as it's easy to customize it, I guess that's fine.

In term of code review, what should I look at at this point? Were some
commits already reviewed, or should I just look at the diff w.r.t
develop?

Cheers,
                         Nicolas



---

archive/issue_comments_192553.json:
```json
{
    "body": "Replying to [comment:21 nthiery]: \n> > but as a special case, I have `IndexedFreeAbelianGroup` as `FreeGroup(index_set=X, abelian=True)`. Should we do the same for `FreeMonoid`?\n> \n> It would be nice to be consistent indeed, but I have no preference for\n> one idiom or the other. Maybe ask on sage-devel?\n\nI will do so.\n\n> By the way, for this ticket or later, I have been desiring for a long\n> time to have some systematic idiom like:\n> {{{\n>     sage: Groups().free(index_set={...})\n>     sage: CommutativeAdditiveGroups().free(index_set={...})\n>     sage: Algebras(QQ).free(index_set={...})\n> }}}\n> \n> Then we could remove all the Free* from the global name space.\n\nI'll also ask about this on sage-devel, and will start the process here if there's no resistance.\n\n> I was thinking of putting it in the categories, but you are right,\n> given the mro `Parent.__contains__` will take over.\n> \n> In fact do you have a specific reason to override\n> `Parent.__contains__`? Granted, the policy implemented in\n> `Parent.__contains__` is unsatisfactory (it's doing too much stuff to\n> my taste, in particular stuff that can potentially be costly). And\n> fixing it could indeed be a can of worm. On the other hand, having\n> many parents define their own containment policy is unsatisfactory as\n> well.\n\nI don't have a good reason (the annoyance is the `self(x)` calls the coercion framework and makes it so we can't register any coercions thereafter, but that's not a problem in how I'm using these), so I'm fine with scraping it.\n \n> > * I'd like to keep `IndexedFreeAbelianGroup` as multiplicative since I want to use them as a basis indexing set for polynomials.\n> \n> It's customary as well to index polynomials by exponent vectors in the\n> additive group `NN^n`. Actually I would tend to prefer it. But that's\n> probably something to ask on sage-devel.\n\nI'm not quite sure what you're suggesting here.\n\n> As long as it's easy to customize it, I guess that's fine.\n\nYes it is by passing a parameter (`monomial_cmp`, which should be renamed to `generator_cmp`) with a cmp function.\n \n> In term of code review, what should I look at at this point? Were some\n> commits already reviewed, or should I just look at the diff w.r.t\n> develop?\n\nYou're the only one who's really looked at this code, so a diff w.r.t. develop.\n\nThank you!",
    "created_at": "2014-04-18T16:07:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192553",
    "user": "tscrim"
}
```

Replying to [comment:21 nthiery]: 
> > but as a special case, I have `IndexedFreeAbelianGroup` as `FreeGroup(index_set=X, abelian=True)`. Should we do the same for `FreeMonoid`?
> 
> It would be nice to be consistent indeed, but I have no preference for
> one idiom or the other. Maybe ask on sage-devel?

I will do so.

> By the way, for this ticket or later, I have been desiring for a long
> time to have some systematic idiom like:
> {{{
>     sage: Groups().free(index_set={...})
>     sage: CommutativeAdditiveGroups().free(index_set={...})
>     sage: Algebras(QQ).free(index_set={...})
> }}}
> 
> Then we could remove all the Free* from the global name space.

I'll also ask about this on sage-devel, and will start the process here if there's no resistance.

> I was thinking of putting it in the categories, but you are right,
> given the mro `Parent.__contains__` will take over.
> 
> In fact do you have a specific reason to override
> `Parent.__contains__`? Granted, the policy implemented in
> `Parent.__contains__` is unsatisfactory (it's doing too much stuff to
> my taste, in particular stuff that can potentially be costly). And
> fixing it could indeed be a can of worm. On the other hand, having
> many parents define their own containment policy is unsatisfactory as
> well.

I don't have a good reason (the annoyance is the `self(x)` calls the coercion framework and makes it so we can't register any coercions thereafter, but that's not a problem in how I'm using these), so I'm fine with scraping it.
 
> > * I'd like to keep `IndexedFreeAbelianGroup` as multiplicative since I want to use them as a basis indexing set for polynomials.
> 
> It's customary as well to index polynomials by exponent vectors in the
> additive group `NN^n`. Actually I would tend to prefer it. But that's
> probably something to ask on sage-devel.

I'm not quite sure what you're suggesting here.

> As long as it's easy to customize it, I guess that's fine.

Yes it is by passing a parameter (`monomial_cmp`, which should be renamed to `generator_cmp`) with a cmp function.
 
> In term of code review, what should I look at at this point? Were some
> commits already reviewed, or should I just look at the diff w.r.t
> develop?

You're the only one who's really looked at this code, so a diff w.r.t. develop.

Thank you!



---

archive/issue_comments_192554.json:
```json
{
    "body": "Replying to [comment:22 tscrim]:\n> > > * I'd like to keep `IndexedFreeAbelianGroup` as multiplicative since I want to use them as a basis indexing set for polynomials.\n> > \n> > It's customary as well to index polynomials by exponent vectors in the\n> > additive group `NN^n`. Actually I would tend to prefer it. But that's\n> > probably something to ask on sage-devel.\n> \n> I'm not quite sure what you're suggesting here.\n\nI guess I mean that I lean toward IndexedFreeAbelianGroup being\nadditive. But that's definitely debatable. Opinion anyone?\n\nBtw, for consistency with the naming of hte categories maybe a better\nname for the class could be IndexedFreeCommutativeGroup (or\nIndexedFreeCommutativeAdditiveGroup if we opt for additive).\n\n> You're the only one who's really looked at this code, so a diff w.r.t. develop.\n\nOk!",
    "created_at": "2014-04-18T17:29:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192554",
    "user": "nthiery"
}
```

Replying to [comment:22 tscrim]:
> > > * I'd like to keep `IndexedFreeAbelianGroup` as multiplicative since I want to use them as a basis indexing set for polynomials.
> > 
> > It's customary as well to index polynomials by exponent vectors in the
> > additive group `NN^n`. Actually I would tend to prefer it. But that's
> > probably something to ask on sage-devel.
> 
> I'm not quite sure what you're suggesting here.

I guess I mean that I lean toward IndexedFreeAbelianGroup being
additive. But that's definitely debatable. Opinion anyone?

Btw, for consistency with the naming of hte categories maybe a better
name for the class could be IndexedFreeCommutativeGroup (or
IndexedFreeCommutativeAdditiveGroup if we opt for additive).

> You're the only one who's really looked at this code, so a diff w.r.t. develop.

Ok!



---

archive/issue_comments_192555.json:
```json
{
    "body": "sage-devel thread: https://groups.google.com/forum/#!topic/sage-devel/yAvIvWxNgXE",
    "created_at": "2014-04-18T23:23:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192555",
    "user": "tscrim"
}
```

sage-devel thread: https://groups.google.com/forum/#!topic/sage-devel/yAvIvWxNgXE



---

archive/issue_comments_192556.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-04-25T16:58:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192556",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_192557.json:
```json
{
    "body": "Hey Nicolas,\n\nI've changed `monomial_cmp` to `generator_cmp` and made some other fixes I encountered along the way (after merging in `6.2.rc0`). I've started adding in our idiom of `Category.free` for groups and monoids, the rest will be done in #16218 (along with possible deprecations). Back to ready for review.\n\nThanks,\n\nTravis",
    "created_at": "2014-04-26T04:35:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192557",
    "user": "tscrim"
}
```

Hey Nicolas,

I've changed `monomial_cmp` to `generator_cmp` and made some other fixes I encountered along the way (after merging in `6.2.rc0`). I've started adding in our idiom of `Category.free` for groups and monoids, the rest will be done in #16218 (along with possible deprecations). Back to ready for review.

Thanks,

Travis



---

archive/issue_comments_192558.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-05T15:43:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192558",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_192559.json:
```json
{
    "body": "Hi Travis,\n\nFinally working on the review! Besides the little tidying I just\ncommitted here are some comments for the files I have been checking so\nfar:\n\nFreeGroup:\n\n- \u00abif specified then the optional keyword ``abelian`` can be used\u00bb\n   And not otherwise?\n\n- Rename indexed_group.py to indexed_free_group.py\n\n- Define group_generators rather than gens (or at the minimum define\n  group_generators as an alias to gens) and use it whenever\n  possible.\n\n- Element.__pow__: better use standard binary powering:\n  {{{\n  sage: pow = x.__class__.__pow__\n  sage: pow_generic = Monoids().element_class.__pow__\n  sage: pow_generic(x,1000) == pow(x,1000)\n  True\n\n  sage: %timeit pow(x,1)\n  1000000 loops, best of 3: 827 ns per loop\n  sage: %timeit pow_generic(x,1)\n  1000000 loops, best of 3: 521 ns per loop\n\n  sage: %timeit pow(x,-1)\n  100000 loops, best of 3: 6.45 \u00b5s per loop\n  sage: %timeit pow_generic(x,-1)\n  100000 loops, best of 3: 6.85 \u00b5s per loop\n\n  sage: %timeit pow(x,2)\n  100000 loops, best of 3: 11.5 \u00b5s per loop\n  sage: %timeit pow_generic(x,2)\n  100000 loops, best of 3: 6.07 \u00b5s per loop\n\n  sage: %timeit pow(x,50)\n  1000 loops, best of 3: 844 \u00b5s per loop\n  sage: %timeit pow_generic(x,50)\n  10000 loops, best of 3: 80.2 \u00b5s per loop\n\n  sage: %timeit pow(x,1000)\n  10 loops, best of 3: 181 ms per loop\n  sage: %timeit pow_generic(x,1000)\n  1000 loops, best of 3: 1.04 ms per loop\n  }}}\n\n- __len__, ... all the calls to sorted_items suggest that some\n  sorting is involved when this is not the case.\n\n- order, rank, is_finite are identical in all the free\n  (abelian) monoids/groups. Could we avoid the duplication?\n\nFreeAbelianGroup:\n\n- Element._mul_ could use sage.combinat.dict_addition\n\nMore later tonight!\n\nCheers,\n                                 Nicolas",
    "created_at": "2014-05-05T15:50:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192559",
    "user": "nthiery"
}
```

Hi Travis,

Finally working on the review! Besides the little tidying I just
committed here are some comments for the files I have been checking so
far:

FreeGroup:

- «if specified then the optional keyword ``abelian`` can be used»
   And not otherwise?

- Rename indexed_group.py to indexed_free_group.py

- Define group_generators rather than gens (or at the minimum define
  group_generators as an alias to gens) and use it whenever
  possible.

- Element.__pow__: better use standard binary powering:
  {{{
  sage: pow = x.__class__.__pow__
  sage: pow_generic = Monoids().element_class.__pow__
  sage: pow_generic(x,1000) == pow(x,1000)
  True

  sage: %timeit pow(x,1)
  1000000 loops, best of 3: 827 ns per loop
  sage: %timeit pow_generic(x,1)
  1000000 loops, best of 3: 521 ns per loop

  sage: %timeit pow(x,-1)
  100000 loops, best of 3: 6.45 µs per loop
  sage: %timeit pow_generic(x,-1)
  100000 loops, best of 3: 6.85 µs per loop

  sage: %timeit pow(x,2)
  100000 loops, best of 3: 11.5 µs per loop
  sage: %timeit pow_generic(x,2)
  100000 loops, best of 3: 6.07 µs per loop

  sage: %timeit pow(x,50)
  1000 loops, best of 3: 844 µs per loop
  sage: %timeit pow_generic(x,50)
  10000 loops, best of 3: 80.2 µs per loop

  sage: %timeit pow(x,1000)
  10 loops, best of 3: 181 ms per loop
  sage: %timeit pow_generic(x,1000)
  1000 loops, best of 3: 1.04 ms per loop
  }}}

- __len__, ... all the calls to sorted_items suggest that some
  sorting is involved when this is not the case.

- order, rank, is_finite are identical in all the free
  (abelian) monoids/groups. Could we avoid the duplication?

FreeAbelianGroup:

- Element._mul_ could use sage.combinat.dict_addition

More later tonight!

Cheers,
                                 Nicolas



---

archive/issue_comments_192560.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-05T20:47:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192560",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_192561.json:
```json
{
    "body": "Back to work!\n\nI have been through the whole diff. Thanks for this big chunk of work!\nSome more comments:\n\nIndexedGenerators\n\n- Move to sage/structure\n\n- Detailed description of what the options do: this is probably best\n  done in the EXAMPLES section, with illustrations.\n\n- Avoid the duplication in the documentation for the print options,\n  (in CombinatorialFreeModule and IndexedGenerators). I probably would\n  put it in IndexedGenerators.\n\n- Side note: since the `cmp` function is phased out by Python 3, we\n  will have to start thinking about what would be the most natural way\n  to specify a total order in the context of Python 3.\n\nFreeAbelianMonoid / FreeMonoid:\n\n- Now or later: for consistency, could we use a class with\n  UniqueRepresentation and __classcall__ instead of a factory\n  function?\n\n  If you decide for later, please open a ticket. Same for the items below.\n\n- Now or later: `__repr__` -> `_repr_`, `__call__` ->\n  `_element_constructor_`. The custom `__contains__` might not be\n  needed.\n\n- Now or later: initialize the category\n\n- is_FreeAbelianMonoid will return False for an\n  IndexedFreeAbelianMonoid. Do we care?\n\n- cardinality should be 1 for n=0. Same for all the following\n  cardinality methods later in the diff\n\n- TODO: same docstring changes as in my commit (e.g. for the\n  description of 'abelian')\n\nIndexedMonoid:\n\n- The description is useful; I now see the point of `sorted_items`. We\n  should search for a better name though. In particular the\n  description \"Return the items (i.e terms) of ``self``, sorted for\n  printing.\"  is misleading, as it's not only used for printing.\n\n- Same remarks as for IndexedGroups.\n\n- cancel: shouldn't this be // ?\n\n- Special cases for converting 1 or testing equality with 1: don't\n  bother for new monoids. That's an ugly habit in Sage and we should\n  steer away of it.\n\n- In _element_constructor_:\n  - The following line is not needed; this is already taken care of by `__call__`:\n    {{{\n    if isinstance(x, IndexedFreeAbelianMonoidElement) and x.parent() is self:\n       return x\n    }}}\n\n  - Construction of the generator indexed by `i` with `F(i)`: I'd\n    rather not enable this unless users come crying loud for\n    it. F.gen(i) is fine, and it's just an endless can of worm since,\n    as you point out later, it can be ambiguous. Besides containment\n    testing can be expensive.\n\nIndexedFreeAbelianMonoid:\n\n- Add an example in `_element_constructor_` illustrating the construction from a dictionary.\n\n- Don't we want to always call dict on `x` so as to avoid a reference\n  effect in case of a dict, throw appropriate errors if it can't be\n  made into a dict, and accept, e.g. iterables?",
    "created_at": "2014-05-05T20:56:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192561",
    "user": "nthiery"
}
```

Back to work!

I have been through the whole diff. Thanks for this big chunk of work!
Some more comments:

IndexedGenerators

- Move to sage/structure

- Detailed description of what the options do: this is probably best
  done in the EXAMPLES section, with illustrations.

- Avoid the duplication in the documentation for the print options,
  (in CombinatorialFreeModule and IndexedGenerators). I probably would
  put it in IndexedGenerators.

- Side note: since the `cmp` function is phased out by Python 3, we
  will have to start thinking about what would be the most natural way
  to specify a total order in the context of Python 3.

FreeAbelianMonoid / FreeMonoid:

- Now or later: for consistency, could we use a class with
  UniqueRepresentation and __classcall__ instead of a factory
  function?

  If you decide for later, please open a ticket. Same for the items below.

- Now or later: `__repr__` -> `_repr_`, `__call__` ->
  `_element_constructor_`. The custom `__contains__` might not be
  needed.

- Now or later: initialize the category

- is_FreeAbelianMonoid will return False for an
  IndexedFreeAbelianMonoid. Do we care?

- cardinality should be 1 for n=0. Same for all the following
  cardinality methods later in the diff

- TODO: same docstring changes as in my commit (e.g. for the
  description of 'abelian')

IndexedMonoid:

- The description is useful; I now see the point of `sorted_items`. We
  should search for a better name though. In particular the
  description "Return the items (i.e terms) of ``self``, sorted for
  printing."  is misleading, as it's not only used for printing.

- Same remarks as for IndexedGroups.

- cancel: shouldn't this be // ?

- Special cases for converting 1 or testing equality with 1: don't
  bother for new monoids. That's an ugly habit in Sage and we should
  steer away of it.

- In _element_constructor_:
  - The following line is not needed; this is already taken care of by `__call__`:
    {{{
    if isinstance(x, IndexedFreeAbelianMonoidElement) and x.parent() is self:
       return x
    }}}

  - Construction of the generator indexed by `i` with `F(i)`: I'd
    rather not enable this unless users come crying loud for
    it. F.gen(i) is fine, and it's just an endless can of worm since,
    as you point out later, it can be ambiguous. Besides containment
    testing can be expensive.

IndexedFreeAbelianMonoid:

- Add an example in `_element_constructor_` illustrating the construction from a dictionary.

- Don't we want to always call dict on `x` so as to avoid a reference
  effect in case of a dict, throw appropriate errors if it can't be
  made into a dict, and accept, e.g. iterables?



---

archive/issue_comments_192562.json:
```json
{
    "body": "Remaining two questions about the user interface.\n\nCurrently, the arguments passed to construct a free * are:\n\n```\n    def free(n=None, names='x', index_set=None, ...):\n```\n\n\nHere is a proposal for a variant:\n\n```\n    def free(index_set=None, names=None, prefix='x', ...)\n```\n\nwhere:\n\n- `index_set=n` is a short hand for `index_set=[0,...,n-1]` (or the\n  equivalent `IntegerRange`?)\n- `index_set='x,y,z'` is a short hand for `names='x,y,z'`\n- `names` can either be a string like `'x,y,z'` or a list or iterables\n  of `names`.\n\nAdvantages:\n\n- This supports simultaneously `C.free(I)`, `C.free('x,y,z')`, and\n  `C.free(3)`, which are the most common use cases.\n\n- This still supports `F.<x,y,z> = C.free()`.\n\n- This is consistent with both `FreeModule(QQ, 3)` and\n  `CombinatorialFreeModule(QQ, I)`, as well as with the upcoming\n  `FreeModule(QQ,I)` which will call `IndexedFreeModule(QQ, I)`.\n\n- There is a clear distinction between the prefix and the names.\n  Otherwise `names='x'` is ambiguous: a singleton list of names, or a\n  prefix?\n\nSecond point: I am hesitant about the `abelian` argument. With #10963,\nI definitely would prefer:\n\n```\n    Groups().Commutative().free()\n```\n\nto\n\n```\n    Groups().free(abelian=True)\n```\n\n\nMaybe, as a more consistent temporary measure, we could use:\n\n```\n    Groups().free(commutative=True)\n```\n\n\nOnce the above is settled, I guess this ticket is good to go!\n\nCheers,\n                                 Nicolas",
    "created_at": "2014-05-05T21:23:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192562",
    "user": "nthiery"
}
```

Remaining two questions about the user interface.

Currently, the arguments passed to construct a free * are:

```
    def free(n=None, names='x', index_set=None, ...):
```


Here is a proposal for a variant:

```
    def free(index_set=None, names=None, prefix='x', ...)
```

where:

- `index_set=n` is a short hand for `index_set=[0,...,n-1]` (or the
  equivalent `IntegerRange`?)
- `index_set='x,y,z'` is a short hand for `names='x,y,z'`
- `names` can either be a string like `'x,y,z'` or a list or iterables
  of `names`.

Advantages:

- This supports simultaneously `C.free(I)`, `C.free('x,y,z')`, and
  `C.free(3)`, which are the most common use cases.

- This still supports `F.<x,y,z> = C.free()`.

- This is consistent with both `FreeModule(QQ, 3)` and
  `CombinatorialFreeModule(QQ, I)`, as well as with the upcoming
  `FreeModule(QQ,I)` which will call `IndexedFreeModule(QQ, I)`.

- There is a clear distinction between the prefix and the names.
  Otherwise `names='x'` is ambiguous: a singleton list of names, or a
  prefix?

Second point: I am hesitant about the `abelian` argument. With #10963,
I definitely would prefer:

```
    Groups().Commutative().free()
```

to

```
    Groups().free(abelian=True)
```


Maybe, as a more consistent temporary measure, we could use:

```
    Groups().free(commutative=True)
```


Once the above is settled, I guess this ticket is good to go!

Cheers,
                                 Nicolas



---

archive/issue_comments_192563.json:
```json
{
    "body": "Btw, I am wondering whether there would be a way to obtain, with minimum duplication of code, the additive versions? After all, it's just about the names of few methods (`_add_` vs `_mul_`, `intmul` vs `_pow_`,  `_neg_` vs `__invert__`).",
    "created_at": "2014-05-05T21:26:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192563",
    "user": "nthiery"
}
```

Btw, I am wondering whether there would be a way to obtain, with minimum duplication of code, the additive versions? After all, it's just about the names of few methods (`_add_` vs `_mul_`, `intmul` vs `_pow_`,  `_neg_` vs `__invert__`).



---

archive/issue_comments_192564.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-05-09T14:50:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192564",
    "user": "rws"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_192565.json:
```json
{
    "body": "patchbot:\n\n```\nsage -t --long src/sage/structure/sage_object.pyx  # 1 doctest failed\nsage -t --long src/sage/misc/indexed_generators.py  # 1 doctest failed\n```\n",
    "created_at": "2014-05-09T14:50:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192565",
    "user": "rws"
}
```

patchbot:

```
sage -t --long src/sage/structure/sage_object.pyx  # 1 doctest failed
sage -t --long src/sage/misc/indexed_generators.py  # 1 doctest failed
```




---

archive/issue_comments_192566.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-12T00:28:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192566",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_192567.json:
```json
{
    "body": "Fixed everything mentioned above except I've run into a *major* pickling issue with `UniqueFactory` (which is why I've cc-ed Simon).\n\nThere is some precedence for creating a generator from an index:\n\n```\nsage: C = CombinatorialFree\nModule(ZZ, ['a','b','c'])\nsage: C('a')\nB['a']\n```\n\nSo I'd like to leave that in for now. However I made things like `F(1)` only return `F[1]`.\n\nI changed the input for `Monoids().free(...)` but I left `FreeMonoid(...)` as I had it before because I don't want to deal with deprecations there in this ticket (this is #16330). I'll do the cleanup of the factory functions in the followup #16329.\n\nI'm not doing anything to `FreeMonoid` or `FreeAbelianMonoid` other than redirecting input, so I'm not going to make these changes here:\n\n> * Now or later: `__repr__ -> _repr_`, `__call__ -> _element_constructor_`. The custom `__contains__` might not be needed.\n> * Now or later: initialize the category\n\nWe could probably also fit that in #16329 or another followup.\n\nSimon, so I've changed the `UniqueFactory` object `FreeMonoid` to a new factory function since it returns a class which I've designed as a `UniqueRepresentation`. However unpickling old `FreeMonoid` objects fails because of the unpickling mechanism of `UniqueFactory` redirects to `generic_factory_unpickle()` and has `FreeMonoid` from the global namespace as the first object. It is expecting it to be a `UniqueFactory` instance, so it errors out here. Furthermore because of the structure of the pickle, I'm unable to use `register_unpickle_override` or see anyway to redirect that specific pickle without changing the behavior of `generic_factory_unpickle()`.\n\nI'm thinking the best thing to do is to change `generic_factory_unpickle()` to accept a general object as input and if the first input is no longer a `UniqueFactory`, then call it with the arguments given as part of the pickle. Another option I see is to override `UniqueFactory.__call__`, but I really don't want to do that. The last option I see, and I absolutely don't like this, is to make my new factory function into a different name temporarily (or deprecate `FreeMonoid` construction altogether).  Any ideas?\n\nI'm also thinking we should change this behavior so we don't keep running into this problem.",
    "created_at": "2014-05-12T00:40:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192567",
    "user": "tscrim"
}
```

Fixed everything mentioned above except I've run into a *major* pickling issue with `UniqueFactory` (which is why I've cc-ed Simon).

There is some precedence for creating a generator from an index:

```
sage: C = CombinatorialFree
Module(ZZ, ['a','b','c'])
sage: C('a')
B['a']
```

So I'd like to leave that in for now. However I made things like `F(1)` only return `F[1]`.

I changed the input for `Monoids().free(...)` but I left `FreeMonoid(...)` as I had it before because I don't want to deal with deprecations there in this ticket (this is #16330). I'll do the cleanup of the factory functions in the followup #16329.

I'm not doing anything to `FreeMonoid` or `FreeAbelianMonoid` other than redirecting input, so I'm not going to make these changes here:

> * Now or later: `__repr__ -> _repr_`, `__call__ -> _element_constructor_`. The custom `__contains__` might not be needed.
> * Now or later: initialize the category

We could probably also fit that in #16329 or another followup.

Simon, so I've changed the `UniqueFactory` object `FreeMonoid` to a new factory function since it returns a class which I've designed as a `UniqueRepresentation`. However unpickling old `FreeMonoid` objects fails because of the unpickling mechanism of `UniqueFactory` redirects to `generic_factory_unpickle()` and has `FreeMonoid` from the global namespace as the first object. It is expecting it to be a `UniqueFactory` instance, so it errors out here. Furthermore because of the structure of the pickle, I'm unable to use `register_unpickle_override` or see anyway to redirect that specific pickle without changing the behavior of `generic_factory_unpickle()`.

I'm thinking the best thing to do is to change `generic_factory_unpickle()` to accept a general object as input and if the first input is no longer a `UniqueFactory`, then call it with the arguments given as part of the pickle. Another option I see is to override `UniqueFactory.__call__`, but I really don't want to do that. The last option I see, and I absolutely don't like this, is to make my new factory function into a different name temporarily (or deprecate `FreeMonoid` construction altogether).  Any ideas?

I'm also thinking we should change this behavior so we don't keep running into this problem.



---

archive/issue_comments_192568.json:
```json
{
    "body": "Replying to [comment:36 tscrim]:\n> Fixed everything mentioned above except I've run into a *major* pickling issue with `UniqueFactory` (which is why I've cc-ed Simon).\n\nCool, thanks!\n\n> There is some precedence for creating a generator from an index:\n> {{{\n> sage: C = CombinatorialFree\n> Module(ZZ, ['a','b','c'])\n> sage: C('a')\n> B['a']\n> }}}\n> So I'd like to leave that in for now.\n\nPrecisely: we have made that mistake once, and been bitten by it. So\nI'd rather not redo it!\n\n> I changed the input for `Monoids().free(...)` but I left `FreeMonoid(...)` as I had it before because I don't want to deal with deprecations there in this ticket (this is #16330). I'll do the cleanup of the factory functions in the followup #16329.\n\nFair enough.\n\n> I'm not doing anything to `FreeMonoid` or `FreeAbelianMonoid` other than redirecting input, so I'm not going to make these changes here:\n> \n> > * Now or later: `__repr__ -> _repr_`, `__call__ -> _element_constructor_`. The custom `__contains__` might not be needed.\n> > * Now or later: initialize the category\n> \n> We could probably also fit that in #16329 or another followup.\n\nOk.\n\n> Simon, so I've changed the `UniqueFactory` object `FreeMonoid` to a new factory function since it returns a class which I've designed as a `UniqueRepresentation`. However unpickling old `FreeMonoid` objects fails because of the unpickling mechanism of `UniqueFactory` redirects to `generic_factory_unpickle()` and has `FreeMonoid` from the global namespace as the first object. It is expecting it to be a `UniqueFactory` instance, so it errors out here. Furthermore because of the structure of the pickle, I'm unable to use `register_unpickle_override` or see anyway to redirect that specific pickle without changing the behavior of `generic_factory_unpickle()`.\n> \n> I'm thinking the best thing to do is to change `generic_factory_unpickle()` to accept a general object as input and if the first input is no longer a `UniqueFactory`, then call it with the arguments given as part of the pickle. Another option I see is to override `UniqueFactory.__call__`, but I really don't want to do that. The last option I see, and I absolutely don't like this, is to make my new factory function into a different name temporarily (or deprecate `FreeMonoid` construction altogether).  Any ideas?\n> \n> I'm also thinking we should change this behavior so we don't keep running into this problem.\n\nMaybe, at least as a temporary solution, the FreeMonoid object from\nthe global namespace could remain a trivial factory function\ndelegating to a class, also called FreeMonoid, but in its own module?\n\nCheers,\n                                  Nicolas",
    "created_at": "2014-05-12T20:55:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192568",
    "user": "nthiery"
}
```

Replying to [comment:36 tscrim]:
> Fixed everything mentioned above except I've run into a *major* pickling issue with `UniqueFactory` (which is why I've cc-ed Simon).

Cool, thanks!

> There is some precedence for creating a generator from an index:
> {{{
> sage: C = CombinatorialFree
> Module(ZZ, ['a','b','c'])
> sage: C('a')
> B['a']
> }}}
> So I'd like to leave that in for now.

Precisely: we have made that mistake once, and been bitten by it. So
I'd rather not redo it!

> I changed the input for `Monoids().free(...)` but I left `FreeMonoid(...)` as I had it before because I don't want to deal with deprecations there in this ticket (this is #16330). I'll do the cleanup of the factory functions in the followup #16329.

Fair enough.

> I'm not doing anything to `FreeMonoid` or `FreeAbelianMonoid` other than redirecting input, so I'm not going to make these changes here:
> 
> > * Now or later: `__repr__ -> _repr_`, `__call__ -> _element_constructor_`. The custom `__contains__` might not be needed.
> > * Now or later: initialize the category
> 
> We could probably also fit that in #16329 or another followup.

Ok.

> Simon, so I've changed the `UniqueFactory` object `FreeMonoid` to a new factory function since it returns a class which I've designed as a `UniqueRepresentation`. However unpickling old `FreeMonoid` objects fails because of the unpickling mechanism of `UniqueFactory` redirects to `generic_factory_unpickle()` and has `FreeMonoid` from the global namespace as the first object. It is expecting it to be a `UniqueFactory` instance, so it errors out here. Furthermore because of the structure of the pickle, I'm unable to use `register_unpickle_override` or see anyway to redirect that specific pickle without changing the behavior of `generic_factory_unpickle()`.
> 
> I'm thinking the best thing to do is to change `generic_factory_unpickle()` to accept a general object as input and if the first input is no longer a `UniqueFactory`, then call it with the arguments given as part of the pickle. Another option I see is to override `UniqueFactory.__call__`, but I really don't want to do that. The last option I see, and I absolutely don't like this, is to make my new factory function into a different name temporarily (or deprecate `FreeMonoid` construction altogether).  Any ideas?
> 
> I'm also thinking we should change this behavior so we don't keep running into this problem.

Maybe, at least as a temporary solution, the FreeMonoid object from
the global namespace could remain a trivial factory function
delegating to a class, also called FreeMonoid, but in its own module?

Cheers,
                                  Nicolas



---

archive/issue_comments_192569.json:
```json
{
    "body": "The `FreeMonoid` in the global namespace must be the `UniqueFactory` instance for the old pickles to work, irregardless of which module or the name of the class. That's the big problem. Or are you suggesting to just leave `FreeMonoid` alone (or perhaps give it some warnings and redirections when given other types of input)?\n\nThere is one other thing I thought of today, to implement a custom unpickle override for `UniqueFactory`. I'm thinking this might be the best way to work around this (and could easily create this on a separate ticket). Thoughts?",
    "created_at": "2014-05-12T21:01:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192569",
    "user": "tscrim"
}
```

The `FreeMonoid` in the global namespace must be the `UniqueFactory` instance for the old pickles to work, irregardless of which module or the name of the class. That's the big problem. Or are you suggesting to just leave `FreeMonoid` alone (or perhaps give it some warnings and redirections when given other types of input)?

There is one other thing I thought of today, to implement a custom unpickle override for `UniqueFactory`. I'm thinking this might be the best way to work around this (and could easily create this on a separate ticket). Thoughts?



---

archive/issue_comments_192570.json:
```json
{
    "body": "Replying to [comment:38 tscrim]:\n> The `FreeMonoid` in the global namespace must be the `UniqueFactory` instance for the old pickles to work,\n\nYes. But this UniqueFactory instance can probably be a fake one and just act as a delegator\nto whichever new class now implements `FreeMonoid`.\n\n> There is one other thing I thought of today, to implement a custom unpickle override for `UniqueFactory`. I'm thinking this might be the best way to work around this (and could easily create this on a separate ticket). Thoughts?\n\nI am not sure I see what you mean, but I can live with that if someone\nelse answers :-)",
    "created_at": "2014-05-12T22:00:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192570",
    "user": "nthiery"
}
```

Replying to [comment:38 tscrim]:
> The `FreeMonoid` in the global namespace must be the `UniqueFactory` instance for the old pickles to work,

Yes. But this UniqueFactory instance can probably be a fake one and just act as a delegator
to whichever new class now implements `FreeMonoid`.

> There is one other thing I thought of today, to implement a custom unpickle override for `UniqueFactory`. I'm thinking this might be the best way to work around this (and could easily create this on a separate ticket). Thoughts?

I am not sure I see what you mean, but I can live with that if someone
else answers :-)



---

archive/issue_comments_192571.json:
```json
{
    "body": "Replying to [comment:39 nthiery]:\n> Replying to [comment:38 tscrim]:\n> > The `FreeMonoid` in the global namespace must be the `UniqueFactory` instance for the old pickles to work,\n> \n> Yes. But this UniqueFactory instance can probably be a fake one and just act as a delegator\n> to whichever new class now implements `FreeMonoid`.\n\nSo do you mean doing something like this:\n\n```python\nclass DummyFactory(UniqueFactory):\n    def __call__(self, *args, **kwds):\n        return factory_function(*args, **kwds)\n    def get_object(self, the, ..., args):\n        return OriginalFactoryInstance.get_object(the, ..., args)\n```\n\nand `DummyFactory` would become the object in the global namespace?",
    "created_at": "2014-05-12T22:06:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192571",
    "user": "tscrim"
}
```

Replying to [comment:39 nthiery]:
> Replying to [comment:38 tscrim]:
> > The `FreeMonoid` in the global namespace must be the `UniqueFactory` instance for the old pickles to work,
> 
> Yes. But this UniqueFactory instance can probably be a fake one and just act as a delegator
> to whichever new class now implements `FreeMonoid`.

So do you mean doing something like this:

```python
class DummyFactory(UniqueFactory):
    def __call__(self, *args, **kwds):
        return factory_function(*args, **kwds)
    def get_object(self, the, ..., args):
        return OriginalFactoryInstance.get_object(the, ..., args)
```

and `DummyFactory` would become the object in the global namespace?



---

archive/issue_comments_192572.json:
```json
{
    "body": "Yeah. Not sure it's a good idea though. Do as you feel is right.",
    "created_at": "2014-05-13T05:28:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192572",
    "user": "nthiery"
}
```

Yeah. Not sure it's a good idea though. Do as you feel is right.



---

archive/issue_comments_192573.json:
```json
{
    "body": "In order to checkout this ticket, I had to fix the list of dependencies (which is supposed to be comma-separated).",
    "created_at": "2014-05-13T09:14:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192573",
    "user": "SimonKing"
}
```

In order to checkout this ticket, I had to fix the list of dependencies (which is supposed to be comma-separated).



---

archive/issue_comments_192574.json:
```json
{
    "body": "Replying to [comment:36 tscrim]:\n> Simon, so I've changed the `UniqueFactory` object `FreeMonoid` to a new factory function since it returns a class which I've designed as a `UniqueRepresentation`. However unpickling old `FreeMonoid` objects fails because of the unpickling mechanism of `UniqueFactory` redirects to `generic_factory_unpickle()` and has `FreeMonoid` from the global namespace as the first object.\n\nFirst thing I wonder: *Why* is that statically typed? Just to shave off a little calling overhead?\n\n> It is expecting it to be a `UniqueFactory` instance, so it errors out here. Furthermore because of the structure of the pickle, I'm unable to use `register_unpickle_override` or see anyway to redirect that specific pickle without changing the behavior of `generic_factory_unpickle()`.\n\nI don't really understand how `register_unpickle_override` is working. It seems that it can only work if `unpickle_global` is involved---and it is not clear to me if this is involved everywhere or only if there is no `__reduce__` method around.\n\n> I'm thinking the best thing to do is to change `generic_factory_unpickle()` to accept a general object as input and if the first input is no longer a `UniqueFactory`, then call it with the arguments given as part of the pickle.\n\nMakes sense to me. And I even think the following idiom would not be slower in terms of calling overhead than the current implementation:\n\n```\ndef generic_factory_unpickle(factory, *args):\n    cdef UniqueFactory F\n    try:\n        F = factory\n    except TypeError:\n        return factory(*args[1:])\n    return F.get_object(*args)\n```\n\n\nNote that I wrote `factory(*args[1:])`, since the first argument is the version information. So, either we need to shave it off here, or the new class (or function) replacing the old factory is required to take care of this.\n\n> I'm also thinking we should change this behavior so we don't keep running into this problem.\n\nI think with my suggestion above, unpickling of using factory would work as quickly as it used to, and it would relatively easily allow to replace the factory by something else (provided that this \"something else\" takes care of the argument mangling and the version information that is involved in the factory pickle).",
    "created_at": "2014-05-13T09:35:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192574",
    "user": "SimonKing"
}
```

Replying to [comment:36 tscrim]:
> Simon, so I've changed the `UniqueFactory` object `FreeMonoid` to a new factory function since it returns a class which I've designed as a `UniqueRepresentation`. However unpickling old `FreeMonoid` objects fails because of the unpickling mechanism of `UniqueFactory` redirects to `generic_factory_unpickle()` and has `FreeMonoid` from the global namespace as the first object.

First thing I wonder: *Why* is that statically typed? Just to shave off a little calling overhead?

> It is expecting it to be a `UniqueFactory` instance, so it errors out here. Furthermore because of the structure of the pickle, I'm unable to use `register_unpickle_override` or see anyway to redirect that specific pickle without changing the behavior of `generic_factory_unpickle()`.

I don't really understand how `register_unpickle_override` is working. It seems that it can only work if `unpickle_global` is involved---and it is not clear to me if this is involved everywhere or only if there is no `__reduce__` method around.

> I'm thinking the best thing to do is to change `generic_factory_unpickle()` to accept a general object as input and if the first input is no longer a `UniqueFactory`, then call it with the arguments given as part of the pickle.

Makes sense to me. And I even think the following idiom would not be slower in terms of calling overhead than the current implementation:

```
def generic_factory_unpickle(factory, *args):
    cdef UniqueFactory F
    try:
        F = factory
    except TypeError:
        return factory(*args[1:])
    return F.get_object(*args)
```


Note that I wrote `factory(*args[1:])`, since the first argument is the version information. So, either we need to shave it off here, or the new class (or function) replacing the old factory is required to take care of this.

> I'm also thinking we should change this behavior so we don't keep running into this problem.

I think with my suggestion above, unpickling of using factory would work as quickly as it used to, and it would relatively easily allow to replace the factory by something else (provided that this "something else" takes care of the argument mangling and the version information that is involved in the factory pickle).



---

archive/issue_comments_192575.json:
```json
{
    "body": "PS: The documentation breaks. After repeated attempts of `make doc-clean` and `make`, I keep getting\n\n```\nOSError: [misc     ] /home/king/Sage/git/sage/src/doc/en/reference/misc/sage/misc/indexed_generators.rst:11: WARNING: autodoc can't import/find module 'sage.misc.indexed_generators', it reported error: \"No module named indexed_generators\", please check your spelling and sys.path\n```\n",
    "created_at": "2014-05-13T09:37:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192575",
    "user": "SimonKing"
}
```

PS: The documentation breaks. After repeated attempts of `make doc-clean` and `make`, I keep getting

```
OSError: [misc     ] /home/king/Sage/git/sage/src/doc/en/reference/misc/sage/misc/indexed_generators.rst:11: WARNING: autodoc can't import/find module 'sage.misc.indexed_generators', it reported error: "No module named indexed_generators", please check your spelling and sys.path
```




---

archive/issue_comments_192576.json:
```json
{
    "body": "This is now #16349. Try `sage -sync-build` (there's probably the old file in the lib build folder which is getting picked up).",
    "created_at": "2014-05-13T15:44:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192576",
    "user": "tscrim"
}
```

This is now #16349. Try `sage -sync-build` (there's probably the old file in the lib build folder which is getting picked up).



---

archive/issue_comments_192577.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-15T22:18:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192577",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_192578.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-05-15T22:36:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192578",
    "user": "tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_192579.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-16T19:50:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192579",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_192580.json:
```json
{
    "body": "Sorry that actually is my fault, I forgot to move the file over in the doc `index.rst` files.",
    "created_at": "2014-05-16T19:51:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192580",
    "user": "tscrim"
}
```

Sorry that actually is my fault, I forgot to move the file over in the doc `index.rst` files.



---

archive/issue_comments_192581.json:
```json
{
    "body": "\n```\n    AttributeError: 'FreeAbelianMonoid_class' object has no attribute 'monoid_generators'\n**********************************************************************\n6 items had failures:\n   3 of   7 in sage.monoids.indexed_free_monoid.IndexedFreeMonoidElement.__init__\n   1 of   8 in sage.monoids.indexed_free_monoid.IndexedMonoid.__classcall__\n   1 of   9 in sage.monoids.indexed_free_monoid.IndexedMonoid.__init__\n   1 of   5 in sage.monoids.indexed_free_monoid.IndexedMonoid._an_element_\n   1 of   5 in sage.monoids.indexed_free_monoid.IndexedMonoid.monoid_generators\n   3 of  11 in sage.monoids.indexed_free_monoid.IndexedMonoidElement.__init__\n    [213 tests, 10 failures, 0.29 s]\n----------------------------------------------------------------------\nsage -t src/sage/monoids/indexed_free_monoid.py  # 10 doctests failed\n```\n",
    "created_at": "2014-05-20T05:32:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192581",
    "user": "rws"
}
```


```
    AttributeError: 'FreeAbelianMonoid_class' object has no attribute 'monoid_generators'
**********************************************************************
6 items had failures:
   3 of   7 in sage.monoids.indexed_free_monoid.IndexedFreeMonoidElement.__init__
   1 of   8 in sage.monoids.indexed_free_monoid.IndexedMonoid.__classcall__
   1 of   9 in sage.monoids.indexed_free_monoid.IndexedMonoid.__init__
   1 of   5 in sage.monoids.indexed_free_monoid.IndexedMonoid._an_element_
   1 of   5 in sage.monoids.indexed_free_monoid.IndexedMonoid.monoid_generators
   3 of  11 in sage.monoids.indexed_free_monoid.IndexedMonoidElement.__init__
    [213 tests, 10 failures, 0.29 s]
----------------------------------------------------------------------
sage -t src/sage/monoids/indexed_free_monoid.py  # 10 doctests failed
```




---

archive/issue_comments_192582.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-05-20T05:32:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192582",
    "user": "rws"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_192583.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-20T05:49:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192583",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_192584.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-05-20T05:50:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192584",
    "user": "tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_192585.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-26T04:03:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192585",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_192586.json:
```json
{
    "body": "Hi Travis,\n\nSorry for being slow once again. Unless I missed it, you haven't commented on my suggestions for:\n- Using `dict_addition` whenever meaningful\n- Implementing `Groups().Commutative().free()` rather than `Groups().free(commutative=True)` now that #10963 is in (I can do that if you want)\n- Putting index_set as first argument to the `free` methods to make the following work properly:\n   {{{\n       sage: C.free([1,2,3])\n       Free monoid indexed by None\n   }}}\n  By the way, with no argument there should either be some reasonable default, or an error:\n   {{{\n       sage: C.free()\n       Free monoid indexed by None\n   }}}\n- Construction of the generators by `F(i)` (see [comment:37]).\n- [comment:32]\n\nCheers,\n                              Nicolas",
    "created_at": "2014-06-10T10:20:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192586",
    "user": "nthiery"
}
```

Hi Travis,

Sorry for being slow once again. Unless I missed it, you haven't commented on my suggestions for:
- Using `dict_addition` whenever meaningful
- Implementing `Groups().Commutative().free()` rather than `Groups().free(commutative=True)` now that #10963 is in (I can do that if you want)
- Putting index_set as first argument to the `free` methods to make the following work properly:
   {{{
       sage: C.free([1,2,3])
       Free monoid indexed by None
   }}}
  By the way, with no argument there should either be some reasonable default, or an error:
   {{{
       sage: C.free()
       Free monoid indexed by None
   }}}
- Construction of the generators by `F(i)` (see [comment:37]).
- [comment:32]

Cheers,
                              Nicolas



---

archive/issue_comments_192587.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-06-11T03:18:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192587",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_192588.json:
```json
{
    "body": "Hey Nicolas,\n\nThanks for getting back to this ticket. I know how hard it can be to find time.\n\nReplying to [comment:55 nthiery]:\n> - Using `dict_addition` whenever meaningful\n\nDone.\n\n> - Implementing `Groups().Commutative().free()` rather than `Groups().free(commutative=True)` now that #10963 is in (I can do that if you want)\n\nDone (now that #10963 is in; big yay!). I also cleaned up some of the logic and made the `*.free()` always return the indexed monoid/group except for `Groups.free(n, names)` since IMO (perhaps not-so-humble) the indexed version is better since it's a proper parent and more general. I can revert this if desired.\n\n> - Putting index_set as first argument to the `free` methods to make the following work properly:\n>    {{{\n>        sage: C.free([1,2,3])\n>        Free monoid indexed by None\n>    }}}\n\nI had missed this somehow for monoids (but I had done it for groups).\n\n>   By the way, with no argument there should either be some reasonable default, or an error:\n>    {{{\n>        sage: C.free()\n>        Free monoid indexed by None\n>    }}}\n\nNow it raises an error.\n\n> - Construction of the generators by `F(i)` (see [comment:37]).\n\nI've made it a forbidden construction.\n\n> - [comment:32]\n\nI think we should just use `CombinatorialFreeModule` over `ZZ` for this, or do you think it would be too heavy-handed? However I don't think it would be difficult to do (following your comment).\n\nBest,\n\nTravis",
    "created_at": "2014-06-11T03:27:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192588",
    "user": "tscrim"
}
```

Hey Nicolas,

Thanks for getting back to this ticket. I know how hard it can be to find time.

Replying to [comment:55 nthiery]:
> - Using `dict_addition` whenever meaningful

Done.

> - Implementing `Groups().Commutative().free()` rather than `Groups().free(commutative=True)` now that #10963 is in (I can do that if you want)

Done (now that #10963 is in; big yay!). I also cleaned up some of the logic and made the `*.free()` always return the indexed monoid/group except for `Groups.free(n, names)` since IMO (perhaps not-so-humble) the indexed version is better since it's a proper parent and more general. I can revert this if desired.

> - Putting index_set as first argument to the `free` methods to make the following work properly:
>    {{{
>        sage: C.free([1,2,3])
>        Free monoid indexed by None
>    }}}

I had missed this somehow for monoids (but I had done it for groups).

>   By the way, with no argument there should either be some reasonable default, or an error:
>    {{{
>        sage: C.free()
>        Free monoid indexed by None
>    }}}

Now it raises an error.

> - Construction of the generators by `F(i)` (see [comment:37]).

I've made it a forbidden construction.

> - [comment:32]

I think we should just use `CombinatorialFreeModule` over `ZZ` for this, or do you think it would be too heavy-handed? However I don't think it would be difficult to do (following your comment).

Best,

Travis



---

archive/issue_comments_192589.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-06-20T23:26:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192589",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_192590.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-07-01T16:11:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192590",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_192591.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-07-01T16:25:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192591",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_192592.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-07-01T16:37:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192592",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_192593.json:
```json
{
    "body": "I checked the recent commits, and we have been discussing side by side for the last ones today. doc and pdf doc compiles. Positive review assuming all long tests pass (running them now).\n\nThanks Travis!\n\nCheers,\n                          Nicolas",
    "created_at": "2014-07-01T17:20:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192593",
    "user": "nthiery"
}
```

I checked the recent commits, and we have been discussing side by side for the last ones today. doc and pdf doc compiles. Positive review assuming all long tests pass (running them now).

Thanks Travis!

Cheers,
                          Nicolas



---

archive/issue_comments_192594.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-07-01T17:20:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192594",
    "user": "nthiery"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_192595.json:
```json
{
    "body": "Thank you for doing the review Nicolas.",
    "created_at": "2014-07-01T17:23:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192595",
    "user": "tscrim"
}
```

Thank you for doing the review Nicolas.



---

archive/issue_comments_192596.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2014-07-01T17:47:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192596",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_192597.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2014-07-01T17:47:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192597",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_192598.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-07-01T17:48:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192598",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_192599.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-07-03T02:03:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192599",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_192600.json:
```json
{
    "body": "Hi guys, please see http://ask.sagemath.org/question/25763/incorrect-parsing-of-docstring-of-sagestructureindexed_generatorsindexedgenerators/ where it seems that putting `\"\\left\"` becomes something quite different in html.  I assume this is not desired; see #17745.",
    "created_at": "2015-02-08T02:43:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15052#issuecomment-192600",
    "user": "kcrisman"
}
```

Hi guys, please see http://ask.sagemath.org/question/25763/incorrect-parsing-of-docstring-of-sagestructureindexed_generatorsindexedgenerators/ where it seems that putting `"\left"` becomes something quite different in html.  I assume this is not desired; see #17745.
