# Issue 33079: Drop support for GCC < 6.3 in Sage 9.7

Issue created by migration from https://trac.sagemath.org/ticket/33316

Original creator: mkoeppe

Original creation time: 2022-02-08 21:21:18

CC:  dimpase @kliem

(see Meta-ticket #32074: Remove support for outdated distros)

This ticket can be used as a dependency for upgrade tickets that impose stricter compiler requirements.



---

Comment by git created at 2022-02-08 22:07:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-04-20 23:33:28

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2022-04-20 23:40:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-04-21 00:14:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-04-21 06:13:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-04-29 00:46:43

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2022-04-29 04:26:19

On `ubuntu-trusty-toolchain-gcc_9-minimal` (https://github.com/mkoeppe/sage/runs/6221011844) and `-standard`, `nauty`, `ecm`, `ntl` fail with 
`Error: operand size mismatch for `vmovdqa64'` or `Error: operand size mismatch for `vmovdqu64'`; and `fflas_ffpack` fails with many different `operand size mismatch` errors.


---

Comment by @kliem created at 2022-04-30 17:20:58

I'm guessing the problem is in https://github.com/linbox-team/fflas-ffpack/blob/b51626baf2715c8b8bcb0c334856b204f9a4a901/fflas-ffpack/fflas/fflas_simd/simd512_double.inl

They are calling `_mm512_and_pd` with `const __mm512d` instead of just `__m512d`. The problem should mostly go away, because stuff is inlined, but it might fail with g++ 9.

It seems to work with g++ 11.3.0 for me. At least I cannot reproduce the bug, even though I have available the `avx512...` instructions. But then again, it works for the other workflows, so this doesn't seem to be a problem in other cases. Just in the `toolchain-gcc_9-minimal` workflow.

Can we configure `fflas_ffpack` with `--disable-avx512dq` in this case?


---

Comment by mkoeppe created at 2022-05-01 01:57:29

I'll try first if installing `binutils-2.26` (and setting `PATH="/usr/lib/binutils-2.26/bin:$PATH"`) helps.


---

Comment by git created at 2022-05-02 22:43:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-05-03 03:47:26

Replying to [comment:15 mkoeppe]:
> I'll try first if installing `binutils-2.26` (and setting `PATH="/usr/lib/binutils-2.26/bin:$PATH"`) helps. 

It seems to work. Ready for review


---

Comment by git created at 2022-05-03 06:31:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @kliem created at 2022-05-09 10:22:05

Changing status from needs_review to positive_review.


---

Comment by @kliem created at 2022-05-09 10:22:05

LGTM.


---

Comment by mkoeppe created at 2022-05-09 17:43:01

Thank you!


---

Comment by vbraun created at 2022-05-22 09:56:56

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2022-05-22 09:56:56

If configure doesn't find a supported version we should just install it instead of giving users instructions for other configure flags:

```
configure: error: 
    Given --with-system-gcc=force, but no system package could be used.
    That's an error.  Please install the indicated package to continue.
    (To override this error, use ./configure --without-system-gcc)
```



---

Comment by dimpase created at 2022-05-22 11:00:39

Replying to [comment:22 vbraun]:
> If configure doesn't find a supported version we should just install it instead of giving users instructions for other configure flags:
> {{{
> configure: error: 
>     Given --with-system-gcc=force, but no system package could be used.
>     That's an error.  Please install the indicated package to continue.
>     (To override this error, use ./configure --without-system-gcc)
> }}}

Volker, it is not a bug, it is how `=force`  option is meant to be.


---

Comment by dimpase created at 2022-05-22 11:00:39

Changing status from needs_work to positive_review.


---

Comment by mkoeppe created at 2022-05-22 11:32:13

For reference, this behavior was implemented in #32060.


---

Comment by vbraun created at 2022-05-22 16:36:56

Breaks the Debian 9 buildbot, we can merge this after I get around to update the buildbot config


---

Comment by vbraun created at 2022-05-22 16:36:56

Changing status from positive_review to needs_work.


---

Comment by mkoeppe created at 2022-05-22 16:39:17

Changing status from needs_work to positive_review.


---

Comment by mkoeppe created at 2022-05-22 16:39:17

See #32074 - we're dropping support for Debian 9.


---

Comment by vbraun created at 2022-05-22 16:39:45

Debian 9 is still LTS


---

Comment by mkoeppe created at 2022-05-22 16:43:00

Replying to [comment:26 mkoeppe]:
> See #32074 - we're dropping support for Debian 9.

Sorry, I was off by one. Debian 9 is fine. What's the problem on your buildbot?


---

Comment by mkoeppe created at 2022-05-22 16:44:03

Changing status from positive_review to needs_work.


---

Comment by mkoeppe created at 2022-05-22 16:44:03

so needs_work but not on the ticket


---

Comment by dimpase created at 2022-05-22 21:23:44

Replying to [comment:27 vbraun]:
> Debian 9 is still LTS 

but only till 01.07.2022, so we should be dropping it in 9.7, I guess.


---

Comment by mkoeppe created at 2022-05-24 01:06:58

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2022-06-13 18:15:21

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2022-06-13 18:15:21

Merge failure on top of:

08609a40ad Trac #33829: sage.graphs: Do not use SAGE_TMP in doctests

eca52b24ab Trac #33922: Add missing title to conf.py

e9bfcd2dd8 Trac #33980: codespell in graphs: fix a few typos

28f70e0932 Trac #31153: Fix latex of elements of multivariate polynomial quotient ring

b36c11c5d7 Trac #33983: sage_setup: Add missing dependency

6edac51d8b Trac #33970: Remove a period sneaked in the documentation website

6d60bf357f Trac #33977: fix pycodestyle E306 in geometry and schemes

edd7a74ed3 Trac #33976: some pycodestyle fixes in pxd and pxi files

b0973afaa7 Trac #33975: get rid of commented old-style prints

b3d6a0b8ff Trac #33956: some better .join with iterator inside

a33f2df893 Trac #33949: get rid of have_ring option in singular interface

ad1c3ac34f Trac #33946: fix pycodestyle E306 in rings and algebras

4942ca958b Trac #33945: fix pycodestyle E306 outside of algebras,rings,graphs,schemes,categories

8dad9ce80f Trac #30683: Nu Tamari

346b3b04a5 Trac #33968: Replace $...$ in docstrings by `...`

f793558dd1 Trac #33967: sage -t: Print git commit hash and SAGE_LOCAL, SAGE_VENV

0e48fececd Trac #33963: wrong sign for symbolic Legendre polynomial at 0

34d562ee2b Trac #33962: wrong sign for value of Legendre polynomial at 0

bd33f87651 Trac #33961: compute square roots modulo powers of two in polynomial time

16af958d67 Trac #33940: enhance maple interface

8d921a4996 Trac #33872: Upgrade memory allocator to 0.1.3

29499f89e2 Trac #33871: Don't run singular in spkg-configure.m4 when cross compiling

4cc978b96c Trac #33823: sage -t --optional='sage,!FEATURE'

6b6f0cf0f4 Trac #33776: move method distance_graph to graph.py

65e866a5b1 Trac #23443: More Schubert polynomial shenanigans

a6e696e91d Updated [SageMath](SageMath) version to 9.7.beta2



merge was not clean: conflicts in .github/workflows/tox.yml


---

Comment by git created at 2022-06-13 18:29:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-06-13 18:29:37

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2022-06-19 15:24:40

Resolution: fixed
