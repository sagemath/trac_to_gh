# Issue 11016: Make testcc.sh exit with an exit code of 1 if attempting to compile a file fails.

Issue created by migration from https://trac.sagemath.org/ticket/11169

Original creator: drkirkby

Original creation time: 2011-04-10 21:06:11

CC:  jhpalmieri mkoeppe @kliem

The script `$SAGE_LOCAL/bin/testcc.sh` checks to see what C compiler the environment variable `$CC` is. But currently the script always exits with a 0, even if an error occurs. 

This patch will correct that. 

Note some forms of error will not be detected. If CC is defined as `ls`, then the code will try to list the C file, which will succeed without error. But the changes will allow one to check if a compiler is installed or not. 


```
drkirkby@hawk:~$ export CC=cc
drkirkby@hawk:~$ sage-4.7.alpha3/local/bin/testcc.sh $CC
Sun_Studio
drkirkby@hawk:~$ export CC=gcc
drkirkby@hawk:~$ sage-4.7.alpha3/local/bin/testcc.sh $CC
GCC
drkirkby@hawk:~$ export CC=junk
drkirkby@hawk:~$ sage-4.7.alpha3/local/bin/testcc.sh $CC
Error - junk is not compiling a C file properly
```


Since the `testcc.sh` script is not under revision control, the attached file just needs to replace the one currently in Sage. The patch is for review purposes only.


---

Comment by drkirkby created at 2011-04-10 22:01:37

Changing status from new to needs_review.


---

Comment by drkirkby created at 2011-04-10 22:01:37

Changing type from PLEASE CHANGE to defect.


---

Comment by mariah created at 2011-05-25 13:56:49

Where is test.cc used?  It does not seem to be used by prereq-0.9 in sage-4.7.rc4.


---

Comment by mariah created at 2011-05-25 13:56:49

Changing status from needs_review to needs_info.


---

Comment by was created at 2011-08-24 23:47:21

Changing keywords from "" to "sd32".


---

Comment by drkirkby created at 2012-01-31 23:10:59

Changing status from needs_info to needs_review.


---

Comment by drkirkby created at 2012-01-31 23:10:59

Replying to [comment:2 mariah]:
> Where is test.cc used?  It does not seem to be used by prereq-0.9 in sage-4.7.rc4.

Some of the .spkg's use it. Not many I must admit, but a few do, mainly in an attempt to support the Sun (now Oracle) compiler, but it might be used for AIX/HP-UX too. 

It would be worth fixing this bug. It might be sensible to add support for 'clang' to this script later, although since that's supposed to be compatible with gcc, perhaps it's not needed.


---

Attachment


---

Comment by jdemeyer created at 2012-04-02 10:08:34

I'm not entirely sure this patch is a good idea.  How universal is the command line option "-E" to run the preprocessor?


---

Comment by jdemeyer created at 2012-04-02 10:08:34

Changing status from needs_review to needs_info.


---

Comment by chapoton created at 2020-04-26 19:22:08

is this ancient ticket now obsolete ?


---

Comment by chapoton created at 2020-04-26 19:22:08

Changing status from needs_info to needs_review.


---

Comment by @kliem created at 2020-04-27 19:07:06

I agree that this is invalid.

Currently, there is no use case for this ticket. We only use `local/bin/testcc.sh` to check whether or not a compiler is `GCC` or `Sun_Studio` or `HP_on_HP-UX`. It is never used to check whether or not a compiler is suitable for anything.


---

Comment by @kliem created at 2020-04-27 19:07:06

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2020-04-27 19:22:28

Resolution: invalid
