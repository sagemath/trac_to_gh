# Issue 30985: Many integrals fail now using sagemath 9.2 using giac algorithm

archive/issues_030985.json:
```json
{
    "body": "CC:  @fchapoton @EmmanuelCharpentier @frederichan-IMJPRG @mwageringel @nasser1 @slel\n\nKeywords: integrate,giac,interface\n\nHello. I am woking on a new build and new reports for CAS integration tests [https://www.12000.org/my_notes/CAS_integration_tests/index.htm](https://www.12000.org/my_notes/CAS_integration_tests/index.htm). \n\nNow using sagemath 9.2 on Linux to test thousands of integrals using fricas, maxima and giac among other CAS systems.\n\nI found that hundreds of integrals now fail when using giac version 1.6, which all work on giac itself, and also which all worked using sagemath 8.9 using giac 1.5 which I did last year.\n\nIt fails either by now hanging or not evaluating. The ones that hang in sagemath, complete immediately in giac. \n\nSince there so many integrals that now fail, I will only show few examples below. Hopefully the cause of the failure is the same for all. If not, I can provide more examples.\n\n**Example 1, do not evaluate any more**\n\n```\n>sage\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 SageMath version 9.2, Release Date: 2020-10-24                     \u2502\n\u2502 Using Python 3.8.6. Type \"help()\" for help.                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\nsage: x,a = var('x a')\nsage: integrate(sin(2*x)/(a^2-4*sin(x)^2)^(1/3),x, algorithm=\"giac\")\nintegrate(sin(2*x)/(a^2 - 4*sin(x)^2)^(1/3), x)\nsage: \n\nUsing giac directly\n\n>giac\n// Using locale /usr/share/locale/\n// en_US.utf8\n// /usr/share/locale/\n// giac\n// UTF-8\n// Maximum number of parallel threads 2\nHelp file /usr/share/giac/doc/en/aide_cas not found\nAdded 26 synonyms\nWelcome to giac readline interface\n(c) 2001,2020 B. Parisse & others\nHomepage http://www-fourier.ujf-grenoble.fr/~parisse/giac.html\nReleased under the GPL license 3.0 or above\nSee http://www.gnu.org for license details\nMay contain BSD licensed software parts (lapack, atlas, tinymt)\n-------------------------------------------------\nPress CTRL and D simultaneously to finish session\nType ?commandname for help\n0>> integrate(sin(2*x)/(a^2-4*sin(x)^2)^(1/3),x)\n-3/4*((a^2-2*(-2*cos(2*x)/2+1))^(1/3))^2/2\n// Time 0.01\n1>> \n\n```\n\n**Example 2. Hangs now in sagemath**\n\n\n```\nsage: x,a,b = var('x a b')\nsage: integrate(x^(5/2)/(b*x+a)^(5/2),x, algorithm=\"giac\")\n\n\nWhile in giac, completes right away\n\n>> integrate(x^(5/2)/(b*x+a)^(5/2),x)\n2*(2*((9*b^4*a*1/36/b^5/a*sqrt(x)*sqrt(x)+60*b^3*a^2*1/36/b^5/a)*sqrt(x)*sqrt(x)+45*b^2*a^3*1/36/b^5/a)*sqrt(x)*sqrt(a+b*x)/(a+b*x)^2+10*a/4/b^3/sqrt(b)*ln(abs(sqrt(a+b*x)-sqrt(b)*sqrt(x))))\n// Time 0.02\n\n\n```\n\n\n**Example 3, hangs**\n\n\n```\n\nintegrate(x^(3/2)/(b*x+a)^(5/2),x, algorithm=\"giac\")\n\nUsing giac directly, it completes right away\n\n14>> integrate(x^(3/2)/(b*x+a)^(5/2),x)\n2*(2*(-12*b^2*a*1/18/b^3/a*sqrt(x)*sqrt(x)-9*b*a^2*1/18/b^3/a)*sqrt(x)*sqrt(a+b*x)/(a+b*x)^2-1/b^2/sqrt(b)*ln(abs(sqrt(a+b*x)-sqrt(b)*sqrt(x))))\n// Time 0.03\n\n```\n\nMost of the ones that fail now looks like due to hang. But also some fail because the integral do not evaluate in sagemath, but it does using giac directly.\n\n**Version information**\n\n\n```\nwhich giac\n/bin/giac\n>\n>\n>giac --version\n// Using locale /usr/share/locale/\n// en_US.utf8\n// /usr/share/locale/\n// giac\n// UTF-8\n// Maximum number of parallel threads 2\n// (c) 2001, 2018 B. Parisse & others\n1.6.0\n>\n>\n\n\n>which sage\n/bin/sage\n>sage --version\nSageMath version 9.2, Release Date: 2020-10-24\n>\n\n>which sage\n/bin/sage\n>sage --version\nSageMath version 9.2, Release Date: 2020-10-24\n>\n\n\n```\n\nBecause of this, I stopped the tests. And will wait for next version of sagemath, hopefully it have a fix for this, as giac result are now looking not good due to this.\n\nPlease feel free to add any fields for the ticket if needed. I filled the ones I know about. \n\nThank you,\n--Nasser\n\nIssue created by migration from https://trac.sagemath.org/ticket/31222\n\n",
    "created_at": "2021-01-10T19:26:52Z",
    "labels": [
        "component: symbolics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Many integrals fail now using sagemath 9.2 using giac algorithm",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30985",
    "user": "https://github.com/nasser1"
}
```
CC:  @fchapoton @EmmanuelCharpentier @frederichan-IMJPRG @mwageringel @nasser1 @slel

Keywords: integrate,giac,interface

Hello. I am woking on a new build and new reports for CAS integration tests [https://www.12000.org/my_notes/CAS_integration_tests/index.htm](https://www.12000.org/my_notes/CAS_integration_tests/index.htm). 

Now using sagemath 9.2 on Linux to test thousands of integrals using fricas, maxima and giac among other CAS systems.

I found that hundreds of integrals now fail when using giac version 1.6, which all work on giac itself, and also which all worked using sagemath 8.9 using giac 1.5 which I did last year.

It fails either by now hanging or not evaluating. The ones that hang in sagemath, complete immediately in giac. 

Since there so many integrals that now fail, I will only show few examples below. Hopefully the cause of the failure is the same for all. If not, I can provide more examples.

**Example 1, do not evaluate any more**

```
>sage
┌────────────────────────────────────────────────────────────────────┐
│ SageMath version 9.2, Release Date: 2020-10-24                     │
│ Using Python 3.8.6. Type "help()" for help.                        │
└────────────────────────────────────────────────────────────────────┘
sage: x,a = var('x a')
sage: integrate(sin(2*x)/(a^2-4*sin(x)^2)^(1/3),x, algorithm="giac")
integrate(sin(2*x)/(a^2 - 4*sin(x)^2)^(1/3), x)
sage: 

Using giac directly

>giac
// Using locale /usr/share/locale/
// en_US.utf8
// /usr/share/locale/
// giac
// UTF-8
// Maximum number of parallel threads 2
Help file /usr/share/giac/doc/en/aide_cas not found
Added 26 synonyms
Welcome to giac readline interface
(c) 2001,2020 B. Parisse & others
Homepage http://www-fourier.ujf-grenoble.fr/~parisse/giac.html
Released under the GPL license 3.0 or above
See http://www.gnu.org for license details
May contain BSD licensed software parts (lapack, atlas, tinymt)
-------------------------------------------------
Press CTRL and D simultaneously to finish session
Type ?commandname for help
0>> integrate(sin(2*x)/(a^2-4*sin(x)^2)^(1/3),x)
-3/4*((a^2-2*(-2*cos(2*x)/2+1))^(1/3))^2/2
// Time 0.01
1>> 

```

**Example 2. Hangs now in sagemath**


```
sage: x,a,b = var('x a b')
sage: integrate(x^(5/2)/(b*x+a)^(5/2),x, algorithm="giac")


While in giac, completes right away

>> integrate(x^(5/2)/(b*x+a)^(5/2),x)
2*(2*((9*b^4*a*1/36/b^5/a*sqrt(x)*sqrt(x)+60*b^3*a^2*1/36/b^5/a)*sqrt(x)*sqrt(x)+45*b^2*a^3*1/36/b^5/a)*sqrt(x)*sqrt(a+b*x)/(a+b*x)^2+10*a/4/b^3/sqrt(b)*ln(abs(sqrt(a+b*x)-sqrt(b)*sqrt(x))))
// Time 0.02


```


**Example 3, hangs**


```

integrate(x^(3/2)/(b*x+a)^(5/2),x, algorithm="giac")

Using giac directly, it completes right away

14>> integrate(x^(3/2)/(b*x+a)^(5/2),x)
2*(2*(-12*b^2*a*1/18/b^3/a*sqrt(x)*sqrt(x)-9*b*a^2*1/18/b^3/a)*sqrt(x)*sqrt(a+b*x)/(a+b*x)^2-1/b^2/sqrt(b)*ln(abs(sqrt(a+b*x)-sqrt(b)*sqrt(x))))
// Time 0.03

```

Most of the ones that fail now looks like due to hang. But also some fail because the integral do not evaluate in sagemath, but it does using giac directly.

**Version information**


```
which giac
/bin/giac
>
>
>giac --version
// Using locale /usr/share/locale/
// en_US.utf8
// /usr/share/locale/
// giac
// UTF-8
// Maximum number of parallel threads 2
// (c) 2001, 2018 B. Parisse & others
1.6.0
>
>


>which sage
/bin/sage
>sage --version
SageMath version 9.2, Release Date: 2020-10-24
>

>which sage
/bin/sage
>sage --version
SageMath version 9.2, Release Date: 2020-10-24
>


```

Because of this, I stopped the tests. And will wait for next version of sagemath, hopefully it have a fix for this, as giac result are now looking not good due to this.

Please feel free to add any fields for the ticket if needed. I filled the ones I know about. 

Thank you,
--Nasser

Issue created by migration from https://trac.sagemath.org/ticket/31222





---

archive/issue_comments_441935.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2021-01-10T22:00:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30985#issuecomment-441935",
    "user": "https://github.com/slel"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_441936.json:
```json
{
    "body": "Changing keywords from \"integrate,giac,interface\" to \"integrate, giac, interface\".",
    "created_at": "2021-01-10T22:00:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30985#issuecomment-441936",
    "user": "https://github.com/slel"
}
```

Changing keywords from "integrate,giac,interface" to "integrate, giac, interface".



---

archive/issue_comments_441937.json:
```json
{
    "body": "everything works in the current beta. I guess your Sage install is broken.\n\n```\n\u2502 SageMath version 9.3.beta5, Release Date: 2020-12-27               \u2502\n\u2502 Using Python 3.7.7. Type \"help()\" for help.                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Warning: this is a prerelease version, and it may be unstable.     \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\nsage: sage: x,a = var('x a')                                                                                                                                                                                                                                            \nsage: sage: integrate(sin(2*x)/(a^2-4*sin(x)^2)^(1/3),x, algorithm=\"giac\")                                                                                                                                                                                              \n-3/8*(a^2 - 16*tan(1/2*x)^2/(tan(1/2*x)^2 + 1)^2)^(2/3)\nsage:             \n```",
    "created_at": "2021-01-11T09:50:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30985#issuecomment-441937",
    "user": "https://github.com/dimpase"
}
```

everything works in the current beta. I guess your Sage install is broken.

```
│ SageMath version 9.3.beta5, Release Date: 2020-12-27               │
│ Using Python 3.7.7. Type "help()" for help.                        │
└────────────────────────────────────────────────────────────────────┘
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Warning: this is a prerelease version, and it may be unstable.     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
sage: sage: x,a = var('x a')                                                                                                                                                                                                                                            
sage: sage: integrate(sin(2*x)/(a^2-4*sin(x)^2)^(1/3),x, algorithm="giac")                                                                                                                                                                                              
-3/8*(a^2 - 16*tan(1/2*x)^2/(tan(1/2*x)^2 + 1)^2)^(2/3)
sage:             
```



---

archive/issue_comments_441938.json:
```json
{
    "body": "It looks like this is about Sage 9.2 installed, as a system package, on a particular Linux, what is Linux in question?",
    "created_at": "2021-01-11T10:13:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30985#issuecomment-441938",
    "user": "https://github.com/dimpase"
}
```

It looks like this is about Sage 9.2 installed, as a system package, on a particular Linux, what is Linux in question?



---

archive/issue_comments_441939.json:
```json
{
    "body": "version information for linux\n\n\n```\n>uname -a\nLinux me-virtualbox 5.4.80-2-MANJARO #1 SMP PREEMPT Sat Nov 28 09:58:18 UTC 2020 x86_64 GNU/Linux\n>uname -r\n5.4.80-2-MANJARO\n\n```\n\nI installed 9.2 via Linux package manager and all was installed correctly. sagemath works fine.",
    "created_at": "2021-01-11T10:18:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30985#issuecomment-441939",
    "user": "https://github.com/nasser1"
}
```

version information for linux


```
>uname -a
Linux me-virtualbox 5.4.80-2-MANJARO #1 SMP PREEMPT Sat Nov 28 09:58:18 UTC 2020 x86_64 GNU/Linux
>uname -r
5.4.80-2-MANJARO

```

I installed 9.2 via Linux package manager and all was installed correctly. sagemath works fine.



---

archive/issue_comments_441940.json:
```json
{
    "body": "your report indicates that Sage's interface with giac is broken in your installation.",
    "created_at": "2021-01-11T10:36:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30985#issuecomment-441940",
    "user": "https://github.com/dimpase"
}
```

your report indicates that Sage's interface with giac is broken in your installation.



---

archive/issue_comments_441941.json:
```json
{
    "body": "`@`dimpase could you please try the other examples ? On my computer (Sage `9.3.beta5`, compiled by myself, Debian buster), the first example works, but not the other ones.",
    "created_at": "2021-01-11T17:36:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30985#issuecomment-441941",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

`@`dimpase could you please try the other examples ? On my computer (Sage `9.3.beta5`, compiled by myself, Debian buster), the first example works, but not the other ones.



---

archive/issue_comments_441942.json:
```json
{
    "body": "`@`gh-nasser1 if you have interesting examples, you should add them as doctests within Sage so that we could see regressions immediately.",
    "created_at": "2021-01-11T17:37:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30985#issuecomment-441942",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

`@`gh-nasser1 if you have interesting examples, you should add them as doctests within Sage so that we could see regressions immediately.



---

archive/issue_comments_441943.json:
```json
{
    "body": "The second example seems to hand in giac 1.5 itself. Maybe giac 1.6 makes a difference.",
    "created_at": "2021-01-11T18:26:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30985#issuecomment-441943",
    "user": "https://github.com/fchapoton"
}
```

The second example seems to hand in giac 1.5 itself. Maybe giac 1.6 makes a difference.



---

archive/issue_comments_441944.json:
```json
{
    "body": "FWIW: My experience matches that of tmonteil in comment:7. This is with 9.3.beta5 on MacOS 10.15.7. \n\n(The result for the 1st integral is the same as reported by dimpasse in comment:3. It looks different from what is reported in the ticket description, but I believe the two expressions are equal, so that is not a problem.)",
    "created_at": "2021-01-11T18:40:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30985#issuecomment-441944",
    "user": "https://github.com/DaveWitteMorris"
}
```

FWIW: My experience matches that of tmonteil in comment:7. This is with 9.3.beta5 on MacOS 10.15.7. 

(The result for the 1st integral is the same as reported by dimpasse in comment:3. It looks different from what is reported in the ticket description, but I believe the two expressions are equal, so that is not a problem.)



---

archive/issue_comments_441945.json:
```json
{
    "body": "`@`gh-nasser1: Thanks for reporting this problem. It seems to be serious, but I hope it will have an easy solution.\n\nIt seems that you have translated the rubi tests to sagemath format. If so, would you be willing to share the zip file, perhaps as an attachment to this ticket?",
    "created_at": "2021-01-11T19:11:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30985#issuecomment-441945",
    "user": "https://github.com/DaveWitteMorris"
}
```

`@`gh-nasser1: Thanks for reporting this problem. It seems to be serious, but I hope it will have an easy solution.

It seems that you have translated the rubi tests to sagemath format. If so, would you be willing to share the zip file, perhaps as an attachment to this ticket?



---

archive/issue_comments_441946.json:
```json
{
    "body": "Attachment [SAGE.zip](tarball://root/attachments/some-uuid/ticket31222/SAGE.zip) by @nasser1 created at 2021-01-11 21:31:45\n\nContains RUBI integration problems in sagemath synyax",
    "created_at": "2021-01-11T21:31:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30985#issuecomment-441946",
    "user": "https://github.com/nasser1"
}
```

Attachment [SAGE.zip](tarball://root/attachments/some-uuid/ticket31222/SAGE.zip) by @nasser1 created at 2021-01-11 21:31:45

Contains RUBI integration problems in sagemath synyax



---

archive/issue_comments_441947.json:
```json
{
    "body": "Replying to [comment:11 gh-DaveWitteMorris]:\n> `@`gh-nasser1: Thanks for reporting this problem. It seems to be serious, but I hope it will have an easy solution.\n> \n> It seems that you have translated the rubi tests to sagemath format. If so, would you be willing to share the zip file, perhaps as an attachment to this ticket? \n\n\n\nI seem to have lost what I wrote here. WIll try again.\n\nI attached zip file to the ticket. Each file in the zip file, say \"Hebisch_Problems.sage\" has first line as the `var` command, followed by `lis` which is a list that contains all the integrals for that specific test.\n\nTo run one file you could do\n\n\n```\nfileName = \"Hebisch_Problems.sage\"\nload(fileName) #read the problems into variable lis. This also contains the var('') statement.\nfor problem in lst: #problem[0] is the integrand, problem[1] is the integration variable.\n    integrate(SR(problem[0]),problem[1],algorithm=\"giac\")\n\n```\n\nEach row in the list has as first field the integrand (as a string) and the second field is the integration variable.\n\nOf you could simply copy the integral from the files and past it to sagemath.   \n\nHere is an example of one small complete file. There are about 200 files, some contains thousands of integrals. But they all have this format:\n\n\n```\nvar('x ')\nlst=[[\"(x^6-x^5+x^4-x^3+1)*exp(x)\",x,25,\"871*exp(x)-870*exp(x)*x+435*exp(x)*x^2-145*exp(x)*x^3+36*exp(x)*x^4-7*exp(x)*x^5+exp(x)*x^6\"],\n[\"(-x^2+2)*exp(x/(x^2+2))/(x^3+2*x)\",x,-5,\"Ei(x/(x^2+2))\"],\n[\"(2*x^4-x^3+3*x^2+2*x+2)*exp(x/(x^2+2))/(x^3+2*x)\",x,-5,\"exp(x/(x^2+2))*(x^2+2)+Ei(x/(x^2+2))\"],\n[\"(1+exp(x))*exp(x+exp(x))/(x+exp(x))\",x,2,\"Ei(x+exp(x))\"],\n[\"(x^3-x^2-3*x+1)*exp(1/(x^2-1))/(x^3-x^2-x+1)\",x,-6,\"exp(1/(x^2-1))*(1+x)\"],\n[\"exp(1+1/log(x))*(-1+log(x)^2)/log(x)^2\",x,1,\"exp(1+1/log(x))*x\"],\n[\"exp(x+1/log(x))*(-1+(1+x)*log(x)^2)/log(x)^2\",x,-2,\"exp(x+1/log(x))*x\"]]\n\n```\n\n\n--Nasser",
    "created_at": "2021-01-11T21:36:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30985#issuecomment-441947",
    "user": "https://github.com/nasser1"
}
```

Replying to [comment:11 gh-DaveWitteMorris]:
> `@`gh-nasser1: Thanks for reporting this problem. It seems to be serious, but I hope it will have an easy solution.
> 
> It seems that you have translated the rubi tests to sagemath format. If so, would you be willing to share the zip file, perhaps as an attachment to this ticket? 



I seem to have lost what I wrote here. WIll try again.

I attached zip file to the ticket. Each file in the zip file, say "Hebisch_Problems.sage" has first line as the `var` command, followed by `lis` which is a list that contains all the integrals for that specific test.

To run one file you could do


```
fileName = "Hebisch_Problems.sage"
load(fileName) #read the problems into variable lis. This also contains the var('') statement.
for problem in lst: #problem[0] is the integrand, problem[1] is the integration variable.
    integrate(SR(problem[0]),problem[1],algorithm="giac")

```

Each row in the list has as first field the integrand (as a string) and the second field is the integration variable.

Of you could simply copy the integral from the files and past it to sagemath.   

Here is an example of one small complete file. There are about 200 files, some contains thousands of integrals. But they all have this format:


```
var('x ')
lst=[["(x^6-x^5+x^4-x^3+1)*exp(x)",x,25,"871*exp(x)-870*exp(x)*x+435*exp(x)*x^2-145*exp(x)*x^3+36*exp(x)*x^4-7*exp(x)*x^5+exp(x)*x^6"],
["(-x^2+2)*exp(x/(x^2+2))/(x^3+2*x)",x,-5,"Ei(x/(x^2+2))"],
["(2*x^4-x^3+3*x^2+2*x+2)*exp(x/(x^2+2))/(x^3+2*x)",x,-5,"exp(x/(x^2+2))*(x^2+2)+Ei(x/(x^2+2))"],
["(1+exp(x))*exp(x+exp(x))/(x+exp(x))",x,2,"Ei(x+exp(x))"],
["(x^3-x^2-3*x+1)*exp(1/(x^2-1))/(x^3-x^2-x+1)",x,-6,"exp(1/(x^2-1))*(1+x)"],
["exp(1+1/log(x))*(-1+log(x)^2)/log(x)^2",x,1,"exp(1+1/log(x))*x"],
["exp(x+1/log(x))*(-1+(1+x)*log(x)^2)/log(x)^2",x,-2,"exp(x+1/log(x))*x"]]

```


--Nasser



---

archive/issue_comments_441948.json:
```json
{
    "body": "Replying to [comment:13 gh-nasser1]:\n> I attached zip file to the ticket...\n\n\nThanks! Your instructions were very clear, so I had no problem running some tests (until I ran into one that hangs). As suggested by tmonteil in comment:8, I think a bunch of these should be added to the testing framework after this bug is cleared up.",
    "created_at": "2021-01-12T01:29:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30985#issuecomment-441948",
    "user": "https://github.com/DaveWitteMorris"
}
```

Replying to [comment:13 gh-nasser1]:
> I attached zip file to the ticket...


Thanks! Your instructions were very clear, so I had no problem running some tests (until I ran into one that hangs). As suggested by tmonteil in comment:8, I think a bunch of these should be added to the testing framework after this bug is cleared up.



---

archive/issue_comments_441949.json:
```json
{
    "body": "Replying to [comment:7 tmonteil]:\n> `@`dimpase could you please try the other examples ? On my computer (Sage `9.3.beta5`, compiled by myself, Debian buster), the first example works, but not the other ones.\n\n\noops, indeed, while the 1st example works for me, the 2nd one hangs. Sorry for noise.",
    "created_at": "2021-01-12T09:38:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30985#issuecomment-441949",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:7 tmonteil]:
> `@`dimpase could you please try the other examples ? On my computer (Sage `9.3.beta5`, compiled by myself, Debian buster), the first example works, but not the other ones.


oops, indeed, while the 1st example works for me, the 2nd one hangs. Sorry for noise.



---

archive/issue_comments_441950.json:
```json
{
    "body": "Something silly is happening where the expression to pass to giac is formed.\nI've added \n\n```diff\n--- a/src/sage/interfaces/giac.py\n+++ b/src/sage/interfaces/giac.py\n@@ -1154,6 +1154,9 @@ class GiacElement(ExpectElement):\n             sage: x,y=giac('x'),giac('y');integrate(cos(x+y),'x=0..pi').simplify()\n             -2*sin(y)\n         \"\"\"\n+        print(self.name())\n+        print(self)\n+        print(var)\n         if min is None:\n             return giac('int(%s,%s)' % (self.name(), var))\n         else:\n```\n\nand as you see, the expression is malformed, e.g. there is no terminating `)`\nso giac just waits for the end of the expression, which never comes, thus the hang.\n\n```\nsage: sage: x,a,b = var('x a b') \n....: sage: integrate((x/(b*x+a))^(5/2),x, algorithm=\"giac\")                                                                                                                                                                                                                      \nsage4\nsqrt((b*x+a)^-1*x)*((b*x+a)^-1*x)^2\nx\n^CInterrupting Giac...\n```",
    "created_at": "2021-01-12T09:52:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30985#issuecomment-441950",
    "user": "https://github.com/dimpase"
}
```

Something silly is happening where the expression to pass to giac is formed.
I've added 

```diff
--- a/src/sage/interfaces/giac.py
+++ b/src/sage/interfaces/giac.py
@@ -1154,6 +1154,9 @@ class GiacElement(ExpectElement):
             sage: x,y=giac('x'),giac('y');integrate(cos(x+y),'x=0..pi').simplify()
             -2*sin(y)
         """
+        print(self.name())
+        print(self)
+        print(var)
         if min is None:
             return giac('int(%s,%s)' % (self.name(), var))
         else:
```

and as you see, the expression is malformed, e.g. there is no terminating `)`
so giac just waits for the end of the expression, which never comes, thus the hang.

```
sage: sage: x,a,b = var('x a b') 
....: sage: integrate((x/(b*x+a))^(5/2),x, algorithm="giac")                                                                                                                                                                                                                      
sage4
sqrt((b*x+a)^-1*x)*((b*x+a)^-1*x)^2
x
^CInterrupting Giac...
```



---

archive/issue_comments_441951.json:
```json
{
    "body": "and here is the malformed giac input for Example 2 as given in the ticket description\n\n```\nsage: sage: x,a,b = var('x a b') \n....: sage: integrate(x^(5/2)/(b*x+a)^(5/2),x, algorithm=\"giac\")                                                                                                                                                                                                                  \nsage0\n(sqrt(b*x+a))^-1*(b*x+a)^-2*sqrt(x)*x^2\nx\n^CInterrupting Giac...\n```\n\nsomebody has damaged handling of non-integer exponents (for giac only?) since Sage 8.9, it seems.",
    "created_at": "2021-01-12T09:59:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30985#issuecomment-441951",
    "user": "https://github.com/dimpase"
}
```

and here is the malformed giac input for Example 2 as given in the ticket description

```
sage: sage: x,a,b = var('x a b') 
....: sage: integrate(x^(5/2)/(b*x+a)^(5/2),x, algorithm="giac")                                                                                                                                                                                                                  
sage0
(sqrt(b*x+a))^-1*(b*x+a)^-2*sqrt(x)*x^2
x
^CInterrupting Giac...
```

somebody has damaged handling of non-integer exponents (for giac only?) since Sage 8.9, it seems.



---

archive/issue_comments_441952.json:
```json
{
    "body": "On the other hand, `integrate(x<sup>(5/2)/(b*x+a)</sup>(5/2),x, algorithm=\"fricas\")` works, which gives hope that the bug is specific to giac interface.",
    "created_at": "2021-01-12T10:06:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30985#issuecomment-441952",
    "user": "https://github.com/dimpase"
}
```

On the other hand, `integrate(x<sup>(5/2)/(b*x+a)</sup>(5/2),x, algorithm="fricas")` works, which gives hope that the bug is specific to giac interface.



---

archive/issue_comments_441953.json:
```json
{
    "body": "sorry, but where do you see a missing parenthesis ? The following works fine:\n\n```\nsage: x,a,b = var('x a b')                                                      \nsage: F=(x/(b*x+a))^(5/2)                                                       \nsage: F._fricas_init_() == F._giac_init_()                                      \nTrue\nsage: giac(F).diff()                                                            \n1/2*(-b*(b*x+a)^-2*x+(b*x+a)^-1)*(sqrt((b*x+a)^-1*x))^-1*((b*x+a)^-1*x)^2+2*sqrt((b*x+a)^-1*x)*(-b*(b*x+a)^-2*x+(b*x+a)^-1)*(b*x+a)^-1*x\nsage: giac(F).sage()                                                            \nx^2*sqrt(x/(b*x + a))/(b*x + a)^2\n\n```",
    "created_at": "2021-01-12T10:31:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30985#issuecomment-441953",
    "user": "https://github.com/fchapoton"
}
```

sorry, but where do you see a missing parenthesis ? The following works fine:

```
sage: x,a,b = var('x a b')                                                      
sage: F=(x/(b*x+a))^(5/2)                                                       
sage: F._fricas_init_() == F._giac_init_()                                      
True
sage: giac(F).diff()                                                            
1/2*(-b*(b*x+a)^-2*x+(b*x+a)^-1)*(sqrt((b*x+a)^-1*x))^-1*((b*x+a)^-1*x)^2+2*sqrt((b*x+a)^-1*x)*(-b*(b*x+a)^-2*x+(b*x+a)^-1)*(b*x+a)^-1*x
sage: giac(F).sage()                                                            
x^2*sqrt(x/(b*x + a))/(b*x + a)^2

```



---

archive/issue_comments_441954.json:
```json
{
    "body": "Replying to [comment:19 chapoton]:\n> sorry, but where do you see a missing parenthesis ? The following works fine:\n> \n> ```\n> sage: x,a,b = var('x a b')                                                      \n> sage: F=(x/(b*x+a))^(5/2)                                                       \n> sage: F._fricas_init_() == F._giac_init_()                                      \n> True\n> sage: giac(F).diff()                                                            \n> 1/2*(-b*(b*x+a)^-2*x+(b*x+a)^-1)*(sqrt((b*x+a)^-1*x))^-1*((b*x+a)^-1*x)^2+2*sqrt((b*x+a)^-1*x)*(-b*(b*x+a)^-2*x+(b*x+a)^-1)*(b*x+a)^-1*x\n> sage: giac(F).sage()                                                            \n> x^2*sqrt(x/(b*x + a))/(b*x + a)^2\n> \n> ```\n\n\nsee the output of the debugging print I inserted:\n\n```\nsage: integral(F,x,algorithm=\"giac\")                                                                                                                                                                                                                                              \nsage0\nsqrt((b*x+a)^-1*x)*((b*x+a)^-1*x)^2\nx\n```\n\nthere is an attempted conversion to an expression involving `sqrt()`, but it does not go through!\n\nWhere the hell this is happening in the code, I don't know.",
    "created_at": "2021-01-12T10:39:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30985#issuecomment-441954",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:19 chapoton]:
> sorry, but where do you see a missing parenthesis ? The following works fine:
> 
> ```
> sage: x,a,b = var('x a b')                                                      
> sage: F=(x/(b*x+a))^(5/2)                                                       
> sage: F._fricas_init_() == F._giac_init_()                                      
> True
> sage: giac(F).diff()                                                            
> 1/2*(-b*(b*x+a)^-2*x+(b*x+a)^-1)*(sqrt((b*x+a)^-1*x))^-1*((b*x+a)^-1*x)^2+2*sqrt((b*x+a)^-1*x)*(-b*(b*x+a)^-2*x+(b*x+a)^-1)*(b*x+a)^-1*x
> sage: giac(F).sage()                                                            
> x^2*sqrt(x/(b*x + a))/(b*x + a)^2
> 
> ```


see the output of the debugging print I inserted:

```
sage: integral(F,x,algorithm="giac")                                                                                                                                                                                                                                              
sage0
sqrt((b*x+a)^-1*x)*((b*x+a)^-1*x)^2
x
```

there is an attempted conversion to an expression involving `sqrt()`, but it does not go through!

Where the hell this is happening in the code, I don't know.



---

archive/issue_comments_441955.json:
```json
{
    "body": "once again: `sqrt((b*x+a)<sup>-1*x)*((b*x+a)</sup>-1*x)^2` is what's being passed to giac, and of course this does not fly.",
    "created_at": "2021-01-12T10:44:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30985#issuecomment-441955",
    "user": "https://github.com/dimpase"
}
```

once again: `sqrt((b*x+a)<sup>-1*x)*((b*x+a)</sup>-1*x)^2` is what's being passed to giac, and of course this does not fly.



---

archive/issue_comments_441956.json:
```json
{
    "body": "Here it is, in another way:\n\n```\nsage: F._giac_()                                                                                                                                                                                                                                                                  \nsqrt((b*x+a)^-1*x)*((b*x+a)^-1*x)^2\n```\nI don't know where this is happening, but it is obviously very wrong.\n\nby the way\n\n```\nsage: F._fricas_()                                                                                                                                                                                                                                                                \n       +-------+\n     2 |   x\n    x  |-------\n      \\|b x + a\n-------------------\n 2 2              2\nb x  + 2 a b x + a\n```",
    "created_at": "2021-01-12T10:52:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30985#issuecomment-441956",
    "user": "https://github.com/dimpase"
}
```

Here it is, in another way:

```
sage: F._giac_()                                                                                                                                                                                                                                                                  
sqrt((b*x+a)^-1*x)*((b*x+a)^-1*x)^2
```
I don't know where this is happening, but it is obviously very wrong.

by the way

```
sage: F._fricas_()                                                                                                                                                                                                                                                                
       +-------+
     2 |   x
    x  |-------
      \|b x + a
-------------------
 2 2              2
b x  + 2 a b x + a
```



---

archive/issue_comments_441957.json:
```json
{
    "body": "There is indeed a filter between Expression and giac used to convert some keywords so giac(F) may not be the same as giac(str(F))\nI guess it is in\n`sage.symbolic.expression_conversions`",
    "created_at": "2021-01-12T11:09:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30985#issuecomment-441957",
    "user": "https://github.com/frederichan-IMJPRG"
}
```

There is indeed a filter between Expression and giac used to convert some keywords so giac(F) may not be the same as giac(str(F))
I guess it is in
`sage.symbolic.expression_conversions`



---

archive/issue_comments_441958.json:
```json
{
    "body": "Replying to [comment:21 dimpase]:\n> once again: `sqrt((b*x+a)<sup>-1*x)*((b*x+a)</sup>-1*x)^2` is what's being passed to giac, and of course this does not fly.\n\n\nNo, I do not think so. This is what giac is printing. What giac gets is the string given by `_giac_init_`, which is fine.",
    "created_at": "2021-01-12T11:10:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30985#issuecomment-441958",
    "user": "https://github.com/fchapoton"
}
```

Replying to [comment:21 dimpase]:
> once again: `sqrt((b*x+a)<sup>-1*x)*((b*x+a)</sup>-1*x)^2` is what's being passed to giac, and of course this does not fly.


No, I do not think so. This is what giac is printing. What giac gets is the string given by `_giac_init_`, which is fine.



---

archive/issue_comments_441959.json:
```json
{
    "body": "Replying to [comment:24 chapoton]:\n> Replying to [comment:21 dimpase]:\n> > once again: `sqrt((b*x+a)<sup>-1*x)*((b*x+a)</sup>-1*x)^2` is what's being passed to giac, and of course this does not fly.\n\n> \n> No, I do not think so. This is what giac is printing. What giac gets is the string given by `_giac_init_`, which is fine.\n\n\n\"passing\" means \"what giac tries to integrate\".\nIMHO it is what Sage prepares to pass to giac, giac is not yet involved at this point.\n\n \ngiac is perfectly capable to take this `_giac_init_` and integrate it.",
    "created_at": "2021-01-12T11:17:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30985#issuecomment-441959",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:24 chapoton]:
> Replying to [comment:21 dimpase]:
> > once again: `sqrt((b*x+a)<sup>-1*x)*((b*x+a)</sup>-1*x)^2` is what's being passed to giac, and of course this does not fly.

> 
> No, I do not think so. This is what giac is printing. What giac gets is the string given by `_giac_init_`, which is fine.


"passing" means "what giac tries to integrate".
IMHO it is what Sage prepares to pass to giac, giac is not yet involved at this point.

 
giac is perfectly capable to take this `_giac_init_` and integrate it.



---

archive/issue_comments_441960.json:
```json
{
    "body": "meanwhile I looked at Example 8. The trouble there is that giac is highly sensitive to \nthe expression format; we shuffle the terms around, and all of a sudden it has trouble integrating the expression.\n\n```\n0>> integrate((b*x+a)^4*(d*x+c)^3*exp(-b*x-a),x)\n^CCtrl-C pressed (pid 21354)\nStopped by user interruption. Error: Bad Argument Value\n\nEvaluation time: 50.4\n\"Stopped by user interruption. Error: Bad Argument Value\"\n// Time 50.4\n1>> integrate(exp(-b*x-a)*(b*x+a)^4*(d*x+c)^3,x)\nDone\n```\n\nand the first of these forms is what you get by doing \n\n```\nsage: F=exp(-b*x-a)*(b*x+a)^4*(d*x+c)^3\nsage: F._giac_()\n```\nso that's why this particular example is stuck in Sage.\n\nSo it's more of a giac problem/bug for this example.",
    "created_at": "2021-01-12T11:22:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30985#issuecomment-441960",
    "user": "https://github.com/dimpase"
}
```

meanwhile I looked at Example 8. The trouble there is that giac is highly sensitive to 
the expression format; we shuffle the terms around, and all of a sudden it has trouble integrating the expression.

```
0>> integrate((b*x+a)^4*(d*x+c)^3*exp(-b*x-a),x)
^CCtrl-C pressed (pid 21354)
Stopped by user interruption. Error: Bad Argument Value

Evaluation time: 50.4
"Stopped by user interruption. Error: Bad Argument Value"
// Time 50.4
1>> integrate(exp(-b*x-a)*(b*x+a)^4*(d*x+c)^3,x)
Done
```

and the first of these forms is what you get by doing 

```
sage: F=exp(-b*x-a)*(b*x+a)^4*(d*x+c)^3
sage: F._giac_()
```
so that's why this particular example is stuck in Sage.

So it's more of a giac problem/bug for this example.



---

archive/issue_comments_441961.json:
```json
{
    "body": "Oops, sorry, you're right, Example 2 is more of a giac problem, too (I took that `_giac_init_()` form):\n\n```\n0>> integrate((((((b)*(x))+(a))^(-1))*(x))^(5/2),x)\nWarning, integration of abs or sign assumes constant sign by intervals (correct if the argument is real):\nCheck [abs(b*x+a)]\n^CCtrl-C pressed (pid 32350)\n```",
    "created_at": "2021-01-12T11:31:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30985#issuecomment-441961",
    "user": "https://github.com/dimpase"
}
```

Oops, sorry, you're right, Example 2 is more of a giac problem, too (I took that `_giac_init_()` form):

```
0>> integrate((((((b)*(x))+(a))^(-1))*(x))^(5/2),x)
Warning, integration of abs or sign assumes constant sign by intervals (correct if the argument is real):
Check [abs(b*x+a)]
^CCtrl-C pressed (pid 32350)
```



---

archive/issue_comments_441962.json:
```json
{
    "body": "Upstream notified in https://xcas.univ-grenoble-alpes.fr/forum/viewtopic.php?f=3&t=2600",
    "created_at": "2021-01-12T12:47:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30985#issuecomment-441962",
    "user": "https://github.com/dimpase"
}
```

Upstream notified in https://xcas.univ-grenoble-alpes.fr/forum/viewtopic.php?f=3&t=2600



---

archive/issue_comments_441963.json:
```json
{
    "body": "Replying to [comment:11 gh-DaveWitteMorris]:\n> `@`gh-nasser1: Thanks for reporting this problem. It seems to be serious, but I hope it will have an easy solution.\n\n\nAn easy solution, making sure that giac called from Sage does exactly the same as giac called stanadlone, is to bypass rewriting done by Sage, by using `giac.eval()`. E.g.\n\n```\nsage: x,a,b,B,A,m,n,d,c = var('x a b B A m n d c')                                                                                                                                           \nsage: F='exp(-b*x-a)*(b*x+a)^4*(d*x+c)^3'                                                                                                                                                    \nsage: giac.eval(F+',x')                                                                                                                                                                      \n'exp(-b*x-a)*(b*x+a)^4*(d*x+c)^3,x'\nsage: giac.eval('integrate('+F+',x)')                                                                                                                                                        \n'(-x^7*d^3*b^11-4*x^6*...'\n```\nSo you pass giac a string and get a string back.\nOne can convert strings to Sage's symbolic expressions then, by calling `SR()`.",
    "created_at": "2021-01-12T13:22:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30985#issuecomment-441963",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:11 gh-DaveWitteMorris]:
> `@`gh-nasser1: Thanks for reporting this problem. It seems to be serious, but I hope it will have an easy solution.


An easy solution, making sure that giac called from Sage does exactly the same as giac called stanadlone, is to bypass rewriting done by Sage, by using `giac.eval()`. E.g.

```
sage: x,a,b,B,A,m,n,d,c = var('x a b B A m n d c')                                                                                                                                           
sage: F='exp(-b*x-a)*(b*x+a)^4*(d*x+c)^3'                                                                                                                                                    
sage: giac.eval(F+',x')                                                                                                                                                                      
'exp(-b*x-a)*(b*x+a)^4*(d*x+c)^3,x'
sage: giac.eval('integrate('+F+',x)')                                                                                                                                                        
'(-x^7*d^3*b^11-4*x^6*...'
```
So you pass giac a string and get a string back.
One can convert strings to Sage's symbolic expressions then, by calling `SR()`.



---

archive/issue_comments_441964.json:
```json
{
    "body": "the problem of Ex.8 has been fixed upstream:\nhttps://dev.geogebra.org/trac/changeset/69729/",
    "created_at": "2021-01-13T18:58:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30985#issuecomment-441964",
    "user": "https://github.com/dimpase"
}
```

the problem of Ex.8 has been fixed upstream:
https://dev.geogebra.org/trac/changeset/69729/



---

archive/issue_events_081608.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-02T20:21:54Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30985",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30985#event-81608"
}
```



---

archive/issue_comments_441965.json:
```json
{
    "body": "Moving this ticket to 9.4, as it seems unlikely that it will be merged in 9.3, which is in the release candidate stage",
    "created_at": "2021-04-02T20:21:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30985#issuecomment-441965",
    "user": "https://github.com/mkoeppe"
}
```

Moving this ticket to 9.4, as it seems unlikely that it will be merged in 9.3, which is in the release candidate stage



---

archive/issue_comments_441966.json:
```json
{
    "body": "Examples 2, 3, 5, 6, 7 have `ln` in Giac's output.\nEmmanuel Charpentier's answer to\n\n- [Ask Sage question 57145: integrating via Giac can give \"Malformed expression\"](https://ask.sagemath.org/question/57145)\n\npoints to the absence of conversion from\nGiac's `ln` to Sage's `log` being a problem.",
    "created_at": "2021-05-18T12:40:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30985#issuecomment-441966",
    "user": "https://github.com/slel"
}
```

Examples 2, 3, 5, 6, 7 have `ln` in Giac's output.
Emmanuel Charpentier's answer to

- [Ask Sage question 57145: integrating via Giac can give "Malformed expression"](https://ask.sagemath.org/question/57145)

points to the absence of conversion from
Giac's `ln` to Sage's `log` being a problem.



---

archive/issue_comments_441967.json:
```json
{
    "body": "no example [1..9] hangs anymore:\n\nhttps://asciinema.org/a/kPLdynWBPFraIDEJLvHOKP7xq\n\ntry it yourself with https://github.com/sheerluck/ticket-31222",
    "created_at": "2021-07-03T10:48:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30985",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30985#issuecomment-441967",
    "user": "https://github.com/sheerluck"
}
```

no example [1..9] hangs anymore:

https://asciinema.org/a/kPLdynWBPFraIDEJLvHOKP7xq

try it yourself with https://github.com/sheerluck/ticket-31222



---

archive/issue_events_081609.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-22T20:35:10Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30985",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30985#event-81609"
}
```



---

archive/issue_events_081610.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-22T20:35:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30985",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30985#event-81610"
}
```



---

archive/issue_events_081611.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T20:12:32Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30985",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30985#event-81611"
}
```



---

archive/issue_events_081612.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T20:12:32Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30985",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30985#event-81612"
}
```



---

archive/issue_events_081613.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:17:06Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30985",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30985#event-81613"
}
```



---

archive/issue_events_081614.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:17:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30985",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30985#event-81614"
}
```



---

archive/issue_events_081615.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30985",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30985#event-81615"
}
```



---

archive/issue_events_081616.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30985",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30985#event-81616"
}
```
