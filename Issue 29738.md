# Issue 29738: Make numerical and probability doctests ready for random seeds

archive/issues_029738.json:
```json
{
    "body": "This ticket makes\n\n```\nsage -t --long --random-seed=n src/sage/numerical/\nsage -t --long --random-seed=n src/sage/probabilty/\n```\n\npass for different values n than just 0.\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/29975\n\n",
    "created_at": "2020-06-24T21:26:38Z",
    "labels": [
        "doctest framework",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Make numerical and probability doctests ready for random seeds",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29738",
    "user": "@kliem"
}
```
This ticket makes

```
sage -t --long --random-seed=n src/sage/numerical/
sage -t --long --random-seed=n src/sage/probabilty/
```

pass for different values n than just 0.


Issue created by migration from https://trac.sagemath.org/ticket/29975





---

archive/issue_comments_422439.json:
```json
{
    "body": "\n```\nsage -t --long --random-seed=151058820726654196682836430928254760259 src/sage/numerical/optimize.py  # 2 doctests failed\nsage -t --long --random-seed=151058820726654196682836430928254760259 src/sage/probability/probability_distribution.pyx  # 18 doctests failed\n```\n",
    "created_at": "2020-06-24T21:27:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29738#issuecomment-422439",
    "user": "@kliem"
}
```


```
sage -t --long --random-seed=151058820726654196682836430928254760259 src/sage/numerical/optimize.py  # 2 doctests failed
sage -t --long --random-seed=151058820726654196682836430928254760259 src/sage/probability/probability_distribution.pyx  # 18 doctests failed
```




---

archive/issue_comments_422440.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-09-18T17:58:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29738#issuecomment-422440",
    "user": "@kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_422441.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-09-18T17:58:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29738#issuecomment-422441",
    "user": "@kliem"
}
```

New commits:



---

archive/issue_comments_422442.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-09-19T08:16:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29738#issuecomment-422442",
    "user": "@mwageringel"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_422443.json:
```json
{
    "body": "Although this is unlikely to fail, the test should agree with the documentation, so please apply this change for the uniform distribution:\n\n\n```diff\n     Uniform distribution on the interval ``[a, b]``::\n \n         sage: a = 0\n         sage: b = 2\n         sage: T = RealDistribution('uniform', [a, b])\n-        sage: a <= T.get_random_element() < b\n+        sage: a <= T.get_random_element() <= b\n         True\n```\n\n\nFor the Pareto distribution, you could also add a test that `s >= b`. Similarly, the Rayleigh, Lognormal, F, Chisquared and Weibull distributions are \u2265 0, and the Beta distribution lives on [0,1].\n\nFinally, I think this test should document the expected outcome, for clarity:\n\n\n```diff\n         sage: [1.0*x/nr_samples for x in counts]  # abs tol 1e-1\n-        [0.304200000000000, 0.397300000000000, 0.298500000000000]\n+        [0.3, 0.4, 0.3]\n```\n\n\nI hope it is sufficiently unlikely that this test fails, but it is not impossible.",
    "created_at": "2020-09-19T08:16:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29738#issuecomment-422443",
    "user": "@mwageringel"
}
```

Although this is unlikely to fail, the test should agree with the documentation, so please apply this change for the uniform distribution:


```diff
     Uniform distribution on the interval ``[a, b]``::
 
         sage: a = 0
         sage: b = 2
         sage: T = RealDistribution('uniform', [a, b])
-        sage: a <= T.get_random_element() < b
+        sage: a <= T.get_random_element() <= b
         True
```


For the Pareto distribution, you could also add a test that `s >= b`. Similarly, the Rayleigh, Lognormal, F, Chisquared and Weibull distributions are ≥ 0, and the Beta distribution lives on [0,1].

Finally, I think this test should document the expected outcome, for clarity:


```diff
         sage: [1.0*x/nr_samples for x in counts]  # abs tol 1e-1
-        [0.304200000000000, 0.397300000000000, 0.298500000000000]
+        [0.3, 0.4, 0.3]
```


I hope it is sufficiently unlikely that this test fails, but it is not impossible.



---

archive/issue_comments_422444.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-21T04:23:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29738#issuecomment-422444",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_422445.json:
```json
{
    "body": "Thanks for improving the doctests.\n\nReplying to [comment:4 gh-mwageringel]:\n> Finally, I think this test should document the expected outcome, for clarity:\n> \n> {{{#!diff\n>          sage: [1.0*x/nr_samples for x in counts]  # abs tol 1e-1\n> -        [0.304200000000000, 0.397300000000000, 0.298500000000000]\n> +        [0.3, 0.4, 0.3]\n> }}}\n> \n> I hope it is sufficiently unlikely that this test fails, but it is not impossible.\n\nI even modified it down to `3e-2`. I tested it and the maximal difference is `0.0192` in 10 000 runs. So I guess it is much less likely than 1 in 10 000 that this test will fail.",
    "created_at": "2020-09-21T04:29:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29738#issuecomment-422445",
    "user": "@kliem"
}
```

Thanks for improving the doctests.

Replying to [comment:4 gh-mwageringel]:
> Finally, I think this test should document the expected outcome, for clarity:
> 
> {{{#!diff
>          sage: [1.0*x/nr_samples for x in counts]  # abs tol 1e-1
> -        [0.304200000000000, 0.397300000000000, 0.298500000000000]
> +        [0.3, 0.4, 0.3]
> }}}
> 
> I hope it is sufficiently unlikely that this test fails, but it is not impossible.

I even modified it down to `3e-2`. I tested it and the maximal difference is `0.0192` in 10 000 runs. So I guess it is much less likely than 1 in 10 000 that this test will fail.



---

archive/issue_comments_422446.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-09-21T04:30:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29738#issuecomment-422446",
    "user": "@kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_422447.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-09-21T17:35:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29738#issuecomment-422447",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_422448.json:
```json
{
    "body": "Thanks for the updates. The change to multigraphics seems unintentional \u2013 I have removed it from your commit. I have also fixed another doctest:\n\n```\nsage -t --long --warn-long 55.4 --random-seed=2001 src/sage/numerical/optimize.py\n**********************************************************************\nFile \"src/sage/numerical/optimize.py\", line 264, in sage.numerical.optimize.find_local_minimum\nFailed example:\n    plot(f, (x,-2.5, 2)).ymin()\nExpected:\n    -2.1827...\nGot:\n    -2.182677572710766\n```\n\nYou can set this to positive if you agree with my changes.",
    "created_at": "2020-09-21T17:39:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29738#issuecomment-422448",
    "user": "@mwageringel"
}
```

Thanks for the updates. The change to multigraphics seems unintentional – I have removed it from your commit. I have also fixed another doctest:

```
sage -t --long --warn-long 55.4 --random-seed=2001 src/sage/numerical/optimize.py
**********************************************************************
File "src/sage/numerical/optimize.py", line 264, in sage.numerical.optimize.find_local_minimum
Failed example:
    plot(f, (x,-2.5, 2)).ymin()
Expected:
    -2.1827...
Got:
    -2.182677572710766
```

You can set this to positive if you agree with my changes.



---

archive/issue_comments_422449.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-09-21T17:52:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29738#issuecomment-422449",
    "user": "@kliem"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_422450.json:
```json
{
    "body": "Thank you. Yes, agreed.",
    "created_at": "2020-09-21T17:52:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29738#issuecomment-422450",
    "user": "@kliem"
}
```

Thank you. Yes, agreed.



---

archive/issue_comments_422451.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-09-23T21:27:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29738#issuecomment-422451",
    "user": "vbraun"
}
```

Resolution: fixed
