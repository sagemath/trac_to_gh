# Issue 22728: Refactor axioms

archive/issues_022728.json:
```json
{
    "body": "CC:  tscrim simonking vbraun jpflori\n\nThis ticket brings:\n\n- a catalog of axioms `axioms.XXX`\n\n- improved heuristic for displaying categories with axioms. E.g.:\n   {{{\n   Category of finite enumerated fields  ->  Category of finite fields\n   Category of finite enumerated permutation groups  ->  Category of finite permutation groups\n   }}}\n\n   (this is the reason why the commit touches many files)\n\n- axioms as objects rather than plain strings. This had been wished\n  for during the review #12973, and some of the code is reminiscent of\n  Volker's draft at #15501.\n\nThe code is essentially backward compatible, at the price of having\nAssociative == \"Associative\", with compatible has values.\n\nThe bijection axiom <-> \"axiom name\" remains mandatory to support the\nsyntax for implementing axioms in a category.\n\nIssue created by migration from https://trac.sagemath.org/ticket/22965\n\n",
    "created_at": "2017-05-10T03:34:05Z",
    "labels": [
        "categories",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "Refactor axioms",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22728",
    "user": "nthiery"
}
```
CC:  tscrim simonking vbraun jpflori

This ticket brings:

- a catalog of axioms `axioms.XXX`

- improved heuristic for displaying categories with axioms. E.g.:
   {{{
   Category of finite enumerated fields  ->  Category of finite fields
   Category of finite enumerated permutation groups  ->  Category of finite permutation groups
   }}}

   (this is the reason why the commit touches many files)

- axioms as objects rather than plain strings. This had been wished
  for during the review #12973, and some of the code is reminiscent of
  Volker's draft at #15501.

The code is essentially backward compatible, at the price of having
Associative == "Associative", with compatible has values.

The bijection axiom <-> "axiom name" remains mandatory to support the
syntax for implementing axioms in a category.

Issue created by migration from https://trac.sagemath.org/ticket/22965





---

archive/issue_comments_317340.json:
```json
{
    "body": "I know it's not ready for review, but something I've been bit by in the past is only defining an `__eq__`. Make sure you define a `__ne__` as `return not (self == other)`.\n----\nNew commits:",
    "created_at": "2017-05-10T21:38:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22728#issuecomment-317340",
    "user": "tscrim"
}
```

I know it's not ready for review, but something I've been bit by in the past is only defining an `__eq__`. Make sure you define a `__ne__` as `return not (self == other)`.
----
New commits:



---

archive/issue_comments_317341.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-05-10T22:03:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22728#issuecomment-317341",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_317342.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-05-10T22:06:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22728#issuecomment-317342",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_317343.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-05-10T22:10:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22728#issuecomment-317343",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_317344.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-05-10T22:12:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22728#issuecomment-317344",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_317345.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-05-10T22:12:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22728#issuecomment-317345",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_317346.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-05-10T22:45:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22728#issuecomment-317346",
    "user": "nthiery"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_317347.json:
```json
{
    "body": "If you're going to override \"__eq__\" and \"__hash__\" you should probably define the thing to be `CachedRepresentation`. Is there a good reason to be `CachedRepresentation`?\n\n(`CachedRepresentation` has a very nontrivial cost. You should only use it if you need its features)",
    "created_at": "2017-05-10T22:46:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22728#issuecomment-317347",
    "user": "nbruin"
}
```

If you're going to override "__eq__" and "__hash__" you should probably define the thing to be `CachedRepresentation`. Is there a good reason to be `CachedRepresentation`?

(`CachedRepresentation` has a very nontrivial cost. You should only use it if you need its features)



---

archive/issue_comments_317348.json:
```json
{
    "body": "Replying to [comment:12 nbruin]:\n> If you're going to override \"__eq__\" and \"__hash__\" you should probably define the thing to be `CachedRepresentation`. Is there a good reason to be `CachedRepresentation`?\n> \n> (`CachedRepresentation` has a very nontrivial cost. You should only use it if you need its features)\n\nThat's a good question. The `__eq__` and `__hash__` are really here just for backward compatibility (supporting the idiom `\"Foo\" in C.axioms()`). I used `UniqueRepresentation` because that's really what I mean :-) But you are right, it could be more proper to use `CachedRepresentation`.\n\nIn terms of speed, I believe the only important thing is fast equality and hash (which calls for Cythonizing them). Axioms will rarely be recreated.\n\nCheers,\n                                    Nicolas",
    "created_at": "2017-05-10T22:56:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22728#issuecomment-317348",
    "user": "nthiery"
}
```

Replying to [comment:12 nbruin]:
> If you're going to override "__eq__" and "__hash__" you should probably define the thing to be `CachedRepresentation`. Is there a good reason to be `CachedRepresentation`?
> 
> (`CachedRepresentation` has a very nontrivial cost. You should only use it if you need its features)

That's a good question. The `__eq__` and `__hash__` are really here just for backward compatibility (supporting the idiom `"Foo" in C.axioms()`). I used `UniqueRepresentation` because that's really what I mean :-) But you are right, it could be more proper to use `CachedRepresentation`.

In terms of speed, I believe the only important thing is fast equality and hash (which calls for Cythonizing them). Axioms will rarely be recreated.

Cheers,
                                    Nicolas



---

archive/issue_comments_317349.json:
```json
{
    "body": "Replying to [comment:4 tscrim]:\n> I know it's not ready for review, but something I've been bit by in the past is only defining an `__eq__`. Make sure you define a `__ne__` as `return not (self == other)`.\n\nYeah, I pondered about this. Accepting `\"Associative\" == axioms.Associative` is really just here as a workaround for backward compatibility; namely to support idiom `\"Associative\" in C.axioms()` that people apparently have been using. I wondered whether I really wanted to enable more than just the strict minimum.",
    "created_at": "2017-05-10T23:06:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22728#issuecomment-317349",
    "user": "nthiery"
}
```

Replying to [comment:4 tscrim]:
> I know it's not ready for review, but something I've been bit by in the past is only defining an `__eq__`. Make sure you define a `__ne__` as `return not (self == other)`.

Yeah, I pondered about this. Accepting `"Associative" == axioms.Associative` is really just here as a workaround for backward compatibility; namely to support idiom `"Associative" in C.axioms()` that people apparently have been using. I wondered whether I really wanted to enable more than just the strict minimum.



---

archive/issue_comments_317350.json:
```json
{
    "body": "If you want to keep the `__eq__`, then you really need to define a `__ne__` to keep things consistent in case someone wants to test inequality. A slightly contrived example, but say someone has a constructor that accepts an axiom as an arg and they want to do something special when the axiom is not `axioms.Commutative`.\n\nAlso, `__init__`, `__repr__`, and `index` of `Axiom` do not have doctests.",
    "created_at": "2017-05-10T23:11:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22728#issuecomment-317350",
    "user": "tscrim"
}
```

If you want to keep the `__eq__`, then you really need to define a `__ne__` to keep things consistent in case someone wants to test inequality. A slightly contrived example, but say someone has a constructor that accepts an axiom as an arg and they want to do something special when the axiom is not `axioms.Commutative`.

Also, `__init__`, `__repr__`, and `index` of `Axiom` do not have doctests.



---

archive/issue_comments_317351.json:
```json
{
    "body": "I'm not really commenting on whether you should define an `__eq__` or not.",
    "created_at": "2017-05-10T23:12:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22728#issuecomment-317351",
    "user": "tscrim"
}
```

I'm not really commenting on whether you should define an `__eq__` or not.



---

archive/issue_comments_317352.json:
```json
{
    "body": "Also, why does `Axiom` inherit from `SageObject`? What features are you using?",
    "created_at": "2017-05-10T23:13:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22728#issuecomment-317352",
    "user": "tscrim"
}
```

Also, why does `Axiom` inherit from `SageObject`? What features are you using?



---

archive/issue_comments_317353.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-05-10T23:17:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22728#issuecomment-317353",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_317354.json:
```json
{
    "body": "Replying to [comment:19 tscrim]:\n> Also, why does `Axiom` inherit from `SageObject`? What features are you using?\n\nI believe none at this stage. I just put that by default, mostly for consistency with Category.",
    "created_at": "2017-05-11T02:36:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22728#issuecomment-317354",
    "user": "nthiery"
}
```

Replying to [comment:19 tscrim]:
> Also, why does `Axiom` inherit from `SageObject`? What features are you using?

I believe none at this stage. I just put that by default, mostly for consistency with Category.



---

archive/issue_comments_317355.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-05-11T02:39:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22728#issuecomment-317355",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_317356.json:
```json
{
    "body": "Hi; any comment on the questions raised in the description?",
    "created_at": "2017-05-16T14:59:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22728#issuecomment-317356",
    "user": "nthiery"
}
```

Hi; any comment on the questions raised in the description?



---

archive/issue_comments_317357.json:
```json
{
    "body": "> - Inside the code, do we want to call the catalog of axioms\n>   `all_axioms` or `axioms`? The latter is more ambiguous,\n>   but consistent with the name exported in global name space.\n\nI say `axioms` both for consistency and naturality.\n\n> - To fetch an existing axiom from a variable containing either the\n>   axiom or its name, the current idiom is `all_axioms(name)`; that's\n>   somewhat consistent with the `P(xx)` idiom to create elements of a\n>   parent. Would we want some other idiom? `all_axioms[name]`?\n\nI would go for the latter since it is a container object and `all_axioms[name]` is how Python handles other container objects, e.g., `dict`.\n\n> - Do we want to implement a `cmp` method for axioms?\n\nNo, but rich comparisons are good.\n\n>   - Comparing by string: this could avoid the repeated use of\n>     `sorted(...,key=str)` in our documentation\n>   - Comparing by index/definition time? This would be plausibly more\n>     meaningful (axioms shown in some natural order). And simplify\n>     a very tiny bit the one place where this sorting order is used in\n>     the code.\n\nDefinitely Index/definition time as this will allow us to control the printing in a more straightforward way.\n\n> - Do we want to Cythonize axiom.py? Now? Later?\n\nI am inclined to say Cythonize it to keep the categories as fast as possible. I feel like even if highly optimized, this switch will slow down category creation because the string operations are lightweight and optimized at the machine level. However, I haven't done any timings.\n\nAlso, it would be good if you could get rid of the `SageObject` inheritance from `Axiom` so we could `cdef` it, and I don't see axioms fundamentally behaving like other instances of `SageObject`.\n\n> - Do we want to import `all_axioms` from `category_with_axiom` rather than\n>   `axiom`? This would avoid a double import in all the files specifying\n>   `_base_category_and_axiom`\n\n> - Do we want \"additive magmas\" to be renamed to \"additive-magmas\" for consistency?\n\nI don't think the hyphen there is completely grammatically correct, at least it is strange to me. So I'm -1.\n\n> - Do we want to fix the inconsistency below by adding `additive-` in\n>   the first output?\n> \n>   {{{\n>   sage: CommutativeAdditiveGroups()\n>   Category of commutative additive groups\n>   sage: AdditiveMagmas().AdditiveCommutative()\n>   Category of additive-commutative additive magmas\n>   }}}\n\nI would like the latter to be\n\n```\nCategory of commutative additive magmas\n```\n\nas this is more concise and easier to parse.\n\n> - To recover the string associated to an axiom in the code, is it fine\n>   to use `str(axiom)`, or do we want something more explicit and\n>   possibly distinct from printing like `axiom.name()`?\n\n`str(axiom)` is the most natural for me, but it doesn't hurt to have an alias `axiom.name()`.\n\n> - Any better name for `axiom.index()`? It's only used internally,\n>   and in a single place; we could also just use `axiom._index`.\n\nI would get rid of it all together and (mildly) break encapsulation here by using `axiom._index`. It is both faster, only done in one place, and is an implementation detail.",
    "created_at": "2017-05-16T22:26:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22728#issuecomment-317357",
    "user": "tscrim"
}
```

> - Inside the code, do we want to call the catalog of axioms
>   `all_axioms` or `axioms`? The latter is more ambiguous,
>   but consistent with the name exported in global name space.

I say `axioms` both for consistency and naturality.

> - To fetch an existing axiom from a variable containing either the
>   axiom or its name, the current idiom is `all_axioms(name)`; that's
>   somewhat consistent with the `P(xx)` idiom to create elements of a
>   parent. Would we want some other idiom? `all_axioms[name]`?

I would go for the latter since it is a container object and `all_axioms[name]` is how Python handles other container objects, e.g., `dict`.

> - Do we want to implement a `cmp` method for axioms?

No, but rich comparisons are good.

>   - Comparing by string: this could avoid the repeated use of
>     `sorted(...,key=str)` in our documentation
>   - Comparing by index/definition time? This would be plausibly more
>     meaningful (axioms shown in some natural order). And simplify
>     a very tiny bit the one place where this sorting order is used in
>     the code.

Definitely Index/definition time as this will allow us to control the printing in a more straightforward way.

> - Do we want to Cythonize axiom.py? Now? Later?

I am inclined to say Cythonize it to keep the categories as fast as possible. I feel like even if highly optimized, this switch will slow down category creation because the string operations are lightweight and optimized at the machine level. However, I haven't done any timings.

Also, it would be good if you could get rid of the `SageObject` inheritance from `Axiom` so we could `cdef` it, and I don't see axioms fundamentally behaving like other instances of `SageObject`.

> - Do we want to import `all_axioms` from `category_with_axiom` rather than
>   `axiom`? This would avoid a double import in all the files specifying
>   `_base_category_and_axiom`

> - Do we want "additive magmas" to be renamed to "additive-magmas" for consistency?

I don't think the hyphen there is completely grammatically correct, at least it is strange to me. So I'm -1.

> - Do we want to fix the inconsistency below by adding `additive-` in
>   the first output?
> 
>   {{{
>   sage: CommutativeAdditiveGroups()
>   Category of commutative additive groups
>   sage: AdditiveMagmas().AdditiveCommutative()
>   Category of additive-commutative additive magmas
>   }}}

I would like the latter to be

```
Category of commutative additive magmas
```

as this is more concise and easier to parse.

> - To recover the string associated to an axiom in the code, is it fine
>   to use `str(axiom)`, or do we want something more explicit and
>   possibly distinct from printing like `axiom.name()`?

`str(axiom)` is the most natural for me, but it doesn't hurt to have an alias `axiom.name()`.

> - Any better name for `axiom.index()`? It's only used internally,
>   and in a single place; we could also just use `axiom._index`.

I would get rid of it all together and (mildly) break encapsulation here by using `axiom._index`. It is both faster, only done in one place, and is an implementation detail.



---

archive/issue_comments_317358.json:
```json
{
    "body": "Looks like there are a lot of things in the comments to still be addressed and merge conflicts that need to be resolved.",
    "created_at": "2017-08-31T05:38:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22728#issuecomment-317358",
    "user": "mderickx"
}
```

Looks like there are a lot of things in the comments to still be addressed and merge conflicts that need to be resolved.



---

archive/issue_comments_317359.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-08-31T05:38:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22728#issuecomment-317359",
    "user": "mderickx"
}
```

Changing status from needs_review to needs_work.
