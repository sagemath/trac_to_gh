# Issue 27747: Coercion of inputs of nth_iterate into projective space

archive/issues_027747.json:
```json
{
    "body": "Keywords: SI2019\n\nThe following code outputs an element of the integer ring instead of projective space:\n\n```\nsage: P.<x,y> = ProjectiveSpace(QQ,1)\nsage: f = DynamicalSystem([x^2 + y^2, y^2])\nsage: Q = f.nth_iterate(0,0)\nsage: Q.parent()\nInteger Ring\n```\n\nNeed to coerce the input into projective space when it's not already entered as such.\n\nIssue created by migration from https://trac.sagemath.org/ticket/27984\n\n",
    "created_at": "2019-06-13T15:51:45Z",
    "labels": [
        "component: dynamics",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.9",
    "title": "Coercion of inputs of nth_iterate into projective space",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27747",
    "user": "https://trac.sagemath.org/admin/accounts/users/jdoyle"
}
```
Keywords: SI2019

The following code outputs an element of the integer ring instead of projective space:

```
sage: P.<x,y> = ProjectiveSpace(QQ,1)
sage: f = DynamicalSystem([x^2 + y^2, y^2])
sage: Q = f.nth_iterate(0,0)
sage: Q.parent()
Integer Ring
```

Need to coerce the input into projective space when it's not already entered as such.

Issue created by migration from https://trac.sagemath.org/ticket/27984





---

archive/issue_comments_391565.json:
```json
{
    "body": "As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).",
    "created_at": "2019-06-14T14:55:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27747#issuecomment-391565",
    "user": "https://github.com/embray"
}
```

As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).



---

archive/issue_comments_391566.json:
```json
{
    "body": "As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).",
    "created_at": "2019-06-14T14:57:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27747#issuecomment-391566",
    "user": "https://github.com/embray"
}
```

As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).



---

archive/issue_comments_391567.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-06-18T18:33:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27747#issuecomment-391567",
    "user": "https://github.com/erachfal"
}
```

New commits:



---

archive/issue_comments_391568.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-06-18T18:33:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27747#issuecomment-391568",
    "user": "https://github.com/erachfal"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_391569.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-06-20T14:22:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27747#issuecomment-391569",
    "user": "https://github.com/Loops7"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_391570.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-06-20T14:22:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27747#issuecomment-391570",
    "user": "https://github.com/Loops7"
}
```

New commits:



---

archive/issue_events_069347.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-06-21T11:55:12Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27747",
    "milestone": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27747#event-69347"
}
```



---

archive/issue_comments_391571.json:
```json
{
    "body": "I assumed that the missing milestone was 8.9",
    "created_at": "2019-06-21T11:55:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27747#issuecomment-391571",
    "user": "https://github.com/fchapoton"
}
```

I assumed that the missing milestone was 8.9



---

archive/issue_comments_391572.json:
```json
{
    "body": "Test fail:\n\n```\n**********************************************************************\nFile \"src/sage/schemes/projective/projective_subscheme.py\", line 472, in sage.schemes.projective.projective_subscheme.AlgebraicScheme_subscheme_projective.orbit\nFailed example:\n    f.orbit(P.subscheme([x]),5)\nException raised:\n    Traceback (most recent call last):\n      File \"/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1105, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.schemes.projective.projective_subscheme.AlgebraicScheme_subscheme_projective.orbit[2]>\", line 1, in <module>\n        f.orbit(P.subscheme([x]),Integer(5))\n      File \"/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/dynamics/arithmetic_dynamics/projective_ds.py\", line 1312, in orbit\n        Q = self(Q, check)\n      File \"/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/schemes/projective/projective_morphism.py\", line 332, in __call__\n        raise TypeError(\"%s fails to convert into the map's domain %s, but a `pushforward` method is not properly implemented\"%(x, self.domain()))\n    TypeError: Set of morphisms\n      From: Closed subscheme of Projective Space of dimension 3 over Rational Field defined by:\n      x\n      To:   Projective Space of dimension 3 over Rational Field fails to convert into the map's domain Projective Space of dimension 3 over Rational Field, but a `pushforward` method is not properly implemented\n**********************************************************************\nFile \"src/sage/schemes/projective/projective_subscheme.py\", line 554, in sage.schemes.projective.projective_subscheme.AlgebraicScheme_subscheme_projective.nth_iterate\nFailed example:\n    f.nth_iterate(P.subscheme([x-w,y-z]), 3)\nException raised:\n    Traceback (most recent call last):\n      File \"/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1105, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.schemes.projective.projective_subscheme.AlgebraicScheme_subscheme_projective.nth_iterate[2]>\", line 1, in <module>\n        f.nth_iterate(P.subscheme([x-w,y-z]), Integer(3))\n      File \"/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/dynamics/arithmetic_dynamics/projective_ds.py\", line 1069, in nth_iterate\n        return self.orbit(P, [n,n+1], **kwds)[0]\n      File \"/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/dynamics/arithmetic_dynamics/projective_ds.py\", line 1307, in orbit\n        Q = self(Q, check)\n      File \"/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/schemes/projective/projective_morphism.py\", line 332, in __call__\n        raise TypeError(\"%s fails to convert into the map's domain %s, but a `pushforward` method is not properly implemented\"%(x, self.domain()))\n    TypeError: Set of morphisms\n      From: Closed subscheme of Projective Space of dimension 3 over Rational Field defined by:\n      x - w,\n      y - z\n      To:   Projective Space of dimension 3 over Rational Field fails to convert into the map's domain Projective Space of dimension 3 over Rational Field, but a `pushforward` method is not properly implemented\n**********************************************************************\n```",
    "created_at": "2019-07-07T12:34:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27747#issuecomment-391572",
    "user": "https://github.com/vbraun"
}
```

Test fail:

```
**********************************************************************
File "src/sage/schemes/projective/projective_subscheme.py", line 472, in sage.schemes.projective.projective_subscheme.AlgebraicScheme_subscheme_projective.orbit
Failed example:
    f.orbit(P.subscheme([x]),5)
Exception raised:
    Traceback (most recent call last):
      File "/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1105, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.schemes.projective.projective_subscheme.AlgebraicScheme_subscheme_projective.orbit[2]>", line 1, in <module>
        f.orbit(P.subscheme([x]),Integer(5))
      File "/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/dynamics/arithmetic_dynamics/projective_ds.py", line 1312, in orbit
        Q = self(Q, check)
      File "/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/schemes/projective/projective_morphism.py", line 332, in __call__
        raise TypeError("%s fails to convert into the map's domain %s, but a `pushforward` method is not properly implemented"%(x, self.domain()))
    TypeError: Set of morphisms
      From: Closed subscheme of Projective Space of dimension 3 over Rational Field defined by:
      x
      To:   Projective Space of dimension 3 over Rational Field fails to convert into the map's domain Projective Space of dimension 3 over Rational Field, but a `pushforward` method is not properly implemented
**********************************************************************
File "src/sage/schemes/projective/projective_subscheme.py", line 554, in sage.schemes.projective.projective_subscheme.AlgebraicScheme_subscheme_projective.nth_iterate
Failed example:
    f.nth_iterate(P.subscheme([x-w,y-z]), 3)
Exception raised:
    Traceback (most recent call last):
      File "/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1105, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.schemes.projective.projective_subscheme.AlgebraicScheme_subscheme_projective.nth_iterate[2]>", line 1, in <module>
        f.nth_iterate(P.subscheme([x-w,y-z]), Integer(3))
      File "/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/dynamics/arithmetic_dynamics/projective_ds.py", line 1069, in nth_iterate
        return self.orbit(P, [n,n+1], **kwds)[0]
      File "/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/dynamics/arithmetic_dynamics/projective_ds.py", line 1307, in orbit
        Q = self(Q, check)
      File "/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/schemes/projective/projective_morphism.py", line 332, in __call__
        raise TypeError("%s fails to convert into the map's domain %s, but a `pushforward` method is not properly implemented"%(x, self.domain()))
    TypeError: Set of morphisms
      From: Closed subscheme of Projective Space of dimension 3 over Rational Field defined by:
      x - w,
      y - z
      To:   Projective Space of dimension 3 over Rational Field fails to convert into the map's domain Projective Space of dimension 3 over Rational Field, but a `pushforward` method is not properly implemented
**********************************************************************
```



---

archive/issue_comments_391573.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-07-07T12:34:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27747#issuecomment-391573",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_391574.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-07-18T14:59:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27747#issuecomment-391574",
    "user": "https://github.com/erachfal"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_391575.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-07-18T14:59:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27747#issuecomment-391575",
    "user": "https://github.com/erachfal"
}
```

New commits:



---

archive/issue_comments_391576.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-07-25T13:55:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27747#issuecomment-391576",
    "user": "https://trac.sagemath.org/admin/accounts/users/gjorgenson"
}
```

New commits:



---

archive/issue_comments_391577.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-07-25T14:16:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27747#issuecomment-391577",
    "user": "https://trac.sagemath.org/admin/accounts/users/gjorgenson"
}
```

New commits:



---

archive/issue_comments_391578.json:
```json
{
    "body": "The trailing whitespace commit is now based on top of a clean copy of all the previous commits for this ticket, so this should be good to go.",
    "created_at": "2019-07-25T14:20:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27747#issuecomment-391578",
    "user": "https://trac.sagemath.org/admin/accounts/users/gjorgenson"
}
```

The trailing whitespace commit is now based on top of a clean copy of all the previous commits for this ticket, so this should be good to go.



---

archive/issue_comments_391579.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-07-25T14:23:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27747#issuecomment-391579",
    "user": "https://github.com/jasminecamero"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_391580.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-07-29T21:54:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27747#issuecomment-391580",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_069348.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-07-29T21:54:30Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27747",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27747#event-69348"
}
```
