# Issue 11546: Upgrade LinBox to version 1.1.7

Issue created by migration from https://trac.sagemath.org/ticket/11718

Original creator: malb

Original creation time: 2011-08-23 04:49:19

Assignee: tbd

CC:  fbissey cschwan vbraun cpernet kcrisman

LinBox 1.1.7 was release in 2010, yet we are still running 1.1.6. It fixes a few issues which are relevant to Sage


---

Comment by malb created at 2011-08-23 18:37:03

*Status update*

LinBox's Sage interface changed and this causes major problems. The attached patch is supposed to address this new interface but I cannot successfully link against `liblinboxsage.so` any more. 

I get


```python
    846                 import matrix_complex_double_dense
    847                 return matrix_complex_double_dense.Matrix_complex_double_dense
--> 848             elif sage.rings.finite_rings.integer_mod_ring.is_IntegerModRing(R) and R.order() < matrix_modn_dense.MAX_MODULUS:
    849                 if R.order() == 2:
    850                     return matrix_mod2_dense.Matrix_mod2_dense

AttributeError: 'module' object has no attribute 'MAX_MODULUS'
```


However, this is not a Python problem. If I remove *everything* from `linbox.pyx` except for


```python
cdef class Foo:
    pass
```


and remove *all* references to LinBox except for one `cimport` of it in `matrix_modn_dense` *and* I empty out `linbox-sage.C` in the LinBox !SPKG except for


```c
#include <iostream>
#include <gmp.h>

#include <cstdlib>
#include <vector>
#include <list>

#include "linbox-sage.h"

#include <linbox/util/commentator.h>

#include <linbox/blackbox/sparse.h>

#include "linbox/element/givaro-polynomial.h"

#include <linbox/matrix/blas-matrix.h>
#include <linbox/matrix/sparse.h>
#include <linbox/vector/sparse.h>

#include <linbox/algorithms/blas-domain.h>
#include <linbox/algorithms/echelon-form.h>
#include "linbox/algorithms/gauss.h"
#include "linbox/algorithms/smith-form-adaptive.h"
#include "linbox/ffpack/ffpack.h"
#include <linbox/solutions/rank.h>          
#include <linbox/solutions/det.h>
#include <linbox/solutions/solve.h>

#include "linbox/solutions/methods.h"
#include <linbox/solutions/minpoly.h>
#include "linbox/algorithms/double-det.h"
#include <linbox/integer.h>

#include <linbox/field/gmp-rational.h>
#include <linbox/ring/givaro-polynomial.h>
```


I still get this problem. Hence, I figure it should have something to do with the linking. That is, I assume LinBox overwrites some symbol or corrupts some memory somehow which makes it impossible to link against it from Sage.

However, I am out of ideas and steam. Hence, I'll give up on fixing this for now. 
But I will send an e-mail to the LinBox list.

*PS:* We also get the same `UINT32_MAX` error as #9511 on sage.math


---

Comment by malb created at 2011-08-24 21:17:52

The updated patch + SPKG seems to fix the issue, testing on sage.math now


---

Comment by malb created at 2011-08-24 21:18:41

The updated patch + SPKG seems to fix the issue, testing on sage.math now


---

Attachment

Well, we further but we don't reach the finish line:


```
sage -t -gdb "/home/malb/Sage/linbox/devel/sage/sage/matrix/matrix_modn_dense.pyx"
********************************************************************************
Type r at the (gdb) prompt to run the doctests.
Type bt if there is a crash to see a traceback.
********************************************************************************
GNU gdb (GDB) 7.2-debian
Copyright (C) 2010 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
For bug reporting instructions, please see:
<http://www.gnu.org/software/gdb/bugs/>...
Reading symbols from /opt/sage-4.7.1-linbox/local/bin/python...done.
(gdb) r
Starting program: /opt/sage-4.7.1-linbox/local/bin/python /home/malb/.sage//tmp/.doctest_matrix_modn_dense.py
[Thread debugging using libthread_db enabled]

Program received signal SIGSEGV, Segmentation fault.
0x00007ffff48bd545 in std::basic_ostream<char, std::char_traits<char> >::sentry::sentry(std::basic_ostream<char, std::char_traits<char> >&) () from /usr/lib/x86_64-linux-gnu/libstdc++.so.6
#1  0x00007ffff48bdc59 in std::basic_ostream<char, std::char_traits<char> >& std::__ostream_insert<char, std::char_traits<char> >(std::basic_ostream<char, std::char_traits<char> >&, char const*, long) ()
   from /usr/lib/x86_64-linux-gnu/libstdc++.so.6
#2  0x00007ffff48be05f in std::basic_ostream<char, std::char_traits<char> >& std::operator<< <std::char_traits<char> >(std::basic_ostream<char, std::char_traits<char> >&, char const*) ()
   from /usr/lib/x86_64-linux-gnu/libstdc++.so.6
#3  0x00007fffdc91ef76 in ModularRandIter (F=..., frobeniusForm=..., N=3, A=0x4b56840, lda=3, c=30) at ../../linbox/randiter/modular.h:92
92                              commentator.report (10, INTERNAL_DESCRIPTION)
```



---

Comment by kcrisman created at 2012-01-31 02:10:47

Interestingly, a related change about "commentator" apparently was [helpful](http://groups.google.com/group/sage-devel/browse_thread/thread/2feec7c5511c4ae5/910b7f95f297678b) in trying to get Sage to build on FreeBSD.


---

Comment by kcrisman created at 2012-01-31 02:10:47

Changing keywords from "" to "freebsd".


---

Comment by leif created at 2012-04-22 01:49:10

Just for the record:

There's a LinBox 1.1.6.p8 spkg with a couple of fixes at #12762 (currently still needing review).


---

Comment by malb created at 2012-06-18 13:05:36

Please close this ticket as a duplicate.


---

Comment by vbraun created at 2012-06-18 13:16:30

Changing status from new to needs_review.


---

Comment by vbraun created at 2012-06-18 13:16:30

Changing keywords from "freebsd" to "".


---

Comment by vbraun created at 2012-06-18 13:16:42

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2012-06-18 13:16:42

Agreed


---

Comment by jdemeyer created at 2012-06-18 15:55:48

Changing status from positive_review to needs_info.


---

Comment by jdemeyer created at 2012-06-18 15:55:48

Duplicate of what?


---

Comment by malb created at 2012-06-18 15:58:10

It's a duplicate of #12883


---

Comment by vbraun created at 2012-06-18 16:14:19

Changing status from needs_info to needs_review.


---

Comment by vbraun created at 2012-06-18 16:15:00

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2012-08-15 07:57:11

Resolution: duplicate
