# Issue 11546: Upgrade LinBox to version 1.1.7

archive/issues_011546.json:
```json
{
    "body": "Assignee: tbd\n\nCC:  fbissey cschwan vbraun cpernet kcrisman\n\nLinBox 1.1.7 was release in 2010, yet we are still running 1.1.6. It fixes a few issues which are relevant to Sage\n\nIssue created by migration from https://trac.sagemath.org/ticket/11718\n\n",
    "created_at": "2011-08-23T04:49:19Z",
    "labels": [
        "packages: standard",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Upgrade LinBox to version 1.1.7",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11546",
    "user": "malb"
}
```
Assignee: tbd

CC:  fbissey cschwan vbraun cpernet kcrisman

LinBox 1.1.7 was release in 2010, yet we are still running 1.1.6. It fixes a few issues which are relevant to Sage

Issue created by migration from https://trac.sagemath.org/ticket/11718





---

archive/issue_comments_129820.json:
```json
{
    "body": "**Status update**\n\nLinBox's Sage interface changed and this causes major problems. The attached patch is supposed to address this new interface but I cannot successfully link against `liblinboxsage.so` any more. \n\nI get\n\n\n```python\n    846                 import matrix_complex_double_dense\n    847                 return matrix_complex_double_dense.Matrix_complex_double_dense\n--> 848             elif sage.rings.finite_rings.integer_mod_ring.is_IntegerModRing(R) and R.order() < matrix_modn_dense.MAX_MODULUS:\n    849                 if R.order() == 2:\n    850                     return matrix_mod2_dense.Matrix_mod2_dense\n\nAttributeError: 'module' object has no attribute 'MAX_MODULUS'\n```\n\n\nHowever, this is not a Python problem. If I remove **everything** from `linbox.pyx` except for\n\n\n```python\ncdef class Foo:\n    pass\n```\n\n\nand remove **all** references to LinBox except for one `cimport` of it in `matrix_modn_dense` **and** I empty out `linbox-sage.C` in the LinBox !SPKG except for\n\n\n```c\n#include <iostream>\n#include <gmp.h>\n\n#include <cstdlib>\n#include <vector>\n#include <list>\n\n#include \"linbox-sage.h\"\n\n#include <linbox/util/commentator.h>\n\n#include <linbox/blackbox/sparse.h>\n\n#include \"linbox/element/givaro-polynomial.h\"\n\n#include <linbox/matrix/blas-matrix.h>\n#include <linbox/matrix/sparse.h>\n#include <linbox/vector/sparse.h>\n\n#include <linbox/algorithms/blas-domain.h>\n#include <linbox/algorithms/echelon-form.h>\n#include \"linbox/algorithms/gauss.h\"\n#include \"linbox/algorithms/smith-form-adaptive.h\"\n#include \"linbox/ffpack/ffpack.h\"\n#include <linbox/solutions/rank.h>          \n#include <linbox/solutions/det.h>\n#include <linbox/solutions/solve.h>\n\n#include \"linbox/solutions/methods.h\"\n#include <linbox/solutions/minpoly.h>\n#include \"linbox/algorithms/double-det.h\"\n#include <linbox/integer.h>\n\n#include <linbox/field/gmp-rational.h>\n#include <linbox/ring/givaro-polynomial.h>\n```\n\n\nI still get this problem. Hence, I figure it should have something to do with the linking. That is, I assume LinBox overwrites some symbol or corrupts some memory somehow which makes it impossible to link against it from Sage.\n\nHowever, I am out of ideas and steam. Hence, I'll give up on fixing this for now. \nBut I will send an e-mail to the LinBox list.\n\n**PS:** We also get the same `UINT32_MAX` error as #9511 on sage.math",
    "created_at": "2011-08-23T18:37:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11546",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11546#issuecomment-129820",
    "user": "malb"
}
```

**Status update**

LinBox's Sage interface changed and this causes major problems. The attached patch is supposed to address this new interface but I cannot successfully link against `liblinboxsage.so` any more. 

I get


```python
    846                 import matrix_complex_double_dense
    847                 return matrix_complex_double_dense.Matrix_complex_double_dense
--> 848             elif sage.rings.finite_rings.integer_mod_ring.is_IntegerModRing(R) and R.order() < matrix_modn_dense.MAX_MODULUS:
    849                 if R.order() == 2:
    850                     return matrix_mod2_dense.Matrix_mod2_dense

AttributeError: 'module' object has no attribute 'MAX_MODULUS'
```


However, this is not a Python problem. If I remove **everything** from `linbox.pyx` except for


```python
cdef class Foo:
    pass
```


and remove **all** references to LinBox except for one `cimport` of it in `matrix_modn_dense` **and** I empty out `linbox-sage.C` in the LinBox !SPKG except for


```c
#include <iostream>
#include <gmp.h>

#include <cstdlib>
#include <vector>
#include <list>

#include "linbox-sage.h"

#include <linbox/util/commentator.h>

#include <linbox/blackbox/sparse.h>

#include "linbox/element/givaro-polynomial.h"

#include <linbox/matrix/blas-matrix.h>
#include <linbox/matrix/sparse.h>
#include <linbox/vector/sparse.h>

#include <linbox/algorithms/blas-domain.h>
#include <linbox/algorithms/echelon-form.h>
#include "linbox/algorithms/gauss.h"
#include "linbox/algorithms/smith-form-adaptive.h"
#include "linbox/ffpack/ffpack.h"
#include <linbox/solutions/rank.h>          
#include <linbox/solutions/det.h>
#include <linbox/solutions/solve.h>

#include "linbox/solutions/methods.h"
#include <linbox/solutions/minpoly.h>
#include "linbox/algorithms/double-det.h"
#include <linbox/integer.h>

#include <linbox/field/gmp-rational.h>
#include <linbox/ring/givaro-polynomial.h>
```


I still get this problem. Hence, I figure it should have something to do with the linking. That is, I assume LinBox overwrites some symbol or corrupts some memory somehow which makes it impossible to link against it from Sage.

However, I am out of ideas and steam. Hence, I'll give up on fixing this for now. 
But I will send an e-mail to the LinBox list.

**PS:** We also get the same `UINT32_MAX` error as #9511 on sage.math



---

archive/issue_comments_129821.json:
```json
{
    "body": "The updated patch + SPKG seems to fix the issue, testing on sage.math now",
    "created_at": "2011-08-24T21:17:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11546",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11546#issuecomment-129821",
    "user": "malb"
}
```

The updated patch + SPKG seems to fix the issue, testing on sage.math now



---

archive/issue_comments_129822.json:
```json
{
    "body": "The updated patch + SPKG seems to fix the issue, testing on sage.math now",
    "created_at": "2011-08-24T21:18:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11546",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11546#issuecomment-129822",
    "user": "malb"
}
```

The updated patch + SPKG seems to fix the issue, testing on sage.math now



---

archive/issue_comments_129823.json:
```json
{
    "body": "Attachment [trac_11718_linbox_1_1_7.patch](tarball://root/attachments/some-uuid/ticket11718/trac_11718_linbox_1_1_7.patch) by malb created at 2011-08-24 22:13:53\n\nWell, we further but we don't reach the finish line:\n\n\n```\nsage -t -gdb \"/home/malb/Sage/linbox/devel/sage/sage/matrix/matrix_modn_dense.pyx\"\n********************************************************************************\nType r at the (gdb) prompt to run the doctests.\nType bt if there is a crash to see a traceback.\n********************************************************************************\nGNU gdb (GDB) 7.2-debian\nCopyright (C) 2010 Free Software Foundation, Inc.\nLicense GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>\nThis is free software: you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law.  Type \"show copying\"\nand \"show warranty\" for details.\nThis GDB was configured as \"x86_64-linux-gnu\".\nFor bug reporting instructions, please see:\n<http://www.gnu.org/software/gdb/bugs/>...\nReading symbols from /opt/sage-4.7.1-linbox/local/bin/python...done.\n(gdb) r\nStarting program: /opt/sage-4.7.1-linbox/local/bin/python /home/malb/.sage//tmp/.doctest_matrix_modn_dense.py\n[Thread debugging using libthread_db enabled]\n\nProgram received signal SIGSEGV, Segmentation fault.\n0x00007ffff48bd545 in std::basic_ostream<char, std::char_traits<char> >::sentry::sentry(std::basic_ostream<char, std::char_traits<char> >&) () from /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n#1  0x00007ffff48bdc59 in std::basic_ostream<char, std::char_traits<char> >& std::__ostream_insert<char, std::char_traits<char> >(std::basic_ostream<char, std::char_traits<char> >&, char const*, long) ()\n   from /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n#2  0x00007ffff48be05f in std::basic_ostream<char, std::char_traits<char> >& std::operator<< <std::char_traits<char> >(std::basic_ostream<char, std::char_traits<char> >&, char const*) ()\n   from /usr/lib/x86_64-linux-gnu/libstdc++.so.6\n#3  0x00007fffdc91ef76 in ModularRandIter (F=..., frobeniusForm=..., N=3, A=0x4b56840, lda=3, c=30) at ../../linbox/randiter/modular.h:92\n92                              commentator.report (10, INTERNAL_DESCRIPTION)\n```\n",
    "created_at": "2011-08-24T22:13:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11546",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11546#issuecomment-129823",
    "user": "malb"
}
```

Attachment [trac_11718_linbox_1_1_7.patch](tarball://root/attachments/some-uuid/ticket11718/trac_11718_linbox_1_1_7.patch) by malb created at 2011-08-24 22:13:53

Well, we further but we don't reach the finish line:


```
sage -t -gdb "/home/malb/Sage/linbox/devel/sage/sage/matrix/matrix_modn_dense.pyx"
********************************************************************************
Type r at the (gdb) prompt to run the doctests.
Type bt if there is a crash to see a traceback.
********************************************************************************
GNU gdb (GDB) 7.2-debian
Copyright (C) 2010 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
For bug reporting instructions, please see:
<http://www.gnu.org/software/gdb/bugs/>...
Reading symbols from /opt/sage-4.7.1-linbox/local/bin/python...done.
(gdb) r
Starting program: /opt/sage-4.7.1-linbox/local/bin/python /home/malb/.sage//tmp/.doctest_matrix_modn_dense.py
[Thread debugging using libthread_db enabled]

Program received signal SIGSEGV, Segmentation fault.
0x00007ffff48bd545 in std::basic_ostream<char, std::char_traits<char> >::sentry::sentry(std::basic_ostream<char, std::char_traits<char> >&) () from /usr/lib/x86_64-linux-gnu/libstdc++.so.6
#1  0x00007ffff48bdc59 in std::basic_ostream<char, std::char_traits<char> >& std::__ostream_insert<char, std::char_traits<char> >(std::basic_ostream<char, std::char_traits<char> >&, char const*, long) ()
   from /usr/lib/x86_64-linux-gnu/libstdc++.so.6
#2  0x00007ffff48be05f in std::basic_ostream<char, std::char_traits<char> >& std::operator<< <std::char_traits<char> >(std::basic_ostream<char, std::char_traits<char> >&, char const*) ()
   from /usr/lib/x86_64-linux-gnu/libstdc++.so.6
#3  0x00007fffdc91ef76 in ModularRandIter (F=..., frobeniusForm=..., N=3, A=0x4b56840, lda=3, c=30) at ../../linbox/randiter/modular.h:92
92                              commentator.report (10, INTERNAL_DESCRIPTION)
```




---

archive/issue_comments_129824.json:
```json
{
    "body": "Interestingly, a related change about \"commentator\" apparently was [helpful](http://groups.google.com/group/sage-devel/browse_thread/thread/2feec7c5511c4ae5/910b7f95f297678b) in trying to get Sage to build on FreeBSD.",
    "created_at": "2012-01-31T02:10:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11546",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11546#issuecomment-129824",
    "user": "kcrisman"
}
```

Interestingly, a related change about "commentator" apparently was [helpful](http://groups.google.com/group/sage-devel/browse_thread/thread/2feec7c5511c4ae5/910b7f95f297678b) in trying to get Sage to build on FreeBSD.



---

archive/issue_comments_129825.json:
```json
{
    "body": "Changing keywords from \"\" to \"freebsd\".",
    "created_at": "2012-01-31T02:10:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11546",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11546#issuecomment-129825",
    "user": "kcrisman"
}
```

Changing keywords from "" to "freebsd".



---

archive/issue_comments_129826.json:
```json
{
    "body": "Just for the record:\n\nThere's a LinBox 1.1.6.p8 spkg with a couple of fixes at #12762 (currently still needing review).",
    "created_at": "2012-04-22T01:49:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11546",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11546#issuecomment-129826",
    "user": "leif"
}
```

Just for the record:

There's a LinBox 1.1.6.p8 spkg with a couple of fixes at #12762 (currently still needing review).



---

archive/issue_comments_129827.json:
```json
{
    "body": "Please close this ticket as a duplicate.",
    "created_at": "2012-06-18T13:05:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11546",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11546#issuecomment-129827",
    "user": "malb"
}
```

Please close this ticket as a duplicate.



---

archive/issue_comments_129828.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-06-18T13:16:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11546",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11546#issuecomment-129828",
    "user": "vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_129829.json:
```json
{
    "body": "Changing keywords from \"freebsd\" to \"\".",
    "created_at": "2012-06-18T13:16:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11546",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11546#issuecomment-129829",
    "user": "vbraun"
}
```

Changing keywords from "freebsd" to "".



---

archive/issue_comments_129830.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-06-18T13:16:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11546",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11546#issuecomment-129830",
    "user": "vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_129831.json:
```json
{
    "body": "Agreed",
    "created_at": "2012-06-18T13:16:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11546",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11546#issuecomment-129831",
    "user": "vbraun"
}
```

Agreed



---

archive/issue_comments_129832.json:
```json
{
    "body": "Changing status from positive_review to needs_info.",
    "created_at": "2012-06-18T15:55:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11546",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11546#issuecomment-129832",
    "user": "jdemeyer"
}
```

Changing status from positive_review to needs_info.



---

archive/issue_comments_129833.json:
```json
{
    "body": "Duplicate of what?",
    "created_at": "2012-06-18T15:55:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11546",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11546#issuecomment-129833",
    "user": "jdemeyer"
}
```

Duplicate of what?



---

archive/issue_comments_129834.json:
```json
{
    "body": "It's a duplicate of #12883",
    "created_at": "2012-06-18T15:58:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11546",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11546#issuecomment-129834",
    "user": "malb"
}
```

It's a duplicate of #12883



---

archive/issue_comments_129835.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2012-06-18T16:14:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11546",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11546#issuecomment-129835",
    "user": "vbraun"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_129836.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-06-18T16:15:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11546",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11546#issuecomment-129836",
    "user": "vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_129837.json:
```json
{
    "body": "Resolution: duplicate",
    "created_at": "2012-08-15T07:57:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11546",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11546#issuecomment-129837",
    "user": "jdemeyer"
}
```

Resolution: duplicate
