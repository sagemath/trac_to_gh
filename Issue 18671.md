# Issue 18671: mathematica interface hands if mathematica is not installed

archive/issues_018671.json:
```json
{
    "body": "CC:  @nathanncohen @etn40ff @NathanDunfield @seblabbe\n\n\n```\nsage: mathematica(1)\n```\n\nhangs indefinitely if `Mathematica` is not installed. The reason is that internally the script `$SAGE_LOCAL/bin/math-readline` is called by `Expect()`, and the latter hangs. This script should check that `math` is present in the path, before proceeding.\n\nIssue created by migration from https://trac.sagemath.org/ticket/18908\n\n",
    "created_at": "2015-07-15T15:23:41Z",
    "labels": [
        "component: interfaces: optional",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.8",
    "title": "mathematica interface hands if mathematica is not installed",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18671",
    "user": "https://github.com/dimpase"
}
```
CC:  @nathanncohen @etn40ff @NathanDunfield @seblabbe


```
sage: mathematica(1)
```

hangs indefinitely if `Mathematica` is not installed. The reason is that internally the script `$SAGE_LOCAL/bin/math-readline` is called by `Expect()`, and the latter hangs. This script should check that `math` is present in the path, before proceeding.

Issue created by migration from https://trac.sagemath.org/ticket/18908





---

archive/issue_comments_254002.json:
```json
{
    "body": "moving the discussion from the closed #16703 here.\nI propose the patch in the attached `public/18908` branch.\nI don't have a system with mathematica installed, I only tested it works nicely without `math` present, both stand-alone and as well as producing the right result when calling `mathematica(10)` from Sage.",
    "created_at": "2015-07-16T09:00:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18671#issuecomment-254002",
    "user": "https://github.com/dimpase"
}
```

moving the discussion from the closed #16703 here.
I propose the patch in the attached `public/18908` branch.
I don't have a system with mathematica installed, I only tested it works nicely without `math` present, both stand-alone and as well as producing the right result when calling `mathematica(10)` from Sage.



---

archive/issue_comments_254003.json:
```json
{
    "body": "Works for me, though I don't have mathematica either. Can someone who has it run the optional mathematica doctests with it?\n\nNathann",
    "created_at": "2015-07-16T09:04:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18671#issuecomment-254003",
    "user": "https://github.com/nathanncohen"
}
```

Works for me, though I don't have mathematica either. Can someone who has it run the optional mathematica doctests with it?

Nathann



---

archive/issue_comments_254004.json:
```json
{
    "body": "Replying to [comment:3 ncohen]:\n> Works for me, though I don't have mathematica either. Can someone who has it run the optional mathematica doctests with it?\n> \nworks for me with Mathematica 9, I don't seem to have Mathematica 10 though.\n(well, doctests fail due to numerical noise etc, but the patch itself looks good)",
    "created_at": "2015-07-16T09:08:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18671#issuecomment-254004",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:3 ncohen]:
> Works for me, though I don't have mathematica either. Can someone who has it run the optional mathematica doctests with it?
> 
works for me with Mathematica 9, I don't seem to have Mathematica 10 though.
(well, doctests fail due to numerical noise etc, but the patch itself looks good)



---

archive/issue_comments_254005.json:
```json
{
    "body": "I'll try to fix doctests for Mathematica 9 then...",
    "created_at": "2015-07-16T09:09:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18671#issuecomment-254005",
    "user": "https://github.com/dimpase"
}
```

I'll try to fix doctests for Mathematica 9 then...



---

archive/issue_comments_254006.json:
```json
{
    "body": "They may get pretty annoying when #18904 will be merged `;-)`",
    "created_at": "2015-07-16T09:10:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18671#issuecomment-254006",
    "user": "https://github.com/nathanncohen"
}
```

They may get pretty annoying when #18904 will be merged `;-)`



---

archive/issue_comments_254007.json:
```json
{
    "body": "basically a lot of output is texified, or semi-texified, for a reason I don't get. Typically I see things like\n\n```\nFile \"src/sage/interfaces/mathematica.py\", line 44, in sage.interfaces.mathematica\nFailed example:\n    mathematica('Factor[x^2-1]')          # optional - mathematica\nExpected:\n    (-1 + x)*(1 + x)\nGot:\n    (x-1) (x+1)\n**********************************************************************\nFile \"src/sage/interfaces/mathematica.py\", line 46, in sage.interfaces.mathematica\nFailed example:\n    mathematica('Range[3]')               # optional - mathematica\nExpected:\n    {1, 2, 3}\nGot:\n    \\{1,2,3\\}\n```\n\n\nNow, the hard question: where does one have the place to describe the (pseudo)package type, \ni.e. optional vs experimental?!",
    "created_at": "2015-07-16T09:16:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18671#issuecomment-254007",
    "user": "https://github.com/dimpase"
}
```

basically a lot of output is texified, or semi-texified, for a reason I don't get. Typically I see things like

```
File "src/sage/interfaces/mathematica.py", line 44, in sage.interfaces.mathematica
Failed example:
    mathematica('Factor[x^2-1]')          # optional - mathematica
Expected:
    (-1 + x)*(1 + x)
Got:
    (x-1) (x+1)
**********************************************************************
File "src/sage/interfaces/mathematica.py", line 46, in sage.interfaces.mathematica
Failed example:
    mathematica('Range[3]')               # optional - mathematica
Expected:
    {1, 2, 3}
Got:
    \{1,2,3\}
```


Now, the hard question: where does one have the place to describe the (pseudo)package type, 
i.e. optional vs experimental?!



---

archive/issue_comments_254008.json:
```json
{
    "body": "Replying to [comment:5 dimpase]:\n> I'll try to fix doctests for Mathematica 9 then...\n\nsee also #18888 which tries to fix doctests for Mathematica 10 to avoid conflicts...",
    "created_at": "2015-07-16T10:05:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18671#issuecomment-254008",
    "user": "https://github.com/seblabbe"
}
```

Replying to [comment:5 dimpase]:
> I'll try to fix doctests for Mathematica 9 then...

see also #18888 which tries to fix doctests for Mathematica 10 to avoid conflicts...



---

archive/issue_comments_254009.json:
```json
{
    "body": "I have mathematica 10.1 but the machine is currently out of service. It should be back, hopefully, late next week; I can run the doctest then.",
    "created_at": "2015-07-16T10:13:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18671#issuecomment-254009",
    "user": "https://github.com/etn40ff"
}
```

I have mathematica 10.1 but the machine is currently out of service. It should be back, hopefully, late next week; I can run the doctest then.



---

archive/issue_comments_254010.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-07-16T10:20:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18671#issuecomment-254010",
    "user": "https://github.com/dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_254011.json:
```json
{
    "body": "Replying to [comment:8 slabbe]:\n> Replying to [comment:5 dimpase]:\n> > I'll try to fix doctests for Mathematica 9 then...\n> \n> see also #18888 which tries to fix doctests for Mathematica 10 to avoid conflicts...\nAh, OK, so let us not fix any doctests here then, do it on #18888 instead.",
    "created_at": "2015-07-16T10:20:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18671#issuecomment-254011",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:8 slabbe]:
> Replying to [comment:5 dimpase]:
> > I'll try to fix doctests for Mathematica 9 then...
> 
> see also #18888 which tries to fix doctests for Mathematica 10 to avoid conflicts...
Ah, OK, so let us not fix any doctests here then, do it on #18888 instead.



---

archive/issue_comments_254012.json:
```json
{
    "body": "I have `Mathematica 10.0 for Linux x86 (64-bit)` installed on my machine. I installed the branch. I did make start (I think sage -b does not update the script right?). And it seems to work:\n\n```\nsage: mathematica(10)\n10\n```\n\n\nTo make sure that the new code was really tested after the make start, I added some print:\n\n\n```\ndiff --git a/src/bin/math-readline b/src/bin/math-readline\nindex e6d40ef..ead0980 100755\n--- a/src/bin/math-readline\n+++ b/src/bin/math-readline\n@@ -11,6 +11,11 @@ try:\n except:\n     sys.exit('ERROR: executable math not found')\n \n+print \"NEW CODE IS BEING TESTED!!!\"\n+print \"NEW CODE IS BEING TESTED!!!\"\n+print \"NEW CODE IS BEING TESTED!!!\"\n+print \"NEW CODE IS BEING TESTED!!!\"\n+\n f1 = subprocess.Popen('math', shell=True, stdin=subprocess.PIPE).stdin\n f1.flush()\n try:\n```\n\n\ndid make start, run sage, but then, I still get\n\n```\nsage: mathematica(10)\n10\n```\n\nSo is the new code really run? Is it okay if the print are not shown?",
    "created_at": "2015-07-16T10:26:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18671#issuecomment-254012",
    "user": "https://github.com/seblabbe"
}
```

I have `Mathematica 10.0 for Linux x86 (64-bit)` installed on my machine. I installed the branch. I did make start (I think sage -b does not update the script right?). And it seems to work:

```
sage: mathematica(10)
10
```


To make sure that the new code was really tested after the make start, I added some print:


```
diff --git a/src/bin/math-readline b/src/bin/math-readline
index e6d40ef..ead0980 100755
--- a/src/bin/math-readline
+++ b/src/bin/math-readline
@@ -11,6 +11,11 @@ try:
 except:
     sys.exit('ERROR: executable math not found')
 
+print "NEW CODE IS BEING TESTED!!!"
+print "NEW CODE IS BEING TESTED!!!"
+print "NEW CODE IS BEING TESTED!!!"
+print "NEW CODE IS BEING TESTED!!!"
+
 f1 = subprocess.Popen('math', shell=True, stdin=subprocess.PIPE).stdin
 f1.flush()
 try:
```


did make start, run sage, but then, I still get

```
sage: mathematica(10)
10
```

So is the new code really run? Is it okay if the print are not shown?



---

archive/issue_comments_254013.json:
```json
{
    "body": "Perhaps you should run 'make' in Sage's ROOT folder before trying it again. This could copy the updated `math-realine` from `src/bin/` to `local/bin/`.",
    "created_at": "2015-07-16T10:28:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18671#issuecomment-254013",
    "user": "https://github.com/nathanncohen"
}
```

Perhaps you should run 'make' in Sage's ROOT folder before trying it again. This could copy the updated `math-realine` from `src/bin/` to `local/bin/`.



---

archive/issue_comments_254014.json:
```json
{
    "body": "I do see this line at the end of make start :\n\n```\ncp /home/labbe/Applications/sage-git/src/bin/math-readline /home/labbe/Applications/sage-git/local/bin/math-readline\n```\n",
    "created_at": "2015-07-16T10:30:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18671#issuecomment-254014",
    "user": "https://github.com/seblabbe"
}
```

I do see this line at the end of make start :

```
cp /home/labbe/Applications/sage-git/src/bin/math-readline /home/labbe/Applications/sage-git/local/bin/math-readline
```




---

archive/issue_comments_254015.json:
```json
{
    "body": "Replying to [comment:11 slabbe]:\n\n> So is the new code really run? Is it okay if the print are not shown?\n\nI think it is, you should not get the output of math-readline within sage. It should be stripped as it is stripped the header \n\n\n```\nMathematica 10.0 for Linux x86 (64-bit)\nCopyright 1988-2014 Wolfram Research, Inc.\n\n```\n",
    "created_at": "2015-07-16T10:37:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18671#issuecomment-254015",
    "user": "https://github.com/etn40ff"
}
```

Replying to [comment:11 slabbe]:

> So is the new code really run? Is it okay if the print are not shown?

I think it is, you should not get the output of math-readline within sage. It should be stripped as it is stripped the header 


```
Mathematica 10.0 for Linux x86 (64-bit)
Copyright 1988-2014 Wolfram Research, Inc.

```




---

archive/issue_comments_254016.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-07-16T10:59:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18671#issuecomment-254016",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_254017.json:
```json
{
    "body": "Ok, so then, positive review!",
    "created_at": "2015-07-16T10:59:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18671#issuecomment-254017",
    "user": "https://github.com/seblabbe"
}
```

Ok, so then, positive review!



---

archive/issue_comments_254018.json:
```json
{
    "body": "Changing status from positive_review to needs_info.",
    "created_at": "2015-07-16T11:19:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18671#issuecomment-254018",
    "user": "https://github.com/seblabbe"
}
```

Changing status from positive_review to needs_info.



---

archive/issue_comments_254019.json:
```json
{
    "body": "Wait, is there a way to doctest this fix?\n\n\n```\nmathematica(10)  # not mathematica\nSome error message...\n```\n",
    "created_at": "2015-07-16T11:19:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18671#issuecomment-254019",
    "user": "https://github.com/seblabbe"
}
```

Wait, is there a way to doctest this fix?


```
mathematica(10)  # not mathematica
Some error message...
```




---

archive/issue_comments_254020.json:
```json
{
    "body": "> Wait, is there a way to doctest this fix?\n\nNo, though others have asked (Dima in particular).\n\nYou should not change the status of a ticket in `positive_review` to ask a question unrelated to what the ticket is supposed to address.",
    "created_at": "2015-07-16T11:23:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18671#issuecomment-254020",
    "user": "https://github.com/nathanncohen"
}
```

> Wait, is there a way to doctest this fix?

No, though others have asked (Dima in particular).

You should not change the status of a ticket in `positive_review` to ask a question unrelated to what the ticket is supposed to address.



---

archive/issue_comments_254021.json:
```json
{
    "body": "Changing status from needs_info to positive_review.",
    "created_at": "2015-07-16T11:44:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18671#issuecomment-254021",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_info to positive_review.



---

archive/issue_comments_254022.json:
```json
{
    "body": "Ok sorry. Back to positive review.",
    "created_at": "2015-07-16T11:44:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18671#issuecomment-254022",
    "user": "https://github.com/seblabbe"
}
```

Ok sorry. Back to positive review.



---

archive/issue_comments_254023.json:
```json
{
    "body": "Replying to [comment:16 slabbe]:\n> Wait, is there a way to doctest this fix?\n> \n> {{{\n> mathematica(10)  # not mathematica\n> Some error message...\n> }}}\nlike this? \n\n```\ndiff --git a/src/sage/interfaces/mathematica.py b/src/sage/interfaces/mathematica.py\nindex aa5a848..04eaf9f 100644\n--- a/src/sage/interfaces/mathematica.py\n+++ b/src/sage/interfaces/mathematica.py\n@@ -729,6 +729,17 @@ class MathematicaElement(ExpectElement):\n             0\n \n \n+        TESTS::\n+\n+            sage: import subprocess                  # optional - nomathematica\n+            sage: try:                               # optional - nomathematica\n+            ....:     subprocess.check_output('which math', shell=True)  # optional - nomathematica\n+            ....: except:                            # optional - nomathematica\n+            ....:     mathematica(10)                # optional - nomathematica\n+            Traceback (most recent call last):\n+            ...\n+            TypeError: ...\n+\n         AUTHORS:\n \n         - Felix Lawrence (2010-11-03): Major rewrite to use ._sage_repr() and\n```\n",
    "created_at": "2015-07-16T11:58:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18671#issuecomment-254023",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:16 slabbe]:
> Wait, is there a way to doctest this fix?
> 
> {{{
> mathematica(10)  # not mathematica
> Some error message...
> }}}
like this? 

```
diff --git a/src/sage/interfaces/mathematica.py b/src/sage/interfaces/mathematica.py
index aa5a848..04eaf9f 100644
--- a/src/sage/interfaces/mathematica.py
+++ b/src/sage/interfaces/mathematica.py
@@ -729,6 +729,17 @@ class MathematicaElement(ExpectElement):
             0
 
 
+        TESTS::
+
+            sage: import subprocess                  # optional - nomathematica
+            sage: try:                               # optional - nomathematica
+            ....:     subprocess.check_output('which math', shell=True)  # optional - nomathematica
+            ....: except:                            # optional - nomathematica
+            ....:     mathematica(10)                # optional - nomathematica
+            Traceback (most recent call last):
+            ...
+            TypeError: ...
+
         AUTHORS:
 
         - Felix Lawrence (2010-11-03): Major rewrite to use ._sage_repr() and
```




---

archive/issue_comments_254024.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-07-16T14:55:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18671#issuecomment-254024",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_254025.json:
```json
{
    "body": "This is really the wrong fix.",
    "created_at": "2015-07-16T14:55:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18671#issuecomment-254025",
    "user": "https://github.com/jdemeyer"
}
```

This is really the wrong fix.



---

archive/issue_comments_254026.json:
```json
{
    "body": "I don't know what you are talking about. If I quit Sage with math available, I see\n\n```\nsage: \nExiting Sage (CPU time 0m2.48s, Wall time 36m25.69s).\nExiting Mathematica with PID 12864 running /home/scratch/dimpase/sage/sage/src/bin/math-readline\n```\n\nDo you mean to say that the last message is misleading?\n\nAnd of course if there is no `math` there then the script kills itself by `sys.exit()`.",
    "created_at": "2015-07-16T15:10:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18671#issuecomment-254026",
    "user": "https://github.com/dimpase"
}
```

I don't know what you are talking about. If I quit Sage with math available, I see

```
sage: 
Exiting Sage (CPU time 0m2.48s, Wall time 36m25.69s).
Exiting Mathematica with PID 12864 running /home/scratch/dimpase/sage/sage/src/bin/math-readline
```

Do you mean to say that the last message is misleading?

And of course if there is no `math` there then the script kills itself by `sys.exit()`.



---

archive/issue_comments_254027.json:
```json
{
    "body": "The patch on this ticket means to solve the problem of hanging if `math` is not present, no more than that. And it does it. I am not aware of any other problems, leave alone ways to reproduce these other problems.",
    "created_at": "2015-07-16T15:15:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18671#issuecomment-254027",
    "user": "https://github.com/dimpase"
}
```

The patch on this ticket means to solve the problem of hanging if `math` is not present, no more than that. And it does it. I am not aware of any other problems, leave alone ways to reproduce these other problems.



---

archive/issue_comments_254028.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2015-07-16T15:17:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18671#issuecomment-254028",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_254029.json:
```json
{
    "body": "I am setting it back to positive review. Please feel free to submit a proper error report, not \"wrong fix\" bullsh*t, and then change the ticket status accordingly.",
    "created_at": "2015-07-16T15:17:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18671#issuecomment-254029",
    "user": "https://github.com/dimpase"
}
```

I am setting it back to positive review. Please feel free to submit a proper error report, not "wrong fix" bullsh*t, and then change the ticket status accordingly.



---

archive/issue_comments_254030.json:
```json
{
    "body": "If I understand correctly what is being said by [comment:21  jdemeyer] the problem is this:\n\n\n```\n$ math-readline\nMathematica 10.0 for Linux x86 (64-bit)\nCopyright 1988-2014 Wolfram Research, Inc.\n\nIn[1]:= Exit\n\nTraceback (most recent call last):\n  File \"/opt/sage/local/bin/math-readline\", line 23, in <module>\n    f1.writelines(line+'\\n')\nIOError: [Errno 32] Broken pipe\n```\n\n\nwhich is quite ugly.",
    "created_at": "2015-07-16T15:19:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18671#issuecomment-254030",
    "user": "https://github.com/etn40ff"
}
```

If I understand correctly what is being said by [comment:21  jdemeyer] the problem is this:


```
$ math-readline
Mathematica 10.0 for Linux x86 (64-bit)
Copyright 1988-2014 Wolfram Research, Inc.

In[1]:= Exit

Traceback (most recent call last):
  File "/opt/sage/local/bin/math-readline", line 23, in <module>
    f1.writelines(line+'\n')
IOError: [Errno 32] Broken pipe
```


which is quite ugly.



---

archive/issue_comments_254031.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2015-07-16T15:20:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18671#issuecomment-254031",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_254032.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2015-07-16T15:20:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18671#issuecomment-254032",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_254033.json:
```json
{
    "body": "Changing component from interfaces: optional to scripts.",
    "created_at": "2015-07-16T15:22:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18671#issuecomment-254033",
    "user": "https://github.com/jdemeyer"
}
```

Changing component from interfaces: optional to scripts.



---

archive/issue_comments_254034.json:
```json
{
    "body": "Sometimes it is easier to just write a patch and explain later rather than the other way around. And unfortunately there is no ticket status for \"hang on, I'm working on a patch\".\n\nThe *real* problem with the script was that, when the `math` child process exited (for whatever reason, including Mathematica not being installed), the `math-readline` script did not exit. The proper fix is to check for the exiting of the child process. This works no matter for which reason the child process exited (which could be calling `Exit` in Mathematica, which could be Mathematica crashing, which could be Mathematica not being installed).",
    "created_at": "2015-07-16T15:26:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18671#issuecomment-254034",
    "user": "https://github.com/jdemeyer"
}
```

Sometimes it is easier to just write a patch and explain later rather than the other way around. And unfortunately there is no ticket status for "hang on, I'm working on a patch".

The *real* problem with the script was that, when the `math` child process exited (for whatever reason, including Mathematica not being installed), the `math-readline` script did not exit. The proper fix is to check for the exiting of the child process. This works no matter for which reason the child process exited (which could be calling `Exit` in Mathematica, which could be Mathematica crashing, which could be Mathematica not being installed).



---

archive/issue_comments_254035.json:
```json
{
    "body": "I also made a few more fixes to the script:\n1. actually using `readline`, which was the whole point of the script!\n2. removing the empty write `sys.stdout.write('')` (what was the point of that?).\n3. using `write()` instead of `writelines()` to write a single string.\n4. removing the unneeded `sys.exit()` at the end.",
    "created_at": "2015-07-16T15:30:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18671#issuecomment-254035",
    "user": "https://github.com/jdemeyer"
}
```

I also made a few more fixes to the script:
1. actually using `readline`, which was the whole point of the script!
2. removing the empty write `sys.stdout.write('')` (what was the point of that?).
3. using `write()` instead of `writelines()` to write a single string.
4. removing the unneeded `sys.exit()` at the end.



---

archive/issue_comments_254036.json:
```json
{
    "body": "Replying to [comment:20 jdemeyer]:\n> This is really the wrong fix.\nFYI, I found this comment very annoying. Unless you want to alienate people, always say in such cases instead \"I would like to improve this\".",
    "created_at": "2015-07-16T22:09:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18671#issuecomment-254036",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:20 jdemeyer]:
> This is really the wrong fix.
FYI, I found this comment very annoying. Unless you want to alienate people, always say in such cases instead "I would like to improve this".



---

archive/issue_comments_254037.json:
```json
{
    "body": "Replying to [comment:32 dimpase]:\n> Replying to [comment:20 jdemeyer]:\n> > This is really the wrong fix.\n> FYI, I found this comment very annoying. Unless you want to alienate people, always say in such cases instead \"I would like to improve this\". \n\nOK, point taken. What about \"This is really not the correct fix, I'm having a look at how to improve it\".",
    "created_at": "2015-07-17T06:00:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18671#issuecomment-254037",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:32 dimpase]:
> Replying to [comment:20 jdemeyer]:
> > This is really the wrong fix.
> FYI, I found this comment very annoying. Unless you want to alienate people, always say in such cases instead "I would like to improve this". 

OK, point taken. What about "This is really not the correct fix, I'm having a look at how to improve it".



---

archive/issue_comments_254038.json:
```json
{
    "body": "Replying to [comment:33 jdemeyer]:\n> Replying to [comment:32 dimpase]:\n> > Replying to [comment:20 jdemeyer]:\n> > > This is really the wrong fix.\n> > FYI, I found this comment very annoying. Unless you want to alienate people, always say in such cases instead \"I would like to improve this\". \n> \n> OK, point taken. What about \"This is really not the correct fix, I'm having a look at how to improve it\"\n\ns/correct/complete would do; indeed, saying that something is incorrect/wrong without giving an explanation could create a tension you don't need.",
    "created_at": "2015-07-17T07:16:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18671#issuecomment-254038",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:33 jdemeyer]:
> Replying to [comment:32 dimpase]:
> > Replying to [comment:20 jdemeyer]:
> > > This is really the wrong fix.
> > FYI, I found this comment very annoying. Unless you want to alienate people, always say in such cases instead "I would like to improve this". 
> 
> OK, point taken. What about "This is really not the correct fix, I'm having a look at how to improve it"

s/correct/complete would do; indeed, saying that something is incorrect/wrong without giving an explanation could create a tension you don't need.



---

archive/issue_comments_254039.json:
```json
{
    "body": "Replying to [comment:34 dimpase]:\n> saying that something is incorrect/wrong without giving an explanation could create a tension you don't need.\n\nBut it was really incorrect: the fact that the script hangs when `math` is not installed was a *symptom* of the problem, not the problem itself.\n\nBut at the time when I send that message, I didn't have a clear explanation of the real problem: I knew that the proposed solution was wrong, but I couldn't yet say what the right fix would be. Like I said: it's often easier to explain *after* you have a working patch.\n\nAnd I had to act quickly because, these days, tickets which have positive_review are often closed very soon.",
    "created_at": "2015-07-17T07:29:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18671#issuecomment-254039",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:34 dimpase]:
> saying that something is incorrect/wrong without giving an explanation could create a tension you don't need.

But it was really incorrect: the fact that the script hangs when `math` is not installed was a *symptom* of the problem, not the problem itself.

But at the time when I send that message, I didn't have a clear explanation of the real problem: I knew that the proposed solution was wrong, but I couldn't yet say what the right fix would be. Like I said: it's often easier to explain *after* you have a working patch.

And I had to act quickly because, these days, tickets which have positive_review are often closed very soon.



---

archive/issue_comments_254040.json:
```json
{
    "body": "The script hanged without `math` installed, and hanged Sage in return. And that few lines that were in the fix solved this particular issue, obviously an improvement. Anything that is an improvement cannot be called incorrect.",
    "created_at": "2015-07-17T07:39:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18671#issuecomment-254040",
    "user": "https://github.com/dimpase"
}
```

The script hanged without `math` installed, and hanged Sage in return. And that few lines that were in the fix solved this particular issue, obviously an improvement. Anything that is an improvement cannot be called incorrect.



---

archive/issue_comments_254041.json:
```json
{
    "body": "Replying to [comment:36 dimpase]:\n> Anything that is an improvement cannot be called incorrect.\nI completely disagree with this. An improvement which hides a bug is incorrect.",
    "created_at": "2015-07-17T09:29:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18671#issuecomment-254041",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:36 dimpase]:
> Anything that is an improvement cannot be called incorrect.
I completely disagree with this. An improvement which hides a bug is incorrect.



---

archive/issue_comments_254042.json:
```json
{
    "body": "lgtm",
    "created_at": "2015-07-17T09:29:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18671#issuecomment-254042",
    "user": "https://github.com/dimpase"
}
```

lgtm



---

archive/issue_comments_254043.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-07-17T09:29:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18671#issuecomment-254043",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_254044.json:
```json
{
    "body": "Replying to [comment:37 jdemeyer]:\n> Replying to [comment:36 dimpase]:\n> > Anything that is an improvement cannot be called incorrect.\n> I completely disagree with this. An improvement which hides a bug is incorrect.\nexcept that this one did not hide a bug, at least not any more than the original scrip did.\n \nAnyhow, this is not the point; the point is that you should not brand anything at all \"wrong\", \"incorrect\" without a justification. (Unless you out to annoy people, and I hope that this is not the case).",
    "created_at": "2015-07-17T09:33:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18671#issuecomment-254044",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:37 jdemeyer]:
> Replying to [comment:36 dimpase]:
> > Anything that is an improvement cannot be called incorrect.
> I completely disagree with this. An improvement which hides a bug is incorrect.
except that this one did not hide a bug, at least not any more than the original scrip did.
 
Anyhow, this is not the point; the point is that you should not brand anything at all "wrong", "incorrect" without a justification. (Unless you out to annoy people, and I hope that this is not the case).



---

archive/issue_events_052774.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-07-18T09:36:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18671",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18671#event-52774"
}
```



---

archive/issue_comments_254045.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-07-18T09:36:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18671#issuecomment-254045",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
