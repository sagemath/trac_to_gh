# Issue 13566: bug in multivariate factorization over prime fields

Issue created by migration from https://trac.sagemath.org/ticket/13770

Original creator: zimmerma

Original creation time: 2012-11-28 10:25:01

Assignee: malb

CC:  malb simonking alexanderdreyer

after #11829, #11838, #12918, #12928, #13672, here is another bug in multivariate arithmetic over prime fields:

```
----------------------------------------------------------------------
----------------------------------------------------------------------
sage: U.<y,t> = GF(2)[]  
sage: f
y*t^8 + y^5*t^2 + y*t^6 + t^7 + y^6 + y^5*t + y^2*t^4 + y^2*t^2 + y^2*t + t^3 + y^2 + t^2
sage: f.factor()
y*t^8 + y^5*t^2 + y*t^6 + t^7 + y^6 + y^5*t + y^2*t^4 + y^2*t^2 + y^2*t + t^3 + y^2 + t^2
sage: f % (t^2+t+y+1)
0
```

When will Sage be usable for this kind of computation?
| Sage Version 5.4.1, Release Date: 2012-11-15                       |
| Type "notebook()" for the browser-based notebook interface.        |
| Type "help()" for help.                                            |
Paul Zimmermann


---

Comment by zimmerma created at 2012-11-28 10:27:29

maybe one should consider replacing Singular by another more reliable component?

Paul


---

Comment by malb created at 2012-11-28 11:01:18

Paul,

to be fair #13672 isn't a bug in Singular but an issue with Pari and how we use it. Also, I am not sure there is a component we could use besides Singular for factoring. In any case, I've forwarded your bug report.


---

Comment by AlexanderDreyer created at 2012-11-28 11:50:30

Replying to [comment:1 zimmerma]:
> maybe one should consider replacing Singular by another more reliable component?
If there were any (for multivariate polynomials etc.), we would immediately use it in Singular.
BTW: when reported upstream, the response time is quite good, I think.


---

Comment by zimmerma created at 2012-12-03 12:06:25

from Martin Lee:
> I have just committed a fix for this under 15453.


---

Comment by zimmerma created at 2013-08-23 16:24:10

Martin Lee tells me the bug is fixed by this commit: https://github.com/Singular/Sources/pull/215

Also it is fixed in Singular 3-1-6. Any plan to upgrade the Singular version?

Martin also tells me Singular 3-1-7 is planned within the next month.

Paul


---

Attachment


---

Comment by zimmerma created at 2013-08-24 07:26:00

on http://www.loria.fr/~zimmerma/singular-3-1-5.p8.spkg I've put an updated Singular spkg which includes the first patch of https://github.com/Singular/Sources/pull/215. This seems to be enough to solve this bug.

The attached patch adds a non-regression test.

Paul


---

Comment by zimmerma created at 2013-08-24 07:26:00

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2013-08-24 08:12:11

Replying to [comment:10 zimmerma]:
> on http://www.loria.fr/~zimmerma/singular-3-1-5.p8.spkg I've put an updated Singular spkg which includes the first patch of https://github.com/Singular/Sources/pull/215.
Wouldn't it be safer to include all four commits? Did you check whether this solves #14658?


---

Comment by zimmerma created at 2013-08-24 08:54:02

Jeroen,

> Wouldn't it be safer to include all four commits?

indeed (maybe only the first three, since the last one only adds tests). But I didn't know how to extract the diff, thus I edited the Singular source file manually, it took then several hours on my laptop to recompile the spkg and rebuild Sage, thus I was quite happy it worked (currently running
sage -t --long).

> Did you check whether this solves #14658?

unfortunately not. The first example of #14658 does no longer produce an error (same with vanilla 5.11 btw) but the factorization is incomplete:

```
sage: R.<x1,x2,x3> = QQ['x1,x2,x3']                              
sage: f = (x1+x2+x3)*(2*x1-x2+x3+2)*(4*x1+x2+x3+2)*(8*x1-x2+x3+4)
sage: f.factor()                                                 
(x1 + x2 + x3) * (64*x1^3 - 24*x1^2*x2 - 6*x1*x2^2 + x2^3 + 56*x1^2*x3 - 8*x1*x2*x3 - x2^2*x3 + 14*x1*x3^2 - x2*x3^2 + x3^3 + 128*x1^2 - 20*x1*x2 - 4*x2^2 + 68*x1*x3 - 4*x2*x3 + 8*x3^2 + 80*x1 - 4*x2 + 20*x3 + 16)
```

The other example still breaks with `Floating point exception`.

Paul


---

Comment by zimmerma created at 2013-08-26 10:23:16

my Singular spkg was corrupted. I made a new one (same url).

Paul


---

Comment by jdemeyer created at 2013-08-26 10:50:13

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2013-08-26 10:50:13

When updating a spkg, you should add a Changelog entry in `SPKG.txt`. Also, changes should be committed to the Mercurial repo (`hg add patches/singular_13770.patch` and `hg commit`).

I will make these changes and try to use the 3 commits from the upstream pull request.


---

Comment by jdemeyer created at 2013-08-26 10:52:11

To download patches from github, see [http://stackoverflow.com/questions/6188591/download-github-pull-request-as-unified-diff](http://stackoverflow.com/questions/6188591/download-github-pull-request-as-unified-diff) (I agree it is hard to find out)


---

Comment by jdemeyer created at 2013-08-26 10:56:30

Also rebasing to #14737.


---

Comment by zimmerma created at 2013-08-26 11:13:13

thank you Jeroen for the pointers. I thus let you continue on this ticket.

Paul


---

Comment by zimmerma created at 2013-08-26 11:25:42

just answering to my own question:

> Also it is fixed in Singular 3-1-6. Any plan to upgrade the Singular version?

this is planned in #14333

Paul


---

Attachment


---

Comment by jdemeyer created at 2013-08-26 14:36:53

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2013-08-26 14:36:53

New spkg is up, but I still need to test it properly myself.


---

Comment by zimmerma created at 2013-08-26 15:02:07

#14658 is still not fixed:

```
sage: R.<x1,x2,x3> = QQ['x1,x2,x3']
sage: f = (x1+x2+x3)*(2*x1-x2+x3+2)*(4*x1+x2+x3+2)*(8*x1-x2+x3+4)
sage: f.factor()
(x1 + x2 + x3) * (2*x1 - x2 + x3 + 2) * (32*x1^2 + 4*x1*x2 - x2^2 + 12*x1*x3 + x3^2 + 32*x1 + 2*x2 + 6*x3 + 8)
```

Note that we do not even get deterministic answers:

```
sage: f.factor()
(x1 + x2 + x3) * (64*x1^3 - 24*x1^2*x2 - 6*x1*x2^2 + x2^3 + 56*x1^2*x3 - 8*x1*x2*x3 - x2^2*x3 + 14*x1*x3^2 - x2*x3^2 + x3^3 + 128*x1^2 - 20*x1*x2 - 4*x2^2 + 68*x1*x3 - 4*x2*x3 + 8*x3^2 + 80*x1 - 4*x2 + 20*x3 + 16)
sage: f.factor()
(x1 + x2 + x3) * (64*x1^3 - 24*x1^2*x2 - 6*x1*x2^2 + x2^3 + 56*x1^2*x3 - 8*x1*x2*x3 - x2^2*x3 + 14*x1*x3^2 - x2*x3^2 + x3^3 + 128*x1^2 - 20*x1*x2 - 4*x2^2 + 68*x1*x3 - 4*x2*x3 + 8*x3^2 + 80*x1 - 4*x2 + 20*x3 + 16)
sage: f.factor()
(x1 + x2 + x3) * (2*x1 - x2 + x3 + 2) * (32*x1^2 + 4*x1*x2 - x2^2 + 12*x1*x3 + x3^2 + 32*x1 + 2*x2 + 6*x3 + 8)
sage: f.factor()
(x1 + x2 + x3) * (64*x1^3 - 24*x1^2*x2 - 6*x1*x2^2 + x2^3 + 56*x1^2*x3 - 8*x1*x2*x3 - x2^2*x3 + 14*x1*x3^2 - x2*x3^2 + x3^3 + 128*x1^2 - 20*x1*x2 - 4*x2^2 + 68*x1*x3 - 4*x2*x3 + 8*x3^2 + 80*x1 - 4*x2 + 20*x3 + 16)
sage: f.factor()
(x1 + x2 + x3) * (8*x1 - x2 + x3 + 4) * (8*x1^2 - 2*x1*x2 - x2^2 + 6*x1*x3 + x3^2 + 12*x1 + 4*x3 + 4)
sage: f.factor()
(x1 + x2 + x3) * (64*x1^3 - 24*x1^2*x2 - 6*x1*x2^2 + x2^3 + 56*x1^2*x3 - 8*x1*x2*x3 - x2^2*x3 + 14*x1*x3^2 - x2*x3^2 + x3^3 + 128*x1^2 - 20*x1*x2 - 4*x2^2 + 68*x1*x3 - 4*x2*x3 + 8*x3^2 + 80*x1 - 4*x2 + 20*x3 + 16)
sage: f.factor()
(x1 + x2 + x3) * (8*x1 - x2 + x3 + 4) * (8*x1^2 - 2*x1*x2 - x2^2 + 6*x1*x3 + x3^2 + 12*x1 + 4*x3 + 4)
sage: f.factor()
(x1 + x2 + x3) * (64*x1^3 - 24*x1^2*x2 - 6*x1*x2^2 + x2^3 + 56*x1^2*x3 - 8*x1*x2*x3 - x2^2*x3 + 14*x1*x3^2 - x2*x3^2 + x3^3 + 128*x1^2 - 20*x1*x2 - 4*x2^2 + 68*x1*x3 - 4*x2*x3 + 8*x3^2 + 80*x1 - 4*x2 + 20*x3 + 16)
sage: f.factor()
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
<ipython-input-25-429743410e57> in <module>()
----> 1 f.factor()

/localdisk/tmp/sage-5.11/local/lib/python2.7/site-packages/sage/rings/polynomial/multi_polynomial_libsingular.so in sage.rings.polynomial.multi_polynomial_libsingular.MPolynomial_libsingular.factor (sage/rings/polynomial/multi_polynomial_libsingular.cpp:26013)()

RuntimeError: Segmentation fault
```



---

Comment by jdemeyer created at 2013-08-28 06:06:09

Passes all tests on the buildbot, so needs_review for real.


---

Comment by jpflori created at 2013-09-27 18:04:39

Changing status from needs_review to positive_review.


---

Comment by jpflori created at 2013-09-27 18:04:39

Changing keywords from "" to "sd53, singular, polynomial, factorization".


---

Comment by jpflori created at 2013-09-27 18:04:39

Looks good.
Lets get this in even though updating to Singular 3-1-6 or even 3-1-7 should supersede it, but needs more serious work.
(Moreover singular website is down right now.)


---

Comment by jdemeyer created at 2013-10-01 07:16:02

Resolution: fixed
