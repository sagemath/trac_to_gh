# Issue 12841: Update to python-2.7.3

Issue created by migration from https://trac.sagemath.org/ticket/13013

Original creator: vbraun

Original creation time: 2012-05-25 17:55:20

Assignee: tbd

CC:  fbissey novoselt

Python 2.7.2 distutils have a bug on ext4 or other filesystems with sub-second resolution. The result is that some source files are copied unnecessarily. This is somewhat annoying in `sage -b`.


---

Comment by vbraun created at 2012-05-25 19:28:21

Our `setup.py` needed some fixes to work with the new python, most notably you need to tell it to have at least one thread. Also fixed some other warts that annoyed me, like the 

```
setup.py:644: UserWarning: could not find dependency <vector> included in /home/vbraun/opt/sage-5.0/local/lib/python/site-packages/Cython/Includes/libcpp/vector.pxd. I will assume it is a system C/C++ header.
```



---

Comment by vbraun created at 2012-05-25 19:29:26

Changing status from new to needs_review.


---

Comment by vbraun created at 2012-05-25 19:30:47

spkg diff for review purposes only


---

Attachment

I think one doctest may need fixing, I don't have the particular at hand because my work computer is switched off.


---

Comment by novoselt created at 2012-05-25 23:16:30

I am getting

```
sage -t -long devel/sage-main/sage/misc/prandom.py
**********************************************************************
File "/tmp/sage-5.0/devel/sage-main/sage/misc/prandom.py", line 211:
    sage: [expovariate(0.001) for i in range(3)]
Expected:
    [2194.27528710212, 664.856145830767, 3108.01255906546]
Got:
    [118.152309288166, 722.261959038118, 45.7190543690470]
**********************************************************************
File "/tmp/sage-5.0/devel/sage-main/sage/misc/prandom.py", line 213:
    sage: [expovariate(1.0) for i in range(3)]
Expected:
    [1.10114367058632, 0.652772818610748, 1.69983589896220]
Got:
    [0.404201816061304, 0.735220464997051, 0.201765578600627]
**********************************************************************
File "/tmp/sage-5.0/devel/sage-main/sage/misc/prandom.py", line 215:
    sage: [expovariate(1000) for i in range(3)]
Expected:
    [0.0003554358393809391, 0.0025254102812587195, 0.0001175899408167489]
Got:
    [0.0012068700332283973, 8.340929747302108e-05, 0.00219877067980605]
**********************************************************************
1 items had failures:
   3 of   6 in __main__.example_11
***Test Failed*** 3 failures.
```



---

Comment by vbraun created at 2012-05-26 02:04:20

Changing keywords from "" to "sd40.5".


---

Comment by fbissey created at 2012-05-26 02:07:49

That's the one I got in sage-on-gentoo when we did move to 2.7.3. I think that's the exact same value but that's a memory from 3 weeks ago. We also need to check if it is platform dependent.


---

Comment by vbraun created at 2012-05-26 05:23:20

This is the upstream change http://hg.python.org/releasing/2.7.3/rev/4970fa3c4a0b

On the plus side, its as platform-independent as it was before.


---

Attachment

Updated patch


---

Comment by vbraun created at 2012-05-26 06:16:33

All doctests pass now...


---

Comment by jdemeyer created at 2012-05-26 16:57:42

I'll have a look.


---

Comment by jdemeyer created at 2012-05-26 18:26:35

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2012-05-26 18:26:35

Looks good to me.  The package works and the changes to `setup.py` make sense.


---

Comment by jdemeyer created at 2012-05-29 00:25:21

Many files in `src/` are not world-readable.  This should be fixed to be safe.


---

Comment by jdemeyer created at 2012-05-29 00:25:21

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2012-05-29 03:57:16

Changing status from needs_work to positive_review.


---

Comment by jdemeyer created at 2012-05-29 03:57:16

Permissions fixed.


---

Comment by jdemeyer created at 2012-05-31 13:41:49

Resolution: fixed
