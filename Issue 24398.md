# Issue 24398: make vertex_connectivity faster if only a lower bound is required.

Issue created by migration from https://trac.sagemath.org/ticket/24635

Original creator: moritz

Original creation time: 2018-02-01 11:20:10

Sometimes it is useful to check if a graph is at least n-connected, but it is not required to calculate the vertex connectivity precisely. 

So basically, the call `G.vertex_connectivity() >= n`, should be made faster. It could perhaps be implemented by adding an option like `G.vertex_connectivity(is_at_least=n)` or something similar. 

This is used in the case n-3 for example in the functions `planar-dual` and `is_polyhedral` (see ticket:24634).


---

Comment by dcoudert created at 2018-02-03 11:26:26

Testing if the connectivity is `>= 3` can be done in linear time using a decomposition of the graph into 3-vertex-connected components. This is one of the proposed project for GSoC 2018 https://wiki.sagemath.org/GSoC/2018#Addition_of_SPQR-tree_to_graph_module

For larger values, we can add parameter `k` to the method to check if the vertex connectivity is `>= k`. I will try.


---

Comment by dcoudert created at 2018-02-03 13:23:23

I made a first trial. We can certainly do better. It is sometimes faster and sometimes slower, but I don't understand why...

```
sage: G = Graph(1000)
sage: G.add_edges(graphs.RandomTree(G.order()).edges())
sage: G.add_edges(graphs.RandomTree(G.order()).edges())
sage: G.add_edges(graphs.RandomTree(G.order()).edges())
sage: %time G.vertex_connectivity()
CPU times: user 23.7 s, sys: 159 ms, total: 23.8 s
Wall time: 7.61 s
3
sage: %time G.vertex_connectivity(k=3)
CPU times: user 51.4 s, sys: 233 ms, total: 51.7 s
Wall time: 15.8 s
True
sage:
sage: G.add_edges(graphs.RandomTree(G.order()).edges())
sage: %time G.vertex_connectivity()
CPU times: user 1min 45s, sys: 311 ms, total: 1min 45s
Wall time: 30 s
4
sage: %time G.vertex_connectivity(k=3)
CPU times: user 27.7 s, sys: 192 ms, total: 27.9 s
Wall time: 8.78 s
True
```

----
New commits:


---

Comment by dcoudert created at 2018-02-03 13:23:23

Changing status from new to needs_review.


---

Comment by jmantysalo created at 2018-02-03 18:21:23

Same kind of functionality could be useful for, say, crossing number of a graph or dimension of a poset.

What would be parameter name for that? `k` is used in `is_eulerian()` of a poset with kind of different meaning.

And about the output: could those functions return integers of Infinity? I mean that `f(some_parameter_name=3)` would output either 0, 1, 2 or Infinity.


---

Comment by dcoudert created at 2018-02-03 18:45:49

`k` is often good name for such parameter, as long as it is well documented.

For the output of a decision problem, it should be `True` or `False`. 
For optimization problems, you can return something else.

The modification I proposed is not so efficient. Any idea to speed up the method is welcome.


---

Comment by moritz created at 2018-02-13 16:50:52

Changing status from needs_review to needs_info.


---

Comment by moritz created at 2018-02-13 16:50:52

I did some timings simliar to yours and in many cases the setting `k=...` is much faster then `.vertex_connectivity>=...`, especially if the vertex_connectity is different from "`...`".

I think it is a great addition!


A few comments, which i add as a commit:

   - I suggest to allow the case `k=0` to be an alias for `is_connected`.
Do you agree? (Then an error message, the documentation and one of the Tests need to be changed slightly)


The following question has nothing to do with the new feature of the function, but while we are at it..:

   - Perhaps it would be useful warn the user in the doc that the default MILP solver is not "exact".
   I propose three different ways to improve the situation:
    1. add "(see `default_mip_solver()`)" with a link to sage.numerical.backends.generic_backend.default_mip_solver
    2. add "notice that the default solver might not be an exact solver (see `default_mip_solver()`)! To get exact (but possibly slower) results set `solver = "ppl"`"
    3. Make `solver = "ppl"` the default and tell people that they have an option to set solver = None, if they want the default solver (see default_mip_solver()). 
 
  I think "1." doesn't hurt anyone and perhaps "2." is also really an imrovement. "3." would of course be a rather drastic change, that makes the method run considerably slower in the default settings.


Two more things:

  - I have some minor suggestions on python conventions and also removing a forgotten ">" in the wikipedia link. 

  - I rebased on beta5 in order to be able to use the method not only (as you did) in the `is_planar`, but also in the `is_polyhedral` mehtod (new in beta5!).


---

Comment by moritz created at 2018-02-13 16:58:18

New commits:


---

Comment by dcoudert created at 2018-02-13 17:11:43

> A few comments, which i add as a commit:
> 
>    - I suggest to allow the case `k=0` to be an alias for `is_connected`.
> Do you agree? (Then an error message, the documentation and one of the Tests need to be changed slightly)

Good idea.
 
 
> The following question has nothing to do with the new feature of the function, but while we are at it..:
> 
>    - Perhaps it would be useful warn the user in the doc that the default MILP solver is not "exact".
>    I propose three different ways to improve the situation:
>     1. add "(see `default_mip_solver()`)" with a link to sage.numerical.backends.generic_backend.default_mip_solver
>     2. add "notice that the default solver might not be an exact solver (see `default_mip_solver()`)! To get exact (but possibly slower) results set `solver = "ppl"`"
>     3. Make `solver = "ppl"` the default and tell people that they have an option to set solver = None, if they want the default solver (see default_mip_solver()). 
>  
>   I think "1." doesn't hurt anyone and perhaps "2." is also really an imrovement. "3." would of course be a rather drastic change, that makes the method run considerably slower in the default settings.

I vote for "1.". 

I doubt that using a non "exact" solver can result in a wrong answer here. Also, since calls are hidden in various methods (e.g. `is_polyhedron`), it is almost impossible for the user to choose the solver.


> Two more things:
> 
>   - I have some minor suggestions on python conventions and also removing a forgotten ">" in the wikipedia link. 
> 
>   - I rebased on beta5 in order to be able to use the method not only (as you did) in the `is_planar`, but also in the `is_polyhedral` mehtod (new in beta5!).


Thank you for the improvements.


---

Comment by moritz created at 2018-02-14 19:12:48

Changing status from needs_info to needs_work.


---

Comment by moritz created at 2018-02-14 19:12:48

Replying to [comment:9 dcoudert]:

>  
>  
> > The following question has nothing to do with the new feature of the function, but while we are at it..:
> 
> I doubt that using a non "exact" solver can result in a wrong answer here. Also, since calls are hidden in various methods (e.g. `is_polyhedron`), it is almost impossible for the user to choose the solver.
> 
I guess this is why the `default`-setting is quite useful; one can set the default solver globally...

I will be happy to finish the review, if you add the two improvements!


---

Comment by dcoudert created at 2018-02-15 07:52:34

I wanted to push modifications, but you have changed the branch from `public/...` to `u/moritz/...`. 


I though again about possible changes:
- `k==0`: actually this is confusing. The definition of the parameter says that we check is the connectivity is larger or equal to k. So `k=1` is to check if the graph is (strongly)connected. Allowing `k==0` might introduce some confusion to users, forcing them to carefully check the documentation each time. It's not a natural use of the method.

- I can add links to `default_mip_solver` with a sentence explaining that it allows to know which solver is used by default and to change the default solver. However, explaining the user that other solvers than `PPL` are not exact might again introduce some confusion. Furthermore, why adding it here and not in all methods using LP solvers ? The best place to add such warning might be in the global documentation of `sage.numerical.mip`.


---

Comment by moritz created at 2018-02-15 18:14:54

Replying to [comment:11 dcoudert]:
> I wanted to push modifications, but you have changed the branch from `public/...` to `u/moritz/...`. 
> 
Yes, I didn't want to force push to `public/...`, because I rebased and changed history. But I will do that now..
> 
> I though again about possible changes:
> - `k==0`: actually this is confusing. The definition of the parameter says that we check is the connectivity is larger or equal to k. So `k=1` is to check if the graph is (strongly)connected. Allowing `k==0` might introduce some confusion to users, forcing them to carefully check the documentation each time. It's not a natural use of the method.
You are right; let's leave it as is. 

> - I can add links to `default_mip_solver` with a sentence explaining that it allows to know which solver is used by default and to change the default solver. However, explaining the user that other solvers than `PPL` are not exact might again introduce some confusion. Furthermore, why adding it here and not in all methods using LP solvers ? The best place to add such warning might be in the global documentation of `sage.numerical.mip`.
Ok, then simply the link to `default_mip_solver`.


---

Comment by moritz created at 2018-02-15 18:15:38

New commits:


---

Comment by git created at 2018-02-15 18:17:43

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2018-02-15 18:29:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2018-02-15 18:31:15

just pushed small improvements (`default_mip_solver` and a quick test when `k==1`)


---

Comment by dcoudert created at 2018-02-15 18:31:15

Changing status from needs_work to needs_review.


---

Comment by moritz created at 2018-02-18 20:24:37


```
sage: G = Graph()
sage: G.vertex_connectivity(k=2)
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<ipython-input-9-4c919a85b95d> in <module>()
----> 1 G.vertex_connectivity(k=Integer(2))

...sage/graphs/generic_graph.pyc in vertex_connectivity(self, value_only, sets, k, solver, verbose)
   9842                 raise ValueError("parameter k must be strictly positive")
   9843             if (g.is_directed() and k > min(min(g.in_degree()), min(g.out_degree()))) \
-> 9844                or (not g.is_directed() and (k > min(g.degree()))):
   9845                 return False
   9846             value_only = True

ValueError: min() arg is an empty sequence
```


Perhaps, its best to change `min(g.degree())` to `min(g.degree(),0)`?

Other than that it looks quite good to me!


---

Comment by moritz created at 2018-02-18 20:24:37

Changing status from needs_review to needs_work.


---

Comment by dcoudert created at 2018-02-18 21:13:29

The empty graph again :( 

We have to treat it separately, and graph theory books are not helpful here since this special case is most of the time omitted. 

According methods `is_connected`, it is connected, and according to `is_biconnected` it is not biconnected. So I propose to say return `True` when `k==1` and `False` else. Do you agree ?


Observe that we cannot use `min(g.degree(),0)` since:

```
sage: min([2,3,4],0)
[2, 3, 4]
```



---

Comment by moritz created at 2018-02-19 14:41:24

Replying to [comment:18 dcoudert]:
> The empty graph again :( 
> 
> We have to treat it separately, and graph theory books are not helpful here since this special case is most of the time omitted. 
> 
I read up a bit on old sage discussions about it. 
I also like the exposition here:
https://ncatlab.org/nlab/show/too+simple+to+be+simple

> According methods `is_connected`, it is connected, and according to `is_biconnected` it is not biconnected. So I propose to say return `True` when `k==1` and `False` else. Do you agree ?
> 
I would prefer to have `is_connected` return `False`, but I guess nobody wants to discuss this again. For our case, I would agree with any convention that you decide.
> 
> Observe that we cannot use `min(g.degree(),0)` since:
> {{{
> sage: min([2,3,4],0)
> [2, 3, 4]
> }}}
What I meant was `min(g.degree() or [0])`. (And in Python 3.4 one could do `min(g.degree(), default=0)`!)

Sorry for bringing up this special case...


---

Comment by git created at 2018-02-19 16:35:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2018-02-19 16:36:23

last commit fix the special case of empty (di)graph and add tests.


---

Comment by dcoudert created at 2018-02-19 17:06:10

Changing status from needs_work to needs_review.


---

Comment by moritz created at 2018-02-20 22:17:11

I think its good know and am waiting for the patchbot..


---

Comment by moritz created at 2018-02-21 20:16:00

Changing status from needs_review to positive_review.


---

Comment by dcoudert created at 2018-02-21 20:44:27

Thanks


---

Comment by vbraun created at 2018-02-23 08:01:38

Resolution: fixed
