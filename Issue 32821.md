# Issue 32821: doctest in generic_graph.py can fail due to rounding error

Issue created by migration from https://trac.sagemath.org/ticket/33058

Original creator: @DaveWitteMorris

Original creation time: 2021-12-21 06:31:58

CC:  @kliem

`sage -t --long --random-seed=285615421785840867793774705868421856551 src/sage/graphs/generic_graph.py` reports the following doctest failure:

```
File "src/sage/graphs/generic_graph.py", line 7945, in sage.graphs.generic_graph.GenericGraph.?
Failed example:
    for i in range(20):
        g = Graph()
        g.allow_multiple_edges(False)
        for u, v in graphs.RandomGNP(n,.2).edges(labels=False, sort=False):
             g.add_edge(u, v, round(random(), 5))
        for u, v in graphs.CycleGraph(n).edges(labels=False, sort=False):
             if not g.has_edge(u, v):
                 g.add_edge(u, v, round(random(),5))
        v1 = g.traveling_salesman_problem(constraint_generation=False, use_edge_labels=True)
        v2 = g.traveling_salesman_problem(use_edge_labels=True)
        c1 = sum(v1.edge_labels())
        c2 = sum(v2.edge_labels())
        if c1 != c2:
            print("Error !", c1, c2)
            break
Expected nothing
Got:
    Error ! 6.59867 6.5986699999999985
```

This seems to clearly be a rounding error. Should tolerance be added to the doctest, or is this a fundamental problem?

The problem was discovered by a patchbot testing ticket #30999 (but I confirmed with 9.5b8 on MacOS 11.5.2 and `CoCalc` Ubuntu 20.04). 


---

Comment by mjo created at 2021-12-21 17:14:57

`round(random(), 5)` is returning an element of `RDF`, so this should either (a) have a tolerance associated with it, or (b) be using an exact ring.

Moreover, this doctest shouldn't be repeating the same test 20 times... it looks like there are four other tests in this file doing the same thing.


---

Comment by mjo created at 2021-12-21 21:54:41

Changing status from new to needs_review.


---

Comment by mjo created at 2021-12-21 21:54:41

New commits:


---

Comment by @kliem created at 2021-12-22 07:19:33

Typo: `on a random graphs`

Also the original test was basically on integers in `range(1, 100000)`. Does this make a difference?


---

Comment by git created at 2021-12-22 13:48:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @kliem created at 2021-12-22 14:44:54

Sorry, there is actually one more typo here:


```
+        Let us compute longest paths on a random graph with random
```


Looks to me, like we compute only one longest path on a random graph.

Otherwise looks good to me.


---

Comment by git created at 2021-12-22 15:02:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @kliem created at 2021-12-22 17:43:35

LGTM.


---

Comment by @kliem created at 2021-12-22 17:43:35

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2022-01-01 00:23:18

Resolution: fixed
