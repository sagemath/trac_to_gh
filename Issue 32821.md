# Issue 32821: doctest in generic_graph.py can fail due to rounding error

archive/issues_032821.json:
```json
{
    "body": "CC:  @kliem\n\n`sage -t --long --random-seed=285615421785840867793774705868421856551 src/sage/graphs/generic_graph.py` reports the following doctest failure:\n\n```\nFile \"src/sage/graphs/generic_graph.py\", line 7945, in sage.graphs.generic_graph.GenericGraph.?\nFailed example:\n    for i in range(20):\n        g = Graph()\n        g.allow_multiple_edges(False)\n        for u, v in graphs.RandomGNP(n,.2).edges(labels=False, sort=False):\n             g.add_edge(u, v, round(random(), 5))\n        for u, v in graphs.CycleGraph(n).edges(labels=False, sort=False):\n             if not g.has_edge(u, v):\n                 g.add_edge(u, v, round(random(),5))\n        v1 = g.traveling_salesman_problem(constraint_generation=False, use_edge_labels=True)\n        v2 = g.traveling_salesman_problem(use_edge_labels=True)\n        c1 = sum(v1.edge_labels())\n        c2 = sum(v2.edge_labels())\n        if c1 != c2:\n            print(\"Error !\", c1, c2)\n            break\nExpected nothing\nGot:\n    Error ! 6.59867 6.5986699999999985\n```\n\nThis seems to clearly be a rounding error. Should tolerance be added to the doctest, or is this a fundamental problem?\n\nThe problem was discovered by a patchbot testing ticket #30999 (but I confirmed with 9.5b8 on MacOS 11.5.2 and `CoCalc` Ubuntu 20.04). \n\nIssue created by migration from https://trac.sagemath.org/ticket/33058\n\n",
    "created_at": "2021-12-21T06:31:58Z",
    "labels": [
        "component: graph theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "doctest in generic_graph.py can fail due to rounding error",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32821",
    "user": "https://github.com/DaveWitteMorris"
}
```
CC:  @kliem

`sage -t --long --random-seed=285615421785840867793774705868421856551 src/sage/graphs/generic_graph.py` reports the following doctest failure:

```
File "src/sage/graphs/generic_graph.py", line 7945, in sage.graphs.generic_graph.GenericGraph.?
Failed example:
    for i in range(20):
        g = Graph()
        g.allow_multiple_edges(False)
        for u, v in graphs.RandomGNP(n,.2).edges(labels=False, sort=False):
             g.add_edge(u, v, round(random(), 5))
        for u, v in graphs.CycleGraph(n).edges(labels=False, sort=False):
             if not g.has_edge(u, v):
                 g.add_edge(u, v, round(random(),5))
        v1 = g.traveling_salesman_problem(constraint_generation=False, use_edge_labels=True)
        v2 = g.traveling_salesman_problem(use_edge_labels=True)
        c1 = sum(v1.edge_labels())
        c2 = sum(v2.edge_labels())
        if c1 != c2:
            print("Error !", c1, c2)
            break
Expected nothing
Got:
    Error ! 6.59867 6.5986699999999985
```

This seems to clearly be a rounding error. Should tolerance be added to the doctest, or is this a fundamental problem?

The problem was discovered by a patchbot testing ticket #30999 (but I confirmed with 9.5b8 on MacOS 11.5.2 and `CoCalc` Ubuntu 20.04). 

Issue created by migration from https://trac.sagemath.org/ticket/33058





---

archive/issue_comments_467315.json:
```json
{
    "body": "`round(random(), 5)` is returning an element of `RDF`, so this should either (a) have a tolerance associated with it, or (b) be using an exact ring.\n\nMoreover, this doctest shouldn't be repeating the same test 20 times... it looks like there are four other tests in this file doing the same thing.",
    "created_at": "2021-12-21T17:14:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32821",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32821#issuecomment-467315",
    "user": "https://github.com/orlitzky"
}
```

`round(random(), 5)` is returning an element of `RDF`, so this should either (a) have a tolerance associated with it, or (b) be using an exact ring.

Moreover, this doctest shouldn't be repeating the same test 20 times... it looks like there are four other tests in this file doing the same thing.



---

archive/issue_comments_467316.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-12-21T21:54:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32821",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32821#issuecomment-467316",
    "user": "https://github.com/orlitzky"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_467317.json:
```json
{
    "body": "New commits:",
    "created_at": "2021-12-21T21:54:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32821",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32821#issuecomment-467317",
    "user": "https://github.com/orlitzky"
}
```

New commits:



---

archive/issue_comments_467318.json:
```json
{
    "body": "Typo: `on a random graphs`\n\nAlso the original test was basically on integers in `range(1, 100000)`. Does this make a difference?",
    "created_at": "2021-12-22T07:19:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32821",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32821#issuecomment-467318",
    "user": "https://github.com/kliem"
}
```

Typo: `on a random graphs`

Also the original test was basically on integers in `range(1, 100000)`. Does this make a difference?



---

archive/issue_comments_467319.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-22T13:48:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32821",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32821#issuecomment-467319",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467320.json:
```json
{
    "body": "Sorry, there is actually one more typo here:\n\n\n```\n+        Let us compute longest paths on a random graph with random\n```\n\n\nLooks to me, like we compute only one longest path on a random graph.\n\nOtherwise looks good to me.",
    "created_at": "2021-12-22T14:44:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32821",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32821#issuecomment-467320",
    "user": "https://github.com/kliem"
}
```

Sorry, there is actually one more typo here:


```
+        Let us compute longest paths on a random graph with random
```


Looks to me, like we compute only one longest path on a random graph.

Otherwise looks good to me.



---

archive/issue_comments_467321.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-22T15:02:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32821",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32821#issuecomment-467321",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467322.json:
```json
{
    "body": "LGTM.",
    "created_at": "2021-12-22T17:43:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32821",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32821#issuecomment-467322",
    "user": "https://github.com/kliem"
}
```

LGTM.



---

archive/issue_comments_467323.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-12-22T17:43:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32821",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32821#issuecomment-467323",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_467324.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-01-01T00:23:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32821",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32821#issuecomment-467324",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_087353.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-01-01T00:23:18Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32821",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32821#event-87353"
}
```
