# Issue 5350: [with patch, needs review] sage-clone should use hard links for the build directory

Issue created by migration from Trac.

Original creator: burcin

Original creation time: 2009-02-23 18:53:19

Assignee: burcin

CC:  cwitty robertwb ralf@hemmecke.de

We copy the build directory when we're cloning the tree. This wastes disk space, and makes switching between branches slow, since new files need to be loaded from disk while the previous ones might already be in the cache.

Attached patch to the scripts repository changes the sage-clone script to hard link the build directory. On my laptop this saves >450 MB per clone.


```
burcin`@`karr ~/sage/sage-3.3/devel $ du -sh sage-*
593M    sage-hl
125M    sage-hl1
557M    sage-main
```


Also the time to clone on my laptop goes from:

```
real    0m14.709s
user    0m4.640s
sys     0m1.924s
```

to

```
real    0m6.100s
user    0m4.712s
sys     0m0.928s
```

about 2.8 seconds of which is spent in the sage -b step.

Unfortunately, hard linking the .c, .cpp, and .h files doesn't work. This might be a problem with how cython handles its output when the output file is already present. This would save another ~100MB if it works.


---

Comment by burcin created at 2009-02-23 18:54:55

make sage-clone use hard links


---

Attachment

I don't think we want this in a critical stable release :)

Cheers,

Michael


---

Comment by robertwb created at 2009-03-18 04:54:12

Cython 0.11 will make hard links on .c and .cpp files work too. 

http://trac.cython.org/cython_trac/ticket/220 and #4987


---

Comment by burcin created at 2009-06-07 12:19:57

rebased for 4.0.1


---

Comment by burcin created at 2009-06-07 12:24:02

Changing status from new to assigned.


---

Attachment

attachment:trac_5350-clone_hardlink-take2.patch is a new version of the patch. It is rebased to 4.0.1. We now use hard links for autogenerated cython files and documentation output too.


---

Comment by rlm created at 2009-06-21 22:35:00

Everything works fine, and the speedup is impressive, but I agree that a two-digit release might not be appropriate for something so invasive.


---

Comment by boothby created at 2009-06-26 17:45:24

Resolution: fixed
