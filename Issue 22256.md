# Issue 22256: upgrade to MPIR-3.0.0

archive/issues_022256.json:
```json
{
    "body": "CC:  mkoeppe jdemeyer vbraun fbissey\n\nNew upstream version\n\n    http://mpir.org/mpir-3.0.0.tar.bz2\n\nIssue created by migration from https://trac.sagemath.org/ticket/22493\n\n",
    "created_at": "2017-03-02T15:48:58Z",
    "labels": [
        "packages: standard",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.6",
    "title": "upgrade to MPIR-3.0.0",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22256",
    "user": "vdelecroix"
}
```
CC:  mkoeppe jdemeyer vbraun fbissey

New upstream version

    http://mpir.org/mpir-3.0.0.tar.bz2

Issue created by migration from https://trac.sagemath.org/ticket/22493





---

archive/issue_comments_309200.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-03-02T15:57:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309200",
    "user": "vdelecroix"
}
```

New commits:



---

archive/issue_comments_309201.json:
```json
{
    "body": "Changing keywords from \"\" to \"days84\".",
    "created_at": "2017-03-02T15:57:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309201",
    "user": "vdelecroix"
}
```

Changing keywords from "" to "days84".



---

archive/issue_comments_309202.json:
```json
{
    "body": "I suppose the documentation should mention dependence on yasm.\n(The version on the yasm's website appears to be 1.3, same as on a couple of Linux\nmachines I checked, so that's matter of doing `apt-get install yasm` or something like this. Although on `arando` buildbot it's 1.2, not 1.3, and so something would have to be done to such older systems).",
    "created_at": "2017-03-03T10:21:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309202",
    "user": "dimpase"
}
```

I suppose the documentation should mention dependence on yasm.
(The version on the yasm's website appears to be 1.3, same as on a couple of Linux
machines I checked, so that's matter of doing `apt-get install yasm` or something like this. Although on `arando` buildbot it's 1.2, not 1.3, and so something would have to be done to such older systems).



---

archive/issue_comments_309203.json:
```json
{
    "body": "Replying to [comment:4 dimpase]:\n> I suppose the documentation should mention dependence on yasm.\n> (The version on the yasm's website appears to be 1.3, same as on a couple of Linux\n> machines I checked, so that's matter of doing `apt-get install yasm` or something like this. Although on `arando` buildbot it's 1.2, not 1.3, and so something would have to be done to such older systems).\n\nDima, do we need yasm 1.3 to compile MPIR 3.0.0? Building MPIR on arando would fail?",
    "created_at": "2017-03-03T11:56:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309203",
    "user": "vdelecroix"
}
```

Replying to [comment:4 dimpase]:
> I suppose the documentation should mention dependence on yasm.
> (The version on the yasm's website appears to be 1.3, same as on a couple of Linux
> machines I checked, so that's matter of doing `apt-get install yasm` or something like this. Although on `arando` buildbot it's 1.2, not 1.3, and so something would have to be done to such older systems).

Dima, do we need yasm 1.3 to compile MPIR 3.0.0? Building MPIR on arando would fail?



---

archive/issue_comments_309204.json:
```json
{
    "body": "Replying to [comment:5 vdelecroix]:\n> do we need yasm 1.3 to compile MPIR 3.0.0? Building MPIR on arando would fail?\nBull writes in no uncertain terms that you need the latest version of yasm.\nAs 1.2 is almost 6 years old, I imagine that on new CPUs there could be problems, as the  code for the CPU won't compile.\n\narando has old CPU, more that 6 years old in fact, and I just checked that there MPIR compiles and passes all its checks (with system's gcc 6.2 and yasm 1.2).",
    "created_at": "2017-03-03T12:23:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309204",
    "user": "dimpase"
}
```

Replying to [comment:5 vdelecroix]:
> do we need yasm 1.3 to compile MPIR 3.0.0? Building MPIR on arando would fail?
Bull writes in no uncertain terms that you need the latest version of yasm.
As 1.2 is almost 6 years old, I imagine that on new CPUs there could be problems, as the  code for the CPU won't compile.

arando has old CPU, more that 6 years old in fact, and I just checked that there MPIR compiles and passes all its checks (with system's gcc 6.2 and yasm 1.2).



---

archive/issue_comments_309205.json:
```json
{
    "body": "We decided to remove the inlcuded yasm form mpir sources.\nThat was the only sane thing to do... so Sage needs to ship it separately or we make it a build dependency.",
    "created_at": "2017-03-14T13:06:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309205",
    "user": "jpflori"
}
```

We decided to remove the inlcuded yasm form mpir sources.
That was the only sane thing to do... so Sage needs to ship it separately or we make it a build dependency.



---

archive/issue_comments_309206.json:
```json
{
    "body": "`@`vincent: do you plan on modifying this ticket to include yasm?",
    "created_at": "2017-04-03T11:42:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309206",
    "user": "jpflori"
}
```

`@`vincent: do you plan on modifying this ticket to include yasm?



---

archive/issue_comments_309207.json:
```json
{
    "body": "Replying to [comment:8 jpflori]:\n> `@`vincent: do you plan on modifying this ticket to include yasm?\n\nNope. Would better be a dependency ticket.",
    "created_at": "2017-04-03T11:44:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309207",
    "user": "vdelecroix"
}
```

Replying to [comment:8 jpflori]:
> `@`vincent: do you plan on modifying this ticket to include yasm?

Nope. Would better be a dependency ticket.



---

archive/issue_comments_309208.json:
```json
{
    "body": "See #22748 for yasm",
    "created_at": "2017-04-03T11:46:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309208",
    "user": "vdelecroix"
}
```

See #22748 for yasm



---

archive/issue_comments_309209.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-04-25T16:47:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309209",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_309210.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-04-25T16:48:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309210",
    "user": "jpflori"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_309211.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-04-25T16:48:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309211",
    "user": "jpflori"
}
```

New commits:



---

archive/issue_comments_309212.json:
```json
{
    "body": "Seems to work fine for me.",
    "created_at": "2017-04-26T12:58:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309212",
    "user": "jpflori"
}
```

Seems to work fine for me.



---

archive/issue_comments_309213.json:
```json
{
    "body": "this and #22748 seem to work on clang/FreeBSD.",
    "created_at": "2017-04-27T00:04:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309213",
    "user": "dimpase"
}
```

this and #22748 seem to work on clang/FreeBSD.



---

archive/issue_comments_309214.json:
```json
{
    "body": "Good to go in?",
    "created_at": "2017-04-28T07:25:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309214",
    "user": "jpflori"
}
```

Good to go in?



---

archive/issue_comments_309215.json:
```json
{
    "body": "Yes.",
    "created_at": "2017-04-28T07:30:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309215",
    "user": "fbissey"
}
```

Yes.



---

archive/issue_comments_309216.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-04-28T12:17:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309216",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_309217.json:
```json
{
    "body": "Is that a positive review?",
    "created_at": "2017-05-04T07:43:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309217",
    "user": "tscrim"
}
```

Is that a positive review?



---

archive/issue_comments_309218.json:
```json
{
    "body": "I would say so!",
    "created_at": "2017-05-04T08:53:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309218",
    "user": "jpflori"
}
```

I would say so!



---

archive/issue_comments_309219.json:
```json
{
    "body": "And of we go....",
    "created_at": "2017-05-04T09:52:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309219",
    "user": "fbissey"
}
```

And of we go....



---

archive/issue_comments_309220.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-05-04T09:52:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309220",
    "user": "fbissey"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_309221.json:
```json
{
    "body": "On Debian 7 64-bit: http://build.sagedev.org/#/builders/80/builds/1/steps/5/logs/stdio\n\n```\n[mpir-3.0.0] libtool: compile:  gcc -DHAVE_CONFIG_H -I. -D__GMP_WITHIN_GMP -m64 -O2 -march=corei7-avx -mtune=corei7-avx -g -c nextprime.c  -fPIC -DPIC -o .libs/nextprime.o\n[mpir-3.0.0] libtool: compile:  gcc -DHAVE_CONFIG_H -I. -D__GMP_WITHIN_GMP -m64 -O2 -march=corei7-avx -mtune=corei7-avx -g -c nextprime.c -o nextprime.o >/dev/null 2>&1\n[mpir-3.0.0] libtool: compile:  gcc -DHAVE_CONFIG_H -I. -D__GMP_WITHIN_GMP -m64 -O2 -march=corei7-avx -mtune=corei7-avx -g -c primesieve.c -o primesieve.o >/dev/null 2>&1\n[mpir-3.0.0] /bin/bash ./libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H -I.  -D__GMP_WITHIN_GMP   -m64 -O2 -march=corei7-avx -mtune=corei7-avx  -g  -c -o version.lo version.c\n[mpir-3.0.0] libtool: compile:  gcc -DHAVE_CONFIG_H -I. -D__GMP_WITHIN_GMP -m64 -O2 -march=corei7-avx -mtune=corei7-avx -g -c version.c  -fPIC -DPIC -o .libs/version.o\n[mpir-3.0.0] /bin/bash ./libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H -I.  -D__GMP_WITHIN_GMP   -m64 -O2 -march=corei7-avx -mtune=corei7-avx  -g  -c -o tal-reent.lo tal-reent.c\n[mpir-3.0.0] make[6]: *** No rule to make target `mpn/addmul_1.lo', needed by `libmpir.la'.\n[mpir-3.0.0] make[6]: *** No rule to make target `mpn/mul_basecase.lo', needed by `libmpir.la'.\n[mpir-3.0.0] make[6]: *** No rule to make target `mpn/sqr_basecase.lo', needed by `libmpir.la'.\n[mpir-3.0.0] libtool: compile:  gcc -DHAVE_CONFIG_H -I. -D__GMP_WITHIN_GMP -m64 -O2 -march=corei7-avx -mtune=corei7-avx -g -c version.c -o version.o >/dev/null 2>&1\n[mpir-3.0.0] libtool: compile:  gcc -DHAVE_CONFIG_H -I. -D__GMP_WITHIN_GMP -m64 -O2 -march=corei7-avx -mtune=corei7-avx -g -c tal-reent.c  -fPIC -DPIC -o .libs/tal-reent.o\n[mpir-3.0.0] libtool: compile:  gcc -DHAVE_CONFIG_H -I. -D__GMP_WITHIN_GMP -m64 -O2 -march=corei7-avx -mtune=corei7-avx -g -c tal-reent.c -o tal-reent.o >/dev/null 2>&1\n[mpir-3.0.0] /bin/bash ./libtool  --tag=CXX   --mode=compile g++ -DHAVE_CONFIG_H -I.  -D__GMP_WITHIN_GMP   -m64 -O2 -march=corei7-avx -mtune=corei7-avx  -g  -c -o cxx/dummy.lo cxx/dummy.cc\n[mpir-3.0.0] libtool: compile:  g++ -DHAVE_CONFIG_H -I. -D__GMP_WITHIN_GMP -m64 -O2 -march=corei7-avx -mtune=corei7-avx -g -c cxx/dummy.cc  -fPIC -DPIC -o cxx/.libs/dummy.o\n[mpir-3.0.0] libtool: compile:  g++ -DHAVE_CONFIG_H -I. -D__GMP_WITHIN_GMP -m64 -O2 -march=corei7-avx -mtune=corei7-avx -g -c cxx/dummy.cc -o cxx/dummy.o >/dev/null 2>&1\n[mpir-3.0.0] make[6]: Target `all-am' not remade because of errors.\n[mpir-3.0.0] make[6]: Leaving directory `/home/buildbot/slave/sage_git/build/local/var/tmp/sage/build/mpir-3.0.0/src'\n[mpir-3.0.0] make[5]: *** [all-recursive] Error 1\n[mpir-3.0.0] make[5]: Leaving directory `/home/buildbot/slave/sage_git/build/local/var/tmp/sage/build/mpir-3.0.0/src'\n[mpir-3.0.0] make[4]: *** [all] Error 2\n[mpir-3.0.0] make[4]: Leaving directory `/home/buildbot/slave/sage_git/build/local/var/tmp/sage/build/mpir-3.0.0/src'\n[mpir-3.0.0] Error building MPIR.\n```\n",
    "created_at": "2017-05-06T21:43:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309221",
    "user": "vbraun"
}
```

On Debian 7 64-bit: http://build.sagedev.org/#/builders/80/builds/1/steps/5/logs/stdio

```
[mpir-3.0.0] libtool: compile:  gcc -DHAVE_CONFIG_H -I. -D__GMP_WITHIN_GMP -m64 -O2 -march=corei7-avx -mtune=corei7-avx -g -c nextprime.c  -fPIC -DPIC -o .libs/nextprime.o
[mpir-3.0.0] libtool: compile:  gcc -DHAVE_CONFIG_H -I. -D__GMP_WITHIN_GMP -m64 -O2 -march=corei7-avx -mtune=corei7-avx -g -c nextprime.c -o nextprime.o >/dev/null 2>&1
[mpir-3.0.0] libtool: compile:  gcc -DHAVE_CONFIG_H -I. -D__GMP_WITHIN_GMP -m64 -O2 -march=corei7-avx -mtune=corei7-avx -g -c primesieve.c -o primesieve.o >/dev/null 2>&1
[mpir-3.0.0] /bin/bash ./libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H -I.  -D__GMP_WITHIN_GMP   -m64 -O2 -march=corei7-avx -mtune=corei7-avx  -g  -c -o version.lo version.c
[mpir-3.0.0] libtool: compile:  gcc -DHAVE_CONFIG_H -I. -D__GMP_WITHIN_GMP -m64 -O2 -march=corei7-avx -mtune=corei7-avx -g -c version.c  -fPIC -DPIC -o .libs/version.o
[mpir-3.0.0] /bin/bash ./libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H -I.  -D__GMP_WITHIN_GMP   -m64 -O2 -march=corei7-avx -mtune=corei7-avx  -g  -c -o tal-reent.lo tal-reent.c
[mpir-3.0.0] make[6]: *** No rule to make target `mpn/addmul_1.lo', needed by `libmpir.la'.
[mpir-3.0.0] make[6]: *** No rule to make target `mpn/mul_basecase.lo', needed by `libmpir.la'.
[mpir-3.0.0] make[6]: *** No rule to make target `mpn/sqr_basecase.lo', needed by `libmpir.la'.
[mpir-3.0.0] libtool: compile:  gcc -DHAVE_CONFIG_H -I. -D__GMP_WITHIN_GMP -m64 -O2 -march=corei7-avx -mtune=corei7-avx -g -c version.c -o version.o >/dev/null 2>&1
[mpir-3.0.0] libtool: compile:  gcc -DHAVE_CONFIG_H -I. -D__GMP_WITHIN_GMP -m64 -O2 -march=corei7-avx -mtune=corei7-avx -g -c tal-reent.c  -fPIC -DPIC -o .libs/tal-reent.o
[mpir-3.0.0] libtool: compile:  gcc -DHAVE_CONFIG_H -I. -D__GMP_WITHIN_GMP -m64 -O2 -march=corei7-avx -mtune=corei7-avx -g -c tal-reent.c -o tal-reent.o >/dev/null 2>&1
[mpir-3.0.0] /bin/bash ./libtool  --tag=CXX   --mode=compile g++ -DHAVE_CONFIG_H -I.  -D__GMP_WITHIN_GMP   -m64 -O2 -march=corei7-avx -mtune=corei7-avx  -g  -c -o cxx/dummy.lo cxx/dummy.cc
[mpir-3.0.0] libtool: compile:  g++ -DHAVE_CONFIG_H -I. -D__GMP_WITHIN_GMP -m64 -O2 -march=corei7-avx -mtune=corei7-avx -g -c cxx/dummy.cc  -fPIC -DPIC -o cxx/.libs/dummy.o
[mpir-3.0.0] libtool: compile:  g++ -DHAVE_CONFIG_H -I. -D__GMP_WITHIN_GMP -m64 -O2 -march=corei7-avx -mtune=corei7-avx -g -c cxx/dummy.cc -o cxx/dummy.o >/dev/null 2>&1
[mpir-3.0.0] make[6]: Target `all-am' not remade because of errors.
[mpir-3.0.0] make[6]: Leaving directory `/home/buildbot/slave/sage_git/build/local/var/tmp/sage/build/mpir-3.0.0/src'
[mpir-3.0.0] make[5]: *** [all-recursive] Error 1
[mpir-3.0.0] make[5]: Leaving directory `/home/buildbot/slave/sage_git/build/local/var/tmp/sage/build/mpir-3.0.0/src'
[mpir-3.0.0] make[4]: *** [all] Error 2
[mpir-3.0.0] make[4]: Leaving directory `/home/buildbot/slave/sage_git/build/local/var/tmp/sage/build/mpir-3.0.0/src'
[mpir-3.0.0] Error building MPIR.
```




---

archive/issue_comments_309222.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-05-06T21:43:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309222",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_309223.json:
```json
{
    "body": "Hum\n\n```\n[mpir-3.0.0] libtool: compile:  ../mpn/m4-ccas --m4=m4 gcc -c -DHAVE_CONFIG_H -D__GMP_WITHIN_GMP -I.. -DOPERATION_addmul_1 -m64 -O2 -march=corei7-avx -mtune=corei7-avx -g -I. -I.. addmul_1.asm  -fPIC -DPIC -o .libs/addmul_1.o\n[mpir-3.0.0] m4  -DHAVE_CONFIG_H -D__GMP_WITHIN_GMP -DOPERATION_addmul_1 -DPIC addmul_1.asm >tmp-addmul_1.s\n[mpir-3.0.0]  gcc -c -DHAVE_CONFIG_H -D__GMP_WITHIN_GMP -I.. -DOPERATION_addmul_1 -m64 -O2 -march=corei7-avx -mtune=corei7-avx -g -I. -I.. tmp-addmul_1.s -fPIC -DPIC -o .libs/addmul_1.o\n[mpir-3.0.0] libtool: compile:  ../strip_fPIC.sh /home/buildbot/slave/sage_git/build/local/bin/yasm -I .. -f elf64 submul_1.as  -fPIC -DPIC -o .libs/submul_1.o\n[mpir-3.0.0] /home/buildbot/slave/sage_git/build/local/bin/yasm -I .. -f elf64 submul_1.as -D PIC -o .libs/submul_1.o\n[mpir-3.0.0] libtool: compile:  ../strip_fPIC.sh /home/buildbot/slave/sage_git/build/local/bin/yasm -I .. -f elf64 submul_1.as -o submul_1.o >/dev/null 2>&1\n[mpir-3.0.0] tmp-addmul_1.s: Assembler messages:\n[mpir-3.0.0] tmp-addmul_1.s:152: Error: no such instruction: `adox (%rdi),%r9'\n[mpir-3.0.0] tmp-addmul_1.s:154: Error: no such instruction: `adox %rcx,%rax'\n[mpir-3.0.0] tmp-addmul_1.s:166: Error: no such instruction: `adox -8(%rdi),%r10'\n[mpir-3.0.0] tmp-addmul_1.s:167: Error: no such instruction: `adcx %r8,%r9'\n[mpir-3.0.0] tmp-addmul_1.s:171: Error: no such instruction: `adox (%rdi),%r9'\n[mpir-3.0.0] tmp-addmul_1.s:174: Error: no such instruction: `adcx %rax,%r10'\n[mpir-3.0.0] tmp-addmul_1.s:176: Error: no such instruction: `adcx %r8,%r9'\n[mpir-3.0.0] tmp-addmul_1.s:177: Error: no such instruction: `adox 8(%rdi),%r10'\n[mpir-3.0.0] tmp-addmul_1.s:181: Error: no such instruction: `adcx %rax,%r10'\n[mpir-3.0.0] tmp-addmul_1.s:182: Error: no such instruction: `adox 16(%rdi),%r9'\n[mpir-3.0.0] tmp-addmul_1.s:185: Error: no such instruction: `adox 24(%rdi),%r10'\n[mpir-3.0.0] tmp-addmul_1.s:186: Error: no such instruction: `adcx %r8,%r9'\n[mpir-3.0.0] tmp-addmul_1.s:189: Error: no such instruction: `adcx %rax,%r10'\n[mpir-3.0.0] tmp-addmul_1.s:190: Error: no such instruction: `adox 32(%rdi),%r9'\n[mpir-3.0.0] tmp-addmul_1.s:193: Error: no such instruction: `adox 40(%rdi),%r10'\n[mpir-3.0.0] tmp-addmul_1.s:194: Error: no such instruction: `adcx %r8,%r9'\n[mpir-3.0.0] tmp-addmul_1.s:196: Error: no such instruction: `adox 48(%rdi),%r9'\n[mpir-3.0.0] tmp-addmul_1.s:200: Error: no such instruction: `adcx %rax,%r10'\n[mpir-3.0.0] make[6]: *** [addmul_1.lo] Error 1\n```\n",
    "created_at": "2017-05-06T21:51:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309223",
    "user": "fbissey"
}
```

Hum

```
[mpir-3.0.0] libtool: compile:  ../mpn/m4-ccas --m4=m4 gcc -c -DHAVE_CONFIG_H -D__GMP_WITHIN_GMP -I.. -DOPERATION_addmul_1 -m64 -O2 -march=corei7-avx -mtune=corei7-avx -g -I. -I.. addmul_1.asm  -fPIC -DPIC -o .libs/addmul_1.o
[mpir-3.0.0] m4  -DHAVE_CONFIG_H -D__GMP_WITHIN_GMP -DOPERATION_addmul_1 -DPIC addmul_1.asm >tmp-addmul_1.s
[mpir-3.0.0]  gcc -c -DHAVE_CONFIG_H -D__GMP_WITHIN_GMP -I.. -DOPERATION_addmul_1 -m64 -O2 -march=corei7-avx -mtune=corei7-avx -g -I. -I.. tmp-addmul_1.s -fPIC -DPIC -o .libs/addmul_1.o
[mpir-3.0.0] libtool: compile:  ../strip_fPIC.sh /home/buildbot/slave/sage_git/build/local/bin/yasm -I .. -f elf64 submul_1.as  -fPIC -DPIC -o .libs/submul_1.o
[mpir-3.0.0] /home/buildbot/slave/sage_git/build/local/bin/yasm -I .. -f elf64 submul_1.as -D PIC -o .libs/submul_1.o
[mpir-3.0.0] libtool: compile:  ../strip_fPIC.sh /home/buildbot/slave/sage_git/build/local/bin/yasm -I .. -f elf64 submul_1.as -o submul_1.o >/dev/null 2>&1
[mpir-3.0.0] tmp-addmul_1.s: Assembler messages:
[mpir-3.0.0] tmp-addmul_1.s:152: Error: no such instruction: `adox (%rdi),%r9'
[mpir-3.0.0] tmp-addmul_1.s:154: Error: no such instruction: `adox %rcx,%rax'
[mpir-3.0.0] tmp-addmul_1.s:166: Error: no such instruction: `adox -8(%rdi),%r10'
[mpir-3.0.0] tmp-addmul_1.s:167: Error: no such instruction: `adcx %r8,%r9'
[mpir-3.0.0] tmp-addmul_1.s:171: Error: no such instruction: `adox (%rdi),%r9'
[mpir-3.0.0] tmp-addmul_1.s:174: Error: no such instruction: `adcx %rax,%r10'
[mpir-3.0.0] tmp-addmul_1.s:176: Error: no such instruction: `adcx %r8,%r9'
[mpir-3.0.0] tmp-addmul_1.s:177: Error: no such instruction: `adox 8(%rdi),%r10'
[mpir-3.0.0] tmp-addmul_1.s:181: Error: no such instruction: `adcx %rax,%r10'
[mpir-3.0.0] tmp-addmul_1.s:182: Error: no such instruction: `adox 16(%rdi),%r9'
[mpir-3.0.0] tmp-addmul_1.s:185: Error: no such instruction: `adox 24(%rdi),%r10'
[mpir-3.0.0] tmp-addmul_1.s:186: Error: no such instruction: `adcx %r8,%r9'
[mpir-3.0.0] tmp-addmul_1.s:189: Error: no such instruction: `adcx %rax,%r10'
[mpir-3.0.0] tmp-addmul_1.s:190: Error: no such instruction: `adox 32(%rdi),%r9'
[mpir-3.0.0] tmp-addmul_1.s:193: Error: no such instruction: `adox 40(%rdi),%r10'
[mpir-3.0.0] tmp-addmul_1.s:194: Error: no such instruction: `adcx %r8,%r9'
[mpir-3.0.0] tmp-addmul_1.s:196: Error: no such instruction: `adox 48(%rdi),%r9'
[mpir-3.0.0] tmp-addmul_1.s:200: Error: no such instruction: `adcx %rax,%r10'
[mpir-3.0.0] make[6]: *** [addmul_1.lo] Error 1
```




---

archive/issue_comments_309224.json:
```json
{
    "body": "http://stackoverflow.com/questions/29747508/what-is-the-difference-between-the-adc-and-adcx-instructions-on-ia32-ia64 \nI'd say we have a misdetection of the hardware or the assmebler used by gcc doesn't support those instructions.",
    "created_at": "2017-05-06T23:36:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309224",
    "user": "fbissey"
}
```

http://stackoverflow.com/questions/29747508/what-is-the-difference-between-the-adc-and-adcx-instructions-on-ia32-ia64 
I'd say we have a misdetection of the hardware or the assmebler used by gcc doesn't support those instructions.



---

archive/issue_comments_309225.json:
```json
{
    "body": "I'd say the assembler is yasm.",
    "created_at": "2017-05-10T13:26:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309225",
    "user": "jpflori"
}
```

I'd say the assembler is yasm.



---

archive/issue_comments_309226.json:
```json
{
    "body": "Can't seem to get any info from the (terrible) buildbot pages...\nSeems like a wrong arch choice by MPIR configure script.",
    "created_at": "2017-05-10T13:45:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309226",
    "user": "jpflori"
}
```

Can't seem to get any info from the (terrible) buildbot pages...
Seems like a wrong arch choice by MPIR configure script.



---

archive/issue_comments_309227.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2017-05-10T14:03:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309227",
    "user": "jpflori"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_comments_309228.json:
```json
{
    "body": "The error message is from as, not yasm:\n\n```\n$ strings local/bin/yasm  | grep such\n$ strings /usr/bin/as  | grep such\nno such architecture modifier: `%s'\nbroadcast is needed for operand of such type\nno such architecture: `%s'\nno such instruction: `%s'\n```\n\nUnless yasm calls as somewhere under the hood, though I don't think thats the case...",
    "created_at": "2017-05-14T08:43:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309228",
    "user": "vbraun"
}
```

The error message is from as, not yasm:

```
$ strings local/bin/yasm  | grep such
$ strings /usr/bin/as  | grep such
no such architecture modifier: `%s'
broadcast is needed for operand of such type
no such architecture: `%s'
no such instruction: `%s'
```

Unless yasm calls as somewhere under the hood, though I don't think thats the case...



---

archive/issue_comments_309229.json:
```json
{
    "body": "I.e. the error comes from \n\n```\ngcc -c -DHAVE_CONFIG_H -D__GMP_WITHIN_GMP -I.. -DOPERATION_addmul_1 -m64 -O2 -march=corei7-avx -mtune=corei7-avx -g -I. -I.. tmp-addmul_1.s -fPIC -DPIC -o .libs/addmul_1.o\n```\n\nwhich does not use yasm.",
    "created_at": "2017-05-14T08:46:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309229",
    "user": "vbraun"
}
```

I.e. the error comes from 

```
gcc -c -DHAVE_CONFIG_H -D__GMP_WITHIN_GMP -I.. -DOPERATION_addmul_1 -m64 -O2 -march=corei7-avx -mtune=corei7-avx -g -I. -I.. tmp-addmul_1.s -fPIC -DPIC -o .libs/addmul_1.o
```

which does not use yasm.



---

archive/issue_comments_309230.json:
```json
{
    "body": "Ok, that's right.\nMPIR uses yasm or not based on the file extension.\n\nMaybe the error is just because as on debian 7 is just too old?",
    "created_at": "2017-05-14T19:38:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309230",
    "user": "jpflori"
}
```

Ok, that's right.
MPIR uses yasm or not based on the file extension.

Maybe the error is just because as on debian 7 is just too old?



---

archive/issue_comments_309231.json:
```json
{
    "body": "Cannot reproduce this on an unstable debian with the exact same command lines.",
    "created_at": "2017-05-15T12:45:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309231",
    "user": "jpflori"
}
```

Cannot reproduce this on an unstable debian with the exact same command lines.



---

archive/issue_comments_309232.json:
```json
{
    "body": "I would say as is indeed too old.\nThe problematic file is:\n* https://github.com/wbhart/mpir/blob/master/mpn/x86_64/skylake/avx/addmul_1.asm\nusing adcx/adox instructions.\nThese were added in a post july 2012 as release:\n* https://sourceware.org/git/gitweb.cgi?p=binutils-gdb.git;a=commit;h=e2e1fcde622f2f6cedfd7fb6615aa6e136f21dec\nAnd debian wheezy ships binutils 2.22 which is pre-2012:\n* https://ftp.gnu.org/gnu/binutils/\n\nSo can we ignore this very outdated OS?\nIt's a Debian old stable, so quite very old...",
    "created_at": "2017-05-15T12:55:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309232",
    "user": "jpflori"
}
```

I would say as is indeed too old.
The problematic file is:
* https://github.com/wbhart/mpir/blob/master/mpn/x86_64/skylake/avx/addmul_1.asm
using adcx/adox instructions.
These were added in a post july 2012 as release:
* https://sourceware.org/git/gitweb.cgi?p=binutils-gdb.git;a=commit;h=e2e1fcde622f2f6cedfd7fb6615aa6e136f21dec
And debian wheezy ships binutils 2.22 which is pre-2012:
* https://ftp.gnu.org/gnu/binutils/

So can we ignore this very outdated OS?
It's a Debian old stable, so quite very old...



---

archive/issue_comments_309233.json:
```json
{
    "body": "One could argue that wheezy has LTS till may 2018:\n* https://www.debian.org/releases/wheezy/",
    "created_at": "2017-05-15T12:58:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309233",
    "user": "jpflori"
}
```

One could argue that wheezy has LTS till may 2018:
* https://www.debian.org/releases/wheezy/



---

archive/issue_comments_309234.json:
```json
{
    "body": "How would the version of binutils matter? Isn't the asm code meant to be compiled with an up to date yasm installed by Sage?",
    "created_at": "2017-05-15T13:23:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309234",
    "user": "dimpase"
}
```

How would the version of binutils matter? Isn't the asm code meant to be compiled with an up to date yasm installed by Sage?



---

archive/issue_comments_309235.json:
```json
{
    "body": "Nope, some assembly files are compiled with yasm, others with as...",
    "created_at": "2017-05-15T13:25:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309235",
    "user": "jpflori"
}
```

Nope, some assembly files are compiled with yasm, others with as...



---

archive/issue_comments_309236.json:
```json
{
    "body": "Replying to [comment:35 jpflori]:\n> Nope, some assembly files are compiled with yasm, others with as...\n\nOK, so we either have to tell the users to upgrade binutils to something meaningful, or ship our own `gas`...",
    "created_at": "2017-05-15T13:28:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309236",
    "user": "dimpase"
}
```

Replying to [comment:35 jpflori]:
> Nope, some assembly files are compiled with yasm, others with as...

OK, so we either have to tell the users to upgrade binutils to something meaningful, or ship our own `gas`...



---

archive/issue_comments_309237.json:
```json
{
    "body": "Not so many users whould use a pre-2012 `gas`...\nWe can also forbid the use of assembly when `gas` is too old.\nThat's the best solution I have in mind to please the patchbot running Debian 7.",
    "created_at": "2017-05-15T13:34:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309237",
    "user": "jpflori"
}
```

Not so many users whould use a pre-2012 `gas`...
We can also forbid the use of assembly when `gas` is too old.
That's the best solution I have in mind to please the patchbot running Debian 7.



---

archive/issue_comments_309238.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-05-15T15:34:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309238",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_309239.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2017-05-15T15:35:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309239",
    "user": "jpflori"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_309240.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-05-15T15:39:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309240",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_309241.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-05-15T15:41:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309241",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_309242.json:
```json
{
    "body": "It would be nice to get this into Sage 8.0.",
    "created_at": "2017-05-16T08:48:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309242",
    "user": "jpflori"
}
```

It would be nice to get this into Sage 8.0.



---

archive/issue_comments_309243.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-05-16T09:11:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309243",
    "user": "fbissey"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_309244.json:
```json
{
    "body": "OK, sorry for the delay. It looks OK to me. It will work on all the systems we officially support.\n\nFor the records if you are in that kind of trivia `uname -m` is not portable (but is OK across the platform we support so no need to change). For bonus points, can you tell me what kind of system I am testing here\n\n```\n[xcat1-c][/]> uname -m\n00F6B2734C00\n```\n",
    "created_at": "2017-05-16T09:11:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309244",
    "user": "fbissey"
}
```

OK, sorry for the delay. It looks OK to me. It will work on all the systems we officially support.

For the records if you are in that kind of trivia `uname -m` is not portable (but is OK across the platform we support so no need to change). For bonus points, can you tell me what kind of system I am testing here

```
[xcat1-c][/]> uname -m
00F6B2734C00
```




---

archive/issue_comments_309245.json:
```json
{
    "body": "\n```\n-bash-4.3$ uname -m\n00F84C0C4C00\n```\n",
    "created_at": "2017-05-16T09:47:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309245",
    "user": "jpflori"
}
```


```
-bash-4.3$ uname -m
00F84C0C4C00
```




---

archive/issue_comments_309246.json:
```json
{
    "body": "Should have known you'd have access to one of those too.",
    "created_at": "2017-05-16T09:49:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309246",
    "user": "fbissey"
}
```

Should have known you'd have access to one of those too.



---

archive/issue_comments_309247.json:
```json
{
    "body": "On FreeBSD with clang this does not work, as it misidentifies the compiler as gcc and then trips over itself. Does it work with clang on OSX?",
    "created_at": "2017-05-16T20:11:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309247",
    "user": "dimpase"
}
```

On FreeBSD with clang this does not work, as it misidentifies the compiler as gcc and then trips over itself. Does it work with clang on OSX?



---

archive/issue_comments_309248.json:
```json
{
    "body": "I haven't tried yet I must say. Can you post a log so I can see how it trips itself? It'll probably be quicker for me to try on linux+clang actually.",
    "created_at": "2017-05-16T21:09:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309248",
    "user": "fbissey"
}
```

I haven't tried yet I must say. Can you post a log so I can see how it trips itself? It'll probably be quicker for me to try on linux+clang actually.



---

archive/issue_comments_309249.json:
```json
{
    "body": "Replying to [comment:47 fbissey]:\n> I haven't tried yet I must say. Can you post a log so I can see how it trips itself? It'll probably be quicker for me to try on linux+clang actually.\n\nit actually works on FreeBSD/clang, sorry for noise. I used wrong C++ compiler, with `clang++-devel` it works like a charm.",
    "created_at": "2017-05-16T21:36:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309249",
    "user": "dimpase"
}
```

Replying to [comment:47 fbissey]:
> I haven't tried yet I must say. Can you post a log so I can see how it trips itself? It'll probably be quicker for me to try on linux+clang actually.

it actually works on FreeBSD/clang, sorry for noise. I used wrong C++ compiler, with `clang++-devel` it works like a charm.



---

archive/issue_comments_309250.json:
```json
{
    "body": "I just finished building `mpir` on linux+clang without a hitch either.",
    "created_at": "2017-05-16T21:37:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309250",
    "user": "fbissey"
}
```

I just finished building `mpir` on linux+clang without a hitch either.



---

archive/issue_comments_309251.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-05-17T19:38:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309251",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_309252.json:
```json
{
    "body": "now fails with\n\n```\n[mpir-3.0.0] libtool: compile:  gcc -DHAVE_CONFIG_H -I. -D__GMP_WITHIN_GMP -m64 -O2 -march=corei7-avx -mtune=corei7-avx -g -c version.c  -fPIC -DPIC -o .libs/version.o\n[mpir-3.0.0] make[6]: *** No rule to make target `mpn/addmul_1.lo', needed by `libmpir.la'.\n[mpir-3.0.0] make[6]: *** No rule to make target `mpn/mul_basecase.lo', needed by `libmpir.la'.\n[mpir-3.0.0] make[6]: *** No rule to make target `mpn/sqr_basecase.lo', needed by `libmpir.la'.\n[mpir-3.0.0] libtool: compile:  gcc -DHAVE_CONFIG_H -I. -D__GMP_WITHIN_GMP -m64 -O2 -march=corei7-avx -mtune=corei7-avx -g -c tal-reent.c  -fPIC -DPIC -o .libs/tal-reent.o\n[mpir-3.0.0] libtool: compile:  gcc -DHAVE_CONFIG_H -I. -D__GMP_WITHIN_GMP -m64 -O2 -march=corei7-avx -mtune=corei7-avx -g -c version.c -o version.o >/dev/null 2>&1\n[mpir-3.0.0] /bin/bash ./libtool  --tag=CXX   --mode=compile g++ -DHAVE_CONFIG_H -I.  -D__GMP_WITHIN_GMP   -m64 -O2 -march=corei7-avx -mtune=corei7-avx  -g  -c -o cxx/dummy.lo cxx/dummy.cc\n[mpir-3.0.0] libtool: compile:  gcc -DHAVE_CONFIG_H -I. -D__GMP_WITHIN_GMP -m64 -O2 -march=corei7-avx -mtune=corei7-avx -g -c tal-reent.c -o tal-reent.o >/dev/null 2>&1\n[mpir-3.0.0] libtool: compile:  g++ -DHAVE_CONFIG_H -I. -D__GMP_WITHIN_GMP -m64 -O2 -march=corei7-avx -mtune=corei7-avx -g -c cxx/dummy.cc  -fPIC -DPIC -o cxx/.libs/dummy.o\n[mpir-3.0.0] libtool: compile:  g++ -DHAVE_CONFIG_H -I. -D__GMP_WITHIN_GMP -m64 -O2 -march=corei7-avx -mtune=corei7-avx -g -c cxx/dummy.cc -o cxx/dummy.o >/dev/null 2>&1\n[mpir-3.0.0] make[6]: Target `all-am' not remade because of errors.\n[mpir-3.0.0] make[6]: Leaving directory `/home/buildbot/slave/sage_git/build/local/var/tmp/sage/build/mpir-3.0.0/src'\n[mpir-3.0.0] make[5]: *** [all-recursive] Error 1\n[mpir-3.0.0] make[5]: Leaving directory `/home/buildbot/slave/sage_git/build/local/var/tmp/sage/build/mpir-3.0.0/src'\n[mpir-3.0.0] make[4]: *** [all] Error 2\n[mpir-3.0.0] make[4]: Leaving directory `/home/buildbot/slave/sage_git/build/local/var/tmp/sage/build/mpir-3.0.0/src'\n[mpir-3.0.0] Error building MPIR.\n```\n\non Debian 7.\nhttp://build.sagedev.org/#/builders/80/builds/5/steps/5/logs/stdio",
    "created_at": "2017-05-17T19:38:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309252",
    "user": "vbraun"
}
```

now fails with

```
[mpir-3.0.0] libtool: compile:  gcc -DHAVE_CONFIG_H -I. -D__GMP_WITHIN_GMP -m64 -O2 -march=corei7-avx -mtune=corei7-avx -g -c version.c  -fPIC -DPIC -o .libs/version.o
[mpir-3.0.0] make[6]: *** No rule to make target `mpn/addmul_1.lo', needed by `libmpir.la'.
[mpir-3.0.0] make[6]: *** No rule to make target `mpn/mul_basecase.lo', needed by `libmpir.la'.
[mpir-3.0.0] make[6]: *** No rule to make target `mpn/sqr_basecase.lo', needed by `libmpir.la'.
[mpir-3.0.0] libtool: compile:  gcc -DHAVE_CONFIG_H -I. -D__GMP_WITHIN_GMP -m64 -O2 -march=corei7-avx -mtune=corei7-avx -g -c tal-reent.c  -fPIC -DPIC -o .libs/tal-reent.o
[mpir-3.0.0] libtool: compile:  gcc -DHAVE_CONFIG_H -I. -D__GMP_WITHIN_GMP -m64 -O2 -march=corei7-avx -mtune=corei7-avx -g -c version.c -o version.o >/dev/null 2>&1
[mpir-3.0.0] /bin/bash ./libtool  --tag=CXX   --mode=compile g++ -DHAVE_CONFIG_H -I.  -D__GMP_WITHIN_GMP   -m64 -O2 -march=corei7-avx -mtune=corei7-avx  -g  -c -o cxx/dummy.lo cxx/dummy.cc
[mpir-3.0.0] libtool: compile:  gcc -DHAVE_CONFIG_H -I. -D__GMP_WITHIN_GMP -m64 -O2 -march=corei7-avx -mtune=corei7-avx -g -c tal-reent.c -o tal-reent.o >/dev/null 2>&1
[mpir-3.0.0] libtool: compile:  g++ -DHAVE_CONFIG_H -I. -D__GMP_WITHIN_GMP -m64 -O2 -march=corei7-avx -mtune=corei7-avx -g -c cxx/dummy.cc  -fPIC -DPIC -o cxx/.libs/dummy.o
[mpir-3.0.0] libtool: compile:  g++ -DHAVE_CONFIG_H -I. -D__GMP_WITHIN_GMP -m64 -O2 -march=corei7-avx -mtune=corei7-avx -g -c cxx/dummy.cc -o cxx/dummy.o >/dev/null 2>&1
[mpir-3.0.0] make[6]: Target `all-am' not remade because of errors.
[mpir-3.0.0] make[6]: Leaving directory `/home/buildbot/slave/sage_git/build/local/var/tmp/sage/build/mpir-3.0.0/src'
[mpir-3.0.0] make[5]: *** [all-recursive] Error 1
[mpir-3.0.0] make[5]: Leaving directory `/home/buildbot/slave/sage_git/build/local/var/tmp/sage/build/mpir-3.0.0/src'
[mpir-3.0.0] make[4]: *** [all] Error 2
[mpir-3.0.0] make[4]: Leaving directory `/home/buildbot/slave/sage_git/build/local/var/tmp/sage/build/mpir-3.0.0/src'
[mpir-3.0.0] Error building MPIR.
```

on Debian 7.
http://build.sagedev.org/#/builders/80/builds/5/steps/5/logs/stdio



---

archive/issue_comments_309253.json:
```json
{
    "body": "Debian 7 again :/",
    "created_at": "2017-05-17T21:47:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309253",
    "user": "jpflori"
}
```

Debian 7 again :/



---

archive/issue_comments_309254.json:
```json
{
    "body": "Looks like the fix didn't work\n\n```\n[mpir-3.0.0] tmp-addmul_1.s: Assembler messages:\n[mpir-3.0.0] tmp-addmul_1.s:152: Error: no such instruction: `adox (%rdi),%r9'\n[mpir-3.0.0] tmp-addmul_1.s:154: Error: no such instruction: `adox %rcx,%rax'\n[mpir-3.0.0] tmp-addmul_1.s:166: Error: no such instruction: `adox -8(%rdi),%r10'\n[mpir-3.0.0] tmp-addmul_1.s:167: Error: no such instruction: `adcx %r8,%r9'\n[mpir-3.0.0] tmp-addmul_1.s:171: Error: no such instruction: `adox (%rdi),%r9'\n[mpir-3.0.0] tmp-addmul_1.s:174: Error: no such instruction: `adcx %rax,%r10'\n[mpir-3.0.0] tmp-addmul_1.s:176: Error: no such instruction: `adcx %r8,%r9'\n[mpir-3.0.0] tmp-addmul_1.s:177: Error: no such instruction: `adox 8(%rdi),%r10'\n[mpir-3.0.0] tmp-addmul_1.s:181: Error: no such instruction: `adcx %rax,%r10'\n[mpir-3.0.0] tmp-addmul_1.s:182: Error: no such instruction: `adox 16(%rdi),%r9'\n[mpir-3.0.0] tmp-addmul_1.s:185: Error: no such instruction: `adox 24(%rdi),%r10'\n[mpir-3.0.0] tmp-addmul_1.s:186: Error: no such instruction: `adcx %r8,%r9'\n[mpir-3.0.0] tmp-addmul_1.s:189: Error: no such instruction: `adcx %rax,%r10'\n[mpir-3.0.0] tmp-addmul_1.s:190: Error: no such instruction: `adox 32(%rdi),%r9'\n[mpir-3.0.0] tmp-addmul_1.s:193: Error: no such instruction: `adox 40(%rdi),%r10'\n[mpir-3.0.0] tmp-addmul_1.s:194: Error: no such instruction: `adcx %r8,%r9'\n[mpir-3.0.0] tmp-addmul_1.s:196: Error: no such instruction: `adox 48(%rdi),%r9'\n[mpir-3.0.0] tmp-addmul_1.s:200: Error: no such instruction: `adcx %rax,%r10'\n[mpir-3.0.0] /bin/bash ../libtool --mode=compile --tag=CC ../strip_fPIC.sh /home/buildbot/slave/sage_git/build/local/bin/yasm -I .. -f elf64  -o lshift.lo `test -f 'lshift.as' || echo './'`lshift.as\n[mpir-3.0.0] make[6]: *** [addmul_1.lo] Error 1\n```\n\nback to the drawing board.",
    "created_at": "2017-05-17T21:51:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309254",
    "user": "fbissey"
}
```

Looks like the fix didn't work

```
[mpir-3.0.0] tmp-addmul_1.s: Assembler messages:
[mpir-3.0.0] tmp-addmul_1.s:152: Error: no such instruction: `adox (%rdi),%r9'
[mpir-3.0.0] tmp-addmul_1.s:154: Error: no such instruction: `adox %rcx,%rax'
[mpir-3.0.0] tmp-addmul_1.s:166: Error: no such instruction: `adox -8(%rdi),%r10'
[mpir-3.0.0] tmp-addmul_1.s:167: Error: no such instruction: `adcx %r8,%r9'
[mpir-3.0.0] tmp-addmul_1.s:171: Error: no such instruction: `adox (%rdi),%r9'
[mpir-3.0.0] tmp-addmul_1.s:174: Error: no such instruction: `adcx %rax,%r10'
[mpir-3.0.0] tmp-addmul_1.s:176: Error: no such instruction: `adcx %r8,%r9'
[mpir-3.0.0] tmp-addmul_1.s:177: Error: no such instruction: `adox 8(%rdi),%r10'
[mpir-3.0.0] tmp-addmul_1.s:181: Error: no such instruction: `adcx %rax,%r10'
[mpir-3.0.0] tmp-addmul_1.s:182: Error: no such instruction: `adox 16(%rdi),%r9'
[mpir-3.0.0] tmp-addmul_1.s:185: Error: no such instruction: `adox 24(%rdi),%r10'
[mpir-3.0.0] tmp-addmul_1.s:186: Error: no such instruction: `adcx %r8,%r9'
[mpir-3.0.0] tmp-addmul_1.s:189: Error: no such instruction: `adcx %rax,%r10'
[mpir-3.0.0] tmp-addmul_1.s:190: Error: no such instruction: `adox 32(%rdi),%r9'
[mpir-3.0.0] tmp-addmul_1.s:193: Error: no such instruction: `adox 40(%rdi),%r10'
[mpir-3.0.0] tmp-addmul_1.s:194: Error: no such instruction: `adcx %r8,%r9'
[mpir-3.0.0] tmp-addmul_1.s:196: Error: no such instruction: `adox 48(%rdi),%r9'
[mpir-3.0.0] tmp-addmul_1.s:200: Error: no such instruction: `adcx %rax,%r10'
[mpir-3.0.0] /bin/bash ../libtool --mode=compile --tag=CC ../strip_fPIC.sh /home/buildbot/slave/sage_git/build/local/bin/yasm -I .. -f elf64  -o lshift.lo `test -f 'lshift.as' || echo './'`lshift.as
[mpir-3.0.0] make[6]: *** [addmul_1.lo] Error 1
```

back to the drawing board.



---

archive/issue_comments_309255.json:
```json
{
    "body": "Hum, I did not actually test on a debian 7 seven, I just looked at what GNU as version is provided there and thought I ound the issue.\nSo several possibilities:\n* I'm stupid,\n* the check for as version I implemented is wrong,\n* the issue is somewhere else.\n\nThe easiest way to solve this would be to get access to the machine...\nI downloaded a bunch of qemu debian 7 images but the pc I mostly work on does not have internet access and these images come wihtout gnu as :/",
    "created_at": "2017-05-17T21:55:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309255",
    "user": "jpflori"
}
```

Hum, I did not actually test on a debian 7 seven, I just looked at what GNU as version is provided there and thought I ound the issue.
So several possibilities:
* I'm stupid,
* the check for as version I implemented is wrong,
* the issue is somewhere else.

The easiest way to solve this would be to get access to the machine...
I downloaded a bunch of qemu debian 7 images but the pc I mostly work on does not have internet access and these images come wihtout gnu as :/



---

archive/issue_comments_309256.json:
```json
{
    "body": "I think the as version check is correct but `\"$CC\" = GCC` is always false unless you really go out of your way to rename gcc...",
    "created_at": "2017-05-17T22:21:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309256",
    "user": "vbraun"
}
```

I think the as version check is correct but `"$CC" = GCC` is always false unless you really go out of your way to rename gcc...



---

archive/issue_comments_309257.json:
```json
{
    "body": "PS:\n\n```\nbuildbot@sagebd07_64s02:~$ as --version | head -1 | awk 'NF>1{print $NF}'\n2.22\n```\n",
    "created_at": "2017-05-17T22:22:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309257",
    "user": "vbraun"
}
```

PS:

```
buildbot@sagebd07_64s02:~$ as --version | head -1 | awk 'NF>1{print $NF}'
2.22
```




---

archive/issue_comments_309258.json:
```json
{
    "body": "Replying to [comment:54 vbraun]:\n> I think the as version check is correct but `\"$CC\" = GCC` is always false unless you really go out of your way to rename gcc...\n\nYou are probably right. It is not a correct way to ascertain that `CC` is `gcc`, you'd have to look at `$CC -v` or similar. Considering the only other possibility is `clang`  during toolchain building on OS X and that\n\n```\nMirage:~ fbissey$ as --version | head -1 | awk 'NF>1{print $NF}'\n(clang-802.0.42)\n```\n\nwon't be caught by your `case` statement, I think we can just scrap the `$CC=GCC` bit.",
    "created_at": "2017-05-17T22:35:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309258",
    "user": "fbissey"
}
```

Replying to [comment:54 vbraun]:
> I think the as version check is correct but `"$CC" = GCC` is always false unless you really go out of your way to rename gcc...

You are probably right. It is not a correct way to ascertain that `CC` is `gcc`, you'd have to look at `$CC -v` or similar. Considering the only other possibility is `clang`  during toolchain building on OS X and that

```
Mirage:~ fbissey$ as --version | head -1 | awk 'NF>1{print $NF}'
(clang-802.0.42)
```

won't be caught by your `case` statement, I think we can just scrap the `$CC=GCC` bit.



---

archive/issue_comments_309259.json:
```json
{
    "body": "Argh, Now I see why I had started a bit of my answer differently. If you are worried about using clang on linux, which is in the future so far, we'll do it when it become possible. Using an output from configure preferably (I currently output a variable `IS_CLANG` in `sage-env-config` and that's much more reliable).",
    "created_at": "2017-05-17T22:40:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309259",
    "user": "fbissey"
}
```

Argh, Now I see why I had started a bit of my answer differently. If you are worried about using clang on linux, which is in the future so far, we'll do it when it become possible. Using an output from configure preferably (I currently output a variable `IS_CLANG` in `sage-env-config` and that's much more reliable).



---

archive/issue_comments_309260.json:
```json
{
    "body": "Replying to [comment:35 jpflori]:\n> Nope, some assembly files are compiled with yasm, others with as...\n\nAre we sure that this is an upstream *feature*? It seems strange to me...",
    "created_at": "2017-05-18T08:09:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309260",
    "user": "jdemeyer"
}
```

Replying to [comment:35 jpflori]:
> Nope, some assembly files are compiled with yasm, others with as...

Are we sure that this is an upstream *feature*? It seems strange to me...



---

archive/issue_comments_309261.json:
```json
{
    "body": "Yes it is.\nOne of the former developer prefered ATT syntax over intel (or the other way around) and that was not very well supported by gas at that time, don't know the current situation.\nMoreover yasm provides better windows support with stack dark magic unwinding feature.\n\nFiles are treated by yasm or gas depending on their extension (as or asm).",
    "created_at": "2017-05-18T08:14:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309261",
    "user": "jpflori"
}
```

Yes it is.
One of the former developer prefered ATT syntax over intel (or the other way around) and that was not very well supported by gas at that time, don't know the current situation.
Moreover yasm provides better windows support with stack dark magic unwinding feature.

Files are treated by yasm or gas depending on their extension (as or asm).



---

archive/issue_comments_309262.json:
```json
{
    "body": "Replying to [comment:54 vbraun]:\n> I think the as version check is correct but `\"$CC\" = GCC` is always false unless you really go out of your way to rename gcc...\nOops!",
    "created_at": "2017-05-18T08:17:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309262",
    "user": "jpflori"
}
```

Replying to [comment:54 vbraun]:
> I think the as version check is correct but `"$CC" = GCC` is always false unless you really go out of your way to rename gcc...
Oops!



---

archive/issue_comments_309263.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-05-18T08:21:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309263",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_309264.json:
```json
{
    "body": "Argh, I merged unrelated stuff.",
    "created_at": "2017-05-18T08:22:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309264",
    "user": "jpflori"
}
```

Argh, I merged unrelated stuff.



---

archive/issue_comments_309265.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-05-18T08:24:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309265",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_309266.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-05-18T08:25:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309266",
    "user": "jpflori"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_309267.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-05-18T08:51:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309267",
    "user": "fbissey"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_309268.json:
```json
{
    "body": "Once again to the bots.",
    "created_at": "2017-05-18T08:51:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309268",
    "user": "fbissey"
}
```

Once again to the bots.



---

archive/issue_comments_309269.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-05-19T22:09:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309269",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_309270.json:
```json
{
    "body": "\n```\n[mpir-3.0.0] ./spkg-install: line 168: as_version: command not found\n```\n\nIn bash you can't have a space before the equal sign in assignment...",
    "created_at": "2017-05-19T22:09:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309270",
    "user": "vbraun"
}
```


```
[mpir-3.0.0] ./spkg-install: line 168: as_version: command not found
```

In bash you can't have a space before the equal sign in assignment...



---

archive/issue_comments_309271.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-05-22T11:48:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309271",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_309272.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-05-22T11:49:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309272",
    "user": "jpflori"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_309273.json:
```json
{
    "body": "`@`francois: push the button again?",
    "created_at": "2017-05-24T13:40:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309273",
    "user": "jpflori"
}
```

`@`francois: push the button again?



---

archive/issue_comments_309274.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-05-24T13:43:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309274",
    "user": "dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_309275.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-05-26T21:28:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309275",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_309276.json:
```json
{
    "body": "\n```\n+# Workaround old GNU as version by disabling assembly use.\n+if [ \"$UNAME\" = Linux ] && [ \"$CC\" = GCC ]; then\n+    as_version = `$AS --version | head -1 | awk 'NF>1{print $NF}'`\n+    case \"$as_version\" in\n+        1.*|2.1*|2.[0-2]*)\n                  ^^^^^^^\n+        echo \"Disable use of assembly because of GNU as < 2.23.\"\n+        export MPN_PATH=generic\n+        ;;\n+    esac\n+fi\n```\n\n\nShouldn't that be `2.2[0-2]*`? In other words, aren't you disabling assembly for everyone on Linux/gcc here?\n\nSage has become significantly slower on my system (judging from a few quick experiments, perhaps 10-15% slower on average, with integer operations 1.5\u00d7 to 2\u00d7 slower) somewhere between 7.6.rc2 and 8.0.beta9, and I'm wondering if this isn't the cause of the regression...",
    "created_at": "2017-06-10T12:18:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309276",
    "user": "mmezzarobba"
}
```


```
+# Workaround old GNU as version by disabling assembly use.
+if [ "$UNAME" = Linux ] && [ "$CC" = GCC ]; then
+    as_version = `$AS --version | head -1 | awk 'NF>1{print $NF}'`
+    case "$as_version" in
+        1.*|2.1*|2.[0-2]*)
                  ^^^^^^^
+        echo "Disable use of assembly because of GNU as < 2.23."
+        export MPN_PATH=generic
+        ;;
+    esac
+fi
```


Shouldn't that be `2.2[0-2]*`? In other words, aren't you disabling assembly for everyone on Linux/gcc here?

Sage has become significantly slower on my system (judging from a few quick experiments, perhaps 10-15% slower on average, with integer operations 1.5 to 2 slower) somewhere between 7.6.rc2 and 8.0.beta9, and I'm wondering if this isn't the cause of the regression...



---

archive/issue_comments_309277.json:
```json
{
    "body": "Replying to [comment:72 myself]: Indeed, changing `2.[0-2]` to `2.2[0-2]` solves the issue. Follow-up at #23209.",
    "created_at": "2017-06-10T12:56:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309277",
    "user": "mmezzarobba"
}
```

Replying to [comment:72 myself]: Indeed, changing `2.[0-2]` to `2.2[0-2]` solves the issue. Follow-up at #23209.



---

archive/issue_comments_309278.json:
```json
{
    "body": "This ticket caused a significant performance regression: #23327",
    "created_at": "2017-06-27T10:39:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309278",
    "user": "jdemeyer"
}
```

This ticket caused a significant performance regression: #23327



---

archive/issue_comments_309279.json:
```json
{
    "body": "Replying to [comment:74 jdemeyer]:\n> This ticket caused a significant performance regression: #23327\n\nThis is not fixed by #23146?",
    "created_at": "2017-06-27T13:26:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22256#issuecomment-309279",
    "user": "tscrim"
}
```

Replying to [comment:74 jdemeyer]:
> This ticket caused a significant performance regression: #23327

This is not fixed by #23146?
