# Issue 20877: ATLAS spkg doesn't need /Sage's/ python to build

archive/issues_020877.json:
```json
{
    "body": "CC:  @vbraun\n\nKeywords: sage-spkg dependencies spkg-install\n\nSince we meanwhile require a *system* python to let Sage build anyway, we don't have to wait with building ATLAS until Sage's python has been built, as ATLAS doesn't install any Python libraries, but only its `spkg-install` has been rewritten in Python quite a while ago.\n\nThis requires two things:\n\n* Remove the dependency of ATLAS on `$(PYTHON)` (which means Sage's `python2` or `python3` package) in its `dependencies`.\n\n* Make ATLAS' `spkg-install` again a shell script, renaming the current one to `spkg-install.py`, say, where the shell script just contains\n\n```sh\n#!/bin/sh\nexec python spkg-install.py\n```\n   This is necessary because `sage-spkg` checks whether *Sage's* `python` is already installed if an `spkg-install` script starts with `#! ... python`, and bails out otherwise:\n\n```\natlas-3.10.2.p2\n====================================================\nSetting up build directory for atlas-3.10.2.p2\nFinished set up\nError: The spkg-install script is written in Python, but the Python\npackage is not yet installed in Sage.  You should add $(PYTHON)\nas dependency in build/pkgs/atlas/dependencies\nmake[2]: *** [.../sage/local/var/lib/sage/installed/atlas-3.10.2.p2] Error 1\n```\n  (Note that this message originates from a build where the `Makefile` was broken, such that the `make` dependency of ATLAS on the python package was fulfilled by `$(PYTHON)` accidentally being empty.  So one won't get this message unless the `Makefile` is corrupted.)\n\n---\n\nRather orthogonal to that, our top-level `configure` doesn't contain any check for `python` yet, although currently at least `sage-download-file` and `sage-uncompress-spkg` require (a system) python (in the beginning of the build).  I'll address that on another ticket -- see #21116.\n\nIssue created by migration from https://trac.sagemath.org/ticket/21114\n\n",
    "closed_at": "2021-10-04T23:44:13Z",
    "created_at": "2016-07-28T13:36:05Z",
    "labels": [
        "component: packages: standard",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "ATLAS spkg doesn't need /Sage's/ python to build",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20877",
    "user": "https://github.com/nexttime"
}
```
CC:  @vbraun

Keywords: sage-spkg dependencies spkg-install

Since we meanwhile require a *system* python to let Sage build anyway, we don't have to wait with building ATLAS until Sage's python has been built, as ATLAS doesn't install any Python libraries, but only its `spkg-install` has been rewritten in Python quite a while ago.

This requires two things:

* Remove the dependency of ATLAS on `$(PYTHON)` (which means Sage's `python2` or `python3` package) in its `dependencies`.

* Make ATLAS' `spkg-install` again a shell script, renaming the current one to `spkg-install.py`, say, where the shell script just contains

```sh
#!/bin/sh
exec python spkg-install.py
```
   This is necessary because `sage-spkg` checks whether *Sage's* `python` is already installed if an `spkg-install` script starts with `#! ... python`, and bails out otherwise:

```
atlas-3.10.2.p2
====================================================
Setting up build directory for atlas-3.10.2.p2
Finished set up
Error: The spkg-install script is written in Python, but the Python
package is not yet installed in Sage.  You should add $(PYTHON)
as dependency in build/pkgs/atlas/dependencies
make[2]: *** [.../sage/local/var/lib/sage/installed/atlas-3.10.2.p2] Error 1
```
  (Note that this message originates from a build where the `Makefile` was broken, such that the `make` dependency of ATLAS on the python package was fulfilled by `$(PYTHON)` accidentally being empty.  So one won't get this message unless the `Makefile` is corrupted.)

---

Rather orthogonal to that, our top-level `configure` doesn't contain any check for `python` yet, although currently at least `sage-download-file` and `sage-uncompress-spkg` require (a system) python (in the beginning of the build).  I'll address that on another ticket -- see #21116.

Issue created by migration from https://trac.sagemath.org/ticket/21114





---

archive/issue_comments_288307.json:
```json
{
    "body": "outdated after atlas spkg removal in #30350",
    "created_at": "2021-09-25T17:37:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20877",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20877#issuecomment-288307",
    "user": "https://github.com/mkoeppe"
}
```

outdated after atlas spkg removal in #30350



---

archive/issue_comments_288308.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-09-25T17:37:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20877",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20877#issuecomment-288308",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_events_056358.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-25T17:37:00Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20877",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20877#event-56358"
}
```



---

archive/issue_comments_288309.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-10-04T23:25:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20877",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20877#issuecomment-288309",
    "user": "https://github.com/orlitzky"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_056359.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-10-04T23:44:13Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/20877",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20877#event-56359"
}
```



---

archive/issue_comments_288310.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2021-10-04T23:44:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20877",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20877#issuecomment-288310",
    "user": "https://github.com/mkoeppe"
}
```

Resolution: invalid
