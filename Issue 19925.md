# Issue 19925: properties of converted finite field elements are wrong

Issue created by migration from https://trac.sagemath.org/ticket/20162

Original creator: behackl

Original creation time: 2016-03-04 21:55:42

CC:  rws

This should not happen:

```
sage: k.<a> = GF(9)
sage: SR(a).is_real()
True
sage: SR(a).is_positive()
True
```



---

Comment by behackl created at 2016-03-04 21:59:22

New commits:


---

Comment by behackl created at 2016-03-04 21:59:22

Changing status from new to needs_review.


---

Comment by rws created at 2016-03-05 14:04:53

Patchbot shows doctest fails.


---

Comment by behackl created at 2016-03-05 16:44:51

Ah, yes. Maybe I need another way of finding out whether a parent is a finite field; `is_finite` seems to throw `NotImplementedError`s here. That would fix the failures in `schemes/elliptic_curves/heigth.py`.

However, I'm not sure about the segmentation fault in `expression.pyx`, calling

```
sage: (Mod(2,7)*x^2 + Mod(2,7))^7
```

from `sage -gdb` prints the line

```
Program received signal SIGSEGV, Segmentation fault.
GiNaC::add::integer_content (this=0x3019c20) at normal.cpp:325
```

It seems that something requires the expression to be a real in order for the power to work. This is bad.

Maybe I'll investigate later; have to go now.


---

Comment by git created at 2016-03-06 09:48:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by behackl created at 2016-03-06 09:57:46

The last commit fixes the doctest failures in `schemes/elliptic_curves/height.py`, but not the segmentation fault. Unfortunately, the reason for that lies in pynac---a fix can be found here: https://github.com/pynac/pynac/pull/160.


---

Comment by vdelecroix created at 2016-03-09 18:43:51

Just to share some related fun with quotients of the integer ring

```
sage: cos(Zmod(7)(3))
-0.989992496600445
sage: cos(Zmod(10)(3))
1
sage: cos(Zmod(15)(3))
1
```



---

Comment by behackl created at 2016-03-09 19:40:04

With pynac-0.6.4 (#20134):

```
sage: cos(Zmod(7)(3))
-0.989992496600445
sage: cos(Zmod(10)(3))
-0.989992496600445
sage: cos(Zmod(15)(3))
-0.989992496600445
```

In an ideal world, this would probably raise a `ValueError` or so. This way it is at least consistent.


---

Comment by mmezzarobba created at 2016-04-18 11:42:40

I doubt it is such a good idea to special-case finite fields here. Why does `py_imag` default to returning `True` in the first place?! And as for returning results based on the parent of the wrapped object, I'd be tempted to base the logic on whether the parent has coercions to things like `{Real,Complex}Field(mpfr_prec_min())` instead of having explicit lists of “real” and “non-real” parents.


---

Comment by behackl created at 2016-04-18 12:02:23

Replying to [comment:9 mmezzarobba]:
> I doubt it is such a good idea to special-case finite fields here. Why does `py_imag` default to returning `True` in the first place?! 

This is because if in doubt `py_is_real` asks `py_imag` whether the imaginary part is 0---which is the case for these elements, because if in doubt, `py_imag` assumes that the imaginary part is 0. ;-)

> And as for returning results based on the parent of the wrapped object, I'd be tempted to base the logic on whether the parent has coercions to things like `{Real,Complex}Field(mpfr_prec_min())` instead of having explicit lists of “real” and “non-real” parents.

This might be an approach worth pursuing.


---

Comment by behackl created at 2016-04-18 12:02:33

Changing status from needs_review to needs_work.


---

Comment by rws created at 2016-05-11 06:08:10

Now (with #20312) both flags are false. Can this case be considered to be fixed? Then just a doctest would be needed here.


---

Comment by rws created at 2017-01-10 14:31:48

With #22162 this would return `Unknown`, and a doctest already exist (changed in #22162) so I think this is a duplicate now.


---

Comment by rws created at 2017-01-10 14:31:48

Changing status from needs_work to needs_review.


---

Comment by cheuberg created at 2017-01-12 06:48:02

Changing status from needs_review to needs_work.


---

Comment by cheuberg created at 2017-01-12 06:48:02

In any case, this produces a merge conflict.


---

Comment by rws created at 2017-01-12 07:32:40

Changing status from needs_work to needs_review.


---

Comment by rws created at 2017-01-12 07:32:40

Replying to [comment:14 cheuberg]:
> In any case, this produces a merge conflict.

Needs work on a duplicate request!?


---

Comment by cheuberg created at 2017-01-12 07:43:08

sorry, did not see the sage-duplicate/invalid/wontfix milestone.


---

Comment by cheuberg created at 2017-01-12 07:47:54

I see that the problem is fixed; can you tell me where the doctest is? I did not see it at first glance.


---

Comment by rws created at 2017-01-12 08:28:56

It was added with https://github.com/sagemath/sage/commit/11e2b784
(bottom)


---

Comment by cheuberg created at 2017-01-12 09:25:27

Problem is fixed and doctest has been included in #20475.


---

Comment by cheuberg created at 2017-01-12 09:25:27

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-01-21 18:03:11

Resolution: invalid
