# Issue 31762: Use Vector_symbolic_dense for all symbolic rings, not just SR

Issue created by migration from https://trac.sagemath.org/ticket/31999

Original creator: mkoeppe

Original creation time: 2021-06-17 18:07:08

CC:  egourgoulhon @mjungmath tscrim

(split out from #31982)

We change the function `sage.modules.free_module.element_class` so that it uses the element class `Vector_symbolic_dense` not only for free modules over the ring `SR` but also for free modules over any commutative ring whose base ring is `SR`.

In fact, we dispatch through a new method `_free_module_element_class_dense`.


---

Comment by mkoeppe created at 2021-06-17 18:39:35

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2021-06-17 18:39:35

New commits:


---

Comment by tscrim created at 2021-06-17 22:50:14

What about if we have something like `R = SR['t']['x']`? Then the base ring of `R` is `SR['t']`, which is not `SR`. How do you want to handle that?


---

Comment by git created at 2021-06-18 20:21:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-06-18 20:24:12

OK, this needs more thought. For now I have reduced the scope of the ticket. Ready for review.


---

Comment by mkoeppe created at 2021-06-20 00:07:54

Changing status from needs_review to needs_work.


---

Comment by mkoeppe created at 2021-06-20 00:09:20

The pickling error first observed in #31982 unsurprisingly also shows up here:

```
sage -t --long --random-seed=0 src/sage/algebras/lie_algebras/quotient.py  # 1 doctest failed
sage -t --long --random-seed=0 src/sage/modules/free_module_element.pyx  # 1 doctest failed
```



---

Comment by mkoeppe created at 2021-07-19 00:44:56

Setting a new milestone for this ticket based on a cursory review.
