# Issue 24981: Extract roots in NumberField if possible

archive/issues_024981.json:
```json
{
    "body": "CC:  @slel\n\nKeywords: NumberField\n\nNumberField previously evaluated integral powers in the NumberField, and evaluated all fractional powers in the symbolic ring.\n\nThis patch makes NumberField attempt to evaluate the fractional power within the field, and only falls back on the symbolic ring if this fails.\n\nThere's a few interesting changes in the test suite.\n\nOld code:\n\n```\nsage: QQbar((2*I)^(1/2))\n1 + 1*I\nsage: (2*I)^(1/2)\nsqrt(2*I)\nsage: I^(2/3)\nI^(2/3)\n```\n\nNew code:\n\n```\nsage: QQbar((2*I)^(1/2))\nI + 1\nsage: (2*I)^(1/2)\nI + 1\nsage: I^(2/3)\n-1\n```\n\nThe first change is just cosmetic.  The second makes good sense, as Sage is now evaluating an expression it didn't before.  The third change is more troubling.\n\nThe explanation lies in the definition of I:\n\n```\nsage: I.parent()\nSymbolic Ring\nsage: I.pyobject().parent()\nNumber Field in I with defining polynomial x^2 + 1\n```\n\nIn this number field, there is a single cube root of `I` (`-I`).  Squaring `-I` gives us `-1`, so `I^(2/3)=-1`.\n\nMy opinion is that the new behavior of NumberField is correct and preferred, but perhaps `I` should be defined in QQbar, not in a NumberField.\n\nIssue created by migration from https://trac.sagemath.org/ticket/25218\n\n",
    "created_at": "2018-04-20T04:16:42Z",
    "labels": [
        "component: algebra",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.3",
    "title": "Extract roots in NumberField if possible",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24981",
    "user": "https://github.com/BrentBaccala"
}
```
CC:  @slel

Keywords: NumberField

NumberField previously evaluated integral powers in the NumberField, and evaluated all fractional powers in the symbolic ring.

This patch makes NumberField attempt to evaluate the fractional power within the field, and only falls back on the symbolic ring if this fails.

There's a few interesting changes in the test suite.

Old code:

```
sage: QQbar((2*I)^(1/2))
1 + 1*I
sage: (2*I)^(1/2)
sqrt(2*I)
sage: I^(2/3)
I^(2/3)
```

New code:

```
sage: QQbar((2*I)^(1/2))
I + 1
sage: (2*I)^(1/2)
I + 1
sage: I^(2/3)
-1
```

The first change is just cosmetic.  The second makes good sense, as Sage is now evaluating an expression it didn't before.  The third change is more troubling.

The explanation lies in the definition of I:

```
sage: I.parent()
Symbolic Ring
sage: I.pyobject().parent()
Number Field in I with defining polynomial x^2 + 1
```

In this number field, there is a single cube root of `I` (`-I`).  Squaring `-I` gives us `-1`, so `I^(2/3)=-1`.

My opinion is that the new behavior of NumberField is correct and preferred, but perhaps `I` should be defined in QQbar, not in a NumberField.

Issue created by migration from https://trac.sagemath.org/ticket/25218





---

archive/issue_comments_351163.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-04-20T04:26:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24981#issuecomment-351163",
    "user": "https://github.com/BrentBaccala"
}
```

New commits:



---

archive/issue_comments_351164.json:
```json
{
    "body": "Regarding the suggestion that\n\n> perhaps `I` should be defined in QQbar, not in a NumberField,\n\n\nsee also #18036.",
    "created_at": "2018-04-20T09:45:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24981#issuecomment-351164",
    "user": "https://github.com/slel"
}
```

Regarding the suggestion that

> perhaps `I` should be defined in QQbar, not in a NumberField,


see also #18036.



---

archive/issue_comments_351165.json:
```json
{
    "body": "The following tickets are possibly related.\n\n- #7545: Gaussian and Eisenstein integers\n  #7545\n\n- #18036: I.parent() should not be the symbolic ring\n  #18036\n\n- #22208: Conversion from SR to number fields\n  #22208\n\n- #25178: SR('I') is not consistent\n  #25178\n\n- #25218: Extract roots in NumberField if possible\n  #25218",
    "created_at": "2018-04-20T09:54:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24981#issuecomment-351165",
    "user": "https://github.com/slel"
}
```

The following tickets are possibly related.

- #7545: Gaussian and Eisenstein integers
  #7545

- #18036: I.parent() should not be the symbolic ring
  #18036

- #22208: Conversion from SR to number fields
  #22208

- #25178: SR('I') is not consistent
  #25178

- #25218: Extract roots in NumberField if possible
  #25218



---

archive/issue_comments_351166.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-20T17:09:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24981#issuecomment-351166",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_351167.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-04-20T19:49:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24981#issuecomment-351167",
    "user": "https://github.com/BrentBaccala"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_351168.json:
```json
{
    "body": "I did small spaces fixes. If you agree with my changes, please change the status to positive review.\n\n---\nNew commits:",
    "created_at": "2018-04-26T09:43:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24981#issuecomment-351168",
    "user": "https://github.com/seblabbe"
}
```

I did small spaces fixes. If you agree with my changes, please change the status to positive review.

---
New commits:



---

archive/issue_comments_351169.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-04-26T17:07:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24981#issuecomment-351169",
    "user": "https://github.com/BrentBaccala"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_063276.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2018-05-17T11:05:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/24981",
    "milestone": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24981#event-63276"
}
```



---

archive/issue_events_063277.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-05-18T17:49:14Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24981",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24981#event-63277"
}
```



---

archive/issue_comments_351170.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-05-18T17:49:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24981#issuecomment-351170",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_351171.json:
```json
{
    "body": "Replying to [ticket:25218 gh-BrentBaccala]:\n> The third change is more troubling.\n> \n> The explanation lies in the definition of I:\n> \n> \n> ```\n> sage: I.parent()\n> Symbolic Ring\n> sage: I.pyobject().parent()\n> Number Field in I with defining polynomial x^2 + 1\n> ```\n> \n> In this number field, there is a single cube root of `I` (`-I`).  Squaring `-I` gives us `-1`, so `I^(2/3)=-1`.\n> \n> My opinion is that the new behavior of NumberField is correct and preferred, but perhaps `I` should be defined in QQbar, not in a NumberField.\n\n\nI think this is **very** unfortunate. In Sage, QQ[i] automatically comes with a complex embedding, for which i<sup>2/3</sup> (= exp(i\u03c0/3)) is perfectly well defined. It is really confusing to have a basic operator like `^` (whose evaluation normally uses the coercion framework) that is incompatible with the embedding.\n\nSee #30783.",
    "created_at": "2020-10-17T16:48:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24981#issuecomment-351171",
    "user": "https://github.com/mezzarobba"
}
```

Replying to [ticket:25218 gh-BrentBaccala]:
> The third change is more troubling.
> 
> The explanation lies in the definition of I:
> 
> 
> ```
> sage: I.parent()
> Symbolic Ring
> sage: I.pyobject().parent()
> Number Field in I with defining polynomial x^2 + 1
> ```
> 
> In this number field, there is a single cube root of `I` (`-I`).  Squaring `-I` gives us `-1`, so `I^(2/3)=-1`.
> 
> My opinion is that the new behavior of NumberField is correct and preferred, but perhaps `I` should be defined in QQbar, not in a NumberField.


I think this is **very** unfortunate. In Sage, QQ[i] automatically comes with a complex embedding, for which i<sup>2/3</sup> (= exp(iÏ€/3)) is perfectly well defined. It is really confusing to have a basic operator like `^` (whose evaluation normally uses the coercion framework) that is incompatible with the embedding.

See #30783.
