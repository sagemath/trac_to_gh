# Issue 24981: Extract roots in NumberField if possible

Issue created by migration from Trac.

Original creator: @BrentBaccala

Original creation time: 2018-04-20 04:16:42

CC:  slelievre

Keywords: NumberField

NumberField previously evaluated integral powers in the NumberField, and evaluated all fractional powers in the symbolic ring.

This patch makes NumberField attempt to evaluate the fractional power within the field, and only falls back on the symbolic ring if this fails.

There's a few interesting changes in the test suite.

Old code:


```
sage: QQbar((2*I)^(1/2))
1 + 1*I
sage: (2*I)^(1/2)
sqrt(2*I)
sage: I^(2/3)
I^(2/3)
```


New code:


```
sage: QQbar((2*I)^(1/2))
I + 1
sage: (2*I)^(1/2)
I + 1
sage: I^(2/3)
-1
```


The first change is just cosmetic.  The second makes good sense, as Sage is now evaluating an expression it didn't before.  The third change is more troubling.

The explanation lies in the definition of I:


```
sage: I.parent()
Symbolic Ring
sage: I.pyobject().parent()
Number Field in I with defining polynomial x^2 + 1
```


In this number field, there is a single cube root of `I` (`-I`).  Squaring `-I` gives us `-1`, so `I^(2/3)=-1`.

My opinion is that the new behavior of NumberField is correct and preferred, but perhaps `I` should be defined in QQbar, not in a NumberField.


---

Comment by @BrentBaccala created at 2018-04-20 04:26:02

New commits:


---

Comment by slelievre created at 2018-04-20 09:45:58

Regarding the suggestion that

> perhaps `I` should be defined in QQbar, not in a NumberField,

see also #18036.


---

Comment by slelievre created at 2018-04-20 09:54:58

The following tickets are possibly related.

- #7545: Gaussian and Eisenstein integers
  #7545

- #18036: I.parent() should not be the symbolic ring
  #18036

- #22208: Conversion from SR to number fields
  #22208

- #25178: SR('I') is not consistent
  #25178

- #25218: Extract roots in NumberField if possible
  #25218


---

Comment by git created at 2018-04-20 17:09:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @BrentBaccala created at 2018-04-20 19:49:28

Changing status from new to needs_review.


---

Comment by slabbe created at 2018-04-26 09:43:29

I did small spaces fixes. If you agree with my changes, please change the status to positive review.
----
New commits:


---

Comment by @BrentBaccala created at 2018-04-26 17:07:40

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-05-18 17:49:14

Resolution: fixed


---

Comment by mmezzarobba created at 2020-10-17 16:48:54

Replying to [ticket:25218 gh-BrentBaccala]:
> The third change is more troubling.
> 
> The explanation lies in the definition of I:
> 
> {{{
> sage: I.parent()
> Symbolic Ring
> sage: I.pyobject().parent()
> Number Field in I with defining polynomial x^2 + 1
> }}}
> 
> In this number field, there is a single cube root of `I` (`-I`).  Squaring `-I` gives us `-1`, so `I^(2/3)=-1`.
> 
> My opinion is that the new behavior of NumberField is correct and preferred, but perhaps `I` should be defined in QQbar, not in a NumberField.

I think this is **very** unfortunate. In Sage, QQ[i] automatically comes with a complex embedding, for which i<sup>2/3</sup> (= exp(iÏ€/3)) is perfectly well defined. It is really confusing to have a basic operator like `^` (whose evaluation normally uses the coercion framework) that is incompatible with the embedding.

See #30783.
