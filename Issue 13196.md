# Issue 13196: plot(x, xmax=1, xmin=-1) comes up empty

archive/issues_013196.json:
```json
{
    "body": "Assignee: jason, was\n\nCC:  @kcrisman jakobkroeker @paulmasson jhonrubia6 @novoselt @alauve @tscrim @jm58660\n\nThe following two plots\n\n```\nplot(x, xmin=1, xmax=-1)\nplot(x).show(xmin=1, xmax=-1)\n```\n\ngive different outputs. In particular, the plot comes up empty in the\nformer one. This seems to be a conscious decision taken in #5651. The main\nline seems to be this line in `sage/plot/plot.py` and similar lines in\nseveral other files.\n\n```\n    G_kwds = Graphics._extract_kwds_for_show(kwds, ignore=['xmin', 'xmax'])\n```\n\nIs there a reason for this? Should this be \"fixed?\"\n\nIssue created by migration from https://trac.sagemath.org/ticket/13368\n\n",
    "created_at": "2012-08-15T03:34:09Z",
    "labels": [
        "graphics",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.4",
    "title": "plot(x, xmax=1, xmin=-1) comes up empty",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13196",
    "user": "@ppurka"
}
```
Assignee: jason, was

CC:  @kcrisman jakobkroeker @paulmasson jhonrubia6 @novoselt @alauve @tscrim @jm58660

The following two plots

```
plot(x, xmin=1, xmax=-1)
plot(x).show(xmin=1, xmax=-1)
```

give different outputs. In particular, the plot comes up empty in the
former one. This seems to be a conscious decision taken in #5651. The main
line seems to be this line in `sage/plot/plot.py` and similar lines in
several other files.

```
    G_kwds = Graphics._extract_kwds_for_show(kwds, ignore=['xmin', 'xmax'])
```

Is there a reason for this? Should this be "fixed?"

Issue created by migration from https://trac.sagemath.org/ticket/13368





---

archive/issue_comments_161246.json:
```json
{
    "body": "One data point is an email I got today (unrelated to Sage development, just use) asking why\n\n```\nplot(1/x,xmin=-5,xmax=5)\n```\n\ndidn't result as expected.  So maybe we should do more than ignore them, but raise an error or something...\n\n----\n\nNO!  My belief is that this is a typo.  Notice that in #5651, the places where this is ignored are ALL some kind of contour or \"rectangular\" plot, except for plot.py, but then plot_field.py does *not* have this, even though it's this kind of plot.  In fact, we probably should support things like\n\n```\nsage: plot(x,(x,1,5),xmin=2)\n```\n\nsince we might want to keep the data but not show it.",
    "created_at": "2013-06-20T01:22:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13196#issuecomment-161246",
    "user": "@kcrisman"
}
```

One data point is an email I got today (unrelated to Sage development, just use) asking why

```
plot(1/x,xmin=-5,xmax=5)
```

didn't result as expected.  So maybe we should do more than ignore them, but raise an error or something...

----

NO!  My belief is that this is a typo.  Notice that in #5651, the places where this is ignored are ALL some kind of contour or "rectangular" plot, except for plot.py, but then plot_field.py does *not* have this, even though it's this kind of plot.  In fact, we probably should support things like

```
sage: plot(x,(x,1,5),xmin=2)
```

since we might want to keep the data but not show it.



---

archive/issue_comments_161247.json:
```json
{
    "body": "Though we'd probably have to deal with\n\n```\nsage: plot(x,(x,1,5),xmin=2).show(xmin=3)\n```\n\nsomehow...",
    "created_at": "2013-06-20T01:23:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13196#issuecomment-161247",
    "user": "@kcrisman"
}
```

Though we'd probably have to deal with

```
sage: plot(x,(x,1,5),xmin=2).show(xmin=3)
```

somehow...



---

archive/issue_comments_161248.json:
```json
{
    "body": "with ymin, the parameter in show overrides the parameter in plot.",
    "created_at": "2013-06-20T01:24:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13196#issuecomment-161248",
    "user": "@ppurka"
}
```

with ymin, the parameter in show overrides the parameter in plot.



---

archive/issue_comments_161249.json:
```json
{
    "body": "An example from #5124 (duplicate of this ticket; note that this was created before #5651):\n\n```\nE = EllipticCurve('37a')\nE.plot(xmin=-10, xmax=10)\n```\n",
    "created_at": "2014-04-11T00:42:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13196#issuecomment-161249",
    "user": "@pjbruin"
}
```

An example from #5124 (duplicate of this ticket; note that this was created before #5651):

```
E = EllipticCurve('37a')
E.plot(xmin=-10, xmax=10)
```




---

archive/issue_comments_161250.json:
```json
{
    "body": "I think I had some idea how to fix this. If I get some time I will look at it again. It will not be any time soon, unfortunately. Essentially, we just need to mimic how ymin and ymax are handled.",
    "created_at": "2014-04-11T05:59:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13196#issuecomment-161250",
    "user": "@ppurka"
}
```

I think I had some idea how to fix this. If I get some time I will look at it again. It will not be any time soon, unfortunately. Essentially, we just need to mimic how ymin and ymax are handled.



---

archive/issue_comments_161251.json:
```json
{
    "body": "Just came across this again.  Really, *all* relevant options should be passed to show!",
    "created_at": "2015-06-26T19:27:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13196#issuecomment-161251",
    "user": "@kcrisman"
}
```

Just came across this again.  Really, *all* relevant options should be passed to show!



---

archive/issue_comments_161252.json:
```json
{
    "body": "As of 7.3.beta8 evaluating `plot(x, xmin=-1, xmax=1)` and `plot(1/x,xmin=-5,xmax=5,ymin=-5,ymax=5)` both produce the expected graphs.\n\nEvaluating `plot(x, xmin=1, xmax=-1)` with a reversed domain does not produce a plot. Evaluating`plot(1/x,xmin=-5,xmax=5,ymin=5,ymax=-5)` with an inverted range flips the plot upside down.\n\nShouldn't this ticket be first about a sanity check on domain and range? Is there a good reason to allow reversal and inversion?",
    "created_at": "2016-07-20T21:02:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13196#issuecomment-161252",
    "user": "@paulmasson"
}
```

As of 7.3.beta8 evaluating `plot(x, xmin=-1, xmax=1)` and `plot(1/x,xmin=-5,xmax=5,ymin=-5,ymax=5)` both produce the expected graphs.

Evaluating `plot(x, xmin=1, xmax=-1)` with a reversed domain does not produce a plot. Evaluating`plot(1/x,xmin=-5,xmax=5,ymin=5,ymax=-5)` with an inverted range flips the plot upside down.

Shouldn't this ticket be first about a sanity check on domain and range? Is there a good reason to allow reversal and inversion?



---

archive/issue_comments_161253.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2016-07-20T21:02:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13196#issuecomment-161253",
    "user": "@paulmasson"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_161254.json:
```json
{
    "body": "Replying to [comment:12 paulmasson]:\n> Evaluating `plot(x, xmin=1, xmax=-1)` with a reversed domain does not produce a plot. Evaluating`plot(1/x,xmin=-5,xmax=5,ymin=5,ymax=-5)` with an inverted range flips the plot upside down.\n\nSecond command should be the desired output.\n\n> Shouldn't this ticket be first about a sanity check on domain and range? Is there a good reason to allow reversal and inversion?\n\nA good reason to allow flipped axis is to have axes that are decreasing instead of increasing. It is already possible by using `plot(...).show(xmax=-1,xmin=1)`. This ticket was about making the behavior of plot *consistent* with what `plot(...).show()` does.",
    "created_at": "2016-07-21T15:26:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13196#issuecomment-161254",
    "user": "@ppurka"
}
```

Replying to [comment:12 paulmasson]:
> Evaluating `plot(x, xmin=1, xmax=-1)` with a reversed domain does not produce a plot. Evaluating`plot(1/x,xmin=-5,xmax=5,ymin=5,ymax=-5)` with an inverted range flips the plot upside down.

Second command should be the desired output.

> Shouldn't this ticket be first about a sanity check on domain and range? Is there a good reason to allow reversal and inversion?

A good reason to allow flipped axis is to have axes that are decreasing instead of increasing. It is already possible by using `plot(...).show(xmax=-1,xmin=1)`. This ticket was about making the behavior of plot *consistent* with what `plot(...).show()` does.



---

archive/issue_comments_161255.json:
```json
{
    "body": "He's a solution to this problem. Part of the reason the plots were empty is that the function `setup_for_eval_on_grid()` in `plot/misc.py` outputs plotting steps as an absolute value, not a signed value. I've removed that and modified the doctests accordingly, but six other plotting files use that function in addition to `plot.py`.\n\nAll plotting doctests pass and documentation all builds. I scanned all seven plotting documentation HTML files that use `setup_for_eval_on_grid()` and didn't see anything strange, but other eyes need to look at them closely.\n\nAdding Javier to cc list since he's been working on plotting examples and might spot something wrong.\n----\nNew commits:",
    "created_at": "2016-07-22T20:31:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13196#issuecomment-161255",
    "user": "@paulmasson"
}
```

He's a solution to this problem. Part of the reason the plots were empty is that the function `setup_for_eval_on_grid()` in `plot/misc.py` outputs plotting steps as an absolute value, not a signed value. I've removed that and modified the doctests accordingly, but six other plotting files use that function in addition to `plot.py`.

All plotting doctests pass and documentation all builds. I scanned all seven plotting documentation HTML files that use `setup_for_eval_on_grid()` and didn't see anything strange, but other eyes need to look at them closely.

Adding Javier to cc list since he's been working on plotting examples and might spot something wrong.
----
New commits:



---

archive/issue_comments_161256.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2016-07-22T20:31:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13196#issuecomment-161256",
    "user": "@paulmasson"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_161257.json:
```json
{
    "body": "Andrey, after reading some older Trac tickets I see that you've been active in the plotting parts of Sage, so I'm adding you to the cc list. I want to make sure the change I made to `setup_for_eval_on_grid()` in `plot/misc.py` doesn't have unintended consequences, so if you have any input on that it would be appreciated.",
    "created_at": "2016-07-23T22:11:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13196#issuecomment-161257",
    "user": "@paulmasson"
}
```

Andrey, after reading some older Trac tickets I see that you've been active in the plotting parts of Sage, so I'm adding you to the cc list. I want to make sure the change I made to `setup_for_eval_on_grid()` in `plot/misc.py` doesn't have unintended consequences, so if you have any input on that it would be appreciated.



---

archive/issue_comments_161258.json:
```json
{
    "body": "I think you need to adjust logic here:\n\n```diff\n@@ -131,7 +131,7 @@ def setup_for_eval_on_grid(funcs, ranges, plot_points=None, return_vars=False):\n         raise ValueError(\"plot_points must be either an integer or a list of integers, one for each range\")\n \n     plot_points = [int(p) if p>=2 else 2 for p in plot_points]\n-    range_steps = [abs(range[1] - range[0])/(p-1) for range, p in zip(ranges, plot_points)]\n+    range_steps = [(range[1] - range[0])/(p-1) for range, p in zip(ranges, plot_points)]\n     if min(range_steps) == float(0):\n         raise ValueError(\"plot start point and end point must be different\")\n```\n\nSince the question is about any of the steps being 0. (Which, ideally, should not be a problem, but assuming that it is now let's keep the error.\n\nOtherwise, PLEASE, let keywords have the same meaning in all related functions and let them be handled in the same way!",
    "created_at": "2016-07-24T18:41:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13196#issuecomment-161258",
    "user": "@novoselt"
}
```

I think you need to adjust logic here:

```diff
@@ -131,7 +131,7 @@ def setup_for_eval_on_grid(funcs, ranges, plot_points=None, return_vars=False):
         raise ValueError("plot_points must be either an integer or a list of integers, one for each range")
 
     plot_points = [int(p) if p>=2 else 2 for p in plot_points]
-    range_steps = [abs(range[1] - range[0])/(p-1) for range, p in zip(ranges, plot_points)]
+    range_steps = [(range[1] - range[0])/(p-1) for range, p in zip(ranges, plot_points)]
     if min(range_steps) == float(0):
         raise ValueError("plot start point and end point must be different")
```

Since the question is about any of the steps being 0. (Which, ideally, should not be a problem, but assuming that it is now let's keep the error.

Otherwise, PLEASE, let keywords have the same meaning in all related functions and let them be handled in the same way!



---

archive/issue_comments_161259.json:
```json
{
    "body": "Andrey, I haven't changed any keywords and don't plan to. All I did was remove `abs` so that `range_steps` can take negative as well as positive values. This is necessary for creating plots in `plot.py` when `xmin > xmax`.\n\nThe question is whether the change of allowing `range_steps` to be negative will have an unintended impact on other plotting routines. I don't expect you to read all of the plotting code, but if anything else comes to mind let me know. Thanks!",
    "created_at": "2016-07-24T19:21:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13196#issuecomment-161259",
    "user": "@paulmasson"
}
```

Andrey, I haven't changed any keywords and don't plan to. All I did was remove `abs` so that `range_steps` can take negative as well as positive values. This is necessary for creating plots in `plot.py` when `xmin > xmax`.

The question is whether the change of allowing `range_steps` to be negative will have an unintended impact on other plotting routines. I don't expect you to read all of the plotting code, but if anything else comes to mind let me know. Thanks!



---

archive/issue_comments_161260.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-18T22:33:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13196#issuecomment-161260",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_161261.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-18T22:55:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13196#issuecomment-161261",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_161262.json:
```json
{
    "body": "Code rewritten for consistency with #20924",
    "created_at": "2016-08-18T23:05:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13196#issuecomment-161262",
    "user": "@paulmasson"
}
```

Code rewritten for consistency with #20924



---

archive/issue_comments_161263.json:
```json
{
    "body": "everything looks good to me. As I see no negative vote, I'll make it a positive review",
    "created_at": "2016-10-23T10:03:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13196#issuecomment-161263",
    "user": "jhonrubia6"
}
```

everything looks good to me. As I see no negative vote, I'll make it a positive review



---

archive/issue_comments_161264.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-10-23T10:03:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13196#issuecomment-161264",
    "user": "jhonrubia6"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_161265.json:
```json
{
    "body": "Reviewer name is needed.",
    "created_at": "2016-10-23T14:04:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13196#issuecomment-161265",
    "user": "@tscrim"
}
```

Reviewer name is needed.



---

archive/issue_comments_161266.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-10-23T14:04:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13196#issuecomment-161266",
    "user": "@tscrim"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_161267.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2016-10-23T16:13:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13196#issuecomment-161267",
    "user": "jhonrubia6"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_161268.json:
```json
{
    "body": "\n```\nsage -t --long src/sage/schemes/elliptic_curves/ell_generic.py  # 1 doctest failed\n```\n\nsee patchbot",
    "created_at": "2016-10-29T14:21:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13196#issuecomment-161268",
    "user": "@vbraun"
}
```


```
sage -t --long src/sage/schemes/elliptic_curves/ell_generic.py  # 1 doctest failed
```

see patchbot



---

archive/issue_comments_161269.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-10-29T14:21:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13196#issuecomment-161269",
    "user": "@vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_161270.json:
```json
{
    "body": "The changes on this ticket produce unexpected results for elliptic curves. Needs to be investigated.",
    "created_at": "2016-11-14T00:19:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13196#issuecomment-161270",
    "user": "@paulmasson"
}
```

The changes on this ticket produce unexpected results for elliptic curves. Needs to be investigated.



---

archive/issue_comments_161271.json:
```json
{
    "body": "Maybe not related, but why \"e\" in \"2.717e\" in\n\n\n```\nplot(x/log_b(x, 2), (2.717, 2.72))\n```\n",
    "created_at": "2017-01-23T06:54:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13196#issuecomment-161271",
    "user": "@jm58660"
}
```

Maybe not related, but why "e" in "2.717e" in


```
plot(x/log_b(x, 2), (2.717, 2.72))
```




---

archive/issue_comments_161272.json:
```json
{
    "body": "> Maybe not related, but why \"e\" in \"2.717e\" in\n\nIndeed unrelated, but also worth a ticket.  We don't do a good job dealing with scientific notation that ends up in the tick labels, and you can see that if you try plotting things with really high output values but in a narrow range.  [For example](http://sagecell.sagemath.org/?z=eJwryMkv0aiIM9LRqNAxNIgzAxPahpqaAGNfBqw=&lang=sage):\n\n```\nplot(x^2,(x,10^6,10^6+1))\n```\n",
    "created_at": "2017-01-23T15:38:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13196#issuecomment-161272",
    "user": "@kcrisman"
}
```

> Maybe not related, but why "e" in "2.717e" in

Indeed unrelated, but also worth a ticket.  We don't do a good job dealing with scientific notation that ends up in the tick labels, and you can see that if you try plotting things with really high output values but in a narrow range.  [For example](http://sagecell.sagemath.org/?z=eJwryMkv0aiIM9LRqNAxNIgzAxPahpqaAGNfBqw=&lang=sage):

```
plot(x^2,(x,10^6,10^6+1))
```

