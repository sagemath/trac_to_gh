# Issue 13196: plot(x, xmax=1, xmin=-1) comes up empty

Issue created by migration from https://trac.sagemath.org/ticket/13368

Original creator: ppurka

Original creation time: 2012-08-15 03:34:09

Assignee: jason, was

CC:  kcrisman jakobkroeker paulmasson jhonrubia6 novoselt alauve tscrim jmantysalo

The following two plots

```
plot(x, xmin=1, xmax=-1)
plot(x).show(xmin=1, xmax=-1)
```

give different outputs. In particular, the plot comes up empty in the
former one. This seems to be a conscious decision taken in #5651. The main
line seems to be this line in `sage/plot/plot.py` and similar lines in
several other files.

```
    G_kwds = Graphics._extract_kwds_for_show(kwds, ignore=['xmin', 'xmax'])
```

Is there a reason for this? Should this be "fixed?"


---

Comment by kcrisman created at 2013-06-20 01:22:23

One data point is an email I got today (unrelated to Sage development, just use) asking why

```
plot(1/x,xmin=-5,xmax=5)
```

didn't result as expected.  So maybe we should do more than ignore them, but raise an error or something...

----

NO!  My belief is that this is a typo.  Notice that in #5651, the places where this is ignored are ALL some kind of contour or "rectangular" plot, except for plot.py, but then plot_field.py does _not_ have this, even though it's this kind of plot.  In fact, we probably should support things like

```
sage: plot(x,(x,1,5),xmin=2)
```

since we might want to keep the data but not show it.


---

Comment by kcrisman created at 2013-06-20 01:23:31

Though we'd probably have to deal with

```
sage: plot(x,(x,1,5),xmin=2).show(xmin=3)
```

somehow...


---

Comment by ppurka created at 2013-06-20 01:24:50

with ymin, the parameter in show overrides the parameter in plot.


---

Comment by pbruin created at 2014-04-11 00:42:49

An example from #5124 (duplicate of this ticket; note that this was created before #5651):

```
E = EllipticCurve('37a')
E.plot(xmin=-10, xmax=10)
```



---

Comment by ppurka created at 2014-04-11 05:59:28

I think I had some idea how to fix this. If I get some time I will look at it again. It will not be any time soon, unfortunately. Essentially, we just need to mimic how ymin and ymax are handled.


---

Comment by kcrisman created at 2015-06-26 19:27:49

Just came across this again.  Really, _all_ relevant options should be passed to show!


---

Comment by paulmasson created at 2016-07-20 21:02:25

As of 7.3.beta8 evaluating `plot(x, xmin=-1, xmax=1)` and `plot(1/x,xmin=-5,xmax=5,ymin=-5,ymax=5)` both produce the expected graphs.

Evaluating `plot(x, xmin=1, xmax=-1)` with a reversed domain does not produce a plot. Evaluating`plot(1/x,xmin=-5,xmax=5,ymin=5,ymax=-5)` with an inverted range flips the plot upside down.

Shouldn't this ticket be first about a sanity check on domain and range? Is there a good reason to allow reversal and inversion?


---

Comment by paulmasson created at 2016-07-20 21:02:25

Changing status from new to needs_info.


---

Comment by ppurka created at 2016-07-21 15:26:01

Replying to [comment:12 paulmasson]:
> Evaluating `plot(x, xmin=1, xmax=-1)` with a reversed domain does not produce a plot. Evaluating`plot(1/x,xmin=-5,xmax=5,ymin=5,ymax=-5)` with an inverted range flips the plot upside down.

Second command should be the desired output.

> Shouldn't this ticket be first about a sanity check on domain and range? Is there a good reason to allow reversal and inversion?

A good reason to allow flipped axis is to have axes that are decreasing instead of increasing. It is already possible by using `plot(...).show(xmax=-1,xmin=1)`. This ticket was about making the behavior of plot _consistent_ with what `plot(...).show()` does.


---

Comment by paulmasson created at 2016-07-22 20:31:53

He's a solution to this problem. Part of the reason the plots were empty is that the function `setup_for_eval_on_grid()` in `plot/misc.py` outputs plotting steps as an absolute value, not a signed value. I've removed that and modified the doctests accordingly, but six other plotting files use that function in addition to `plot.py`.

All plotting doctests pass and documentation all builds. I scanned all seven plotting documentation HTML files that use `setup_for_eval_on_grid()` and didn't see anything strange, but other eyes need to look at them closely.

Adding Javier to cc list since he's been working on plotting examples and might spot something wrong.
----
New commits:


---

Comment by paulmasson created at 2016-07-22 20:31:53

Changing status from needs_info to needs_review.


---

Comment by paulmasson created at 2016-07-23 22:11:52

Andrey, after reading some older Trac tickets I see that you've been active in the plotting parts of Sage, so I'm adding you to the cc list. I want to make sure the change I made to `setup_for_eval_on_grid()` in `plot/misc.py` doesn't have unintended consequences, so if you have any input on that it would be appreciated.


---

Comment by novoselt created at 2016-07-24 18:41:55

I think you need to adjust logic here:

```diff
@@ -131,7 +131,7 @@ def setup_for_eval_on_grid(funcs, ranges, plot_points=None, return_vars=False):
         raise ValueError("plot_points must be either an integer or a list of integers, one for each range")
 
     plot_points = [int(p) if p>=2 else 2 for p in plot_points]
-    range_steps = [abs(range[1] - range[0])/(p-1) for range, p in zip(ranges, plot_points)]
+    range_steps = [(range[1] - range[0])/(p-1) for range, p in zip(ranges, plot_points)]
     if min(range_steps) == float(0):
         raise ValueError("plot start point and end point must be different")
```

Since the question is about any of the steps being 0. (Which, ideally, should not be a problem, but assuming that it is now let's keep the error.

Otherwise, PLEASE, let keywords have the same meaning in all related functions and let them be handled in the same way!


---

Comment by paulmasson created at 2016-07-24 19:21:42

Andrey, I haven't changed any keywords and don't plan to. All I did was remove `abs` so that `range_steps` can take negative as well as positive values. This is necessary for creating plots in `plot.py` when `xmin > xmax`.

The question is whether the change of allowing `range_steps` to be negative will have an unintended impact on other plotting routines. I don't expect you to read all of the plotting code, but if anything else comes to mind let me know. Thanks!


---

Comment by git created at 2016-08-18 22:33:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-08-18 22:55:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by paulmasson created at 2016-08-18 23:05:02

Code rewritten for consistency with #20924


---

Comment by jhonrubia6 created at 2016-10-23 10:03:36

everything looks good to me. As I see no negative vote, I'll make it a positive review


---

Comment by jhonrubia6 created at 2016-10-23 10:03:36

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2016-10-23 14:04:45

Reviewer name is needed.


---

Comment by tscrim created at 2016-10-23 14:04:45

Changing status from positive_review to needs_work.


---

Comment by jhonrubia6 created at 2016-10-23 16:13:03

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2016-10-29 14:21:12


```
sage -t --long src/sage/schemes/elliptic_curves/ell_generic.py  # 1 doctest failed
```

see patchbot


---

Comment by vbraun created at 2016-10-29 14:21:12

Changing status from positive_review to needs_work.


---

Comment by paulmasson created at 2016-11-14 00:19:17

The changes on this ticket produce unexpected results for elliptic curves. Needs to be investigated.


---

Comment by jmantysalo created at 2017-01-23 06:54:18

Maybe not related, but why "e" in "2.717e" in


```
plot(x/log_b(x, 2), (2.717, 2.72))
```



---

Comment by kcrisman created at 2017-01-23 15:38:52

> Maybe not related, but why "e" in "2.717e" in

Indeed unrelated, but also worth a ticket.  We don't do a good job dealing with scientific notation that ends up in the tick labels, and you can see that if you try plotting things with really high output values but in a narrow range.  [For example](http://sagecell.sagemath.org/?z=eJwryMkv0aiIM9LRqNAxNIgzAxPahpqaAGNfBqw=&lang=sage):

```
plot(x^2,(x,10^6,10^6+1))
```

