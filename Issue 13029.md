# Issue 13029: patch setuptools to allow for parallel usage

archive/issues_013029.json:
```json
{
    "body": "Assignee: GeorgSWeber\n\nCC:  jdemeyer kini jason\n\nCurrently we have to force the spkgs that use setuptools to build serially because setuptools does not do any file locking with `easy_install.pth`. This is an inconvenience that has a fairly straightforward fix.\n\n\nInstallation Instructions:\n* Use the new spkg [http://wstein.org/home/ohanar/spkgs/setuptools-0.6.16.p1.spkg](http://wstein.org/home/ohanar/spkgs/setuptools-0.6.16.p1.spkg)\n* Apply ... to the root repo.\n\nIssue created by migration from https://trac.sagemath.org/ticket/13201\n\n",
    "created_at": "2012-07-04T22:23:39Z",
    "labels": [
        "build",
        "major",
        "enhancement"
    ],
    "title": "patch setuptools to allow for parallel usage",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13029",
    "user": "ohanar"
}
```
Assignee: GeorgSWeber

CC:  jdemeyer kini jason

Currently we have to force the spkgs that use setuptools to build serially because setuptools does not do any file locking with `easy_install.pth`. This is an inconvenience that has a fairly straightforward fix.


Installation Instructions:
* Use the new spkg [http://wstein.org/home/ohanar/spkgs/setuptools-0.6.16.p1.spkg](http://wstein.org/home/ohanar/spkgs/setuptools-0.6.16.p1.spkg)
* Apply ... to the root repo.

Issue created by migration from https://trac.sagemath.org/ticket/13201





---

archive/issue_comments_157622.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-07-04T22:25:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13029#issuecomment-157622",
    "user": "ohanar"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_157623.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-08-13T12:39:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13029#issuecomment-157623",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_157624.json:
```json
{
    "body": "Why re-invent the wheel?  Why not use [http://docs.python.org/library/fcntl.html#fcntl.lockf](http://docs.python.org/library/fcntl.html#fcntl.lockf)?\n\nAlso, this should obviously be reported upstream.",
    "created_at": "2012-08-13T12:39:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13029#issuecomment-157624",
    "user": "jdemeyer"
}
```

Why re-invent the wheel?  Why not use [http://docs.python.org/library/fcntl.html#fcntl.lockf](http://docs.python.org/library/fcntl.html#fcntl.lockf)?

Also, this should obviously be reported upstream.



---

archive/issue_comments_157625.json:
```json
{
    "body": "Replying to [comment:2 jdemeyer]:\n> Why re-invent the wheel?  Why not use [http://docs.python.org/library/fcntl.html#fcntl.lockf](http://docs.python.org/library/fcntl.html#fcntl.lockf)?\nBecause I was being dumb and couldn't find that function :).\n> Also, this should obviously be reported upstream.\nYup, although upstream is basically dead. IMO we should switch to distribute (I'll see about making an SPKG).",
    "created_at": "2012-09-04T21:01:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13029#issuecomment-157625",
    "user": "ohanar"
}
```

Replying to [comment:2 jdemeyer]:
> Why re-invent the wheel?  Why not use [http://docs.python.org/library/fcntl.html#fcntl.lockf](http://docs.python.org/library/fcntl.html#fcntl.lockf)?
Because I was being dumb and couldn't find that function :).
> Also, this should obviously be reported upstream.
Yup, although upstream is basically dead. IMO we should switch to distribute (I'll see about making an SPKG).



---

archive/issue_comments_157626.json:
```json
{
    "body": "new patch applied to setuptools; for review purposes",
    "created_at": "2012-09-06T11:17:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13029#issuecomment-157626",
    "user": "ohanar"
}
```

new patch applied to setuptools; for review purposes



---

archive/issue_comments_157627.json:
```json
{
    "body": "Attachment\n\napply to root repo",
    "created_at": "2012-09-06T11:22:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13029#issuecomment-157627",
    "user": "ohanar"
}
```

Attachment

apply to root repo



---

archive/issue_comments_157628.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-09-06T11:23:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13029#issuecomment-157628",
    "user": "ohanar"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_157629.json:
```json
{
    "body": "I unfortuntely don't understand `setuptools` well enough to review this.  It seems there are some changes unrelated to the locking.  What do they do?\n\nAlso, do we really need to do this *every time* Sage runs (could it be moved to `sage-location`?):\n\n```\n    # Hack around setuptools since --egg-path isn't fully respected \n    sed -i 's-.*sagenb.*-\\.\\./\\.\\./\\.\\./\\.\\./devel/sagenb-' \\ \n        \"$SAGE_LOCAL/lib/python/site-packages/easy-install.pth\" \n```\n\nYou also need to handle the case that `$SAGE_ROOT` isn't writeable.",
    "created_at": "2012-09-06T11:35:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13029#issuecomment-157629",
    "user": "jdemeyer"
}
```

I unfortuntely don't understand `setuptools` well enough to review this.  It seems there are some changes unrelated to the locking.  What do they do?

Also, do we really need to do this *every time* Sage runs (could it be moved to `sage-location`?):

```
    # Hack around setuptools since --egg-path isn't fully respected 
    sed -i 's-.*sagenb.*-\.\./\.\./\.\./\.\./devel/sagenb-' \ 
        "$SAGE_LOCAL/lib/python/site-packages/easy-install.pth" 
```

You also need to handle the case that `$SAGE_ROOT` isn't writeable.



---

archive/issue_comments_157630.json:
```json
{
    "body": "Replying to [comment:6 jdemeyer]:\n> I unfortuntely don't understand `setuptools` well enough to review this.  It seems there are some changes unrelated to the locking.  What do they do?\nInternally setuptools identifies packages based on a normalized path (no absolute paths without symlinks, and a normalized case for case-insensitive filesystems). It reads these from easy-install.pth, and then creates a brand new easy-install.pth if it detects that it needs to. The issue is that it loads the list of packages when it starts, and then writes it back when it finishes, if any changes were made to the file in the meantime, setuptools doesn't detect them, and just overrides them with its new easy-install.pth. What I did was add a bit of code for reloading the file right before writing a new one -- making sure things that were deleted don't pop back up, and making sure things that were added don't disappear.\n> Also, do we really need to do this *every time* Sage runs (could it be moved to `sage-location`?):\n> {{{\n>     # Hack around setuptools since --egg-path isn't fully respected \n>     sed -i 's-.*sagenb.*-\\.\\./\\.\\./\\.\\./\\.\\./devel/sagenb-' \\ \n>         \"$SAGE_LOCAL/lib/python/site-packages/easy-install.pth\" \n> }}}\n> You also need to handle the case that `$SAGE_ROOT` isn't writeable.\nWell no you don't have to run it every time sage starts, just every time a package using setuptools is installed, since setuptools always inscribes the absolute path into easy-install.pth (even if you specify a relative path for `--egg-path`).",
    "created_at": "2012-09-06T11:50:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13029#issuecomment-157630",
    "user": "ohanar"
}
```

Replying to [comment:6 jdemeyer]:
> I unfortuntely don't understand `setuptools` well enough to review this.  It seems there are some changes unrelated to the locking.  What do they do?
Internally setuptools identifies packages based on a normalized path (no absolute paths without symlinks, and a normalized case for case-insensitive filesystems). It reads these from easy-install.pth, and then creates a brand new easy-install.pth if it detects that it needs to. The issue is that it loads the list of packages when it starts, and then writes it back when it finishes, if any changes were made to the file in the meantime, setuptools doesn't detect them, and just overrides them with its new easy-install.pth. What I did was add a bit of code for reloading the file right before writing a new one -- making sure things that were deleted don't pop back up, and making sure things that were added don't disappear.
> Also, do we really need to do this *every time* Sage runs (could it be moved to `sage-location`?):
> {{{
>     # Hack around setuptools since --egg-path isn't fully respected 
>     sed -i 's-.*sagenb.*-\.\./\.\./\.\./\.\./devel/sagenb-' \ 
>         "$SAGE_LOCAL/lib/python/site-packages/easy-install.pth" 
> }}}
> You also need to handle the case that `$SAGE_ROOT` isn't writeable.
Well no you don't have to run it every time sage starts, just every time a package using setuptools is installed, since setuptools always inscribes the absolute path into easy-install.pth (even if you specify a relative path for `--egg-path`).



---

archive/issue_comments_157631.json:
```json
{
    "body": "Since `sage-location` specifically deals with rewriting paths, I would do it there.",
    "created_at": "2012-09-06T11:57:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13029#issuecomment-157631",
    "user": "jdemeyer"
}
```

Since `sage-location` specifically deals with rewriting paths, I would do it there.



---

archive/issue_comments_157632.json:
```json
{
    "body": "I thought that was for rewriting paths when `SAGE_ROOT` changed. The issue is that setuptools rewrites paths, regardless of what happens to `SAGE_ROOT`, so we have to overwrite their rewrites. An alternative (now that we have the flask notebook has been merged), is to treat sagenb like any other upstream package, and just install it in site-packages (I don't think the sagenb developers would be opposed to this, we are already planning on doing this in the transition to git).",
    "created_at": "2012-09-06T23:06:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13029#issuecomment-157632",
    "user": "ohanar"
}
```

I thought that was for rewriting paths when `SAGE_ROOT` changed. The issue is that setuptools rewrites paths, regardless of what happens to `SAGE_ROOT`, so we have to overwrite their rewrites. An alternative (now that we have the flask notebook has been merged), is to treat sagenb like any other upstream package, and just install it in site-packages (I don't think the sagenb developers would be opposed to this, we are already planning on doing this in the transition to git).



---

archive/issue_comments_157633.json:
```json
{
    "body": "Replying to [comment:9 ohanar]:\n> I thought that was for rewriting paths when `SAGE_ROOT` changed.\nWell, the reason you need to rewrite the `setuptools` paths is to allow relocation, right? (or am I missing something?)",
    "created_at": "2012-09-07T07:30:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13029#issuecomment-157633",
    "user": "jdemeyer"
}
```

Replying to [comment:9 ohanar]:
> I thought that was for rewriting paths when `SAGE_ROOT` changed.
Well, the reason you need to rewrite the `setuptools` paths is to allow relocation, right? (or am I missing something?)



---

archive/issue_comments_157634.json:
```json
{
    "body": "Replying to [comment:10 jdemeyer]:\n> Well, the reason you need to rewrite the `setuptools` paths is to allow relocation, right? (or am I missing something?)\nWell we also support clones for sagenb, which will brake every time setuptools is run (it readlinks everything). If we don't care about that, then we could.\n\nI'm CCing Keshav and Jason on this ticket, they might have an opinion on how we handle this (since currently it only affects sagenb).",
    "created_at": "2012-09-07T07:45:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13029#issuecomment-157634",
    "user": "ohanar"
}
```

Replying to [comment:10 jdemeyer]:
> Well, the reason you need to rewrite the `setuptools` paths is to allow relocation, right? (or am I missing something?)
Well we also support clones for sagenb, which will brake every time setuptools is run (it readlinks everything). If we don't care about that, then we could.

I'm CCing Keshav and Jason on this ticket, they might have an opinion on how we handle this (since currently it only affects sagenb).



---

archive/issue_comments_157635.json:
```json
{
    "body": "Since sagenb is now distributed without a repository, it might make sense for it not to be installed in SAGE_ROOT/devel/.  The reason for it to be in SAGE_ROOT/devel/sagenb is so that the barrier is way lower for people wanting to patch it and work with it.  If we're making them clone the git repository anyway, the barrier isn't lower.\n\nSo what do you think, kini?  Should we just install it like a normal spkg?  If they want to develop, they need to git clone and do `sage setup.py develop`?\n\n(personally, I'm mildly in favor of going back to installing the git repo in SAGE_ROOT/devel/sagenb...)",
    "created_at": "2012-09-07T08:28:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13029#issuecomment-157635",
    "user": "jason"
}
```

Since sagenb is now distributed without a repository, it might make sense for it not to be installed in SAGE_ROOT/devel/.  The reason for it to be in SAGE_ROOT/devel/sagenb is so that the barrier is way lower for people wanting to patch it and work with it.  If we're making them clone the git repository anyway, the barrier isn't lower.

So what do you think, kini?  Should we just install it like a normal spkg?  If they want to develop, they need to git clone and do `sage setup.py develop`?

(personally, I'm mildly in favor of going back to installing the git repo in SAGE_ROOT/devel/sagenb...)



---

archive/issue_comments_157636.json:
```json
{
    "body": "Absolutely. I 100% think that sagenb should be installed like any other python package, i.e. in the site packages directory.",
    "created_at": "2012-09-07T08:35:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13029#issuecomment-157636",
    "user": "kini"
}
```

Absolutely. I 100% think that sagenb should be installed like any other python package, i.e. in the site packages directory.



---

archive/issue_comments_157637.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-03-16T22:42:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13029#issuecomment-157637",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_157638.json:
```json
{
    "body": "In any case, this needs work because it assumes that `$SAGE_ROOT` is writable and it needs to be rebased.",
    "created_at": "2013-03-16T22:42:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13029#issuecomment-157638",
    "user": "jdemeyer"
}
```

In any case, this needs work because it assumes that `$SAGE_ROOT` is writable and it needs to be rebased.



---

archive/issue_comments_157639.json:
```json
{
    "body": "Replying to [comment:3 ohanar]:\n> Replying to [comment:2 jdemeyer]:\n> > Why re-invent the wheel?  Why not use [http://docs.python.org/library/fcntl.html#fcntl.lockf](http://docs.python.org/library/fcntl.html#fcntl.lockf)?\n> Because I was being dumb and couldn't find that function :).\n> > Also, this should obviously be reported upstream.\n> Yup, although upstream is basically dead. IMO we should switch to distribute (I'll see about making an SPKG).\n\nAt this point I'd like to point you to SPKG.txt and actually read it:\n\n```\n# setuptools\n\n## Description\n\nsetuptools is a collection of enhancements to the Python distutils (for Python 2.3.5 and up on mo\nst platforms; 64-bit platforms require a minimum of Python 2.4) that allow you to more easily bui\nld and distribute Python packages, especially ones that have dependencies on other packages.\n\nWebsite: http://pypi.python.org/pypi/setuptools/\n\nThe present spkg is based on the fork of setuptools known as distribute.\nWebsite: http://pypi.python.org/pypi/distribute\n```\n\nAnd\n\n```\n### setuptools-0.6.16 (Francois Bissey, June 1, 2011)\n * Switch to the \"distribute\" fork of setuptools and update to 0.6.16, \n * adopt a Gentoo patch to avoid warnings with python-2.7 (works with 2.6 too). \n * Remove the two windows binaries and patch so setup.py doesn't\n   try to install them.\n```\n\nThis was a pre-requisite to the upgrade to python-2.7.3. Fell free to upgrade to a newer version of distribute and change the name if you want too.",
    "created_at": "2013-03-17T09:34:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13029#issuecomment-157639",
    "user": "fbissey"
}
```

Replying to [comment:3 ohanar]:
> Replying to [comment:2 jdemeyer]:
> > Why re-invent the wheel?  Why not use [http://docs.python.org/library/fcntl.html#fcntl.lockf](http://docs.python.org/library/fcntl.html#fcntl.lockf)?
> Because I was being dumb and couldn't find that function :).
> > Also, this should obviously be reported upstream.
> Yup, although upstream is basically dead. IMO we should switch to distribute (I'll see about making an SPKG).

At this point I'd like to point you to SPKG.txt and actually read it:

```
# setuptools

## Description

setuptools is a collection of enhancements to the Python distutils (for Python 2.3.5 and up on mo
st platforms; 64-bit platforms require a minimum of Python 2.4) that allow you to more easily bui
ld and distribute Python packages, especially ones that have dependencies on other packages.

Website: http://pypi.python.org/pypi/setuptools/

The present spkg is based on the fork of setuptools known as distribute.
Website: http://pypi.python.org/pypi/distribute
```

And

```
### setuptools-0.6.16 (Francois Bissey, June 1, 2011)
 * Switch to the "distribute" fork of setuptools and update to 0.6.16, 
 * adopt a Gentoo patch to avoid warnings with python-2.7 (works with 2.6 too). 
 * Remove the two windows binaries and patch so setup.py doesn't
   try to install them.
```

This was a pre-requisite to the upgrade to python-2.7.3. Fell free to upgrade to a newer version of distribute and change the name if you want too.



---

archive/issue_comments_157640.json:
```json
{
    "body": "Yeah, I made that remark about 5 minutes before completely reading through the SPKG.txt. I haven't really looked at this in awhile, but I probably won't be touching this soon, as I'm really trying to put all of my time into working on the transition to git.",
    "created_at": "2013-03-17T09:50:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13029#issuecomment-157640",
    "user": "ohanar"
}
```

Yeah, I made that remark about 5 minutes before completely reading through the SPKG.txt. I haven't really looked at this in awhile, but I probably won't be touching this soon, as I'm really trying to put all of my time into working on the transition to git.



---

archive/issue_comments_157641.json:
```json
{
    "body": "I checked if you said that in the ticket but didn't see it so I assumed... too much. ;)",
    "created_at": "2013-03-17T09:53:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13029#issuecomment-157641",
    "user": "fbissey"
}
```

I checked if you said that in the ticket but didn't see it so I assumed... too much. ;)



---

archive/issue_comments_157642.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-02-28T15:24:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13029#issuecomment-157642",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_157643.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-02-28T20:07:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13029#issuecomment-157643",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_157644.json:
```json
{
    "body": "New attempt... The patch didn't apply, so I wrote a different version. It is now IMHO clearer though perhaps at the cost of rewriting a pth file even if it is not dirty. But then it is hardly a performance-critical step.",
    "created_at": "2014-02-28T20:23:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13029#issuecomment-157644",
    "user": "vbraun"
}
```

New attempt... The patch didn't apply, so I wrote a different version. It is now IMHO clearer though perhaps at the cost of rewriting a pth file even if it is not dirty. But then it is hardly a performance-critical step.



---

archive/issue_comments_157645.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-02-28T20:24:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13029#issuecomment-157645",
    "user": "vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_157646.json:
```json
{
    "body": "We can't push the changes upstream since fcntl is unix only but setuptools has to work on (non-cygwin) windows",
    "created_at": "2014-02-28T20:24:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13029#issuecomment-157646",
    "user": "vbraun"
}
```

We can't push the changes upstream since fcntl is unix only but setuptools has to work on (non-cygwin) windows



---

archive/issue_comments_157647.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2014-02-28T20:26:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13029#issuecomment-157647",
    "user": "vbraun"
}
```

Changing priority from major to critical.



---

archive/issue_comments_157648.json:
```json
{
    "body": "Critical as we currently have some races as I noticed in parallel testing.",
    "created_at": "2014-02-28T20:26:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13029#issuecomment-157648",
    "user": "vbraun"
}
```

Critical as we currently have some races as I noticed in parallel testing.



---

archive/issue_comments_157649.json:
```json
{
    "body": "Looks fine, although I'll have to test it out. It would be good to get some sort of proper locking in upstream -- maybe doing something along the lines of http://code.activestate.com/recipes/65203/.",
    "created_at": "2014-02-28T21:29:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13029#issuecomment-157649",
    "user": "ohanar"
}
```

Looks fine, although I'll have to test it out. It would be good to get some sort of proper locking in upstream -- maybe doing something along the lines of http://code.activestate.com/recipes/65203/.



---

archive/issue_comments_157650.json:
```json
{
    "body": "The patch version of setuptools will need a version bump to force a rebuild. Also, it would be good to have the patch documented in the SPKG.txt. Pending those two things, positive review.",
    "created_at": "2014-02-28T21:43:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13029#issuecomment-157650",
    "user": "ohanar"
}
```

The patch version of setuptools will need a version bump to force a rebuild. Also, it would be good to have the patch documented in the SPKG.txt. Pending those two things, positive review.



---

archive/issue_comments_157651.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-03-11T12:53:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13029#issuecomment-157651",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_157652.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-03-11T12:53:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13029#issuecomment-157652",
    "user": "vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_157653.json:
```json
{
    "body": "Done.",
    "created_at": "2014-03-11T12:53:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13029#issuecomment-157653",
    "user": "vbraun"
}
```

Done.



---

archive/issue_comments_157654.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2014-03-11T12:56:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13029#issuecomment-157654",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_157655.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2014-03-11T12:56:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13029#issuecomment-157655",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_157656.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-03-11T16:15:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13029#issuecomment-157656",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_157657.json:
```json
{
    "body": "You just broke sagenb: #17268",
    "created_at": "2014-10-31T13:39:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13029",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13029#issuecomment-157657",
    "user": "jdemeyer"
}
```

You just broke sagenb: #17268
