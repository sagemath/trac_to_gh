# Issue 30714: tox.ini, build/bin/write-dockerfile.sh: Simplify by using new options of "sage -package list"

Issue created by migration from https://trac.sagemath.org/ticket/30951

Original creator: mkoeppe

Original creation time: 2020-11-23 02:27:42

CC:  @tobiasdiez slabbe @kliem




---

Comment by mkoeppe created at 2020-11-23 07:52:13

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2020-11-23 07:52:13

Last 10 new commits:


---

Comment by git created at 2020-11-26 18:51:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-11-26 19:02:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-11-26 19:04:19

Ready for review


---

Comment by slabbe created at 2020-11-27 11:22:28

Something is weird, I can not get the documentation to build, I get:


```
[dochtml] [manifolds] ImportError: /home/slabbe/GitBox/sage/local/lib/python3.8/site-packages/sage/matrix/matrix_symbolic_dense.cpython-38-x86_64-linux-gnu.so: fichier trop court
[dochtml] [manifolds] The inventory files are in local/share/doc/sage/inventory/en/reference/manifolds.
[dochtml] Error building the documentation.
[dochtml] Traceback (most recent call last):
[dochtml]   File "/usr/lib/python3.8/runpy.py", line 192, in _run_module_as_main
[dochtml]     return _run_code(code, main_globals, None,
[dochtml]   File "/usr/lib/python3.8/runpy.py", line 85, in _run_code
[dochtml]     exec(code, run_globals)
[dochtml]   File "/home/slabbe/GitBox/sage/local/lib/python3.8/site-packages/sage_setup/docbuild/__main__.py", line 2, in <module>
[dochtml]     main()                                              
[dochtml]   File "/home/slabbe/GitBox/sage/local/lib/python3.8/site-packages/sage_setup/docbuild/__init__.py", line 1730, in main
[dochtml]     builder()
[dochtml]   File "/home/slabbe/GitBox/sage/local/lib/python3.8/site-packages/sage_setup/docbuild/__init__.py", line 343, in _wrapper
[dochtml]     getattr(get_builder(document), 'inventory')(*args, **kwds)
[dochtml]   File "/home/slabbe/GitBox/sage/local/lib/python3.8/site-packages/sage_setup/docbuild/__init__.py", line 569, in _wrapper
[dochtml]     self._build_everything_except_bibliography(lang, format, *args, **kwds)
[dochtml]   File "/home/slabbe/GitBox/sage/local/lib/python3.8/site-packages/sage_setup/docbuild/__init__.py", line 555, in _build_everything_except_bibliography
[dochtml]     build_many(build_ref_doc, non_references)          
[dochtml]   File "/home/slabbe/GitBox/sage/local/lib/python3.8/site-packages/sage_setup/docbuild/__init__.py", line 295, in build_many
[dochtml]     _build_many(target, args, processes=NUM_THREADS)   
[dochtml]   File "/home/slabbe/GitBox/sage/local/lib/python3.8/site-packages/sage_setup/docbuild/utils.py", line 289, in build_many
[dochtml]     raise worker_exc.original_exception
[dochtml] OSError: /home/slabbe/GitBox/sage/local/lib/python3.8/site-packages/sage/manifolds/differentiable/integrated_curve.py:docstring of sage.manifolds.differentiable.integrated_curve:5
1: WARNING: Exception occurred in plotting integrated_curve-1
Makefile:1888: recipe for target 'doc-html' failed            
make[3]: *** [doc-html] Error 1            
Makefile:1778: recipe for target 'all-start' failed
```


probably it has nothing to do with the current ticket, but the error stays after `make doc-clean`. Is there a new way of cleaning the documentation?


---

Comment by mkoeppe created at 2020-11-27 21:40:43

I don't think that this ticket should affect docbuilding in any way.


---

Comment by slabbe created at 2020-11-30 08:20:41

Changing status from needs_review to positive_review.


---

Comment by slabbe created at 2020-11-30 08:20:41

`make ptestlong` works on Ubuntu 18.04.

I also tested archlinux and fedora with the command given in the current ticket description:


```
$ tox -e docker-archlinux-minimal -- config.status
...
___________________________________ summary ____________________________________
  docker-archlinux-minimal: commands succeeded
  congratulations :)
```


and


```
$ tox -e docker-fedora-32-maximal -- config.status
...
___________________________________ summary ____________________________________
  docker-fedora-32-maximal: commands succeeded
  congratulations :)
```



---

Comment by mkoeppe created at 2020-11-30 16:24:59

Thank you!


---

Comment by vbraun created at 2020-12-06 12:49:27

Resolution: fixed
