# Issue 30714: tox.ini, build/bin/write-dockerfile.sh: Simplify by using new options of "sage -package list"

archive/issues_030714.json:
```json
{
    "body": "CC:  @tobiasdiez @seblabbe @kliem\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/30951\n\n",
    "created_at": "2020-11-23T02:27:42Z",
    "labels": [
        "porting",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "tox.ini, build/bin/write-dockerfile.sh: Simplify by using new options of \"sage -package list\"",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30714",
    "user": "@mkoeppe"
}
```
CC:  @tobiasdiez @seblabbe @kliem



Issue created by migration from https://trac.sagemath.org/ticket/30951





---

archive/issue_comments_439125.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-11-23T07:52:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30714#issuecomment-439125",
    "user": "@mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_439126.json:
```json
{
    "body": "Last 10 new commits:",
    "created_at": "2020-11-23T07:52:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30714#issuecomment-439126",
    "user": "@mkoeppe"
}
```

Last 10 new commits:



---

archive/issue_comments_439127.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-11-26T18:51:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30714#issuecomment-439127",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_439128.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-11-26T19:02:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30714#issuecomment-439128",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_439129.json:
```json
{
    "body": "Ready for review",
    "created_at": "2020-11-26T19:04:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30714#issuecomment-439129",
    "user": "@mkoeppe"
}
```

Ready for review



---

archive/issue_comments_439130.json:
```json
{
    "body": "Something is weird, I can not get the documentation to build, I get:\n\n\n```\n[dochtml] [manifolds] ImportError: /home/slabbe/GitBox/sage/local/lib/python3.8/site-packages/sage/matrix/matrix_symbolic_dense.cpython-38-x86_64-linux-gnu.so: fichier trop court\n[dochtml] [manifolds] The inventory files are in local/share/doc/sage/inventory/en/reference/manifolds.\n[dochtml] Error building the documentation.\n[dochtml] Traceback (most recent call last):\n[dochtml]   File \"/usr/lib/python3.8/runpy.py\", line 192, in _run_module_as_main\n[dochtml]     return _run_code(code, main_globals, None,\n[dochtml]   File \"/usr/lib/python3.8/runpy.py\", line 85, in _run_code\n[dochtml]     exec(code, run_globals)\n[dochtml]   File \"/home/slabbe/GitBox/sage/local/lib/python3.8/site-packages/sage_setup/docbuild/__main__.py\", line 2, in <module>\n[dochtml]     main()                                              \n[dochtml]   File \"/home/slabbe/GitBox/sage/local/lib/python3.8/site-packages/sage_setup/docbuild/__init__.py\", line 1730, in main\n[dochtml]     builder()\n[dochtml]   File \"/home/slabbe/GitBox/sage/local/lib/python3.8/site-packages/sage_setup/docbuild/__init__.py\", line 343, in _wrapper\n[dochtml]     getattr(get_builder(document), 'inventory')(*args, **kwds)\n[dochtml]   File \"/home/slabbe/GitBox/sage/local/lib/python3.8/site-packages/sage_setup/docbuild/__init__.py\", line 569, in _wrapper\n[dochtml]     self._build_everything_except_bibliography(lang, format, *args, **kwds)\n[dochtml]   File \"/home/slabbe/GitBox/sage/local/lib/python3.8/site-packages/sage_setup/docbuild/__init__.py\", line 555, in _build_everything_except_bibliography\n[dochtml]     build_many(build_ref_doc, non_references)          \n[dochtml]   File \"/home/slabbe/GitBox/sage/local/lib/python3.8/site-packages/sage_setup/docbuild/__init__.py\", line 295, in build_many\n[dochtml]     _build_many(target, args, processes=NUM_THREADS)   \n[dochtml]   File \"/home/slabbe/GitBox/sage/local/lib/python3.8/site-packages/sage_setup/docbuild/utils.py\", line 289, in build_many\n[dochtml]     raise worker_exc.original_exception\n[dochtml] OSError: /home/slabbe/GitBox/sage/local/lib/python3.8/site-packages/sage/manifolds/differentiable/integrated_curve.py:docstring of sage.manifolds.differentiable.integrated_curve:5\n1: WARNING: Exception occurred in plotting integrated_curve-1\nMakefile:1888: recipe for target 'doc-html' failed            \nmake[3]: *** [doc-html] Error 1            \nMakefile:1778: recipe for target 'all-start' failed\n```\n\n\nprobably it has nothing to do with the current ticket, but the error stays after `make doc-clean`. Is there a new way of cleaning the documentation?",
    "created_at": "2020-11-27T11:22:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30714#issuecomment-439130",
    "user": "@seblabbe"
}
```

Something is weird, I can not get the documentation to build, I get:


```
[dochtml] [manifolds] ImportError: /home/slabbe/GitBox/sage/local/lib/python3.8/site-packages/sage/matrix/matrix_symbolic_dense.cpython-38-x86_64-linux-gnu.so: fichier trop court
[dochtml] [manifolds] The inventory files are in local/share/doc/sage/inventory/en/reference/manifolds.
[dochtml] Error building the documentation.
[dochtml] Traceback (most recent call last):
[dochtml]   File "/usr/lib/python3.8/runpy.py", line 192, in _run_module_as_main
[dochtml]     return _run_code(code, main_globals, None,
[dochtml]   File "/usr/lib/python3.8/runpy.py", line 85, in _run_code
[dochtml]     exec(code, run_globals)
[dochtml]   File "/home/slabbe/GitBox/sage/local/lib/python3.8/site-packages/sage_setup/docbuild/__main__.py", line 2, in <module>
[dochtml]     main()                                              
[dochtml]   File "/home/slabbe/GitBox/sage/local/lib/python3.8/site-packages/sage_setup/docbuild/__init__.py", line 1730, in main
[dochtml]     builder()
[dochtml]   File "/home/slabbe/GitBox/sage/local/lib/python3.8/site-packages/sage_setup/docbuild/__init__.py", line 343, in _wrapper
[dochtml]     getattr(get_builder(document), 'inventory')(*args, **kwds)
[dochtml]   File "/home/slabbe/GitBox/sage/local/lib/python3.8/site-packages/sage_setup/docbuild/__init__.py", line 569, in _wrapper
[dochtml]     self._build_everything_except_bibliography(lang, format, *args, **kwds)
[dochtml]   File "/home/slabbe/GitBox/sage/local/lib/python3.8/site-packages/sage_setup/docbuild/__init__.py", line 555, in _build_everything_except_bibliography
[dochtml]     build_many(build_ref_doc, non_references)          
[dochtml]   File "/home/slabbe/GitBox/sage/local/lib/python3.8/site-packages/sage_setup/docbuild/__init__.py", line 295, in build_many
[dochtml]     _build_many(target, args, processes=NUM_THREADS)   
[dochtml]   File "/home/slabbe/GitBox/sage/local/lib/python3.8/site-packages/sage_setup/docbuild/utils.py", line 289, in build_many
[dochtml]     raise worker_exc.original_exception
[dochtml] OSError: /home/slabbe/GitBox/sage/local/lib/python3.8/site-packages/sage/manifolds/differentiable/integrated_curve.py:docstring of sage.manifolds.differentiable.integrated_curve:5
1: WARNING: Exception occurred in plotting integrated_curve-1
Makefile:1888: recipe for target 'doc-html' failed            
make[3]: *** [doc-html] Error 1            
Makefile:1778: recipe for target 'all-start' failed
```


probably it has nothing to do with the current ticket, but the error stays after `make doc-clean`. Is there a new way of cleaning the documentation?



---

archive/issue_comments_439131.json:
```json
{
    "body": "I don't think that this ticket should affect docbuilding in any way.",
    "created_at": "2020-11-27T21:40:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30714#issuecomment-439131",
    "user": "@mkoeppe"
}
```

I don't think that this ticket should affect docbuilding in any way.



---

archive/issue_comments_439132.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-11-30T08:20:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30714#issuecomment-439132",
    "user": "@seblabbe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_439133.json:
```json
{
    "body": "`make ptestlong` works on Ubuntu 18.04.\n\nI also tested archlinux and fedora with the command given in the current ticket description:\n\n\n```\n$ tox -e docker-archlinux-minimal -- config.status\n...\n___________________________________ summary ____________________________________\n  docker-archlinux-minimal: commands succeeded\n  congratulations :)\n```\n\n\nand\n\n\n```\n$ tox -e docker-fedora-32-maximal -- config.status\n...\n___________________________________ summary ____________________________________\n  docker-fedora-32-maximal: commands succeeded\n  congratulations :)\n```\n",
    "created_at": "2020-11-30T08:20:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30714#issuecomment-439133",
    "user": "@seblabbe"
}
```

`make ptestlong` works on Ubuntu 18.04.

I also tested archlinux and fedora with the command given in the current ticket description:


```
$ tox -e docker-archlinux-minimal -- config.status
...
___________________________________ summary ____________________________________
  docker-archlinux-minimal: commands succeeded
  congratulations :)
```


and


```
$ tox -e docker-fedora-32-maximal -- config.status
...
___________________________________ summary ____________________________________
  docker-fedora-32-maximal: commands succeeded
  congratulations :)
```




---

archive/issue_comments_439134.json:
```json
{
    "body": "Thank you!",
    "created_at": "2020-11-30T16:24:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30714#issuecomment-439134",
    "user": "@mkoeppe"
}
```

Thank you!



---

archive/issue_comments_439135.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-12-06T12:49:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30714#issuecomment-439135",
    "user": "@vbraun"
}
```

Resolution: fixed
