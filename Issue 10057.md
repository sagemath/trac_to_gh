# Issue 10057: Segfault in backward and inverse FFT for 2**n elements

Issue created by migration from Trac.

Original creator: mpatel

Original creation time: 2010-10-02 21:13:11

Assignee: jason, jkantor

CC:  wdj

Sage crashes when asked to do a backward or inverse FFT for sizes that are powers of two:

```
sage: a = FFT(5)
sage: a[1] = 2
sage: a.forward_transform()
sage: a.backward_transform()
sage: a = FFT(4)
sage: a[1] = 2
sage: a.forward_transform()
sage: a.backward_transform()


------------------------------------------------------------
Unhandled SIGSEGV: A segmentation fault occurred in Sage.
This probably occurred because a *compiled* component
of Sage has a bug in it (typically accessing invalid memory)
or is not properly wrapped with _sig_on, _sig_off.
You might want to run Sage under gdb with 'sage -gdb' to debug this.
Sage will now terminate (sorry).
------------------------------------------------------------
```


Joal Heagney reported this problem on [sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/7830e0c484a0f38d).


---

Comment by mpatel created at 2010-10-02 21:15:24

This happens with `a.inverse_transform()`, too.  From near the end of `sage/gsl/fft.pyx`:

```python
    def backward_transform(self):
        cdef gsl_fft_complex_wavetable * wt
        cdef gsl_fft_complex_workspace * mem
        N = Integer(self.n)
        e = N.exact_log(2)
        if N==2**e:
            gsl_fft_complex_backward(self.data, self.stride, self.n, wt, mem)
```

Should this be

```python
            gsl_fft_complex_radix2_backward(self.data, self.stride, self.n)
```

(and similarly for `inverse_transform`)?

```python
        if N!=2**e:
            mem = gsl_fft_complex_workspace_alloc(self.n)
            wt = gsl_fft_complex_wavetable_alloc(self.n)
            gsl_fft_complex_backward(self.data, self.stride, self.n, wt, mem)
            gsl_fft_complex_workspace_free(mem)
            gsl_fft_complex_wavetable_free(wt)
```



---

Attachment


---

Attachment

rebase to sage-5.8.beta2


---

Comment by lftabera created at 2013-03-06 12:04:43

I have reviewed (and rebased) the code of M. Hansen and it is correct. I have also added another patch that fills coverage of fft.pyx and cleans the plot code. This second patch needs review.

Apply: trac_10058.2.patch, trac_10058_doc.patch


---

Comment by lftabera created at 2013-03-06 12:04:43

Changing status from new to needs_review.


---

Comment by lftabera created at 2013-03-06 12:04:43

Changing keywords from "" to "gsl, fft, segfault".


---

Comment by ppurka created at 2013-03-31 03:39:57

Hello! The patches look good. I have the following comments about the doc patch.

1. Can you fix the documentation of the functions? It should be like this

```
def function(n, p=1):
    """
    Determine the ``n``-th number. Note that I didn't use `n`
    since single backticks will format it in latex.
   
    INPUT:

    - ``n`` -- Integer. Description of this parameter

    - ``p`` -- Integer (default: 1). Description of this parameter.
```


2. The following line `180	        See `self.plot` for details. ` should use `:meth:` to refer to plot. Also, ``self.plot`` is used in some other functions.

```
See :meth:`.plot` for details.
```


3. `pi` should also be changed to float in this line

```
191	        pi    = sage.symbolic.constants.pi   # should append .n() at the end.
```


4. In the function `plot`, the INPUT needs a fix. It should be like this. Also, see 1. for the comment about default values and formatting.

```
- ``style`` -- Style of the plot, options are ``"rect"`` or ``"polar"``
```


You can refer to the [developer guide](http://www.sagemath.org/doc/developer/conventions.html#documentation-strings) for more information about the formatting of docstrings.

_EDIT_: Some formatting fixes.


---

Attachment

documentation, doctest, cleanin the plot code, rebased against sage 5.10.beta2


---

Comment by mmezzarobba created at 2014-02-01 11:34:52

Gitified and rebased on top of 6.1. The second patch looks good to me, except for minor points that I fixed in my two commits. Could seomeone please check:
* that I rebased the code correctly;
* whether you agree with my changes?
(If both are ok, please go ahead and set the ticket's status to `positive_review`.)


---

Comment by ppurka created at 2014-02-01 14:44:10

Looks good to me. It applies fine to sage-6.1 and `sage/gsl` passes all doctests.

On a sidenote, I don't even remember having made those comments earlier. In reply to my comments `@`lftabera updated a new patch but I never got any email because adding attachments do not generate emails!

_In short_: add a comment after adding or updating a git branch; otherwise we don't get email notifications!


---

Comment by ppurka created at 2014-02-01 14:44:10

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-02-02 16:57:23

Resolution: fixed


---

Comment by vbraun created at 2014-02-08 13:20:30

Followup at #15799
