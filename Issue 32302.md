# Issue 32302: Another fix in the usage of MixedIntegerLinearProgram in sage.graphs.generic_graph - part 2

Issue created by migration from https://trac.sagemath.org/ticket/32539

Original creator: dcoudert

Original creation time: 2021-09-19 11:42:59

CC:  mkoeppe

Part of #32191 (Meta-ticket: Audit/fix all uses of `MixedIntegerLinearProgram` in sage.combinat, sage.graphs).

Improve methods:
- `feedback_vertex_set`
- `flow`


---

Comment by dcoudert created at 2021-09-19 12:03:20

in method `flow`, I'm not completely sure that this code is safe

```
        if not integer and use_edge_labels is False:
            obj = Integer(obj)
```

Indeed, now the value `obj` is computed using the values of the flow variables and we either convert the values of the flow variables to `Integer` or we use the base ring of the MILP solver when `integer` is `False`.
`obj` is the balance of flow at the source.

Before, we had:

```
        obj = p.solve(log=verbose)
        if integer or use_edge_labels is False:
            obj = Integer(round(obj))
```

 
----
New commits:


---

Comment by dcoudert created at 2021-09-19 12:03:20

Changing status from new to needs_review.


---

Comment by dcoudert created at 2021-09-19 15:45:54

the reported pyflakes is fixed in #32538.


---

Comment by dcoudert created at 2021-10-01 07:01:34

green bot. Please review.


---

Comment by mkoeppe created at 2021-10-05 18:39:27

Replying to [comment:1 dcoudert]:
> in method `flow`, I'm not completely sure that this code is safe
> {{{
>         if not integer and use_edge_labels is False:
>             obj = Integer(obj)
> }}}

I think this will lead to errors if the `obj` (computed from the backend arc flow values) is not an exact integer.

```
sage: ZZ(1.9999999999)
TypeError: Attempt to coerce non-integral RealNumber to Integer
```



---

Comment by mkoeppe created at 2021-10-05 18:46:21

I think a better solution is to have this handled directly by `get_values`:
When the given edge capacities are `ZZ` (or the implicit capacities of 1 are used), pass `convert=ZZ` to `get_values`, not `convert=True`.


---

Comment by git created at 2021-10-05 21:21:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-10-05 21:24:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2021-10-05 21:24:57

This might be a better solution.


---

Comment by mkoeppe created at 2021-10-06 00:06:45

Changing status from needs_review to positive_review.


---

Comment by dcoudert created at 2021-10-06 05:13:22

Thank you for the review.


---

Comment by vbraun created at 2021-10-10 22:34:23

Resolution: fixed
