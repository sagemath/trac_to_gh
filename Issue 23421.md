# Issue 23421: Fractional Chromatic Index Infinite Loop

archive/issues_023421.json:
```json
{
    "body": "Keywords: GLPK,graph-theory\n\nThe implementation contains an infinite loop that is broken when a quantity is less than or equal to 1, however the loop never ends on the following input:\n\n\n```\nsage: g=graphs.PetersenGraph()\nsage: g.fractional_chromatic_index(solver=\"GLPK\")\n```\n\n\nThe problem seems to depend on the LP solver, using PPL seems to work just fine. Issue seems to be GLPK and CBC/Coin.\n\nRelevant sage-devel thread at [1].\n\nRelevant ask.sagemath thread at [2].\n\n[1]: https://groups.google.com/forum/#!topic/sage-devel/hsKxANYAeQI\n\n[2]: https://ask.sagemath.org/question/38543/fractional_chromatic_index-in-sage-76-gets-stuck-in-loop-adding-constraints/\n\nIssue created by migration from https://trac.sagemath.org/ticket/23658\n\n",
    "created_at": "2017-08-20T16:25:02Z",
    "labels": [
        "component: graph theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "Fractional Chromatic Index Infinite Loop",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23421",
    "user": "https://trac.sagemath.org/admin/accounts/users/fidelbarrera"
}
```
Keywords: GLPK,graph-theory

The implementation contains an infinite loop that is broken when a quantity is less than or equal to 1, however the loop never ends on the following input:


```
sage: g=graphs.PetersenGraph()
sage: g.fractional_chromatic_index(solver="GLPK")
```


The problem seems to depend on the LP solver, using PPL seems to work just fine. Issue seems to be GLPK and CBC/Coin.

Relevant sage-devel thread at [1].

Relevant ask.sagemath thread at [2].

[1]: https://groups.google.com/forum/#!topic/sage-devel/hsKxANYAeQI

[2]: https://ask.sagemath.org/question/38543/fractional_chromatic_index-in-sage-76-gets-stuck-in-loop-adding-constraints/

Issue created by migration from https://trac.sagemath.org/ticket/23658





---

archive/issue_comments_327393.json:
```json
{
    "body": "The easiest fix is to set the default solver to PPL.",
    "created_at": "2017-08-20T20:54:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23421#issuecomment-327393",
    "user": "https://github.com/dimpase"
}
```

The easiest fix is to set the default solver to PPL.



---

archive/issue_comments_327394.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-08-20T20:54:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23421#issuecomment-327394",
    "user": "https://github.com/dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_327395.json:
```json
{
    "body": "Changing keywords from \"GLPK,graph-theory\" to \"graph-theory, LP\".",
    "created_at": "2017-08-20T20:54:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23421#issuecomment-327395",
    "user": "https://github.com/dimpase"
}
```

Changing keywords from "GLPK,graph-theory" to "graph-theory, LP".



---

archive/issue_comments_327396.json:
```json
{
    "body": "another fix is to change the stop condition to \n\n```\nif sum((x[2] for x in matching)) <= 1 + 1e-9:\n    break\n```\n\n\nwith GLPK, we add multiple times the same constraint\n\n```\nAdding a constraint on matching : [(0, 5, 0.9999999999999999), (1, 2, 3.3306690738754696e-16), (6, 9, 1.4802973661668753e-16)]\n```\n\nand we can check that\n\n```\nsage: M = [(0, 5, 0.999999999999), (1, 6, 9.999778782798785e-13), (7, 9, 2.0000667788622195e-12)]\nsage: round(sum(e[2] for e in M),10)\n1.0\nsage: round(sum(e[2] for e in M),11)\n1.0\nsage: round(sum(e[2] for e in M),12)\n1.000000000002\n```\n\n\nThis is similar with Coin and I believe that it could also happen with `Cplex/Gurobi/...` on some graphs.",
    "created_at": "2017-08-21T07:27:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23421#issuecomment-327396",
    "user": "https://github.com/dcoudert"
}
```

another fix is to change the stop condition to 

```
if sum((x[2] for x in matching)) <= 1 + 1e-9:
    break
```


with GLPK, we add multiple times the same constraint

```
Adding a constraint on matching : [(0, 5, 0.9999999999999999), (1, 2, 3.3306690738754696e-16), (6, 9, 1.4802973661668753e-16)]
```

and we can check that

```
sage: M = [(0, 5, 0.999999999999), (1, 6, 9.999778782798785e-13), (7, 9, 2.0000667788622195e-12)]
sage: round(sum(e[2] for e in M),10)
1.0
sage: round(sum(e[2] for e in M),11)
1.0
sage: round(sum(e[2] for e in M),12)
1.000000000002
```


This is similar with Coin and I believe that it could also happen with `Cplex/Gurobi/...` on some graphs.



---

archive/issue_comments_327397.json:
```json
{
    "body": "Replying to [comment:2 dcoudert]:\n> another fix is to change the stop condition to \n> {{{\n> if sum((x[2] for x in matching)) <= 1 + 1e-9:\n>     break\n> }}}\n> \nthese kinds of absolute bounds don't scale well.\nWhile I didn't try, I guess taking a sufficiently big example\nwill render this broken, still.\n\nThere are several pointers in the source on how to improve it, perhaps\nthey should be explored, on another ticket.",
    "created_at": "2017-08-21T08:20:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23421#issuecomment-327397",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:2 dcoudert]:
> another fix is to change the stop condition to 
> {{{
> if sum((x[2] for x in matching)) <= 1 + 1e-9:
>     break
> }}}
> 
these kinds of absolute bounds don't scale well.
While I didn't try, I guess taking a sufficiently big example
will render this broken, still.

There are several pointers in the source on how to improve it, perhaps
they should be explored, on another ticket.



---

archive/issue_comments_327398.json:
```json
{
    "body": "I have another version in `u/dcoudert/23658`. It uses a LP for the matching problem which solved the issue.",
    "created_at": "2017-08-21T12:25:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23421#issuecomment-327398",
    "user": "https://github.com/dcoudert"
}
```

I have another version in `u/dcoudert/23658`. It uses a LP for the matching problem which solved the issue.



---

archive/issue_comments_327399.json:
```json
{
    "body": "So which branch should be used?\n\nChoosing `PPL` sounds reasonable since it is also the default in `Polyhedron`. In the current branch, I see only some spacing missing. Otherwise, looks good.",
    "created_at": "2017-08-22T16:36:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23421#issuecomment-327399",
    "user": "https://github.com/jplab"
}
```

So which branch should be used?

Choosing `PPL` sounds reasonable since it is also the default in `Polyhedron`. In the current branch, I see only some spacing missing. Otherwise, looks good.



---

archive/issue_comments_327400.json:
```json
{
    "body": "The branch I proposed seems solver independent.\n\nDima, what do you think?",
    "created_at": "2017-08-22T16:41:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23421#issuecomment-327400",
    "user": "https://github.com/dcoudert"
}
```

The branch I proposed seems solver independent.

Dima, what do you think?



---

archive/issue_comments_327401.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-08-30T22:31:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23421#issuecomment-327401",
    "user": "https://github.com/dimpase"
}
```

New commits:



---

archive/issue_comments_327402.json:
```json
{
    "body": "Sorry for sitting on this: I presume your approach is more efficient.\nCould we have more tests, in particular the example on the ticket ought to become a test, with a reference to this ticket...",
    "created_at": "2017-08-30T22:34:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23421#issuecomment-327402",
    "user": "https://github.com/dimpase"
}
```

Sorry for sitting on this: I presume your approach is more efficient.
Could we have more tests, in particular the example on the ticket ought to become a test, with a reference to this ticket...



---

archive/issue_comments_327403.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-31T08:13:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23421#issuecomment-327403",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_327404.json:
```json
{
    "body": "The ticket number of the test was wrong, but the test of this ticket is in the patch.\nI don't know which extra tests I could be added.",
    "created_at": "2017-08-31T08:15:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23421#issuecomment-327404",
    "user": "https://github.com/dcoudert"
}
```

The ticket number of the test was wrong, but the test of this ticket is in the patch.
I don't know which extra tests I could be added.



---

archive/issue_comments_327405.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-08-31T08:18:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23421#issuecomment-327405",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_327406.json:
```json
{
    "body": "OK, sorry, I overlooked it. It's good to go, thanks.",
    "created_at": "2017-08-31T08:18:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23421#issuecomment-327406",
    "user": "https://github.com/dimpase"
}
```

OK, sorry, I overlooked it. It's good to go, thanks.



---

archive/issue_comments_327407.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-09-04T06:10:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23421#issuecomment-327407",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_327408.json:
```json
{
    "body": "Follow-up: #23798",
    "created_at": "2017-09-07T11:52:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23421#issuecomment-327408",
    "user": "https://github.com/jdemeyer"
}
```

Follow-up: #23798
