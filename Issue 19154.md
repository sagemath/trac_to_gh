# Issue 19154: Move invariant_generators to libsingular

archive/issues_019154.json:
```json
{
    "body": "CC:  simonking @wdjoyner\n\nThis patch moves the .invariant_generators() method of finite matrix groups to libsingular, which simplifies much the code.\n\nIt also adds the possibility of defining the ring in which the result should be:\n\n\n```\nsage: m1 = matrix(QQ, [[0, -1], [1, 0]])\nsage: G = MatrixGroup([m1])\nsage: G.invariant_generators()\n[x0^2 + x1^2, x0^4 + x1^4, x0^3*x1 - x0*x1^3]\nsage: R.<x,y> = QQ[]\nsage: G.invariant_generators(R)\n[x^2 + y^2, x^4 + y^4, x^3*y - x*y^3]\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/19391\n\n",
    "created_at": "2015-10-11T23:44:30Z",
    "labels": [
        "component: group theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Move invariant_generators to libsingular",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19154",
    "user": "https://github.com/miguelmarco"
}
```
CC:  simonking @wdjoyner

This patch moves the .invariant_generators() method of finite matrix groups to libsingular, which simplifies much the code.

It also adds the possibility of defining the ring in which the result should be:


```
sage: m1 = matrix(QQ, [[0, -1], [1, 0]])
sage: G = MatrixGroup([m1])
sage: G.invariant_generators()
[x0^2 + x1^2, x0^4 + x1^4, x0^3*x1 - x0*x1^3]
sage: R.<x,y> = QQ[]
sage: G.invariant_generators(R)
[x^2 + y^2, x^4 + y^4, x^3*y - x*y^3]
```


Issue created by migration from https://trac.sagemath.org/ticket/19391





---

archive/issue_comments_262550.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-10-11T23:44:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19154",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19154#issuecomment-262550",
    "user": "https://github.com/miguelmarco"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_262551.json:
```json
{
    "body": "The code now is simpler. But there was a reason to have it like that: Singular isn't good at listing the elements of a group (which is needed for the Reynolds operator).\n\nIf I recall correctly, there were examples for which the computation of the Reynolds operator in Singular was too slow. Apparently these examples didn't go into the doctests. But perhaps they are available at the trac ticket for the original version of the code?\n----\nNew commits:",
    "created_at": "2015-10-12T06:48:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19154",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19154#issuecomment-262551",
    "user": "https://github.com/simon-king-jena"
}
```

The code now is simpler. But there was a reason to have it like that: Singular isn't good at listing the elements of a group (which is needed for the Reynolds operator).

If I recall correctly, there were examples for which the computation of the Reynolds operator in Singular was too slow. Apparently these examples didn't go into the doctests. But perhaps they are available at the trac ticket for the original version of the code?
----
New commits:



---

archive/issue_comments_262552.json:
```json
{
    "body": "Ok, i read in the header that you moved the computation of the reynolds operator to gap, but i didn't see any call to gap in the code. Now i see it, you mean this part, right?:\n\n\n```\nReyName = 't'+singular._next_var_name()\nsingular.eval('matrix %s[%d][%d]'%(ReyName,self.cardinality(),n))\nfor i in range(1,self.cardinality()+1):\n     M = Matrix(elements[i-1],F)\n     D = [{} for foobar in range(self.degree())]\n     for x,y in M.dict().items():\n     D[x[0]][x[1]] = y\n      for row in range(self.degree()):\n          for t in D[row].items():\n          singular.eval('%s[%d,%d]=%s[%d,%d]+(%s)*var(%d)'\n          %(ReyName,i,row+1,ReyName,i,row+1, repr(t[1]),t[0]+1))\n\n\n```\n\n\nWhat i don't understand is this part:\n\n\n```\nelse:\n    ReyName = 't'+singular._next_var_name()\n    singular.eval('list %s=group_reynolds((%s))'%(ReyName,Lgens))\n    IRName = 't'+singular._next_var_name()\n    singular.eval('matrix %s = invariant_algebra_reynolds(%s[1])'%(IRName,ReyName))\n```\n\n\nIf i am getting it right, it is supposed to cover the case where there are no elements in the group. In that case we should just return the ring itself.",
    "created_at": "2015-10-12T09:43:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19154",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19154#issuecomment-262552",
    "user": "https://github.com/miguelmarco"
}
```

Ok, i read in the header that you moved the computation of the reynolds operator to gap, but i didn't see any call to gap in the code. Now i see it, you mean this part, right?:


```
ReyName = 't'+singular._next_var_name()
singular.eval('matrix %s[%d][%d]'%(ReyName,self.cardinality(),n))
for i in range(1,self.cardinality()+1):
     M = Matrix(elements[i-1],F)
     D = [{} for foobar in range(self.degree())]
     for x,y in M.dict().items():
     D[x[0]][x[1]] = y
      for row in range(self.degree()):
          for t in D[row].items():
          singular.eval('%s[%d,%d]=%s[%d,%d]+(%s)*var(%d)'
          %(ReyName,i,row+1,ReyName,i,row+1, repr(t[1]),t[0]+1))


```


What i don't understand is this part:


```
else:
    ReyName = 't'+singular._next_var_name()
    singular.eval('list %s=group_reynolds((%s))'%(ReyName,Lgens))
    IRName = 't'+singular._next_var_name()
    singular.eval('matrix %s = invariant_algebra_reynolds(%s[1])'%(IRName,ReyName))
```


If i am getting it right, it is supposed to cover the case where there are no elements in the group. In that case we should just return the ring itself.



---

archive/issue_comments_262553.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-12T19:51:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19154",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19154#issuecomment-262553",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_262554.json:
```json
{
    "body": "Ok, now it computes the reynolds operator before passing it to singular.\n\nI am now working on the modular case. I having trouble getting the output of invariant_ring from libsingular. The singular command is supposed to return three matrices, but calling it through libsingular only gets the first one:\n\n\n```\nsage: from sage.libs.singular.function import singular_function\nsage: import sage.libs.singular.function_factory\nsage: sage.libs.singular.function_factory.lib('finvar.lib')\nsage: inring = singular_function('invariant_ring')\nsage: F=FiniteField(2)\nsage: R.<x,y> = F[]\nsage: m1 = matrix(R, 2, [0,1,1,0])\nsage: inring(m1)\n[x + y   x*y]\n```\n\n\nAny clue about how to get around this?",
    "created_at": "2015-10-12T19:57:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19154",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19154#issuecomment-262554",
    "user": "https://github.com/miguelmarco"
}
```

Ok, now it computes the reynolds operator before passing it to singular.

I am now working on the modular case. I having trouble getting the output of invariant_ring from libsingular. The singular command is supposed to return three matrices, but calling it through libsingular only gets the first one:


```
sage: from sage.libs.singular.function import singular_function
sage: import sage.libs.singular.function_factory
sage: sage.libs.singular.function_factory.lib('finvar.lib')
sage: inring = singular_function('invariant_ring')
sage: F=FiniteField(2)
sage: R.<x,y> = F[]
sage: m1 = matrix(R, 2, [0,1,1,0])
sage: inring(m1)
[x + y   x*y]
```


Any clue about how to get around this?



---

archive/issue_comments_262555.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-13T12:49:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19154",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19154#issuecomment-262555",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_262556.json:
```json
{
    "body": "Ok, i think it should be ok now. I added the modular case.\n\nI think that this code should be faster than the previous one, since it does the same, but using the faster libsingular interface rather than the string based one. If you have some interesting examples to test, please benchmark them.",
    "created_at": "2015-10-13T12:55:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19154",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19154#issuecomment-262556",
    "user": "https://github.com/miguelmarco"
}
```

Ok, i think it should be ok now. I added the modular case.

I think that this code should be faster than the previous one, since it does the same, but using the faster libsingular interface rather than the string based one. If you have some interesting examples to test, please benchmark them.



---

archive/issue_comments_262557.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-01-12T06:45:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19154",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19154#issuecomment-262557",
    "user": "https://github.com/cheuberg"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_262558.json:
```json
{
    "body": "merge conflict.",
    "created_at": "2017-01-12T06:45:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19154",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19154#issuecomment-262558",
    "user": "https://github.com/cheuberg"
}
```

merge conflict.



---

archive/issue_comments_262559.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-10-26T17:36:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19154",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19154#issuecomment-262559",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_262560.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-10-26T17:37:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19154",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19154#issuecomment-262560",
    "user": "https://github.com/miguelmarco"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_262561.json:
```json
{
    "body": "one failing doctest (shift in the indices)",
    "created_at": "2022-05-12T10:00:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19154",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19154#issuecomment-262561",
    "user": "https://github.com/fchapoton"
}
```

one failing doctest (shift in the indices)



---

archive/issue_comments_262562.json:
```json
{
    "body": "I fixed the failing doctest\n----\nNew commits:",
    "created_at": "2022-05-15T06:13:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19154",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19154#issuecomment-262562",
    "user": "https://github.com/fchapoton"
}
```

I fixed the failing doctest
----
New commits:



---

archive/issue_comments_262563.json:
```json
{
    "body": "is there anybody around still interested in this ticket ? It now passes the doctests. It may deserve some benchmarking.",
    "created_at": "2022-05-23T18:53:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19154",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19154#issuecomment-262563",
    "user": "https://github.com/fchapoton"
}
```

is there anybody around still interested in this ticket ? It now passes the doctests. It may deserve some benchmarking.



---

archive/issue_comments_262564.json:
```json
{
    "body": "For my part, i would set it to positive review if you agree.",
    "created_at": "2022-05-23T20:37:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19154",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19154#issuecomment-262564",
    "user": "https://github.com/miguelmarco"
}
```

For my part, i would set it to positive review if you agree.



---

archive/issue_comments_262565.json:
```json
{
    "body": "I would like to have at least one benchmark here (before / after), please.",
    "created_at": "2022-05-24T08:28:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19154",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19154#issuecomment-262565",
    "user": "https://github.com/fchapoton"
}
```

I would like to have at least one benchmark here (before / after), please.



---

archive/issue_comments_262566.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-24T18:55:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19154",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19154#issuecomment-262566",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_262567.json:
```json
{
    "body": "Surprisingly, I have found that the new code is actually a few miliseconds slower that the older one.\n\nWhile at profiling, I also caught a possible source of segfaults.\n----\nNew commits:",
    "created_at": "2022-05-24T18:56:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19154",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19154#issuecomment-262567",
    "user": "https://github.com/miguelmarco"
}
```

Surprisingly, I have found that the new code is actually a few miliseconds slower that the older one.

While at profiling, I also caught a possible source of segfaults.
----
New commits:



---

archive/issue_comments_262568.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-08-10T11:41:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19154",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19154#issuecomment-262568",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_262569.json:
```json
{
    "body": "red branch => needs_work",
    "created_at": "2022-08-10T11:41:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19154",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19154#issuecomment-262569",
    "user": "https://github.com/fchapoton"
}
```

red branch => needs_work
