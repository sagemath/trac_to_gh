# Issue 19154: Move invariant_generators to libsingular

Issue created by migration from Trac.

Original creator: mmarco

Original creation time: 2015-10-11 23:44:30

CC:  simonking wdj

This patch moves the .invariant_generators() method of finite matrix groups to libsingular, which simplifies much the code.

It also adds the possibility of defining the ring in which the result should be:


```
sage: m1 = matrix(QQ, [[0, -1], [1, 0]])
sage: G = MatrixGroup([m1])
sage: G.invariant_generators()
[x0^2 + x1^2, x0^4 + x1^4, x0^3*x1 - x0*x1^3]
sage: R.<x,y> = QQ[]
sage: G.invariant_generators(R)
[x^2 + y^2, x^4 + y^4, x^3*y - x*y^3]
```



---

Comment by mmarco created at 2015-10-11 23:44:43

Changing status from new to needs_review.


---

Comment by SimonKing created at 2015-10-12 06:48:50

The code now is simpler. But there was a reason to have it like that: Singular isn't good at listing the elements of a group (which is needed for the Reynolds operator).

If I recall correctly, there were examples for which the computation of the Reynolds operator in Singular was too slow. Apparently these examples didn't go into the doctests. But perhaps they are available at the trac ticket for the original version of the code?
----
New commits:


---

Comment by mmarco created at 2015-10-12 09:43:46

Ok, i read in the header that you moved the computation of the reynolds operator to gap, but i didn't see any call to gap in the code. Now i see it, you mean this part, right?:


```
ReyName = 't'+singular._next_var_name()
singular.eval('matrix %s[%d][%d]'%(ReyName,self.cardinality(),n))
for i in range(1,self.cardinality()+1):
     M = Matrix(elements[i-1],F)
     D = [{} for foobar in range(self.degree())]
     for x,y in M.dict().items():
     D[x[0]][x[1]] = y
      for row in range(self.degree()):
          for t in D[row].items():
          singular.eval('%s[%d,%d]=%s[%d,%d]+(%s)*var(%d)'
          %(ReyName,i,row+1,ReyName,i,row+1, repr(t[1]),t[0]+1))


```


What i don't understand is this part:


```
else:
    ReyName = 't'+singular._next_var_name()
    singular.eval('list %s=group_reynolds((%s))'%(ReyName,Lgens))
    IRName = 't'+singular._next_var_name()
    singular.eval('matrix %s = invariant_algebra_reynolds(%s[1])'%(IRName,ReyName))
```


If i am getting it right, it is supposed to cover the case where there are no elements in the group. In that case we should just return the ring itself.


---

Comment by git created at 2015-10-12 19:51:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mmarco created at 2015-10-12 19:57:09

Ok, now it computes the reynolds operator before passing it to singular.

I am now working on the modular case. I having trouble getting the output of invariant_ring from libsingular. The singular command is supposed to return three matrices, but calling it through libsingular only gets the first one:


```
sage: from sage.libs.singular.function import singular_function
sage: import sage.libs.singular.function_factory
sage: sage.libs.singular.function_factory.lib('finvar.lib')
sage: inring = singular_function('invariant_ring')
sage: F=FiniteField(2)
sage: R.<x,y> = F[]
sage: m1 = matrix(R, 2, [0,1,1,0])
sage: inring(m1)
[x + y   x*y]
```


Any clue about how to get around this?


---

Comment by git created at 2015-10-13 12:49:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mmarco created at 2015-10-13 12:55:17

Ok, i think it should be ok now. I added the modular case.

I think that this code should be faster than the previous one, since it does the same, but using the faster libsingular interface rather than the string based one. If you have some interesting examples to test, please benchmark them.


---

Comment by cheuberg created at 2017-01-12 06:45:24

Changing status from needs_review to needs_work.


---

Comment by cheuberg created at 2017-01-12 06:45:24

merge conflict.


---

Comment by git created at 2021-10-26 17:36:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mmarco created at 2021-10-26 17:37:27

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2022-05-12 10:00:57

one failing doctest (shift in the indices)


---

Comment by chapoton created at 2022-05-15 06:13:10

I fixed the failing doctest
----
New commits:


---

Comment by chapoton created at 2022-05-23 18:53:06

is there anybody around still interested in this ticket ? It now passes the doctests. It may deserve some benchmarking.


---

Comment by mmarco created at 2022-05-23 20:37:11

For my part, i would set it to positive review if you agree.


---

Comment by chapoton created at 2022-05-24 08:28:13

I would like to have at least one benchmark here (before / after), please.


---

Comment by git created at 2022-05-24 18:55:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mmarco created at 2022-05-24 18:56:49

Surprisingly, I have found that the new code is actually a few miliseconds slower that the older one.

While at profiling, I also caught a possible source of segfaults.
----
New commits:


---

Comment by chapoton created at 2022-08-10 11:41:06

Changing status from needs_review to needs_work.


---

Comment by chapoton created at 2022-08-10 11:41:06

red branch => needs_work
