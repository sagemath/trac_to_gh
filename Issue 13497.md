# Issue 13497: Replace some python2 functions with pyhton3 compatible ones in sage/databases

Issue created by migration from https://trac.sagemath.org/ticket/13701

Original creator: aapitzsch

Original creation time: 2012-11-11 18:01:37

Assignee: was

Keywords: python3

Moving forward to Python 3.

Execute

```
2to3 -f has_key -f except -f idioms -f ne -f raise -f print
```

for each *.py in sage/databases.


---

Comment by aapitzsch created at 2012-11-11 18:11:13

Changing status from new to needs_review.


---

Comment by kcrisman created at 2013-01-03 20:40:11

Same comment as at other similar tickets - does a lot without need, though in this case hopefully not quite as invasive since this code is less likely to be used.  Though even here the sloane stuff is essentially broken anyway (#10358) and with 5.6.beta2 I get

```
applying trac_13701.patch
patching file sage/databases/cremona.py
Hunk #2 succeeded at 123 with fuzz 2 (offset 0 lines).
Hunk #11 succeeded at 1336 with fuzz 1 (offset 34 lines).
now at: trac_13701.patch
```

which isn't a killer but indicates the complexity of these changes.


---

Comment by kcrisman created at 2013-01-03 20:56:03

I've rebased.  Patchbot, apply trac_13701.2.patch

Note also that conv.py has zero doctests - who knows what that code is really up to?  Among other things, it refers to

```
PATH = SAGE_ROOT + "/src/tables/modular/gamma0/db/"
```

which clearly makes no sense.  In fact, the only touches of this code in AGES have been essentially auto-produced.  I'm going to ask on sage-devel about this, in fact.


---

Comment by fbissey created at 2013-01-04 09:36:05

Answering here rather than on list. It is clearly unused unless, may be, by some unidentified optional/experimental spkg. The line you quote is followed by:

```
sage_makedirs(PATH)
```

which would be making a big splash on any sage-on-gentoo install (or the fedora port by pcpa and before that his Mandriva one). The fact that we haven't noticed seem to indicate that it is never called from anywhere by default.


---

Comment by kcrisman created at 2013-01-04 15:11:55

Replying to [comment:4 fbissey]:
> Answering here rather than on list. It is clearly unused unless, may be, by some unidentified optional/experimental spkg. The line you quote is followed by:
> {{{
> sage_makedirs(PATH)
> }}}
> which would be making a big splash on any sage-on-gentoo install (or the fedora port by pcpa and before that his Mandriva one). The fact that we haven't noticed seem to indicate that it is never called from anywhere by default.
William confirmed this - see #13910.

André, can you do this ticket but without that file included, so that removing it at #13910 won't conflict with the patch here?


---

Comment by aapitzsch created at 2013-01-06 14:48:29

Replying to [comment:5 kcrisman]:
> André, can you do this ticket but without that file included, so that removing it at #13910 won't conflict with the patch here?
Done.

Apply [attachment:trac_13701.3.patch].


---

Comment by fbissey created at 2013-01-14 10:35:31

This work will be affected/interfere with #12205 and #10353.


---

Comment by kcrisman created at 2013-01-14 13:56:10

> This work will be affected/interfere with #12205 and #10353.
André, do you mind rebasing with respect to those?  In fact, you could probably just cut out hunks of your patch by hand to make it compatible with #10353 - this is great that we are able to remove that cruft, I just assumed it was actually used!


---

Comment by aapitzsch created at 2013-01-14 21:54:04

I just removed the _compressed_storage, db_ and _conway_ parts from [attachment:trac_13701.3.patch].

To patchbot: apply [attachment:trac_13701.4.patch].


---

Comment by fbissey created at 2013-01-14 21:56:28

Have you checked if the new conway.py needs touching for python 3?


---

Attachment

I updated the patch to consider changes in the new _conway.py_. That's why this patch now depends on #12205.

Still apply [attachment:trac_13701.4.patch].


---

Comment by fbissey created at 2013-01-14 22:31:07

That's great! Thank you, hopefully we can integrate this in 5.7.beta0 or beta1.


---

Comment by aapitzsch created at 2013-02-01 22:32:54

Karl-Dieter, are additional changes needed to get this positive reviewed?


---

Comment by kcrisman created at 2013-02-02 02:32:42

> Karl-Dieter, are additional changes needed to get this positive reviewed?
Probably not - I just haven't had time to look it all over again.  I tend to need a while, just to make sure I really check everything, and so it can take time... especially with my current non-Sage duties ;-) but I'm not the only potential reviewer out there!


---

Comment by kcrisman created at 2013-02-07 03:01:59

I don't think this will impact this ticket, but #14075 also touches one of these files.


---

Comment by fbissey created at 2013-02-07 08:26:55

Changing status from needs_review to positive_review.


---

Comment by fbissey created at 2013-02-07 08:26:55

Replying to [comment:15 kcrisman]:
> I don't think this will impact this ticket, but #14075 also touches one of these files.

No. The only changes that will be made in #14075 will be to the concerned spkg. Nothing will happen to the sage library. Since spkg-install is python you can comment on it but it is completely orthogonal to this patch.

And I will put this to positive review already. I think you two have done a great job with that and it look good to me.


---

Comment by kcrisman created at 2013-02-07 14:55:47

> > I don't think this will impact this ticket, but #14075 also touches one of these files.
> 
> No. The only changes that will be made in #14075 will be to the concerned spkg. Nothing will happen to the sage library. Since spkg-install is python you can comment on it but it is completely orthogonal to this patch.

Sorry, I was referring to another ticket and mistyped - I meant #12092.  Thanks for catching that!


---

Comment by jdemeyer created at 2013-02-09 12:12:45

Resolution: fixed
