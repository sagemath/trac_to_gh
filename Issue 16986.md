# Issue 16986: Pari testsuite segfault on OSX 10.10

Issue created by migration from Trac.

Original creator: vbraun

Original creation time: 2014-10-25 22:59:31

Keywords: yosemite

The dynamically-linked part of the pari testsuite segfaults in a test:


```

* Testing multivar-mul     gp-sta..TIME= 3791   gp-dyn..TIME= 4240   

* Testing nf               gp-sta..TIME= 1179   gp-dyn..BUG ![878]    

```


The !`-Wl,-flat_namespace` linker flag looks very dodgy. Probably just another case of "You can't reliably build shared libraries without libtool"...


---

Attachment

Log of the "gen2red-dyn" failing test


---

Comment by vbraun created at 2014-10-25 23:03:40

Log of the "nf-dyn" failing testn


---

Attachment


---

Comment by vbraun created at 2014-10-26 12:27:23

Testsuite passes indeed if I change the linker flags to what is appropriate on newer OSX versions

```
--- pari-2.7.1/config/get_dlld	2014-03-25 08:59:21.000000000 +0000
+++ pari-2.7.1/config/get_dlld	2014-10-26 12:17:12.000000000 +0000
`@``@` -74,7 +74,7 `@``@`
   else # DLLD != GNU ld
     case "$osname" in
       aix)     DLLDFLAGS='-r' ;;
-      darwin)  DLLDFLAGS="-flat_namespace -undefined suppress -compatibility_version $compat_ver -current_version $num_ver" ;;
+      darwin)  DLLDFLAGS="-undefined dynamic_lookup -compatibility_version $compat_ver -current_version $num_ver" ;;
       freebsd) DLLDFLAGS='-Bshareable -x' ;;
       hpux)    DLLDFLAGS='-b' ;;
       irix)    DLLDFLAGS='-shared -elf -no_unresolved -all' ;;
```



---

Comment by jdemeyer created at 2014-10-28 09:26:09

Replying to [ticket:17223 vbraun]:
> You can't reliably build shared libraries without libtool

Not with libtool either :-)


---

Comment by jdemeyer created at 2015-03-13 09:53:02

Is this fixed by #16997?


---

Comment by jhpalmieri created at 2015-03-13 17:40:21

With the latest beta, pari passes its test suite on two different OS X machines for me. So it looks fixed to me.


---

Comment by jdemeyer created at 2015-03-13 18:26:44

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2015-03-13 18:26:49

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-03-13 19:53:02

Resolution: fixed
