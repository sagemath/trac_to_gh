# Issue 29176: Upgrade cddlib, fix cddlib header search for packages latte_int, gfan, topcom

Issue created by migration from https://trac.sagemath.org/ticket/29413

Original creator: mkoeppe

Original creation time: 2020-03-27 12:35:49

CC:  mjo dimpase saraedum slelievre arojas fbissey @kliem

Follow up from #28905.


---

Comment by slelievre created at 2020-09-15 17:02:42

Changing keywords from "" to "upgrade, cddlib".


---

Comment by slelievre created at 2020-09-15 17:02:42

New: cddlib 0.94k was released on 2020-09-15.

- https://github.com/cddlib/cddlib/releases


---

Comment by dimpase created at 2020-12-09 16:08:09

a newer cdd 0.94m fixing #30319 has been released


---

Comment by mkoeppe created at 2021-02-25 00:39:48

Are there already patches around for the cdd header file locations for `gfan` and `topcom`?


---

Comment by fbissey created at 2021-02-25 22:37:10

For `cddlib`, this is a bit upsetting. We compile in Gentoo and in sage with `-DNOCDDPREFIX` which trigger block like this

```
#ifdef NOCDDPREFIX
#include "setoper.h"
#include "cdd.h"
#include "cdd_f.h"
#else
#include "cdd/setoper.h"
#include "cdd/cdd.h"
#include "cdd/cdd_f.h"
#endif
```

in `src/lp_cdd.cpp`, `src/gfanlib_zcone.cpp` and `src/app_librarytest.cpp`. So, it feels a bit stupid now that the prefix is `cddlib`. But at least the patch should be easy and then remove the `-DNOCDDPREFIX` from CXXFLAGS.


---

Comment by fbissey created at 2021-02-26 01:03:29

nix has a patch to go with the removal of `-DNOCDDPREFIX`. However, there is a simpler fix. gfan only install binaries and no headers. Adding `-Ipath_to/include/cddlib` to `CXXFLAGS` will allow compilation and it is compatible with older cddlib too. I'll look at topcom next.


---

Comment by mkoeppe created at 2021-02-26 02:13:03

Replying to [comment:7 fbissey]:
> However, there is a simpler fix. gfan only install binaries and no headers. Adding `-Ipath_to/include/cddlib` to `CXXFLAGS` will allow compilation and it is compatible with older cddlib too.

This is not a good fix. All of these packages should be modified (with proper upstreamable patches) so that they look for upstream's official new header name `cddlib/cdd.h` in the normal user-provided include path.


---

Comment by fbissey created at 2021-02-26 03:32:10

That's easy enough to do. I would hope the fix has already been forwarded to the gfan people. Upstream is overdue for a maintenance release :)


---

Comment by fbissey created at 2021-02-26 03:53:11

For topcom I am going to advocate adding to CPPFLAGS for now. Because upstream is a serial vendorer and its build system relies exclusively on vendored versions. Once we can get that upstream to get out of vendoring we may be able to suggest patches to them. But right now the point is moot.


---

Comment by fbissey created at 2021-02-26 03:55:58

And topcom has a new version: 0.17.8 (still massively vendoring).


---

Comment by fbissey created at 2021-02-26 04:33:02

Now that I see how much you already patched topcom, it is trivial to add a little love for cddlib at https://github.com/sagemath/sage/blob/develop/build/pkgs/topcom/patches/configure.ac#L63


---

Comment by @kliem created at 2021-02-26 13:27:36

I think I got it figured out for latte now: https://github.com/latte-int/latte/pull/23

There is a couple of scenarios that could happen:

- System cdd in:
  - inclusion directory
  - `cdd/`
  - `cddlib'`
- Sages cdd in:
  - inclusion directory (of sage)
  - `cddlib/` (once cdd is upgraded)


---

Comment by mkoeppe created at 2021-03-18 02:36:01

Also need to check polymake.


---

Comment by mkoeppe created at 2021-03-21 17:37:59

Replying to [comment:11 fbissey]:
> And topcom has a new version: 0.17.8 (still massively vendoring).
Opened #31531 for topcom


---

Comment by mkoeppe created at 2021-03-27 02:13:38

Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.


---

Comment by jhpalmieri created at 2022-09-14 22:29:45

Is the last issue ("make singular pick sage's cdd") resolved? The Singular change is marked as "merged", and I've been using `homebrew`'s `cddlib` and `singular` on at least one OS X machine for a while with no apparent issues.


---

Comment by dimpase created at 2022-10-03 07:12:50

let's reenable cddlib for Homebrew.


---

Comment by dimpase created at 2022-10-03 09:13:32

New commits:


---

Comment by dimpase created at 2022-10-03 09:13:32

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2022-10-03 15:47:57

Good idea. Is there any reason to keep this meta-ticket open and handle homebrew/cddlib elsewhere? Otherwise, I'm happy with this change.


---

Comment by mkoeppe created at 2022-10-05 00:22:29

I think also the comment in `build/pkgs/cddlib/spkg-configure.m4` should be updated so that it does not talk about this ticket as something for the future


---

Comment by git created at 2022-10-05 12:53:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2022-10-05 12:54:57

I've opened #34634 to deal with the renaming `cddlib/->cdd/` of headers' subdir on Debian.


---

Comment by mkoeppe created at 2022-10-05 16:42:16

Another update on debian please for the comment


---

Comment by git created at 2022-10-05 19:45:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2022-10-06 14:47:35

Replying to [comment:38 Matthias Köppe]:
> Another update on debian please for the comment
done in ​0c27c4f


---

Comment by mkoeppe created at 2022-10-06 19:09:48

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2022-10-06 19:09:48

Thanks. Should #31531 be a dependency?


---

Comment by dimpase created at 2022-10-06 19:15:53

I don't see how #31531 is a dependency to this Homebrew-specific branch.


---

Comment by mkoeppe created at 2022-10-06 19:17:13

ok then


---

Comment by vbraun created at 2022-10-16 22:16:05

Resolution: fixed
