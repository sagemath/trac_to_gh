# Issue 19283: implement random triangulations in a bijective way

archive/issues_019283.json:
```json
{
    "body": "CC:  @nathanncohen\n\nKeywords: random graph\n\nThis will provide a fast uniform (almost) random generator for triangulations.\n\nThis uses the algorithm via a bijection with blossoming trees due to Schaeffer and Poulalhon.\n\nIssue created by migration from https://trac.sagemath.org/ticket/19520\n\n",
    "created_at": "2015-11-04T14:18:42Z",
    "labels": [
        "component: graph theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.10",
    "title": "implement random triangulations in a bijective way",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19283",
    "user": "https://github.com/fchapoton"
}
```
CC:  @nathanncohen

Keywords: random graph

This will provide a fast uniform (almost) random generator for triangulations.

This uses the algorithm via a bijection with blossoming trees due to Schaeffer and Poulalhon.

Issue created by migration from https://trac.sagemath.org/ticket/19520





---

archive/issue_comments_264427.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-11-04T14:19:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264427",
    "user": "https://github.com/fchapoton"
}
```

New commits:



---

archive/issue_comments_264428.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-11-04T14:19:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264428",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_264429.json:
```json
{
    "body": "Hello,\n\nIf you add this then I do not think that we need our former 'randomtriangulation' anymore.\n\nNathann\n\nP.S.: The difference between `listA += listB` and `listA.extend(listB)` is that the first one creates a copy og `listA` first.",
    "created_at": "2015-11-04T15:58:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264429",
    "user": "https://github.com/nathanncohen"
}
```

Hello,

If you add this then I do not think that we need our former 'randomtriangulation' anymore.

Nathann

P.S.: The difference between `listA += listB` and `listA.extend(listB)` is that the first one creates a copy og `listA` first.



---

archive/issue_comments_264430.json:
```json
{
    "body": "Well, this is a different \"random triangulation\", not the same distribution at all. Mine is better because it's almost uniform, but nevertheless one could keep the other.\n\nShould I use `.append` and `.extend` everywhere possible ?",
    "created_at": "2015-11-04T16:36:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264430",
    "user": "https://github.com/fchapoton"
}
```

Well, this is a different "random triangulation", not the same distribution at all. Mine is better because it's almost uniform, but nevertheless one could keep the other.

Should I use `.append` and `.extend` everywhere possible ?



---

archive/issue_comments_264431.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-04T16:44:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264431",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_264432.json:
```json
{
    "body": "Hello Fr\u00e9d\u00e9ric,\n\nYours is clearly better, and unless there is a specific reason why we should\nkeep the old one (please enlighten me) I do not see the point to have it around.\n\nFirst, because 'graphs.RandomTriangulation' should preferably be what you\nimplement now: at least the notion of 'random' is clear (and what one would expect).\n\nIf you insist on keeping the other, then perhaps it could be a (non-default)\noption of `RandomTriangulation`? Let us not kee code just for the sake of not\nthrowing anything away. What you did is what `RandomTriangulation` should be. If\nit had been like this from the start, we certainly wouldn't have added the other\nfunction later.\n\n> Should I use `.append` and `.extend` everywhere possible ?\n\nYes, please. Let us not waste ressources when we can easily avoid it.\n\nNathann",
    "created_at": "2015-11-04T21:07:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264432",
    "user": "https://github.com/nathanncohen"
}
```

Hello Frédéric,

Yours is clearly better, and unless there is a specific reason why we should
keep the old one (please enlighten me) I do not see the point to have it around.

First, because 'graphs.RandomTriangulation' should preferably be what you
implement now: at least the notion of 'random' is clear (and what one would expect).

If you insist on keeping the other, then perhaps it could be a (non-default)
option of `RandomTriangulation`? Let us not kee code just for the sake of not
throwing anything away. What you did is what `RandomTriangulation` should be. If
it had been like this from the start, we certainly wouldn't have added the other
function later.

> Should I use `.append` and `.extend` everywhere possible ?

Yes, please. Let us not waste ressources when we can easily avoid it.

Nathann



---

archive/issue_comments_264433.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-05T08:58:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264433",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_264434.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-05T09:01:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264434",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_264435.json:
```json
{
    "body": "ok, done. So this ticket now replaces the old implementation of `RandomTriangulation` by a new one.",
    "created_at": "2015-11-05T09:03:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264435",
    "user": "https://github.com/fchapoton"
}
```

ok, done. So this ticket now replaces the old implementation of `RandomTriangulation` by a new one.



---

archive/issue_comments_264436.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-05T11:08:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264436",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_264437.json:
```json
{
    "body": "Hello Fr\u00e9d\u00e9ric,\n\nI only read the content of `auxiliary_random_word` so far (one cannot say that the construction appears very explicitly in the paper `:-/`) and added a small commit at `public/19520`, mainly to point to where the constraints on the binary word are provided in the paper.\n\nIs there any reason why you add +3n and -n in to 'height', instead of compution '3*number_of_1 - number_of_zeroes' like in Proposition 4.2?\n\nNathann",
    "created_at": "2015-11-05T14:34:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264437",
    "user": "https://github.com/nathanncohen"
}
```

Hello Frédéric,

I only read the content of `auxiliary_random_word` so far (one cannot say that the construction appears very explicitly in the paper `:-/`) and added a small commit at `public/19520`, mainly to point to where the constraints on the binary word are provided in the paper.

Is there any reason why you add +3n and -n in to 'height', instead of compution '3*number_of_1 - number_of_zeroes' like in Proposition 4.2?

Nathann



---

archive/issue_comments_264438.json:
```json
{
    "body": "Hello,\n\nyes, this part is indeed already not clear. I am not sure to be convinced myself\nthat the algorithm that I wrote to conjugate the binary word is correct. But it works..\n\nThe idea is (like for usual conjugation into Dyck words) to assign a height at every step of the path, and to cut where the height is minimal or almost minimal here...",
    "created_at": "2015-11-05T15:23:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264438",
    "user": "https://github.com/fchapoton"
}
```

Hello,

yes, this part is indeed already not clear. I am not sure to be convinced myself
that the algorithm that I wrote to conjugate the binary word is correct. But it works..

The idea is (like for usual conjugation into Dyck words) to assign a height at every step of the path, and to cut where the height is minimal or almost minimal here...



---

archive/issue_comments_264439.json:
```json
{
    "body": "> yes, this part is indeed already not clear. I am not sure to be convinced myself\n> that the algorithm that I wrote to conjugate the binary word is correct.\n\nI'm sorry but I will not accept a code without being convinced that it is correct. Please make sure that this part does what it should, and then set this ticket to `needs_review`.\n\nNathann",
    "created_at": "2015-11-05T15:39:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264439",
    "user": "https://github.com/nathanncohen"
}
```

> yes, this part is indeed already not clear. I am not sure to be convinced myself
> that the algorithm that I wrote to conjugate the binary word is correct.

I'm sorry but I will not accept a code without being convinced that it is correct. Please make sure that this part does what it should, and then set this ticket to `needs_review`.

Nathann



---

archive/issue_comments_264440.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-11-05T15:39:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264440",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_264441.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-05T18:35:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264441",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_264442.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-05T18:49:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264442",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_264443.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-05T20:33:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264443",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_264444.json:
```json
{
    "body": "ok, should be much better now. I have added doc and explanations.\nAnd indeed my code was awful, and working only by miracle.",
    "created_at": "2015-11-05T20:34:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264444",
    "user": "https://github.com/fchapoton"
}
```

ok, should be much better now. I have added doc and explanations.
And indeed my code was awful, and working only by miracle.



---

archive/issue_comments_264445.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-11-05T20:34:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264445",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_264446.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2015-11-06T13:48:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264446",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_264447.json:
```json
{
    "body": "Hello Fr\u00e9d\u00e9ric,\n\nHere is another (incomplete) review:\n\n- The names of the two functions `contour_and_graph_from_word` and\n  `auxiliary_random_word` are not very descriptive of what they do, and this is\n  not really a problem since they are not meant to be called directly by the\n  user. As they do not appear in the documentation anyway, could you turn them\n  into private functions by adding a `_` at the beginning of their name?\n\n  If you do so, please update the sphinx links.\n\n- As a french person I understand why 'f' would denote a leaf, but that probably\n  isn't the appropriate letter. Is there actually anything stopping you from\n  using 'inner' and 'leaf' instead of 'i' and 'f'?\n\n- As my notion of up/down is apparently the opposite of what the paper use, I\n  rearranged the sentences of the doc of `contour_and_graph_from_word` so that\n  'away/toward the root' appears before the notion of up/down (which matches the\n  paper, as in your original text).\n\n- What do you call 'every inner vertex has two leaves' ? In the sequence\n  `[1,0,0,0,0,0]` that you use as an example in the docstring of\n  `contour_and_graph_from_word`, the root vertex (that you consider to be an\n  'inner' vertex) has exactly one neighbor, which is not a leaf.\n\n- In `contour_and_graph_from_word` the variable `active_vertex` was always equal\n  to `inner_stack[-1]`. I removed it. Less variables to keep track of --> easier\n  to understand.\n\n- This is a search operation in a list\n  {{{\n  inner_stack[-1] in leaf_stack:\n  }}}\n  This is not very efficient. Same for `leaf_stack.remove(x)`, which first looks\n  for an occurrence of `x` in `leaf_stack`, then removes it.\n\n  Fortunately none of these operations is necessary, for if there is a leaf to\n  add to the current inner vertex it is the last element of `leaf_stack` (which\n  also means that all 'search' operations actually read the list completely).\n\n- Where exactly is the algorithm of `RandomTriangulation` to be found in\n  [PS2006]_? In the documentation you say that it comes from this paper,\n  but... where? `O_o`\n\nThe modifications I mention can be found at public/19520.\n\nThanks,\n\nNathann",
    "created_at": "2015-11-06T13:48:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264447",
    "user": "https://github.com/nathanncohen"
}
```

Hello Frédéric,

Here is another (incomplete) review:

- The names of the two functions `contour_and_graph_from_word` and
  `auxiliary_random_word` are not very descriptive of what they do, and this is
  not really a problem since they are not meant to be called directly by the
  user. As they do not appear in the documentation anyway, could you turn them
  into private functions by adding a `_` at the beginning of their name?

  If you do so, please update the sphinx links.

- As a french person I understand why 'f' would denote a leaf, but that probably
  isn't the appropriate letter. Is there actually anything stopping you from
  using 'inner' and 'leaf' instead of 'i' and 'f'?

- As my notion of up/down is apparently the opposite of what the paper use, I
  rearranged the sentences of the doc of `contour_and_graph_from_word` so that
  'away/toward the root' appears before the notion of up/down (which matches the
  paper, as in your original text).

- What do you call 'every inner vertex has two leaves' ? In the sequence
  `[1,0,0,0,0,0]` that you use as an example in the docstring of
  `contour_and_graph_from_word`, the root vertex (that you consider to be an
  'inner' vertex) has exactly one neighbor, which is not a leaf.

- In `contour_and_graph_from_word` the variable `active_vertex` was always equal
  to `inner_stack[-1]`. I removed it. Less variables to keep track of --> easier
  to understand.

- This is a search operation in a list
  {{{
  inner_stack[-1] in leaf_stack:
  }}}
  This is not very efficient. Same for `leaf_stack.remove(x)`, which first looks
  for an occurrence of `x` in `leaf_stack`, then removes it.

  Fortunately none of these operations is necessary, for if there is a leaf to
  add to the current inner vertex it is the last element of `leaf_stack` (which
  also means that all 'search' operations actually read the list completely).

- Where exactly is the algorithm of `RandomTriangulation` to be found in
  [PS2006]_? In the documentation you say that it comes from this paper,
  but... where? `O_o`

The modifications I mention can be found at public/19520.

Thanks,

Nathann



---

archive/issue_comments_264448.json:
```json
{
    "body": "Hello Nathann, thanks for your time and your work.\n\n0) adding underscores to names, done\n\n1) using 'in' and 'lf' instead, done\n\n> - What do you call 'every inner vertex has two leaves' ? In the sequence\n>   `[1,0,0,0,0,0]` that you use as an example in the docstring of\n>   `contour_and_graph_from_word`, the root vertex (that you consider to be an\n>   'inner' vertex) has exactly one neighbor, which is not a leaf.\n\nNo, no, in the example `1,0,0,0,0,0`, the inner-root does have two leaves.\n\nOne must be careful about what is called the root. There is a leaf-root and an inner-root. In the paper, the leaf-root is considered as the \"true\" root. And so the inner root would have only one leaf.\n\nIn the algorithms, it turns out to be more convenient to use the inner-root as \"true\" root, and to transform the leaf-root to become the rightmost leaf of the inner-root. In this case, the inner root also has two leaves.\n\n\n> - Where exactly is the algorithm of `RandomTriangulation` to be found in\n>   [PS2006]_? In the documentation you say that it comes from this paper,\n>   but... where? `O_o`\n\nThis algorithm is my own implementation\nof the bijective map described in section 2.1. I am not sure that it is really efficient. I perform the closure moves by successive reductions of the contour word,\nuntil there is no sequence (in,in,in,lf) in the cyclic contour word.\n\n> The modifications I mention can be found at public/19520.\n\nLet us work together on the branch public/19520\n----\nNew commits:",
    "created_at": "2015-11-06T14:30:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264448",
    "user": "https://github.com/fchapoton"
}
```

Hello Nathann, thanks for your time and your work.

0) adding underscores to names, done

1) using 'in' and 'lf' instead, done

> - What do you call 'every inner vertex has two leaves' ? In the sequence
>   `[1,0,0,0,0,0]` that you use as an example in the docstring of
>   `contour_and_graph_from_word`, the root vertex (that you consider to be an
>   'inner' vertex) has exactly one neighbor, which is not a leaf.

No, no, in the example `1,0,0,0,0,0`, the inner-root does have two leaves.

One must be careful about what is called the root. There is a leaf-root and an inner-root. In the paper, the leaf-root is considered as the "true" root. And so the inner root would have only one leaf.

In the algorithms, it turns out to be more convenient to use the inner-root as "true" root, and to transform the leaf-root to become the rightmost leaf of the inner-root. In this case, the inner root also has two leaves.


> - Where exactly is the algorithm of `RandomTriangulation` to be found in
>   [PS2006]_? In the documentation you say that it comes from this paper,
>   but... where? `O_o`

This algorithm is my own implementation
of the bijective map described in section 2.1. I am not sure that it is really efficient. I perform the closure moves by successive reductions of the contour word,
until there is no sequence (in,in,in,lf) in the cyclic contour word.

> The modifications I mention can be found at public/19520.

Let us work together on the branch public/19520
----
New commits:



---

archive/issue_comments_264449.json:
```json
{
    "body": "Hellooooo,\n\n> No, no, in the example `1,0,0,0,0,0`, the inner-root does have two leaves.\n\nArgggggg, sorry. I wrote this comment then spent more time understanding what was actually going on. This comment was indeed incorrect, but I hope that you will find nothing wrong in my modifications of doc/code.\n\n> In the algorithms, it turns out to be more convenient to use the inner-root as \"true\" root, and to transform the leaf-root to become the rightmost leaf of the inner-root. In this case, the inner root also has two leaves.\n\nYepyep. I agree that the code seems consistent with this definition: all internal vertices have two leaves.\n\nAt first, I expected that discovering a leaf resulted in two consecutive '0' in the word, as going there (one 0) and going back (one 0) would take two moves. Turns out that 'discovering a leaf' takes only one 0.\n\nThis is the reason why I added in the documentation a comment about the expected length of a sequence with respect to its associated tree.\n\n> This algorithm is my own implementation\n> of the bijective map described in section 2.1. I am not sure that it is really efficient. I perform the closure moves by successive reductions of the contour word,\n> until there is no sequence (in,in,in,lf) in the cyclic contour word.\n\nI see. Could you add in the doc some pointers toward the corresponding sections of the paper (e.g. section 2.1) so that it is easier to know while reading the code which part of the paper you were 'translating'?\n\nThanks,\n\nNathann",
    "created_at": "2015-11-06T14:35:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264449",
    "user": "https://github.com/nathanncohen"
}
```

Hellooooo,

> No, no, in the example `1,0,0,0,0,0`, the inner-root does have two leaves.

Argggggg, sorry. I wrote this comment then spent more time understanding what was actually going on. This comment was indeed incorrect, but I hope that you will find nothing wrong in my modifications of doc/code.

> In the algorithms, it turns out to be more convenient to use the inner-root as "true" root, and to transform the leaf-root to become the rightmost leaf of the inner-root. In this case, the inner root also has two leaves.

Yepyep. I agree that the code seems consistent with this definition: all internal vertices have two leaves.

At first, I expected that discovering a leaf resulted in two consecutive '0' in the word, as going there (one 0) and going back (one 0) would take two moves. Turns out that 'discovering a leaf' takes only one 0.

This is the reason why I added in the documentation a comment about the expected length of a sequence with respect to its associated tree.

> This algorithm is my own implementation
> of the bijective map described in section 2.1. I am not sure that it is really efficient. I perform the closure moves by successive reductions of the contour word,
> until there is no sequence (in,in,in,lf) in the cyclic contour word.

I see. Could you add in the doc some pointers toward the corresponding sections of the paper (e.g. section 2.1) so that it is easier to know while reading the code which part of the paper you were 'translating'?

Thanks,

Nathann



---

archive/issue_comments_264450.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-06T14:47:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264450",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_264451.json:
```json
{
    "body": "needs review?",
    "created_at": "2015-11-06T17:03:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264451",
    "user": "https://github.com/nathanncohen"
}
```

needs review?



---

archive/issue_comments_264452.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-06T18:18:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264452",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_264453.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2015-11-06T18:19:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264453",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_264454.json:
```json
{
    "body": "now, yes. I had forgotten to add some underscores..",
    "created_at": "2015-11-06T18:19:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264454",
    "user": "https://github.com/fchapoton"
}
```

now, yes. I had forgotten to add some underscores..



---

archive/issue_comments_264455.json:
```json
{
    "body": "Replying to [comment:2 ncohen]:\n> Hello,\n> \n> If you add this then I do not think that we need our former 'randomtriangulation' anymore.\n> \n> Nathann\n> \n> P.S.: The difference between `listA += listB` and `listA.extend(listB)` is that the first one creates a copy og `listA` first.\n\nWhere did you see that?\n\n```\nsage: l = [1,2]\nsage: m = l\nsage: l += [4,5]\nsage: m\n[1, 2, 4, 5]\n```\n\n\nSee also [this stackoverflow question](http://stackoverflow.com/questions/9766387/different-behaviour-for-list-iadd-and-list-add)",
    "created_at": "2015-11-06T23:28:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264455",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:2 ncohen]:
> Hello,
> 
> If you add this then I do not think that we need our former 'randomtriangulation' anymore.
> 
> Nathann
> 
> P.S.: The difference between `listA += listB` and `listA.extend(listB)` is that the first one creates a copy og `listA` first.

Where did you see that?

```
sage: l = [1,2]
sage: m = l
sage: l += [4,5]
sage: m
[1, 2, 4, 5]
```


See also [this stackoverflow question](http://stackoverflow.com/questions/9766387/different-behaviour-for-list-iadd-and-list-add)



---

archive/issue_comments_264456.json:
```json
{
    "body": "Hmmmmmmmmmm.... You are right. And so 'l += b' is not equivalent to 'l = l + b'. Love it. I'll change it back to what it was, for then the original code was easier to read.\n\nNathann",
    "created_at": "2015-11-07T09:16:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264456",
    "user": "https://github.com/nathanncohen"
}
```

Hmmmmmmmmmm.... You are right. And so 'l += b' is not equivalent to 'l = l + b'. Love it. I'll change it back to what it was, for then the original code was easier to read.

Nathann



---

archive/issue_comments_264457.json:
```json
{
    "body": "But maybe `.append` is still a little bit faster than `+=` because there is no \"try except\" involved ?\n\nNOTA BENE: I intend to use the same code to create a simplicial complex instead. I would rather do that in another ticket, if you don't mind.",
    "created_at": "2015-11-07T09:47:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264457",
    "user": "https://github.com/fchapoton"
}
```

But maybe `.append` is still a little bit faster than `+=` because there is no "try except" involved ?

NOTA BENE: I intend to use the same code to create a simplicial complex instead. I would rather do that in another ticket, if you don't mind.



---

archive/issue_comments_264458.json:
```json
{
    "body": "try/except? Where?\n\nFrom what I understand '+=' is an alias of 'extend'. \n\nNathann",
    "created_at": "2015-11-07T09:49:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264458",
    "user": "https://github.com/nathanncohen"
}
```

try/except? Where?

From what I understand '+=' is an alias of 'extend'. 

Nathann



---

archive/issue_comments_264459.json:
```json
{
    "body": "> NOTA BENE: I intend to use the same code to create a simplicial complex instead. I would rather do that in another ticket, if you don't mind.\n\nI do not understand. Do you mean that you do not want the change `extend-> '+='`  to be done here because you fear a conflict with another branch?",
    "created_at": "2015-11-07T09:50:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264459",
    "user": "https://github.com/nathanncohen"
}
```

> NOTA BENE: I intend to use the same code to create a simplicial complex instead. I would rather do that in another ticket, if you don't mind.

I do not understand. Do you mean that you do not want the change `extend-> '+='`  to be done here because you fear a conflict with another branch?



---

archive/issue_comments_264460.json:
```json
{
    "body": "No, see the first answer in the stackoverflow. It says `+=` tries iadd then add.\n\nAnd my note bene has nothing to do with that, it was just information about my later plans. Sorry for the confusion.",
    "created_at": "2015-11-07T09:57:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264460",
    "user": "https://github.com/fchapoton"
}
```

No, see the first answer in the stackoverflow. It says `+=` tries iadd then add.

And my note bene has nothing to do with that, it was just information about my later plans. Sorry for the confusion.



---

archive/issue_comments_264461.json:
```json
{
    "body": "Oh, so that's the exception your worry about. Well, I'd say that until your code proves to not be sufficiently fast we have no need for this kind of optimisation (if it makes a difference). Avoiding a copy of the list was sufficiently non-negligible, but that's not so bad. If it ever becomes a problem, your code can easily be turned into more efficient Cython anyway `:-)`\n\nNathann",
    "created_at": "2015-11-07T10:04:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264461",
    "user": "https://github.com/nathanncohen"
}
```

Oh, so that's the exception your worry about. Well, I'd say that until your code proves to not be sufficiently fast we have no need for this kind of optimisation (if it makes a difference). Avoiding a copy of the list was sufficiently non-negligible, but that's not so bad. If it ever becomes a problem, your code can easily be turned into more efficient Cython anyway `:-)`

Nathann



---

archive/issue_comments_264462.json:
```json
{
    "body": "Ok; I agree. But please don't waste your time to put back +=, it is just as readable now IMHO.",
    "created_at": "2015-11-07T10:06:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264462",
    "user": "https://github.com/fchapoton"
}
```

Ok; I agree. But please don't waste your time to put back +=, it is just as readable now IMHO.



---

archive/issue_comments_264463.json:
```json
{
    "body": "Okayyyy !!!",
    "created_at": "2015-11-07T10:08:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264463",
    "user": "https://github.com/nathanncohen"
}
```

Okayyyy !!!



---

archive/issue_comments_264464.json:
```json
{
    "body": "Hellooo Fr\u00e9d\u00e9ric,\n\nI am reading the 'main' part of the algorithm, and trying to understand how you find the subsequences of the form 'in,in,in,lf,in'. It seems (I am not sure) that you do this manually. Here is something that you may like:\n\n\n```\nsage: 'abcdefghihijk'.index('def')\n3\n```\n\n\nThis 'index' function of str also takes an optional argument that means that the search should not start from the first character of the string, but from some later index. Eg\n\n```\nsage: 'abcdefghihijk'.index('def',5)\n...\nValueError: substring not found\n```\n\n\nIf you do what I think you are doing, then you are rewriting this .index function.\n\nNow, you cannot directly use this function, because it is a member of 'str' and not a member of 'list'. And your list is a sequence of pairs. Thus, it could be 'made to work' by creating a 'copy' of your list that only contains the indication of in/lf. Something like that\n\n```\nsage: w=[('in',3)]*5+[('lf',4)]+[('in',3)]\nsage: s=\"\".join(x[0] for x in w)\nsage: s.index('inininlfin')\n4\n```\n\n\nWith this index you can now do whatever operation on w you need.\n\nThis requires a copy of the list into a string, though on the other hand it would make your code much easier to read -- if you actually do what I think you do.\n\nWhat do you think?\n\nAlternatively, you could 'rewrite' an index function that applies to lists. Something like:\n\n```\nsage: def find_pattern(l):\n....:     for i in range(len(l)-4):\n....:         if 'in' == l[i] == l[i+1] == l[i+2] == l[i+4] and l[i+3] == 'lf':\n....:             return i\n```\n\n\nIt is not the 'best algorithmic way to compute it', but it would work. Do you think something like that may improve the code?\n\nNathann",
    "created_at": "2015-11-07T12:20:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264464",
    "user": "https://github.com/nathanncohen"
}
```

Hellooo Frédéric,

I am reading the 'main' part of the algorithm, and trying to understand how you find the subsequences of the form 'in,in,in,lf,in'. It seems (I am not sure) that you do this manually. Here is something that you may like:


```
sage: 'abcdefghihijk'.index('def')
3
```


This 'index' function of str also takes an optional argument that means that the search should not start from the first character of the string, but from some later index. Eg

```
sage: 'abcdefghihijk'.index('def',5)
...
ValueError: substring not found
```


If you do what I think you are doing, then you are rewriting this .index function.

Now, you cannot directly use this function, because it is a member of 'str' and not a member of 'list'. And your list is a sequence of pairs. Thus, it could be 'made to work' by creating a 'copy' of your list that only contains the indication of in/lf. Something like that

```
sage: w=[('in',3)]*5+[('lf',4)]+[('in',3)]
sage: s="".join(x[0] for x in w)
sage: s.index('inininlfin')
4
```


With this index you can now do whatever operation on w you need.

This requires a copy of the list into a string, though on the other hand it would make your code much easier to read -- if you actually do what I think you do.

What do you think?

Alternatively, you could 'rewrite' an index function that applies to lists. Something like:

```
sage: def find_pattern(l):
....:     for i in range(len(l)-4):
....:         if 'in' == l[i] == l[i+1] == l[i+2] == l[i+4] and l[i+3] == 'lf':
....:             return i
```


It is not the 'best algorithmic way to compute it', but it would work. Do you think something like that may improve the code?

Nathann



---

archive/issue_comments_264465.json:
```json
{
    "body": "Hmm. Well, I can see that one could use `index` as you suggest. Does this improve the code ? I don't know if it will be simpler at the end.\n\nI am currently running over the contour, contracting when I meet 'in,in,in,lf' (and  removing the next 'in' at the same time) ; this may happen several times in one run. Then doing it again and again, until nothing can be done. This must be done cyclically, so I shift and start again if something can still happen at the end. All this is certainly rather awkward. It may be possible to do all that in just one or two passes, by using a stack to remember how many 'in' one has at our disposal when meeting one 'lf', so that one can in some sense go backward when needed. I think I have seen some allusion to that kind of idea in the article.\n\nSo, what to do ? \n\n0) Keep more or less the current algo\n\n1) try to make it clearer, maybe by using `index`\n\n2) try to find an optimal or at least better algo, maybe with stacks\n\nI have no clear opinion, but I would rather avoid doing a lot of work.",
    "created_at": "2015-11-07T21:06:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264465",
    "user": "https://github.com/fchapoton"
}
```

Hmm. Well, I can see that one could use `index` as you suggest. Does this improve the code ? I don't know if it will be simpler at the end.

I am currently running over the contour, contracting when I meet 'in,in,in,lf' (and  removing the next 'in' at the same time) ; this may happen several times in one run. Then doing it again and again, until nothing can be done. This must be done cyclically, so I shift and start again if something can still happen at the end. All this is certainly rather awkward. It may be possible to do all that in just one or two passes, by using a stack to remember how many 'in' one has at our disposal when meeting one 'lf', so that one can in some sense go backward when needed. I think I have seen some allusion to that kind of idea in the article.

So, what to do ? 

0) Keep more or less the current algo

1) try to make it clearer, maybe by using `index`

2) try to find an optimal or at least better algo, maybe with stacks

I have no clear opinion, but I would rather avoid doing a lot of work.



---

archive/issue_comments_264466.json:
```json
{
    "body": "Hello Fr\u00e9d\u00e9ric,\n\nMy last comment was written with 'if' everywhere, because I was not sure of what you were doing exactly by looking at the code. Hence, my message was both a request for a confirmation that I understood correctly what you were doing, and a proposal to rewrite the code in a more readable way.\n\nI had totally missed the constraint that those merging operations had to be made cyclically, for instance. And right now, though I have 'some idea' of what you try to do in the code, I still do not understand it.\n\nMy proposition was not mainly a proposition to rewrite it more efficiently (and the 'string' of index version does have the 'copy' drawback I mentionned) but to rewrite it more clearly.\n\nTomorrow I will have a long bus trip, and I can try to rewrite a cyclic merging algorithm using 'index' that will only work on a string, leaving you to fill it with whatever it does at the same time with the graph.\n\nAt the moment I do not understand what your code does, and I try to do what I can to understand it and make life easier for whoever next will read it.\n\nNathann",
    "created_at": "2015-11-07T21:23:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264466",
    "user": "https://github.com/nathanncohen"
}
```

Hello Frédéric,

My last comment was written with 'if' everywhere, because I was not sure of what you were doing exactly by looking at the code. Hence, my message was both a request for a confirmation that I understood correctly what you were doing, and a proposal to rewrite the code in a more readable way.

I had totally missed the constraint that those merging operations had to be made cyclically, for instance. And right now, though I have 'some idea' of what you try to do in the code, I still do not understand it.

My proposition was not mainly a proposition to rewrite it more efficiently (and the 'string' of index version does have the 'copy' drawback I mentionned) but to rewrite it more clearly.

Tomorrow I will have a long bus trip, and I can try to rewrite a cyclic merging algorithm using 'index' that will only work on a string, leaving you to fill it with whatever it does at the same time with the graph.

At the moment I do not understand what your code does, and I try to do what I can to understand it and make life easier for whoever next will read it.

Nathann



---

archive/issue_comments_264467.json:
```json
{
    "body": "Hello Fr\u00e9d\u00e9ric,\n\nI thought about it for a while and ended up with the following design: a function scans for a pattern through a list l and -- if it finds it -- rotates l so that it starts with that pattern.\n\nHere is the code, hoping that it may help rewrite your code a bit more clearly:\n\n\n```python\ndef rotate_l_to_next_pattern(pattern):\n    global l\n    # Find 'pattern' in l, and rotates l so that l starts with 'pattern'.\n    n = len(n)\n    for i in range(n):\n        if all(l[(i+ii)%n] == x for ii,x in enumerate(pattern)):\n            l = l[i:] + l[:i]\n            return True\n    return False\n\nl = [0,1,0,0,0,0,0,1,1,0,1,0,1]\nwhile rotate_l_to_next_pattern([0,1]):\n    l[0] = 2\n```\n\n\nNathann",
    "created_at": "2015-11-08T07:34:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264467",
    "user": "https://github.com/nathanncohen"
}
```

Hello Frédéric,

I thought about it for a while and ended up with the following design: a function scans for a pattern through a list l and -- if it finds it -- rotates l so that it starts with that pattern.

Here is the code, hoping that it may help rewrite your code a bit more clearly:


```python
def rotate_l_to_next_pattern(pattern):
    global l
    # Find 'pattern' in l, and rotates l so that l starts with 'pattern'.
    n = len(n)
    for i in range(n):
        if all(l[(i+ii)%n] == x for ii,x in enumerate(pattern)):
            l = l[i:] + l[:i]
            return True
    return False

l = [0,1,0,0,0,0,0,1,1,0,1,0,1]
while rotate_l_to_next_pattern([0,1]):
    l[0] = 2
```


Nathann



---

archive/issue_comments_264468.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-09T16:01:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264468",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_264469.json:
```json
{
    "body": "I have tried to simplify my code, but I have not used your proposal.\nI have essentially kept my algo, but removed some variables, and reorganised a little bit.\nSome parts are still not very nice. Tell me what you think.",
    "created_at": "2015-11-09T16:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264469",
    "user": "https://github.com/fchapoton"
}
```

I have tried to simplify my code, but I have not used your proposal.
I have essentially kept my algo, but removed some variables, and reorganised a little bit.
Some parts are still not very nice. Tell me what you think.



---

archive/issue_comments_264470.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-09T16:17:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264470",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_264471.json:
```json
{
    "body": "Helloooooo Fr\u00e9d\u00e9ric,\n\nThanks, this code is a bit easier to understand (and I almost get what it does)!\n\nI admit that I am still looking with longing at the `rotate_l_to_next_pattern` function I gave in an earlier comment hoping that it could fit, but so far I have a couple of questions left:\n\n1) It seems that you consider the word as a circular word, but I am not convinced that your code would notice the pattern 'in,in,in,lf' if it appeared 'wrapped around' in this way: 'lf,in,in,in,in,in,in'. Is that correct? My previous code was written to handle this situation.\n\n2) I do not understand the purpose of the second condition in `if not stack_in or (x != stack_in[-1]):`. I thought you were only looking for the pattern 'in,in,in,lf' but it seems that some additional constraint has to be added?\n\nAlso, could you add a check at the end of your function that the graph you return has the expected number of edges (as it is a planar triangulation)?\n\nThanks,\n\nNathann",
    "created_at": "2015-11-09T18:09:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264471",
    "user": "https://github.com/nathanncohen"
}
```

Helloooooo Frédéric,

Thanks, this code is a bit easier to understand (and I almost get what it does)!

I admit that I am still looking with longing at the `rotate_l_to_next_pattern` function I gave in an earlier comment hoping that it could fit, but so far I have a couple of questions left:

1) It seems that you consider the word as a circular word, but I am not convinced that your code would notice the pattern 'in,in,in,lf' if it appeared 'wrapped around' in this way: 'lf,in,in,in,in,in,in'. Is that correct? My previous code was written to handle this situation.

2) I do not understand the purpose of the second condition in `if not stack_in or (x != stack_in[-1]):`. I thought you were only looking for the pattern 'in,in,in,lf' but it seems that some additional constraint has to be added?

Also, could you add a check at the end of your function that the graph you return has the expected number of edges (as it is a planar triangulation)?

Thanks,

Nathann



---

archive/issue_comments_264472.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-09T19:05:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264472",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_264473.json:
```json
{
    "body": "lo\n\n> 1) It seems that you consider the word as a circular word, but I am not convinced that your code would notice the pattern 'in,in,in,lf' if it appeared 'wrapped around' in this way: 'lf,in,in,in,in,in,in'. Is that correct? My previous code was written to handle this situation.\n\nThis is taken care near the end of the 'while' loop, which bring all final 'in' to the beginning on the word, and start again.\n \n> 2) I do not understand the purpose of the second condition in `if not stack_in or (x != stack_in[-1]):`. I thought you were only looking for the pattern 'in,in,in,lf' but it seems that some additional constraint has to be added?\n\nThis is because, when we meet in,in,in,lf, the next letter is always another in, that we must not add twice to the stack of in. Maybe one could add it there, instead, if you feel it is simpler.\n \n> Also, could you add a check at the end of your function that the graph you return has the expected number of edges (as it is a planar triangulation)?\n\ndone\n \nThanks to you!",
    "created_at": "2015-11-09T19:10:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264473",
    "user": "https://github.com/fchapoton"
}
```

lo

> 1) It seems that you consider the word as a circular word, but I am not convinced that your code would notice the pattern 'in,in,in,lf' if it appeared 'wrapped around' in this way: 'lf,in,in,in,in,in,in'. Is that correct? My previous code was written to handle this situation.

This is taken care near the end of the 'while' loop, which bring all final 'in' to the beginning on the word, and start again.
 
> 2) I do not understand the purpose of the second condition in `if not stack_in or (x != stack_in[-1]):`. I thought you were only looking for the pattern 'in,in,in,lf' but it seems that some additional constraint has to be added?

This is because, when we meet in,in,in,lf, the next letter is always another in, that we must not add twice to the stack of in. Maybe one could add it there, instead, if you feel it is simpler.
 
> Also, could you add a check at the end of your function that the graph you return has the expected number of edges (as it is a planar triangulation)?

done
 
Thanks to you!



---

archive/issue_comments_264474.json:
```json
{
    "body": "Hmm, I am putting this to needs_work, because I now have some doubts on\nmy algorithm.. Let me think about that.",
    "created_at": "2015-11-10T09:57:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264474",
    "user": "https://github.com/fchapoton"
}
```

Hmm, I am putting this to needs_work, because I now have some doubts on
my algorithm.. Let me think about that.



---

archive/issue_comments_264475.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-11-10T09:57:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264475",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_264476.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-10T10:42:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264476",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_264477.json:
```json
{
    "body": "ok, this should be good now. And the code is getting simpler. Back to needs review.",
    "created_at": "2015-11-10T10:44:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264477",
    "user": "https://github.com/fchapoton"
}
```

ok, this should be good now. And the code is getting simpler. Back to needs review.



---

archive/issue_comments_264478.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-11-10T10:44:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264478",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_264479.json:
```json
{
    "body": "Yooooooo,\n\n> ok, this should be good now. And the code is getting simpler. Back to needs review.\\\nOkay thanks! You'll get it today.\n\nNathann",
    "created_at": "2015-11-10T10:44:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264479",
    "user": "https://github.com/nathanncohen"
}
```

Yooooooo,

> ok, this should be good now. And the code is getting simpler. Back to needs review.\
Okay thanks! You'll get it today.

Nathann



---

archive/issue_comments_264480.json:
```json
{
    "body": "Hello Fr\u00e9d\u00e9ric,\n\nYou say in a comment that 'in1,in2,in3,lf' gets replaced by 'in1,in3', but your code removes the last two elements of the stack (which should be `in2,in3`). \n\nThus, I get the impression that your code replaces 'in1,in2,in3,lf' by 'in1'.\n\nNathann",
    "created_at": "2015-11-10T22:18:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264480",
    "user": "https://github.com/nathanncohen"
}
```

Hello Frédéric,

You say in a comment that 'in1,in2,in3,lf' gets replaced by 'in1,in3', but your code removes the last two elements of the stack (which should be `in2,in3`). 

Thus, I get the impression that your code replaces 'in1,in2,in3,lf' by 'in1'.

Nathann



---

archive/issue_comments_264481.json:
```json
{
    "body": "At this point, yes, but just the next step is another 'in3', that gets added.",
    "created_at": "2015-11-11T08:24:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264481",
    "user": "https://github.com/fchapoton"
}
```

At this point, yes, but just the next step is another 'in3', that gets added.



---

archive/issue_comments_264482.json:
```json
{
    "body": "Hello Fr\u00e9d\u00e9ric,\n\nI read in the paper that the order in which the replacements are performed did not matter (page 7, right before 'balanced trees').\n\nI tried to simplify the code a bit, and ended up with the commit I just pushed to this ticket's public branch. Could you give me your opinion?\n\nThanks,\n\nNathann",
    "created_at": "2015-11-12T17:40:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264482",
    "user": "https://github.com/nathanncohen"
}
```

Hello Frédéric,

I read in the paper that the order in which the replacements are performed did not matter (page 7, right before 'balanced trees').

I tried to simplify the code a bit, and ended up with the commit I just pushed to this ticket's public branch. Could you give me your opinion?

Thanks,

Nathann



---

archive/issue_comments_264483.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-12T17:40:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264483",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_264484.json:
```json
{
    "body": "ok, it suits me. As far as I can tell, this is good to go\n\nThe resulting graphs can be nicely displayed by Ivan Kuckir graph viewer.",
    "created_at": "2015-11-12T19:22:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264484",
    "user": "https://github.com/fchapoton"
}
```

ok, it suits me. As far as I can tell, this is good to go

The resulting graphs can be nicely displayed by Ivan Kuckir graph viewer.



---

archive/issue_comments_264485.json:
```json
{
    "body": "> ok, it suits me. As far as I can tell, this is good to go\n\nOkay. I'll do a final check once at home and it will probably be reviewed tonight.\n\n> The resulting graphs can be nicely displayed by Ivan Kuckir graph viewer.\n\nWhat is that?\n\nNathann",
    "created_at": "2015-11-12T19:25:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264485",
    "user": "https://github.com/nathanncohen"
}
```

> ok, it suits me. As far as I can tell, this is good to go

Okay. I'll do a final check once at home and it will probably be reviewed tonight.

> The resulting graphs can be nicely displayed by Ivan Kuckir graph viewer.

What is that?

Nathann



---

archive/issue_comments_264486.json:
```json
{
    "body": "> > The resulting graphs can be nicely displayed by Ivan Kuckir graph viewer.\n> \n> What is that?\n\n#13418",
    "created_at": "2015-11-12T19:35:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264486",
    "user": "https://github.com/fchapoton"
}
```

> > The resulting graphs can be nicely displayed by Ivan Kuckir graph viewer.
> 
> What is that?

#13418



---

archive/issue_comments_264487.json:
```json
{
    "body": "Don't you want to help me improve 'g.show(method='js')' instead? I am tring to add a zooming feature right now. It already works in d3.js but I'm not exactly a js expert.\n\nNathann",
    "created_at": "2015-11-12T19:37:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264487",
    "user": "https://github.com/nathanncohen"
}
```

Don't you want to help me improve 'g.show(method='js')' instead? I am tring to add a zooming feature right now. It already works in d3.js but I'm not exactly a js expert.

Nathann



---

archive/issue_comments_264488.json:
```json
{
    "body": "Errrrrrr... Don't know if it is my fault, but I just noticed that `:-P`\n\n\n```\nsage: print graphs.RandomTriangulation(7).vertices()\n[0, 1, 2, 3, 4, 'a', 'b', ('in', 0), ('in', 1), ('in', 2), ('in', 3), ('in', 4)]\n```\n\n\nNathann",
    "created_at": "2015-11-13T10:16:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264488",
    "user": "https://github.com/nathanncohen"
}
```

Errrrrrr... Don't know if it is my fault, but I just noticed that `:-P`


```
sage: print graphs.RandomTriangulation(7).vertices()
[0, 1, 2, 3, 4, 'a', 'b', ('in', 0), ('in', 1), ('in', 2), ('in', 3), ('in', 4)]
```


Nathann



---

archive/issue_comments_264489.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-13T10:42:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264489",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_264490.json:
```json
{
    "body": "Arg... Sorry sorry, I was about to push it but I am currently experimenting with the distribution, to check if everything is 'uniform as expected'. It was my fault, and I did not expect you to fix it for me `^^;`",
    "created_at": "2015-11-13T10:44:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264490",
    "user": "https://github.com/nathanncohen"
}
```

Arg... Sorry sorry, I was about to push it but I am currently experimenting with the distribution, to check if everything is 'uniform as expected'. It was my fault, and I did not expect you to fix it for me `^^;`



---

archive/issue_comments_264491.json:
```json
{
    "body": "Hmmmmmmm... Okay okay. From looking at the distribution I can't say that I quite like it, but then I forgot too much about statistics to prove it in any way `:-/`\n\nNathann",
    "created_at": "2015-11-13T10:53:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264491",
    "user": "https://github.com/nathanncohen"
}
```

Hmmmmmmm... Okay okay. From looking at the distribution I can't say that I quite like it, but then I forgot too much about statistics to prove it in any way `:-/`

Nathann



---

archive/issue_comments_264492.json:
```json
{
    "body": "The distribution is not exactly uniform, because it is uniform for \"rooted\" triangulations, and the presence of automorphisms breaks the uniformity. But in the large size limit, only a negligible number of triangulations do have automorphisms, so this becomes a better and better approx to uniform distribution.",
    "created_at": "2015-11-13T10:56:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264492",
    "user": "https://github.com/fchapoton"
}
```

The distribution is not exactly uniform, because it is uniform for "rooted" triangulations, and the presence of automorphisms breaks the uniformity. But in the large size limit, only a negligible number of triangulations do have automorphisms, so this becomes a better and better approx to uniform distribution.



---

archive/issue_comments_264493.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-13T11:13:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264493",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_264494.json:
```json
{
    "body": "If you don't see anything wrong in this last commit, you can set the ticket to `positive_review`. Thanks!\n\nNathann",
    "created_at": "2015-11-13T11:13:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264494",
    "user": "https://github.com/nathanncohen"
}
```

If you don't see anything wrong in this last commit, you can set the ticket to `positive_review`. Thanks!

Nathann



---

archive/issue_comments_264495.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-13T11:15:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264495",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_264496.json:
```json
{
    "body": "ok, let it be. Thanks a lot for your collaboration.",
    "created_at": "2015-11-13T11:16:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264496",
    "user": "https://github.com/fchapoton"
}
```

ok, let it be. Thanks a lot for your collaboration.



---

archive/issue_comments_264497.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-11-13T11:16:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264497",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_264498.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-11-16T01:35:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264498",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_264499.json:
```json
{
    "body": "Merge conflict, try again with the next beta",
    "created_at": "2015-11-16T01:35:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264499",
    "user": "https://github.com/vbraun"
}
```

Merge conflict, try again with the next beta



---

archive/issue_comments_264500.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-23T08:25:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264500",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_264501.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2015-11-23T08:26:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264501",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_events_018378.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-11-24T13:01:26Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19283#event-18378"
}
```



---

archive/issue_comments_264502.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-11-24T13:01:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19283#issuecomment-264502",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
