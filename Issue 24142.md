# Issue 24142: Matplotlib on Python 2 bugs out when there are non-ASCII characters in user's home directory

archive/issues_024142.json:
```json
{
    "body": "CC:  @slel epalezzato\n\nThe `matplotlib/__init__.py` module contains `from __future__ import unicode_literals` which is often inadvisable, as it can run afoul of some of Python's own unicode bugs.\n\nIn particular at one point it calls `os.path.expanduser('~')`, where because of `unicode_literals` this becomes `os.path.expanduser(u'~')`.  This does not take care to decode the results of `os.environ['HOME']` (assuming it is ASCII), and ends up concatenating a unicode string with a non-unicode string, which means trying to first decoded the non-unicode string with the default (ASCII) encoding.\n\nThis is a bug in matplotlib but it affects Sage users, particularly on Windows where non-ASCII usernames are more common (may also affect OSX users): https://ask.sagemath.org/question/40131/sagemath-80-using-windows-installer\n\nIssue created by migration from https://trac.sagemath.org/ticket/24379\n\n",
    "created_at": "2017-12-15T10:20:06Z",
    "labels": [
        "component: packages: standard",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Matplotlib on Python 2 bugs out when there are non-ASCII characters in user's home directory",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24142",
    "user": "https://github.com/embray"
}
```
CC:  @slel epalezzato

The `matplotlib/__init__.py` module contains `from __future__ import unicode_literals` which is often inadvisable, as it can run afoul of some of Python's own unicode bugs.

In particular at one point it calls `os.path.expanduser('~')`, where because of `unicode_literals` this becomes `os.path.expanduser(u'~')`.  This does not take care to decode the results of `os.environ['HOME']` (assuming it is ASCII), and ends up concatenating a unicode string with a non-unicode string, which means trying to first decoded the non-unicode string with the default (ASCII) encoding.

This is a bug in matplotlib but it affects Sage users, particularly on Windows where non-ASCII usernames are more common (may also affect OSX users): https://ask.sagemath.org/question/40131/sagemath-80-using-windows-installer

Issue created by migration from https://trac.sagemath.org/ticket/24379





---

archive/issue_comments_338042.json:
```json
{
    "body": "It looks like it is still present in the latest release (2.1.0), for which I have been working on an upgrade at #23696.\n\n```\nfrom __future__ import (absolute_import, division, print_function,\n                        unicode_literals)\n```\n",
    "created_at": "2017-12-15T18:03:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24142#issuecomment-338042",
    "user": "https://github.com/kiwifb"
}
```

It looks like it is still present in the latest release (2.1.0), for which I have been working on an upgrade at #23696.

```
from __future__ import (absolute_import, division, print_function,
                        unicode_literals)
```




---

archive/issue_comments_338043.json:
```json
{
    "body": "This should be solved by upgrading to matplotlib 2.2.2 which has the upstream fix.",
    "created_at": "2018-06-29T14:12:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24142#issuecomment-338043",
    "user": "https://trac.sagemath.org/admin/accounts/users/epalezzato"
}
```

This should be solved by upgrading to matplotlib 2.2.2 which has the upstream fix.



---

archive/issue_comments_338044.json:
```json
{
    "body": "Changing keywords from \"\" to \"matplotlib, days94\".",
    "created_at": "2018-06-29T14:12:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24142#issuecomment-338044",
    "user": "https://trac.sagemath.org/admin/accounts/users/epalezzato"
}
```

Changing keywords from "" to "matplotlib, days94".



---

archive/issue_comments_338045.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-10-31T00:48:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24142#issuecomment-338045",
    "user": "https://github.com/kiwifb"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_338046.json:
```json
{
    "body": "This is arguably fixed by #25702 (upgrade to MPL 2.2.2 with the fix).",
    "created_at": "2018-10-31T00:48:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24142#issuecomment-338046",
    "user": "https://github.com/kiwifb"
}
```

This is arguably fixed by #25702 (upgrade to MPL 2.2.2 with the fix).



---

archive/issue_events_022563.json:
```json
{
    "actor": "@embray",
    "created_at": "2018-10-31T12:07:09Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24142",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24142#event-22563"
}
```



---

archive/issue_comments_338047.json:
```json
{
    "body": "Yep; IIRC this was fixed, thanks for the triaging.",
    "created_at": "2018-10-31T12:07:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24142#issuecomment-338047",
    "user": "https://github.com/embray"
}
```

Yep; IIRC this was fixed, thanks for the triaging.



---

archive/issue_comments_338048.json:
```json
{
    "body": "Resolution: worksforme",
    "created_at": "2018-10-31T12:07:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24142#issuecomment-338048",
    "user": "https://github.com/embray"
}
```

Resolution: worksforme
