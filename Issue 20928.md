# Issue 20928: Various cleanup and deprecation in `sage.coding.linear_code`

archive/issues_020928.json:
```json
{
    "body": "CC:  dlucas\n\nKeywords: cleanup\n\n`sage.coding.linear_code` has a number of global functions and class methods which are badly named, badly documented, badly placed or badly conceived. This ticket takes some steps towards cleaning up. I'll update the ticket description once the full extend is clear.\n\nIssue created by migration from https://trac.sagemath.org/ticket/21165\n\n",
    "created_at": "2016-08-04T09:08:34Z",
    "labels": [
        "coding theory",
        "major",
        "enhancement"
    ],
    "title": "Various cleanup and deprecation in `sage.coding.linear_code`",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20928",
    "user": "jsrn"
}
```
CC:  dlucas

Keywords: cleanup

`sage.coding.linear_code` has a number of global functions and class methods which are badly named, badly documented, badly placed or badly conceived. This ticket takes some steps towards cleaning up. I'll update the ticket description once the full extend is clear.

Issue created by migration from https://trac.sagemath.org/ticket/21165





---

archive/issue_comments_289413.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-04T16:09:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20928#issuecomment-289413",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_289414.json:
```json
{
    "body": "OK, I think I'm done for the moment. The diff touches many lines in many files, but most of those changes are trivial renaming. Substantial changes occurred in `linear_code.py`, `databases.py` and `code_constructions.py`.",
    "created_at": "2016-08-04T16:12:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20928#issuecomment-289414",
    "user": "jsrn"
}
```

OK, I think I'm done for the moment. The diff touches many lines in many files, but most of those changes are trivial renaming. Substantial changes occurred in `linear_code.py`, `databases.py` and `code_constructions.py`.



---

archive/issue_comments_289415.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-08-04T16:12:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20928#issuecomment-289415",
    "user": "jsrn"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_289416.json:
```json
{
    "body": "Forgot to add that I merged in #20835 since I modified some doctests to use the systematic generator matrix.",
    "created_at": "2016-08-05T06:00:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20928#issuecomment-289416",
    "user": "jsrn"
}
```

Forgot to add that I merged in #20835 since I modified some doctests to use the systematic generator matrix.



---

archive/issue_comments_289417.json:
```json
{
    "body": "Hello,\n\nThanks for cleaning up all this!\n\nI only have a couple of remarks:\n\n- There's a lone import statement at the bottom of `databases.py`. Is there any reason why it's here and not at the top of this file with the others?\n\n- Same file, the first two methods do not have an `INPUT` block, while they do have some input arguments.\n\nOtherwise, tests pass and documentation builds, everything seems to be properly deprecated, I agree with your changes.\n\nBTW, it was not merging with the latest beta, fixed this and pushed my change.\n\nBest,\n\nDavid\n----\nNew commits:",
    "created_at": "2016-08-17T10:44:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20928#issuecomment-289417",
    "user": "dlucas"
}
```

Hello,

Thanks for cleaning up all this!

I only have a couple of remarks:

- There's a lone import statement at the bottom of `databases.py`. Is there any reason why it's here and not at the top of this file with the others?

- Same file, the first two methods do not have an `INPUT` block, while they do have some input arguments.

Otherwise, tests pass and documentation builds, everything seems to be properly deprecated, I agree with your changes.

BTW, it was not merging with the latest beta, fixed this and pushed my change.

Best,

David
----
New commits:



---

archive/issue_comments_289418.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-18T09:38:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20928#issuecomment-289418",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_289419.json:
```json
{
    "body": "Replying to [comment:7 dlucas]:\n> - There's a lone import statement at the bottom of `databases.py`. Is there any reason why it's here and not at the top of this file with the others?\n\nIt's not there to make the functional available to code in the module, but rather to make the function available on the command line as `codes.databases.<tab>`.\n\nHowever, your comment made me realise that all the global imports at the top of `databases.py` are also present in that tab-completion. So now I've localised all of those.\n\n> - Same file, the first two methods do not have an `INPUT` block, while they do have some input arguments.\n\nI've added it.\n\n\n> Otherwise, tests pass and documentation builds, everything seems to be properly deprecated, I agree with your changes.\n\nBe aware that many of the tests in `databases.py` require the spkg\n`gap_packages` or `internet`, and are not run by default with `./sage -t`. I\nhad forgotten this myself, but now made them run and fixed some import bugs.\n\n> BTW, it was not merging with the latest beta, fixed this and pushed my change.\n\nThanks, and thanks for reviewing.\n\nBest,\nJohan",
    "created_at": "2016-08-18T09:41:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20928#issuecomment-289419",
    "user": "jsrn"
}
```

Replying to [comment:7 dlucas]:
> - There's a lone import statement at the bottom of `databases.py`. Is there any reason why it's here and not at the top of this file with the others?

It's not there to make the functional available to code in the module, but rather to make the function available on the command line as `codes.databases.<tab>`.

However, your comment made me realise that all the global imports at the top of `databases.py` are also present in that tab-completion. So now I've localised all of those.

> - Same file, the first two methods do not have an `INPUT` block, while they do have some input arguments.

I've added it.


> Otherwise, tests pass and documentation builds, everything seems to be properly deprecated, I agree with your changes.

Be aware that many of the tests in `databases.py` require the spkg
`gap_packages` or `internet`, and are not run by default with `./sage -t`. I
had forgotten this myself, but now made them run and fixed some import bugs.

> BTW, it was not merging with the latest beta, fixed this and pushed my change.

Thanks, and thanks for reviewing.

Best,
Johan



---

archive/issue_comments_289420.json:
```json
{
    "body": "Hello,\n\nJust found a broken doctest in one of the thematic tutorials (forgot to test that yesterday).\nIt was a trivial deprecation, fixed it myself and pushed the related change.\nI'm fine with this ticket, so if you're fine with my change, you can set this ticket to positive\nreview.\n\nDavid\n----\nNew commits:",
    "created_at": "2016-08-18T11:13:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20928#issuecomment-289420",
    "user": "dlucas"
}
```

Hello,

Just found a broken doctest in one of the thematic tutorials (forgot to test that yesterday).
It was a trivial deprecation, fixed it myself and pushed the related change.
I'm fine with this ticket, so if you're fine with my change, you can set this ticket to positive
review.

David
----
New commits:



---

archive/issue_comments_289421.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-08-18T18:01:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20928#issuecomment-289421",
    "user": "jsrn"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_289422.json:
```json
{
    "body": "Great! Thanks a lot.",
    "created_at": "2016-08-18T18:01:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20928#issuecomment-289422",
    "user": "jsrn"
}
```

Great! Thanks a lot.



---

archive/issue_comments_289423.json:
```json
{
    "body": "\n```\nsage -t --long src/sage/categories/homset.py  # 3 doctests failed\nsage -t --long src/sage/structure/coerce.pyx  # 1 doctest failed\n```\n",
    "created_at": "2016-08-20T14:03:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20928#issuecomment-289423",
    "user": "vbraun"
}
```


```
sage -t --long src/sage/categories/homset.py  # 3 doctests failed
sage -t --long src/sage/structure/coerce.pyx  # 1 doctest failed
```




---

archive/issue_comments_289424.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-08-20T14:03:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20928#issuecomment-289424",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_289425.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-08-20T19:05:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20928#issuecomment-289425",
    "user": "jsrn"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_289426.json:
```json
{
    "body": "Fixed. Sorry for not testing: I believed the changes to be completely local to `sage.coding`. The errors occurred because some of the changes means that certain computations are no longer done at Sage start-up: these initialised `GF(2)` which meant that e.g. the garbage collector always knew of `GF(2)`.",
    "created_at": "2016-08-20T19:05:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20928#issuecomment-289426",
    "user": "jsrn"
}
```

Fixed. Sorry for not testing: I believed the changes to be completely local to `sage.coding`. The errors occurred because some of the changes means that certain computations are no longer done at Sage start-up: these initialised `GF(2)` which meant that e.g. the garbage collector always knew of `GF(2)`.



---

archive/issue_comments_289427.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-08-21T15:20:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20928#issuecomment-289427",
    "user": "dlucas"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_289428.json:
```json
{
    "body": "Bug fixed, doctests pass, I set this ticket to `positive_review`.",
    "created_at": "2016-08-21T15:20:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20928#issuecomment-289428",
    "user": "dlucas"
}
```

Bug fixed, doctests pass, I set this ticket to `positive_review`.



---

archive/issue_comments_289429.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-08-23T22:01:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20928#issuecomment-289429",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_289430.json:
```json
{
    "body": "\n```\nsage -t --long src/doc/en/thematic_tutorials/coding_theory.rst\n**********************************************************************\nFile \"src/doc/en/thematic_tutorials/coding_theory.rst\", line 547, in doc.en.thematic_tutorials.coding_theory\nFailed example:\n    C = codes.RandomLinearCode(10, 5, GF(7))\nExpected nothing\nGot:\n    doctest:warning\n      File \"/home/buildbot/slave/sage_git/build/src/bin/sage-runtests\", line 89, in <module>\n        err = DC.run()\n      File \"/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/control.py\", line 1130, in run\n        self.run_doctests()\n      File \"/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/control.py\", line 854, in run_doctests\n        self.dispatcher.dispatch()\n      File \"/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1698, in dispatch\n        self.parallel_dispatch()\n      File \"/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1588, in parallel_dispatch\n        w.start()  # This might take some time\n      File \"/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1864, in start\n        super(DocTestWorker, self).start()\n      File \"/home/buildbot/slave/sage_git/build/local/lib/python/multiprocessing/process.py\", line 130, in start\n        self._popen = Popen(self)\n      File \"/home/buildbot/slave/sage_git/build/local/lib/python/multiprocessing/forking.py\", line 126, in __init__\n        code = process_obj._bootstrap()\n      File \"/home/buildbot/slave/sage_git/build/local/lib/python/multiprocessing/process.py\", line 258, in _bootstrap\n        self.run()\n      File \"/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1837, in run\n        task(self.options, self.outtmpfile, msgpipe, self.result_queue)\n      File \"/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 2130, in __call__\n        runner.run(test)\n      File \"/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 636, in run\n        return self._run(test, compileflags, out)\n      File \"/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 498, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 861, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest doc.en.thematic_tutorials.coding_theory[76]>\", line 1, in <module>\n        C = codes.RandomLinearCode(Integer(10), Integer(5), GF(Integer(7)))\n      File \"/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/coding/code_constructions.py\", line 1052, in RandomLinearCode\n        deprecation(21165, \"codes.RandomLinearCode(n, k, F) is deprecated. Please use codes.random_linear_code(F, n, k) instead\")\n      File \"/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/misc/superseded.py\", line 100, in deprecation\n        warning(trac_number, message, DeprecationWarning, stacklevel)\n      File \"/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/misc/superseded.py\", line 141, in warning\n        warn(message, warning_class, stacklevel)\n    :\n    DeprecationWarning: codes.RandomLinearCode(n, k, F) is deprecated. Please use codes.random_linear_code(F, n, k) instead\n    See http://trac.sagemath.org/21165 for details.\n**********************************************************************\n1 item had failures:\n   1 of  80 in doc.en.thematic_tutorials.coding_theory\n    [79 tests, 1 failure, 0.59 s]\n```\n",
    "created_at": "2016-08-23T22:01:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20928#issuecomment-289430",
    "user": "vbraun"
}
```


```
sage -t --long src/doc/en/thematic_tutorials/coding_theory.rst
**********************************************************************
File "src/doc/en/thematic_tutorials/coding_theory.rst", line 547, in doc.en.thematic_tutorials.coding_theory
Failed example:
    C = codes.RandomLinearCode(10, 5, GF(7))
Expected nothing
Got:
    doctest:warning
      File "/home/buildbot/slave/sage_git/build/src/bin/sage-runtests", line 89, in <module>
        err = DC.run()
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/control.py", line 1130, in run
        self.run_doctests()
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/control.py", line 854, in run_doctests
        self.dispatcher.dispatch()
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1698, in dispatch
        self.parallel_dispatch()
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1588, in parallel_dispatch
        w.start()  # This might take some time
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1864, in start
        super(DocTestWorker, self).start()
      File "/home/buildbot/slave/sage_git/build/local/lib/python/multiprocessing/process.py", line 130, in start
        self._popen = Popen(self)
      File "/home/buildbot/slave/sage_git/build/local/lib/python/multiprocessing/forking.py", line 126, in __init__
        code = process_obj._bootstrap()
      File "/home/buildbot/slave/sage_git/build/local/lib/python/multiprocessing/process.py", line 258, in _bootstrap
        self.run()
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1837, in run
        task(self.options, self.outtmpfile, msgpipe, self.result_queue)
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 2130, in __call__
        runner.run(test)
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 636, in run
        return self._run(test, compileflags, out)
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 498, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 861, in compile_and_execute
        exec(compiled, globs)
      File "<doctest doc.en.thematic_tutorials.coding_theory[76]>", line 1, in <module>
        C = codes.RandomLinearCode(Integer(10), Integer(5), GF(Integer(7)))
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/coding/code_constructions.py", line 1052, in RandomLinearCode
        deprecation(21165, "codes.RandomLinearCode(n, k, F) is deprecated. Please use codes.random_linear_code(F, n, k) instead")
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/misc/superseded.py", line 100, in deprecation
        warning(trac_number, message, DeprecationWarning, stacklevel)
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/misc/superseded.py", line 141, in warning
        warn(message, warning_class, stacklevel)
    :
    DeprecationWarning: codes.RandomLinearCode(n, k, F) is deprecated. Please use codes.random_linear_code(F, n, k) instead
    See http://trac.sagemath.org/21165 for details.
**********************************************************************
1 item had failures:
   1 of  80 in doc.en.thematic_tutorials.coding_theory
    [79 tests, 1 failure, 0.59 s]
```




---

archive/issue_comments_289431.json:
```json
{
    "body": "Hello,\n\nFixed.\nOr, to be more specific, I already fixed it. Commit [189d8e5](https://git.sagemath.org/sage.git/commit?id=189d8e59744914fb14ff052436f53e59f3cb2927).\nI pushed my branch once again, hopefully it will work this time.\n\nBTW, I don't know what happened.\n`git trac pull 21165` returned `already up-to-date with u/jsrn/21165_linear_code_cleanup`.\nWhich explains why I did not catch that failing doctest: it's fixed on my side...\n\n\nDavid\n----\nNew commits:",
    "created_at": "2016-08-24T13:51:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20928#issuecomment-289431",
    "user": "dlucas"
}
```

Hello,

Fixed.
Or, to be more specific, I already fixed it. Commit [189d8e5](https://git.sagemath.org/sage.git/commit?id=189d8e59744914fb14ff052436f53e59f3cb2927).
I pushed my branch once again, hopefully it will work this time.

BTW, I don't know what happened.
`git trac pull 21165` returned `already up-to-date with u/jsrn/21165_linear_code_cleanup`.
Which explains why I did not catch that failing doctest: it's fixed on my side...


David
----
New commits:



---

archive/issue_comments_289432.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-08-24T13:53:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20928#issuecomment-289432",
    "user": "dlucas"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_289433.json:
```json
{
    "body": "Tests pass now.",
    "created_at": "2016-08-25T08:50:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20928#issuecomment-289433",
    "user": "jsrn"
}
```

Tests pass now.



---

archive/issue_comments_289434.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-08-25T08:50:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20928#issuecomment-289434",
    "user": "jsrn"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_289435.json:
```json
{
    "body": "Changing keywords from \"cleanup\" to \"cleanup, sd75\".",
    "created_at": "2016-08-25T08:50:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20928#issuecomment-289435",
    "user": "jsrn"
}
```

Changing keywords from "cleanup" to "cleanup, sd75".



---

archive/issue_comments_289436.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-08-27T08:38:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20928",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20928#issuecomment-289436",
    "user": "vbraun"
}
```

Resolution: fixed
