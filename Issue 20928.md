# Issue 20928: Various cleanup and deprecation in `sage.coding.linear_code`

Issue created by migration from Trac.

Original creator: jsrn

Original creation time: 2016-08-04 09:08:34

CC:  dlucas

Keywords: cleanup

`sage.coding.linear_code` has a number of global functions and class methods which are badly named, badly documented, badly placed or badly conceived. This ticket takes some steps towards cleaning up. I'll update the ticket description once the full extend is clear.


---

Comment by git created at 2016-08-04 16:09:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jsrn created at 2016-08-04 16:12:51

OK, I think I'm done for the moment. The diff touches many lines in many files, but most of those changes are trivial renaming. Substantial changes occurred in `linear_code.py`, `databases.py` and `code_constructions.py`.


---

Comment by jsrn created at 2016-08-04 16:12:51

Changing status from new to needs_review.


---

Comment by jsrn created at 2016-08-05 06:00:56

Forgot to add that I merged in #20835 since I modified some doctests to use the systematic generator matrix.


---

Comment by dlucas created at 2016-08-17 10:44:41

Hello,

Thanks for cleaning up all this!

I only have a couple of remarks:

- There's a lone import statement at the bottom of `databases.py`. Is there any reason why it's here and not at the top of this file with the others?

- Same file, the first two methods do not have an `INPUT` block, while they do have some input arguments.

Otherwise, tests pass and documentation builds, everything seems to be properly deprecated, I agree with your changes.

BTW, it was not merging with the latest beta, fixed this and pushed my change.

Best,

David
----
New commits:


---

Comment by git created at 2016-08-18 09:38:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jsrn created at 2016-08-18 09:41:43

Replying to [comment:7 dlucas]:
> - There's a lone import statement at the bottom of `databases.py`. Is there any reason why it's here and not at the top of this file with the others?

It's not there to make the functional available to code in the module, but rather to make the function available on the command line as `codes.databases.<tab>`.

However, your comment made me realise that all the global imports at the top of `databases.py` are also present in that tab-completion. So now I've localised all of those.

> - Same file, the first two methods do not have an `INPUT` block, while they do have some input arguments.

I've added it.


> Otherwise, tests pass and documentation builds, everything seems to be properly deprecated, I agree with your changes.

Be aware that many of the tests in `databases.py` require the spkg
`gap_packages` or `internet`, and are not run by default with `./sage -t`. I
had forgotten this myself, but now made them run and fixed some import bugs.

> BTW, it was not merging with the latest beta, fixed this and pushed my change.

Thanks, and thanks for reviewing.

Best,
Johan


---

Comment by dlucas created at 2016-08-18 11:13:10

Hello,

Just found a broken doctest in one of the thematic tutorials (forgot to test that yesterday).
It was a trivial deprecation, fixed it myself and pushed the related change.
I'm fine with this ticket, so if you're fine with my change, you can set this ticket to positive
review.

David
----
New commits:


---

Comment by jsrn created at 2016-08-18 18:01:13

Changing status from needs_review to positive_review.


---

Comment by jsrn created at 2016-08-18 18:01:13

Great! Thanks a lot.


---

Comment by vbraun created at 2016-08-20 14:03:47


```
sage -t --long src/sage/categories/homset.py  # 3 doctests failed
sage -t --long src/sage/structure/coerce.pyx  # 1 doctest failed
```



---

Comment by vbraun created at 2016-08-20 14:03:47

Changing status from positive_review to needs_work.


---

Comment by jsrn created at 2016-08-20 19:05:56

Changing status from needs_work to needs_review.


---

Comment by jsrn created at 2016-08-20 19:05:56

Fixed. Sorry for not testing: I believed the changes to be completely local to `sage.coding`. The errors occurred because some of the changes means that certain computations are no longer done at Sage start-up: these initialised `GF(2)` which meant that e.g. the garbage collector always knew of `GF(2)`.


---

Comment by dlucas created at 2016-08-21 15:20:29

Changing status from needs_review to positive_review.


---

Comment by dlucas created at 2016-08-21 15:20:29

Bug fixed, doctests pass, I set this ticket to `positive_review`.


---

Comment by vbraun created at 2016-08-23 22:01:54

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2016-08-23 22:01:54


```
sage -t --long src/doc/en/thematic_tutorials/coding_theory.rst
**********************************************************************
File "src/doc/en/thematic_tutorials/coding_theory.rst", line 547, in doc.en.thematic_tutorials.coding_theory
Failed example:
    C = codes.RandomLinearCode(10, 5, GF(7))
Expected nothing
Got:
    doctest:warning
      File "/home/buildbot/slave/sage_git/build/src/bin/sage-runtests", line 89, in <module>
        err = DC.run()
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/control.py", line 1130, in run
        self.run_doctests()
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/control.py", line 854, in run_doctests
        self.dispatcher.dispatch()
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1698, in dispatch
        self.parallel_dispatch()
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1588, in parallel_dispatch
        w.start()  # This might take some time
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1864, in start
        super(DocTestWorker, self).start()
      File "/home/buildbot/slave/sage_git/build/local/lib/python/multiprocessing/process.py", line 130, in start
        self._popen = Popen(self)
      File "/home/buildbot/slave/sage_git/build/local/lib/python/multiprocessing/forking.py", line 126, in __init__
        code = process_obj._bootstrap()
      File "/home/buildbot/slave/sage_git/build/local/lib/python/multiprocessing/process.py", line 258, in _bootstrap
        self.run()
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1837, in run
        task(self.options, self.outtmpfile, msgpipe, self.result_queue)
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 2130, in __call__
        runner.run(test)
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 636, in run
        return self._run(test, compileflags, out)
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 498, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 861, in compile_and_execute
        exec(compiled, globs)
      File "<doctest doc.en.thematic_tutorials.coding_theory[76]>", line 1, in <module>
        C = codes.RandomLinearCode(Integer(10), Integer(5), GF(Integer(7)))
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/coding/code_constructions.py", line 1052, in RandomLinearCode
        deprecation(21165, "codes.RandomLinearCode(n, k, F) is deprecated. Please use codes.random_linear_code(F, n, k) instead")
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/misc/superseded.py", line 100, in deprecation
        warning(trac_number, message, DeprecationWarning, stacklevel)
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/misc/superseded.py", line 141, in warning
        warn(message, warning_class, stacklevel)
    :
    DeprecationWarning: codes.RandomLinearCode(n, k, F) is deprecated. Please use codes.random_linear_code(F, n, k) instead
    See http://trac.sagemath.org/21165 for details.
**********************************************************************
1 item had failures:
   1 of  80 in doc.en.thematic_tutorials.coding_theory
    [79 tests, 1 failure, 0.59 s]
```



---

Comment by dlucas created at 2016-08-24 13:51:42

Hello,

Fixed.
Or, to be more specific, I already fixed it. Commit [189d8e5](https://git.sagemath.org/sage.git/commit?id=189d8e59744914fb14ff052436f53e59f3cb2927).
I pushed my branch once again, hopefully it will work this time.

BTW, I don't know what happened.
`git trac pull 21165` returned `already up-to-date with u/jsrn/21165_linear_code_cleanup`.
Which explains why I did not catch that failing doctest: it's fixed on my side...


David
----
New commits:


---

Comment by dlucas created at 2016-08-24 13:53:27

Changing status from needs_work to needs_review.


---

Comment by jsrn created at 2016-08-25 08:50:39

Tests pass now.


---

Comment by jsrn created at 2016-08-25 08:50:39

Changing status from needs_review to positive_review.


---

Comment by jsrn created at 2016-08-25 08:50:39

Changing keywords from "cleanup" to "cleanup, sd75".


---

Comment by vbraun created at 2016-08-27 08:38:03

Resolution: fixed
