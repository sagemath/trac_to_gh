# Issue 18360: Implement m-Cambrian lattices (using delta sequences)

archive/issues_018360.json:
```json
{
    "body": "CC:  stumpc5 vivianepons kdilks tscrim\n\nKeywords: sagedays64.5,catalan,coxeter,cambrian\n\nImplement m-Cambrian lattices for a finite Coxeter group W and a Coxeter element c using the description in arXiv:1503.00710 on D. Armstrong's delta sequences.\n\nIssue created by migration from https://trac.sagemath.org/ticket/18597\n\n",
    "created_at": "2015-06-02T23:23:46Z",
    "labels": [
        "combinatorics",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.10",
    "title": "Implement m-Cambrian lattices (using delta sequences)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18360",
    "user": "nathanwilliams"
}
```
CC:  stumpc5 vivianepons kdilks tscrim

Keywords: sagedays64.5,catalan,coxeter,cambrian

Implement m-Cambrian lattices for a finite Coxeter group W and a Coxeter element c using the description in arXiv:1503.00710 on D. Armstrong's delta sequences.

Issue created by migration from https://trac.sagemath.org/ticket/18597





---

archive/issue_comments_249250.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-06-04T20:03:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18360#issuecomment-249250",
    "user": "nathanwilliams"
}
```

New commits:



---

archive/issue_comments_249251.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-04T22:47:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18360#issuecomment-249251",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_249252.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-06-04T22:48:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18360#issuecomment-249252",
    "user": "nathanwilliams"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_249253.json:
```json
{
    "body": "You should not introduce all these trailing whitespaces.\n\nSee what the diff looks like when clicking on the branch name on top of this page.",
    "created_at": "2015-06-05T07:44:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18360#issuecomment-249253",
    "user": "chapoton"
}
```

You should not introduce all these trailing whitespaces.

See what the diff looks like when clicking on the branch name on top of this page.



---

archive/issue_comments_249254.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-06-05T07:44:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18360#issuecomment-249254",
    "user": "chapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_249255.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-05T15:36:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18360#issuecomment-249255",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_249256.json:
```json
{
    "body": "Hello, nice idea to implement these posets.\n\nThe doc of a function must start with a single line looking like\n\n```\nReturn the c-Cambrian lattice on delta sequences.\n```\n\nthen a blank line, then more explanations, and then\n\n```\nINPUT:\n```\n\netc",
    "created_at": "2015-06-05T15:42:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18360#issuecomment-249256",
    "user": "chapoton"
}
```

Hello, nice idea to implement these posets.

The doc of a function must start with a single line looking like

```
Return the c-Cambrian lattice on delta sequences.
```

then a blank line, then more explanations, and then

```
INPUT:
```

etc



---

archive/issue_comments_249257.json:
```json
{
    "body": "Replying to [comment:8 chapoton]:\n> Hello, nice idea to implement these posets.\n> \n> The doc of a function must start with a single line looking like\n> {{{\n> Return the c-Cambrian lattice on delta sequences.\n> }}}\n> then a blank line, then more explanations, and then\n> {{{\n> INPUT:\n> }}}\n> etc\n\nThank you for the clarification.  I will change the order of the documentation in the functions I have implemented.  Note that some previously existing documentation uses a different order (for example, `weak_poset` in `finite_coxeter_groups.py`).",
    "created_at": "2015-06-05T16:09:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18360#issuecomment-249257",
    "user": "nathanwilliams"
}
```

Replying to [comment:8 chapoton]:
> Hello, nice idea to implement these posets.
> 
> The doc of a function must start with a single line looking like
> {{{
> Return the c-Cambrian lattice on delta sequences.
> }}}
> then a blank line, then more explanations, and then
> {{{
> INPUT:
> }}}
> etc

Thank you for the clarification.  I will change the order of the documentation in the functions I have implemented.  Note that some previously existing documentation uses a different order (for example, `weak_poset` in `finite_coxeter_groups.py`).



---

archive/issue_comments_249258.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-05T16:14:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18360#issuecomment-249258",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_249259.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-06-05T16:17:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18360#issuecomment-249259",
    "user": "nathanwilliams"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_249260.json:
```json
{
    "body": "Hi Nathan --\n\nwould you please check what of `src/sage/categories/coxeter_groups.py` you really want in this ticket, you already have the dependency #18610.\n\nBtw that was your first contribution to `Sage` that made its way into main Sage -- congrats!\n\nBeside that, I will do the review today.",
    "created_at": "2015-06-07T11:55:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18360#issuecomment-249260",
    "user": "stumpc5"
}
```

Hi Nathan --

would you please check what of `src/sage/categories/coxeter_groups.py` you really want in this ticket, you already have the dependency #18610.

Btw that was your first contribution to `Sage` that made its way into main Sage -- congrats!

Beside that, I will do the review today.



---

archive/issue_comments_249261.json:
```json
{
    "body": "correct syntax for arxiv links is\n\n\n```\n:arxiv:`1503.00710`\n```\n",
    "created_at": "2015-06-07T19:11:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18360#issuecomment-249261",
    "user": "chapoton"
}
```

correct syntax for arxiv links is


```
:arxiv:`1503.00710`
```




---

archive/issue_comments_249262.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-08T10:56:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18360#issuecomment-249262",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_249263.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-08T10:58:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18360#issuecomment-249263",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_249264.json:
```json
{
    "body": "Left to do:\n\n* recheck that the merge of the two methods worked out (i.e., `@`Nathan please recheck that I did everything right when deleting the cambrian stuff from weyl groups and moved it into coxeter groups\n\n* consider a more intelligent way of accessing roots and their methods from the coxeter groups category. At the moment, Weyl groups have an ElementMethod `reflection_to_root`. I think this should be moved into the parent as this method is only available for reflections, see also #18634 and #18635.\n\n* provide a preprocessing to turn lists into tuples, otherwise, most users will see the error\n\n```\nsage: W = WeylGroup(['A',2])\nsage: W.cambrian_lattice([1,2])\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n...\nTypeError: unhashable type: 'list'\n```\n",
    "created_at": "2015-06-08T11:25:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18360#issuecomment-249264",
    "user": "stumpc5"
}
```

Left to do:

* recheck that the merge of the two methods worked out (i.e., `@`Nathan please recheck that I did everything right when deleting the cambrian stuff from weyl groups and moved it into coxeter groups

* consider a more intelligent way of accessing roots and their methods from the coxeter groups category. At the moment, Weyl groups have an ElementMethod `reflection_to_root`. I think this should be moved into the parent as this method is only available for reflections, see also #18634 and #18635.

* provide a preprocessing to turn lists into tuples, otherwise, most users will see the error

```
sage: W = WeylGroup(['A',2])
sage: W.cambrian_lattice([1,2])
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
...
TypeError: unhashable type: 'list'
```




---

archive/issue_comments_249265.json:
```json
{
    "body": "Christian, maybe we could get rid of the dependency to #11187 ?\n\nThere is currently a problem with the `Twords` dictionary, because its keys are essentially in \n\n`Full MatrixSpace of 2 by 2 sparse matrices over Universal Cyclotomic Field`\n\nbut it is evaluated on some elements\n\n`Full MatrixSpace of 2 by 2 dense matrices over Universal Cyclotomic Field`\n\nTravis, may I ask for your help ?",
    "created_at": "2015-11-01T17:29:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18360#issuecomment-249265",
    "user": "chapoton"
}
```

Christian, maybe we could get rid of the dependency to #11187 ?

There is currently a problem with the `Twords` dictionary, because its keys are essentially in 

`Full MatrixSpace of 2 by 2 sparse matrices over Universal Cyclotomic Field`

but it is evaluated on some elements

`Full MatrixSpace of 2 by 2 dense matrices over Universal Cyclotomic Field`

Travis, may I ask for your help ?



---

archive/issue_comments_249266.json:
```json
{
    "body": "I would think it shouldn't matter for dense versus sparse matrices other than some output, internal storage, and/or speed:\n\n```\nsage: M = matrix(QQ, [[1,2],[0,1]], sparse=True)\nsage: M2 = matrix(QQ, [[1,2],[0,1]], sparse=False)\nsage: M.set_immutable()\nsage: M2.set_immutable()\nsage: M == M2\nTrue\nsage: hash(M) == hash(M2)\nTrue\n```\n\nWhat exactly are the issues you get? I'd guess that the reasons for some of the differences come from some of the matrices that get generated...",
    "created_at": "2015-11-01T17:46:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18360#issuecomment-249266",
    "user": "tscrim"
}
```

I would think it shouldn't matter for dense versus sparse matrices other than some output, internal storage, and/or speed:

```
sage: M = matrix(QQ, [[1,2],[0,1]], sparse=True)
sage: M2 = matrix(QQ, [[1,2],[0,1]], sparse=False)
sage: M.set_immutable()
sage: M2.set_immutable()
sage: M == M2
True
sage: hash(M) == hash(M2)
True
```

What exactly are the issues you get? I'd guess that the reasons for some of the differences come from some of the matrices that get generated...



---

archive/issue_comments_249267.json:
```json
{
    "body": "Well, some (but not all) matrices (in fact matrix group elements) are not recognized as keys, even if they are == to one of the keys of the dict Twords. The hash do not match, so I thought it was because of the sparse versus dense, but maybe it comes from somewhere else..",
    "created_at": "2015-11-01T18:12:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18360#issuecomment-249267",
    "user": "chapoton"
}
```

Well, some (but not all) matrices (in fact matrix group elements) are not recognized as keys, even if they are == to one of the keys of the dict Twords. The hash do not match, so I thought it was because of the sparse versus dense, but maybe it comes from somewhere else..



---

archive/issue_comments_249268.json:
```json
{
    "body": "Here is the problem (sitting on this branch):\n\n```\nsage: a2=CoxeterGroup([\"A\",2])\nsage: [hash(u) for u in a2.simple_reflections()]\n[-6264216653212800886, 172961895888939822]\nsage: [hash(u) for u in a2.reflections_from_w0()]\n[-6264216653212800886, 6091272663176086308, 172961895888939822]\nsage: [hash(u) for u in a2.inversion_sequence([1,2,1])]\n[-3594435451552999106, -3594435451546834518, 3594435451550176244]\nsage: [u for u in a2.inversion_sequence([1,2,1])]\n[\n[-1  1]  [ 0 -1]  [ 1  0]\n[ 0  1], [-1  0], [ 1 -1]\n]\nsage: [u for u in a2.reflections_from_w0()]\n[\n[-1  1]  [ 0 -1]  [ 1  0]\n[ 0  1], [-1  0], [ 1 -1]\n]\nsage: a2.reflections_from_w0()==a2.inversion_sequence([1,2,1])\nTrue\n```\n",
    "created_at": "2015-11-02T16:57:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18360#issuecomment-249268",
    "user": "chapoton"
}
```

Here is the problem (sitting on this branch):

```
sage: a2=CoxeterGroup(["A",2])
sage: [hash(u) for u in a2.simple_reflections()]
[-6264216653212800886, 172961895888939822]
sage: [hash(u) for u in a2.reflections_from_w0()]
[-6264216653212800886, 6091272663176086308, 172961895888939822]
sage: [hash(u) for u in a2.inversion_sequence([1,2,1])]
[-3594435451552999106, -3594435451546834518, 3594435451550176244]
sage: [u for u in a2.inversion_sequence([1,2,1])]
[
[-1  1]  [ 0 -1]  [ 1  0]
[ 0  1], [-1  0], [ 1 -1]
]
sage: [u for u in a2.reflections_from_w0()]
[
[-1  1]  [ 0 -1]  [ 1  0]
[ 0  1], [-1  0], [ 1 -1]
]
sage: a2.reflections_from_w0()==a2.inversion_sequence([1,2,1])
True
```




---

archive/issue_comments_249269.json:
```json
{
    "body": "Here is the core of the problem:\n\n```\nsage: m0=matrix(UniversalCyclotomicField(),2,2,[-1,-1,0,1],sparse=True)\nsage: m1=matrix(UniversalCyclotomicField(),2,2,[-1,-1,0,1],sparse=False)\nsage: m0.set_immutable()\nsage: m1.set_immutable()\nsage: hash(m0)\n6264216653211852203\nsage: hash(m1)\n3594435451553950751\nsage: m0==m1\nTrue\n```\n\nNo problem when using ZZ or QQ instead of UCF though..",
    "created_at": "2015-11-03T10:29:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18360#issuecomment-249269",
    "user": "chapoton"
}
```

Here is the core of the problem:

```
sage: m0=matrix(UniversalCyclotomicField(),2,2,[-1,-1,0,1],sparse=True)
sage: m1=matrix(UniversalCyclotomicField(),2,2,[-1,-1,0,1],sparse=False)
sage: m0.set_immutable()
sage: m1.set_immutable()
sage: hash(m0)
6264216653211852203
sage: hash(m1)
3594435451553950751
sage: m0==m1
True
```

No problem when using ZZ or QQ instead of UCF though..



---

archive/issue_comments_249270.json:
```json
{
    "body": "Maybe due to that difference ?\n\n```\nsage: hash(UniversalCyclotomicField()(0))\n3713081631936575706\nsage: hash(ZZ(0))\n0\nsage: hash(QQ(0))\n0\n```\n",
    "created_at": "2015-11-03T10:56:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18360#issuecomment-249270",
    "user": "chapoton"
}
```

Maybe due to that difference ?

```
sage: hash(UniversalCyclotomicField()(0))
3713081631936575706
sage: hash(ZZ(0))
0
sage: hash(QQ(0))
0
```




---

archive/issue_comments_249271.json:
```json
{
    "body": "I made #19514, but I have not yet checked if that solves the issue here.",
    "created_at": "2015-11-03T11:12:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18360#issuecomment-249271",
    "user": "chapoton"
}
```

I made #19514, but I have not yet checked if that solves the issue here.



---

archive/issue_comments_249272.json:
```json
{
    "body": "It seems to work.",
    "created_at": "2015-11-03T11:15:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18360#issuecomment-249272",
    "user": "chapoton"
}
```

It seems to work.



---

archive/issue_comments_249273.json:
```json
{
    "body": "Now complains about lattice property:\n\n```\nsage: a4=CoxeterGroup([\"A\",4])\nsage: a4.m_cambrian_lattice((4,3,2,1))\n...\nValueError: Not a lattice.\n```\n",
    "created_at": "2015-11-03T11:19:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18360#issuecomment-249273",
    "user": "chapoton"
}
```

Now complains about lattice property:

```
sage: a4=CoxeterGroup(["A",4])
sage: a4.m_cambrian_lattice((4,3,2,1))
...
ValueError: Not a lattice.
```




---

archive/issue_comments_249274.json:
```json
{
    "body": "\n```\nValueError: Not a lattice.\n```\n\nHm, we cannot ignore this :-)",
    "created_at": "2015-11-03T13:07:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18360#issuecomment-249274",
    "user": "stumpc5"
}
```


```
ValueError: Not a lattice.
```

Hm, we cannot ignore this :-)



---

archive/issue_comments_249275.json:
```json
{
    "body": "Fred, as usual I either forget how to use git, or I never knew: Is there a way to merge 6.10.rc0 into this branch without me rebuilding all of sage?",
    "created_at": "2015-11-03T14:03:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18360#issuecomment-249275",
    "user": "stumpc5"
}
```

Fred, as usual I either forget how to use git, or I never knew: Is there a way to merge 6.10.rc0 into this branch without me rebuilding all of sage?



---

archive/issue_comments_249276.json:
```json
{
    "body": "0) I assume the name of the branch 6.10.beta2 is `develop`\n1) `git checkout develop -b my_new_branch`\n2) `git pull trac u/stumpc5/implement_m_cambrian_lattices__using_delta_sequences_`\n(please choose shorter and simpler names for your branches, by the way)\n3) `sage -b`\n\nThe trick is to always start over a copy of the develop branch (step 1) and pull\nyou old branch on that (step 2). Then the new branch created is just a few commits after develop,\nand so should not trigger large-scale re-compilation, if you have compiled the develop branch before.",
    "created_at": "2015-11-03T14:09:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18360#issuecomment-249276",
    "user": "chapoton"
}
```

0) I assume the name of the branch 6.10.beta2 is `develop`
1) `git checkout develop -b my_new_branch`
2) `git pull trac u/stumpc5/implement_m_cambrian_lattices__using_delta_sequences_`
(please choose shorter and simpler names for your branches, by the way)
3) `sage -b`

The trick is to always start over a copy of the develop branch (step 1) and pull
you old branch on that (step 2). Then the new branch created is just a few commits after develop,
and so should not trigger large-scale re-compilation, if you have compiled the develop branch before.



---

archive/issue_comments_249277.json:
```json
{
    "body": "Awesome, thanks!",
    "created_at": "2015-11-03T14:16:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18360#issuecomment-249277",
    "user": "stumpc5"
}
```

Awesome, thanks!



---

archive/issue_comments_249278.json:
```json
{
    "body": "It does work using `WeylGroup(['A',4])` instead. The poset even gives me 48 elts for `CoxeterGroups` rather than the expected 42. I cannot say whether that ever worked, or whether this is some sort of hashing issue... `@`Nathan, could you briefly check for computation issues that might come from left vs. right multiplications ?",
    "created_at": "2015-11-04T10:37:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18360#issuecomment-249278",
    "user": "stumpc5"
}
```

It does work using `WeylGroup(['A',4])` instead. The poset even gives me 48 elts for `CoxeterGroups` rather than the expected 42. I cannot say whether that ever worked, or whether this is some sort of hashing issue... `@`Nathan, could you briefly check for computation issues that might come from left vs. right multiplications ?



---

archive/issue_comments_249279.json:
```json
{
    "body": "Okay, the problem is that `cov_element = sorted(cov_element)` does not turn `cov_element` into some canonical form. So the same element can be found multiple times without recognizing.",
    "created_at": "2015-11-04T20:17:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18360#issuecomment-249279",
    "user": "stumpc5"
}
```

Okay, the problem is that `cov_element = sorted(cov_element)` does not turn `cov_element` into some canonical form. So the same element can be found multiple times without recognizing.



---

archive/issue_comments_249280.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-04T20:35:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18360#issuecomment-249280",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_249281.json:
```json
{
    "body": "I hope to have fixed it -- please have a look, Nathan. The two main changes are: we are now using `sets` so that containment test is faster, and we use `frozensets` for inversion sets. This way we bypass the problem to have somehow sorted lists. This is cleaner and faster anyway...\n\nFred, could you do some tests to see whether you can confirm this bug to be fixed?",
    "created_at": "2015-11-04T20:38:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18360#issuecomment-249281",
    "user": "stumpc5"
}
```

I hope to have fixed it -- please have a look, Nathan. The two main changes are: we are now using `sets` so that containment test is faster, and we use `frozensets` for inversion sets. This way we bypass the problem to have somehow sorted lists. This is cleaner and faster anyway...

Fred, could you do some tests to see whether you can confirm this bug to be fixed?



---

archive/issue_comments_249282.json:
```json
{
    "body": "ok, this looks good to me. \n\nHere is a new branch (on top of 6.10.beta3) where\n\nI have made small changes to the doc, mainly formatting\n\nand also a few changes to the code, for greater clarity.\n\nIf you agree with these changes, you can set to positive review on my behalf.\n----\nNew commits:",
    "created_at": "2015-11-06T13:57:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18360#issuecomment-249282",
    "user": "chapoton"
}
```

ok, this looks good to me. 

Here is a new branch (on top of 6.10.beta3) where

I have made small changes to the doc, mainly formatting

and also a few changes to the code, for greater clarity.

If you agree with these changes, you can set to positive review on my behalf.
----
New commits:



---

archive/issue_comments_249283.json:
```json
{
    "body": "okay, looks good to me, waiting for the patchbot before setting it to positive.",
    "created_at": "2015-11-06T14:03:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18360#issuecomment-249283",
    "user": "stumpc5"
}
```

okay, looks good to me, waiting for the patchbot before setting it to positive.



---

archive/issue_comments_249284.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-11-06T15:30:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18360#issuecomment-249284",
    "user": "chapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_249285.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-11-07T09:34:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18360#issuecomment-249285",
    "user": "vbraun"
}
```

Resolution: fixed
