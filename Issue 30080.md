# Issue 30080: Update pip to 20.2.1, setuptools to 49.2.1

Issue created by migration from https://trac.sagemath.org/ticket/30317

Original creator: mkoeppe

Original creation time: 2020-08-07 21:10:54

CC:  jhpalmieri dimpase

Previous update: #29803 (20.1.1, 47.1.1)


---

Comment by mkoeppe created at 2020-08-07 21:12:07

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2020-08-07 21:12:07

New commits:


---

Comment by git created at 2020-08-28 05:08:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-08-28 05:19:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-08-28 05:20:09

Changing priority from major to critical.


---

Comment by @tobiasdiez created at 2020-08-28 20:40:49

I tried this as recommended in #30459, but it fails with "Error downloading pip-20.2.2.tar.gz" because this version of pip cannot be found on any of the sage mirrors apparently. Do I have to change something before running this branch?

Just out of interest, what is the reason for this spkg infrastructure over say pipenv + pipfile?


---

Comment by mkoeppe created at 2020-08-28 20:51:56

Replying to [comment:7 gh-tobiasdiez]:
> I tried this as recommended in #30459, but it fails with "Error downloading pip-20.2.2.tar.gz" because this version of pip cannot be found on any of the sage mirrors apparently. Do I have to change something before running this branch?

Tickets with package changes need `./configure --enable-download-from-upstream-url` until the ticket has been merged into the next beta (which is when the release manager uploads the tarballs to the mirrors).


---

Comment by mkoeppe created at 2020-08-28 21:02:18

Replying to [comment:7 gh-tobiasdiez]:
> Just out of interest, what is the reason for this spkg infrastructure over say pipenv + pipfile?

If you are asking why we bypass proper package management by pip and install things in the most basic way using `pip --ignore-installed --verbose --no-deps --no-index` (see `build/bin/sage-pip-install`)... let's just say that it is the result of design decisions made a long time ago based on implementation constraints that were valid at that time - but no longer bind us now.

I am hoping that we can make the installation of Python packages more straightforward in the Sage 9.3 cycle. #29500 (Install all Python packages via pip wheel) is a step in this direction.

I haven't looked at pipenv in detail; pipfile looks like it is far from a stable version


---

Comment by @tobiasdiez created at 2020-08-29 09:34:18

After `configure` it downloaded pip. However, the installation failed with the same error as reported in #30459. I also tried to add `with_pip=True` in the constructor argument of EnvBuilder in `sage-venv`, but this script doesn't seem to be triggered at all during a `make`.


Thanks for the explanation. It's interesting to learn more about the inner workings of sage. Pipfile is as stable as pipenv, since the latter uses it heavily. But if I understand it correctly, you are not using a virtual environment for the local python installation, right?


---

Comment by jhpalmieri created at 2020-08-31 21:38:30

Changing status from needs_review to positive_review.


---

Comment by jhpalmieri created at 2020-08-31 21:38:30

Looks like a straightforward update to me. It works for me on OS X. Other issues could be addressed on another ticket: the problems reported by `@`gh-tobiasdiez look like they're independent of the changes here, unless I'm misunderstanding.


---

Comment by mkoeppe created at 2020-08-31 21:40:02

Thanks!


---

Comment by vbraun created at 2020-09-06 21:52:00

Resolution: fixed


---

Comment by slelievre created at 2020-09-26 09:23:16

> 50.0.0 will bring backward-incompatible changes;
> see â€‹https://setuptools.readthedocs.io/en/latest/history.html#v50-0-0

Some if not all these changes are reverted in 50.1.0, 50.2.0, 50.3.0,
see [history](https://setuptools.readthedocs.io/en/latest/history.html).
