# Issue 23299: Transversal Matroids

archive/issues_023299.json:
```json
{
    "body": "CC:  stefan rudi yomcat zgershkoff\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/23536\n\n",
    "created_at": "2017-07-25T00:48:26Z",
    "labels": [
        "component: please change"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.5",
    "title": "Transversal Matroids",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23299",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```
CC:  stefan rudi yomcat zgershkoff



Issue created by migration from https://trac.sagemath.org/ticket/23536





---

archive/issue_comments_325643.json:
```json
{
    "body": "The way I have it currently set up, it builds a digraph from the data after taking a matching and orienting it opposite of everything else, and this is used for finding alternating paths and enabling the basis exchange. I'll upload it as soon as I get git-trac working again.",
    "created_at": "2017-07-25T01:15:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325643",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```

The way I have it currently set up, it builds a digraph from the data after taking a matching and orienting it opposite of everything else, and this is used for finding alternating paths and enabling the basis exchange. I'll upload it as soon as I get git-trac working again.



---

archive/issue_comments_325644.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2017-07-25T01:15:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325644",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_325645.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to matroid theory.",
    "created_at": "2017-07-25T01:15:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325645",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```

Changing component from PLEASE CHANGE to matroid theory.



---

archive/issue_comments_325646.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-07-25T21:59:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325646",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```

New commits:



---

archive/issue_comments_325647.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-31T02:40:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325647",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_325648.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-31T03:45:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325648",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_325649.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-01T00:37:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325649",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_325650.json:
```json
{
    "body": "This is behaving in ways I don't understand. If I add an isolated vertex to the ground set side of the bipartite graph, that should be a loop, but right now it will think that the element is in parallel with something, even though `__is_exchange_pair()` is always `False` no matter what you check it with.\n\nIn exploring this, I discovered a more serious error.\n\n\n```\nsage: G = Graph([('a', 'b'), ('b', 'c')])\nsage: G.add_vertex('d')\nsage: from sage.matroids.transversal_matroid import TransversalMatroid\nsage: M = TransversalMatroid(G, groundset = ['a', 'c', 'd'])\nsage: M.loops()\n```\n\n\nAfter a long traceback, we get this error:\n\n\n```\nValueError: vertex '1' is not in the (di)graph\n```\n\n\nWhy would it be looking for a vertex '1'?",
    "created_at": "2017-08-01T01:14:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325650",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```

This is behaving in ways I don't understand. If I add an isolated vertex to the ground set side of the bipartite graph, that should be a loop, but right now it will think that the element is in parallel with something, even though `__is_exchange_pair()` is always `False` no matter what you check it with.

In exploring this, I discovered a more serious error.


```
sage: G = Graph([('a', 'b'), ('b', 'c')])
sage: G.add_vertex('d')
sage: from sage.matroids.transversal_matroid import TransversalMatroid
sage: M = TransversalMatroid(G, groundset = ['a', 'c', 'd'])
sage: M.loops()
```


After a long traceback, we get this error:


```
ValueError: vertex '1' is not in the (di)graph
```


Why would it be looking for a vertex '1'?



---

archive/issue_comments_325651.json:
```json
{
    "body": "The BasisExchangeMatroid class does an extra round of translation: elements get changed into integers through __pack and __unpack. This ensures elements correspond directly to bits in a bitset.",
    "created_at": "2017-08-01T02:21:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325651",
    "user": "https://trac.sagemath.org/admin/accounts/users/Stefan"
}
```

The BasisExchangeMatroid class does an extra round of translation: elements get changed into integers through __pack and __unpack. This ensures elements correspond directly to bits in a bitset.



---

archive/issue_comments_325652.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-01T02:34:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325652",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_325653.json:
```json
{
    "body": "I found a hint in the BasisMatroid class that `x` refers to the element `e = self._E[x]`. I guess my previous examples worked because my ground set was in a natural bijection with `range(n)`. Maybe I should rewrite it later using bitset commands, but for now I'm just glad it works.",
    "created_at": "2017-08-01T02:36:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325653",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```

I found a hint in the BasisMatroid class that `x` refers to the element `e = self._E[x]`. I guess my previous examples worked because my ground set was in a natural bijection with `range(n)`. Maybe I should rewrite it later using bitset commands, but for now I'm just glad it works.



---

archive/issue_comments_325654.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-01T23:39:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325654",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_325655.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-07T02:23:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325655",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_325656.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-08-07T20:38:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325656",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_325657.json:
```json
{
    "body": "I think it's complete enough to be reviewed now. It lacks a method to give a minimal or maximal presentation, but I think getting a set system to work as input through the constructor is a priority, and that belongs in another ticket.",
    "created_at": "2017-08-07T20:38:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325657",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```

I think it's complete enough to be reviewed now. It lacks a method to give a minimal or maximal presentation, but I think getting a set system to work as input through the constructor is a priority, and that belongs in another ticket.



---

archive/issue_comments_325658.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-07T20:39:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325658",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_325659.json:
```json
{
    "body": "Looks like it timed out as I was pushing an update. It's all there now.\n\nAlso, this will almost certainly conflict with #23139 in a couple of places like unpickling.pyx.",
    "created_at": "2017-08-07T20:44:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325659",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```

Looks like it timed out as I was pushing an update. It's all there now.

Also, this will almost certainly conflict with #23139 in a couple of places like unpickling.pyx.



---

archive/issue_comments_325660.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-07T23:06:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325660",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_325661.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-08T03:38:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325661",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_325662.json:
```json
{
    "body": "Actually, let me think about this a little more before it's reviewed.",
    "created_at": "2017-08-08T04:58:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325662",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```

Actually, let me think about this a little more before it's reviewed.



---

archive/issue_comments_325663.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-08-08T04:58:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325663",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_325664.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-08T21:13:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325664",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_325665.json:
```json
{
    "body": "I can't find a clean algorithmic way to get a minimal presentation, but with `reduce_presentation()`, we at least get a presentation where the number of sets equals the rank.\n\nIt should be a little faster now that the basis exchange computations are done in NetworkX.",
    "created_at": "2017-08-08T21:16:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325665",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```

I can't find a clean algorithmic way to get a minimal presentation, but with `reduce_presentation()`, we at least get a presentation where the number of sets equals the rank.

It should be a little faster now that the basis exchange computations are done in NetworkX.



---

archive/issue_comments_325666.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-08-08T21:16:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325666",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_325667.json:
```json
{
    "body": "Also, the reason I let it assume that the larger side of a `BipartiteGraph` is the ground set is that there's no method to switch the sides, so it would be inefficient to have the constructor take a bipartite graph as input, build a new one, and sent it to `__init__()`. I could rewrite `__init__()` to take a set system instead of a graph, but that should be done in a ticket where these are added to the constructor.",
    "created_at": "2017-08-08T21:24:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325667",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```

Also, the reason I let it assume that the larger side of a `BipartiteGraph` is the ground set is that there's no method to switch the sides, so it would be inefficient to have the constructor take a bipartite graph as input, build a new one, and sent it to `__init__()`. I could rewrite `__init__()` to take a set system instead of a graph, but that should be done in a ticket where these are added to the constructor.



---

archive/issue_comments_325668.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-08T21:25:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325668",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_325669.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-15T02:27:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325669",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_325670.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-08-16T00:05:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325670",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_325671.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-16T00:05:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325671",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_325672.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-16T02:23:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325672",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_325673.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-16T18:44:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325673",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_325674.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-08-16T18:46:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325674",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_325675.json:
```json
{
    "body": "I think it's ready now.",
    "created_at": "2017-08-16T18:46:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325675",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```

I think it's ready now.



---

archive/issue_comments_325676.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-21T01:14:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325676",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_325677.json:
```json
{
    "body": "I can't fix it now because I'm upgrading sage so maybe the documentation will build, but patchbot says there are a couple of problems. I don't know what \"coverage\" is (maybe I just need to rebase) but it looks like there's a python3 compatibility problem because `iteritems()` is deprecated for dictionaries, which should mean it won't work for the `Counter` either.",
    "created_at": "2017-08-23T03:17:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325677",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```

I can't fix it now because I'm upgrading sage so maybe the documentation will build, but patchbot says there are a couple of problems. I don't know what "coverage" is (maybe I just need to rebase) but it looks like there's a python3 compatibility problem because `iteritems()` is deprecated for dictionaries, which should mean it won't work for the `Counter` either.



---

archive/issue_comments_325678.json:
```json
{
    "body": "\"Coverage\" is checking to see if the code has sufficient doctests. I'm not seeing any methods that are missing examples/tests, but maybe since you're defining a class you need to run some sort of testsuite to make sure it's done right?\n\nFor python3 compatibility, I think you just need to change `d.iteritems() -> iter(d.items())`.",
    "created_at": "2017-08-23T04:05:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325678",
    "user": "https://github.com/kevindilks"
}
```

"Coverage" is checking to see if the code has sufficient doctests. I'm not seeing any methods that are missing examples/tests, but maybe since you're defining a class you need to run some sort of testsuite to make sure it's done right?

For python3 compatibility, I think you just need to change `d.iteritems() -> iter(d.items())`.



---

archive/issue_comments_325679.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-25T16:40:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325679",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_325680.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-25T19:15:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325680",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_325681.json:
```json
{
    "body": "I think it was expecting tests on `__translate_matching()` because it was `cpdef`. I changed it to `cdef` because there's no reason for it to be exposed.",
    "created_at": "2017-08-25T19:16:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325681",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```

I think it was expecting tests on `__translate_matching()` because it was `cpdef`. I changed it to `cdef` because there's no reason for it to be exposed.



---

archive/issue_comments_325682.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-09-05T20:12:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325682",
    "user": "https://trac.sagemath.org/admin/accounts/users/msaaltink"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_325683.json:
```json
{
    "body": "This looks pretty good, with good documentation and plenty of tests.  Here are a few small issues I noticed:\n\n1. the documentation for the 'matching' parameter is unclear.\n2. There are no tests for the 'matching' parameter.  There should be a test with matching provided and set_labels not provided (to provoke the error), and some successful cases.\n3. the 'matching' parameter does not seem to be fully checked, e.g.\n\n```\nsage: K = TransversalMatroid([[10,11],[10,12]], set_labels=['x1', 'x2'], matching={10:'x1', 11:'x3'})\nsage: K\nTransversal matroid of rank 2 on 3 elements, with 2 sets.\nsage: list(K.bases())\n[frozenset({10, 11})]\nsage: L = TransversalMatroid([[10,11],[10,12]], set_labels=['x1', 'x2'])\nsage: list(L.bases())\n[frozenset({10, 11}), frozenset({11, 12}), frozenset({10, 12})]\nsage: K == L\nTrue\n```\n\n1. The automatic calculation of set_names can create conflicts that go undetected:\n\n```\nsage: sets = [['s1', 's2'], ['s1', 's3']]\nsage: M = TransversalMatroid(sets); M\nTransversal matroid of rank 2 on 3 elements, with 2 sets.\nsage: M.sets()\n[['s1', 's2'], ['s1', 's3']]\nsage: M.set_labels()\n['s0', 's1']\nsage: M.graph()\nNotImplementedError: Non injective relabeling\n\nsage: M.transversal_extension(sets=['s1'])\nValueError: set labels cannot be element labels\n```\n\n1. Funny things can happen if the constructor is given \"sets\" that are not lists - yet being a list is not tested for.  The class documentation says it should be a \"list of lists\" while the constructor's documentation asks for \"an iterable of iterables\".  Which is it to be?\n\n```\nsage: N = TransversalMatroid(['abc', 'abd', 'cde']); N\nTransversal matroid of rank 3 on 5 elements, with 3 sets.\nsage: Ne = N.transversal_extension(element='f', sets=['s2'])\nTypeError: cannot concatenate 'str' and 'list' objects\n\nsage: N2 = TransversalMatroid(sets=[list('abc'), list('abd'), list('cde')]); N2\nTransversal matroid of rank 3 on 5 elements, with 3 sets.\nsage: N2e = N2.transversal_extension(element='f', sets=['s2']); N2e\nTransversal matroid of rank 3 on 6 elements, with 3 sets.\n```\n\n1. `basis_exchange_matroid.pyx` has some documentation \"``TransversalMatroid`` (not yet implemented) ...\" which should be edited as part of this changeset,\n2. The constructor silently drops empty sets from the given list of sets. Consider:\n\n```\nsage: TransversalMatroid([[], [1]], set_labels=['x', 'y'])\nTransversal matroid of rank 1 on 1 elements, with 1 sets.\nsage: M = _\nsage: M.sets()\n[[1]]\nsage: M.set_labels()\n['x', 'y']\n```\n\nSurely sets and set_labels should have the same length!  And indeed there is trouble in other methods:\n\n```\nsage: M.transversal_extension(element=2, sets=['x'])\nValueError: set labels do not match sets\n```\n\n1. The tests for '_minor' do not cover all cases, e.g., self.corank(contractions) == 0, or\ncontractions without deletions.",
    "created_at": "2017-09-05T20:12:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325683",
    "user": "https://trac.sagemath.org/admin/accounts/users/msaaltink"
}
```

This looks pretty good, with good documentation and plenty of tests.  Here are a few small issues I noticed:

1. the documentation for the 'matching' parameter is unclear.
2. There are no tests for the 'matching' parameter.  There should be a test with matching provided and set_labels not provided (to provoke the error), and some successful cases.
3. the 'matching' parameter does not seem to be fully checked, e.g.

```
sage: K = TransversalMatroid([[10,11],[10,12]], set_labels=['x1', 'x2'], matching={10:'x1', 11:'x3'})
sage: K
Transversal matroid of rank 2 on 3 elements, with 2 sets.
sage: list(K.bases())
[frozenset({10, 11})]
sage: L = TransversalMatroid([[10,11],[10,12]], set_labels=['x1', 'x2'])
sage: list(L.bases())
[frozenset({10, 11}), frozenset({11, 12}), frozenset({10, 12})]
sage: K == L
True
```

1. The automatic calculation of set_names can create conflicts that go undetected:

```
sage: sets = [['s1', 's2'], ['s1', 's3']]
sage: M = TransversalMatroid(sets); M
Transversal matroid of rank 2 on 3 elements, with 2 sets.
sage: M.sets()
[['s1', 's2'], ['s1', 's3']]
sage: M.set_labels()
['s0', 's1']
sage: M.graph()
NotImplementedError: Non injective relabeling

sage: M.transversal_extension(sets=['s1'])
ValueError: set labels cannot be element labels
```

1. Funny things can happen if the constructor is given "sets" that are not lists - yet being a list is not tested for.  The class documentation says it should be a "list of lists" while the constructor's documentation asks for "an iterable of iterables".  Which is it to be?

```
sage: N = TransversalMatroid(['abc', 'abd', 'cde']); N
Transversal matroid of rank 3 on 5 elements, with 3 sets.
sage: Ne = N.transversal_extension(element='f', sets=['s2'])
TypeError: cannot concatenate 'str' and 'list' objects

sage: N2 = TransversalMatroid(sets=[list('abc'), list('abd'), list('cde')]); N2
Transversal matroid of rank 3 on 5 elements, with 3 sets.
sage: N2e = N2.transversal_extension(element='f', sets=['s2']); N2e
Transversal matroid of rank 3 on 6 elements, with 3 sets.
```

1. `basis_exchange_matroid.pyx` has some documentation "``TransversalMatroid`` (not yet implemented) ..." which should be edited as part of this changeset,
2. The constructor silently drops empty sets from the given list of sets. Consider:

```
sage: TransversalMatroid([[], [1]], set_labels=['x', 'y'])
Transversal matroid of rank 1 on 1 elements, with 1 sets.
sage: M = _
sage: M.sets()
[[1]]
sage: M.set_labels()
['x', 'y']
```

Surely sets and set_labels should have the same length!  And indeed there is trouble in other methods:

```
sage: M.transversal_extension(element=2, sets=['x'])
ValueError: set labels do not match sets
```

1. The tests for '_minor' do not cover all cases, e.g., self.corank(contractions) == 0, or
contractions without deletions.



---

archive/issue_comments_325684.json:
```json
{
    "body": "First half of my review:\n\n\n```\nunpickling.pyx:\n\nl. 38 use relative import and cimport, like in the lines above it, for consistency.\n\ntransversal_matroid.pyx:\n\nl. 15 iterable of iterables\nl. 36 All references for matroids go into matroid.pyx. And really, looking at http://doc.sagemath.org/html/en/developer/coding_basics.html#sage-s-master-bibliography-file , should go into the master file.\nl. 103 one missing space, some surplus spaces\nl. 117, 118, 128, 145 missing spaces (please do a full search for such instances, I\u2019m not going to list any more)\nl. 146 no need for the \u201cverbose=True\u201d argument. Just TestSuite(M).run() will do\nl. 159 why do you only keep nonempty sets? I would just keep a list of \"sets\" and add the \"if s\" clause to the end of the next line.\nl. 162 are you sure this labeling is the same as in BasisExchangeMatroid? To fix this, after l. 156, add\n\ngroundset = tuple(groundset)\n\nl. 207, 213, 223: use the self._idx dictionary provided by BasisExchangeMatroid.\n\nThe only reason to build your own element_int_map is to ensure uniqueness of vertex labels between groundset and set_labels. You might consider using something like newlabel() for the set labels and not converting to integers.\n\nl. 213 Would it be possible to add all vertices at once? Depending on data structure, reallocating memory for each vertex can be expensive.\n\nl. 217 same question.\n\nl. 223 same question.\n\nl. 247 range(len(sh[:-1])) makes a whole new list, just to count the length. Better:\n\nrange(len(sh) - 1)\n\nOr even:\n\nsh_edges = [(sh[i], sh[i + 1]) for i in xrange(len(sh) - 1)]\nsh_edges_r = [(sh[i + 1], sh[i]) for i in xrange(len(sh) - 1)]\n\nl. 266 better: len(self._sets_input)\n\nl. 339 Better to compare a frozenset of frozensets. The whole sorted() thing won\u2019t work in Python 3 if the user mixes integers and strings (something I frequently do while working with matroids)\n\nl. 346 Explain how you implemented this.\n\nl. 371 iteritems (and, for that matter, self._E) will assume an ordering of the elements that has no bearing on the underlying matroid. Better to put each in a frozenset so we get set comparisons.\n```\n",
    "created_at": "2017-09-06T14:45:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325684",
    "user": "https://trac.sagemath.org/admin/accounts/users/Stefan"
}
```

First half of my review:


```
unpickling.pyx:

l. 38 use relative import and cimport, like in the lines above it, for consistency.

transversal_matroid.pyx:

l. 15 iterable of iterables
l. 36 All references for matroids go into matroid.pyx. And really, looking at http://doc.sagemath.org/html/en/developer/coding_basics.html#sage-s-master-bibliography-file , should go into the master file.
l. 103 one missing space, some surplus spaces
l. 117, 118, 128, 145 missing spaces (please do a full search for such instances, I’m not going to list any more)
l. 146 no need for the “verbose=True” argument. Just TestSuite(M).run() will do
l. 159 why do you only keep nonempty sets? I would just keep a list of "sets" and add the "if s" clause to the end of the next line.
l. 162 are you sure this labeling is the same as in BasisExchangeMatroid? To fix this, after l. 156, add

groundset = tuple(groundset)

l. 207, 213, 223: use the self._idx dictionary provided by BasisExchangeMatroid.

The only reason to build your own element_int_map is to ensure uniqueness of vertex labels between groundset and set_labels. You might consider using something like newlabel() for the set labels and not converting to integers.

l. 213 Would it be possible to add all vertices at once? Depending on data structure, reallocating memory for each vertex can be expensive.

l. 217 same question.

l. 223 same question.

l. 247 range(len(sh[:-1])) makes a whole new list, just to count the length. Better:

range(len(sh) - 1)

Or even:

sh_edges = [(sh[i], sh[i + 1]) for i in xrange(len(sh) - 1)]
sh_edges_r = [(sh[i + 1], sh[i]) for i in xrange(len(sh) - 1)]

l. 266 better: len(self._sets_input)

l. 339 Better to compare a frozenset of frozensets. The whole sorted() thing won’t work in Python 3 if the user mixes integers and strings (something I frequently do while working with matroids)

l. 346 Explain how you implemented this.

l. 371 iteritems (and, for that matter, self._E) will assume an ordering of the elements that has no bearing on the underlying matroid. Better to put each in a frozenset so we get set comparisons.
```




---

archive/issue_comments_325685.json:
```json
{
    "body": "Second half:\n\n\n```\nl. 456 Better: \"A transversal matroid can be represented as a set system, or as a bipartite graph, with one color class corresponding to the ground set and the other to the sets of the set system. This method returns that bipartite graph.\"\n\nl. 490 I don't think I see the problems that msaaltink pointed out for _minor.\n\nl. 531 can use self._corank for slight speedup\n\nl. 549 You should call N._minor for speed. The set contractions is already known to be independent and a subset of the groundset.\n\nl. 587 add \"nonempty\"\n\nl. 626 move into else clause\n\nl. 632 use _minor for speed. The \"delete\" method will actually call _minor with an independent set to contract and a coindependent set to delete.\n\nIn any case, this method will change once you stop discarding empty sets, so I'll skip it for now.\n\nl. 644 in light of this function, I strongly suggest not discarding empty sets. People might want to build their transversal matroid one element at a time, and have the final\nrank in mind already.\n\nl. 730 I'm not happy with the condition that set labels and groundset labels be different. This relabeling really gets in the way of people doing matroid extensions. Since you're already keeping a translation between the input set labels and internal set labels (see l. 179), just allow any collection of set labels as input. That also gets rid of the exception in l. 140.\n\nl. 738 isinstance(newset, bool)\n\nl. 743 The point is moot since you're (hopefully) dropping the requirement on set labels, but you're not using your labels_map here.\n\nl. 805 Is there a reason you made this into a list?\n```\n",
    "created_at": "2017-09-11T15:00:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325685",
    "user": "https://trac.sagemath.org/admin/accounts/users/Stefan"
}
```

Second half:


```
l. 456 Better: "A transversal matroid can be represented as a set system, or as a bipartite graph, with one color class corresponding to the ground set and the other to the sets of the set system. This method returns that bipartite graph."

l. 490 I don't think I see the problems that msaaltink pointed out for _minor.

l. 531 can use self._corank for slight speedup

l. 549 You should call N._minor for speed. The set contractions is already known to be independent and a subset of the groundset.

l. 587 add "nonempty"

l. 626 move into else clause

l. 632 use _minor for speed. The "delete" method will actually call _minor with an independent set to contract and a coindependent set to delete.

In any case, this method will change once you stop discarding empty sets, so I'll skip it for now.

l. 644 in light of this function, I strongly suggest not discarding empty sets. People might want to build their transversal matroid one element at a time, and have the final
rank in mind already.

l. 730 I'm not happy with the condition that set labels and groundset labels be different. This relabeling really gets in the way of people doing matroid extensions. Since you're already keeping a translation between the input set labels and internal set labels (see l. 179), just allow any collection of set labels as input. That also gets rid of the exception in l. 140.

l. 738 isinstance(newset, bool)

l. 743 The point is moot since you're (hopefully) dropping the requirement on set labels, but you're not using your labels_map here.

l. 805 Is there a reason you made this into a list?
```




---

archive/issue_comments_325686.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-24T23:33:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325686",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_325687.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-25T00:06:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325687",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_325688.json:
```json
{
    "body": "I addressed everything in [comment:36]. Here are some notes before I forget.\n\nThe matching parameter is like the basis parameter of `BasisExchangeMatroid`. It's there for speed, and as such, it's not strictly necessary to use, and there are no checks for bad input. Giving it just saves a little processing time finding one. The real purpose of having it there is compatibility with the rest of the matroid module. So I'm not really sure what else I should do to document or test it.\n\nThe documentation for basis exchange matroid should be updated, but it's best to do that when this class is exposed in #23628.\n\nI have changed it so empty sets are kept in the constructor. If a user doesn't like it, they can run `reduce_presentation()`, which will remove them.\n\nFor comparison, I took out `sorted` so there aren't issues mixing strings and numbers, but having a frozenset of frozensets would ignore repeated sets, so I used the `Counter` object instead. This is identical to `self._sets`, although Cython probably wouldn't like it if I tried to call those directly.",
    "created_at": "2018-04-25T01:08:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325688",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```

I addressed everything in [comment:36]. Here are some notes before I forget.

The matching parameter is like the basis parameter of `BasisExchangeMatroid`. It's there for speed, and as such, it's not strictly necessary to use, and there are no checks for bad input. Giving it just saves a little processing time finding one. The real purpose of having it there is compatibility with the rest of the matroid module. So I'm not really sure what else I should do to document or test it.

The documentation for basis exchange matroid should be updated, but it's best to do that when this class is exposed in #23628.

I have changed it so empty sets are kept in the constructor. If a user doesn't like it, they can run `reduce_presentation()`, which will remove them.

For comparison, I took out `sorted` so there aren't issues mixing strings and numbers, but having a frozenset of frozensets would ignore repeated sets, so I used the `Counter` object instead. This is identical to `self._sets`, although Cython probably wouldn't like it if I tried to call those directly.



---

archive/issue_comments_325689.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-25T01:08:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325689",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_325690.json:
```json
{
    "body": "There are still a few issues from #comment:35 that should be addressed:\n\n* The `matching` parameter.  You wrote\n> The matching parameter is like the basis parameter of BasisExchangeMatroid. It's there for speed, and as such, it's not strictly necessary to use, and there are no checks for bad input. Giving it just saves a little processing time finding one. The real purpose of having it there is compatibility with the rest of the matroid module. So I'm not really sure what else I should do to document or test it. \nIt may be there just for speed, but can badly affect the answers you get.  I think the documentation should at least clarify that the matching must be a **maximal** matching, or things will not work out.  For example\n\n```\nsage: from sage.matroids.transversal_matroid import TransversalMatroid\nsage: M = TransversalMatroid([range(5)] * 4, set_labels='abcd', matching={0:'a', 1:'c'})\nsage: N = TransversalMatroid([range(5)] * 4, set_labels='abcd')\nsage: M == N\nTrue\nsage: M.full_rank()\n2\nsage: N.full_rank()\n4\nsage: M.rank([0,1,2])\n2\nsage: N.rank([0,1,2])\n3\n```\n\nIt is perplexing that `M` and `N` compare as equal but have different ranks, and ascribe different ranks to the same set!  I would argue that the results for `M` are mathematically incorrect and therefore dangerous.  If it cannot be tested that the given matching is maximal, at least it should be documented that there is a potential for error here.  I am thinking of a situation where someone has written some code using this constructor, then later edits it without remembering to fix the matching.  They can then be silently getting bad answers.\n\nAs for additional test cases, the sort of thing I was suggesting is like this:\n\n```\nsage: TransversalMatroid(sets=[[0,1],[0,2]], matching={0:'s1'})\n...\nValueError: set labels must be provided if matching is provided\n```\n\nthat ensures the error of not providing set labels is indeed detected.  If you are shooting for full code coverage in your tests, things like this are needed.\n\n* Iterables vs. lists.  This still seems wrong to me.  The constructor does what the documentation asks, giving an iterable of iterables, but then some functions raise exceptions.  Perhaps the given iterables should be coerced into lists internally?\n\n```\nN = TransversalMatroid(['abc', 'abd', 'cde']); N\nTransversal matroid of rank 3 on 5 elements, with 3 sets.\nsage: Ne = N.transversal_extension(element='f', sets=['s2'])\nTypeError: cannot concatenate 'str' and 'list' objects\n```\n",
    "created_at": "2018-05-01T18:46:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325690",
    "user": "https://trac.sagemath.org/admin/accounts/users/msaaltink"
}
```

There are still a few issues from #comment:35 that should be addressed:

* The `matching` parameter.  You wrote
> The matching parameter is like the basis parameter of BasisExchangeMatroid. It's there for speed, and as such, it's not strictly necessary to use, and there are no checks for bad input. Giving it just saves a little processing time finding one. The real purpose of having it there is compatibility with the rest of the matroid module. So I'm not really sure what else I should do to document or test it. 
It may be there just for speed, but can badly affect the answers you get.  I think the documentation should at least clarify that the matching must be a **maximal** matching, or things will not work out.  For example

```
sage: from sage.matroids.transversal_matroid import TransversalMatroid
sage: M = TransversalMatroid([range(5)] * 4, set_labels='abcd', matching={0:'a', 1:'c'})
sage: N = TransversalMatroid([range(5)] * 4, set_labels='abcd')
sage: M == N
True
sage: M.full_rank()
2
sage: N.full_rank()
4
sage: M.rank([0,1,2])
2
sage: N.rank([0,1,2])
3
```

It is perplexing that `M` and `N` compare as equal but have different ranks, and ascribe different ranks to the same set!  I would argue that the results for `M` are mathematically incorrect and therefore dangerous.  If it cannot be tested that the given matching is maximal, at least it should be documented that there is a potential for error here.  I am thinking of a situation where someone has written some code using this constructor, then later edits it without remembering to fix the matching.  They can then be silently getting bad answers.

As for additional test cases, the sort of thing I was suggesting is like this:

```
sage: TransversalMatroid(sets=[[0,1],[0,2]], matching={0:'s1'})
...
ValueError: set labels must be provided if matching is provided
```

that ensures the error of not providing set labels is indeed detected.  If you are shooting for full code coverage in your tests, things like this are needed.

* Iterables vs. lists.  This still seems wrong to me.  The constructor does what the documentation asks, giving an iterable of iterables, but then some functions raise exceptions.  Perhaps the given iterables should be coerced into lists internally?

```
N = TransversalMatroid(['abc', 'abd', 'cde']); N
Transversal matroid of rank 3 on 5 elements, with 3 sets.
sage: Ne = N.transversal_extension(element='f', sets=['s2'])
TypeError: cannot concatenate 'str' and 'list' objects
```




---

archive/issue_comments_325691.json:
```json
{
    "body": "Thank you, msaaltink. I didn't mean to ignore you! I was going to work through comments 36 and 37, and then see what was still unresolved from 35.",
    "created_at": "2018-05-02T17:47:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325691",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```

Thank you, msaaltink. I didn't mean to ignore you! I was going to work through comments 36 and 37, and then see what was still unresolved from 35.



---

archive/issue_comments_325692.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-05T02:38:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325692",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_325693.json:
```json
{
    "body": "Good points about the matching. I'm not sure how to fix it but I agree it needs more tests.\n\nReplying to [comment:37 Stefan]: \n> l. 730 I'm not happy with the condition that set labels and groundset labels be different. This relabeling really gets in the way of people doing matroid extensions. Since you're already keeping a translation between the input set labels and internal set labels (see l. 179), just allow any collection of set labels as input. That also gets rid of the exception in l. 140.\n\nIf the labels are the same, it becomes impossible to graph, since vertex labellings have to be injective. What should I do so the user can still graph their matroid?\n\n> l. 743 The point is moot since you're (hopefully) dropping the requirement on set labels, but you're not using your labels_map here.\n\nIt appears that I don't use labels_map anywhere, so I guess I should remove that part of the code.",
    "created_at": "2018-05-05T03:26:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325693",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```

Good points about the matching. I'm not sure how to fix it but I agree it needs more tests.

Replying to [comment:37 Stefan]: 
> l. 730 I'm not happy with the condition that set labels and groundset labels be different. This relabeling really gets in the way of people doing matroid extensions. Since you're already keeping a translation between the input set labels and internal set labels (see l. 179), just allow any collection of set labels as input. That also gets rid of the exception in l. 140.

If the labels are the same, it becomes impossible to graph, since vertex labellings have to be injective. What should I do so the user can still graph their matroid?

> l. 743 The point is moot since you're (hopefully) dropping the requirement on set labels, but you're not using your labels_map here.

It appears that I don't use labels_map anywhere, so I guess I should remove that part of the code.



---

archive/issue_comments_325694.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-05T03:26:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325694",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_325695.json:
```json
{
    "body": "Replying to [comment:43 msaaltink]:\n> {{{\n> sage: from sage.matroids.transversal_matroid import TransversalMatroid\n> sage: M = TransversalMatroid([range(5)] * 4, set_labels='abcd', matching={0:'a', 1:'c'})\n> sage: N = TransversalMatroid([range(5)] * 4, set_labels='abcd')\n> sage: M == N\n> True\n> sage: M.full_rank()\n> 2\n> sage: N.full_rank()\n> 4\n> sage: M.rank([0,1,2])\n> 2\n> sage: N.rank([0,1,2])\n> 3\n> }}}\n> It is perplexing that `M` and `N` compare as equal but have different ranks, and ascribe different ranks to the same set!  I would argue that the results for `M` are mathematically incorrect and therefore dangerous.  If it cannot be tested that the given matching is maximal, at least it should be documented that there is a potential for error here.  I am thinking of a situation where someone has written some code using this constructor, then later edits it without remembering to fix the matching.  They can then be silently getting bad answers.\n\nThat is perplexing, and it seems worse than the behavior of `BasisExchangeMatroid`, which can correct itself if the input is inconsistent. I can't think of a clean way to check if the matching provided actually gives the full rank, or indeed that it is a matching, without calling some computation-heavy graph methods.\n\n\n```\nsage: from sage.matroids.basis_exchange_matroid import *\nsage: B = BasisExchangeMatroid([0,1], [0], 2)\nsage: C = BasisExchangeMatroid([0,1], [0,1], 2)\nsage: B == C\nFalse\nsage: B.rank()\n1\nsage: D = BasisExchangeMatroid([0,1], [0,1], 3)\nsage: C == D\nTrue\n```\n",
    "created_at": "2018-06-10T19:00:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325695",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```

Replying to [comment:43 msaaltink]:
> {{{
> sage: from sage.matroids.transversal_matroid import TransversalMatroid
> sage: M = TransversalMatroid([range(5)] * 4, set_labels='abcd', matching={0:'a', 1:'c'})
> sage: N = TransversalMatroid([range(5)] * 4, set_labels='abcd')
> sage: M == N
> True
> sage: M.full_rank()
> 2
> sage: N.full_rank()
> 4
> sage: M.rank([0,1,2])
> 2
> sage: N.rank([0,1,2])
> 3
> }}}
> It is perplexing that `M` and `N` compare as equal but have different ranks, and ascribe different ranks to the same set!  I would argue that the results for `M` are mathematically incorrect and therefore dangerous.  If it cannot be tested that the given matching is maximal, at least it should be documented that there is a potential for error here.  I am thinking of a situation where someone has written some code using this constructor, then later edits it without remembering to fix the matching.  They can then be silently getting bad answers.

That is perplexing, and it seems worse than the behavior of `BasisExchangeMatroid`, which can correct itself if the input is inconsistent. I can't think of a clean way to check if the matching provided actually gives the full rank, or indeed that it is a matching, without calling some computation-heavy graph methods.


```
sage: from sage.matroids.basis_exchange_matroid import *
sage: B = BasisExchangeMatroid([0,1], [0], 2)
sage: C = BasisExchangeMatroid([0,1], [0,1], 2)
sage: B == C
False
sage: B.rank()
1
sage: D = BasisExchangeMatroid([0,1], [0,1], 3)
sage: C == D
True
```




---

archive/issue_comments_325696.json:
```json
{
    "body": "Here's one course of action: leave matching as it is without checks in __init__(), but override is_valid() to check that the matching in memory is indeed a maximal matching. Then have the comparison methods use is_valid(), returning true if they have the same ground set and sets and they're both valid, and false otherwise. (I think it's okay to have two of the same invalid matroids compare as false-- no one should be working with them on purpose.)",
    "created_at": "2018-06-11T15:58:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325696",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```

Here's one course of action: leave matching as it is without checks in __init__(), but override is_valid() to check that the matching in memory is indeed a maximal matching. Then have the comparison methods use is_valid(), returning true if they have the same ground set and sets and they're both valid, and false otherwise. (I think it's okay to have two of the same invalid matroids compare as false-- no one should be working with them on purpose.)



---

archive/issue_comments_325697.json:
```json
{
    "body": "Overriding is_valid is a good idea in any case. The default implementation will check the basis exchange axioms in full, whereas for transversal matroids we only need to know that the basis size corresponds to a maximal transversal!\n\nWould it suffice in the comparison to just check the ranks, rather than running is_valid? Or does that still leave the door open to other incorrect input, e.g. if both \"matroids\" have a non-maximal matching?",
    "created_at": "2018-06-11T21:16:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325697",
    "user": "https://trac.sagemath.org/admin/accounts/users/Stefan"
}
```

Overriding is_valid is a good idea in any case. The default implementation will check the basis exchange axioms in full, whereas for transversal matroids we only need to know that the basis size corresponds to a maximal transversal!

Would it suffice in the comparison to just check the ranks, rather than running is_valid? Or does that still leave the door open to other incorrect input, e.g. if both "matroids" have a non-maximal matching?



---

archive/issue_comments_325698.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-18T06:56:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325698",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_325699.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-18T14:32:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325699",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_325700.json:
```json
{
    "body": "Replying to [comment:50 Stefan]:\n> Overriding is_valid is a good idea in any case. The default implementation will check the basis exchange axioms in full, whereas for transversal matroids we only need to know that the basis size corresponds to a maximal transversal!\n> \n> Would it suffice in the comparison to just check the ranks, rather than running is_valid? Or does that still leave the door open to other incorrect input, e.g. if both \"matroids\" have a non-maximal matching?\nThere are three things that can go wrong with the \"matching\": It's not maximal, it's not actually a matching, or it's not in the set system. The rank only catches the former, so an invalid matroid can still have full rank but the same ground set and sets as a valid matroid. So I think I really do need comparison to test all of these.\n\nI found a bug in the way matching input is handled, so thanks, msaaltink, for your thoroughness. Test coverage should be complete now.\n\nI'll set it to needs review since I've made all of the suggested changes. There remains the issue of letting the element and set labels overlap, but I'm not sure how to let that happen without compromising graph functionality, or if it's worth it.",
    "created_at": "2018-06-18T16:03:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325700",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```

Replying to [comment:50 Stefan]:
> Overriding is_valid is a good idea in any case. The default implementation will check the basis exchange axioms in full, whereas for transversal matroids we only need to know that the basis size corresponds to a maximal transversal!
> 
> Would it suffice in the comparison to just check the ranks, rather than running is_valid? Or does that still leave the door open to other incorrect input, e.g. if both "matroids" have a non-maximal matching?
There are three things that can go wrong with the "matching": It's not maximal, it's not actually a matching, or it's not in the set system. The rank only catches the former, so an invalid matroid can still have full rank but the same ground set and sets as a valid matroid. So I think I really do need comparison to test all of these.

I found a bug in the way matching input is handled, so thanks, msaaltink, for your thoroughness. Test coverage should be complete now.

I'll set it to needs review since I've made all of the suggested changes. There remains the issue of letting the element and set labels overlap, but I'm not sure how to let that happen without compromising graph functionality, or if it's worth it.



---

archive/issue_comments_325701.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-06-18T16:03:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325701",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_325702.json:
```json
{
    "body": "Sorry, I just noticed a whitespace issue that I need to fix later.",
    "created_at": "2018-06-18T16:08:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325702",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```

Sorry, I just noticed a whitespace issue that I need to fix later.



---

archive/issue_comments_325703.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-06-18T16:08:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325703",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_325704.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-19T03:04:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325704",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_325705.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-06-19T03:06:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325705",
    "user": "https://trac.sagemath.org/admin/accounts/users/zgershkoff"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_325706.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-22T03:45:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325706",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_325707.json:
```json
{
    "body": "I've mostly made my way though this, and overall it seemed good. However, there was a serious bug in `_translate_matching` that I fixed about how the matching was handled. The input for `matching` was expecting a dict whose values where elements of `set_labels`, not the normalized `self._set_labels`. So when pickling, it was raising an error.\n\nI've tweaked the doc in a few places for Sage's convention and tried to improve the speed by using a bunch of Cython tricks I've learned. I did not run any specific timings, but the C code generally looks cleaner.\n----\nNew commits:",
    "created_at": "2018-09-18T03:03:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325707",
    "user": "https://github.com/tscrim"
}
```

I've mostly made my way though this, and overall it seemed good. However, there was a serious bug in `_translate_matching` that I fixed about how the matching was handled. The input for `matching` was expecting a dict whose values where elements of `set_labels`, not the normalized `self._set_labels`. So when pickling, it was raising an error.

I've tweaked the doc in a few places for Sage's convention and tried to improve the speed by using a bunch of Cython tricks I've learned. I did not run any specific timings, but the C code generally looks cleaner.
----
New commits:



---

archive/issue_comments_325708.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-12-01T15:06:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325708",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_325709.json:
```json
{
    "body": "branch is red",
    "created_at": "2018-12-01T15:06:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23299#issuecomment-325709",
    "user": "https://github.com/fchapoton"
}
```

branch is red



---

archive/issue_events_060323.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-12-01T15:06:39Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/23299",
    "milestone": "sage-8.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23299#event-60323"
}
```
