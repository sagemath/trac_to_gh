# Issue 10010: "sage -upgrade" appears to hang when its output is tee'd

Issue created by migration from Trac.

Original creator: leif

Original creation time: 2010-09-25 02:52:23

Assignee: leif

CC:  jhpalmieri mpatel jdemeyer

Keywords: upgrade update prompt log redirect


```sh
user`@`host$ ./sage -upgrade | tee upgrade.log
```

appears to hang (without giving *any* output).

This is because `sage-update` prompts the user for confirmation, but doesn't flush the output.

The attached patch to `sage-update` (a Python script called by `sage-upgrade`) adds flushing various output and also contains some clean-up and corrections (to comments, docstrings, and the messages printed).



---

Attachment

Apply to scripts repo. Based on Sage 4.6.alpha1.


---

Comment by leif created at 2010-09-25 03:06:03

Changing status from new to needs_review.


---

Comment by leif created at 2010-09-25 03:17:19

Just for the record:

```
leif`@`quadriga:~/Sage/sage-4.6.alpha1$ ./sage -upgrade | tee -a upgrade-tee-test-10011.1.log
Testing mirrors...

    [8 ] ftp.sh.cvut.cz                   224 [ms]
    [11] mirror.switch.ch                 259 [ms]
    [3 ] content.wuala.com                381 [ms]
    [13] mirrors.fe.up.pt                 382 [ms]
    [21] www.mirrorservice.org            387 [ms]
    [19] sunsite.rediris.es               434 [ms]
    [12] mirror.yandex.ru                 529 [ms]
    [15] modular.math.jmu.edu             806 [ms]
    [14] mirrors.xmission.com             833 [ms]
    [2 ] boxen.math.washington.edu        851 [ms]
    [5 ] ftp.iitm.ac.in                   938 [ms]
    [20] www.cecm.sfu.ca                  967 [ms]
    [17] sagemath.mirror.ac.za           1038 [ms]
    [4 ] echidna.maths.usyd.edu.au       1451 [ms]
    [10] mirror.aarnet.edu.au            1523 [ms]
    [7 ] ftp.leg.uct.ac.za               1581 [ms]
    [16] sagemath.c3sl.ufpr.br           1703 [ms]
    [6 ] ftp.kaist.ac.kr                 2108 [ms]
    [18] sagemath.polytechnic.edu.na     6327 [ms]
    [9 ] mira.sunsite.utk.edu           11068 [ms]

Automatically selected server ftp.sh.cvut.cz (http://ftp.sh.cvut.cz/MIRRORS/sagemath/).
Downloading packages from 'http://ftp.sh.cvut.cz/MIRRORS/sagemath//spkg'.
Reading package lists.......... Done!
The following packages will be upgraded:

    cliquer-1.2.p6 examples-4.5.3 extcode-4.5.3 genus2reduction-0.3.p6
    iconv-1.13.1.p2 lcalc-20100428-1.23.p1 pari-2.3.5.p4
    polybori-0.6.4.p4 sage-4.5.3 sage_scripts-4.5.3
    singular-3-1-1-4.p0

 ** WARNING: This is a source-based upgrade, which could take hours,
 ** fail, and render your Sage install useless!!

Do you want to continue [y/N]? n
Abort.
leif`@`quadriga:~/Sage/sage-4.6.alpha1$ 
```


Note that I did *not* run `sage -downgrade`! 8D


---

Comment by leif created at 2010-10-19 13:45:37

I know you don't like interactive scripts... ;-)


---

Comment by jdemeyer created at 2010-10-21 15:33:37

Replying to [comment:3 leif]:
> I know you don't like interactive scripts... ;-)
Very true.

The patch looks fine and fixes the problem mentioned in the ticket.  I can't really be sure that it doesn't break anything, but positive_review anyway.


---

Comment by jdemeyer created at 2010-10-21 15:33:37

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2010-11-01 10:12:16

Resolution: fixed
