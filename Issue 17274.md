# Issue 17274: Get integral of abs(sin(x)) and abs(cos(x)) right

Issue created by migration from Trac.

Original creator: kcrisman

Original creation time: 2014-12-15 16:09:47

CC:  slelievre

See [comment:12:ticket:11483 this comment], discussion in #13364, the supposed fix at https://sourceforge.net/p/maxima/bugs/2520/, [this ask.sagemath question](http://ask.sagemath.org/question/25269/i-dont-know-why-sage-return-0-for-integratesin2xabsx0pi-when-its-value-is-2/), and so forth.

E.g. apparently this is quite wrong

```
(%i1) load(abs_integrate);
(%i3) display2d:false;

(%o3) false
(%i4) integrate(abs(sin(x)),x);

(%o4) 4*(abs(sin(x))*(atan(sin(x)/(cos(x)+1))/2
                     +sin(x)/((cos(x)+1)*(2*sin(x)^2/(cos(x)+1)^2+2)))
        /abs(cos(x)+1)
        -(signum(1/(cos(x)+1))*signum(sin(x))*log(2*sin(x)^2/(cos(x)+1)^2+2)
         -signum(1/(cos(x)+1))*signum(sin(x))*log(sin(x)^2/(cos(x)+1)^2+1)
         +signum(1/(cos(x)+1))*signum(sin(x))
                              *(2*sin(x)*atan(sin(x)/(cos(x)+1))/(cos(x)+1)
                               -log(2)))
         /4)
```

and it doesn't do the definite integral at all, even the easy ones where abs does nothing on the interval!


---

Comment by kcrisman created at 2014-12-15 16:16:55

Worse,

```
sage: integrate(abs(cos(x)),x,0,pi)
-1
```



---

Comment by kcrisman created at 2014-12-15 16:19:21

https://sourceforge.net/p/maxima/bugs/2859/


---

Comment by kcrisman created at 2015-10-27 16:56:24

Reported again at https://groups.google.com/forum/#!topic/sage-support/1Hcv29UyqVo


---

Comment by chapoton created at 2019-05-17 17:52:38

Changing keywords from "" to "abs_integrate".


---

Comment by chapoton created at 2019-08-26 18:54:42

Everything works in 8.9.b7 after #27958. Some doctests were added there.

Maybe one could add one doctest for

```
sage: integrate(abs(sin(x)),x)
-cos(x)*sgn(sin(x)) + sgn(sin(x))
```



---

Comment by chapoton created at 2019-09-14 07:20:03

Changing status from new to needs_review.


---

Comment by chapoton created at 2019-09-14 07:20:03

I have added a doctest.
----
New commits:


---

Comment by vdelecroix created at 2019-09-15 14:28:01

This answer

```
sage: integrate(abs(sin(x)),x)
-cos(x)*sgn(sin(x)) + sgn(sin(x))
```

is *very* wrong (outside of [-pi, pi])! It takes negative values

```
sage: f = integrate(abs(sin(x)), x)
sage: (f(5) - f(0)).n()
-0.716337814536774
```

and the integral is supposed to go to `+oo` as `x -> +oo/-oo`...


---

Comment by vdelecroix created at 2019-09-15 14:30:25

But this is correct

```
sage: integrate(abs(sin(x)), x, 0, 10)
cos(10) + 7
```



---

Comment by vdelecroix created at 2019-09-15 14:32:33

And I like very much

```
sage: %time integrate(abs(sin(x)), x, algorithm='sympy')
CPU times: user 8.09 s, sys: 99 µs, total: 8.09 s
Wall time: 8.1 s
integrate(abs(sin(x)), x)
```



---

Comment by chapoton created at 2019-09-15 16:29:32

Indeed. Giac is responsible for the wrong answer. This should be reported upstream.

```
sage: integrate(abs(sin(x)),x,algorithm='maxima')
integrate(abs(sin(x)), x)
sage: integrate(abs(sin(x)),x,algorithm='sympy')
integrate(abs(sin(x)), x)
sage: integrate(abs(sin(x)),x,algorithm='giac')
-cos(x)*sgn(sin(x)) + sgn(sin(x))
sage: integrate(abs(sin(x)),x,algorithm='fricas')
integral(abs(sin(x)), x)
sage: integrate(abs(sin(x)),x,algorithm='mathematica_free')
-cos(x)*sgn(sin(x))
```



---

Comment by chapoton created at 2019-09-15 16:39:10

But giac is also providing the correct answer for the definite integral, where sympy fails to deliver:

```
sage: integrate(abs(cos(x)),x,0,44,algorithm='maxima')
integrate(abs(cos(x)), x, 0, 44)
sage: integrate(abs(cos(x)),x,0,44,algorithm='sympy')
-sin(44) + 4
sage: integrate(abs(cos(x)),x,0,44,algorithm='giac')
sin(44) + 28
sage: integrate(abs(cos(x)),x,0,44,algorithm='fricas')
integrate(abs(cos(x)), x, 0, 44)
sage: integrate(abs(cos(x)),x,0,44,algorithm='mathematica_free')
sin(44) + 28
```



---

Comment by vdelecroix created at 2019-09-15 17:36:19

Replying to [comment:13 chapoton]:
> But giac is also providing the correct answer for the definite integral, where sympy fails to deliver:
>
> [...]
>

which should also be reported upstream I guess...


---

Comment by chapoton created at 2019-09-15 19:18:00

Changing status from needs_review to needs_info.


---

Comment by chapoton created at 2019-10-06 19:16:08

Samuel, would you please report to giac the failure of comment:12 ?


---

Comment by slelievre created at 2019-10-07 11:42:32

I emailed Bernard Parisse, here is his reply:

```
Ce n'est pas une erreur, au sens ou un avertissement est renvoyé
0>> integrate(abs(sin(x))
Warning adding 1 ) at end of input
Attention, l'intégration de abs() ou sign() suppose un signe constant
par intervalles (vérifié si l'argument est réel):
  Verifiez [abs(sin(x))]
Discontinuités aux zeros de sin(x) were not checked
sign(sin(x))-cos(x)*sign(sin(x))
// Time 0.04

C'est à l'utilisateur de prendre garde aux discontinuites de la
primitive pour calculer une intégrale définie s'il utilise la primitive
renvoyée. Lorsqu'on demande à giac une intégrale définie, il essaie de
tenir compte des discontinuités, et il fait le calcul numérique en
parallèle pour verifier. En cas de non concordance, les 2 valeurs sont
renvoyées (la plupart du temps c'est la valeur numérique qui est la bonne).
```

which roughly translates as

```
This is not an error, in the sense that a warning is issued:
0>> integrate(abs(sin(x))
Warning adding 1 ) at end of input
Caution, integrating abs() or sign() assumes piecewise constant sign
(check if the argument is real):
Check [abs(sin(x))]
Discontinuities at zeros of sin(x) were not checked
sign(sin(x))-cos(x)*sign(sin(x))
// Time 0.04

It is up to the user to check for discontinuities of the antiderivative
to compute an integral using the antiderivative returned by giac.
When asking giac for an integral on an interval, it tries to take
discontinuities into account, and does the numerical integration in parallel
to check. In case of mismatch, both values are returned (most of the time
the numerical value is the one that is correct).
```



---

Comment by embray created at 2019-12-30 14:48:17

Ticket retargeted after milestone closed


---

Comment by mkoeppe created at 2020-05-01 04:28:42

Moving tickets to milestone sage-9.2 based on a review of last modification date, branch status, and severity.


---

Comment by mkoeppe created at 2021-04-02 20:21:54

Moving this ticket to 9.4, as it seems unlikely that it will be merged in 9.3, which is in the release candidate stage


---

Comment by mkoeppe created at 2021-07-19 00:44:56

Setting a new milestone for this ticket based on a cursory review.


---

Comment by mkoeppe created at 2021-12-18 19:53:12

Stalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.
