# Issue 17274: Get integral of abs(sin(x)) and abs(cos(x)) right

archive/issues_017274.json:
```json
{
    "body": "CC:  slelievre\n\nSee [comment:12:ticket:11483 this comment], discussion in #13364, the supposed fix at https://sourceforge.net/p/maxima/bugs/2520/, [this ask.sagemath question](http://ask.sagemath.org/question/25269/i-dont-know-why-sage-return-0-for-integratesin2xabsx0pi-when-its-value-is-2/), and so forth.\n\nE.g. apparently this is quite wrong\n\n```\n(%i1) load(abs_integrate);\n(%i3) display2d:false;\n\n(%o3) false\n(%i4) integrate(abs(sin(x)),x);\n\n(%o4) 4*(abs(sin(x))*(atan(sin(x)/(cos(x)+1))/2\n                     +sin(x)/((cos(x)+1)*(2*sin(x)^2/(cos(x)+1)^2+2)))\n        /abs(cos(x)+1)\n        -(signum(1/(cos(x)+1))*signum(sin(x))*log(2*sin(x)^2/(cos(x)+1)^2+2)\n         -signum(1/(cos(x)+1))*signum(sin(x))*log(sin(x)^2/(cos(x)+1)^2+1)\n         +signum(1/(cos(x)+1))*signum(sin(x))\n                              *(2*sin(x)*atan(sin(x)/(cos(x)+1))/(cos(x)+1)\n                               -log(2)))\n         /4)\n```\n\nand it doesn't do the definite integral at all, even the easy ones where abs does nothing on the interval!\n\nIssue created by migration from https://trac.sagemath.org/ticket/17511\n\n",
    "created_at": "2014-12-15T16:09:47Z",
    "labels": [
        "calculus",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Get integral of abs(sin(x)) and abs(cos(x)) right",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17274",
    "user": "kcrisman"
}
```
CC:  slelievre

See [comment:12:ticket:11483 this comment], discussion in #13364, the supposed fix at https://sourceforge.net/p/maxima/bugs/2520/, [this ask.sagemath question](http://ask.sagemath.org/question/25269/i-dont-know-why-sage-return-0-for-integratesin2xabsx0pi-when-its-value-is-2/), and so forth.

E.g. apparently this is quite wrong

```
(%i1) load(abs_integrate);
(%i3) display2d:false;

(%o3) false
(%i4) integrate(abs(sin(x)),x);

(%o4) 4*(abs(sin(x))*(atan(sin(x)/(cos(x)+1))/2
                     +sin(x)/((cos(x)+1)*(2*sin(x)^2/(cos(x)+1)^2+2)))
        /abs(cos(x)+1)
        -(signum(1/(cos(x)+1))*signum(sin(x))*log(2*sin(x)^2/(cos(x)+1)^2+2)
         -signum(1/(cos(x)+1))*signum(sin(x))*log(sin(x)^2/(cos(x)+1)^2+1)
         +signum(1/(cos(x)+1))*signum(sin(x))
                              *(2*sin(x)*atan(sin(x)/(cos(x)+1))/(cos(x)+1)
                               -log(2)))
         /4)
```

and it doesn't do the definite integral at all, even the easy ones where abs does nothing on the interval!

Issue created by migration from https://trac.sagemath.org/ticket/17511





---

archive/issue_comments_230010.json:
```json
{
    "body": "Worse,\n\n```\nsage: integrate(abs(cos(x)),x,0,pi)\n-1\n```\n",
    "created_at": "2014-12-15T16:16:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17274#issuecomment-230010",
    "user": "kcrisman"
}
```

Worse,

```
sage: integrate(abs(cos(x)),x,0,pi)
-1
```




---

archive/issue_comments_230011.json:
```json
{
    "body": "https://sourceforge.net/p/maxima/bugs/2859/",
    "created_at": "2014-12-15T16:19:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17274#issuecomment-230011",
    "user": "kcrisman"
}
```

https://sourceforge.net/p/maxima/bugs/2859/



---

archive/issue_comments_230012.json:
```json
{
    "body": "Reported again at https://groups.google.com/forum/#!topic/sage-support/1Hcv29UyqVo",
    "created_at": "2015-10-27T16:56:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17274#issuecomment-230012",
    "user": "kcrisman"
}
```

Reported again at https://groups.google.com/forum/#!topic/sage-support/1Hcv29UyqVo



---

archive/issue_comments_230013.json:
```json
{
    "body": "Changing keywords from \"\" to \"abs_integrate\".",
    "created_at": "2019-05-17T17:52:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17274#issuecomment-230013",
    "user": "chapoton"
}
```

Changing keywords from "" to "abs_integrate".



---

archive/issue_comments_230014.json:
```json
{
    "body": "Everything works in 8.9.b7 after #27958. Some doctests were added there.\n\nMaybe one could add one doctest for\n\n```\nsage: integrate(abs(sin(x)),x)\n-cos(x)*sgn(sin(x)) + sgn(sin(x))\n```\n",
    "created_at": "2019-08-26T18:54:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17274#issuecomment-230014",
    "user": "chapoton"
}
```

Everything works in 8.9.b7 after #27958. Some doctests were added there.

Maybe one could add one doctest for

```
sage: integrate(abs(sin(x)),x)
-cos(x)*sgn(sin(x)) + sgn(sin(x))
```




---

archive/issue_comments_230015.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-09-14T07:20:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17274#issuecomment-230015",
    "user": "chapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_230016.json:
```json
{
    "body": "I have added a doctest.\n----\nNew commits:",
    "created_at": "2019-09-14T07:20:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17274#issuecomment-230016",
    "user": "chapoton"
}
```

I have added a doctest.
----
New commits:



---

archive/issue_comments_230017.json:
```json
{
    "body": "This answer\n\n```\nsage: integrate(abs(sin(x)),x)\n-cos(x)*sgn(sin(x)) + sgn(sin(x))\n```\n\nis *very* wrong (outside of [-pi, pi])! It takes negative values\n\n```\nsage: f = integrate(abs(sin(x)), x)\nsage: (f(5) - f(0)).n()\n-0.716337814536774\n```\n\nand the integral is supposed to go to `+oo` as `x -> +oo/-oo`...",
    "created_at": "2019-09-15T14:28:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17274#issuecomment-230017",
    "user": "vdelecroix"
}
```

This answer

```
sage: integrate(abs(sin(x)),x)
-cos(x)*sgn(sin(x)) + sgn(sin(x))
```

is *very* wrong (outside of [-pi, pi])! It takes negative values

```
sage: f = integrate(abs(sin(x)), x)
sage: (f(5) - f(0)).n()
-0.716337814536774
```

and the integral is supposed to go to `+oo` as `x -> +oo/-oo`...



---

archive/issue_comments_230018.json:
```json
{
    "body": "But this is correct\n\n```\nsage: integrate(abs(sin(x)), x, 0, 10)\ncos(10) + 7\n```\n",
    "created_at": "2019-09-15T14:30:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17274#issuecomment-230018",
    "user": "vdelecroix"
}
```

But this is correct

```
sage: integrate(abs(sin(x)), x, 0, 10)
cos(10) + 7
```




---

archive/issue_comments_230019.json:
```json
{
    "body": "And I like very much\n\n```\nsage: %time integrate(abs(sin(x)), x, algorithm='sympy')\nCPU times: user 8.09 s, sys: 99 \u00b5s, total: 8.09 s\nWall time: 8.1 s\nintegrate(abs(sin(x)), x)\n```\n",
    "created_at": "2019-09-15T14:32:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17274#issuecomment-230019",
    "user": "vdelecroix"
}
```

And I like very much

```
sage: %time integrate(abs(sin(x)), x, algorithm='sympy')
CPU times: user 8.09 s, sys: 99 µs, total: 8.09 s
Wall time: 8.1 s
integrate(abs(sin(x)), x)
```




---

archive/issue_comments_230020.json:
```json
{
    "body": "Indeed. Giac is responsible for the wrong answer. This should be reported upstream.\n\n```\nsage: integrate(abs(sin(x)),x,algorithm='maxima')\nintegrate(abs(sin(x)), x)\nsage: integrate(abs(sin(x)),x,algorithm='sympy')\nintegrate(abs(sin(x)), x)\nsage: integrate(abs(sin(x)),x,algorithm='giac')\n-cos(x)*sgn(sin(x)) + sgn(sin(x))\nsage: integrate(abs(sin(x)),x,algorithm='fricas')\nintegral(abs(sin(x)), x)\nsage: integrate(abs(sin(x)),x,algorithm='mathematica_free')\n-cos(x)*sgn(sin(x))\n```\n",
    "created_at": "2019-09-15T16:29:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17274#issuecomment-230020",
    "user": "chapoton"
}
```

Indeed. Giac is responsible for the wrong answer. This should be reported upstream.

```
sage: integrate(abs(sin(x)),x,algorithm='maxima')
integrate(abs(sin(x)), x)
sage: integrate(abs(sin(x)),x,algorithm='sympy')
integrate(abs(sin(x)), x)
sage: integrate(abs(sin(x)),x,algorithm='giac')
-cos(x)*sgn(sin(x)) + sgn(sin(x))
sage: integrate(abs(sin(x)),x,algorithm='fricas')
integral(abs(sin(x)), x)
sage: integrate(abs(sin(x)),x,algorithm='mathematica_free')
-cos(x)*sgn(sin(x))
```




---

archive/issue_comments_230021.json:
```json
{
    "body": "But giac is also providing the correct answer for the definite integral, where sympy fails to deliver:\n\n```\nsage: integrate(abs(cos(x)),x,0,44,algorithm='maxima')\nintegrate(abs(cos(x)), x, 0, 44)\nsage: integrate(abs(cos(x)),x,0,44,algorithm='sympy')\n-sin(44) + 4\nsage: integrate(abs(cos(x)),x,0,44,algorithm='giac')\nsin(44) + 28\nsage: integrate(abs(cos(x)),x,0,44,algorithm='fricas')\nintegrate(abs(cos(x)), x, 0, 44)\nsage: integrate(abs(cos(x)),x,0,44,algorithm='mathematica_free')\nsin(44) + 28\n```\n",
    "created_at": "2019-09-15T16:39:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17274#issuecomment-230021",
    "user": "chapoton"
}
```

But giac is also providing the correct answer for the definite integral, where sympy fails to deliver:

```
sage: integrate(abs(cos(x)),x,0,44,algorithm='maxima')
integrate(abs(cos(x)), x, 0, 44)
sage: integrate(abs(cos(x)),x,0,44,algorithm='sympy')
-sin(44) + 4
sage: integrate(abs(cos(x)),x,0,44,algorithm='giac')
sin(44) + 28
sage: integrate(abs(cos(x)),x,0,44,algorithm='fricas')
integrate(abs(cos(x)), x, 0, 44)
sage: integrate(abs(cos(x)),x,0,44,algorithm='mathematica_free')
sin(44) + 28
```




---

archive/issue_comments_230022.json:
```json
{
    "body": "Replying to [comment:13 chapoton]:\n> But giac is also providing the correct answer for the definite integral, where sympy fails to deliver:\n>\n> [...]\n>\n\nwhich should also be reported upstream I guess...",
    "created_at": "2019-09-15T17:36:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17274#issuecomment-230022",
    "user": "vdelecroix"
}
```

Replying to [comment:13 chapoton]:
> But giac is also providing the correct answer for the definite integral, where sympy fails to deliver:
>
> [...]
>

which should also be reported upstream I guess...



---

archive/issue_comments_230023.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2019-09-15T19:18:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17274#issuecomment-230023",
    "user": "chapoton"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_230024.json:
```json
{
    "body": "Samuel, would you please report to giac the failure of comment:12 ?",
    "created_at": "2019-10-06T19:16:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17274#issuecomment-230024",
    "user": "chapoton"
}
```

Samuel, would you please report to giac the failure of comment:12 ?



---

archive/issue_comments_230025.json:
```json
{
    "body": "I emailed Bernard Parisse, here is his reply:\n\n```\nCe n'est pas une erreur, au sens ou un avertissement est renvoy\u00e9\n0>> integrate(abs(sin(x))\nWarning adding 1 ) at end of input\nAttention, l'int\u00e9gration de abs() ou sign() suppose un signe constant\npar intervalles (v\u00e9rifi\u00e9 si l'argument est r\u00e9el):\n  Verifiez [abs(sin(x))]\nDiscontinuit\u00e9s aux zeros de sin(x) were not checked\nsign(sin(x))-cos(x)*sign(sin(x))\n// Time 0.04\n\nC'est \u00e0 l'utilisateur de prendre garde aux discontinuites de la\nprimitive pour calculer une int\u00e9grale d\u00e9finie s'il utilise la primitive\nrenvoy\u00e9e. Lorsqu'on demande \u00e0 giac une int\u00e9grale d\u00e9finie, il essaie de\ntenir compte des discontinuit\u00e9s, et il fait le calcul num\u00e9rique en\nparall\u00e8le pour verifier. En cas de non concordance, les 2 valeurs sont\nrenvoy\u00e9es (la plupart du temps c'est la valeur num\u00e9rique qui est la bonne).\n```\n\nwhich roughly translates as\n\n```\nThis is not an error, in the sense that a warning is issued:\n0>> integrate(abs(sin(x))\nWarning adding 1 ) at end of input\nCaution, integrating abs() or sign() assumes piecewise constant sign\n(check if the argument is real):\nCheck [abs(sin(x))]\nDiscontinuities at zeros of sin(x) were not checked\nsign(sin(x))-cos(x)*sign(sin(x))\n// Time 0.04\n\nIt is up to the user to check for discontinuities of the antiderivative\nto compute an integral using the antiderivative returned by giac.\nWhen asking giac for an integral on an interval, it tries to take\ndiscontinuities into account, and does the numerical integration in parallel\nto check. In case of mismatch, both values are returned (most of the time\nthe numerical value is the one that is correct).\n```\n",
    "created_at": "2019-10-07T11:42:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17274#issuecomment-230025",
    "user": "slelievre"
}
```

I emailed Bernard Parisse, here is his reply:

```
Ce n'est pas une erreur, au sens ou un avertissement est renvoyé
0>> integrate(abs(sin(x))
Warning adding 1 ) at end of input
Attention, l'intégration de abs() ou sign() suppose un signe constant
par intervalles (vérifié si l'argument est réel):
  Verifiez [abs(sin(x))]
Discontinuités aux zeros de sin(x) were not checked
sign(sin(x))-cos(x)*sign(sin(x))
// Time 0.04

C'est à l'utilisateur de prendre garde aux discontinuites de la
primitive pour calculer une intégrale définie s'il utilise la primitive
renvoyée. Lorsqu'on demande à giac une intégrale définie, il essaie de
tenir compte des discontinuités, et il fait le calcul numérique en
parallèle pour verifier. En cas de non concordance, les 2 valeurs sont
renvoyées (la plupart du temps c'est la valeur numérique qui est la bonne).
```

which roughly translates as

```
This is not an error, in the sense that a warning is issued:
0>> integrate(abs(sin(x))
Warning adding 1 ) at end of input
Caution, integrating abs() or sign() assumes piecewise constant sign
(check if the argument is real):
Check [abs(sin(x))]
Discontinuities at zeros of sin(x) were not checked
sign(sin(x))-cos(x)*sign(sin(x))
// Time 0.04

It is up to the user to check for discontinuities of the antiderivative
to compute an integral using the antiderivative returned by giac.
When asking giac for an integral on an interval, it tries to take
discontinuities into account, and does the numerical integration in parallel
to check. In case of mismatch, both values are returned (most of the time
the numerical value is the one that is correct).
```




---

archive/issue_comments_230026.json:
```json
{
    "body": "Ticket retargeted after milestone closed",
    "created_at": "2019-12-30T14:48:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17274#issuecomment-230026",
    "user": "embray"
}
```

Ticket retargeted after milestone closed



---

archive/issue_comments_230027.json:
```json
{
    "body": "Moving tickets to milestone sage-9.2 based on a review of last modification date, branch status, and severity.",
    "created_at": "2020-05-01T04:28:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17274#issuecomment-230027",
    "user": "mkoeppe"
}
```

Moving tickets to milestone sage-9.2 based on a review of last modification date, branch status, and severity.



---

archive/issue_comments_230028.json:
```json
{
    "body": "Moving this ticket to 9.4, as it seems unlikely that it will be merged in 9.3, which is in the release candidate stage",
    "created_at": "2021-04-02T20:21:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17274#issuecomment-230028",
    "user": "mkoeppe"
}
```

Moving this ticket to 9.4, as it seems unlikely that it will be merged in 9.3, which is in the release candidate stage



---

archive/issue_comments_230029.json:
```json
{
    "body": "Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17274#issuecomment-230029",
    "user": "mkoeppe"
}
```

Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_comments_230030.json:
```json
{
    "body": "Stalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.",
    "created_at": "2021-12-18T19:53:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17274#issuecomment-230030",
    "user": "mkoeppe"
}
```

Stalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.
