# Issue 31824: New SPKG for GNU gengetopt

archive/issues_031824.json:
```json
{
    "body": "The latest version of lcalc requires gengetopt to build:\n\n  https://www.gnu.org/software/gengetopt/\n\nWe'll need an SPKG for lcalc to depend on.\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/32061\n\n",
    "created_at": "2021-06-25T17:13:35Z",
    "labels": [
        "packages: standard",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "New SPKG for GNU gengetopt",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31824",
    "user": "@orlitzky"
}
```
The latest version of lcalc requires gengetopt to build:

  https://www.gnu.org/software/gengetopt/

We'll need an SPKG for lcalc to depend on.



Issue created by migration from https://trac.sagemath.org/ticket/32061





---

archive/issue_comments_454840.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-06-25T18:06:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454840",
    "user": "@orlitzky"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_454841.json:
```json
{
    "body": "New commits:",
    "created_at": "2021-06-25T18:06:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454841",
    "user": "@orlitzky"
}
```

New commits:



---

archive/issue_comments_454842.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-25T18:08:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454842",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_454843.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-25T23:03:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454843",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_454844.json:
```json
{
    "body": "Title (first line) in SPKG.rst needs to start with the SPKG name (= directory name in build/pkgs/)",
    "created_at": "2021-06-26T01:21:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454844",
    "user": "@mkoeppe"
}
```

Title (first line) in SPKG.rst needs to start with the SPKG name (= directory name in build/pkgs/)



---

archive/issue_comments_454845.json:
```json
{
    "body": "https://repology.org/project/gengetopt/versions has the missing distro information",
    "created_at": "2021-06-26T01:21:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454845",
    "user": "@mkoeppe"
}
```

https://repology.org/project/gengetopt/versions has the missing distro information



---

archive/issue_comments_454846.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-06-26T01:51:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454846",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_454847.json:
```json
{
    "body": "With the current branch, \"make gengetopt\" persists to try to upload from the mirrors, even if configure says\n\n```\ngengetopt-2.23:                              using system package; SPKG will not be installed\n```\n\nThis is on Ubuntu 20.04\n\n**EDIT** ok, I guess this may be the normal behaviour.",
    "created_at": "2021-06-26T07:13:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454847",
    "user": "@fchapoton"
}
```

With the current branch, "make gengetopt" persists to try to upload from the mirrors, even if configure says

```
gengetopt-2.23:                              using system package; SPKG will not be installed
```

This is on Ubuntu 20.04

**EDIT** ok, I guess this may be the normal behaviour.



---

archive/issue_comments_454848.json:
```json
{
    "body": "ok, installs correctly for me. \n\n`@`mkoeppe : Is there any way to check against many other machine configurations before setting to positive ? Because this will become a standard package, one should be cautious.",
    "created_at": "2021-07-01T07:19:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454848",
    "user": "@fchapoton"
}
```

ok, installs correctly for me. 

`@`mkoeppe : Is there any way to check against many other machine configurations before setting to positive ? Because this will become a standard package, one should be cautious.



---

archive/issue_comments_454849.json:
```json
{
    "body": "Replying to [comment:8 chapoton]:\n> Is there any way to check against many other machine configurations before setting to positive ? Because this will become a standard package, one should be cautious.\n\nYes, see https://doc.sagemath.org/html/en/developer/portability_testing.html#automatic-parallel-tox-runs-on-github-actions",
    "created_at": "2021-07-01T16:10:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454849",
    "user": "@mkoeppe"
}
```

Replying to [comment:8 chapoton]:
> Is there any way to check against many other machine configurations before setting to positive ? Because this will become a standard package, one should be cautious.

Yes, see https://doc.sagemath.org/html/en/developer/portability_testing.html#automatic-parallel-tox-runs-on-github-actions



---

archive/issue_comments_454850.json:
```json
{
    "body": "please also add homebrew gengetopt (yes it is gengetopt)",
    "created_at": "2021-07-01T19:50:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454850",
    "user": "@dimpase"
}
```

please also add homebrew gengetopt (yes it is gengetopt)



---

archive/issue_comments_454851.json:
```json
{
    "body": "Replying to [comment:9 mkoeppe]:\n> Replying to [comment:8 chapoton]:\n> > Is there any way to check against many other machine configurations before setting to positive ? Because this will become a standard package, one should be cautious.\n> \n> Yes, see https://doc.sagemath.org/html/en/developer/portability_testing.html#automatic-parallel-tox-runs-on-github-actions\n\nit can be started from a browser, very cool :-)",
    "created_at": "2021-07-01T19:52:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454851",
    "user": "@dimpase"
}
```

Replying to [comment:9 mkoeppe]:
> Replying to [comment:8 chapoton]:
> > Is there any way to check against many other machine configurations before setting to positive ? Because this will become a standard package, one should be cautious.
> 
> Yes, see https://doc.sagemath.org/html/en/developer/portability_testing.html#automatic-parallel-tox-runs-on-github-actions

it can be started from a browser, very cool :-)



---

archive/issue_comments_454852.json:
```json
{
    "body": "comment:10 needs to be done",
    "created_at": "2021-07-04T08:08:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454852",
    "user": "@fchapoton"
}
```

comment:10 needs to be done



---

archive/issue_comments_454853.json:
```json
{
    "body": "conda has gengetopt too.",
    "created_at": "2021-07-04T10:42:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454853",
    "user": "@dimpase"
}
```

conda has gengetopt too.



---

archive/issue_comments_454854.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-07-04T12:06:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454854",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_454855.json:
```json
{
    "body": "both done",
    "created_at": "2021-07-04T12:07:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454855",
    "user": "@orlitzky"
}
```

both done



---

archive/issue_comments_454856.json:
```json
{
    "body": "do other reviewers agree on a positive review ?",
    "created_at": "2021-07-05T15:37:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454856",
    "user": "@fchapoton"
}
```

do other reviewers agree on a positive review ?



---

archive/issue_comments_454857.json:
```json
{
    "body": "`@`mjo I know it's kind of late for this, but have you considered just shipping the generated C files as part of `lcalc`'s `make dist` and use `AM_MAINTAINER_MODE`, just like one used to do with `bison`?",
    "created_at": "2021-07-05T16:29:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454857",
    "user": "@mkoeppe"
}
```

`@`mjo I know it's kind of late for this, but have you considered just shipping the generated C files as part of `lcalc`'s `make dist` and use `AM_MAINTAINER_MODE`, just like one used to do with `bison`?



---

archive/issue_comments_454858.json:
```json
{
    "body": "Yes, but not too much. The gengetopt input file is preprocessed by `./configure` to avoid duplication (i.e. to avoid leaving the old version in `lcalc --version` after changing `configure.ac`). I'm sure it could still be made to work, but the fact that the source files get touched on the user's machine would involve some autotools voodoo that I didn't really feel like dealing with.",
    "created_at": "2021-07-05T16:41:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454858",
    "user": "@orlitzky"
}
```

Yes, but not too much. The gengetopt input file is preprocessed by `./configure` to avoid duplication (i.e. to avoid leaving the old version in `lcalc --version` after changing `configure.ac`). I'm sure it could still be made to work, but the fact that the source files get touched on the user's machine would involve some autotools voodoo that I didn't really feel like dealing with.



---

archive/issue_comments_454859.json:
```json
{
    "body": "I think gengetopt is small and everywhere, let's just add it and forget about it",
    "created_at": "2021-07-05T16:57:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454859",
    "user": "@dimpase"
}
```

I think gengetopt is small and everywhere, let's just add it and forget about it



---

archive/issue_comments_454860.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-07-05T16:58:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454860",
    "user": "@dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_454861.json:
```json
{
    "body": "Replying to [comment:9 mkoeppe]:\n> Replying to [comment:8 chapoton]:\n> > Is there any way to check against many other machine configurations before setting to positive ? Because this will become a standard package, one should be cautious.\n> \n> Yes, see https://doc.sagemath.org/html/en/developer/portability_testing.html#automatic-parallel-tox-runs-on-github-actions\n\nWell, did someone actually run it on GH Actions?",
    "created_at": "2021-07-05T17:12:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454861",
    "user": "@mkoeppe"
}
```

Replying to [comment:9 mkoeppe]:
> Replying to [comment:8 chapoton]:
> > Is there any way to check against many other machine configurations before setting to positive ? Because this will become a standard package, one should be cautious.
> 
> Yes, see https://doc.sagemath.org/html/en/developer/portability_testing.html#automatic-parallel-tox-runs-on-github-actions

Well, did someone actually run it on GH Actions?



---

archive/issue_comments_454862.json:
```json
{
    "body": "I tried, but everything I tried failed.",
    "created_at": "2021-07-05T19:09:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454862",
    "user": "@fchapoton"
}
```

I tried, but everything I tried failed.



---

archive/issue_comments_454863.json:
```json
{
    "body": "Replying to [comment:22 chapoton]:\n> I tried, but everything I tried failed.\nthe only workflow that can be started from browser is\n`SAGE_ROOT/tox.ini`\n\nstarted here: \nhttps://github.com/sagemath/sagetrac-mirror/actions/runs/1002175317",
    "created_at": "2021-07-05T19:40:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454863",
    "user": "@dimpase"
}
```

Replying to [comment:22 chapoton]:
> I tried, but everything I tried failed.
the only workflow that can be started from browser is
`SAGE_ROOT/tox.ini`

started here: 
https://github.com/sagemath/sagetrac-mirror/actions/runs/1002175317



---

archive/issue_comments_454864.json:
```json
{
    "body": "although many old systems fail due to #32101 not yet merged.",
    "created_at": "2021-07-06T08:49:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454864",
    "user": "@dimpase"
}
```

although many old systems fail due to #32101 not yet merged.



---

archive/issue_comments_454865.json:
```json
{
    "body": "The default build fails if `makeinfo` is not installed. I don't immediately see how to disable it, it seems to be hardwired.\nIn its aclocal.m4 one sees\n\n```\n# Some tools Automake needs.\nAC_REQUIRE([AM_SANITY_CHECK])dnl\nAC_REQUIRE([AC_ARG_PROGRAM])dnl\nAM_MISSING_PROG([ACLOCAL], [aclocal-${am__api_version}])\nAM_MISSING_PROG([AUTOCONF], [autoconf])\nAM_MISSING_PROG([AUTOMAKE], [automake-${am__api_version}])\nAM_MISSING_PROG([AUTOHEADER], [autoheader])\nAM_MISSING_PROG([MAKEINFO], [makeinfo])\nAC_REQUIRE([AM_PROG_INSTALL_SH])dnl\nAC_REQUIRE([AM_PROG_INSTALL_STRIP])dnl\nAC_REQUIRE([AC_PROG_MKDIR_P])dnl\n```\n\n\nso it seems to be treated in the same scope as autotools.",
    "created_at": "2021-07-08T11:23:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454865",
    "user": "@dimpase"
}
```

The default build fails if `makeinfo` is not installed. I don't immediately see how to disable it, it seems to be hardwired.
In its aclocal.m4 one sees

```
# Some tools Automake needs.
AC_REQUIRE([AM_SANITY_CHECK])dnl
AC_REQUIRE([AC_ARG_PROGRAM])dnl
AM_MISSING_PROG([ACLOCAL], [aclocal-${am__api_version}])
AM_MISSING_PROG([AUTOCONF], [autoconf])
AM_MISSING_PROG([AUTOMAKE], [automake-${am__api_version}])
AM_MISSING_PROG([AUTOHEADER], [autoheader])
AM_MISSING_PROG([MAKEINFO], [makeinfo])
AC_REQUIRE([AM_PROG_INSTALL_SH])dnl
AC_REQUIRE([AM_PROG_INSTALL_STRIP])dnl
AC_REQUIRE([AC_PROG_MKDIR_P])dnl
```


so it seems to be treated in the same scope as autotools.



---

archive/issue_comments_454866.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-07-08T11:23:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454866",
    "user": "@dimpase"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_454867.json:
```json
{
    "body": "Should we just add gengetopt to the general pre-reqs instead (and texinfo, for the good measure).\nIn fact if we added texinfo to the general pre-reqs then we'd be able to build gengetopt always.",
    "created_at": "2021-07-08T12:14:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454867",
    "user": "@dimpase"
}
```

Should we just add gengetopt to the general pre-reqs instead (and texinfo, for the good measure).
In fact if we added texinfo to the general pre-reqs then we'd be able to build gengetopt always.



---

archive/issue_comments_454868.json:
```json
{
    "body": "The info/html files are not supposed to be rebuilt (and makeinfo should not be required). There's just some stupid timestamp issue that I need to figure out.",
    "created_at": "2021-07-08T12:55:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454868",
    "user": "@orlitzky"
}
```

The info/html files are not supposed to be rebuilt (and makeinfo should not be required). There's just some stupid timestamp issue that I need to figure out.



---

archive/issue_comments_454869.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-07-08T13:35:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454869",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_454870.json:
```json
{
    "body": "That new commit fixes it, but is a pretty ugly solution. I'm open to suggestions.\n\nThe next version of gengetopt should allow us to disable the documentation: https://git.savannah.gnu.org/cgit/gengetopt.git/commit/?h=devel&id=e3fe8db2b67cdb18e1a2a6765644c8cc476d0b0a",
    "created_at": "2021-07-08T13:41:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454870",
    "user": "@orlitzky"
}
```

That new commit fixes it, but is a pretty ugly solution. I'm open to suggestions.

The next version of gengetopt should allow us to disable the documentation: https://git.savannah.gnu.org/cgit/gengetopt.git/commit/?h=devel&id=e3fe8db2b67cdb18e1a2a6765644c8cc476d0b0a



---

archive/issue_comments_454871.json:
```json
{
    "body": "Replying to [comment:26 dimpase]:\n> Should we just add gengetopt to the general pre-reqs instead (and texinfo, for the good measure).\n\nDefinitely no - it does not exist on macOS without homebrew.\n\n\nI'd suggest to investigate comment 17 above more. \n\nThe generated files are a clear use case for just being shipped in the \"make dist\" of lcalc.",
    "created_at": "2021-07-08T13:59:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454871",
    "user": "@mkoeppe"
}
```

Replying to [comment:26 dimpase]:
> Should we just add gengetopt to the general pre-reqs instead (and texinfo, for the good measure).

Definitely no - it does not exist on macOS without homebrew.


I'd suggest to investigate comment 17 above more. 

The generated files are a clear use case for just being shipped in the "make dist" of lcalc.



---

archive/issue_comments_454872.json:
```json
{
    "body": "Replying to [comment:30 mkoeppe]:\n> \n> I'd suggest to investigate comment 17 above more. \n> \n> The generated files are a clear use case for just being shipped in the \"make dist\" of lcalc. \n> \n\nThis isn't a good long-term solution even if we can hack autotools to avoid re-running gengetopt. Currently only the package name and version (which are static) are substituted into the ggo file, but that should change. For example...\n\n\n\n```\n$ lcalc -O5 -z 10\n\nERROR: lcalc has not been compiled with openmp enabled.\n...\n```\n\n\nIgnoring the nonsense advice it gives you, that option simply shouldn't be present. In other words, `./configure --disable-openmp` should not add the `-O` flag to the gengetopt file. Likewise for the elliptic curve flags that require `--with-pari`. Fixing that will make it thoroughly impossible to ship the generated C++ sources.\n\nI've opened https://gitlab.com/sagemath/lcalc/-/issues/12 to track the issue.",
    "created_at": "2021-07-08T14:42:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454872",
    "user": "@orlitzky"
}
```

Replying to [comment:30 mkoeppe]:
> 
> I'd suggest to investigate comment 17 above more. 
> 
> The generated files are a clear use case for just being shipped in the "make dist" of lcalc. 
> 

This isn't a good long-term solution even if we can hack autotools to avoid re-running gengetopt. Currently only the package name and version (which are static) are substituted into the ggo file, but that should change. For example...



```
$ lcalc -O5 -z 10

ERROR: lcalc has not been compiled with openmp enabled.
...
```


Ignoring the nonsense advice it gives you, that option simply shouldn't be present. In other words, `./configure --disable-openmp` should not add the `-O` flag to the gengetopt file. Likewise for the elliptic curve flags that require `--with-pari`. Fixing that will make it thoroughly impossible to ship the generated C++ sources.

I've opened https://gitlab.com/sagemath/lcalc/-/issues/12 to track the issue.



---

archive/issue_comments_454873.json:
```json
{
    "body": "Replying to [comment:31 mjo]:\n> Replying to [comment:30 mkoeppe]:\n> > \n> > I'd suggest to investigate comment 17 above more. \n> > \n> > The generated files are a clear use case for just being shipped in the \"make dist\" of lcalc. \n> > \n> \n> This isn't a good long-term solution even if we can hack autotools to avoid re-running gengetopt. Currently only the package name and version (which are static) are substituted into the ggo file, but that should change. For example...\n> \n> \n> {{{\n> $ lcalc -O5 -z 10\n> \n> ERROR: lcalc has not been compiled with openmp enabled.\n> ...\n> }}}\n> \n> Ignoring the nonsense advice it gives you, that option simply shouldn't be present.\n\nI don't think so. I think in general a user would prefer that a package informs them about an option disabled at compile time rather than just pretending that it has never heard of this option.",
    "created_at": "2021-07-08T15:44:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454873",
    "user": "@mkoeppe"
}
```

Replying to [comment:31 mjo]:
> Replying to [comment:30 mkoeppe]:
> > 
> > I'd suggest to investigate comment 17 above more. 
> > 
> > The generated files are a clear use case for just being shipped in the "make dist" of lcalc. 
> > 
> 
> This isn't a good long-term solution even if we can hack autotools to avoid re-running gengetopt. Currently only the package name and version (which are static) are substituted into the ggo file, but that should change. For example...
> 
> 
> {{{
> $ lcalc -O5 -z 10
> 
> ERROR: lcalc has not been compiled with openmp enabled.
> ...
> }}}
> 
> Ignoring the nonsense advice it gives you, that option simply shouldn't be present.

I don't think so. I think in general a user would prefer that a package informs them about an option disabled at compile time rather than just pretending that it has never heard of this option.



---

archive/issue_comments_454874.json:
```json
{
    "body": "testing this branch + #32101 on https://github.com/dimpase/sagetrac-mirror/actions/runs/1012429541",
    "created_at": "2021-07-08T17:03:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454874",
    "user": "@dimpase"
}
```

testing this branch + #32101 on https://github.com/dimpase/sagetrac-mirror/actions/runs/1012429541



---

archive/issue_comments_454875.json:
```json
{
    "body": "Replying to [comment:32 mkoeppe]:\n> \n> I don't think so. I think in general a user would prefer that a package informs them about an option disabled at compile time rather than just pretending that it has never heard of this option.\n\nI can see your point, but am still aesthetically opposed to compiling in decoy options. If the user builds lcalc from source, the decoy options do him no good, since he's the one that disabled them in the first place. And if he's using a binary package, having them documented also does him no good, since he can't do anything about it. And in this case, while OpenMP isn't too bad, the pari options significantly clutter up the `--help` output.\n\nIf there were no gengetopt at all, I think these option would have been hidden by an `#if HAVE_FOO` a long time ago.",
    "created_at": "2021-07-08T19:44:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454875",
    "user": "@orlitzky"
}
```

Replying to [comment:32 mkoeppe]:
> 
> I don't think so. I think in general a user would prefer that a package informs them about an option disabled at compile time rather than just pretending that it has never heard of this option.

I can see your point, but am still aesthetically opposed to compiling in decoy options. If the user builds lcalc from source, the decoy options do him no good, since he's the one that disabled them in the first place. And if he's using a binary package, having them documented also does him no good, since he can't do anything about it. And in this case, while OpenMP isn't too bad, the pari options significantly clutter up the `--help` output.

If there were no gengetopt at all, I think these option would have been hidden by an `#if HAVE_FOO` a long time ago.



---

archive/issue_comments_454876.json:
```json
{
    "body": "Replying to [comment:34 mjo]:\n> if he's using a binary package, having them documented also does him no good, since he can't do anything about it.\n\nSure, the user can then complain to the packager.",
    "created_at": "2021-07-08T19:48:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454876",
    "user": "@mkoeppe"
}
```

Replying to [comment:34 mjo]:
> if he's using a binary package, having them documented also does him no good, since he can't do anything about it.

Sure, the user can then complain to the packager.



---

archive/issue_comments_454877.json:
```json
{
    "body": "Replying to [comment:34 mjo]:\n> If the user builds lcalc from source, the decoy options do him no good, since he's the one that disabled them in the first place. \n\nThat may have been 3 years in the past.",
    "created_at": "2021-07-08T19:49:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454877",
    "user": "@mkoeppe"
}
```

Replying to [comment:34 mjo]:
> If the user builds lcalc from source, the decoy options do him no good, since he's the one that disabled them in the first place. 

That may have been 3 years in the past.



---

archive/issue_comments_454878.json:
```json
{
    "body": "\n```\n[gengetopt-2.23] if /bin/bash /var/lib/buildbot/slave/sage_git/build/local/var/tmp/sage/build/gengetopt-2.23/src/build-aux/missing makeinfo   -I . \\\n[gengetopt-2.23]  -o gengetopt.info `test -f 'gengetopt.texi' || echo './'`gengetopt.texi; \\\n[gengetopt-2.23] then \\\n[gengetopt-2.23]   rc=0; \\\n[gengetopt-2.23] else \\\n[gengetopt-2.23]   rc=$?; \\\n[gengetopt-2.23]   $restore $backupdir/* `echo \"./gengetopt.info\" | sed 's|[^/]*$||'`; \\\n[gengetopt-2.23] fi; \\\n[gengetopt-2.23] rm -rf $backupdir; exit $rc\n[gengetopt-2.23] /var/lib/buildbot/slave/sage_git/build/local/var/tmp/sage/build/gengetopt-2.23/src/build-aux/missing: line 81: makeinfo: command not found\n[gengetopt-2.23] WARNING: 'makeinfo' is missing on your system.\n[gengetopt-2.23]          You should only need it if you modified a '.texi' file, or\n[gengetopt-2.23]          any other file indirectly affecting the aspect of the manual.\n[gengetopt-2.23]          You might want to install the Texinfo package:\n[gengetopt-2.23]          <https://www.gnu.org/software/texinfo/>\n[gengetopt-2.23]          The spurious makeinfo call might also be the consequence of\n[gengetopt-2.23]          using a buggy 'make' (AIX, DU, IRIX), in which case you might\n[gengetopt-2.23]          want to install GNU make:\n[gengetopt-2.23]          <https://www.gnu.org/software/make/>\n[gengetopt-2.23] make[8]: *** [Makefile:812: gengetopt.info] Error 127\n```\n",
    "created_at": "2021-07-08T21:16:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454878",
    "user": "@vbraun"
}
```


```
[gengetopt-2.23] if /bin/bash /var/lib/buildbot/slave/sage_git/build/local/var/tmp/sage/build/gengetopt-2.23/src/build-aux/missing makeinfo   -I . \
[gengetopt-2.23]  -o gengetopt.info `test -f 'gengetopt.texi' || echo './'`gengetopt.texi; \
[gengetopt-2.23] then \
[gengetopt-2.23]   rc=0; \
[gengetopt-2.23] else \
[gengetopt-2.23]   rc=$?; \
[gengetopt-2.23]   $restore $backupdir/* `echo "./gengetopt.info" | sed 's|[^/]*$||'`; \
[gengetopt-2.23] fi; \
[gengetopt-2.23] rm -rf $backupdir; exit $rc
[gengetopt-2.23] /var/lib/buildbot/slave/sage_git/build/local/var/tmp/sage/build/gengetopt-2.23/src/build-aux/missing: line 81: makeinfo: command not found
[gengetopt-2.23] WARNING: 'makeinfo' is missing on your system.
[gengetopt-2.23]          You should only need it if you modified a '.texi' file, or
[gengetopt-2.23]          any other file indirectly affecting the aspect of the manual.
[gengetopt-2.23]          You might want to install the Texinfo package:
[gengetopt-2.23]          <https://www.gnu.org/software/texinfo/>
[gengetopt-2.23]          The spurious makeinfo call might also be the consequence of
[gengetopt-2.23]          using a buggy 'make' (AIX, DU, IRIX), in which case you might
[gengetopt-2.23]          want to install GNU make:
[gengetopt-2.23]          <https://www.gnu.org/software/make/>
[gengetopt-2.23] make[8]: *** [Makefile:812: gengetopt.info] Error 127
```




---

archive/issue_comments_454879.json:
```json
{
    "body": "Replying to [comment:37 vbraun]:\n> {{{\n> ...\n> [gengetopt-2.23] make[8]: *** [Makefile:812: gengetopt.info] Error 127\n> }}}\nis this including the latest commit?",
    "created_at": "2021-07-08T22:04:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454879",
    "user": "@dimpase"
}
```

Replying to [comment:37 vbraun]:
> {{{
> ...
> [gengetopt-2.23] make[8]: *** [Makefile:812: gengetopt.info] Error 127
> }}}
is this including the latest commit?



---

archive/issue_comments_454880.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-07-09T16:11:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454880",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_454881.json:
```json
{
    "body": "The new commit works around the \"makeinfo\" problem in a better way. Instead of running \"make\" at the top level, we `cd` into the `gl` and `src` subdirectories and run \"make\" there.",
    "created_at": "2021-07-09T16:12:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454881",
    "user": "@orlitzky"
}
```

The new commit works around the "makeinfo" problem in a better way. Instead of running "make" at the top level, we `cd` into the `gl` and `src` subdirectories and run "make" there.



---

archive/issue_comments_454882.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-07-09T16:12:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454882",
    "user": "@orlitzky"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_454883.json:
```json
{
    "body": "lgtm",
    "created_at": "2021-11-01T12:21:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454883",
    "user": "@dimpase"
}
```

lgtm



---

archive/issue_comments_454884.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-11-01T12:21:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454884",
    "user": "@dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_454885.json:
```json
{
    "body": "Running with SAGE_CHECK=yes still fails:\n\n```\n[gengetopt-2.23]          using a buggy 'make' (AIX, DU, IRIX), in which case you might\n[gengetopt-2.23]          want to install GNU make:\n[gengetopt-2.23]          <https://www.gnu.org/software/make/>\n[gengetopt-2.23] Makefile:842: recipe for target 'gengetopt.html' failed\n[gengetopt-2.23] make[7]: *** [gengetopt.html] Error 1\n[gengetopt-2.23] Makefile:812: recipe for target 'gengetopt.info' failed\n[gengetopt-2.23] make[7]: *** [gengetopt.info] Error 127\n[gengetopt-2.23] make[7]: Target 'check-am' not remade because of errors.\n[gengetopt-2.23] Makefile:1201: recipe for target 'check' failed\n[gengetopt-2.23] make[6]: *** [check] Error 2\n```\n",
    "created_at": "2021-11-06T13:25:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454885",
    "user": "@vbraun"
}
```

Running with SAGE_CHECK=yes still fails:

```
[gengetopt-2.23]          using a buggy 'make' (AIX, DU, IRIX), in which case you might
[gengetopt-2.23]          want to install GNU make:
[gengetopt-2.23]          <https://www.gnu.org/software/make/>
[gengetopt-2.23] Makefile:842: recipe for target 'gengetopt.html' failed
[gengetopt-2.23] make[7]: *** [gengetopt.html] Error 1
[gengetopt-2.23] Makefile:812: recipe for target 'gengetopt.info' failed
[gengetopt-2.23] make[7]: *** [gengetopt.info] Error 127
[gengetopt-2.23] make[7]: Target 'check-am' not remade because of errors.
[gengetopt-2.23] Makefile:1201: recipe for target 'check' failed
[gengetopt-2.23] make[6]: *** [check] Error 2
```




---

archive/issue_comments_454886.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-11-06T13:25:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454886",
    "user": "@vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_454887.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-06T16:41:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454887",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_454888.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2021-11-06T16:43:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454888",
    "user": "@orlitzky"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_454889.json:
```json
{
    "body": "Replying to [comment:43 vbraun]:\n> Running with SAGE_CHECK=yes still fails:\n\nWhoops, we need to copy the fix from `spkg-build.in` into `spkg-check.in`, too. Should work now.",
    "created_at": "2021-11-06T16:43:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454889",
    "user": "@orlitzky"
}
```

Replying to [comment:43 vbraun]:
> Running with SAGE_CHECK=yes still fails:

Whoops, we need to copy the fix from `spkg-build.in` into `spkg-check.in`, too. Should work now.



---

archive/issue_comments_454890.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-11-12T21:27:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31824#issuecomment-454890",
    "user": "@vbraun"
}
```

Resolution: fixed
