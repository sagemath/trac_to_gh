# Issue 12204: BipartiteGraph complement

archive/issues_012204.json:
```json
{
    "body": "Assignee: brunellus\n\nCC:  tscrim\n\n\n```\nsage: B = BipartiteGraph({0:[1,2]})\nsage: print(B.complement())\n...\n  File \"/sagenb/sage_install/sage-4.7.2/local/lib/python2.6/site-packages/sage/graphs/generic_graph.py\", line 11939, in complement\n    G.add_edge(u,v)\n  File \"/sagenb/sage_install/sage-4.7.2/local/lib/python2.6/site-packages/sage/graphs/bipartite_graph.py\", line 766, in add_edge\n    \"Edge vertices must lie in different partitions.\")\nRuntimeError: Edge vertices must lie in different partitions.\n```\n\n\nIt is natural to understand complement on BipartiteGraph object in the bipartite context, i.e. excluding possible edges between vertices in the same partition. Currently there is no such implementation in the BipartiteGraph object and call falls back to the GenericGraph implementation.\n\nIssue created by migration from https://trac.sagemath.org/ticket/12376\n\n",
    "created_at": "2012-01-28T12:19:23Z",
    "labels": [
        "graph theory",
        "major",
        "bug"
    ],
    "title": "BipartiteGraph complement",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12204",
    "user": "brunellus"
}
```
Assignee: brunellus

CC:  tscrim


```
sage: B = BipartiteGraph({0:[1,2]})
sage: print(B.complement())
...
  File "/sagenb/sage_install/sage-4.7.2/local/lib/python2.6/site-packages/sage/graphs/generic_graph.py", line 11939, in complement
    G.add_edge(u,v)
  File "/sagenb/sage_install/sage-4.7.2/local/lib/python2.6/site-packages/sage/graphs/bipartite_graph.py", line 766, in add_edge
    "Edge vertices must lie in different partitions.")
RuntimeError: Edge vertices must lie in different partitions.
```


It is natural to understand complement on BipartiteGraph object in the bipartite context, i.e. excluding possible edges between vertices in the same partition. Currently there is no such implementation in the BipartiteGraph object and call falls back to the GenericGraph implementation.

Issue created by migration from https://trac.sagemath.org/ticket/12376





---

archive/issue_comments_142571.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-01-28T13:09:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12204#issuecomment-142571",
    "user": "brunellus"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_142572.json:
```json
{
    "body": "Attachment [trac_12376_bipartite_complement.patch](tarball://root/attachments/some-uuid/ticket12376/trac_12376_bipartite_complement.patch) by ncohen created at 2012-01-29 18:19:04\n\nHmmm.... I am sorry but these things are really dangerous... `:-/`\n\nWhat would happen if one of the functions BipartiteGraph inherits has to compute the complement of the graph at some point ? The result would not be the one intended.... `:-/`\n\nNathann",
    "created_at": "2012-01-29T18:19:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12204#issuecomment-142572",
    "user": "ncohen"
}
```

Attachment [trac_12376_bipartite_complement.patch](tarball://root/attachments/some-uuid/ticket12376/trac_12376_bipartite_complement.patch) by ncohen created at 2012-01-29 18:19:04

Hmmm.... I am sorry but these things are really dangerous... `:-/`

What would happen if one of the functions BipartiteGraph inherits has to compute the complement of the graph at some point ? The result would not be the one intended.... `:-/`

Nathann



---

archive/issue_comments_142573.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2012-01-29T18:19:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12204#issuecomment-142573",
    "user": "ncohen"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_142574.json:
```json
{
    "body": "I think that the correct behaviour there would be to throw an exception whenever the Bipartite graph contains two vertices in the same partition (=> the result is not bipartite, or does not respect the bipartition stored), and to define a complement_bipartite() method. Actually bipartite_complement would be better, but it would be easier to find if named bipartite_complement.\n\nNathann",
    "created_at": "2012-01-29T18:20:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12204#issuecomment-142574",
    "user": "ncohen"
}
```

I think that the correct behaviour there would be to throw an exception whenever the Bipartite graph contains two vertices in the same partition (=> the result is not bipartite, or does not respect the bipartition stored), and to define a complement_bipartite() method. Actually bipartite_complement would be better, but it would be easier to find if named bipartite_complement.

Nathann



---

archive/issue_comments_142575.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2016-08-21T04:48:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12204#issuecomment-142575",
    "user": "jmantysalo"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_142576.json:
```json
{
    "body": "Original error report was misleading, as this has been changed. Anyways, currently `.complement()` returns wrong type.",
    "created_at": "2016-08-21T04:48:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12204#issuecomment-142576",
    "user": "jmantysalo"
}
```

Original error report was misleading, as this has been changed. Anyways, currently `.complement()` returns wrong type.



---

archive/issue_comments_142577.json:
```json
{
    "body": "Travis, can you comment this?\n\nIf I make a special case for `BipartiteGraph`, it will break if there will be another subclass of `Graph`. So I should just check for `isinstance(g, sage.graphs.digraph.DiGraph)` and `isinstance(g, sage.graphs.graph.Graph)` and then make a copy like `Graph(self)`. However the docstring for that says \"Please use this method only if you need to copy but change the underlying implementation or weightedness.  Otherwise simply do `copy(g)` - -\".\n\nSo what is the right thing to do?",
    "created_at": "2016-08-22T03:47:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12204#issuecomment-142577",
    "user": "jmantysalo"
}
```

Travis, can you comment this?

If I make a special case for `BipartiteGraph`, it will break if there will be another subclass of `Graph`. So I should just check for `isinstance(g, sage.graphs.digraph.DiGraph)` and `isinstance(g, sage.graphs.graph.Graph)` and then make a copy like `Graph(self)`. However the docstring for that says "Please use this method only if you need to copy but change the underlying implementation or weightedness.  Otherwise simply do `copy(g)` - -".

So what is the right thing to do?



---

archive/issue_comments_142578.json:
```json
{
    "body": "Hmm...I'm really not sure. The problem is that doing stuff to the backend doesn't reflect the front-end class (normally if you added an edge that breaks the bipartite-ness, then it errors out). I would implement a `BipartiteGraph.complement` that either checks the output is bipartite and errors out if not or generically constructs the corresponding `Graph`.",
    "created_at": "2016-08-22T04:25:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12204#issuecomment-142578",
    "user": "tscrim"
}
```

Hmm...I'm really not sure. The problem is that doing stuff to the backend doesn't reflect the front-end class (normally if you added an edge that breaks the bipartite-ness, then it errors out). I would implement a `BipartiteGraph.complement` that either checks the output is bipartite and errors out if not or generically constructs the corresponding `Graph`.



---

archive/issue_comments_142579.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-08-22T05:35:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12204#issuecomment-142579",
    "user": "jmantysalo"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_142580.json:
```json
{
    "body": "Like this?\n\nBut this will not help if there will be another subclass of generic graphs. Anyways, this corrects this particular problem for now.\n----\nNew commits:",
    "created_at": "2016-08-22T05:35:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12204#issuecomment-142580",
    "user": "jmantysalo"
}
```

Like this?

But this will not help if there will be another subclass of generic graphs. Anyways, this corrects this particular problem for now.
----
New commits:



---

archive/issue_comments_142581.json:
```json
{
    "body": "Just pinging. At least this fixes a bug.",
    "created_at": "2016-09-02T11:50:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12204#issuecomment-142581",
    "user": "jmantysalo"
}
```

Just pinging. At least this fixes a bug.



---

archive/issue_comments_142582.json:
```json
{
    "body": "Agreed. (Sorry about this dropping off my radar.)",
    "created_at": "2016-09-02T14:34:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12204#issuecomment-142582",
    "user": "tscrim"
}
```

Agreed. (Sorry about this dropping off my radar.)



---

archive/issue_comments_142583.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-09-02T14:34:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12204#issuecomment-142583",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_142584.json:
```json
{
    "body": "Thanks. And no horry: I work on several tickets, so nothing gets stalled for one ticket being in review queue.",
    "created_at": "2016-09-02T16:48:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12204#issuecomment-142584",
    "user": "jmantysalo"
}
```

Thanks. And no horry: I work on several tickets, so nothing gets stalled for one ticket being in review queue.



---

archive/issue_comments_142585.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-09-04T00:14:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12204",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12204#issuecomment-142585",
    "user": "vbraun"
}
```

Resolution: fixed
