# Issue 22667: numerical noise in sage/matrix/matrix_double_dense.pyx

archive/issues_022667.json:
```json
{
    "body": "CC:  @strogdon\n\nI get the following doctest failures in sage-on-gentoo\n\n```\nsage -t --long /usr/lib64/python2.7/site-packages/sage/matrix/matrix_double_dense.pyx\n**********************************************************************\nFile \"/usr/lib64/python2.7/site-packages/sage/matrix/matrix_double_dense.pyx\", line 628, in sage.matrix.matrix_double_dense.Matrix_double_dense.condition\nFailed example:\n    A.condition(p=Infinity)  # tol 2e-14\nExpected:\n    22738.50000000045\nGot:\n    22738.499999999945\nTolerance exceeded:\n    22738.50000000045 vs 22738.499999999945, tolerance 2e-14 > 2e-14\n**********************************************************************\nFile \"/usr/lib64/python2.7/site-packages/sage/matrix/matrix_double_dense.pyx\", line 1787, in sage.matrix.matrix_double_dense.Matrix_double_dense.solve_left\nFailed example:\n    x = A.solve_left(b); x.zero_at(1e-17) # fix noisy zeroes\nExpected:\n    (0.666666666..., 0.0, 0.333333333...)\nGot:\n    (0.6666666666666666, 1.50030138462859e-17, 0.3333333333333332)\n**********************************************************************\n```\nAt first I thought it was caused by a difference in openblas version but it turns out out not to be the case. Probably hardware tuning related.\n\nThis ticket will raise the tolerance of these tests a little bit to accomodate the failure\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/22904\n\n",
    "closed_at": "2017-05-04T21:00:33Z",
    "created_at": "2017-04-29T21:11:23Z",
    "labels": [
        "component: numerical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "numerical noise in sage/matrix/matrix_double_dense.pyx",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22667",
    "user": "https://github.com/kiwifb"
}
```
CC:  @strogdon

I get the following doctest failures in sage-on-gentoo

```
sage -t --long /usr/lib64/python2.7/site-packages/sage/matrix/matrix_double_dense.pyx
**********************************************************************
File "/usr/lib64/python2.7/site-packages/sage/matrix/matrix_double_dense.pyx", line 628, in sage.matrix.matrix_double_dense.Matrix_double_dense.condition
Failed example:
    A.condition(p=Infinity)  # tol 2e-14
Expected:
    22738.50000000045
Got:
    22738.499999999945
Tolerance exceeded:
    22738.50000000045 vs 22738.499999999945, tolerance 2e-14 > 2e-14
**********************************************************************
File "/usr/lib64/python2.7/site-packages/sage/matrix/matrix_double_dense.pyx", line 1787, in sage.matrix.matrix_double_dense.Matrix_double_dense.solve_left
Failed example:
    x = A.solve_left(b); x.zero_at(1e-17) # fix noisy zeroes
Expected:
    (0.666666666..., 0.0, 0.333333333...)
Got:
    (0.6666666666666666, 1.50030138462859e-17, 0.3333333333333332)
**********************************************************************
```
At first I thought it was caused by a difference in openblas version but it turns out out not to be the case. Probably hardware tuning related.

This ticket will raise the tolerance of these tests a little bit to accomodate the failure


Issue created by migration from https://trac.sagemath.org/ticket/22904





---

archive/issue_comments_315766.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-04-29T21:12:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22667#issuecomment-315766",
    "user": "https://github.com/kiwifb"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_315767.json:
```json
{
    "body": "Hi Steve,\n\nwould you mind reviewing this? This is fairly minor.\n\n---\nNew commits:",
    "created_at": "2017-04-29T21:12:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22667#issuecomment-315767",
    "user": "https://github.com/kiwifb"
}
```

Hi Steve,

would you mind reviewing this? This is fairly minor.

---
New commits:



---

archive/issue_comments_315768.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-04-30T00:54:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22667#issuecomment-315768",
    "user": "https://github.com/strogdon"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_315769.json:
```json
{
    "body": "I suppose you get the same with vanilla. Here my SoG and vanilla are identical for the first example. There are only minor difference for the second, but no noise in the `zero` value. Openblas version does not seem to affect results here. I have had similar problems with this particular test in the past.",
    "created_at": "2017-04-30T00:54:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22667#issuecomment-315769",
    "user": "https://github.com/strogdon"
}
```

I suppose you get the same with vanilla. Here my SoG and vanilla are identical for the first example. There are only minor difference for the second, but no noise in the `zero` value. Openblas version does not seem to affect results here. I have had similar problems with this particular test in the past.



---

archive/issue_comments_315770.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-05-04T21:00:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22667#issuecomment-315770",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_059450.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-05-04T21:00:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22667",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22667#event-59450"
}
```
