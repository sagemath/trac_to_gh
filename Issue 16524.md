# Issue 16524: Error message bad when trying to make vector symbolic expression

archive/issues_016524.json:
```json
{
    "body": "CC:  @tscrim\n\n\n```\nsage: symbolic_expression(vector([1,2]))\n<boom>\nTypeError:\n```\n\nThis is pretty uninformative, esp. when it is in [the midst of a larger computation](http://ask.sagemath.org/question/23690/how-to-fit-data-to-an-arrhenius-equation/).\n\nI'm not suggesting we make a vector a symbolic expression, though of course \n\n```\nsage: vector([x,2*x])\n```\n\nworks so we could go that way.\n\nIssue created by migration from https://trac.sagemath.org/ticket/16761\n\n",
    "created_at": "2014-08-05T01:36:04Z",
    "labels": [
        "component: symbolics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "Error message bad when trying to make vector symbolic expression",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16524",
    "user": "https://github.com/kcrisman"
}
```
CC:  @tscrim


```
sage: symbolic_expression(vector([1,2]))
<boom>
TypeError:
```

This is pretty uninformative, esp. when it is in [the midst of a larger computation](http://ask.sagemath.org/question/23690/how-to-fit-data-to-an-arrhenius-equation/).

I'm not suggesting we make a vector a symbolic expression, though of course 

```
sage: vector([x,2*x])
```

works so we could go that way.

Issue created by migration from https://trac.sagemath.org/ticket/16761





---

archive/issue_comments_217151.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-07-06T05:03:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16524#issuecomment-217151",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_217152.json:
```json
{
    "body": "New commits:",
    "created_at": "2021-07-06T05:03:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16524#issuecomment-217152",
    "user": "https://github.com/mkoeppe"
}
```

New commits:



---

archive/issue_comments_217153.json:
```json
{
    "body": "It's always so great to wake up to someone working on a ticket from seven years ago :-)\n\nI agree that this is the preferred way to handle it, and on a first pass the code looks good for it.  I do have two usage questions.\n\n```\nsage: f = symbolic_expression(lambda z: z^2 + 1); f\n```\n\nAm I correct that this does *not* inject `z` into the global namespace?  This seems to be how you constructed it with `SR.var`.\n\nAlso, I'm not familiar with `SR.subring(no_variables=True)`, which is presumably what generates the \"Symbolic Constants Subring\".  If someone later wanted to take something like `symbolic_expression(vector(QQ, 0))` and then add it to another (zero-dimensional) vector, how would that behave?  Would it complain because it has a different base ring?  Or would it do the \"obvious\" thing in any of these degenerate cases?  I don't know if there is a \"right\" answer here (for degenerate cases), but I wanted to ask.\n\nFinally, it could be fun to exemplify the recursive nature of the code by having a vector composed of vector functions or something.  Though I doubt that would be a real use case; this ticket is more to make sure that if people insist on making everything \"symbolic\" that nothing goes boom.",
    "created_at": "2021-07-06T12:05:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16524#issuecomment-217153",
    "user": "https://github.com/kcrisman"
}
```

It's always so great to wake up to someone working on a ticket from seven years ago :-)

I agree that this is the preferred way to handle it, and on a first pass the code looks good for it.  I do have two usage questions.

```
sage: f = symbolic_expression(lambda z: z^2 + 1); f
```

Am I correct that this does *not* inject `z` into the global namespace?  This seems to be how you constructed it with `SR.var`.

Also, I'm not familiar with `SR.subring(no_variables=True)`, which is presumably what generates the "Symbolic Constants Subring".  If someone later wanted to take something like `symbolic_expression(vector(QQ, 0))` and then add it to another (zero-dimensional) vector, how would that behave?  Would it complain because it has a different base ring?  Or would it do the "obvious" thing in any of these degenerate cases?  I don't know if there is a "right" answer here (for degenerate cases), but I wanted to ask.

Finally, it could be fun to exemplify the recursive nature of the code by having a vector composed of vector functions or something.  Though I doubt that would be a real use case; this ticket is more to make sure that if people insist on making everything "symbolic" that nothing goes boom.



---

archive/issue_comments_217154.json:
```json
{
    "body": "Replying to [comment:5 kcrisman]:\n> {{{\n> sage: f = symbolic_expression(lambda z: z^2 + 1); f\n> }}}\n> Am I correct that this does *not* inject `z` into the global namespace?  This seems to be how you constructed it with `SR.var`.\n\nThat's right. (Note this is from #32103, not the present ticket.)",
    "created_at": "2021-07-06T12:34:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16524#issuecomment-217154",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:5 kcrisman]:
> {{{
> sage: f = symbolic_expression(lambda z: z^2 + 1); f
> }}}
> Am I correct that this does *not* inject `z` into the global namespace?  This seems to be how you constructed it with `SR.var`.

That's right. (Note this is from #32103, not the present ticket.)



---

archive/issue_comments_217155.json:
```json
{
    "body": "Replying to [comment:5 kcrisman]:\n> Also, I'm not familiar with `SR.subring(no_variables=True)`, which is presumably what generates the \"Symbolic Constants Subring\".  If someone later wanted to take something like `symbolic_expression(vector(QQ, 0))` and then add it to another (zero-dimensional) vector, how would that behave?\nThe coercion system takes care of it:\n\n```\nsage: vector(SR.subring(no_variables=True), 0) + vector(SR, 0) + vector(ZZ, 0)\n()\nsage: _.parent()\nVector space of dimension 0 over Symbolic Ring\n```\n",
    "created_at": "2021-07-06T12:36:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16524#issuecomment-217155",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:5 kcrisman]:
> Also, I'm not familiar with `SR.subring(no_variables=True)`, which is presumably what generates the "Symbolic Constants Subring".  If someone later wanted to take something like `symbolic_expression(vector(QQ, 0))` and then add it to another (zero-dimensional) vector, how would that behave?
The coercion system takes care of it:

```
sage: vector(SR.subring(no_variables=True), 0) + vector(SR, 0) + vector(ZZ, 0)
()
sage: _.parent()
Vector space of dimension 0 over Symbolic Ring
```




---

archive/issue_comments_217156.json:
```json
{
    "body": "Replying to [comment:5 kcrisman]:\n > it could be fun to exemplify the recursive nature of the code by having a vector composed of vector functions or something.  Though I doubt that would be a real use case; this ticket is more to make sure that if people insist on making everything \"symbolic\" that nothing goes boom.\n\nI think I'd rather not advertise more complicated possible uses of this function at this point. I only became aware of its existence when I was looking for a preparser-less idiom for creating callable symbolic expressions (#32103).",
    "created_at": "2021-07-06T12:43:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16524#issuecomment-217156",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:5 kcrisman]:
 > it could be fun to exemplify the recursive nature of the code by having a vector composed of vector functions or something.  Though I doubt that would be a real use case; this ticket is more to make sure that if people insist on making everything "symbolic" that nothing goes boom.

I think I'd rather not advertise more complicated possible uses of this function at this point. I only became aware of its existence when I was looking for a preparser-less idiom for creating callable symbolic expressions (#32103).



---

archive/issue_comments_217157.json:
```json
{
    "body": "> I only became aware of its existence when I was looking for a preparser-less idiom for creating callable symbolic expressions (#32103). \n\nI see now.  I certainly can give positive review to the changes for this ticket (modulo green patchbot).  I'll make one or two other comments there.  Thanks for fixing this!",
    "created_at": "2021-07-06T12:49:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16524#issuecomment-217157",
    "user": "https://github.com/kcrisman"
}
```

> I only became aware of its existence when I was looking for a preparser-less idiom for creating callable symbolic expressions (#32103). 

I see now.  I certainly can give positive review to the changes for this ticket (modulo green patchbot).  I'll make one or two other comments there.  Thanks for fixing this!



---

archive/issue_comments_217158.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-06T13:41:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16524#issuecomment-217158",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_217159.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-07-26T17:55:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16524#issuecomment-217159",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_217160.json:
```json
{
    "body": "Doctest failures",
    "created_at": "2021-07-26T17:55:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16524#issuecomment-217160",
    "user": "https://github.com/mkoeppe"
}
```

Doctest failures



---

archive/issue_comments_217161.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-26T20:14:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16524#issuecomment-217161",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_217162.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-07-26T20:15:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16524#issuecomment-217162",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_217163.json:
```json
{
    "body": "Do we also want to support the case when a list of lists is passed to create a symbolic matrix? It could be done by\n\n```diff\n     elif isinstance(x, (tuple, list)) or is_FreeModuleElement(x):\n         expressions = [symbolic_expression(item) for item in x]\n         if not expressions:\n             # Make sure it is symbolic also when length is 0\n             return vector(SR.subring(no_variables=True), 0)\n+        if is_FreeModuleElement(expressions[0]):\n+            return matrix(expressions)\n         return vector(expressions)\n```\n",
    "created_at": "2021-07-26T22:43:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16524#issuecomment-217163",
    "user": "https://github.com/tscrim"
}
```

Do we also want to support the case when a list of lists is passed to create a symbolic matrix? It could be done by

```diff
     elif isinstance(x, (tuple, list)) or is_FreeModuleElement(x):
         expressions = [symbolic_expression(item) for item in x]
         if not expressions:
             # Make sure it is symbolic also when length is 0
             return vector(SR.subring(no_variables=True), 0)
+        if is_FreeModuleElement(expressions[0]):
+            return matrix(expressions)
         return vector(expressions)
```




---

archive/issue_comments_217164.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-26T23:45:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16524#issuecomment-217164",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_217165.json:
```json
{
    "body": "Good idea, done",
    "created_at": "2021-07-26T23:46:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16524#issuecomment-217165",
    "user": "https://github.com/mkoeppe"
}
```

Good idea, done



---

archive/issue_comments_217166.json:
```json
{
    "body": "Thanks. Green bot => positive review.",
    "created_at": "2021-07-27T01:53:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16524#issuecomment-217166",
    "user": "https://github.com/tscrim"
}
```

Thanks. Green bot => positive review.



---

archive/issue_comments_217167.json:
```json
{
    "body": "Using the symbolic constants ring actually depends on #31999, #31988",
    "created_at": "2021-08-03T19:13:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16524#issuecomment-217167",
    "user": "https://github.com/mkoeppe"
}
```

Using the symbolic constants ring actually depends on #31999, #31988



---

archive/issue_comments_217168.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-03T19:32:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16524#issuecomment-217168",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_217169.json:
```json
{
    "body": "Another issue remains - symbolic matrices have no `function` method\n\n```\nsage -t --random-seed=0 src/sage/symbolic/expression.pyx\n**********************************************************************\nFile \"src/sage/symbolic/expression.pyx\", line 3186, in sage.symbolic.expression.Expression.__nonzero__\nFailed example:\n    f(x) = matrix()\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/doctest/forker.py\", line 718, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/doctest/forker.py\", line 1137, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.symbolic.expression.Expression.__nonzero__[87]>\", line 1, in <module>\n        __tmp__=var(\"x\"); f = symbolic_expression(matrix()).function(x)\n      File \"sage/structure/element.pyx\", line 493, in sage.structure.element.Element.__getattr__\n        return self.getattr_from_category(name)\n      File \"sage/structure/element.pyx\", line 506, in sage.structure.element.Element.getattr_from_category\n        return getattr_from_other_class(self, cls, name)\n      File \"sage/cpython/getattr.pyx\", line 372, in sage.cpython.getattr.getattr_from_other_class\n        raise AttributeError(dummy_error_message)\n    AttributeError: 'sage.matrix.matrix_symbolic_dense.Matrix_symbolic_dense' object has no attribute 'function'\n```\n",
    "created_at": "2021-08-03T19:37:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16524#issuecomment-217169",
    "user": "https://github.com/mkoeppe"
}
```

Another issue remains - symbolic matrices have no `function` method

```
sage -t --random-seed=0 src/sage/symbolic/expression.pyx
**********************************************************************
File "src/sage/symbolic/expression.pyx", line 3186, in sage.symbolic.expression.Expression.__nonzero__
Failed example:
    f(x) = matrix()
Exception raised:
    Traceback (most recent call last):
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/doctest/forker.py", line 718, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/doctest/forker.py", line 1137, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.symbolic.expression.Expression.__nonzero__[87]>", line 1, in <module>
        __tmp__=var("x"); f = symbolic_expression(matrix()).function(x)
      File "sage/structure/element.pyx", line 493, in sage.structure.element.Element.__getattr__
        return self.getattr_from_category(name)
      File "sage/structure/element.pyx", line 506, in sage.structure.element.Element.getattr_from_category
        return getattr_from_other_class(self, cls, name)
      File "sage/cpython/getattr.pyx", line 372, in sage.cpython.getattr.getattr_from_other_class
        raise AttributeError(dummy_error_message)
    AttributeError: 'sage.matrix.matrix_symbolic_dense.Matrix_symbolic_dense' object has no attribute 'function'
```




---

archive/issue_comments_217170.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-03T19:49:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16524#issuecomment-217170",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_217171.json:
```json
{
    "body": "This works now but it is not perfect yet because we do not have a matrix element class in analogy to `Vector_callable_symbolic_dense`, so the repr of such callable symbolic matrices does not look nice. But this is a cosmetic wishlist item that is already noted in #31988.",
    "created_at": "2021-08-03T20:03:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16524#issuecomment-217171",
    "user": "https://github.com/mkoeppe"
}
```

This works now but it is not perfect yet because we do not have a matrix element class in analogy to `Vector_callable_symbolic_dense`, so the repr of such callable symbolic matrices does not look nice. But this is a cosmetic wishlist item that is already noted in #31988.



---

archive/issue_comments_217172.json:
```json
{
    "body": "I have noticed in the past other inconsistencies between matrices and vectors over symbolic rings with elements in SR. I just can't remember them now. We can just add any missing functionality as we come across it.\n\nAnyways, the current branch LGTM.",
    "created_at": "2021-08-05T22:40:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16524#issuecomment-217172",
    "user": "https://github.com/tscrim"
}
```

I have noticed in the past other inconsistencies between matrices and vectors over symbolic rings with elements in SR. I just can't remember them now. We can just add any missing functionality as we come across it.

Anyways, the current branch LGTM.



---

archive/issue_comments_217173.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-08-05T22:40:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16524#issuecomment-217173",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_217174.json:
```json
{
    "body": "Thanks!",
    "created_at": "2021-08-09T20:01:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16524#issuecomment-217174",
    "user": "https://github.com/mkoeppe"
}
```

Thanks!



---

archive/issue_comments_217175.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-08-29T09:37:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16524#issuecomment-217175",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_016021.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-08-29T09:37:59Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16524",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16524#event-16021"
}
```
