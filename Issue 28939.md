# Issue 28939: Bug in Voronoi Diagram

Issue created by migration from https://trac.sagemath.org/ticket/29176

Original creator: jipilab

Original creation time: 2020-02-10 12:53:15

CC:  jipilab @laisrast

The following should give two non-empty regions:


```
sage: P = [[-2687.19, -2088.53], [-2686.81, -2084.19]]
....: V = VoronoiDiagram(P)
....: R = V.regions()
....: 
sage: R
{P(-2687.19000000000, -2088.53000000000): The empty polyhedron in RDF^0,
 P(-2686.81000000000, -2084.19000000000): A 1-dimensional polyhedron in RDF^2 defined as the convex hull of 1 vertex and 1 ray
```


This way reported here:

https://ask.sagemath.org/question/49749/voronoidiagram-returns-empty-regions/


---

Comment by @kliem created at 2020-03-19 11:12:56

This can and should be solved by fetching the incidences from cdd.

I will try to do so. This might get rid of a lot of numerical inconsistencies.


---

Comment by @kliem created at 2020-03-19 14:55:32

New commits:


---

Comment by @kliem created at 2020-03-19 14:55:32

Changing keywords from "" to "cdd, incidence matrix".


---

Comment by @kliem created at 2020-03-19 14:55:32

Changing status from new to needs_review.


---

Comment by jipilab created at 2020-04-19 13:33:56

Thanks! Looks good to me.


---

Comment by jipilab created at 2020-04-19 13:33:56

Changing status from needs_review to positive_review.


---

Comment by @kliem created at 2020-04-19 13:34:34

Thank you.


---

Comment by vbraun created at 2020-04-21 22:42:38

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2020-04-21 22:42:38

On Python 2 Debian 9 x86_64:

```
**********************************************************************
File "src/sage/geometry/polyhedron/backend_cdd.py", line 231, in sage.geometry.polyhedron.backend_cdd.Polyhedron_cdd._init_from_cdd_output
Failed example:
    R
Expected:
    {P(-2686.81000000000, -2084.19000000000): A 2-dimensional polyhedron in RDF^2 defined as the convex hull of 1 vertex, 1 ray, 1 line,
     P(-2687.19000000000, -2088.53000000000): A 2-dimensional polyhedron in RDF^2 defined as the convex hull of 1 vertex, 1 ray, 1 line}
Got:
    {P(-2687.19000000000, -2088.53000000000): A 2-dimensional polyhedron in RDF^2 defined as the convex hull of 1 vertex, 1 ray, 1 line,
     P(-2686.81000000000, -2084.19000000000): A 2-dimensional polyhedron in RDF^2 defined as the convex hull of 1 vertex, 1 ray, 1 line}
**********************************************************************
1 item had failures:
```



---

Comment by git created at 2020-04-22 05:40:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @kliem created at 2020-04-22 05:41:12

Changing status from needs_work to needs_review.


---

Comment by @kliem created at 2020-04-22 05:41:12

I tested this in python2:


```
>>> {(-2686.81000000000, -2084.19000000000): 0, (-2687.19000000000, -2088.53000000000): 0}
{(-2687.19, -2088.53): 0, (-2686.81, -2084.19): 0}
```


So the fix should work fine.


---

Comment by jipilab created at 2020-04-22 12:34:45

Changing status from needs_review to positive_review.


---

Comment by jipilab created at 2020-04-22 12:34:45

Thanks for the quick fix.


---

Comment by vbraun created at 2020-04-23 22:32:59

Resolution: fixed


---

Comment by vbraun created at 2020-04-25 08:52:42

Changing status from closed to new.


---

Comment by vbraun created at 2020-04-25 08:52:42


```
**********************************************************************
File "src/sage/geometry/polyhedron/backend_cdd.py", line 234, in sage.geometry.polyhedron.backend_cdd.Polyhedron_cdd._init_from_cdd_output
Failed example:
    R  # py2
Expected:
    {P(-2687.19000000000, -2088.53000000000): A 2-dimensional polyhedron in RDF^2 defined as the convex hull of 1 vertex, 1 ray, 1 line,
     P(-2686.81000000000, -2084.19000000000): A 2-dimensional polyhedron in RDF^2 defined as the convex hull of 1 vertex, 1 ray, 1 line}
Got:
    {P(-2686.81000000000, -2084.19000000000): A 2-dimensional polyhedron in RDF^2 defined as the convex hull of 1 vertex, 1 ray, 1 line,
     P(-2687.19000000000, -2088.53000000000): A 2-dimensional polyhedron in RDF^2 defined as the convex hull of 1 vertex, 1 ray, 1 line}
**********************************************************************
1 item had failures:
   1 of  10 in sage.geometry.polyhedron.backend_cdd.Polyhedron_cdd._init_from_cdd_output
    [46 tests, 1 failure, 0.59 s]
**********************************************************************
```



---

Comment by vbraun created at 2020-04-25 08:52:42

Resolution changed from fixed to 


---

Comment by @kliem created at 2020-04-25 22:12:49

Got rid of the dictionary printing in the tests.
----
New commits:


---

Comment by @kliem created at 2020-04-25 22:12:49

Changing status from new to needs_review.


---

Comment by jipilab created at 2020-04-27 07:24:17

Changing status from needs_review to positive_review.


---

Comment by @kliem created at 2020-04-27 07:24:46

Thank you.


---

Comment by vbraun created at 2020-05-02 21:58:26

Resolution: fixed
