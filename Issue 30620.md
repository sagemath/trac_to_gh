# Issue 30620: compatibility wrappers after #24483

Issue created by migration from https://trac.sagemath.org/ticket/30857

Original creator: mmezzarobba

Original creation time: 2020-11-03 16:24:49

CC:  vdelecroix dunfield




---

Comment by mmezzarobba created at 2020-11-03 17:51:53

Changing status from new to needs_review.


---

Comment by mmezzarobba created at 2020-11-03 17:51:53

I don't know if there is a standard way of keeping deprecated _Cython_ interfaces (so that `cimport`ing from the old location still works, that is).
----
New commits:


---

Comment by mmezzarobba created at 2020-11-03 17:51:53

Changing priority from major to minor.


---

Comment by soehms created at 2020-12-01 21:59:50

>  I don't know if there is a standard way of keeping deprecated Cython interfaces (so that cimporting from the old location still works, that is).

I don't know this, either. But anyway, as the ticket does what it should, I think we should let it pass before the next release, since otherwise #24483 could break some external packages completely, for example SnaPy:


```
sage: import snappy
Plink failed to import tkinter.
doctest:warning
...
DeprecationWarning: the complex_field module is deprecated, please use sage.rings.complex_mpfr
See http://trac.sagemath.org/24483 for details.
doctest:warning
```


Furthermore, the maintainers of SnaPy probably want to implement an adaption, to get rid of that warning. Did somebody inform them, already?


---

Comment by vdelecroix created at 2020-12-02 07:15:35

Replying to [comment:3 soehms]:
> >  I don't know if there is a standard way of keeping deprecated Cython interfaces (so that cimporting from the old location still works, that is).
> 
> I don't know this, either. But anyway, as the ticket does what it should, I think we should let it pass before the next release, since otherwise #24483 could break some external packages completely, for example SnaPy:
> 
> {{{
> sage: import snappy
> Plink failed to import tkinter.
> doctest:warning
> ...
> DeprecationWarning: the complex_field module is deprecated, please use sage.rings.complex_mpfr
> See http://trac.sagemath.org/24483 for details.
> doctest:warning
> }}}
> 
> Furthermore, the maintainers of SnaPy probably want to implement an adaption, to get rid of that warning. Did somebody inform them, already?                                        

Easy: Nathan Dunfield has a trac account!


---

Comment by vdelecroix created at 2020-12-02 07:17:18

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2020-12-13 00:43:27

Resolution: fixed


---

Comment by dunfield created at 2020-12-14 03:19:32

Marc and Vincent: thanks for the heads up, [we have made](https://github.com/3-manifolds/SnapPy/commit/8a2d42f8665268c3) it so `SnapPy` checks both module locations in such a way that the `DeprecationWarning` should not appear.


---

Comment by soehms created at 2021-02-15 08:28:05

Replying to [comment:8 dunfield]:

Nathan,

FYI: It seems that once again the import of SnapPy inside Sage is broken with the new beta release (observed while working on #30352):


```
sage: import snappy
Plink failed to import tkinter.
/home/sebastian/devel/sage/local/lib/python3.9/site-packages/snappy/snap/shapes.py:4: DeprecationWarning: the complex_field module is deprecated, please use sage.rings.complex_mpfr
See http://trac.sagemath.org/24483 for details.
  from sage.rings.complex_field import ComplexField
/home/sebastian/devel/sage/local/lib/python3.9/site-packages/snappy/verify/verifyCanonical.py:6: DeprecationWarning: the complex_number module is deprecated, please use sage.rings.complex_mpfr
See http://trac.sagemath.org/24483 for details.
  from .squareExtensions import find_shapes_as_complex_sqrt_lin_combinations
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-1-710a7f18823c> in <module>
----> 1 import snappy

~/devel/sage/local/lib/python3.9/site-packages/snappy/__init__.py in <module>
      5 #logging.debug('This message should go to the log file')
      6 import sys
----> 7 from .SnapPy import (AbelianGroup, HolonomyGroup, FundamentalGroup,
      8                      DirichletDomain, CuspNeighborhood, SymmetryGroup,
      9                      AlternatingKnotExteriors, NonalternatingKnotExteriors,

cython/core/fundamental_group.pyx in init SnapPy()

cython/core/fundamental_group.pyx in SnapPy.HolonomyGroup.use_field_conversion()

TypeError: can't set attributes of built-in/extension type 'type'
```


I suspect this to be caused by the upgrade to Python 3.9.1 (#30589).


---

Comment by dunfield created at 2021-02-15 14:22:07

Replying to [comment:9 soehms]:
> FYI: It seems that once again the import of SnapPy inside Sage is broken with the new beta release (observed while working on #30352):

Thanks for the heads up.  I believe this fixed in the development version of SnapPy, see https://github.com/3-manifolds/SnapPy/issues/22
