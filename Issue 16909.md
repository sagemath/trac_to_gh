# Issue 16909: Random failure in doctest/test.py

Issue created by migration from https://trac.sagemath.org/ticket/17146

Original creator: vbraun

Original creation time: 2014-10-13 20:34:54

Keywords: random_fail

This one seems to be associated with high cpu load, looks like some race condition in the doctest framework:

```
sage -t --long src/sage/doctest/test.py
**********************************************************************
File "src/sage/doctest/test.py", line 180, in sage.doctest.test
Failed example:
    subprocess.call(["sage", "-t",  "--warn-long", "0", "interrupt.rst"], **kwds)  # long time
Expected:
    Running doctests...
    Doctesting 1 file.
    sage -t --warn-long 0.0 interrupt.rst
    Killing test interrupt.rst
    ----------------------------------------------------------------------
    Doctests interrupted: 0/1 files tested
    ----------------------------------------------------------------------
    ...
    128
Got:
    Running doctests with ID 2014-10-13-20-15-10-008c21c4.
    Doctesting 1 file.
    sage -t --warn-long 0.0 interrupt.rst
    Killing test interrupt.rst
    **********************************************************************
    File "interrupt.rst", line 6, in sage.doctest.tests.interrupt
    Failed example:
        time.sleep(10)
    Exception raised:
        Traceback (most recent call last):
          File "/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 488, in _run
            self.compile_and_execute(example, compiler, test.globs)
          File "/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 853, in compile_and_execute
            timer.stop().annotate(example)
          File "/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/util.py", line 133, in stop
            self.cputime = cputime(self.cputime)
        AttributeError: Timer instance has no attribute 'cputime'
    ----------------------------------------------------------------------
    Doctests interrupted: 0/1 files tested
    ----------------------------------------------------------------------
    Total time for all tests: 0.0 seconds
        cpu time: 0.0 seconds
        cumulative wall time: 0.0 seconds
    128
**********************************************************************
1 item had failures:
   1 of  45 in sage.doctest.test
```



---

Comment by vbraun created at 2014-11-22 22:11:14

Changing status from new to needs_review.


---

Comment by vbraun created at 2014-11-22 22:11:14

New commits:


---

Comment by jdemeyer created at 2014-12-06 15:27:47

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-12-12 12:29:03

Resolution: fixed
