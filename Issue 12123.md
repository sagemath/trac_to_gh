# Issue 12123: maple interface broken

archive/issues_012123.json:
```json
{
    "body": "Assignee: @williamstein\n\n\n```\nWith sage-4.7 (and maple 14) it works:\n----------------------------------------------------------------------\n----------------------------------------------------------------------\nsage: maple('1+1')\n2\nsage:\n| Sage Version 4.7, Release Date: 2011-05-23                         |\n| Type notebook() for the GUI, and license() for information.        |\n\nBut with 4.7.2 all maple commands end in this traceback:\n\n----------------------------------------------------------------------\n----------------------------------------------------------------------\nsage: maple('1+1')\nERROR: An unexpected error occurred while tokenizing input\nThe following traceback may be corrupted or invalid\nThe error message is: ('EOF in multi-line statement', (17, 0))\n| Sage Version 4.7.2, Release Date: 2011-10-29                       |\n| Type notebook() for the GUI, and license() for information.        |\n---------------------------------------------------------------------------\nRuntimeError                              Traceback (most recent call last)\n\n/home/luther/<ipython console> in <module>()\n\n/home/luther/sage-4.7.2-linux-64bit-ubuntu_10.04.3_lts-x86_64-Linux/local/lib/python2.6/site-packages/IPython/Prompts.pyc in __call__(self, arg)\n    550 \n    551             # and now call a possibly user-defined print mechanism\n--> 552             manipulated_val = self.display(arg)\n    553             \n    554             # user display hooks can change the variable to be stored in\n\n/home/luther/sage-4.7.2-linux-64bit-ubuntu_10.04.3_lts-x86_64-Linux/local/lib/python2.6/site-packages/IPython/Prompts.pyc in _display(self, arg)\n    576             return IPython.generics.result_display(arg)\n    577         except TryNext:            \n--> 578             return self.shell.hooks.result_display(arg)\n    579 \n    580     # Assign the default display method:\n\n/home/luther/sage-4.7.2-linux-64bit-ubuntu_10.04.3_lts-x86_64-Linux/local/lib/python2.6/site-packages/IPython/hooks.pyc in __call__(self, *args, **kw)\n    139             #print \"prio\",prio,\"cmd\",cmd #dbg\n    140             try:\n--> 141                 ret = cmd(*args, **kw)\n    142                 return ret\n    143             except ipapi.TryNext, exc:\n\n/home/luther/sage-4.7.2-linux-64bit-ubuntu_10.04.3_lts-x86_64-Linux/local/lib/python2.6/site-packages/sage/misc/displayhook.pyc in result_display(ip_self, obj)\n    148     # IPython's default result_display() uses the IPython.genutils.Term.cout stream.\n    149     # See also local/lib/python2.6/site-packages/IPython/hooks.py.\n--> 150     print_obj(IPython.genutils.Term.cout, obj)\n    151 \n    152 def displayhook(obj):\n\n/home/luther/sage-4.7.2-linux-64bit-ubuntu_10.04.3_lts-x86_64-Linux/local/lib/python2.6/site-packages/sage/misc/displayhook.pyc in print_obj(out_stream, obj)\n    140             if _check_tall_list_and_print(out_stream, obj):\n    141                 return\n--> 142     print >>out_stream, `obj`\n    143 \n    144 def result_display(ip_self, obj):\n\n/home/luther/sage-4.7.2-linux-64bit-ubuntu_10.04.3_lts-x86_64-Linux/local/lib/python2.6/site-packages/sage/interfaces/maple.pyc in __repr__(self)\n   1056         \"\"\"\n   1057         self._check_valid()\n-> 1058         return self.parent().get(self._name)\n   1059 \n   1060     def _latex_(self):\n\n/home/luther/sage-4.7.2-linux-64bit-ubuntu_10.04.3_lts-x86_64-Linux/local/lib/python2.6/site-packages/sage/interfaces/maple.pyc in get(self, var)\n    609             '2'\n    610         \"\"\"\n--> 611         s = self.eval('printf(\"%%q\",%s)'%var)\n    612         return s\n    613 \n\n/home/luther/sage-4.7.2-linux-64bit-ubuntu_10.04.3_lts-x86_64-Linux/local/lib/python2.6/site-packages/sage/interfaces/expect.pyc in eval(self, code, strip, synchronize, locals, allow_use_file, split_lines, **kwds)\n   1034                 if (split_lines is \"nofile\" and allow_use_file and\n   1035                         self._eval_using_file_cutoff and len(code) > self._eval_using_file_cutoff):\n-> 1036                     return self._eval_line_using_file(code)\n   1037                 elif split_lines:\n   1038                     return '\\n'.join([self._eval_line(L, allow_use_file=allow_use_file, **kwds)\n\n/home/luther/sage-4.7.2-linux-64bit-ubuntu_10.04.3_lts-x86_64-Linux/local/lib/python2.6/site-packages/sage/interfaces/expect.pyc in _eval_line_using_file(self, line)\n    653             tmp_to_use = self._remote_tmpfile()\n    654         try:\n--> 655             s = self._eval_line(self._read_in_file_command(tmp_to_use), allow_use_file=False)\n    656         except pexpect.EOF, msg:\n    657             if self._quit_string() in line:\n\n/home/luther/sage-4.7.2-linux-64bit-ubuntu_10.04.3_lts-x86_64-Linux/local/lib/python2.6/site-packages/sage/interfaces/maple.pyc in _eval_line(self, line, allow_use_file, wait_for_prompt)\n    559                 e.expect('__sage__;')\n    560                 e.expect(self._prompt)            \n--> 561                 raise RuntimeError, \"An error occurred running a Maple command:\\nINPUT:\\n%s\\nOUTPUT:\\n%s\"%(line, z)\n    562         return z\n    563 \n\nRuntimeError: An error occurred running a Maple command:\nINPUT:\nread \"/home/luther/.sage//temp/dirac/18306//interface//tmp18309\";\nOUTPUT:\non line 2, unexpected end of input\nError, while reading\n`/home/luther/.sage//temp/dirac/18306//interface//tmp18309`\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/12295\n\n",
    "created_at": "2012-01-11T13:46:21Z",
    "labels": [
        "component: interfaces",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "maple interface broken",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12123",
    "user": "https://trac.sagemath.org/admin/accounts/users/sluther"
}
```
Assignee: @williamstein


```
With sage-4.7 (and maple 14) it works:
----------------------------------------------------------------------
----------------------------------------------------------------------
sage: maple('1+1')
2
sage:
| Sage Version 4.7, Release Date: 2011-05-23                         |
| Type notebook() for the GUI, and license() for information.        |

But with 4.7.2 all maple commands end in this traceback:

----------------------------------------------------------------------
----------------------------------------------------------------------
sage: maple('1+1')
ERROR: An unexpected error occurred while tokenizing input
The following traceback may be corrupted or invalid
The error message is: ('EOF in multi-line statement', (17, 0))
| Sage Version 4.7.2, Release Date: 2011-10-29                       |
| Type notebook() for the GUI, and license() for information.        |
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)

/home/luther/<ipython console> in <module>()

/home/luther/sage-4.7.2-linux-64bit-ubuntu_10.04.3_lts-x86_64-Linux/local/lib/python2.6/site-packages/IPython/Prompts.pyc in __call__(self, arg)
    550 
    551             # and now call a possibly user-defined print mechanism
--> 552             manipulated_val = self.display(arg)
    553             
    554             # user display hooks can change the variable to be stored in

/home/luther/sage-4.7.2-linux-64bit-ubuntu_10.04.3_lts-x86_64-Linux/local/lib/python2.6/site-packages/IPython/Prompts.pyc in _display(self, arg)
    576             return IPython.generics.result_display(arg)
    577         except TryNext:            
--> 578             return self.shell.hooks.result_display(arg)
    579 
    580     # Assign the default display method:

/home/luther/sage-4.7.2-linux-64bit-ubuntu_10.04.3_lts-x86_64-Linux/local/lib/python2.6/site-packages/IPython/hooks.pyc in __call__(self, *args, **kw)
    139             #print "prio",prio,"cmd",cmd #dbg
    140             try:
--> 141                 ret = cmd(*args, **kw)
    142                 return ret
    143             except ipapi.TryNext, exc:

/home/luther/sage-4.7.2-linux-64bit-ubuntu_10.04.3_lts-x86_64-Linux/local/lib/python2.6/site-packages/sage/misc/displayhook.pyc in result_display(ip_self, obj)
    148     # IPython's default result_display() uses the IPython.genutils.Term.cout stream.
    149     # See also local/lib/python2.6/site-packages/IPython/hooks.py.
--> 150     print_obj(IPython.genutils.Term.cout, obj)
    151 
    152 def displayhook(obj):

/home/luther/sage-4.7.2-linux-64bit-ubuntu_10.04.3_lts-x86_64-Linux/local/lib/python2.6/site-packages/sage/misc/displayhook.pyc in print_obj(out_stream, obj)
    140             if _check_tall_list_and_print(out_stream, obj):
    141                 return
--> 142     print >>out_stream, `obj`
    143 
    144 def result_display(ip_self, obj):

/home/luther/sage-4.7.2-linux-64bit-ubuntu_10.04.3_lts-x86_64-Linux/local/lib/python2.6/site-packages/sage/interfaces/maple.pyc in __repr__(self)
   1056         """
   1057         self._check_valid()
-> 1058         return self.parent().get(self._name)
   1059 
   1060     def _latex_(self):

/home/luther/sage-4.7.2-linux-64bit-ubuntu_10.04.3_lts-x86_64-Linux/local/lib/python2.6/site-packages/sage/interfaces/maple.pyc in get(self, var)
    609             '2'
    610         """
--> 611         s = self.eval('printf("%%q",%s)'%var)
    612         return s
    613 

/home/luther/sage-4.7.2-linux-64bit-ubuntu_10.04.3_lts-x86_64-Linux/local/lib/python2.6/site-packages/sage/interfaces/expect.pyc in eval(self, code, strip, synchronize, locals, allow_use_file, split_lines, **kwds)
   1034                 if (split_lines is "nofile" and allow_use_file and
   1035                         self._eval_using_file_cutoff and len(code) > self._eval_using_file_cutoff):
-> 1036                     return self._eval_line_using_file(code)
   1037                 elif split_lines:
   1038                     return '\n'.join([self._eval_line(L, allow_use_file=allow_use_file, **kwds)

/home/luther/sage-4.7.2-linux-64bit-ubuntu_10.04.3_lts-x86_64-Linux/local/lib/python2.6/site-packages/sage/interfaces/expect.pyc in _eval_line_using_file(self, line)
    653             tmp_to_use = self._remote_tmpfile()
    654         try:
--> 655             s = self._eval_line(self._read_in_file_command(tmp_to_use), allow_use_file=False)
    656         except pexpect.EOF, msg:
    657             if self._quit_string() in line:

/home/luther/sage-4.7.2-linux-64bit-ubuntu_10.04.3_lts-x86_64-Linux/local/lib/python2.6/site-packages/sage/interfaces/maple.pyc in _eval_line(self, line, allow_use_file, wait_for_prompt)
    559                 e.expect('__sage__;')
    560                 e.expect(self._prompt)            
--> 561                 raise RuntimeError, "An error occurred running a Maple command:\nINPUT:\n%s\nOUTPUT:\n%s"%(line, z)
    562         return z
    563 

RuntimeError: An error occurred running a Maple command:
INPUT:
read "/home/luther/.sage//temp/dirac/18306//interface//tmp18309";
OUTPUT:
on line 2, unexpected end of input
Error, while reading
`/home/luther/.sage//temp/dirac/18306//interface//tmp18309`
```


Issue created by migration from https://trac.sagemath.org/ticket/12295





---

archive/issue_comments_140333.json:
```json
{
    "body": "* **Patch to apply:** trac-12295-maple_interface_20130115.patch\n* **Versions:**\n  * Sage 5.6\n  * Maple 13\n  * Linux Mint 14 cinnamon edition x86_64\n* **Dependencies:** None\n* **Causes:** \n  1. Maple command line interface automatically breaks input lines so pexpect interface sometimes fails (e.g. when the Sage user's home has a *long* route).\n  2. When this is fixed, a new bug appears because the method sage.interfaces.maple.Maple._eval_line_using_file did not manage the Maple's \";\"-stuff.\n  3. When these bugs are corrected, a new issue appears in sage.interfaces.maple.Maple._keyboard_interrupt. If we expect two maple prompts, the interface freezes when hitting ctrl-c once to stop a long calculation.\n* **Fixes:**\n  The Maple command passed to sage.interfaces.expect.Expect contains now a Maple configuration command.\n    1. Now, Maple command line interface does not break input lines.\n    2. When an Maple syntax error occurs, the command line interface does not enter in edit mode. Thus, we are not restricted to only use the expect file interface.\n* **Additional changes:**\n    1. The method sage.interfaces.maple.Maple.clear was modified to provide a standard way to eventually *clear* a Maple variable.\n    2. Some docstrings are changed to pass the doctests.\n    3. A docstring is changed in sage.symbolic.integration.integral to pass the tests of Ticket #2120\n* **Related tickets:** The issues of Tickets #2120 and #1465 could be also fixed with this patch, but not sure.\n* **Tests passed:**\n  {{{\n  sage -coverage devel/sage-maple/sage/interfaces/maple.py\n  sage -t -optional devel/sage-maple/sage/interfaces/maple.py\n  sage -t --only-optional=maple devel/sage-maple/sage/interfaces/maple.py\n  sage -t --only-optional=maple devel/sage/sage/symbolic/expression.pyx  \n  sage -t --only-optional=maple devel/sage/sage/symbolic/integration/integral.py\n  sage -t --only-optional=maple devel/sage/sage/calculus/calculus.py\n  sage -t --only-optional=maple devel/sage/sage/misc/functional.py\n  sage -t --only-optional=maple devel/sage/sage/tests/benchmark.py\n  sage -t --only-optional=maple devel/sage/sage/interfaces/maple.py\n  sage --testall --long\n  sage -docbuild reference html\n  sage -docbuild reference pdf\n  }}}",
    "created_at": "2013-02-15T15:38:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12123#issuecomment-140333",
    "user": "https://trac.sagemath.org/admin/accounts/users/migeruhito"
}
```

* **Patch to apply:** trac-12295-maple_interface_20130115.patch
* **Versions:**
  * Sage 5.6
  * Maple 13
  * Linux Mint 14 cinnamon edition x86_64
* **Dependencies:** None
* **Causes:** 
  1. Maple command line interface automatically breaks input lines so pexpect interface sometimes fails (e.g. when the Sage user's home has a *long* route).
  2. When this is fixed, a new bug appears because the method sage.interfaces.maple.Maple._eval_line_using_file did not manage the Maple's ";"-stuff.
  3. When these bugs are corrected, a new issue appears in sage.interfaces.maple.Maple._keyboard_interrupt. If we expect two maple prompts, the interface freezes when hitting ctrl-c once to stop a long calculation.
* **Fixes:**
  The Maple command passed to sage.interfaces.expect.Expect contains now a Maple configuration command.
    1. Now, Maple command line interface does not break input lines.
    2. When an Maple syntax error occurs, the command line interface does not enter in edit mode. Thus, we are not restricted to only use the expect file interface.
* **Additional changes:**
    1. The method sage.interfaces.maple.Maple.clear was modified to provide a standard way to eventually *clear* a Maple variable.
    2. Some docstrings are changed to pass the doctests.
    3. A docstring is changed in sage.symbolic.integration.integral to pass the tests of Ticket #2120
* **Related tickets:** The issues of Tickets #2120 and #1465 could be also fixed with this patch, but not sure.
* **Tests passed:**
  {{{
  sage -coverage devel/sage-maple/sage/interfaces/maple.py
  sage -t -optional devel/sage-maple/sage/interfaces/maple.py
  sage -t --only-optional=maple devel/sage-maple/sage/interfaces/maple.py
  sage -t --only-optional=maple devel/sage/sage/symbolic/expression.pyx  
  sage -t --only-optional=maple devel/sage/sage/symbolic/integration/integral.py
  sage -t --only-optional=maple devel/sage/sage/calculus/calculus.py
  sage -t --only-optional=maple devel/sage/sage/misc/functional.py
  sage -t --only-optional=maple devel/sage/sage/tests/benchmark.py
  sage -t --only-optional=maple devel/sage/sage/interfaces/maple.py
  sage --testall --long
  sage -docbuild reference html
  sage -docbuild reference pdf
  }}}



---

archive/issue_comments_140334.json:
```json
{
    "body": "Fix Maple interface",
    "created_at": "2013-02-15T15:39:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12123#issuecomment-140334",
    "user": "https://trac.sagemath.org/admin/accounts/users/migeruhito"
}
```

Fix Maple interface



---

archive/issue_comments_140335.json:
```json
{
    "body": "Attachment [trac-12295-maple_interface_20130115.patch](tarball://root/attachments/some-uuid/ticket12295/trac-12295-maple_interface_20130115.patch) by migeruhito created at 2013-03-21 13:50:47\n\n* trac-12295-maple_interface_20130115.patch works with Sage 5.6 and 5.7\n  * trac-12295-maple_interface_20130321.patch is a similar patch but for Sage 5.8\n  * trac-12295-maple_interface_5.9_20130614.patch is a similar patch but for Sage 5.9",
    "created_at": "2013-03-21T13:50:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12123#issuecomment-140335",
    "user": "https://trac.sagemath.org/admin/accounts/users/migeruhito"
}
```

Attachment [trac-12295-maple_interface_20130115.patch](tarball://root/attachments/some-uuid/ticket12295/trac-12295-maple_interface_20130115.patch) by migeruhito created at 2013-03-21 13:50:47

* trac-12295-maple_interface_20130115.patch works with Sage 5.6 and 5.7
  * trac-12295-maple_interface_20130321.patch is a similar patch but for Sage 5.8
  * trac-12295-maple_interface_5.9_20130614.patch is a similar patch but for Sage 5.9



---

archive/issue_comments_140336.json:
```json
{
    "body": "Please put your real name on both the patch and the ticket \"Author\" description.",
    "created_at": "2013-04-16T21:22:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12123#issuecomment-140336",
    "user": "https://github.com/kcrisman"
}
```

Please put your real name on both the patch and the ticket "Author" description.



---

archive/issue_comments_140337.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2013-04-16T21:22:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12123#issuecomment-140337",
    "user": "https://github.com/kcrisman"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_140338.json:
```json
{
    "body": "Attachment [trac-12295-maple_interface_20130321.patch](tarball://root/attachments/some-uuid/ticket12295/trac-12295-maple_interface_20130321.patch) by migeruhito created at 2013-04-16 21:41:03\n\nMaple interface fix for Sage 5.8",
    "created_at": "2013-04-16T21:41:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12123#issuecomment-140338",
    "user": "https://trac.sagemath.org/admin/accounts/users/migeruhito"
}
```

Attachment [trac-12295-maple_interface_20130321.patch](tarball://root/attachments/some-uuid/ticket12295/trac-12295-maple_interface_20130321.patch) by migeruhito created at 2013-04-16 21:41:03

Maple interface fix for Sage 5.8



---

archive/issue_comments_140339.json:
```json
{
    "body": "Maple interface fix for Sage 5.9",
    "created_at": "2013-06-14T17:01:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12123#issuecomment-140339",
    "user": "https://trac.sagemath.org/admin/accounts/users/migeruhito"
}
```

Maple interface fix for Sage 5.9



---

archive/issue_comments_140340.json:
```json
{
    "body": "Attachment [trac-12295-maple_interface_5.9_20130614.patch](tarball://root/attachments/some-uuid/ticket12295/trac-12295-maple_interface_5.9_20130614.patch) by @jdemeyer created at 2013-08-13 15:35:53",
    "created_at": "2013-08-13T15:35:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12123#issuecomment-140340",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [trac-12295-maple_interface_5.9_20130614.patch](tarball://root/attachments/some-uuid/ticket12295/trac-12295-maple_interface_5.9_20130614.patch) by @jdemeyer created at 2013-08-13 15:35:53



---

archive/issue_comments_140341.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2014-03-30T16:42:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12123#issuecomment-140341",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_140342.json:
```json
{
    "body": "Changing keywords from \"\" to \"maple interface\".",
    "created_at": "2014-07-24T13:24:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12123#issuecomment-140342",
    "user": "https://github.com/fchapoton"
}
```

Changing keywords from "" to "maple interface".



---

archive/issue_comments_140343.json:
```json
{
    "body": "Here is a git branch. Could somebody please have a look before it rosts ?\n----\nNew commits:",
    "created_at": "2014-07-24T13:24:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12123#issuecomment-140343",
    "user": "https://github.com/fchapoton"
}
```

Here is a git branch. Could somebody please have a look before it rosts ?
----
New commits:



---

archive/issue_comments_140344.json:
```json
{
    "body": "Branch u/chapoton/12295 merged with 6.3 sources.\nTested for Linux mint 17 and maple 13.\nIt works fine.",
    "created_at": "2014-09-15T18:13:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12123#issuecomment-140344",
    "user": "https://trac.sagemath.org/admin/accounts/users/migeruhito"
}
```

Branch u/chapoton/12295 merged with 6.3 sources.
Tested for Linux mint 17 and maple 13.
It works fine.



---

archive/issue_comments_140345.json:
```json
{
    "body": "Would you give a positive review, then ?",
    "created_at": "2014-09-22T09:36:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12123#issuecomment-140345",
    "user": "https://github.com/fchapoton"
}
```

Would you give a positive review, then ?



---

archive/issue_comments_140346.json:
```json
{
    "body": "I have been successfully using the fix for more than a year.",
    "created_at": "2014-09-22T21:27:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12123#issuecomment-140346",
    "user": "https://trac.sagemath.org/admin/accounts/users/migeruhito"
}
```

I have been successfully using the fix for more than a year.



---

archive/issue_comments_140347.json:
```json
{
    "body": "Then could you please put this ticket in positive review, so that it can be closed ?",
    "created_at": "2014-09-23T07:45:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12123#issuecomment-140347",
    "user": "https://github.com/fchapoton"
}
```

Then could you please put this ticket in positive review, so that it can be closed ?



---

archive/issue_comments_140348.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-09-23T07:53:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12123#issuecomment-140348",
    "user": "https://trac.sagemath.org/admin/accounts/users/migeruhito"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_140349.json:
```json
{
    "body": "Changing status from positive_review to needs_info.",
    "created_at": "2014-09-23T07:53:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12123#issuecomment-140349",
    "user": "https://github.com/kcrisman"
}
```

Changing status from positive_review to needs_info.



---

archive/issue_comments_140350.json:
```json
{
    "body": "`@`chapoton:  Umm... Miguel **IS** the author!  So he definitely can't review it.  However, if it solves the problem for you as well (perhaps on a different platform? having someone test on Mac would be good) that would be great for positive review.  I'll put a note on sage-devel.",
    "created_at": "2014-09-23T07:53:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12123#issuecomment-140350",
    "user": "https://github.com/kcrisman"
}
```

`@`chapoton:  Umm... Miguel **IS** the author!  So he definitely can't review it.  However, if it solves the problem for you as well (perhaps on a different platform? having someone test on Mac would be good) that would be great for positive review.  I'll put a note on sage-devel.



---

archive/issue_comments_140351.json:
```json
{
    "body": "Why are those marked random? This should have deterministic output (depending on maple of course):\n\n```\n-        sage: g = maple(f); g                             # optional - maple\n+        sage: g = maple(f); g                  # random ; optional - maple\n         sin(x^2)+y^z\n-        sage: g.integrate(x)                              # optional - maple\n+        sage: g.integrate(x)                   # random ; optional - maple\n         1/2*2^(1/2)*Pi^(1/2)*FresnelS(2^(1/2)/Pi^(1/2)*x)+y^z*x\n```\n",
    "created_at": "2014-09-23T08:01:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12123#issuecomment-140351",
    "user": "https://github.com/vbraun"
}
```

Why are those marked random? This should have deterministic output (depending on maple of course):

```
-        sage: g = maple(f); g                             # optional - maple
+        sage: g = maple(f); g                  # random ; optional - maple
         sin(x^2)+y^z
-        sage: g.integrate(x)                              # optional - maple
+        sage: g.integrate(x)                   # random ; optional - maple
         1/2*2^(1/2)*Pi^(1/2)*FresnelS(2^(1/2)/Pi^(1/2)*x)+y^z*x
```




---

archive/issue_comments_140352.json:
```json
{
    "body": "The order of the operands is session-dependent in maple. Sometimes the tests didn't passed due to this fact, when I performed them (long time ago). I know that this \"random\" setting makes the tests (mathematically) useless, but I don't know how to address this problem. Maybe now the test suite takes into account this issue.",
    "created_at": "2014-09-23T08:53:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12123#issuecomment-140352",
    "user": "https://trac.sagemath.org/admin/accounts/users/migeruhito"
}
```

The order of the operands is session-dependent in maple. Sometimes the tests didn't passed due to this fact, when I performed them (long time ago). I know that this "random" setting makes the tests (mathematically) useless, but I don't know how to address this problem. Maybe now the test suite takes into account this issue.



---

archive/issue_comments_140353.json:
```json
{
    "body": "Replying to [comment:20 migeruhito]:\n> The order of the operands is session-dependent in maple.\n\nI believe starting maple with option `--setsort=1` and then calling (maple's) `sort()` on the result before sending it back to sage should make the output deterministic, at least on these examples.",
    "created_at": "2014-09-23T09:18:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12123#issuecomment-140353",
    "user": "https://github.com/mezzarobba"
}
```

Replying to [comment:20 migeruhito]:
> The order of the operands is session-dependent in maple.

I believe starting maple with option `--setsort=1` and then calling (maple's) `sort()` on the result before sending it back to sage should make the output deterministic, at least on these examples.



---

archive/issue_comments_140354.json:
```json
{
    "body": "I performed my tests with maple 11. Prior to Maple 12, the only sort option available is session dependent, and I think `--setsort` option is not available at all. By including it, we will probably break the interface for older versions of maple. In the other hand, `--setsort=1` seems to be deterministic for these examples as mmezzarobba said, but it is the default from version 12. `sort()` is not necessary in this case.\n\nI think that \"random\" must be removed from the tests and `--setsort=1` must not be added in the call parameters of the maple interface. Then, the status of the question would be:\n\n* For Maple prior to v. 11, the tests will randomly pass.\n* For Maple from v. 12, the tests will probably pass. (From Maple documentation:: \"The --setsort=orderNumber option changes the sort order for Maple sets\". I believe that maple expressions are ordered like sets, but not sure).",
    "created_at": "2014-09-23T12:59:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12123#issuecomment-140354",
    "user": "https://trac.sagemath.org/admin/accounts/users/migeruhito"
}
```

I performed my tests with maple 11. Prior to Maple 12, the only sort option available is session dependent, and I think `--setsort` option is not available at all. By including it, we will probably break the interface for older versions of maple. In the other hand, `--setsort=1` seems to be deterministic for these examples as mmezzarobba said, but it is the default from version 12. `sort()` is not necessary in this case.

I think that "random" must be removed from the tests and `--setsort=1` must not be added in the call parameters of the maple interface. Then, the status of the question would be:

* For Maple prior to v. 11, the tests will randomly pass.
* For Maple from v. 12, the tests will probably pass. (From Maple documentation:: "The --setsort=orderNumber option changes the sort order for Maple sets". I believe that maple expressions are ordered like sets, but not sure).



---

archive/issue_comments_140355.json:
```json
{
    "body": "Sounds good to me.",
    "created_at": "2014-09-23T13:03:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12123#issuecomment-140355",
    "user": "https://github.com/vbraun"
}
```

Sounds good to me.



---

archive/issue_comments_140356.json:
```json
{
    "body": "Replying to [comment:22 migeruhito]:\n> I performed my tests with maple 11. Prior to Maple 12, the only sort option available is session dependent, and I think `--setsort` option is not available at all. By including it, we will probably break the interface for older versions of maple. In the other hand, `--setsort=1` seems to be deterministic for these examples as mmezzarobba said, but it is the default from version 12. `sort()` is not necessary in this case.\n\nYes, I forgot that `setsort=1` was in fact the default. However, while *sets* are sorted by default under recent versions of Maple, it looks like expressions aren't. For example, with Maple\u00a017, I get:\n\n```\n$ maple -t\n#-->sin(x^2)+y^z;\nsin(x^2)+y^z\n#-->{sin(x^2),y^z};\n{y^z, sin(x^2)}\n#-->sort(%%);\ny^z+sin(x^2)\n```\n\nSo I would say that adding the command-line option is indeed not necessary, but we do need to call `sort()` to make the tests deterministic under Maple 12+.\n\n> I believe that maple expressions are ordered like sets, but not sure).\n\nSame for me.",
    "created_at": "2014-09-23T14:20:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12123#issuecomment-140356",
    "user": "https://github.com/mezzarobba"
}
```

Replying to [comment:22 migeruhito]:
> I performed my tests with maple 11. Prior to Maple 12, the only sort option available is session dependent, and I think `--setsort` option is not available at all. By including it, we will probably break the interface for older versions of maple. In the other hand, `--setsort=1` seems to be deterministic for these examples as mmezzarobba said, but it is the default from version 12. `sort()` is not necessary in this case.

Yes, I forgot that `setsort=1` was in fact the default. However, while *sets* are sorted by default under recent versions of Maple, it looks like expressions aren't. For example, with Maple 17, I get:

```
$ maple -t
#-->sin(x^2)+y^z;
sin(x^2)+y^z
#-->{sin(x^2),y^z};
{y^z, sin(x^2)}
#-->sort(%%);
y^z+sin(x^2)
```

So I would say that adding the command-line option is indeed not necessary, but we do need to call `sort()` to make the tests deterministic under Maple 12+.

> I believe that maple expressions are ordered like sets, but not sure).

Same for me.



---

archive/issue_comments_140357.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-09-23T20:26:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12123#issuecomment-140357",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_140358.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-09-23T20:35:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12123#issuecomment-140358",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_140359.json:
```json
{
    "body": "Is this ok like that ?\n\nI regret that testing `optional=something` does not run the \"not-optional\" tests. This prevents from the `optional=maple` tests to pass for me in this ticket in the current state.\n\nBut the `optional=all` do pass (except for the mathematica optional ones, cause I do not have that.",
    "created_at": "2014-09-24T18:37:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12123#issuecomment-140359",
    "user": "https://github.com/fchapoton"
}
```

Is this ok like that ?

I regret that testing `optional=something` does not run the "not-optional" tests. This prevents from the `optional=maple` tests to pass for me in this ticket in the current state.

But the `optional=all` do pass (except for the mathematica optional ones, cause I do not have that.



---

archive/issue_comments_140360.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2014-09-24T18:37:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12123#issuecomment-140360",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_140361.json:
```json
{
    "body": "You can run standard + optional maple tests with \n\n```\nsage -t --optional=sage,maple src/sage/foo.py\n```\n",
    "created_at": "2014-09-24T19:10:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12123#issuecomment-140361",
    "user": "https://github.com/vbraun"
}
```

You can run standard + optional maple tests with 

```
sage -t --optional=sage,maple src/sage/foo.py
```




---

archive/issue_comments_140362.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-09-25T12:13:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12123#issuecomment-140362",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_140363.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-09-27T12:57:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12123#issuecomment-140363",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_012138.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-09-27T12:57:12Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12123",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12123#event-12138"
}
```
