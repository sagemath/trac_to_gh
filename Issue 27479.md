# Issue 27479: Refactor backend_normaliz

Issue created by migration from https://trac.sagemath.org/ticket/27716

Original creator: mkoeppe

Original creation time: 2019-04-23 12:41:44

CC:  vdelecroix jipilab

Preparation for #25097.


---

Comment by git created at 2019-04-23 12:46:01

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2019-04-23 12:48:09

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2019-04-23 12:48:09

This branch has a part of the changes on #25097 without dependencies.


---

Comment by vdelecroix created at 2019-04-23 13:39:29

Do you intend to make #27682 a dependency?


---

Comment by mkoeppe created at 2019-04-23 13:41:15

No, not for this ticket


---

Comment by git created at 2019-04-23 13:49:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2019-04-23 14:03:33

I think in #27682 there is a need to touch the normaliz backend due to some changed in the (not yet released) PyNormaliz. So there might be a small conflict.


---

Comment by jipilab created at 2019-04-23 14:16:59

Replying to [comment:7 vdelecroix]:
> I think in #27682 there is a need to touch the normaliz backend due to some changed in the (not yet released) PyNormaliz. So there might be a small conflict.

Yes, Matthias merged cleanly so far. It's coming...


---

Comment by jipilab created at 2019-04-23 14:26:00

Here are a few things:

 - to get 100% coverage, the function `_nmz_result` should be tested. Perhaps also with a function name that does not exist?
 - sage.matrix.constructor.matrix imported but not used
 - pep8 around here, and blankline at end of file...........


```diff /src/geometry/polyhedron/backend_normaliz
921             if  box_points<threshold:                                                                                                                                                                          
922                 from sage.geometry.integral_points import rectangular_box_points
923                 return rectangular_box_points(list(box_min), list(box_max), self)
```


Otherwise, it looks quite good, let's see what the bot says. vdelecroix mentioned in #25091 in comment #25091#comment:69 that 


```
import PyNormaliz
```


is not desirable... and we should use feature. I would not do this here but in a follow up ticket.


---

Comment by jipilab created at 2019-04-23 15:04:19

There seems to be only two small things:

Pyflakes:

```
+src/sage/geometry/polyhedron/backend_normaliz.py:33: 'sage.matrix.constructor.matrix' imported but unused
+
+src/sage/geometry/polyhedron/parent.py:21: 'sage.geometry.polyhedron.base.Polyhedron_base' imported but unused
```

Python3:

```
+inside file:  b/src/sage/geometry/polyhedron/backend_normaliz.py
+@@ -496,25 +607,36 @@ class Polyhedron_normaliz(Polyhedron_base):
++        for key, value in sorted(data.iteritems()):
```



---

Comment by git created at 2019-04-23 17:16:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jipilab created at 2019-04-24 06:00:47

Changing status from needs_review to positive_review.


---

Comment by jipilab created at 2019-04-24 06:00:47

LGTM. The bot gave the green light and I am satisfied.

A next step would be to make pynormaliz a feature...


---

Comment by vbraun created at 2019-04-24 16:05:04

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2019-04-24 16:05:04


```
sage -t --long src/sage/geometry/polyhedron/backend_normaliz.py  # 1 doctest failed
```



---

Comment by git created at 2019-04-24 17:46:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2019-04-24 17:47:08

Changing status from needs_work to needs_review.


---

Comment by jipilab created at 2019-04-25 10:12:44

LGTM now hopefully no more doctests failure.


---

Comment by jipilab created at 2019-04-25 10:12:44

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-04-29 12:35:47

Resolution: fixed
