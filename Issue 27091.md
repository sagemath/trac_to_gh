# Issue 27091: caching of Groebner basis not always done

archive/issues_027091.json:
```json
{
    "body": "\n```\n            sage: R.<a,b> = QQ[]\n            sage: I = R.ideal([a^2-a, b^2-b, a+b])\n            sage: GB1 = I.groebner_basis(algorithm='libsingular:slimgb')\n            sage: GB2 = I.groebner_basis()\n            sage: GB1 is GB2\n```\n\nreturns `False`, the Gr\u00f6bner basis is recomputed. This is problematic, as a lot of methods (e.g. `.variety`) simply call `.groebner_basis()` and a precomputed Gr\u00f6bner basis (maybe with a different algorithm than the default) is not used.\n\nIssue created by migration from https://trac.sagemath.org/ticket/27328\n\n",
    "created_at": "2019-02-20T15:59:52Z",
    "labels": [
        "algebra",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "caching of Groebner basis not always done",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27091",
    "user": "@dkrenn"
}
```

```
            sage: R.<a,b> = QQ[]
            sage: I = R.ideal([a^2-a, b^2-b, a+b])
            sage: GB1 = I.groebner_basis(algorithm='libsingular:slimgb')
            sage: GB2 = I.groebner_basis()
            sage: GB1 is GB2
```

returns `False`, the Gröbner basis is recomputed. This is problematic, as a lot of methods (e.g. `.variety`) simply call `.groebner_basis()` and a precomputed Gröbner basis (maybe with a different algorithm than the default) is not used.

Issue created by migration from https://trac.sagemath.org/ticket/27328





---

archive/issue_comments_381572.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-02-20T16:03:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27091#issuecomment-381572",
    "user": "@dkrenn"
}
```

New commits:



---

archive/issue_comments_381573.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-02-20T16:03:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27091#issuecomment-381573",
    "user": "@dkrenn"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_381574.json:
```json
{
    "body": "The proposed solution is now that if there is no algorithm given but something is cached, then this is taken.",
    "created_at": "2019-02-20T16:07:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27091#issuecomment-381574",
    "user": "@dkrenn"
}
```

The proposed solution is now that if there is no algorithm given but something is cached, then this is taken.



---

archive/issue_comments_381575.json:
```json
{
    "body": "The building of the cache is still reliant on `cached_method`. For instance, that means that if `I.groebner_basis()` is called and then `I.groebner_basis(algorithm=<whatever the default is>)`, then the algorithm gets executed twice.",
    "created_at": "2019-02-20T16:23:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27091#issuecomment-381575",
    "user": "@nbruin"
}
```

The building of the cache is still reliant on `cached_method`. For instance, that means that if `I.groebner_basis()` is called and then `I.groebner_basis(algorithm=<whatever the default is>)`, then the algorithm gets executed twice.



---

archive/issue_comments_381576.json:
```json
{
    "body": "Replying to [comment:4 nbruin]:\n> The building of the cache is still reliant on `cached_method`. For instance, that means that if `I.groebner_basis()` is called and then `I.groebner_basis(algorithm=<whatever the default is>)`, then the algorithm gets executed twice.\n\nYes, this is indeed true. The problem is that `I.groebner_basis()` does not simply translate to `I.groebner_basis(algorithm=<somealgorithmname>)` at the beginning, but tries a couple of things which might lead to a result. Any ideas how this can be taken care of?",
    "created_at": "2019-02-20T16:34:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27091#issuecomment-381576",
    "user": "@dkrenn"
}
```

Replying to [comment:4 nbruin]:
> The building of the cache is still reliant on `cached_method`. For instance, that means that if `I.groebner_basis()` is called and then `I.groebner_basis(algorithm=<whatever the default is>)`, then the algorithm gets executed twice.

Yes, this is indeed true. The problem is that `I.groebner_basis()` does not simply translate to `I.groebner_basis(algorithm=<somealgorithmname>)` at the beginning, but tries a couple of things which might lead to a result. Any ideas how this can be taken care of?



---

archive/issue_comments_381577.json:
```json
{
    "body": "Replying to [comment:5 dkrenn]:\n> Replying to [comment:4 nbruin]:\n> > The building of the cache is still reliant on `cached_method`. For instance, that means that if `I.groebner_basis()` is called and then `I.groebner_basis(algorithm=<whatever the default is>)`, then the algorithm gets executed twice.\n> \n> Yes, this is indeed true. The problem is that `I.groebner_basis()` does not simply translate to `I.groebner_basis(algorithm=<somealgorithmname>)` at the beginning, but tries a couple of things which might lead to a result. Any ideas how this can be taken care of?\n\nThe generic way around that is to instead have the default call `self.groebner_basis(algorithm=<algorithmname>)` with the chosen algorithm. The other thing you could do, and which might be better, is to explicitly set the cache in those cases.",
    "created_at": "2019-02-20T21:21:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27091#issuecomment-381577",
    "user": "@tscrim"
}
```

Replying to [comment:5 dkrenn]:
> Replying to [comment:4 nbruin]:
> > The building of the cache is still reliant on `cached_method`. For instance, that means that if `I.groebner_basis()` is called and then `I.groebner_basis(algorithm=<whatever the default is>)`, then the algorithm gets executed twice.
> 
> Yes, this is indeed true. The problem is that `I.groebner_basis()` does not simply translate to `I.groebner_basis(algorithm=<somealgorithmname>)` at the beginning, but tries a couple of things which might lead to a result. Any ideas how this can be taken care of?

The generic way around that is to instead have the default call `self.groebner_basis(algorithm=<algorithmname>)` with the chosen algorithm. The other thing you could do, and which might be better, is to explicitly set the cache in those cases.



---

archive/issue_comments_381578.json:
```json
{
    "body": "Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)",
    "created_at": "2019-03-25T10:56:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27091#issuecomment-381578",
    "user": "@embray"
}
```

Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)



---

archive/issue_comments_381579.json:
```json
{
    "body": "Replying to [comment:6 tscrim]:\n> > [...] The problem is that `I.groebner_basis()` does not simply translate to `I.groebner_basis(algorithm=<somealgorithmname>)` at the beginning, but tries a couple of things which might lead to a result. Any ideas how this can be taken care of?\n> \n> The generic way around that is to instead have the default call `self.groebner_basis(algorithm=<algorithmname>)` with the chosen algorithm.\n\nThis is not what we want: We do want that `algorithm=''` tries a couple of things until it succeeds (or fails after all).\n\n> The other thing you could do, and which might be better, is to explicitly set the cache in those cases.\n\nYou mean setting the cache for `algorithm=''` to be the same as for `algorithm='chosen'`. This could work ;)",
    "created_at": "2019-03-28T09:15:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27091#issuecomment-381579",
    "user": "@dkrenn"
}
```

Replying to [comment:6 tscrim]:
> > [...] The problem is that `I.groebner_basis()` does not simply translate to `I.groebner_basis(algorithm=<somealgorithmname>)` at the beginning, but tries a couple of things which might lead to a result. Any ideas how this can be taken care of?
> 
> The generic way around that is to instead have the default call `self.groebner_basis(algorithm=<algorithmname>)` with the chosen algorithm.

This is not what we want: We do want that `algorithm=''` tries a couple of things until it succeeds (or fails after all).

> The other thing you could do, and which might be better, is to explicitly set the cache in those cases.

You mean setting the cache for `algorithm=''` to be the same as for `algorithm='chosen'`. This could work ;)



---

archive/issue_comments_381580.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-28T10:50:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27091#issuecomment-381580",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_381581.json:
```json
{
    "body": "Replying to [comment:8 dkrenn]:\n> You mean setting the cache for `algorithm=''` to be the same as for `algorithm='chosen'`. This could work ;)\n\nWorks indeed; see current implementation.",
    "created_at": "2019-03-28T10:51:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27091#issuecomment-381581",
    "user": "@dkrenn"
}
```

Replying to [comment:8 dkrenn]:
> You mean setting the cache for `algorithm=''` to be the same as for `algorithm='chosen'`. This could work ;)

Works indeed; see current implementation.



---

archive/issue_comments_381582.json:
```json
{
    "body": "Replying to [comment:4 nbruin]:\n> The building of the cache is still reliant on `cached_method`. For instance, that means that if `I.groebner_basis()` is called and then `I.groebner_basis(algorithm=<whatever the default is>)`, then the algorithm gets executed twice.\n\nThis is now fixed as well.",
    "created_at": "2019-03-28T10:52:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27091#issuecomment-381582",
    "user": "@dkrenn"
}
```

Replying to [comment:4 nbruin]:
> The building of the cache is still reliant on `cached_method`. For instance, that means that if `I.groebner_basis()` is called and then `I.groebner_basis(algorithm=<whatever the default is>)`, then the algorithm gets executed twice.

This is now fixed as well.



---

archive/issue_comments_381583.json:
```json
{
    "body": "I've changed the code so that all issues are solved.\n\nMoreover, I've simplifed the way arguments are processed and handled, and cleaned up of what seems to be historically grown (and sometimes not even used or incompatible or even ignored).\n\nPlease review :)",
    "created_at": "2019-03-28T10:53:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27091#issuecomment-381583",
    "user": "@dkrenn"
}
```

I've changed the code so that all issues are solved.

Moreover, I've simplifed the way arguments are processed and handled, and cleaned up of what seems to be historically grown (and sometimes not even used or incompatible or even ignored).

Please review :)



---

archive/issue_comments_381584.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-01T08:06:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27091#issuecomment-381584",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_381585.json:
```json
{
    "body": "Forgot push; now updated :)",
    "created_at": "2019-04-01T08:06:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27091#issuecomment-381585",
    "user": "@dkrenn"
}
```

Forgot push; now updated :)



---

archive/issue_comments_381586.json:
```json
{
    "body": "Moving tickets from the Sage 8.8 milestone that have been actively worked on in the last six months to the next release milestone (optimistically).",
    "created_at": "2019-07-03T11:37:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27091#issuecomment-381586",
    "user": "@embray"
}
```

Moving tickets from the Sage 8.8 milestone that have been actively worked on in the last six months to the next release milestone (optimistically).



---

archive/issue_comments_381587.json:
```json
{
    "body": "Ticket retargeted after milestone closed",
    "created_at": "2019-12-30T14:48:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27091#issuecomment-381587",
    "user": "@embray"
}
```

Ticket retargeted after milestone closed



---

archive/issue_comments_381588.json:
```json
{
    "body": "Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.",
    "created_at": "2020-04-14T19:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27091#issuecomment-381588",
    "user": "@mkoeppe"
}
```

Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.



---

archive/issue_comments_381589.json:
```json
{
    "body": "It's been long enough that I'm getting a merge failure. Rebase?",
    "created_at": "2020-09-07T18:41:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27091#issuecomment-381589",
    "user": "@kedlaya"
}
```

It's been long enough that I'm getting a merge failure. Rebase?



---

archive/issue_comments_381590.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-09-07T18:41:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27091#issuecomment-381590",
    "user": "@kedlaya"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_381591.json:
```json
{
    "body": "Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27091#issuecomment-381591",
    "user": "@mkoeppe"
}
```

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.
