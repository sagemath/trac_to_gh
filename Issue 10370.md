# Issue 10370: Upgrade Jinja2 to version 2.5.5 (latest upstream)

archive/issues_010370.json:
```json
{
    "body": "Assignee: tbd\n\nCC:  @jdemeyer @TimDumol @jhpalmieri @mwhansen\n\nKeywords: Sphinx download\n\nThe new Sphinx version in Sage 4.6.1.alpha2 (1.0.4, #10118, #10350) requires Jinja2 >= 2.2, while in Sage we currently have version 2.1.1, which triggers undesired downloads during the build.\n\n----\n\nNew spkg coming up soon.\n\nIssue created by migration from https://trac.sagemath.org/ticket/10423\n\n",
    "created_at": "2010-12-03T17:48:53Z",
    "labels": [
        "packages: standard",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.6.1",
    "title": "Upgrade Jinja2 to version 2.5.5 (latest upstream)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10370",
    "user": "@nexttime"
}
```
Assignee: tbd

CC:  @jdemeyer @TimDumol @jhpalmieri @mwhansen

Keywords: Sphinx download

The new Sphinx version in Sage 4.6.1.alpha2 (1.0.4, #10118, #10350) requires Jinja2 >= 2.2, while in Sage we currently have version 2.1.1, which triggers undesired downloads during the build.

----

New spkg coming up soon.

Issue created by migration from https://trac.sagemath.org/ticket/10423





---

archive/issue_comments_106635.json:
```json
{
    "body": "Perhaps we could clarify the dependencies; the web page just says Python and setuptools (or distribute).\n\nAlso, `spkg/standard/deps` lacks an explicit dependency on these, instead lists Pygments:\n\n```make\n$(INST)/$(JINJA2): $(BASE) $(INST)/$(PYGMENTS) $(INST)/$(PATCH)\n\t$(INSTALL) \"$(SAGE_SPKG) $(JINJA2) 2>&1\" \"tee -a $(SAGE_LOGS)/$(JINJA2).log\"\n```\n\nThere's also:\n\n```make\n# For reference and for when the setuptools problem is solved, here\n# are the actual dependencies:\n#\n# sagenb: python pexpect twisted jinja2 sphinx docutils setuptools\n# sqlalchemy: python setuptools\n# sphinx: docutils jinja2 pygments\n# jinja2: python docutils setuptools\n# pygments: python setuptools\n# twisted: python python_gnutls setuptools\n# zodb: python setuptools\n```\n",
    "created_at": "2010-12-03T18:16:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10370#issuecomment-106635",
    "user": "@nexttime"
}
```

Perhaps we could clarify the dependencies; the web page just says Python and setuptools (or distribute).

Also, `spkg/standard/deps` lacks an explicit dependency on these, instead lists Pygments:

```make
$(INST)/$(JINJA2): $(BASE) $(INST)/$(PYGMENTS) $(INST)/$(PATCH)
	$(INSTALL) "$(SAGE_SPKG) $(JINJA2) 2>&1" "tee -a $(SAGE_LOGS)/$(JINJA2).log"
```

There's also:

```make
# For reference and for when the setuptools problem is solved, here
# are the actual dependencies:
#
# sagenb: python pexpect twisted jinja2 sphinx docutils setuptools
# sqlalchemy: python setuptools
# sphinx: docutils jinja2 pygments
# jinja2: python docutils setuptools
# pygments: python setuptools
# twisted: python python_gnutls setuptools
# zodb: python setuptools
```




---

archive/issue_comments_106636.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-12-03T18:16:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10370#issuecomment-106636",
    "user": "@nexttime"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_106637.json:
```json
{
    "body": "Replaced the spkg with a corrected one (version names in `SPKG.txt`).",
    "created_at": "2010-12-03T18:24:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10370#issuecomment-106637",
    "user": "@nexttime"
}
```

Replaced the spkg with a corrected one (version names in `SPKG.txt`).



---

archive/issue_comments_106638.json:
```json
{
    "body": "I've made some very minor changes, dropped .p0 from version number and made `spkg-install` executable.  New spkg: [http://sage.math.washington.edu/home/jdemeyer/spkg/jinja2-2.5.5.spkg](http://sage.math.washington.edu/home/jdemeyer/spkg/jinja2-2.5.5.spkg)\n\nIf somebody can review my changes, positive_review.",
    "created_at": "2010-12-04T14:53:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10370#issuecomment-106638",
    "user": "@jdemeyer"
}
```

I've made some very minor changes, dropped .p0 from version number and made `spkg-install` executable.  New spkg: [http://sage.math.washington.edu/home/jdemeyer/spkg/jinja2-2.5.5.spkg](http://sage.math.washington.edu/home/jdemeyer/spkg/jinja2-2.5.5.spkg)

If somebody can review my changes, positive_review.



---

archive/issue_comments_106639.json:
```json
{
    "body": "Changing keywords from \"Sphinx download\" to \"Sphinx download jinja2 spkg\".",
    "created_at": "2010-12-04T14:53:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10370#issuecomment-106639",
    "user": "@jdemeyer"
}
```

Changing keywords from "Sphinx download" to "Sphinx download jinja2 spkg".



---

archive/issue_comments_106640.json:
```json
{
    "body": "Attachment [jinja2_jdemeyer.patch](tarball://root/attachments/some-uuid/ticket10423/jinja2_jdemeyer.patch) by @jdemeyer created at 2010-12-04 14:54:32\n\nPatch between Leif's and my spkg",
    "created_at": "2010-12-04T14:54:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10370#issuecomment-106640",
    "user": "@jdemeyer"
}
```

Attachment [jinja2_jdemeyer.patch](tarball://root/attachments/some-uuid/ticket10423/jinja2_jdemeyer.patch) by @jdemeyer created at 2010-12-04 14:54:32

Patch between Leif's and my spkg



---

archive/issue_comments_106641.json:
```json
{
    "body": "Replying to [comment:3 jdemeyer]:\n> I've made some very minor changes, dropped .p0 from version number and made `spkg-install` executable.  New spkg: [http://sage.math.washington.edu/home/jdemeyer/spkg/jinja2-2.5.5.spkg](http://sage.math.washington.edu/home/jdemeyer/spkg/jinja2-2.5.5.spkg)\n\nThe p0 was intentional, as IMHO *every* Sage package should have a \"patch\" level, be it zero for the first spkg in a new upstream series, to avoid confusion with (vanilla) upstream tarballs and packages.\n\n(I'm not sure if everybody knows one can often simply change the extension of an upstream tarball and [try to] install it *as is* into Sage, with the usual Sage commands.)\n\nAlmost every distribution prepends its own versioning to package names.\n\n\n\n \n> If somebody can review my changes, positive_review.\n\nReally minor, no operational effect, so **positive review** for those changes.\n\nP.S.: Fortunately(?) `sage-spkg` does `chmod +x`, otherwise I would have noticed that myself. ;-)",
    "created_at": "2010-12-04T15:41:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10370#issuecomment-106641",
    "user": "@nexttime"
}
```

Replying to [comment:3 jdemeyer]:
> I've made some very minor changes, dropped .p0 from version number and made `spkg-install` executable.  New spkg: [http://sage.math.washington.edu/home/jdemeyer/spkg/jinja2-2.5.5.spkg](http://sage.math.washington.edu/home/jdemeyer/spkg/jinja2-2.5.5.spkg)

The p0 was intentional, as IMHO *every* Sage package should have a "patch" level, be it zero for the first spkg in a new upstream series, to avoid confusion with (vanilla) upstream tarballs and packages.

(I'm not sure if everybody knows one can often simply change the extension of an upstream tarball and [try to] install it *as is* into Sage, with the usual Sage commands.)

Almost every distribution prepends its own versioning to package names.



 
> If somebody can review my changes, positive_review.

Really minor, no operational effect, so **positive review** for those changes.

P.S.: Fortunately(?) `sage-spkg` does `chmod +x`, otherwise I would have noticed that myself. ;-)



---

archive/issue_comments_106642.json:
```json
{
    "body": "P.P.S.: (For other tickets as well:) You don't have to add keywords that are already contained in the ticket's title; also case doesn't matter as far as I know. Substrings also match.\n\nThe best trac \"keywords\" I've found so far are \"r\" and \"64\". :D\n\nI really wonder if anyone will ever search for these, and if so, I strongly doubt he/she will [quickly] find what he/she was looking for...",
    "created_at": "2010-12-04T16:12:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10370#issuecomment-106642",
    "user": "@nexttime"
}
```

P.P.S.: (For other tickets as well:) You don't have to add keywords that are already contained in the ticket's title; also case doesn't matter as far as I know. Substrings also match.

The best trac "keywords" I've found so far are "r" and "64". :D

I really wonder if anyone will ever search for these, and if so, I strongly doubt he/she will [quickly] find what he/she was looking for...



---

archive/issue_comments_106643.json:
```json
{
    "body": "Replying to [comment:4 leif]:\n> Replying to [comment:3 jdemeyer]:\n> > I've made some very minor changes, dropped .p0 from version number and made `spkg-install` executable.  New spkg: [http://sage.math.washington.edu/home/jdemeyer/spkg/jinja2-2.5.5.spkg](http://sage.math.washington.edu/home/jdemeyer/spkg/jinja2-2.5.5.spkg)\n> \n> The p0 was intentional, as IMHO *every* Sage package should have a \"patch\" level, be it zero for the first spkg in a new upstream series, to avoid confusion with (vanilla) upstream tarballs and packages.\nUpstream tarballs and packages don't have an `.spkg` extension, so I don't think there is much confusion possible.\n\nAbout the naming: it seems there are no rules for this.  I would personally always add a patch level if the package contains patches, no patch level otherwise (as is the case with Jinja2).",
    "created_at": "2010-12-04T17:09:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10370#issuecomment-106643",
    "user": "@jdemeyer"
}
```

Replying to [comment:4 leif]:
> Replying to [comment:3 jdemeyer]:
> > I've made some very minor changes, dropped .p0 from version number and made `spkg-install` executable.  New spkg: [http://sage.math.washington.edu/home/jdemeyer/spkg/jinja2-2.5.5.spkg](http://sage.math.washington.edu/home/jdemeyer/spkg/jinja2-2.5.5.spkg)
> 
> The p0 was intentional, as IMHO *every* Sage package should have a "patch" level, be it zero for the first spkg in a new upstream series, to avoid confusion with (vanilla) upstream tarballs and packages.
Upstream tarballs and packages don't have an `.spkg` extension, so I don't think there is much confusion possible.

About the naming: it seems there are no rules for this.  I would personally always add a patch level if the package contains patches, no patch level otherwise (as is the case with Jinja2).



---

archive/issue_comments_106644.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2010-12-04T17:09:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10370#issuecomment-106644",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_106645.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2010-12-04T18:05:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10370#issuecomment-106645",
    "user": "@jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_106646.json:
```json
{
    "body": "Replying to [comment:6 jdemeyer]:\n> Replying to [comment:4 leif]:\n> > The p0 was intentional, as IMHO *every* Sage package should have a \"patch\" level, be it zero for the first spkg in a new upstream series, to avoid confusion with (vanilla) upstream tarballs and packages.\n> Upstream tarballs and packages don't have an `.spkg` extension, so I don't think there is much confusion possible.\n\nAn `.spkg` is essentially the same as a `.tar`, `.tar.gz` or `.tar.bz2`, so the extension doesn't really matter, except that for dealing with an `.spkg` you have to modify filename completion.\n\nSo a \"real\" spkg, with `src/`, `SPKG.txt` and `spkg-install` etc. should have a different basename, which should be the upstream name (unfortunately not always the case) plus Sage's addendum, `.pX`, to distinguish its *content* / structure.\n\nAs said above, you can also directly install some vanilla upstream packages if you only change the extension (from e.g. `.tar.bz2` to `.spkg`); these should clearly be distinguishable by lacking a Sage \"patch level\". (You can of course also rename spkgs to `.tar.bz2` or create links just to make handling them easier. ;-) )\n\n\n \n> About the naming: it seems there are no rules for this.  I would personally always add a patch level if the package contains patches, no patch level otherwise (as is the case with Jinja2).\n\nThis is an endless discussion (some even say there shouldn't be p0's, but only p1's and up).\n\nIMHO we should use p0 for the first package (new or upgraded to a newer upstream version) if there are no actual patches to upstream source code, p1 otherwise, i.e. if we still have to apply patches though upstream is fresh. (Some even start without a patch level despite we patch upstream.)\n\n\"Downgrading\" the patch level, or keeping it for a long time though there have been many changes during the review process is the worst thing. I don't know how many x.y.z.pK**.oldN** spkgs I have. At least posting the new md5sum gets common now.",
    "created_at": "2010-12-04T18:32:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10370#issuecomment-106646",
    "user": "@nexttime"
}
```

Replying to [comment:6 jdemeyer]:
> Replying to [comment:4 leif]:
> > The p0 was intentional, as IMHO *every* Sage package should have a "patch" level, be it zero for the first spkg in a new upstream series, to avoid confusion with (vanilla) upstream tarballs and packages.
> Upstream tarballs and packages don't have an `.spkg` extension, so I don't think there is much confusion possible.

An `.spkg` is essentially the same as a `.tar`, `.tar.gz` or `.tar.bz2`, so the extension doesn't really matter, except that for dealing with an `.spkg` you have to modify filename completion.

So a "real" spkg, with `src/`, `SPKG.txt` and `spkg-install` etc. should have a different basename, which should be the upstream name (unfortunately not always the case) plus Sage's addendum, `.pX`, to distinguish its *content* / structure.

As said above, you can also directly install some vanilla upstream packages if you only change the extension (from e.g. `.tar.bz2` to `.spkg`); these should clearly be distinguishable by lacking a Sage "patch level". (You can of course also rename spkgs to `.tar.bz2` or create links just to make handling them easier. ;-) )


 
> About the naming: it seems there are no rules for this.  I would personally always add a patch level if the package contains patches, no patch level otherwise (as is the case with Jinja2).

This is an endless discussion (some even say there shouldn't be p0's, but only p1's and up).

IMHO we should use p0 for the first package (new or upgraded to a newer upstream version) if there are no actual patches to upstream source code, p1 otherwise, i.e. if we still have to apply patches though upstream is fresh. (Some even start without a patch level despite we patch upstream.)

"Downgrading" the patch level, or keeping it for a long time though there have been many changes during the review process is the worst thing. I don't know how many x.y.z.pK**.oldN** spkgs I have. At least posting the new md5sum gets common now.
