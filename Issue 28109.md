# Issue 28109: Use dots instead of precision in polynomial_element

Issue created by migration from https://trac.sagemath.org/ticket/28346

Original creator: @timokau

Original creation time: 2019-08-12 23:12:35

The precision markers check the precision of real and imaginary part individually. That is problematic when one of the parts is so small that it may be 0, because even 1e-16 is not equal to no number at all.

I ran into this problem when running the sage testsuite on aarch64. There, the 3.88...e-16 components in the touched test files just reduces to 0 because of architecture-dependent precision differences.

Using dots is not particularly nice. Ideally we'd want `#abs tol` to relate to the norm of complex numbers. This works in the meanwhile though.


---

Comment by @timokau created at 2019-08-12 23:12:54

Changing status from new to needs_review.


---

Comment by mmezzarobba created at 2019-08-18 12:25:26

Changing status from needs_review to needs_info.


---

Comment by mmezzarobba created at 2019-08-18 12:25:26

Sorry for nitpicking, but why are you removing many more digits than implied by the tolerances you are replacing?


---

Comment by @timokau created at 2019-08-18 12:50:50

Because I think the tolerances are way too tight currently. It looks like they are just the smallest tolerances we can get away with, which can be brittle. I doubt that anything more than 1e-6 would be seriously useful: Have you ever seen an actual bug that manifests itself only in the 7th significant digit?

I don't feel that strongly about it though. If you prefer I can amend the patch to keep the precision.


---

Comment by mmezzarobba created at 2019-08-18 13:34:38

Replying to [comment:3 gh-timokau]:
> Because I think the tolerances are way too tight currently. It looks like they are just the smallest tolerances we can get away with, which can be brittle.

Maybe. But we are talking about polynomial roots, and, on top of that, very simple ones. To me it would be the sign of a serious problem if they were not accurate essentially to the last digit.

> I doubt that anything more than 1e-6 would be seriously useful: Have you ever seen an actual bug that manifests itself only in the 7th significant digit?

Oh yes I have `:-)`.


---

Comment by @timokau created at 2019-08-18 14:45:07

> Maybe. But we are talking about polynomial roots, and, on top of that, very simple ones. To me it would be the sign of a serious problem if they were not accurate essentially to the last digit.

Well the motivation for this ticket is that it's generally *not* accurate to the last digit. That's just an inherent limitation of floating point calculation. For example, on aarch64 I see differences in the 16th significant digit just because of architecture differences.


---

Comment by mmezzarobba created at 2019-08-18 15:56:46

Replying to [comment:5 gh-timokau]:
> Well the motivation for this ticket is that it's generally *not* accurate to the last digit. That's just an inherent limitation of floating point calculation. For example, on aarch64 I see differences in the 16th significant digit just because of architecture differences.

Yes, that's what I meant by “essentially”. An error that affects half of the mantissa is a different story (for instance, it could come from doing one less Newton step than you should, or using a formula subject to catastrophic cancellation, or inadvertently casting from `float` to `double`).


---

Comment by git created at 2019-08-18 16:52:33

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by @timokau created at 2019-08-18 16:55:03

Fair enough. I've amended the commit to include 14 digits after the point (though I'm not entirely sure `#abs tol 1e-14` is supposed to be digits after the point or total significant digits).


---

Comment by @timokau created at 2019-08-18 16:55:11

Changing status from needs_info to needs_review.


---

Comment by @timokau created at 2019-08-18 17:00:29

Okay so apparently it means the *difference* between the actual result and the one in the test can't exceed 1e-14, which makes sense. So my changes should be correct.


---

Comment by mmezzarobba created at 2019-08-18 18:55:10

Thank you!


---

Comment by mmezzarobba created at 2019-08-18 18:55:10

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-08-19 22:11:53

Author name should be the actual name, not trac username


---

Comment by vbraun created at 2019-08-19 22:11:53

Changing status from positive_review to needs_work.


---

Comment by @timokau created at 2019-08-19 22:37:35

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2019-08-21 22:27:36

Resolution: fixed
