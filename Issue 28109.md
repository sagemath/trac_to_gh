# Issue 28109: Use dots instead of precision in polynomial_element

archive/issues_028109.json:
```json
{
    "body": "The precision markers check the precision of real and imaginary part individually. That is problematic when one of the parts is so small that it may be 0, because even 1e-16 is not equal to no number at all.\n\nI ran into this problem when running the sage testsuite on aarch64. There, the 3.88...e-16 components in the touched test files just reduces to 0 because of architecture-dependent precision differences.\n\nUsing dots is not particularly nice. Ideally we'd want `#abs tol` to relate to the norm of complex numbers. This works in the meanwhile though.\n\nIssue created by migration from https://trac.sagemath.org/ticket/28346\n\n",
    "created_at": "2019-08-12T23:12:35Z",
    "labels": [
        "component: doctest framework"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.9",
    "title": "Use dots instead of precision in polynomial_element",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28109",
    "user": "https://github.com/timokau"
}
```
The precision markers check the precision of real and imaginary part individually. That is problematic when one of the parts is so small that it may be 0, because even 1e-16 is not equal to no number at all.

I ran into this problem when running the sage testsuite on aarch64. There, the 3.88...e-16 components in the touched test files just reduces to 0 because of architecture-dependent precision differences.

Using dots is not particularly nice. Ideally we'd want `#abs tol` to relate to the norm of complex numbers. This works in the meanwhile though.

Issue created by migration from https://trac.sagemath.org/ticket/28346





---

archive/issue_comments_396679.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-08-12T23:12:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28109",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28109#issuecomment-396679",
    "user": "https://github.com/timokau"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_396680.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2019-08-18T12:25:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28109",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28109#issuecomment-396680",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_396681.json:
```json
{
    "body": "Sorry for nitpicking, but why are you removing many more digits than implied by the tolerances you are replacing?",
    "created_at": "2019-08-18T12:25:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28109",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28109#issuecomment-396681",
    "user": "https://github.com/mezzarobba"
}
```

Sorry for nitpicking, but why are you removing many more digits than implied by the tolerances you are replacing?



---

archive/issue_comments_396682.json:
```json
{
    "body": "Because I think the tolerances are way too tight currently. It looks like they are just the smallest tolerances we can get away with, which can be brittle. I doubt that anything more than 1e-6 would be seriously useful: Have you ever seen an actual bug that manifests itself only in the 7th significant digit?\n\nI don't feel that strongly about it though. If you prefer I can amend the patch to keep the precision.",
    "created_at": "2019-08-18T12:50:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28109",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28109#issuecomment-396682",
    "user": "https://github.com/timokau"
}
```

Because I think the tolerances are way too tight currently. It looks like they are just the smallest tolerances we can get away with, which can be brittle. I doubt that anything more than 1e-6 would be seriously useful: Have you ever seen an actual bug that manifests itself only in the 7th significant digit?

I don't feel that strongly about it though. If you prefer I can amend the patch to keep the precision.



---

archive/issue_comments_396683.json:
```json
{
    "body": "Replying to [comment:3 gh-timokau]:\n> Because I think the tolerances are way too tight currently. It looks like they are just the smallest tolerances we can get away with, which can be brittle.\n\nMaybe. But we are talking about polynomial roots, and, on top of that, very simple ones. To me it would be the sign of a serious problem if they were not accurate essentially to the last digit.\n\n> I doubt that anything more than 1e-6 would be seriously useful: Have you ever seen an actual bug that manifests itself only in the 7th significant digit?\n\nOh yes I have `:-)`.",
    "created_at": "2019-08-18T13:34:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28109",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28109#issuecomment-396683",
    "user": "https://github.com/mezzarobba"
}
```

Replying to [comment:3 gh-timokau]:
> Because I think the tolerances are way too tight currently. It looks like they are just the smallest tolerances we can get away with, which can be brittle.

Maybe. But we are talking about polynomial roots, and, on top of that, very simple ones. To me it would be the sign of a serious problem if they were not accurate essentially to the last digit.

> I doubt that anything more than 1e-6 would be seriously useful: Have you ever seen an actual bug that manifests itself only in the 7th significant digit?

Oh yes I have `:-)`.



---

archive/issue_comments_396684.json:
```json
{
    "body": "> Maybe. But we are talking about polynomial roots, and, on top of that, very simple ones. To me it would be the sign of a serious problem if they were not accurate essentially to the last digit.\n\nWell the motivation for this ticket is that it's generally *not* accurate to the last digit. That's just an inherent limitation of floating point calculation. For example, on aarch64 I see differences in the 16th significant digit just because of architecture differences.",
    "created_at": "2019-08-18T14:45:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28109",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28109#issuecomment-396684",
    "user": "https://github.com/timokau"
}
```

> Maybe. But we are talking about polynomial roots, and, on top of that, very simple ones. To me it would be the sign of a serious problem if they were not accurate essentially to the last digit.

Well the motivation for this ticket is that it's generally *not* accurate to the last digit. That's just an inherent limitation of floating point calculation. For example, on aarch64 I see differences in the 16th significant digit just because of architecture differences.



---

archive/issue_comments_396685.json:
```json
{
    "body": "Replying to [comment:5 gh-timokau]:\n> Well the motivation for this ticket is that it's generally *not* accurate to the last digit. That's just an inherent limitation of floating point calculation. For example, on aarch64 I see differences in the 16th significant digit just because of architecture differences.\n\nYes, that's what I meant by \u201cessentially\u201d. An error that affects half of the mantissa is a different story (for instance, it could come from doing one less Newton step than you should, or using a formula subject to catastrophic cancellation, or inadvertently casting from `float` to `double`).",
    "created_at": "2019-08-18T15:56:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28109",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28109#issuecomment-396685",
    "user": "https://github.com/mezzarobba"
}
```

Replying to [comment:5 gh-timokau]:
> Well the motivation for this ticket is that it's generally *not* accurate to the last digit. That's just an inherent limitation of floating point calculation. For example, on aarch64 I see differences in the 16th significant digit just because of architecture differences.

Yes, that's what I meant by “essentially”. An error that affects half of the mantissa is a different story (for instance, it could come from doing one less Newton step than you should, or using a formula subject to catastrophic cancellation, or inadvertently casting from `float` to `double`).



---

archive/issue_comments_396686.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-08-18T16:52:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28109",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28109#issuecomment-396686",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_396687.json:
```json
{
    "body": "Fair enough. I've amended the commit to include 14 digits after the point (though I'm not entirely sure `#abs tol 1e-14` is supposed to be digits after the point or total significant digits).",
    "created_at": "2019-08-18T16:55:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28109",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28109#issuecomment-396687",
    "user": "https://github.com/timokau"
}
```

Fair enough. I've amended the commit to include 14 digits after the point (though I'm not entirely sure `#abs tol 1e-14` is supposed to be digits after the point or total significant digits).



---

archive/issue_comments_396688.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2019-08-18T16:55:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28109",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28109#issuecomment-396688",
    "user": "https://github.com/timokau"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_396689.json:
```json
{
    "body": "Okay so apparently it means the *difference* between the actual result and the one in the test can't exceed 1e-14, which makes sense. So my changes should be correct.",
    "created_at": "2019-08-18T17:00:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28109",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28109#issuecomment-396689",
    "user": "https://github.com/timokau"
}
```

Okay so apparently it means the *difference* between the actual result and the one in the test can't exceed 1e-14, which makes sense. So my changes should be correct.



---

archive/issue_comments_396690.json:
```json
{
    "body": "Thank you!",
    "created_at": "2019-08-18T18:55:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28109",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28109#issuecomment-396690",
    "user": "https://github.com/mezzarobba"
}
```

Thank you!



---

archive/issue_comments_396691.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-08-18T18:55:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28109",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28109#issuecomment-396691",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_396692.json:
```json
{
    "body": "Author name should be the actual name, not trac username",
    "created_at": "2019-08-19T22:11:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28109",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28109#issuecomment-396692",
    "user": "https://github.com/vbraun"
}
```

Author name should be the actual name, not trac username



---

archive/issue_comments_396693.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-08-19T22:11:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28109",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28109#issuecomment-396693",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_396694.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2019-08-19T22:37:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28109",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28109#issuecomment-396694",
    "user": "https://github.com/timokau"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_396695.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-08-21T22:27:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28109",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28109#issuecomment-396695",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_070797.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-08-21T22:27:36Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28109",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28109#event-70797"
}
```
