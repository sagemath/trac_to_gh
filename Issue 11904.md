# Issue 11904: optional package libogg-1.1.4.spkg causes error upon SAGE_ROOT relocation

archive/issues_011904.json:
```json
{
    "body": "Assignee: tbd\n\nsage-4.7.2 with optional package libogg-1.1.4.spkg installed.\nNow when I move the sage tree I get:\n\n\n```\neno% ./sage\n----------------------------------------------------------------------\n----------------------------------------------------------------------\nThe Sage installation tree may have moved\n(from /home/mariah/sage/sage-4.7.2-x86_64-Linux-core2-fc to /home/mariah/sage/sage-4.7.2-x86_64-Linux-core2-fc-libogg-test).\nChanging various hardcoded paths...\n(Please wait at most a few minutes.)\nDO NOT INTERRUPT THIS.\nError: sage_location: update_pkgconfig_files():\n  File \"ogg.pc\" doesn't contain a definition of SAGE_ROOT.\n  Skipping it...\nDone resetting paths.\nsage:\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/12076\n\n",
    "created_at": "2011-11-23T19:19:20Z",
    "labels": [
        "optional packages",
        "major",
        "bug"
    ],
    "title": "optional package libogg-1.1.4.spkg causes error upon SAGE_ROOT relocation",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11904",
    "user": "mariah"
}
```
Assignee: tbd

sage-4.7.2 with optional package libogg-1.1.4.spkg installed.
Now when I move the sage tree I get:


```
eno% ./sage
----------------------------------------------------------------------
----------------------------------------------------------------------
The Sage installation tree may have moved
(from /home/mariah/sage/sage-4.7.2-x86_64-Linux-core2-fc to /home/mariah/sage/sage-4.7.2-x86_64-Linux-core2-fc-libogg-test).
Changing various hardcoded paths...
(Please wait at most a few minutes.)
DO NOT INTERRUPT THIS.
Error: sage_location: update_pkgconfig_files():
  File "ogg.pc" doesn't contain a definition of SAGE_ROOT.
  Skipping it...
Done resetting paths.
sage:
```


Issue created by migration from https://trac.sagemath.org/ticket/12076





---

archive/issue_comments_136432.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-05-25T19:23:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11904#issuecomment-136432",
    "user": "mhansen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_136433.json:
```json
{
    "body": "Attachment",
    "created_at": "2012-05-25T19:23:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11904#issuecomment-136433",
    "user": "mhansen"
}
```

Attachment



---

archive/issue_comments_136434.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd40.5\".",
    "created_at": "2012-05-25T19:23:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11904#issuecomment-136434",
    "user": "mhansen"
}
```

Changing keywords from "" to "sd40.5".



---

archive/issue_comments_136435.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2012-05-25T21:51:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11904#issuecomment-136435",
    "user": "ddrake"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_136436.json:
```json
{
    "body": "The patch here appears to fix the problem, but I notice that the `ogg.pc` file looks a little different from all the others:\n\n```\ndrake@sagenb:~/s/y5.1.b0/local/lib/pkgconfig$ grep ^prefix= *\nbdw-gc.pc:prefix=${SAGE_ROOT}/local\nfreetype2.pc:prefix=${SAGE_ROOT}/local\ngnutls-extra.pc:prefix=${SAGE_ROOT}/local\ngnutls.pc:prefix=${SAGE_ROOT}/local\ngsl.pc:prefix=${SAGE_ROOT}/local\nlibpng12.pc:prefix=${SAGE_ROOT}/local\nlibpng.pc:prefix=${SAGE_ROOT}/local\nm4ri.pc:prefix=${SAGE_ROOT}/local\nogg.pc:prefix=/home/drake/s/5.1b0/local\nopencdk.pc:prefix=${SAGE_ROOT}/local\npynac.pc:prefix=${SAGE_ROOT}/local\npython-2.7.pc:prefix=${SAGE_ROOT}/local\npython.pc:prefix=${SAGE_ROOT}/local\nsqlite3.pc:prefix=${SAGE_ROOT}/local\nzlib.pc:prefix=${SAGE_ROOT}/local\n```\n\n\nObserve that only `ogg.pc` has the original `SAGE_ROOT` in its `prefix`; all other files have `prefix` in terms of `SAGE_ROOT`. Is that what we want? Is that okay?",
    "created_at": "2012-05-25T21:51:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11904#issuecomment-136436",
    "user": "ddrake"
}
```

The patch here appears to fix the problem, but I notice that the `ogg.pc` file looks a little different from all the others:

```
drake@sagenb:~/s/y5.1.b0/local/lib/pkgconfig$ grep ^prefix= *
bdw-gc.pc:prefix=${SAGE_ROOT}/local
freetype2.pc:prefix=${SAGE_ROOT}/local
gnutls-extra.pc:prefix=${SAGE_ROOT}/local
gnutls.pc:prefix=${SAGE_ROOT}/local
gsl.pc:prefix=${SAGE_ROOT}/local
libpng12.pc:prefix=${SAGE_ROOT}/local
libpng.pc:prefix=${SAGE_ROOT}/local
m4ri.pc:prefix=${SAGE_ROOT}/local
ogg.pc:prefix=/home/drake/s/5.1b0/local
opencdk.pc:prefix=${SAGE_ROOT}/local
pynac.pc:prefix=${SAGE_ROOT}/local
python-2.7.pc:prefix=${SAGE_ROOT}/local
python.pc:prefix=${SAGE_ROOT}/local
sqlite3.pc:prefix=${SAGE_ROOT}/local
zlib.pc:prefix=${SAGE_ROOT}/local
```


Observe that only `ogg.pc` has the original `SAGE_ROOT` in its `prefix`; all other files have `prefix` in terms of `SAGE_ROOT`. Is that what we want? Is that okay?



---

archive/issue_comments_136437.json:
```json
{
    "body": "After installing the patch, did you move the Sage directory and start it?",
    "created_at": "2012-05-25T21:56:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11904#issuecomment-136437",
    "user": "mhansen"
}
```

After installing the patch, did you move the Sage directory and start it?



---

archive/issue_comments_136438.json:
```json
{
    "body": "Replying to [comment:3 mhansen]:\n> After installing the patch, did you move the Sage directory and start it?\n\nI did. And the relocation appears to work properly. I'm mostly just curious about the difference in the `.pc` file.",
    "created_at": "2012-05-25T22:28:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11904#issuecomment-136438",
    "user": "ddrake"
}
```

Replying to [comment:3 mhansen]:
> After installing the patch, did you move the Sage directory and start it?

I did. And the relocation appears to work properly. I'm mostly just curious about the difference in the `.pc` file.



---

archive/issue_comments_136439.json:
```json
{
    "body": "I can confirm this problem, and that this patch fixes it, and the patch seems right, just abstracting out something.\n\nBut Dan and I agree that\n\n```\n        config = config.replace(SAGE_ROOT_absolute, \"${SAGE_ROOT}\")\n```\n\nseems to not be happening here for some reason.  But maybe we are parsing it wrong.",
    "created_at": "2012-05-27T05:59:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11904#issuecomment-136439",
    "user": "kcrisman"
}
```

I can confirm this problem, and that this patch fixes it, and the patch seems right, just abstracting out something.

But Dan and I agree that

```
        config = config.replace(SAGE_ROOT_absolute, "${SAGE_ROOT}")
```

seems to not be happening here for some reason.  But maybe we are parsing it wrong.



---

archive/issue_comments_136440.json:
```json
{
    "body": "The new patch, which applies on top of the previous one, should (really!) fix this issue.",
    "created_at": "2012-05-27T20:53:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11904#issuecomment-136440",
    "user": "mhansen"
}
```

The new patch, which applies on top of the previous one, should (really!) fix this issue.



---

archive/issue_comments_136441.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2012-05-28T00:57:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11904#issuecomment-136441",
    "user": "ddrake"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_136442.json:
```json
{
    "body": "Attachment\n\nWhew! These two patches now fix the problem. To be sure, I'd like one more person to look at this, and then we'll do a positive review.",
    "created_at": "2012-05-28T00:57:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11904#issuecomment-136442",
    "user": "ddrake"
}
```

Attachment

Whew! These two patches now fix the problem. To be sure, I'd like one more person to look at this, and then we'll do a positive review.



---

archive/issue_comments_136443.json:
```json
{
    "body": "Karl-Dieter Crisman tried this and it works as expected. Positive review.",
    "created_at": "2012-05-28T04:13:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11904#issuecomment-136443",
    "user": "ddrake"
}
```

Karl-Dieter Crisman tried this and it works as expected. Positive review.



---

archive/issue_comments_136444.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-05-28T04:13:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11904#issuecomment-136444",
    "user": "ddrake"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_136445.json:
```json
{
    "body": "Changing component from optional packages to scripts.",
    "created_at": "2012-06-02T14:17:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11904#issuecomment-136445",
    "user": "jdemeyer"
}
```

Changing component from optional packages to scripts.



---

archive/issue_comments_136446.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-06-14T06:38:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11904",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11904#issuecomment-136446",
    "user": "jdemeyer"
}
```

Resolution: fixed
