# Issue 11904: optional package libogg-1.1.4.spkg causes error upon SAGE_ROOT relocation

Issue created by migration from https://trac.sagemath.org/ticket/12076

Original creator: mariah

Original creation time: 2011-11-23 19:19:20

Assignee: tbd

sage-4.7.2 with optional package libogg-1.1.4.spkg installed.
Now when I move the sage tree I get:


```
eno% ./sage
----------------------------------------------------------------------
----------------------------------------------------------------------
The Sage installation tree may have moved
(from /home/mariah/sage/sage-4.7.2-x86_64-Linux-core2-fc to /home/mariah/sage/sage-4.7.2-x86_64-Linux-core2-fc-libogg-test).
Changing various hardcoded paths...
(Please wait at most a few minutes.)
DO NOT INTERRUPT THIS.
Error: sage_location: update_pkgconfig_files():
  File "ogg.pc" doesn't contain a definition of SAGE_ROOT.
  Skipping it...
Done resetting paths.
sage:
```



---

Comment by mhansen created at 2012-05-25 19:23:54

Changing status from new to needs_review.


---

Attachment


---

Comment by mhansen created at 2012-05-25 19:23:54

Changing keywords from "" to "sd40.5".


---

Comment by ddrake created at 2012-05-25 21:51:58

Changing status from needs_review to needs_info.


---

Comment by ddrake created at 2012-05-25 21:51:58

The patch here appears to fix the problem, but I notice that the `ogg.pc` file looks a little different from all the others:

```
drake@sagenb:~/s/y5.1.b0/local/lib/pkgconfig$ grep ^prefix= *
bdw-gc.pc:prefix=${SAGE_ROOT}/local
freetype2.pc:prefix=${SAGE_ROOT}/local
gnutls-extra.pc:prefix=${SAGE_ROOT}/local
gnutls.pc:prefix=${SAGE_ROOT}/local
gsl.pc:prefix=${SAGE_ROOT}/local
libpng12.pc:prefix=${SAGE_ROOT}/local
libpng.pc:prefix=${SAGE_ROOT}/local
m4ri.pc:prefix=${SAGE_ROOT}/local
ogg.pc:prefix=/home/drake/s/5.1b0/local
opencdk.pc:prefix=${SAGE_ROOT}/local
pynac.pc:prefix=${SAGE_ROOT}/local
python-2.7.pc:prefix=${SAGE_ROOT}/local
python.pc:prefix=${SAGE_ROOT}/local
sqlite3.pc:prefix=${SAGE_ROOT}/local
zlib.pc:prefix=${SAGE_ROOT}/local
```


Observe that only `ogg.pc` has the original `SAGE_ROOT` in its `prefix`; all other files have `prefix` in terms of `SAGE_ROOT`. Is that what we want? Is that okay?


---

Comment by mhansen created at 2012-05-25 21:56:42

After installing the patch, did you move the Sage directory and start it?


---

Comment by ddrake created at 2012-05-25 22:28:08

Replying to [comment:3 mhansen]:
> After installing the patch, did you move the Sage directory and start it?

I did. And the relocation appears to work properly. I'm mostly just curious about the difference in the `.pc` file.


---

Comment by kcrisman created at 2012-05-27 05:59:56

I can confirm this problem, and that this patch fixes it, and the patch seems right, just abstracting out something.

But Dan and I agree that

```
        config = config.replace(SAGE_ROOT_absolute, "${SAGE_ROOT}")
```

seems to not be happening here for some reason.  But maybe we are parsing it wrong.


---

Comment by mhansen created at 2012-05-27 20:53:44

The new patch, which applies on top of the previous one, should (really!) fix this issue.


---

Comment by ddrake created at 2012-05-28 00:57:18

Changing status from needs_info to needs_review.


---

Attachment

Whew! These two patches now fix the problem. To be sure, I'd like one more person to look at this, and then we'll do a positive review.


---

Comment by ddrake created at 2012-05-28 04:13:24

Karl-Dieter Crisman tried this and it works as expected. Positive review.


---

Comment by ddrake created at 2012-05-28 04:13:24

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2012-06-02 14:17:59

Changing component from optional packages to scripts.


---

Comment by jdemeyer created at 2012-06-14 06:38:43

Resolution: fixed
