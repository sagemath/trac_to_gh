# Issue 21663: AttributeError: class Extension has no attribute '__mro__'

Issue created by migration from https://trac.sagemath.org/ticket/21900

Original creator: slabbe

Original creation time: 2016-11-19 13:35:52

I am trying to build vaucanson in sage and I get the following problem with Cython 0.25.1 :


```
(sage-sh) slabbe@MacBookebastien:build$ make python
[ 20%] Linking CXX shared library libvaucrdyn.dylib
[ 40%] Built target vaucrdyn
Scanning dependencies of target python
[ 60%] Forcing python library compilation
[ 80%] Generating Python module
Traceback (most recent call last):
  File "setup.py", line 41, in <module>
    ext_modules =  cythonize(cython_module),
  File "/Users/slabbe/Applications/sage-git/local/lib/python2.7/site-packages/Cython/Build/Dependencies
.py", line 809, in cythonize
    aliases=aliases)
  File "/Users/slabbe/Applications/sage-git/local/lib/python2.7/site-packages/Cython/Build/Dependencies
.py", line 648, in create_extension_list
    elif isinstance(patterns, basestring) or not isinstance(patterns, collections.Iterable):
  File "/Users/slabbe/Applications/sage-git/local/lib/python/abc.py", line 144, in __instancecheck__
    return cls.__subclasscheck__(subtype)
  File "/Users/slabbe/Applications/sage-git/local/lib/python/abc.py", line 180, in __subclasscheck__
    if issubclass(subclass, scls):
  File "/Users/slabbe/Applications/sage-git/local/lib/python/abc.py", line 180, in __subclasscheck__
    if issubclass(subclass, scls):
  File "/Users/slabbe/Applications/sage-git/local/lib/python/abc.py", line 161, in __subclasscheck__
    ok = cls.__subclasshook__(subclass)
  File "/Users/slabbe/Applications/sage-git/local/lib/python2.7/site-packages/backports_abc.py", line 6
6, in __subclasshook__
    mro = C.__mro__
AttributeError: class Extension has no attribute '__mro__'
make[3]: *** [python/vaucrpy.so] Error 1
make[2]: *** [python/CMakeFiles/python.dir/all] Error 2
make[1]: *** [python/CMakeFiles/python.dir/rule] Error 2
make: *** [python] Error 2
```


This seems to have been fixed a few days ago:
https://github.com/cython/cython/issues/1507

Below is the version I am currently running:

```
(sage-sh) slabbe@MacBookebastien:build$ cython --version
Cython version 0.25.1
(sage-sh) slabbe@MacBookebastien:build$ sage --version
SageMath version 7.5.beta1, Release Date: 2016-10-31
```



---

Comment by jdemeyer created at 2016-11-19 13:44:09

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2016-11-19 13:44:09

How is this related to Sage?


---

Comment by slabbe created at 2016-11-19 13:59:35

Replying to [comment:2 jdemeyer]:
> How is this related to Sage?

I would like to make vaucanson as an optional Sage package.

Question: I am trying to find a workaround. I was thinking to add a patch on Cython-0.25.1. But where is the file backports_abc.py ? It does not seem to be inside of Cython-0.25.1 ?


---

Comment by slabbe created at 2016-11-19 14:17:15

Ok, now I see. The solution to this ticket to update Sage standard package `backports_abc` from version 0.4 to 0.5.

https://pypi.python.org/pypi/backports_abc

Jeroen, if you agree, I will change the title of this ticket to "update backports_abc to 0.5" and I suggest to not close this ticket as "won't fix".


---

Comment by slabbe created at 2016-11-19 14:27:07

Changing component from cython to packages: standard.


---

Comment by slabbe created at 2016-11-19 14:27:07

New commits:


---

Comment by jdemeyer created at 2016-11-19 17:08:39

Why the `.p0` in the version number?


---

Comment by jdemeyer created at 2016-11-19 17:08:39

Changing status from needs_review to needs_info.


---

Comment by jdemeyer created at 2016-11-19 17:40:27

Where is the new package?


---

Comment by git created at 2016-11-19 19:09:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by slabbe created at 2016-11-19 19:21:41

Changing status from needs_info to needs_review.


---

Comment by slabbe created at 2016-11-19 19:21:41

Replying to [comment:9 jdemeyer]:
> Why the `.p0` in the version number?

For the same reason as there was a `.p0` in the version number for 0.4 without any patches to apply. So I removed the `.p0` to be consistent with the fact that there is no patches to apply.

I also added a link to the tarball available on pypi in the first line of description of this ticket.

Needs review.


---

Comment by git created at 2016-11-19 19:24:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by slabbe created at 2016-11-19 19:26:08

I folded the two commits into one.


---

Comment by slabbe created at 2016-11-19 19:37:49

Replying to [comment:9 jdemeyer]:
> Why the `.p0` in the version number?

Maybe you know the answer more than me:


```
$ git show 783cd7d build/pkgs/backports_abc
commit 783cd7d541970012f037de0364df099312d2624a
Author: Jeroen Demeyer <jdemeyer@cage.ugent.be>
Date:   Tue Sep 20 10:37:56 2016 +0200

    Re-install all pip-installed packages

diff --git a/build/pkgs/backports_abc/package-version.txt b/build/pkgs/backports_abc/package-version.txt
index bd73f47..fba722f 100644
--- a/build/pkgs/backports_abc/package-version.txt
+++ b/build/pkgs/backports_abc/package-version.txt
@@ -1 +1 @@
-0.4
+0.4.p0
```


So should it be with or without `.p0`?


---

Comment by slabbe created at 2016-11-19 19:57:06

Ok, I found the ticket (https://trac.sagemath.org/ticket/21441#comment:21) which was related to the commit adding the `.p0` to force reinstallation of some packages. So, I got my answer: that `.p0` should be removed for `0.5`.


---

Comment by jdemeyer created at 2016-11-20 19:21:24

I can't verify that it fixes your problem but otherwise this is fine...


---

Comment by jdemeyer created at 2016-11-20 19:21:24

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-11-21 21:56:15

Resolution: fixed
