# Issue 25574: os.path.abspath does not work for Windows-style paths on Cygwin

Issue created by migration from https://trac.sagemath.org/ticket/25811

Original creator: embray

Original creation time: 2018-07-10 11:28:47

As [this question](https://ask.sagemath.org/question/42870/using-sagemath-on-windows-10-impossible-to-attach-file/?answer=42883#post-id-42883) demonstrated, passing a Windows-style absolute path (e.g. paths starting with a drive letter) to interfaces that pass the path through `os.path.abspath` breaks on Cygwin.

This is because the `os.path` module in Python on Cygwin is just the `posixpath` module (whereas on Windows the `ntpath` module is used).  The `posixpath` module, understandably, doesn't know anything about Windows paths, which leads to incompatibilities with Cygwin's unusual hybrid path handling.

I believe this should be fixed in Python, but it might not be an easy fix to get in.  In the meantime, it would be user-friendly (albeit annoying to implement) if more user-facing functions in Sage were friendlier to Windows paths in this context.  Note, this is not a problem for all interfaces that take a filename argument.  It only appears to be a problem when filenames are passed through `os.path.abspath`, which a quick grep demonstrates that there aren't too many of.

Perhaps we could have a generic path normalization function which also takes into account the Cygwin case, and use that where appropriate.  I don't even believe this is necessary for ''all' uses of `os.path.abspath` in Sage.  Only in high-level user-facing APIs like `attach()`.


---

Comment by embray created at 2018-07-10 11:29:41

Note, the same problem also applies to `os.path.isabs`.


---

Comment by jdemeyer created at 2018-07-10 12:40:26

I'd rather monkey-patch `os.path.abspath` instead of using a custom function in Sage.


---

Comment by jdemeyer created at 2018-07-10 12:42:05

Note: `abspath` uses `isabs` internally, so really only the latter needs to be fixed.


---

Comment by embray created at 2018-07-10 12:42:14

Hmm...a bit sketchy maybe, but I'm not opposed.


---

Comment by embray created at 2018-07-10 12:45:00

Replying to [comment:4 jdemeyer]:
> Note: `abspath` uses `isabs` internally, so really only the latter needs to be fixed.

Yes, I think I agree with that.


---

Comment by embray created at 2018-07-12 15:25:44

There are some other functions in `posixpath` that don't work on Windows paths, such as `os.path.dirname()`.  I'm not sure if there's anything affected by that though.


---

Comment by embray created at 2018-12-28 14:10:15

Retargeting some of my tickets (somewhat optimistically for now).


---

Comment by embray created at 2019-03-25 10:44:36

Removing most of the rest of my open tickets out of the 8.7 milestone, which should be closed.
