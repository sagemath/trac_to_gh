# Issue 27735: py3: fix last doctest in cpython folder

archive/issues_027735.json:
```json
{
    "body": "CC:  @jhpalmieri @tscrim\n\nusing hash() as suggest in #27886\n\nIssue created by migration from https://trac.sagemath.org/ticket/27972\n\n",
    "created_at": "2019-06-12T08:00:20Z",
    "labels": [
        "component: python3"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "py3: fix last doctest in cpython folder",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27735",
    "user": "https://github.com/fchapoton"
}
```
CC:  @jhpalmieri @tscrim

using hash() as suggest in #27886

Issue created by migration from https://trac.sagemath.org/ticket/27972





---

archive/issue_comments_391344.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-06-12T08:02:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27735#issuecomment-391344",
    "user": "https://github.com/fchapoton"
}
```

New commits:



---

archive/issue_comments_391345.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-06-12T08:02:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27735#issuecomment-391345",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_391346.json:
```json
{
    "body": "an easy one",
    "created_at": "2019-06-12T08:02:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27735#issuecomment-391346",
    "user": "https://github.com/fchapoton"
}
```

an easy one



---

archive/issue_comments_391347.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-06-12T08:20:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27735#issuecomment-391347",
    "user": "https://github.com/vinklein"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_391348.json:
```json
{
    "body": "Looks good to me.",
    "created_at": "2019-06-12T08:20:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27735#issuecomment-391348",
    "user": "https://github.com/vinklein"
}
```

Looks good to me.



---

archive/issue_comments_391349.json:
```json
{
    "body": "Was literally in the process of saying the same just now :)",
    "created_at": "2019-06-12T08:22:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27735#issuecomment-391349",
    "user": "https://github.com/embray"
}
```

Was literally in the process of saying the same just now :)



---

archive/issue_comments_391350.json:
```json
{
    "body": "Oops!",
    "created_at": "2019-06-12T08:23:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27735#issuecomment-391350",
    "user": "https://github.com/embray"
}
```

Oops!



---

archive/issue_comments_391351.json:
```json
{
    "body": "Let's be fair.",
    "created_at": "2019-06-12T09:17:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27735#issuecomment-391351",
    "user": "https://github.com/vinklein"
}
```

Let's be fair.



---

archive/issue_comments_391352.json:
```json
{
    "body": "There is nothing wrong with the Sage code, it should work. It would be better to just apply the upstream fix https://github.com/cython/cython/commit/28251032f86c266065e4976080230481b1a1bb29 instead.",
    "created_at": "2019-06-12T09:28:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27735#issuecomment-391352",
    "user": "https://github.com/jdemeyer"
}
```

There is nothing wrong with the Sage code, it should work. It would be better to just apply the upstream fix https://github.com/cython/cython/commit/28251032f86c266065e4976080230481b1a1bb29 instead.



---

archive/issue_comments_391353.json:
```json
{
    "body": "Changing status from positive_review to needs_info.",
    "created_at": "2019-06-12T09:28:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27735#issuecomment-391353",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_info.



---

archive/issue_comments_391354.json:
```json
{
    "body": "Better maybe, but not for the goal of having all tests pass soon in python3.\n\nJeroen, will you be able to provide your alternative solution as a branch ? You seem to have less activity on trac, so I guess you have more urgent matters to handle.\n\nOtherwise, maybe this could be done in another ticket ?",
    "created_at": "2019-06-12T12:11:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27735#issuecomment-391354",
    "user": "https://github.com/fchapoton"
}
```

Better maybe, but not for the goal of having all tests pass soon in python3.

Jeroen, will you be able to provide your alternative solution as a branch ? You seem to have less activity on trac, so I guess you have more urgent matters to handle.

Otherwise, maybe this could be done in another ticket ?



---

archive/issue_comments_391355.json:
```json
{
    "body": "Replying to [comment:8 chapoton]:\n> Jeroen, will you be able to provide your alternative solution as a branch ?\n\nShould I add it to #27886? It should take little effort.",
    "created_at": "2019-06-12T12:16:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27735#issuecomment-391355",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:8 chapoton]:
> Jeroen, will you be able to provide your alternative solution as a branch ?

Should I add it to #27886? It should take little effort.



---

archive/issue_comments_391356.json:
```json
{
    "body": "Yes, please. And hopefully someone will review that ticket...",
    "created_at": "2019-06-12T12:17:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27735#issuecomment-391356",
    "user": "https://github.com/fchapoton"
}
```

Yes, please. And hopefully someone will review that ticket...



---

archive/issue_comments_391357.json:
```json
{
    "body": "Replying to [comment:8 chapoton]:\n> You seem to have less activity on trac, so I guess you have more urgent matters to handle.\n\nNot really \"more urgent matters\" but more \"other matters\".\n\nIn case you are wondering what I have been doing recently: https://docs.python.org/3.8/whatsnew/3.8.html#vectorcall-a-fast-calling-protocol-for-cpython",
    "created_at": "2019-06-12T12:18:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27735#issuecomment-391357",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:8 chapoton]:
> You seem to have less activity on trac, so I guess you have more urgent matters to handle.

Not really "more urgent matters" but more "other matters".

In case you are wondering what I have been doing recently: https://docs.python.org/3.8/whatsnew/3.8.html#vectorcall-a-fast-calling-protocol-for-cpython



---

archive/issue_comments_391358.json:
```json
{
    "body": "There is a very simple workaround here, that makes logical sense for the tests (passing an object through `hash()` necessarily returns whatever the acceptable type for a hash is).  Let's just fix this without having to rely yet again on patching cython or whatever.",
    "created_at": "2019-06-12T13:05:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27735#issuecomment-391358",
    "user": "https://github.com/embray"
}
```

There is a very simple workaround here, that makes logical sense for the tests (passing an object through `hash()` necessarily returns whatever the acceptable type for a hash is).  Let's just fix this without having to rely yet again on patching cython or whatever.



---

archive/issue_comments_391359.json:
```json
{
    "body": "I already added the patch to #27886.",
    "created_at": "2019-06-12T13:08:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27735#issuecomment-391359",
    "user": "https://github.com/jdemeyer"
}
```

I already added the patch to #27886.



---

archive/issue_comments_391360.json:
```json
{
    "body": "I feel like the changes here make sense independently of the Cython patch: I believe that\n\n```\nsage: D = {1230981308409180310928308123: ZZ} # random large integer\nsage: test_del_dictitem_by_exact_value(D, ZZ, 1230981308409180310928308123)\n```\n\nwill fail, while\n\n```\nsage: D = {1230981308409180310928308123: ZZ}\nsage: test_del_dictitem_by_exact_value(D, ZZ, hash(1230981308409180310928308123))\n```\n\nwill work.\n\nI don't object to testing whether small integers are equal to their hash values, but that  is tested in `integer.pyx`. After the changes here, the doctest still tests the appropriate function, and they also indicate how to use the function:\n\n```\nsage: D = {'a': ZZ}\nsage: test_del_dictitem_by_exact_value(D, ZZ, hash('a'))\n```\n",
    "created_at": "2019-06-12T15:10:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27735#issuecomment-391360",
    "user": "https://github.com/jhpalmieri"
}
```

I feel like the changes here make sense independently of the Cython patch: I believe that

```
sage: D = {1230981308409180310928308123: ZZ} # random large integer
sage: test_del_dictitem_by_exact_value(D, ZZ, 1230981308409180310928308123)
```

will fail, while

```
sage: D = {1230981308409180310928308123: ZZ}
sage: test_del_dictitem_by_exact_value(D, ZZ, hash(1230981308409180310928308123))
```

will work.

I don't object to testing whether small integers are equal to their hash values, but that  is tested in `integer.pyx`. After the changes here, the doctest still tests the appropriate function, and they also indicate how to use the function:

```
sage: D = {'a': ZZ}
sage: test_del_dictitem_by_exact_value(D, ZZ, hash('a'))
```




---

archive/issue_comments_391361.json:
```json
{
    "body": "Replying to [comment:14 jhpalmieri]:\n> I don't object to testing whether small integers are equal to their hash values, but that  is tested in `integer.pyx`.\n\nTrue, but unrelated to this ticket. That's not what this doctest is testing.",
    "created_at": "2019-06-12T15:13:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27735#issuecomment-391361",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:14 jhpalmieri]:
> I don't object to testing whether small integers are equal to their hash values, but that  is tested in `integer.pyx`.

True, but unrelated to this ticket. That's not what this doctest is testing.



---

archive/issue_comments_391362.json:
```json
{
    "body": "Are you agreeing with me or disagreeing? I can't tell.\n\nWhat is the doctest supposed to be testing?",
    "created_at": "2019-06-12T16:03:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27735#issuecomment-391362",
    "user": "https://github.com/jhpalmieri"
}
```

Are you agreeing with me or disagreeing? I can't tell.

What is the doctest supposed to be testing?



---

archive/issue_comments_391363.json:
```json
{
    "body": "Replying to [comment:16 jhpalmieri]:\n> What is the doctest supposed to be testing?\n\nThat nothing happens if you give the *wrong* hash value. So basically the test relies on `hash(1) != 2`.",
    "created_at": "2019-06-13T07:02:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27735#issuecomment-391363",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:16 jhpalmieri]:
> What is the doctest supposed to be testing?

That nothing happens if you give the *wrong* hash value. So basically the test relies on `hash(1) != 2`.



---

archive/issue_comments_391364.json:
```json
{
    "body": "The second doctest relies on `hash(1) == 1`. Well, it doesn't rely on it, but if `hash(1) != 1`, then I think it is not testing what is intended.\n\nAnd of course both rely on Sage Integers being valid hash values, which is what is fixed by the patch you posted to #27886.",
    "created_at": "2019-06-13T18:00:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27735#issuecomment-391364",
    "user": "https://github.com/jhpalmieri"
}
```

The second doctest relies on `hash(1) == 1`. Well, it doesn't rely on it, but if `hash(1) != 1`, then I think it is not testing what is intended.

And of course both rely on Sage Integers being valid hash values, which is what is fixed by the patch you posted to #27886.



---

archive/issue_comments_391365.json:
```json
{
    "body": "Tickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).",
    "created_at": "2019-06-14T14:50:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27735#issuecomment-391365",
    "user": "https://github.com/embray"
}
```

Tickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).



---

archive/issue_comments_391366.json:
```json
{
    "body": "should we close this one as invalid ?",
    "created_at": "2019-07-07T07:14:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27735#issuecomment-391366",
    "user": "https://github.com/fchapoton"
}
```

should we close this one as invalid ?



---

archive/issue_comments_391367.json:
```json
{
    "body": "Because of #28112?",
    "created_at": "2019-07-08T18:54:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27735#issuecomment-391367",
    "user": "https://github.com/jhpalmieri"
}
```

Because of #28112?



---

archive/issue_comments_391368.json:
```json
{
    "body": "rather because of the cython upgrade in #27886, which fixes these doctests in py3",
    "created_at": "2019-07-09T19:08:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27735#issuecomment-391368",
    "user": "https://github.com/fchapoton"
}
```

rather because of the cython upgrade in #27886, which fixes these doctests in py3



---

archive/issue_comments_391369.json:
```json
{
    "body": "Replying to [comment:20 chapoton]:\n> should we close this one as invalid ?\n\nSure. All cpython's module tests pass with 8.9.beta1/py3.",
    "created_at": "2019-07-10T07:09:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27735#issuecomment-391369",
    "user": "https://github.com/vinklein"
}
```

Replying to [comment:20 chapoton]:
> should we close this one as invalid ?

Sure. All cpython's module tests pass with 8.9.beta1/py3.



---

archive/issue_comments_391370.json:
```json
{
    "body": "Changing status from needs_info to positive_review.",
    "created_at": "2019-07-10T07:10:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27735#issuecomment-391370",
    "user": "https://github.com/vinklein"
}
```

Changing status from needs_info to positive_review.



---

archive/issue_comments_391371.json:
```json
{
    "body": "Resolution: wontfix",
    "created_at": "2019-07-13T10:21:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27735#issuecomment-391371",
    "user": "https://github.com/fchapoton"
}
```

Resolution: wontfix



---

archive/issue_events_025731.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-07-13T10:21:32Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27735",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27735#event-25731"
}
```
