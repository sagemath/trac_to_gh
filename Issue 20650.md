# Issue 20650: Integration of polynomials over polytopes with LattE

archive/issues_020650.json:
```json
{
    "body": "CC:  jipilab moritz\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/20887\n\n",
    "created_at": "2016-06-27T06:05:10Z",
    "labels": [
        "geometry",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.6",
    "title": "Integration of polynomials over polytopes with LattE",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20650",
    "user": "mkoeppe"
}
```
CC:  jipilab moritz



Issue created by migration from https://trac.sagemath.org/ticket/20887





---

archive/issue_comments_285043.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-03-07T23:42:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20650#issuecomment-285043",
    "user": "mforets"
}
```

New commits:



---

archive/issue_comments_285044.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-08T06:44:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20650#issuecomment-285044",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_285045.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-09T17:30:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20650#issuecomment-285045",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_285046.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-03-09T17:47:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20650#issuecomment-285046",
    "user": "mforets"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_285047.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-03-09T18:00:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20650#issuecomment-285047",
    "user": "vdelecroix"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_285048.json:
```json
{
    "body": "The commits here and at #22522 are exactly the same (last being `507aea5`). You need to be clear about what belong to which ticket and update the branches accordingly.",
    "created_at": "2017-03-09T18:00:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20650#issuecomment-285048",
    "user": "vdelecroix"
}
```

The commits here and at #22522 are exactly the same (last being `507aea5`). You need to be clear about what belong to which ticket and update the branches accordingly.



---

archive/issue_comments_285049.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-10T08:52:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20650#issuecomment-285049",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_285050.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-03-10T09:03:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20650#issuecomment-285050",
    "user": "mforets"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_285051.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-10T15:07:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20650#issuecomment-285051",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_285052.json:
```json
{
    "body": "there is a test that's being incorrectly parsed by the bot (in the shell it's fine):\n\n\n```\n**********************************************************************\nFile \"src/sage/geometry/polyhedron/base.py\", line 4101, in sage.geometry.polyhedron.base.Polyhedron_base.integrate\nFailed example:\n    P.integrate('[[1,[2,2]]]')    # optional - latte_int\nExpected:\n    Traceback (most recent call last):\n    ...\n    TypeError: LattE integrale cannot be applied over inexact rings.\nGot:\n    <BLANKLINE>\n    Traceback (most recent call last):\n      File \"/Users/forets/sage-src/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 498, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/forets/sage-src/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 861, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.geometry.polyhedron.base.Polyhedron_base.integrate[15]>\", line 1, in <module>\n        P.integrate('[[1,[2,2]]]')    # optional - latte_int\n      File \"/Users/forets/sage-src/sage/local/lib/python2.7/site-packages/sage/geometry/polyhedron/base.py\", line 4109, in integrate\n        raise ValueError(\"LattE integrale cannot be applied over inexact rings.\")\n    ValueError: LattE integrale cannot be applied over inexact rings.\n**********************************************************************\n```\n",
    "created_at": "2017-03-10T15:10:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20650#issuecomment-285052",
    "user": "mforets"
}
```

there is a test that's being incorrectly parsed by the bot (in the shell it's fine):


```
**********************************************************************
File "src/sage/geometry/polyhedron/base.py", line 4101, in sage.geometry.polyhedron.base.Polyhedron_base.integrate
Failed example:
    P.integrate('[[1,[2,2]]]')    # optional - latte_int
Expected:
    Traceback (most recent call last):
    ...
    TypeError: LattE integrale cannot be applied over inexact rings.
Got:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/Users/forets/sage-src/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 498, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/forets/sage-src/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 861, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.geometry.polyhedron.base.Polyhedron_base.integrate[15]>", line 1, in <module>
        P.integrate('[[1,[2,2]]]')    # optional - latte_int
      File "/Users/forets/sage-src/sage/local/lib/python2.7/site-packages/sage/geometry/polyhedron/base.py", line 4109, in integrate
        raise ValueError("LattE integrale cannot be applied over inexact rings.")
    ValueError: LattE integrale cannot be applied over inexact rings.
**********************************************************************
```




---

archive/issue_comments_285053.json:
```json
{
    "body": "(migrated from #22522)\n\nReplying to [comment:26 mkoeppe]:\n> Integration over an RDF polyhedron via QQ polyhedron (latte) could make sense *as long as the method converts the answer back to RDF* to indicate that the answer is inexact.\n\nOk, that makes sense! Moreover Vincent convinced me that coercing and instantiating like that is a bad idea, potentially very costly and because it's hidden. In the new patch that's been reverted, but an illustrative example was added.\n \n> As to `change_ring`, this could be useful. I had related discussions with JP.\n\nI've created #22574 for change_ring and #22575 for change_backend.",
    "created_at": "2017-03-10T15:26:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20650#issuecomment-285053",
    "user": "mforets"
}
```

(migrated from #22522)

Replying to [comment:26 mkoeppe]:
> Integration over an RDF polyhedron via QQ polyhedron (latte) could make sense *as long as the method converts the answer back to RDF* to indicate that the answer is inexact.

Ok, that makes sense! Moreover Vincent convinced me that coercing and instantiating like that is a bad idea, potentially very costly and because it's hidden. In the new patch that's been reverted, but an illustrative example was added.
 
> As to `change_ring`, this could be useful. I had related discussions with JP.

I've created #22574 for change_ring and #22575 for change_backend.



---

archive/issue_comments_285054.json:
```json
{
    "body": "\n```\n+        Testing convex decomposition algorithm::\n```\n\nthis should be \"cone decomposition\".\n\n`Polyhedron.integrate` should include tests for lower-dimensional polytopes. Those are not supported by latte's integrate. The result should either be 0 - or a proper error should be raised.",
    "created_at": "2017-03-14T15:28:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20650#issuecomment-285054",
    "user": "mkoeppe"
}
```


```
+        Testing convex decomposition algorithm::
```

this should be "cone decomposition".

`Polyhedron.integrate` should include tests for lower-dimensional polytopes. Those are not supported by latte's integrate. The result should either be 0 - or a proper error should be raised.



---

archive/issue_comments_285055.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-03-14T15:28:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20650#issuecomment-285055",
    "user": "mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_285056.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-15T12:45:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20650#issuecomment-285056",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_285057.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-03-15T12:46:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20650#issuecomment-285057",
    "user": "mforets"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_285058.json:
```json
{
    "body": "Replying to [comment:15 mkoeppe]:\n> {{{\n> +        Testing convex decomposition algorithm::\n> }}}\n> this should be \"cone decomposition\".\n> \n> `Polyhedron.integrate` should include tests for lower-dimensional polytopes. Those are not supported by latte's integrate. The result should either be 0 - or a proper error should be raised.\n\nwait a moment, because i may have misunderstood:\n\n1- if the polytope is not full-dimensional, but the polynomial is in low dimension, then latte gives an answer wrt to the relative interior, as in:\n\n\n```\nsage: P = Polyhedron(vertices=[[0,0],[1,1]])\nsage: from sage.interfaces.latte import integrate as integrate\nsage: x = polygen(QQ, 'x')\nsage: integrate(P.cdd_Hrepresentation(), 2*x^2 + x - 1, cdd=True)\n1/6\n```\n\n\nand we should keep this behaviour. \n\n2- however, in the situation of a multivariate polynomial in a low-dim polytope it breaks,\n\n\n```\nsage: P = Polyhedron(vertices=[[0,0],[1,1]])\nsage: from sage.interfaces.latte import integrate as integrate\nsage: x, y = polygens(QQ, 'x, y')\nsage: integrate(P.cdd_Hrepresentation(), 2*x^2 + x - y, cdd=True)\n...\nSetLength: can't change this vector's length\n```\n\n\nand we should raise an exception.\n\ncan you confirm?",
    "created_at": "2017-03-15T13:28:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20650#issuecomment-285058",
    "user": "mforets"
}
```

Replying to [comment:15 mkoeppe]:
> {{{
> +        Testing convex decomposition algorithm::
> }}}
> this should be "cone decomposition".
> 
> `Polyhedron.integrate` should include tests for lower-dimensional polytopes. Those are not supported by latte's integrate. The result should either be 0 - or a proper error should be raised.

wait a moment, because i may have misunderstood:

1- if the polytope is not full-dimensional, but the polynomial is in low dimension, then latte gives an answer wrt to the relative interior, as in:


```
sage: P = Polyhedron(vertices=[[0,0],[1,1]])
sage: from sage.interfaces.latte import integrate as integrate
sage: x = polygen(QQ, 'x')
sage: integrate(P.cdd_Hrepresentation(), 2*x^2 + x - 1, cdd=True)
1/6
```


and we should keep this behaviour. 

2- however, in the situation of a multivariate polynomial in a low-dim polytope it breaks,


```
sage: P = Polyhedron(vertices=[[0,0],[1,1]])
sage: from sage.interfaces.latte import integrate as integrate
sage: x, y = polygens(QQ, 'x, y')
sage: integrate(P.cdd_Hrepresentation(), 2*x^2 + x - y, cdd=True)
...
SetLength: can't change this vector's length
```


and we should raise an exception.

can you confirm?



---

archive/issue_comments_285059.json:
```json
{
    "body": "Replying to [comment:19 mforets]:\n> {{{\n> sage: P = Polyhedron(vertices=[[0,0],[1,1]])\n> sage: from sage.interfaces.latte import integrate as integrate\n> sage: x = polygen(QQ, 'x')\n> sage: integrate(P.cdd_Hrepresentation(), 2*x^2 + x - 1, cdd=True)\n> 1/6\n> }}}\n> \n> and we should keep this behaviour. \n\nUnfortunately, there is no control over what exact transformation LattE applies; and so the input polynomial is meaningless even though it has the correct number of variables.",
    "created_at": "2017-03-15T23:17:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20650#issuecomment-285059",
    "user": "mkoeppe"
}
```

Replying to [comment:19 mforets]:
> {{{
> sage: P = Polyhedron(vertices=[[0,0],[1,1]])
> sage: from sage.interfaces.latte import integrate as integrate
> sage: x = polygen(QQ, 'x')
> sage: integrate(P.cdd_Hrepresentation(), 2*x^2 + x - 1, cdd=True)
> 1/6
> }}}
> 
> and we should keep this behaviour. 

Unfortunately, there is no control over what exact transformation LattE applies; and so the input polynomial is meaningless even though it has the correct number of variables.



---

archive/issue_comments_285060.json:
```json
{
    "body": "Replying to [comment:20 mkoeppe]:\n> Replying to [comment:19 mforets]:\n> > {{{\n> > sage: P = Polyhedron(vertices=[[0,0],[1,1]])\n> > sage: from sage.interfaces.latte import integrate as integrate\n> > sage: x = polygen(QQ, 'x')\n> > sage: integrate(P.cdd_Hrepresentation(), 2*x^2 + x - 1, cdd=True)\n> > 1/6\n> > }}}\n> > \n> > and we should keep this behaviour. \n> \n> Unfortunately, there is no control over what exact transformation LattE applies; and so the input polynomial is meaningless even though it has the correct number of variables.\n> \n\nok then; commit ec15897 raises exception in both cases.",
    "created_at": "2017-03-16T07:36:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20650#issuecomment-285060",
    "user": "mforets"
}
```

Replying to [comment:20 mkoeppe]:
> Replying to [comment:19 mforets]:
> > {{{
> > sage: P = Polyhedron(vertices=[[0,0],[1,1]])
> > sage: from sage.interfaces.latte import integrate as integrate
> > sage: x = polygen(QQ, 'x')
> > sage: integrate(P.cdd_Hrepresentation(), 2*x^2 + x - 1, cdd=True)
> > 1/6
> > }}}
> > 
> > and we should keep this behaviour. 
> 
> Unfortunately, there is no control over what exact transformation LattE applies; and so the input polynomial is meaningless even though it has the correct number of variables.
> 

ok then; commit ec15897 raises exception in both cases.



---

archive/issue_comments_285061.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-03-16T22:54:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20650#issuecomment-285061",
    "user": "mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_285062.json:
```json
{
    "body": "I tested this on top of 7.6rc0 and got:\n\n```\nsage -t src/sage/geometry/polyhedron/base.py\n**********************************************************************\nFile \"src/sage/geometry/polyhedron/base.py\", line 4232, in sage.geometry.polyhedron.base.Polyhedron_base.integrate\nFailed example:\n    P.integrate('[[1,[2,2]]]')    # optional - latte_int\nExpected:\n    Traceback (most recent call last):\n    ...\n    TypeError: LattE integrale cannot be applied over inexact rings.\nGot:\n    <BLANKLINE>\n    Traceback (most recent call last):\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/another-local-sans-autotools/lib/python2.7/site-packages/sage/doctest/forker.py\", line 498, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/another-local-sans-autotools/lib/python2.7/site-packages/sage/doctest/forker.py\", line 861, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.geometry.polyhedron.base.Polyhedron_base.integrate[18]>\", line 1, in <module>\n        P.integrate('[[1,[2,2]]]')    # optional - latte_int\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/another-local-sans-autotools/lib/python2.7/site-packages/sage/geometry/polyhedron/base.py\", line 4240, in integrate\n        raise ValueError(\"LattE integrale cannot be applied over inexact rings.\")\n    ValueError: LattE integrale cannot be applied over inexact rings.\n**********************************************************************\n```\n",
    "created_at": "2017-03-16T22:54:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20650#issuecomment-285062",
    "user": "mkoeppe"
}
```

I tested this on top of 7.6rc0 and got:

```
sage -t src/sage/geometry/polyhedron/base.py
**********************************************************************
File "src/sage/geometry/polyhedron/base.py", line 4232, in sage.geometry.polyhedron.base.Polyhedron_base.integrate
Failed example:
    P.integrate('[[1,[2,2]]]')    # optional - latte_int
Expected:
    Traceback (most recent call last):
    ...
    TypeError: LattE integrale cannot be applied over inexact rings.
Got:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/Users/mkoeppe/s/sage/sage-rebasing/another-local-sans-autotools/lib/python2.7/site-packages/sage/doctest/forker.py", line 498, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/mkoeppe/s/sage/sage-rebasing/another-local-sans-autotools/lib/python2.7/site-packages/sage/doctest/forker.py", line 861, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.geometry.polyhedron.base.Polyhedron_base.integrate[18]>", line 1, in <module>
        P.integrate('[[1,[2,2]]]')    # optional - latte_int
      File "/Users/mkoeppe/s/sage/sage-rebasing/another-local-sans-autotools/lib/python2.7/site-packages/sage/geometry/polyhedron/base.py", line 4240, in integrate
        raise ValueError("LattE integrale cannot be applied over inexact rings.")
    ValueError: LattE integrale cannot be applied over inexact rings.
**********************************************************************
```




---

archive/issue_comments_285063.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-19T08:34:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20650#issuecomment-285063",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_285064.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-03-19T08:35:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20650#issuecomment-285064",
    "user": "mforets"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_285065.json:
```json
{
    "body": "Replying to [comment:23 mkoeppe]:\n> I tested this on top of 7.6rc0 and got:\n> {{{\n> sage -t src/sage/geometry/polyhedron/base.py\n> **********************************************************************\n> File \"src/sage/geometry/polyhedron/base.py\", line 4232, in sage.geometry.polyhedron.base.Polyhedron_base.integrate\n> Failed example:\n>     P.integrate('[This is the Trac macro *1,[2,2* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#1,[2,2-macro)]')    # optional - latte_int\n> Expected:\n>     Traceback (most recent call last):\n>     ...\n>     TypeError: LattE integrale cannot be applied over inexact rings.\n> Got:\n>     <BLANKLINE>\n>     Traceback (most recent call last):\n>       File \"/Users/mkoeppe/s/sage/sage-rebasing/another-local-sans-autotools/lib/python2.7/site-packages/sage/doctest/forker.py\", line 498, in _run\n>         self.compile_and_execute(example, compiler, test.globs)\n>       File \"/Users/mkoeppe/s/sage/sage-rebasing/another-local-sans-autotools/lib/python2.7/site-packages/sage/doctest/forker.py\", line 861, in compile_and_execute\n>         exec(compiled, globs)\n>       File \"<doctest sage.geometry.polyhedron.base.Polyhedron_base.integrate[18]>\", line 1, in <module>\n>         P.integrate('[This is the Trac macro *1,[2,2* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#1,[2,2-macro)]')    # optional - latte_int\n>       File \"/Users/mkoeppe/s/sage/sage-rebasing/another-local-sans-autotools/lib/python2.7/site-packages/sage/geometry/polyhedron/base.py\", line 4240, in integrate\n>         raise ValueError(\"LattE integrale cannot be applied over inexact rings.\")\n>     ValueError: LattE integrale cannot be applied over inexact rings.\n> **********************************************************************\n> }}}\n\nthanks Matthias; i did run the tests before submitting, but there was this \"<BLANKLINE>\" thing that i didn't know how to solve. but actually it was a trivial error on my side. anyway, commit \u200b1cf59f4 shall fix it.",
    "created_at": "2017-03-19T08:41:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20650#issuecomment-285065",
    "user": "mforets"
}
```

Replying to [comment:23 mkoeppe]:
> I tested this on top of 7.6rc0 and got:
> {{{
> sage -t src/sage/geometry/polyhedron/base.py
> **********************************************************************
> File "src/sage/geometry/polyhedron/base.py", line 4232, in sage.geometry.polyhedron.base.Polyhedron_base.integrate
> Failed example:
>     P.integrate('[This is the Trac macro *1,[2,2* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#1,[2,2-macro)]')    # optional - latte_int
> Expected:
>     Traceback (most recent call last):
>     ...
>     TypeError: LattE integrale cannot be applied over inexact rings.
> Got:
>     <BLANKLINE>
>     Traceback (most recent call last):
>       File "/Users/mkoeppe/s/sage/sage-rebasing/another-local-sans-autotools/lib/python2.7/site-packages/sage/doctest/forker.py", line 498, in _run
>         self.compile_and_execute(example, compiler, test.globs)
>       File "/Users/mkoeppe/s/sage/sage-rebasing/another-local-sans-autotools/lib/python2.7/site-packages/sage/doctest/forker.py", line 861, in compile_and_execute
>         exec(compiled, globs)
>       File "<doctest sage.geometry.polyhedron.base.Polyhedron_base.integrate[18]>", line 1, in <module>
>         P.integrate('[This is the Trac macro *1,[2,2* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#1,[2,2-macro)]')    # optional - latte_int
>       File "/Users/mkoeppe/s/sage/sage-rebasing/another-local-sans-autotools/lib/python2.7/site-packages/sage/geometry/polyhedron/base.py", line 4240, in integrate
>         raise ValueError("LattE integrale cannot be applied over inexact rings.")
>     ValueError: LattE integrale cannot be applied over inexact rings.
> **********************************************************************
> }}}

thanks Matthias; i did run the tests before submitting, but there was this "<BLANKLINE>" thing that i didn't know how to solve. but actually it was a trivial error on my side. anyway, commit ​1cf59f4 shall fix it.



---

archive/issue_comments_285066.json:
```json
{
    "body": "Changing keywords from \"\" to \"days84, polytope\".",
    "created_at": "2017-03-19T08:56:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20650#issuecomment-285066",
    "user": "mforets"
}
```

Changing keywords from "" to "days84, polytope".



---

archive/issue_comments_285067.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-03-19T22:16:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20650#issuecomment-285067",
    "user": "mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_285068.json:
```json
{
    "body": "I have to ask, at no point are importing `is_package_installed` from `sage.misc.package` or `sage.misc.all`, yet you are using it. How it is that you don't get \"global name `is_package_installed` is not defined\"?",
    "created_at": "2017-03-28T21:22:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20650#issuecomment-285068",
    "user": "fbissey"
}
```

I have to ask, at no point are importing `is_package_installed` from `sage.misc.package` or `sage.misc.all`, yet you are using it. How it is that you don't get "global name `is_package_installed` is not defined"?



---

archive/issue_comments_285069.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-03-28T22:21:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20650#issuecomment-285069",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_285070.json:
```json
{
    "body": "\n```\nsage -t --long src/sage/geometry/polyhedron/base.py\n**********************************************************************\nFile \"src/sage/geometry/polyhedron/base.py\", line 4308, in sage.geometry.polyhedron.base.Polyhedron_base.integrate\nFailed example:\n    P.integrate(x*y)\nExpected:\n    Traceback (most recent call last):\n    ...\n    NotImplementedError: The polytope must be full-dimensional.\nGot:\n    <BLANKLINE>\n    Traceback (most recent call last):\n      File \"/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 498, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 861, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.geometry.polyhedron.base.Polyhedron_base.integrate[6]>\", line 1, in <module>\n        P.integrate(x*y)\n      File \"/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/geometry/polyhedron/base.py\", line 4355, in integrate\n        raise NotImplementedError('You must install the optional latte_int package for this function to work.')\n    NotImplementedError: You must install the optional latte_int package for this function to work.\n**********************************************************************\n```\n",
    "created_at": "2017-03-28T22:21:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20650#issuecomment-285070",
    "user": "vbraun"
}
```


```
sage -t --long src/sage/geometry/polyhedron/base.py
**********************************************************************
File "src/sage/geometry/polyhedron/base.py", line 4308, in sage.geometry.polyhedron.base.Polyhedron_base.integrate
Failed example:
    P.integrate(x*y)
Expected:
    Traceback (most recent call last):
    ...
    NotImplementedError: The polytope must be full-dimensional.
Got:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 498, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 861, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.geometry.polyhedron.base.Polyhedron_base.integrate[6]>", line 1, in <module>
        P.integrate(x*y)
      File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/geometry/polyhedron/base.py", line 4355, in integrate
        raise NotImplementedError('You must install the optional latte_int package for this function to work.')
    NotImplementedError: You must install the optional latte_int package for this function to work.
**********************************************************************
```




---

archive/issue_comments_285071.json:
```json
{
    "body": "I should have thought about that! Never mind \"is_package_installed\", it is only visible at all because you forgot to mark that particular test `#optional - latte_int`.",
    "created_at": "2017-03-28T22:43:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20650#issuecomment-285071",
    "user": "fbissey"
}
```

I should have thought about that! Never mind "is_package_installed", it is only visible at all because you forgot to mark that particular test `#optional - latte_int`.



---

archive/issue_comments_285072.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-29T05:42:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20650#issuecomment-285072",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_285073.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-03-29T05:43:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20650#issuecomment-285073",
    "user": "mforets"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_285074.json:
```json
{
    "body": "Doesn't fbissey's comment regarding `is_package_installed` need addressing?",
    "created_at": "2017-03-30T05:51:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20650#issuecomment-285074",
    "user": "mkoeppe"
}
```

Doesn't fbissey's comment regarding `is_package_installed` need addressing?



---

archive/issue_comments_285075.json:
```json
{
    "body": "It's a funny, it has to work due to a chain of import from `all.py` \n\n```\nfrom sage.misc.all \t import *         # takes a while\n```\n\nand in `misc/all.py`\n\n```\nfrom .package import (installed_packages, is_package_installed,\n        standard_packages, optional_packages, experimental_packages,\n        package_versions)\n```\n\nBut most other call to it, do an explicit import. I would think it is supposed to work unless I am missing something.",
    "created_at": "2017-03-30T06:40:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20650#issuecomment-285075",
    "user": "fbissey"
}
```

It's a funny, it has to work due to a chain of import from `all.py` 

```
from sage.misc.all 	 import *         # takes a while
```

and in `misc/all.py`

```
from .package import (installed_packages, is_package_installed,
        standard_packages, optional_packages, experimental_packages,
        package_versions)
```

But most other call to it, do an explicit import. I would think it is supposed to work unless I am missing something.



---

archive/issue_comments_285076.json:
```json
{
    "body": "Replying to [comment:34 mkoeppe]:\n> Doesn't fbissey's comment regarding `is_package_installed` need addressing? \n \nbut `is_package_installed` is imported above (line 25). it also has to be imported in the function body? thanks.",
    "created_at": "2017-03-30T06:45:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20650#issuecomment-285076",
    "user": "mforets"
}
```

Replying to [comment:34 mkoeppe]:
> Doesn't fbissey's comment regarding `is_package_installed` need addressing? 
 
but `is_package_installed` is imported above (line 25). it also has to be imported in the function body? thanks.



---

archive/issue_comments_285077.json:
```json
{
    "body": "Let's call it a \"user\" error and forget about my comment about it. I have stuff from the feature branch which removes it. I didn't notice that this file was touched by it. That's why it is absent on my stuff.",
    "created_at": "2017-03-30T06:53:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20650#issuecomment-285077",
    "user": "fbissey"
}
```

Let's call it a "user" error and forget about my comment about it. I have stuff from the feature branch which removes it. I didn't notice that this file was touched by it. That's why it is absent on my stuff.



---

archive/issue_comments_285078.json:
```json
{
    "body": "Ah, thanks for the clarification.",
    "created_at": "2017-03-30T17:56:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20650#issuecomment-285078",
    "user": "mkoeppe"
}
```

Ah, thanks for the clarification.



---

archive/issue_comments_285079.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-03-30T17:56:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20650#issuecomment-285079",
    "user": "mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_285080.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-04-03T21:00:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20650#issuecomment-285080",
    "user": "vbraun"
}
```

Resolution: fixed
