# Issue 12840: MatrixSpace is too eager to construct zero matrices

Issue created by migration from https://trac.sagemath.org/ticket/13012

Original creator: novoselt

Original creation time: 2012-05-25 17:51:22

Assignee: jason, was

CC:  vbraun kcrisman rbeezer

Keywords: sd40.5

This is a follow up to #10793 where it was prohibited to silently change dimensions of a matrix preserving the number of entries (e.g. 3x2 to 2x3). Here is the problem with zeros:

```
sage: m = zero_matrix(2, 3)
sage: m
[0 0 0]
[0 0 0]
sage: M = MatrixSpace(ZZ, 3, 5)
sage: M.zero()
[0 0 0 0 0]
[0 0 0 0 0]
[0 0 0 0 0]
sage: M(m)
[0 0 0 0 0]
[0 0 0 0 0]
[0 0 0 0 0]
```

The last line should have raised an exception. I'm writing a patch.


---

Comment by novoselt created at 2012-05-25 19:25:12

Changing status from new to needs_review.


---

Comment by novoselt created at 2012-05-25 19:46:47

Changing status from needs_review to needs_work.


---

Comment by novoselt created at 2012-05-26 03:22:54

Not yet finished, but I am doing the following:
 * concentrate matrix constructor code in `MatrixSpace.matrix` (currently a lot is done in its `__call__`);
 * quit automatic determination of "data as columns" - this is dangerous since if the code relying on it ever hits a square matrix, it will give a hard to find mistake;
 * drop support for constructing matrices from arbitrary combination of matrices/vectors/scalars introduced at #10628 (and released in Sage-5.0). This was not the goal of that ticket and I think it is a dangerous functionality since it easily lets through wrong code on "corner cases": those who deliberately want to augment or stack matrices should use corresponding methods.

If you object to anything on this list, please talk to me! I think that correctness of this approach is indirectly confirmed by the fact that only tests in `matrix_space` that demonstrate removed functionality fail in the matrix directory (a few tests fail because of a more informative error message).


---

Attachment


---

Comment by novoselt created at 2012-05-27 03:19:58

Changing status from needs_work to needs_review.


---

Comment by novoselt created at 2012-05-27 03:19:58

Summary of what was done:
 * `MatrixSpace.__call__` just calls `MatrixSpace.matrix`, so that the logic is the same for both ways.
 * `row` keyword is deprecated and no guessing for `row=False` is done - this was used only in `matrix_space` for demonstration, so it is unlikely that users use it either.
 * Matrices are now constructed either from a list of entries or from a list of rows, there are special methods for stacking/augmenting matrices.

Two files had to be adjusted:
 * `linear_code` had code which was very strange, I have rewritten it.
 * `matrix_morphism` exploited undocumented functionality - I have removed it and fixed the test.


---

Comment by was created at 2012-05-27 19:43:58

Changing status from needs_review to positive_review.


---

Comment by was created at 2012-05-27 19:43:58

LGTM


---

Comment by jdemeyer created at 2012-06-09 19:23:00

Please fill in your real name in the Author / Reviewer fields.


---

Comment by jdemeyer created at 2012-06-18 10:25:59

Resolution: fixed
