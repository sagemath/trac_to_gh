# Issue 13300: latex_macros: don't evaluate anything on startup

Issue created by migration from https://trac.sagemath.org/ticket/13504

Original creator: jhpalmieri

Original creation time: 2012-09-17 21:46:58

Assignee: jason

CC:  vbraun

Keywords: latex macros

Right now, `sage.misc.latex_macros` evaluates lots of things on startup. The attached patch modifies this: after the patch, the list of LaTeX macros is only computed when asked for.


---

Attachment


---

Comment by jhpalmieri created at 2012-09-17 22:22:38

Changing status from new to needs_review.


---

Comment by vbraun created at 2012-09-18 09:03:58

Maybe I'm missing something, but can't we avoid the bracket bonanza `LatexCall()(x)` with a lazy import? As in http://www.sagemath.org/doc/reference/sage/misc/lazy_import.html
  * don't import `sage.misc.latex` anywhere on startup
  * define an instance `latex = LatexCall()` in `sage.misc.latex`
  * lazy import it from `sage.misc.all`, say


---

Comment by jhpalmieri created at 2012-09-18 17:51:15

`latex` has more uses than just `latex(x)`, which is part of the problem: `latex.blackboard_bold(...)` uses `sage_latex_macros`. If we define `latex = LatexCall()`, then we lose

```
latex.add_macro                             latex.extra_macros
latex.add_package_to_preamble_if_available  latex.extra_preamble
latex.add_to_mathjax_avoid_list             latex.has_file
latex.add_to_preamble                       latex.mathjax_avoid_list
latex.blackboard_bold                       latex.matrix_delimiters
latex.check_file                            latex.pdflatex
latex.engine                                latex.vector_delimiters
```

With the patch, we should only have to do `LatexCall()(x)` a few times, in latex_macros.py; elsewhere, we can just use `latex(x)`.


---

Comment by vbraun created at 2012-09-19 09:34:21

Changing status from needs_review to needs_work.


---

Comment by vbraun created at 2012-09-19 09:34:21

Patch doesn't apply on sage-5.4.beta1. For starters there is no mention of mathjax in `doc/common/conf.py`. Are you missing a dependency?


---

Comment by vbraun created at 2012-09-19 12:03:56

Just noticed that I accidentally applied it to sage-5.3, not 5.4.beta1. Does indeed work fine on the newest version. Patch looks good to me.

Maybe I can interest you in reviewing #13361 which improves the measurement of the startup time?


---

Comment by vbraun created at 2012-09-19 12:03:56

Changing status from needs_work to positive_review.


---

Comment by jdemeyer created at 2012-09-20 10:11:00

This obviously needs to depend on some notebook upgrade.


---

Comment by jdemeyer created at 2013-01-23 15:36:20

Resolution: fixed
