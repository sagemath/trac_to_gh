# Issue 13300: latex_macros: don't evaluate anything on startup

archive/issues_013300.json:
```json
{
    "body": "Assignee: @jasongrout\n\nCC:  @vbraun\n\nKeywords: latex macros\n\nRight now, `sage.misc.latex_macros` evaluates lots of things on startup. The attached patch modifies this: after the patch, the list of LaTeX macros is only computed when asked for.\n\nIssue created by migration from https://trac.sagemath.org/ticket/13504\n\n",
    "created_at": "2012-09-17T21:46:58Z",
    "labels": [
        "component: misc"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.7",
    "title": "latex_macros: don't evaluate anything on startup",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13300",
    "user": "https://github.com/jhpalmieri"
}
```
Assignee: @jasongrout

CC:  @vbraun

Keywords: latex macros

Right now, `sage.misc.latex_macros` evaluates lots of things on startup. The attached patch modifies this: after the patch, the list of LaTeX macros is only computed when asked for.

Issue created by migration from https://trac.sagemath.org/ticket/13504





---

archive/issue_comments_163072.json:
```json
{
    "body": "Attachment [trac_13504-latex-macros.patch](tarball://root/attachments/some-uuid/ticket13504/trac_13504-latex-macros.patch) by @jhpalmieri created at 2012-09-17 22:22:38",
    "created_at": "2012-09-17T22:22:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13300#issuecomment-163072",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment [trac_13504-latex-macros.patch](tarball://root/attachments/some-uuid/ticket13504/trac_13504-latex-macros.patch) by @jhpalmieri created at 2012-09-17 22:22:38



---

archive/issue_comments_163073.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-09-17T22:22:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13300#issuecomment-163073",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_163074.json:
```json
{
    "body": "Maybe I'm missing something, but can't we avoid the bracket bonanza `LatexCall()(x)` with a lazy import? As in http://www.sagemath.org/doc/reference/sage/misc/lazy_import.html\n* don't import `sage.misc.latex` anywhere on startup\n* define an instance `latex = LatexCall()` in `sage.misc.latex`\n* lazy import it from `sage.misc.all`, say",
    "created_at": "2012-09-18T09:03:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13300#issuecomment-163074",
    "user": "https://github.com/vbraun"
}
```

Maybe I'm missing something, but can't we avoid the bracket bonanza `LatexCall()(x)` with a lazy import? As in http://www.sagemath.org/doc/reference/sage/misc/lazy_import.html
* don't import `sage.misc.latex` anywhere on startup
* define an instance `latex = LatexCall()` in `sage.misc.latex`
* lazy import it from `sage.misc.all`, say



---

archive/issue_comments_163075.json:
```json
{
    "body": "`latex` has more uses than just `latex(x)`, which is part of the problem: `latex.blackboard_bold(...)` uses `sage_latex_macros`. If we define `latex = LatexCall()`, then we lose\n\n```\nlatex.add_macro                             latex.extra_macros\nlatex.add_package_to_preamble_if_available  latex.extra_preamble\nlatex.add_to_mathjax_avoid_list             latex.has_file\nlatex.add_to_preamble                       latex.mathjax_avoid_list\nlatex.blackboard_bold                       latex.matrix_delimiters\nlatex.check_file                            latex.pdflatex\nlatex.engine                                latex.vector_delimiters\n```\n\nWith the patch, we should only have to do `LatexCall()(x)` a few times, in latex_macros.py; elsewhere, we can just use `latex(x)`.",
    "created_at": "2012-09-18T17:51:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13300#issuecomment-163075",
    "user": "https://github.com/jhpalmieri"
}
```

`latex` has more uses than just `latex(x)`, which is part of the problem: `latex.blackboard_bold(...)` uses `sage_latex_macros`. If we define `latex = LatexCall()`, then we lose

```
latex.add_macro                             latex.extra_macros
latex.add_package_to_preamble_if_available  latex.extra_preamble
latex.add_to_mathjax_avoid_list             latex.has_file
latex.add_to_preamble                       latex.mathjax_avoid_list
latex.blackboard_bold                       latex.matrix_delimiters
latex.check_file                            latex.pdflatex
latex.engine                                latex.vector_delimiters
```

With the patch, we should only have to do `LatexCall()(x)` a few times, in latex_macros.py; elsewhere, we can just use `latex(x)`.



---

archive/issue_comments_163076.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-09-19T09:34:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13300#issuecomment-163076",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_163077.json:
```json
{
    "body": "Patch doesn't apply on sage-5.4.beta1. For starters there is no mention of mathjax in `doc/common/conf.py`. Are you missing a dependency?",
    "created_at": "2012-09-19T09:34:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13300#issuecomment-163077",
    "user": "https://github.com/vbraun"
}
```

Patch doesn't apply on sage-5.4.beta1. For starters there is no mention of mathjax in `doc/common/conf.py`. Are you missing a dependency?



---

archive/issue_comments_163078.json:
```json
{
    "body": "Just noticed that I accidentally applied it to sage-5.3, not 5.4.beta1. Does indeed work fine on the newest version. Patch looks good to me.\n\nMaybe I can interest you in reviewing #13361 which improves the measurement of the startup time?",
    "created_at": "2012-09-19T12:03:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13300#issuecomment-163078",
    "user": "https://github.com/vbraun"
}
```

Just noticed that I accidentally applied it to sage-5.3, not 5.4.beta1. Does indeed work fine on the newest version. Patch looks good to me.

Maybe I can interest you in reviewing #13361 which improves the measurement of the startup time?



---

archive/issue_comments_163079.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2012-09-19T12:03:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13300#issuecomment-163079",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_163080.json:
```json
{
    "body": "This obviously needs to depend on some notebook upgrade.",
    "created_at": "2012-09-20T10:11:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13300#issuecomment-163080",
    "user": "https://github.com/jdemeyer"
}
```

This obviously needs to depend on some notebook upgrade.



---

archive/issue_comments_163081.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-01-23T15:36:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13300",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13300#issuecomment-163081",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
