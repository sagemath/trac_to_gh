# Issue 30515: switch the default mp library to gmp

archive/issues_030515.json:
```json
{
    "body": "CC:  jhpalmieri mkoeppe mjo\n\ncurrently the default mp library is mpir: the default `--with-mp` is `system`, and in\n`build/pkgs/mpir/spkg-configure.m4` we have\n\n```\nSAGE_SPKG_CONFIGURE([mpir], [\ndnl Implement cases for what to do on different options here\n    case \"$with_mp\" in\n        system)\n            AC_CHECK_HEADER(gmp.h, [], [sage_spkg_install_mpir=yes])\n...\n\ndnl Set SAGE_MP_LIBRARY depending on the with_mp option\n    case \"$with_mp\" in\n    mpir|system)\n        SAGE_MP_LIBRARY=mpir\n        ;;\n    gmp)\n        SAGE_MP_LIBRARY=gmp\n```\n\n\nas `mpir` is getting more and more bitrotten, this should be switched to `gmp` as the default.\n\nAlso, \n\n```\n  --with-mp=system        use the system GMP as multiprecision library, if\n                          possible (default)\n```\n\nis a lie, as can be seen from above, the default is `mpir`, not `gmp`.\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/30752\n\n",
    "created_at": "2020-10-11T10:00:20Z",
    "labels": [
        "build: configure",
        "major",
        "bug"
    ],
    "title": "switch the default mp library to gmp",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30515",
    "user": "dimpase"
}
```
CC:  jhpalmieri mkoeppe mjo

currently the default mp library is mpir: the default `--with-mp` is `system`, and in
`build/pkgs/mpir/spkg-configure.m4` we have

```
SAGE_SPKG_CONFIGURE([mpir], [
dnl Implement cases for what to do on different options here
    case "$with_mp" in
        system)
            AC_CHECK_HEADER(gmp.h, [], [sage_spkg_install_mpir=yes])
...

dnl Set SAGE_MP_LIBRARY depending on the with_mp option
    case "$with_mp" in
    mpir|system)
        SAGE_MP_LIBRARY=mpir
        ;;
    gmp)
        SAGE_MP_LIBRARY=gmp
```


as `mpir` is getting more and more bitrotten, this should be switched to `gmp` as the default.

Also, 

```
  --with-mp=system        use the system GMP as multiprecision library, if
                          possible (default)
```

is a lie, as can be seen from above, the default is `mpir`, not `gmp`.



Issue created by migration from https://trac.sagemath.org/ticket/30752





---

archive/issue_comments_435730.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2020-10-11T17:57:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30515#issuecomment-435730",
    "user": "dimpase"
}
```

Changing priority from major to critical.



---

archive/issue_comments_435731.json:
```json
{
    "body": "marking it critical, as it corrects the `./configure -h` misleading info.\n----\nNew commits:",
    "created_at": "2020-10-11T17:57:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30515#issuecomment-435731",
    "user": "dimpase"
}
```

marking it critical, as it corrects the `./configure -h` misleading info.
----
New commits:



---

archive/issue_comments_435732.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-10-11T18:29:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30515#issuecomment-435732",
    "user": "dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_435733.json:
```json
{
    "body": "the reporting is still a bit misleading:\n\n```\n...\ngmp-6.1.2:                                   using system package; SPKG will not be installed\n...\nmpir-3.0.0-644faf502c56f97d9accd301965fc57d6ec70868.p0:no suitable system package; will be installed as an SPKG\n...\n```\n\nbut this not a regression.",
    "created_at": "2020-10-11T18:29:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30515#issuecomment-435733",
    "user": "dimpase"
}
```

the reporting is still a bit misleading:

```
...
gmp-6.1.2:                                   using system package; SPKG will not be installed
...
mpir-3.0.0-644faf502c56f97d9accd301965fc57d6ec70868.p0:no suitable system package; will be installed as an SPKG
...
```

but this not a regression.



---

archive/issue_comments_435734.json:
```json
{
    "body": "In principle this is okay, and I'm testing it on OS X, but I think it should be merged early in a release, not late in this one, since it needs testing on a wide variety of platforms.",
    "created_at": "2020-10-11T20:33:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30515#issuecomment-435734",
    "user": "jhpalmieri"
}
```

In principle this is okay, and I'm testing it on OS X, but I think it should be merged early in a release, not late in this one, since it needs testing on a wide variety of platforms.



---

archive/issue_comments_435735.json:
```json
{
    "body": "perhaps you'd like to try this together with #30625 - upgrade of Sage's GMP.\n\nI've moved this to 9.3.",
    "created_at": "2020-10-11T21:16:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30515#issuecomment-435735",
    "user": "dimpase"
}
```

perhaps you'd like to try this together with #30625 - upgrade of Sage's GMP.

I've moved this to 9.3.



---

archive/issue_comments_435736.json:
```json
{
    "body": "With Xcode 12, OS X Catalina: works on its own and in combination with #30625.",
    "created_at": "2020-10-12T00:29:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30515#issuecomment-435736",
    "user": "jhpalmieri"
}
```

With Xcode 12, OS X Catalina: works on its own and in combination with #30625.



---

archive/issue_comments_435737.json:
```json
{
    "body": "This will affect all `-minimal` builds - so I am testing it with GH Actions",
    "created_at": "2020-11-10T19:50:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30515#issuecomment-435737",
    "user": "mkoeppe"
}
```

This will affect all `-minimal` builds - so I am testing it with GH Actions



---

archive/issue_comments_435738.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-11-11T17:06:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30515#issuecomment-435738",
    "user": "mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_435739.json:
```json
{
    "body": "This breaks lots of `-minimal` builds - see for example `fedora-31-minimal`  (https://github.com/mkoeppe/sage/runs/1381716520)\n\n```\n  gcc -pthread -shared -Wl,-rpath-link,/sage/local/lib -L/sage/local/lib -Wl,-rpath,/sage/local/lib -L. -Wl,-rpath-link,/sage/local/lib -L/sage/local/lib -Wl,-rpath,/sage/local/lib -Wl,-rpath-link,/sage/local/lib -L/sage/local/lib -Wl,-rpath,/sage/local/lib build/temp.linux-x86_64-3.8/cypari2/closure.o -L/sage/local/lib -L/sage/local/lib64 -L/sage/local/lib -lgmp -lpari -o build/lib.linux-x86_64-3.8/cypari2/closure.cpython-38-x86_64-linux-gnu.so -lpari\n  /usr/bin/ld: cannot find -lgmp\n  collect2: error: ld returned 1 exit status\n  error: command 'gcc' failed with exit status 1\n  Building wheel for cypari2 (setup.py): finished with status 'error'\n```\n",
    "created_at": "2020-11-11T17:06:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30515#issuecomment-435739",
    "user": "mkoeppe"
}
```

This breaks lots of `-minimal` builds - see for example `fedora-31-minimal`  (https://github.com/mkoeppe/sage/runs/1381716520)

```
  gcc -pthread -shared -Wl,-rpath-link,/sage/local/lib -L/sage/local/lib -Wl,-rpath,/sage/local/lib -L. -Wl,-rpath-link,/sage/local/lib -L/sage/local/lib -Wl,-rpath,/sage/local/lib -Wl,-rpath-link,/sage/local/lib -L/sage/local/lib -Wl,-rpath,/sage/local/lib build/temp.linux-x86_64-3.8/cypari2/closure.o -L/sage/local/lib -L/sage/local/lib64 -L/sage/local/lib -lgmp -lpari -o build/lib.linux-x86_64-3.8/cypari2/closure.cpython-38-x86_64-linux-gnu.so -lpari
  /usr/bin/ld: cannot find -lgmp
  collect2: error: ld returned 1 exit status
  error: command 'gcc' failed with exit status 1
  Building wheel for cypari2 (setup.py): finished with status 'error'
```




---

archive/issue_comments_435740.json:
```json
{
    "body": "a logic error in spkg-configure (of mpir or gmp)\n\n```\n2020-11-10T22:56:48.4470802Z Checking whether SageMath should install SPKG mpir...\n2020-11-10T22:56:48.4471312Z checking gmp.h usability... no\n2020-11-10T22:56:48.4471747Z checking gmp.h presence... no\n2020-11-10T22:56:48.4472119Z checking for gmp.h... no\n2020-11-10T22:56:48.4472533Z checking gmpxx.h usability... no\n2020-11-10T22:56:48.4472984Z checking gmpxx.h presence... no\n2020-11-10T22:56:48.4473541Z checking for gmpxx.h... no\n2020-11-10T22:56:48.4473965Z checking for library containing __gmpq_cmp_z... no\n2020-11-10T22:56:48.4474813Z configure: will use system package and not install SPKG mpir\n2020-11-10T22:56:48.4475426Z using gmp SPKG (via --with-mp=gmp)\n2020-11-10T22:56:48.4475906Z -----------------------------------------------------------------------------\n2020-11-10T22:56:48.4476313Z Checking whether SageMath should install SPKG gmp...\n2020-11-10T22:56:48.4476849Z configure: will use system package and not install SPKG gmp\n```\n\nsomehow it thinks that system GMP is available.",
    "created_at": "2020-11-12T09:25:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30515#issuecomment-435740",
    "user": "dimpase"
}
```

a logic error in spkg-configure (of mpir or gmp)

```
2020-11-10T22:56:48.4470802Z Checking whether SageMath should install SPKG mpir...
2020-11-10T22:56:48.4471312Z checking gmp.h usability... no
2020-11-10T22:56:48.4471747Z checking gmp.h presence... no
2020-11-10T22:56:48.4472119Z checking for gmp.h... no
2020-11-10T22:56:48.4472533Z checking gmpxx.h usability... no
2020-11-10T22:56:48.4472984Z checking gmpxx.h presence... no
2020-11-10T22:56:48.4473541Z checking for gmpxx.h... no
2020-11-10T22:56:48.4473965Z checking for library containing __gmpq_cmp_z... no
2020-11-10T22:56:48.4474813Z configure: will use system package and not install SPKG mpir
2020-11-10T22:56:48.4475426Z using gmp SPKG (via --with-mp=gmp)
2020-11-10T22:56:48.4475906Z -----------------------------------------------------------------------------
2020-11-10T22:56:48.4476313Z Checking whether SageMath should install SPKG gmp...
2020-11-10T22:56:48.4476849Z configure: will use system package and not install SPKG gmp
```

somehow it thinks that system GMP is available.



---

archive/issue_comments_435741.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-11-12T11:17:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30515#issuecomment-435741",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_435742.json:
```json
{
    "body": "fixed this (and rebased over latest beta).\nTested with/without gmp present, with various options for `--with-mp=`, all seems to work.",
    "created_at": "2020-11-12T11:24:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30515#issuecomment-435742",
    "user": "dimpase"
}
```

fixed this (and rebased over latest beta).
Tested with/without gmp present, with various options for `--with-mp=`, all seems to work.



---

archive/issue_comments_435743.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-11-12T11:24:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30515#issuecomment-435743",
    "user": "dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_435744.json:
```json
{
    "body": "this round of GH actions looks better, several \"minimal\" jobs completed successfully.\nThese that failed (e.g. ubunuty-trusty) seemed to have failed for an unrelated reason.\nAlthough it's hart to see atm, for the latter one can only see that sagelib build failed somewhere, but the full log is not there - is it supposed to become available at some point after the run completes?",
    "created_at": "2020-11-13T09:34:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30515#issuecomment-435744",
    "user": "dimpase"
}
```

this round of GH actions looks better, several "minimal" jobs completed successfully.
These that failed (e.g. ubunuty-trusty) seemed to have failed for an unrelated reason.
Although it's hart to see atm, for the latter one can only see that sagelib build failed somewhere, but the full log is not there - is it supposed to become available at some point after the run completes?



---

archive/issue_comments_435745.json:
```json
{
    "body": "The full logs are now available as the run has completed",
    "created_at": "2020-11-14T23:55:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30515#issuecomment-435745",
    "user": "mkoeppe"
}
```

The full logs are now available as the run has completed



---

archive/issue_comments_435746.json:
```json
{
    "body": "Replying to [comment:13 mkoeppe]:\n> The full logs are now available as the run has completed\nI don't know where to find  full untruncated logs, such as install.log for e.g. \ndocker (ubuntu-trusty, minimal).\n\"last whatever lines\" do not show the real error.",
    "created_at": "2020-11-15T10:06:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30515#issuecomment-435746",
    "user": "dimpase"
}
```

Replying to [comment:13 mkoeppe]:
> The full logs are now available as the run has completed
I don't know where to find  full untruncated logs, such as install.log for e.g. 
docker (ubuntu-trusty, minimal).
"last whatever lines" do not show the real error.



---

archive/issue_comments_435747.json:
```json
{
    "body": "In the build artifacts listed at https://github.com/mkoeppe/sage/actions/runs/360142559, such as this one: https://github.com/mkoeppe/sage/suites/1493083844/artifacts/26253188\nfor ubuntu-trusty-minimal",
    "created_at": "2020-11-15T19:33:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30515#issuecomment-435747",
    "user": "mkoeppe"
}
```

In the build artifacts listed at https://github.com/mkoeppe/sage/actions/runs/360142559, such as this one: https://github.com/mkoeppe/sage/suites/1493083844/artifacts/26253188
for ubuntu-trusty-minimal



---

archive/issue_comments_435748.json:
```json
{
    "body": "Replying to [comment:15 mkoeppe]:\n> In the build artifacts listed at https://github.com/mkoeppe/sage/actions/runs/360142559, such as this one: https://github.com/mkoeppe/sage/suites/1493083844/artifacts/26253188\n> for ubuntu-trusty-minimal\n\nOK, thanks for pointing to the right direction. In this case the error is about a giac header,\nas can be seen in `logs/pkgs/sagelib-9.3.beta1.log`\n\n\n```\n[197/523] creating build/temp.linux-x86_64-3.8/build/cythonized/sage/libs/giac\ngcc -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -fPIC -Isage/libs/giac -I./sage/cpython -I/sage/local/lib/python3.8/site-packages/cysignals -I/sage/build/pkgs/sagelib/src -I/sage/l\nocal/include/python3.8 -I/sage/local/lib/python3.8/site-packages/numpy/core/include -Ibuild/cythonized -I/sage/local/include/python3.8 -c build/cythonized/sage/libs/giac/giac.cpp -o build/temp.linux-x86_64-3.8/bu\nild/cythonized/sage/libs/giac/giac.o -fno-strict-aliasing -DCYTHON_CLINE_IN_TRACEBACK=1 -fno-tree-copyrename -std=c++11\nbuild/cythonized/sage/libs/giac/giac.cpp:676:23: fatal error: giac/giac.h: No such file or directory\n #include \"giac/giac.h\"\n                       ^\ncompilation terminated.\n```\n\nLooks as if `-I$SAGE_LOCAL/include` is missing in CFLAGS, or something like this.\nNothing to do with the branch on this ticket, anyway.",
    "created_at": "2020-11-15T22:32:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30515#issuecomment-435748",
    "user": "dimpase"
}
```

Replying to [comment:15 mkoeppe]:
> In the build artifacts listed at https://github.com/mkoeppe/sage/actions/runs/360142559, such as this one: https://github.com/mkoeppe/sage/suites/1493083844/artifacts/26253188
> for ubuntu-trusty-minimal

OK, thanks for pointing to the right direction. In this case the error is about a giac header,
as can be seen in `logs/pkgs/sagelib-9.3.beta1.log`


```
[197/523] creating build/temp.linux-x86_64-3.8/build/cythonized/sage/libs/giac
gcc -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -fPIC -Isage/libs/giac -I./sage/cpython -I/sage/local/lib/python3.8/site-packages/cysignals -I/sage/build/pkgs/sagelib/src -I/sage/l
ocal/include/python3.8 -I/sage/local/lib/python3.8/site-packages/numpy/core/include -Ibuild/cythonized -I/sage/local/include/python3.8 -c build/cythonized/sage/libs/giac/giac.cpp -o build/temp.linux-x86_64-3.8/bu
ild/cythonized/sage/libs/giac/giac.o -fno-strict-aliasing -DCYTHON_CLINE_IN_TRACEBACK=1 -fno-tree-copyrename -std=c++11
build/cythonized/sage/libs/giac/giac.cpp:676:23: fatal error: giac/giac.h: No such file or directory
 #include "giac/giac.h"
                       ^
compilation terminated.
```

Looks as if `-I$SAGE_LOCAL/include` is missing in CFLAGS, or something like this.
Nothing to do with the branch on this ticket, anyway.



---

archive/issue_comments_435749.json:
```json
{
    "body": "The problem with giac is probably just that missing dependency, fixed in #30858",
    "created_at": "2020-11-17T03:13:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30515#issuecomment-435749",
    "user": "mkoeppe"
}
```

The problem with giac is probably just that missing dependency, fixed in #30858



---

archive/issue_comments_435750.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-11-17T03:20:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30515#issuecomment-435750",
    "user": "mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_435751.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-11-22T15:06:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30515#issuecomment-435751",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_435752.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2020-11-22T22:22:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30515#issuecomment-435752",
    "user": "vbraun"
}
```

Changing status from closed to new.



---

archive/issue_comments_435753.json:
```json
{
    "body": "On OSX:\n\n```\nvbraun@osx Sage % ./sage -p gmp                       \nFound local metadata for gmp-6.2.0\nUsing cached file /Users/vbraun/Sage/upstream/gmp-6.2.0.tar.xz\ngmp-6.2.0\n====================================================\nSetting up build directory for gmp-6.2.0\nError: Unknown file type: /Users/vbraun/Sage/upstream/gmp-6.2.0.tar.xz\nFinished extraction\n```\n\nThe inability to extract xz is apparently ignored, but obviously install fails sooner or later.",
    "created_at": "2020-11-22T22:22:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30515#issuecomment-435753",
    "user": "vbraun"
}
```

On OSX:

```
vbraun@osx Sage % ./sage -p gmp                       
Found local metadata for gmp-6.2.0
Using cached file /Users/vbraun/Sage/upstream/gmp-6.2.0.tar.xz
gmp-6.2.0
====================================================
Setting up build directory for gmp-6.2.0
Error: Unknown file type: /Users/vbraun/Sage/upstream/gmp-6.2.0.tar.xz
Finished extraction
```

The inability to extract xz is apparently ignored, but obviously install fails sooner or later.



---

archive/issue_comments_435754.json:
```json
{
    "body": "Resolution changed from fixed to ",
    "created_at": "2020-11-22T22:22:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30515#issuecomment-435754",
    "user": "vbraun"
}
```

Resolution changed from fixed to 



---

archive/issue_comments_435755.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-11-22T22:22:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30515#issuecomment-435755",
    "user": "vbraun"
}
```

New commits:



---

archive/issue_comments_435756.json:
```json
{
    "body": "What does this have to do with this ticket? If you can't extract xz files, then you can't extract tarballs for Python, symmetrica, gcc, and gmp.",
    "created_at": "2020-11-22T22:58:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30515#issuecomment-435756",
    "user": "jhpalmieri"
}
```

What does this have to do with this ticket? If you can't extract xz files, then you can't extract tarballs for Python, symmetrica, gcc, and gmp.



---

archive/issue_comments_435757.json:
```json
{
    "body": "These other packages declare a dependency on `xz` (see #30559)",
    "created_at": "2020-11-22T23:00:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30515#issuecomment-435757",
    "user": "mkoeppe"
}
```

These other packages declare a dependency on `xz` (see #30559)



---

archive/issue_comments_435758.json:
```json
{
    "body": "But on OS X, the included version of Python 3, at least as of 10.15.7, can extract `.tar.xz` files using its `tarfile` module. It looks like this feature was added in Python 3.3. We shouldn't need the `xz` executable for this, unless the system only has an old version of Python. Rather than using #30948, or maybe in addition, maybe we should modify the code in `sage_bootstrap.uncompress.tar_file` that handles `xz` files.",
    "created_at": "2020-11-22T23:53:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30515#issuecomment-435758",
    "user": "jhpalmieri"
}
```

But on OS X, the included version of Python 3, at least as of 10.15.7, can extract `.tar.xz` files using its `tarfile` module. It looks like this feature was added in Python 3.3. We shouldn't need the `xz` executable for this, unless the system only has an old version of Python. Rather than using #30948, or maybe in addition, maybe we should modify the code in `sage_bootstrap.uncompress.tar_file` that handles `xz` files.



---

archive/issue_comments_435759.json:
```json
{
    "body": "That's true, but as of #29890, we prefer system python 2 because with python3 we have run into SSL problems. (The correct fix is discussed in the ticket description of #29418.)",
    "created_at": "2020-11-23T00:53:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30515#issuecomment-435759",
    "user": "mkoeppe"
}
```

That's true, but as of #29890, we prefer system python 2 because with python3 we have run into SSL problems. (The correct fix is discussed in the ticket description of #29418.)



---

archive/issue_comments_435760.json:
```json
{
    "body": "Replying to [comment:25 mkoeppe]:\n> The correct fix is discussed in the ticket description of #29418.\nI've opened #30950 for this -- but for the present ticket, let's just add `xz` to the dependencies.",
    "created_at": "2020-11-23T02:02:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30515#issuecomment-435760",
    "user": "mkoeppe"
}
```

Replying to [comment:25 mkoeppe]:
> The correct fix is discussed in the ticket description of #29418.
I've opened #30950 for this -- but for the present ticket, let's just add `xz` to the dependencies.



---

archive/issue_comments_435761.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-11-25T00:06:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30515#issuecomment-435761",
    "user": "mkoeppe"
}
```

New commits:



---

archive/issue_comments_435762.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-11-25T00:06:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30515#issuecomment-435762",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_435763.json:
```json
{
    "body": "lgtm",
    "created_at": "2020-11-25T10:07:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30515#issuecomment-435763",
    "user": "dimpase"
}
```

lgtm



---

archive/issue_comments_435764.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-11-25T10:07:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30515#issuecomment-435764",
    "user": "dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_435765.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-12-05T22:13:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30515",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30515#issuecomment-435765",
    "user": "vbraun"
}
```

Resolution: fixed
