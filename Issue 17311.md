# Issue 17311: sage5.7 Partitions() error

archive/issues_017311.json:
```json
{
    "body": "Assignee: z\n\nCC:  jakobkroeker aschilling\n\nKeywords: Partitions\n\nsage: Partitions(5,min_slope=1).list()\n[[5], [2, 4]]\n\nIssue created by migration from https://trac.sagemath.org/ticket/17548\n\n",
    "created_at": "2014-12-25T05:21:54Z",
    "labels": [
        "number theory",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "sage5.7 Partitions() error",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17311",
    "user": "ferriszorro"
}
```
Assignee: z

CC:  jakobkroeker aschilling

Keywords: Partitions

sage: Partitions(5,min_slope=1).list()
[[5], [2, 4]]

Issue created by migration from https://trac.sagemath.org/ticket/17548





---

archive/issue_comments_230514.json:
```json
{
    "body": "Partitions error",
    "created_at": "2014-12-25T05:23:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17311",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17311#issuecomment-230514",
    "user": "ferriszorro"
}
```

Partitions error



---

archive/issue_comments_230515.json:
```json
{
    "body": "Changing assignee from z to ferriszorro.",
    "created_at": "2014-12-25T05:24:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17311",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17311#issuecomment-230515",
    "user": "ferriszorro"
}
```

Changing assignee from z to ferriszorro.



---

archive/issue_comments_230516.json:
```json
{
    "body": "` #!diff # HG changeset patch # Date 1300721936 0 foo  diff --git a/bar b/bar --- a/bar +++ b/bar `@``@` -1,2 +1,3 `@``@`  baz  quux +xyzzy `",
    "created_at": "2014-12-25T05:27:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17311",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17311#issuecomment-230516",
    "user": "ferriszorro"
}
```

` #!diff # HG changeset patch # Date 1300721936 0 foo  diff --git a/bar b/bar --- a/bar +++ b/bar `@``@` -1,2 +1,3 `@``@`  baz  quux +xyzzy `



---

archive/issue_comments_230517.json:
```json
{
    "body": "Attachment [patch](tarball://root/attachments/some-uuid/ticket17548/patch) by chapoton created at 2014-12-25 08:43:22",
    "created_at": "2014-12-25T08:43:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17311",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17311#issuecomment-230517",
    "user": "chapoton"
}
```

Attachment [patch](tarball://root/attachments/some-uuid/ticket17548/patch) by chapoton created at 2014-12-25 08:43:22



---

archive/issue_comments_230518.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-12-25T08:43:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17311",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17311#issuecomment-230518",
    "user": "chapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_230519.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-12-25T08:57:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17311",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17311#issuecomment-230519",
    "user": "ncohen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_230520.json:
```json
{
    "body": "Fr\u00e9d\u00e9ric: the wontfix tickets should be set to 'positive review', otherwise Volker will not see them.\n\n\"Merry Christmas\",\n\nNathann",
    "created_at": "2014-12-25T08:57:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17311",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17311#issuecomment-230520",
    "user": "ncohen"
}
```

Frédéric: the wontfix tickets should be set to 'positive review', otherwise Volker will not see them.

"Merry Christmas",

Nathann



---

archive/issue_comments_230521.json:
```json
{
    "body": "This being said this bug report is a real bug report `O_o`",
    "created_at": "2014-12-25T08:57:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17311",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17311#issuecomment-230521",
    "user": "ncohen"
}
```

This being said this bug report is a real bug report `O_o`



---

archive/issue_comments_230522.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2014-12-25T17:31:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17311",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17311#issuecomment-230522",
    "user": "tmonteil"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_230523.json:
```json
{
    "body": "I was very puzzled when i saw this ticket, since my Turing tests were not able to conclude (unless we just reached the singularity). I propose to reopen the ticket since the report is correct.\n\nBy the way, i am not sure the following is a correct behaviour:\n\n\n```\nsage: P = Partitions(5, min_slope=2)\nsage: Q = Partitions(5)\nsage: Q[0] \n[5]\nsage: Q[0] in P\nFalse\n```\n",
    "created_at": "2014-12-25T17:31:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17311",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17311#issuecomment-230523",
    "user": "tmonteil"
}
```

I was very puzzled when i saw this ticket, since my Turing tests were not able to conclude (unless we just reached the singularity). I propose to reopen the ticket since the report is correct.

By the way, i am not sure the following is a correct behaviour:


```
sage: P = Partitions(5, min_slope=2)
sage: Q = Partitions(5)
sage: Q[0] 
[5]
sage: Q[0] in P
False
```




---

archive/issue_comments_230524.json:
```json
{
    "body": "Changing component from number theory to combinatorics.",
    "created_at": "2014-12-25T17:31:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17311",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17311#issuecomment-230524",
    "user": "tmonteil"
}
```

Changing component from number theory to combinatorics.



---

archive/issue_comments_230525.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-12-26T19:18:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17311",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17311#issuecomment-230525",
    "user": "tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_230526.json:
```json
{
    "body": "This is actually bad input: the slopes should be negative (to be useful for partitions). From the documentation of `Partitions`:\n\n```\n- ``min_slope=k`` specifies that the partitions have slope at least\n  `k`; the slope is the difference between successive parts.\n```\n\nThe second input is actually correct, that is the only partition of 5 with a positive slope (provided you don't count trailing 0's, which is how Sage currently behaves). With that being said, the internal assumptions of `IntegerListsLex` are also being broken with `min_slope > max_slope == 0`, so it's no surprise bad data is being returned. So this should be a wontfix.",
    "created_at": "2014-12-26T19:18:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17311",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17311#issuecomment-230526",
    "user": "tscrim"
}
```

This is actually bad input: the slopes should be negative (to be useful for partitions). From the documentation of `Partitions`:

```
- ``min_slope=k`` specifies that the partitions have slope at least
  `k`; the slope is the difference between successive parts.
```

The second input is actually correct, that is the only partition of 5 with a positive slope (provided you don't count trailing 0's, which is how Sage currently behaves). With that being said, the internal assumptions of `IntegerListsLex` are also being broken with `min_slope > max_slope == 0`, so it's no surprise bad data is being returned. So this should be a wontfix.



---

archive/issue_comments_230527.json:
```json
{
    "body": "Does this also qualify as bad input ?\n\n\n```\nsage: list(Partitions(5,length=4,min_slope=0))\n...\nValueError: [1, 1, 1, 2] is not a valid partition\n```\n\n\nNathann",
    "created_at": "2014-12-27T02:29:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17311",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17311#issuecomment-230527",
    "user": "ncohen"
}
```

Does this also qualify as bad input ?


```
sage: list(Partitions(5,length=4,min_slope=0))
...
ValueError: [1, 1, 1, 2] is not a valid partition
```


Nathann



---

archive/issue_comments_230528.json:
```json
{
    "body": "Currently yes. From the doc of `IntegerListsLex` (which is the underlying class):\n\n```\n   Note: Caveat: with the current implementation, the constraints\n     should satisfy the following conditions:\n\n     * The upper and lower bounds themselves should satisfy the\n       slope constraints.\n\n     * The maximal and minimal slopes values should not be equal.\n\n     * The maximal and minimal part values should not be equal.\n```\n",
    "created_at": "2014-12-27T03:50:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17311",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17311#issuecomment-230528",
    "user": "tscrim"
}
```

Currently yes. From the doc of `IntegerListsLex` (which is the underlying class):

```
   Note: Caveat: with the current implementation, the constraints
     should satisfy the following conditions:

     * The upper and lower bounds themselves should satisfy the
       slope constraints.

     * The maximal and minimal slopes values should not be equal.

     * The maximal and minimal part values should not be equal.
```




---

archive/issue_comments_230529.json:
```json
{
    "body": "> Currently yes. From the doc of `IntegerListsLex` (which is the underlying class):\n\nCool. So the strategy is to close as wontfix the attempts to change that because, after all, it is not a bug ?\n\nNathann",
    "created_at": "2014-12-27T03:56:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17311",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17311#issuecomment-230529",
    "user": "ncohen"
}
```

> Currently yes. From the doc of `IntegerListsLex` (which is the underlying class):

Cool. So the strategy is to close as wontfix the attempts to change that because, after all, it is not a bug ?

Nathann



---

archive/issue_comments_230530.json:
```json
{
    "body": "The other option would be to recycle this ticket to use for rewriting `IntegerListsLex`, but in terms of historical documentation, I think this would best done on a new ticket.",
    "created_at": "2014-12-27T04:08:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17311",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17311#issuecomment-230530",
    "user": "tscrim"
}
```

The other option would be to recycle this ticket to use for rewriting `IntegerListsLex`, but in terms of historical documentation, I think this would best done on a new ticket.



---

archive/issue_comments_230531.json:
```json
{
    "body": "OK, this ticket should be closed",
    "created_at": "2014-12-27T07:33:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17311",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17311#issuecomment-230531",
    "user": "ferriszorro"
}
```

OK, this ticket should be closed



---

archive/issue_comments_230532.json:
```json
{
    "body": "Replying to [comment:7 tscrim]:\n> This is actually bad input: the slopes should be negative (to be useful for partitions). From the documentation of `Partitions`:\n> {{{\n> - ``min_slope=k`` specifies that the partitions have slope at least\n>   `k`; the slope is the difference between successive parts.\n> }}}\n\nThis is confusing: the difference between `a` and `b` is `a-b` and not `b-a`. But hopefully, it is clear in the doctest.",
    "created_at": "2014-12-28T11:44:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17311",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17311#issuecomment-230532",
    "user": "vdelecroix"
}
```

Replying to [comment:7 tscrim]:
> This is actually bad input: the slopes should be negative (to be useful for partitions). From the documentation of `Partitions`:
> {{{
> - ``min_slope=k`` specifies that the partitions have slope at least
>   `k`; the slope is the difference between successive parts.
> }}}

This is confusing: the difference between `a` and `b` is `a-b` and not `b-a`. But hopefully, it is clear in the doctest.



---

archive/issue_comments_230533.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-01-15T12:46:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17311",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17311#issuecomment-230533",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_230534.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-01-15T12:47:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17311",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17311#issuecomment-230534",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_230535.json:
```json
{
    "body": "Aahahahahah.\n\nOkay, I spent the last 2h30 hours writing all the equations needed to ensure that there is a solution, and with all possibilities that there are I give up.\n\nI will add a stopgap for this feature as it returns wrong results.\n\nNathann",
    "created_at": "2015-01-15T15:39:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17311",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17311#issuecomment-230535",
    "user": "ncohen"
}
```

Aahahahahah.

Okay, I spent the last 2h30 hours writing all the equations needed to ensure that there is a solution, and with all possibilities that there are I give up.

I will add a stopgap for this feature as it returns wrong results.

Nathann



---

archive/issue_comments_230536.json:
```json
{
    "body": "Stopgap created at #17637.\n\nNathann",
    "created_at": "2015-01-15T15:50:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17311",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17311#issuecomment-230536",
    "user": "ncohen"
}
```

Stopgap created at #17637.

Nathann



---

archive/issue_comments_230537.json:
```json
{
    "body": "It's not a wrong result, it's invalid input because it violates the assumptions.",
    "created_at": "2015-01-15T16:55:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17311",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17311#issuecomment-230537",
    "user": "tscrim"
}
```

It's not a wrong result, it's invalid input because it violates the assumptions.



---

archive/issue_comments_230538.json:
```json
{
    "body": "(the branch does not actually contain useful code. Switching this to `needs_work`)\n\n> It's not a wrong result, it's invalid input because it violates the assumptions.\n\nI was not able to write a patch that checks all assumptions and returns an exception in this case. If these assumptions are so complicated to check we cannot ask the users to check them for themselves before calling the function. Some of them are probably calling this function on bad input, and they are taking a big risk.\n\nNathann",
    "created_at": "2015-01-16T04:13:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17311",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17311#issuecomment-230538",
    "user": "ncohen"
}
```

(the branch does not actually contain useful code. Switching this to `needs_work`)

> It's not a wrong result, it's invalid input because it violates the assumptions.

I was not able to write a patch that checks all assumptions and returns an exception in this case. If these assumptions are so complicated to check we cannot ask the users to check them for themselves before calling the function. Some of them are probably calling this function on bad input, and they are taking a big risk.

Nathann



---

archive/issue_comments_230539.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-01-21T09:04:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17311",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17311#issuecomment-230539",
    "user": "ncohen"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_230540.json:
```json
{
    "body": "(there is nothing to review here)",
    "created_at": "2015-01-21T09:04:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17311",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17311#issuecomment-230540",
    "user": "ncohen"
}
```

(there is nothing to review here)



---

archive/issue_comments_230541.json:
```json
{
    "body": "Hello,\n\nTwo bug-feature report.\n\n1. Depending on the input, the floor is sometimes `0` and sometimes `1`:\n\n```python\nsage: IntegerListsLex(5, length=3).list()               # ok: it is 0\n[[5, 0, 0],\n [4, 1, 0],\n [4, 0, 1],\n...\n [0, 2, 3],\n [0, 1, 4],\n [0, 0, 5]]\nsage: IntegerListsLex(5, length=3, max_slope=0).list()   # ok: it is 0\n[[5, 0, 0], [4, 1, 0], [3, 2, 0], [3, 1, 1], [2, 2, 1]]\nsage: IntegerListsLex(5, max_slope=0).list()             # now it is 1\n[[5], [4, 1], [3, 2], [3, 1, 1], [2, 2, 1], [2, 1, 1, 1], [1, 1, 1, 1, 1]]\n```\n\n\n2. The iterator is sometimes completely wrong when the set is infinite:\n\n```python\nsage: it = iter(IntegerListsLex(5))\nsage: for _ in range(10): print it.next()\n[5]\n[4, 1]\n[4, 0, 1]\n[4, 0, 0, 1]\n[4, 0, 0, 0, 1]\n[4, 0, 0, 0, 0, 1]\n[4, 0, 0, 0, 0, 0, 1]\n[4, 0, 0, 0, 0, 0, 0, 1]\n[4, 0, 0, 0, 0, 0, 0, 0, 1]\n[4, 0, 0, 0, 0, 0, 0, 0, 0, 1]\n```\n",
    "created_at": "2015-02-22T10:11:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17311",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17311#issuecomment-230541",
    "user": "vdelecroix"
}
```

Hello,

Two bug-feature report.

1. Depending on the input, the floor is sometimes `0` and sometimes `1`:

```python
sage: IntegerListsLex(5, length=3).list()               # ok: it is 0
[[5, 0, 0],
 [4, 1, 0],
 [4, 0, 1],
...
 [0, 2, 3],
 [0, 1, 4],
 [0, 0, 5]]
sage: IntegerListsLex(5, length=3, max_slope=0).list()   # ok: it is 0
[[5, 0, 0], [4, 1, 0], [3, 2, 0], [3, 1, 1], [2, 2, 1]]
sage: IntegerListsLex(5, max_slope=0).list()             # now it is 1
[[5], [4, 1], [3, 2], [3, 1, 1], [2, 2, 1], [2, 1, 1, 1], [1, 1, 1, 1, 1]]
```


2. The iterator is sometimes completely wrong when the set is infinite:

```python
sage: it = iter(IntegerListsLex(5))
sage: for _ in range(10): print it.next()
[5]
[4, 1]
[4, 0, 1]
[4, 0, 0, 1]
[4, 0, 0, 0, 1]
[4, 0, 0, 0, 0, 1]
[4, 0, 0, 0, 0, 0, 1]
[4, 0, 0, 0, 0, 0, 0, 1]
[4, 0, 0, 0, 0, 0, 0, 0, 1]
[4, 0, 0, 0, 0, 0, 0, 0, 0, 1]
```




---

archive/issue_comments_230542.json:
```json
{
    "body": "This function should be replaced by smaller, more dedicated functions. Making it all fit in something so general makes it very hard to manage.\n\nAnd wrong, too.\n\nNathann",
    "created_at": "2015-02-22T17:43:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17311",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17311#issuecomment-230542",
    "user": "ncohen"
}
```

This function should be replaced by smaller, more dedicated functions. Making it all fit in something so general makes it very hard to manage.

And wrong, too.

Nathann



---

archive/issue_comments_230543.json:
```json
{
    "body": "Replying to [comment:25 vdelecroix]:\n> 1. Depending on the input, the floor is sometimes `0` and sometimes `1`:\n> {{{\n> #!python\n> sage: IntegerListsLex(5, length=3).list()               # ok: it is 0\n> [[5, 0, 0],\n>  [4, 1, 0],\n>  [4, 0, 1],\n> ...\n>  [0, 2, 3],\n>  [0, 1, 4],\n>  [0, 0, 5]]\n> sage: IntegerListsLex(5, length=3, max_slope=0).list()   # ok: it is 0\n> [[5, 0, 0], [4, 1, 0], [3, 2, 0], [3, 1, 1], [2, 2, 1]]\n> sage: IntegerListsLex(5, max_slope=0).list()             # now it is 1\n> [[5], [4, 1], [3, 2], [3, 1, 1], [2, 2, 1], [2, 1, 1, 1], [1, 1, 1, 1, 1]]\n> }}}\n\nThis is not a bug because this has trailing 0's and there is no way to have a non-trailing 0 in the last output. See this part of the documentation:\n\n```\nTwo valid integer lists are considered equivalent if they only\ndiffer by trailing zeroes. In this case, only the list with the\nleast number of trailing zeroes will be produced.\n```\n\nIt's subtle, but again, not a bug.\n\n> 2. The iterator is sometimes completely wrong when the set is infinite:\n> {{{\n> #!python\n> sage: it = iter(IntegerListsLex(5))\n> sage: for _ in range(10): print it.next()\n> [5]\n> [4, 1]\n> [4, 0, 1]\n> [4, 0, 0, 1]\n> [4, 0, 0, 0, 1]\n> [4, 0, 0, 0, 0, 1]\n> [4, 0, 0, 0, 0, 0, 1]\n> [4, 0, 0, 0, 0, 0, 0, 1]\n> [4, 0, 0, 0, 0, 0, 0, 0, 1]\n> [4, 0, 0, 0, 0, 0, 0, 0, 0, 1]\n> }}}\n\nThis is also not a bug because there are no other conditions on the lists and each of these are the next in lex ordering.",
    "created_at": "2015-03-04T23:36:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17311",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17311#issuecomment-230543",
    "user": "tscrim"
}
```

Replying to [comment:25 vdelecroix]:
> 1. Depending on the input, the floor is sometimes `0` and sometimes `1`:
> {{{
> #!python
> sage: IntegerListsLex(5, length=3).list()               # ok: it is 0
> [[5, 0, 0],
>  [4, 1, 0],
>  [4, 0, 1],
> ...
>  [0, 2, 3],
>  [0, 1, 4],
>  [0, 0, 5]]
> sage: IntegerListsLex(5, length=3, max_slope=0).list()   # ok: it is 0
> [[5, 0, 0], [4, 1, 0], [3, 2, 0], [3, 1, 1], [2, 2, 1]]
> sage: IntegerListsLex(5, max_slope=0).list()             # now it is 1
> [[5], [4, 1], [3, 2], [3, 1, 1], [2, 2, 1], [2, 1, 1, 1], [1, 1, 1, 1, 1]]
> }}}

This is not a bug because this has trailing 0's and there is no way to have a non-trailing 0 in the last output. See this part of the documentation:

```
Two valid integer lists are considered equivalent if they only
differ by trailing zeroes. In this case, only the list with the
least number of trailing zeroes will be produced.
```

It's subtle, but again, not a bug.

> 2. The iterator is sometimes completely wrong when the set is infinite:
> {{{
> #!python
> sage: it = iter(IntegerListsLex(5))
> sage: for _ in range(10): print it.next()
> [5]
> [4, 1]
> [4, 0, 1]
> [4, 0, 0, 1]
> [4, 0, 0, 0, 1]
> [4, 0, 0, 0, 0, 1]
> [4, 0, 0, 0, 0, 0, 1]
> [4, 0, 0, 0, 0, 0, 0, 1]
> [4, 0, 0, 0, 0, 0, 0, 0, 1]
> [4, 0, 0, 0, 0, 0, 0, 0, 0, 1]
> }}}

This is also not a bug because there are no other conditions on the lists and each of these are the next in lex ordering.



---

archive/issue_comments_230544.json:
```json
{
    "body": "Replying to [comment:27 tscrim]:\n> > 2. The iterator is sometimes completely wrong when the set is infinite:\n> > {{{\n> > #!python\n> > sage: it = iter(IntegerListsLex(5))\n> > sage: for _ in range(10): print it.next()\n> > [5]\n> > [4, 1]\n> > [4, 0, 1]\n> > [4, 0, 0, 1]\n> > [4, 0, 0, 0, 1]\n> > [4, 0, 0, 0, 0, 1]\n> > [4, 0, 0, 0, 0, 0, 1]\n> > [4, 0, 0, 0, 0, 0, 0, 1]\n> > [4, 0, 0, 0, 0, 0, 0, 0, 1]\n> > [4, 0, 0, 0, 0, 0, 0, 0, 0, 1]\n> > }}}\n> \n> This is also not a bug because there are no other conditions on the lists and each of these are the next in lex ordering.\n\nThis is a bug! An iterator (finite or infinite) must eventually return every element of the set.",
    "created_at": "2015-03-05T12:45:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17311",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17311#issuecomment-230544",
    "user": "jdemeyer"
}
```

Replying to [comment:27 tscrim]:
> > 2. The iterator is sometimes completely wrong when the set is infinite:
> > {{{
> > #!python
> > sage: it = iter(IntegerListsLex(5))
> > sage: for _ in range(10): print it.next()
> > [5]
> > [4, 1]
> > [4, 0, 1]
> > [4, 0, 0, 1]
> > [4, 0, 0, 0, 1]
> > [4, 0, 0, 0, 0, 1]
> > [4, 0, 0, 0, 0, 0, 1]
> > [4, 0, 0, 0, 0, 0, 0, 1]
> > [4, 0, 0, 0, 0, 0, 0, 0, 1]
> > [4, 0, 0, 0, 0, 0, 0, 0, 0, 1]
> > }}}
> 
> This is also not a bug because there are no other conditions on the lists and each of these are the next in lex ordering.

This is a bug! An iterator (finite or infinite) must eventually return every element of the set.



---

archive/issue_comments_230545.json:
```json
{
    "body": "Replying to [comment:29 jdemeyer]:\n> > This is also not a bug because there are no other conditions on the lists and each of these are the next in lex ordering.\n> \n> This is a bug! An iterator (finite or infinite) must eventually return every element of the set.\n\nIt does, but it is doing it by lex ordering, which is different than by length-then-lex ordering. Its the same as doing a Cartesian product of `{1,2} x NN` and getting `[1, 0]`, `[1, 1]`, `[1, 2]`, ... Is that a bug to you then too?",
    "created_at": "2015-03-05T17:56:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17311",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17311#issuecomment-230545",
    "user": "tscrim"
}
```

Replying to [comment:29 jdemeyer]:
> > This is also not a bug because there are no other conditions on the lists and each of these are the next in lex ordering.
> 
> This is a bug! An iterator (finite or infinite) must eventually return every element of the set.

It does, but it is doing it by lex ordering, which is different than by length-then-lex ordering. Its the same as doing a Cartesian product of `{1,2} x NN` and getting `[1, 0]`, `[1, 1]`, `[1, 2]`, ... Is that a bug to you then too?



---

archive/issue_comments_230546.json:
```json
{
    "body": "> Is that a bug to you then too?\n\nformally not, but the design is unfortunate.\nI suggest to change the behaviour.\n\n\nJakob",
    "created_at": "2015-03-05T17:59:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17311",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17311#issuecomment-230546",
    "user": "jakobkroeker"
}
```

> Is that a bug to you then too?

formally not, but the design is unfortunate.
I suggest to change the behaviour.


Jakob



---

archive/issue_comments_230547.json:
```json
{
    "body": "Replying to [comment:30 tscrim]:\n> It does, but it is doing it by lex ordering, which is different than by length-then-lex ordering.\nOK, listing all elements in lex ordering might not be possible. Fine, then **raise an exception** instead of returning a wrong answer.\n\n> Its the same as doing a Cartesian product of `{1,2} x NN` and getting `[1, 0]`, `[1, 1]`, `[1, 2]`, ... Is that a bug to you then too?\nOf course that's a bug.",
    "created_at": "2015-03-06T08:11:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17311",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17311#issuecomment-230547",
    "user": "jdemeyer"
}
```

Replying to [comment:30 tscrim]:
> It does, but it is doing it by lex ordering, which is different than by length-then-lex ordering.
OK, listing all elements in lex ordering might not be possible. Fine, then **raise an exception** instead of returning a wrong answer.

> Its the same as doing a Cartesian product of `{1,2} x NN` and getting `[1, 0]`, `[1, 1]`, `[1, 2]`, ... Is that a bug to you then too?
Of course that's a bug.



---

archive/issue_comments_230548.json:
```json
{
    "body": "Changing priority from minor to major.",
    "created_at": "2015-03-09T14:04:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17311",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17311#issuecomment-230548",
    "user": "jdemeyer"
}
```

Changing priority from minor to major.



---

archive/issue_comments_230549.json:
```json
{
    "body": "Replying to [comment:32 jdemeyer]:\n> Replying to [comment:30 tscrim]:\n> > It does, but it is doing it by lex ordering, which is different than by length-then-lex ordering.\n> OK, listing all elements in lex ordering might not be possible. Fine, then **raise an exception** instead of returning a wrong answer.\n> \n> > Its the same as doing a Cartesian product of `{1,2} x NN` and getting `[1, 0]`, `[1, 1]`, `[1, 2]`, ... Is that a bug to you then too?\n> Of course that's a bug.\n\n+1 -- It is a reasonable basic principle that when iterating over a set S, for every x in S the iterator must eventually return x, as (Jereon said above).  If this is impossible due to constraints on the order of iteration, there should be an error...",
    "created_at": "2015-03-09T14:14:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17311",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17311#issuecomment-230549",
    "user": "was"
}
```

Replying to [comment:32 jdemeyer]:
> Replying to [comment:30 tscrim]:
> > It does, but it is doing it by lex ordering, which is different than by length-then-lex ordering.
> OK, listing all elements in lex ordering might not be possible. Fine, then **raise an exception** instead of returning a wrong answer.
> 
> > Its the same as doing a Cartesian product of `{1,2} x NN` and getting `[1, 0]`, `[1, 1]`, `[1, 2]`, ... Is that a bug to you then too?
> Of course that's a bug.

+1 -- It is a reasonable basic principle that when iterating over a set S, for every x in S the iterator must eventually return x, as (Jereon said above).  If this is impossible due to constraints on the order of iteration, there should be an error...



---

archive/issue_comments_230550.json:
```json
{
    "body": "The branch I've attached fixes the length bounds and when `min_slope == max_slope`. However these violate the internal assumptions:\n\n```\nsage: C = Compositions(4, max_part=2, min_slope=1)\nsage: Compositions(7, max_part=4, inner=[1], min_slope=1)\n```\n\nsince the ceiling defaults to `max_part`, which is always 2/4 and has a slope of 0 and violates the `min_slope` condition (i.e., the ceiling must be increasing).\n\nAlso FTR, the last one in the description is the error message that was wanted (precisely because it violates the conditions).",
    "created_at": "2015-03-16T05:13:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17311",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17311#issuecomment-230550",
    "user": "tscrim"
}
```

The branch I've attached fixes the length bounds and when `min_slope == max_slope`. However these violate the internal assumptions:

```
sage: C = Compositions(4, max_part=2, min_slope=1)
sage: Compositions(7, max_part=4, inner=[1], min_slope=1)
```

since the ceiling defaults to `max_part`, which is always 2/4 and has a slope of 0 and violates the `min_slope` condition (i.e., the ceiling must be increasing).

Also FTR, the last one in the description is the error message that was wanted (precisely because it violates the conditions).



---

archive/issue_comments_230551.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-16T05:14:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17311",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17311#issuecomment-230551",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_230552.json:
```json
{
    "body": "Replying to [comment:45 tscrim]:\n> the last one in the description is the error message that was wanted (precisely because it violates the conditions).\n\nMy point with the last one is that it should simply be allowed input. There is no fundamental reason why\n\n```\nsage: Compositions(10, inner=[1,1], max_slope=-1)\n```\n\nshouldn't \"just work\".",
    "created_at": "2015-03-16T07:36:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17311",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17311#issuecomment-230552",
    "user": "jdemeyer"
}
```

Replying to [comment:45 tscrim]:
> the last one in the description is the error message that was wanted (precisely because it violates the conditions).

My point with the last one is that it should simply be allowed input. There is no fundamental reason why

```
sage: Compositions(10, inner=[1,1], max_slope=-1)
```

shouldn't "just work".



---

archive/issue_comments_230553.json:
```json
{
    "body": "Replying to [comment:45 tscrim]:\n> These violate the internal assumptions\nThen you really should add checks in the code raising an exception if the condition is not satisfied. If you do add such checks, make sure to add them to `IntegerListsLex` and not the `Partitions`/`Compositions` front-ends.\n\nBut even better would be to just allow such input.",
    "created_at": "2015-03-16T07:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17311",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17311#issuecomment-230553",
    "user": "jdemeyer"
}
```

Replying to [comment:45 tscrim]:
> These violate the internal assumptions
Then you really should add checks in the code raising an exception if the condition is not satisfied. If you do add such checks, make sure to add them to `IntegerListsLex` and not the `Partitions`/`Compositions` front-ends.

But even better would be to just allow such input.



---

archive/issue_comments_230554.json:
```json
{
    "body": "Replying to [comment:48 jdemeyer]:\n> Replying to [comment:45 tscrim]:\n> > These violate the internal assumptions\n> Then you really should add checks in the code raising an exception if the condition is not satisfied. If you do add such checks, make sure to add them to `IntegerListsLex` and not the `Partitions`/`Compositions` front-ends.\n> \n> But even better would be to just allow such input.\n\nIn principle, all these bugs should now be fixed with #17979. Please check!",
    "created_at": "2015-03-24T03:00:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17311",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17311#issuecomment-230554",
    "user": "aschilling"
}
```

Replying to [comment:48 jdemeyer]:
> Replying to [comment:45 tscrim]:
> > These violate the internal assumptions
> Then you really should add checks in the code raising an exception if the condition is not satisfied. If you do add such checks, make sure to add them to `IntegerListsLex` and not the `Partitions`/`Compositions` front-ends.
> 
> But even better would be to just allow such input.

In principle, all these bugs should now be fixed with #17979. Please check!



---

archive/issue_comments_230555.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2015-04-13T12:47:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17311",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17311#issuecomment-230555",
    "user": "jdemeyer"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_230556.json:
```json
{
    "body": "Resolution: duplicate",
    "created_at": "2015-04-13T17:47:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17311",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17311#issuecomment-230556",
    "user": "vbraun"
}
```

Resolution: duplicate
