# Issue 17311: sage5.7 Partitions() error

Issue created by migration from https://trac.sagemath.org/ticket/17548

Original creator: ferriszorro

Original creation time: 2014-12-25 05:21:54

Assignee: z

CC:  jakobkroeker aschilling

Keywords: Partitions

sage: Partitions(5,min_slope=1).list()
[[5], [2, 4]]


---

Comment by ferriszorro created at 2014-12-25 05:23:01

Partitions error


---

Comment by ferriszorro created at 2014-12-25 05:24:47

Changing assignee from z to ferriszorro.


---

Comment by ferriszorro created at 2014-12-25 05:27:23

` #!diff # HG changeset patch # Date 1300721936 0 foo  diff --git a/bar b/bar --- a/bar +++ b/bar `@``@` -1,2 +1,3 `@``@`  baz  quux +xyzzy `


---

Attachment


---

Comment by chapoton created at 2014-12-25 08:43:22

Changing status from new to needs_review.


---

Comment by ncohen created at 2014-12-25 08:57:08

Changing status from needs_review to positive_review.


---

Comment by ncohen created at 2014-12-25 08:57:08

Frédéric: the wontfix tickets should be set to 'positive review', otherwise Volker will not see them.

"Merry Christmas",

Nathann


---

Comment by ncohen created at 2014-12-25 08:57:54

This being said this bug report is a real bug report `O_o`


---

Comment by tmonteil created at 2014-12-25 17:31:56

Changing status from positive_review to needs_work.


---

Comment by tmonteil created at 2014-12-25 17:31:56

I was very puzzled when i saw this ticket, since my Turing tests were not able to conclude (unless we just reached the singularity). I propose to reopen the ticket since the report is correct.

By the way, i am not sure the following is a correct behaviour:


```
sage: P = Partitions(5, min_slope=2)
sage: Q = Partitions(5)
sage: Q[0] 
[5]
sage: Q[0] in P
False
```



---

Comment by tmonteil created at 2014-12-25 17:31:56

Changing component from number theory to combinatorics.


---

Comment by tscrim created at 2014-12-26 19:18:49

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2014-12-26 19:18:49

This is actually bad input: the slopes should be negative (to be useful for partitions). From the documentation of `Partitions`:

```
- ``min_slope=k`` specifies that the partitions have slope at least
  `k`; the slope is the difference between successive parts.
```

The second input is actually correct, that is the only partition of 5 with a positive slope (provided you don't count trailing 0's, which is how Sage currently behaves). With that being said, the internal assumptions of `IntegerListsLex` are also being broken with `min_slope > max_slope == 0`, so it's no surprise bad data is being returned. So this should be a wontfix.


---

Comment by ncohen created at 2014-12-27 02:29:05

Does this also qualify as bad input ?


```
sage: list(Partitions(5,length=4,min_slope=0))
...
ValueError: [1, 1, 1, 2] is not a valid partition
```


Nathann


---

Comment by tscrim created at 2014-12-27 03:50:17

Currently yes. From the doc of `IntegerListsLex` (which is the underlying class):

```
   Note: Caveat: with the current implementation, the constraints
     should satisfy the following conditions:

     * The upper and lower bounds themselves should satisfy the
       slope constraints.

     * The maximal and minimal slopes values should not be equal.

     * The maximal and minimal part values should not be equal.
```



---

Comment by ncohen created at 2014-12-27 03:56:31

> Currently yes. From the doc of `IntegerListsLex` (which is the underlying class):

Cool. So the strategy is to close as wontfix the attempts to change that because, after all, it is not a bug ?

Nathann


---

Comment by tscrim created at 2014-12-27 04:08:24

The other option would be to recycle this ticket to use for rewriting `IntegerListsLex`, but in terms of historical documentation, I think this would best done on a new ticket.


---

Comment by ferriszorro created at 2014-12-27 07:33:21

OK, this ticket should be closed


---

Comment by vdelecroix created at 2014-12-28 11:44:50

Replying to [comment:7 tscrim]:
> This is actually bad input: the slopes should be negative (to be useful for partitions). From the documentation of `Partitions`:
> {{{
> - ``min_slope=k`` specifies that the partitions have slope at least
>   `k`; the slope is the difference between successive parts.
> }}}

This is confusing: the difference between `a` and `b` is `a-b` and not `b-a`. But hopefully, it is clear in the doctest.


---

Comment by git created at 2015-01-15 12:46:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-01-15 12:47:16

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by ncohen created at 2015-01-15 15:39:39

Aahahahahah.

Okay, I spent the last 2h30 hours writing all the equations needed to ensure that there is a solution, and with all possibilities that there are I give up.

I will add a stopgap for this feature as it returns wrong results.

Nathann


---

Comment by ncohen created at 2015-01-15 15:50:25

Stopgap created at #17637.

Nathann


---

Comment by tscrim created at 2015-01-15 16:55:35

It's not a wrong result, it's invalid input because it violates the assumptions.


---

Comment by ncohen created at 2015-01-16 04:13:31

(the branch does not actually contain useful code. Switching this to `needs_work`)

> It's not a wrong result, it's invalid input because it violates the assumptions.

I was not able to write a patch that checks all assumptions and returns an exception in this case. If these assumptions are so complicated to check we cannot ask the users to check them for themselves before calling the function. Some of them are probably calling this function on bad input, and they are taking a big risk.

Nathann


---

Comment by ncohen created at 2015-01-21 09:04:19

Changing status from needs_review to needs_work.


---

Comment by ncohen created at 2015-01-21 09:04:19

(there is nothing to review here)


---

Comment by vdelecroix created at 2015-02-22 10:11:46

Hello,

Two bug-feature report.

1. Depending on the input, the floor is sometimes `0` and sometimes `1`:

```python
sage: IntegerListsLex(5, length=3).list()               # ok: it is 0
[[5, 0, 0],
 [4, 1, 0],
 [4, 0, 1],
...
 [0, 2, 3],
 [0, 1, 4],
 [0, 0, 5]]
sage: IntegerListsLex(5, length=3, max_slope=0).list()   # ok: it is 0
[[5, 0, 0], [4, 1, 0], [3, 2, 0], [3, 1, 1], [2, 2, 1]]
sage: IntegerListsLex(5, max_slope=0).list()             # now it is 1
[[5], [4, 1], [3, 2], [3, 1, 1], [2, 2, 1], [2, 1, 1, 1], [1, 1, 1, 1, 1]]
```


2. The iterator is sometimes completely wrong when the set is infinite:

```python
sage: it = iter(IntegerListsLex(5))
sage: for _ in range(10): print it.next()
[5]
[4, 1]
[4, 0, 1]
[4, 0, 0, 1]
[4, 0, 0, 0, 1]
[4, 0, 0, 0, 0, 1]
[4, 0, 0, 0, 0, 0, 1]
[4, 0, 0, 0, 0, 0, 0, 1]
[4, 0, 0, 0, 0, 0, 0, 0, 1]
[4, 0, 0, 0, 0, 0, 0, 0, 0, 1]
```



---

Comment by ncohen created at 2015-02-22 17:43:21

This function should be replaced by smaller, more dedicated functions. Making it all fit in something so general makes it very hard to manage.

And wrong, too.

Nathann


---

Comment by tscrim created at 2015-03-04 23:36:39

Replying to [comment:25 vdelecroix]:
> 1. Depending on the input, the floor is sometimes `0` and sometimes `1`:
> {{{
> #!python
> sage: IntegerListsLex(5, length=3).list()               # ok: it is 0
> [[5, 0, 0],
>  [4, 1, 0],
>  [4, 0, 1],
> ...
>  [0, 2, 3],
>  [0, 1, 4],
>  [0, 0, 5]]
> sage: IntegerListsLex(5, length=3, max_slope=0).list()   # ok: it is 0
> [[5, 0, 0], [4, 1, 0], [3, 2, 0], [3, 1, 1], [2, 2, 1]]
> sage: IntegerListsLex(5, max_slope=0).list()             # now it is 1
> [[5], [4, 1], [3, 2], [3, 1, 1], [2, 2, 1], [2, 1, 1, 1], [1, 1, 1, 1, 1]]
> }}}

This is not a bug because this has trailing 0's and there is no way to have a non-trailing 0 in the last output. See this part of the documentation:

```
Two valid integer lists are considered equivalent if they only
differ by trailing zeroes. In this case, only the list with the
least number of trailing zeroes will be produced.
```

It's subtle, but again, not a bug.

> 2. The iterator is sometimes completely wrong when the set is infinite:
> {{{
> #!python
> sage: it = iter(IntegerListsLex(5))
> sage: for _ in range(10): print it.next()
> [5]
> [4, 1]
> [4, 0, 1]
> [4, 0, 0, 1]
> [4, 0, 0, 0, 1]
> [4, 0, 0, 0, 0, 1]
> [4, 0, 0, 0, 0, 0, 1]
> [4, 0, 0, 0, 0, 0, 0, 1]
> [4, 0, 0, 0, 0, 0, 0, 0, 1]
> [4, 0, 0, 0, 0, 0, 0, 0, 0, 1]
> }}}

This is also not a bug because there are no other conditions on the lists and each of these are the next in lex ordering.


---

Comment by jdemeyer created at 2015-03-05 12:45:30

Replying to [comment:27 tscrim]:
> > 2. The iterator is sometimes completely wrong when the set is infinite:
> > {{{
> > #!python
> > sage: it = iter(IntegerListsLex(5))
> > sage: for _ in range(10): print it.next()
> > [5]
> > [4, 1]
> > [4, 0, 1]
> > [4, 0, 0, 1]
> > [4, 0, 0, 0, 1]
> > [4, 0, 0, 0, 0, 1]
> > [4, 0, 0, 0, 0, 0, 1]
> > [4, 0, 0, 0, 0, 0, 0, 1]
> > [4, 0, 0, 0, 0, 0, 0, 0, 1]
> > [4, 0, 0, 0, 0, 0, 0, 0, 0, 1]
> > }}}
> 
> This is also not a bug because there are no other conditions on the lists and each of these are the next in lex ordering.

This is a bug! An iterator (finite or infinite) must eventually return every element of the set.


---

Comment by tscrim created at 2015-03-05 17:56:07

Replying to [comment:29 jdemeyer]:
> > This is also not a bug because there are no other conditions on the lists and each of these are the next in lex ordering.
> 
> This is a bug! An iterator (finite or infinite) must eventually return every element of the set.

It does, but it is doing it by lex ordering, which is different than by length-then-lex ordering. Its the same as doing a Cartesian product of `{1,2} x NN` and getting `[1, 0]`, `[1, 1]`, `[1, 2]`, ... Is that a bug to you then too?


---

Comment by jakobkroeker created at 2015-03-05 17:59:57

> Is that a bug to you then too?

formally not, but the design is unfortunate.
I suggest to change the behaviour.


Jakob


---

Comment by jdemeyer created at 2015-03-06 08:11:37

Replying to [comment:30 tscrim]:
> It does, but it is doing it by lex ordering, which is different than by length-then-lex ordering.
OK, listing all elements in lex ordering might not be possible. Fine, then *raise an exception* instead of returning a wrong answer.

> Its the same as doing a Cartesian product of `{1,2} x NN` and getting `[1, 0]`, `[1, 1]`, `[1, 2]`, ... Is that a bug to you then too?
Of course that's a bug.


---

Comment by jdemeyer created at 2015-03-09 14:04:33

Changing priority from minor to major.


---

Comment by was created at 2015-03-09 14:14:08

Replying to [comment:32 jdemeyer]:
> Replying to [comment:30 tscrim]:
> > It does, but it is doing it by lex ordering, which is different than by length-then-lex ordering.
> OK, listing all elements in lex ordering might not be possible. Fine, then *raise an exception* instead of returning a wrong answer.
> 
> > Its the same as doing a Cartesian product of `{1,2} x NN` and getting `[1, 0]`, `[1, 1]`, `[1, 2]`, ... Is that a bug to you then too?
> Of course that's a bug.

+1 -- It is a reasonable basic principle that when iterating over a set S, for every x in S the iterator must eventually return x, as (Jereon said above).  If this is impossible due to constraints on the order of iteration, there should be an error...


---

Comment by tscrim created at 2015-03-16 05:13:15

The branch I've attached fixes the length bounds and when `min_slope == max_slope`. However these violate the internal assumptions:

```
sage: C = Compositions(4, max_part=2, min_slope=1)
sage: Compositions(7, max_part=4, inner=[1], min_slope=1)
```

since the ceiling defaults to `max_part`, which is always 2/4 and has a slope of 0 and violates the `min_slope` condition (i.e., the ceiling must be increasing).

Also FTR, the last one in the description is the error message that was wanted (precisely because it violates the conditions).


---

Comment by git created at 2015-03-16 05:14:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2015-03-16 07:36:51

Replying to [comment:45 tscrim]:
> the last one in the description is the error message that was wanted (precisely because it violates the conditions).

My point with the last one is that it should simply be allowed input. There is no fundamental reason why

```
sage: Compositions(10, inner=[1,1], max_slope=-1)
```

shouldn't "just work".


---

Comment by jdemeyer created at 2015-03-16 07:41:51

Replying to [comment:45 tscrim]:
> These violate the internal assumptions
Then you really should add checks in the code raising an exception if the condition is not satisfied. If you do add such checks, make sure to add them to `IntegerListsLex` and not the `Partitions`/`Compositions` front-ends.

But even better would be to just allow such input.


---

Comment by aschilling created at 2015-03-24 03:00:23

Replying to [comment:48 jdemeyer]:
> Replying to [comment:45 tscrim]:
> > These violate the internal assumptions
> Then you really should add checks in the code raising an exception if the condition is not satisfied. If you do add such checks, make sure to add them to `IntegerListsLex` and not the `Partitions`/`Compositions` front-ends.
> 
> But even better would be to just allow such input.

In principle, all these bugs should now be fixed with #17979. Please check!


---

Comment by jdemeyer created at 2015-04-13 12:47:55

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2015-04-13 17:47:22

Resolution: duplicate
