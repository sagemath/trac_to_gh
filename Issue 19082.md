# Issue 19082: iterator over pairs on diagonals a la Cantor pairing

archive/issues_019082.json:
```json
{
    "body": "CC:  behackl cheuberg ncohen\n\nAdd an iterator, which goes over pairs of (possible infinite) inputs along the diagonals like the [Cantor pairing function](https://en.wikipedia.org/wiki/Pairing_function#Cantor_pairing_function).\n\nThis is factored out from #19048.\n\nIssue created by migration from https://trac.sagemath.org/ticket/19319\n\n",
    "created_at": "2015-09-30T12:06:08Z",
    "labels": [
        "misc",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.9",
    "title": "iterator over pairs on diagonals a la Cantor pairing",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19082",
    "user": "dkrenn"
}
```
CC:  behackl cheuberg ncohen

Add an iterator, which goes over pairs of (possible infinite) inputs along the diagonals like the [Cantor pairing function](https://en.wikipedia.org/wiki/Pairing_function#Cantor_pairing_function).

This is factored out from #19048.

Issue created by migration from https://trac.sagemath.org/ticket/19319





---

archive/issue_comments_261858.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-09-30T12:07:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19082#issuecomment-261858",
    "user": "dkrenn"
}
```

New commits:



---

archive/issue_comments_261859.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-09-30T12:07:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19082#issuecomment-261859",
    "user": "dkrenn"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_261860.json:
```json
{
    "body": "`O_o`",
    "created_at": "2015-09-30T12:09:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19082#issuecomment-261860",
    "user": "ncohen"
}
```

`O_o`



---

archive/issue_comments_261861.json:
```json
{
    "body": "Yeah, I also believed that it should be shorter.\n\nDo you really need this Kantor enumeration, or perhaps you don't care for as long as the product of two infinite iterators works correctly?",
    "created_at": "2015-09-30T12:10:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19082#issuecomment-261861",
    "user": "ncohen"
}
```

Yeah, I also believed that it should be shorter.

Do you really need this Kantor enumeration, or perhaps you don't care for as long as the product of two infinite iterators works correctly?



---

archive/issue_comments_261862.json:
```json
{
    "body": "If you don't care, I just gave it a try:\n\n\n```\ndef product(A,B):\n    B = iter(B)\n    lb = []\n    b_done = False\n    for a in A:\n        try:\n            if not b_done:\n                lb.append(B.next())\n        except StopIteration:\n            b_done = True\n        for b in lb:\n            yield (a,b)\n```\n\n\nDoes the job.\n\nNathann",
    "created_at": "2015-09-30T12:20:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19082#issuecomment-261862",
    "user": "ncohen"
}
```

If you don't care, I just gave it a try:


```
def product(A,B):
    B = iter(B)
    lb = []
    b_done = False
    for a in A:
        try:
            if not b_done:
                lb.append(B.next())
        except StopIteration:
            b_done = True
        for b in lb:
            yield (a,b)
```


Does the job.

Nathann



---

archive/issue_comments_261863.json:
```json
{
    "body": "About your 5 copy/paste: if you want to link every function to all others, I think the best is to have an index of methods at the head of the module and add a link toward the module.\n\nBy the way, if you feel like reviewing some doc patch: #19061\n\nNathann",
    "created_at": "2015-09-30T12:26:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19082#issuecomment-261863",
    "user": "ncohen"
}
```

About your 5 copy/paste: if you want to link every function to all others, I think the best is to have an index of methods at the head of the module and add a link toward the module.

By the way, if you feel like reviewing some doc patch: #19061

Nathann



---

archive/issue_comments_261864.json:
```json
{
    "body": "Replying to [comment:4 ncohen]:\n> Yeah, I also believed that it should be shorter.\n\n:)\n\n> Do you really need this Kantor enumeration, or perhaps you don't care for as long as the product of two infinite iterators works correctly?\n\nI care (at least a bit)...so I would leave it as it is.",
    "created_at": "2015-09-30T12:38:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19082#issuecomment-261864",
    "user": "dkrenn"
}
```

Replying to [comment:4 ncohen]:
> Yeah, I also believed that it should be shorter.

:)

> Do you really need this Kantor enumeration, or perhaps you don't care for as long as the product of two infinite iterators works correctly?

I care (at least a bit)...so I would leave it as it is.



---

archive/issue_comments_261865.json:
```json
{
    "body": "> I care (at least a bit)...so I would leave it as it is.\n\nCould you say why? I do not see the point of having a complicated code in Sage if ten lines provide the feature.",
    "created_at": "2015-09-30T12:39:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19082#issuecomment-261865",
    "user": "ncohen"
}
```

> I care (at least a bit)...so I would leave it as it is.

Could you say why? I do not see the point of having a complicated code in Sage if ten lines provide the feature.



---

archive/issue_comments_261866.json:
```json
{
    "body": "Replying to [comment:5 ncohen]:\n> If you don't care, I just gave it a try:\n> \n> {{{\n> def product(A,B):\n>     B = iter(B)\n>     lb = []\n>     b_done = False\n>     for a in A:\n>         try:\n>             if not b_done:\n>                 lb.append(B.next())\n>         except StopIteration:\n>             b_done = True\n>         for b in lb:\n>             yield (a,b)\n> }}}\n\nYour code does not give all pairs...",
    "created_at": "2015-09-30T12:55:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19082#issuecomment-261866",
    "user": "dkrenn"
}
```

Replying to [comment:5 ncohen]:
> If you don't care, I just gave it a try:
> 
> {{{
> def product(A,B):
>     B = iter(B)
>     lb = []
>     b_done = False
>     for a in A:
>         try:
>             if not b_done:
>                 lb.append(B.next())
>         except StopIteration:
>             b_done = True
>         for b in lb:
>             yield (a,b)
> }}}

Your code does not give all pairs...



---

archive/issue_comments_261867.json:
```json
{
    "body": "> Your code does not give all pairs...\n\nYeah, only works for infinite sets.",
    "created_at": "2015-09-30T12:56:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19082#issuecomment-261867",
    "user": "ncohen"
}
```

> Your code does not give all pairs...

Yeah, only works for infinite sets.



---

archive/issue_comments_261868.json:
```json
{
    "body": "Replying to [comment:5 ncohen]:\n> If you don't care, I just gave it a try:\n> \n> {{{\n> def product(A,B):\n>     B = iter(B)\n>     lb = []\n>     b_done = False\n>     for a in A:\n>         try:\n>             if not b_done:\n>                 lb.append(B.next())\n>         except StopIteration:\n>             b_done = True\n>         for b in lb:\n>             yield (a,b)\n> }}}\n\n\n```\nsage: list(product(srange(2), ['a', 'b', 'c']))\n[(0, 'a'), (1, 'a'), (1, 'b')]\n```\n",
    "created_at": "2015-09-30T12:59:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19082#issuecomment-261868",
    "user": "dkrenn"
}
```

Replying to [comment:5 ncohen]:
> If you don't care, I just gave it a try:
> 
> {{{
> def product(A,B):
>     B = iter(B)
>     lb = []
>     b_done = False
>     for a in A:
>         try:
>             if not b_done:
>                 lb.append(B.next())
>         except StopIteration:
>             b_done = True
>         for b in lb:
>             yield (a,b)
> }}}


```
sage: list(product(srange(2), ['a', 'b', 'c']))
[(0, 'a'), (1, 'a'), (1, 'b')]
```




---

archive/issue_comments_261869.json:
```json
{
    "body": "Yeah true, it's really bad. Soooooo I need two lists. Wanted to avoid that.\n\nThe question remains, though: is there a reason to insist on Kantor ordering, or would any other order do the job?",
    "created_at": "2015-09-30T13:04:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19082#issuecomment-261869",
    "user": "ncohen"
}
```

Yeah true, it's really bad. Soooooo I need two lists. Wanted to avoid that.

The question remains, though: is there a reason to insist on Kantor ordering, or would any other order do the job?



---

archive/issue_comments_261870.json:
```json
{
    "body": "Replying to [comment:12 ncohen]:\n> The question remains, though: is there a reason to insist on Kantor ordering, or would any other order do the job?\n\nIn #19048 it does not really (except from aesthetic aspects) matter (but it has to deal with the finite case as well and it would be nice if then all pairs would occur). But I use the same code in some other Sage projects as well (not public (yet)), where it matters: There I need an order my the sums of the indices, which is Cantor.\nThus having this tool in SageMath would be great.",
    "created_at": "2015-09-30T13:12:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19082#issuecomment-261870",
    "user": "dkrenn"
}
```

Replying to [comment:12 ncohen]:
> The question remains, though: is there a reason to insist on Kantor ordering, or would any other order do the job?

In #19048 it does not really (except from aesthetic aspects) matter (but it has to deal with the finite case as well and it would be nice if then all pairs would occur). But I use the same code in some other Sage projects as well (not public (yet)), where it matters: There I need an order my the sums of the indices, which is Cantor.
Thus having this tool in SageMath would be great.



---

archive/issue_comments_261871.json:
```json
{
    "body": "Okay. Longer than the first attempt, though\n\n```\ndef product(A,B):\n    A = iter(A)\n    B = iter(B)\n    list_a = []\n    list_b = []\n    a_nonempty = b_nonempty = True\n    while a_nonempty or b_nonempty:\n        if a_nonempty:\n            try:\n                list_a.append(A.next())\n            except StopIteration:\n                a_nonempty = False\n            else:\n                for b in list_b:\n                    yield (list_a[-1],b)\n        if b_nonempty:\n            try:\n                list_b.append(B.next())\n            except StopIteration:\n                b_nonempty = False\n            else:\n                for a in list_a:\n                    yield (a, list_b[-1])\n```\n",
    "created_at": "2015-09-30T13:15:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19082#issuecomment-261871",
    "user": "ncohen"
}
```

Okay. Longer than the first attempt, though

```
def product(A,B):
    A = iter(A)
    B = iter(B)
    list_a = []
    list_b = []
    a_nonempty = b_nonempty = True
    while a_nonempty or b_nonempty:
        if a_nonempty:
            try:
                list_a.append(A.next())
            except StopIteration:
                a_nonempty = False
            else:
                for b in list_b:
                    yield (list_a[-1],b)
        if b_nonempty:
            try:
                list_b.append(B.next())
            except StopIteration:
                b_nonempty = False
            else:
                for a in list_a:
                    yield (a, list_b[-1])
```




---

archive/issue_comments_261872.json:
```json
{
    "body": "ARgggg.. Fails too `>_<`",
    "created_at": "2015-09-30T13:15:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19082#issuecomment-261872",
    "user": "ncohen"
}
```

ARgggg.. Fails too `>_<`



---

archive/issue_comments_261873.json:
```json
{
    "body": "Oh no, false alarm. Seems ok.",
    "created_at": "2015-09-30T13:16:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19082#issuecomment-261873",
    "user": "ncohen"
}
```

Oh no, false alarm. Seems ok.



---

archive/issue_comments_261874.json:
```json
{
    "body": "A few comments on Daniel's code:\n1. Does not terminate if `A` is empty and `B` is infinite, thus I'd simply try to yield A[0], B[0] initially and then start `s` at `1`.\n2. `try:` `except:` block in `iter_as_list` can be removed",
    "created_at": "2015-09-30T13:34:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19082#issuecomment-261874",
    "user": "cheuberg"
}
```

A few comments on Daniel's code:
1. Does not terminate if `A` is empty and `B` is infinite, thus I'd simply try to yield A[0], B[0] initially and then start `s` at `1`.
2. `try:` `except:` block in `iter_as_list` can be removed



---

archive/issue_comments_261875.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-09-30T13:40:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19082#issuecomment-261875",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_261876.json:
```json
{
    "body": "Replying to [comment:17 cheuberg]:\n> A few comments on Daniel's code:\n> 1. Does not terminate if `A` is empty and `B` is infinite, thus I'd simply try to yield A[0], B[0] initially and then start `s` at `1`.\n> 2. `try:` `except:` block in `iter_as_list` can be removed\n\nBoth changed.",
    "created_at": "2015-09-30T13:40:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19082#issuecomment-261876",
    "user": "dkrenn"
}
```

Replying to [comment:17 cheuberg]:
> A few comments on Daniel's code:
> 1. Does not terminate if `A` is empty and `B` is infinite, thus I'd simply try to yield A[0], B[0] initially and then start `s` at `1`.
> 2. `try:` `except:` block in `iter_as_list` can be removed

Both changed.



---

archive/issue_comments_261877.json:
```json
{
    "body": "Replying to [comment:6 ncohen]:\n> About your 5 copy/paste: if you want to link every function to all others, I think the best is to have an index of methods at the head of the module and add a link toward the module.\n\nI think having SEEALSO blocks with links pointing directly to related functions/classes is a very useful thing (There have been some discussions on sage-devel about this.); it makes it easy for the user to find functions without a long search (Finding the \"correct\" function is definitly a problem for Sage users have...)",
    "created_at": "2015-09-30T13:43:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19082#issuecomment-261877",
    "user": "dkrenn"
}
```

Replying to [comment:6 ncohen]:
> About your 5 copy/paste: if you want to link every function to all others, I think the best is to have an index of methods at the head of the module and add a link toward the module.

I think having SEEALSO blocks with links pointing directly to related functions/classes is a very useful thing (There have been some discussions on sage-devel about this.); it makes it easy for the user to find functions without a long search (Finding the "correct" function is definitly a problem for Sage users have...)



---

archive/issue_comments_261878.json:
```json
{
    "body": "I have an alternative implementation (pushed as `u/cheuberg/product_cantor_pairing`):\n\n```\n    from itertools import count\n    from sage.rings.infinity import infinity\n    A = iter(A)\n    B = iter(B)\n    max_A = infinity\n    max_B = infinity\n    cache_A = []\n    cache_B = []\n    for s in count():\n        if s <= max_A:\n            try:\n                cache_A.append(next(A))\n            except StopIteration:\n                max_A = s-1\n        if s <= max_B:\n            try:\n                cache_B.append(next(B))\n            except StopIteration:\n                max_B = s-1\n        if s > max_A + max_B or max_A < 0 or max_B < 0:\n            return\n\n        for i in range(max(0, s-max_B), min(s, max_A)+1):\n            yield cache_A[i], cache_B[s-i]\n```\n",
    "created_at": "2015-09-30T13:54:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19082#issuecomment-261878",
    "user": "cheuberg"
}
```

I have an alternative implementation (pushed as `u/cheuberg/product_cantor_pairing`):

```
    from itertools import count
    from sage.rings.infinity import infinity
    A = iter(A)
    B = iter(B)
    max_A = infinity
    max_B = infinity
    cache_A = []
    cache_B = []
    for s in count():
        if s <= max_A:
            try:
                cache_A.append(next(A))
            except StopIteration:
                max_A = s-1
        if s <= max_B:
            try:
                cache_B.append(next(B))
            except StopIteration:
                max_B = s-1
        if s > max_A + max_B or max_A < 0 or max_B < 0:
            return

        for i in range(max(0, s-max_B), min(s, max_A)+1):
            yield cache_A[i], cache_B[s-i]
```




---

archive/issue_comments_261879.json:
```json
{
    "body": "> I think having SEEALSO blocks with links pointing directly to related functions/classes is a very useful thing (There have been some discussions on sage-devel about this.); it makes it easy for the user to find functions without a long search (Finding the \"correct\" function is definitly a problem for Sage users have...)\n\nYou got me wrong: I did not ask you to remove the seealso block. I proposed to have a\n\n```\nSEEALSO::\n\n    For related functions, refer to the module's documentation\n```\n\nwith a link of course.\n\nLinking n functions to each other requires n*(n-1) different links. If a function is moved, if a function is added, that requires much more work. Additionally, it possible that somebody *adding* a function may forget to update the others, which will not happen if we have an index of function at the head of the module.\n\nNathann",
    "created_at": "2015-09-30T13:54:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19082#issuecomment-261879",
    "user": "ncohen"
}
```

> I think having SEEALSO blocks with links pointing directly to related functions/classes is a very useful thing (There have been some discussions on sage-devel about this.); it makes it easy for the user to find functions without a long search (Finding the "correct" function is definitly a problem for Sage users have...)

You got me wrong: I did not ask you to remove the seealso block. I proposed to have a

```
SEEALSO::

    For related functions, refer to the module's documentation
```

with a link of course.

Linking n functions to each other requires n*(n-1) different links. If a function is moved, if a function is added, that requires much more work. Additionally, it possible that somebody *adding* a function may forget to update the others, which will not happen if we have an index of function at the head of the module.

Nathann



---

archive/issue_comments_261880.json:
```json
{
    "body": "> I have an alternative implementation (pushed as `u/cheuberg/product_cantor_pairing`):\n+1 for the abscence of private class.\n\nNathann",
    "created_at": "2015-09-30T13:57:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19082#issuecomment-261880",
    "user": "ncohen"
}
```

> I have an alternative implementation (pushed as `u/cheuberg/product_cantor_pairing`):
+1 for the abscence of private class.

Nathann



---

archive/issue_comments_261881.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-09-30T14:22:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19082#issuecomment-261881",
    "user": "cheuberg"
}
```

New commits:



---

archive/issue_comments_261882.json:
```json
{
    "body": "Replying to [comment:22 ncohen]:\n> You got me wrong: I did not ask you to remove the seealso block. I proposed to have a\n> {{{\n> SEEALSO::\n> \n>     For related functions, refer to the module's documentation\n> }}}\n> with a link of course.\n\nI understood.\n\n> Linking n functions to each other requires n*(n-1) different links. If a function is moved, if a function is added, that requires much more work. Additionally, it possible that somebody *adding* a function may forget to update the others, which will not happen if we have an index of function at the head of the module.\n\nHaving these links directly in the `SEEALSO` block of the function helps the user...and this ranks higher to me than what a developer has to add when moving something around (and of course there is `--warn-links` which alerts when something is not where it should be). When adding a new function it is fine that not all `SEEALSO` blocks contain it; maybe only the close related ones. In `sage.misc.mrange` there are just a few functions and all those should IMHO be linked. In larger files I would *not* link all in all, but only build \"cliques\" of very related functions (but this depends on the functions, of course).",
    "created_at": "2015-09-30T14:35:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19082#issuecomment-261882",
    "user": "dkrenn"
}
```

Replying to [comment:22 ncohen]:
> You got me wrong: I did not ask you to remove the seealso block. I proposed to have a
> {{{
> SEEALSO::
> 
>     For related functions, refer to the module's documentation
> }}}
> with a link of course.

I understood.

> Linking n functions to each other requires n*(n-1) different links. If a function is moved, if a function is added, that requires much more work. Additionally, it possible that somebody *adding* a function may forget to update the others, which will not happen if we have an index of function at the head of the module.

Having these links directly in the `SEEALSO` block of the function helps the user...and this ranks higher to me than what a developer has to add when moving something around (and of course there is `--warn-links` which alerts when something is not where it should be). When adding a new function it is fine that not all `SEEALSO` blocks contain it; maybe only the close related ones. In `sage.misc.mrange` there are just a few functions and all those should IMHO be linked. In larger files I would *not* link all in all, but only build "cliques" of very related functions (but this depends on the functions, of course).



---

archive/issue_comments_261883.json:
```json
{
    "body": "Alternative implementation looks good to be (and all tests pass).\n----\nNew commits:",
    "created_at": "2015-09-30T14:42:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19082#issuecomment-261883",
    "user": "dkrenn"
}
```

Alternative implementation looks good to be (and all tests pass).
----
New commits:



---

archive/issue_comments_261884.json:
```json
{
    "body": "Replying to [comment:27 dkrenn]:\n> New commits:\n> ||[fde8e6d](http://git.sagemath.org/sage.git/commit/?id=fde8e6d09f41645ec4faf9d071cf60c7b35ef9e3)||`minor changes to code: spacings, PEP8, remove comment`||\n\nthanks.",
    "created_at": "2015-09-30T14:47:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19082#issuecomment-261884",
    "user": "cheuberg"
}
```

Replying to [comment:27 dkrenn]:
> New commits:
> ||[fde8e6d](http://git.sagemath.org/sage.git/commit/?id=fde8e6d09f41645ec4faf9d071cf60c7b35ef9e3)||`minor changes to code: spacings, PEP8, remove comment`||

thanks.



---

archive/issue_comments_261885.json:
```json
{
    "body": "What is the point of having it only for pairs? What if I want to iterate `ZZ x ZZ x ZZ`? Using  towers of iterators is definitely not a solution (hard to write/use and slow).",
    "created_at": "2015-10-01T00:32:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19082#issuecomment-261885",
    "user": "vdelecroix"
}
```

What is the point of having it only for pairs? What if I want to iterate `ZZ x ZZ x ZZ`? Using  towers of iterators is definitely not a solution (hard to write/use and slow).



---

archive/issue_comments_261886.json:
```json
{
    "body": "Replying to [comment:29 vdelecroix]:\n> What is the point of having it only for pairs? What if I want to iterate `ZZ x ZZ x ZZ`? Using  towers of iterators is definitely not a solution (hard to write/use and slow).\n\nShort answer: iterating over pairs is what we need right now.\n\nIteration over the product of n iterators will, as far as I can see, always need some recursive algorithm. I do not know whether avoiding iterators internally would make that much of a difference with respect of speed; IMHO it will not make it more readable.\n\nWhat about replacing `product_cantor_pairing(A, B)` by `product_cantor_pairing([A, B])` and implementing products of `>= 3` iterators by a recursive call to `product_cantor_pairing` (and flattening the results) for the time being?",
    "created_at": "2015-10-02T07:14:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19082#issuecomment-261886",
    "user": "cheuberg"
}
```

Replying to [comment:29 vdelecroix]:
> What is the point of having it only for pairs? What if I want to iterate `ZZ x ZZ x ZZ`? Using  towers of iterators is definitely not a solution (hard to write/use and slow).

Short answer: iterating over pairs is what we need right now.

Iteration over the product of n iterators will, as far as I can see, always need some recursive algorithm. I do not know whether avoiding iterators internally would make that much of a difference with respect of speed; IMHO it will not make it more readable.

What about replacing `product_cantor_pairing(A, B)` by `product_cantor_pairing([A, B])` and implementing products of `>= 3` iterators by a recursive call to `product_cantor_pairing` (and flattening the results) for the time being?



---

archive/issue_comments_261887.json:
```json
{
    "body": "Replying to [comment:30 cheuberg]:\n> Replying to [comment:29 vdelecroix]:\n> > What is the point of having it only for pairs? What if I want to iterate `ZZ x ZZ x ZZ`? Using  towers of iterators is definitely not a solution (hard to write/use and slow).\n> \n> Short answer: iterating over pairs is what we need right now.\n\nI perfectly understand.\n\n> Iteration over the product of n iterators will, as far as I can see, always need some recursive algorithm. I do not know whether avoiding iterators internally would make that much of a difference with respect of speed; IMHO it will not make it more readable.\n\nNope. If you look at the code of `product` in Python there is no recursion involved. It 70 lines long, with a lot of spaces and written in pure C.\n\n> What about replacing `product_cantor_pairing(A, B)` by `product_cantor_pairing([A, B])` and implementing products of `>= 3` iterators by a recursive call to `product_cantor_pairing` (and flattening the results) for the time being?\n \nIs that the canonical order you want for a triple?",
    "created_at": "2015-10-02T11:49:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19082#issuecomment-261887",
    "user": "vdelecroix"
}
```

Replying to [comment:30 cheuberg]:
> Replying to [comment:29 vdelecroix]:
> > What is the point of having it only for pairs? What if I want to iterate `ZZ x ZZ x ZZ`? Using  towers of iterators is definitely not a solution (hard to write/use and slow).
> 
> Short answer: iterating over pairs is what we need right now.

I perfectly understand.

> Iteration over the product of n iterators will, as far as I can see, always need some recursive algorithm. I do not know whether avoiding iterators internally would make that much of a difference with respect of speed; IMHO it will not make it more readable.

Nope. If you look at the code of `product` in Python there is no recursion involved. It 70 lines long, with a lot of spaces and written in pure C.

> What about replacing `product_cantor_pairing(A, B)` by `product_cantor_pairing([A, B])` and implementing products of `>= 3` iterators by a recursive call to `product_cantor_pairing` (and flattening the results) for the time being?
 
Is that the canonical order you want for a triple?



---

archive/issue_comments_261888.json:
```json
{
    "body": "Replying to [comment:31 vdelecroix]:\n> Replying to [comment:30 cheuberg]:\n> > Iteration over the product of n iterators will, as far as I can see, always need some recursive algorithm. I do not know whether avoiding iterators internally would make that much of a difference with respect of speed; IMHO it will not make it more readable.\n> \n> Nope. If you look at the code of `product` in Python there is no recursion involved. It 70 lines long, with a lot of spaces and written in pure C.\n\nfor infinite iterators, I suppose that things get somewhat trickier.\n\n> > What about replacing `product_cantor_pairing(A, B)` by `product_cantor_pairing([A, B])` and implementing products of `>= 3` iterators by a recursive call to `product_cantor_pairing` (and flattening the results) for the time being?\n>  \n> Is that the canonical order you want for a triple?\n\nWell, I am not really eager for ordering triples anyway.\n\nBut I imagine that having \n`product_cantor_pairing([A, B, C])` returning the elements in the same order as\n`product_cantor_pairing([product_cantor_pairing([A, B]), C])` (or the other way around, i.e., `product_cantor_pairing([A, product_cantor_pairing([B, C])])`) would make sense.",
    "created_at": "2015-10-02T12:49:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19082#issuecomment-261888",
    "user": "cheuberg"
}
```

Replying to [comment:31 vdelecroix]:
> Replying to [comment:30 cheuberg]:
> > Iteration over the product of n iterators will, as far as I can see, always need some recursive algorithm. I do not know whether avoiding iterators internally would make that much of a difference with respect of speed; IMHO it will not make it more readable.
> 
> Nope. If you look at the code of `product` in Python there is no recursion involved. It 70 lines long, with a lot of spaces and written in pure C.

for infinite iterators, I suppose that things get somewhat trickier.

> > What about replacing `product_cantor_pairing(A, B)` by `product_cantor_pairing([A, B])` and implementing products of `>= 3` iterators by a recursive call to `product_cantor_pairing` (and flattening the results) for the time being?
>  
> Is that the canonical order you want for a triple?

Well, I am not really eager for ordering triples anyway.

But I imagine that having 
`product_cantor_pairing([A, B, C])` returning the elements in the same order as
`product_cantor_pairing([product_cantor_pairing([A, B]), C])` (or the other way around, i.e., `product_cantor_pairing([A, product_cantor_pairing([B, C])])`) would make sense.



---

archive/issue_comments_261889.json:
```json
{
    "body": "26 lines and no recursion.\n\nVincent\n----\nNew commits:",
    "created_at": "2015-10-02T14:21:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19082#issuecomment-261889",
    "user": "vdelecroix"
}
```

26 lines and no recursion.

Vincent
----
New commits:



---

archive/issue_comments_261890.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-02T14:25:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19082#issuecomment-261890",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_261891.json:
```json
{
    "body": "Perhaps consider using `sage.misc.lazy_list.lazy_list` as a cache? That should save you making explicit appends. You could even get slightly better memory use for cartesian powers (a common case) by sharing caches.",
    "created_at": "2015-10-02T16:23:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19082#issuecomment-261891",
    "user": "nbruin"
}
```

Perhaps consider using `sage.misc.lazy_list.lazy_list` as a cache? That should save you making explicit appends. You could even get slightly better memory use for cartesian powers (a common case) by sharing caches.



---

archive/issue_comments_261892.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-02T17:30:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19082#issuecomment-261892",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_261893.json:
```json
{
    "body": "Replying to [comment:33 vdelecroix]:\n> 26 lines and no recursion.\n\nthanks --- however, using `IntegerListsLex` amounts to a little cheating with respect to the length of this routine `;-)`.\n\nI added three minor commits.\n\nAny particular reason that you return lists instead of tuples?",
    "created_at": "2015-10-02T17:34:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19082#issuecomment-261893",
    "user": "cheuberg"
}
```

Replying to [comment:33 vdelecroix]:
> 26 lines and no recursion.

thanks --- however, using `IntegerListsLex` amounts to a little cheating with respect to the length of this routine `;-)`.

I added three minor commits.

Any particular reason that you return lists instead of tuples?



---

archive/issue_comments_261894.json:
```json
{
    "body": "Replying to [comment:39 cheuberg]:\n> Replying to [comment:33 vdelecroix]:\n> > 26 lines and no recursion.\n> \n> thanks --- however, using `IntegerListsLex` amounts to a little cheating with respect to the length of this routine `;-)`.\n\nSure. But the moto is \"not reinvent the wheel\".\n\n> Any particular reason that you return lists instead of tuples?\n\nGood question. `itertools` used to output tuples. But sometimes you want to play with the result (like appending some more elements). For me it is fine either way.\n\n\nReplying to [comment:36 nbruin]:\n> Perhaps consider using `sage.misc.lazy_list.lazy_list` as a cache? That should save you making explicit appends. You could even get slightly better memory use for cartesian powers (a common case) by sharing caches.\n\nUsing lazy list you would also need to catch `IndexError` or so until we use the Cython API I would not go with it.\n\nI will add a trivial commit for handling sharing of slices (very good idea!).\n\nVincent",
    "created_at": "2015-10-02T18:14:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19082#issuecomment-261894",
    "user": "vdelecroix"
}
```

Replying to [comment:39 cheuberg]:
> Replying to [comment:33 vdelecroix]:
> > 26 lines and no recursion.
> 
> thanks --- however, using `IntegerListsLex` amounts to a little cheating with respect to the length of this routine `;-)`.

Sure. But the moto is "not reinvent the wheel".

> Any particular reason that you return lists instead of tuples?

Good question. `itertools` used to output tuples. But sometimes you want to play with the result (like appending some more elements). For me it is fine either way.


Replying to [comment:36 nbruin]:
> Perhaps consider using `sage.misc.lazy_list.lazy_list` as a cache? That should save you making explicit appends. You could even get slightly better memory use for cartesian powers (a common case) by sharing caches.

Using lazy list you would also need to catch `IndexError` or so until we use the Cython API I would not go with it.

I will add a trivial commit for handling sharing of slices (very good idea!).

Vincent



---

archive/issue_comments_261895.json:
```json
{
    "body": "Replying to [comment:40 vdelecroix]:\n> Replying to [comment:39 cheuberg]:\n> > Any particular reason that you return lists instead of tuples?\n> \n> Good question. `itertools` used to output tuples. But sometimes you want to play with the result (like appending some more elements). For me it is fine either way.\n\nI'd actually prefer tuples, for consistency with `itertools` and the other methods in this module.",
    "created_at": "2015-10-02T18:19:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19082#issuecomment-261895",
    "user": "cheuberg"
}
```

Replying to [comment:40 vdelecroix]:
> Replying to [comment:39 cheuberg]:
> > Any particular reason that you return lists instead of tuples?
> 
> Good question. `itertools` used to output tuples. But sometimes you want to play with the result (like appending some more elements). For me it is fine either way.

I'd actually prefer tuples, for consistency with `itertools` and the other methods in this module.



---

archive/issue_comments_261896.json:
```json
{
    "body": "Hi Clemens,\n\nI added a commit on top of yours for returning tuples and accepting a `repeat` argument (with the very same specification as for `itertools.product`).\n\nVincent\n----\nNew commits:",
    "created_at": "2015-10-02T18:50:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19082#issuecomment-261896",
    "user": "vdelecroix"
}
```

Hi Clemens,

I added a commit on top of yours for returning tuples and accepting a `repeat` argument (with the very same specification as for `itertools.product`).

Vincent
----
New commits:



---

archive/issue_comments_261897.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-10-03T05:04:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19082#issuecomment-261897",
    "user": "cheuberg"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_261898.json:
```json
{
    "body": "Code is fine, doctests pass, documentation builds. Thanks.",
    "created_at": "2015-10-03T05:04:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19082#issuecomment-261898",
    "user": "cheuberg"
}
```

Code is fine, doctests pass, documentation builds. Thanks.



---

archive/issue_comments_261899.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-10-12T22:52:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19082#issuecomment-261899",
    "user": "vbraun"
}
```

Resolution: fixed
