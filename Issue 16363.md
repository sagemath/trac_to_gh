# Issue 16363: Further Free* cleanup

Issue created by migration from Trac.

Original creator: nthiery

Original creation time: 2014-07-01 15:30:26

CC:  sage-combinat tscrim

- Implement shorthand `Algebras(QQ).free(...)` for `FreeAlgebra(QQ, ...)`
- Implement shorthand `Algebras(QQ).Commutative().free(...)` for `PolynomialRing(QQ,...)`
- Merge the implementations of `FreeAlgebra(...)` with `FreeMonoid().algebra()`
- Deprecate `FreeGroup`, `FreeAlgebra`, `FreeAbelianMonoid`, `FreeMonoid` from the global name space?
- Deprecate the `FreeMonoid` and `FreeAbelianMonoid` implementations (the indexed versions are as good)
- Make the algorithmic available in `FreeGroup` and `AbelianGroup` available to the indexed versions
- Implement categories like `Algebras.Commutative.Free` for generic code for all polynomial rings.


---

Comment by nbruin created at 2014-07-01 16:13:12

Keep in mind to avoid memory leaks. Currently we have one that can be avoided, but your proposed syntax would make it harder:

```
sage: FreeAlgebra(GF(5),['a','b']).category()
Category of algebras with basis over Finite Field of size 5
```

Since categories do not get garbage collected (and given their strong interconnections, never will: see how much trouble it takes to keep parents somewhat collectable in the face of the coercion model), you'll run out of memory  when you make algebras over a whole bunch of finite fields sequentially. We have a solution to this (as you're well aware, since you helped with the implementation):

```
sage: PolynomialRing(GF(5),['x','y']).category()
Join of Category of unique factorization domains and Category of commutative algebras over (finite fields and subquotients of monoids and quotients of semigroups)
sage: PolynomialRing(GF(5),['x','y']).category() is PolynomialRing(GF(7),['x','y']).category()
True
```

The category name looks absolutely horrible, but note that there's no explicit mention of the base ring. Indeed, the second line confirms that different base rings lead to the same category.

We could change `FreeAlgebra(GF(5),['a','b'])` to do the same, but if I understand your proposal, you're thinking of changing that to `Algebras(GF(5)).free(['a','b'])` in which case you'd force the creation of the object that causes the memory leak.

Your proposal `Algebras(QQ).Commutative().free(...)` for `PolynomialRing(QQ,...)` would make this even worse. I guess we could have `Algebras(Fields()).Commutative().free(QQ,...)` but I don't think that's very compelling. It requires the user to input `Fields()` and `QQ` in two different places and remember which goes where.

By comparison, `FreeCommutativeAlgebra(QQ,...)` looks much more natural and makes it easy to only install a generic category by default (I'd say `PolynomialRing` is a shorter and more mnemonic alternative, though).


---

Comment by nthiery created at 2014-07-01 16:50:47

Hi Nils,

That's a very good point. Thanks!

Hmm, kind of annoying. The point of this syntax was to aim for something uniform and remove stuff from the global name space by using the categories as single entry point. But I agree, as is that's not acceptable. Or at least not acceptable from a programmatic point of view. For interactive use, that would be ok; I don't expect users to create by hand billions of free algebras.

Let's think more about it!

A variant could be `Algebras.Commutative.free(QQ,4)`, but one need no check how robust this can be made.

Cheers,
                                                     Nicolas
