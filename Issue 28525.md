# Issue 28525: 2 doctests failed in cmdline.py related to rst2ipynb

Issue created by migration from https://trac.sagemath.org/ticket/28762

Original creator: slabbe

Original creation time: 2019-11-19 08:59:34

CC:  tmonteil

With 9.0.beta6, Release Date: 2019-11-18, the following


```
sage -t --optional=sage,optional,external src/sage/tests/cmdline.py
```


gives


```
sage -t src/sage/tests/cmdline.py
**********************************************************************
File "src/sage/tests/cmdline.py", line 658, in sage.tests.cmdline.test_executable
Failed example:
    print(out)                           # optional - rst2ipynb
Expected:
    {
     "nbformat_minor": ...,
     "nbformat": ...,
     "cells": [
      {
       "source": [
        "$$\n",
        "\\def\\CC{\\bf C}\n",
        "\\def\\QQ{\\bf Q}\n",
        "\\def\\RR{\\bf R}\n",
        "\\def\\ZZ{\\bf Z}\n",
        "\\def\\NN{\\bf N}\n",
        "$$"
       ],
       "cell_type": "markdown",
       "metadata": {}
      },
      {
       "execution_count": null,
       "cell_type": "code",
       "source": [
        "2^10"
       ],
       "outputs": [
        {
         "execution_count": 1,
         "output_type": "execute_result",
         "data": {
          "text/plain": [
           "1024"
          ]
         },
         "metadata": {}
        }
       ],
       "metadata": {}
      },
      {
       "execution_count": null,
       "cell_type": "code",
       "source": [
        "2 + 2"
       ],
       "outputs": [
        {
         "execution_count": 1,
         "output_type": "execute_result",
         "data": {
          "text/plain": [
           "4"
          ]
         },
         "metadata": {}
        }
       ],
       "metadata": {}
      }
     ],
     "metadata": {
      "kernelspec": {
       "display_name": "sagemath",
       "name": "sagemath"
      }
     }
    }
Got:
    {
     "cells": [
      {
       "cell_type": "markdown",
       "metadata": {},
       "source": [
        "$$\n",
        "\\def\\CC{\\bf C}\n",
        "\\def\\QQ{\\bf Q}\n",
        "\\def\\RR{\\bf R}\n",
        "\\def\\ZZ{\\bf Z}\n",
        "\\def\\NN{\\bf N}\n",
        "$$"
       ]
      },
      {
       "cell_type": "code",
       "execution_count": null,
       "metadata": {},
       "outputs": [
        {
         "data": {
          "text/plain": [
           "1024"
          ]
         },
         "execution_count": 1,
         "metadata": {},
         "output_type": "execute_result"
        }
       ],
       "source": [
        "2^10"
       ]
      },
      {
       "cell_type": "code",
       "execution_count": null,
       "metadata": {},
       "outputs": [
        {
         "data": {
          "text/plain": [
           "4"
          ]
         },
         "execution_count": 1,
         "metadata": {},
         "output_type": "execute_result"
        }
       ],
       "source": [
        "2 + 2"
       ]
      }
     ],
     "metadata": {
      "kernelspec": {
       "display_name": "sagemath",
       "name": "sagemath"
      }
     },
     "nbformat": 4,
     "nbformat_minor": 2
    }
    <BLANKLINE>
**********************************************************************
File "src/sage/tests/cmdline.py", line 739, in sage.tests.cmdline.test_executable
Failed example:
    print(open(output, 'r').read()) # optional - rst2ipynb
Expected:
    {
     "nbformat_minor": ...,
     "nbformat": ...,
     "cells": [
      {
       "source": [
        "$$\n",
        "\\def\\CC{\\bf C}\n",
        "\\def\\QQ{\\bf Q}\n",
    ...
     "metadata": {
      "kernelspec": {
       "display_name": "sagemath",
       "name": "sagemath"
      }
     }
    }
Got:
    {
     "cells": [
      {
       "cell_type": "markdown",
       "metadata": {},
       "source": [
        "$$\n",
        "\\def\\CC{\\bf C}\n",
        "\\def\\QQ{\\bf Q}\n",
        "\\def\\RR{\\bf R}\n",
        "\\def\\ZZ{\\bf Z}\n",
        "\\def\\NN{\\bf N}\n",
        "$$"
       ]
      },
      {
       "cell_type": "code",
       "execution_count": null,
       "metadata": {},
       "outputs": [
        {
         "data": {
          "text/plain": [
           "1024"
          ]
         },
         "execution_count": 1,
         "metadata": {},
         "output_type": "execute_result"
        }
       ],
       "source": [
        "2^10"
       ]
      },
      {
       "cell_type": "code",
       "execution_count": null,
       "metadata": {},
       "outputs": [
        {
         "data": {
          "text/plain": [
           "4"
          ]
         },
         "execution_count": 1,
         "metadata": {},
         "output_type": "execute_result"
        }
       ],
       "source": [
        "2 + 2"
       ]
      }
     ],
     "metadata": {
      "kernelspec": {
       "display_name": "sagemath",
       "name": "sagemath"
      }
     },
     "nbformat": 4,
     "nbformat_minor": 2
    }
**********************************************************************
1 item had failures:
   2 of 249 in sage.tests.cmdline.test_executable
    [248 tests, 2 failures, 29.00 s]
----------------------------------------------------------------------
sage -t src/sage/tests/cmdline.py  # 2 doctests failed
----------------------------------------------------------------------
Total time for all tests: 29.2 seconds
    cpu time: 0.3 seconds
    cumulative wall time: 29.0 seconds
External software detected for doctesting: internet,pandoc
```



---

Comment by slabbe created at 2019-11-20 20:06:46

Changing status from new to needs_review.


---

Comment by slabbe created at 2019-11-20 20:06:46

New commits:


---

Comment by tscrim created at 2019-12-09 02:55:09

These look like much more robust doctests.


---

Comment by tscrim created at 2019-12-09 02:55:09

Changing status from needs_review to positive_review.


---

Comment by slabbe created at 2019-12-09 22:11:28

Thanks for the review.


---

Comment by vbraun created at 2019-12-11 21:46:26

Resolution: fixed
