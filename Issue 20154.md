# Issue 20154: count_points breaks on even-degree hyperelliptic curves

Issue created by migration from Trac.

Original creator: kedlaya

Original creation time: 2016-04-08 16:37:05

CC:  cremona

Keywords: hyperelliptic curve, number of points

The following is currently broken:

```
sage: x = polygen(GF(4099))
sage: H = HyperellipticCurve(x^6 + x + 1)
sage: H.count_points(1)
...
ValueError: Q must be a monic polynomial of odd degree >= 3
```

The problem is that ultimately this is trying to call hypellfrob, which is only implemented for odd degree polynomials. One can patch around this using either PARI's hyperellcharpoly or the naive point counting code.

In the longer term, some more intelligent switching needs to be implemented for this method, as well as the related zeta_function and zeta_series methods; these do not all optimize the same way. See #965, #16931, #18916, #20309 for related discussions.


---

Comment by kedlaya created at 2016-04-08 23:51:10

There is a commit on #18916 that addresses this breakage.


---

Comment by kedlaya created at 2016-08-17 01:01:48

Please close after #18916 is merged.


---

Comment by kedlaya created at 2016-08-17 14:38:24

Changing status from new to needs_review.


---

Comment by kedlaya created at 2016-10-27 14:48:19

As reported by cremona, this is not completely resolved by #18916 after all. This call syntax should also be covered:

```
sage: F=GF(23) 
sage: x=polygen(F) 
sage: C=HyperellipticCurve(x^8+1) 
sage: C.cardinality()
... 
ValueError: Q must be a monic polynomial of odd degree >= 3 
```



---

Comment by kedlaya created at 2016-10-27 14:48:19

Changing status from needs_review to needs_work.


---

Comment by cremona created at 2016-10-27 14:55:28

Thanks for the update --  I had not noticed this ticket before.


---

Comment by kedlaya created at 2016-10-27 15:52:03

This is ultimately a dispatching issue: the code in #18916 includes some updated decision-making about what algorithm to use, but the `cardinality` method doesn't currently route through this decision point. This should be easy to fix!


---

Comment by kedlaya created at 2016-10-27 22:23:14

Changing status from needs_work to needs_review.


---

Comment by kedlaya created at 2016-10-27 22:23:14

Apparently what I did for `count_points` was the trivial patch: in the even-degree case, just drop down to counting points. This is of course not the correct solution long-term, but it does fix the reported bug. Anyway, I copied that trivial fix over to `cardinality`.
----
New commits:


---

Comment by jpflori created at 2016-11-17 15:39:34

Ok let's go with this at the moment.


---

Comment by jpflori created at 2016-11-17 15:39:34

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-11-19 16:35:02

Resolution: fixed
