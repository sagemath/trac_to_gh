# Issue 14227: Rewrite the sage-cleaner

Issue created by migration from Trac.

Original creator: vbraun

Original creation time: 2013-04-09 13:39:27

Assignee: leif

Its still bad. Here is a wishlist:

* don't continuously restart the sage cleaner during doctests
* make it part of the sage library to get rid of the code duplication for temporary directories that keeps breaking the cleaner
* in particular, make it doctestable
* Entries in `spawned_processes` are killed by the cleaner and by `sage.interfaces.quit.expect_quitall()`.
* avoid potential races with PID wrap-around: Sage should announce its shutdown to the cleaner.
* Ensure (and doctest) that the temp directory with given PID is deleted before Sage starts. Even if the cleaner doesn't work we must not kill stuff from old `spawned_process` files. 


---

Comment by leif created at 2013-04-16 15:49:38

Replying to [ticket:14431 vbraun]:
> * make it part of the sage library to get rid of the code duplication for temporary directories that keeps breaking the cleaner

Not sure if that makes sense.  People should take more care when changing such parts... ;-)

In any case, "both parts" should of course somehow use the same interface (i.e., directories etc.), which doesn't or shouldn't require code duplication.  It should IMHO still be possible to run a single instance of the Sage cleaner for different (running) Sage versions, or, at the very least, the cleaner(s) shouldn't break when running different Sage versions at the same time.


---

Comment by jhpalmieri created at 2013-04-16 16:01:59

My suggestion on #14055 was to put, for example,

```
from sage.env import HOSTNAME
```

in `sage-cleaner`.
