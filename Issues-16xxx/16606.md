# Issue 16606: Bernstein creation operators and other fixes on symmetric functions

archive/issues_016369.json:
```json
{
    "body": "This patch introduces the Bernstein creation operators on the symmetric and the noncommutative symmetric functions. I don't know whether the implementation on the latter is anywhere near optimal, but the former should be fairly fast.\n\nIt also fixes a mistake I made long ago when implementing the Witt basis of Sym and the Hazewinkel basis of QSym, which caused the following to break:\n\n```\nSym = SymmetricFunctions(ZZ)\nw = Sym.w()\nw[4].coproduct()\n```\nThis failed because `w[4]` would be transformed into the h-basis, which would make some of its coefficients into rationals even though they should be integers. The cause was the fact that inverting an integer matrix can turn its entries into rationals even if the matrix is invertible over ZZ. I have fixed this in a way I believe to be suboptimal, but this is all I have time for...\n\nA few more cases of broken documentation are fixed.\n\nCC:  sage-combinat @nthiery @zabrocki\n\nKeywords: symmetric functions, sage-combinat\n\nBranch/Commit: e4d7f5395a4437325941ba6526bba92b42ae65c1\n\nReviewer: Travis Scrimshaw\n\nAuthor: Darij Grinberg\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/16606\n\n",
    "closed_at": "2014-08-24T12:31:43Z",
    "created_at": "2014-07-03T05:16:02Z",
    "labels": [
        "component: combinatorics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Bernstein creation operators and other fixes on symmetric functions",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16606",
    "user": "https://github.com/darijgr"
}
```
This patch introduces the Bernstein creation operators on the symmetric and the noncommutative symmetric functions. I don't know whether the implementation on the latter is anywhere near optimal, but the former should be fairly fast.

It also fixes a mistake I made long ago when implementing the Witt basis of Sym and the Hazewinkel basis of QSym, which caused the following to break:

```
Sym = SymmetricFunctions(ZZ)
w = Sym.w()
w[4].coproduct()
```
This failed because `w[4]` would be transformed into the h-basis, which would make some of its coefficients into rationals even though they should be integers. The cause was the fact that inverting an integer matrix can turn its entries into rationals even if the matrix is invertible over ZZ. I have fixed this in a way I believe to be suboptimal, but this is all I have time for...

A few more cases of broken documentation are fixed.

CC:  sage-combinat @nthiery @zabrocki

Keywords: symmetric functions, sage-combinat

Branch/Commit: e4d7f5395a4437325941ba6526bba92b42ae65c1

Reviewer: Travis Scrimshaw

Author: Darij Grinberg

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/16606





---

archive/issue_comments_228788.json:
```json
{
    "body": "<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-07-04T07:05:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16606#issuecomment-228788",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_228789.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-07-04T07:07:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16606#issuecomment-228789",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_228790.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-07-04T07:21:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16606#issuecomment-228790",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_228791.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-07-04T07:29:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16606#issuecomment-228791",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_228792.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-07-14T23:33:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16606#issuecomment-228792",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_228793.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,11 +1,15 @@\n+This patch introduces the Bernstein creation operators on the symmetric and the noncommutative symmetric functions. I don't know whether the implementation on the latter is anywhere near optimal, but the former should be fairly fast.\n+\n+It also fixes a mistake I made long ago when implementing the Witt basis of Sym and the Hazewinkel basis of QSym, which caused the following to break:\n+\n \\`\\`\\`\n Sym = SymmetricFunctions(ZZ)\n w = Sym.w()\n w[4].coproduct()\n \\`\\`\\`\n-This would fail because \\`w[4]\\` would be transformed into the h-basis, which would make some of its coefficients into rationals even though they should be integers.\n+This failed because \\`w[4]\\` would be transformed into the h-basis, which would make some of its coefficients into rationals even though they should be integers. The cause was the fact that inverting an integer matrix can turn its entries into rationals even if the matrix is invertible over ZZ. I have fixed this in a way I believe to be suboptimal, but this is all I have time for...\n \n-The cause is the fact that inverting an integer matrix can turn its entries into rationals even if the matrix is invertible over ZZ. I have fixed this in a way I believe to be suboptimal, but this is all I have time for...\n+A few more cases of broken documentation are fixed.\n \n Author: Darij Grinberg\n \n```\n",
    "created_at": "2014-07-14T23:36:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16606#issuecomment-228793",
    "user": "https://github.com/darijgr"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,11 +1,15 @@
+This patch introduces the Bernstein creation operators on the symmetric and the noncommutative symmetric functions. I don't know whether the implementation on the latter is anywhere near optimal, but the former should be fairly fast.
+
+It also fixes a mistake I made long ago when implementing the Witt basis of Sym and the Hazewinkel basis of QSym, which caused the following to break:
+
 \`\`\`
 Sym = SymmetricFunctions(ZZ)
 w = Sym.w()
 w[4].coproduct()
 \`\`\`
-This would fail because \`w[4]\` would be transformed into the h-basis, which would make some of its coefficients into rationals even though they should be integers.
+This failed because \`w[4]\` would be transformed into the h-basis, which would make some of its coefficients into rationals even though they should be integers. The cause was the fact that inverting an integer matrix can turn its entries into rationals even if the matrix is invertible over ZZ. I have fixed this in a way I believe to be suboptimal, but this is all I have time for...
 
-The cause is the fact that inverting an integer matrix can turn its entries into rationals even if the matrix is invertible over ZZ. I have fixed this in a way I believe to be suboptimal, but this is all I have time for...
+A few more cases of broken documentation are fixed.
 
 Author: Darij Grinberg
 
```




---

archive/issue_comments_228794.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2014-07-15T00:17:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16606#issuecomment-228794",
    "user": "https://github.com/darijgr"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_228795.json:
```json
{
    "body": "<a id='comment:9'></a>The info that this ticket is in need for is whether it is OK to rely on sage's ability to invert an invertible matrix over an arbitrary base ring. The matrix is defined over ZZ (and is invertible over ZZ), but Sage does not know that, and the worry is that over some rings it might not find the inverse despite its existence.",
    "created_at": "2014-07-15T00:19:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16606#issuecomment-228795",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:9'></a>The info that this ticket is in need for is whether it is OK to rely on sage's ability to invert an invertible matrix over an arbitrary base ring. The matrix is defined over ZZ (and is invertible over ZZ), but Sage does not know that, and the worry is that over some rings it might not find the inverse despite its existence.



---

archive/issue_comments_228796.json:
```json
{
    "body": "<a id='comment:10'></a>I would perhaps do something like this as the workaround:\n\n```python\ninv_m = ~m\ntry:\n    inv_m = inv_m.change_ring(m.base_ring())\nexcept TypeError: # It's not in the base ring as we thought it was\n    pass\n```\nor without the `try/except` block if it should fail.\n\nI would also say the using Sage's ability to invert the matrix over general base rings is the only realistic way to work (unless I'm missing something).",
    "created_at": "2014-07-15T03:13:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16606#issuecomment-228796",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:10'></a>I would perhaps do something like this as the workaround:

```python
inv_m = ~m
try:
    inv_m = inv_m.change_ring(m.base_ring())
except TypeError: # It's not in the base ring as we thought it was
    pass
```
or without the `try/except` block if it should fail.

I would also say the using Sage's ability to invert the matrix over general base rings is the only realistic way to work (unless I'm missing something).



---

archive/issue_comments_228797.json:
```json
{
    "body": "<a id='comment:11'></a>Thanks, but this begs my question, which I guess was unclear.\n\nThe thing that can fail is not the \"change_ring\"; it's the inversion itself. And what I am worried is that it could fail despite the matrix (which is actually an integer matrix with determinant -+1) having an inverse. The one realistic workaround for that is to do these matrix computations over the base ring ZZ rather than the given base ring for the symmetric functions. This could have the additional advantage that the matrices are constructed only once even if I work over different rings at the same time. Is it worth redesigning the Witt basis?",
    "created_at": "2014-07-15T09:19:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16606#issuecomment-228797",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:11'></a>Thanks, but this begs my question, which I guess was unclear.

The thing that can fail is not the "change_ring"; it's the inversion itself. And what I am worried is that it could fail despite the matrix (which is actually an integer matrix with determinant -+1) having an inverse. The one realistic workaround for that is to do these matrix computations over the base ring ZZ rather than the given base ring for the symmetric functions. This could have the additional advantage that the matrices are constructed only once even if I work over different rings at the same time. Is it worth redesigning the Witt basis?



---

archive/issue_comments_228798.json:
```json
{
    "body": "<a id='comment:12'></a>Are you worried about rings with positive characteristic (in which case, if it fails, is the basis even well-defined)? I believe we should just leave it as (doing the matrix inversion over the base ring) is until we come across a definite problem.",
    "created_at": "2014-07-15T17:37:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16606#issuecomment-228798",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:12'></a>Are you worried about rings with positive characteristic (in which case, if it fails, is the basis even well-defined)? I believe we should just leave it as (doing the matrix inversion over the base ring) is until we come across a definite problem.



---

archive/issue_comments_228799.json:
```json
{
    "body": "<a id='comment:13'></a>Not so much positive-characteristic as rings which are too complicated for inversion (I'm thinking of symmetric functions over symmetric functions, but right now this is probably made impossible by other issues).\n\nOK, needs_review then (and thanks for the feedback!).",
    "created_at": "2014-07-15T17:40:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16606#issuecomment-228799",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:13'></a>Not so much positive-characteristic as rings which are too complicated for inversion (I'm thinking of symmetric functions over symmetric functions, but right now this is probably made impossible by other issues).

OK, needs_review then (and thanks for the feedback!).



---

archive/issue_comments_228800.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2014-07-15T17:40:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16606#issuecomment-228800",
    "user": "https://github.com/darijgr"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_228801.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-07-29T10:49:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16606#issuecomment-228801",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_048702.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16606",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16606#event-48702"
}
```



---

archive/issue_comments_228802.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-08-23T00:37:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16606#issuecomment-228802",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_228803.json:
```json
{
    "body": "<a id='comment:17'></a>I made some review tweaks. If you're happy with them, then go ahead and set a positive review.",
    "created_at": "2014-08-23T00:38:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16606#issuecomment-228803",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:17'></a>I made some review tweaks. If you're happy with them, then go ahead and set a positive review.



---

archive/issue_comments_228804.json:
```json
{
    "body": "<a id='comment:18'></a>Thanks a lot for the review! I wish I had the time to reciprocate...\n\nSorry, but your Bernstein operator on the immaculate basis doesn't work, since n could be nonpositive. Maybe you can delegate this case to the \"super\" version of the method? (I'm not saying you should; removing the thing is just as fine.)",
    "created_at": "2014-08-23T01:02:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16606#issuecomment-228804",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:18'></a>Thanks a lot for the review! I wish I had the time to reciprocate...

Sorry, but your Bernstein operator on the immaculate basis doesn't work, since n could be nonpositive. Maybe you can delegate this case to the "super" version of the method? (I'm not saying you should; removing the thing is just as fine.)



---

archive/issue_comments_228805.json:
```json
{
    "body": "<a id='comment:19'></a>Alternatively, you could use the `immaculate_function` method on any basis (I think they all go through the complete basis, so that's where you want to do it). That gives you the immaculate function for every integer vector.\n\n```\nsage: NSym = NonCommutativeSymmetricFunctions(QQ)\nsage: I = NSym.I()\nsage: I.immaculate_function([-1,2,2,2]) # that should be the -1-st Bernstein of I[2,2,2]\nI[1, 1, 1, 2] + I[1, 1, 2, 1] + I[1, 2, 1, 1] - I[1, 2, 2]\nsage: I.immaculate_function([0,2,3,2])\n-I[1, 1, 3, 2] - I[1, 2, 2, 2] - I[1, 2, 3, 1] + I[2, 3, 2]\n```\n\nBut I am not sure if this is faster than just going through the complete basis...",
    "created_at": "2014-08-23T11:28:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16606#issuecomment-228805",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:19'></a>Alternatively, you could use the `immaculate_function` method on any basis (I think they all go through the complete basis, so that's where you want to do it). That gives you the immaculate function for every integer vector.

```
sage: NSym = NonCommutativeSymmetricFunctions(QQ)
sage: I = NSym.I()
sage: I.immaculate_function([-1,2,2,2]) # that should be the -1-st Bernstein of I[2,2,2]
I[1, 1, 1, 2] + I[1, 1, 2, 1] + I[1, 2, 1, 1] - I[1, 2, 2]
sage: I.immaculate_function([0,2,3,2])
-I[1, 1, 3, 2] - I[1, 2, 2, 2] - I[1, 2, 3, 1] + I[2, 3, 2]
```

But I am not sure if this is faster than just going through the complete basis...



---

archive/issue_comments_228806.json:
```json
{
    "body": "<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-08-23T14:54:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16606#issuecomment-228806",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_228807.json:
```json
{
    "body": "<a id='comment:21'></a>I decided to push to the super. Fixed.",
    "created_at": "2014-08-23T14:54:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16606#issuecomment-228807",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:21'></a>I decided to push to the super. Fixed.



---

archive/issue_comments_228808.json:
```json
{
    "body": "<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-08-23T15:08:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16606#issuecomment-228808",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_228809.json:
```json
{
    "body": "<a id='comment:23'></a>Thanks again. If you are fine with my last commit, please set to positive_review.",
    "created_at": "2014-08-23T15:09:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16606#issuecomment-228809",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:23'></a>Thanks again. If you are fine with my last commit, please set to positive_review.



---

archive/issue_comments_228810.json:
```json
{
    "body": "<a id='comment:24'></a>LGTM",
    "created_at": "2014-08-23T15:24:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16606#issuecomment-228810",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:24'></a>LGTM



---

archive/issue_comments_228811.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-08-23T15:24:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16606#issuecomment-228811",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_048703.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-08-24T12:31:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16606",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16606#event-48703"
}
```



---

archive/issue_comments_228812.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-08-24T12:31:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16606",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16606#issuecomment-228812",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
