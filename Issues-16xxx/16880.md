# Issue 16880: previous_prime, previous_prime_power, next_prime_power

archive/issues_016643.json:
```json
{
    "body": "In this ticket we add three methods to integers: `previous_prime` (calling pari `precprime`), `next_prime_power` and `previous_prime_power`. We also make changes in `sage.rings.arith` to call these (faster) methods.\n\nTimings on the current version (sage-6.7.beta2)\n\n```\nsage: timeit(\"for i in range(200): next_prime_power(i)\", number=5000, repeat=10)\n5000 loops, best of 10: 311 \u00b5s per loop\nsage: a = 33622489\nsage: timeit(\"next_prime_power(a)\", number=5000, repeat=10)\n5000 loops, best of 10: 53.6 \u00b5s per loop\n```\n\nTimings with the branch applied\n\n```\nsage: timeit(\"for i in range(200): next_prime_power(i)\", number=5000, repeat=10)\n5000 loops, best of 10: 184 \u00b5s per loop\nsage: a = 33622489\nsage: timeit(\"next_prime_power(a)\", number=5000, repeat=10)\n5000 loops, best of 10: 16.9 \u00b5s per loop\n```\n\nFollow up: #18298 and #18299\n\nCC:  @nathanncohen @jdemeyer\n\nReviewer: Jeroen Demeyer\n\nAuthor: Vincent Delecroix\n\nBranch: 35c0211766537e6769cd060ed528ad9d77e60068\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/16880\n\n",
    "closed_at": "2015-04-29T03:13:45Z",
    "created_at": "2014-08-26T11:09:37Z",
    "labels": [
        "component: number theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.7",
    "title": "previous_prime, previous_prime_power, next_prime_power",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16880",
    "user": "https://github.com/videlec"
}
```
In this ticket we add three methods to integers: `previous_prime` (calling pari `precprime`), `next_prime_power` and `previous_prime_power`. We also make changes in `sage.rings.arith` to call these (faster) methods.

Timings on the current version (sage-6.7.beta2)

```
sage: timeit("for i in range(200): next_prime_power(i)", number=5000, repeat=10)
5000 loops, best of 10: 311 µs per loop
sage: a = 33622489
sage: timeit("next_prime_power(a)", number=5000, repeat=10)
5000 loops, best of 10: 53.6 µs per loop
```

Timings with the branch applied

```
sage: timeit("for i in range(200): next_prime_power(i)", number=5000, repeat=10)
5000 loops, best of 10: 184 µs per loop
sage: a = 33622489
sage: timeit("next_prime_power(a)", number=5000, repeat=10)
5000 loops, best of 10: 16.9 µs per loop
```

Follow up: #18298 and #18299

CC:  @nathanncohen @jdemeyer

Reviewer: Jeroen Demeyer

Author: Vincent Delecroix

Branch: 35c0211766537e6769cd060ed528ad9d77e60068

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/16880





---

archive/issue_comments_278577.json:
```json
{
    "body": "<a id='comment:1'></a>\n+1 for \"primes\"",
    "created_at": "2014-08-26T11:29:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278577",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:1'></a>
+1 for "primes"



---

archive/issue_comments_278578.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,7 @@\n-The cythonization of `prime_powers` is much faster (around x4 in the timings). We also introduce the keyword `py_ints` as in `prime_range` in order to be able to use Python int instead of Sage integers.\n+The cythonization of `prime_powers` is much faster (around x4 in the timings). We introduce in a new function `prime_power_range` in `fast_arith.pyx` (that also has a keyword `py_ints` as `prime_range`).\n \n-Note: I do not like the convention that the name are different `prime_powers` vs `prime_range`... why not using `primes` or `prime_power_range`?\n+Note: naming conventions are crazy... right now there are:\n+- `primes`: iterator over prime numbers\n+- `prime_range`: return the list of the first prime (fast implementation in Cython but only handles integer up to `LONG_MAX` and require memory)\n+- `prime_powers`: return the list of prime powers!\n+It seems to me that in Sage we tend to have `X_iterator` for iterator and `Xs` for the list of objects...\n``````\n",
    "created_at": "2014-08-26T11:54:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278578",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,7 @@
-The cythonization of `prime_powers` is much faster (around x4 in the timings). We also introduce the keyword `py_ints` as in `prime_range` in order to be able to use Python int instead of Sage integers.
+The cythonization of `prime_powers` is much faster (around x4 in the timings). We introduce in a new function `prime_power_range` in `fast_arith.pyx` (that also has a keyword `py_ints` as `prime_range`).
 
-Note: I do not like the convention that the name are different `prime_powers` vs `prime_range`... why not using `primes` or `prime_power_range`?
+Note: naming conventions are crazy... right now there are:
+- `primes`: iterator over prime numbers
+- `prime_range`: return the list of the first prime (fast implementation in Cython but only handles integer up to `LONG_MAX` and require memory)
+- `prime_powers`: return the list of prime powers!
+It seems to me that in Sage we tend to have `X_iterator` for iterator and `Xs` for the list of objects...
``````




---

archive/issue_comments_278579.json:
```json
{
    "body": "Changing branch from \"\" to \"u/vdelecroix/16880\"",
    "created_at": "2014-08-26T11:54:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278579",
    "user": "https://github.com/videlec"
}
```

Changing branch from "" to "u/vdelecroix/16880"



---

archive/issue_comments_278580.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-08-26T11:54:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278580",
    "user": "https://github.com/videlec"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_278581.json:
```json
{
    "body": "Changing commit from \"\" to \"6c6cbe25b41dece8513ad3527c68415517328710\"",
    "created_at": "2014-08-26T12:01:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278581",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "" to "6c6cbe25b41dece8513ad3527c68415517328710"



---

archive/issue_comments_278582.json:
```json
{
    "body": "<a id='comment:3'></a>\nBranch pushed to git repo; I updated commit sha1. Last 10 new commits:\n|                                                                                                                                          |                                  |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------|\n|[1d103da](https://github.com/sagemath/sagetrac-mirror/commit/1d103da9fc0cc1629750e421a07cdfed4b94b040)|`Trac 15767: fix doctest in Ser()`|\n|[62ca821](https://github.com/sagemath/sagetrac-mirror/commit/62ca8211de7d43d0686edf0d77f55a23aaeee5c7)|`Trac 15767: explain application of Sturm's theorem`|\n|[bf435f8](https://github.com/sagemath/sagetrac-mirror/commit/bf435f8db1537f63c001894fb4949879617b71f2)|`Merge tag '6.4.beta1' into ticket/15767`|\n|[6e9f686](https://github.com/sagemath/sagetrac-mirror/commit/6e9f686d323671a4927cdc081cf7b473e6d356fe)|`trac #16878: faster is_prime`|\n|[d7dc389](https://github.com/sagemath/sagetrac-mirror/commit/d7dc38918903a97af742a90050ce87c58f6f222a)|`trac #16878: review`|\n|[175d6b5](https://github.com/sagemath/sagetrac-mirror/commit/175d6b5fd339989df12ec9c1f26d3b0d7e6dd82c)|`trac #16878: review 2`|\n|[d55dc67](https://github.com/sagemath/sagetrac-mirror/commit/d55dc6737936077eeee903687207f7af54588439)|`trac #16878: bikeshedding`|\n|[f73bd87](https://github.com/sagemath/sagetrac-mirror/commit/f73bd87b6850f626ae9d6da896fb730f3ae759c1)|`trac #16869: fast prime_powers`|\n|[8259a7d](https://github.com/sagemath/sagetrac-mirror/commit/8259a7d2951366c5c715e8080ce96106e1e7e14a)|`trac #16869: fix prime_powers(0,1)`|\n|[6c6cbe2](https://github.com/sagemath/sagetrac-mirror/commit/6c6cbe25b41dece8513ad3527c68415517328710)|`trac #16880: implement prime_power_range`|",
    "created_at": "2014-08-26T12:01:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278582",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
Branch pushed to git repo; I updated commit sha1. Last 10 new commits:
|                                                                                                                                          |                                  |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------|
|[1d103da](https://github.com/sagemath/sagetrac-mirror/commit/1d103da9fc0cc1629750e421a07cdfed4b94b040)|`Trac 15767: fix doctest in Ser()`|
|[62ca821](https://github.com/sagemath/sagetrac-mirror/commit/62ca8211de7d43d0686edf0d77f55a23aaeee5c7)|`Trac 15767: explain application of Sturm's theorem`|
|[bf435f8](https://github.com/sagemath/sagetrac-mirror/commit/bf435f8db1537f63c001894fb4949879617b71f2)|`Merge tag '6.4.beta1' into ticket/15767`|
|[6e9f686](https://github.com/sagemath/sagetrac-mirror/commit/6e9f686d323671a4927cdc081cf7b473e6d356fe)|`trac #16878: faster is_prime`|
|[d7dc389](https://github.com/sagemath/sagetrac-mirror/commit/d7dc38918903a97af742a90050ce87c58f6f222a)|`trac #16878: review`|
|[175d6b5](https://github.com/sagemath/sagetrac-mirror/commit/175d6b5fd339989df12ec9c1f26d3b0d7e6dd82c)|`trac #16878: review 2`|
|[d55dc67](https://github.com/sagemath/sagetrac-mirror/commit/d55dc6737936077eeee903687207f7af54588439)|`trac #16878: bikeshedding`|
|[f73bd87](https://github.com/sagemath/sagetrac-mirror/commit/f73bd87b6850f626ae9d6da896fb730f3ae759c1)|`trac #16869: fast prime_powers`|
|[8259a7d](https://github.com/sagemath/sagetrac-mirror/commit/8259a7d2951366c5c715e8080ce96106e1e7e14a)|`trac #16869: fix prime_powers(0,1)`|
|[6c6cbe2](https://github.com/sagemath/sagetrac-mirror/commit/6c6cbe25b41dece8513ad3527c68415517328710)|`trac #16880: implement prime_power_range`|



---

archive/issue_comments_278583.json:
```json
{
    "body": "<a id='comment:4'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                          |                                |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------|\n|[e7b9458](https://github.com/sagemath/sagetrac-mirror/commit/e7b94588ee7ecb82c00afa48f905622f5c374cdd)|`trac #16880: prime_power_range`|",
    "created_at": "2014-08-28T20:23:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278583",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                          |                                |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------|
|[e7b9458](https://github.com/sagemath/sagetrac-mirror/commit/e7b94588ee7ecb82c00afa48f905622f5c374cdd)|`trac #16880: prime_power_range`|



---

archive/issue_comments_278584.json:
```json
{
    "body": "Changing commit from \"6c6cbe25b41dece8513ad3527c68415517328710\" to \"e7b94588ee7ecb82c00afa48f905622f5c374cdd\"",
    "created_at": "2014-08-28T20:23:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278584",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "6c6cbe25b41dece8513ad3527c68415517328710" to "e7b94588ee7ecb82c00afa48f905622f5c374cdd"



---

archive/issue_comments_278585.json:
```json
{
    "body": "Changing dependencies from \"#16869, #16878\" to \"\"",
    "created_at": "2014-08-28T20:25:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278585",
    "user": "https://github.com/videlec"
}
```

Changing dependencies from "#16869, #16878" to ""



---

archive/issue_comments_278586.json:
```json
{
    "body": "<a id='comment:5'></a>\nRebased on 6.4.beta2, no dependency anymore...\n\nVincent",
    "created_at": "2014-08-28T20:25:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278586",
    "user": "https://github.com/videlec"
}
```

<a id='comment:5'></a>
Rebased on 6.4.beta2, no dependency anymore...

Vincent



---

archive/issue_events_063859.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "rename": {
        "from": "even faster prime_powers",
        "to": "prime_power_range"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16880#event-63859"
}
```



---

archive/issue_comments_278587.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,7 +1 @@\n The cythonization of `prime_powers` is much faster (around x4 in the timings). We introduce in a new function `prime_power_range` in `fast_arith.pyx` (that also has a keyword `py_ints` as `prime_range`).\n-\n-Note: naming conventions are crazy... right now there are:\n-- `primes`: iterator over prime numbers\n-- `prime_range`: return the list of the first prime (fast implementation in Cython but only handles integer up to `LONG_MAX` and require memory)\n-- `prime_powers`: return the list of prime powers!\n-It seems to me that in Sage we tend to have `X_iterator` for iterator and `Xs` for the list of objects...\n``````\n",
    "created_at": "2014-08-28T20:25:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278587",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,7 +1 @@
 The cythonization of `prime_powers` is much faster (around x4 in the timings). We introduce in a new function `prime_power_range` in `fast_arith.pyx` (that also has a keyword `py_ints` as `prime_range`).
-
-Note: naming conventions are crazy... right now there are:
-- `primes`: iterator over prime numbers
-- `prime_range`: return the list of the first prime (fast implementation in Cython but only handles integer up to `LONG_MAX` and require memory)
-- `prime_powers`: return the list of prime powers!
-It seems to me that in Sage we tend to have `X_iterator` for iterator and `Xs` for the list of objects...
``````




---

archive/issue_comments_278588.json:
```json
{
    "body": "Changing commit from \"e7b94588ee7ecb82c00afa48f905622f5c374cdd\" to \"a3195f7bb4e16cc4eb3f3ae4ef58a4b5d0341ad2\"",
    "created_at": "2014-08-30T16:36:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278588",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e7b94588ee7ecb82c00afa48f905622f5c374cdd" to "a3195f7bb4e16cc4eb3f3ae4ef58a4b5d0341ad2"



---

archive/issue_comments_278589.json:
```json
{
    "body": "<a id='comment:6'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                          |                              |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------|\n|[6e9f686](https://github.com/sagemath/sagetrac-mirror/commit/6e9f686d323671a4927cdc081cf7b473e6d356fe)|`trac #16878: faster is_prime`|\n|[d7dc389](https://github.com/sagemath/sagetrac-mirror/commit/d7dc38918903a97af742a90050ce87c58f6f222a)|`trac #16878: review`|\n|[175d6b5](https://github.com/sagemath/sagetrac-mirror/commit/175d6b5fd339989df12ec9c1f26d3b0d7e6dd82c)|`trac #16878: review 2`|\n|[d55dc67](https://github.com/sagemath/sagetrac-mirror/commit/d55dc6737936077eeee903687207f7af54588439)|`trac #16878: bikeshedding`|\n|[7f61321](https://github.com/sagemath/sagetrac-mirror/commit/7f6132188b7ddafd97630aaf721875f9d60a7106)|`Reorganize is_prime_power() and next_prime() logic`|\n|[5937af5](https://github.com/sagemath/sagetrac-mirror/commit/5937af54afa0562007d710c495ecd0f1160f7498)|`Sloane considers 1 to be a prime power`|\n|[f0d716f](https://github.com/sagemath/sagetrac-mirror/commit/f0d716fd34029f65d0be0aa45d5cb1783f8da2f5)|`trac #16878: certificate flag in is_prime_power`|\n|[bfd69d3](https://github.com/sagemath/sagetrac-mirror/commit/bfd69d3b188a8ec36ab373b4e958b54c74b64d2b)|`is_prime_power() reviewer fixes`|\n|[9e04c7a](https://github.com/sagemath/sagetrac-mirror/commit/9e04c7a060a739ca9933a8f599524e63cf5d070c)|`trac #16880: merge #16878 (faster is_prime)`|\n|[a3195f7](https://github.com/sagemath/sagetrac-mirror/commit/a3195f7bb4e16cc4eb3f3ae4ef58a4b5d0341ad2)|`trac #16880: prime_power_range`|",
    "created_at": "2014-08-30T16:36:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278589",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                          |                              |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------|
|[6e9f686](https://github.com/sagemath/sagetrac-mirror/commit/6e9f686d323671a4927cdc081cf7b473e6d356fe)|`trac #16878: faster is_prime`|
|[d7dc389](https://github.com/sagemath/sagetrac-mirror/commit/d7dc38918903a97af742a90050ce87c58f6f222a)|`trac #16878: review`|
|[175d6b5](https://github.com/sagemath/sagetrac-mirror/commit/175d6b5fd339989df12ec9c1f26d3b0d7e6dd82c)|`trac #16878: review 2`|
|[d55dc67](https://github.com/sagemath/sagetrac-mirror/commit/d55dc6737936077eeee903687207f7af54588439)|`trac #16878: bikeshedding`|
|[7f61321](https://github.com/sagemath/sagetrac-mirror/commit/7f6132188b7ddafd97630aaf721875f9d60a7106)|`Reorganize is_prime_power() and next_prime() logic`|
|[5937af5](https://github.com/sagemath/sagetrac-mirror/commit/5937af54afa0562007d710c495ecd0f1160f7498)|`Sloane considers 1 to be a prime power`|
|[f0d716f](https://github.com/sagemath/sagetrac-mirror/commit/f0d716fd34029f65d0be0aa45d5cb1783f8da2f5)|`trac #16878: certificate flag in is_prime_power`|
|[bfd69d3](https://github.com/sagemath/sagetrac-mirror/commit/bfd69d3b188a8ec36ab373b4e958b54c74b64d2b)|`is_prime_power() reviewer fixes`|
|[9e04c7a](https://github.com/sagemath/sagetrac-mirror/commit/9e04c7a060a739ca9933a8f599524e63cf5d070c)|`trac #16880: merge #16878 (faster is_prime)`|
|[a3195f7](https://github.com/sagemath/sagetrac-mirror/commit/a3195f7bb4e16cc4eb3f3ae4ef58a4b5d0341ad2)|`trac #16880: prime_power_range`|



---

archive/issue_comments_278590.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#16878\"",
    "created_at": "2014-08-30T16:39:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278590",
    "user": "https://github.com/videlec"
}
```

Changing dependencies from "" to "#16878"



---

archive/issue_comments_278591.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n-The cythonization of `prime_powers` is much faster (around x4 in the timings). We introduce in a new function `prime_power_range` in `fast_arith.pyx` (that also has a keyword `py_ints` as `prime_range`).\n+The cythonization of `prime_powers` is much faster (around x4 in the timings). We introduce in a new function `prime_power_range` in `fast_arith.pyx` that is similar to `prime_range`.\n+\n+Since #16878, 1 is not a prime power anymore! So we fix `prime_powers` to never return 1 in its output.\n``````\n",
    "created_at": "2014-08-30T16:39:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278591",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,3 @@
-The cythonization of `prime_powers` is much faster (around x4 in the timings). We introduce in a new function `prime_power_range` in `fast_arith.pyx` (that also has a keyword `py_ints` as `prime_range`).
+The cythonization of `prime_powers` is much faster (around x4 in the timings). We introduce in a new function `prime_power_range` in `fast_arith.pyx` that is similar to `prime_range`.
+
+Since #16878, 1 is not a prime power anymore! So we fix `prime_powers` to never return 1 in its output.
``````




---

archive/issue_comments_278592.json:
```json
{
    "body": "<a id='comment:7'></a>\nAnd with timings\n\nusing `prime_powers` (EDIT: only for commit at a3195f7 and not at e3be1ce)\n\n```\nsage: timeit(\"prime_powers(1000)\", number=4000)\n4000 loops, best of 3: 86.7 \u00b5s per loop\nsage: timeit(\"prime_powers(5000)\", number=2000)\n2000 loops, best of 3: 314 \u00b5s per loop\n```\n\nusing `prime_power_range` instead\n\n```\nsage: timeit(\"prime_power_range(1000)\", number=4000)\n4000 loops, best of 3: 17.6 \u00b5s per loop\nsage:  timeit(\"prime_power_range(5000)\", number=2000)\n2000 loops, best of 3: 72.3 \u00b5s per loop\n```\n\nusing `prime_power_range` with `py_ints=True`\n\n```\nsage: timeit(\"prime_power_range(1000,py_ints=True)\", number=4000)\n4000 loops, best of 3: 14.6 \u00b5s per loop\nsage:  timeit(\"prime_power_range(5000,py_ints=True)\", number=2000)\n2000 loops, best of 3: 33.9 \u00b5s per loop\n```",
    "created_at": "2014-08-30T16:39:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278592",
    "user": "https://github.com/videlec"
}
```

<a id='comment:7'></a>
And with timings

using `prime_powers` (EDIT: only for commit at a3195f7 and not at e3be1ce)

```
sage: timeit("prime_powers(1000)", number=4000)
4000 loops, best of 3: 86.7 µs per loop
sage: timeit("prime_powers(5000)", number=2000)
2000 loops, best of 3: 314 µs per loop
```

using `prime_power_range` instead

```
sage: timeit("prime_power_range(1000)", number=4000)
4000 loops, best of 3: 17.6 µs per loop
sage:  timeit("prime_power_range(5000)", number=2000)
2000 loops, best of 3: 72.3 µs per loop
```

using `prime_power_range` with `py_ints=True`

```
sage: timeit("prime_power_range(1000,py_ints=True)", number=4000)
4000 loops, best of 3: 14.6 µs per loop
sage:  timeit("prime_power_range(5000,py_ints=True)", number=2000)
2000 loops, best of 3: 33.9 µs per loop
```



---

archive/issue_comments_278593.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,18 @@\n-The cythonization of `prime_powers` is much faster (around x4 in the timings). We introduce in a new function `prime_power_range` in `fast_arith.pyx` that is similar to `prime_range`.\n+This ticket introduces several changes:\n+- introduce a method `next_prime_power` for integers\n+- make `prime_powers` an iterator (using `next_prime_power`) so that it can be used for large integers as well\n+- create a much faster cythonized `prime_power_range`\n+\n+We get a little speed down for the iteration over `prime_powers` but we can now do\n+\n+```\n+sage: for p in prime_powers(2**100, 2**100+500):\n+....:     print p\n+1267650600228229401496703205376\n+1267650600228229401496703205653\n+1267650600228229401496703205707\n+1267650600228229401496703205823\n+```\n+The cython function `prime_power_range` is much faster than the previous `prime_powers` (around x4 in the timings).\n \n Since #16878, 1 is not a prime power anymore! So we fix `prime_powers` to never return 1 in its output.\n``````\n",
    "created_at": "2014-08-31T09:44:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278593",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,18 @@
-The cythonization of `prime_powers` is much faster (around x4 in the timings). We introduce in a new function `prime_power_range` in `fast_arith.pyx` that is similar to `prime_range`.
+This ticket introduces several changes:
+- introduce a method `next_prime_power` for integers
+- make `prime_powers` an iterator (using `next_prime_power`) so that it can be used for large integers as well
+- create a much faster cythonized `prime_power_range`
+
+We get a little speed down for the iteration over `prime_powers` but we can now do
+
+```
+sage: for p in prime_powers(2**100, 2**100+500):
+....:     print p
+1267650600228229401496703205376
+1267650600228229401496703205653
+1267650600228229401496703205707
+1267650600228229401496703205823
+```
+The cython function `prime_power_range` is much faster than the previous `prime_powers` (around x4 in the timings).
 
 Since #16878, 1 is not a prime power anymore! So we fix `prime_powers` to never return 1 in its output.
``````




---

archive/issue_events_063860.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "rename": {
        "from": "prime_power_range",
        "to": "prime_powers and prime_power_range"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16880#event-63860"
}
```



---

archive/issue_comments_278594.json:
```json
{
    "body": "<a id='comment:9'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                          |                                                 |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------|\n|[e3be1ce](https://github.com/sagemath/sagetrac-mirror/commit/e3be1ce5b13d007baf6982e1b94a2299c68744c1)|`trac #16880: prime_powers and prime_power_range`|",
    "created_at": "2014-08-31T09:44:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278594",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                          |                                                 |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------|
|[e3be1ce](https://github.com/sagemath/sagetrac-mirror/commit/e3be1ce5b13d007baf6982e1b94a2299c68744c1)|`trac #16880: prime_powers and prime_power_range`|



---

archive/issue_comments_278595.json:
```json
{
    "body": "Changing commit from \"a3195f7bb4e16cc4eb3f3ae4ef58a4b5d0341ad2\" to \"e3be1ce5b13d007baf6982e1b94a2299c68744c1\"",
    "created_at": "2014-08-31T09:44:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278595",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "a3195f7bb4e16cc4eb3f3ae4ef58a4b5d0341ad2" to "e3be1ce5b13d007baf6982e1b94a2299c68744c1"



---

archive/issue_comments_278596.json:
```json
{
    "body": "<a id='comment:10'></a>\nIt looks more natural to me to follow what `primes` and `prime_range` do... this is what I did in e3be1ce.\n\nVincent",
    "created_at": "2014-08-31T09:45:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278596",
    "user": "https://github.com/videlec"
}
```

<a id='comment:10'></a>
It looks more natural to me to follow what `primes` and `prime_range` do... this is what I did in e3be1ce.

Vincent



---

archive/issue_comments_278597.json:
```json
{
    "body": "<a id='comment:11'></a>\nNeeds rebase.",
    "created_at": "2015-03-09T09:30:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278597",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>
Needs rebase.



---

archive/issue_events_063861.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-03-09T09:30:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "milestone": "sage-6.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16880#event-63861"
}
```



---

archive/issue_comments_278598.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-03-09T09:30:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278598",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_278599.json:
```json
{
    "body": "Changing dependencies from \"#16878\" to \"#16878, #17852\"",
    "created_at": "2015-03-09T10:03:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278599",
    "user": "https://github.com/jdemeyer"
}
```

Changing dependencies from "#16878" to "#16878, #17852"



---

archive/issue_comments_278600.json:
```json
{
    "body": "<a id='comment:13'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n|                                                                                                                                          |                                               |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------|\n|[b365b9e](https://github.com/sagemath/sagetrac-mirror/commit/b365b9ed18aec68ce34fe2e8c01e30031df8792f)|`trac #17852: fix binomial(n,0) for negative n`|\n|[faed0c0](https://github.com/sagemath/sagetrac-mirror/commit/faed0c082f75a312072cd89b9c68ee3c28ed2d9c)|`trac #17852: remove lcm on rationals (category takes care)`|\n|[cbbb06f](https://github.com/sagemath/sagetrac-mirror/commit/cbbb06fa27b0b9178ad3f9d0de3dc3235c5ec1c3)|`trac #17852: make a reference to the symbolic binomial`|\n|[1655367](https://github.com/sagemath/sagetrac-mirror/commit/1655367faec5cdca8cc7b580f7c7f7e22905858c)|`trac #17852: replace powermod_ui by hash in the doc`|\n|[d401269](https://github.com/sagemath/sagetrac-mirror/commit/d40126995abbc7dcb7e484b3d628a5196ea026d0)|`trac #17852: fix output type of arith.binomial`|\n|[8fc6b3d](https://github.com/sagemath/sagetrac-mirror/commit/8fc6b3da7c26d5ff4695991c26d67e38b3c1f103)|`trac #17852: type -> parent`|\n|[61b94c2](https://github.com/sagemath/sagetrac-mirror/commit/61b94c202141bf164d87bae24912c687553b7869)|`trac #17852: fix curious failing doctest in  multi_polynomial_ideal`|\n|[6697e68](https://github.com/sagemath/sagetrac-mirror/commit/6697e686ab123c65b147e03c8df1b3969ea548fa)|`trac #17852: be nicer on non-integral domains`|\n|[2260680](https://github.com/sagemath/sagetrac-mirror/commit/2260680a81f19b47202401109a7ec10f59e32d50)|`trac #17852: merge beta-6.6`|\n|[25176c5](https://github.com/sagemath/sagetrac-mirror/commit/25176c520e538f0a98334c7ffdfe69c14207b32d)|`trac #16880: cleanup for prime and prime powers`|",
    "created_at": "2015-03-21T17:07:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278600",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
|                                                                                                                                          |                                               |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------|
|[b365b9e](https://github.com/sagemath/sagetrac-mirror/commit/b365b9ed18aec68ce34fe2e8c01e30031df8792f)|`trac #17852: fix binomial(n,0) for negative n`|
|[faed0c0](https://github.com/sagemath/sagetrac-mirror/commit/faed0c082f75a312072cd89b9c68ee3c28ed2d9c)|`trac #17852: remove lcm on rationals (category takes care)`|
|[cbbb06f](https://github.com/sagemath/sagetrac-mirror/commit/cbbb06fa27b0b9178ad3f9d0de3dc3235c5ec1c3)|`trac #17852: make a reference to the symbolic binomial`|
|[1655367](https://github.com/sagemath/sagetrac-mirror/commit/1655367faec5cdca8cc7b580f7c7f7e22905858c)|`trac #17852: replace powermod_ui by hash in the doc`|
|[d401269](https://github.com/sagemath/sagetrac-mirror/commit/d40126995abbc7dcb7e484b3d628a5196ea026d0)|`trac #17852: fix output type of arith.binomial`|
|[8fc6b3d](https://github.com/sagemath/sagetrac-mirror/commit/8fc6b3da7c26d5ff4695991c26d67e38b3c1f103)|`trac #17852: type -> parent`|
|[61b94c2](https://github.com/sagemath/sagetrac-mirror/commit/61b94c202141bf164d87bae24912c687553b7869)|`trac #17852: fix curious failing doctest in  multi_polynomial_ideal`|
|[6697e68](https://github.com/sagemath/sagetrac-mirror/commit/6697e686ab123c65b147e03c8df1b3969ea548fa)|`trac #17852: be nicer on non-integral domains`|
|[2260680](https://github.com/sagemath/sagetrac-mirror/commit/2260680a81f19b47202401109a7ec10f59e32d50)|`trac #17852: merge beta-6.6`|
|[25176c5](https://github.com/sagemath/sagetrac-mirror/commit/25176c520e538f0a98334c7ffdfe69c14207b32d)|`trac #16880: cleanup for prime and prime powers`|



---

archive/issue_comments_278601.json:
```json
{
    "body": "Changing commit from \"e3be1ce5b13d007baf6982e1b94a2299c68744c1\" to \"25176c520e538f0a98334c7ffdfe69c14207b32d\"",
    "created_at": "2015-03-21T17:07:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278601",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e3be1ce5b13d007baf6982e1b94a2299c68744c1" to "25176c520e538f0a98334c7ffdfe69c14207b32d"



---

archive/issue_comments_278602.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,18 +1,5 @@\n-This ticket introduces several changes:\n-- introduce a method `next_prime_power` for integers\n-- make `prime_powers` an iterator (using `next_prime_power`) so that it can be used for large integers as well\n-- create a much faster cythonized `prime_power_range`\n-\n-We get a little speed down for the iteration over `prime_powers` but we can now do\n-\n-```\n-sage: for p in prime_powers(2**100, 2**100+500):\n-....:     print p\n-1267650600228229401496703205376\n-1267650600228229401496703205653\n-1267650600228229401496703205707\n-1267650600228229401496703205823\n-```\n-The cython function `prime_power_range` is much faster than the previous `prime_powers` (around x4 in the timings).\n-\n-Since #16878, 1 is not a prime power anymore! So we fix `prime_powers` to never return 1 in its output.\n+In this ticket we:\n+- introduce methods `previous_prime`, `next_prime_power`, `previous_prime_power` for integers\n+- split `prime_range` in `rings/fast_arith.pyx` into two subfunctions and optimize them\n+- create a faster cythonized `prime_power_range` and propose two implementations for `arith.prime_powers`\n+- add `rings/fast_arith.pyx` to the documentation\n``````\n",
    "created_at": "2015-03-21T17:10:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278602",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,18 +1,5 @@
-This ticket introduces several changes:
-- introduce a method `next_prime_power` for integers
-- make `prime_powers` an iterator (using `next_prime_power`) so that it can be used for large integers as well
-- create a much faster cythonized `prime_power_range`
-
-We get a little speed down for the iteration over `prime_powers` but we can now do
-
-```
-sage: for p in prime_powers(2**100, 2**100+500):
-....:     print p
-1267650600228229401496703205376
-1267650600228229401496703205653
-1267650600228229401496703205707
-1267650600228229401496703205823
-```
-The cython function `prime_power_range` is much faster than the previous `prime_powers` (around x4 in the timings).
-
-Since #16878, 1 is not a prime power anymore! So we fix `prime_powers` to never return 1 in its output.
+In this ticket we:
+- introduce methods `previous_prime`, `next_prime_power`, `previous_prime_power` for integers
+- split `prime_range` in `rings/fast_arith.pyx` into two subfunctions and optimize them
+- create a faster cythonized `prime_power_range` and propose two implementations for `arith.prime_powers`
+- add `rings/fast_arith.pyx` to the documentation
``````




---

archive/issue_comments_278603.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-03-21T17:10:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278603",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_events_063862.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "rename": {
        "from": "prime_powers and prime_power_range",
        "to": "further cleanup in arith.py/integer.pyx"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16880#event-63862"
}
```



---

archive/issue_comments_278604.json:
```json
{
    "body": "Changing commit from \"25176c520e538f0a98334c7ffdfe69c14207b32d\" to \"b3cfd3cce04b352ee86b7b84c3880f0c5d5829e9\"",
    "created_at": "2015-03-21T18:08:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278604",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "25176c520e538f0a98334c7ffdfe69c14207b32d" to "b3cfd3cce04b352ee86b7b84c3880f0c5d5829e9"



---

archive/issue_comments_278605.json:
```json
{
    "body": "<a id='comment:15'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                                  |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------|\n|[b3cfd3c](https://github.com/sagemath/sagetrac-mirror/commit/b3cfd3cce04b352ee86b7b84c3880f0c5d5829e9)|`trac 16880: fix doctest related to random_primes`|",
    "created_at": "2015-03-21T18:08:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278605",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                                  |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------|
|[b3cfd3c](https://github.com/sagemath/sagetrac-mirror/commit/b3cfd3cce04b352ee86b7b84c3880f0c5d5829e9)|`trac 16880: fix doctest related to random_primes`|



---

archive/issue_events_063863.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-25T10:50:55Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "milestone": "sage-6.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16880#event-63863"
}
```



---

archive/issue_events_063864.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-25T10:50:55Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "milestone": "sage-6.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16880#event-63864"
}
```



---

archive/issue_comments_278606.json:
```json
{
    "body": "Changing dependencies from \"#16878, #17852\" to \"\"",
    "created_at": "2015-04-25T10:50:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278606",
    "user": "https://github.com/videlec"
}
```

Changing dependencies from "#16878, #17852" to ""



---

archive/issue_comments_278607.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1 @@\n-In this ticket we:\n-- introduce methods `previous_prime`, `next_prime_power`, `previous_prime_power` for integers\n-- split `prime_range` in `rings/fast_arith.pyx` into two subfunctions and optimize them\n-- create a faster cythonized `prime_power_range` and propose two implementations for `arith.prime_powers`\n-- add `rings/fast_arith.pyx` to the documentation\n+In this ticket we add three methods to integers: `previous_prime` (calling pari `precprime`), `next_prime_power` and `previous_prime_power`. We also make changes in `sage.rings.arith` to call these (faster) methods.\n``````\n",
    "created_at": "2015-04-25T10:50:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278607",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1 @@
-In this ticket we:
-- introduce methods `previous_prime`, `next_prime_power`, `previous_prime_power` for integers
-- split `prime_range` in `rings/fast_arith.pyx` into two subfunctions and optimize them
-- create a faster cythonized `prime_power_range` and propose two implementations for `arith.prime_powers`
-- add `rings/fast_arith.pyx` to the documentation
+In this ticket we add three methods to integers: `previous_prime` (calling pari `precprime`), `next_prime_power` and `previous_prime_power`. We also make changes in `sage.rings.arith` to call these (faster) methods.
``````




---

archive/issue_events_063865.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "rename": {
        "from": "further cleanup in arith.py/integer.pyx",
        "to": "previous_prime, previous_prime_power, next_prime_power"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16880#event-63865"
}
```



---

archive/issue_comments_278608.json:
```json
{
    "body": "<a id='comment:17'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                          |                                                        |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------|\n|[d85a98c](https://github.com/sagemath/sagetrac-mirror/commit/d85a98ccbbe34c2abc032c7bc18efe9af67c95e1)|`Trac 16880: previous_prime/{next,previous}_prime_power`|\n|[db1e869](https://github.com/sagemath/sagetrac-mirror/commit/db1e869640dbb20d39e565970aaa8c5d58fa8953)|`Trac 16880: make rings.arith uses the new methods`|",
    "created_at": "2015-04-25T10:51:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278608",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                          |                                                        |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------|
|[d85a98c](https://github.com/sagemath/sagetrac-mirror/commit/d85a98ccbbe34c2abc032c7bc18efe9af67c95e1)|`Trac 16880: previous_prime/{next,previous}_prime_power`|
|[db1e869](https://github.com/sagemath/sagetrac-mirror/commit/db1e869640dbb20d39e565970aaa8c5d58fa8953)|`Trac 16880: make rings.arith uses the new methods`|



---

archive/issue_comments_278609.json:
```json
{
    "body": "Changing commit from \"b3cfd3cce04b352ee86b7b84c3880f0c5d5829e9\" to \"db1e869640dbb20d39e565970aaa8c5d58fa8953\"",
    "created_at": "2015-04-25T10:51:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278609",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "b3cfd3cce04b352ee86b7b84c3880f0c5d5829e9" to "db1e869640dbb20d39e565970aaa8c5d58fa8953"



---

archive/issue_comments_278610.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n In this ticket we add three methods to integers: `previous_prime` (calling pari `precprime`), `next_prime_power` and `previous_prime_power`. We also make changes in `sage.rings.arith` to call these (faster) methods.\n+\n+Follow up: #18298 and #18299\n``````\n",
    "created_at": "2015-04-25T11:20:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278610",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,3 @@
 In this ticket we add three methods to integers: `previous_prime` (calling pari `precprime`), `next_prime_power` and `previous_prime_power`. We also make changes in `sage.rings.arith` to call these (faster) methods.
+
+Follow up: #18298 and #18299
``````




---

archive/issue_comments_278611.json:
```json
{
    "body": "<a id='comment:18'></a>\nI split the other parts to different tickets: #18298 and #18299.",
    "created_at": "2015-04-25T11:20:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278611",
    "user": "https://github.com/videlec"
}
```

<a id='comment:18'></a>
I split the other parts to different tickets: #18298 and #18299.



---

archive/issue_comments_278612.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,23 @@\n In this ticket we add three methods to integers: `previous_prime` (calling pari `precprime`), `next_prime_power` and `previous_prime_power`. We also make changes in `sage.rings.arith` to call these (faster) methods.\n \n+Timings on the current version (sage-6.7.beta2)\n+\n+```\n+sage: timeit(\"for i in range(200): next_prime_power(i)\", number=5000, repeat=10)\n+5000 loops, best of 10: 311 \u00b5s per loop\n+sage: a = 33622489\n+sage: timeit(\"next_prime_power(a)\", number=5000, repeat=10)\n+5000 loops, best of 10: 53.6 \u00b5s per loop\n+```\n+\n+Timings with the branch applied\n+\n+```\n+sage: timeit(\"for i in range(200): next_prime_power(i)\", number=5000, repeat=10)\n+5000 loops, best of 10: 184 \u00b5s per loop\n+sage: a = 33622489\n+sage: timeit(\"next_prime_power(a)\", number=5000, repeat=10)\n+5000 loops, best of 10: 16.9 \u00b5s per loop\n+```\n+\n Follow up: #18298 and #18299\n``````\n",
    "created_at": "2015-04-25T13:30:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278612",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,23 @@
 In this ticket we add three methods to integers: `previous_prime` (calling pari `precprime`), `next_prime_power` and `previous_prime_power`. We also make changes in `sage.rings.arith` to call these (faster) methods.
 
+Timings on the current version (sage-6.7.beta2)
+
+```
+sage: timeit("for i in range(200): next_prime_power(i)", number=5000, repeat=10)
+5000 loops, best of 10: 311 µs per loop
+sage: a = 33622489
+sage: timeit("next_prime_power(a)", number=5000, repeat=10)
+5000 loops, best of 10: 53.6 µs per loop
+```
+
+Timings with the branch applied
+
+```
+sage: timeit("for i in range(200): next_prime_power(i)", number=5000, repeat=10)
+5000 loops, best of 10: 184 µs per loop
+sage: a = 33622489
+sage: timeit("next_prime_power(a)", number=5000, repeat=10)
+5000 loops, best of 10: 16.9 µs per loop
+```
+
 Follow up: #18298 and #18299
``````




---

archive/issue_comments_278613.json:
```json
{
    "body": "<a id='comment:20'></a>\n1. I don't know if `lesser or equal than` is proper English. How about `less than or equal to`?\n\n2. `PARI` instead of `Pari`.\n\n3. In `next_prime_power` and `previous_prime_power`, a small optimization is possible: you can replace\n\n```\nmpz_set(n.value, self.value)\nmpz_add_ui(n.value, n.value, 1)\n```\nby\n\n```\nmpz_add_ui(n.value, self.value, 1)\n```\n\nand in `next_prime_power`, replace\n\n```\nif mpz_cmp_ui(n.value, 2) < 0:\n    mpz_set_ui(n.value, 2)\n    return n\n```\nby\n\n```\nif mpz_cmp_ui(self.value, 2) < 0:\n    return smallInteger(2)\n```\n\n4. Another algorithmic comment for `next_prime_power` (an analogous comment holds for `previous_prime_power`): instead of computing the next power of 2 and doing\n\n```\nwhile mpz_cmp(m.value, n.value) == 1:\n```\nI would instead check if `mpz_sizeinbase(n.value, 2)` increases during the loop. In that case, we know that we skipped a power of 2.",
    "created_at": "2015-04-28T09:11:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278613",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'></a>
1. I don't know if `lesser or equal than` is proper English. How about `less than or equal to`?

2. `PARI` instead of `Pari`.

3. In `next_prime_power` and `previous_prime_power`, a small optimization is possible: you can replace

```
mpz_set(n.value, self.value)
mpz_add_ui(n.value, n.value, 1)
```
by

```
mpz_add_ui(n.value, self.value, 1)
```

and in `next_prime_power`, replace

```
if mpz_cmp_ui(n.value, 2) < 0:
    mpz_set_ui(n.value, 2)
    return n
```
by

```
if mpz_cmp_ui(self.value, 2) < 0:
    return smallInteger(2)
```

4. Another algorithmic comment for `next_prime_power` (an analogous comment holds for `previous_prime_power`): instead of computing the next power of 2 and doing

```
while mpz_cmp(m.value, n.value) == 1:
```
I would instead check if `mpz_sizeinbase(n.value, 2)` increases during the loop. In that case, we know that we skipped a power of 2.



---

archive/issue_comments_278614.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-04-28T09:11:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278614",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_278615.json:
```json
{
    "body": "<a id='comment:22'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                         |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------|\n|[1e09561](https://github.com/sagemath/sagetrac-mirror/commit/1e0956157ef8f49bc19eb145dc60589f8e59587a)|`Trac 16880: optimization + Pari -> PARI`|",
    "created_at": "2015-04-28T10:44:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278615",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                         |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------|
|[1e09561](https://github.com/sagemath/sagetrac-mirror/commit/1e0956157ef8f49bc19eb145dc60589f8e59587a)|`Trac 16880: optimization + Pari -> PARI`|



---

archive/issue_comments_278616.json:
```json
{
    "body": "Changing commit from \"db1e869640dbb20d39e565970aaa8c5d58fa8953\" to \"1e0956157ef8f49bc19eb145dc60589f8e59587a\"",
    "created_at": "2015-04-28T10:44:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278616",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "db1e869640dbb20d39e565970aaa8c5d58fa8953" to "1e0956157ef8f49bc19eb145dc60589f8e59587a"



---

archive/issue_comments_278617.json:
```json
{
    "body": "<a id='comment:23'></a>\nReplying to [jdemeyer](#comment%3A20):\n \n> 4. Another algorithmic comment for `next_prime_power` (an analogous comment holds for `previous_prime_power`): instead of computing the next power of 2 and doing\n> \n> ```\n> while mpz_cmp(m.value, n.value) == 1:\n> ```\n> I would instead check if `mpz_sizeinbase(n.value, 2)` increases during the loop. In that case, we know that we skipped a power of 2.\n\n\nI used `mpz_tstbit` instead. Should be the fastest.\n\nPotential micro optimization that would need to use `mpn_*` functions\n- the call to `mpz_sizeinbase` can be replaced by `mpn_count_leading_zeros` and some arithmetic\n- we can avoid a useless bit shift in `mpz_tstbit` by only considering the `&` with the most significant limb. Moreover, the allocation of the limbs will not change inside the loop. So we can already use the good pointer to the concerned limb.\n\nI think this is too much for a naive algorithm...",
    "created_at": "2015-04-28T10:54:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278617",
    "user": "https://github.com/videlec"
}
```

<a id='comment:23'></a>
Replying to [jdemeyer](#comment%3A20):
 
> 4. Another algorithmic comment for `next_prime_power` (an analogous comment holds for `previous_prime_power`): instead of computing the next power of 2 and doing
> 
> ```
> while mpz_cmp(m.value, n.value) == 1:
> ```
> I would instead check if `mpz_sizeinbase(n.value, 2)` increases during the loop. In that case, we know that we skipped a power of 2.


I used `mpz_tstbit` instead. Should be the fastest.

Potential micro optimization that would need to use `mpn_*` functions
- the call to `mpz_sizeinbase` can be replaced by `mpn_count_leading_zeros` and some arithmetic
- we can avoid a useless bit shift in `mpz_tstbit` by only considering the `&` with the most significant limb. Moreover, the allocation of the limbs will not change inside the loop. So we can already use the good pointer to the concerned limb.

I think this is too much for a naive algorithm...



---

archive/issue_comments_278618.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-04-28T10:54:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278618",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_278619.json:
```json
{
    "body": "<a id='comment:24'></a>\n`skept` -> `skipped`\n\nThis should be moved *after* the comparison with 2 (and `self` should be compared with 2):\n\n```\ncdef Integer n = PY_NEW(Integer)\n```\n\nAnother simplification that I missed: you can skip the block\n\n```\n    if mpz_even_p(n.value):\n    if n.is_prime_power(proof=proof):\n    return n\n    mpz_add_ui(n.value, n.value, 1)\n```\nif you instead just add 2 if `self` was odd:\n\n```\nmpz_add_ui(n.value, self.value, 1 if mpz_even_p(self.value) else 2)\n```\n\nThen the `bit_index` should be based on the value of `self`, such that the check works correctly if `self` was `2^n - 1`.",
    "created_at": "2015-04-28T11:20:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278619",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:24'></a>
`skept` -> `skipped`

This should be moved *after* the comparison with 2 (and `self` should be compared with 2):

```
cdef Integer n = PY_NEW(Integer)
```

Another simplification that I missed: you can skip the block

```
    if mpz_even_p(n.value):
    if n.is_prime_power(proof=proof):
    return n
    mpz_add_ui(n.value, n.value, 1)
```
if you instead just add 2 if `self` was odd:

```
mpz_add_ui(n.value, self.value, 1 if mpz_even_p(self.value) else 2)
```

Then the `bit_index` should be based on the value of `self`, such that the check works correctly if `self` was `2^n - 1`.



---

archive/issue_comments_278620.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Jeroen Demeyer\"",
    "created_at": "2015-04-28T11:20:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278620",
    "user": "https://github.com/jdemeyer"
}
```

Changing reviewer from "" to "Jeroen Demeyer"



---

archive/issue_comments_278621.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-04-28T11:20:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278621",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_278622.json:
```json
{
    "body": "Changing commit from \"1e0956157ef8f49bc19eb145dc60589f8e59587a\" to \"35c0211766537e6769cd060ed528ad9d77e60068\"",
    "created_at": "2015-04-28T11:51:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278622",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "1e0956157ef8f49bc19eb145dc60589f8e59587a" to "35c0211766537e6769cd060ed528ad9d77e60068"



---

archive/issue_comments_278623.json:
```json
{
    "body": "<a id='comment:25'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                          |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------|\n|[35c0211](https://github.com/sagemath/sagetrac-mirror/commit/35c0211766537e6769cd060ed528ad9d77e60068)|`Trac 16880: optimization`|",
    "created_at": "2015-04-28T11:51:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278623",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                          |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------|
|[35c0211](https://github.com/sagemath/sagetrac-mirror/commit/35c0211766537e6769cd060ed528ad9d77e60068)|`Trac 16880: optimization`|



---

archive/issue_comments_278624.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-04-28T11:52:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278624",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_278625.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-04-28T15:24:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278625",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_063866.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-29T03:13:45Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16880#event-63866"
}
```



---

archive/issue_comments_278626.json:
```json
{
    "body": "Changing branch from \"u/vdelecroix/16880\" to \"35c0211766537e6769cd060ed528ad9d77e60068\"",
    "created_at": "2015-04-29T03:13:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278626",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/vdelecroix/16880" to "35c0211766537e6769cd060ed528ad9d77e60068"



---

archive/issue_comments_278627.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-04-29T03:13:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278627",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_278628.json:
```json
{
    "body": "Changing commit from \"35c0211766537e6769cd060ed528ad9d77e60068\" to \"\"",
    "created_at": "2015-05-06T07:16:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278628",
    "user": "https://github.com/nexttime"
}
```

Changing commit from "35c0211766537e6769cd060ed528ad9d77e60068" to ""



---

archive/issue_comments_278629.json:
```json
{
    "body": "<a id='comment:29'></a>\nSome copy/paste accidents (could probably be corrected on the follow-ups):\n\n```\n+    def previous_prime(self, proof=None):\n+        r\"\"\"\n+        Returns the previous prime before self.\n+\n+        This method calls the PARI ``precprime`` function.\n+\n+        INPUT:\n+\n+        - ``proof`` - if ``True`` ensure that the returned value is the next\n+          prime power and if set to ``False`` uses probabilistic methods\n+          (i.e. the result is not guaranteed). By default it uses global\n+          configuration variables to determine which alternative to use (see\n+          :mod:`proof.arithmetic` or :mod:`sage.structure.proof`).\n```\n\n```\n+    def previous_prime_power(self, proof=None):\n+        r\"\"\"\n+        Return the previous prime power before self.\n+\n+        INPUT:\n+\n+        - ``proof`` - if ``True`` ensure that the returned value is the next\n+          prime power and if set to ``False`` uses probabilistic methods\n+          (i.e. the result is not guaranteed). By default it uses global\n+          configuration variables to determine which alternative to use (see\n+          :mod:`proof.arithmetic` or :mod:`sage.structure.proof`).\n```",
    "created_at": "2015-05-06T07:16:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278629",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:29'></a>
Some copy/paste accidents (could probably be corrected on the follow-ups):

```
+    def previous_prime(self, proof=None):
+        r"""
+        Returns the previous prime before self.
+
+        This method calls the PARI ``precprime`` function.
+
+        INPUT:
+
+        - ``proof`` - if ``True`` ensure that the returned value is the next
+          prime power and if set to ``False`` uses probabilistic methods
+          (i.e. the result is not guaranteed). By default it uses global
+          configuration variables to determine which alternative to use (see
+          :mod:`proof.arithmetic` or :mod:`sage.structure.proof`).
```

```
+    def previous_prime_power(self, proof=None):
+        r"""
+        Return the previous prime power before self.
+
+        INPUT:
+
+        - ``proof`` - if ``True`` ensure that the returned value is the next
+          prime power and if set to ``False`` uses probabilistic methods
+          (i.e. the result is not guaranteed). By default it uses global
+          configuration variables to determine which alternative to use (see
+          :mod:`proof.arithmetic` or :mod:`sage.structure.proof`).
```



---

archive/issue_comments_278630.json:
```json
{
    "body": "<a id='comment:30'></a>\nReplying to [leif](#comment%3A29):\n> Some copy/paste accidents (could probably be corrected on the follow-ups):\n\n\nHa right.",
    "created_at": "2015-05-06T07:18:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16880#issuecomment-278630",
    "user": "https://github.com/videlec"
}
```

<a id='comment:30'></a>
Replying to [leif](#comment%3A29):
> Some copy/paste accidents (could probably be corrected on the follow-ups):


Ha right.
