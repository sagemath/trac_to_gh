# Issue 16880: previous_prime, previous_prime_power, next_prime_power

archive/issues_016643.json:
```json
{
    "assignees": [],
    "body": "In this ticket we add three methods to integers: `previous_prime` (calling pari `precprime`), `next_prime_power` and `previous_prime_power`. We also make changes in `sage.rings.arith` to call these (faster) methods.\n\nTimings on the current version (sage-6.7.beta2)\n\n```\nsage: timeit(\"for i in range(200): next_prime_power(i)\", number=5000, repeat=10)\n5000 loops, best of 10: 311 \u00b5s per loop\nsage: a = 33622489\nsage: timeit(\"next_prime_power(a)\", number=5000, repeat=10)\n5000 loops, best of 10: 53.6 \u00b5s per loop\n```\n\nTimings with the branch applied\n\n```\nsage: timeit(\"for i in range(200): next_prime_power(i)\", number=5000, repeat=10)\n5000 loops, best of 10: 184 \u00b5s per loop\nsage: a = 33622489\nsage: timeit(\"next_prime_power(a)\", number=5000, repeat=10)\n5000 loops, best of 10: 16.9 \u00b5s per loop\n```\n\nFollow up: #18298 and #18299\n\nCC:  @nathanncohen @jdemeyer\n\nBranch: **[`35c0211`](https://github.com/sagemath/sagetrac-mirror/commit/35c0211766537e6769cd060ed528ad9d77e60068)**\n\nReviewer: **Jeroen Demeyer**\n\nAuthor: **Vincent Delecroix**\n\nComponent: **number theory**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/16880_\n\n",
    "closed_at": "2015-04-29T03:13:45Z",
    "created_at": "2014-08-26T11:09:37Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20number%20theory",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.7",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "previous_prime, previous_prime_power, next_prime_power",
    "type": "issue",
    "updated_at": "2015-05-06T07:18:27Z",
    "url": "https://github.com/sagemath/sage/issues/16880",
    "user": "https://github.com/videlec"
}
```
In this ticket we add three methods to integers: `previous_prime` (calling pari `precprime`), `next_prime_power` and `previous_prime_power`. We also make changes in `sage.rings.arith` to call these (faster) methods.

Timings on the current version (sage-6.7.beta2)

```
sage: timeit("for i in range(200): next_prime_power(i)", number=5000, repeat=10)
5000 loops, best of 10: 311 µs per loop
sage: a = 33622489
sage: timeit("next_prime_power(a)", number=5000, repeat=10)
5000 loops, best of 10: 53.6 µs per loop
```

Timings with the branch applied

```
sage: timeit("for i in range(200): next_prime_power(i)", number=5000, repeat=10)
5000 loops, best of 10: 184 µs per loop
sage: a = 33622489
sage: timeit("next_prime_power(a)", number=5000, repeat=10)
5000 loops, best of 10: 16.9 µs per loop
```

Follow up: #18298 and #18299

CC:  @nathanncohen @jdemeyer

Branch: **[`35c0211`](https://github.com/sagemath/sagetrac-mirror/commit/35c0211766537e6769cd060ed528ad9d77e60068)**

Reviewer: **Jeroen Demeyer**

Author: **Vincent Delecroix**

Component: **number theory**

_Issue created by migration from https://trac.sagemath.org/ticket/16880_





---

archive/issue_events_241297.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2014-08-26T11:09:37Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16880#event-241297"
}
```



---

archive/issue_events_241298.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2014-08-26T11:09:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20number%20theory",
    "label_color": "0000ff",
    "label_name": "c: number theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16880#event-241298"
}
```



---

archive/issue_events_241299.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2014-08-26T11:09:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16880#event-241299"
}
```



---

archive/issue_events_241300.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2014-08-26T11:09:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16880#event-241300"
}
```



---

archive/issue_comments_222161.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\n+1 for \"primes\"",
    "created_at": "2014-08-26T11:29:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16880#issuecomment-222161",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:1" align="right">comment:1</div>

+1 for "primes"



---

archive/issue_comments_222162.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,7 @@\n-The cythonization of `prime_powers` is much faster (around x4 in the timings). We also introduce the keyword `py_ints` as in `prime_range` in order to be able to use Python int instead of Sage integers.\n+The cythonization of `prime_powers` is much faster (around x4 in the timings). We introduce in a new function `prime_power_range` in `fast_arith.pyx` (that also has a keyword `py_ints` as `prime_range`).\n \n-Note: I do not like the convention that the name are different `prime_powers` vs `prime_range`... why not using `primes` or `prime_power_range`?\n+Note: naming conventions are crazy... right now there are:\n+- `primes`: iterator over prime numbers\n+- `prime_range`: return the list of the first prime (fast implementation in Cython but only handles integer up to `LONG_MAX` and require memory)\n+- `prime_powers`: return the list of prime powers!\n+It seems to me that in Sage we tend to have `X_iterator` for iterator and `Xs` for the list of objects...\n``````\n",
    "created_at": "2014-08-26T11:54:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16880#issuecomment-222162",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,7 @@
-The cythonization of `prime_powers` is much faster (around x4 in the timings). We also introduce the keyword `py_ints` as in `prime_range` in order to be able to use Python int instead of Sage integers.
+The cythonization of `prime_powers` is much faster (around x4 in the timings). We introduce in a new function `prime_power_range` in `fast_arith.pyx` (that also has a keyword `py_ints` as `prime_range`).
 
-Note: I do not like the convention that the name are different `prime_powers` vs `prime_range`... why not using `primes` or `prime_power_range`?
+Note: naming conventions are crazy... right now there are:
+- `primes`: iterator over prime numbers
+- `prime_range`: return the list of the first prime (fast implementation in Cython but only handles integer up to `LONG_MAX` and require memory)
+- `prime_powers`: return the list of prime powers!
+It seems to me that in Sage we tend to have `X_iterator` for iterator and `Xs` for the list of objects...
``````




---

archive/issue_comments_222163.json:
```json
{
    "body": "Branch: **[u/vdelecroix/16880](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/16880)**",
    "created_at": "2014-08-26T11:54:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16880#issuecomment-222163",
    "user": "https://github.com/videlec"
}
```

Branch: **[u/vdelecroix/16880](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/16880)**



---

archive/issue_events_241301.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2014-08-26T11:54:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16880#event-241301"
}
```



---

archive/issue_comments_222164.json:
```json
{
    "body": "Commit: **[`6c6cbe2`](https://github.com/sagemath/sagetrac-mirror/commit/6c6cbe25b41dece8513ad3527c68415517328710)**",
    "created_at": "2014-08-26T12:01:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16880#issuecomment-222164",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[`6c6cbe2`](https://github.com/sagemath/sagetrac-mirror/commit/6c6cbe25b41dece8513ad3527c68415517328710)**



---

archive/issue_comments_222165.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nBranch pushed to git repo; I updated commit sha1. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1d103da9fc0cc1629750e421a07cdfed4b94b040\"><code>1d103da</code></a></td><td><code>Trac 15767: fix doctest in Ser()</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/62ca8211de7d43d0686edf0d77f55a23aaeee5c7\"><code>62ca821</code></a></td><td><code>Trac 15767: explain application of Sturm's theorem</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bf435f8db1537f63c001894fb4949879617b71f2\"><code>bf435f8</code></a></td><td><code>Merge tag '6.4.beta1' into ticket/15767</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6e9f686d323671a4927cdc081cf7b473e6d356fe\"><code>6e9f686</code></a></td><td><code>trac #16878: faster is_prime</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d7dc38918903a97af742a90050ce87c58f6f222a\"><code>d7dc389</code></a></td><td><code>trac #16878: review</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/175d6b5fd339989df12ec9c1f26d3b0d7e6dd82c\"><code>175d6b5</code></a></td><td><code>trac #16878: review 2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d55dc6737936077eeee903687207f7af54588439\"><code>d55dc67</code></a></td><td><code>trac #16878: bikeshedding</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f73bd87b6850f626ae9d6da896fb730f3ae759c1\"><code>f73bd87</code></a></td><td><code>trac #16869: fast prime_powers</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8259a7d2951366c5c715e8080ce96106e1e7e14a\"><code>8259a7d</code></a></td><td><code>trac #16869: fix prime_powers(0,1)</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6c6cbe25b41dece8513ad3527c68415517328710\"><code>6c6cbe2</code></a></td><td><code>trac #16880: implement prime_power_range</code></td></tr></table>\n",
    "created_at": "2014-08-26T12:01:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16880#issuecomment-222165",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:3"></div>

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1d103da9fc0cc1629750e421a07cdfed4b94b040"><code>1d103da</code></a></td><td><code>Trac 15767: fix doctest in Ser()</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/62ca8211de7d43d0686edf0d77f55a23aaeee5c7"><code>62ca821</code></a></td><td><code>Trac 15767: explain application of Sturm's theorem</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bf435f8db1537f63c001894fb4949879617b71f2"><code>bf435f8</code></a></td><td><code>Merge tag '6.4.beta1' into ticket/15767</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6e9f686d323671a4927cdc081cf7b473e6d356fe"><code>6e9f686</code></a></td><td><code>trac #16878: faster is_prime</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d7dc38918903a97af742a90050ce87c58f6f222a"><code>d7dc389</code></a></td><td><code>trac #16878: review</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/175d6b5fd339989df12ec9c1f26d3b0d7e6dd82c"><code>175d6b5</code></a></td><td><code>trac #16878: review 2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d55dc6737936077eeee903687207f7af54588439"><code>d55dc67</code></a></td><td><code>trac #16878: bikeshedding</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f73bd87b6850f626ae9d6da896fb730f3ae759c1"><code>f73bd87</code></a></td><td><code>trac #16869: fast prime_powers</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8259a7d2951366c5c715e8080ce96106e1e7e14a"><code>8259a7d</code></a></td><td><code>trac #16869: fix prime_powers(0,1)</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6c6cbe25b41dece8513ad3527c68415517328710"><code>6c6cbe2</code></a></td><td><code>trac #16880: implement prime_power_range</code></td></tr></table>




---

archive/issue_comments_222166.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e7b94588ee7ecb82c00afa48f905622f5c374cdd\"><code>e7b9458</code></a></td><td><code>trac #16880: prime_power_range</code></td></tr></table>\n",
    "created_at": "2014-08-28T20:23:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16880#issuecomment-222166",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e7b94588ee7ecb82c00afa48f905622f5c374cdd"><code>e7b9458</code></a></td><td><code>trac #16880: prime_power_range</code></td></tr></table>




---

archive/issue_comments_222167.json:
```json
{
    "body": "Changed commit from **[`6c6cbe2`](https://github.com/sagemath/sagetrac-mirror/commit/6c6cbe25b41dece8513ad3527c68415517328710)** to **[`e7b9458`](https://github.com/sagemath/sagetrac-mirror/commit/e7b94588ee7ecb82c00afa48f905622f5c374cdd)**",
    "created_at": "2014-08-28T20:23:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16880#issuecomment-222167",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6c6cbe2`](https://github.com/sagemath/sagetrac-mirror/commit/6c6cbe25b41dece8513ad3527c68415517328710)** to **[`e7b9458`](https://github.com/sagemath/sagetrac-mirror/commit/e7b94588ee7ecb82c00afa48f905622f5c374cdd)**



---

archive/issue_comments_222168.json:
```json
{
    "body": "Changed dependencies from **#16869, #16878** to none",
    "created_at": "2014-08-28T20:25:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16880#issuecomment-222168",
    "user": "https://github.com/videlec"
}
```

Changed dependencies from **#16869, #16878** to none



---

archive/issue_comments_222169.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nRebased on 6.4.beta2, no dependency anymore...\n\nVincent",
    "created_at": "2014-08-28T20:25:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16880#issuecomment-222169",
    "user": "https://github.com/videlec"
}
```

<div id="comment:5" align="right">comment:5</div>

Rebased on 6.4.beta2, no dependency anymore...

Vincent



---

archive/issue_events_241302.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2014-08-28T20:25:27Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "title_is": "prime_power_range",
    "title_was": "even faster prime_powers",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16880#event-241302"
}
```



---

archive/issue_comments_222170.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,7 +1 @@\n The cythonization of `prime_powers` is much faster (around x4 in the timings). We introduce in a new function `prime_power_range` in `fast_arith.pyx` (that also has a keyword `py_ints` as `prime_range`).\n-\n-Note: naming conventions are crazy... right now there are:\n-- `primes`: iterator over prime numbers\n-- `prime_range`: return the list of the first prime (fast implementation in Cython but only handles integer up to `LONG_MAX` and require memory)\n-- `prime_powers`: return the list of prime powers!\n-It seems to me that in Sage we tend to have `X_iterator` for iterator and `Xs` for the list of objects...\n``````\n",
    "created_at": "2014-08-28T20:25:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16880#issuecomment-222170",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,7 +1 @@
 The cythonization of `prime_powers` is much faster (around x4 in the timings). We introduce in a new function `prime_power_range` in `fast_arith.pyx` (that also has a keyword `py_ints` as `prime_range`).
-
-Note: naming conventions are crazy... right now there are:
-- `primes`: iterator over prime numbers
-- `prime_range`: return the list of the first prime (fast implementation in Cython but only handles integer up to `LONG_MAX` and require memory)
-- `prime_powers`: return the list of prime powers!
-It seems to me that in Sage we tend to have `X_iterator` for iterator and `Xs` for the list of objects...
``````




---

archive/issue_comments_222171.json:
```json
{
    "body": "Changed commit from **[`e7b9458`](https://github.com/sagemath/sagetrac-mirror/commit/e7b94588ee7ecb82c00afa48f905622f5c374cdd)** to **[`a3195f7`](https://github.com/sagemath/sagetrac-mirror/commit/a3195f7bb4e16cc4eb3f3ae4ef58a4b5d0341ad2)**",
    "created_at": "2014-08-30T16:36:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16880#issuecomment-222171",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e7b9458`](https://github.com/sagemath/sagetrac-mirror/commit/e7b94588ee7ecb82c00afa48f905622f5c374cdd)** to **[`a3195f7`](https://github.com/sagemath/sagetrac-mirror/commit/a3195f7bb4e16cc4eb3f3ae4ef58a4b5d0341ad2)**



---

archive/issue_comments_222172.json:
```json
{
    "body": "<div id=\"comment:6\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6e9f686d323671a4927cdc081cf7b473e6d356fe\"><code>6e9f686</code></a></td><td><code>trac #16878: faster is_prime</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d7dc38918903a97af742a90050ce87c58f6f222a\"><code>d7dc389</code></a></td><td><code>trac #16878: review</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/175d6b5fd339989df12ec9c1f26d3b0d7e6dd82c\"><code>175d6b5</code></a></td><td><code>trac #16878: review 2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d55dc6737936077eeee903687207f7af54588439\"><code>d55dc67</code></a></td><td><code>trac #16878: bikeshedding</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7f6132188b7ddafd97630aaf721875f9d60a7106\"><code>7f61321</code></a></td><td><code>Reorganize is_prime_power() and next_prime() logic</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5937af54afa0562007d710c495ecd0f1160f7498\"><code>5937af5</code></a></td><td><code>Sloane considers 1 to be a prime power</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f0d716fd34029f65d0be0aa45d5cb1783f8da2f5\"><code>f0d716f</code></a></td><td><code>trac #16878: certificate flag in is_prime_power</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bfd69d3b188a8ec36ab373b4e958b54c74b64d2b\"><code>bfd69d3</code></a></td><td><code>is_prime_power() reviewer fixes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9e04c7a060a739ca9933a8f599524e63cf5d070c\"><code>9e04c7a</code></a></td><td><code>trac #16880: merge #16878 (faster is_prime)</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a3195f7bb4e16cc4eb3f3ae4ef58a4b5d0341ad2\"><code>a3195f7</code></a></td><td><code>trac #16880: prime_power_range</code></td></tr></table>\n",
    "created_at": "2014-08-30T16:36:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16880#issuecomment-222172",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:6"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6e9f686d323671a4927cdc081cf7b473e6d356fe"><code>6e9f686</code></a></td><td><code>trac #16878: faster is_prime</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d7dc38918903a97af742a90050ce87c58f6f222a"><code>d7dc389</code></a></td><td><code>trac #16878: review</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/175d6b5fd339989df12ec9c1f26d3b0d7e6dd82c"><code>175d6b5</code></a></td><td><code>trac #16878: review 2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d55dc6737936077eeee903687207f7af54588439"><code>d55dc67</code></a></td><td><code>trac #16878: bikeshedding</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7f6132188b7ddafd97630aaf721875f9d60a7106"><code>7f61321</code></a></td><td><code>Reorganize is_prime_power() and next_prime() logic</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5937af54afa0562007d710c495ecd0f1160f7498"><code>5937af5</code></a></td><td><code>Sloane considers 1 to be a prime power</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f0d716fd34029f65d0be0aa45d5cb1783f8da2f5"><code>f0d716f</code></a></td><td><code>trac #16878: certificate flag in is_prime_power</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bfd69d3b188a8ec36ab373b4e958b54c74b64d2b"><code>bfd69d3</code></a></td><td><code>is_prime_power() reviewer fixes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9e04c7a060a739ca9933a8f599524e63cf5d070c"><code>9e04c7a</code></a></td><td><code>trac #16880: merge #16878 (faster is_prime)</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a3195f7bb4e16cc4eb3f3ae4ef58a4b5d0341ad2"><code>a3195f7</code></a></td><td><code>trac #16880: prime_power_range</code></td></tr></table>




---

archive/issue_comments_222173.json:
```json
{
    "body": "Dependencies: **#16878**",
    "created_at": "2014-08-30T16:39:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16880#issuecomment-222173",
    "user": "https://github.com/videlec"
}
```

Dependencies: **#16878**



---

archive/issue_comments_222174.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n-The cythonization of `prime_powers` is much faster (around x4 in the timings). We introduce in a new function `prime_power_range` in `fast_arith.pyx` (that also has a keyword `py_ints` as `prime_range`).\n+The cythonization of `prime_powers` is much faster (around x4 in the timings). We introduce in a new function `prime_power_range` in `fast_arith.pyx` that is similar to `prime_range`.\n+\n+Since #16878, 1 is not a prime power anymore! So we fix `prime_powers` to never return 1 in its output.\n``````\n",
    "created_at": "2014-08-30T16:39:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16880#issuecomment-222174",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,3 @@
-The cythonization of `prime_powers` is much faster (around x4 in the timings). We introduce in a new function `prime_power_range` in `fast_arith.pyx` (that also has a keyword `py_ints` as `prime_range`).
+The cythonization of `prime_powers` is much faster (around x4 in the timings). We introduce in a new function `prime_power_range` in `fast_arith.pyx` that is similar to `prime_range`.
+
+Since #16878, 1 is not a prime power anymore! So we fix `prime_powers` to never return 1 in its output.
``````




---

archive/issue_comments_222175.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nAnd with timings\n\nusing `prime_powers` (EDIT: only for commit at a3195f7 and not at e3be1ce)\n\n```\nsage: timeit(\"prime_powers(1000)\", number=4000)\n4000 loops, best of 3: 86.7 \u00b5s per loop\nsage: timeit(\"prime_powers(5000)\", number=2000)\n2000 loops, best of 3: 314 \u00b5s per loop\n```\n\nusing `prime_power_range` instead\n\n```\nsage: timeit(\"prime_power_range(1000)\", number=4000)\n4000 loops, best of 3: 17.6 \u00b5s per loop\nsage:  timeit(\"prime_power_range(5000)\", number=2000)\n2000 loops, best of 3: 72.3 \u00b5s per loop\n```\n\nusing `prime_power_range` with `py_ints=True`\n\n```\nsage: timeit(\"prime_power_range(1000,py_ints=True)\", number=4000)\n4000 loops, best of 3: 14.6 \u00b5s per loop\nsage:  timeit(\"prime_power_range(5000,py_ints=True)\", number=2000)\n2000 loops, best of 3: 33.9 \u00b5s per loop\n```",
    "created_at": "2014-08-30T16:39:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16880#issuecomment-222175",
    "user": "https://github.com/videlec"
}
```

<div id="comment:7" align="right">comment:7</div>

And with timings

using `prime_powers` (EDIT: only for commit at a3195f7 and not at e3be1ce)

```
sage: timeit("prime_powers(1000)", number=4000)
4000 loops, best of 3: 86.7 µs per loop
sage: timeit("prime_powers(5000)", number=2000)
2000 loops, best of 3: 314 µs per loop
```

using `prime_power_range` instead

```
sage: timeit("prime_power_range(1000)", number=4000)
4000 loops, best of 3: 17.6 µs per loop
sage:  timeit("prime_power_range(5000)", number=2000)
2000 loops, best of 3: 72.3 µs per loop
```

using `prime_power_range` with `py_ints=True`

```
sage: timeit("prime_power_range(1000,py_ints=True)", number=4000)
4000 loops, best of 3: 14.6 µs per loop
sage:  timeit("prime_power_range(5000,py_ints=True)", number=2000)
2000 loops, best of 3: 33.9 µs per loop
```



---

archive/issue_comments_222176.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,18 @@\n-The cythonization of `prime_powers` is much faster (around x4 in the timings). We introduce in a new function `prime_power_range` in `fast_arith.pyx` that is similar to `prime_range`.\n+This ticket introduces several changes:\n+- introduce a method `next_prime_power` for integers\n+- make `prime_powers` an iterator (using `next_prime_power`) so that it can be used for large integers as well\n+- create a much faster cythonized `prime_power_range`\n+\n+We get a little speed down for the iteration over `prime_powers` but we can now do\n+\n+```\n+sage: for p in prime_powers(2**100, 2**100+500):\n+....:     print p\n+1267650600228229401496703205376\n+1267650600228229401496703205653\n+1267650600228229401496703205707\n+1267650600228229401496703205823\n+```\n+The cython function `prime_power_range` is much faster than the previous `prime_powers` (around x4 in the timings).\n \n Since #16878, 1 is not a prime power anymore! So we fix `prime_powers` to never return 1 in its output.\n``````\n",
    "created_at": "2014-08-31T09:44:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16880#issuecomment-222176",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,18 @@
-The cythonization of `prime_powers` is much faster (around x4 in the timings). We introduce in a new function `prime_power_range` in `fast_arith.pyx` that is similar to `prime_range`.
+This ticket introduces several changes:
+- introduce a method `next_prime_power` for integers
+- make `prime_powers` an iterator (using `next_prime_power`) so that it can be used for large integers as well
+- create a much faster cythonized `prime_power_range`
+
+We get a little speed down for the iteration over `prime_powers` but we can now do
+
+```
+sage: for p in prime_powers(2**100, 2**100+500):
+....:     print p
+1267650600228229401496703205376
+1267650600228229401496703205653
+1267650600228229401496703205707
+1267650600228229401496703205823
+```
+The cython function `prime_power_range` is much faster than the previous `prime_powers` (around x4 in the timings).
 
 Since #16878, 1 is not a prime power anymore! So we fix `prime_powers` to never return 1 in its output.
``````




---

archive/issue_events_241303.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2014-08-31T09:44:06Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "title_is": "prime_powers and prime_power_range",
    "title_was": "prime_power_range",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16880#event-241303"
}
```



---

archive/issue_comments_222177.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e3be1ce5b13d007baf6982e1b94a2299c68744c1\"><code>e3be1ce</code></a></td><td><code>trac #16880: prime_powers and prime_power_range</code></td></tr></table>\n",
    "created_at": "2014-08-31T09:44:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16880#issuecomment-222177",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e3be1ce5b13d007baf6982e1b94a2299c68744c1"><code>e3be1ce</code></a></td><td><code>trac #16880: prime_powers and prime_power_range</code></td></tr></table>




---

archive/issue_comments_222178.json:
```json
{
    "body": "Changed commit from **[`a3195f7`](https://github.com/sagemath/sagetrac-mirror/commit/a3195f7bb4e16cc4eb3f3ae4ef58a4b5d0341ad2)** to **[`e3be1ce`](https://github.com/sagemath/sagetrac-mirror/commit/e3be1ce5b13d007baf6982e1b94a2299c68744c1)**",
    "created_at": "2014-08-31T09:44:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16880#issuecomment-222178",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a3195f7`](https://github.com/sagemath/sagetrac-mirror/commit/a3195f7bb4e16cc4eb3f3ae4ef58a4b5d0341ad2)** to **[`e3be1ce`](https://github.com/sagemath/sagetrac-mirror/commit/e3be1ce5b13d007baf6982e1b94a2299c68744c1)**



---

archive/issue_comments_222179.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nIt looks more natural to me to follow what `primes` and `prime_range` do... this is what I did in e3be1ce.\n\nVincent",
    "created_at": "2014-08-31T09:45:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16880#issuecomment-222179",
    "user": "https://github.com/videlec"
}
```

<div id="comment:10" align="right">comment:10</div>

It looks more natural to me to follow what `primes` and `prime_range` do... this is what I did in e3be1ce.

Vincent



---

archive/issue_comments_222180.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nNeeds rebase.",
    "created_at": "2015-03-09T09:30:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16880#issuecomment-222180",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:11" align="right">comment:11</div>

Needs rebase.



---

archive/issue_events_241304.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-03-09T09:30:21Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16880#event-241304"
}
```



---

archive/issue_events_241305.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-03-09T09:30:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "milestone_number": null,
    "milestone_title": "sage-6.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16880#event-241305"
}
```



---

archive/issue_events_241306.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-03-09T09:30:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16880#event-241306"
}
```



---

archive/issue_events_241307.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-03-09T09:30:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16880#event-241307"
}
```



---

archive/issue_comments_222181.json:
```json
{
    "body": "Changed dependencies from **#16878** to **#16878, #17852**",
    "created_at": "2015-03-09T10:03:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16880#issuecomment-222181",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#16878** to **#16878, #17852**



---

archive/issue_comments_222182.json:
```json
{
    "body": "<div id=\"comment:13\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b365b9ed18aec68ce34fe2e8c01e30031df8792f\"><code>b365b9e</code></a></td><td><code>trac #17852: fix binomial(n,0) for negative n</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/faed0c082f75a312072cd89b9c68ee3c28ed2d9c\"><code>faed0c0</code></a></td><td><code>trac #17852: remove lcm on rationals (category takes care)</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cbbb06fa27b0b9178ad3f9d0de3dc3235c5ec1c3\"><code>cbbb06f</code></a></td><td><code>trac #17852: make a reference to the symbolic binomial</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1655367faec5cdca8cc7b580f7c7f7e22905858c\"><code>1655367</code></a></td><td><code>trac #17852: replace powermod_ui by hash in the doc</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d40126995abbc7dcb7e484b3d628a5196ea026d0\"><code>d401269</code></a></td><td><code>trac #17852: fix output type of arith.binomial</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8fc6b3da7c26d5ff4695991c26d67e38b3c1f103\"><code>8fc6b3d</code></a></td><td><code>trac #17852: type -> parent</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/61b94c202141bf164d87bae24912c687553b7869\"><code>61b94c2</code></a></td><td><code>trac #17852: fix curious failing doctest in  multi_polynomial_ideal</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6697e686ab123c65b147e03c8df1b3969ea548fa\"><code>6697e68</code></a></td><td><code>trac #17852: be nicer on non-integral domains</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2260680a81f19b47202401109a7ec10f59e32d50\"><code>2260680</code></a></td><td><code>trac #17852: merge beta-6.6</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/25176c520e538f0a98334c7ffdfe69c14207b32d\"><code>25176c5</code></a></td><td><code>trac #16880: cleanup for prime and prime powers</code></td></tr></table>\n",
    "created_at": "2015-03-21T17:07:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16880#issuecomment-222182",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:13"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b365b9ed18aec68ce34fe2e8c01e30031df8792f"><code>b365b9e</code></a></td><td><code>trac #17852: fix binomial(n,0) for negative n</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/faed0c082f75a312072cd89b9c68ee3c28ed2d9c"><code>faed0c0</code></a></td><td><code>trac #17852: remove lcm on rationals (category takes care)</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cbbb06fa27b0b9178ad3f9d0de3dc3235c5ec1c3"><code>cbbb06f</code></a></td><td><code>trac #17852: make a reference to the symbolic binomial</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1655367faec5cdca8cc7b580f7c7f7e22905858c"><code>1655367</code></a></td><td><code>trac #17852: replace powermod_ui by hash in the doc</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d40126995abbc7dcb7e484b3d628a5196ea026d0"><code>d401269</code></a></td><td><code>trac #17852: fix output type of arith.binomial</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8fc6b3da7c26d5ff4695991c26d67e38b3c1f103"><code>8fc6b3d</code></a></td><td><code>trac #17852: type -> parent</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/61b94c202141bf164d87bae24912c687553b7869"><code>61b94c2</code></a></td><td><code>trac #17852: fix curious failing doctest in  multi_polynomial_ideal</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6697e686ab123c65b147e03c8df1b3969ea548fa"><code>6697e68</code></a></td><td><code>trac #17852: be nicer on non-integral domains</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2260680a81f19b47202401109a7ec10f59e32d50"><code>2260680</code></a></td><td><code>trac #17852: merge beta-6.6</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/25176c520e538f0a98334c7ffdfe69c14207b32d"><code>25176c5</code></a></td><td><code>trac #16880: cleanup for prime and prime powers</code></td></tr></table>




---

archive/issue_comments_222183.json:
```json
{
    "body": "Changed commit from **[`e3be1ce`](https://github.com/sagemath/sagetrac-mirror/commit/e3be1ce5b13d007baf6982e1b94a2299c68744c1)** to **[`25176c5`](https://github.com/sagemath/sagetrac-mirror/commit/25176c520e538f0a98334c7ffdfe69c14207b32d)**",
    "created_at": "2015-03-21T17:07:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16880#issuecomment-222183",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e3be1ce`](https://github.com/sagemath/sagetrac-mirror/commit/e3be1ce5b13d007baf6982e1b94a2299c68744c1)** to **[`25176c5`](https://github.com/sagemath/sagetrac-mirror/commit/25176c520e538f0a98334c7ffdfe69c14207b32d)**



---

archive/issue_comments_222184.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,18 +1,5 @@\n-This ticket introduces several changes:\n-- introduce a method `next_prime_power` for integers\n-- make `prime_powers` an iterator (using `next_prime_power`) so that it can be used for large integers as well\n-- create a much faster cythonized `prime_power_range`\n-\n-We get a little speed down for the iteration over `prime_powers` but we can now do\n-\n-```\n-sage: for p in prime_powers(2**100, 2**100+500):\n-....:     print p\n-1267650600228229401496703205376\n-1267650600228229401496703205653\n-1267650600228229401496703205707\n-1267650600228229401496703205823\n-```\n-The cython function `prime_power_range` is much faster than the previous `prime_powers` (around x4 in the timings).\n-\n-Since #16878, 1 is not a prime power anymore! So we fix `prime_powers` to never return 1 in its output.\n+In this ticket we:\n+- introduce methods `previous_prime`, `next_prime_power`, `previous_prime_power` for integers\n+- split `prime_range` in `rings/fast_arith.pyx` into two subfunctions and optimize them\n+- create a faster cythonized `prime_power_range` and propose two implementations for `arith.prime_powers`\n+- add `rings/fast_arith.pyx` to the documentation\n``````\n",
    "created_at": "2015-03-21T17:10:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16880#issuecomment-222184",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,18 +1,5 @@
-This ticket introduces several changes:
-- introduce a method `next_prime_power` for integers
-- make `prime_powers` an iterator (using `next_prime_power`) so that it can be used for large integers as well
-- create a much faster cythonized `prime_power_range`
-
-We get a little speed down for the iteration over `prime_powers` but we can now do
-
-```
-sage: for p in prime_powers(2**100, 2**100+500):
-....:     print p
-1267650600228229401496703205376
-1267650600228229401496703205653
-1267650600228229401496703205707
-1267650600228229401496703205823
-```
-The cython function `prime_power_range` is much faster than the previous `prime_powers` (around x4 in the timings).
-
-Since #16878, 1 is not a prime power anymore! So we fix `prime_powers` to never return 1 in its output.
+In this ticket we:
+- introduce methods `previous_prime`, `next_prime_power`, `previous_prime_power` for integers
+- split `prime_range` in `rings/fast_arith.pyx` into two subfunctions and optimize them
+- create a faster cythonized `prime_power_range` and propose two implementations for `arith.prime_powers`
+- add `rings/fast_arith.pyx` to the documentation
``````




---

archive/issue_events_241308.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-03-21T17:10:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16880#event-241308"
}
```



---

archive/issue_events_241309.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-03-21T17:10:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16880#event-241309"
}
```



---

archive/issue_events_241310.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-03-21T17:10:11Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "title_is": "further cleanup in arith.py/integer.pyx",
    "title_was": "prime_powers and prime_power_range",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16880#event-241310"
}
```



---

archive/issue_comments_222185.json:
```json
{
    "body": "Changed commit from **[`25176c5`](https://github.com/sagemath/sagetrac-mirror/commit/25176c520e538f0a98334c7ffdfe69c14207b32d)** to **[`b3cfd3c`](https://github.com/sagemath/sagetrac-mirror/commit/b3cfd3cce04b352ee86b7b84c3880f0c5d5829e9)**",
    "created_at": "2015-03-21T18:08:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16880#issuecomment-222185",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`25176c5`](https://github.com/sagemath/sagetrac-mirror/commit/25176c520e538f0a98334c7ffdfe69c14207b32d)** to **[`b3cfd3c`](https://github.com/sagemath/sagetrac-mirror/commit/b3cfd3cce04b352ee86b7b84c3880f0c5d5829e9)**



---

archive/issue_comments_222186.json:
```json
{
    "body": "<div id=\"comment:15\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b3cfd3cce04b352ee86b7b84c3880f0c5d5829e9\"><code>b3cfd3c</code></a></td><td><code>trac 16880: fix doctest related to random_primes</code></td></tr></table>\n",
    "created_at": "2015-03-21T18:08:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16880#issuecomment-222186",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:15"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b3cfd3cce04b352ee86b7b84c3880f0c5d5829e9"><code>b3cfd3c</code></a></td><td><code>trac 16880: fix doctest related to random_primes</code></td></tr></table>




---

archive/issue_events_241311.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-25T10:50:55Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "milestone_number": null,
    "milestone_title": "sage-6.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16880#event-241311"
}
```



---

archive/issue_events_241312.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-25T10:50:55Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "milestone_number": null,
    "milestone_title": "sage-6.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16880#event-241312"
}
```



---

archive/issue_comments_222187.json:
```json
{
    "body": "Changed dependencies from **#16878, #17852** to none",
    "created_at": "2015-04-25T10:50:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16880#issuecomment-222187",
    "user": "https://github.com/videlec"
}
```

Changed dependencies from **#16878, #17852** to none



---

archive/issue_comments_222188.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1 @@\n-In this ticket we:\n-- introduce methods `previous_prime`, `next_prime_power`, `previous_prime_power` for integers\n-- split `prime_range` in `rings/fast_arith.pyx` into two subfunctions and optimize them\n-- create a faster cythonized `prime_power_range` and propose two implementations for `arith.prime_powers`\n-- add `rings/fast_arith.pyx` to the documentation\n+In this ticket we add three methods to integers: `previous_prime` (calling pari `precprime`), `next_prime_power` and `previous_prime_power`. We also make changes in `sage.rings.arith` to call these (faster) methods.\n``````\n",
    "created_at": "2015-04-25T10:50:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16880#issuecomment-222188",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1 @@
-In this ticket we:
-- introduce methods `previous_prime`, `next_prime_power`, `previous_prime_power` for integers
-- split `prime_range` in `rings/fast_arith.pyx` into two subfunctions and optimize them
-- create a faster cythonized `prime_power_range` and propose two implementations for `arith.prime_powers`
-- add `rings/fast_arith.pyx` to the documentation
+In this ticket we add three methods to integers: `previous_prime` (calling pari `precprime`), `next_prime_power` and `previous_prime_power`. We also make changes in `sage.rings.arith` to call these (faster) methods.
``````




---

archive/issue_events_241313.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-25T10:50:55Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "title_is": "previous_prime, previous_prime_power, next_prime_power",
    "title_was": "further cleanup in arith.py/integer.pyx",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16880#event-241313"
}
```



---

archive/issue_comments_222189.json:
```json
{
    "body": "<div id=\"comment:17\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d85a98ccbbe34c2abc032c7bc18efe9af67c95e1\"><code>d85a98c</code></a></td><td><code>Trac 16880: previous_prime/{next,previous}_prime_power</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/db1e869640dbb20d39e565970aaa8c5d58fa8953\"><code>db1e869</code></a></td><td><code>Trac 16880: make rings.arith uses the new methods</code></td></tr></table>\n",
    "created_at": "2015-04-25T10:51:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16880#issuecomment-222189",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:17"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d85a98ccbbe34c2abc032c7bc18efe9af67c95e1"><code>d85a98c</code></a></td><td><code>Trac 16880: previous_prime/{next,previous}_prime_power</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/db1e869640dbb20d39e565970aaa8c5d58fa8953"><code>db1e869</code></a></td><td><code>Trac 16880: make rings.arith uses the new methods</code></td></tr></table>




---

archive/issue_comments_222190.json:
```json
{
    "body": "Changed commit from **[`b3cfd3c`](https://github.com/sagemath/sagetrac-mirror/commit/b3cfd3cce04b352ee86b7b84c3880f0c5d5829e9)** to **[`db1e869`](https://github.com/sagemath/sagetrac-mirror/commit/db1e869640dbb20d39e565970aaa8c5d58fa8953)**",
    "created_at": "2015-04-25T10:51:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16880#issuecomment-222190",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b3cfd3c`](https://github.com/sagemath/sagetrac-mirror/commit/b3cfd3cce04b352ee86b7b84c3880f0c5d5829e9)** to **[`db1e869`](https://github.com/sagemath/sagetrac-mirror/commit/db1e869640dbb20d39e565970aaa8c5d58fa8953)**



---

archive/issue_comments_222191.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n In this ticket we add three methods to integers: `previous_prime` (calling pari `precprime`), `next_prime_power` and `previous_prime_power`. We also make changes in `sage.rings.arith` to call these (faster) methods.\n+\n+Follow up: #18298 and #18299\n``````\n",
    "created_at": "2015-04-25T11:20:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16880#issuecomment-222191",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,3 @@
 In this ticket we add three methods to integers: `previous_prime` (calling pari `precprime`), `next_prime_power` and `previous_prime_power`. We also make changes in `sage.rings.arith` to call these (faster) methods.
+
+Follow up: #18298 and #18299
``````




---

archive/issue_comments_222192.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nI split the other parts to different tickets: #18298 and #18299.",
    "created_at": "2015-04-25T11:20:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16880#issuecomment-222192",
    "user": "https://github.com/videlec"
}
```

<div id="comment:18" align="right">comment:18</div>

I split the other parts to different tickets: #18298 and #18299.



---

archive/issue_comments_222193.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,23 @@\n In this ticket we add three methods to integers: `previous_prime` (calling pari `precprime`), `next_prime_power` and `previous_prime_power`. We also make changes in `sage.rings.arith` to call these (faster) methods.\n \n+Timings on the current version (sage-6.7.beta2)\n+\n+```\n+sage: timeit(\"for i in range(200): next_prime_power(i)\", number=5000, repeat=10)\n+5000 loops, best of 10: 311 \u00b5s per loop\n+sage: a = 33622489\n+sage: timeit(\"next_prime_power(a)\", number=5000, repeat=10)\n+5000 loops, best of 10: 53.6 \u00b5s per loop\n+```\n+\n+Timings with the branch applied\n+\n+```\n+sage: timeit(\"for i in range(200): next_prime_power(i)\", number=5000, repeat=10)\n+5000 loops, best of 10: 184 \u00b5s per loop\n+sage: a = 33622489\n+sage: timeit(\"next_prime_power(a)\", number=5000, repeat=10)\n+5000 loops, best of 10: 16.9 \u00b5s per loop\n+```\n+\n Follow up: #18298 and #18299\n``````\n",
    "created_at": "2015-04-25T13:30:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16880#issuecomment-222193",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,23 @@
 In this ticket we add three methods to integers: `previous_prime` (calling pari `precprime`), `next_prime_power` and `previous_prime_power`. We also make changes in `sage.rings.arith` to call these (faster) methods.
 
+Timings on the current version (sage-6.7.beta2)
+
+```
+sage: timeit("for i in range(200): next_prime_power(i)", number=5000, repeat=10)
+5000 loops, best of 10: 311 µs per loop
+sage: a = 33622489
+sage: timeit("next_prime_power(a)", number=5000, repeat=10)
+5000 loops, best of 10: 53.6 µs per loop
+```
+
+Timings with the branch applied
+
+```
+sage: timeit("for i in range(200): next_prime_power(i)", number=5000, repeat=10)
+5000 loops, best of 10: 184 µs per loop
+sage: a = 33622489
+sage: timeit("next_prime_power(a)", number=5000, repeat=10)
+5000 loops, best of 10: 16.9 µs per loop
+```
+
 Follow up: #18298 and #18299
``````




---

archive/issue_comments_222194.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\n1. I don't know if `lesser or equal than` is proper English. How about `less than or equal to`?\n\n2. `PARI` instead of `Pari`.\n\n3. In `next_prime_power` and `previous_prime_power`, a small optimization is possible: you can replace\n\n```\nmpz_set(n.value, self.value)\nmpz_add_ui(n.value, n.value, 1)\n```\nby\n\n```\nmpz_add_ui(n.value, self.value, 1)\n```\n\nand in `next_prime_power`, replace\n\n```\nif mpz_cmp_ui(n.value, 2) < 0:\n    mpz_set_ui(n.value, 2)\n    return n\n```\nby\n\n```\nif mpz_cmp_ui(self.value, 2) < 0:\n    return smallInteger(2)\n```\n\n4. Another algorithmic comment for `next_prime_power` (an analogous comment holds for `previous_prime_power`): instead of computing the next power of 2 and doing\n\n```\nwhile mpz_cmp(m.value, n.value) == 1:\n```\nI would instead check if `mpz_sizeinbase(n.value, 2)` increases during the loop. In that case, we know that we skipped a power of 2.",
    "created_at": "2015-04-28T09:11:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16880#issuecomment-222194",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:20" align="right">comment:20</div>

1. I don't know if `lesser or equal than` is proper English. How about `less than or equal to`?

2. `PARI` instead of `Pari`.

3. In `next_prime_power` and `previous_prime_power`, a small optimization is possible: you can replace

```
mpz_set(n.value, self.value)
mpz_add_ui(n.value, n.value, 1)
```
by

```
mpz_add_ui(n.value, self.value, 1)
```

and in `next_prime_power`, replace

```
if mpz_cmp_ui(n.value, 2) < 0:
    mpz_set_ui(n.value, 2)
    return n
```
by

```
if mpz_cmp_ui(self.value, 2) < 0:
    return smallInteger(2)
```

4. Another algorithmic comment for `next_prime_power` (an analogous comment holds for `previous_prime_power`): instead of computing the next power of 2 and doing

```
while mpz_cmp(m.value, n.value) == 1:
```
I would instead check if `mpz_sizeinbase(n.value, 2)` increases during the loop. In that case, we know that we skipped a power of 2.



---

archive/issue_events_241314.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-28T09:11:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16880#event-241314"
}
```



---

archive/issue_events_241315.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-28T09:11:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16880#event-241315"
}
```



---

archive/issue_comments_222195.json:
```json
{
    "body": "<div id=\"comment:22\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1e0956157ef8f49bc19eb145dc60589f8e59587a\"><code>1e09561</code></a></td><td><code>Trac 16880: optimization + Pari -> PARI</code></td></tr></table>\n",
    "created_at": "2015-04-28T10:44:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16880#issuecomment-222195",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:22"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1e0956157ef8f49bc19eb145dc60589f8e59587a"><code>1e09561</code></a></td><td><code>Trac 16880: optimization + Pari -> PARI</code></td></tr></table>




---

archive/issue_comments_222196.json:
```json
{
    "body": "Changed commit from **[`db1e869`](https://github.com/sagemath/sagetrac-mirror/commit/db1e869640dbb20d39e565970aaa8c5d58fa8953)** to **[`1e09561`](https://github.com/sagemath/sagetrac-mirror/commit/1e0956157ef8f49bc19eb145dc60589f8e59587a)**",
    "created_at": "2015-04-28T10:44:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16880#issuecomment-222196",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`db1e869`](https://github.com/sagemath/sagetrac-mirror/commit/db1e869640dbb20d39e565970aaa8c5d58fa8953)** to **[`1e09561`](https://github.com/sagemath/sagetrac-mirror/commit/1e0956157ef8f49bc19eb145dc60589f8e59587a)**



---

archive/issue_comments_222197.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@jdemeyer](#comment:20):\n \n> 4. Another algorithmic comment for `next_prime_power` (an analogous comment holds for `previous_prime_power`): instead of computing the next power of 2 and doing\n> \n> ```\n> while mpz_cmp(m.value, n.value) == 1:\n> ```\n> I would instead check if `mpz_sizeinbase(n.value, 2)` increases during the loop. In that case, we know that we skipped a power of 2.\n\nI used `mpz_tstbit` instead. Should be the fastest.\n\nPotential micro optimization that would need to use `mpn_*` functions\n- the call to `mpz_sizeinbase` can be replaced by `mpn_count_leading_zeros` and some arithmetic\n- we can avoid a useless bit shift in `mpz_tstbit` by only considering the `&` with the most significant limb. Moreover, the allocation of the limbs will not change inside the loop. So we can already use the good pointer to the concerned limb.\n\nI think this is too much for a naive algorithm...",
    "created_at": "2015-04-28T10:54:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16880#issuecomment-222197",
    "user": "https://github.com/videlec"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@jdemeyer](#comment:20):
 
> 4. Another algorithmic comment for `next_prime_power` (an analogous comment holds for `previous_prime_power`): instead of computing the next power of 2 and doing
> 
> ```
> while mpz_cmp(m.value, n.value) == 1:
> ```
> I would instead check if `mpz_sizeinbase(n.value, 2)` increases during the loop. In that case, we know that we skipped a power of 2.

I used `mpz_tstbit` instead. Should be the fastest.

Potential micro optimization that would need to use `mpn_*` functions
- the call to `mpz_sizeinbase` can be replaced by `mpn_count_leading_zeros` and some arithmetic
- we can avoid a useless bit shift in `mpz_tstbit` by only considering the `&` with the most significant limb. Moreover, the allocation of the limbs will not change inside the loop. So we can already use the good pointer to the concerned limb.

I think this is too much for a naive algorithm...



---

archive/issue_events_241316.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-28T10:54:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16880#event-241316"
}
```



---

archive/issue_events_241317.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-28T10:54:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16880#event-241317"
}
```



---

archive/issue_comments_222198.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\n`skept` -> `skipped`\n\nThis should be moved *after* the comparison with 2 (and `self` should be compared with 2):\n\n```\ncdef Integer n = PY_NEW(Integer)\n```\n\nAnother simplification that I missed: you can skip the block\n\n```\n    if mpz_even_p(n.value):\n    if n.is_prime_power(proof=proof):\n    return n\n    mpz_add_ui(n.value, n.value, 1)\n```\nif you instead just add 2 if `self` was odd:\n\n```\nmpz_add_ui(n.value, self.value, 1 if mpz_even_p(self.value) else 2)\n```\n\nThen the `bit_index` should be based on the value of `self`, such that the check works correctly if `self` was `2^n - 1`.",
    "created_at": "2015-04-28T11:20:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16880#issuecomment-222198",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:24" align="right">comment:24</div>

`skept` -> `skipped`

This should be moved *after* the comparison with 2 (and `self` should be compared with 2):

```
cdef Integer n = PY_NEW(Integer)
```

Another simplification that I missed: you can skip the block

```
    if mpz_even_p(n.value):
    if n.is_prime_power(proof=proof):
    return n
    mpz_add_ui(n.value, n.value, 1)
```
if you instead just add 2 if `self` was odd:

```
mpz_add_ui(n.value, self.value, 1 if mpz_even_p(self.value) else 2)
```

Then the `bit_index` should be based on the value of `self`, such that the check works correctly if `self` was `2^n - 1`.



---

archive/issue_comments_222199.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2015-04-28T11:20:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16880#issuecomment-222199",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**



---

archive/issue_events_241318.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-28T11:20:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16880#event-241318"
}
```



---

archive/issue_events_241319.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-28T11:20:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16880#event-241319"
}
```



---

archive/issue_comments_222200.json:
```json
{
    "body": "Changed commit from **[`1e09561`](https://github.com/sagemath/sagetrac-mirror/commit/1e0956157ef8f49bc19eb145dc60589f8e59587a)** to **[`35c0211`](https://github.com/sagemath/sagetrac-mirror/commit/35c0211766537e6769cd060ed528ad9d77e60068)**",
    "created_at": "2015-04-28T11:51:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16880#issuecomment-222200",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`1e09561`](https://github.com/sagemath/sagetrac-mirror/commit/1e0956157ef8f49bc19eb145dc60589f8e59587a)** to **[`35c0211`](https://github.com/sagemath/sagetrac-mirror/commit/35c0211766537e6769cd060ed528ad9d77e60068)**



---

archive/issue_comments_222201.json:
```json
{
    "body": "<div id=\"comment:25\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/35c0211766537e6769cd060ed528ad9d77e60068\"><code>35c0211</code></a></td><td><code>Trac 16880: optimization</code></td></tr></table>\n",
    "created_at": "2015-04-28T11:51:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16880#issuecomment-222201",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:25"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/35c0211766537e6769cd060ed528ad9d77e60068"><code>35c0211</code></a></td><td><code>Trac 16880: optimization</code></td></tr></table>




---

archive/issue_events_241320.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-28T11:52:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16880#event-241320"
}
```



---

archive/issue_events_241321.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-04-28T11:52:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16880#event-241321"
}
```



---

archive/issue_events_241322.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-28T15:24:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16880#event-241322"
}
```



---

archive/issue_events_241323.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-28T15:24:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16880#event-241323"
}
```



---

archive/issue_events_241324.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-29T03:13:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16880#event-241324"
}
```



---

archive/issue_events_241325.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "106e79c5f52c7988b7108e30239a9ef52164a482",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2015-04-29T03:13:45Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16880#event-241325"
}
```



---

archive/issue_comments_222202.json:
```json
{
    "body": "Changed branch from **[u/vdelecroix/16880](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/16880)** to **[`35c0211`](https://github.com/sagemath/sagetrac-mirror/commit/35c0211766537e6769cd060ed528ad9d77e60068)**",
    "created_at": "2015-04-29T03:13:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16880#issuecomment-222202",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/vdelecroix/16880](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/16880)** to **[`35c0211`](https://github.com/sagemath/sagetrac-mirror/commit/35c0211766537e6769cd060ed528ad9d77e60068)**



---

archive/issue_comments_222203.json:
```json
{
    "body": "Changed commit from **[`35c0211`](https://github.com/sagemath/sagetrac-mirror/commit/35c0211766537e6769cd060ed528ad9d77e60068)** to none",
    "created_at": "2015-05-06T07:16:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16880#issuecomment-222203",
    "user": "https://github.com/nexttime"
}
```

Changed commit from **[`35c0211`](https://github.com/sagemath/sagetrac-mirror/commit/35c0211766537e6769cd060ed528ad9d77e60068)** to none



---

archive/issue_comments_222204.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nSome copy/paste accidents (could probably be corrected on the follow-ups):\n\n```\n+    def previous_prime(self, proof=None):\n+        r\"\"\"\n+        Returns the previous prime before self.\n+\n+        This method calls the PARI ``precprime`` function.\n+\n+        INPUT:\n+\n+        - ``proof`` - if ``True`` ensure that the returned value is the next\n+          prime power and if set to ``False`` uses probabilistic methods\n+          (i.e. the result is not guaranteed). By default it uses global\n+          configuration variables to determine which alternative to use (see\n+          :mod:`proof.arithmetic` or :mod:`sage.structure.proof`).\n```\n\n```\n+    def previous_prime_power(self, proof=None):\n+        r\"\"\"\n+        Return the previous prime power before self.\n+\n+        INPUT:\n+\n+        - ``proof`` - if ``True`` ensure that the returned value is the next\n+          prime power and if set to ``False`` uses probabilistic methods\n+          (i.e. the result is not guaranteed). By default it uses global\n+          configuration variables to determine which alternative to use (see\n+          :mod:`proof.arithmetic` or :mod:`sage.structure.proof`).\n```",
    "created_at": "2015-05-06T07:16:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16880#issuecomment-222204",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:29" align="right">comment:29</div>

Some copy/paste accidents (could probably be corrected on the follow-ups):

```
+    def previous_prime(self, proof=None):
+        r"""
+        Returns the previous prime before self.
+
+        This method calls the PARI ``precprime`` function.
+
+        INPUT:
+
+        - ``proof`` - if ``True`` ensure that the returned value is the next
+          prime power and if set to ``False`` uses probabilistic methods
+          (i.e. the result is not guaranteed). By default it uses global
+          configuration variables to determine which alternative to use (see
+          :mod:`proof.arithmetic` or :mod:`sage.structure.proof`).
```

```
+    def previous_prime_power(self, proof=None):
+        r"""
+        Return the previous prime power before self.
+
+        INPUT:
+
+        - ``proof`` - if ``True`` ensure that the returned value is the next
+          prime power and if set to ``False`` uses probabilistic methods
+          (i.e. the result is not guaranteed). By default it uses global
+          configuration variables to determine which alternative to use (see
+          :mod:`proof.arithmetic` or :mod:`sage.structure.proof`).
```



---

archive/issue_comments_222205.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nReplying to [@nexttime](#comment:29):\n> Some copy/paste accidents (could probably be corrected on the follow-ups):\n\nHa right.",
    "created_at": "2015-05-06T07:18:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16880",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16880#issuecomment-222205",
    "user": "https://github.com/videlec"
}
```

<div id="comment:30" align="right">comment:30</div>

Replying to [@nexttime](#comment:29):
> Some copy/paste accidents (could probably be corrected on the follow-ups):

Ha right.
