# Issue 16105: Stop linking everything to libntl

archive/issues_015868.json:
```json
{
    "body": "After upgrading to Sage 6.2.beta7:\n\n```\n(sage-sh) jdemeyer@tamiyo:sage-config$ ldd local/lib/python2.7/site-packages/sage/misc/readline_extra_commands.so\n        linux-vdso.so.1 (0x00007fffdfffa000)\n        libcsage.so => /usr/local/src/sage-config/local/lib/libcsage.so (0x00007f403d747000)\n        libreadline.so.6 => /usr/local/src/sage-config/local/lib/libreadline.so.6 (0x00007f403d500000)\n        libstdc++.so.6 => /usr/lib/gcc/x86_64-pc-linux-gnu/4.6.3/libstdc++.so.6 (0x00007f403d1c4000)\n        libntl.so.2 => not found\n        libpython2.7.so.1.0 => /usr/local/src/sage-config/local/lib/libpython2.7.so.1.0 (0x00007f403cde5000)\n        libpthread.so.0 => /lib64/libpthread.so.0 (0x00007f403cbc8000)\n        libc.so.6 => /lib64/libc.so.6 (0x00007f403c820000)\n        libntl.so.3 => /usr/local/src/sage-config/local/lib/libntl.so.3 (0x00007f403c459000)\n        libpari-gmp.so.4 => /usr/local/src/sage-config/local/lib/libpari-gmp.so.4 (0x00007f403bce9000)\n        libgmp.so.11 => /usr/local/src/sage-config/local/lib/libgmp.so.11 (0x00007f403ba7a000)\n        libm.so.6 => /lib64/libm.so.6 (0x00007f403b78b000)\n        libgcc_s.so.1 => /usr/lib/gcc/x86_64-pc-linux-gnu/4.6.3/libgcc_s.so.1 (0x00007f403b575000)\n        libtinfo.so.5 => /usr/local/src/sage-config/local/lib/libtinfo.so.5 (0x00007f403b340000)\n        /lib64/ld-linux-x86-64.so.2 (0x00007f403db66000)\n        libdl.so.2 => /lib64/libdl.so.2 (0x00007f403b13b000)\n        libutil.so.1 => /lib64/libutil.so.1 (0x00007f403af38000)\n        libgf2x.so.1 => /usr/local/src/sage-config/local/lib/libgf2x.so.1 (0x00007f403ad22000)\n```\nNote the missing `libntl.so.2` causing various kinds of problems.\n\nThe reason is that *every* Cython extension is compiled with `-lntl` (see `src/setup.py`), this should be fixed. This `-lntl` was added in\n\n```diff\ncommit 707bac8c37de8e320630c94d67d7154dd14e91da\nAuthor: William Stein <wstein@gmail.com>\nDate:   Mon Apr 9 18:43:36 2007 -0700\n\n    add -lntl to the build line for building SAGE extension modules; this avoids a warning on OS X.\n\ndiff --git a/src/setup.py b/src/setup.py\nindex 38c8ed4..b7e88fe 100644\n--- a/src/setup.py\n+++ b/src/setup.py\n@@ -573,7 +573,7 @@ if DEVEL:\n     #ext_modules.append(mpc)\n \n for m in ext_modules:\n-    m.libraries = ['csage'] + m.libraries + ['stdc++']\n+    m.libraries = ['csage'] + m.libraries + ['stdc++', 'ntl']\n     m.library_dirs += ['%s/lib' % SAGE_LOCAL]\n```\n\n**CC:**  @vbraun\n\n**Keywords:** ntl, crash\n\n**Branch:** [2770a55d98ddb44edb113207e00c502baf30acb6](https://github.com/sagemath/sagetrac-mirror/commit/2770a55d98ddb44edb113207e00c502baf30acb6)\n\n**Reviewer:** Volker Braun\n\n**Author:** Jeroen Demeyer\n\nIssue created by migration from https://trac.sagemath.org/ticket/16105\n\n",
    "closed_at": "2014-04-11T19:41:30Z",
    "created_at": "2014-04-09T05:43:06Z",
    "labels": [
        "component: build",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.2",
    "title": "Stop linking everything to libntl",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/16105",
    "user": "https://github.com/darijgr"
}
```
After upgrading to Sage 6.2.beta7:

```
(sage-sh) jdemeyer@tamiyo:sage-config$ ldd local/lib/python2.7/site-packages/sage/misc/readline_extra_commands.so
        linux-vdso.so.1 (0x00007fffdfffa000)
        libcsage.so => /usr/local/src/sage-config/local/lib/libcsage.so (0x00007f403d747000)
        libreadline.so.6 => /usr/local/src/sage-config/local/lib/libreadline.so.6 (0x00007f403d500000)
        libstdc++.so.6 => /usr/lib/gcc/x86_64-pc-linux-gnu/4.6.3/libstdc++.so.6 (0x00007f403d1c4000)
        libntl.so.2 => not found
        libpython2.7.so.1.0 => /usr/local/src/sage-config/local/lib/libpython2.7.so.1.0 (0x00007f403cde5000)
        libpthread.so.0 => /lib64/libpthread.so.0 (0x00007f403cbc8000)
        libc.so.6 => /lib64/libc.so.6 (0x00007f403c820000)
        libntl.so.3 => /usr/local/src/sage-config/local/lib/libntl.so.3 (0x00007f403c459000)
        libpari-gmp.so.4 => /usr/local/src/sage-config/local/lib/libpari-gmp.so.4 (0x00007f403bce9000)
        libgmp.so.11 => /usr/local/src/sage-config/local/lib/libgmp.so.11 (0x00007f403ba7a000)
        libm.so.6 => /lib64/libm.so.6 (0x00007f403b78b000)
        libgcc_s.so.1 => /usr/lib/gcc/x86_64-pc-linux-gnu/4.6.3/libgcc_s.so.1 (0x00007f403b575000)
        libtinfo.so.5 => /usr/local/src/sage-config/local/lib/libtinfo.so.5 (0x00007f403b340000)
        /lib64/ld-linux-x86-64.so.2 (0x00007f403db66000)
        libdl.so.2 => /lib64/libdl.so.2 (0x00007f403b13b000)
        libutil.so.1 => /lib64/libutil.so.1 (0x00007f403af38000)
        libgf2x.so.1 => /usr/local/src/sage-config/local/lib/libgf2x.so.1 (0x00007f403ad22000)
```
Note the missing `libntl.so.2` causing various kinds of problems.

The reason is that *every* Cython extension is compiled with `-lntl` (see `src/setup.py`), this should be fixed. This `-lntl` was added in

```diff
commit 707bac8c37de8e320630c94d67d7154dd14e91da
Author: William Stein <wstein@gmail.com>
Date:   Mon Apr 9 18:43:36 2007 -0700

    add -lntl to the build line for building SAGE extension modules; this avoids a warning on OS X.

diff --git a/src/setup.py b/src/setup.py
index 38c8ed4..b7e88fe 100644
--- a/src/setup.py
+++ b/src/setup.py
@@ -573,7 +573,7 @@ if DEVEL:
     #ext_modules.append(mpc)
 
 for m in ext_modules:
-    m.libraries = ['csage'] + m.libraries + ['stdc++']
+    m.libraries = ['csage'] + m.libraries + ['stdc++', 'ntl']
     m.library_dirs += ['%s/lib' % SAGE_LOCAL]
```

**CC:**  @vbraun

**Keywords:** ntl, crash

**Branch:** [2770a55d98ddb44edb113207e00c502baf30acb6](https://github.com/sagemath/sagetrac-mirror/commit/2770a55d98ddb44edb113207e00c502baf30acb6)

**Reviewer:** Volker Braun

**Author:** Jeroen Demeyer

Issue created by migration from https://trac.sagemath.org/ticket/16105





---

archive/issue_comments_207734.json:
```json
{
    "body": "<a id='comment:1'></a>\nSolution in https://groups.google.com/forum/?hl=en#!topic/sage-release/zxlHERyLUVU",
    "created_at": "2014-04-09T09:03:36Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207734",
    "user": "https://github.com/rwst"
}
```

<a id='comment:1'></a>
Solution in https://groups.google.com/forum/?hl=en#!topic/sage-release/zxlHERyLUVU



---

archive/issue_events_143463.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-04-09T09:03:36Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16105#event-143463"
}
```



---

archive/issue_events_143464.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-04-09T09:03:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "label": "invalid",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16105#event-143464"
}
```



---

archive/issue_events_143465.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-04-09T09:03:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16105#event-143465"
}
```



---

archive/issue_comments_207735.json:
```json
{
    "body": "<a id='comment:2'></a>\n\n```\nmake distclean && make\n```",
    "created_at": "2014-04-09T09:14:49Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207735",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:2'></a>

```
make distclean && make
```



---

archive/issue_comments_207736.json:
```json
{
    "body": "<a id='comment:3'></a>\nAh, thank you!\n\nHmm... any chance things like this could appear in the release notes? Or is it a system-dependent heisenbug?",
    "created_at": "2014-04-09T13:01:53Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207736",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:3'></a>
Ah, thank you!

Hmm... any chance things like this could appear in the release notes? Or is it a system-dependent heisenbug?



---

archive/issue_events_143466.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-04-11T09:40:37Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16105#event-143466"
}
```



---

archive/issue_events_143467.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-04-11T09:40:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16105#event-143467"
}
```



---

archive/issue_events_143468.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-04-11T09:40:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16105#event-143468"
}
```



---

archive/issue_events_143469.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-04-11T09:40:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "label": "critical",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16105#event-143469"
}
```



---

archive/issue_events_143470.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-04-11T09:40:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "label": "blocker",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16105#event-143470"
}
```



---

archive/issue_events_143471.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-04-11T09:40:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "label": "component: number theory",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16105#event-143471"
}
```



---

archive/issue_events_143472.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-04-11T09:40:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "label": "component: build",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16105#event-143472"
}
```



---

archive/issue_comments_207737.json:
```json
{
    "body": "<a id='comment:4'></a>\nI disagree with the \"solution\", this is a bug in the dependency checking.",
    "created_at": "2014-04-11T09:40:37Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207737",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>
I disagree with the "solution", this is a bug in the dependency checking.



---

archive/issue_comments_207738.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,315 +1,24 @@\n-Sorry for the laziest bugreport since my last one, but this is what I'm getting since I've updated to 6.2.beta7 and I have no idea what it comes from.\n+After upgrading to Sage 6.2.beta7:\n \n ```\n-***************************************************************************\n-\n-IPython post-mortem report\n-\n-{'codename': 'An Afternoon Hack',\n- 'commit_hash': '9db8c5c',\n- 'commit_source': 'installation',\n- 'default_encoding': 'UTF-8',\n- 'ipython_path': '/home/darij/gitsage6.2/local/lib/python2.7/site-packages/IPython',\n- 'ipython_version': '1.2.1',\n- 'os_name': 'posix',\n- 'platform': 'Linux-3.2.0-60-generic-i686-with-debian-wheezy-sid',\n- 'sys_executable': '/home/darij/gitsage6.2/local/bin/python',\n- 'sys_platform': 'linux2',\n- 'sys_version': '2.7.5 (default, Mar 23 2014, 16:40:35) \\n[GCC 4.6.3]'}\n-\n-***************************************************************************\n-\n-\n-\n-***************************************************************************\n-\n-Crash traceback:\n-\n----------------------------------------------------------------------------\n-ImportError           Python 2.7.5: /home/darij/gitsage6.2/local/bin/python\n-                                                   Tue Apr  8 22:39:26 2014\n-A problem occured executing Python code.  Here is the sequence of function\n-calls leading up to the error, with the most recent (innermost) call last.\n-/home/darij/gitsage6.2/src/bin/sage-ipython in <module>()\n-      2 # -*- coding: utf-8 -*-\n-      3 \"\"\"\n-      4 Sage IPython startup script.\n-      5 \"\"\"\n-      6 from sage.misc.interpreter import SageTerminalApp\n-      7 \n-      8 # installs the extra readline commands before the IPython initialization begins.\n-      9 from sage.misc.readline_extra_commands import *\n-     10 \n-     11 # Make sure we're using the Sage profile if one isn't specified.\n-     12 import sys\n-     13 if '--profile' not in sys.argv:\n-     14     sys.argv.extend(['--profile', 'sage'])\n-     15 \n-     16 app = SageTerminalApp.instance()\n----> 17 app.initialize()\n-        global app.initialize = <bound method SageTerminalApp.initialize of <sage.misc.interpreter.SageTerminalApp object at 0xb76f0a2c>>\n-     18 app.start()\n-\n-/home/darij/gitsage6.2/local/lib/python2.7/site-packages/IPython/terminal/ipapp.pyc in initialize(self=<sage.misc.interpreter.SageTerminalApp object>, argv=None)\n-\n-/home/darij/gitsage6.2/local/lib/python2.7/site-packages/IPython/config/application.pyc in catch_config_error(method=<function initialize>, app=<sage.misc.interpreter.SageTerminalApp object>, *args=(None,), **kwargs={})\n-     74 \n-     75 #-----------------------------------------------------------------------------\n-     76 # Application class\n-     77 #-----------------------------------------------------------------------------\n-     78 \n-     79 @decorator\n-     80 def catch_config_error(method, app, *args, **kwargs):\n-     81     \"\"\"Method decorator for catching invalid config (Trait/ArgumentErrors) during init.\n-     82 \n-     83     On a TraitError (generally caused by bad config), this will print the trait's\n-     84     message, and exit the app.\n-     85     \n-     86     For use on init methods, to prevent invoking excepthook on invalid input.\n-     87     \"\"\"\n-     88     try:\n----> 89         return method(app, *args, **kwargs)\n-        method = <function initialize at 0xb7170bfc>\n-        app = <sage.misc.interpreter.SageTerminalApp object at 0xb76f0a2c>\n-        args = (None,)\n-        kwargs = {}\n-     90     except (TraitError, ArgumentError) as e:\n-     91         app.print_help()\n-     92         app.log.fatal(\"Bad config encountered during initialization:\")\n-     93         app.log.fatal(str(e))\n-     94         app.log.debug(\"Config at the time: %s\", app.config)\n-     95         app.exit(1)\n-     96 \n-     97 \n-     98 class ApplicationError(Exception):\n-     99     pass\n-    100 \n-    101 class LevelFormatter(logging.Formatter):\n-    102     \"\"\"Formatter with additional `highlevel` record\n-    103     \n-    104     This field is empty if log level is less than highlevel_limit,\n-\n-/home/darij/gitsage6.2/local/lib/python2.7/site-packages/IPython/terminal/ipapp.pyc in initialize(self=<sage.misc.interpreter.SageTerminalApp object>, argv=None)\n-    308     \n-    309     @catch_config_error\n-    310     def initialize(self, argv=None):\n-    311         \"\"\"Do actions after construct, but before starting the app.\"\"\"\n-    312         super(TerminalIPythonApp, self).initialize(argv)\n-    313         if self.subapp is not None:\n-    314             # don't bother initializing further, starting subapp\n-    315             return\n-    316         if not self.ignore_old_config:\n-    317             check_for_old_config(self.ipython_dir)\n-    318         # print self.extra_args\n-    319         if self.extra_args and not self.something_to_run:\n-    320             self.file_to_run = self.extra_args[0]\n-    321         self.init_path()\n-    322         # create the shell\n---> 323         self.init_shell()\n-        self.init_shell = <bound method SageTerminalApp.init_shell of <sage.misc.interpreter.SageTerminalApp object at 0xb76f0a2c>>\n-    324         # and draw the banner\n-    325         self.init_banner()\n-    326         # Now a variety of things that happen after the banner is printed.\n-    327         self.init_gui_pylab()\n-    328         self.init_extensions()\n-    329         self.init_code()\n-    330 \n-    331     def init_shell(self):\n-    332         \"\"\"initialize the InteractiveShell instance\"\"\"\n-    333         # Create an InteractiveShell instance.\n-    334         # shell.display_banner should always be False for the terminal\n-    335         # based app, because we call shell.show_banner() by hand below\n-    336         # so the banner shows *before* all extension loading stuff.\n-    337         self.shell = TerminalInteractiveShell.instance(parent=self,\n-    338                         display_banner=False, profile_dir=self.profile_dir,\n-\n-/home/darij/gitsage6.2/local/lib/python2.7/site-packages/sage/misc/interpreter.pyc in init_shell(self=<sage.misc.interpreter.SageTerminalApp object>)\n-    668             sage: from sage.misc.interpreter import SageTerminalApp, DEFAULT_SAGE_CONFIG\n-    669             sage: app = SageTerminalApp(config=DEFAULT_SAGE_CONFIG)\n-    670             sage: app.initialize(argv=[])  # indirect doctest\n-    671             sage: app.shell\n-    672             <sage.misc.interpreter.SageInteractiveShell object at 0x...>\n-    673         \"\"\"\n-    674         # We need verbose crashes for the Sage crash handler.  We set it here\n-    675         # so that we don't overwrite the traitlet attribute\n-    676         self.verbose_crash = True\n-    677 \n-    678         # Shell initialization\n-    679         self.shell = SageInteractiveShell.instance(config=self.config,\n-    680                         display_banner=False, profile_dir=self.profile_dir,\n-    681                         ipython_dir=self.ipython_dir)\n-    682         self.shell.configurables.append(self)\n---> 683         self.shell.extension_manager.load_extension('sage.misc.sage_extension')\n-        self.shell.extension_manager.load_extension = <bound method ExtensionManager.load_extension of <IPython.core.extensions.ExtensionManager object at 0x97e5a4c>>\n-\n-/home/darij/gitsage6.2/local/lib/python2.7/site-packages/IPython/core/extensions.pyc in load_extension(self=<IPython.core.extensions.ExtensionManager object>, module_str='sage.misc.sage_extension')\n-     83     def load_extension(self, module_str):\n-     84         \"\"\"Load an IPython extension by its module name.\n-     85 \n-     86         Returns the string \"already loaded\" if the extension is already loaded,\n-     87         \"no load function\" if the module doesn't have a load_ipython_extension\n-     88         function, or None if it succeeded.\n-     89         \"\"\"\n-     90         if module_str in self.loaded:\n-     91             return \"already loaded\"\n-     92         \n-     93         from IPython.utils.syspathcontext import prepended_to_syspath\n-     94         \n-     95         with self.shell.builtin_trap:\n-     96             if module_str not in sys.modules:\n-     97                 with prepended_to_syspath(self.ipython_extension_dir):\n----> 98                     __import__(module_str)\n-        global __import__ = undefined\n-        module_str = 'sage.misc.sage_extension'\n-     99             mod = sys.modules[module_str]\n-    100             if self._call_load_ipython_extension(mod):\n-    101                 self.loaded.add(module_str)\n-    102             else:\n-    103                 return \"no load function\"\n-    104 \n-    105     def unload_extension(self, module_str):\n-    106         \"\"\"Unload an IPython extension by its module name.\n-    107 \n-    108         This function looks up the extension's name in ``sys.modules`` and\n-    109         simply calls ``mod.unload_ipython_extension(self)``.\n-    110         \n-    111         Returns the string \"no unload function\" if the extension doesn't define\n-    112         a function to unload itself, \"not loaded\" if the extension isn't loaded,\n-    113         otherwise None.\n-\n-/home/darij/gitsage6.2/local/lib/python2.7/site-packages/sage/misc/sage_extension.py in <module>()\n-     45     2\n-     46 \n-     47 In contrast, input to the ``%time`` magic command is preparsed::\n-     48 \n-     49     sage: shell.run_cell('%time 594.factor()')\n-     50     CPU times: user ...\n-     51     Wall time: ...\n-     52     2 * 3^3 * 11\n-     53 \"\"\"\n-     54 \n-     55 from IPython.core.hooks import TryNext\n-     56 from IPython.core.magic import Magics, magics_class, line_magic\n-     57 import os\n-     58 import sys\n-     59 import sage\n----> 60 import sage.all\n-        global sage.all = undefined\n-     61 from sage.misc.interpreter import preparser\n-     62 from sage.misc.preparser import preparse\n-     63 \n-     64 @magics_class\n-     65 class SageMagics(Magics):\n-     66 \n-     67     @line_magic\n-     68     def crun(self, s):\n-     69         r\"\"\"\n-     70         Profile C function calls\n-     71 \n-     72         INPUT:\n-     73         \n-     74         - ``s`` -- string. Sage command to profile.\n-     75 \n-\n-/home/darij/gitsage6.2/local/lib/python2.7/site-packages/sage/all.py in <module>()\n-     76 ###################################################################\n-     77 \n-     78 import sage.ext.c_lib\n-     79 sage.ext.c_lib._init_csage()\n-     80 sig_on_count = sage.ext.c_lib._sig_on_reset\n-     81 \n-     82 from time                import sleep\n-     83 \n-     84 from sage.ext.c_lib import AlarmInterrupt, SignalError\n-     85 \n-     86 import sage.misc.lazy_import\n-     87 from sage.misc.all       import *         # takes a while\n-     88 \n-     89 from sage.misc.sh import sh\n-     90 \n----> 91 from sage.libs.all       import *\n-        global sage.libs.all = undefined\n-     92 from sage.doctest.all    import *\n-     93 try:\n-     94     from sage.dev.all    import *\n-     95 except ImportError:\n-     96     pass   # dev scripts are disabled\n-     97 \n-     98 from sage.rings.all      import *\n-     99 from sage.matrix.all     import *\n-    100 \n-    101 # This must come before Calculus -- it initializes the Pynac library.\n-    102 import sage.symbolic.pynac\n-    103 \n-    104 from sage.modules.all    import *\n-    105 from sage.monoids.all    import *\n-    106 from sage.algebras.all   import *\n-\n-/home/darij/gitsage6.2/local/lib/python2.7/site-packages/sage/libs/all.py in <module>()\n-----> 1 import sage.libs.ntl.all  as ntl\n-        global sage.libs.ntl.all = undefined\n-        global ntl = undefined\n-      2 \n-      3 from sage.libs.pari.all   import pari, pari_gen, PariError\n-      4 \n-      5 from sage.libs.mwrank.all  import (mwrank_EllipticCurve, mwrank_MordellWeil,\n-      6                                    mwrank_initprimes,\n-      7                                    get_precision as mwrank_get_precision,\n-      8                                    set_precision as mwrank_set_precision)\n-      9 \n-     10 \n-     11 import symmetrica.all as symmetrica\n-     12 \n-     13 from cremona.all import CremonaModularSymbols\n-     14 \n-     15 \n-     16 from sage.misc.lazy_import import lazy_import\n-     17 lazy_import('sage.libs.gap.libgap', 'libgap')\n-\n-/home/darij/gitsage6.2/local/lib/python2.7/site-packages/sage/libs/ntl/__init__.py in <module>()\n-----> 1 import all\n-        global all = undefined\n-\n-/home/darij/gitsage6.2/local/lib/python2.7/site-packages/sage/libs/ntl/all.py in <module>()\n-     17 #    but WITHOUT ANY WARRANTY; without even the implied warranty of\n-     18 #    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n-     19 #    General Public License for more details.\n-     20 #\n-     21 #  The full text of the GPL is available at:\n-     22 #\n-     23 #                  http://www.gnu.org/licenses/\n-     24 #*****************************************************************************\n-     25 \n-     26 from sage.libs.ntl.ntl_ZZ import (\n-     27                  ntl_setSeed, \\\n-     28                  ntl_ZZ as ZZ,\n-     29                  randomBnd as ZZ_random,\n-     30                  randomBits as ZZ_random_bits )\n-     31 \n----> 32 from sage.libs.ntl.ntl_ZZ_pContext import ntl_ZZ_pContext as ZZ_pContext\n-        global sage.libs.ntl.ntl_ZZ_pContext = undefined\n-        global ntl_ZZ_pContext = undefined\n-        global ZZ_pContext = undefined\n-     33 \n-     34 from sage.libs.ntl.ntl_ZZ_p import (\n-     35                  ntl_ZZ_p as ZZ_p,\n-     36                  ntl_ZZ_p_random_element as ZZ_p_random )\n-     37 \n-     38 from sage.libs.ntl.ntl_ZZX import (\n-     39                  ntl_ZZX as ZZX,\n-     40                  zero_ZZX, one_ZZX )\n-     41 \n-     42 from sage.libs.ntl.ntl_ZZ_pX import ntl_ZZ_pX as ZZ_pX\n-     43 \n-     44 from sage.libs.ntl.ntl_ZZ_pEContext import ntl_ZZ_pEContext as ZZ_pEContext\n-     45 \n-     46 from sage.libs.ntl.ntl_ZZ_pE import ntl_ZZ_pE as ZZ_pE\n-     47 \n-\n-ImportError: libntl.so.2: cannot open shared object file: No such file or directory\n-\n-***************************************************************************\n-\n-History of session input:\n-*** Last line of input (may not be in above history):\n+(sage-sh) jdemeyer@tamiyo:sage-config$ ldd local/lib/python2.7/site-packages/sage/misc/readline_extra_commands.so\n+        linux-vdso.so.1 (0x00007fffdfffa000)\n+        libcsage.so => /usr/local/src/sage-config/local/lib/libcsage.so (0x00007f403d747000)\n+        libreadline.so.6 => /usr/local/src/sage-config/local/lib/libreadline.so.6 (0x00007f403d500000)\n+        libstdc++.so.6 => /usr/lib/gcc/x86_64-pc-linux-gnu/4.6.3/libstdc++.so.6 (0x00007f403d1c4000)\n+        libntl.so.2 => not found\n+        libpython2.7.so.1.0 => /usr/local/src/sage-config/local/lib/libpython2.7.so.1.0 (0x00007f403cde5000)\n+        libpthread.so.0 => /lib64/libpthread.so.0 (0x00007f403cbc8000)\n+        libc.so.6 => /lib64/libc.so.6 (0x00007f403c820000)\n+        libntl.so.3 => /usr/local/src/sage-config/local/lib/libntl.so.3 (0x00007f403c459000)\n+        libpari-gmp.so.4 => /usr/local/src/sage-config/local/lib/libpari-gmp.so.4 (0x00007f403bce9000)\n+        libgmp.so.11 => /usr/local/src/sage-config/local/lib/libgmp.so.11 (0x00007f403ba7a000)\n+        libm.so.6 => /lib64/libm.so.6 (0x00007f403b78b000)\n+        libgcc_s.so.1 => /usr/lib/gcc/x86_64-pc-linux-gnu/4.6.3/libgcc_s.so.1 (0x00007f403b575000)\n+        libtinfo.so.5 => /usr/local/src/sage-config/local/lib/libtinfo.so.5 (0x00007f403b340000)\n+        /lib64/ld-linux-x86-64.so.2 (0x00007f403db66000)\n+        libdl.so.2 => /lib64/libdl.so.2 (0x00007f403b13b000)\n+        libutil.so.1 => /lib64/libutil.so.1 (0x00007f403af38000)\n+        libgf2x.so.1 => /usr/local/src/sage-config/local/lib/libgf2x.so.1 (0x00007f403ad22000)\n ```\n+Note the missing `libntl.so.2` causing various kinds of problems.\n``````\n",
    "created_at": "2014-04-11T09:46:07Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207738",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,315 +1,24 @@
-Sorry for the laziest bugreport since my last one, but this is what I'm getting since I've updated to 6.2.beta7 and I have no idea what it comes from.
+After upgrading to Sage 6.2.beta7:
 
 ```
-***************************************************************************
-
-IPython post-mortem report
-
-{'codename': 'An Afternoon Hack',
- 'commit_hash': '9db8c5c',
- 'commit_source': 'installation',
- 'default_encoding': 'UTF-8',
- 'ipython_path': '/home/darij/gitsage6.2/local/lib/python2.7/site-packages/IPython',
- 'ipython_version': '1.2.1',
- 'os_name': 'posix',
- 'platform': 'Linux-3.2.0-60-generic-i686-with-debian-wheezy-sid',
- 'sys_executable': '/home/darij/gitsage6.2/local/bin/python',
- 'sys_platform': 'linux2',
- 'sys_version': '2.7.5 (default, Mar 23 2014, 16:40:35) \n[GCC 4.6.3]'}
-
-***************************************************************************
-
-
-
-***************************************************************************
-
-Crash traceback:
-
----------------------------------------------------------------------------
-ImportError           Python 2.7.5: /home/darij/gitsage6.2/local/bin/python
-                                                   Tue Apr  8 22:39:26 2014
-A problem occured executing Python code.  Here is the sequence of function
-calls leading up to the error, with the most recent (innermost) call last.
-/home/darij/gitsage6.2/src/bin/sage-ipython in <module>()
-      2 # -*- coding: utf-8 -*-
-      3 """
-      4 Sage IPython startup script.
-      5 """
-      6 from sage.misc.interpreter import SageTerminalApp
-      7 
-      8 # installs the extra readline commands before the IPython initialization begins.
-      9 from sage.misc.readline_extra_commands import *
-     10 
-     11 # Make sure we're using the Sage profile if one isn't specified.
-     12 import sys
-     13 if '--profile' not in sys.argv:
-     14     sys.argv.extend(['--profile', 'sage'])
-     15 
-     16 app = SageTerminalApp.instance()
----> 17 app.initialize()
-        global app.initialize = <bound method SageTerminalApp.initialize of <sage.misc.interpreter.SageTerminalApp object at 0xb76f0a2c>>
-     18 app.start()
-
-/home/darij/gitsage6.2/local/lib/python2.7/site-packages/IPython/terminal/ipapp.pyc in initialize(self=<sage.misc.interpreter.SageTerminalApp object>, argv=None)
-
-/home/darij/gitsage6.2/local/lib/python2.7/site-packages/IPython/config/application.pyc in catch_config_error(method=<function initialize>, app=<sage.misc.interpreter.SageTerminalApp object>, *args=(None,), **kwargs={})
-     74 
-     75 #-----------------------------------------------------------------------------
-     76 # Application class
-     77 #-----------------------------------------------------------------------------
-     78 
-     79 @decorator
-     80 def catch_config_error(method, app, *args, **kwargs):
-     81     """Method decorator for catching invalid config (Trait/ArgumentErrors) during init.
-     82 
-     83     On a TraitError (generally caused by bad config), this will print the trait's
-     84     message, and exit the app.
-     85     
-     86     For use on init methods, to prevent invoking excepthook on invalid input.
-     87     """
-     88     try:
----> 89         return method(app, *args, **kwargs)
-        method = <function initialize at 0xb7170bfc>
-        app = <sage.misc.interpreter.SageTerminalApp object at 0xb76f0a2c>
-        args = (None,)
-        kwargs = {}
-     90     except (TraitError, ArgumentError) as e:
-     91         app.print_help()
-     92         app.log.fatal("Bad config encountered during initialization:")
-     93         app.log.fatal(str(e))
-     94         app.log.debug("Config at the time: %s", app.config)
-     95         app.exit(1)
-     96 
-     97 
-     98 class ApplicationError(Exception):
-     99     pass
-    100 
-    101 class LevelFormatter(logging.Formatter):
-    102     """Formatter with additional `highlevel` record
-    103     
-    104     This field is empty if log level is less than highlevel_limit,
-
-/home/darij/gitsage6.2/local/lib/python2.7/site-packages/IPython/terminal/ipapp.pyc in initialize(self=<sage.misc.interpreter.SageTerminalApp object>, argv=None)
-    308     
-    309     @catch_config_error
-    310     def initialize(self, argv=None):
-    311         """Do actions after construct, but before starting the app."""
-    312         super(TerminalIPythonApp, self).initialize(argv)
-    313         if self.subapp is not None:
-    314             # don't bother initializing further, starting subapp
-    315             return
-    316         if not self.ignore_old_config:
-    317             check_for_old_config(self.ipython_dir)
-    318         # print self.extra_args
-    319         if self.extra_args and not self.something_to_run:
-    320             self.file_to_run = self.extra_args[0]
-    321         self.init_path()
-    322         # create the shell
---> 323         self.init_shell()
-        self.init_shell = <bound method SageTerminalApp.init_shell of <sage.misc.interpreter.SageTerminalApp object at 0xb76f0a2c>>
-    324         # and draw the banner
-    325         self.init_banner()
-    326         # Now a variety of things that happen after the banner is printed.
-    327         self.init_gui_pylab()
-    328         self.init_extensions()
-    329         self.init_code()
-    330 
-    331     def init_shell(self):
-    332         """initialize the InteractiveShell instance"""
-    333         # Create an InteractiveShell instance.
-    334         # shell.display_banner should always be False for the terminal
-    335         # based app, because we call shell.show_banner() by hand below
-    336         # so the banner shows *before* all extension loading stuff.
-    337         self.shell = TerminalInteractiveShell.instance(parent=self,
-    338                         display_banner=False, profile_dir=self.profile_dir,
-
-/home/darij/gitsage6.2/local/lib/python2.7/site-packages/sage/misc/interpreter.pyc in init_shell(self=<sage.misc.interpreter.SageTerminalApp object>)
-    668             sage: from sage.misc.interpreter import SageTerminalApp, DEFAULT_SAGE_CONFIG
-    669             sage: app = SageTerminalApp(config=DEFAULT_SAGE_CONFIG)
-    670             sage: app.initialize(argv=[])  # indirect doctest
-    671             sage: app.shell
-    672             <sage.misc.interpreter.SageInteractiveShell object at 0x...>
-    673         """
-    674         # We need verbose crashes for the Sage crash handler.  We set it here
-    675         # so that we don't overwrite the traitlet attribute
-    676         self.verbose_crash = True
-    677 
-    678         # Shell initialization
-    679         self.shell = SageInteractiveShell.instance(config=self.config,
-    680                         display_banner=False, profile_dir=self.profile_dir,
-    681                         ipython_dir=self.ipython_dir)
-    682         self.shell.configurables.append(self)
---> 683         self.shell.extension_manager.load_extension('sage.misc.sage_extension')
-        self.shell.extension_manager.load_extension = <bound method ExtensionManager.load_extension of <IPython.core.extensions.ExtensionManager object at 0x97e5a4c>>
-
-/home/darij/gitsage6.2/local/lib/python2.7/site-packages/IPython/core/extensions.pyc in load_extension(self=<IPython.core.extensions.ExtensionManager object>, module_str='sage.misc.sage_extension')
-     83     def load_extension(self, module_str):
-     84         """Load an IPython extension by its module name.
-     85 
-     86         Returns the string "already loaded" if the extension is already loaded,
-     87         "no load function" if the module doesn't have a load_ipython_extension
-     88         function, or None if it succeeded.
-     89         """
-     90         if module_str in self.loaded:
-     91             return "already loaded"
-     92         
-     93         from IPython.utils.syspathcontext import prepended_to_syspath
-     94         
-     95         with self.shell.builtin_trap:
-     96             if module_str not in sys.modules:
-     97                 with prepended_to_syspath(self.ipython_extension_dir):
----> 98                     __import__(module_str)
-        global __import__ = undefined
-        module_str = 'sage.misc.sage_extension'
-     99             mod = sys.modules[module_str]
-    100             if self._call_load_ipython_extension(mod):
-    101                 self.loaded.add(module_str)
-    102             else:
-    103                 return "no load function"
-    104 
-    105     def unload_extension(self, module_str):
-    106         """Unload an IPython extension by its module name.
-    107 
-    108         This function looks up the extension's name in ``sys.modules`` and
-    109         simply calls ``mod.unload_ipython_extension(self)``.
-    110         
-    111         Returns the string "no unload function" if the extension doesn't define
-    112         a function to unload itself, "not loaded" if the extension isn't loaded,
-    113         otherwise None.
-
-/home/darij/gitsage6.2/local/lib/python2.7/site-packages/sage/misc/sage_extension.py in <module>()
-     45     2
-     46 
-     47 In contrast, input to the ``%time`` magic command is preparsed::
-     48 
-     49     sage: shell.run_cell('%time 594.factor()')
-     50     CPU times: user ...
-     51     Wall time: ...
-     52     2 * 3^3 * 11
-     53 """
-     54 
-     55 from IPython.core.hooks import TryNext
-     56 from IPython.core.magic import Magics, magics_class, line_magic
-     57 import os
-     58 import sys
-     59 import sage
----> 60 import sage.all
-        global sage.all = undefined
-     61 from sage.misc.interpreter import preparser
-     62 from sage.misc.preparser import preparse
-     63 
-     64 @magics_class
-     65 class SageMagics(Magics):
-     66 
-     67     @line_magic
-     68     def crun(self, s):
-     69         r"""
-     70         Profile C function calls
-     71 
-     72         INPUT:
-     73         
-     74         - ``s`` -- string. Sage command to profile.
-     75 
-
-/home/darij/gitsage6.2/local/lib/python2.7/site-packages/sage/all.py in <module>()
-     76 ###################################################################
-     77 
-     78 import sage.ext.c_lib
-     79 sage.ext.c_lib._init_csage()
-     80 sig_on_count = sage.ext.c_lib._sig_on_reset
-     81 
-     82 from time                import sleep
-     83 
-     84 from sage.ext.c_lib import AlarmInterrupt, SignalError
-     85 
-     86 import sage.misc.lazy_import
-     87 from sage.misc.all       import *         # takes a while
-     88 
-     89 from sage.misc.sh import sh
-     90 
----> 91 from sage.libs.all       import *
-        global sage.libs.all = undefined
-     92 from sage.doctest.all    import *
-     93 try:
-     94     from sage.dev.all    import *
-     95 except ImportError:
-     96     pass   # dev scripts are disabled
-     97 
-     98 from sage.rings.all      import *
-     99 from sage.matrix.all     import *
-    100 
-    101 # This must come before Calculus -- it initializes the Pynac library.
-    102 import sage.symbolic.pynac
-    103 
-    104 from sage.modules.all    import *
-    105 from sage.monoids.all    import *
-    106 from sage.algebras.all   import *
-
-/home/darij/gitsage6.2/local/lib/python2.7/site-packages/sage/libs/all.py in <module>()
-----> 1 import sage.libs.ntl.all  as ntl
-        global sage.libs.ntl.all = undefined
-        global ntl = undefined
-      2 
-      3 from sage.libs.pari.all   import pari, pari_gen, PariError
-      4 
-      5 from sage.libs.mwrank.all  import (mwrank_EllipticCurve, mwrank_MordellWeil,
-      6                                    mwrank_initprimes,
-      7                                    get_precision as mwrank_get_precision,
-      8                                    set_precision as mwrank_set_precision)
-      9 
-     10 
-     11 import symmetrica.all as symmetrica
-     12 
-     13 from cremona.all import CremonaModularSymbols
-     14 
-     15 
-     16 from sage.misc.lazy_import import lazy_import
-     17 lazy_import('sage.libs.gap.libgap', 'libgap')
-
-/home/darij/gitsage6.2/local/lib/python2.7/site-packages/sage/libs/ntl/__init__.py in <module>()
-----> 1 import all
-        global all = undefined
-
-/home/darij/gitsage6.2/local/lib/python2.7/site-packages/sage/libs/ntl/all.py in <module>()
-     17 #    but WITHOUT ANY WARRANTY; without even the implied warranty of
-     18 #    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-     19 #    General Public License for more details.
-     20 #
-     21 #  The full text of the GPL is available at:
-     22 #
-     23 #                  http://www.gnu.org/licenses/
-     24 #*****************************************************************************
-     25 
-     26 from sage.libs.ntl.ntl_ZZ import (
-     27                  ntl_setSeed, \
-     28                  ntl_ZZ as ZZ,
-     29                  randomBnd as ZZ_random,
-     30                  randomBits as ZZ_random_bits )
-     31 
----> 32 from sage.libs.ntl.ntl_ZZ_pContext import ntl_ZZ_pContext as ZZ_pContext
-        global sage.libs.ntl.ntl_ZZ_pContext = undefined
-        global ntl_ZZ_pContext = undefined
-        global ZZ_pContext = undefined
-     33 
-     34 from sage.libs.ntl.ntl_ZZ_p import (
-     35                  ntl_ZZ_p as ZZ_p,
-     36                  ntl_ZZ_p_random_element as ZZ_p_random )
-     37 
-     38 from sage.libs.ntl.ntl_ZZX import (
-     39                  ntl_ZZX as ZZX,
-     40                  zero_ZZX, one_ZZX )
-     41 
-     42 from sage.libs.ntl.ntl_ZZ_pX import ntl_ZZ_pX as ZZ_pX
-     43 
-     44 from sage.libs.ntl.ntl_ZZ_pEContext import ntl_ZZ_pEContext as ZZ_pEContext
-     45 
-     46 from sage.libs.ntl.ntl_ZZ_pE import ntl_ZZ_pE as ZZ_pE
-     47 
-
-ImportError: libntl.so.2: cannot open shared object file: No such file or directory
-
-***************************************************************************
-
-History of session input:
-*** Last line of input (may not be in above history):
+(sage-sh) jdemeyer@tamiyo:sage-config$ ldd local/lib/python2.7/site-packages/sage/misc/readline_extra_commands.so
+        linux-vdso.so.1 (0x00007fffdfffa000)
+        libcsage.so => /usr/local/src/sage-config/local/lib/libcsage.so (0x00007f403d747000)
+        libreadline.so.6 => /usr/local/src/sage-config/local/lib/libreadline.so.6 (0x00007f403d500000)
+        libstdc++.so.6 => /usr/lib/gcc/x86_64-pc-linux-gnu/4.6.3/libstdc++.so.6 (0x00007f403d1c4000)
+        libntl.so.2 => not found
+        libpython2.7.so.1.0 => /usr/local/src/sage-config/local/lib/libpython2.7.so.1.0 (0x00007f403cde5000)
+        libpthread.so.0 => /lib64/libpthread.so.0 (0x00007f403cbc8000)
+        libc.so.6 => /lib64/libc.so.6 (0x00007f403c820000)
+        libntl.so.3 => /usr/local/src/sage-config/local/lib/libntl.so.3 (0x00007f403c459000)
+        libpari-gmp.so.4 => /usr/local/src/sage-config/local/lib/libpari-gmp.so.4 (0x00007f403bce9000)
+        libgmp.so.11 => /usr/local/src/sage-config/local/lib/libgmp.so.11 (0x00007f403ba7a000)
+        libm.so.6 => /lib64/libm.so.6 (0x00007f403b78b000)
+        libgcc_s.so.1 => /usr/lib/gcc/x86_64-pc-linux-gnu/4.6.3/libgcc_s.so.1 (0x00007f403b575000)
+        libtinfo.so.5 => /usr/local/src/sage-config/local/lib/libtinfo.so.5 (0x00007f403b340000)
+        /lib64/ld-linux-x86-64.so.2 (0x00007f403db66000)
+        libdl.so.2 => /lib64/libdl.so.2 (0x00007f403b13b000)
+        libutil.so.1 => /lib64/libutil.so.1 (0x00007f403af38000)
+        libgf2x.so.1 => /usr/local/src/sage-config/local/lib/libgf2x.so.1 (0x00007f403ad22000)
 ```
+Note the missing `libntl.so.2` causing various kinds of problems.
``````




---

archive/issue_events_143473.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-04-11T09:58:56Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "rename": {
        "from": "Sage crashes on start: libntl.so.2 not find",
        "to": "Stop linking everything to libntl"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16105#event-143473"
}
```



---

archive/issue_comments_207739.json:
```json
{
    "body": "<a id='comment:6'></a>\nIt seems that all Cython extensions are compiled against NTL for no clear reason:\n\n```\n$ ./sage -b\n[...]\ngcc -pthread -shared -L/usr/local/src/sage-config/local/lib build/temp.linux-x86_64-2.7/sage/misc/parser.o -L/usr/local/src/sage-config/local/lib -L/usr/local/src/sage-config/local/lib -lcsage -lstdc++ -lntl -lpython2.7 -o build/lib.linux-x86_64-2.7/sage/misc/parser.so\n```\n\nThis `-lntl` is hardcoded in `src/setup.py`.",
    "created_at": "2014-04-11T09:58:56Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207739",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>
It seems that all Cython extensions are compiled against NTL for no clear reason:

```
$ ./sage -b
[...]
gcc -pthread -shared -L/usr/local/src/sage-config/local/lib build/temp.linux-x86_64-2.7/sage/misc/parser.o -L/usr/local/src/sage-config/local/lib -L/usr/local/src/sage-config/local/lib -lcsage -lstdc++ -lntl -lpython2.7 -o build/lib.linux-x86_64-2.7/sage/misc/parser.so
```

This `-lntl` is hardcoded in `src/setup.py`.



---

archive/issue_comments_207740.json:
```json
{
    "body": "**Author:** Jeroen Demeyer",
    "created_at": "2014-04-11T10:10:26Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207740",
    "user": "https://github.com/jdemeyer"
}
```

**Author:** Jeroen Demeyer



---

archive/issue_comments_207741.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -22,3 +22,5 @@\n         libgf2x.so.1 => /usr/local/src/sage-config/local/lib/libgf2x.so.1 (0x00007f403ad22000)\n ```\n Note the missing `libntl.so.2` causing various kinds of problems.\n+\n+The reason is that *every* Cython extension is compiled with `-lntl` (see `src/setup.py`), this should be fixed.\n``````\n",
    "created_at": "2014-04-11T10:25:16Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207741",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -22,3 +22,5 @@
         libgf2x.so.1 => /usr/local/src/sage-config/local/lib/libgf2x.so.1 (0x00007f403ad22000)
 ```
 Note the missing `libntl.so.2` causing various kinds of problems.
+
+The reason is that *every* Cython extension is compiled with `-lntl` (see `src/setup.py`), this should be fixed.
``````




---

archive/issue_comments_207742.json:
```json
{
    "body": "**Branch:** [u/jdemeyer/ticket/16105](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/16105)",
    "created_at": "2014-04-11T10:37:35Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207742",
    "user": "https://github.com/jdemeyer"
}
```

**Branch:** [u/jdemeyer/ticket/16105](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/16105)



---

archive/issue_events_143474.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-04-11T12:25:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16105#event-143474"
}
```



---

archive/issue_events_143475.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-04-11T12:25:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16105#event-143475"
}
```



---

archive/issue_comments_207743.json:
```json
{
    "body": "**Commit:** [b8a96a49dd23f420b2b6cc45553cb2e9b812d27a](https://github.com/sagemath/sagetrac-mirror/commit/b8a96a49dd23f420b2b6cc45553cb2e9b812d27a)",
    "created_at": "2014-04-11T12:25:34Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207743",
    "user": "https://github.com/jdemeyer"
}
```

**Commit:** [b8a96a49dd23f420b2b6cc45553cb2e9b812d27a](https://github.com/sagemath/sagetrac-mirror/commit/b8a96a49dd23f420b2b6cc45553cb2e9b812d27a)



---

archive/issue_comments_207744.json:
```json
{
    "body": "<a id='comment:10'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b8a96a49dd23f420b2b6cc45553cb2e9b812d27a\">b8a96a4</a></td><td><code>Stop linking everything to libntl and libstdc++</code></td></tr></table>\n",
    "created_at": "2014-04-11T12:25:34Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207744",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b8a96a49dd23f420b2b6cc45553cb2e9b812d27a">b8a96a4</a></td><td><code>Stop linking everything to libntl and libstdc++</code></td></tr></table>




---

archive/issue_comments_207745.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -23,4 +23,24 @@\n ```\n Note the missing `libntl.so.2` causing various kinds of problems.\n \n-The reason is that *every* Cython extension is compiled with `-lntl` (see `src/setup.py`), this should be fixed.\n+The reason is that *every* Cython extension is compiled with `-lntl` (see `src/setup.py`), this should be fixed. This `-lntl` was added in\n+\n+```diff\n+commit 707bac8c37de8e320630c94d67d7154dd14e91da\n+Author: William Stein <wstein@gmail.com>\n+Date:   Mon Apr 9 18:43:36 2007 -0700\n+\n+    add -lntl to the build line for building SAGE extension modules; this avoids a warning on OS X.\n+\n+diff --git a/src/setup.py b/src/setup.py\n+index 38c8ed4..b7e88fe 100644\n+--- a/src/setup.py\n++++ b/src/setup.py\n+@@ -573,7 +573,7 @@ if DEVEL:\n+     #ext_modules.append(mpc)\n+ \n+ for m in ext_modules:\n+-    m.libraries = ['csage'] + m.libraries + ['stdc++']\n++    m.libraries = ['csage'] + m.libraries + ['stdc++', 'ntl']\n+     m.library_dirs += ['%s/lib' % SAGE_LOCAL]\n+```\n``````\n",
    "created_at": "2014-04-11T12:38:18Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207745",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -23,4 +23,24 @@
 ```
 Note the missing `libntl.so.2` causing various kinds of problems.
 
-The reason is that *every* Cython extension is compiled with `-lntl` (see `src/setup.py`), this should be fixed.
+The reason is that *every* Cython extension is compiled with `-lntl` (see `src/setup.py`), this should be fixed. This `-lntl` was added in
+
+```diff
+commit 707bac8c37de8e320630c94d67d7154dd14e91da
+Author: William Stein <wstein@gmail.com>
+Date:   Mon Apr 9 18:43:36 2007 -0700
+
+    add -lntl to the build line for building SAGE extension modules; this avoids a warning on OS X.
+
+diff --git a/src/setup.py b/src/setup.py
+index 38c8ed4..b7e88fe 100644
+--- a/src/setup.py
++++ b/src/setup.py
+@@ -573,7 +573,7 @@ if DEVEL:
+     #ext_modules.append(mpc)
+ 
+ for m in ext_modules:
+-    m.libraries = ['csage'] + m.libraries + ['stdc++']
++    m.libraries = ['csage'] + m.libraries + ['stdc++', 'ntl']
+     m.library_dirs += ['%s/lib' % SAGE_LOCAL]
+```
``````




---

archive/issue_comments_207746.json:
```json
{
    "body": "<a id='comment:12'></a>\nJust realized that always using `list.append()` is dangerous. I should use `list = list + [foo]`.",
    "created_at": "2014-04-11T13:02:17Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207746",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>
Just realized that always using `list.append()` is dangerous. I should use `list = list + [foo]`.



---

archive/issue_comments_207747.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [jdemeyer](#comment%3A12):\n> Just realized that always using `list.append()` is dangerous. I should use `list = list + [foo]`.\n\nWhy is it dangerous?",
    "created_at": "2014-04-11T13:07:00Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207747",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:13'></a>
Replying to [jdemeyer](#comment%3A12):
> Just realized that always using `list.append()` is dangerous. I should use `list = list + [foo]`.

Why is it dangerous?



---

archive/issue_comments_207748.json:
```json
{
    "body": "<a id='comment:14'></a>\nOkay, \"dangerous\" isn't the right word.\n\nThe problem is the following:\n\n```\nsage: mylist = [\"hello\"]\nsage: a = mylist\nsage: a.append(\"world\")\nsage: a\n['hello', 'world']\nsage: mylist\n['hello', 'world']\n```\n\nAs you can see, `a` and `mylist` remain the same object. The same if you use `+=`. That is also the reason why some Sage command lines look like\n\n```\ngcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -fPIC -I/usr/local/src/sage-config/local/include/singular -I/usr/local/src/sage-config/local/include -I/usr/local/src/sage-config/local/include/csage -I/usr/local/src/sage-config/src -I/usr/local/src/sage-config/src/sage/ext -I/usr/local/src/sage-config/local/include -I/usr/local/src/sage-config/local/include/csage -I/usr/local/src/sage-config/src -I/usr/local/src/sage-config/src/sage/ext -I/usr/local/src/sage-config/local/include/python2.7 -c sage/rings/polynomial/plural.cpp -o build/temp.linux-x86_64-2.7/sage/rings/polynomial/plural.o -D__STDC_LIMIT_MACROS -fno-strict-aliasing -w -fno-strict-aliasing -w -fno-strict-aliasing -w -fno-strict-aliasing -w -fno-strict-aliasing -w -fno-strict-aliasing -w -fno-strict-aliasing -w -fno-strict-aliasing -w -fno-strict-aliasing -w -fno-strict-aliasing -w -fno-strict-aliasing -w -fno-strict-aliasing -w -fno-strict-aliasing -w\n```\nso I plan to fix this also here.",
    "created_at": "2014-04-11T13:12:13Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207748",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'></a>
Okay, "dangerous" isn't the right word.

The problem is the following:

```
sage: mylist = ["hello"]
sage: a = mylist
sage: a.append("world")
sage: a
['hello', 'world']
sage: mylist
['hello', 'world']
```

As you can see, `a` and `mylist` remain the same object. The same if you use `+=`. That is also the reason why some Sage command lines look like

```
gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -fPIC -I/usr/local/src/sage-config/local/include/singular -I/usr/local/src/sage-config/local/include -I/usr/local/src/sage-config/local/include/csage -I/usr/local/src/sage-config/src -I/usr/local/src/sage-config/src/sage/ext -I/usr/local/src/sage-config/local/include -I/usr/local/src/sage-config/local/include/csage -I/usr/local/src/sage-config/src -I/usr/local/src/sage-config/src/sage/ext -I/usr/local/src/sage-config/local/include/python2.7 -c sage/rings/polynomial/plural.cpp -o build/temp.linux-x86_64-2.7/sage/rings/polynomial/plural.o -D__STDC_LIMIT_MACROS -fno-strict-aliasing -w -fno-strict-aliasing -w -fno-strict-aliasing -w -fno-strict-aliasing -w -fno-strict-aliasing -w -fno-strict-aliasing -w -fno-strict-aliasing -w -fno-strict-aliasing -w -fno-strict-aliasing -w -fno-strict-aliasing -w -fno-strict-aliasing -w -fno-strict-aliasing -w -fno-strict-aliasing -w
```
so I plan to fix this also here.



---

archive/issue_comments_207749.json:
```json
{
    "body": "<a id='comment:15'></a>\nNice.  (After the FIXME has been in for more than `\\pi` years... ;-) )\n\nThe order of the libraries is still wrong in many places (e.g. `\"gmp\", \"gmpxx\"`; and `\"m\"` should almost always be the *last*), but that's not really the point of the ticket; the following is:\n\nI'd also add NTL here:\n\n```python\nlib_headers = { \"gmp\":     [ os.path.join(SAGE_INC,'gmp.h') ],   # cf. #8664, #9896\n                \"gmpxx\":   [ os.path.join(SAGE_INC,'gmpxx.h') ],\n                \"ntl\":     [ os.path.join(SAGE_INC,'NTL','config.h') ]\n              }\n```\n(That way, all modules using NTL, i.e., [directly] linking to it, will automatically depend on an NTL header that gets modified upon every NTL reinstallation.)\n\n\n\n\nNot sure why you want all extension modules to depend on `setup.py` (makes sense of course, but will also trigger frequent rebuilds of the *whole* Sage library); we should then also let all of them depend on `module_list.py` (which is IMHO probably more important).\n\n\n\n\nAnd there are of course still many libraries not really needed, because they're just indirectly used, but that's another issue, cf. [ticket:16017#comment:10 this comment on #16017].",
    "created_at": "2014-04-11T13:32:55Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207749",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:15'></a>
Nice.  (After the FIXME has been in for more than `\pi` years... ;-) )

The order of the libraries is still wrong in many places (e.g. `"gmp", "gmpxx"`; and `"m"` should almost always be the *last*), but that's not really the point of the ticket; the following is:

I'd also add NTL here:

```python
lib_headers = { "gmp":     [ os.path.join(SAGE_INC,'gmp.h') ],   # cf. #8664, #9896
                "gmpxx":   [ os.path.join(SAGE_INC,'gmpxx.h') ],
                "ntl":     [ os.path.join(SAGE_INC,'NTL','config.h') ]
              }
```
(That way, all modules using NTL, i.e., [directly] linking to it, will automatically depend on an NTL header that gets modified upon every NTL reinstallation.)




Not sure why you want all extension modules to depend on `setup.py` (makes sense of course, but will also trigger frequent rebuilds of the *whole* Sage library); we should then also let all of them depend on `module_list.py` (which is IMHO probably more important).




And there are of course still many libraries not really needed, because they're just indirectly used, but that's another issue, cf. [ticket:16017#comment:10 this comment on #16017].



---

archive/issue_comments_207750.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [leif](#comment%3A15):\n> Not sure why you want all extension modules to depend on `setup.py`\n\nWell, it is needed at least to fix all modules currently linked to an old version of NTL: all these need to be relinked.\n\n> (makes sense of course, but will also trigger frequent rebuilds of the *whole* Sage library);\n\nI doubt it, that file isn't changed so frequently.",
    "created_at": "2014-04-11T13:48:52Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207750",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>
Replying to [leif](#comment%3A15):
> Not sure why you want all extension modules to depend on `setup.py`

Well, it is needed at least to fix all modules currently linked to an old version of NTL: all these need to be relinked.

> (makes sense of course, but will also trigger frequent rebuilds of the *whole* Sage library);

I doubt it, that file isn't changed so frequently.



---

archive/issue_comments_207751.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [jdemeyer](#comment%3A16):\n> Replying to [leif](#comment%3A15):\n> > Not sure why you want all extension modules to depend on `setup.py`\n\n> Well, it is needed at least to fix all modules currently linked to an old version of NTL: all these need to be relinked.\n\nHaha, a one-time dependency.  So you're going to remove it again in some of the next betas? \n\n> > (makes sense of course, but will also trigger frequent rebuilds of the *whole* Sage library);\n\n> I doubt it, that file isn't changed so frequently.\n\nSo you're not going to let them depend on `module_list.py` also?\n\n(I frequently hate myself for making all targets depend on the Makefile; similar issue.)\n\n\n\n\nProbably Volker should mention `env SAGE_UPGRADING=yes make build` in the release announcements for a while.  (Doing `./sage -ba-force` afterwards should no longer be necessary once this ticket is merged, hopefully...)\n\nWould save him a couple of `make distclean && make` replies, too.",
    "created_at": "2014-04-11T14:02:18Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207751",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:17'></a>
Replying to [jdemeyer](#comment%3A16):
> Replying to [leif](#comment%3A15):
> > Not sure why you want all extension modules to depend on `setup.py`

> Well, it is needed at least to fix all modules currently linked to an old version of NTL: all these need to be relinked.

Haha, a one-time dependency.  So you're going to remove it again in some of the next betas? 

> > (makes sense of course, but will also trigger frequent rebuilds of the *whole* Sage library);

> I doubt it, that file isn't changed so frequently.

So you're not going to let them depend on `module_list.py` also?

(I frequently hate myself for making all targets depend on the Makefile; similar issue.)




Probably Volker should mention `env SAGE_UPGRADING=yes make build` in the release announcements for a while.  (Doing `./sage -ba-force` afterwards should no longer be necessary once this ticket is merged, hopefully...)

Would save him a couple of `make distclean && make` replies, too.



---

archive/issue_comments_207752.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [leif](#comment%3A17):\n> Haha, a one-time dependency.  So you're going to remove it again in some of the next betas? \n\nOf course not. I am saying it is needed *now* and it doesn't really hurt to keep it.\n\n> So you're not going to let them depend on `module_list.py` also?\n\nI would say no.\nI think it is quite unlikely that `module_list.py` gets edited\n- without a change to the corresponding `.pyx` files (if the `.pyx` file is changed, the module is recompiled anyway)\n- without considering changes which are only cosmetic or only for portability (those don't need rebuilds).",
    "created_at": "2014-04-11T14:33:57Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207752",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:18'></a>
Replying to [leif](#comment%3A17):
> Haha, a one-time dependency.  So you're going to remove it again in some of the next betas? 

Of course not. I am saying it is needed *now* and it doesn't really hurt to keep it.

> So you're not going to let them depend on `module_list.py` also?

I would say no.
I think it is quite unlikely that `module_list.py` gets edited
- without a change to the corresponding `.pyx` files (if the `.pyx` file is changed, the module is recompiled anyway)
- without considering changes which are only cosmetic or only for portability (those don't need rebuilds).



---

archive/issue_comments_207753.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [jdemeyer](#comment%3A18):\n> Replying to [leif](#comment%3A17):\n> > So you're going to remove it again in some of the next betas? \n\n> Of course not. I am saying it is needed *now* and it doesn't really hurt to keep it.\n> \n> > So you're not going to let them depend on `module_list.py` also?\n\n> I would say no.\n\nOk.  Then we can at least \"touch\" `setup.py` in the future (by adding a comment, or by fixing some typo...) to trigger a *full* rebuild of the Sage library, e.g. if we make further structural changes to (just) `module_list.py` that do require a rebuild (of a couple of otherwise untouched, or of all modules).\n\nAnd simply adding an extension module (or changing *one's* deps etc.) will *not* trigger the rebuild of the whole Sage library, which presumably is more important to many.",
    "created_at": "2014-04-11T15:17:09Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207753",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:19'></a>
Replying to [jdemeyer](#comment%3A18):
> Replying to [leif](#comment%3A17):
> > So you're going to remove it again in some of the next betas? 

> Of course not. I am saying it is needed *now* and it doesn't really hurt to keep it.
> 
> > So you're not going to let them depend on `module_list.py` also?

> I would say no.

Ok.  Then we can at least "touch" `setup.py` in the future (by adding a comment, or by fixing some typo...) to trigger a *full* rebuild of the Sage library, e.g. if we make further structural changes to (just) `module_list.py` that do require a rebuild (of a couple of otherwise untouched, or of all modules).

And simply adding an extension module (or changing *one's* deps etc.) will *not* trigger the rebuild of the whole Sage library, which presumably is more important to many.



---

archive/issue_comments_207754.json:
```json
{
    "body": "<a id='comment:20'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2770a55d98ddb44edb113207e00c502baf30acb6\">2770a55</a></td><td><code>Do not append to lists; add NTL dependencies; don't add include_dirs</code></td></tr></table>\n",
    "created_at": "2014-04-11T15:24:35Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207754",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2770a55d98ddb44edb113207e00c502baf30acb6">2770a55</a></td><td><code>Do not append to lists; add NTL dependencies; don't add include_dirs</code></td></tr></table>




---

archive/issue_comments_207755.json:
```json
{
    "body": "**Changing commit** from \"[b8a96a49dd23f420b2b6cc45553cb2e9b812d27a](https://github.com/sagemath/sagetrac-mirror/commit/b8a96a49dd23f420b2b6cc45553cb2e9b812d27a)\" to \"[2770a55d98ddb44edb113207e00c502baf30acb6](https://github.com/sagemath/sagetrac-mirror/commit/2770a55d98ddb44edb113207e00c502baf30acb6)\".",
    "created_at": "2014-04-11T15:24:35Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207755",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[b8a96a49dd23f420b2b6cc45553cb2e9b812d27a](https://github.com/sagemath/sagetrac-mirror/commit/b8a96a49dd23f420b2b6cc45553cb2e9b812d27a)" to "[2770a55d98ddb44edb113207e00c502baf30acb6](https://github.com/sagemath/sagetrac-mirror/commit/2770a55d98ddb44edb113207e00c502baf30acb6)".



---

archive/issue_comments_207756.json:
```json
{
    "body": "<a id='comment:21'></a>\nNew version for review.",
    "created_at": "2014-04-11T15:25:56Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207756",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:21'></a>
New version for review.



---

archive/issue_comments_207757.json:
```json
{
    "body": "<a id='comment:22'></a>\nReplying to [jdemeyer](#comment%3A21):\n> New version for review.\n\n\nLooks sane, but I can't test this right now.  (Others will presumably be faster.)\n\nJust wonder whether we'd need the absolute path of `setup.py` (`__file__` may just be the latter, or have a relative path).",
    "created_at": "2014-04-11T15:54:59Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207757",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:22'></a>
Replying to [jdemeyer](#comment%3A21):
> New version for review.


Looks sane, but I can't test this right now.  (Others will presumably be faster.)

Just wonder whether we'd need the absolute path of `setup.py` (`__file__` may just be the latter, or have a relative path).



---

archive/issue_comments_207758.json:
```json
{
    "body": "<a id='comment:23'></a>\nReplying to [leif](#comment%3A19):\n> Replying to [jdemeyer](#comment%3A18):\n> > Replying to [leif](#comment%3A17):\n> > > So you're going to remove it again in some of the next betas? \n\n> > Of course not. I am saying it is needed *now* and it doesn't really hurt to keep it.\n> Ok.  Then we can at least \"touch\" `setup.py` in the future (by adding a comment, or by fixing some typo...) to trigger a *full* rebuild of the Sage library, e.g. if we make further structural changes to (just) `module_list.py` that do require a rebuild (of a couple of otherwise untouched, or of all modules).\n\n\nThinking a bit more about it, this can be quite annoying *during development*, so we may add some way to bypass the dependency on `setup.py`.  (There's already a `DEVEL` variable in it, but it's also unconditionally set to `False`, rather than derived from some environment variable, say.)",
    "created_at": "2014-04-11T16:45:44Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207758",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:23'></a>
Replying to [leif](#comment%3A19):
> Replying to [jdemeyer](#comment%3A18):
> > Replying to [leif](#comment%3A17):
> > > So you're going to remove it again in some of the next betas? 

> > Of course not. I am saying it is needed *now* and it doesn't really hurt to keep it.
> Ok.  Then we can at least "touch" `setup.py` in the future (by adding a comment, or by fixing some typo...) to trigger a *full* rebuild of the Sage library, e.g. if we make further structural changes to (just) `module_list.py` that do require a rebuild (of a couple of otherwise untouched, or of all modules).


Thinking a bit more about it, this can be quite annoying *during development*, so we may add some way to bypass the dependency on `setup.py`.  (There's already a `DEVEL` variable in it, but it's also unconditionally set to `False`, rather than derived from some environment variable, say.)



---

archive/issue_comments_207759.json:
```json
{
    "body": "<a id='comment:24'></a>\nInstead of introducing yet another environment variable (here, at least), we could (ab|re)use `SAGE_UPGRADING`, and bypass the dependency on `setup.py` iff `SAGE_UPGRADING = \"no\"`, which would also be compatible to having `SAGE_UPGRADING=yes` the default (in future releases).",
    "created_at": "2014-04-11T16:59:39Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207759",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:24'></a>
Instead of introducing yet another environment variable (here, at least), we could (ab|re)use `SAGE_UPGRADING`, and bypass the dependency on `setup.py` iff `SAGE_UPGRADING = "no"`, which would also be compatible to having `SAGE_UPGRADING=yes` the default (in future releases).



---

archive/issue_comments_207760.json:
```json
{
    "body": "<a id='comment:25'></a>\nwill test it on the bulidbot",
    "created_at": "2014-04-11T17:03:38Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207760",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:25'></a>
will test it on the bulidbot



---

archive/issue_comments_207761.json:
```json
{
    "body": "**Reviewer:** Volker Braun",
    "created_at": "2014-04-11T17:03:38Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207761",
    "user": "https://github.com/vbraun"
}
```

**Reviewer:** Volker Braun



---

archive/issue_comments_207762.json:
```json
{
    "body": "<a id='comment:26'></a>\nIMHO any extra logic to avoid recompile with certain environment variables will just break because it is not doctested. And `sage -ba` takes 11 seconds on my laptop with warm caches.",
    "created_at": "2014-04-11T17:26:45Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207762",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:26'></a>
IMHO any extra logic to avoid recompile with certain environment variables will just break because it is not doctested. And `sage -ba` takes 11 seconds on my laptop with warm caches.



---

archive/issue_comments_207763.json:
```json
{
    "body": "<a id='comment:27'></a>\nReplying to [vbraun](#comment%3A26):\n> IMHO any extra logic to avoid recompile with certain environment variables will just break because it is not doctested.\n\n\nBuilding is not doctested at all, unfortunately not even upgrading is tested -- at least not on a regular basis (otherwise the ticket upgrading NTL would have dealt with what we do here).  `SAGE_UPGRADING` isn't new, and the default behaviour of (just issuing) `make` (or `sage-spkg`) regularly causes failures.\n\n\n\n\n> And `sage -ba` takes 11 seconds on my laptop with warm caches.\n\n\n[File system and ccache I guess.]\n\nWell, if every Sage user|developer (at your choice) in the world gets such for free...\n\nOtherwise we could just update the minimal hardware requirements (for building or developing with Sage).",
    "created_at": "2014-04-11T18:02:55Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207763",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:27'></a>
Replying to [vbraun](#comment%3A26):
> IMHO any extra logic to avoid recompile with certain environment variables will just break because it is not doctested.


Building is not doctested at all, unfortunately not even upgrading is tested -- at least not on a regular basis (otherwise the ticket upgrading NTL would have dealt with what we do here).  `SAGE_UPGRADING` isn't new, and the default behaviour of (just issuing) `make` (or `sage-spkg`) regularly causes failures.




> And `sage -ba` takes 11 seconds on my laptop with warm caches.


[File system and ccache I guess.]

Well, if every Sage user|developer (at your choice) in the world gets such for free...

Otherwise we could just update the minimal hardware requirements (for building or developing with Sage).



---

archive/issue_comments_207764.json:
```json
{
    "body": "<a id='comment:28'></a>\nIMHO the current build system is not sufficient to reasonably be able to guarantee upgrades. Of course feel free to volunteer to test and debug upgrades. As long as \"make distclean && make\" works I don't consider it a blocker.",
    "created_at": "2014-04-11T19:28:54Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207764",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:28'></a>
IMHO the current build system is not sufficient to reasonably be able to guarantee upgrades. Of course feel free to volunteer to test and debug upgrades. As long as "make distclean && make" works I don't consider it a blocker.



---

archive/issue_events_143476.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-04-11T19:41:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16105#event-143476"
}
```



---

archive/issue_events_143477.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "ab41becedd023d9637ee684995b2827328666e81",
    "created_at": "2014-04-11T19:41:30Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16105#event-143477"
}
```



---

archive/issue_comments_207765.json:
```json
{
    "body": "**Changing branch** from \"[u/jdemeyer/ticket/16105](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/16105)\" to \"[2770a55d98ddb44edb113207e00c502baf30acb6](https://github.com/sagemath/sagetrac-mirror/commit/2770a55d98ddb44edb113207e00c502baf30acb6)\".",
    "created_at": "2014-04-11T19:41:30Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207765",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/jdemeyer/ticket/16105](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/16105)" to "[2770a55d98ddb44edb113207e00c502baf30acb6](https://github.com/sagemath/sagetrac-mirror/commit/2770a55d98ddb44edb113207e00c502baf30acb6)".



---

archive/issue_comments_207766.json:
```json
{
    "body": "<a id='comment:30'></a>\nReplying to [vbraun](#comment%3A28):\n> IMHO the current build system is not sufficient to reasonably be able to guarantee upgrades.\n\n\n*We worked hard<sup>TM</sup>* to make upgrading work (again), without much hassle such as having to artificially bump spkg patch levels to trigger a \"rebuild\", but people tend to create new pitfalls or refuse to remove the existing ones, and apparently don't care much about whether upgrading will work with their changes, so testing the latter is (or had been) mostly up to the release manager.\n\nAnd the \"disabling\" of upgrades *from* betas (or alphas to that time, IIRC) for a while presumably didn't encourage people to test upgrading either.\n\n\n\n\n> Of course feel free to volunteer to test and debug upgrades. As long as \"make distclean && make\" works I don't consider it a blocker.\n\n\n[http://wiki.sagemath.org/devel/ReleaseManagement#Release_checklist](http://wiki.sagemath.org/devel/ReleaseManagement#Release_checklist) B)\n\n(Once upon a time...)\n\n\nBuildbots could (and IMHO should) not just test building from scratch, but also upgrading (nowadays `git pull` plus `[env SAGE_UPGRADING=yes] make`), at least from the last stable release, say.",
    "created_at": "2014-04-11T20:03:57Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207766",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:30'></a>
Replying to [vbraun](#comment%3A28):
> IMHO the current build system is not sufficient to reasonably be able to guarantee upgrades.


*We worked hard<sup>TM</sup>* to make upgrading work (again), without much hassle such as having to artificially bump spkg patch levels to trigger a "rebuild", but people tend to create new pitfalls or refuse to remove the existing ones, and apparently don't care much about whether upgrading will work with their changes, so testing the latter is (or had been) mostly up to the release manager.

And the "disabling" of upgrades *from* betas (or alphas to that time, IIRC) for a while presumably didn't encourage people to test upgrading either.




> Of course feel free to volunteer to test and debug upgrades. As long as "make distclean && make" works I don't consider it a blocker.


[http://wiki.sagemath.org/devel/ReleaseManagement#Release_checklist](http://wiki.sagemath.org/devel/ReleaseManagement#Release_checklist) B)

(Once upon a time...)


Buildbots could (and IMHO should) not just test building from scratch, but also upgrading (nowadays `git pull` plus `[env SAGE_UPGRADING=yes] make`), at least from the last stable release, say.



---

archive/issue_comments_207767.json:
```json
{
    "body": "**Changing branch** from \"[2770a55d98ddb44edb113207e00c502baf30acb6](https://github.com/sagemath/sagetrac-mirror/commit/2770a55d98ddb44edb113207e00c502baf30acb6)\" to \"[u/jdemeyer/ticket/16105](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/16105)\".",
    "created_at": "2014-04-11T20:03:57Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207767",
    "user": "https://github.com/nexttime"
}
```

**Changing branch** from "[2770a55d98ddb44edb113207e00c502baf30acb6](https://github.com/sagemath/sagetrac-mirror/commit/2770a55d98ddb44edb113207e00c502baf30acb6)" to "[u/jdemeyer/ticket/16105](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/16105)".



---

archive/issue_comments_207768.json:
```json
{
    "body": "**Changing branch** from \"[u/jdemeyer/ticket/16105](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/16105)\" to \"[2770a55d98ddb44edb113207e00c502baf30acb6](https://github.com/sagemath/sagetrac-mirror/commit/2770a55d98ddb44edb113207e00c502baf30acb6)\".",
    "created_at": "2014-04-11T20:05:46Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207768",
    "user": "https://github.com/nexttime"
}
```

**Changing branch** from "[u/jdemeyer/ticket/16105](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/16105)" to "[2770a55d98ddb44edb113207e00c502baf30acb6](https://github.com/sagemath/sagetrac-mirror/commit/2770a55d98ddb44edb113207e00c502baf30acb6)".



---

archive/issue_comments_207769.json:
```json
{
    "body": "<a id='comment:31'></a>\nArgh, trac...",
    "created_at": "2014-04-11T20:05:46Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207769",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:31'></a>
Argh, trac...



---

archive/issue_comments_207770.json:
```json
{
    "body": "**Changing commit** from \"[2770a55d98ddb44edb113207e00c502baf30acb6](https://github.com/sagemath/sagetrac-mirror/commit/2770a55d98ddb44edb113207e00c502baf30acb6)\" to \"\".",
    "created_at": "2014-04-11T20:05:46Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207770",
    "user": "https://github.com/nexttime"
}
```

**Changing commit** from "[2770a55d98ddb44edb113207e00c502baf30acb6](https://github.com/sagemath/sagetrac-mirror/commit/2770a55d98ddb44edb113207e00c502baf30acb6)" to "".



---

archive/issue_comments_207771.json:
```json
{
    "body": "<a id='comment:32'></a>\nReplying to [leif](#comment%3A30):\n> Buildbots could (and IMHO should) not just test building from scratch, but also upgrading (nowadays `git pull` plus `[env SAGE_UPGRADING=yes] make`), at least from the last stable release, say.\nAgreed. `env SAGE_UPGRADING=yes $MAKE` should always work.",
    "created_at": "2014-04-12T11:07:25Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207771",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:32'></a>
Replying to [leif](#comment%3A30):
> Buildbots could (and IMHO should) not just test building from scratch, but also upgrading (nowadays `git pull` plus `[env SAGE_UPGRADING=yes] make`), at least from the last stable release, say.
Agreed. `env SAGE_UPGRADING=yes $MAKE` should always work.



---

archive/issue_comments_207772.json:
```json
{
    "body": "<a id='comment:33'></a>\nReplying to [vbraun](#comment%3A28):\n> IMHO the current build system is not sufficient to reasonably be able to guarantee upgrades.\n\nWell, if we would make `SAGE_UPGRADING=yes` the default, it should work. In the light of `ccache`, that's not such a stupid idea either.",
    "created_at": "2014-04-12T11:08:20Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207772",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:33'></a>
Replying to [vbraun](#comment%3A28):
> IMHO the current build system is not sufficient to reasonably be able to guarantee upgrades.

Well, if we would make `SAGE_UPGRADING=yes` the default, it should work. In the light of `ccache`, that's not such a stupid idea either.



---

archive/issue_comments_207773.json:
```json
{
    "body": "<a id='comment:34'></a>\nReplying to [jdemeyer](#comment%3A32):\n> Agreed. `env SAGE_UPGRADING=yes $MAKE` should always work.\n\n\nI disagree, having irremovably crapped old headers or old shared libraries into the Sage tree is always going to be a challenge for upgrades. I have no interest in forever playing whack-a-mole there. Upgrades without \"make distclean\" will be guaranteed to work when the build system can reliably support them.",
    "created_at": "2014-04-12T23:53:00Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207773",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:34'></a>
Replying to [jdemeyer](#comment%3A32):
> Agreed. `env SAGE_UPGRADING=yes $MAKE` should always work.


I disagree, having irremovably crapped old headers or old shared libraries into the Sage tree is always going to be a challenge for upgrades. I have no interest in forever playing whack-a-mole there. Upgrades without "make distclean" will be guaranteed to work when the build system can reliably support them.



---

archive/issue_comments_207774.json:
```json
{
    "body": "<a id='comment:35'></a>\nReplying to [vbraun](#comment%3A34):\n> I disagree, having irremovably crapped old headers or old shared libraries into the Sage tree is always going to be a challenge for upgrades. I have no interest in forever playing whack-a-mole there. Upgrades without \"make distclean\" will be guaranteed to work when the build system can reliably support them.\n\nUpgrades worked fine up to Sage 5.13 (I always tested that) and that was with a much worse build system than we have now. And I guess this ticket here is maybe the first time since Sage 6.0 that upgrades break but it's also clearly a genuine bug which should be fixed.",
    "created_at": "2014-04-13T08:08:03Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207774",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:35'></a>
Replying to [vbraun](#comment%3A34):
> I disagree, having irremovably crapped old headers or old shared libraries into the Sage tree is always going to be a challenge for upgrades. I have no interest in forever playing whack-a-mole there. Upgrades without "make distclean" will be guaranteed to work when the build system can reliably support them.

Upgrades worked fine up to Sage 5.13 (I always tested that) and that was with a much worse build system than we have now. And I guess this ticket here is maybe the first time since Sage 6.0 that upgrades break but it's also clearly a genuine bug which should be fixed.



---

archive/issue_comments_207775.json:
```json
{
    "body": "<a id='comment:36'></a>\nI of course agree that this ticket was a genuine bug, and I'm happy that you fixed it. Still, we are not at a point where upgrading is guaranteed to work. Making that happen is a higher priority to me than checking whether or not it works right now.",
    "created_at": "2014-04-13T10:14:09Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207775",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:36'></a>
I of course agree that this ticket was a genuine bug, and I'm happy that you fixed it. Still, we are not at a point where upgrading is guaranteed to work. Making that happen is a higher priority to me than checking whether or not it works right now.



---

archive/issue_comments_207776.json:
```json
{
    "body": "<a id='comment:37'></a>\nI almost feel like I am watching on the side while eating popcorn :) ... But that will probably create me a bit of work in sage-on-gentoo by breaking patches :P\n\nSo I will take a serious look at this because I want to clean as little as possible. Jeroen, is there a reason why you are inconsistent in removing stdc++ in extension that are marked \"language = c++\". I am presuming that stdc++ is always brought in by the c++ compiler. So, in the patch I would expect it to be removed from: \n* sage.algebras.quatalg.quaternion_algebra_element\n* sage.algebras.quatalg.quaternion_algebra_cython\n* sage.numerical.backends.glpk_graph_backend\n\nNow I will try to work through the libs on my sage-on-gentoo install which is all compiled with --as-needed and see if you got the minimal set of library. I already have an answer for the top one in your patch, gmpxx is not needed:\n\n```\nldd -r /usr/lib64/python2.7/site-packages/sage/algebras/quatalg/quaternion_algebra_element.so\n\tlinux-vdso.so.1 (0x00007fffe372b000)\n\tlibcsage.so => /usr/lib64/libcsage.so (0x00007f6d4cb06000)\n\tlibflint.so.2.4.3 => /usr/lib64/libflint.so.2.4.3 (0x00007f6d4c778000)\n\tlibgmp.so.10 => /usr/lib64/libgmp.so.10 (0x00007f6d4c507000)\n\tlibstdc++.so.6 => /usr/lib/gcc/x86_64-pc-linux-gnu/4.8.2/libstdc++.so.6 (0x00007f6d4c1ff000)\n\tlibpython2.7.so.1.0 => /usr/lib64/libpython2.7.so.1.0 (0x00007f6d4be4e000)\n\tlibc.so.6 => /lib64/libc.so.6 (0x00007f6d4baa0000)\n\tlibntl-6.1.0.so => /usr/lib64/libntl-6.1.0.so (0x00007f6d4b6fe000)\n\tlibpari-gmp.so.3 => /usr/lib64/libpari-gmp.so.3 (0x00007f6d4b0bd000)\n\tlibgcc_s.so.1 => /usr/lib/gcc/x86_64-pc-linux-gnu/4.8.2/libgcc_s.so.1 (0x00007f6d4aea5000)\n\tlibpthread.so.0 => /lib64/libpthread.so.0 (0x00007f6d4ac88000)\n\tlibmpfr.so.4 => /usr/lib64/libmpfr.so.4 (0x00007f6d4aa2d000)\n\tlibm.so.6 => /lib64/libm.so.6 (0x00007f6d4a730000)\n\t/lib64/ld-linux-x86-64.so.2 (0x00007f6d4cf88000)\n\tlibdl.so.2 => /lib64/libdl.so.2 (0x00007f6d4a52c000)\n\tlibutil.so.1 => /lib64/libutil.so.1 (0x00007f6d4a329000)\n\tlibgf2x.so.1 => /usr/lib64/libgf2x.so.1 (0x00007f6d4a113000)\n```\nAnd readelf is even more minimalist:\n\n```\nreadelf -d /usr/lib64/python2.7/site-packages/sage/algebras/quatalg/quaternion_algebra_element.so\n\nDynamic section at offset 0x26c90 contains 30 entries:\n  Tag        Type                         Name/Value\n 0x0000000000000001 (NEEDED)             Shared library: [libcsage.so]\n 0x0000000000000001 (NEEDED)             Shared library: [libflint.so.2.4.3]\n 0x0000000000000001 (NEEDED)             Shared library: [libgmp.so.10]\n 0x0000000000000001 (NEEDED)             Shared library: [libstdc++.so.6]\n 0x0000000000000001 (NEEDED)             Shared library: [libpython2.7.so.1.0]\n 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]\n 0x000000000000000c (INIT)               0x5938\n```\nlibpari probably comes through libcsage, all the rest, indirect linking...",
    "created_at": "2014-04-13T10:40:46Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207776",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:37'></a>
I almost feel like I am watching on the side while eating popcorn :) ... But that will probably create me a bit of work in sage-on-gentoo by breaking patches :P

So I will take a serious look at this because I want to clean as little as possible. Jeroen, is there a reason why you are inconsistent in removing stdc++ in extension that are marked "language = c++". I am presuming that stdc++ is always brought in by the c++ compiler. So, in the patch I would expect it to be removed from: 
* sage.algebras.quatalg.quaternion_algebra_element
* sage.algebras.quatalg.quaternion_algebra_cython
* sage.numerical.backends.glpk_graph_backend

Now I will try to work through the libs on my sage-on-gentoo install which is all compiled with --as-needed and see if you got the minimal set of library. I already have an answer for the top one in your patch, gmpxx is not needed:

```
ldd -r /usr/lib64/python2.7/site-packages/sage/algebras/quatalg/quaternion_algebra_element.so
	linux-vdso.so.1 (0x00007fffe372b000)
	libcsage.so => /usr/lib64/libcsage.so (0x00007f6d4cb06000)
	libflint.so.2.4.3 => /usr/lib64/libflint.so.2.4.3 (0x00007f6d4c778000)
	libgmp.so.10 => /usr/lib64/libgmp.so.10 (0x00007f6d4c507000)
	libstdc++.so.6 => /usr/lib/gcc/x86_64-pc-linux-gnu/4.8.2/libstdc++.so.6 (0x00007f6d4c1ff000)
	libpython2.7.so.1.0 => /usr/lib64/libpython2.7.so.1.0 (0x00007f6d4be4e000)
	libc.so.6 => /lib64/libc.so.6 (0x00007f6d4baa0000)
	libntl-6.1.0.so => /usr/lib64/libntl-6.1.0.so (0x00007f6d4b6fe000)
	libpari-gmp.so.3 => /usr/lib64/libpari-gmp.so.3 (0x00007f6d4b0bd000)
	libgcc_s.so.1 => /usr/lib/gcc/x86_64-pc-linux-gnu/4.8.2/libgcc_s.so.1 (0x00007f6d4aea5000)
	libpthread.so.0 => /lib64/libpthread.so.0 (0x00007f6d4ac88000)
	libmpfr.so.4 => /usr/lib64/libmpfr.so.4 (0x00007f6d4aa2d000)
	libm.so.6 => /lib64/libm.so.6 (0x00007f6d4a730000)
	/lib64/ld-linux-x86-64.so.2 (0x00007f6d4cf88000)
	libdl.so.2 => /lib64/libdl.so.2 (0x00007f6d4a52c000)
	libutil.so.1 => /lib64/libutil.so.1 (0x00007f6d4a329000)
	libgf2x.so.1 => /usr/lib64/libgf2x.so.1 (0x00007f6d4a113000)
```
And readelf is even more minimalist:

```
readelf -d /usr/lib64/python2.7/site-packages/sage/algebras/quatalg/quaternion_algebra_element.so

Dynamic section at offset 0x26c90 contains 30 entries:
  Tag        Type                         Name/Value
 0x0000000000000001 (NEEDED)             Shared library: [libcsage.so]
 0x0000000000000001 (NEEDED)             Shared library: [libflint.so.2.4.3]
 0x0000000000000001 (NEEDED)             Shared library: [libgmp.so.10]
 0x0000000000000001 (NEEDED)             Shared library: [libstdc++.so.6]
 0x0000000000000001 (NEEDED)             Shared library: [libpython2.7.so.1.0]
 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]
 0x000000000000000c (INIT)               0x5938
```
libpari probably comes through libcsage, all the rest, indirect linking...



---

archive/issue_comments_207777.json:
```json
{
    "body": "<a id='comment:38'></a>\nNext\n\n```\nreadelf -d /usr/lib64/python2.7/site-packages/sage/algebras/quatalg/quaternion_algebra_cython.so\n\nDynamic section at offset 0xcd18 contains 29 entries:\n  Tag        Type                         Name/Value\n 0x0000000000000001 (NEEDED)             Shared library: [libcsage.so]\n 0x0000000000000001 (NEEDED)             Shared library: [libgmp.so.10]\n 0x0000000000000001 (NEEDED)             Shared library: [libstdc++.so.6]\n 0x0000000000000001 (NEEDED)             Shared library: [libpython2.7.so.1.0]\n 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]\n 0x000000000000000c (INIT)               0x29e0\n```\nand \n\n```\nldd -r /usr/lib64/python2.7/site-packages/sage/algebras/quatalg/quaternion_algebra_cython.so\n\tlinux-vdso.so.1 (0x00007fffbb1ff000)\n\tlibcsage.so => /usr/lib64/libcsage.so (0x00007ff74c655000)\n\tlibgmp.so.10 => /usr/lib64/libgmp.so.10 (0x00007ff74c3e5000)\n\tlibstdc++.so.6 => /usr/lib/gcc/x86_64-pc-linux-gnu/4.8.2/libstdc++.so.6 (0x00007ff74c0dc000)\n\tlibpython2.7.so.1.0 => /usr/lib64/libpython2.7.so.1.0 (0x00007ff74bd2b000)\n\tlibc.so.6 => /lib64/libc.so.6 (0x00007ff74b97e000)\n\tlibntl-6.1.0.so => /usr/lib64/libntl-6.1.0.so (0x00007ff74b5db000)\n\tlibpari-gmp.so.3 => /usr/lib64/libpari-gmp.so.3 (0x00007ff74af9a000)\n\tlibgcc_s.so.1 => /usr/lib/gcc/x86_64-pc-linux-gnu/4.8.2/libgcc_s.so.1 (0x00007ff74ad83000)\n\tlibm.so.6 => /lib64/libm.so.6 (0x00007ff74aa86000)\n\t/lib64/ld-linux-x86-64.so.2 (0x00007ff74cab4000)\n\tlibpthread.so.0 => /lib64/libpthread.so.0 (0x00007ff74a869000)\n\tlibdl.so.2 => /lib64/libdl.so.2 (0x00007ff74a665000)\n\tlibutil.so.1 => /lib64/libutil.so.1 (0x00007ff74a461000)\n\tlibgf2x.so.1 => /usr/lib64/libgf2x.so.1 (0x00007ff74a24c000)\n```\nflint and gmpxx are absent.\n\n```\nreadelf -d /usr/lib64/python2.7/site-packages/sage/groups/perm_gps/partn_ref2/refinement_generic.so\n\nDynamic section at offset 0x32cd8 contains 30 entries:\n  Tag        Type                         Name/Value\n 0x0000000000000001 (NEEDED)             Shared library: [libcsage.so]\n 0x0000000000000001 (NEEDED)             Shared library: [libflint.so.2.4.3]\n 0x0000000000000001 (NEEDED)             Shared library: [libgmp.so.10]\n 0x0000000000000001 (NEEDED)             Shared library: [libpython2.7.so.1.0]\n 0x0000000000000001 (NEEDED)             Shared library: [libpthread.so.0]\n 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]\n 0x000000000000000c (INIT)               0x5ec8\n```\ngmpxx not there and in consequence stdc++ is not there either. It is brought in indirectly by ntl through flint and csage from the ldd output.\n\n```\nreadelf -d /usr/lib64/python2.7/site-packages/sage/libs/flint/flint.so\n\nDynamic section at offset 0x1da8 contains 29 entries:\n  Tag        Type                         Name/Value\n 0x0000000000000001 (NEEDED)             Shared library: [libcsage.so]\n 0x0000000000000001 (NEEDED)             Shared library: [libflint.so.2.4.3]\n 0x0000000000000001 (NEEDED)             Shared library: [libpython2.7.so.1.0]\n 0x0000000000000001 (NEEDED)             Shared library: [libpthread.so.0]\n 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]\n 0x000000000000000c (INIT)               0xf98\n```\n\nAt this stage I did a little research and found that the only extension linking directly to gmpxx is\n\n```\nFile: /usr/lib64/python2.7/site-packages/sage/modular/arithgroup/farey_symbol.so\n\nDynamic section at offset 0x42be8 contains 32 entries:\n  Tag        Type                         Name/Value\n 0x0000000000000001 (NEEDED)             Shared library: [libcsage.so]\n 0x0000000000000001 (NEEDED)             Shared library: [libgmpxx.so.4]\n 0x0000000000000001 (NEEDED)             Shared library: [libgmp.so.10]\n 0x0000000000000001 (NEEDED)             Shared library: [libstdc++.so.6]\n 0x0000000000000001 (NEEDED)             Shared library: [libpython2.7.so.1.0]\n 0x0000000000000001 (NEEDED)             Shared library: [libgcc_s.so.1]\n 0x0000000000000001 (NEEDED)             Shared library: [libpthread.so.0]\n 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]\n 0x000000000000000c (INIT)               0xbd28\n```",
    "created_at": "2014-04-13T11:02:40Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207777",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:38'></a>
Next

```
readelf -d /usr/lib64/python2.7/site-packages/sage/algebras/quatalg/quaternion_algebra_cython.so

Dynamic section at offset 0xcd18 contains 29 entries:
  Tag        Type                         Name/Value
 0x0000000000000001 (NEEDED)             Shared library: [libcsage.so]
 0x0000000000000001 (NEEDED)             Shared library: [libgmp.so.10]
 0x0000000000000001 (NEEDED)             Shared library: [libstdc++.so.6]
 0x0000000000000001 (NEEDED)             Shared library: [libpython2.7.so.1.0]
 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]
 0x000000000000000c (INIT)               0x29e0
```
and 

```
ldd -r /usr/lib64/python2.7/site-packages/sage/algebras/quatalg/quaternion_algebra_cython.so
	linux-vdso.so.1 (0x00007fffbb1ff000)
	libcsage.so => /usr/lib64/libcsage.so (0x00007ff74c655000)
	libgmp.so.10 => /usr/lib64/libgmp.so.10 (0x00007ff74c3e5000)
	libstdc++.so.6 => /usr/lib/gcc/x86_64-pc-linux-gnu/4.8.2/libstdc++.so.6 (0x00007ff74c0dc000)
	libpython2.7.so.1.0 => /usr/lib64/libpython2.7.so.1.0 (0x00007ff74bd2b000)
	libc.so.6 => /lib64/libc.so.6 (0x00007ff74b97e000)
	libntl-6.1.0.so => /usr/lib64/libntl-6.1.0.so (0x00007ff74b5db000)
	libpari-gmp.so.3 => /usr/lib64/libpari-gmp.so.3 (0x00007ff74af9a000)
	libgcc_s.so.1 => /usr/lib/gcc/x86_64-pc-linux-gnu/4.8.2/libgcc_s.so.1 (0x00007ff74ad83000)
	libm.so.6 => /lib64/libm.so.6 (0x00007ff74aa86000)
	/lib64/ld-linux-x86-64.so.2 (0x00007ff74cab4000)
	libpthread.so.0 => /lib64/libpthread.so.0 (0x00007ff74a869000)
	libdl.so.2 => /lib64/libdl.so.2 (0x00007ff74a665000)
	libutil.so.1 => /lib64/libutil.so.1 (0x00007ff74a461000)
	libgf2x.so.1 => /usr/lib64/libgf2x.so.1 (0x00007ff74a24c000)
```
flint and gmpxx are absent.

```
readelf -d /usr/lib64/python2.7/site-packages/sage/groups/perm_gps/partn_ref2/refinement_generic.so

Dynamic section at offset 0x32cd8 contains 30 entries:
  Tag        Type                         Name/Value
 0x0000000000000001 (NEEDED)             Shared library: [libcsage.so]
 0x0000000000000001 (NEEDED)             Shared library: [libflint.so.2.4.3]
 0x0000000000000001 (NEEDED)             Shared library: [libgmp.so.10]
 0x0000000000000001 (NEEDED)             Shared library: [libpython2.7.so.1.0]
 0x0000000000000001 (NEEDED)             Shared library: [libpthread.so.0]
 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]
 0x000000000000000c (INIT)               0x5ec8
```
gmpxx not there and in consequence stdc++ is not there either. It is brought in indirectly by ntl through flint and csage from the ldd output.

```
readelf -d /usr/lib64/python2.7/site-packages/sage/libs/flint/flint.so

Dynamic section at offset 0x1da8 contains 29 entries:
  Tag        Type                         Name/Value
 0x0000000000000001 (NEEDED)             Shared library: [libcsage.so]
 0x0000000000000001 (NEEDED)             Shared library: [libflint.so.2.4.3]
 0x0000000000000001 (NEEDED)             Shared library: [libpython2.7.so.1.0]
 0x0000000000000001 (NEEDED)             Shared library: [libpthread.so.0]
 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]
 0x000000000000000c (INIT)               0xf98
```

At this stage I did a little research and found that the only extension linking directly to gmpxx is

```
File: /usr/lib64/python2.7/site-packages/sage/modular/arithgroup/farey_symbol.so

Dynamic section at offset 0x42be8 contains 32 entries:
  Tag        Type                         Name/Value
 0x0000000000000001 (NEEDED)             Shared library: [libcsage.so]
 0x0000000000000001 (NEEDED)             Shared library: [libgmpxx.so.4]
 0x0000000000000001 (NEEDED)             Shared library: [libgmp.so.10]
 0x0000000000000001 (NEEDED)             Shared library: [libstdc++.so.6]
 0x0000000000000001 (NEEDED)             Shared library: [libpython2.7.so.1.0]
 0x0000000000000001 (NEEDED)             Shared library: [libgcc_s.so.1]
 0x0000000000000001 (NEEDED)             Shared library: [libpthread.so.0]
 0x0000000000000001 (NEEDED)             Shared library: [libc.so.6]
 0x000000000000000c (INIT)               0xbd28
```



---

archive/issue_comments_207778.json:
```json
{
    "body": "<a id='comment:39'></a>\nReplying to [fbissey](#comment%3A37):\n> So I will take a serious look at this because I want to clean as little as possible. Jeroen, is there a reason why you are inconsistent in removing stdc++ in extension that are marked \"language = c++\".\n\nI am consistent, but just in a different way: I only removed `stdc++` if it appears at the end of the list of libraries, because the order matters. In theory, it could be that a build breaks by changing `-lstdc++ -lmylib -lstdc++` to `-lmylib -lstdc++`, but changing `-lmylib -lstdc++ -lstdc++` to `-lmylib -lstdc++` is always safe.\n\n> I am presuming that stdc++ is always brought in by the c++ compiler.\n\nYes, if `g++` is used instead of `gcc`. I'm not entirely sure this is always the case.",
    "created_at": "2014-04-13T11:17:44Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207778",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:39'></a>
Replying to [fbissey](#comment%3A37):
> So I will take a serious look at this because I want to clean as little as possible. Jeroen, is there a reason why you are inconsistent in removing stdc++ in extension that are marked "language = c++".

I am consistent, but just in a different way: I only removed `stdc++` if it appears at the end of the list of libraries, because the order matters. In theory, it could be that a build breaks by changing `-lstdc++ -lmylib -lstdc++` to `-lmylib -lstdc++`, but changing `-lmylib -lstdc++ -lstdc++` to `-lmylib -lstdc++` is always safe.

> I am presuming that stdc++ is always brought in by the c++ compiler.

Yes, if `g++` is used instead of `gcc`. I'm not entirely sure this is always the case.



---

archive/issue_comments_207779.json:
```json
{
    "body": "<a id='comment:40'></a>\nReplying to [fbissey](#comment%3A37):\n> libpari probably comes through libcsage, all the rest, indirect linking...\n\nPlease keep in mind that linking is a very system-dependent thing. If it works on Linux doesn't mean that it will work on OS X or Cygwin.",
    "created_at": "2014-04-13T11:19:21Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207779",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:40'></a>
Replying to [fbissey](#comment%3A37):
> libpari probably comes through libcsage, all the rest, indirect linking...

Please keep in mind that linking is a very system-dependent thing. If it works on Linux doesn't mean that it will work on OS X or Cygwin.



---

archive/issue_comments_207780.json:
```json
{
    "body": "<a id='comment:41'></a>\nI'll admit I am not sure about cygwin. I am fairly confident that it will work on OS X on the other hand. As for stdc++, yes my comment assume that g++ is used, which I am expecting to be the case for anything that is marked \"language=c++\". I haven't checked that cython always uses g++ (or the C++ compiler du jour) for c++ but I would be baffled if it didn't (unless expressly instructed to use something else).",
    "created_at": "2014-04-13T11:39:23Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207780",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:41'></a>
I'll admit I am not sure about cygwin. I am fairly confident that it will work on OS X on the other hand. As for stdc++, yes my comment assume that g++ is used, which I am expecting to be the case for anything that is marked "language=c++". I haven't checked that cython always uses g++ (or the C++ compiler du jour) for c++ but I would be baffled if it didn't (unless expressly instructed to use something else).



---

archive/issue_comments_207781.json:
```json
{
    "body": "<a id='comment:42'></a>\nAs an empirical fact linking works on the buildbot...",
    "created_at": "2014-04-13T12:10:02Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207781",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:42'></a>
As an empirical fact linking works on the buildbot...



---

archive/issue_comments_207782.json:
```json
{
    "body": "<a id='comment:43'></a>\nReplying to [fbissey](#comment%3A41):\n> I'll admit I am not sure about cygwin. I am fairly confident that it will work on OS X on the other hand.\n\n\nWell, for MacOS X 10.4 at least, *provided the `install_name`s are correct*, as you know...\n\n\n\n\n> As for stdc++, yes my comment assume that g++ is used, which I am expecting to be the case for anything that is marked \"language=c++\". I haven't checked that cython always uses g++ (or the C++ compiler du jour) for c++ but I would be baffled if it didn't (unless expressly instructed to use something else).\n\n\nThere at least used to be times where that was not the case (years ago, I admit).  Another problem is (or was) that the sources of a module may consist of both C and C++ files (although you'd actually just need `g++` *for linking* unless you explicitly specify `-lstdc++`, modulo probably different include paths), but there's just one `language` tag per extension module.  Compiling C99 sources as if they were C++ with a C++98 compiler also caused a lot of trouble in the past. \n\n\n\n\n(Also `--as-needed` didn't work when I tried about four years ago, IIRC due to some implicit assumptions on the import order.  I wasted a few weeks removing and adding libraries in `module_list.py`, when Robert B. told me the mechanism was subject to change on the Cython side anyway, so I didn't pursue that further.)",
    "created_at": "2014-04-13T15:05:18Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207782",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:43'></a>
Replying to [fbissey](#comment%3A41):
> I'll admit I am not sure about cygwin. I am fairly confident that it will work on OS X on the other hand.


Well, for MacOS X 10.4 at least, *provided the `install_name`s are correct*, as you know...




> As for stdc++, yes my comment assume that g++ is used, which I am expecting to be the case for anything that is marked "language=c++". I haven't checked that cython always uses g++ (or the C++ compiler du jour) for c++ but I would be baffled if it didn't (unless expressly instructed to use something else).


There at least used to be times where that was not the case (years ago, I admit).  Another problem is (or was) that the sources of a module may consist of both C and C++ files (although you'd actually just need `g++` *for linking* unless you explicitly specify `-lstdc++`, modulo probably different include paths), but there's just one `language` tag per extension module.  Compiling C99 sources as if they were C++ with a C++98 compiler also caused a lot of trouble in the past. 




(Also `--as-needed` didn't work when I tried about four years ago, IIRC due to some implicit assumptions on the import order.  I wasted a few weeks removing and adding libraries in `module_list.py`, when Robert B. told me the mechanism was subject to change on the Cython side anyway, so I didn't pursue that further.)



---

archive/issue_comments_207783.json:
```json
{
    "body": "<a id='comment:44'></a>\nFor stdc++ I only named the one tagged with \"language=c++\". Yes there are other that include it but they have plain c sources and will be compiled with the c compiler so the extra stdc++ is necessary for them. I explicitly didn't mention them.\n\nMy comment is for those that are compiled with g++ remove it and that's the three I listed. For the other you leave them alone.\n\nI cannot tell when we started to have --as-needed working. I remember a time where it wasn't but now it definitely does.",
    "created_at": "2014-04-13T18:56:08Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207783",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:44'></a>
For stdc++ I only named the one tagged with "language=c++". Yes there are other that include it but they have plain c sources and will be compiled with the c compiler so the extra stdc++ is necessary for them. I explicitly didn't mention them.

My comment is for those that are compiled with g++ remove it and that's the three I listed. For the other you leave them alone.

I cannot tell when we started to have --as-needed working. I remember a time where it wasn't but now it definitely does.



---

archive/issue_comments_207784.json:
```json
{
    "body": "<a id='comment:45'></a>\nJohn C. just reported for 6.2.beta8 (where this ticket got merged):\n\n```\nThis is a different problem to the one I reported on the other\nsage-release thread.  On my laptop (ubuntu 12.04) I had a working\nbuild of a previous beta, I think beta6.  I pulled from trac/develop\nand ran a make.  Here's the error message:\n\n\n[ -f local/etc/sage-started.txt ] || local/bin/sage-starts\nbuild/pipestatus \"./sage --docbuild --no-pdf-links all html  2>&1\"\n\"tee -a logs/dochtml.log\"\nTraceback (most recent call last):\n  File \"/home/john/sagegit/src/doc/common/builder.py\", line 1467, in <module>\n    import sage.all\n(...)\n  File \"/home/john/sagegit/local/lib/python2.7/site-packages/sage/matrix/matrix_space.py\",\nline 48, in <module>\n    import matrix_mpolynomial_dense\nImportError: libntl.so.2: cannot open shared object file: No such file\nor directory\n```\n\nWonder what went wrong, since due to the dependency of *every* extension module on `setup.py` the *whole* Sage library should have gotten rebuilt.",
    "created_at": "2014-04-17T12:26:27Z",
    "issue": "https://github.com/sagemath/sage/issues/16105",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16105#issuecomment-207784",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:45'></a>
John C. just reported for 6.2.beta8 (where this ticket got merged):

```
This is a different problem to the one I reported on the other
sage-release thread.  On my laptop (ubuntu 12.04) I had a working
build of a previous beta, I think beta6.  I pulled from trac/develop
and ran a make.  Here's the error message:


[ -f local/etc/sage-started.txt ] || local/bin/sage-starts
build/pipestatus "./sage --docbuild --no-pdf-links all html  2>&1"
"tee -a logs/dochtml.log"
Traceback (most recent call last):
  File "/home/john/sagegit/src/doc/common/builder.py", line 1467, in <module>
    import sage.all
(...)
  File "/home/john/sagegit/local/lib/python2.7/site-packages/sage/matrix/matrix_space.py",
line 48, in <module>
    import matrix_mpolynomial_dense
ImportError: libntl.so.2: cannot open shared object file: No such file
or directory
```

Wonder what went wrong, since due to the dependency of *every* extension module on `setup.py` the *whole* Sage library should have gotten rebuilt.
