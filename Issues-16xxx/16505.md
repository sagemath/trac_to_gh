# Issue 16505: Add unset_cache() to remove single keys from a cached_method

archive/issues_016268.json:
```json
{
    "body": "A `cached_method`'s `clear_cache()` clears the entire dictionary of a `cached_method`. Currently, there is no way to only remove some keys. This is sometimes necessary if values in the cache are not usable anymore (e.g. because they are defined in some external expect interface but the external session is not running anymore).\n\nKeywords: cached_method\n\nAuthor: Julian Rueth\n\nBranch: u/saraedum/ticket/16505\n\nStatus: needs_work\n\nCommit: 9cee22e0b83fb18a699df9d898f5d437b5cdb2a2\n\nIssue created by migration from https://trac.sagemath.org/ticket/16505\n\n",
    "created_at": "2014-06-20T18:54:16Z",
    "labels": [
        "component: misc",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.0",
    "title": "Add unset_cache() to remove single keys from a cached_method",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16505",
    "user": "https://github.com/saraedum"
}
```
A `cached_method`'s `clear_cache()` clears the entire dictionary of a `cached_method`. Currently, there is no way to only remove some keys. This is sometimes necessary if values in the cache are not usable anymore (e.g. because they are defined in some external expect interface but the external session is not running anymore).

Keywords: cached_method

Author: Julian Rueth

Branch: u/saraedum/ticket/16505

Status: needs_work

Commit: 9cee22e0b83fb18a699df9d898f5d437b5cdb2a2

Issue created by migration from https://trac.sagemath.org/ticket/16505





---

archive/issue_comments_226685.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-06-20T19:33:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16505#issuecomment-226685",
    "user": "https://github.com/saraedum"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_226686.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,6 +1,4 @@\n A `cached_method`'s `clear_cache()` clears the entire dictionary of a `cached_method`. Currently, there is no way to only remove some keys. This is sometimes necessary if values in the cache are not usable anymore (e.g. because they are defined in some external expect interface but the external session is not running anymore, #16369).\n-\n-This tickets adds an optional parameter to `clear_cache()` which removes only the specified keys from the dictionary.\n \n Author: Julian Rueth\n \n```\n",
    "created_at": "2014-06-20T19:33:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16505#issuecomment-226686",
    "user": "https://github.com/saraedum"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,6 +1,4 @@
 A `cached_method`'s `clear_cache()` clears the entire dictionary of a `cached_method`. Currently, there is no way to only remove some keys. This is sometimes necessary if values in the cache are not usable anymore (e.g. because they are defined in some external expect interface but the external session is not running anymore, #16369).
-
-This tickets adds an optional parameter to `clear_cache()` which removes only the specified keys from the dictionary.
 
 Author: Julian Rueth
 
```




---

archive/issue_comments_226687.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-06-23T02:14:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16505#issuecomment-226687",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_226688.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-\n+A `cached_method`'s `clear_cache()` clears the entire dictionary of a `cached_method`. Currently, there is no way to only remove some keys. This is sometimes necessary if values in the cache are not usable anymore (e.g. because they are defined in some external expect interface but the external session is not running anymore).\n \n Author: Julian Rueth\n \n```\n",
    "created_at": "2014-07-23T17:32:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16505#issuecomment-226688",
    "user": "https://github.com/saraedum"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,4 @@
-
+A `cached_method`'s `clear_cache()` clears the entire dictionary of a `cached_method`. Currently, there is no way to only remove some keys. This is sometimes necessary if values in the cache are not usable anymore (e.g. because they are defined in some external expect interface but the external session is not running anymore).
 
 Author: Julian Rueth
 
```




---

archive/issue_comments_226689.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-07-23T17:33:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16505#issuecomment-226689",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_048490.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16505",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16505#event-48490"
}
```



---

archive/issue_comments_226690.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-01-10T07:14:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16505#issuecomment-226690",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_226691.json:
```json
{
    "body": "<a id='comment:7'></a>From the looks of the function `set_cache` just above the one that you define, it seems that you should also handle the case of non-hashable keys.\n\nNathann",
    "created_at": "2015-01-10T07:14:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16505#issuecomment-226691",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:7'></a>From the looks of the function `set_cache` just above the one that you define, it seems that you should also handle the case of non-hashable keys.

Nathann



---

archive/issue_comments_226692.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-12-23T18:54:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16505#issuecomment-226692",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_226693.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-12-23T19:00:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16505#issuecomment-226693",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_226694.json:
```json
{
    "body": "<a id='comment:10'></a>Please rebase this on top of #19768.",
    "created_at": "2015-12-23T19:09:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16505#issuecomment-226694",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>Please rebase this on top of #19768.



---

archive/issue_comments_226695.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-01-09T05:23:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16505#issuecomment-226695",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_226696.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-01-09T05:27:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16505#issuecomment-226696",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_226697.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-01-09T06:59:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16505#issuecomment-226697",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_226698.json:
```json
{
    "body": "<a id='comment:15'></a>Please use the `get_key_args_kwds()` and `dict_key()` functions added recently to cached functions.",
    "created_at": "2016-01-09T08:17:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16505#issuecomment-226698",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>Please use the `get_key_args_kwds()` and `dict_key()` functions added recently to cached functions.



---

archive/issue_events_048491.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-01-09T08:22:15Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16505",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16505#event-48491"
}
```



---

archive/issue_events_048492.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-01-09T08:22:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16505",
    "milestone": "sage-7.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16505#event-48492"
}
```



---

archive/issue_comments_226699.json:
```json
{
    "body": "Replying to [ticket:16505 saraedum]:\n> Currently, there is no way to only remove some keys. This is sometimes necessary if values in the cache are not usable anymore\n\n\nFor this use case, I see no reason to raise `KeyError` when the key does not exist: I would just ignore non-existing keys.\n\nYou should add doctests showing that this also works for a weak cached function and a cached method (not just plain cached functions).",
    "created_at": "2016-01-09T08:22:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16505#issuecomment-226699",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:16505 saraedum]:
> Currently, there is no way to only remove some keys. This is sometimes necessary if values in the cache are not usable anymore


For this use case, I see no reason to raise `KeyError` when the key does not exist: I would just ignore non-existing keys.

You should add doctests showing that this also works for a weak cached function and a cached method (not just plain cached functions).



---

archive/issue_comments_226700.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-01-09T08:22:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16505#issuecomment-226700",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.
