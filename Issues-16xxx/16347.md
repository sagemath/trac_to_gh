# Issue 16347: Wilson's constructions of OA with 2 truncated groups

archive/issues_016110.json:
```json
{
    "body": "CC:  @videlec @KPanComputes @dimpase\n\nHeeeeeeeere it is ! The new construction !\n\nAs a result, the MOLS table really took a lifetime to fill. This is fixed by caching the OA that Sage can build, a new feature from #16460.\n\nNathann\n\nIssue created by migration from https://trac.sagemath.org/ticket/16347\n\n",
    "closed_at": "2014-06-26T01:50:37Z",
    "created_at": "2014-05-13T13:58:30Z",
    "labels": [
        "component: combinatorial designs"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.3",
    "title": "Wilson's constructions of OA with 2 truncated groups",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16347",
    "user": "https://github.com/nathanncohen"
}
```
CC:  @videlec @KPanComputes @dimpase

Heeeeeeeere it is ! The new construction !

As a result, the MOLS table really took a lifetime to fill. This is fixed by caching the OA that Sage can build, a new feature from #16460.

Nathann

Issue created by migration from https://trac.sagemath.org/ticket/16347





---

archive/issue_comments_209841.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-05-13T13:58:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16347#issuecomment-209841",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_209842.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2014-05-13T13:59:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16347#issuecomment-209842",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_209843.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-05-14T09:40:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16347#issuecomment-209843",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_209844.json:
```json
{
    "body": "Changing component from combinatorics to combinatorial designs.",
    "created_at": "2014-05-16T21:14:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16347#issuecomment-209844",
    "user": "https://github.com/nathanncohen"
}
```

Changing component from combinatorics to combinatorial designs.



---

archive/issue_comments_209845.json:
```json
{
    "body": "With this updated patch, we only have one version of `wilson_construction` which can handle 0,1 or 2 truncated columns. It can actually handle much more situations that will appear in new constructions I am writing these days. I think that it is a much cleaner code `:-)`\n\nThe two function which look for decomposition of integers are left as they are, they are still useful : they find sets of parameters with which the new `wilson_construction` function is to be fed.\n\nNathann",
    "created_at": "2014-05-29T19:39:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16347#issuecomment-209845",
    "user": "https://github.com/nathanncohen"
}
```

With this updated patch, we only have one version of `wilson_construction` which can handle 0,1 or 2 truncated columns. It can actually handle much more situations that will appear in new constructions I am writing these days. I think that it is a much cleaner code `:-)`

The two function which look for decomposition of integers are left as they are, they are still useful : they find sets of parameters with which the new `wilson_construction` function is to be fed.

Nathann



---

archive/issue_comments_209846.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-29T19:40:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16347#issuecomment-209846",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_209847.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-06-02T13:20:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16347#issuecomment-209847",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_209848.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2014-06-05T13:51:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16347#issuecomment-209848",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_209849.json:
```json
{
    "body": "Hi Nathann,\n\nI do not like the fact that we would have to cache everything. Could we instead cache the construction? In other words, have a function\n\n```\n@cached_function\ndef orthogonal_array_construction(n):\n    r\"\"\"\n    Return a triple `(k,f,args)` such that `k` is the maximum value\n    such that Sage knows how to build a `OA(k,n)` and `f(*args)` actually\n    return this `OA(k,n)`.\n    \"\"\"\n```\nAdvantages:\n- that function can be use to speed up both boolean and designs answers of `orthogonal_array`.\n- we can remove the current cache from `find_wilson_decomposition*` and `TD_find_product_decomposition`\n- it might be used later on to draw the tree of constructions.\n\nI am not sure it is feasible, but without thinking too much, it looks like a good solution.\n\nVincent",
    "created_at": "2014-06-05T13:51:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16347#issuecomment-209849",
    "user": "https://github.com/videlec"
}
```

Hi Nathann,

I do not like the fact that we would have to cache everything. Could we instead cache the construction? In other words, have a function

```
@cached_function
def orthogonal_array_construction(n):
    r"""
    Return a triple `(k,f,args)` such that `k` is the maximum value
    such that Sage knows how to build a `OA(k,n)` and `f(*args)` actually
    return this `OA(k,n)`.
    """
```
Advantages:
- that function can be use to speed up both boolean and designs answers of `orthogonal_array`.
- we can remove the current cache from `find_wilson_decomposition*` and `TD_find_product_decomposition`
- it might be used later on to draw the tree of constructions.

I am not sure it is feasible, but without thinking too much, it looks like a good solution.

Vincent



---

archive/issue_comments_209850.json:
```json
{
    "body": "Yo !\n\n> I do not like the fact that we would have to cache everything.\n\n\nCould you have missed the 10 000 posts about a new flag for the `@`cached_method decorator ?\n\n> Could we instead cache the construction? In other words, have a function\n> \n> ```\n> @cached_function\n> def orthogonal_array_construction(n):\n>     r\"\"\"\n>     Return a triple `(k,f,args)` such that `k` is the maximum value\n>     such that Sage knows how to build a `OA(k,n)` and `f(*args)` actually\n>     return this `OA(k,n)`.\n>     \"\"\"\n> ```\n\n\nYou should not compute the largest k if you do not need to. If your function takes both k and n as an argument then it is Volker's idea.\n\nIt actually isn't a bad idea, if not for the fact that there is no reason why we should go that far to implement a caching mechanism in combinat.designs while the caching mechanism has nothing to do with designs.\n\nThe \"clean/proper\" solution is to implement a real caching mechanism for designs which takes k,n as input and answer accordingly, by only storing for each n the largest k that has been built so far, and the smallest k such that it has been proved that no OA(k,n) could built so far.\n\nThis is what I want to do eventually, but I first wanted to get the actual constructions in ..... This is not a definitive solution but it is not the moment to implement a caching mechanism either... There are features to get in, really ...\n\nNathann\n\nP.S. : When I say eventually I do not say \"in two years\". I say --> as soon as all the current patches are merged into Sage, along with the 4 constructions I have been keeping on my hard drive waiting for all these patches to be reviewed.",
    "created_at": "2014-06-05T14:02:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16347#issuecomment-209850",
    "user": "https://github.com/nathanncohen"
}
```

Yo !

> I do not like the fact that we would have to cache everything.


Could you have missed the 10 000 posts about a new flag for the `@`cached_method decorator ?

> Could we instead cache the construction? In other words, have a function
> 
> ```
> @cached_function
> def orthogonal_array_construction(n):
>     r"""
>     Return a triple `(k,f,args)` such that `k` is the maximum value
>     such that Sage knows how to build a `OA(k,n)` and `f(*args)` actually
>     return this `OA(k,n)`.
>     """
> ```


You should not compute the largest k if you do not need to. If your function takes both k and n as an argument then it is Volker's idea.

It actually isn't a bad idea, if not for the fact that there is no reason why we should go that far to implement a caching mechanism in combinat.designs while the caching mechanism has nothing to do with designs.

The "clean/proper" solution is to implement a real caching mechanism for designs which takes k,n as input and answer accordingly, by only storing for each n the largest k that has been built so far, and the smallest k such that it has been proved that no OA(k,n) could built so far.

This is what I want to do eventually, but I first wanted to get the actual constructions in ..... This is not a definitive solution but it is not the moment to implement a caching mechanism either... There are features to get in, really ...

Nathann

P.S. : When I say eventually I do not say "in two years". I say --> as soon as all the current patches are merged into Sage, along with the 4 constructions I have been keeping on my hard drive waiting for all these patches to be reviewed.



---

archive/issue_comments_209851.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2014-06-05T14:14:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16347#issuecomment-209851",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_209852.json:
```json
{
    "body": "Oh, I forgot something : the other solution is of course to implement a `@`cached_method_with_conditions decorator which can filter the input.\n\nNathann",
    "created_at": "2014-06-05T14:15:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16347#issuecomment-209852",
    "user": "https://github.com/nathanncohen"
}
```

Oh, I forgot something : the other solution is of course to implement a `@`cached_method_with_conditions decorator which can filter the input.

Nathann



---

archive/issue_comments_209853.json:
```json
{
    "body": "It is now implemented in #16353 but Volker introduced a notion of morality in computer science and it seems that one is not allowed to write a function that could be used for possibly dark deeds.\n\nNathann",
    "created_at": "2014-06-05T16:19:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16347#issuecomment-209853",
    "user": "https://github.com/nathanncohen"
}
```

It is now implemented in #16353 but Volker introduced a notion of morality in computer science and it seems that one is not allowed to write a function that could be used for possibly dark deeds.

Nathann



---

archive/issue_comments_209854.json:
```json
{
    "body": "I actually developed the same idea as yours while thinking a bit more about it. What we want to cache is something like `n -> (k1,OA,k2)` where `OA` is a OA(k1,n) and `k2` is such that Sage does not know how to compute OA(k2,n). And this feature looks very specific to design and I do not see how a decorator can handle that nicely.\n\nSo, if you are willing to use these `@`cached_method everywhere or even the one you wrote in #16353, there is a need for a big **TODO** saying that it is here for quick-and-dirty speedup.\n\nSo let's not talk to much about caching right now, I will look at the construction.\n\nVincent",
    "created_at": "2014-06-05T16:29:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16347#issuecomment-209854",
    "user": "https://github.com/videlec"
}
```

I actually developed the same idea as yours while thinking a bit more about it. What we want to cache is something like `n -> (k1,OA,k2)` where `OA` is a OA(k1,n) and `k2` is such that Sage does not know how to compute OA(k2,n). And this feature looks very specific to design and I do not see how a decorator can handle that nicely.

So, if you are willing to use these `@`cached_method everywhere or even the one you wrote in #16353, there is a need for a big **TODO** saying that it is here for quick-and-dirty speedup.

So let's not talk to much about caching right now, I will look at the construction.

Vincent



---

archive/issue_comments_209855.json:
```json
{
    "body": "Yo !\n\n> I actually developed the same idea as yours while thinking a bit more about it. What we want to cache is something like `n -> (k1,OA,k2)` where `OA` is a OA(k1,n) and `k2` is such that Sage does not know how to compute OA(k2,n). And this feature looks very specific to design and I do not see how a decorator can handle that nicely.\n\n\nYes of course, this would be design-specific.\n\n> So, if you are willing to use these `@`cached_method everywhere or even the one you wrote in #16353, there is a need for a big **TODO** saying that it is here for quick-and-dirty speedup.\n\n\nWhat was done here is quick but not dirty. We cache too much, but that's much better than not caching anything at all because all functions would become useless. What I implemented in #16353 is NOT quick and dirty, it is the most generic way to solve our problem here. Anything more would be design-specific and that's where it would actually become to be ugly, because it would just be \"for our own purposes\" with global variabls everywhere ....\n\n> So let's not talk to much about caching right now, I will look at the construction.\n\n\nYes, please do. But remember that there are many dependencies to this patch that have to be reviewed first.\n\nNathann",
    "created_at": "2014-06-05T16:33:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16347#issuecomment-209855",
    "user": "https://github.com/nathanncohen"
}
```

Yo !

> I actually developed the same idea as yours while thinking a bit more about it. What we want to cache is something like `n -> (k1,OA,k2)` where `OA` is a OA(k1,n) and `k2` is such that Sage does not know how to compute OA(k2,n). And this feature looks very specific to design and I do not see how a decorator can handle that nicely.


Yes of course, this would be design-specific.

> So, if you are willing to use these `@`cached_method everywhere or even the one you wrote in #16353, there is a need for a big **TODO** saying that it is here for quick-and-dirty speedup.


What was done here is quick but not dirty. We cache too much, but that's much better than not caching anything at all because all functions would become useless. What I implemented in #16353 is NOT quick and dirty, it is the most generic way to solve our problem here. Anything more would be design-specific and that's where it would actually become to be ugly, because it would just be "for our own purposes" with global variabls everywhere ....

> So let's not talk to much about caching right now, I will look at the construction.


Yes, please do. But remember that there are many dependencies to this patch that have to be reviewed first.

Nathann



---

archive/issue_comments_209856.json:
```json
{
    "body": "Rebased on top of #16373, all in one commit !\n\nNathann",
    "created_at": "2014-06-13T11:00:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16347#issuecomment-209856",
    "user": "https://github.com/nathanncohen"
}
```

Rebased on top of #16373, all in one commit !

Nathann



---

archive/issue_comments_209857.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2014-06-13T11:01:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16347#issuecomment-209857",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_209858.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-06-19T14:50:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16347#issuecomment-209858",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_209859.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2014-06-23T20:43:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16347#issuecomment-209859",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_209860.json:
```json
{
    "body": "Hi Nathann,\n\nI did several things at `public/16347`. But I still need to understand more the Wilson construction.\n\nThe only construction that does not belong to `orthogonal_array` is the product construction (which can be seen as a particular case of wilson construction). What do you think if we move it to `orthogonal_array` and remove the `who_asked` stuff? It would be much more readable.\n\nEDIT: more precisely, all constructions in `mutually_orthogonal_latin_squares` and `transversal_design` comes from the database except the product construction. As your Wilson construction can be used for the product we can move **all** recursive constructions in `orthogonal_array` and remove the `who_asked` argument in all these functions.\n\nVincent",
    "created_at": "2014-06-23T20:43:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16347#issuecomment-209860",
    "user": "https://github.com/videlec"
}
```

Hi Nathann,

I did several things at `public/16347`. But I still need to understand more the Wilson construction.

The only construction that does not belong to `orthogonal_array` is the product construction (which can be seen as a particular case of wilson construction). What do you think if we move it to `orthogonal_array` and remove the `who_asked` stuff? It would be much more readable.

EDIT: more precisely, all constructions in `mutually_orthogonal_latin_squares` and `transversal_design` comes from the database except the product construction. As your Wilson construction can be used for the product we can move **all** recursive constructions in `orthogonal_array` and remove the `who_asked` argument in all these functions.

Vincent



---

archive/issue_comments_209861.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2014-06-24T08:24:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16347#issuecomment-209861",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_209862.json:
```json
{
    "body": "Yo !\n\n> I did several things at `public/16347`. But I still need to understand more the Wilson construction.\n\n\nI took a picture of a drawing I made, hoping that it helps.\n\nhttp://www.steinertriples.fr/ncohen/tmp/photo1.jpg\n\n> The only construction that does not belong to `orthogonal_array` is the product construction (which can be seen as a particular case of wilson construction). What do you think if we move it to `orthogonal_array` and remove the `who_asked` stuff? It would be much more readable.\n\n\nI agree, I agree. I intended to do this at some point, but.. Well... When the current patches will be reviewed, etc etc ...\n\nActually, tickets #16500 and #16503 create a file named `orthogonal_arrays_recursive.py` which contain many pairs construction/find_parameters. I intended to move the \"find decompositions\" that we already have in other files there (e.g. the one implemented here, and the `find_product_decomposition`), and indeed to rewrite this last TD construction for OA.\n\nIt will be done. For everty patch that you review I will write another one that does one of these things `:-P`\n\nNathann\n\n---\nNew commits:",
    "created_at": "2014-06-24T08:24:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16347#issuecomment-209862",
    "user": "https://github.com/nathanncohen"
}
```

Yo !

> I did several things at `public/16347`. But I still need to understand more the Wilson construction.


I took a picture of a drawing I made, hoping that it helps.

http://www.steinertriples.fr/ncohen/tmp/photo1.jpg

> The only construction that does not belong to `orthogonal_array` is the product construction (which can be seen as a particular case of wilson construction). What do you think if we move it to `orthogonal_array` and remove the `who_asked` stuff? It would be much more readable.


I agree, I agree. I intended to do this at some point, but.. Well... When the current patches will be reviewed, etc etc ...

Actually, tickets #16500 and #16503 create a file named `orthogonal_arrays_recursive.py` which contain many pairs construction/find_parameters. I intended to move the "find decompositions" that we already have in other files there (e.g. the one implemented here, and the `find_product_decomposition`), and indeed to rewrite this last TD construction for OA.

It will be done. For everty patch that you review I will write another one that does one of these things `:-P`

Nathann

---
New commits:



---

archive/issue_comments_209863.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-06-24T11:33:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16347#issuecomment-209863",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_209864.json:
```json
{
    "body": "More changes on public if you agree...\n\nQuestions:\n- I do not understand why you output `n` in `find_wilson_decomposition_with_one_truncated_group`\n- I do not understand why you output `k` in `find_wilson_decomposition_with_two_truncated_groups`\n\nI would rather output `(r,m,(r1,))` and `(r,m,(r1,r2))`. That way the call would be uniform in `orthogonal_array`... and you should decide between `r1,r2` and `u1,u2`.\n\nVincent\n\nPS: right now I am going to teach ctypes and cython, so I will not look at it again until tonight.",
    "created_at": "2014-06-24T11:33:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16347#issuecomment-209864",
    "user": "https://github.com/videlec"
}
```

More changes on public if you agree...

Questions:
- I do not understand why you output `n` in `find_wilson_decomposition_with_one_truncated_group`
- I do not understand why you output `k` in `find_wilson_decomposition_with_two_truncated_groups`

I would rather output `(r,m,(r1,))` and `(r,m,(r1,r2))`. That way the call would be uniform in `orthogonal_array`... and you should decide between `r1,r2` and `u1,u2`.

Vincent

PS: right now I am going to teach ctypes and cython, so I will not look at it again until tonight.



---

archive/issue_comments_209865.json:
```json
{
    "body": "Yo !\n\n> More changes on public if you agree...\n\n\nThey look good ! Except for tho things :\n\n```\nFinds a wilson decomposition to build an `OA(k,n)` with one truncated column\n```\n\nHere one can understand that the purpose of the function is to build a truncated OA....\n\n```\n+    Then there exists an `OA(k,rm+\\sum u_i)`. This construction is a\n+    straightforward generalization of Lemma 3.16 of [HananiBIBD]_.\n```\n\nIt is only straightforward when one tells you what there is to find `:-P`\n\n> - I do not understand why you output `n` in `find_wilson_decomposition_with_one_truncated_group`\n> - I do not understand why you output `k` in `find_wilson_decomposition_with_two_truncated_groups`\n\n\nHistorical resons I would say. You just changed the inputs used by Wilson's construction, I did it too before, and I did not think necessary to update the related functions ...\n\n> I would rather output `(r,m,(r1,))` and `(r,m,(r1,r2))`. That way the call would be uniform in `orthogonal_array`... and you should decide between `r1,r2` and `u1,u2`.\n\n\nIf you sleep better this way you can update them. Really it is only internal stuff, I thought that we could make them private functions at some point.. I do not care as long as the designs are produced `:-P`\n\nBy the way, #16500 defines a `find_recursive_construction` is `orthogonal_array_recursive.py` which calls all recursive constructions. The plan was to move the two `find_wilson_decomposition*` to this file later, and this will require to change their output again.\n\n> PS: right now I am going to teach ctypes and cython, so I will not look at it again until tonight.\n\n\nGood luck ! And show them \n\n```\nsage -cython -a my_file.pyx # produces a html file whose lines are clickable\n```\nthat's really cool !\n\nNathann",
    "created_at": "2014-06-24T12:01:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16347#issuecomment-209865",
    "user": "https://github.com/nathanncohen"
}
```

Yo !

> More changes on public if you agree...


They look good ! Except for tho things :

```
Finds a wilson decomposition to build an `OA(k,n)` with one truncated column
```

Here one can understand that the purpose of the function is to build a truncated OA....

```
+    Then there exists an `OA(k,rm+\sum u_i)`. This construction is a
+    straightforward generalization of Lemma 3.16 of [HananiBIBD]_.
```

It is only straightforward when one tells you what there is to find `:-P`

> - I do not understand why you output `n` in `find_wilson_decomposition_with_one_truncated_group`
> - I do not understand why you output `k` in `find_wilson_decomposition_with_two_truncated_groups`


Historical resons I would say. You just changed the inputs used by Wilson's construction, I did it too before, and I did not think necessary to update the related functions ...

> I would rather output `(r,m,(r1,))` and `(r,m,(r1,r2))`. That way the call would be uniform in `orthogonal_array`... and you should decide between `r1,r2` and `u1,u2`.


If you sleep better this way you can update them. Really it is only internal stuff, I thought that we could make them private functions at some point.. I do not care as long as the designs are produced `:-P`

By the way, #16500 defines a `find_recursive_construction` is `orthogonal_array_recursive.py` which calls all recursive constructions. The plan was to move the two `find_wilson_decomposition*` to this file later, and this will require to change their output again.

> PS: right now I am going to teach ctypes and cython, so I will not look at it again until tonight.


Good luck ! And show them 

```
sage -cython -a my_file.pyx # produces a html file whose lines are clickable
```
that's really cool !

Nathann



---

archive/issue_comments_209866.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-06-24T22:08:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16347#issuecomment-209866",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_209867.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-06-24T23:02:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16347#issuecomment-209867",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_209868.json:
```json
{
    "body": "Hi Nathann,\n\nIt is much clearer now without the `who_asked`. I did a bit of speedup in `find_wilson_*` and the test in `latin_squares` run in 11sec instead of 17sec. Not yet marvelous but not bad. It would be nice to spend some time there as most of the time is clearly spent in looking for decompositions.\n\n(I messed up the case of `k=1` in the intermediate commit... so they are not relevant)\n\nVincent",
    "created_at": "2014-06-24T23:06:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16347#issuecomment-209868",
    "user": "https://github.com/videlec"
}
```

Hi Nathann,

It is much clearer now without the `who_asked`. I did a bit of speedup in `find_wilson_*` and the test in `latin_squares` run in 11sec instead of 17sec. Not yet marvelous but not bad. It would be nice to spend some time there as most of the time is clearly spent in looking for decompositions.

(I messed up the case of `k=1` in the intermediate commit... so they are not relevant)

Vincent



---

archive/issue_comments_209869.json:
```json
{
    "body": "Yo.\n\n> It is much clearer now without the `who_asked`. I did a bit of speedup in `find_wilson_*` and the test in `latin_squares` run in 11sec instead of 17sec. Not yet marvelous but not bad. It would be nice to spend some time there as most of the time is clearly spent in looking for decompositions.\n> \n> (I messed up the case of `k=1` in the intermediate commit... so they are not relevant)\n\n\nSeveral values decreased in the table of mols.\n\nBtw, you should have opened another ticket to remove `who_asked` and move functions around.\n\nNathann",
    "created_at": "2014-06-25T07:56:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16347#issuecomment-209869",
    "user": "https://github.com/nathanncohen"
}
```

Yo.

> It is much clearer now without the `who_asked`. I did a bit of speedup in `find_wilson_*` and the test in `latin_squares` run in 11sec instead of 17sec. Not yet marvelous but not bad. It would be nice to spend some time there as most of the time is clearly spent in looking for decompositions.
> 
> (I messed up the case of `k=1` in the intermediate commit... so they are not relevant)


Several values decreased in the table of mols.

Btw, you should have opened another ticket to remove `who_asked` and move functions around.

Nathann



---

archive/issue_comments_209870.json:
```json
{
    "body": "What the hell is this `find_wilson_decomposition` function ? I told you that I had already written the very same thing in #16500 !!\n\nNathann",
    "created_at": "2014-06-25T08:01:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16347#issuecomment-209870",
    "user": "https://github.com/nathanncohen"
}
```

What the hell is this `find_wilson_decomposition` function ? I told you that I had already written the very same thing in #16500 !!

Nathann



---

archive/issue_comments_209871.json:
```json
{
    "body": "Okay, could you move the last two commits to a different patch, *above* those that are aready in `needs_review` ?\n\nNathann",
    "created_at": "2014-06-25T08:06:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16347#issuecomment-209871",
    "user": "https://github.com/nathanncohen"
}
```

Okay, could you move the last two commits to a different patch, *above* those that are aready in `needs_review` ?

Nathann



---

archive/issue_comments_209872.json:
```json
{
    "body": "All right...",
    "created_at": "2014-06-25T09:16:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16347#issuecomment-209872",
    "user": "https://github.com/videlec"
}
```

All right...



---

archive/issue_comments_209873.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-06-25T09:27:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16347#issuecomment-209873",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_209874.json:
```json
{
    "body": "Hi Nathann,\n\nThere is something that I do not understand. After the merge of #16430 the MOLS table gets better... but it is fake\n\n```\nsage: designs.orthogonal_array(8,66,existence=True)\nTrue\nsage: designs.orthogonal_array(8,66)\nTraceback (most recent call last):\n...\nAssertionError\n```\n\nSo please do the merge yourself from f5069f0. I will adapt the review from there.\n\nVincent",
    "created_at": "2014-06-25T09:27:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16347#issuecomment-209874",
    "user": "https://github.com/videlec"
}
```

Hi Nathann,

There is something that I do not understand. After the merge of #16430 the MOLS table gets better... but it is fake

```
sage: designs.orthogonal_array(8,66,existence=True)
True
sage: designs.orthogonal_array(8,66)
Traceback (most recent call last):
...
AssertionError
```

So please do the merge yourself from f5069f0. I will adapt the review from there.

Vincent



---

archive/issue_comments_209875.json:
```json
{
    "body": "Yo !\n\n> So please do the merge yourself from f5069f0.\n\n\n....\n\nNow I have to fix the bugs you meet when you do a merge ?...\n\nNathann",
    "created_at": "2014-06-25T09:41:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16347#issuecomment-209875",
    "user": "https://github.com/nathanncohen"
}
```

Yo !

> So please do the merge yourself from f5069f0.


....

Now I have to fix the bugs you meet when you do a merge ?...

Nathann



---

archive/issue_comments_209876.json:
```json
{
    "body": "Replying to [comment:38 ncohen]:\n> Yo !\n> \n> > So please do the merge yourself from f5069f0.\n\n> \n> ....\n> \n> Now I have to fix the bugs you meet when you do a merge ?...\n\n\nNope. The merge with #16430 just fails. f5069f0 is your commit before I started the review. I can dig to find what is the problem here but you should be able to find better than me what is the problem...",
    "created_at": "2014-06-25T09:45:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16347#issuecomment-209876",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:38 ncohen]:
> Yo !
> 
> > So please do the merge yourself from f5069f0.

> 
> ....
> 
> Now I have to fix the bugs you meet when you do a merge ?...


Nope. The merge with #16430 just fails. f5069f0 is your commit before I started the review. I can dig to find what is the problem here but you should be able to find better than me what is the problem...



---

archive/issue_comments_209877.json:
```json
{
    "body": "Okay, here it is. There was a problem in `find_wilson_decomposition_with_two_truncated_groups`, a variable was being assigned negative values.\n\nFixed in the updated branch which rebases history. I will also need to rewrite the branches above this one.\n\nNathann\n\nP.S. : I pushed the changes on u/ncohen/16347 because pushing on the public one may have deleted commits, though you probably have them on your computer.",
    "created_at": "2014-06-25T10:00:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16347#issuecomment-209877",
    "user": "https://github.com/nathanncohen"
}
```

Okay, here it is. There was a problem in `find_wilson_decomposition_with_two_truncated_groups`, a variable was being assigned negative values.

Fixed in the updated branch which rebases history. I will also need to rewrite the branches above this one.

Nathann

P.S. : I pushed the changes on u/ncohen/16347 because pushing on the public one may have deleted commits, though you probably have them on your computer.



---

archive/issue_comments_209878.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-06-25T10:00:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16347#issuecomment-209878",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_209879.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-06-25T10:01:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16347#issuecomment-209879",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_209880.json:
```json
{
    "body": "Thank you!",
    "created_at": "2014-06-25T10:05:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16347#issuecomment-209880",
    "user": "https://github.com/videlec"
}
```

Thank you!



---

archive/issue_comments_209881.json:
```json
{
    "body": "More reasonable review at `public/16347-bis`. If you like it enough, set to positive review.\n\nVincent",
    "created_at": "2014-06-25T10:49:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16347#issuecomment-209881",
    "user": "https://github.com/videlec"
}
```

More reasonable review at `public/16347-bis`. If you like it enough, set to positive review.

Vincent



---

archive/issue_comments_209882.json:
```json
{
    "body": "Yo !\n\n> More reasonable review at `public/16347-bis`. If you like it enough, set to positive review.\n\n\nI agree with the latest two commits but when it comes to the modifications made in `find_wilson_decomposition_with_two_truncated_groups` I believe that you are really making the code harder to read for almost no improvement. You add 6 lines to replace one, and this only to avoid calling `orthogonal_arrays` several times, knowing that all calls would answer instantly (they do the check that \"n<=1 or k<n+1\" each time).\n\nWhen `n` is not a prime power, I expect that `orthogonal_array(n+1,n,existence=True)` is much more costly than all `orthogonal_array(n+1,n_prime,existence=True)` for `n_prime<n` combined (all straightforward 'no').\n\nReally, that's not where the performance is hidden. The next patch improves things a lot, and the next patch on recursive constructions make things a lot worse. There will be profiling to do there, but really that's not where performance is to be found.\n\nNathann",
    "created_at": "2014-06-25T11:11:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16347#issuecomment-209882",
    "user": "https://github.com/nathanncohen"
}
```

Yo !

> More reasonable review at `public/16347-bis`. If you like it enough, set to positive review.


I agree with the latest two commits but when it comes to the modifications made in `find_wilson_decomposition_with_two_truncated_groups` I believe that you are really making the code harder to read for almost no improvement. You add 6 lines to replace one, and this only to avoid calling `orthogonal_arrays` several times, knowing that all calls would answer instantly (they do the check that "n<=1 or k<n+1" each time).

When `n` is not a prime power, I expect that `orthogonal_array(n+1,n,existence=True)` is much more costly than all `orthogonal_array(n+1,n_prime,existence=True)` for `n_prime<n` combined (all straightforward 'no').

Really, that's not where the performance is hidden. The next patch improves things a lot, and the next patch on recursive constructions make things a lot worse. There will be profiling to do there, but really that's not where performance is to be found.

Nathann



---

archive/issue_comments_209883.json:
```json
{
    "body": "(There are broken doctests in `block_design.py`)",
    "created_at": "2014-06-25T11:12:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16347#issuecomment-209883",
    "user": "https://github.com/nathanncohen"
}
```

(There are broken doctests in `block_design.py`)



---

archive/issue_comments_209884.json:
```json
{
    "body": "Replying to [comment:44 ncohen]:\n> Yo !\n> \n> > More reasonable review at `public/16347-bis`. If you like it enough, set to positive review.\n\n> \n> I agree with the latest two commits but when it comes to the modifications made in `find_wilson_decomposition_with_two_truncated_groups` I believe that you are really making the code harder to read for almost no improvement. You add 6 lines to replace one, and this only to avoid calling `orthogonal_arrays` several times, knowing that all calls would answer instantly (they do the check that \"n<=1 or k<n+1\" each time).\n> \n> When `n` is not a prime power, I expect that `orthogonal_array(n+1,n,existence=True)` is much more costly than all `orthogonal_array(n+1,n_prime,existence=True)` for `n_prime<n` combined (all straightforward 'no').\n> \n> Really, that's not where the performance is hidden. The next patch improves things a lot, and the next patch on recursive constructions make things a lot worse. There will be profiling to do there, but really that's not where performance is to be found.\n\n\nThen, why after the commit is it 30% faster to construct the MOLS table?\n\nEDIT: and I have no doctest error.\n\nVincent",
    "created_at": "2014-06-25T11:28:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16347#issuecomment-209884",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:44 ncohen]:
> Yo !
> 
> > More reasonable review at `public/16347-bis`. If you like it enough, set to positive review.

> 
> I agree with the latest two commits but when it comes to the modifications made in `find_wilson_decomposition_with_two_truncated_groups` I believe that you are really making the code harder to read for almost no improvement. You add 6 lines to replace one, and this only to avoid calling `orthogonal_arrays` several times, knowing that all calls would answer instantly (they do the check that "n<=1 or k<n+1" each time).
> 
> When `n` is not a prime power, I expect that `orthogonal_array(n+1,n,existence=True)` is much more costly than all `orthogonal_array(n+1,n_prime,existence=True)` for `n_prime<n` combined (all straightforward 'no').
> 
> Really, that's not where the performance is hidden. The next patch improves things a lot, and the next patch on recursive constructions make things a lot worse. There will be profiling to do there, but really that's not where performance is to be found.


Then, why after the commit is it 30% faster to construct the MOLS table?

EDIT: and I have no doctest error.

Vincent



---

archive/issue_comments_209885.json:
```json
{
    "body": "Here are the timings I got\n\nold timing before the branch cut (at 0fa89d5)\n\n```\nsage -t --long latin_squares.py\n    [36 tests, 17.83 s]\n```\nnew timings after the branch cut (at  828ff22)\n\n```\nsage -t --long latin_squares.py\n    [36 tests, 15.00 s]\n```",
    "created_at": "2014-06-25T11:38:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16347#issuecomment-209885",
    "user": "https://github.com/videlec"
}
```

Here are the timings I got

old timing before the branch cut (at 0fa89d5)

```
sage -t --long latin_squares.py
    [36 tests, 17.83 s]
```
new timings after the branch cut (at  828ff22)

```
sage -t --long latin_squares.py
    [36 tests, 15.00 s]
```



---

archive/issue_comments_209886.json:
```json
{
    "body": "Right right it's faster this way, sorry for what I said. I find it weird, but still, it is faster `O_o`\n\nNathann",
    "created_at": "2014-06-25T11:39:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16347#issuecomment-209886",
    "user": "https://github.com/nathanncohen"
}
```

Right right it's faster this way, sorry for what I said. I find it weird, but still, it is faster `O_o`

Nathann



---

archive/issue_comments_209887.json:
```json
{
    "body": "Sorry, it was my fault again for the doctests too. Positive review then, thank you for your help !\n\nNathann",
    "created_at": "2014-06-25T11:43:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16347#issuecomment-209887",
    "user": "https://github.com/nathanncohen"
}
```

Sorry, it was my fault again for the doctests too. Positive review then, thank you for your help !

Nathann



---

archive/issue_comments_209888.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-06-25T11:43:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16347#issuecomment-209888",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_209889.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-06-25T11:44:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16347#issuecomment-209889",
    "user": "https://github.com/nathanncohen"
}
```

New commits:



---

archive/issue_events_048172.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-06-26T01:50:37Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16347#event-48172"
}
```



---

archive/issue_comments_209890.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-06-26T01:50:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16347#issuecomment-209890",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
