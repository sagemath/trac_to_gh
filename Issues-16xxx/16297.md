# Issue 16297: Basic Block design methods

archive/issues_016297.json:
```json
{
    "body": "CC:  @KPanComputes @videlec melissah danziger\n\nKeywords: Block Design, Incidence Structure, Residual, Derived, Complement, Supplement, Union\n\nincludes complement, supplement, block derivation, block residue and union of block designs\n\nIssue created by migration from https://trac.sagemath.org/ticket/16534\n\n",
    "created_at": "2014-06-25T08:41:09Z",
    "labels": [
        "component: combinatorial designs"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Basic Block design methods",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16297",
    "user": "https://github.com/brettpim"
}
```
CC:  @KPanComputes @videlec melissah danziger

Keywords: Block Design, Incidence Structure, Residual, Derived, Complement, Supplement, Union

includes complement, supplement, block derivation, block residue and union of block designs

Issue created by migration from https://trac.sagemath.org/ticket/16534





---

archive/issue_comments_213005.json:
```json
{
    "body": "Hmm, a part of this was the intent of the ticket #16287. However, a linear combination of my own laziness and limited internet and sage access has made it impossible for me to finish the ticket. We should probably close that one in favour of this which mentions one more operation: the union of block designs.",
    "created_at": "2014-06-25T10:19:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16297",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16297#issuecomment-213005",
    "user": "https://github.com/KPanComputes"
}
```

Hmm, a part of this was the intent of the ticket #16287. However, a linear combination of my own laziness and limited internet and sage access has made it impossible for me to finish the ticket. We should probably close that one in favour of this which mentions one more operation: the union of block designs.



---

archive/issue_comments_213006.json:
```json
{
    "body": "Hey,\n\nOn #16552 we are talking about reimplementing `IncidenceStructure`. Do you already have code for that ticket? I do not want to create interference.\n\nVincent",
    "created_at": "2014-06-26T12:13:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16297",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16297#issuecomment-213006",
    "user": "https://github.com/videlec"
}
```

Hey,

On #16552 we are talking about reimplementing `IncidenceStructure`. Do you already have code for that ticket? I do not want to create interference.

Vincent



---

archive/issue_comments_213007.json:
```json
{
    "body": "Replying to [comment:3 vdelecroix]:\n> Hey,\n> \n> On #16552 we are talking about reimplementing `IncidenceStructure`. Do you already have code for that ticket? I do not want to create interference.\n\n\nAll right, the best will be to build your work above #16553. Otherwise, it will be a complete mess.\n\nVincent",
    "created_at": "2014-06-27T11:45:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16297",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16297#issuecomment-213007",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:3 vdelecroix]:
> Hey,
> 
> On #16552 we are talking about reimplementing `IncidenceStructure`. Do you already have code for that ticket? I do not want to create interference.


All right, the best will be to build your work above #16553. Otherwise, it will be a complete mess.

Vincent



---

archive/issue_events_048543.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16297",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16297#event-48543"
}
```



---

archive/issue_comments_213008.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-03-10T02:02:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16297",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16297#issuecomment-213008",
    "user": "https://github.com/brettpim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_213009.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-03-10T02:02:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16297",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16297#issuecomment-213009",
    "user": "https://github.com/brettpim"
}
```

New commits:



---

archive/issue_comments_213010.json:
```json
{
    "body": "I rebuilt my old code on top of Vincent's major changes to the file.",
    "created_at": "2015-03-10T02:03:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16297",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16297#issuecomment-213010",
    "user": "https://github.com/brettpim"
}
```

I rebuilt my old code on top of Vincent's major changes to the file.



---

archive/issue_comments_213011.json:
```json
{
    "body": "I would also like to discuss the \"maximal packing\" method that Vincent created in his revisions.  Where is the appropriate space to have this discussion?",
    "created_at": "2015-03-10T02:20:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16297",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16297#issuecomment-213011",
    "user": "https://github.com/brettpim"
}
```

I would also like to discuss the "maximal packing" method that Vincent created in his revisions.  Where is the appropriate space to have this discussion?



---

archive/issue_comments_213012.json:
```json
{
    "body": "How can I close/delete #7422",
    "created_at": "2015-03-10T02:21:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16297",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16297#issuecomment-213012",
    "user": "https://github.com/brettpim"
}
```

How can I close/delete #7422



---

archive/issue_comments_213013.json:
```json
{
    "body": "Changing keywords from \"\" to \"Block Design, Incidence Structure, Residual, Derived, Complement, Supplement, Point Deletion\".",
    "created_at": "2015-03-10T02:23:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16297",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16297#issuecomment-213013",
    "user": "https://github.com/brettpim"
}
```

Changing keywords from "" to "Block Design, Incidence Structure, Residual, Derived, Complement, Supplement, Point Deletion".



---

archive/issue_comments_213014.json:
```json
{
    "body": "> I would also like to discuss the \"maximal packing\" method that Vincent created in his revisions.  Where is the appropriate space to have this discussion?\n\n\nBy email or on sage-devel, depending on who you want to involve. If you want to discuss it by email I would be glad to be in Cc, by the way `:-)`\n\nNathann",
    "created_at": "2015-03-10T15:18:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16297",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16297#issuecomment-213014",
    "user": "https://github.com/nathanncohen"
}
```

> I would also like to discuss the "maximal packing" method that Vincent created in his revisions.  Where is the appropriate space to have this discussion?


By email or on sage-devel, depending on who you want to involve. If you want to discuss it by email I would be glad to be in Cc, by the way `:-)`

Nathann



---

archive/issue_comments_213015.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-03-10T15:59:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16297",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16297#issuecomment-213015",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_213016.json:
```json
{
    "body": "Hellooooooo Brett,\n\nHere is a first-pass review of your branch:\n\n- About giving credit to the authors: I believe that this part of your branch is\n  a bit too verbose, if I may say. I am not saying that you should not leave a\n  trace of what you do in the source code, but on the other hand we are many to\n  work on the same files, and we patch them very often. We cannot leave a 'log'\n  of what is being done to the files every time, for if we did most of the files\n  would be credit to the authors.\n\n  To give you an idea: after all the work we did recently in the design code\n  (around 60+ tickets), my name and Vincent's appear for a total of three times\n  in the whole designs/ folder.\n\n  Furthermore, we used to advise developers to add their name in the functions\n  that they implement, just in case we need to find out who wrote them later on:\n  it turns out that the 'git blame' command does that 1000x more easily, so\n  this is not needed anymore. Added to that, it is often true that some function\n  initially written by X is then totally rewritten by Y... and only the name of\n  X appears in the function's doc.\n\n  http://git-scm.com/docs/git-blame\n\n  Thus please, if you do want to leave your name somewhere, add a line with a\n  short description of what you did. Vincent left the following comment at the\n  head of `incidence_structure.py`:\n\n  {{{\n  - Vincent Delecroix (2014): major rewrite\n  }}}\n\n- About line length: we try to keep lines of doc/code to a maximum of 80\n  characters (unless that makes the doc/code much harder to read)\n\n- We try to write the documentation of each function following a pattern:\n\n  1) A one-line description of what the function does\n\n  2) Longer explanations if needed in the next paragraph\n\n  See\n  http://www.sagemath.org/doc/developer/coding_basics.html#the-docstring-of-a-function-content\n\n- In the specific case of `incidence_structure.py`, you will find at the top of\n  the page an index of all methods, which makes it easier to browse. Please add\n  yours to that list.\n\n  http://www.sagemath.org/doc/reference/graphs/sage/combinat/designs/incidence_structures.html\n\n- Could you use backticks ``x`` instead of `$x$` in this file? This is\n  the style that is used there.\n\n- `pt in self.ground_set()` builds the list of points only to throw it away\n  afterwards. You will find how to do that in the code of other functions.\n\n- A big block of code from `derived_incidence_structure_at_point` seems to be\n  equivalent to\n\n  {{{\n  [[x for x in B if x!=p] for B in self if p in self]\n  }}}\n\n  I also do not understand to what end you sort the sets.\n\n- about `derived_incidence_structure_at_block/point` and\n  `residual_incidence_structure_at_block/point`. I would be for turning these\n  two very similar functions to something like\n  `derived_incidence_structure(at_point=p)` and\n  `derived_incidence_structure(at_block=b)`. Actually, perhaps\n  `derived_structure` and `residual_structure` may be sufficient.\n\n- about `delete_points` -- I feel a bit uneasy with respect to this function, as\n  contrarily to what 'graph' does it does not remove the points 'inplace' but\n  returns a copy. Furthermore, 'removing' a point x always leaves some\n  uncertainty with respect to the blocks containing x: are they reduced?\n  deleted?\n\n- We already have `.induced_substructure` and `.trace` which more or less do the\n  job. Perhaps we could add an argument to them in order to remove points from\n  the whole design, instead of giving the list of those that will stay?\n\nTell me what you think about the points above. Cheers,\n\nNathann",
    "created_at": "2015-03-10T15:59:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16297",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16297#issuecomment-213016",
    "user": "https://github.com/nathanncohen"
}
```

Hellooooooo Brett,

Here is a first-pass review of your branch:

- About giving credit to the authors: I believe that this part of your branch is
  a bit too verbose, if I may say. I am not saying that you should not leave a
  trace of what you do in the source code, but on the other hand we are many to
  work on the same files, and we patch them very often. We cannot leave a 'log'
  of what is being done to the files every time, for if we did most of the files
  would be credit to the authors.

  To give you an idea: after all the work we did recently in the design code
  (around 60+ tickets), my name and Vincent's appear for a total of three times
  in the whole designs/ folder.

  Furthermore, we used to advise developers to add their name in the functions
  that they implement, just in case we need to find out who wrote them later on:
  it turns out that the 'git blame' command does that 1000x more easily, so
  this is not needed anymore. Added to that, it is often true that some function
  initially written by X is then totally rewritten by Y... and only the name of
  X appears in the function's doc.

  http://git-scm.com/docs/git-blame

  Thus please, if you do want to leave your name somewhere, add a line with a
  short description of what you did. Vincent left the following comment at the
  head of `incidence_structure.py`:

  {{{
  - Vincent Delecroix (2014): major rewrite
  }}}

- About line length: we try to keep lines of doc/code to a maximum of 80
  characters (unless that makes the doc/code much harder to read)

- We try to write the documentation of each function following a pattern:

  1) A one-line description of what the function does

  2) Longer explanations if needed in the next paragraph

  See
  http://www.sagemath.org/doc/developer/coding_basics.html#the-docstring-of-a-function-content

- In the specific case of `incidence_structure.py`, you will find at the top of
  the page an index of all methods, which makes it easier to browse. Please add
  yours to that list.

  http://www.sagemath.org/doc/reference/graphs/sage/combinat/designs/incidence_structures.html

- Could you use backticks ``x`` instead of `$x$` in this file? This is
  the style that is used there.

- `pt in self.ground_set()` builds the list of points only to throw it away
  afterwards. You will find how to do that in the code of other functions.

- A big block of code from `derived_incidence_structure_at_point` seems to be
  equivalent to

  {{{
  [[x for x in B if x!=p] for B in self if p in self]
  }}}

  I also do not understand to what end you sort the sets.

- about `derived_incidence_structure_at_block/point` and
  `residual_incidence_structure_at_block/point`. I would be for turning these
  two very similar functions to something like
  `derived_incidence_structure(at_point=p)` and
  `derived_incidence_structure(at_block=b)`. Actually, perhaps
  `derived_structure` and `residual_structure` may be sufficient.

- about `delete_points` -- I feel a bit uneasy with respect to this function, as
  contrarily to what 'graph' does it does not remove the points 'inplace' but
  returns a copy. Furthermore, 'removing' a point x always leaves some
  uncertainty with respect to the blocks containing x: are they reduced?
  deleted?

- We already have `.induced_substructure` and `.trace` which more or less do the
  job. Perhaps we could add an argument to them in order to remove points from
  the whole design, instead of giving the list of those that will stay?

Tell me what you think about the points above. Cheers,

Nathann



---

archive/issue_comments_213017.json:
```json
{
    "body": "Replying to [comment:14 ncohen]:\n\n\n> Hellooooooo Brett,\n> \n> Here is a first-pass review of your branch:\n> \n> - About giving credit to the authors: I believe that this part of your branch is\n> a bit too verbose, if I may say. I am not saying that you should not leave a\n> trace of what you do in the source code, but on the other hand we are many to\n> work on the same files, and we patch them very often. We cannot leave a 'log'\n> of what is being done to the files every time, for if we did most of the files\n> would be credit to the authors.\n> \n> To give you an idea: after all the work we did recently in the design code\n> (around 60+ tickets), my name and Vincent's appear for a total of three times\n> in the whole designs/ folder.\n> \n> Furthermore, we used to advise developers to add their name in the functions\n> that they implement, just in case we need to find out who wrote them later on:\n> it turns out that the 'git blame' command does that 1000x more easily, so\n> this is not needed anymore. Added to that, it is often true that some function\n> initially written by X is then totally rewritten by Y... and only the name of\n> X appears in the function's doc.\n> \n> http://git-scm.com/docs/git-blame\n> \n> Thus please, if you do want to leave your name somewhere, add a line with a\n> short description of what you did. Vincent left the following comment at the\n> head of `incidence_structure.py`:\n> \n> \n> ```\n> - Vincent Delecroix (2014): major rewrite\n> ```\n\n>\n\n OK, I will put my name at the top and remove from code.\n \n> \n> \n> - About line length: we try to keep lines of doc/code to a maximum of 80\n> characters (unless that makes the doc/code much harder to read)\n> \n> - We try to write the documentation of each function following a pattern:\n> \n> 1) A one-line description of what the function does\n> \n> 2) Longer explanations if needed in the next paragraph\n> \n> See\n> http://www.sagemath.org/doc/developer/coding_basics.html#the-docstring-of-a-function-content\n\n>\n\nThis should be no problem\n \n> - In the specific case of `incidence_structure.py`, you will find at the top of\n> the page an index of all methods, which makes it easier to browse. Please add\n> yours to that list.\n> \n> http://www.sagemath.org/doc/reference/graphs/sage/combinat/designs/incidence_structures.html\n> \n\n\nsure, in any particular order?\n\n> - Could you use backticks ``x`` instead of `$x$` in this file? This is\n> the style that is used there.\n> \n\n\nsure\n\n> - `pt in self.ground_set()` builds the list of points only to throw it away\n> afterwards. You will find how to do that in the code of other functions.\n> \n\n\nYou mean in the other functions I will see how to have the same functionality without the waste of time and space?\n\n> - A big block of code from `derived_incidence_structure_at_point` seems to be\n> equivalent to\n> \n> \n> ```\n> [[x for x in B if x!=p] for B in self if p in self]\n> ```\n> \n\n\nthis is much nicer!\n\n> I also do not understand to what end you sort the sets.\n> \n\n\nway back when I started these methods, the blocks were not sorted and this led to __eq__ not working properly, so I do this to makes sure that everything is in a invarient form. \n\n> - about `derived_incidence_structure_at_block/point` and\n> `residual_incidence_structure_at_block/point`. I would be for turning these\n> two very similar functions to something like\n> `derived_incidence_structure(at_point=p)` and\n> `derived_incidence_structure(at_block=b)`. Actually, perhaps\n> `derived_structure` and `residual_structure` may be sufficient.\n> \n> - about `delete_points` -- I feel a bit uneasy with respect to this function, as\n> contrarily to what 'graph' does it does not remove the points 'inplace' but\n> returns a copy. Furthermore, 'removing' a point x always leaves some\n> uncertainty with respect to the blocks containing x: are they reduced?\n> deleted?\n> \n\n\nIn design theory when we delete points we keep the blocks that had the point, we just remove the points from them.  This is like truncating a group in a TD (you keep the group) or going from projective plane to the affine plane it contains (you keep all the lines, except the one which ends up empty).  I don't mind this doing this inplace like the graphs. \n\n> - We already have `.induced_substructure` and `.trace` which more or less do the\n> job. Perhaps we could add an argument to them in order to remove points from\n> the whole design, instead of giving the list of those that will stay?\n> \n\n\ninduced is not at all the same method (as that throws away blocks which lose any points)\n\nyou are right it seems that trace does what I am doing for \"delete_points\"  do you agree from my description above?\n\n\n> Tell me what you think about the points above. Cheers,\n> \n> Nathann",
    "created_at": "2015-03-10T16:23:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16297",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16297#issuecomment-213017",
    "user": "https://github.com/brettpim"
}
```

Replying to [comment:14 ncohen]:


> Hellooooooo Brett,
> 
> Here is a first-pass review of your branch:
> 
> - About giving credit to the authors: I believe that this part of your branch is
> a bit too verbose, if I may say. I am not saying that you should not leave a
> trace of what you do in the source code, but on the other hand we are many to
> work on the same files, and we patch them very often. We cannot leave a 'log'
> of what is being done to the files every time, for if we did most of the files
> would be credit to the authors.
> 
> To give you an idea: after all the work we did recently in the design code
> (around 60+ tickets), my name and Vincent's appear for a total of three times
> in the whole designs/ folder.
> 
> Furthermore, we used to advise developers to add their name in the functions
> that they implement, just in case we need to find out who wrote them later on:
> it turns out that the 'git blame' command does that 1000x more easily, so
> this is not needed anymore. Added to that, it is often true that some function
> initially written by X is then totally rewritten by Y... and only the name of
> X appears in the function's doc.
> 
> http://git-scm.com/docs/git-blame
> 
> Thus please, if you do want to leave your name somewhere, add a line with a
> short description of what you did. Vincent left the following comment at the
> head of `incidence_structure.py`:
> 
> 
> ```
> - Vincent Delecroix (2014): major rewrite
> ```

>

 OK, I will put my name at the top and remove from code.
 
> 
> 
> - About line length: we try to keep lines of doc/code to a maximum of 80
> characters (unless that makes the doc/code much harder to read)
> 
> - We try to write the documentation of each function following a pattern:
> 
> 1) A one-line description of what the function does
> 
> 2) Longer explanations if needed in the next paragraph
> 
> See
> http://www.sagemath.org/doc/developer/coding_basics.html#the-docstring-of-a-function-content

>

This should be no problem
 
> - In the specific case of `incidence_structure.py`, you will find at the top of
> the page an index of all methods, which makes it easier to browse. Please add
> yours to that list.
> 
> http://www.sagemath.org/doc/reference/graphs/sage/combinat/designs/incidence_structures.html
> 


sure, in any particular order?

> - Could you use backticks ``x`` instead of `$x$` in this file? This is
> the style that is used there.
> 


sure

> - `pt in self.ground_set()` builds the list of points only to throw it away
> afterwards. You will find how to do that in the code of other functions.
> 


You mean in the other functions I will see how to have the same functionality without the waste of time and space?

> - A big block of code from `derived_incidence_structure_at_point` seems to be
> equivalent to
> 
> 
> ```
> [[x for x in B if x!=p] for B in self if p in self]
> ```
> 


this is much nicer!

> I also do not understand to what end you sort the sets.
> 


way back when I started these methods, the blocks were not sorted and this led to __eq__ not working properly, so I do this to makes sure that everything is in a invarient form. 

> - about `derived_incidence_structure_at_block/point` and
> `residual_incidence_structure_at_block/point`. I would be for turning these
> two very similar functions to something like
> `derived_incidence_structure(at_point=p)` and
> `derived_incidence_structure(at_block=b)`. Actually, perhaps
> `derived_structure` and `residual_structure` may be sufficient.
> 
> - about `delete_points` -- I feel a bit uneasy with respect to this function, as
> contrarily to what 'graph' does it does not remove the points 'inplace' but
> returns a copy. Furthermore, 'removing' a point x always leaves some
> uncertainty with respect to the blocks containing x: are they reduced?
> deleted?
> 


In design theory when we delete points we keep the blocks that had the point, we just remove the points from them.  This is like truncating a group in a TD (you keep the group) or going from projective plane to the affine plane it contains (you keep all the lines, except the one which ends up empty).  I don't mind this doing this inplace like the graphs. 

> - We already have `.induced_substructure` and `.trace` which more or less do the
> job. Perhaps we could add an argument to them in order to remove points from
> the whole design, instead of giving the list of those that will stay?
> 


induced is not at all the same method (as that throws away blocks which lose any points)

you are right it seems that trace does what I am doing for "delete_points"  do you agree from my description above?


> Tell me what you think about the points above. Cheers,
> 
> Nathann



---

archive/issue_comments_213018.json:
```json
{
    "body": "In general when should a method return a new incidence structure and when should it modify the current incidence structure in place?\n\nIs there a sage philosophy for this?",
    "created_at": "2015-03-10T16:33:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16297",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16297#issuecomment-213018",
    "user": "https://github.com/brettpim"
}
```

In general when should a method return a new incidence structure and when should it modify the current incidence structure in place?

Is there a sage philosophy for this?



---

archive/issue_comments_213019.json:
```json
{
    "body": "Hello,\n\n> sure, in any particular order?\n\n\nAs you see fit. I would say 'respect the alphabetical order' if the existing entries do, otherwise reorder them, otherwise add them to the end of the list, otherwise [...].\n\n> You mean in the other functions I will see how to have the same functionality without the waste of time and space?\n\n\nIndeed.\n\n> way back when I started these methods, the blocks were not sorted and this led to __eq__ not working properly, so I do this to makes sure that everything is in a invarient form. \n\n\nOh I see. Well, this has been solved some time ago and you do not have to sort the blocks anymore. You can, optionally, give the blocks to `IncidenceStructure` and 'swear' that they are already sorted: this is only useful to save some time when you know that the blocks are already as they should.\n\n> In design theory when we delete points we keep the blocks that had the point, we just remove the points from them.  This is like truncating a group in a TD (you keep the group) or going from projective plane to the affine plane it contains (you keep all the lines, except the one which ends up empty).  I don't mind this doing this inplace like the graphs. \n\n\nWell, doing this inplace raises new problems: you cannot do that in an object of type `BIBD` as it will not remain a `BIBD` (most of the time). We are somehow stuck there, which is why I proposed this optional argument to `trace/induced_substructure`.\n\nCheers,\n\nNathann",
    "created_at": "2015-03-10T16:58:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16297",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16297#issuecomment-213019",
    "user": "https://github.com/nathanncohen"
}
```

Hello,

> sure, in any particular order?


As you see fit. I would say 'respect the alphabetical order' if the existing entries do, otherwise reorder them, otherwise add them to the end of the list, otherwise [...].

> You mean in the other functions I will see how to have the same functionality without the waste of time and space?


Indeed.

> way back when I started these methods, the blocks were not sorted and this led to __eq__ not working properly, so I do this to makes sure that everything is in a invarient form. 


Oh I see. Well, this has been solved some time ago and you do not have to sort the blocks anymore. You can, optionally, give the blocks to `IncidenceStructure` and 'swear' that they are already sorted: this is only useful to save some time when you know that the blocks are already as they should.

> In design theory when we delete points we keep the blocks that had the point, we just remove the points from them.  This is like truncating a group in a TD (you keep the group) or going from projective plane to the affine plane it contains (you keep all the lines, except the one which ends up empty).  I don't mind this doing this inplace like the graphs. 


Well, doing this inplace raises new problems: you cannot do that in an object of type `BIBD` as it will not remain a `BIBD` (most of the time). We are somehow stuck there, which is why I proposed this optional argument to `trace/induced_substructure`.

Cheers,

Nathann



---

archive/issue_comments_213020.json:
```json
{
    "body": "I know how to skip lines of output in a doctest and still have the testing recognize the output:\n\n\n```\nsage: BD2.residual_incidence_structure(at_block=[0,2,4])\nTraceback (most recent call last):\n...\nValueError: Block [0, 2, 4] is not in the block set.\n```\n\n\nBut how can I skip part of a line of output and makes sure the test still recognizes the output?",
    "created_at": "2015-03-10T21:10:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16297",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16297#issuecomment-213020",
    "user": "https://github.com/brettpim"
}
```

I know how to skip lines of output in a doctest and still have the testing recognize the output:


```
sage: BD2.residual_incidence_structure(at_block=[0,2,4])
Traceback (most recent call last):
...
ValueError: Block [0, 2, 4] is not in the block set.
```


But how can I skip part of a line of output and makes sure the test still recognizes the output?



---

archive/issue_comments_213021.json:
```json
{
    "body": "OK, I figured out how to make what I needed work:\n\n```\nsage: BD3 = BD1.derived_incidence_structure()\ndoctest:...: UserWarning: no point nor block given to derive at.  Simply returning self.\n```\n\nwhere the ellipsis match the line number that appears between the colons.  But I had tried ellipsis in other various ways and they did not work.  I cannot find a clear explanation of exactly what ellipsis will match in the output of a doctest.  Do any of you know exactly  how they work?",
    "created_at": "2015-03-10T22:34:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16297",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16297#issuecomment-213021",
    "user": "https://github.com/brettpim"
}
```

OK, I figured out how to make what I needed work:

```
sage: BD3 = BD1.derived_incidence_structure()
doctest:...: UserWarning: no point nor block given to derive at.  Simply returning self.
```

where the ellipsis match the line number that appears between the colons.  But I had tried ellipsis in other various ways and they did not work.  I cannot find a clear explanation of exactly what ellipsis will match in the output of a doctest.  Do any of you know exactly  how they work?



---

archive/issue_comments_213022.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-10T22:40:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16297",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16297#issuecomment-213022",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_213023.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-10T23:12:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16297",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16297#issuecomment-213023",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_213024.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-03-10T23:14:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16297",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16297#issuecomment-213024",
    "user": "https://github.com/brettpim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_213025.json:
```json
{
    "body": "OK I have done all that Nathann has suggested. \n\nI have changed the packing method to be able to find maximum packings both for cardinality and for coverage.\n\nOne question for some thought and discussion:\n\nmost of my methods return new incidence structures rather than modify the given incidence structure inplace.  Are there any methods that need to be modified to be inplace methods?",
    "created_at": "2015-03-10T23:14:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16297",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16297#issuecomment-213025",
    "user": "https://github.com/brettpim"
}
```

OK I have done all that Nathann has suggested. 

I have changed the packing method to be able to find maximum packings both for cardinality and for coverage.

One question for some thought and discussion:

most of my methods return new incidence structures rather than modify the given incidence structure inplace.  Are there any methods that need to be modified to be inplace methods?



---

archive/issue_comments_213026.json:
```json
{
    "body": "Changing keywords from \"Block Design, Incidence Structure, Residual, Derived, Complement, Supplement, Point Deletion\" to \"Block Design, Incidence Structure, Residual, Derived, Complement, Supplement, Union\".",
    "created_at": "2015-03-11T00:29:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16297",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16297#issuecomment-213026",
    "user": "https://github.com/brettpim"
}
```

Changing keywords from "Block Design, Incidence Structure, Residual, Derived, Complement, Supplement, Point Deletion" to "Block Design, Incidence Structure, Residual, Derived, Complement, Supplement, Union".



---

archive/issue_comments_213027.json:
```json
{
    "body": "Hellooooooo Brett,\n\nYour branch does not seem to be compatible with Sage's latest developer version\n(its name appears in red on the trac ticket). Could you please fix that by\nrebasing/merging it with the latest beta?\n\nAlso:\n\n- We try to keep trac tickets \"thematically focused\". Thus, it would have been\n  better to open a new ticket to discuss your modification of `.packing` instead\n  of doing it here. It is not a big deal, so let us do everything at once here\n  anyway.\n\n- I am not a big defender of your `blocks_by_size` function. I first thought\n  that it would return the list of blocks sorted by size, but it is actually\n  equivalent to `[B for B in H if len(B) in block_sizes]` soooo 'well'...\n\n  In particular, I do not understand why you wrote\n\n  `p.set_objective(p.sum([b[i]*self.block_sizes()[i] for i in range(self.num_blocks())]))`\n\n  instead of\n\n  `p.set_objective(p.sum([b[i]*len(self._blocks[i]) for i in range(self.num_blocks())]))`\n\n- When a keyword can take two values like `coverage/cardinality`, it is better\n  to avoid if/else and write something like:\n\n  {{{\n  if objective == \"coverage\":\n     pass\n  elif objective == \"cardinality\":\n     pass\n  else:\n     raise ValueError(\"'objective' must be equal to either 'coverage' or 'cardinality'\")\n  }}}\n\n  This, because otherwise you would pay very dear a typo like \"covearge\" `;-)`\n\nCheers,\n\nNathann",
    "created_at": "2015-03-11T06:35:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16297",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16297#issuecomment-213027",
    "user": "https://github.com/nathanncohen"
}
```

Hellooooooo Brett,

Your branch does not seem to be compatible with Sage's latest developer version
(its name appears in red on the trac ticket). Could you please fix that by
rebasing/merging it with the latest beta?

Also:

- We try to keep trac tickets "thematically focused". Thus, it would have been
  better to open a new ticket to discuss your modification of `.packing` instead
  of doing it here. It is not a big deal, so let us do everything at once here
  anyway.

- I am not a big defender of your `blocks_by_size` function. I first thought
  that it would return the list of blocks sorted by size, but it is actually
  equivalent to `[B for B in H if len(B) in block_sizes]` soooo 'well'...

  In particular, I do not understand why you wrote

  `p.set_objective(p.sum([b[i]*self.block_sizes()[i] for i in range(self.num_blocks())]))`

  instead of

  `p.set_objective(p.sum([b[i]*len(self._blocks[i]) for i in range(self.num_blocks())]))`

- When a keyword can take two values like `coverage/cardinality`, it is better
  to avoid if/else and write something like:

  {{{
  if objective == "coverage":
     pass
  elif objective == "cardinality":
     pass
  else:
     raise ValueError("'objective' must be equal to either 'coverage' or 'cardinality'")
  }}}

  This, because otherwise you would pay very dear a typo like "covearge" `;-)`

Cheers,

Nathann



---

archive/issue_comments_213028.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-03-11T06:35:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16297",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16297#issuecomment-213028",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_213029.json:
```json
{
    "body": "Replying to [comment:24 ncohen]:\n> Hellooooooo Brett,\n> \n> Your branch does not seem to be compatible with Sage's latest developer version\n> (its name appears in red on the trac ticket). Could you please fix that by\n> rebasing/merging it with the latest beta?\n\n\nI will try but I may have questions\n\n> \n> Also:\n> \n> - We try to keep trac tickets \"thematically focused\". Thus, it would have been\n>   better to open a new ticket to discuss your modification of `.packing` instead\n>   of doing it here. It is not a big deal, so let us do everything at once here\n>   anyway.\n\n\nwait, which should we do?\n\n> \n> - I am not a big defender of your `blocks_by_size` function. I first thought\n>   that it would return the list of blocks sorted by size, but it is actually\n>   equivalent to `[B for B in H if len(B) in block_sizes]` soooo 'well'...\n> \n>   In particular, I do not understand why you wrote\n> \n>   `p.set_objective(p.sum([b[i]*self.block_sizes()[i] for i in range(self.num_blocks())]))`\n> \n>   instead of\n> \n>   `p.set_objective(p.sum([b[i]*len(self._blocks[i]) for i in range(self.num_blocks())]))`\n> \n\n\njust remove it entirely or build it in as an option to .blocks()?\n\n\n> - When a keyword can take two values like `coverage/cardinality`, it is better\n>   to avoid if/else and write something like:\n> \n>   {{{\n>   if objective == \"coverage\":\n>      pass\n>   elif objective == \"cardinality\":\n>      pass\n>   else:\n>      raise ValueError(\"'objective' must be equal to either 'coverage' or 'cardinality'\")\n>   }}}\n> \n>   This, because otherwise you would pay very dear a typo like \"covearge\" `;-)`\n\n\nwill do.\n\n> \n> Cheers,\n> \n> Nathann",
    "created_at": "2015-03-11T19:50:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16297",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16297#issuecomment-213029",
    "user": "https://github.com/brettpim"
}
```

Replying to [comment:24 ncohen]:
> Hellooooooo Brett,
> 
> Your branch does not seem to be compatible with Sage's latest developer version
> (its name appears in red on the trac ticket). Could you please fix that by
> rebasing/merging it with the latest beta?


I will try but I may have questions

> 
> Also:
> 
> - We try to keep trac tickets "thematically focused". Thus, it would have been
>   better to open a new ticket to discuss your modification of `.packing` instead
>   of doing it here. It is not a big deal, so let us do everything at once here
>   anyway.


wait, which should we do?

> 
> - I am not a big defender of your `blocks_by_size` function. I first thought
>   that it would return the list of blocks sorted by size, but it is actually
>   equivalent to `[B for B in H if len(B) in block_sizes]` soooo 'well'...
> 
>   In particular, I do not understand why you wrote
> 
>   `p.set_objective(p.sum([b[i]*self.block_sizes()[i] for i in range(self.num_blocks())]))`
> 
>   instead of
> 
>   `p.set_objective(p.sum([b[i]*len(self._blocks[i]) for i in range(self.num_blocks())]))`
> 


just remove it entirely or build it in as an option to .blocks()?


> - When a keyword can take two values like `coverage/cardinality`, it is better
>   to avoid if/else and write something like:
> 
>   {{{
>   if objective == "coverage":
>      pass
>   elif objective == "cardinality":
>      pass
>   else:
>      raise ValueError("'objective' must be equal to either 'coverage' or 'cardinality'")
>   }}}
> 
>   This, because otherwise you would pay very dear a typo like "covearge" `;-)`


will do.

> 
> Cheers,
> 
> Nathann



---

archive/issue_comments_213030.json:
```json
{
    "body": "Hello,\n\n> I will try but I may have questions\n\n\nYou may find some answers in the developer's manual:\nhttp://www.sagemath.org/doc/developer/\n\n> wait, which should we do?\n\n\nWe keep it this way to make it simpler (you will have to do your first merge/rebase, let us not add a ticket split to that). Next time, however, it would be better to open a second ticket.\n\n> just remove it entirely or build it in as an option to .blocks()?\n\n\nI think that it can be removed. Python already solves the problem with a short and natural one-liner.\n\nNathann",
    "created_at": "2015-03-12T08:29:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16297",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16297#issuecomment-213030",
    "user": "https://github.com/nathanncohen"
}
```

Hello,

> I will try but I may have questions


You may find some answers in the developer's manual:
http://www.sagemath.org/doc/developer/

> wait, which should we do?


We keep it this way to make it simpler (you will have to do your first merge/rebase, let us not add a ticket split to that). Next time, however, it would be better to open a second ticket.

> just remove it entirely or build it in as an option to .blocks()?


I think that it can be removed. Python already solves the problem with a short and natural one-liner.

Nathann



---

archive/issue_comments_213031.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-12T14:29:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16297",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16297#issuecomment-213031",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_213032.json:
```json
{
    "body": "Done all suggested changes",
    "created_at": "2015-03-12T14:30:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16297",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16297#issuecomment-213032",
    "user": "https://github.com/brettpim"
}
```

Done all suggested changes



---

archive/issue_comments_213033.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-03-12T14:30:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16297",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16297#issuecomment-213033",
    "user": "https://github.com/brettpim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_213034.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-03-12T14:56:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16297",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16297#issuecomment-213034",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_213035.json:
```json
{
    "body": "Hello Brett,\n\nIt seems that your branch still includes traces of a failed merge. Look for strings like \">>>>\" in the design/ files and you will find them.\n\nAlso, I had to ask you about the two \"todo\" that you add: we have a `.is_resolvable` function and all designs are already checked at construction time. You will find the 'actual' code in `designs_pyx.pyx`, and the calls appear in the `__init__` functions of each class.\n\nNathann\n\nP.S.: Also, something weird happened as every commit appears twice in your branch. You will see that if you click on the 'commits' link that appears right next to the name of your branch at the head of the ticket.",
    "created_at": "2015-03-12T14:56:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16297",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16297#issuecomment-213035",
    "user": "https://github.com/nathanncohen"
}
```

Hello Brett,

It seems that your branch still includes traces of a failed merge. Look for strings like ">>>>" in the design/ files and you will find them.

Also, I had to ask you about the two "todo" that you add: we have a `.is_resolvable` function and all designs are already checked at construction time. You will find the 'actual' code in `designs_pyx.pyx`, and the calls appear in the `__init__` functions of each class.

Nathann

P.S.: Also, something weird happened as every commit appears twice in your branch. You will see that if you click on the 'commits' link that appears right next to the name of your branch at the head of the ticket.



---

archive/issue_comments_213036.json:
```json
{
    "body": "(it is much easier to use git if you have some graphical way to visualize the branches. I use 'tig' which works in command line, but there are many others)",
    "created_at": "2015-03-12T15:05:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16297",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16297#issuecomment-213036",
    "user": "https://github.com/nathanncohen"
}
```

(it is much easier to use git if you have some graphical way to visualize the branches. I use 'tig' which works in command line, but there are many others)



---

archive/issue_comments_213037.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-12T15:27:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16297",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16297#issuecomment-213037",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_213038.json:
```json
{
    "body": "Replying to [comment:29 ncohen]:\n> Hello Brett,\n> \n> It seems that your branch still includes traces of a failed merge. Look for strings like \">>>>\" in the design/ files and you will find them.\n\n\nI think I got them all this time.\n\n> \n> Also, I had to ask you about the two \"todo\" that you add: we have a `.is_resolvable` function and all designs are already checked at construction time. You will find the 'actual' code in `designs_pyx.pyx`, and the calls appear in the `__init__` functions of each class.\n> \n\n\nAn incidence structure is group divisible iff its dual is resolvable so the is_resolvable method can be used to determine if the IS is group divisible.  The question is if we find that a IS is group divisible, what do we want to do.  Do we want to store the groups as a part fo the IS?\n\n> Nathann\n> \n> P.S.: Also, something weird happened as every commit appears twice in your branch. You will see that if you click on the 'commits' link that appears right next to the name of your branch at the head of the ticket.\n\n\nI am using \n\n```\ngit add src/sage/combinat/designs/incidence_structures.py\ngit commit\ngit trac push 16534 \n```\n\nshould I be doing something differently?",
    "created_at": "2015-03-12T15:33:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16297",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16297#issuecomment-213038",
    "user": "https://github.com/brettpim"
}
```

Replying to [comment:29 ncohen]:
> Hello Brett,
> 
> It seems that your branch still includes traces of a failed merge. Look for strings like ">>>>" in the design/ files and you will find them.


I think I got them all this time.

> 
> Also, I had to ask you about the two "todo" that you add: we have a `.is_resolvable` function and all designs are already checked at construction time. You will find the 'actual' code in `designs_pyx.pyx`, and the calls appear in the `__init__` functions of each class.
> 


An incidence structure is group divisible iff its dual is resolvable so the is_resolvable method can be used to determine if the IS is group divisible.  The question is if we find that a IS is group divisible, what do we want to do.  Do we want to store the groups as a part fo the IS?

> Nathann
> 
> P.S.: Also, something weird happened as every commit appears twice in your branch. You will see that if you click on the 'commits' link that appears right next to the name of your branch at the head of the ticket.


I am using 

```
git add src/sage/combinat/designs/incidence_structures.py
git commit
git trac push 16534 
```

should I be doing something differently?



---

archive/issue_comments_213039.json:
```json
{
    "body": "Hello,\n\n> I think I got them all this time.\n\n\nYou did.\n\n> An incidence structure is group divisible iff its dual is resolvable so the is_resolvable method can be used to determine if the IS is group divisible.  The question is if we find that a IS is group divisible, what do we want to do.  Do we want to store the groups as a part fo the IS?\n\n\nFrom your question I wonder if we are talking about the same thing. I was simply saying that we have a function `is_group_divisible_design` that tells you if an incidence structure is a group divisible design. Is that also what you have in mind?\n\nIn particular, I do not understand how that could be equivalent to finding out whether the dual is resolvable: we have a `.is_resolvable` function, but it is rather slow.\n\n> I am using \n> \n> \n> ```\n> git add src/sage/combinat/designs/incidence_structures.py\n> git commit\n> git trac push 16534 \n> ```\n> \n> should I be doing something differently?\n\n\nNo, those commands look okay. It must be something that happened before.\n\nNathann",
    "created_at": "2015-03-12T15:38:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16297",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16297#issuecomment-213039",
    "user": "https://github.com/nathanncohen"
}
```

Hello,

> I think I got them all this time.


You did.

> An incidence structure is group divisible iff its dual is resolvable so the is_resolvable method can be used to determine if the IS is group divisible.  The question is if we find that a IS is group divisible, what do we want to do.  Do we want to store the groups as a part fo the IS?


From your question I wonder if we are talking about the same thing. I was simply saying that we have a function `is_group_divisible_design` that tells you if an incidence structure is a group divisible design. Is that also what you have in mind?

In particular, I do not understand how that could be equivalent to finding out whether the dual is resolvable: we have a `.is_resolvable` function, but it is rather slow.

> I am using 
> 
> 
> ```
> git add src/sage/combinat/designs/incidence_structures.py
> git commit
> git trac push 16534 
> ```
> 
> should I be doing something differently?


No, those commands look okay. It must be something that happened before.

Nathann



---

archive/issue_comments_213040.json:
```json
{
    "body": "Replying to [comment:29 ncohen]:\n\n> P.S.: Also, something weird happened as every commit appears twice in your branch. You will see that if you click on the 'commits' link that appears right next to the name of your branch at the head of the ticket.\n\n\ncould this have been caused by my rebasing to develop?",
    "created_at": "2015-03-12T15:38:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16297",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16297#issuecomment-213040",
    "user": "https://github.com/brettpim"
}
```

Replying to [comment:29 ncohen]:

> P.S.: Also, something weird happened as every commit appears twice in your branch. You will see that if you click on the 'commits' link that appears right next to the name of your branch at the head of the ticket.


could this have been caused by my rebasing to develop?



---

archive/issue_comments_213041.json:
```json
{
    "body": "Replying to [comment:33 ncohen]:\n\n> > An incidence structure is group divisible iff its dual is resolvable so the is_resolvable method can be used to determine if the IS is group divisible.  The question is if we find that a IS is group divisible, what do we want to do.  Do we want to store the groups as a part fo the IS?\n\n> \n> From your question I wonder if we are talking about the same thing. I was simply saying that we have a function `is_group_divisible_design` that tells you if an incidence structure is a group divisible design. Is that also what you have in mind?\n\n\nIt looks to me as if your is_group_divisible_design requires the user to hand the method the groups.\n\nI was thinking of building a function to determine if an IS is group divisible without knowing what the groups might be.\n\nI was slightly incorrect before.  A more accurate statement would be that the dual of a resolvable IS is an group divisible IS with the property that the blocks are transversal. \n\nIt is important to note that neither may be designs.\n\nThis fact follows from dualising thew definition of resolvable:\n\nA IS is resolvable if there exists a partition of the blocks into classes such that every point is incident with exactly one block in each class. \n\nthe dual of this statement is \n\nthere exists a partition of the points into classes (groups) such that every block is incident with exactly one point in each class (group) \n\n> \n> In particular, I do not understand how that could be equivalent to finding out whether the dual is resolvable: we have a `.is_resolvable` function, but it is rather slow.",
    "created_at": "2015-03-12T15:50:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16297",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16297#issuecomment-213041",
    "user": "https://github.com/brettpim"
}
```

Replying to [comment:33 ncohen]:

> > An incidence structure is group divisible iff its dual is resolvable so the is_resolvable method can be used to determine if the IS is group divisible.  The question is if we find that a IS is group divisible, what do we want to do.  Do we want to store the groups as a part fo the IS?

> 
> From your question I wonder if we are talking about the same thing. I was simply saying that we have a function `is_group_divisible_design` that tells you if an incidence structure is a group divisible design. Is that also what you have in mind?


It looks to me as if your is_group_divisible_design requires the user to hand the method the groups.

I was thinking of building a function to determine if an IS is group divisible without knowing what the groups might be.

I was slightly incorrect before.  A more accurate statement would be that the dual of a resolvable IS is an group divisible IS with the property that the blocks are transversal. 

It is important to note that neither may be designs.

This fact follows from dualising thew definition of resolvable:

A IS is resolvable if there exists a partition of the blocks into classes such that every point is incident with exactly one block in each class. 

the dual of this statement is 

there exists a partition of the points into classes (groups) such that every block is incident with exactly one point in each class (group) 

> 
> In particular, I do not understand how that could be equivalent to finding out whether the dual is resolvable: we have a `.is_resolvable` function, but it is rather slow.



---

archive/issue_comments_213042.json:
```json
{
    "body": "Hello,\n\n> It looks to me as if your is_group_divisible_design requires the user to hand the method the groups.\n\n\nIt does.\n\n> I was thinking of building a function to determine if a deign is group divisible without knowing what the groups might be.\n\n\nOkay.\n\n> I was slightly incorrect before.  A more accurate statement would be that the dual of a resolvable IS is an group divisible IS with the property that the blocks are transversal. \n\n\nOh, I see. I found it weird that there could exist a way to not solve the actual packing problem `;-)`\n\nNathann",
    "created_at": "2015-03-12T15:55:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16297",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16297#issuecomment-213042",
    "user": "https://github.com/nathanncohen"
}
```

Hello,

> It looks to me as if your is_group_divisible_design requires the user to hand the method the groups.


It does.

> I was thinking of building a function to determine if a deign is group divisible without knowing what the groups might be.


Okay.

> I was slightly incorrect before.  A more accurate statement would be that the dual of a resolvable IS is an group divisible IS with the property that the blocks are transversal. 


Oh, I see. I found it weird that there could exist a way to not solve the actual packing problem `;-)`

Nathann



---

archive/issue_comments_213043.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-12T15:58:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16297",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16297#issuecomment-213043",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_213044.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-03-12T15:59:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16297",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16297#issuecomment-213044",
    "user": "https://github.com/brettpim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_213045.json:
```json
{
    "body": "Hellooooooooooo again,\n\nSome remarks follow... It is a bit long, which is one of the reasons why we try\nto keep the patches 'focused'.. Sorry for that ^^;\n\n- 'union' does not appear in the index of methods\n\n- A 'the' is missing several times, e.g.: \"Return complementary incidence\n  structure.\"\n\n- Sage's source code is not the right place to ask questions. What about turning\n  this 'todo' into a trac ticket?\n\n- It is not very efficient to look for an element in a list. You could do the\n  following replacement for a better runtime:\n\n```diff\n-  if delete:\n-      int_points = frozenset(int(x) for x in self._points if x not in points)\n-  else:\n-      int_points = frozenset(int(x) for x in points)\n+  if delete:\n+      int_points = frozenset(self._points).difference(points)\n+  else:\n+      int_points = frozenset(int(x) for x in points)\n```\n\n  The same pattern appears several times.\n\n- In the sentence {{{Specify whether the objective function is to maximize the\n  cardinality of blocks in the packing}}}, could you say \"is to maximize the\n  number of blocks\" instead? I believe that this could avoid confusion.\n\n- The indentation of `+ # Maximum number of blocks ` is not correct by one\n  space.\n\n- The following replacement also makes the code simpler:\n\n```\n-            p.set_objective(p.sum([b[i]*len(self._blocks[i]) for i in range(self.num_blocks())]))\n+            p.set_objective(p.sum([b[i]*len(bi) for i,bi in enumerate(self._blocks)]))\n```\n\n- We try to keep the LaTeX readable both in html form and in text form (for\n  those who query the help from the command line) whenever possible. Could you\n  replace \"\\mid\" by \"|\" in your formulas? The latter is much easier to decrypt.\n\n- In `derived_incidence_structure` a \"\\\\neq\" is wrongly displayed in the html\n  version of the doc.\n\n- The documentation of the derived incidence structure could be made easier to\n  read as\n\n  {{{\n  At **a point**: Given a [...]\n  At **a block**: Given a [...]\n  }}}\n\n- Isn't the derived incidence structure \"at a block\" equal to the trace of the\n  incidence structure on that block? Is only 'B' missing?\n\n- \"Otherwise there is no guarantee that the derived incidence structure at a\n  block is a block design\": I do not think that this is actually necessary,\n  though it is not very important.\n\n- Could you specify in the INPUT section of `derived_incidence_structure` that\n  exactly one of `at_point` and `at_block` must be defined?\n\n- The documentation of a function is no place to ask questions on its desired\n  behaviour. Please specify in the documentation how it behaves on multiple\n  blocks if that troubles you. You can use a '.. NOTE' environment.\n\n- If neither `at_point` nor `at_block` is specified, I would say that the\n  correct behaviour is an exception. You can use the following pattern:\n\n  {{{\n  if (at_point is None) + (at_block is None) != 1:\n      raise ValueError(\"Exactly one of at_block and at_point must be specified\")\n  if at_point:\n      <code>\n  else:\n      <code>\n  }}}\n\n- `if not(at_block in self.blocks()):`: this can be rewritten as `at_block\n  not in self`. It is less wasteful, as it does not build the list of blocks\n  only to throw it away afterwards. In general `not(a in b)` is I believe\n  equivalent to `a not in b`.\n\n- `residual_incidence_structure`: the formulas do not appear correctly in the\n  html doc, probably because of the '\\\\'.\n\n- Could you specify in `residual_incidence_structure` and in\n  `derived_incidence_structure` where those definitions are taken?\n\n- `supplementary_incidence_structure`: again, testing containment in a list is\n  slow. Could you use a set instead? Then, containment tests involve equality\n  test: `a==b` is fast when `a,b` are integers but the points of an incidence\n  structure may be arbitrary objects and their equality tests may be slower. It\n  is best to work on the integers directly.\n\n- `complementary_incidence_structure`: the iterators from itertools are usually\n  faster than their 'combinat' counterpart. It is probably faster to use them:\n\n  {{{\n  sage: list(combinations([1,2,3,4],2))\n  [(1, 2), (1, 3), (1, 4), (2, 3), (2, 4), (3, 4)]\n  }}}\n\n  Here again, it is better to work on integers directly.\n\n- Do you think that it could be useful to add a 'simple' option to 'union'? It\n  would return the union of the two structures while ignoring duplicated blocks.\n\n- It feels a bit weird to carry the class' name in its methods' names. What\n  about renaming 'supplementary_incidence_structure' to 'supplement',\n  \"residual_incidence_structure\" to \"residual\", etc?..\n\nNathann",
    "created_at": "2015-03-12T18:28:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16297",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16297#issuecomment-213045",
    "user": "https://github.com/nathanncohen"
}
```

Hellooooooooooo again,

Some remarks follow... It is a bit long, which is one of the reasons why we try
to keep the patches 'focused'.. Sorry for that ^^;

- 'union' does not appear in the index of methods

- A 'the' is missing several times, e.g.: "Return complementary incidence
  structure."

- Sage's source code is not the right place to ask questions. What about turning
  this 'todo' into a trac ticket?

- It is not very efficient to look for an element in a list. You could do the
  following replacement for a better runtime:

```diff
-  if delete:
-      int_points = frozenset(int(x) for x in self._points if x not in points)
-  else:
-      int_points = frozenset(int(x) for x in points)
+  if delete:
+      int_points = frozenset(self._points).difference(points)
+  else:
+      int_points = frozenset(int(x) for x in points)
```

  The same pattern appears several times.

- In the sentence {{{Specify whether the objective function is to maximize the
  cardinality of blocks in the packing}}}, could you say "is to maximize the
  number of blocks" instead? I believe that this could avoid confusion.

- The indentation of `+ # Maximum number of blocks ` is not correct by one
  space.

- The following replacement also makes the code simpler:

```
-            p.set_objective(p.sum([b[i]*len(self._blocks[i]) for i in range(self.num_blocks())]))
+            p.set_objective(p.sum([b[i]*len(bi) for i,bi in enumerate(self._blocks)]))
```

- We try to keep the LaTeX readable both in html form and in text form (for
  those who query the help from the command line) whenever possible. Could you
  replace "\mid" by "|" in your formulas? The latter is much easier to decrypt.

- In `derived_incidence_structure` a "\\neq" is wrongly displayed in the html
  version of the doc.

- The documentation of the derived incidence structure could be made easier to
  read as

  {{{
  At **a point**: Given a [...]
  At **a block**: Given a [...]
  }}}

- Isn't the derived incidence structure "at a block" equal to the trace of the
  incidence structure on that block? Is only 'B' missing?

- "Otherwise there is no guarantee that the derived incidence structure at a
  block is a block design": I do not think that this is actually necessary,
  though it is not very important.

- Could you specify in the INPUT section of `derived_incidence_structure` that
  exactly one of `at_point` and `at_block` must be defined?

- The documentation of a function is no place to ask questions on its desired
  behaviour. Please specify in the documentation how it behaves on multiple
  blocks if that troubles you. You can use a '.. NOTE' environment.

- If neither `at_point` nor `at_block` is specified, I would say that the
  correct behaviour is an exception. You can use the following pattern:

  {{{
  if (at_point is None) + (at_block is None) != 1:
      raise ValueError("Exactly one of at_block and at_point must be specified")
  if at_point:
      <code>
  else:
      <code>
  }}}

- `if not(at_block in self.blocks()):`: this can be rewritten as `at_block
  not in self`. It is less wasteful, as it does not build the list of blocks
  only to throw it away afterwards. In general `not(a in b)` is I believe
  equivalent to `a not in b`.

- `residual_incidence_structure`: the formulas do not appear correctly in the
  html doc, probably because of the '\\'.

- Could you specify in `residual_incidence_structure` and in
  `derived_incidence_structure` where those definitions are taken?

- `supplementary_incidence_structure`: again, testing containment in a list is
  slow. Could you use a set instead? Then, containment tests involve equality
  test: `a==b` is fast when `a,b` are integers but the points of an incidence
  structure may be arbitrary objects and their equality tests may be slower. It
  is best to work on the integers directly.

- `complementary_incidence_structure`: the iterators from itertools are usually
  faster than their 'combinat' counterpart. It is probably faster to use them:

  {{{
  sage: list(combinations([1,2,3,4],2))
  [(1, 2), (1, 3), (1, 4), (2, 3), (2, 4), (3, 4)]
  }}}

  Here again, it is better to work on integers directly.

- Do you think that it could be useful to add a 'simple' option to 'union'? It
  would return the union of the two structures while ignoring duplicated blocks.

- It feels a bit weird to carry the class' name in its methods' names. What
  about renaming 'supplementary_incidence_structure' to 'supplement',
  "residual_incidence_structure" to "residual", etc?..

Nathann



---

archive/issue_comments_213046.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-03-12T18:28:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16297",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16297#issuecomment-213046",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_213047.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-13T04:05:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16297",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16297#issuecomment-213047",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_213048.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-03-13T04:08:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16297",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16297#issuecomment-213048",
    "user": "https://github.com/brettpim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_213049.json:
```json
{
    "body": "How do I link the places I use the [Col2007] reference with its appearance in the reference list?\n\nI did not change residual and derived to use trace because I thought they are probably fine as they are and deleting a block to create a new IS only to then call trace on it seemed not particularly efficient \n\nI have done everything else.",
    "created_at": "2015-03-13T04:08:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16297",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16297#issuecomment-213049",
    "user": "https://github.com/brettpim"
}
```

How do I link the places I use the [Col2007] reference with its appearance in the reference list?

I did not change residual and derived to use trace because I thought they are probably fine as they are and deleting a block to create a new IS only to then call trace on it seemed not particularly efficient 

I have done everything else.



---

archive/issue_comments_213050.json:
```json
{
    "body": "Helloooooooo Brett,\n\n- Replaced the links to [Col2007] to links toward the existing bibliographical\n  entry [DesignHandbook]. In order to link toward a bibliographical entry, you\n  must type '[DesignHandbook]_'.\n\n- Replaced ```complementary``` (appears as Python code) with\n  `*complementary*` appears in italic.\n\n- Several lines contained what we call \"trailing whitespaces\". I removed them,\n  which explains why some lines of my commit seem to make no modification at\n  all.\n\n- {{{int_points = frozenset(self._point_to_index[x] for x in\n  points).difference(points)}}}: leads to that:\n\n  {{{\n  sage: IncidenceStructure([This is the Trac macro *'a','b','c'* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#'a','b','c'-macro)).trace(['a','b']).blocks()\n  [This is the Trac macro *'a', 'b'* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#'a', 'b'-macro)\n  sage: IncidenceStructure([This is the Trac macro *'a','b','c'* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#'a','b','c'-macro)).trace(['a','b'],delete=True).blocks()\n  [This is the Trac macro *'a', 'b'* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#'a', 'b'-macro)\n  }}}\n\n  I fixed it and added a doctest.\n\n- Please do not leave commented lines in the code (unless you think we might\n  need them later), e.g.\n\n  {{{\n  #        from sage.combinat.combination import Combinations                                                                                                                                       \n  }}}\n\n- The following modifications is a bit incorrect, as what it describes is a pair\n  of Python variables. I reverted it.\n\n  {{{\n  #!diff\n  -          ``(boolean_answer,(t,v,k,l))``.\n  +          (boolean_answer,`(t,v,k,l)`).\n  }}}\n\n- The implemented code of 'derived' does not match the definition. If there are\n  repeated blocks you only remove one of them as you compare the indices. Do\n  whatever you think is best, but please make the doc consistent with the\n  implementation.\n\n- `derived` (and some other functions I believe) do not handle non-integer\n  ground sets:\n\n  {{{\n  sage: IncidenceStructure([[1,2,3],['a','b','c'],['a','b']]).residual(at_block=['a','b','c'])\n  ...\n  ValueError: ['a', 'b', 'c'] is not in list\n  }}}\n\n- `keep_repeats` -- is this keyword different from the `simple` keyword used\n  elsewhere?\n\n- These objects are incidence structures, thus the exceptions should not mention\n  a 'design'.\n\n- {{{\n  sage: IncidenceStructure(\"abc\",[\"ab\"]).complement()\n  Incidence structure with 3 points and 0 blocks\n  }}}\n\nI added a commit on top of yours at public/16534. Please mind corner-cases in\nyour code (e.g. empty list of blocks, non-integer labels) and what actually\nhappens in each command (useless copies of possibly big data).\n\nCheers,\n\nNathann",
    "created_at": "2015-03-13T09:36:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16297",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16297#issuecomment-213050",
    "user": "https://github.com/nathanncohen"
}
```

Helloooooooo Brett,

- Replaced the links to [Col2007] to links toward the existing bibliographical
  entry [DesignHandbook]. In order to link toward a bibliographical entry, you
  must type '[DesignHandbook]_'.

- Replaced ```complementary``` (appears as Python code) with
  `*complementary*` appears in italic.

- Several lines contained what we call "trailing whitespaces". I removed them,
  which explains why some lines of my commit seem to make no modification at
  all.

- {{{int_points = frozenset(self._point_to_index[x] for x in
  points).difference(points)}}}: leads to that:

  {{{
  sage: IncidenceStructure([This is the Trac macro *'a','b','c'* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#'a','b','c'-macro)).trace(['a','b']).blocks()
  [This is the Trac macro *'a', 'b'* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#'a', 'b'-macro)
  sage: IncidenceStructure([This is the Trac macro *'a','b','c'* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#'a','b','c'-macro)).trace(['a','b'],delete=True).blocks()
  [This is the Trac macro *'a', 'b'* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#'a', 'b'-macro)
  }}}

  I fixed it and added a doctest.

- Please do not leave commented lines in the code (unless you think we might
  need them later), e.g.

  {{{
  #        from sage.combinat.combination import Combinations                                                                                                                                       
  }}}

- The following modifications is a bit incorrect, as what it describes is a pair
  of Python variables. I reverted it.

  {{{
  #!diff
  -          ``(boolean_answer,(t,v,k,l))``.
  +          (boolean_answer,`(t,v,k,l)`).
  }}}

- The implemented code of 'derived' does not match the definition. If there are
  repeated blocks you only remove one of them as you compare the indices. Do
  whatever you think is best, but please make the doc consistent with the
  implementation.

- `derived` (and some other functions I believe) do not handle non-integer
  ground sets:

  {{{
  sage: IncidenceStructure([[1,2,3],['a','b','c'],['a','b']]).residual(at_block=['a','b','c'])
  ...
  ValueError: ['a', 'b', 'c'] is not in list
  }}}

- `keep_repeats` -- is this keyword different from the `simple` keyword used
  elsewhere?

- These objects are incidence structures, thus the exceptions should not mention
  a 'design'.

- {{{
  sage: IncidenceStructure("abc",["ab"]).complement()
  Incidence structure with 3 points and 0 blocks
  }}}

I added a commit on top of yours at public/16534. Please mind corner-cases in
your code (e.g. empty list of blocks, non-integer labels) and what actually
happens in each command (useless copies of possibly big data).

Cheers,

Nathann



---

archive/issue_comments_213051.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-03-13T09:36:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16297",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16297#issuecomment-213051",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to needs_work.
