# Issue 16624: upgrade sympy to version 0.7.5

archive/issues_016387.json:
```json
{
    "body": "It's at https://github.com/sympy/sympy/releases/download/sympy-0.7.5/sympy-0.7.5.tar.gz\n\nFor starters the better diophantine solver abilities are needed by #16590\n\nReported as https://github.com/sympy/sympy/issues/8022\n\nCC:  @kiwifb\n\nKeywords: upgrade, mpmath\n\nUpstream: Reported upstream. Developers acknowledge bug.\n\nReviewer: Volker Braun\n\nAuthor: Ralf Stephan, Sergey B Kirpichev\n\nBranch: e6c24d3106cba8af3e9f662aa0b38725d656e520\n\nCommit: e6c24d3106cba8af3e9f662aa0b38725d656e520\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/16624\n\n",
    "closed_at": "2014-11-14T21:01:27Z",
    "created_at": "2014-07-08T09:34:59Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "upgrade sympy to version 0.7.5",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16624",
    "user": "https://github.com/rwst"
}
```
It's at https://github.com/sympy/sympy/releases/download/sympy-0.7.5/sympy-0.7.5.tar.gz

For starters the better diophantine solver abilities are needed by #16590

Reported as https://github.com/sympy/sympy/issues/8022

CC:  @kiwifb

Keywords: upgrade, mpmath

Upstream: Reported upstream. Developers acknowledge bug.

Reviewer: Volker Braun

Author: Ralf Stephan, Sergey B Kirpichev

Branch: e6c24d3106cba8af3e9f662aa0b38725d656e520

Commit: e6c24d3106cba8af3e9f662aa0b38725d656e520

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/16624





---

archive/issue_comments_214876.json:
```json
{
    "body": "<a id='comment:2'></a>No idea what's the matter here:\n\n```\nTraceback (most recent call last):\n  File \"/home/ralf/sage/src/bin/sage-runtests\", line 87, in <module>\n    err = DC.run()\n  File \"/home/ralf/sage/local/lib/python2.7/site-packages/sage/doctest/control.py\", line 904, in run\n    self.run_doctests()\n  File \"/home/ralf/sage/local/lib/python2.7/site-packages/sage/doctest/control.py\", line 674, in run_doctests\n    self.dispatcher = DocTestDispatcher(self)\n  File \"/home/ralf/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1335, in __init__\n    init_sage()\n  File \"/home/ralf/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 113, in init_sage\n    from sympy.printing.pretty.stringpict import stringPict\n  File \"/home/ralf/sage/local/lib/python2.7/site-packages/sympy/__init__.py\", line 32, in <module>\n    from .core import *\n  File \"/home/ralf/sage/local/lib/python2.7/site-packages/sympy/core/__init__.py\", line 8, in <module>\n    from .expr import Expr, AtomicExpr\n  File \"/home/ralf/sage/local/lib/python2.7/site-packages/sympy/core/expr.py\", line 7, in <module>\n    from .evalf import EvalfMixin, pure_complex\n  File \"/home/ralf/sage/local/lib/python2.7/site-packages/sympy/core/evalf.py\", line 9, in <module>\n    import sympy.mpmath.libmp as libmp\n  File \"/home/ralf/sage/local/lib/python2.7/site-packages/sympy/mpmath/__init__.py\", line 6, in <module>\n    from .ctx_mp import MPContext\n  File \"/home/ralf/sage/local/lib/python2.7/site-packages/sympy/mpmath/ctx_mp.py\", line 47, in <module>\n    from sage.libs.mpmath.ext_main import Context as BaseMPContext\n  File \"ext_main.pyx\", line 38, in init sage.libs.mpmath.ext_main (build/cythonized/sage/libs/mpmath/ext_main.c:28725)\n  File \"/home/ralf/sage/local/lib/python2.7/site-packages/mpmath/__init__.py\", line 6, in <module>\n    from .ctx_mp import MPContext\n  File \"/home/ralf/sage/local/lib/python2.7/site-packages/mpmath/ctx_mp.py\", line 49, in <module>\n    import sage.libs.mpmath.ext_main as _mpf_module\nAttributeError: 'module' object has no attribute 'ext_main'\nmake: *** [ptestlong] Error 1\n```\n\n---\nNew commits:",
    "created_at": "2014-07-09T13:18:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16624#issuecomment-214876",
    "user": "https://github.com/rwst"
}
```

<a id='comment:2'></a>No idea what's the matter here:

```
Traceback (most recent call last):
  File "/home/ralf/sage/src/bin/sage-runtests", line 87, in <module>
    err = DC.run()
  File "/home/ralf/sage/local/lib/python2.7/site-packages/sage/doctest/control.py", line 904, in run
    self.run_doctests()
  File "/home/ralf/sage/local/lib/python2.7/site-packages/sage/doctest/control.py", line 674, in run_doctests
    self.dispatcher = DocTestDispatcher(self)
  File "/home/ralf/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1335, in __init__
    init_sage()
  File "/home/ralf/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 113, in init_sage
    from sympy.printing.pretty.stringpict import stringPict
  File "/home/ralf/sage/local/lib/python2.7/site-packages/sympy/__init__.py", line 32, in <module>
    from .core import *
  File "/home/ralf/sage/local/lib/python2.7/site-packages/sympy/core/__init__.py", line 8, in <module>
    from .expr import Expr, AtomicExpr
  File "/home/ralf/sage/local/lib/python2.7/site-packages/sympy/core/expr.py", line 7, in <module>
    from .evalf import EvalfMixin, pure_complex
  File "/home/ralf/sage/local/lib/python2.7/site-packages/sympy/core/evalf.py", line 9, in <module>
    import sympy.mpmath.libmp as libmp
  File "/home/ralf/sage/local/lib/python2.7/site-packages/sympy/mpmath/__init__.py", line 6, in <module>
    from .ctx_mp import MPContext
  File "/home/ralf/sage/local/lib/python2.7/site-packages/sympy/mpmath/ctx_mp.py", line 47, in <module>
    from sage.libs.mpmath.ext_main import Context as BaseMPContext
  File "ext_main.pyx", line 38, in init sage.libs.mpmath.ext_main (build/cythonized/sage/libs/mpmath/ext_main.c:28725)
  File "/home/ralf/sage/local/lib/python2.7/site-packages/mpmath/__init__.py", line 6, in <module>
    from .ctx_mp import MPContext
  File "/home/ralf/sage/local/lib/python2.7/site-packages/mpmath/ctx_mp.py", line 49, in <module>
    import sage.libs.mpmath.ext_main as _mpf_module
AttributeError: 'module' object has no attribute 'ext_main'
make: *** [ptestlong] Error 1
```

---
New commits:



---

archive/issue_comments_214877.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-07-11T07:59:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16624#issuecomment-214877",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_214878.json:
```json
{
    "body": "<a id='comment:4'></a>Even with sympy-0.7.4 in a fresh Sage I get\n\n```\nsage:     import sage.libs.mpmath.ext_main as _mpf_module\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n<ipython-input-1-06f00c8c1fbc> in <module>()\n----> 1 import sage.libs.mpmath.ext_main as _mpf_module\n\n/home/ralf/sage/ext_main.pyx in init sage.libs.mpmath.ext_main (build/cythonized/sage/libs/mpmath/ext_main.c:28725)()\n\n/home/ralf/sage/local/lib/python2.7/site-packages/mpmath/__init__.py in <module>()\n      4 \n      5 from .ctx_fp import FPContext\n----> 6 from .ctx_mp import MPContext\n      7 from .ctx_iv import MPIntervalContext\n      8 \n\n/home/ralf/sage/local/lib/python2.7/site-packages/mpmath/ctx_mp.py in <module>()\n     47     from sage.libs.mpmath.ext_main import Context as BaseMPContext\n     48     # pickle hack\n---> 49     import sage.libs.mpmath.ext_main as _mpf_module\n     50 else:\n     51     from .ctx_mp_python import PythonMPContext as BaseMPContext\n\nAttributeError: 'module' object has no attribute 'ext_main'\n```\nThis and the 0.7.5 failure both can be cured for example with\n\n```\n--- mpmath/libmp/backend.py~    2013-08-08 14:49:58.000000000 +0200\n+++ mpmath/libmp/backend.py     2014-07-11 08:54:28.759388954 +0200\n@@ -71,6 +71,7 @@\n     try:\n         import sage.all\n         import sage.libs.mpmath.utils as _sage_utils\n+        import sage.libs.mpmath.ext_main as _mpf_module\n         sage = sage.all\n         sage_utils = _sage_utils\n         BACKEND = 'sage'\n```\nSo it seems `ext_main` has to be imported in the right place and there was somewhere an import in `sympy-0.7.4` that made that version work but that was changed in `0.7.5`. It does not work to simply catch the error and import again, while it works when in a fresh Sage with `0.7.4`.",
    "created_at": "2014-07-11T08:00:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16624#issuecomment-214878",
    "user": "https://github.com/rwst"
}
```

<a id='comment:4'></a>Even with sympy-0.7.4 in a fresh Sage I get

```
sage:     import sage.libs.mpmath.ext_main as _mpf_module
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-1-06f00c8c1fbc> in <module>()
----> 1 import sage.libs.mpmath.ext_main as _mpf_module

/home/ralf/sage/ext_main.pyx in init sage.libs.mpmath.ext_main (build/cythonized/sage/libs/mpmath/ext_main.c:28725)()

/home/ralf/sage/local/lib/python2.7/site-packages/mpmath/__init__.py in <module>()
      4 
      5 from .ctx_fp import FPContext
----> 6 from .ctx_mp import MPContext
      7 from .ctx_iv import MPIntervalContext
      8 

/home/ralf/sage/local/lib/python2.7/site-packages/mpmath/ctx_mp.py in <module>()
     47     from sage.libs.mpmath.ext_main import Context as BaseMPContext
     48     # pickle hack
---> 49     import sage.libs.mpmath.ext_main as _mpf_module
     50 else:
     51     from .ctx_mp_python import PythonMPContext as BaseMPContext

AttributeError: 'module' object has no attribute 'ext_main'
```
This and the 0.7.5 failure both can be cured for example with

```
--- mpmath/libmp/backend.py~    2013-08-08 14:49:58.000000000 +0200
+++ mpmath/libmp/backend.py     2014-07-11 08:54:28.759388954 +0200
@@ -71,6 +71,7 @@
     try:
         import sage.all
         import sage.libs.mpmath.utils as _sage_utils
+        import sage.libs.mpmath.ext_main as _mpf_module
         sage = sage.all
         sage_utils = _sage_utils
         BACKEND = 'sage'
```
So it seems `ext_main` has to be imported in the right place and there was somewhere an import in `sympy-0.7.4` that made that version work but that was changed in `0.7.5`. It does not work to simply catch the error and import again, while it works when in a fresh Sage with `0.7.4`.



---

archive/issue_events_048757.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16624",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16624#event-48757"
}
```



---

archive/issue_comments_214879.json:
```json
{
    "body": "<a id='comment:7'></a>The whole thing seems to go in circle. I am wondering if the real problem is that first a function is imported from ext_main\n\n```\n/home/ralf/sage/local/lib/python2.7/site-packages/mpmath/ctx_mp.py in <module>()\n     47     from sage.libs.mpmath.ext_main import Context as BaseMPContext\n```\nand then you want to import the whole ext_main\n\n```\n     48     # pickle hack\n---> 49     import sage.libs.mpmath.ext_main as _mpf_module\n```\nI wonder what they mean by pickle hack? Presumably if we add the import in backend.py the import in ctx_mp.py becomes redundant?",
    "created_at": "2014-08-12T22:01:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16624#issuecomment-214879",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:7'></a>The whole thing seems to go in circle. I am wondering if the real problem is that first a function is imported from ext_main

```
/home/ralf/sage/local/lib/python2.7/site-packages/mpmath/ctx_mp.py in <module>()
     47     from sage.libs.mpmath.ext_main import Context as BaseMPContext
```
and then you want to import the whole ext_main

```
     48     # pickle hack
---> 49     import sage.libs.mpmath.ext_main as _mpf_module
```
I wonder what they mean by pickle hack? Presumably if we add the import in backend.py the import in ctx_mp.py becomes redundant?



---

archive/issue_comments_214880.json:
```json
{
    "body": "<a id='comment:8'></a>I tried this patch but the results are the same:\n\n```\ndiff --git a/build/pkgs/sympy/patches/import-extmain.patch b/build/pkgs/sympy/patches/import-extmain.patch\nnew file mode 100644\nindex 0000000..af222c1\n--- /dev/null\n+++ b/build/pkgs/sympy/patches/import-extmain.patch\n@@ -0,0 +1,15 @@\n+--- sympy/mpmath/ctx_mp.py~   2014-02-22 20:13:32.000000000 +0100\n++++ sympy/mpmath/ctx_mp.py    2014-09-11 18:09:11.877599866 +0200\n+@@ -44,9 +44,9 @@\n+                          r'(?P<im>[\\+\\-]?\\d*\\.?\\d*(e[\\+\\-]?\\d+)?j)?\\)?$')\n+ \n+ if BACKEND == 'sage':\n+-    from sage.libs.mpmath.ext_main import Context as BaseMPContext\n+     # pickle hack\n+-    import sage.libs.mpmath.ext_main as _mpf_module\n++    from sage.libs.mpmath import ext_main as _mpf_module\n++    from sage.libs.mpmath.ext_main import Context as BaseMPContext\n+ else:\n+     from .ctx_mp_python import PythonMPContext as BaseMPContext\n+     from . import ctx_mp_python as _mpf_module\n+\n```\nTo be specific, at the moment it's not possible to import anything from sympy. What happens is that at the first attempt the following is raised:\n\n```\n----> 1 from sympy import sympify\n\n/home/ralf/sage/local/lib/python2.7/site-packages/sympy/__init__.py in <module>()\n     33 from .logic import *\n     34 from .assumptions import *\n---> 35 from .polys import *\n     36 from .series import *\n     37 from .functions import *\n\n/home/ralf/sage/local/lib/python2.7/site-packages/sympy/polys/__init__.py in <module>()\n      3 __all__ = []\n      4 \n----> 5 from . import polytools\n      6 __all__.extend(polytools.__all__)\n      7 from .polytools import *\n\n/home/ralf/sage/local/lib/python2.7/site-packages/sympy/polys/polytools.py in <module>()                                                                                      \n     50 import sympy.mpmath\n     51 \n---> 52 from sympy.polys.domains import FF, QQ\n     53 from sympy.polys.constructor import construct_domain\n     54 \n\n/home/ralf/sage/local/lib/python2.7/site-packages/sympy/polys/domains/__init__.py in <module>()\n     76 QQ_gmpy = GMPYRationalField\n     77 \n---> 78 RR = RealField()\n     79 CC = ComplexField()\n     80 \n\n/home/ralf/sage/local/lib/python2.7/site-packages/sympy/polys/domains/realfield.py in __init__(self, prec, dps, tol)\n     52 \n     53         self.dtype = context.mpf\n---> 54         self.zero = self.dtype(0)\n     55         self.one = self.dtype(1)\n     56 \n\n/home/ralf/sage/local/lib/python2.7/site-packages/sympy/mpmath/ctx_mp_python.py in __new__(cls, val, **kwargs)\n     75         else:\n     76             v = new(cls)\n---> 77             v._mpf_ = mpf_pos(cls.mpf_convert_arg(val, prec, rounding), prec, rounding)\n     78             return v\n     79 \n\n/home/ralf/sage/local/lib/python2.7/site-packages/sympy/polys/domains/mpelements.py in _set_mpf(self, val)\n     23         tol = self.context.tol\n     24 \n---> 25         if mpf_lt(mpf_abs(val, prec, rounding), tol):\n     26             self.__mpf__ = fzero\n     27         else:\n\n/home/ralf/sage/local/lib/python2.7/site-packages/sympy/mpmath/libmp/libmpf.py in mpf_abs(s, prec, rnd)\n    662             return (0, man, exp, bc)\n    663         return s\n--> 664     return normalize1(0, man, exp, bc, prec, rnd)\n    665 \n    666 def mpf_sign(s):\n\nTypeError: Argument 'man' has incorrect type (expected sage.rings.integer.Integer, got long)\n```\nand at any further attempt this one:\n\n```\n----> 1 from sympy.solvers.diophantine import *\n\n/home/ralf/sage/local/lib/python2.7/site-packages/sympy/__init__.py in <module>()\n     33 from .logic import *\n     34 from .assumptions import *\n---> 35 from .polys import *\n     36 from .series import *\n     37 from .functions import *\n\n/home/ralf/sage/local/lib/python2.7/site-packages/sympy/polys/__init__.py in <module>()\n      3 __all__ = []\n      4 \n----> 5 from . import polytools\n      6 __all__.extend(polytools.__all__)\n      7 from .polytools import *\n\n/home/ralf/sage/local/lib/python2.7/site-packages/sympy/polys/polytools.py in <module>()                                                                                      \n     50 import sympy.mpmath\n     51 \n---> 52 from sympy.polys.domains import FF, QQ\n     53 from sympy.polys.constructor import construct_domain\n     54 \n\n/home/ralf/sage/local/lib/python2.7/site-packages/sympy/polys/domains/__init__.py in <module>()\n      3 __all__ = []\n      4 \n----> 5 from . import domain\n      6 __all__.extend(domain.__all__)\n      7 from .domain import *\n\nImportError: cannot import name domain\n```",
    "created_at": "2014-09-12T07:46:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16624#issuecomment-214880",
    "user": "https://github.com/rwst"
}
```

<a id='comment:8'></a>I tried this patch but the results are the same:

```
diff --git a/build/pkgs/sympy/patches/import-extmain.patch b/build/pkgs/sympy/patches/import-extmain.patch
new file mode 100644
index 0000000..af222c1
--- /dev/null
+++ b/build/pkgs/sympy/patches/import-extmain.patch
@@ -0,0 +1,15 @@
+--- sympy/mpmath/ctx_mp.py~   2014-02-22 20:13:32.000000000 +0100
++++ sympy/mpmath/ctx_mp.py    2014-09-11 18:09:11.877599866 +0200
+@@ -44,9 +44,9 @@
+                          r'(?P<im>[\+\-]?\d*\.?\d*(e[\+\-]?\d+)?j)?\)?$')
+ 
+ if BACKEND == 'sage':
+-    from sage.libs.mpmath.ext_main import Context as BaseMPContext
+     # pickle hack
+-    import sage.libs.mpmath.ext_main as _mpf_module
++    from sage.libs.mpmath import ext_main as _mpf_module
++    from sage.libs.mpmath.ext_main import Context as BaseMPContext
+ else:
+     from .ctx_mp_python import PythonMPContext as BaseMPContext
+     from . import ctx_mp_python as _mpf_module
+
```
To be specific, at the moment it's not possible to import anything from sympy. What happens is that at the first attempt the following is raised:

```
----> 1 from sympy import sympify

/home/ralf/sage/local/lib/python2.7/site-packages/sympy/__init__.py in <module>()
     33 from .logic import *
     34 from .assumptions import *
---> 35 from .polys import *
     36 from .series import *
     37 from .functions import *

/home/ralf/sage/local/lib/python2.7/site-packages/sympy/polys/__init__.py in <module>()
      3 __all__ = []
      4 
----> 5 from . import polytools
      6 __all__.extend(polytools.__all__)
      7 from .polytools import *

/home/ralf/sage/local/lib/python2.7/site-packages/sympy/polys/polytools.py in <module>()                                                                                      
     50 import sympy.mpmath
     51 
---> 52 from sympy.polys.domains import FF, QQ
     53 from sympy.polys.constructor import construct_domain
     54 

/home/ralf/sage/local/lib/python2.7/site-packages/sympy/polys/domains/__init__.py in <module>()
     76 QQ_gmpy = GMPYRationalField
     77 
---> 78 RR = RealField()
     79 CC = ComplexField()
     80 

/home/ralf/sage/local/lib/python2.7/site-packages/sympy/polys/domains/realfield.py in __init__(self, prec, dps, tol)
     52 
     53         self.dtype = context.mpf
---> 54         self.zero = self.dtype(0)
     55         self.one = self.dtype(1)
     56 

/home/ralf/sage/local/lib/python2.7/site-packages/sympy/mpmath/ctx_mp_python.py in __new__(cls, val, **kwargs)
     75         else:
     76             v = new(cls)
---> 77             v._mpf_ = mpf_pos(cls.mpf_convert_arg(val, prec, rounding), prec, rounding)
     78             return v
     79 

/home/ralf/sage/local/lib/python2.7/site-packages/sympy/polys/domains/mpelements.py in _set_mpf(self, val)
     23         tol = self.context.tol
     24 
---> 25         if mpf_lt(mpf_abs(val, prec, rounding), tol):
     26             self.__mpf__ = fzero
     27         else:

/home/ralf/sage/local/lib/python2.7/site-packages/sympy/mpmath/libmp/libmpf.py in mpf_abs(s, prec, rnd)
    662             return (0, man, exp, bc)
    663         return s
--> 664     return normalize1(0, man, exp, bc, prec, rnd)
    665 
    666 def mpf_sign(s):

TypeError: Argument 'man' has incorrect type (expected sage.rings.integer.Integer, got long)
```
and at any further attempt this one:

```
----> 1 from sympy.solvers.diophantine import *

/home/ralf/sage/local/lib/python2.7/site-packages/sympy/__init__.py in <module>()
     33 from .logic import *
     34 from .assumptions import *
---> 35 from .polys import *
     36 from .series import *
     37 from .functions import *

/home/ralf/sage/local/lib/python2.7/site-packages/sympy/polys/__init__.py in <module>()
      3 __all__ = []
      4 
----> 5 from . import polytools
      6 __all__.extend(polytools.__all__)
      7 from .polytools import *

/home/ralf/sage/local/lib/python2.7/site-packages/sympy/polys/polytools.py in <module>()                                                                                      
     50 import sympy.mpmath
     51 
---> 52 from sympy.polys.domains import FF, QQ
     53 from sympy.polys.constructor import construct_domain
     54 

/home/ralf/sage/local/lib/python2.7/site-packages/sympy/polys/domains/__init__.py in <module>()
      3 __all__ = []
      4 
----> 5 from . import domain
      6 __all__.extend(domain.__all__)
      7 from .domain import *

ImportError: cannot import name domain
```



---

archive/issue_comments_214881.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2014-09-12T08:15:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16624#issuecomment-214881",
    "user": "https://github.com/rwst"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_214882.json:
```json
{
    "body": "<a id='comment:10'></a>Attachment [0001-Update-the-sympy-package.patch.gz](tarball://root/attachments/some-uuid/ticket16624/0001-Update-the-sympy-package.patch.gz) by skirpichev created at 2014-09-30 16:14:19\n\nIf you include patch to unbundle mpmath (see attached patch) - it will solve your problem.",
    "created_at": "2014-09-30T16:14:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16624#issuecomment-214882",
    "user": "https://trac.sagemath.org/admin/accounts/users/skirpichev"
}
```

<a id='comment:10'></a>Attachment [0001-Update-the-sympy-package.patch.gz](tarball://root/attachments/some-uuid/ticket16624/0001-Update-the-sympy-package.patch.gz) by skirpichev created at 2014-09-30 16:14:19

If you include patch to unbundle mpmath (see attached patch) - it will solve your problem.



---

archive/issue_comments_214883.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2014-09-30T16:16:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16624#issuecomment-214883",
    "user": "https://trac.sagemath.org/admin/accounts/users/skirpichev"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_214884.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:10 skirpichev]:\n> If you include patch to unbundle mpmath (see attached patch) - it will solve your problem.\n\nI am a bit surprised by this assertion. Gentoo and by extension sage-on-gentoo unbundle mpmath (I was the person who introduced unbundling of mpmath from sympy on Gentoo). Yet I can see this bug with sympy 0.7.4.1 and mpmath 0.19. Your patch must do something else apart from unbundling.",
    "created_at": "2014-10-02T08:50:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16624#issuecomment-214884",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:12'></a>Replying to [comment:10 skirpichev]:
> If you include patch to unbundle mpmath (see attached patch) - it will solve your problem.

I am a bit surprised by this assertion. Gentoo and by extension sage-on-gentoo unbundle mpmath (I was the person who introduced unbundling of mpmath from sympy on Gentoo). Yet I can see this bug with sympy 0.7.4.1 and mpmath 0.19. Your patch must do something else apart from unbundling.



---

archive/issue_comments_214885.json:
```json
{
    "body": "<a id='comment:13'></a>> I am a bit surprised by this assertion.\n\n\nIt does work for me.  Can you reproduce the bug with this patch?\n\n> Gentoo and by extension sage-on-gentoo unbundle mpmath\n\n\nThis:\nhttp://dev.gentoo.org/~bicatali/distfiles/sympy-0.7.4.1-system-mpmath.patch.gz\n?\n\nPerhaps, it's wrong patch and it just break sympy.  Can you post the traceback for failure in this version?\n\n> Your patch must do something else apart from unbundling.\n\n\nSure.  \"Something else\" - SPKG.txt changes (e.g. Homepage field, changelog and so on).  But the only real change is unbundling mpmath.",
    "created_at": "2014-10-02T10:02:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16624#issuecomment-214885",
    "user": "https://trac.sagemath.org/admin/accounts/users/skirpichev"
}
```

<a id='comment:13'></a>> I am a bit surprised by this assertion.


It does work for me.  Can you reproduce the bug with this patch?

> Gentoo and by extension sage-on-gentoo unbundle mpmath


This:
http://dev.gentoo.org/~bicatali/distfiles/sympy-0.7.4.1-system-mpmath.patch.gz
?

Perhaps, it's wrong patch and it just break sympy.  Can you post the traceback for failure in this version?

> Your patch must do something else apart from unbundling.


Sure.  "Something else" - SPKG.txt changes (e.g. Homepage field, changelog and so on).  But the only real change is unbundling mpmath.



---

archive/issue_comments_214886.json:
```json
{
    "body": "<a id='comment:14'></a>Your big patch is unreadable - too big. most of it is the removal of mpmath sources from sympy. This could be achieved in spkg-src by doing a \"rm -rf\" in the appropriate place. Once that's out of the way we can look at the patch to do the rest and it won't be 2.1MB and we'll be able to see something.",
    "created_at": "2014-10-03T02:09:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16624#issuecomment-214886",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:14'></a>Your big patch is unreadable - too big. most of it is the removal of mpmath sources from sympy. This could be achieved in spkg-src by doing a "rm -rf" in the appropriate place. Once that's out of the way we can look at the patch to do the rest and it won't be 2.1MB and we'll be able to see something.



---

archive/issue_comments_214887.json:
```json
{
    "body": "<a id='comment:15'></a>It looks like the only file not being deleted is `mpmath/tests/__init__.py`.",
    "created_at": "2014-10-03T08:09:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16624#issuecomment-214887",
    "user": "https://github.com/rwst"
}
```

<a id='comment:15'></a>It looks like the only file not being deleted is `mpmath/tests/__init__.py`.



---

archive/issue_comments_214888.json:
```json
{
    "body": "Changing keywords from \"\" to \"upgrade, mpmath\".",
    "created_at": "2014-10-03T08:09:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16624#issuecomment-214888",
    "user": "https://github.com/rwst"
}
```

Changing keywords from "" to "upgrade, mpmath".



---

archive/issue_comments_214889.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-03T09:51:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16624#issuecomment-214889",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_214890.json:
```json
{
    "body": "<a id='comment:17'></a>More can be deleted (mpmath docs). This passes `make ptestlong`.",
    "created_at": "2014-10-03T09:52:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16624#issuecomment-214890",
    "user": "https://github.com/rwst"
}
```

<a id='comment:17'></a>More can be deleted (mpmath docs). This passes `make ptestlong`.



---

archive/issue_comments_214891.json:
```json
{
    "body": "<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-03T13:06:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16624#issuecomment-214891",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_214892.json:
```json
{
    "body": "<a id='comment:19'></a>\n```\n build/pkgs/sympy/patches/01_no-mpmath.patch | 841 +++++++++++++++++++++++++++++++++++\n```\nNow that's more like it. Please review.",
    "created_at": "2014-10-03T13:08:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16624#issuecomment-214892",
    "user": "https://github.com/rwst"
}
```

<a id='comment:19'></a>
```
 build/pkgs/sympy/patches/01_no-mpmath.patch | 841 +++++++++++++++++++++++++++++++++++
```
Now that's more like it. Please review.



---

archive/issue_comments_214893.json:
```json
{
    "body": "<a id='comment:20'></a>> Your big patch is unreadable - too big.\n\n\nIt's upstream patch.  Does it harm your patch utility, what's wrong?)\n\nI don't see points to modify it, unless you want break this patch just like gentoo one...\n\n> remove files via spkg-install\n\n\nremove sympy/mpmath/tests/__init__.py too",
    "created_at": "2014-10-03T18:22:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16624#issuecomment-214893",
    "user": "https://trac.sagemath.org/admin/accounts/users/skirpichev"
}
```

<a id='comment:20'></a>> Your big patch is unreadable - too big.


It's upstream patch.  Does it harm your patch utility, what's wrong?)

I don't see points to modify it, unless you want break this patch just like gentoo one...

> remove files via spkg-install


remove sympy/mpmath/tests/__init__.py too



---

archive/issue_comments_214894.json:
```json
{
    "body": "<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-04T12:57:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16624#issuecomment-214894",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_214895.json:
```json
{
    "body": "<a id='comment:22'></a>lgtm",
    "created_at": "2014-11-02T17:29:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16624#issuecomment-214895",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:22'></a>lgtm



---

archive/issue_comments_214896.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-11-02T17:29:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16624#issuecomment-214896",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_214897.json:
```json
{
    "body": "<a id='comment:24'></a>When applying patches, please use the code from\n[http://www.sagemath.org/doc/developer/packaging.html#patching-sources](http://www.sagemath.org/doc/developer/packaging.html#patching-sources)\n\nOtherwise patching will break needlessly if there no patches.",
    "created_at": "2014-11-03T09:10:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16624#issuecomment-214897",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:24'></a>When applying patches, please use the code from
[http://www.sagemath.org/doc/developer/packaging.html#patching-sources](http://www.sagemath.org/doc/developer/packaging.html#patching-sources)

Otherwise patching will break needlessly if there no patches.



---

archive/issue_comments_214898.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2014-11-03T09:10:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16624#issuecomment-214898",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_214899.json:
```json
{
    "body": "<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-11-03T09:30:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16624#issuecomment-214899",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_214900.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2014-11-03T10:02:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16624#issuecomment-214900",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_214901.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-11-14T21:01:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16624",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16624#issuecomment-214901",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_048758.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-11-14T21:01:27Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16624",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16624#event-48758"
}
```
