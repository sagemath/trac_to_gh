# Issue 16269: Cartesian Products of additive groups

archive/issues_016032.json:
```json
{
    "body": "With this branch, one can see the product of two fields (or the product of one field and an additive group) as an additive group.\n\n```\nsage: F8=GF(8,'x') \nsage: x = F8.primitive_element()\nsage: F5=GF(5)\nsage: F8xF5 = F8.cartesian_product(F5)\nsage: F8xF5.an_element()\n(0, 0)\nsage: e=F8xF5((x,4))    \nsage: e\n(x, 4)\nsage: e+e\n(0, 3)\nsage: 3*e\n(x, 2)\nsage: -e\n(x, 1)\n```\n\nCC:  @nthiery @dimpase @videlec\n\nBranch/Commit: 0a54b68c242cc6541108b709170c35b3a79515b8\n\nReviewer: Nathann Cohen, Nicolas M. Thi\u00e9ry\n\nAuthor: Nathann Cohen, Nicolas M. Thi\u00e9ry\n\nDependencies: #16280\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/16269\n\n",
    "closed_at": "2014-05-06T18:03:39Z",
    "created_at": "2014-04-30T07:13:48Z",
    "labels": [
        "component: categories"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.3",
    "title": "Cartesian Products of additive groups",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16269",
    "user": "https://github.com/nathanncohen"
}
```
With this branch, one can see the product of two fields (or the product of one field and an additive group) as an additive group.

```
sage: F8=GF(8,'x') 
sage: x = F8.primitive_element()
sage: F5=GF(5)
sage: F8xF5 = F8.cartesian_product(F5)
sage: F8xF5.an_element()
(0, 0)
sage: e=F8xF5((x,4))    
sage: e
(x, 4)
sage: e+e
(0, 3)
sage: 3*e
(x, 2)
sage: -e
(x, 1)
```

CC:  @nthiery @dimpase @videlec

Branch/Commit: 0a54b68c242cc6541108b709170c35b3a79515b8

Reviewer: Nathann Cohen, Nicolas M. Thiéry

Author: Nathann Cohen, Nicolas M. Thiéry

Dependencies: #16280

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/16269





---

archive/issue_comments_222090.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-04-30T07:14:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16269#issuecomment-222090",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_222091.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-04-30T07:15:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16269#issuecomment-222091",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_222092.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-04-30T07:17:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16269#issuecomment-222092",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_222093.json:
```json
{
    "body": "<a id='comment:4'></a>Hmm, do you mean to construct the Cartesian product of fields? Then it will be a ring, with two operations, addition and multiplication...\n\n---\nNew commits:",
    "created_at": "2014-04-30T07:19:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16269#issuecomment-222093",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'></a>Hmm, do you mean to construct the Cartesian product of fields? Then it will be a ring, with two operations, addition and multiplication...

---
New commits:



---

archive/issue_comments_222094.json:
```json
{
    "body": "<a id='comment:5'></a>Passes all tests ! The try/except in `_element_constructor_` is because of this discussion https://groups.google.com/d/topic/sage-devel/tHallML3OYI/discussion\n\nIn the meantime, as it seems you cannot call `FiniteEnumeratedSet(a_list)(something)` then  it is unavoidable\n\nNathann",
    "created_at": "2014-04-30T08:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16269#issuecomment-222094",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:5'></a>Passes all tests ! The try/except in `_element_constructor_` is because of this discussion https://groups.google.com/d/topic/sage-devel/tHallML3OYI/discussion

In the meantime, as it seems you cannot call `FiniteEnumeratedSet(a_list)(something)` then  it is unavoidable

Nathann



---

archive/issue_comments_222095.json:
```json
{
    "body": "<a id='comment:6'></a>Yo !\n\n> Hmm, do you mean to construct the Cartesian product of fields? Then it will be a ring, with two operations, addition and multiplication...\n\n\nHmmmm.. Well, I guess it may not be very hard to do. \n\n1) A ring is a additive group (so the + is already implemented) for the product of rings\n\n2) It has a multiplicative operation, but perhaps the product of multiplicative associative magma is not detected as such. If you can just give Sage the right inheritances, perhaps you have no real code to implement.\n\nGood luck,\n\nNathann",
    "created_at": "2014-04-30T08:09:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16269#issuecomment-222095",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:6'></a>Yo !

> Hmm, do you mean to construct the Cartesian product of fields? Then it will be a ring, with two operations, addition and multiplication...


Hmmmm.. Well, I guess it may not be very hard to do. 

1) A ring is a additive group (so the + is already implemented) for the product of rings

2) It has a multiplicative operation, but perhaps the product of multiplicative associative magma is not detected as such. If you can just give Sage the right inheritances, perhaps you have no real code to implement.

Good luck,

Nathann



---

archive/issue_comments_222096.json:
```json
{
    "body": "<a id='comment:7'></a>Funny, there is no `rings.<tab>` thing...\n\nNathann",
    "created_at": "2014-04-30T08:10:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16269#issuecomment-222096",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:7'></a>Funny, there is no `rings.<tab>` thing...

Nathann



---

archive/issue_comments_222097.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-04-30T08:10:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16269#issuecomment-222097",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_222098.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:5 ncohen]:\n> Passes all tests ! The try/except in `_element_constructor_` is because of this discussion https://groups.google.com/d/topic/sage-devel/tHallML3OYI/discussion\n> \n> In the meantime, as it seems you cannot call `FiniteEnumeratedSet(a_list)(something)` then  it is unavoidable\n> \n> Nathann\n\n\nYour `_element_constructor_` is buggy\n\n```\nsage: S1 = FiniteEnumeratedSet(['a','b','c'])\nsage: S2 = GF(5)\nsage: C=cartesian_product([S1,S2])\nsage: C(('a',1))\n('a', 1)\nsage: c = C(('a',1))\nsage: c[1].parent()\nInteger Ring\n```\nIt would be better to clean the input of the cartesian product set by set.",
    "created_at": "2014-04-30T08:21:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16269#issuecomment-222098",
    "user": "https://github.com/videlec"
}
```

<a id='comment:9'></a>Replying to [comment:5 ncohen]:
> Passes all tests ! The try/except in `_element_constructor_` is because of this discussion https://groups.google.com/d/topic/sage-devel/tHallML3OYI/discussion
> 
> In the meantime, as it seems you cannot call `FiniteEnumeratedSet(a_list)(something)` then  it is unavoidable
> 
> Nathann


Your `_element_constructor_` is buggy

```
sage: S1 = FiniteEnumeratedSet(['a','b','c'])
sage: S2 = GF(5)
sage: C=cartesian_product([S1,S2])
sage: C(('a',1))
('a', 1)
sage: c = C(('a',1))
sage: c[1].parent()
Integer Ring
```
It would be better to clean the input of the cartesian product set by set.



---

archive/issue_comments_222099.json:
```json
{
    "body": "<a id='comment:10'></a>I'd say: don't worry about the Rings thing for now unless you critically need it. It will be a one line to add once #10963 is in. Just handle the additive and multiplicative side separately.\n\nI'll have a look at this later today.",
    "created_at": "2014-04-30T08:30:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16269#issuecomment-222099",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:10'></a>I'd say: don't worry about the Rings thing for now unless you critically need it. It will be a one line to add once #10963 is in. Just handle the additive and multiplicative side separately.

I'll have a look at this later today.



---

archive/issue_comments_222100.json:
```json
{
    "body": "<a id='comment:11'></a>> Your `_element_constructor_` is buggy\n\n\nHey man, if it comes to that I think that the design in which the elements of a Parent are not Element is the buggy thing.\n\nNathann",
    "created_at": "2014-04-30T09:02:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16269#issuecomment-222100",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:11'></a>> Your `_element_constructor_` is buggy


Hey man, if it comes to that I think that the design in which the elements of a Parent are not Element is the buggy thing.

Nathann



---

archive/issue_comments_222101.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-04-30T09:07:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16269#issuecomment-222101",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_222102.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:6 ncohen]:\n> Yo !\n> \n> > Hmm, do you mean to construct the Cartesian product of fields? Then it will be a ring, with two operations, addition and multiplication...\n\n> \n> Hmmmm.. Well, I guess it may not be very hard to do. \n> \n> 1) A ring is a additive group (so the + is already implemented) for the product of rings\n\n\nYou can make any abelian group into a ring by defining multiplication by a non-zero element a to be identity operation, i.e. ax=x for all x in the group, and by 0 to be zero, i.e. 0x=0 for all x in the group.\nThis should be easy to implement - no real code, just some abstract nonsense :-)\n\nThat is, as soon as you have cartesian product of rings, you have what you need in general...\n\n> \n> 2) It has a multiplicative operation, but perhaps the product of multiplicative associative magma is not detected as such. \n\nbut why?\nIs it because #10963 will take forever to merge, as it has apparently hit some kind of OSS unsolvability barrier? :)\n \n\n> If you can just give Sage the right inheritances, perhaps you have no real code to implement.\n\nIf I were a category theorist and a (C)Python guru by training, perhaps it will only take me 5 minutes ;-)",
    "created_at": "2014-04-30T13:42:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16269#issuecomment-222102",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:13'></a>Replying to [comment:6 ncohen]:
> Yo !
> 
> > Hmm, do you mean to construct the Cartesian product of fields? Then it will be a ring, with two operations, addition and multiplication...

> 
> Hmmmm.. Well, I guess it may not be very hard to do. 
> 
> 1) A ring is a additive group (so the + is already implemented) for the product of rings


You can make any abelian group into a ring by defining multiplication by a non-zero element a to be identity operation, i.e. ax=x for all x in the group, and by 0 to be zero, i.e. 0x=0 for all x in the group.
This should be easy to implement - no real code, just some abstract nonsense :-)

That is, as soon as you have cartesian product of rings, you have what you need in general...

> 
> 2) It has a multiplicative operation, but perhaps the product of multiplicative associative magma is not detected as such. 

but why?
Is it because #10963 will take forever to merge, as it has apparently hit some kind of OSS unsolvability barrier? :)
 

> If you can just give Sage the right inheritances, perhaps you have no real code to implement.

If I were a category theorist and a (C)Python guru by training, perhaps it will only take me 5 minutes ;-)



---

archive/issue_comments_222103.json:
```json
{
    "body": "<a id='comment:14'></a>Yo !\n\n> Is it because #10963 will take forever to merge, as it has apparently hit some kind of OSS unsolvability barrier? :)\n\n\nI have no idea what #10963 contains, nor do I care to be honest. And about implementing rings, I would personally chose to behave as if #10963 were to never be merged, because you just can't count on stuff like this to happen `:-P`\n\n> If I were a category theorist and a (C)Python guru by training, perhaps it will only take me 5 minutes ;-)\n\n\nWhich is why I lived very hard the last 2 days, during which I tried to implement a ten-lines patch that would have taken any of the so-called \"category theorist and a (C)Python guru by training\" those 5 minutes. Besides, I don't consider the product of additive group to be such a weird notion that it could be left unimplemented for years `:-P`\n\nBut well. Now it is done in this patch. Stuff happens.\n\nNathann",
    "created_at": "2014-04-30T14:00:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16269#issuecomment-222103",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:14'></a>Yo !

> Is it because #10963 will take forever to merge, as it has apparently hit some kind of OSS unsolvability barrier? :)


I have no idea what #10963 contains, nor do I care to be honest. And about implementing rings, I would personally chose to behave as if #10963 were to never be merged, because you just can't count on stuff like this to happen `:-P`

> If I were a category theorist and a (C)Python guru by training, perhaps it will only take me 5 minutes ;-)


Which is why I lived very hard the last 2 days, during which I tried to implement a ten-lines patch that would have taken any of the so-called "category theorist and a (C)Python guru by training" those 5 minutes. Besides, I don't consider the product of additive group to be such a weird notion that it could be left unimplemented for years `:-P`

But well. Now it is done in this patch. Stuff happens.

Nathann



---

archive/issue_comments_222104.json:
```json
{
    "body": "<a id='comment:15'></a>Replying to [comment:13 dimpase]:\n> Is it because #10963 will take forever to merge, as it has apparently hit some kind of OSS unsolvability barrier? :)\n\n\nThe review process has restarted :-)",
    "created_at": "2014-04-30T16:50:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16269#issuecomment-222104",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:15'></a>Replying to [comment:13 dimpase]:
> Is it because #10963 will take forever to merge, as it has apparently hit some kind of OSS unsolvability barrier? :)


The review process has restarted :-)



---

archive/issue_comments_222105.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-04-30T18:08:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16269#issuecomment-222105",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_222106.json:
```json
{
    "body": "<a id='comment:17'></a>Hi!\n\nI have just been through the changes. Overall, it looks good, thanks!\n\nRemaining points:\n- CartesianProduct.__iter__ should be in EnumeratedSets.CartesianProducts.ParentMethods\n- In ``_add_``, ``self.parent(right)`` looks suspicious. Does it even work?\n  If the purpose is to convert ``right`` into the same parent as\n  ``self``, then no need to worry about this: ``_add_`` may assume\n  that its two arguments belong to the same parent.\n- I am uncomfortable with using ``__iter__`` and ``__getitem__`` for\n  accessing the components of an element. For certain cartesian\n  products (e.g. cartesian products of modules), ``__iter__`` may have\n  a different meaning. Please use ``summand_split`` and\n  ``summand_projection`` instead.\n- In ``_element_constructor_``: given the catch, if we feed completely\n  unrelated crap to the constructor, is there an exception raised as\n  one could desire?\n\n```\n    sage: GF(3)(\"a\")\n    Traceback (most recent call last)\n    ...\n    TypeError: unable to convert x (=a) to an integer\n\n    sage: C = cartesian_product([GF(3), GF(3)])\n    sage: C([\"a\",\"b\"])\n    ???\n```\n\n\nPlease add this doctest. Btw, one might also want to raise a meaningful error if the length of `x` is incorrect.\n\nCheers,\n                                        Nicolas",
    "created_at": "2014-05-02T17:07:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16269#issuecomment-222106",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:17'></a>Hi!

I have just been through the changes. Overall, it looks good, thanks!

Remaining points:
- CartesianProduct.__iter__ should be in EnumeratedSets.CartesianProducts.ParentMethods
- In ``_add_``, ``self.parent(right)`` looks suspicious. Does it even work?
  If the purpose is to convert ``right`` into the same parent as
  ``self``, then no need to worry about this: ``_add_`` may assume
  that its two arguments belong to the same parent.
- I am uncomfortable with using ``__iter__`` and ``__getitem__`` for
  accessing the components of an element. For certain cartesian
  products (e.g. cartesian products of modules), ``__iter__`` may have
  a different meaning. Please use ``summand_split`` and
  ``summand_projection`` instead.
- In ``_element_constructor_``: given the catch, if we feed completely
  unrelated crap to the constructor, is there an exception raised as
  one could desire?

```
    sage: GF(3)("a")
    Traceback (most recent call last)
    ...
    TypeError: unable to convert x (=a) to an integer

    sage: C = cartesian_product([GF(3), GF(3)])
    sage: C(["a","b"])
    ???
```


Please add this doctest. Btw, one might also want to raise a meaningful error if the length of `x` is incorrect.

Cheers,
                                        Nicolas



---

archive/issue_comments_222107.json:
```json
{
    "body": "<a id='comment:18'></a>Yo !\n\n> - CartesianProduct.__iter__ should be in EnumeratedSets.CartesianProducts.ParentMethods\n\n\nDone\n\n> - In ``_add_``, ``self.parent(right)`` looks suspicious. Does it even work?\n>   If the purpose is to convert ``right`` into the same parent as\n>   ``self``, then no need to worry about this: ``_add_`` may assume\n>   that its two arguments belong to the same parent.\n\n\nThat was the reason. Done.\n\n> - I am uncomfortable with using ``__iter__`` and ``__getitem__`` for\n>   accessing the components of an element. For certain cartesian\n>   products (e.g. cartesian products of modules), ``__iter__`` may have\n>   a different meaning. Please use ``summand_split`` and\n>   ``summand_projection`` instead.\n\n\nHere I do not agree. This is the most natural definition of an \"iter\" for a cartesian product. Your application will overrule this anyway, so how can that be a problem ?\n\n> - In ``_element_constructor_``: given the catch, if we feed completely\n>   unrelated crap to the constructor, is there an exception raised as\n>   one could desire?\n> \n> ```\n>     sage: GF(3)(\"a\")\n>     Traceback (most recent call last)\n>     ...\n>     TypeError: unable to convert x (=a) to an integer\n> \n>     sage: C = cartesian_product([GF(3), GF(3)])\n>     sage: C([\"a\",\"b\"])\n>     ???\n> ```\n\n\nOkay, so here I am stuck and I can't sort this out. Here is the problem :\n\n```\nsage: FiniteEnumeratedSet([\"a\",\"b\",\"c\"])(\"a\")\nTypeError: Cannot convert str to sage.structure.element.Element\nsage: FiniteEnumeratedSet([\"a\",\"b\",\"c\"])(\"d\")\nValueError: d not in {'a', 'b', 'c'}\n```\n\nBecause you cannot trust `FiniteEnumeratedSet` to have a sound `__call__` method, I need this try/catch.\n\nOn the other hand, if I have this try/catch, then I cannot detect `GF(3)(\"e\")` anymore. So what do we do ?\n\nI personally see no problem in removing this catch, knowing that cartesian products of `FiniteEnumeratedSet` will fail. For me it is because of a bug in `FiniteEnumeratedSet`, not of what I implement.\n\nNathann",
    "created_at": "2014-05-02T18:15:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16269#issuecomment-222107",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:18'></a>Yo !

> - CartesianProduct.__iter__ should be in EnumeratedSets.CartesianProducts.ParentMethods


Done

> - In ``_add_``, ``self.parent(right)`` looks suspicious. Does it even work?
>   If the purpose is to convert ``right`` into the same parent as
>   ``self``, then no need to worry about this: ``_add_`` may assume
>   that its two arguments belong to the same parent.


That was the reason. Done.

> - I am uncomfortable with using ``__iter__`` and ``__getitem__`` for
>   accessing the components of an element. For certain cartesian
>   products (e.g. cartesian products of modules), ``__iter__`` may have
>   a different meaning. Please use ``summand_split`` and
>   ``summand_projection`` instead.


Here I do not agree. This is the most natural definition of an "iter" for a cartesian product. Your application will overrule this anyway, so how can that be a problem ?

> - In ``_element_constructor_``: given the catch, if we feed completely
>   unrelated crap to the constructor, is there an exception raised as
>   one could desire?
> 
> ```
>     sage: GF(3)("a")
>     Traceback (most recent call last)
>     ...
>     TypeError: unable to convert x (=a) to an integer
> 
>     sage: C = cartesian_product([GF(3), GF(3)])
>     sage: C(["a","b"])
>     ???
> ```


Okay, so here I am stuck and I can't sort this out. Here is the problem :

```
sage: FiniteEnumeratedSet(["a","b","c"])("a")
TypeError: Cannot convert str to sage.structure.element.Element
sage: FiniteEnumeratedSet(["a","b","c"])("d")
ValueError: d not in {'a', 'b', 'c'}
```

Because you cannot trust `FiniteEnumeratedSet` to have a sound `__call__` method, I need this try/catch.

On the other hand, if I have this try/catch, then I cannot detect `GF(3)("e")` anymore. So what do we do ?

I personally see no problem in removing this catch, knowing that cartesian products of `FiniteEnumeratedSet` will fail. For me it is because of a bug in `FiniteEnumeratedSet`, not of what I implement.

Nathann



---

archive/issue_comments_222108.json:
```json
{
    "body": "<a id='comment:19'></a>Replying to [comment:18 ncohen]:\n> Here I do not agree. This is the most natural definition of an \"iter\" for a cartesian product. Your application will overrule this anyway, so how can that be a problem ?\n\n\nAh shoot, in the mean time I answered your private e-mail about this\n:-) Shall I copy paste my answer here?\n\n> I personally see no problem in removing this catch, knowing that cartesian products of `FiniteEnumeratedSet` will fail. For me it is because of a bug in `FiniteEnumeratedSet`, not of what I implement.\n\n\nI agree.\n\nIf this special situation is not used too much elsewhere (i.e. if all\ntest pass), then I'd say let's go. And if not, I guess we will need to\nfix/workaround the problem in FiniteEnumeratedSet.\n\nCheers,\n                          Nicolas",
    "created_at": "2014-05-02T18:30:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16269#issuecomment-222108",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:19'></a>Replying to [comment:18 ncohen]:
> Here I do not agree. This is the most natural definition of an "iter" for a cartesian product. Your application will overrule this anyway, so how can that be a problem ?


Ah shoot, in the mean time I answered your private e-mail about this
:-) Shall I copy paste my answer here?

> I personally see no problem in removing this catch, knowing that cartesian products of `FiniteEnumeratedSet` will fail. For me it is because of a bug in `FiniteEnumeratedSet`, not of what I implement.


I agree.

If this special situation is not used too much elsewhere (i.e. if all
test pass), then I'd say let's go. And if not, I guess we will need to
fix/workaround the problem in FiniteEnumeratedSet.

Cheers,
                          Nicolas



---

archive/issue_comments_222109.json:
```json
{
    "body": "<a id='comment:20'></a>Yo !\n\n> Ah shoot, in the mean time I answered your private e-mail about this\n> :-) Shall I copy paste my answer here?\n\n\nFor others: the answer was that I should just use the `.summand_projection` commands in the code and not iter on the elements for it could have a different meaning elsewhere.\n\nI asked you how to guess the length of the vector though... Which I will need to call the projection commands.\n\n> I agree.\n> \n> If this special situation is not used too much elsewhere (i.e. if all\n> test pass), then I'd say let's go. And if not, I guess we will need to\n> fix/workaround the problem in FiniteEnumeratedSet.\n\n\nWell, not all tests pass actually, I just noticed. The first examples in the doc of categories/cartesian_product  use enumerated sets `>_<`\n\nNathann",
    "created_at": "2014-05-02T18:34:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16269#issuecomment-222109",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:20'></a>Yo !

> Ah shoot, in the mean time I answered your private e-mail about this
> :-) Shall I copy paste my answer here?


For others: the answer was that I should just use the `.summand_projection` commands in the code and not iter on the elements for it could have a different meaning elsewhere.

I asked you how to guess the length of the vector though... Which I will need to call the projection commands.

> I agree.
> 
> If this special situation is not used too much elsewhere (i.e. if all
> test pass), then I'd say let's go. And if not, I guess we will need to
> fix/workaround the problem in FiniteEnumeratedSet.


Well, not all tests pass actually, I just noticed. The first examples in the doc of categories/cartesian_product  use enumerated sets `>_<`

Nathann



---

archive/issue_comments_222110.json:
```json
{
    "body": "<a id='comment:21'></a>Replying to [comment:20 ncohen]:\n> Well, not all tests pass actually, I just noticed. The first examples in the doc of categories/cartesian_product  use enumerated sets `>_<`\n\n\nNo luck. I can have a shot at fixing/working around the problem in\nFiniteEnumeratedSets later tonight if you want.",
    "created_at": "2014-05-02T18:40:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16269#issuecomment-222110",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:21'></a>Replying to [comment:20 ncohen]:
> Well, not all tests pass actually, I just noticed. The first examples in the doc of categories/cartesian_product  use enumerated sets `>_<`


No luck. I can have a shot at fixing/working around the problem in
FiniteEnumeratedSets later tonight if you want.



---

archive/issue_comments_222111.json:
```json
{
    "body": "<a id='comment:22'></a>Yo !\n\n> No luck. I can have a shot at fixing/working around the problem in\n> FiniteEnumeratedSets later tonight if you want.\n\n\nWow. Thanks.\n\nAhem. I don't know what happened to the old Nicolas, but I like this version of yourself `:-P`\n\nThanks for your help. I am testing that only the bug produced by the `FiniteEnumeratedSet` remains in my branch, and all your other remarks should be implemented. I also added an exception (and a test) for the case where the element given to `_element_constructor_` has the wrong length.\n\nNathann\n\nP.S. : Okay, the tests are done. It passes all tests in category/ and sets/ except for the category/cartesian_product.py file. The problem is the `.an_element()` call at the top of the file.\n\nIf it comes to that, we could even overwrite `FiniteEnumeratedSet.CartesianProduct.ParentMethod._element_constructor_`. Gosh. I almost speak the category slang, now. I am scared.",
    "created_at": "2014-05-02T18:53:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16269#issuecomment-222111",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:22'></a>Yo !

> No luck. I can have a shot at fixing/working around the problem in
> FiniteEnumeratedSets later tonight if you want.


Wow. Thanks.

Ahem. I don't know what happened to the old Nicolas, but I like this version of yourself `:-P`

Thanks for your help. I am testing that only the bug produced by the `FiniteEnumeratedSet` remains in my branch, and all your other remarks should be implemented. I also added an exception (and a test) for the case where the element given to `_element_constructor_` has the wrong length.

Nathann

P.S. : Okay, the tests are done. It passes all tests in category/ and sets/ except for the category/cartesian_product.py file. The problem is the `.an_element()` call at the top of the file.

If it comes to that, we could even overwrite `FiniteEnumeratedSet.CartesianProduct.ParentMethod._element_constructor_`. Gosh. I almost speak the category slang, now. I am scared.



---

archive/issue_comments_222112.json:
```json
{
    "body": "<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-02T18:53:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16269#issuecomment-222112",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_222113.json:
```json
{
    "body": "<a id='comment:24'></a>I uploaded a potential fix to the `FiniteEnumeratedSet` problem on #16280, which I added here as light dependency.",
    "created_at": "2014-05-02T23:09:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16269#issuecomment-222113",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:24'></a>I uploaded a potential fix to the `FiniteEnumeratedSet` problem on #16280, which I added here as light dependency.



---

archive/issue_comments_222114.json:
```json
{
    "body": "<a id='comment:25'></a>Replying to [comment:22 ncohen]:\n> Ahem. I don't know what happened to the old Nicolas, but I like this version of yourself `:-P`\n\n\n:-)\n\nWell, currently no teaching, no big ongoing administrative task, and\nbefore #10963 is in, I am stuck for long term dev. But don't worry,\nit's the same me: in the mean time others are cursing me (loud or\nquietly) for not working on other stuff ... Sight, that's never ending ...\n\n> Thanks for your help. I am testing that only the bug produced by the `FiniteEnumeratedSet` remains in my branch, and all your other remarks should be implemented. I also added an exception (and a test) for the case where the element given to `_element_constructor_` has the wrong length.\n\n\nSounds good. I'll check that tomorrow.\n\n> Gosh. I almost speak the category slang, now. I am scared.\n\n\n:-)\n\nGood night!\n                             Nicolas",
    "created_at": "2014-05-02T23:17:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16269#issuecomment-222114",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:25'></a>Replying to [comment:22 ncohen]:
> Ahem. I don't know what happened to the old Nicolas, but I like this version of yourself `:-P`


:-)

Well, currently no teaching, no big ongoing administrative task, and
before #10963 is in, I am stuck for long term dev. But don't worry,
it's the same me: in the mean time others are cursing me (loud or
quietly) for not working on other stuff ... Sight, that's never ending ...

> Thanks for your help. I am testing that only the bug produced by the `FiniteEnumeratedSet` remains in my branch, and all your other remarks should be implemented. I also added an exception (and a test) for the case where the element given to `_element_constructor_` has the wrong length.


Sounds good. I'll check that tomorrow.

> Gosh. I almost speak the category slang, now. I am scared.


:-)

Good night!
                             Nicolas



---

archive/issue_comments_222115.json:
```json
{
    "body": "<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-03T13:10:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16269#issuecomment-222115",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_222116.json:
```json
{
    "body": "<a id='comment:27'></a>Here it is ! `;-)`\n\nNathann",
    "created_at": "2014-05-03T13:10:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16269#issuecomment-222116",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:27'></a>Here it is ! `;-)`

Nathann



---

archive/issue_comments_222117.json:
```json
{
    "body": "<a id='comment:28'></a>Okay, the problem being solved can I set this to `positive_review` ? It is the last unreviewed dependency of #16277.\n\nNathann",
    "created_at": "2014-05-03T18:21:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16269#issuecomment-222117",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:28'></a>Okay, the problem being solved can I set this to `positive_review` ? It is the last unreviewed dependency of #16277.

Nathann



---

archive/issue_comments_222118.json:
```json
{
    "body": "<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-04T07:46:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16269#issuecomment-222118",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_222119.json:
```json
{
    "body": "<a id='comment:31'></a>If my latest changes are fine with you, this is definitely a positive review on my side.\n\nRunning all long doctests now just to make sure.\n\n---\nNew commits:",
    "created_at": "2014-05-04T07:47:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16269#issuecomment-222119",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:31'></a>If my latest changes are fine with you, this is definitely a positive review on my side.

Running all long doctests now just to make sure.

---
New commits:



---

archive/issue_comments_222120.json:
```json
{
    "body": "<a id='comment:32'></a>Well, the exception is nicer and I think you told me that __iter__ belonged to this class (sorry I moved a lot of stuff around, I probably lost track) but I would like to know why you replaced this `self()` with `_cartesian_product_of_elements`.\n\nNathann",
    "created_at": "2014-05-04T07:50:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16269#issuecomment-222120",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:32'></a>Well, the exception is nicer and I think you told me that __iter__ belonged to this class (sorry I moved a lot of stuff around, I probably lost track) but I would like to know why you replaced this `self()` with `_cartesian_product_of_elements`.

Nathann



---

archive/issue_comments_222121.json:
```json
{
    "body": "<a id='comment:33'></a>This bypasses the constructor checks while being independent of the internal representation.\n\nOh, no, it does not bypass the constructor in the basic implementation! `_cartesian_product_of_element` should definitely call element_class directly.\n\nOk, I can't do it right now. But this can wait for a later ticket too.",
    "created_at": "2014-05-04T08:16:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16269#issuecomment-222121",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:33'></a>This bypasses the constructor checks while being independent of the internal representation.

Oh, no, it does not bypass the constructor in the basic implementation! `_cartesian_product_of_element` should definitely call element_class directly.

Ok, I can't do it right now. But this can wait for a later ticket too.



---

archive/issue_comments_222122.json:
```json
{
    "body": "<a id='comment:34'></a>All long tests pass btw",
    "created_at": "2014-05-04T08:17:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16269#issuecomment-222122",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:34'></a>All long tests pass btw



---

archive/issue_comments_222123.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-05-04T09:09:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16269#issuecomment-222123",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_222124.json:
```json
{
    "body": "<a id='comment:35'></a>Okayokayokay, thennnnnnnnn ... `:-)`\n\nNathann",
    "created_at": "2014-05-04T09:09:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16269#issuecomment-222124",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:35'></a>Okayokayokay, thennnnnnnnn ... `:-)`

Nathann



---

archive/issue_comments_222125.json:
```json
{
    "body": "<a id='comment:37'></a>New commits:",
    "created_at": "2014-05-04T20:25:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16269#issuecomment-222125",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:37'></a>New commits:



---

archive/issue_comments_222126.json:
```json
{
    "body": "<a id='comment:39'></a>Hi,\n\nI fixed `_cartesian_product_of_elements` to bypass `_element_constructor` and other checks, and documented it. Here is the timing difference:\n\n```\nsage: S1 = Sets().example()\nsage: S2 = InfiniteEnumeratedSets().example()\nsage: C = cartesian_product([S2, S1, S2])\nsage: l = tuple([S2.an_element(), S1.an_element(), S2.an_element()])\n```\nWithout the optimization:\n\n```\nsage: %timeit C._cartesian_product_of_elements(l)\n10000 loops, best of 3: 22 \u00b5s per loop\n```\nWith the optimization:\n\n```\nsage: %timeit C._cartesian_product_of_elements(lt)\n1000000 loops, best of 3: 922 ns per loop\n```\n\nIf you are fine including this in this ticket, please change the branch to `u/nthiery/16269-optimized`. Otherwise, I'll move this commit to a follow up ticket.\n\nFor the record: the tests pass on the cartesian_product.py file. Running all long tests now to be sure.\n\nCheers,\n                                   Nicolas",
    "created_at": "2014-05-04T20:30:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16269#issuecomment-222126",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:39'></a>Hi,

I fixed `_cartesian_product_of_elements` to bypass `_element_constructor` and other checks, and documented it. Here is the timing difference:

```
sage: S1 = Sets().example()
sage: S2 = InfiniteEnumeratedSets().example()
sage: C = cartesian_product([S2, S1, S2])
sage: l = tuple([S2.an_element(), S1.an_element(), S2.an_element()])
```
Without the optimization:

```
sage: %timeit C._cartesian_product_of_elements(l)
10000 loops, best of 3: 22 µs per loop
```
With the optimization:

```
sage: %timeit C._cartesian_product_of_elements(lt)
1000000 loops, best of 3: 922 ns per loop
```

If you are fine including this in this ticket, please change the branch to `u/nthiery/16269-optimized`. Otherwise, I'll move this commit to a follow up ticket.

For the record: the tests pass on the cartesian_product.py file. Running all long tests now to be sure.

Cheers,
                                   Nicolas



---

archive/issue_comments_222127.json:
```json
{
    "body": "<a id='comment:40'></a>The optimization is now #16288, as this was more practical for Nathann.\nHence this ticket is ready to be merged as is.",
    "created_at": "2014-05-04T21:22:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16269#issuecomment-222127",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:40'></a>The optimization is now #16288, as this was more practical for Nathann.
Hence this ticket is ready to be merged as is.



---

archive/issue_events_047972.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16269",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16269#event-47972"
}
```



---

archive/issue_events_047973.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-05-06T18:03:39Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16269",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16269#event-47973"
}
```



---

archive/issue_comments_222128.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-05-06T18:03:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16269#issuecomment-222128",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
