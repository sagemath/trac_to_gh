# Issue 16503: q-x construction of Orthogonal Arrays

archive/issues_016266.json:
```json
{
    "body": "Another construction of orthogonal arrays. New OA for `n=158, 329, 334, 355, 517, 574, 745, 979, 1926`.\n\nThanks to Julian R. Abel's pointers, as usual `:-)`\n\nNathann\n\nCC:  @videlec\n\nBranch/Commit: 8da2c73aeb5a5ca2e1561131fb3218b3c451b33c\n\nReviewer: Vincent Delecroix\n\nAuthor: Nathann Cohen\n\nDependencies: #16500\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/16503\n\n",
    "closed_at": "2014-06-29T00:32:55Z",
    "created_at": "2014-06-20T10:32:21Z",
    "labels": [
        "component: combinatorial designs"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.3",
    "title": "q-x construction of Orthogonal Arrays",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16503",
    "user": "https://github.com/nathanncohen"
}
```
Another construction of orthogonal arrays. New OA for `n=158, 329, 334, 355, 517, 574, 745, 979, 1926`.

Thanks to Julian R. Abel's pointers, as usual `:-)`

Nathann

CC:  @videlec

Branch/Commit: 8da2c73aeb5a5ca2e1561131fb3218b3c451b33c

Reviewer: Vincent Delecroix

Author: Nathann Cohen

Dependencies: #16500

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/16503





---

archive/issue_comments_226601.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-06-20T10:36:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16503#issuecomment-226601",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_226602.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-06-20T10:39:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16503#issuecomment-226602",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_226603.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2014-06-25T15:12:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16503#issuecomment-226603",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_226604.json:
```json
{
    "body": "<a id='comment:4'></a>Updated on top of #16500 !\n\nNathann",
    "created_at": "2014-06-26T10:47:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16503#issuecomment-226604",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:4'></a>Updated on top of #16500 !

Nathann



---

archive/issue_comments_226605.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-06-26T10:48:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16503#issuecomment-226605",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_226606.json:
```json
{
    "body": "<a id='comment:6'></a>Hi Nathann,\n\n1) One lines 656-659 you have an import followed by a commented check!!\n\n```\nfrom sage.combinat.designs.bibd import _check_pbd\nPBD = [[relabel[xx] for xx in B if not xx in points_to_delete] for B in TD]\n\n# _check_pbd(PBD,n,[q,q-x-1,q-x+1,x+2])\n```\nwhy is that?\n\n2) This is wrong (lines 730-731)\n\n```\n# The next is always True, because q is a prime power\n# orthogonal_array(k+1,q,existence=True) and\n```\nif k+1 > q... instead we can start the loop at k+1 instead of 3.\n\n3) I bounced into something bad: I wanted to change in `find_recursive_construction` the\n\n```\nassert k >= 3\n```\ninto a\n\n```\nassert k > 3, \"you do not need recursion for k<4\"\n```\nsince it is trivial to build one latin square. But it appears that the recursive constructions is called with k=3 many times! so bad! This has to be corrected... but hopefully, not here. I guess that #16535 would be the good place.\n\nVincent",
    "created_at": "2014-06-27T12:02:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16503#issuecomment-226606",
    "user": "https://github.com/videlec"
}
```

<a id='comment:6'></a>Hi Nathann,

1) One lines 656-659 you have an import followed by a commented check!!

```
from sage.combinat.designs.bibd import _check_pbd
PBD = [[relabel[xx] for xx in B if not xx in points_to_delete] for B in TD]

# _check_pbd(PBD,n,[q,q-x-1,q-x+1,x+2])
```
why is that?

2) This is wrong (lines 730-731)

```
# The next is always True, because q is a prime power
# orthogonal_array(k+1,q,existence=True) and
```
if k+1 > q... instead we can start the loop at k+1 instead of 3.

3) I bounced into something bad: I wanted to change in `find_recursive_construction` the

```
assert k >= 3
```
into a

```
assert k > 3, "you do not need recursion for k<4"
```
since it is trivial to build one latin square. But it appears that the recursive constructions is called with k=3 many times! so bad! This has to be corrected... but hopefully, not here. I guess that #16535 would be the good place.

Vincent



---

archive/issue_comments_226607.json:
```json
{
    "body": "<a id='comment:7'></a>Hello !\n\n> 1) One lines 656-659 you have an import followed by a commented check!!\n> \n> ```\n> from sage.combinat.designs.bibd import _check_pbd\n> PBD = [[relabel[xx] for xx in B if not xx in points_to_delete] for B in TD]\n> \n> # _check_pbd(PBD,n,[q,q-x-1,q-x+1,x+2])\n> ```\n> why is that?\n\n\nIt is something I used while implementing the construction and as it said something about the PBD I left it. I updated that comment as that troubled you.\n\n> 2) This is wrong (lines 730-731)\n> \n> ```\n> # The next is always True, because q is a prime power\n> # orthogonal_array(k+1,q,existence=True) and\n> ```\n\n\nThe line before that one is \n\n```\n            orthogonal_array(k+1,q-x+1,existence=True) and\n```\n\n> 3) I bounced into something bad: I wanted to change in `find_recursive_construction` the\n> \n> ```\n> assert k >= 3\n> ```\n> into a\n> \n> ```\n> assert k > 3, \"you do not need recursion for k<4\"\n> ```\n> since it is trivial to build one latin square. But it appears that the recursive constructions is called with k=3 many times! so bad! This has to be corrected... but hopefully, not here. I guess that #16535 would be the good place.\n\n\nWhy in #16535 ? What we need to do is add a case for k=3 in the `orthogonal_array` constructor.\n\nI fixed the things above, plus an apparently incorrect `1<x`.\n\nNathann",
    "created_at": "2014-06-27T12:43:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16503#issuecomment-226607",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:7'></a>Hello !

> 1) One lines 656-659 you have an import followed by a commented check!!
> 
> ```
> from sage.combinat.designs.bibd import _check_pbd
> PBD = [[relabel[xx] for xx in B if not xx in points_to_delete] for B in TD]
> 
> # _check_pbd(PBD,n,[q,q-x-1,q-x+1,x+2])
> ```
> why is that?


It is something I used while implementing the construction and as it said something about the PBD I left it. I updated that comment as that troubled you.

> 2) This is wrong (lines 730-731)
> 
> ```
> # The next is always True, because q is a prime power
> # orthogonal_array(k+1,q,existence=True) and
> ```


The line before that one is 

```
            orthogonal_array(k+1,q-x+1,existence=True) and
```

> 3) I bounced into something bad: I wanted to change in `find_recursive_construction` the
> 
> ```
> assert k >= 3
> ```
> into a
> 
> ```
> assert k > 3, "you do not need recursion for k<4"
> ```
> since it is trivial to build one latin square. But it appears that the recursive constructions is called with k=3 many times! so bad! This has to be corrected... but hopefully, not here. I guess that #16535 would be the good place.


Why in #16535 ? What we need to do is add a case for k=3 in the `orthogonal_array` constructor.

I fixed the things above, plus an apparently incorrect `1<x`.

Nathann



---

archive/issue_comments_226608.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-06-27T12:44:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16503#issuecomment-226608",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_226609.json:
```json
{
    "body": "<a id='comment:9'></a>Hi Nathann,\n\nYou can actually cut the loop if `x >= q` as `x` is increasing along the loop. It is done at `public/16503` (it does not matter too much right now, but it will if you want to compute a big MOLS table).\n\nBeyond that, you can set to positive review.\n\nVincent",
    "created_at": "2014-06-27T17:51:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16503#issuecomment-226609",
    "user": "https://github.com/videlec"
}
```

<a id='comment:9'></a>Hi Nathann,

You can actually cut the loop if `x >= q` as `x` is increasing along the loop. It is done at `public/16503` (it does not matter too much right now, but it will if you want to compute a big MOLS table).

Beyond that, you can set to positive review.

Vincent



---

archive/issue_comments_226610.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2014-06-27T17:51:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16503#issuecomment-226610",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_226611.json:
```json
{
    "body": "<a id='comment:11'></a>HMmmmm... I don't like much to differentiate over integer divisions.. Do you mind if we keep it like that ?\n\nNathann",
    "created_at": "2014-06-27T18:06:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16503#issuecomment-226611",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:11'></a>HMmmmm... I don't like much to differentiate over integer divisions.. Do you mind if we keep it like that ?

Nathann



---

archive/issue_comments_226612.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:11 ncohen]:\n> HMmmmm... I don't like much to differentiate over integer divisions.. Do you mind if we keep it like that ?\n\n\nMe neither, but the floor function is increasing... so it is fine (as the composition of increasing functions is increasing)! But we can keep it as it is, since we cut very little with that: `(q^2-n)/(q-2) ~ q + cte` for large `q`.\n\nVincent",
    "created_at": "2014-06-27T18:13:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16503#issuecomment-226612",
    "user": "https://github.com/videlec"
}
```

<a id='comment:12'></a>Replying to [comment:11 ncohen]:
> HMmmmm... I don't like much to differentiate over integer divisions.. Do you mind if we keep it like that ?


Me neither, but the floor function is increasing... so it is fine (as the composition of increasing functions is increasing)! But we can keep it as it is, since we cut very little with that: `(q^2-n)/(q-2) ~ q + cte` for large `q`.

Vincent



---

archive/issue_comments_226613.json:
```json
{
    "body": "Changing status from needs_info to positive_review.",
    "created_at": "2014-06-27T18:13:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16503#issuecomment-226613",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_info to positive_review.



---

archive/issue_comments_226614.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2014-06-28T08:15:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16503#issuecomment-226614",
    "user": "https://github.com/videlec"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_226615.json:
```json
{
    "body": "<a id='comment:13'></a>As reported in #16524 there is a problem building the doc. Solution (line 622)\n\n```\n-    REFERENCES::\n+    REFERENCES:\n```",
    "created_at": "2014-06-28T08:15:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16503#issuecomment-226615",
    "user": "https://github.com/videlec"
}
```

<a id='comment:13'></a>As reported in #16524 there is a problem building the doc. Solution (line 622)

```
-    REFERENCES::
+    REFERENCES:
```



---

archive/issue_comments_226616.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-06-28T08:17:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16503#issuecomment-226616",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_226617.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-06-28T08:17:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16503#issuecomment-226617",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_226618.json:
```json
{
    "body": "<a id='comment:16'></a>... building the doc...",
    "created_at": "2014-06-28T08:22:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16503#issuecomment-226618",
    "user": "https://github.com/videlec"
}
```

<a id='comment:16'></a>... building the doc...



---

archive/issue_comments_226619.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-06-28T08:26:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16503#issuecomment-226619",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_048488.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-06-29T00:32:55Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16503",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16503#event-48488"
}
```



---

archive/issue_comments_226620.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-06-29T00:32:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16503#issuecomment-226620",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
