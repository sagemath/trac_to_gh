# Issue 16823: Implement the free Lie algebra

archive/issues_016586.json:
```json
{
    "body": "Part of #14901. Implements the free Lie algebra in two different bases.\n\nAssignee: @tscrim\n\nCC:  sd67 @bsalisbury1\n\nKeywords: lie algebras\n\nBranch/Commit: e27b98b282a0c86945fc155519169b77fa0b2d41\n\nReviewer: Darij Grinberg\n\nAuthor: Travis Scrimshaw\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/16823\n\n",
    "closed_at": "2018-05-09T09:50:01Z",
    "created_at": "2014-08-14T10:53:56Z",
    "labels": [
        "component: algebra"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.3",
    "title": "Implement the free Lie algebra",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16823",
    "user": "https://github.com/tscrim"
}
```
Part of #14901. Implements the free Lie algebra in two different bases.

Assignee: @tscrim

CC:  sd67 @bsalisbury1

Keywords: lie algebras

Branch/Commit: e27b98b282a0c86945fc155519169b77fa0b2d41

Reviewer: Darij Grinberg

Author: Travis Scrimshaw

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/16823





---

archive/issue_comments_232780.json:
```json
{
    "body": "<a id='comment:1'></a>Last 10 new commits:",
    "created_at": "2015-04-14T15:18:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232780",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:1'></a>Last 10 new commits:



---

archive/issue_comments_232781.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-04-14T15:18:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232781",
    "user": "https://github.com/tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_232782.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-11T19:18:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232782",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_049250.json:
```json
{
    "actor": "https://github.com/kevindilks",
    "created_at": "2015-10-11T19:21:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "milestone": "sage-6.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16823#event-49250"
}
```



---

archive/issue_comments_232783.json:
```json
{
    "body": "<a id='comment:3'></a>New commits:",
    "created_at": "2015-10-11T19:21:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232783",
    "user": "https://github.com/kevindilks"
}
```

<a id='comment:3'></a>New commits:



---

archive/issue_comments_232784.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2016-06-02T13:35:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232784",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_232785.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2017-04-01T23:36:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232785",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_events_049251.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-04-01T23:37:34Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "milestone": "sage-6.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16823#event-49251"
}
```



---

archive/issue_events_049252.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-04-01T23:37:34Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "milestone": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16823#event-49252"
}
```



---

archive/issue_comments_232786.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-04-13T21:41:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232786",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_232787.json:
```json
{
    "body": "<a id='comment:8'></a>Travis: What Hall basis is this? Are you following a specific source? There are many different Hall bases, and the simplest one (I believe using the lexicographic order) is just the Lyndon basis IIRC; hence the question.",
    "created_at": "2017-04-13T23:13:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232787",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:8'></a>Travis: What Hall basis is this? Are you following a specific source? There are many different Hall bases, and the simplest one (I believe using the lexicographic order) is just the Lyndon basis IIRC; hence the question.



---

archive/issue_comments_232788.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-04-13T23:14:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232788",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_232789.json:
```json
{
    "body": "<a id='comment:10'></a>IIRC, I followed [MKO1998], which I thought was based on Hall's original construction, but I can't seem to find that reference. I am not tied to the name, and another name might be better if someone wants to implement the other 2 \"natural\" Hall set based bases. It's up to you.\n\nAlso, we should get rid of this filter:\n\n```diff\n-cf = filter(lambda x: x != 0, c)\n+cf = [x for x in c if x != 0]\n```\nJust below that, we could also do:\n\n```diff\n-                nonzero_indices = []\n-                for i in range(len(c)):\n-                    if c[i] != 0:\n-                        nonzero_indices.append(i)\n+                nonzero_indices = [i for i,val in enumerate(c) if val != 0]\n```\nI can make these changes if you want.",
    "created_at": "2017-04-14T00:28:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232789",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:10'></a>IIRC, I followed [MKO1998], which I thought was based on Hall's original construction, but I can't seem to find that reference. I am not tied to the name, and another name might be better if someone wants to implement the other 2 "natural" Hall set based bases. It's up to you.

Also, we should get rid of this filter:

```diff
-cf = filter(lambda x: x != 0, c)
+cf = [x for x in c if x != 0]
```
Just below that, we could also do:

```diff
-                nonzero_indices = []
-                for i in range(len(c)):
-                    if c[i] != 0:
-                        nonzero_indices.append(i)
+                nonzero_indices = [i for i,val in enumerate(c) if val != 0]
```
I can make these changes if you want.



---

archive/issue_comments_232790.json:
```json
{
    "body": "<a id='comment:11'></a>Would be great if you did them. I squinted with some unease at the filter as well, but I thought you had a rationale for using it :)",
    "created_at": "2017-04-14T00:53:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232790",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:11'></a>Would be great if you did them. I squinted with some unease at the filter as well, but I thought you had a rationale for using it :)



---

archive/issue_comments_232791.json:
```json
{
    "body": "<a id='comment:12'></a>Old code, back before I knew as much as I do now.",
    "created_at": "2017-04-14T00:54:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232791",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:12'></a>Old code, back before I knew as much as I do now.



---

archive/issue_comments_232792.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-04-23T22:30:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232792",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_232793.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-04-23T22:33:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232793",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_232794.json:
```json
{
    "body": "<a id='comment:15'></a>This makes the changes I noted in comment:10, as well as making it Python3 compatible and full doctest coverage (I missed one hidden method).",
    "created_at": "2017-04-23T22:34:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232794",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:15'></a>This makes the changes I noted in comment:10, as well as making it Python3 compatible and full doctest coverage (I missed one hidden method).



---

archive/issue_comments_232795.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-06-05T13:57:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232795",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_232796.json:
```json
{
    "body": "<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-06-05T18:34:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232796",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_232797.json:
```json
{
    "body": "<a id='comment:19'></a>does not apply",
    "created_at": "2017-06-17T06:00:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232797",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:19'></a>does not apply



---

archive/issue_comments_232798.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-06-17T06:00:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232798",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_232799.json:
```json
{
    "body": "<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-06-17T06:13:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232799",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_232800.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-06-17T06:13:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232800",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_232801.json:
```json
{
    "body": "<a id='comment:23'></a>doc does not build\n\n```\n+[dochtml] OSError: [groups   ] /home/chapoton/sage/local/lib/python2.7/site-packages/sage/groups/matrix_gps/finitely_generated.py:docstring of sage.groups.matrix_gps.finitely_generated.FinitelyGeneratedMatrixGroup_gap.invariant_generators:59: WARNING: citation not found: Stu1993\n```",
    "created_at": "2017-06-20T06:15:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232801",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:23'></a>doc does not build

```
+[dochtml] OSError: [groups   ] /home/chapoton/sage/local/lib/python2.7/site-packages/sage/groups/matrix_gps/finitely_generated.py:docstring of sage.groups.matrix_gps.finitely_generated.FinitelyGeneratedMatrixGroup_gap.invariant_generators:59: WARNING: citation not found: Stu1993
```



---

archive/issue_comments_232802.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-06-21T07:00:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232802",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_232803.json:
```json
{
    "body": "<a id='comment:25'></a>Yeah, not sure why the Stu1993 reference was removed. Merge gone wrong?\n\nDoc of `graded_dimension` method: replace `n^(k/d)` by `n^{k/d}` (unless our parser somehow handles parentheses here).\n\nI'm a bit surprised that `_rewrite_bracket` is an abstract method on class `FreeLieBasis_abstract` and not on some higher-up class for arbitrary Lie algebras with ordered family bases. But you know better how the class hierarchy should work.\n\nBased on my arguably naive read of the `lie_algebra_generators` method, it constructs the generators in the Lyndon bases, even if `self` is a Hall basis. Is this really what the rest of the code expects? Same for `gens`.\n\nWhere did you get the definition of a Hall set from? [MKO...]? I cannot really match it with Reutenauer's (Section 5 in http://www.lacim.uqam.ca/~christo/Publi%C3%A9s/2003/free%20Lie%20algebras.pdf ); for example, your `b._left <= a` seems to contradict Reutenauer's rule, which is more like `a._right >= b`. More importantly, what is the ordering on the free magma that you are using? Even [MKO...] leaves this undecided (\"Elements of the same length are ordered internally as we please\"). At the very least it seems to be a degree-first ordering, since otherwise it's probably illegal to restrict yourself to `i in range(1, (k+1) // 2)`.\n\nAlso, what is the mathematical significance of the `GradedLieBracket` class? Are they something like the free magma? Things like this should probably be a lot more transparent, ideally with a way for the user to specify the ordering on the free magma.",
    "created_at": "2017-06-21T20:35:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232803",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:25'></a>Yeah, not sure why the Stu1993 reference was removed. Merge gone wrong?

Doc of `graded_dimension` method: replace `n^(k/d)` by `n^{k/d}` (unless our parser somehow handles parentheses here).

I'm a bit surprised that `_rewrite_bracket` is an abstract method on class `FreeLieBasis_abstract` and not on some higher-up class for arbitrary Lie algebras with ordered family bases. But you know better how the class hierarchy should work.

Based on my arguably naive read of the `lie_algebra_generators` method, it constructs the generators in the Lyndon bases, even if `self` is a Hall basis. Is this really what the rest of the code expects? Same for `gens`.

Where did you get the definition of a Hall set from? [MKO...]? I cannot really match it with Reutenauer's (Section 5 in http://www.lacim.uqam.ca/~christo/Publi%C3%A9s/2003/free%20Lie%20algebras.pdf ); for example, your `b._left <= a` seems to contradict Reutenauer's rule, which is more like `a._right >= b`. More importantly, what is the ordering on the free magma that you are using? Even [MKO...] leaves this undecided ("Elements of the same length are ordered internally as we please"). At the very least it seems to be a degree-first ordering, since otherwise it's probably illegal to restrict yourself to `i in range(1, (k+1) // 2)`.

Also, what is the mathematical significance of the `GradedLieBracket` class? Are they something like the free magma? Things like this should probably be a lot more transparent, ideally with a way for the user to specify the ordering on the free magma.



---

archive/issue_comments_232804.json:
```json
{
    "body": "<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-06-23T00:23:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232804",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_232805.json:
```json
{
    "body": "<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-06-23T00:28:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232805",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_232806.json:
```json
{
    "body": "<a id='comment:28'></a>Replying to [comment:25 darij]:\n> Yeah, not sure why the Stu1993 reference was removed. Merge gone wrong?\n\n\nYep, bad merge.\n\n> Doc of `graded_dimension` method: replace `n^(k/d)` by `n^{k/d}` (unless our parser somehow handles parentheses here).\n\n\nDone.\n\n> I'm a bit surprised that `_rewrite_bracket` is an abstract method on class `FreeLieBasis_abstract` and not on some higher-up class for arbitrary Lie algebras with ordered family bases. But you know better how the class hierarchy should work.\n\n\nIt makes no sense anywhere else as this is the only class that has elements stored as trees of Lie brackets.\n\n> Based on my arguably naive read of the `lie_algebra_generators` method, it constructs the generators in the Lyndon bases, even if `self` is a Hall basis. Is this really what the rest of the code expects? Same for `gens`.\n\n\nNot quite. This is a shortcut for creating elements of the free Lie algebra without explicitly specifying the basis (think `SymmetricFunctions`). If you create the Hall basis, which is a separate object, then you have a different `lie_algebra_generators`.\n\n> Where did you get the definition of a Hall set from? [MKO...]? I cannot really match it with Reutenauer's (Section 5 in http://www.lacim.uqam.ca/~christo/Publi%C3%A9s/2003/free%20Lie%20algebras.pdf ); for example, your `b._left <= a` seems to contradict Reutenauer's rule, which is more like `a._right >= b`. More importantly, what is the ordering on the free magma that you are using? Even [MKO...] leaves this undecided (\"Elements of the same length are ordered internally as we please\"). At the very least it seems to be a degree-first ordering, since otherwise it's probably illegal to restrict yourself to `i in range(1, (k+1) // 2)`.\n\n\nFor the most part, it was far too long ago that I wrote this that I do not really remember. I am pretty sure I used [MKO...], but I can't say for certain. However, length := degree in this construction. Feel free to change what you want, but I know this works. IIRC, it agrees with the monomials in [MKO...]. As you point out, there are a number of different Hall sets (well, really I think there are 4 by fundamentally playing two types of left vs right games), and the code seems very sensitive when things are not correct (infinite recursions).\n\n> Also, what is the mathematical significance of the `GradedLieBracket` class? Are they something like the free magma? Things like this should probably be a lot more transparent, ideally with a way for the user to specify the ordering on the free magma.\n\n\nIt is precisely what it says it is: it is a Lie bracket with a grading. In particular, we use the natural grading of generators being degree 1. However, it is basically a helper class used to construct the basis elements and not really meant to be manipulated by the user.",
    "created_at": "2017-06-23T00:45:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232806",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:28'></a>Replying to [comment:25 darij]:
> Yeah, not sure why the Stu1993 reference was removed. Merge gone wrong?


Yep, bad merge.

> Doc of `graded_dimension` method: replace `n^(k/d)` by `n^{k/d}` (unless our parser somehow handles parentheses here).


Done.

> I'm a bit surprised that `_rewrite_bracket` is an abstract method on class `FreeLieBasis_abstract` and not on some higher-up class for arbitrary Lie algebras with ordered family bases. But you know better how the class hierarchy should work.


It makes no sense anywhere else as this is the only class that has elements stored as trees of Lie brackets.

> Based on my arguably naive read of the `lie_algebra_generators` method, it constructs the generators in the Lyndon bases, even if `self` is a Hall basis. Is this really what the rest of the code expects? Same for `gens`.


Not quite. This is a shortcut for creating elements of the free Lie algebra without explicitly specifying the basis (think `SymmetricFunctions`). If you create the Hall basis, which is a separate object, then you have a different `lie_algebra_generators`.

> Where did you get the definition of a Hall set from? [MKO...]? I cannot really match it with Reutenauer's (Section 5 in http://www.lacim.uqam.ca/~christo/Publi%C3%A9s/2003/free%20Lie%20algebras.pdf ); for example, your `b._left <= a` seems to contradict Reutenauer's rule, which is more like `a._right >= b`. More importantly, what is the ordering on the free magma that you are using? Even [MKO...] leaves this undecided ("Elements of the same length are ordered internally as we please"). At the very least it seems to be a degree-first ordering, since otherwise it's probably illegal to restrict yourself to `i in range(1, (k+1) // 2)`.


For the most part, it was far too long ago that I wrote this that I do not really remember. I am pretty sure I used [MKO...], but I can't say for certain. However, length := degree in this construction. Feel free to change what you want, but I know this works. IIRC, it agrees with the monomials in [MKO...]. As you point out, there are a number of different Hall sets (well, really I think there are 4 by fundamentally playing two types of left vs right games), and the code seems very sensitive when things are not correct (infinite recursions).

> Also, what is the mathematical significance of the `GradedLieBracket` class? Are they something like the free magma? Things like this should probably be a lot more transparent, ideally with a way for the user to specify the ordering on the free magma.


It is precisely what it says it is: it is a Lie bracket with a grading. In particular, we use the natural grading of generators being degree 1. However, it is basically a helper class used to construct the basis elements and not really meant to be manipulated by the user.



---

archive/issue_comments_232807.json:
```json
{
    "body": "<a id='comment:29'></a>Bringing over the side discussion from #24144: If you're worried about the Hall basis, then how about I mark it as `experimental` (yes, there something for that similar to `deprecation`). I recall doing a fair bit of testing with it, so I have some confidence it is solid. However, I am willing to give somewhat to get some implementation of the free Lie algebra into Sage. Moreover, if there are serious problems, we can always fix them on later tickets (Sage reviews do not have to be as thorough as math reviews `:)`).",
    "created_at": "2017-11-04T05:42:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232807",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:29'></a>Bringing over the side discussion from #24144: If you're worried about the Hall basis, then how about I mark it as `experimental` (yes, there something for that similar to `deprecation`). I recall doing a fair bit of testing with it, so I have some confidence it is solid. However, I am willing to give somewhat to get some implementation of the free Lie algebra into Sage. Moreover, if there are serious problems, we can always fix them on later tickets (Sage reviews do not have to be as thorough as math reviews `:)`).



---

archive/issue_comments_232808.json:
```json
{
    "body": "<a id='comment:30'></a>So if you're willing to review everything else now and simply mark the Hall as experimental (unless you find a bug if you do look at it), then I can rebase the ticket with that added in.",
    "created_at": "2017-11-04T05:43:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232808",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:30'></a>So if you're willing to review everything else now and simply mark the Hall as experimental (unless you find a bug if you do look at it), then I can rebase the ticket with that added in.



---

archive/issue_comments_232809.json:
```json
{
    "body": "<a id='comment:31'></a>Please do so!",
    "created_at": "2017-11-04T05:43:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232809",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:31'></a>Please do so!



---

archive/issue_comments_232810.json:
```json
{
    "body": "<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-11-04T06:13:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232810",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_232811.json:
```json
{
    "body": "<a id='comment:33'></a>Done.\n\nNote that this will trivially conflict with #24134. So if this is positively reviewed before #24134 is merged, then we will merge it in here. However, we will not do it beforehand.\n\nEdit - Need the right ticket number.",
    "created_at": "2017-11-04T06:13:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232811",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:33'></a>Done.

Note that this will trivially conflict with #24134. So if this is positively reviewed before #24134 is merged, then we will merge it in here. However, we will not do it beforehand.

Edit - Need the right ticket number.



---

archive/issue_comments_232812.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-11-04T06:13:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232812",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_232813.json:
```json
{
    "body": "<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-11-21T11:01:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232813",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_232814.json:
```json
{
    "body": "<a id='comment:35'></a>This needs a non-fully-trivial rebase, that I did not know how to do myself.",
    "created_at": "2017-12-20T09:24:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232814",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:35'></a>This needs a non-fully-trivial rebase, that I did not know how to do myself.



---

archive/issue_comments_232815.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-12-20T09:24:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232815",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_232816.json:
```json
{
    "body": "<a id='comment:36'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-12-20T11:09:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232816",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:36'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_232817.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-12-20T11:10:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232817",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_events_049253.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-12-20T11:10:14Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "milestone": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16823#event-49253"
}
```



---

archive/issue_events_049254.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-12-20T11:10:14Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "milestone": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16823#event-49254"
}
```



---

archive/issue_comments_232818.json:
```json
{
    "body": "<a id='comment:37'></a>Wasn't too bad.",
    "created_at": "2017-12-20T11:10:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232818",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:37'></a>Wasn't too bad.



---

archive/issue_comments_232819.json:
```json
{
    "body": "<a id='comment:38'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-12-28T01:22:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232819",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:38'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_232820.json:
```json
{
    "body": "<a id='comment:39'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-12-28T02:09:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232820",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:39'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_232821.json:
```json
{
    "body": "<a id='comment:40'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-12-29T02:18:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232821",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:40'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_232822.json:
```json
{
    "body": "<a id='comment:41'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-12-30T19:37:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232822",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:41'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_232823.json:
```json
{
    "body": "<a id='comment:42'></a>TODO:\n\n* Review Hall basis. (Which Hall set and which ordering does it use?)\n\n* Extend Lyndon and Hall basis to arbitrary orderings perhaps. (Next ticket.)\n\n* If you don't like my doc for the helper classes, please suggest better alternatives. Doc is highly necessary there. These classes *are* exposed: they are the parents for basis indices, and so will be relevant to anyone defining e.g. maps out of a free Lie algebra. And their use is sufficiently complex that a grep doesn't answer the questions (this is where I got stuck trying to review the ticket months ago).",
    "created_at": "2017-12-30T19:39:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232823",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:42'></a>TODO:

* Review Hall basis. (Which Hall set and which ordering does it use?)

* Extend Lyndon and Hall basis to arbitrary orderings perhaps. (Next ticket.)

* If you don't like my doc for the helper classes, please suggest better alternatives. Doc is highly necessary there. These classes *are* exposed: they are the parents for basis indices, and so will be relevant to anyone defining e.g. maps out of a free Lie algebra. And their use is sufficiently complex that a grep doesn't answer the questions (this is where I got stuck trying to review the ticket months ago).



---

archive/issue_comments_232824.json:
```json
{
    "body": "<a id='comment:43'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-12-31T14:24:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232824",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:43'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_232825.json:
```json
{
    "body": "<a id='comment:44'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-13T19:57:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232825",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:44'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_232826.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-04-13T20:02:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232826",
    "user": "https://github.com/darijgr"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_049255.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-04-13T20:04:42Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "milestone": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16823#event-49255"
}
```



---

archive/issue_events_049256.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-04-13T20:04:42Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "milestone": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16823#event-49256"
}
```



---

archive/issue_comments_232827.json:
```json
{
    "body": "<a id='comment:46'></a>Thank you. See #25166 for a follow-up.",
    "created_at": "2018-04-13T20:04:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232827",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:46'></a>Thank you. See #25166 for a follow-up.



---

archive/issue_comments_232828.json:
```json
{
    "body": "<a id='comment:47'></a>PDF docs don't build",
    "created_at": "2018-05-06T10:47:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232828",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:47'></a>PDF docs don't build



---

archive/issue_comments_232829.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-05-06T10:47:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232829",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_232830.json:
```json
{
    "body": "<a id='comment:48'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-06T21:34:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232830",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:48'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_232831.json:
```json
{
    "body": "<a id='comment:49'></a>Better now? I regret I can't test PDF output on the university machine where I have sage installed (latexmk is missing).",
    "created_at": "2018-05-06T21:41:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232831",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:49'></a>Better now? I regret I can't test PDF output on the university machine where I have sage installed (latexmk is missing).



---

archive/issue_comments_232832.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2018-05-06T21:41:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232832",
    "user": "https://github.com/darijgr"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_232833.json:
```json
{
    "body": "<a id='comment:50'></a>I am testing it right now.",
    "created_at": "2018-05-06T22:20:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232833",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:50'></a>I am testing it right now.



---

archive/issue_comments_232834.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2018-05-06T22:20:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232834",
    "user": "https://github.com/tscrim"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_232835.json:
```json
{
    "body": "<a id='comment:51'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-06T22:45:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232835",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:51'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_232836.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-05-06T22:45:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232836",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_232837.json:
```json
{
    "body": "<a id='comment:52'></a>I was able to build the pdf with these changes.",
    "created_at": "2018-05-06T22:45:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232837",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:52'></a>I was able to build the pdf with these changes.



---

archive/issue_events_049257.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-05-09T09:50:01Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16823#event-49257"
}
```



---

archive/issue_comments_232838.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-05-09T09:50:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16823#issuecomment-232838",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
