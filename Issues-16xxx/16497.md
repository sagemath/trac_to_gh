# Issue 16497: Rounding problem with CBC and gurobi LP solvers

archive/issues_016260.json:
```json
{
    "body": "Running `make ptestlong` with CBC package installed leads to the following doctest errors:\n\n```\nFile \"src/doc/en/thematic_tutorials/linear_programming.rst\", line 442, in doc.en.thematic_tutorials.linear_programming\nFailed example:\n    p.solve()\nExpected:\n    2.0\nGot:\n    1.0\n```\n\n```\nFile \"src/sage/graphs/graph.py\", line 3215, in sage.graphs.graph.Graph.minimum_outdegree_orientation\nFailed example:\n    max(o.out_degree()) == ceil((4*3)/(3+4))\nExpected:\n    True\nGot:\n    False\n```\n\n```\nFile \"src/sage/numerical/optimize.py\", line 777, in sage.numerical.optimize.binpacking\nFailed example:\n    all([ (v in b1 or v in b2 or v in b3) for v in values ])\nExpected:\n    True\nGot:\n    False\n```\n\nThe problem seems to come from `get_variable_value` method in the CBC backend that does not round its result when the variable is binary. Actually, the same problems exists for integer variables in both gurobi and CBC backends (at least), but no doctest detects it.\n\n\nCC:  @nathanncohen\n\nBranch/Commit: 223941347e7ae66304c99ca73e9a531f8cc2c976\n\nReviewer: Nathann Cohen\n\nAuthor: Thierry Monteil\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/16497\n\n",
    "closed_at": "2014-06-27T15:14:50Z",
    "created_at": "2014-06-18T15:46:40Z",
    "labels": [
        "component: packages: optional",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.3",
    "title": "Rounding problem with CBC and gurobi LP solvers",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16497",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```
Running `make ptestlong` with CBC package installed leads to the following doctest errors:

```
File "src/doc/en/thematic_tutorials/linear_programming.rst", line 442, in doc.en.thematic_tutorials.linear_programming
Failed example:
    p.solve()
Expected:
    2.0
Got:
    1.0
```

```
File "src/sage/graphs/graph.py", line 3215, in sage.graphs.graph.Graph.minimum_outdegree_orientation
Failed example:
    max(o.out_degree()) == ceil((4*3)/(3+4))
Expected:
    True
Got:
    False
```

```
File "src/sage/numerical/optimize.py", line 777, in sage.numerical.optimize.binpacking
Failed example:
    all([ (v in b1 or v in b2 or v in b3) for v in values ])
Expected:
    True
Got:
    False
```

The problem seems to come from `get_variable_value` method in the CBC backend that does not round its result when the variable is binary. Actually, the same problems exists for integer variables in both gurobi and CBC backends (at least), but no doctest detects it.


CC:  @nathanncohen

Branch/Commit: 223941347e7ae66304c99ca73e9a531f8cc2c976

Reviewer: Nathann Cohen

Author: Thierry Monteil

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/16497





---

archive/issue_comments_226506.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-06-25T15:48:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16497#issuecomment-226506",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_226507.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -30,6 +30,9 @@\n     False\n ```\n \n+The problem seems to come from `get_variable_value` method in the CBC backend that does not round its result when the variable is binary. Actually, the same problems exists for integer variables in both gurobi and CBC backends (at least), but no doctest detects it.\n+\n+\n Comment: 1\n \n Summary: Rounding problem with CBC\n``````\n",
    "created_at": "2014-06-25T15:52:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16497#issuecomment-226507",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -30,6 +30,9 @@
     False
 ```
 
+The problem seems to come from `get_variable_value` method in the CBC backend that does not round its result when the variable is binary. Actually, the same problems exists for integer variables in both gurobi and CBC backends (at least), but no doctest detects it.
+
+
 Comment: 1
 
 Summary: Rounding problem with CBC
``````




---

archive/issue_comments_226508.json:
```json
{
    "body": "<a id='comment:3'></a>New commits:",
    "created_at": "2014-06-25T15:52:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16497#issuecomment-226508",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:3'></a>New commits:



---

archive/issue_comments_226509.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-06-25T16:30:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16497#issuecomment-226509",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_226510.json:
```json
{
    "body": "<a id='comment:4'></a>Thank you for that !\n\nNathann",
    "created_at": "2014-06-25T16:30:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16497#issuecomment-226510",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:4'></a>Thank you for that !

Nathann



---

archive/issue_comments_226511.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-06-25T16:30:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16497#issuecomment-226511",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_226512.json:
```json
{
    "body": "<a id='comment:6'></a>Well, assuming it was in \"needs_review\" ... ?\n\nNathann",
    "created_at": "2014-06-25T16:30:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16497#issuecomment-226512",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:6'></a>Well, assuming it was in "needs_review" ... ?

Nathann



---

archive/issue_comments_226513.json:
```json
{
    "body": "<a id='comment:7'></a>Well not really, i still need to find a doctest for non-binary integer variables.",
    "created_at": "2014-06-25T16:35:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16497#issuecomment-226513",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:7'></a>Well not really, i still need to find a doctest for non-binary integer variables.



---

archive/issue_comments_226514.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2014-06-25T16:43:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16497#issuecomment-226514",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_226515.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-06-26T15:02:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16497#issuecomment-226515",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_226516.json:
```json
{
    "body": "<a id='comment:10'></a>AHahahhh.. Is it in needs_review now ? `:-P`\n\nNathann",
    "created_at": "2014-06-26T15:06:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16497#issuecomment-226516",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:10'></a>AHahahhh.. Is it in needs_review now ? `:-P`

Nathann



---

archive/issue_comments_226517.json:
```json
{
    "body": "<a id='comment:11'></a>I added a doctest, not sure it is a valuable one. At least on my machine with CBC installed, it returns a wrong answser without the fix (both integer and binary cases), and a good answer with the fix.\n\nIt could be nice to have some buildbots running with some optional packages installed.",
    "created_at": "2014-06-26T15:06:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16497#issuecomment-226517",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:11'></a>I added a doctest, not sure it is a valuable one. At least on my machine with CBC installed, it returns a wrong answser without the fix (both integer and binary cases), and a good answer with the fix.

It could be nice to have some buildbots running with some optional packages installed.



---

archive/issue_comments_226518.json:
```json
{
    "body": "<a id='comment:12'></a>By the way you added a doctest which checks something that was already checked by doctest, i.e. the ones you reported in the message's description `:-P`\n\nNathann",
    "created_at": "2014-06-26T15:07:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16497#issuecomment-226518",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:12'></a>By the way you added a doctest which checks something that was already checked by doctest, i.e. the ones you reported in the message's description `:-P`

Nathann



---

archive/issue_comments_226519.json:
```json
{
    "body": "<a id='comment:13'></a>Well not completely, all doctests passed if i only fixed the binary case.",
    "created_at": "2014-06-26T15:08:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16497#issuecomment-226519",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:13'></a>Well not completely, all doctests passed if i only fixed the binary case.



---

archive/issue_comments_226520.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-06-26T15:08:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16497#issuecomment-226520",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_226521.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-06-26T20:46:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16497#issuecomment-226521",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_226522.json:
```json
{
    "body": "<a id='comment:14'></a>Yo !\n\nOkayyyyyyyy, good to go `:-)`\n\nNathann",
    "created_at": "2014-06-26T20:46:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16497#issuecomment-226522",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:14'></a>Yo !

Okayyyyyyyy, good to go `:-)`

Nathann



---

archive/issue_events_048479.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-06-27T15:14:50Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16497",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16497#event-48479"
}
```



---

archive/issue_comments_226523.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-06-27T15:14:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16497#issuecomment-226523",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
