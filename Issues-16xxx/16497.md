# Issue 16497: Rounding problem with CBC and gurobi LP solvers

archive/issues_016260.json:
```json
{
    "body": "Running `make ptestlong` with CBC package installed leads to the following doctest errors:\n\n```\nFile \"src/doc/en/thematic_tutorials/linear_programming.rst\", line 442, in doc.en.thematic_tutorials.linear_programming\nFailed example:\n    p.solve()\nExpected:\n    2.0\nGot:\n    1.0\n```\n\n```\nFile \"src/sage/graphs/graph.py\", line 3215, in sage.graphs.graph.Graph.minimum_outdegree_orientation\nFailed example:\n    max(o.out_degree()) == ceil((4*3)/(3+4))\nExpected:\n    True\nGot:\n    False\n```\n\n```\nFile \"src/sage/numerical/optimize.py\", line 777, in sage.numerical.optimize.binpacking\nFailed example:\n    all([ (v in b1 or v in b2 or v in b3) for v in values ])\nExpected:\n    True\nGot:\n    False\n```\n\nThe problem seems to come from `get_variable_value` method in the CBC backend that does not round its result when the variable is binary. Actually, the same problems exists for integer variables in both gurobi and CBC backends (at least), but no doctest detects it.\n\n\nCC:  @nathanncohen\n\nBranch/Commit: 223941347e7ae66304c99ca73e9a531f8cc2c976\n\nReviewer: Nathann Cohen\n\nAuthor: Thierry Monteil\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/16497\n\n",
    "closed_at": "2014-06-27T15:14:50Z",
    "created_at": "2014-06-18T15:46:40Z",
    "labels": [
        "component: packages: optional",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.3",
    "title": "Rounding problem with CBC and gurobi LP solvers",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16497",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```
Running `make ptestlong` with CBC package installed leads to the following doctest errors:

```
File "src/doc/en/thematic_tutorials/linear_programming.rst", line 442, in doc.en.thematic_tutorials.linear_programming
Failed example:
    p.solve()
Expected:
    2.0
Got:
    1.0
```

```
File "src/sage/graphs/graph.py", line 3215, in sage.graphs.graph.Graph.minimum_outdegree_orientation
Failed example:
    max(o.out_degree()) == ceil((4*3)/(3+4))
Expected:
    True
Got:
    False
```

```
File "src/sage/numerical/optimize.py", line 777, in sage.numerical.optimize.binpacking
Failed example:
    all([ (v in b1 or v in b2 or v in b3) for v in values ])
Expected:
    True
Got:
    False
```

The problem seems to come from `get_variable_value` method in the CBC backend that does not round its result when the variable is binary. Actually, the same problems exists for integer variables in both gurobi and CBC backends (at least), but no doctest detects it.


CC:  @nathanncohen

Branch/Commit: 223941347e7ae66304c99ca73e9a531f8cc2c976

Reviewer: Nathann Cohen

Author: Thierry Monteil

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/16497





---

archive/issue_comments_276542.json:
```json
{
    "body": "Changing branch from \"\" to \"u/tmonteil/rounding_problem_with_cbc\"",
    "created_at": "2014-06-24T22:22:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16497#issuecomment-276542",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Changing branch from "" to "u/tmonteil/rounding_problem_with_cbc"



---

archive/issue_comments_276543.json:
```json
{
    "body": "<a id='comment:2'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                                   |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------|\n|[7c2fb38](https://github.com/sagemath/sagetrac-mirror/commit/7c2fb38a2ae24e8c59c5fce8dc0c42967a6ef7c2)|`16497 : fix the integer case for gurobi and cplex`|",
    "created_at": "2014-06-25T15:48:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16497#issuecomment-276543",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                                   |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------|
|[7c2fb38](https://github.com/sagemath/sagetrac-mirror/commit/7c2fb38a2ae24e8c59c5fce8dc0c42967a6ef7c2)|`16497 : fix the integer case for gurobi and cplex`|



---

archive/issue_comments_276544.json:
```json
{
    "body": "Changing commit from \"\" to \"7c2fb38a2ae24e8c59c5fce8dc0c42967a6ef7c2\"",
    "created_at": "2014-06-25T15:48:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16497#issuecomment-276544",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "" to "7c2fb38a2ae24e8c59c5fce8dc0c42967a6ef7c2"



---

archive/issue_events_055140.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/16497",
    "rename": {
        "from": "Rounding problem with CBC",
        "to": "Rounding problem with CBC and gurobi LP solvers"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16497#event-55140"
}
```



---

archive/issue_comments_276545.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -30,3 +30,5 @@\n     False\n ```\n \n+The problem seems to come from `get_variable_value` method in the CBC backend that does not round its result when the variable is binary. Actually, the same problems exists for integer variables in both gurobi and CBC backends (at least), but no doctest detects it.\n+\n``````\n",
    "created_at": "2014-06-25T15:52:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16497#issuecomment-276545",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -30,3 +30,5 @@
     False
 ```
 
+The problem seems to come from `get_variable_value` method in the CBC backend that does not round its result when the variable is binary. Actually, the same problems exists for integer variables in both gurobi and CBC backends (at least), but no doctest detects it.
+
``````




---

archive/issue_comments_276546.json:
```json
{
    "body": "<a id='comment:3'></a>\nNew commits:\n|                                                                                                                                          |                                            |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------|\n|[bc1cc7d](https://github.com/sagemath/sagetrac-mirror/commit/bc1cc7d411fd805879f3c179b6dfaf28c69fe5fc)|`first attempt inspired from gurobi_backend`|\n|[7c2fb38](https://github.com/sagemath/sagetrac-mirror/commit/7c2fb38a2ae24e8c59c5fce8dc0c42967a6ef7c2)|`16497 : fix the integer case for gurobi and cplex`|",
    "created_at": "2014-06-25T15:52:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16497#issuecomment-276546",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:3'></a>
New commits:
|                                                                                                                                          |                                            |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------|
|[bc1cc7d](https://github.com/sagemath/sagetrac-mirror/commit/bc1cc7d411fd805879f3c179b6dfaf28c69fe5fc)|`first attempt inspired from gurobi_backend`|
|[7c2fb38](https://github.com/sagemath/sagetrac-mirror/commit/7c2fb38a2ae24e8c59c5fce8dc0c42967a6ef7c2)|`16497 : fix the integer case for gurobi and cplex`|



---

archive/issue_comments_276547.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-06-25T16:30:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16497#issuecomment-276547",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_276548.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Nathann Cohen\"",
    "created_at": "2014-06-25T16:30:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16497#issuecomment-276548",
    "user": "https://github.com/nathanncohen"
}
```

Changing reviewer from "" to "Nathann Cohen"



---

archive/issue_comments_276549.json:
```json
{
    "body": "Changing author from \"\" to \"Thierry Monteil\"",
    "created_at": "2014-06-25T16:30:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16497#issuecomment-276549",
    "user": "https://github.com/nathanncohen"
}
```

Changing author from "" to "Thierry Monteil"



---

archive/issue_comments_276550.json:
```json
{
    "body": "<a id='comment:4'></a>\nThank you for that !\n\nNathann",
    "created_at": "2014-06-25T16:30:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16497#issuecomment-276550",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:4'></a>
Thank you for that !

Nathann



---

archive/issue_comments_276551.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-06-25T16:30:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16497#issuecomment-276551",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_276552.json:
```json
{
    "body": "<a id='comment:6'></a>\nWell, assuming it was in \"needs_review\" ... ?\n\nNathann",
    "created_at": "2014-06-25T16:30:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16497#issuecomment-276552",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:6'></a>
Well, assuming it was in "needs_review" ... ?

Nathann



---

archive/issue_comments_276553.json:
```json
{
    "body": "<a id='comment:7'></a>\nWell not really, i still need to find a doctest for non-binary integer variables.",
    "created_at": "2014-06-25T16:35:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16497#issuecomment-276553",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:7'></a>
Well not really, i still need to find a doctest for non-binary integer variables.



---

archive/issue_comments_276554.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2014-06-25T16:43:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16497#issuecomment-276554",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_276555.json:
```json
{
    "body": "Changing commit from \"7c2fb38a2ae24e8c59c5fce8dc0c42967a6ef7c2\" to \"223941347e7ae66304c99ca73e9a531f8cc2c976\"",
    "created_at": "2014-06-26T15:02:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16497#issuecomment-276555",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "7c2fb38a2ae24e8c59c5fce8dc0c42967a6ef7c2" to "223941347e7ae66304c99ca73e9a531f8cc2c976"



---

archive/issue_comments_276556.json:
```json
{
    "body": "<a id='comment:9'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                     |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------|\n|[2239413](https://github.com/sagemath/sagetrac-mirror/commit/223941347e7ae66304c99ca73e9a531f8cc2c976)|`16497 : add doctest`|",
    "created_at": "2014-06-26T15:02:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16497#issuecomment-276556",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                     |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------|
|[2239413](https://github.com/sagemath/sagetrac-mirror/commit/223941347e7ae66304c99ca73e9a531f8cc2c976)|`16497 : add doctest`|



---

archive/issue_comments_276557.json:
```json
{
    "body": "<a id='comment:10'></a>\nAHahahhh.. Is it in needs_review now ? `:-P`\n\nNathann",
    "created_at": "2014-06-26T15:06:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16497#issuecomment-276557",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:10'></a>
AHahahhh.. Is it in needs_review now ? `:-P`

Nathann



---

archive/issue_comments_276558.json:
```json
{
    "body": "<a id='comment:11'></a>\nI added a doctest, not sure it is a valuable one. At least on my machine with CBC installed, it returns a wrong answser without the fix (both integer and binary cases), and a good answer with the fix.\n\nIt could be nice to have some buildbots running with some optional packages installed.",
    "created_at": "2014-06-26T15:06:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16497#issuecomment-276558",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:11'></a>
I added a doctest, not sure it is a valuable one. At least on my machine with CBC installed, it returns a wrong answser without the fix (both integer and binary cases), and a good answer with the fix.

It could be nice to have some buildbots running with some optional packages installed.



---

archive/issue_comments_276559.json:
```json
{
    "body": "<a id='comment:12'></a>\nBy the way you added a doctest which checks something that was already checked by doctest, i.e. the ones you reported in the message's description `:-P`\n\nNathann",
    "created_at": "2014-06-26T15:07:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16497#issuecomment-276559",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:12'></a>
By the way you added a doctest which checks something that was already checked by doctest, i.e. the ones you reported in the message's description `:-P`

Nathann



---

archive/issue_comments_276560.json:
```json
{
    "body": "<a id='comment:13'></a>\nWell not completely, all doctests passed if i only fixed the binary case.",
    "created_at": "2014-06-26T15:08:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16497#issuecomment-276560",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:13'></a>
Well not completely, all doctests passed if i only fixed the binary case.



---

archive/issue_comments_276561.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-06-26T15:08:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16497#issuecomment-276561",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_276562.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-06-26T20:46:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16497#issuecomment-276562",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_276563.json:
```json
{
    "body": "<a id='comment:14'></a>\nYo !\n\nOkayyyyyyyy, good to go `:-)`\n\nNathann",
    "created_at": "2014-06-26T20:46:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16497#issuecomment-276563",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:14'></a>
Yo !

Okayyyyyyyy, good to go `:-)`

Nathann



---

archive/issue_comments_276564.json:
```json
{
    "body": "Changing branch from \"u/tmonteil/rounding_problem_with_cbc\" to \"223941347e7ae66304c99ca73e9a531f8cc2c976\"",
    "created_at": "2014-06-27T15:14:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16497#issuecomment-276564",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/tmonteil/rounding_problem_with_cbc" to "223941347e7ae66304c99ca73e9a531f8cc2c976"



---

archive/issue_events_055141.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-06-27T15:14:50Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16497",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16497#event-55141"
}
```



---

archive/issue_comments_276565.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-06-27T15:14:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16497",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16497#issuecomment-276565",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
