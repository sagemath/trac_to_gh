# Issue 16959: p-primary bound for Sha can be improved

archive/issues_016722.json:
```json
{
    "body": "This ticket aims to improve the p-adic bit of sha_tate for elliptic curves over Q. \n\n* There are a few minor points to improve in the documentation (some of the conditions are not stated precisely or slightly wrong).\n\n* We can now allow reducible primes, too. Since #6406 we ask for the p-adic rep to be surjective. However the recent results in [1] imply that the bounds are also correct for all odd primes of semi-stable reduction when the curve admits a p-isogeny. \n\n* There is a small bug in padic_lseries, which made this fails:\n\n```\nsage: E = EllipticCurve(\"5040bi1\")\nsage: E.sha().p_primary_bound(5)\n```\n(reported by Charlene Soh).\n\n[1] C Wuthrich, On the integrality of modular symbols and Kato's Euler system for elliptic curves. Doc. Math. 19 (2014), 381\u2013402.\n\nCC:  @pjbruin\n\nKeywords: tate-shafarevich, shark\n\nBranch/Commit: 01e4bb03168ef08f91295b948baaa8c8c34b696d\n\nReviewer: William Stein, Peter Bruin\n\nAuthor: Chris Wuthrich\n\nDependencies: #16977\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/16959\n\n",
    "closed_at": "2015-01-04T12:43:17Z",
    "created_at": "2014-09-10T15:28:37Z",
    "labels": [
        "component: elliptic curves",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "p-primary bound for Sha can be improved",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16959",
    "user": "https://github.com/categorie"
}
```
This ticket aims to improve the p-adic bit of sha_tate for elliptic curves over Q. 

* There are a few minor points to improve in the documentation (some of the conditions are not stated precisely or slightly wrong).

* We can now allow reducible primes, too. Since #6406 we ask for the p-adic rep to be surjective. However the recent results in [1] imply that the bounds are also correct for all odd primes of semi-stable reduction when the curve admits a p-isogeny. 

* There is a small bug in padic_lseries, which made this fails:

```
sage: E = EllipticCurve("5040bi1")
sage: E.sha().p_primary_bound(5)
```
(reported by Charlene Soh).

[1] C Wuthrich, On the integrality of modular symbols and Kato's Euler system for elliptic curves. Doc. Math. 19 (2014), 381â€“402.

CC:  @pjbruin

Keywords: tate-shafarevich, shark

Branch/Commit: 01e4bb03168ef08f91295b948baaa8c8c34b696d

Reviewer: William Stein, Peter Bruin

Author: Chris Wuthrich

Dependencies: #16977

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/16959





---

archive/issue_comments_235305.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2014-09-10T15:39:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-235305",
    "user": "https://github.com/categorie"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_235306.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-09-10T15:40:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-235306",
    "user": "https://github.com/categorie"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_235307.json:
```json
{
    "body": "<a id='comment:3'></a>Sorry for the noise. I reformated some of the docstrings. Not that much changes actually.",
    "created_at": "2014-09-10T15:41:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-235307",
    "user": "https://github.com/categorie"
}
```

<a id='comment:3'></a>Sorry for the noise. I reformated some of the docstrings. Not that much changes actually.



---

archive/issue_comments_235308.json:
```json
{
    "body": "<a id='comment:4'></a>Please run doctests, e.g., -- your changes here impact the file BSD.py, causing 5 doctest failures:\n\n```\n/scratch/wstein/sage-6.4.beta0$ ./sage -t --warn-long 108.4 src/sage/schemes/elliptic_curves/BSD.py\nRunning doctests with ID 2014-09-10-16-21-02-4fc7534a.\nDoctesting 1 file.\nsage -t --warn-long 108.4 src/sage/schemes/elliptic_curves/BSD.py\n**********************************************************************\nFile \"src/sage/schemes/elliptic_curves/BSD.py\", line 304, in sage.schemes.elliptic_curves.BSD.?\nFailed example:\n    EllipticCurve('11a').prove_BSD(verbosity=2)\nExpected:\n    p = 2: True by 2-descent...\n    True for p not in {2, 5} by Kolyvagin.\n    True for p=5 by Mazur\n    []\nGot:\n    p = 2: True by 2-descent\n    True for p not in {2, 5} by Kolyvagin.\n    Kato further implies that #Sha[5] is trivial.\n    []\n**********************************************************************\nFile \"src/sage/schemes/elliptic_curves/BSD.py\", line 310, in sage.schemes.elliptic_curves.BSD.?\nFailed example:\n    EllipticCurve('14a').prove_BSD(verbosity=2)\nExpected:\n    p = 2: True by 2-descent\n    True for p not in {2, 3} by Kolyvagin.\n    Remaining primes:\n    p = 3: reducible, not surjective, good ordinary, divides a Tamagawa number\n        (no bounds found)\n        ord_p(#Sha_an) = 0\n    [3]\nGot:\n    p = 2: True by 2-descent\n    True for p not in {2, 3} by Kolyvagin.\n    Kato further implies that #Sha[3] is trivial.\n    []\n**********************************************************************\nFile \"src/sage/schemes/elliptic_curves/BSD.py\", line 318, in sage.schemes.elliptic_curves.BSD.?\nFailed example:\n    EllipticCurve('14a').prove_BSD(two_desc='simon')\nExpected:\n    [3]\nGot:\n    []\n**********************************************************************\n...\n```",
    "created_at": "2014-09-10T16:23:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-235308",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:4'></a>Please run doctests, e.g., -- your changes here impact the file BSD.py, causing 5 doctest failures:

```
/scratch/wstein/sage-6.4.beta0$ ./sage -t --warn-long 108.4 src/sage/schemes/elliptic_curves/BSD.py
Running doctests with ID 2014-09-10-16-21-02-4fc7534a.
Doctesting 1 file.
sage -t --warn-long 108.4 src/sage/schemes/elliptic_curves/BSD.py
**********************************************************************
File "src/sage/schemes/elliptic_curves/BSD.py", line 304, in sage.schemes.elliptic_curves.BSD.?
Failed example:
    EllipticCurve('11a').prove_BSD(verbosity=2)
Expected:
    p = 2: True by 2-descent...
    True for p not in {2, 5} by Kolyvagin.
    True for p=5 by Mazur
    []
Got:
    p = 2: True by 2-descent
    True for p not in {2, 5} by Kolyvagin.
    Kato further implies that #Sha[5] is trivial.
    []
**********************************************************************
File "src/sage/schemes/elliptic_curves/BSD.py", line 310, in sage.schemes.elliptic_curves.BSD.?
Failed example:
    EllipticCurve('14a').prove_BSD(verbosity=2)
Expected:
    p = 2: True by 2-descent
    True for p not in {2, 3} by Kolyvagin.
    Remaining primes:
    p = 3: reducible, not surjective, good ordinary, divides a Tamagawa number
        (no bounds found)
        ord_p(#Sha_an) = 0
    [3]
Got:
    p = 2: True by 2-descent
    True for p not in {2, 3} by Kolyvagin.
    Kato further implies that #Sha[3] is trivial.
    []
**********************************************************************
File "src/sage/schemes/elliptic_curves/BSD.py", line 318, in sage.schemes.elliptic_curves.BSD.?
Failed example:
    EllipticCurve('14a').prove_BSD(two_desc='simon')
Expected:
    [3]
Got:
    []
**********************************************************************
...
```



---

archive/issue_comments_235309.json:
```json
{
    "body": "<a id='comment:5'></a>In elliptic_curves, the only failures are in BSD.py:\n\n```\n/scratch/wstein/sage-6.4.beta0$ ./sage -tp 12 --long src/sage/schemes/elliptic_curves/ \n...\n---------------------------------------------------------------------\nsage -t --long --warn-long 101.9 src/sage/schemes/elliptic_curves/BSD.py  # 5 doctests failed\n----------------------------------------------------------------------\nTotal time for all tests: 171.4 seconds\n    cpu time: 814.7 seconds\n    cumulative wall time: 909.4 seconds\n```",
    "created_at": "2014-09-10T16:49:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-235309",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:5'></a>In elliptic_curves, the only failures are in BSD.py:

```
/scratch/wstein/sage-6.4.beta0$ ./sage -tp 12 --long src/sage/schemes/elliptic_curves/ 
...
---------------------------------------------------------------------
sage -t --long --warn-long 101.9 src/sage/schemes/elliptic_curves/BSD.py  # 5 doctests failed
----------------------------------------------------------------------
Total time for all tests: 171.4 seconds
    cpu time: 814.7 seconds
    cumulative wall time: 909.4 seconds
```



---

archive/issue_comments_235310.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-09-10T18:45:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-235310",
    "user": "https://github.com/williamstein"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_235311.json:
```json
{
    "body": "<a id='comment:6'></a>I ran all tests ('make ptestlong') across sage, including the documentation, and this is what I got:\n\n```\n----------------------------------------------------------------------\nsage -t --long --warn-long 104.2 src/doc/en/bordeaux_2008/elliptic_curves.rst  # 1 doctest failed\nsage -t --long --warn-long 104.2 src/sage/schemes/elliptic_curves/BSD.py  # 5 doctests failed\n----------------------------------------------------------------------\nTotal time for all tests: 1106.0 seconds\n    cpu time: 10570.1 seconds\n    cumulative wall time: 12252.5 seconds\nmake: *** [ptestlong] Error 1\n/scratch/wstein/sage-6.4.beta0$  \n```\n\nAside from fixing that, I am happy with this \"patch\" (having read it).",
    "created_at": "2014-09-10T18:45:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-235311",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:6'></a>I ran all tests ('make ptestlong') across sage, including the documentation, and this is what I got:

```
----------------------------------------------------------------------
sage -t --long --warn-long 104.2 src/doc/en/bordeaux_2008/elliptic_curves.rst  # 1 doctest failed
sage -t --long --warn-long 104.2 src/sage/schemes/elliptic_curves/BSD.py  # 5 doctests failed
----------------------------------------------------------------------
Total time for all tests: 1106.0 seconds
    cpu time: 10570.1 seconds
    cumulative wall time: 12252.5 seconds
make: *** [ptestlong] Error 1
/scratch/wstein/sage-6.4.beta0$  
```

Aside from fixing that, I am happy with this "patch" (having read it).



---

archive/issue_comments_235312.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-09-11T07:04:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-235312",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_235313.json:
```json
{
    "body": "<a id='comment:8'></a>Sorry for the sloppy work. Now I adjusted these two and all tests pass.\n\nI had to change William's presentation in Bordeaux. Now there are two more or less identical examples. I thought it better not to change the example though.",
    "created_at": "2014-09-11T07:09:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-235313",
    "user": "https://github.com/categorie"
}
```

<a id='comment:8'></a>Sorry for the sloppy work. Now I adjusted these two and all tests pass.

I had to change William's presentation in Bordeaux. Now there are two more or less identical examples. I thought it better not to change the example though.



---

archive/issue_comments_235314.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-09-11T07:09:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-235314",
    "user": "https://github.com/categorie"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_235315.json:
```json
{
    "body": "<a id='comment:9'></a>It now looks perfect... except why did you delete the periods after our first initials in this diff (e.g., \"W. Stein\" --> \"W Stein\"):\n\n```\ndiff --git a/src/sage/schemes/elliptic_curves/BSD.py b/src/sage/schemes/elliptic_curves/BSD.py\nindex 0b26f34..f496ccb 100644\n--- a/src/sage/schemes/elliptic_curves/BSD.py\n+++ b/src/sage/schemes/elliptic_curves/BSD.py\n@@ -290,9 +290,9 @@ def prove_BSD(E, verbosity=0, two_desc='mwrank', proof=None, secs_hi=5,\n        Hautes \u00c9tudes Sci. Publ. Math. No. 47 (1977), 33--186 (1978).\n     .. [Rubin] K. Rubin. The \"main conjectures\" of Iwasawa theory for\n        imaginary quadratic fields. Invent. Math. 103 (1991), no. 1, 25--68.\n-    .. [SteinWuthrich] W. Stein and C. Wuthrich. Computations about\n-       Tate-Shafarevich groups using Iwasawa theory.\n-       http://wstein.org/papers/shark, February 2008.\n+    .. [SteinWuthrich] W Stein and C Wuthrich, Algorithms\n+       for the Arithmetic of Elliptic Curves using Iwasawa Theory\n+       Mathematics of Computation 82 (2013), 1757-1792.\n     .. [SteinEtAl] G. Grigorov, A. Jorza, S. Patrikis, W. Stein,\n        C. Tarni\u0163\u01ce. Computational verification of the Birch and\n        Swinnerton-Dyer conjecture for individual elliptic curves.\n```",
    "created_at": "2014-09-11T17:28:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-235315",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:9'></a>It now looks perfect... except why did you delete the periods after our first initials in this diff (e.g., "W. Stein" --> "W Stein"):

```
diff --git a/src/sage/schemes/elliptic_curves/BSD.py b/src/sage/schemes/elliptic_curves/BSD.py
index 0b26f34..f496ccb 100644
--- a/src/sage/schemes/elliptic_curves/BSD.py
+++ b/src/sage/schemes/elliptic_curves/BSD.py
@@ -290,9 +290,9 @@ def prove_BSD(E, verbosity=0, two_desc='mwrank', proof=None, secs_hi=5,
        Hautes Ã‰tudes Sci. Publ. Math. No. 47 (1977), 33--186 (1978).
     .. [Rubin] K. Rubin. The "main conjectures" of Iwasawa theory for
        imaginary quadratic fields. Invent. Math. 103 (1991), no. 1, 25--68.
-    .. [SteinWuthrich] W. Stein and C. Wuthrich. Computations about
-       Tate-Shafarevich groups using Iwasawa theory.
-       http://wstein.org/papers/shark, February 2008.
+    .. [SteinWuthrich] W Stein and C Wuthrich, Algorithms
+       for the Arithmetic of Elliptic Curves using Iwasawa Theory
+       Mathematics of Computation 82 (2013), 1757-1792.
     .. [SteinEtAl] G. Grigorov, A. Jorza, S. Patrikis, W. Stein,
        C. TarniÅ£ÇŽ. Computational verification of the Birch and
        Swinnerton-Dyer conjecture for individual elliptic curves.
```



---

archive/issue_comments_235316.json:
```json
{
    "body": "<a id='comment:10'></a>(switching to positive review -- the dots are a triviality).",
    "created_at": "2014-09-11T17:29:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-235316",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:10'></a>(switching to positive review -- the dots are a triviality).



---

archive/issue_comments_235317.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-09-11T17:29:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-235317",
    "user": "https://github.com/williamstein"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_235318.json:
```json
{
    "body": "<a id='comment:11'></a>Fails on 32-bit:\n\n```\nsage -t --long src/sage/schemes/elliptic_curves/sha_tate.py\n**********************************************************************\nFile \"src/sage/schemes/elliptic_curves/sha_tate.py\", line 768, in sage.schemes.elliptic_curves.sha_tate.Sha.p_primary_bound\nFailed example:\n    e.sha().p_primary_bound(7)\nException raised:\n    Traceback (most recent call last):\n      File \"/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 480, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 843, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.schemes.elliptic_curves.sha_tate.Sha.p_primary_bound[13]>\", line 1, in <module>\n        e.sha().p_primary_bound(Integer(7))\n      File \"/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/sha_tate.py\", line 805, in p_primary_bound\n        shan = self.an_padic(p,prec = 0,use_twists=True)\n      File \"/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/sha_tate.py\", line 577, in an_padic\n        lp = Et.padic_lseries(p)\n      File \"/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/padics.py\", line 158, in padic_lseries\n        normalize = normalize, use_eclib=use_eclib)\n      File \"/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/padic_lseries.py\", line 197, in __init__\n        self._modular_symbol = E.modular_symbol(sign=+1, use_eclib = use_eclib, normalize=normalize)\n      File \"/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/ell_rational_field.py\", line 1208, in modular_symbol\n        M = ell_modular_symbols.ModularSymbolECLIB(self, sign, normalize=normalize)\n      File \"/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/ell_modular_symbols.py\", line 500, in __init__\n        self._modsym = ECModularSymbol(E)\n      File \"sage/libs/cremona/newforms.pyx\", line 70, in sage.libs.cremona.newforms.ECModularSymbol.__init__ (build/cythonized/sage/libs/cremona/newforms.cpp:2310)\n    OverflowError: Python int too large to convert to C long\n**********************************************************************\n```",
    "created_at": "2014-09-12T10:43:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-235318",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:11'></a>Fails on 32-bit:

```
sage -t --long src/sage/schemes/elliptic_curves/sha_tate.py
**********************************************************************
File "src/sage/schemes/elliptic_curves/sha_tate.py", line 768, in sage.schemes.elliptic_curves.sha_tate.Sha.p_primary_bound
Failed example:
    e.sha().p_primary_bound(7)
Exception raised:
    Traceback (most recent call last):
      File "/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 480, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 843, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.schemes.elliptic_curves.sha_tate.Sha.p_primary_bound[13]>", line 1, in <module>
        e.sha().p_primary_bound(Integer(7))
      File "/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/sha_tate.py", line 805, in p_primary_bound
        shan = self.an_padic(p,prec = 0,use_twists=True)
      File "/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/sha_tate.py", line 577, in an_padic
        lp = Et.padic_lseries(p)
      File "/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/padics.py", line 158, in padic_lseries
        normalize = normalize, use_eclib=use_eclib)
      File "/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/padic_lseries.py", line 197, in __init__
        self._modular_symbol = E.modular_symbol(sign=+1, use_eclib = use_eclib, normalize=normalize)
      File "/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/ell_rational_field.py", line 1208, in modular_symbol
        M = ell_modular_symbols.ModularSymbolECLIB(self, sign, normalize=normalize)
      File "/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/ell_modular_symbols.py", line 500, in __init__
        self._modsym = ECModularSymbol(E)
      File "sage/libs/cremona/newforms.pyx", line 70, in sage.libs.cremona.newforms.ECModularSymbol.__init__ (build/cythonized/sage/libs/cremona/newforms.cpp:2310)
    OverflowError: Python int too large to convert to C long
**********************************************************************
```



---

archive/issue_comments_235319.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2014-09-12T10:43:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-235319",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_235320.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-09-12T13:00:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-235320",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_235321.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-09-12T13:01:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-235321",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_235322.json:
```json
{
    "body": "<a id='comment:14'></a>Just documenting that it doesn't work on 32bit is not really a desirable fix...",
    "created_at": "2014-09-12T13:03:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-235322",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:14'></a>Just documenting that it doesn't work on 32bit is not really a desirable fix...



---

archive/issue_comments_235323.json:
```json
{
    "body": "<a id='comment:16'></a>I hope this would solve it, though I can't test 32-bit.\n\nThis 32-bit issue is linked to eclib having problems with 32-bit. I copied # 32-bit as I did earlier in #11211, where Paul Zimmermann noticed \"However there are already some tests that are known to fail on 32-bit, for example in lib/cremona/newforms.pyx: ...\". At the time I did not see any other solution than to make 32-bit fail. I don't know if the state has evolved since then. \n\nIf so that should be solved on a different ticket. This ticket here removed one example of this #32-bit behaviour and replaced it with another.",
    "created_at": "2014-09-12T13:11:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-235323",
    "user": "https://github.com/categorie"
}
```

<a id='comment:16'></a>I hope this would solve it, though I can't test 32-bit.

This 32-bit issue is linked to eclib having problems with 32-bit. I copied # 32-bit as I did earlier in #11211, where Paul Zimmermann noticed "However there are already some tests that are known to fail on 32-bit, for example in lib/cremona/newforms.pyx: ...". At the time I did not see any other solution than to make 32-bit fail. I don't know if the state has evolved since then. 

If so that should be solved on a different ticket. This ticket here removed one example of this #32-bit behaviour and replaced it with another.



---

archive/issue_comments_235324.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-09-12T13:11:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-235324",
    "user": "https://github.com/categorie"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_235325.json:
```json
{
    "body": "<a id='comment:17'></a>John, do you care to comment on this? ;-)\n\nI'm fine with making it a separate ticket, but then make sure that there *is* a separate ticket for that issue and link to it.",
    "created_at": "2014-09-12T13:13:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-235325",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:17'></a>John, do you care to comment on this? ;-)

I'm fine with making it a separate ticket, but then make sure that there *is* a separate ticket for that issue and link to it.



---

archive/issue_comments_235326.json:
```json
{
    "body": "<a id='comment:18'></a>I am wondering why Chris removed me from the CC field....in nay case I received the email when I was added, and now I have written on the ticket so you cannot get rid of me!\n\nI think this can be fixed by changing lines 66-70 of sage/libs/cremona/newforms.pyx:\n\n```\n        a1 = new_bigint(int(E.a1()))\n        a2 = new_bigint(int(E.a2()))\n        a3 = new_bigint(int(E.a3()))\n        a4 = new_bigint(int(E.a4()))\n        a6 = new_bigint(int(E.a6()))\n```\nHere the E.a1() etc are Sage integers, and they need to be converted into eclib bigints which are exactly NTL ZZs.  This should be possible without going via Python ints.  The new_bigint function  is defined near the top of defs.pxi is a long --> ZZ conversion (just NTL's to_ZZ).  If nothing else, I think NTL can convert decimal strings to ZZs so you could try just replacing \"int\" with \"str\" in those 5 lines?",
    "created_at": "2014-09-12T13:29:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-235326",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:18'></a>I am wondering why Chris removed me from the CC field....in nay case I received the email when I was added, and now I have written on the ticket so you cannot get rid of me!

I think this can be fixed by changing lines 66-70 of sage/libs/cremona/newforms.pyx:

```
        a1 = new_bigint(int(E.a1()))
        a2 = new_bigint(int(E.a2()))
        a3 = new_bigint(int(E.a3()))
        a4 = new_bigint(int(E.a4()))
        a6 = new_bigint(int(E.a6()))
```
Here the E.a1() etc are Sage integers, and they need to be converted into eclib bigints which are exactly NTL ZZs.  This should be possible without going via Python ints.  The new_bigint function  is defined near the top of defs.pxi is a long --> ZZ conversion (just NTL's to_ZZ).  If nothing else, I think NTL can convert decimal strings to ZZs so you could try just replacing "int" with "str" in those 5 lines?



---

archive/issue_comments_235327.json:
```json
{
    "body": "<a id='comment:19'></a>I did not \"remove\" you, of course. But I am puzzled that you were not added when I chose the component. Sorry John.\n\nThat would be great if we can can get rid of these 32-bit exceptions. There are 3 such examples in sha_tate and one in newforms, not sure if there are any others, but I could not grep any others....\n\nI am fine if you want to do these changes on this present ticket as wel even if the issue is slightly different. Probably a separate ticket makes more sense. However, I fear I can help out because I have no access to a 32-bit machine to test this.",
    "created_at": "2014-09-12T13:50:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-235327",
    "user": "https://github.com/categorie"
}
```

<a id='comment:19'></a>I did not "remove" you, of course. But I am puzzled that you were not added when I chose the component. Sorry John.

That would be great if we can can get rid of these 32-bit exceptions. There are 3 such examples in sha_tate and one in newforms, not sure if there are any others, but I could not grep any others....

I am fine if you want to do these changes on this present ticket as wel even if the issue is slightly different. Probably a separate ticket makes more sense. However, I fear I can help out because I have no access to a 32-bit machine to test this.



---

archive/issue_comments_235328.json:
```json
{
    "body": "<a id='comment:20'></a>I think it would be best to do this on a separate ticket.  I can test it on my 6.5-year-old laptop.  See #16977.  It will not be done immediately since I am still catching up after 2 weeks away, and don't have the laptop in my office anyway.",
    "created_at": "2014-09-12T14:04:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-235328",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:20'></a>I think it would be best to do this on a separate ticket.  I can test it on my 6.5-year-old laptop.  See #16977.  It will not be done immediately since I am still catching up after 2 weeks away, and don't have the laptop in my office anyway.



---

archive/issue_comments_235329.json:
```json
{
    "body": "<a id='comment:21'></a>If you make the edit then I can test it on the 32-bit buildbot...",
    "created_at": "2014-09-12T14:16:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-235329",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:21'></a>If you make the edit then I can test it on the 32-bit buildbot...



---

archive/issue_comments_235330.json:
```json
{
    "body": "<a id='comment:22'></a>ping!\n\n(this should get reviewed as it is in 64bits and 32bits, please. Later the doctests 32-bit can be removed again in #16977.)",
    "created_at": "2014-10-30T17:27:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-235330",
    "user": "https://github.com/categorie"
}
```

<a id='comment:22'></a>ping!

(this should get reviewed as it is in 64bits and 32bits, please. Later the doctests 32-bit can be removed again in #16977.)



---

archive/issue_comments_235331.json:
```json
{
    "body": "<a id='comment:24'></a>Working on a reviewer patch (docstring improvements and doctest updates after #16977).",
    "created_at": "2014-12-23T14:13:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-235331",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:24'></a>Working on a reviewer patch (docstring improvements and doctest updates after #16977).



---

archive/issue_comments_235332.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-12-23T20:37:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-235332",
    "user": "https://github.com/pjbruin"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_235333.json:
```json
{
    "body": "<a id='comment:25'></a>The reviewer patch mostly fixes formatting and typos in docstrings.  All tests pass, time to put it back to positive review.",
    "created_at": "2014-12-23T20:37:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-235333",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:25'></a>The reviewer patch mostly fixes formatting and typos in docstrings.  All tests pass, time to put it back to positive review.



---

archive/issue_comments_235334.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-01-04T12:43:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16959#issuecomment-235334",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_049462.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-01-04T12:43:17Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16959",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16959#event-49462"
}
```
