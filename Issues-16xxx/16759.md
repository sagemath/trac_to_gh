# Issue 16759: install_package() is obsolete

archive/issues_016522.json:
```json
{
    "assignees": [],
    "body": "Packages should be installed using `sage -i` from a shell, not with the `install_package()` Sage command.\n\nFor consistency in error messages, we introduce the exception `PackageNotFoundError` which should be used to signal that a package is not installed. This idea was taken from an existing but unused exception `OptionalPackageNotFoundError` (which is removed).\n\nCC:  @williamstein\n\nBranch/Commit: **[da03be1](https://github.com/sagemath/sagetrac-mirror/commit/da03be13988e41fc483ee2001654a55d4e45ee95)**\n\nStopgaps: **#16760**\n\nReviewer: **John Palmieri**\n\nAuthor: **Jeroen Demeyer**\n\nComponent: **misc**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/16759_\n\n",
    "closed_at": "2015-09-14T19:01:22Z",
    "created_at": "2014-08-04T17:59:49Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.9",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "install_package() is obsolete",
    "type": "issue",
    "updated_at": "2015-09-14T19:01:22Z",
    "url": "https://github.com/sagemath/sage/issues/16759",
    "user": "https://github.com/jdemeyer"
}
```
Packages should be installed using `sage -i` from a shell, not with the `install_package()` Sage command.

For consistency in error messages, we introduce the exception `PackageNotFoundError` which should be used to signal that a package is not installed. This idea was taken from an existing but unused exception `OptionalPackageNotFoundError` (which is removed).

CC:  @williamstein

Branch/Commit: **[da03be1](https://github.com/sagemath/sagetrac-mirror/commit/da03be13988e41fc483ee2001654a55d4e45ee95)**

Stopgaps: **#16760**

Reviewer: **John Palmieri**

Author: **Jeroen Demeyer**

Component: **misc**

_Issue created by migration from https://trac.sagemath.org/ticket/16759_





---

archive/issue_events_239542.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-08-04T17:59:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16759#event-239542"
}
```



---

archive/issue_events_239543.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-08-04T17:59:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16759#event-239543"
}
```



---

archive/issue_events_239544.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-08-04T17:59:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16759#event-239544"
}
```



---

archive/issue_comments_219504.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nIt also looks like `sage --standard` is broken: it is using old package information. For example, it thinks that the current version of Sage is 5.13. Also, `pillow` is now a standard package, replacing `pil`, but `pil` shows up.\n\nI'm not sure where to get a list of all of the current standard packages, but once we had that, we might be able to get the version numbers from `http://www.sagemath.org/packages/upstream/`.",
    "created_at": "2014-08-04T21:07:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16759#issuecomment-219504",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:1" align="right">comment:1</div>

It also looks like `sage --standard` is broken: it is using old package information. For example, it thinks that the current version of Sage is 5.13. Also, `pillow` is now a standard package, replacing `pil`, but `pil` shows up.

I'm not sure where to get a list of all of the current standard packages, but once we had that, we might be able to get the version numbers from `http://www.sagemath.org/packages/upstream/`.



---

archive/issue_comments_219505.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nReplying to [@jhpalmieri](#comment:1):\n> It also looks like `sage --standard` is broken: it is using old package information.\n\nI would say that `sage --standard` is doing the right thing, but somehow `http://www.sagemath.org/packages/standard/` is no longer updated. The right solution is updating the website script to take into account the new git-style packages (which is certainly a different issue than the one this ticket is about).",
    "created_at": "2014-08-04T21:12:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16759#issuecomment-219505",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:2" align="right">comment:2</div>

Replying to [@jhpalmieri](#comment:1):
> It also looks like `sage --standard` is broken: it is using old package information.

I would say that `sage --standard` is doing the right thing, but somehow `http://www.sagemath.org/packages/standard/` is no longer updated. The right solution is updating the website script to take into account the new git-style packages (which is certainly a different issue than the one this ticket is about).



---

archive/issue_comments_219506.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\n...that being said, it makes no sense to work on this ticket if the underlying `sage --standard` command isn't fixed.",
    "created_at": "2014-08-04T21:15:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16759#issuecomment-219506",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:3" align="right">comment:3</div>

...that being said, it makes no sense to work on this ticket if the underlying `sage --standard` command isn't fixed.



---

archive/issue_comments_219507.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nAlong similar lines, does `sage -i` work properly with installing optional packages that have both \"old\" and \"new\" package versions?\n\nBut I agree with William that this is important.  I'm working at a Sage Days prep right now with exactly the kind of people William was talking about in the thread that led to this - people who know quite a bit of math and might want to use some specialized optional package (say, polymake) but would need an awful lot of hand-holding to make it through some of this weird behavior.",
    "created_at": "2014-08-04T23:58:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16759#issuecomment-219507",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:4" align="right">comment:4</div>

Along similar lines, does `sage -i` work properly with installing optional packages that have both "old" and "new" package versions?

But I agree with William that this is important.  I'm working at a Sage Days prep right now with exactly the kind of people William was talking about in the thread that led to this - people who know quite a bit of math and might want to use some specialized optional package (say, polymake) but would need an awful lot of hand-holding to make it through some of this weird behavior.



---

archive/issue_comments_219508.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nHere's an option: turn off `install_package` until we can fix this. See #16760.",
    "created_at": "2014-08-05T01:24:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16759#issuecomment-219508",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:5" align="right">comment:5</div>

Here's an option: turn off `install_package` until we can fix this. See #16760.



---

archive/issue_comments_219509.json:
```json
{
    "body": "Stopgaps: **#16760**",
    "created_at": "2014-08-05T01:24:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16759#issuecomment-219509",
    "user": "https://github.com/jhpalmieri"
}
```

Stopgaps: **#16760**



---

archive/issue_events_239545.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16759#event-239545"
}
```



---

archive/issue_events_239546.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16759#event-239546"
}
```



---

archive/issue_comments_219510.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nThis might be related to the case of the tarball : you use `Pillow-2.2.2.tar.gz`. it turns out that `sage -sh sage-fix-pkg-checksums`, that computes the checksumes, will treat only lower-case-named tarballs ... except on Macs, whose filesystems will find `Pillow-2.2.2.tar.gz` when asked for `pillow-2.2.2.tar.gz`. See #18229 for discussion.\n\nThis is documented in the [Developer's guide](http://www.sagemath.org/doc/developer/packaging.html), paragraph \"Directory structure\", that states :\n\n> \"The build scripts and associated files are in a subdirectory SAGE_ROOT/build/pkgs/package, where you replace package with a lower-case version of the upstream project name.\"\n\nI suppose that the original Pillow porter might have been a Mac user, and that nobody caught the problem.\n\nHTH,",
    "created_at": "2015-04-30T06:13:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16759#issuecomment-219510",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<div id="comment:7" align="right">comment:7</div>

This might be related to the case of the tarball : you use `Pillow-2.2.2.tar.gz`. it turns out that `sage -sh sage-fix-pkg-checksums`, that computes the checksumes, will treat only lower-case-named tarballs ... except on Macs, whose filesystems will find `Pillow-2.2.2.tar.gz` when asked for `pillow-2.2.2.tar.gz`. See #18229 for discussion.

This is documented in the [Developer's guide](http://www.sagemath.org/doc/developer/packaging.html), paragraph "Directory structure", that states :

> "The build scripts and associated files are in a subdirectory SAGE_ROOT/build/pkgs/package, where you replace package with a lower-case version of the upstream project name."

I suppose that the original Pillow porter might have been a Mac user, and that nobody caught the problem.

HTH,



---

archive/issue_comments_219511.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nFrom the `sage-fix-pkg-checksums` script, it looks like the case for the directory name (in `SAGE_ROOT/build/pkgs/`) must match the case for the tarball (except on OS X). Why not change the policy that currently requires the directory to be all lower-case? Would it cause upgrade problems on OS X if we renamed \"pillow\" to \"Pillow\", given the stupid way it deals with case?",
    "created_at": "2015-04-30T16:11:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16759#issuecomment-219511",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:8" align="right">comment:8</div>

From the `sage-fix-pkg-checksums` script, it looks like the case for the directory name (in `SAGE_ROOT/build/pkgs/`) must match the case for the tarball (except on OS X). Why not change the policy that currently requires the directory to be all lower-case? Would it cause upgrade problems on OS X if we renamed "pillow" to "Pillow", given the stupid way it deals with case?



---

archive/issue_comments_219512.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nOr rewrite `sage-fix-pkg-checksums` to convert the tarball to lowercase to determine the directory name. That might be a better choice. \n\n```diff\ndiff --git a/src/bin/sage-fix-pkg-checksums b/src/bin/sage-fix-pkg-checksums\nindex 65542b9..b42463d 100755\n--- a/src/bin/sage-fix-pkg-checksums\n+++ b/src/bin/sage-fix-pkg-checksums\n@@ -11,7 +11,7 @@ fi\n for upstream in \"$@\"\n do\n     tarball=`basename \"$upstream\"`\n-    pkg_name=${tarball%%-*}\n+    pkg_name=`echo ${tarball%%-*} | tr '[:upper:]' '[:lower:]'`\n     pkg_compression=${tarball#*.tar}   # gz or bz2\n     if [ -d \"$SAGE_ROOT/build/pkgs/$pkg_name\" ]; then\n         sage_version=`cat \"$SAGE_ROOT/build/pkgs/$pkg_name/package-version.txt\" | sed 's/\\.p[0-9][0-9]*$//'`\n```\nMaybe print a warning whenever the case is changed, just to be safe?",
    "created_at": "2015-04-30T16:21:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16759#issuecomment-219512",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:9" align="right">comment:9</div>

Or rewrite `sage-fix-pkg-checksums` to convert the tarball to lowercase to determine the directory name. That might be a better choice. 

```diff
diff --git a/src/bin/sage-fix-pkg-checksums b/src/bin/sage-fix-pkg-checksums
index 65542b9..b42463d 100755
--- a/src/bin/sage-fix-pkg-checksums
+++ b/src/bin/sage-fix-pkg-checksums
@@ -11,7 +11,7 @@ fi
 for upstream in "$@"
 do
     tarball=`basename "$upstream"`
-    pkg_name=${tarball%%-*}
+    pkg_name=`echo ${tarball%%-*} | tr '[:upper:]' '[:lower:]'`
     pkg_compression=${tarball#*.tar}   # gz or bz2
     if [ -d "$SAGE_ROOT/build/pkgs/$pkg_name" ]; then
         sage_version=`cat "$SAGE_ROOT/build/pkgs/$pkg_name/package-version.txt" | sed 's/\.p[0-9][0-9]*$//'`
```
Maybe print a warning whenever the case is changed, just to be safe?



---

archive/issue_comments_219513.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nOops, there are more changes required: we need to keep track of `pkg_name` for the directory, and also the version with the original case for use in \n\n```\n            echo \"tarball=$original_pkg_name-VERSION.tar$pkg_compression\" > $checksums\n```",
    "created_at": "2015-04-30T16:23:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16759#issuecomment-219513",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:10" align="right">comment:10</div>

Oops, there are more changes required: we need to keep track of `pkg_name` for the directory, and also the version with the original case for use in 

```
            echo "tarball=$original_pkg_name-VERSION.tar$pkg_compression" > $checksums
```



---

archive/issue_comments_219514.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@jhpalmieri](#comment:8):\nWould you mind joining [this thead](https://groups.google.com/forum/#!topic/sage-devel/2CsisPTWBD8) on sage-devel ? There is not only a (small) technical problem, but also a policy problem, and this thread i probably not the right place to discuss it. In other words, we **know** that at least the `sage-fix-spkg-checksums` script won't work on mixedCase tarballs, and I wonder what will be broken if this script is fixed to accept mixed-case tarball names. Leif thinks that's only a convention, but I am not so sure...\n\nUpdate : Just saw your patch. It fixes the technical problem, but what other holes does it open ?\n\n> From the `sage-fix-pkg-checksums` script, it looks like the case for the directory name (in `SAGE_ROOT/build/pkgs/`) must match the case for the tarball (except on OS X). Why not change the policy that currently requires the directory to be all lower-case? Would it cause upgrade problems on OS X if we renamed \"pillow\" to \"Pillow\", given the stupid way it deals with case?",
    "created_at": "2015-04-30T16:25:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16759#issuecomment-219514",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@jhpalmieri](#comment:8):
Would you mind joining [this thead](https://groups.google.com/forum/#!topic/sage-devel/2CsisPTWBD8) on sage-devel ? There is not only a (small) technical problem, but also a policy problem, and this thread i probably not the right place to discuss it. In other words, we **know** that at least the `sage-fix-spkg-checksums` script won't work on mixedCase tarballs, and I wonder what will be broken if this script is fixed to accept mixed-case tarball names. Leif thinks that's only a convention, but I am not so sure...

Update : Just saw your patch. It fixes the technical problem, but what other holes does it open ?

> From the `sage-fix-pkg-checksums` script, it looks like the case for the directory name (in `SAGE_ROOT/build/pkgs/`) must match the case for the tarball (except on OS X). Why not change the policy that currently requires the directory to be all lower-case? Would it cause upgrade problems on OS X if we renamed "pillow" to "Pillow", given the stupid way it deals with case?



---

archive/issue_comments_219515.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@EmmanuelCharpentier](#comment:11):\n> Update : Just saw your patch. It fixes the technical problem, but what other holes does it open ?\n\nGood question. Since we want to support OS X, we cannot allow different files whose names are the same except for case differences, so we cannot allow different directories `build/Pillow` and `build/PiLlOW`. So I hope it doesn't open any holes. As I suggested, maybe the script should print a warning if there are case differences between the tarball and the directory: \"Note: case mismatch between upstream/Pillow-2.2.2.tar.gz and build/pkgs/pillow.\"",
    "created_at": "2015-04-30T16:36:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16759#issuecomment-219515",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@EmmanuelCharpentier](#comment:11):
> Update : Just saw your patch. It fixes the technical problem, but what other holes does it open ?

Good question. Since we want to support OS X, we cannot allow different files whose names are the same except for case differences, so we cannot allow different directories `build/Pillow` and `build/PiLlOW`. So I hope it doesn't open any holes. As I suggested, maybe the script should print a warning if there are case differences between the tarball and the directory: "Note: case mismatch between upstream/Pillow-2.2.2.tar.gz and build/pkgs/pillow."



---

archive/issue_comments_219516.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nSee #18344.",
    "created_at": "2015-04-30T18:33:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16759#issuecomment-219516",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:13" align="right">comment:13</div>

See #18344.



---

archive/issue_comments_219517.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nI'd keep all (Sage-internal) \"package names\" (i.e., folders) in `build/pkgs/` lowercase.\n\nWe should IMHO simply be more flexible w.r.t. upstream tarballs (their names and also their top-level folders).\n\nThe easiest way to achieve this is to record the upstream tarball's name as well; currently we only have `package-version.txt`, which doesn't contain anything but what we consider the version of the package.\n\nIn the long run, we wouldn't have to rename or modify upstream tarballs (which was the goal anyway), and could even provide the original URL(s) to obtain them, at least as an alternative, and also for documentation purposes.\n\n(There's more data we could move/replicate from `SPKG.txt` into more machine-readable form, finally creating `SPKG.txt` from, or augmenting it with data from other meta-data files, such as authors, copyright, upstream contact/address for bug reports, etc.)",
    "created_at": "2015-05-01T21:50:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16759#issuecomment-219517",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:14" align="right">comment:14</div>

I'd keep all (Sage-internal) "package names" (i.e., folders) in `build/pkgs/` lowercase.

We should IMHO simply be more flexible w.r.t. upstream tarballs (their names and also their top-level folders).

The easiest way to achieve this is to record the upstream tarball's name as well; currently we only have `package-version.txt`, which doesn't contain anything but what we consider the version of the package.

In the long run, we wouldn't have to rename or modify upstream tarballs (which was the goal anyway), and could even provide the original URL(s) to obtain them, at least as an alternative, and also for documentation purposes.

(There's more data we could move/replicate from `SPKG.txt` into more machine-readable form, finally creating `SPKG.txt` from, or augmenting it with data from other meta-data files, such as authors, copyright, upstream contact/address for bug reports, etc.)



---

archive/issue_comments_219518.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@nexttime](#comment:14):\n> I'd keep all (Sage-internal) \"package names\" (i.e., folders) in `build/pkgs/` lowercase.\n\nYes.\n\n> We should IMHO simply be more flexible w.r.t. upstream tarballs (their names and also their top-level folders).\n\nYes.\n\n> The easiest way to achieve this is to record the upstream tarball's name as well; currently we only have `package-version.txt`, which doesn't contain anything but what we consider the version of the package.\n\nThe tarball name (without the version) is stored in `checksums.ini` already.\n\nSee the proposal at #18344. I think that the tarball and the directory name should agree except possibly for case differences. I guess we could allow completely different names for the two, but that would make various parts of the system more complicated: `sage-fix-pkg-checksums`, `sage-spkg`, etc., not to mention making everything more opaque: why should a file `foo.tar.gz` be the right tarball for `build/pkgs/bar`?",
    "created_at": "2015-05-01T22:01:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16759#issuecomment-219518",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@nexttime](#comment:14):
> I'd keep all (Sage-internal) "package names" (i.e., folders) in `build/pkgs/` lowercase.

Yes.

> We should IMHO simply be more flexible w.r.t. upstream tarballs (their names and also their top-level folders).

Yes.

> The easiest way to achieve this is to record the upstream tarball's name as well; currently we only have `package-version.txt`, which doesn't contain anything but what we consider the version of the package.

The tarball name (without the version) is stored in `checksums.ini` already.

See the proposal at #18344. I think that the tarball and the directory name should agree except possibly for case differences. I guess we could allow completely different names for the two, but that would make various parts of the system more complicated: `sage-fix-pkg-checksums`, `sage-spkg`, etc., not to mention making everything more opaque: why should a file `foo.tar.gz` be the right tarball for `build/pkgs/bar`?



---

archive/issue_comments_219519.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@jhpalmieri](#comment:15):\n> The tarball name (without the version) is stored in `checksums.ini` already.\n\nI disregarded M$ Windows files... ;-)",
    "created_at": "2015-05-01T22:43:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16759#issuecomment-219519",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@jhpalmieri](#comment:15):
> The tarball name (without the version) is stored in `checksums.ini` already.

I disregarded M$ Windows files... ;-)



---

archive/issue_comments_219520.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nRelated:\n\n```\n> I tried to install pyopenssl in order to run sagenb in sage 6.6 with\n> secure=True. It fails with Error 404, see below.\n> \n> Regards,\n> \n> CH\n> \n> I get:\n> $ ./sage -i pyopenssl\n> Attempting to download package pyopenssl\n>>>> Checking online list of optional packages.\n> [.]\n>>>> Found pyopenssl-0.13.p0\n>>>> Trying to download http://www.sagemath.org/spkg/optional/pyopenssl-0.13.p0.spkg\n> ....\n> IOError: [Errno 404] Not Found:\n> '//www.sagemath.org/spkg/optional/pyopenssl-0.13.p0.spkg'\n> Error: failed to download package pyopenssl-0.13.p0\n> \n> $ LANG=C wget http://www.sagemath.org/spkg/optional/pyopenssl-0.13.p0.spkg\n> --2015-05-03 16:02:09--\n> http://www.sagemath.org/spkg/optional/pyopenssl-0.13.p0.spkg\n> Resolving www.sagemath.org (www.sagemath.org)... 128.208.178.250\n> Connecting to www.sagemath.org (www.sagemath.org)|128.208.178.250|:80... connected.\n> HTTP request sent, awaiting response... 404 Not Found\n> 2015-05-03 16:02:10 ERROR 404: Not Found.\n\nUnfortunately setting SAGE_SERVER is borked as well (because the mirrors still\nhave 'spkg/', not 'packages/', which the scripts simply ignore), but you could\nuse a mirror \"manually\":\n\n\n  wget http://mirror.switch.ch/mirror/sagemath/spkg/optional/pyopenssl-0.13.p0.spkg\n\n  ./sage -i pyopenssl-0.13.p0.spkg   # Note the extension\n\n```\n\nSetting `SAGE_SERVER` leads into an endless loop: ;-)\n\n```sh\nSAGE_SERVER=\"http://sage.scipy.org/sage/\" ./sage --optional\nUsing Sage Server http://sage.scipy.org/sage/packages\nHTTP Error 404: Not Found\n\n\n\n********************************************************************************\n\n\n\nError contacting http://sage.scipy.org/sage/packages/optional/list. Try using an alternative server.\nFor example, from the bash prompt try typing\n\n   export SAGE_SERVER=http://sage.scipy.org/sage/\n\nthen try again.\n\n\n\n********************************************************************************\n```\n\nThe above [fails for a different reason](http://sage.scipy.org/), but try yourself with some other mirror...",
    "created_at": "2015-05-04T02:03:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16759#issuecomment-219520",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:17" align="right">comment:17</div>

Related:

```
> I tried to install pyopenssl in order to run sagenb in sage 6.6 with
> secure=True. It fails with Error 404, see below.
> 
> Regards,
> 
> CH
> 
> I get:
> $ ./sage -i pyopenssl
> Attempting to download package pyopenssl
>>>> Checking online list of optional packages.
> [.]
>>>> Found pyopenssl-0.13.p0
>>>> Trying to download http://www.sagemath.org/spkg/optional/pyopenssl-0.13.p0.spkg
> ....
> IOError: [Errno 404] Not Found:
> '//www.sagemath.org/spkg/optional/pyopenssl-0.13.p0.spkg'
> Error: failed to download package pyopenssl-0.13.p0
> 
> $ LANG=C wget http://www.sagemath.org/spkg/optional/pyopenssl-0.13.p0.spkg
> --2015-05-03 16:02:09--
> http://www.sagemath.org/spkg/optional/pyopenssl-0.13.p0.spkg
> Resolving www.sagemath.org (www.sagemath.org)... 128.208.178.250
> Connecting to www.sagemath.org (www.sagemath.org)|128.208.178.250|:80... connected.
> HTTP request sent, awaiting response... 404 Not Found
> 2015-05-03 16:02:10 ERROR 404: Not Found.

Unfortunately setting SAGE_SERVER is borked as well (because the mirrors still
have 'spkg/', not 'packages/', which the scripts simply ignore), but you could
use a mirror "manually":


  wget http://mirror.switch.ch/mirror/sagemath/spkg/optional/pyopenssl-0.13.p0.spkg

  ./sage -i pyopenssl-0.13.p0.spkg   # Note the extension

```

Setting `SAGE_SERVER` leads into an endless loop: ;-)

```sh
SAGE_SERVER="http://sage.scipy.org/sage/" ./sage --optional
Using Sage Server http://sage.scipy.org/sage/packages
HTTP Error 404: Not Found



********************************************************************************



Error contacting http://sage.scipy.org/sage/packages/optional/list. Try using an alternative server.
For example, from the bash prompt try typing

   export SAGE_SERVER=http://sage.scipy.org/sage/

then try again.



********************************************************************************
```

The above [fails for a different reason](http://sage.scipy.org/), but try yourself with some other mirror...



---

archive/issue_comments_219521.json:
```json
{
    "body": "Dependencies: **#15642**",
    "created_at": "2015-05-09T15:34:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16759#issuecomment-219521",
    "user": "https://github.com/nexttime"
}
```

Dependencies: **#15642**



---

archive/issue_events_239547.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2015-05-09T15:44:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16759#event-239547"
}
```



---

archive/issue_events_239548.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2015-05-09T15:44:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "milestone_number": null,
    "milestone_title": "sage-6.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16759#event-239548"
}
```



---

archive/issue_comments_219522.json:
```json
{
    "body": "Changed dependencies from **#15642** to **#15642, #18407**",
    "created_at": "2015-05-12T16:11:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16759#issuecomment-219522",
    "user": "https://github.com/nexttime"
}
```

Changed dependencies from **#15642** to **#15642, #18407**



---

archive/issue_comments_219523.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,8 @@\n `install_package()` fails because `standard_packages()` does not parse correctly the output given by the shell command `sage --standard`.\n \n Similar for `optional_packages()` and `experimental_packages`.\n+\n+---\n+\n+The *parsing* issue is now fixed by #18407, but the *logical* issues (cf. [the comment below](#comment:2)) remain to get fixed.\n+\n``````\n",
    "created_at": "2015-05-12T16:18:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16759#issuecomment-219523",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,8 @@
 `install_package()` fails because `standard_packages()` does not parse correctly the output given by the shell command `sage --standard`.
 
 Similar for `optional_packages()` and `experimental_packages`.
+
+---
+
+The *parsing* issue is now fixed by #18407, but the *logical* issues (cf. [the comment below](#comment:2)) remain to get fixed.
+
``````




---

archive/issue_events_239549.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-09-09T11:42:02Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "title_is": "install_package() is obsolete",
    "title_was": "Fix install_package()",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16759#event-239549"
}
```



---

archive/issue_comments_219524.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,8 +1 @@\n-`install_package()` fails because `standard_packages()` does not parse correctly the output given by the shell command `sage --standard`.\n-\n-Similar for `optional_packages()` and `experimental_packages`.\n-\n----\n-\n-The *parsing* issue is now fixed by #18407, but the *logical* issues (cf. [the comment below](#comment:2)) remain to get fixed.\n-\n+Packages should be installed using `sage -i` from a shell, not with the `install_package()` Sage command.\n``````\n",
    "created_at": "2015-09-09T11:42:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16759#issuecomment-219524",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,8 +1 @@
-`install_package()` fails because `standard_packages()` does not parse correctly the output given by the shell command `sage --standard`.
-
-Similar for `optional_packages()` and `experimental_packages`.
-
----
-
-The *parsing* issue is now fixed by #18407, but the *logical* issues (cf. [the comment below](#comment:2)) remain to get fixed.
-
+Packages should be installed using `sage -i` from a shell, not with the `install_package()` Sage command.
``````




---

archive/issue_comments_219525.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nI vote for removing the `install_package()` command. Installing packages from within Sage can never work properly anyway:\n1. for some packages, you need to rebuild the Sage library, which cannot be done in Sage.\n2. some packages might need a change in environment variables (e.g. `ccache`) and that can only be done if `sage-env` is re-run after installing the package.",
    "created_at": "2015-09-09T11:42:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16759#issuecomment-219525",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:22" align="right">comment:22</div>

I vote for removing the `install_package()` command. Installing packages from within Sage can never work properly anyway:
1. for some packages, you need to rebuild the Sage library, which cannot be done in Sage.
2. some packages might need a change in environment variables (e.g. `ccache`) and that can only be done if `sage-env` is re-run after installing the package.



---

archive/issue_comments_219526.json:
```json
{
    "body": "Changed dependencies from **#15642, #18407** to none",
    "created_at": "2015-09-09T11:42:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16759#issuecomment-219526",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#15642, #18407** to none



---

archive/issue_comments_219527.json:
```json
{
    "body": "Branch: **[u/jdemeyer/install_package___is_obsolete](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/install_package___is_obsolete)**",
    "created_at": "2015-09-09T13:43:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16759#issuecomment-219527",
    "user": "https://github.com/jdemeyer"
}
```

Branch: **[u/jdemeyer/install_package___is_obsolete](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/install_package___is_obsolete)**



---

archive/issue_events_239550.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-09-09T13:53:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16759#event-239550"
}
```



---

archive/issue_events_239551.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-09-09T13:53:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16759#event-239551"
}
```



---

archive/issue_comments_219528.json:
```json
{
    "body": "Commit: **[ec6c23a](https://github.com/sagemath/sagetrac-mirror/commit/ec6c23a895a72e46b4920ee08a5de73a3d269791)**",
    "created_at": "2015-09-09T13:53:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16759#issuecomment-219528",
    "user": "https://github.com/jdemeyer"
}
```

Commit: **[ec6c23a](https://github.com/sagemath/sagetrac-mirror/commit/ec6c23a895a72e46b4920ee08a5de73a3d269791)**



---

archive/issue_events_239552.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-09-09T13:53:30Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "milestone_number": null,
    "milestone_title": "sage-6.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16759#event-239552"
}
```



---

archive/issue_events_239553.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-09-09T13:53:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "milestone_number": null,
    "milestone_title": "sage-6.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16759#event-239553"
}
```



---

archive/issue_comments_219529.json:
```json
{
    "body": "<div id=\"comment:24\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ec6c23a895a72e46b4920ee08a5de73a3d269791\">ec6c23a</a></td><td><code>Remove install_package(), document sage -i</code></td></tr></table>\n",
    "created_at": "2015-09-09T13:53:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16759#issuecomment-219529",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:24"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ec6c23a895a72e46b4920ee08a5de73a3d269791">ec6c23a</a></td><td><code>Remove install_package(), document sage -i</code></td></tr></table>




---

archive/issue_events_239554.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-09-09T13:53:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16759#event-239554"
}
```



---

archive/issue_comments_219530.json:
```json
{
    "body": "Author: **Jeroen Demeyer**",
    "created_at": "2015-09-09T13:53:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16759#issuecomment-219530",
    "user": "https://github.com/jdemeyer"
}
```

Author: **Jeroen Demeyer**



---

archive/issue_comments_219531.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n Packages should be installed using `sage -i` from a shell, not with the `install_package()` Sage command.\n+\n+For consistency in error message, we introduce the exception `PackageNotFoundError` which should be used to signal that a package is not installed.\n``````\n",
    "created_at": "2015-09-09T13:54:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16759#issuecomment-219531",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,3 @@
 Packages should be installed using `sage -i` from a shell, not with the `install_package()` Sage command.
+
+For consistency in error message, we introduce the exception `PackageNotFoundError` which should be used to signal that a package is not installed.
``````




---

archive/issue_comments_219532.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n Packages should be installed using `sage -i` from a shell, not with the `install_package()` Sage command.\n \n-For consistency in error message, we introduce the exception `PackageNotFoundError` which should be used to signal that a package is not installed.\n+For consistency in error message, we introduce the exception `PackageNotFoundError` which should be used to signal that a package is not installed. This idea was taken from an existing but unused exception `OptionalPackageNotFoundError` (which is removed).\n``````\n",
    "created_at": "2015-09-09T13:55:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16759#issuecomment-219532",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 Packages should be installed using `sage -i` from a shell, not with the `install_package()` Sage command.
 
-For consistency in error message, we introduce the exception `PackageNotFoundError` which should be used to signal that a package is not installed.
+For consistency in error message, we introduce the exception `PackageNotFoundError` which should be used to signal that a package is not installed. This idea was taken from an existing but unused exception `OptionalPackageNotFoundError` (which is removed).
``````




---

archive/issue_comments_219533.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n Packages should be installed using `sage -i` from a shell, not with the `install_package()` Sage command.\n \n-For consistency in error message, we introduce the exception `PackageNotFoundError` which should be used to signal that a package is not installed. This idea was taken from an existing but unused exception `OptionalPackageNotFoundError` (which is removed).\n+For consistency in error messages, we introduce the exception `PackageNotFoundError` which should be used to signal that a package is not installed. This idea was taken from an existing but unused exception `OptionalPackageNotFoundError` (which is removed).\n``````\n",
    "created_at": "2015-09-09T13:55:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16759#issuecomment-219533",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 Packages should be installed using `sage -i` from a shell, not with the `install_package()` Sage command.
 
-For consistency in error message, we introduce the exception `PackageNotFoundError` which should be used to signal that a package is not installed. This idea was taken from an existing but unused exception `OptionalPackageNotFoundError` (which is removed).
+For consistency in error messages, we introduce the exception `PackageNotFoundError` which should be used to signal that a package is not installed. This idea was taken from an existing but unused exception `OptionalPackageNotFoundError` (which is removed).
``````




---

archive/issue_comments_219534.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nChanneling Nathann: regarding changes like `sage -i cryptominisat && make`, do we need to say something about being in `SAGE_ROOT` first?\n\nThis is no longer a stopgap, so in `misc.package.install_package`, should we be returning some other error message? Maybe `NotImplementedError`? I agree that `install_package('blah')` won't work much of the time for the reasons you give, so a deprecation isn't the right course of action, but a stopgap implies that the situation is temporary and is going to be fixed. This situation may be temporary, but only in the sense that `install_package()` may be completely deleted eventually. Also, with a stopgap, you only get the message the first time you run it. If we raise an error, you will get it every time, which might be better.\n\nI'm not sure if the changes to `trac.py` belong here or on a separate ticket. I don't care that much, though.\n\nAlso, please make the following change (or something similar):\n\n```diff\ndiff --git a/src/sage/misc/package.py b/src/sage/misc/package.py\nindex de4d206..9d727d9 100644\n--- a/src/sage/misc/package.py\n+++ b/src/sage/misc/package.py\n@@ -19,7 +19,7 @@ components:\n Use the :func:``optional_packages`` command to list all\n optional packages available on the central Sage server.\n \n-Actually installing the packages should be done via the Sage command\n+Actually installing the packages should be done via the command\n line, using the following commands:\n \n - ``sage -i PACKAGE_NAME`` -- install the given package\n```\nAlso, the sentences at the top of that file describing Sage packages are outdated and should probably just be replaced with a pointer to the Developer's Guide. If you are willing to do that, too, that would be nice.",
    "created_at": "2015-09-11T22:57:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16759#issuecomment-219534",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:28" align="right">comment:28</div>

Channeling Nathann: regarding changes like `sage -i cryptominisat && make`, do we need to say something about being in `SAGE_ROOT` first?

This is no longer a stopgap, so in `misc.package.install_package`, should we be returning some other error message? Maybe `NotImplementedError`? I agree that `install_package('blah')` won't work much of the time for the reasons you give, so a deprecation isn't the right course of action, but a stopgap implies that the situation is temporary and is going to be fixed. This situation may be temporary, but only in the sense that `install_package()` may be completely deleted eventually. Also, with a stopgap, you only get the message the first time you run it. If we raise an error, you will get it every time, which might be better.

I'm not sure if the changes to `trac.py` belong here or on a separate ticket. I don't care that much, though.

Also, please make the following change (or something similar):

```diff
diff --git a/src/sage/misc/package.py b/src/sage/misc/package.py
index de4d206..9d727d9 100644
--- a/src/sage/misc/package.py
+++ b/src/sage/misc/package.py
@@ -19,7 +19,7 @@ components:
 Use the :func:``optional_packages`` command to list all
 optional packages available on the central Sage server.
 
-Actually installing the packages should be done via the Sage command
+Actually installing the packages should be done via the command
 line, using the following commands:
 
 - ``sage -i PACKAGE_NAME`` -- install the given package
```
Also, the sentences at the top of that file describing Sage packages are outdated and should probably just be replaced with a pointer to the Developer's Guide. If you are willing to do that, too, that would be nice.



---

archive/issue_comments_219535.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nReplying to [@jhpalmieri](#comment:28):\n> Channeling Nathann: regarding changes like `sage -i cryptominisat && make`, do we need to say something about being in `SAGE_ROOT` first?\n\nGood point. I'll replace this by `sage -i cryptominisat sagelib` which doesn't have the `SAGE_ROOT` problem.",
    "created_at": "2015-09-12T07:38:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16759#issuecomment-219535",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:29" align="right">comment:29</div>

Replying to [@jhpalmieri](#comment:28):
> Channeling Nathann: regarding changes like `sage -i cryptominisat && make`, do we need to say something about being in `SAGE_ROOT` first?

Good point. I'll replace this by `sage -i cryptominisat sagelib` which doesn't have the `SAGE_ROOT` problem.



---

archive/issue_comments_219536.json:
```json
{
    "body": "<div id=\"comment:30\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cbf315d4d1623a2200937f4556388de5214566ce\">cbf315d</a></td><td><code>Replace \"make\" by \"sage -i sagelib\"</code></td></tr></table>\n",
    "created_at": "2015-09-12T07:40:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16759#issuecomment-219536",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:30"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cbf315d4d1623a2200937f4556388de5214566ce">cbf315d</a></td><td><code>Replace "make" by "sage -i sagelib"</code></td></tr></table>




---

archive/issue_comments_219537.json:
```json
{
    "body": "Changed commit from **[ec6c23a](https://github.com/sagemath/sagetrac-mirror/commit/ec6c23a895a72e46b4920ee08a5de73a3d269791)** to **[cbf315d](https://github.com/sagemath/sagetrac-mirror/commit/cbf315d4d1623a2200937f4556388de5214566ce)**",
    "created_at": "2015-09-12T07:40:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16759#issuecomment-219537",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[ec6c23a](https://github.com/sagemath/sagetrac-mirror/commit/ec6c23a895a72e46b4920ee08a5de73a3d269791)** to **[cbf315d](https://github.com/sagemath/sagetrac-mirror/commit/cbf315d4d1623a2200937f4556388de5214566ce)**



---

archive/issue_comments_219538.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nReplying to [@jhpalmieri](#comment:28):\n> replaced with a pointer to the Developer's Guide.\n\nI don't think it's technically possible to have an actual link to the Developer's Guide, but I will change the wording.",
    "created_at": "2015-09-12T08:04:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16759#issuecomment-219538",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:31" align="right">comment:31</div>

Replying to [@jhpalmieri](#comment:28):
> replaced with a pointer to the Developer's Guide.

I don't think it's technically possible to have an actual link to the Developer's Guide, but I will change the wording.



---

archive/issue_comments_219539.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nReplying to [@jhpalmieri](#comment:28):\n> I'm not sure if the changes to `trac.py` belong here or on a separate ticket.\n\nIt's really just a deprecation that I added. Pretty innocent.",
    "created_at": "2015-09-12T08:10:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16759#issuecomment-219539",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:32" align="right">comment:32</div>

Replying to [@jhpalmieri](#comment:28):
> I'm not sure if the changes to `trac.py` belong here or on a separate ticket.

It's really just a deprecation that I added. Pretty innocent.



---

archive/issue_comments_219540.json:
```json
{
    "body": "Changed commit from **[cbf315d](https://github.com/sagemath/sagetrac-mirror/commit/cbf315d4d1623a2200937f4556388de5214566ce)** to **[da03be1](https://github.com/sagemath/sagetrac-mirror/commit/da03be13988e41fc483ee2001654a55d4e45ee95)**",
    "created_at": "2015-09-12T08:16:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16759#issuecomment-219540",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[cbf315d](https://github.com/sagemath/sagetrac-mirror/commit/cbf315d4d1623a2200937f4556388de5214566ce)** to **[da03be1](https://github.com/sagemath/sagetrac-mirror/commit/da03be13988e41fc483ee2001654a55d4e45ee95)**



---

archive/issue_comments_219541.json:
```json
{
    "body": "<div id=\"comment:33\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/da03be13988e41fc483ee2001654a55d4e45ee95\">da03be1</a></td><td><code>Replace install_package() by installed_packages()</code></td></tr></table>\n",
    "created_at": "2015-09-12T08:16:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16759#issuecomment-219541",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:33"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/da03be13988e41fc483ee2001654a55d4e45ee95">da03be1</a></td><td><code>Replace install_package() by installed_packages()</code></td></tr></table>




---

archive/issue_comments_219542.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nJohn, I think I made all the changes you proposed.",
    "created_at": "2015-09-12T08:16:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16759#issuecomment-219542",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:34" align="right">comment:34</div>

John, I think I made all the changes you proposed.



---

archive/issue_comments_219543.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nOkay, looks good. What do we do about the files\n\n```\nsrc/doc/en/thematic_tutorials/numerical_sage/installation_linux.rst\nsrc/doc/en/thematic_tutorials/numerical_sage/installation_osx.rst\nsrc/doc/en/thematic_tutorials/numerical_sage/mpi4py.rst\n```\nMaybe I can handle the last one:\n\n```diff\ndiff --git a/src/doc/en/thematic_tutorials/numerical_sage/mpi4py.rst b/src/doc/en/thematic_tutorials/numerical_sage/mpi4py.rst\nindex 93afc85..ef129b1 100644\n--- a/src/doc/en/thematic_tutorials/numerical_sage/mpi4py.rst\n+++ b/src/doc/en/thematic_tutorials/numerical_sage/mpi4py.rst\n@@ -5,22 +5,11 @@ MPI which stands for message passing interface is a common library\n for parallel programming. There is a package mpi4py that builds on\n the top of mpi, and lets arbitrary python objects be passed between\n different processes. These packages are not part of the default\n-sage install. To install them do\n-\n-.. skip\n-\n-::\n-\n-    sage: optional_packages()\n-\n-Find the package name openmpi-\\* and mpi4py-\\*and do\n-\n-.. skip\n+sage install. To install them, from a shell prompt, run\n \n ::\n \n-    sage: install_package('openmpi-*')\n-    sage: install_package('mpi4py-*')\n+    sage -i openmpi mpi4py\n \n Note that openmpi takes a while to compile (15-20 minutes or so).\n Openmpi can be run on a cluster, however this requires some set up\n```\nBut the other two files refer to packages which are now archived (`vtk`) or are archived and almost certainly a bad idea to install (`python-2.5.1-framework`). We can change each instance of `install_package` to `sage -i ...` anyway; I'm not sure what else to suggest.",
    "created_at": "2015-09-12T21:25:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16759#issuecomment-219543",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:35" align="right">comment:35</div>

Okay, looks good. What do we do about the files

```
src/doc/en/thematic_tutorials/numerical_sage/installation_linux.rst
src/doc/en/thematic_tutorials/numerical_sage/installation_osx.rst
src/doc/en/thematic_tutorials/numerical_sage/mpi4py.rst
```
Maybe I can handle the last one:

```diff
diff --git a/src/doc/en/thematic_tutorials/numerical_sage/mpi4py.rst b/src/doc/en/thematic_tutorials/numerical_sage/mpi4py.rst
index 93afc85..ef129b1 100644
--- a/src/doc/en/thematic_tutorials/numerical_sage/mpi4py.rst
+++ b/src/doc/en/thematic_tutorials/numerical_sage/mpi4py.rst
@@ -5,22 +5,11 @@ MPI which stands for message passing interface is a common library
 for parallel programming. There is a package mpi4py that builds on
 the top of mpi, and lets arbitrary python objects be passed between
 different processes. These packages are not part of the default
-sage install. To install them do
-
-.. skip
-
-::
-
-    sage: optional_packages()
-
-Find the package name openmpi-\* and mpi4py-\*and do
-
-.. skip
+sage install. To install them, from a shell prompt, run
 
 ::
 
-    sage: install_package('openmpi-*')
-    sage: install_package('mpi4py-*')
+    sage -i openmpi mpi4py
 
 Note that openmpi takes a while to compile (15-20 minutes or so).
 Openmpi can be run on a cluster, however this requires some set up
```
But the other two files refer to packages which are now archived (`vtk`) or are archived and almost certainly a bad idea to install (`python-2.5.1-framework`). We can change each instance of `install_package` to `sage -i ...` anyway; I'm not sure what else to suggest.



---

archive/issue_comments_219544.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nReplying to [@jhpalmieri](#comment:35):\n> Okay, looks good. What do we do about the files\n> \n> ```\n> src/doc/en/thematic_tutorials/numerical_sage/installation_linux.rst\n> src/doc/en/thematic_tutorials/numerical_sage/installation_osx.rst\n> src/doc/en/thematic_tutorials/numerical_sage/mpi4py.rst\n> ```\n\nI know.... it's difficult. Since I see no sensible way to fix those files, I just left them alone.\n\nThe problem is that those files have a laundry list of old-style packages which are no longer supported. I see no sensible way of updating them, there is no point to replace `install_package(\"foo\")` by `./sage -i foo` if the latter doesn't actually work.",
    "created_at": "2015-09-12T22:20:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16759#issuecomment-219544",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:36" align="right">comment:36</div>

Replying to [@jhpalmieri](#comment:35):
> Okay, looks good. What do we do about the files
> 
> ```
> src/doc/en/thematic_tutorials/numerical_sage/installation_linux.rst
> src/doc/en/thematic_tutorials/numerical_sage/installation_osx.rst
> src/doc/en/thematic_tutorials/numerical_sage/mpi4py.rst
> ```

I know.... it's difficult. Since I see no sensible way to fix those files, I just left them alone.

The problem is that those files have a laundry list of old-style packages which are no longer supported. I see no sensible way of updating them, there is no point to replace `install_package("foo")` by `./sage -i foo` if the latter doesn't actually work.



---

archive/issue_comments_219545.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nHow about this:\n\n```diff\ndiff --git a/src/doc/en/thematic_tutorials/numerical_sage/installation_linux.rst b/src/doc/en/thematic_tutorials/numerical_sage/installation_linux.rst\nindex 16df05f..01ee37f 100644\n--- a/src/doc/en/thematic_tutorials/numerical_sage/installation_linux.rst\n+++ b/src/doc/en/thematic_tutorials/numerical_sage/installation_linux.rst\n@@ -1,6 +1,10 @@\n Installing Visualization Tools on Linux\n =======================================\n \n+.. warning::\n+\n+   The following instructions are outdated (2015-Sep).\n+\n This section assumes you are running linux. You may need\n administrator rights to complete this section. First try\n \ndiff --git a/src/doc/en/thematic_tutorials/numerical_sage/installation_osx.rst b/src/doc/en/thematic_tutorials/numerical_sage/installation_osx.rst\nindex 05c27e8..2c6cec8 100644\n--- a/src/doc/en/thematic_tutorials/numerical_sage/installation_osx.rst\n+++ b/src/doc/en/thematic_tutorials/numerical_sage/installation_osx.rst\n@@ -1,6 +1,11 @@\n Installing Visualization Software on OS X\n =========================================\n \n+\n+.. warning::\n+\n+   The following instructions are outdated (2015-Sep).\n+\n The first thing we need to do is rebuild Python to use OSX's\n frameworks, so that it can create graphical windows. To do this\n first from the terminal do\ndiff --git a/src/doc/en/thematic_tutorials/numerical_sage/mpi4py.rst b/src/doc/en/thematic_tutorials/numerical_sage/mpi4py.rst\nindex 93afc85..98d0edb 100644\n--- a/src/doc/en/thematic_tutorials/numerical_sage/mpi4py.rst\n+++ b/src/doc/en/thematic_tutorials/numerical_sage/mpi4py.rst\n@@ -1,6 +1,11 @@\n mpi4py\n ======\n \n+\n+.. warning::\n+\n+   The following instructions are outdated (2015-Sep).\n+\n MPI which stands for message passing interface is a common library\n for parallel programming. There is a package mpi4py that builds on\n the top of mpi, and lets arbitrary python objects be passed between\n```\nWe can also add a note to contact sage-support for help. What do you think?",
    "created_at": "2015-09-13T02:17:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16759#issuecomment-219545",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:37" align="right">comment:37</div>

How about this:

```diff
diff --git a/src/doc/en/thematic_tutorials/numerical_sage/installation_linux.rst b/src/doc/en/thematic_tutorials/numerical_sage/installation_linux.rst
index 16df05f..01ee37f 100644
--- a/src/doc/en/thematic_tutorials/numerical_sage/installation_linux.rst
+++ b/src/doc/en/thematic_tutorials/numerical_sage/installation_linux.rst
@@ -1,6 +1,10 @@
 Installing Visualization Tools on Linux
 =======================================
 
+.. warning::
+
+   The following instructions are outdated (2015-Sep).
+
 This section assumes you are running linux. You may need
 administrator rights to complete this section. First try
 
diff --git a/src/doc/en/thematic_tutorials/numerical_sage/installation_osx.rst b/src/doc/en/thematic_tutorials/numerical_sage/installation_osx.rst
index 05c27e8..2c6cec8 100644
--- a/src/doc/en/thematic_tutorials/numerical_sage/installation_osx.rst
+++ b/src/doc/en/thematic_tutorials/numerical_sage/installation_osx.rst
@@ -1,6 +1,11 @@
 Installing Visualization Software on OS X
 =========================================
 
+
+.. warning::
+
+   The following instructions are outdated (2015-Sep).
+
 The first thing we need to do is rebuild Python to use OSX's
 frameworks, so that it can create graphical windows. To do this
 first from the terminal do
diff --git a/src/doc/en/thematic_tutorials/numerical_sage/mpi4py.rst b/src/doc/en/thematic_tutorials/numerical_sage/mpi4py.rst
index 93afc85..98d0edb 100644
--- a/src/doc/en/thematic_tutorials/numerical_sage/mpi4py.rst
+++ b/src/doc/en/thematic_tutorials/numerical_sage/mpi4py.rst
@@ -1,6 +1,11 @@
 mpi4py
 ======
 
+
+.. warning::
+
+   The following instructions are outdated (2015-Sep).
+
 MPI which stands for message passing interface is a common library
 for parallel programming. There is a package mpi4py that builds on
 the top of mpi, and lets arbitrary python objects be passed between
```
We can also add a note to contact sage-support for help. What do you think?



---

archive/issue_comments_219546.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nReplying to [@jhpalmieri](#comment:37):\n> We can also add a note to contact sage-support for help. What do you think?\n\nIn order to move forward with this ticket, I made it a separate ticket: #19198",
    "created_at": "2015-09-13T07:32:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16759#issuecomment-219546",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:38" align="right">comment:38</div>

Replying to [@jhpalmieri](#comment:37):
> We can also add a note to contact sage-support for help. What do you think?

In order to move forward with this ticket, I made it a separate ticket: #19198



---

archive/issue_events_239555.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2015-09-13T15:36:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16759#event-239555"
}
```



---

archive/issue_events_239556.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2015-09-13T15:36:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16759#event-239556"
}
```



---

archive/issue_comments_219547.json:
```json
{
    "body": "Reviewer: **John Palmieri**",
    "created_at": "2015-09-13T15:36:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16759#issuecomment-219547",
    "user": "https://github.com/jhpalmieri"
}
```

Reviewer: **John Palmieri**



---

archive/issue_events_239557.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-09-14T19:01:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16759#event-239557"
}
```



---

archive/issue_events_239558.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "ce2b2d57978cce94675128f28617bd22d999b3a0",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2015-09-14T19:01:22Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16759#event-239558"
}
```



---

archive/issue_comments_219548.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/install_package___is_obsolete](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/install_package___is_obsolete)** to **[da03be1](https://github.com/sagemath/sagetrac-mirror/commit/da03be13988e41fc483ee2001654a55d4e45ee95)**",
    "created_at": "2015-09-14T19:01:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16759",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16759#issuecomment-219548",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jdemeyer/install_package___is_obsolete](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/install_package___is_obsolete)** to **[da03be1](https://github.com/sagemath/sagetrac-mirror/commit/da03be13988e41fc483ee2001654a55d4e45ee95)**
