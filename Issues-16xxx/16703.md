# Issue 16703: Fix Mathematica 10 interface

archive/issues_016466.json:
```json
{
    "assignees": [],
    "body": "The interface with Mathematica has been broken since Mathematica 9 came out. \nThe problem is that the program `math` does not behave nicely with expect. \nThis fix uses a wrapper, as suggested in [http://code.activestate.com/recipes/363500-mathematica-with-a-gnu-readline-input/](http://code.activestate.com/recipes/363500-mathematica-with-a-gnu-readline-input/), to make `math` readline-aware. \n\n\nCC:  @sagetrac-jakobkroeker @dimpase\n\nKeywords: **Mathematica, Interfaces**\n\nBranch: **[`c07475f`](https://github.com/sagemath/sagetrac-mirror/commit/c07475f78e4434cfd4424b3c09a502e3db22b323)**\n\nReviewer: **Nathan Dunfield**\n\nAuthor: **Salvatore Stella**\n\nComponent: **scripts**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/16703_\n\n",
    "closed_at": "2015-02-17T20:50:31Z",
    "created_at": "2014-07-22T20:17:56Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20scripts",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Fix Mathematica 10 interface",
    "type": "issue",
    "updated_at": "2015-07-16T09:01:49Z",
    "url": "https://github.com/sagemath/sage/issues/16703",
    "user": "https://github.com/etn40ff"
}
```
The interface with Mathematica has been broken since Mathematica 9 came out. 
The problem is that the program `math` does not behave nicely with expect. 
This fix uses a wrapper, as suggested in [http://code.activestate.com/recipes/363500-mathematica-with-a-gnu-readline-input/](http://code.activestate.com/recipes/363500-mathematica-with-a-gnu-readline-input/), to make `math` readline-aware. 


CC:  @sagetrac-jakobkroeker @dimpase

Keywords: **Mathematica, Interfaces**

Branch: **[`c07475f`](https://github.com/sagemath/sagetrac-mirror/commit/c07475f78e4434cfd4424b3c09a502e3db22b323)**

Reviewer: **Nathan Dunfield**

Author: **Salvatore Stella**

Component: **scripts**

_Issue created by migration from https://trac.sagemath.org/ticket/16703_





---

archive/issue_events_238806.json:
```json
{
    "actor": "https://github.com/etn40ff",
    "created_at": "2014-07-22T20:17:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16703",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16703#event-238806"
}
```



---

archive/issue_events_238807.json:
```json
{
    "actor": "https://github.com/etn40ff",
    "created_at": "2014-07-22T20:17:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16703",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20scripts",
    "label_color": "000080",
    "label_name": "c: scripts",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16703#event-238807"
}
```



---

archive/issue_events_238808.json:
```json
{
    "actor": "https://github.com/etn40ff",
    "created_at": "2014-07-22T20:17:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16703",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16703#event-238808"
}
```



---

archive/issue_events_238809.json:
```json
{
    "actor": "https://github.com/etn40ff",
    "created_at": "2014-07-22T20:17:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16703",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16703#event-238809"
}
```



---

archive/issue_comments_218363.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a15573f863f1133cecafe46e14282d3835ef072a\">a15573f</a></td><td><code>Fix Mathematica interface by passing through readline</code></td></tr></table>\n",
    "created_at": "2014-07-22T20:19:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16703#issuecomment-218363",
    "user": "https://github.com/etn40ff"
}
```

<div id="comment:1"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a15573f863f1133cecafe46e14282d3835ef072a">a15573f</a></td><td><code>Fix Mathematica interface by passing through readline</code></td></tr></table>




---

archive/issue_events_238810.json:
```json
{
    "actor": "https://github.com/etn40ff",
    "created_at": "2014-07-22T20:19:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16703",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16703#event-238810"
}
```



---

archive/issue_comments_218364.json:
```json
{
    "body": "Commit: **[`a15573f`](https://github.com/sagemath/sagetrac-mirror/commit/a15573f863f1133cecafe46e14282d3835ef072a)**",
    "created_at": "2014-07-22T20:19:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16703#issuecomment-218364",
    "user": "https://github.com/etn40ff"
}
```

Commit: **[`a15573f`](https://github.com/sagemath/sagetrac-mirror/commit/a15573f863f1133cecafe46e14282d3835ef072a)**



---

archive/issue_comments_218365.json:
```json
{
    "body": "Branch: **[u/etn40ff/mathematica_10](https://github.com/sagemath/sagetrac-mirror/tree/u/etn40ff/mathematica_10)**",
    "created_at": "2014-07-22T20:19:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16703#issuecomment-218365",
    "user": "https://github.com/etn40ff"
}
```

Branch: **[u/etn40ff/mathematica_10](https://github.com/sagemath/sagetrac-mirror/tree/u/etn40ff/mathematica_10)**



---

archive/issue_comments_218366.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8ac00fceb5cfd764bb0fdbe41bbb269576c06822\">8ac00fc</a></td><td><code>Fix Mathematica interface by passing through readline</code></td></tr></table>\n",
    "created_at": "2014-07-22T20:21:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16703#issuecomment-218366",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:2"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8ac00fceb5cfd764bb0fdbe41bbb269576c06822">8ac00fc</a></td><td><code>Fix Mathematica interface by passing through readline</code></td></tr></table>




---

archive/issue_comments_218367.json:
```json
{
    "body": "Changed commit from **[`a15573f`](https://github.com/sagemath/sagetrac-mirror/commit/a15573f863f1133cecafe46e14282d3835ef072a)** to **[`8ac00fc`](https://github.com/sagemath/sagetrac-mirror/commit/8ac00fceb5cfd764bb0fdbe41bbb269576c06822)**",
    "created_at": "2014-07-22T20:21:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16703#issuecomment-218367",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a15573f`](https://github.com/sagemath/sagetrac-mirror/commit/a15573f863f1133cecafe46e14282d3835ef072a)** to **[`8ac00fc`](https://github.com/sagemath/sagetrac-mirror/commit/8ac00fceb5cfd764bb0fdbe41bbb269576c06822)**



---

archive/issue_comments_218368.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3fe1373cec8e956430521b17ce3996a44283aaba\">3fe1373</a></td><td><code>Fix Mathematica interface by passing through readline</code></td></tr></table>\n",
    "created_at": "2014-07-22T20:28:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16703#issuecomment-218368",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:3"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3fe1373cec8e956430521b17ce3996a44283aaba">3fe1373</a></td><td><code>Fix Mathematica interface by passing through readline</code></td></tr></table>




---

archive/issue_comments_218369.json:
```json
{
    "body": "Changed commit from **[`8ac00fc`](https://github.com/sagemath/sagetrac-mirror/commit/8ac00fceb5cfd764bb0fdbe41bbb269576c06822)** to **[`3fe1373`](https://github.com/sagemath/sagetrac-mirror/commit/3fe1373cec8e956430521b17ce3996a44283aaba)**",
    "created_at": "2014-07-22T20:28:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16703#issuecomment-218369",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`8ac00fc`](https://github.com/sagemath/sagetrac-mirror/commit/8ac00fceb5cfd764bb0fdbe41bbb269576c06822)** to **[`3fe1373`](https://github.com/sagemath/sagetrac-mirror/commit/3fe1373cec8e956430521b17ce3996a44283aaba)**



---

archive/issue_comments_218370.json:
```json
{
    "body": "Changed commit from **[`3fe1373`](https://github.com/sagemath/sagetrac-mirror/commit/3fe1373cec8e956430521b17ce3996a44283aaba)** to **[`43d3ff0`](https://github.com/sagemath/sagetrac-mirror/commit/43d3ff01c97b841e54f9fff604edd519b711dd04)**",
    "created_at": "2014-07-23T19:45:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16703#issuecomment-218370",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3fe1373`](https://github.com/sagemath/sagetrac-mirror/commit/3fe1373cec8e956430521b17ce3996a44283aaba)** to **[`43d3ff0`](https://github.com/sagemath/sagetrac-mirror/commit/43d3ff01c97b841e54f9fff604edd519b711dd04)**



---

archive/issue_comments_218371.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/43d3ff01c97b841e54f9fff604edd519b711dd04\">43d3ff0</a></td><td><code>Removed duplicate code</code></td></tr></table>\n",
    "created_at": "2014-07-23T19:45:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16703#issuecomment-218371",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/43d3ff01c97b841e54f9fff604edd519b711dd04">43d3ff0</a></td><td><code>Removed duplicate code</code></td></tr></table>




---

archive/issue_comments_218372.json:
```json
{
    "body": "<div id=\"comment:5\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c07475f78e4434cfd4424b3c09a502e3db22b323\">c07475f</a></td><td><code>Removed non needed argument from raw_input()</code></td></tr></table>\n",
    "created_at": "2014-07-23T21:20:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16703#issuecomment-218372",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:5"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c07475f78e4434cfd4424b3c09a502e3db22b323">c07475f</a></td><td><code>Removed non needed argument from raw_input()</code></td></tr></table>




---

archive/issue_comments_218373.json:
```json
{
    "body": "Changed commit from **[`43d3ff0`](https://github.com/sagemath/sagetrac-mirror/commit/43d3ff01c97b841e54f9fff604edd519b711dd04)** to **[`c07475f`](https://github.com/sagemath/sagetrac-mirror/commit/c07475f78e4434cfd4424b3c09a502e3db22b323)**",
    "created_at": "2014-07-23T21:20:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16703#issuecomment-218373",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`43d3ff0`](https://github.com/sagemath/sagetrac-mirror/commit/43d3ff01c97b841e54f9fff604edd519b711dd04)** to **[`c07475f`](https://github.com/sagemath/sagetrac-mirror/commit/c07475f78e4434cfd4424b3c09a502e3db22b323)**



---

archive/issue_events_238811.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/16703",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16703#event-238811"
}
```



---

archive/issue_events_238812.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16703",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16703#event-238812"
}
```



---

archive/issue_comments_218374.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nIt seems to me that until the interface is designed properly, it will always have these issues. What is probably the most sensible approach is to use the C interface to Mathematica's published API, called MathLink\n\nhttp://www.wolfram.com/learningcenter/tutorialcollection/MathLinkDevelopmentInC/\n\nlike \"jmath\" uses\n\nhttp://robotics.caltech.edu/~radford/jmath/\n\nSee the \n\nThe total source code for that is under 1000 lines, and makes use of functions like MLInitialize, MLActivate etc. \n\nSure it will take a bit more time to get it right, but it seems to me a better long-term approach. \n\nDave",
    "created_at": "2015-01-31T10:51:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16703#issuecomment-218374",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:8" align="right">comment:8</div>

It seems to me that until the interface is designed properly, it will always have these issues. What is probably the most sensible approach is to use the C interface to Mathematica's published API, called MathLink

http://www.wolfram.com/learningcenter/tutorialcollection/MathLinkDevelopmentInC/

like "jmath" uses

http://robotics.caltech.edu/~radford/jmath/

See the 

The total source code for that is under 1000 lines, and makes use of functions like MLInitialize, MLActivate etc. 

Sure it will take a bit more time to get it right, but it seems to me a better long-term approach. 

Dave



---

archive/issue_comments_218375.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI agree that this is not a good solution: at the time I needed something quick and this was the fastest way I could get it to work. In the long term using MathLink is a better idea but I am not sure there is interest enough in this feature to justify the effort.\n\nS.",
    "created_at": "2015-01-31T15:01:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16703#issuecomment-218375",
    "user": "https://github.com/etn40ff"
}
```

<div id="comment:9" align="right">comment:9</div>

I agree that this is not a good solution: at the time I needed something quick and this was the fastest way I could get it to work. In the long term using MathLink is a better idea but I am not sure there is interest enough in this feature to justify the effort.

S.



---

archive/issue_comments_218376.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nRobert Jacobson indicated he wanted to do this last month\n\nhttps://groups.google.com/forum/#!searchin/sage-devel/Mathematica$20interface|sort:relevance/sage-devel/N4K6lUkUwe0/pKlGj4AfdDcJ\n\nI was the only one to make any comments. Perhaps he might want to complete what he started. \n\nDave",
    "created_at": "2015-01-31T21:03:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16703#issuecomment-218376",
    "user": "https://github.com/sagetrac-drkirkby"
}
```

<div id="comment:10" align="right">comment:10</div>

Robert Jacobson indicated he wanted to do this last month

https://groups.google.com/forum/#!searchin/sage-devel/Mathematica$20interface|sort:relevance/sage-devel/N4K6lUkUwe0/pKlGj4AfdDcJ

I was the only one to make any comments. Perhaps he might want to complete what he started. 

Dave



---

archive/issue_events_238813.json:
```json
{
    "actor": "https://github.com/NathanDunfield",
    "created_at": "2015-02-02T17:47:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16703",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16703#event-238813"
}
```



---

archive/issue_events_238814.json:
```json
{
    "actor": "https://github.com/NathanDunfield",
    "created_at": "2015-02-02T17:47:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16703",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16703#event-238814"
}
```



---

archive/issue_comments_218377.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nI tried out this patch with Mathematica 8, 9, and 10.  It worked fine with all of them, so moving to positive review.  A more robust interface would of course be better, but at least this will mean that the Mathematica interface isn't broken \"out of the box\" as it has been for several years now...",
    "created_at": "2015-02-02T17:47:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16703#issuecomment-218377",
    "user": "https://github.com/NathanDunfield"
}
```

<div id="comment:11" align="right">comment:11</div>

I tried out this patch with Mathematica 8, 9, and 10.  It worked fine with all of them, so moving to positive review.  A more robust interface would of course be better, but at least this will mean that the Mathematica interface isn't broken "out of the box" as it has been for several years now...



---

archive/issue_comments_218378.json:
```json
{
    "body": "Reviewer: **Nathan Dunfield**",
    "created_at": "2015-02-02T17:47:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16703#issuecomment-218378",
    "user": "https://github.com/NathanDunfield"
}
```

Reviewer: **Nathan Dunfield**



---

archive/issue_comments_218379.json:
```json
{
    "body": "Changed branch from **[u/etn40ff/mathematica_10](https://github.com/sagemath/sagetrac-mirror/tree/u/etn40ff/mathematica_10)** to **[`c07475f`](https://github.com/sagemath/sagetrac-mirror/commit/c07475f78e4434cfd4424b3c09a502e3db22b323)**",
    "created_at": "2015-02-17T20:50:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16703#issuecomment-218379",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/etn40ff/mathematica_10](https://github.com/sagemath/sagetrac-mirror/tree/u/etn40ff/mathematica_10)** to **[`c07475f`](https://github.com/sagemath/sagetrac-mirror/commit/c07475f78e4434cfd4424b3c09a502e3db22b323)**



---

archive/issue_events_238815.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-02-17T20:50:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16703",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16703#event-238815"
}
```



---

archive/issue_events_238816.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "b638aee0f33e90802fdb627a79ef49ae454242d7",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2015-02-17T20:50:31Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/16703",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16703#event-238816"
}
```



---

archive/issue_comments_218380.json:
```json
{
    "body": "Changed commit from **[`c07475f`](https://github.com/sagemath/sagetrac-mirror/commit/c07475f78e4434cfd4424b3c09a502e3db22b323)** to none",
    "created_at": "2015-07-13T12:41:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16703#issuecomment-218380",
    "user": "https://github.com/seblabbe"
}
```

Changed commit from **[`c07475f`](https://github.com/sagemath/sagetrac-mirror/commit/c07475f78e4434cfd4424b3c09a502e3db22b323)** to none



---

archive/issue_comments_218381.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nI get failing mathematica doctests (with version 10.0). I created #18888. Do you also get the same failing tests as me?",
    "created_at": "2015-07-13T12:41:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16703#issuecomment-218381",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:13" align="right">comment:13</div>

I get failing mathematica doctests (with version 10.0). I created #18888. Do you also get the same failing tests as me?



---

archive/issue_comments_218382.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nEdit:: I did not realize before posting but I had some issues on my Sage install so my reply was completey wrong; please dirsegard the rest of this comment.\n\nIt looks like the errors are not related to mathematica (at least some of them are not):\n\n```\n$ which math\nmath not found\n$ sage -t --warn-long 2.3 src/sage/symbolic/expression.pyx \nRunning doctests with ID 2015-07-13-16-14-33-bf78acfd.\nGit branch: develop\nUsing --optional=python2,sage,scons\nDoctesting 1 file.\nsage -t --warn-long 2.3 src/sage/symbolic/expression.pyx\n**********************************************************************\nFile \"src/sage/symbolic/expression.pyx\", line 1061, in sage.symbolic.expression.Expression.__int__\nWarning, slow doctest:\n    int(log(8)/log(2))\nTest ran for 3.46 s\n**********************************************************************\nFile \"src/sage/symbolic/expression.pyx\", line 1063, in sage.symbolic.expression.Expression.__int__\nWarning, slow doctest:\n    int(-log(8)/log(2))\nTest ran for 2.46 s\n**********************************************************************\nFile \"src/sage/symbolic/expression.pyx\", line 2385, in sage.symbolic.expression.Expression.__nonzero__\nFailed example:\n    bool(log(2)*Infinity == Infinity)\nExpected:\n    True\nGot:\n    False\n**********************************************************************\nFile \"src/sage/symbolic/expression.pyx\", line 4071, in sage.symbolic.expression.Expression.expand\nFailed example:\n    (c/2*(5*(3*a*b*x*y*p*q)^2)^(7/2*c)).expand()\nExpected:\n    1/2*45^(7/2*c)*(a^2*b^2*x^2*y^2)^(7/2*c)*c*p^(7*c)*q^(7*c)\nGot:\n    1/2*(45*a^2*b^2*p^2*q^2*x^2*y^2)^(7/2*c)*c\n**********************************************************************\nFile \"src/sage/symbolic/expression.pyx\", line 4073, in sage.symbolic.expression.Expression.expand\nFailed example:\n    ((-(-a*x*p)^3*(b*y*p)^3)^(c/2)).expand()\nExpected:\n    (a^3*b^3*x^3*y^3)^(1/2*c)*p^(3*c)\nGot:\n    (a^3*b^3*p^6*x^3*y^3)^(1/2*c)\n**********************************************************************\nFile \"src/sage/symbolic/expression.pyx\", line 5155, in sage.symbolic.expression.Expression._numerical_approx\nWarning, slow doctest:\n    all(len(str(e.n(digits=k)))-1 >= k for k in ks)\nTest ran for 4.45 s\n**********************************************************************\nFile \"src/sage/symbolic/expression.pyx\", line 10884, in sage.symbolic.expression.Expression._plot_fast_callable\nWarning, slow doctest:\n    plot(s)\nTest ran for 2.43 s\n**********************************************************************\n2 items had failures:\n   1 of  70 in sage.symbolic.expression.Expression.__nonzero__\n   2 of  22 in sage.symbolic.expression.Expression.expand\n    [2464 tests, 3 failures, 49.88 s]\n----------------------------------------------------------------------\nsage -t --warn-long 2.3 src/sage/symbolic/expression.pyx  # 3 doctests failed\n----------------------------------------------------------------------\nTotal time for all tests: 50.8 seconds\n    cpu time: 48.0 seconds\n    cumulative wall time: 49.9 seconds\n\n```",
    "created_at": "2015-07-13T14:19:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16703#issuecomment-218382",
    "user": "https://github.com/etn40ff"
}
```

<div id="comment:14" align="right">comment:14</div>

Edit:: I did not realize before posting but I had some issues on my Sage install so my reply was completey wrong; please dirsegard the rest of this comment.

It looks like the errors are not related to mathematica (at least some of them are not):

```
$ which math
math not found
$ sage -t --warn-long 2.3 src/sage/symbolic/expression.pyx 
Running doctests with ID 2015-07-13-16-14-33-bf78acfd.
Git branch: develop
Using --optional=python2,sage,scons
Doctesting 1 file.
sage -t --warn-long 2.3 src/sage/symbolic/expression.pyx
**********************************************************************
File "src/sage/symbolic/expression.pyx", line 1061, in sage.symbolic.expression.Expression.__int__
Warning, slow doctest:
    int(log(8)/log(2))
Test ran for 3.46 s
**********************************************************************
File "src/sage/symbolic/expression.pyx", line 1063, in sage.symbolic.expression.Expression.__int__
Warning, slow doctest:
    int(-log(8)/log(2))
Test ran for 2.46 s
**********************************************************************
File "src/sage/symbolic/expression.pyx", line 2385, in sage.symbolic.expression.Expression.__nonzero__
Failed example:
    bool(log(2)*Infinity == Infinity)
Expected:
    True
Got:
    False
**********************************************************************
File "src/sage/symbolic/expression.pyx", line 4071, in sage.symbolic.expression.Expression.expand
Failed example:
    (c/2*(5*(3*a*b*x*y*p*q)^2)^(7/2*c)).expand()
Expected:
    1/2*45^(7/2*c)*(a^2*b^2*x^2*y^2)^(7/2*c)*c*p^(7*c)*q^(7*c)
Got:
    1/2*(45*a^2*b^2*p^2*q^2*x^2*y^2)^(7/2*c)*c
**********************************************************************
File "src/sage/symbolic/expression.pyx", line 4073, in sage.symbolic.expression.Expression.expand
Failed example:
    ((-(-a*x*p)^3*(b*y*p)^3)^(c/2)).expand()
Expected:
    (a^3*b^3*x^3*y^3)^(1/2*c)*p^(3*c)
Got:
    (a^3*b^3*p^6*x^3*y^3)^(1/2*c)
**********************************************************************
File "src/sage/symbolic/expression.pyx", line 5155, in sage.symbolic.expression.Expression._numerical_approx
Warning, slow doctest:
    all(len(str(e.n(digits=k)))-1 >= k for k in ks)
Test ran for 4.45 s
**********************************************************************
File "src/sage/symbolic/expression.pyx", line 10884, in sage.symbolic.expression.Expression._plot_fast_callable
Warning, slow doctest:
    plot(s)
Test ran for 2.43 s
**********************************************************************
2 items had failures:
   1 of  70 in sage.symbolic.expression.Expression.__nonzero__
   2 of  22 in sage.symbolic.expression.Expression.expand
    [2464 tests, 3 failures, 49.88 s]
----------------------------------------------------------------------
sage -t --warn-long 2.3 src/sage/symbolic/expression.pyx  # 3 doctests failed
----------------------------------------------------------------------
Total time for all tests: 50.8 seconds
    cpu time: 48.0 seconds
    cumulative wall time: 49.9 seconds

```



---

archive/issue_comments_218383.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@seblabbe](#comment:13):\n> I get failing mathematica doctests (with version 10.0). I created #18888. Do you also get the same failing tests as me?\n\nBasically, yes.  See my comment on #18888 for more.",
    "created_at": "2015-07-13T17:31:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16703#issuecomment-218383",
    "user": "https://github.com/NathanDunfield"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@seblabbe](#comment:13):
> I get failing mathematica doctests (with version 10.0). I created #18888. Do you also get the same failing tests as me?

Basically, yes.  See my comment on #18888 for more.



---

archive/issue_comments_218384.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nIn an attempt to run the '#optional - mathematica' doctests automatically (see #18904), we noticed that running 'mathematica(1)' hangs forever when mathematica is not installed. Dima created a ticket for this (#18908), and I post here because it is where `math-readline` was apparently created.\n\nUnless the bug comes from the modification made in #16077.\n\nNathann",
    "created_at": "2015-07-15T15:35:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16703#issuecomment-218384",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:16" align="right">comment:16</div>

In an attempt to run the '#optional - mathematica' doctests automatically (see #18904), we noticed that running 'mathematica(1)' hangs forever when mathematica is not installed. Dima created a ticket for this (#18908), and I post here because it is where `math-readline` was apparently created.

Unless the bug comes from the modification made in #16077.

Nathann



---

archive/issue_comments_218385.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@nathanncohen](#comment:16):\n> In an attempt to run the '#optional - mathematica' doctests automatically (see #18904), we noticed that running 'mathematica(1)' hangs forever when mathematica is not installed. Dima created a ticket for this (#18908), and I post here because it is where `math-readline` was apparently created.\n> \n> Unless the bug comes from the modification made in #16077\n\nno, that wrapper (original or updated) does not check whether `math` can be called.\nAnd it uses obsolete `os.popen` stuff, too...",
    "created_at": "2015-07-15T15:53:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16703#issuecomment-218385",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@nathanncohen](#comment:16):
> In an attempt to run the '#optional - mathematica' doctests automatically (see #18904), we noticed that running 'mathematica(1)' hangs forever when mathematica is not installed. Dima created a ticket for this (#18908), and I post here because it is where `math-readline` was apparently created.
> 
> Unless the bug comes from the modification made in #16077

no, that wrapper (original or updated) does not check whether `math` can be called.
And it uses obsolete `os.popen` stuff, too...



---

archive/issue_comments_218386.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nThis is a quick fix. We should probably use the occasion to rewrite the wrapper without os.popen\n\n```\ndiff --git a/src/bin/math-readline b/src/bin/math-readline\nindex 49a58a1..8175c77 100755\n--- a/src/bin/math-readline\n+++ b/src/bin/math-readline\n@@ -6,6 +6,19 @@\n #    http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/363500\n \n import os, sys\n+\n+installed = False\n+\n+for path in os.environ[\"PATH\"].split(os.pathsep):\n+    path = path.strip('\"')\n+    exe_file = os.path.join(path, 'math')\n+    if os.path.isfile(exe_file) and os.access(exe_file, os.X_OK):\n+        installed = True\n+        break\n+\n+if not installed:\n+    raise RuntimeError(\"Could not find math in the system path.\")\n+\n f1 = os.popen('math ', 'w')\n f1.flush()\n try:\n```",
    "created_at": "2015-07-15T16:01:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16703#issuecomment-218386",
    "user": "https://github.com/etn40ff"
}
```

<div id="comment:18" align="right">comment:18</div>

This is a quick fix. We should probably use the occasion to rewrite the wrapper without os.popen

```
diff --git a/src/bin/math-readline b/src/bin/math-readline
index 49a58a1..8175c77 100755
--- a/src/bin/math-readline
+++ b/src/bin/math-readline
@@ -6,6 +6,19 @@
 #    http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/363500
 
 import os, sys
+
+installed = False
+
+for path in os.environ["PATH"].split(os.pathsep):
+    path = path.strip('"')
+    exe_file = os.path.join(path, 'math')
+    if os.path.isfile(exe_file) and os.access(exe_file, os.X_OK):
+        installed = True
+        break
+
+if not installed:
+    raise RuntimeError("Could not find math in the system path.")
+
 f1 = os.popen('math ', 'w')
 f1.flush()
 try:
```



---

archive/issue_comments_218387.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nI did a little research and it looks like this wrapper is duplicated effort and we should get rid of it. We should be able to call `math` via `rlfe`, which is part of the standard GNU readline implementation, simply as\n\n```\nrfle math\n```\n\nAlternatively there are plenty more, maybe too fancy for our purpose, wrappers like `rlwrap`.",
    "created_at": "2015-07-15T16:35:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16703#issuecomment-218387",
    "user": "https://github.com/etn40ff"
}
```

<div id="comment:19" align="right">comment:19</div>

I did a little research and it looks like this wrapper is duplicated effort and we should get rid of it. We should be able to call `math` via `rlfe`, which is part of the standard GNU readline implementation, simply as

```
rfle math
```

Alternatively there are plenty more, maybe too fancy for our purpose, wrappers like `rlwrap`.



---

archive/issue_comments_218388.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\n> I did a little research and it looks like this wrapper is duplicated effort and we should get rid of it. We should be able to call `math` via `rlfe`, which is part of the standard GNU readline implementation\n\nI don't think`rlfe` is part of Sage currently, and it's not installed by default on Ubuntu or OS X.  While there are many tools available that do the work of the current wrapper, it does have the advantage of being a tiny script with no dependencies other than Python itself.",
    "created_at": "2015-07-15T16:53:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16703#issuecomment-218388",
    "user": "https://github.com/NathanDunfield"
}
```

<div id="comment:20" align="right">comment:20</div>

> I did a little research and it looks like this wrapper is duplicated effort and we should get rid of it. We should be able to call `math` via `rlfe`, which is part of the standard GNU readline implementation

I don't think`rlfe` is part of Sage currently, and it's not installed by default on Ubuntu or OS X.  While there are many tools available that do the work of the current wrapper, it does have the advantage of being a tiny script with no dependencies other than Python itself.



---

archive/issue_comments_218389.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@NathanDunfield](#comment:20):\n> > I did a little research and it looks like this wrapper is duplicated effort and we should get rid of it. We should be able to call `math` via `rlfe`, which is part of the standard GNU readline implementation\n\n> \n> I don't think`rlfe` is part of Sage currently, and it's not installed by default on Ubuntu or OS X.  While there are many tools available that do the work of the current wrapper, it does have the advantage of being a tiny script with no dependencies other than Python itself.  \n\nOk, I guess sticking to the python script is the better option here. Should I write a more modern version or should we use the patch from comment 18? Either option works for me.",
    "created_at": "2015-07-15T16:59:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16703#issuecomment-218389",
    "user": "https://github.com/etn40ff"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@NathanDunfield](#comment:20):
> > I did a little research and it looks like this wrapper is duplicated effort and we should get rid of it. We should be able to call `math` via `rlfe`, which is part of the standard GNU readline implementation

> 
> I don't think`rlfe` is part of Sage currently, and it's not installed by default on Ubuntu or OS X.  While there are many tools available that do the work of the current wrapper, it does have the advantage of being a tiny script with no dependencies other than Python itself.  

Ok, I guess sticking to the python script is the better option here. Should I write a more modern version or should we use the patch from comment 18? Either option works for me.



---

archive/issue_comments_218390.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nlet's move this over to #18908. This ticket is closed, and should stay so.",
    "created_at": "2015-07-16T09:01:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16703#issuecomment-218390",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:22" align="right">comment:22</div>

let's move this over to #18908. This ticket is closed, and should stay so.
