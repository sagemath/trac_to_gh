# Issue 16579: Tides interface

archive/issues_016342.json:
```json
{
    "body": "This implements the generators of the needed .c files to run with tides. See #16578\n\nKeywords: sd59\n\nReviewer: Volker Braun\n\nAuthor: Miguel Marco\n\nBranch: 48e5a6ac043196520f95991b47bcd2557c77b835\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/16579\n\n",
    "closed_at": "2014-07-08T18:51:53Z",
    "created_at": "2014-06-28T05:06:04Z",
    "labels": [
        "component: interfaces"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.3",
    "title": "Tides interface",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16579",
    "user": "https://github.com/miguelmarco"
}
```
This implements the generators of the needed .c files to run with tides. See #16578

Keywords: sd59

Reviewer: Volker Braun

Author: Miguel Marco

Branch: 48e5a6ac043196520f95991b47bcd2557c77b835

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/16579





---

archive/issue_comments_228246.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-06-28T05:18:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16579#issuecomment-228246",
    "user": "https://github.com/miguelmarco"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_228247.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2014-06-28T05:18:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16579#issuecomment-228247",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_228248.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-06-28T07:00:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16579#issuecomment-228248",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_228249.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd59\".",
    "created_at": "2014-06-28T07:40:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16579#issuecomment-228249",
    "user": "https://github.com/miguelmarco"
}
```

Changing keywords from "" to "sd59".



---

archive/issue_comments_228250.json:
```json
{
    "body": "<a id='comment:5'></a>First quick pass\n\n- What is an IVP?\n- Please be more careful with the doc:\n  - symbollic -> symbolic\n  - desored -> desired\n  - paramters -> parameters\n- why did you lazy import `NN`?\n- as trigonometric functions are only used in `subexpressions_list` it would be better to import them only inside the function.\n- Are you sure that `subexpressions_list` must belong to this module?\n- In the function `subexpressions_parameters` the extra argument `parameters` is never tested.\n- You should **never** use an empty list in the definition of a function\n  {{{\n  sage: def f(a=[]): return a\n  sage: a = f()\n  sage: a.append(18)\n  sage: f()\n  [18]\n  }}}\n- why do you use `fast_callable`? There is no introspection directly from the expression?\n\nVincent",
    "created_at": "2014-06-28T18:17:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16579#issuecomment-228250",
    "user": "https://github.com/videlec"
}
```

<a id='comment:5'></a>First quick pass

- What is an IVP?
- Please be more careful with the doc:
  - symbollic -> symbolic
  - desored -> desired
  - paramters -> parameters
- why did you lazy import `NN`?
- as trigonometric functions are only used in `subexpressions_list` it would be better to import them only inside the function.
- Are you sure that `subexpressions_list` must belong to this module?
- In the function `subexpressions_parameters` the extra argument `parameters` is never tested.
- You should **never** use an empty list in the definition of a function
  {{{
  sage: def f(a=[]): return a
  sage: a = f()
  sage: a.append(18)
  sage: f()
  [18]
  }}}
- why do you use `fast_callable`? There is no introspection directly from the expression?

Vincent



---

archive/issue_comments_228251.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2014-06-28T18:17:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16579#issuecomment-228251",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_228252.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-06-28T18:33:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16579#issuecomment-228252",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_228253.json:
```json
{
    "body": "<a id='comment:7'></a>- What is an IVP?\nAn inital value problem. Clarified in the documentation now.\n\n- Please be more careful with the doc:\nchecked.\n\n- why did you lazy import NN?\nsorry about that, at some point this code was in desolvers, that was automatically loaded and produced a circular dependency error at startup\n\n- as trigonometric functions are only used in subexpressions_list it would be better to import them only inside the function.\nThanks, changed.\n\n- Are you sure that subexpressions_list must belong to this module?\nI wrote it for this specific purpose (in fact it was originally inside the code of the generator_.. functions), but i am open to suggestions. Where would it fit better?\n\n- In the function subexpressions_parameters the extra argument parameters is never tested.\nAdded a doctest for that.\n\n- You should never use an empty list in the definition of a function\nups, you are right, took care of that.\n\n- why do you use fast_callable? There is no introspection directly from the expression?\nfast_callable does the job of deciding the correct order for the operations to be properly executed. Doing that directly from the expression tree is possible (and maybe not hard), but also not trivial.",
    "created_at": "2014-06-28T18:56:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16579#issuecomment-228253",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:7'></a>- What is an IVP?
An inital value problem. Clarified in the documentation now.

- Please be more careful with the doc:
checked.

- why did you lazy import NN?
sorry about that, at some point this code was in desolvers, that was automatically loaded and produced a circular dependency error at startup

- as trigonometric functions are only used in subexpressions_list it would be better to import them only inside the function.
Thanks, changed.

- Are you sure that subexpressions_list must belong to this module?
I wrote it for this specific purpose (in fact it was originally inside the code of the generator_.. functions), but i am open to suggestions. Where would it fit better?

- In the function subexpressions_parameters the extra argument parameters is never tested.
Added a doctest for that.

- You should never use an empty list in the definition of a function
ups, you are right, took care of that.

- why do you use fast_callable? There is no introspection directly from the expression?
fast_callable does the job of deciding the correct order for the operations to be properly executed. Doing that directly from the expression tree is possible (and maybe not hard), but also not trivial.



---

archive/issue_comments_228254.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-06-28T18:57:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16579#issuecomment-228254",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_228255.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2014-06-28T19:51:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16579#issuecomment-228255",
    "user": "https://github.com/miguelmarco"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_228256.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-06-29T18:38:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16579#issuecomment-228256",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_228257.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-07-01T18:39:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16579#issuecomment-228257",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_048652.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-07-08T18:51:53Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16579",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16579#event-48652"
}
```



---

archive/issue_comments_228258.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-07-08T18:51:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16579#issuecomment-228258",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_228259.json:
```json
{
    "body": "<a id='comment:16'></a>In `genfiles_mpfr()`, what's the point of all these\n\n```\nN(parameter_values[i],digits=dig)\n```\nwhy not simply\n\n```\nparameter_values[i]\n```\nI'm making this change at #16025.",
    "created_at": "2014-10-16T18:21:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16579#issuecomment-228259",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>In `genfiles_mpfr()`, what's the point of all these

```
N(parameter_values[i],digits=dig)
```
why not simply

```
parameter_values[i]
```
I'm making this change at #16025.



---

archive/issue_comments_228260.json:
```json
{
    "body": "<a id='comment:17'></a>IIRC we decided to force the number of digits of the output because mpfr_set_str requires a string with all the digits.\n\nThat is, if we are working with 10 digits of precision, we need to write 0.5 as 0.5000000000.",
    "created_at": "2014-10-16T20:48:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16579#issuecomment-228260",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:17'></a>IIRC we decided to force the number of digits of the output because mpfr_set_str requires a string with all the digits.

That is, if we are working with 10 digits of precision, we need to write 0.5 as 0.5000000000.



---

archive/issue_comments_228261.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [comment:17 mmarco]:\n> `mpfr_set_str` requires a string with all the digits.\n\nI'm pretty sure that this is not true. `mpfr_set_str()` is what Sage uses to create `RealNumber`s from strings and that works with any number of digits.",
    "created_at": "2014-10-16T20:54:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16579#issuecomment-228261",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:18'></a>Replying to [comment:17 mmarco]:
> `mpfr_set_str` requires a string with all the digits.

I'm pretty sure that this is not true. `mpfr_set_str()` is what Sage uses to create `RealNumber`s from strings and that works with any number of digits.



---

archive/issue_comments_228262.json:
```json
{
    "body": "<a id='comment:19'></a>MPFR documentation states that \"Contrary to mpfr_strtofr, mpfr_set_str requires the whole string to represent a valid floating-point number\"\n\nAnyways i will ask the tides developpers about this. Maybe there are some reasons that i am missing.",
    "created_at": "2014-10-16T21:25:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16579#issuecomment-228262",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:19'></a>MPFR documentation states that "Contrary to mpfr_strtofr, mpfr_set_str requires the whole string to represent a valid floating-point number"

Anyways i will ask the tides developpers about this. Maybe there are some reasons that i am missing.



---

archive/issue_comments_228263.json:
```json
{
    "body": "<a id='comment:20'></a>Replying to [comment:19 mmarco]:\n> MPFR documentation states that \"Contrary to mpfr_strtofr, mpfr_set_str requires the whole string to represent a valid floating-point number\"\n\nSure, but `\"1\"` or `\"1.0\"` are valid floating point numbers just like `\"1.00000000000000000000\"`.",
    "created_at": "2014-10-17T05:45:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16579#issuecomment-228263",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'></a>Replying to [comment:19 mmarco]:
> MPFR documentation states that "Contrary to mpfr_strtofr, mpfr_set_str requires the whole string to represent a valid floating-point number"

Sure, but `"1"` or `"1.0"` are valid floating point numbers just like `"1.00000000000000000000"`.



---

archive/issue_comments_228264.json:
```json
{
    "body": "<a id='comment:21'></a>Maybe i am understanding it in the wrong way, but as i get it, the sentence states that \"1.0\" will create a floating point number with less precission than \"1.0000000\".\n\nIn any case, we could check it using desolve_tides_mpfr (#16581) and compare the results with and without the change. A doctest should be added there in any case.",
    "created_at": "2014-10-17T08:09:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16579#issuecomment-228264",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:21'></a>Maybe i am understanding it in the wrong way, but as i get it, the sentence states that "1.0" will create a floating point number with less precission than "1.0000000".

In any case, we could check it using desolve_tides_mpfr (#16581) and compare the results with and without the change. A doctest should be added there in any case.



---

archive/issue_comments_228265.json:
```json
{
    "body": "<a id='comment:22'></a>Replying to [comment:21 mmarco]:\n> Maybe i am understanding it in the wrong way, but as i get it, the sentence states that \"1.0\" will create a floating point number with less precission than \"1.0000000\".\n\nThat's not what it says. The precision in MPFR is a property of the number, the input doesn't matter.",
    "created_at": "2014-10-17T08:18:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16579#issuecomment-228265",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'></a>Replying to [comment:21 mmarco]:
> Maybe i am understanding it in the wrong way, but as i get it, the sentence states that "1.0" will create a floating point number with less precission than "1.0000000".

That's not what it says. The precision in MPFR is a property of the number, the input doesn't matter.



---

archive/issue_comments_228266.json:
```json
{
    "body": "<a id='comment:23'></a>Hello jdemeyer. I'm also a developer of sagetides, as well as a tides developer.\nYou are right with mpfr. From the very beginning we preset the number of digits (binary or decimal) and all the floating point variables of the code stores numbers of the same binary size.\n\n\nWe wrote 'N(parameter, digits = dig)' because, otherwise sage writes to text either the algebraic representation of the number (eg pi) or an insufficient floating point approximation.\n\nHowever, using string representation, it is the same computational effort parsing 0.10 0.100 or 0.1000000000, cause they have no exact representation. I personally prefer long strings because it is more clear for me to read so. I use sage as preprocessor to obtain C code to work with and edit it outside sage environmet.\n\nI hope this can clarify a bit the ticket.",
    "created_at": "2014-10-17T18:28:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16579#issuecomment-228266",
    "user": "https://trac.sagemath.org/admin/accounts/users/iMark"
}
```

<a id='comment:23'></a>Hello jdemeyer. I'm also a developer of sagetides, as well as a tides developer.
You are right with mpfr. From the very beginning we preset the number of digits (binary or decimal) and all the floating point variables of the code stores numbers of the same binary size.


We wrote 'N(parameter, digits = dig)' because, otherwise sage writes to text either the algebraic representation of the number (eg pi) or an insufficient floating point approximation.

However, using string representation, it is the same computational effort parsing 0.10 0.100 or 0.1000000000, cause they have no exact representation. I personally prefer long strings because it is more clear for me to read so. I use sage as preprocessor to obtain C code to work with and edit it outside sage environmet.

I hope this can clarify a bit the ticket.



---

archive/issue_comments_228267.json:
```json
{
    "body": "<a id='comment:24'></a>Replying to [comment:23 iMark]:\n> We wrote 'N(parameter, digits = dig)' because, otherwise sage writes to text either the algebraic representation of the number\n\nIf that is the reason, this should be\n1) documented\n2) tested in a doctest",
    "created_at": "2014-10-17T18:31:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16579#issuecomment-228267",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:24'></a>Replying to [comment:23 iMark]:
> We wrote 'N(parameter, digits = dig)' because, otherwise sage writes to text either the algebraic representation of the number

If that is the reason, this should be
1) documented
2) tested in a doctest



---

archive/issue_comments_228268.json:
```json
{
    "body": "<a id='comment:25'></a>Ok, i will open a ticket for that.",
    "created_at": "2014-10-17T19:39:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16579#issuecomment-228268",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:25'></a>Ok, i will open a ticket for that.



---

archive/issue_comments_228269.json:
```json
{
    "body": "<a id='comment:26'></a>This is now #17179",
    "created_at": "2014-10-19T21:18:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16579#issuecomment-228269",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:26'></a>This is now #17179
