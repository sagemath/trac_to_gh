# Issue 16455: Update zeromq and pyzmq to recent version and new git layout

archive/issues_016218.json:
```json
{
    "body": "The packages zero an pyzmq are required to let IPython notebook work within Sage. There seems to be a [consensus](https://groups.google.com/forum/#!topic/sage-devel/TbjumtvzCM0) to have those as standard packages. See also #16053.\n\nThe upstream tarballs can be found at : \n- http://download.zeromq.org/zeromq-4.0.4.tar.gz\n- https://pypi.python.org/packages/source/p/pyzmq/pyzmq-14.3.0.tar.gz\n\n\n**CC:**  @seblabbe @vbraun @williamstein @dimpase\n\n**Keywords:** ipython\n\n**Branch:** [184da0c30ccdd81b3d1c0c70ff3590ca14b3446a](https://github.com/sagemath/sagetrac-mirror/commit/184da0c30ccdd81b3d1c0c70ff3590ca14b3446a)\n\n**Reviewer:** S\u00e9bastien Labb\u00e9\n\n**Author:** Thierry Monteil\n\nIssue created by migration from https://trac.sagemath.org/ticket/16455\n\n",
    "closed_at": "2014-06-18T12:00:20Z",
    "created_at": "2014-06-07T13:39:25Z",
    "labels": [
        "component: packages: optional",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.3",
    "title": "Update zeromq and pyzmq to recent version and new git layout",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16455",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```
The packages zero an pyzmq are required to let IPython notebook work within Sage. There seems to be a [consensus](https://groups.google.com/forum/#!topic/sage-devel/TbjumtvzCM0) to have those as standard packages. See also #16053.

The upstream tarballs can be found at : 
- http://download.zeromq.org/zeromq-4.0.4.tar.gz
- https://pypi.python.org/packages/source/p/pyzmq/pyzmq-14.3.0.tar.gz


**CC:**  @seblabbe @vbraun @williamstein @dimpase

**Keywords:** ipython

**Branch:** [184da0c30ccdd81b3d1c0c70ff3590ca14b3446a](https://github.com/sagemath/sagetrac-mirror/commit/184da0c30ccdd81b3d1c0c70ff3590ca14b3446a)

**Reviewer:** Sébastien Labbé

**Author:** Thierry Monteil

Issue created by migration from https://trac.sagemath.org/ticket/16455





---

archive/issue_comments_260274.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,2 @@\n+The packages zero an pyzmq are required to let IPython notebook work within Sage. There seems to be a [consensus](https://groups.google.com/forum/#!topic/sage-devel/TbjumtvzCM0) to have those as standard packages. See also #16053.\n \n``````\n",
    "created_at": "2014-06-07T13:47:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16455#issuecomment-260274",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,2 @@
+The packages zero an pyzmq are required to let IPython notebook work within Sage. There seems to be a [consensus](https://groups.google.com/forum/#!topic/sage-devel/TbjumtvzCM0) to have those as standard packages. See also #16053.
 
``````




---

archive/issue_comments_260275.json:
```json
{
    "body": "**Branch:** [u/tmonteil/update_zeromq_and_pyzmq_to_recent_version_and_new_git_layout](https://github.com/sagemath/sagetrac-mirror/tree/u/tmonteil/update_zeromq_and_pyzmq_to_recent_version_and_new_git_layout)",
    "created_at": "2014-06-07T14:11:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16455#issuecomment-260275",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

**Branch:** [u/tmonteil/update_zeromq_and_pyzmq_to_recent_version_and_new_git_layout](https://github.com/sagemath/sagetrac-mirror/tree/u/tmonteil/update_zeromq_and_pyzmq_to_recent_version_and_new_git_layout)



---

archive/issue_comments_260276.json:
```json
{
    "body": "<a id='comment:3'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/524b2d2b214cee5efbda50cca468c258b03e2db5\">524b2d2</a></td><td><code>#16455 : pyzmq new git layout + update to version 14.3.0 + remove old-style-spkg changelog + update buildutils patch.</code></td></tr></table>\n",
    "created_at": "2014-06-07T14:57:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16455#issuecomment-260276",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/524b2d2b214cee5efbda50cca468c258b03e2db5">524b2d2</a></td><td><code>#16455 : pyzmq new git layout + update to version 14.3.0 + remove old-style-spkg changelog + update buildutils patch.</code></td></tr></table>




---

archive/issue_comments_260277.json:
```json
{
    "body": "**Commit:** [524b2d2b214cee5efbda50cca468c258b03e2db5](https://github.com/sagemath/sagetrac-mirror/commit/524b2d2b214cee5efbda50cca468c258b03e2db5)",
    "created_at": "2014-06-07T14:57:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16455#issuecomment-260277",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Commit:** [524b2d2b214cee5efbda50cca468c258b03e2db5](https://github.com/sagemath/sagetrac-mirror/commit/524b2d2b214cee5efbda50cca468c258b03e2db5)



---

archive/issue_events_054625.json:
```json
{
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/16455",
    "label": "component: packages: standard",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16455#event-54625"
}
```



---

archive/issue_comments_260278.json:
```json
{
    "body": "<a id='comment:4'></a>\nSebastien, i modified the patch that could not be applied anymore, please can you check whether this still works on Darwin ?",
    "created_at": "2014-06-07T15:04:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16455#issuecomment-260278",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:4'></a>
Sebastien, i modified the patch that could not be applied anymore, please can you check whether this still works on Darwin ?



---

archive/issue_comments_260279.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"ipython\".",
    "created_at": "2014-06-07T15:04:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16455#issuecomment-260279",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

**Changing keywords** from "" to "ipython".



---

archive/issue_comments_260280.json:
```json
{
    "body": "**Author:** Thierry Monteil",
    "created_at": "2014-06-07T15:04:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16455#issuecomment-260280",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

**Author:** Thierry Monteil



---

archive/issue_comments_260281.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,2 +1,6 @@\n The packages zero an pyzmq are required to let IPython notebook work within Sage. There seems to be a [consensus](https://groups.google.com/forum/#!topic/sage-devel/TbjumtvzCM0) to have those as standard packages. See also #16053.\n \n+The upstream tarballs can be found at : \n+- http://download.zeromq.org/zeromq-4.0.4.tar.gz\n+- https://pypi.python.org/packages/source/p/pyzmq/pyzmq-14.3.0.tar.gz\n+\n``````\n",
    "created_at": "2014-06-07T15:04:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16455#issuecomment-260281",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,2 +1,6 @@
 The packages zero an pyzmq are required to let IPython notebook work within Sage. There seems to be a [consensus](https://groups.google.com/forum/#!topic/sage-devel/TbjumtvzCM0) to have those as standard packages. See also #16053.
 
+The upstream tarballs can be found at : 
+- http://download.zeromq.org/zeromq-4.0.4.tar.gz
+- https://pypi.python.org/packages/source/p/pyzmq/pyzmq-14.3.0.tar.gz
+
``````




---

archive/issue_comments_260282.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2014-06-07T15:04:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16455#issuecomment-260282",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_260283.json:
```json
{
    "body": "<a id='comment:5'></a>\nFor what it is worth, I strongly support including IPython notebook (and deps) in Sage standard.  -- William",
    "created_at": "2014-06-07T16:08:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16455#issuecomment-260283",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:5'></a>
For what it is worth, I strongly support including IPython notebook (and deps) in Sage standard.  -- William



---

archive/issue_comments_260284.json:
```json
{
    "body": "<a id='comment:6'></a>\nI get this after installing your branch :\n\n```\n10 slabbe@pol ~/Applications/sage-review $ ./sage -f http://download.zeromq.org/zeromq-4.0.4.tar.gz\nAttempting to download package zeromq-4.0.4.tar.gz\n>>> Trying to download http://download.zeromq.org/zeromq-4.0.4.tar.gz\n[............................................................]\nzeromq-4.0.4.tar.gz\n====================================================\nExtracting package /Users/slabbe/Applications/sage-review/upstream/zeromq-4.0.4.tar.gz\n-rw-r--r--  1 slabbe  staff  2149732 Jun 10 08:55 /Users/slabbe/Applications/sage-review/upstream/zeromq-4.0.4.tar.gz\nFinished extraction\n/Users/slabbe/Applications/sage-review/src/bin/sage-spkg: line 594: cd: zeromq-4.0.4.tar.gz: No such file or directory\nError: after extracting, the directory zeromq-4.0.4.tar.gz does not exist\n```",
    "created_at": "2014-06-10T06:58:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16455#issuecomment-260284",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:6'></a>
I get this after installing your branch :

```
10 slabbe@pol ~/Applications/sage-review $ ./sage -f http://download.zeromq.org/zeromq-4.0.4.tar.gz
Attempting to download package zeromq-4.0.4.tar.gz
>>> Trying to download http://download.zeromq.org/zeromq-4.0.4.tar.gz
[............................................................]
zeromq-4.0.4.tar.gz
====================================================
Extracting package /Users/slabbe/Applications/sage-review/upstream/zeromq-4.0.4.tar.gz
-rw-r--r--  1 slabbe  staff  2149732 Jun 10 08:55 /Users/slabbe/Applications/sage-review/upstream/zeromq-4.0.4.tar.gz
Finished extraction
/Users/slabbe/Applications/sage-review/src/bin/sage-spkg: line 594: cd: zeromq-4.0.4.tar.gz: No such file or directory
Error: after extracting, the directory zeromq-4.0.4.tar.gz does not exist
```



---

archive/issue_comments_260285.json:
```json
{
    "body": "<a id='comment:7'></a>\nThe tarball you found at `http://download.zeromq.org/zeromq-4.0.4.tar.gz` is not a sage package, it is the source code of zeromq. You have to put this tarball on your `/Users/slabbe/Applications/sage-review/upstream/` directory, and then do `./sage -f zeromq`.",
    "created_at": "2014-06-10T09:07:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16455#issuecomment-260285",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:7'></a>
The tarball you found at `http://download.zeromq.org/zeromq-4.0.4.tar.gz` is not a sage package, it is the source code of zeromq. You have to put this tarball on your `/Users/slabbe/Applications/sage-review/upstream/` directory, and then do `./sage -f zeromq`.



---

archive/issue_comments_260286.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [tmonteil](#comment%3A7):\n> The tarball you found at `http://download.zeromq.org/zeromq-4.0.4.tar.gz` is not a sage package, it is the source code of zeromq. You have to put this tarball on your `/Users/slabbe/Applications/sage-review/upstream/` directory, and then do `./sage -f zeromq`.\n\n\nBut the above put the tarball in the upstream directory. So that means I can do :\n\n```\n./sage -i http://download.zeromq.org/zeromq-4.0.4.tar.gz   # download in upstream\n./sage -i zeromq\n```",
    "created_at": "2014-06-10T09:16:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16455#issuecomment-260286",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:8'></a>
Replying to [tmonteil](#comment%3A7):
> The tarball you found at `http://download.zeromq.org/zeromq-4.0.4.tar.gz` is not a sage package, it is the source code of zeromq. You have to put this tarball on your `/Users/slabbe/Applications/sage-review/upstream/` directory, and then do `./sage -f zeromq`.


But the above put the tarball in the upstream directory. So that means I can do :

```
./sage -i http://download.zeromq.org/zeromq-4.0.4.tar.gz   # download in upstream
./sage -i zeromq
```



---

archive/issue_comments_260287.json:
```json
{
    "body": "<a id='comment:9'></a>\nThe first command will lead to an error, since it not only tries to download the tarball in upstream/, but also tries to install it as a sage spkg, explaining your error, hence you should consider using wget ot curl for that part of the review. Of course, once the ticket is merged, there is no need to download the tarball manually since sage will find it at http://sagemath.org/packages/upstream/\n\nThat said, after that error, the second command should work, since zeromq-4.0.4.tar.gz is now in the upstream/ directory.",
    "created_at": "2014-06-10T09:26:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16455#issuecomment-260287",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:9'></a>
The first command will lead to an error, since it not only tries to download the tarball in upstream/, but also tries to install it as a sage spkg, explaining your error, hence you should consider using wget ot curl for that part of the review. Of course, once the ticket is merged, there is no need to download the tarball manually since sage will find it at http://sagemath.org/packages/upstream/

That said, after that error, the second command should work, since zeromq-4.0.4.tar.gz is now in the upstream/ directory.



---

archive/issue_comments_260288.json:
```json
{
    "body": "<a id='comment:10'></a>\nOk, so I just tested and it does work on my machine. I also managed to open the ipython notebook with these.\n\nI also tested without the buildutils patch on pyzmq, and `sage -i pyzmq` also worked. Indeed, I remembered I read somewhere (maybe on sage-devel) that my patch was now useless since the problem was fixed in a later release... I tried to find where I read that, but I was not able.",
    "created_at": "2014-06-10T09:28:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16455#issuecomment-260288",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:10'></a>
Ok, so I just tested and it does work on my machine. I also managed to open the ipython notebook with these.

I also tested without the buildutils patch on pyzmq, and `sage -i pyzmq` also worked. Indeed, I remembered I read somewhere (maybe on sage-devel) that my patch was now useless since the problem was fixed in a later release... I tried to find where I read that, but I was not able.



---

archive/issue_comments_260289.json:
```json
{
    "body": "<a id='comment:11'></a>\nOK, once you confirm that the patch is not needed anymore, i will remove it from the branch.",
    "created_at": "2014-06-10T09:34:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16455#issuecomment-260289",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:11'></a>
OK, once you confirm that the patch is not needed anymore, i will remove it from the branch.



---

archive/issue_comments_260290.json:
```json
{
    "body": "<a id='comment:12'></a>\nWith the following modifications:\n\n```\n~/Applications/sage-review $ git diff\ndiff --git a/build/pkgs/pyzmq/spkg-install b/build/pkgs/pyzmq/spkg-install\nindex c7e1216..269f055 100755\n--- a/build/pkgs/pyzmq/spkg-install\n+++ b/build/pkgs/pyzmq/spkg-install\n@@ -13,16 +13,6 @@ echo \"include_dirs = $SAGE_LOCAL/include/\" >> src/setup.cfg\n \n cd src\n \n-# Apply patches.  See SPKG.txt for information about what each patch\n-# does.\n-for patch in ../patches/*.patch; do\n-    patch -p1 <\"$patch\"\n-    if [ $? -ne 0 ]; then\n-        echo >&2 \"Error applying '$patch'\"\n-        exit 1\n-    fi\n-done\n-\n # Configure and install\n python setup.py configure --zmq=\"$SAGE_LOCAL\"\n python setup.py install\n```\n\nI confirm that it works:\n\n```\n./sage -f pyzmq\nFound local metadata for pyzmq-14.3.0\n\n[...]\n\nSuccessfully installed pyzmq-14.3.0\nDeleting temporary build directory\nFinished installing pyzmq-14.3.0.spkg\n```",
    "created_at": "2014-06-10T09:46:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16455#issuecomment-260290",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:12'></a>
With the following modifications:

```
~/Applications/sage-review $ git diff
diff --git a/build/pkgs/pyzmq/spkg-install b/build/pkgs/pyzmq/spkg-install
index c7e1216..269f055 100755
--- a/build/pkgs/pyzmq/spkg-install
+++ b/build/pkgs/pyzmq/spkg-install
@@ -13,16 +13,6 @@ echo "include_dirs = $SAGE_LOCAL/include/" >> src/setup.cfg
 
 cd src
 
-# Apply patches.  See SPKG.txt for information about what each patch
-# does.
-for patch in ../patches/*.patch; do
-    patch -p1 <"$patch"
-    if [ $? -ne 0 ]; then
-        echo >&2 "Error applying '$patch'"
-        exit 1
-    fi
-done
-
 # Configure and install
 python setup.py configure --zmq="$SAGE_LOCAL"
 python setup.py install
```

I confirm that it works:

```
./sage -f pyzmq
Found local metadata for pyzmq-14.3.0

[...]

Successfully installed pyzmq-14.3.0
Deleting temporary build directory
Finished installing pyzmq-14.3.0.spkg
```



---

archive/issue_comments_260291.json:
```json
{
    "body": "<a id='comment:13'></a>\nremove the patch for pyzmq",
    "created_at": "2014-06-10T09:47:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16455#issuecomment-260291",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:13'></a>
remove the patch for pyzmq



---

archive/issue_comments_260292.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2014-06-10T09:47:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16455#issuecomment-260292",
    "user": "https://github.com/seblabbe"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_260293.json:
```json
{
    "body": "**Changing commit** from \"[524b2d2b214cee5efbda50cca468c258b03e2db5](https://github.com/sagemath/sagetrac-mirror/commit/524b2d2b214cee5efbda50cca468c258b03e2db5)\" to \"[184da0c30ccdd81b3d1c0c70ff3590ca14b3446a](https://github.com/sagemath/sagetrac-mirror/commit/184da0c30ccdd81b3d1c0c70ff3590ca14b3446a)\".",
    "created_at": "2014-06-10T10:04:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16455#issuecomment-260293",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[524b2d2b214cee5efbda50cca468c258b03e2db5](https://github.com/sagemath/sagetrac-mirror/commit/524b2d2b214cee5efbda50cca468c258b03e2db5)" to "[184da0c30ccdd81b3d1c0c70ff3590ca14b3446a](https://github.com/sagemath/sagetrac-mirror/commit/184da0c30ccdd81b3d1c0c70ff3590ca14b3446a)".



---

archive/issue_comments_260294.json:
```json
{
    "body": "<a id='comment:14'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/184da0c30ccdd81b3d1c0c70ff3590ca14b3446a\">184da0c</a></td><td><code>#16455 remove useless buildutils patch</code></td></tr></table>\n",
    "created_at": "2014-06-10T10:04:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16455#issuecomment-260294",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/184da0c30ccdd81b3d1c0c70ff3590ca14b3446a">184da0c</a></td><td><code>#16455 remove useless buildutils patch</code></td></tr></table>




---

archive/issue_comments_260295.json:
```json
{
    "body": "**Reviewer:** \u200bS\u00e9bastien Labb\u00e9",
    "created_at": "2014-06-10T10:06:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16455#issuecomment-260295",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

**Reviewer:** ​Sébastien Labbé



---

archive/issue_comments_260296.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2014-06-10T10:06:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16455#issuecomment-260296",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_260297.json:
```json
{
    "body": "<a id='comment:16'></a>\nOne question before giving a positive review. Can the spkg-install of pyzmq check that zeromq spkg was installed before? But maybe it is not a good idea, and it is better to let the installation breaks by itself....",
    "created_at": "2014-06-10T12:40:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16455#issuecomment-260297",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:16'></a>
One question before giving a positive review. Can the spkg-install of pyzmq check that zeromq spkg was installed before? But maybe it is not a good idea, and it is better to let the installation breaks by itself....



---

archive/issue_events_054626.json:
```json
{
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/16455",
    "label": "component: packages: standard",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16455#event-54626"
}
```



---

archive/issue_comments_260298.json:
```json
{
    "body": "<a id='comment:17'></a>\nTo my understanding, the dependencies are set via the `build/deps` file, but it seems to be reserved to standard packages only. Volker, is this correct ?\n\nThat said, since those packages are optional for more than one year and many people want them to become standard, i plan to make a ticket for that.",
    "created_at": "2014-06-10T13:05:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16455#issuecomment-260298",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:17'></a>
To my understanding, the dependencies are set via the `build/deps` file, but it seems to be reserved to standard packages only. Volker, is this correct ?

That said, since those packages are optional for more than one year and many people want them to become standard, i plan to make a ticket for that.



---

archive/issue_comments_260299.json:
```json
{
    "body": "<a id='comment:18'></a>\nWe don't have a dependency mechanism for optional packaeges yet. But please don't roll your own just for zeromq...",
    "created_at": "2014-06-10T13:06:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16455#issuecomment-260299",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:18'></a>
We don't have a dependency mechanism for optional packaeges yet. But please don't roll your own just for zeromq...



---

archive/issue_comments_260300.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2014-06-10T15:42:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16455#issuecomment-260300",
    "user": "https://github.com/seblabbe"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_260301.json:
```json
{
    "body": "<a id='comment:20'></a>\nSome optional packages do some dependency checking in their spkg-install, for example the p_group_cohomology package does this:\n\n```sh\nSMALL_GROUPS=`echo \"SmallGroup(13,1); quit;\" | gap -b -T | grep \"13\"`\nif [ \"$SMALL_GROUPS\" = \"\" ]; then\n   echo \"It seems that GAP's SmallGroups library is missing.\"\n   echo \"One way to install it is by doing\"\n   echo \"    sage: install_package('database_gap')\"\n   echo \"in a Sage session.\"\n   exit 1\nfi\n```\nWill installation of pyzmq fail gracefully if zeromq is missing, or is it better to have a check like this?",
    "created_at": "2014-06-10T17:30:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16455#issuecomment-260301",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:20'></a>
Some optional packages do some dependency checking in their spkg-install, for example the p_group_cohomology package does this:

```sh
SMALL_GROUPS=`echo "SmallGroup(13,1); quit;" | gap -b -T | grep "13"`
if [ "$SMALL_GROUPS" = "" ]; then
   echo "It seems that GAP's SmallGroups library is missing."
   echo "One way to install it is by doing"
   echo "    sage: install_package('database_gap')"
   echo "in a Sage session."
   exit 1
fi
```
Will installation of pyzmq fail gracefully if zeromq is missing, or is it better to have a check like this?



---

archive/issue_comments_260302.json:
```json
{
    "body": "<a id='comment:21'></a>\nsomeone installing pyzmq before zeromq will get something like :\n\n```\n******************************************\nConfigure: Autodetecting ZMQ settings...\n    Custom ZMQ dir:       /Users/slabbe/Applications/sage-git/local\ngcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -I/Users/slabbe/Applications/sage-git/local/include -Izmq/utils -Izmq/core -Izmq/devices -c detect/vers.c -o detect/vers.o\ndetect/vers.c:3:17: fatal error: zmq.h: No such file or directory\ncompilation terminated.\nFatal: \n    Failed to compile ZMQ test program.  Please check to make sure:\n\n    * You have a C compiler installed\n    * A development version of Python is installed (including header files)\n    * A development version of ZMQ >= 2.1.4 is installed (including header files)\n    * If ZMQ is not in a default location, supply the argument --zmq=<path>\n    * If you did recently install ZMQ to a default location, \n      try rebuilding the ld cache with `sudo ldconfig`\n      or specify zmq's location with `--zmq=/usr/local`\n    \nerror: command 'gcc' failed with exit status 1\n******************************************\n\nreal\t0m0.622s\nuser\t0m0.259s\nsys\t0m0.335s\n************************************************************************\nError installing package pyzmq-2.1.11.p1\n************************************************************************\n```",
    "created_at": "2014-06-10T18:43:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16455#issuecomment-260302",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:21'></a>
someone installing pyzmq before zeromq will get something like :

```
******************************************
Configure: Autodetecting ZMQ settings...
    Custom ZMQ dir:       /Users/slabbe/Applications/sage-git/local
gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -I/Users/slabbe/Applications/sage-git/local/include -Izmq/utils -Izmq/core -Izmq/devices -c detect/vers.c -o detect/vers.o
detect/vers.c:3:17: fatal error: zmq.h: No such file or directory
compilation terminated.
Fatal: 
    Failed to compile ZMQ test program.  Please check to make sure:

    * You have a C compiler installed
    * A development version of Python is installed (including header files)
    * A development version of ZMQ >= 2.1.4 is installed (including header files)
    * If ZMQ is not in a default location, supply the argument --zmq=<path>
    * If you did recently install ZMQ to a default location, 
      try rebuilding the ld cache with `sudo ldconfig`
      or specify zmq's location with `--zmq=/usr/local`
    
error: command 'gcc' failed with exit status 1
******************************************

real	0m0.622s
user	0m0.259s
sys	0m0.335s
************************************************************************
Error installing package pyzmq-2.1.11.p1
************************************************************************
```



---

archive/issue_comments_260303.json:
```json
{
    "body": "<a id='comment:22'></a>\nAnyway, these two packages are aimed to become standard soon if I understand correctly, so their dependencies will be set via the `build/deps` as mentionned before. So I believe it OK like that without any dependency checking.",
    "created_at": "2014-06-10T18:47:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16455#issuecomment-260303",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:22'></a>
Anyway, these two packages are aimed to become standard soon if I understand correctly, so their dependencies will be set via the `build/deps` as mentionned before. So I believe it OK like that without any dependency checking.



---

archive/issue_comments_260304.json:
```json
{
    "body": "<a id='comment:23'></a>\ndelete invisible space",
    "created_at": "2014-06-17T19:07:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16455#issuecomment-260304",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:23'></a>
delete invisible space



---

archive/issue_comments_260305.json:
```json
{
    "body": "**Changing reviewer** from \"\u200bS\u00e9bastien Labb\u00e9\" to \"S\u00e9bastien Labb\u00e9\".",
    "created_at": "2014-06-17T19:07:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16455#issuecomment-260305",
    "user": "https://github.com/vbraun"
}
```

**Changing reviewer** from "​Sébastien Labbé" to "Sébastien Labbé".



---

archive/issue_comments_260306.json:
```json
{
    "body": "**Changing branch** from \"[u/tmonteil/update_zeromq_and_pyzmq_to_recent_version_and_new_git_layout](https://github.com/sagemath/sagetrac-mirror/tree/u/tmonteil/update_zeromq_and_pyzmq_to_recent_version_and_new_git_layout)\" to \"[184da0c30ccdd81b3d1c0c70ff3590ca14b3446a](https://github.com/sagemath/sagetrac-mirror/commit/184da0c30ccdd81b3d1c0c70ff3590ca14b3446a)\".",
    "created_at": "2014-06-18T12:00:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16455#issuecomment-260306",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/tmonteil/update_zeromq_and_pyzmq_to_recent_version_and_new_git_layout](https://github.com/sagemath/sagetrac-mirror/tree/u/tmonteil/update_zeromq_and_pyzmq_to_recent_version_and_new_git_layout)" to "[184da0c30ccdd81b3d1c0c70ff3590ca14b3446a](https://github.com/sagemath/sagetrac-mirror/commit/184da0c30ccdd81b3d1c0c70ff3590ca14b3446a)".



---

archive/issue_events_054627.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-06-18T12:00:20Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16455",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16455#event-54627"
}
```



---

archive/issue_comments_260307.json:
```json
{
    "body": "**Changing commit** from \"[184da0c30ccdd81b3d1c0c70ff3590ca14b3446a](https://github.com/sagemath/sagetrac-mirror/commit/184da0c30ccdd81b3d1c0c70ff3590ca14b3446a)\" to \"\".",
    "created_at": "2014-12-13T23:36:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16455#issuecomment-260307",
    "user": "https://github.com/kcrisman"
}
```

**Changing commit** from "[184da0c30ccdd81b3d1c0c70ff3590ca14b3446a](https://github.com/sagemath/sagetrac-mirror/commit/184da0c30ccdd81b3d1c0c70ff3590ca14b3446a)" to "".



---

archive/issue_comments_260308.json:
```json
{
    "body": "<a id='comment:25'></a>\n> OK, once you confirm that the patch is not needed anymore, i will remove it from the branch.\n\n\nWho confirmed that this was useless?  This will still not work on older Macs - see the **actual note that was in the SPKG.txt**!!!\n\n```\n   - patches/buildutils.patch: This patches the file src/buildutils/detect.py.\n     It remove the option -arch for gcc which was broken on MacOSX 10.5.8.\n     The reason to this is that Sage's gcc spkg does not build a compiler\n     which understands the option -arch of Apple's clone of gcc.\n     https://groups.google.com/forum/?fromgroups#!topic/sage-devel/CuZNKclprIQ\n     http://trac.sagemath.org/sage_trac/ticket/13313\n```\nAnd now that this is standard with all the big changes at the end of 6.4, it breaks some of them.  And since the machine I am currently trying to build Sage on does not have git, nor has git built yet, I will have to type this entire patch in BY HAND, or nearly so.",
    "created_at": "2014-12-13T23:36:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16455#issuecomment-260308",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:25'></a>
> OK, once you confirm that the patch is not needed anymore, i will remove it from the branch.


Who confirmed that this was useless?  This will still not work on older Macs - see the **actual note that was in the SPKG.txt**!!!

```
   - patches/buildutils.patch: This patches the file src/buildutils/detect.py.
     It remove the option -arch for gcc which was broken on MacOSX 10.5.8.
     The reason to this is that Sage's gcc spkg does not build a compiler
     which understands the option -arch of Apple's clone of gcc.
     https://groups.google.com/forum/?fromgroups#!topic/sage-devel/CuZNKclprIQ
     http://trac.sagemath.org/sage_trac/ticket/13313
```
And now that this is standard with all the big changes at the end of 6.4, it breaks some of them.  And since the machine I am currently trying to build Sage on does not have git, nor has git built yet, I will have to type this entire patch in BY HAND, or nearly so.



---

archive/issue_comments_260309.json:
```json
{
    "body": "<a id='comment:26'></a>\n> Who confirmed that this was useless?\n\n\nMe. My machine is a MacOSX 10.5.8. I have read that note in the SPKG. When I did the review, I confirmed that the patch was needed with the earlier spkg but not with the new one which I gave a positive review.\n\nI am sorry for having cause you trouble today. Maybe we should add more documentation in the patch to re-add saying for what machine exactly it is mandatory. Because to me, it is not needed for 10.5.8 anymore.\n\nS\u00e9bastien",
    "created_at": "2014-12-15T14:24:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16455#issuecomment-260309",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:26'></a>
> Who confirmed that this was useless?


Me. My machine is a MacOSX 10.5.8. I have read that note in the SPKG. When I did the review, I confirmed that the patch was needed with the earlier spkg but not with the new one which I gave a positive review.

I am sorry for having cause you trouble today. Maybe we should add more documentation in the patch to re-add saying for what machine exactly it is mandatory. Because to me, it is not needed for 10.5.8 anymore.

Sébastien



---

archive/issue_comments_260310.json:
```json
{
    "body": "<a id='comment:27'></a>\n> Me. My machine is a MacOSX 10.5.8. I have read that note in the SPKG. When I did the review, I confirmed that the patch was needed with the earlier spkg but not with the new one which I gave a positive review.\n  \nOh!  And indeed if I had been more careful I would have seen that you were responsible for #13313 and so knew what you were talking about.\n> I am sorry for having cause you trouble today. Maybe we should add more documentation in the patch to re-add saying for what machine exactly it is mandatory. Because to me, it is not needed for 10.5.8 anymore.\n\nI apologize also, because I was snippy in my comment.  I had left the machine compiling all night, only to discover this (relatively early) error.\n\nI think that the question is in when they add these flags.  What do you get for\n\n```\nimport platform\nplatform.architecture()\n```\non my Lion computer (10.7) I get `('64bit', '')`.  I will see what I get on my other one.  My guess is that probably Dima's machine was already building a 64-bit Python (see e.g. [the SAGE64 flag](http://www.sagemath.org/doc/installation/source.html)), and that in the meantime maybe your 10.5 computer also is doing that, maybe we are building Python 64-bit by default or you are using `SAGE64='yes'` all the time on that computer? In principle if you don't have the patch but you get `if platform.architecture()[0]=='32bit':` then you should be getting the bad Apple-gcc-only flags.",
    "created_at": "2014-12-15T14:53:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16455#issuecomment-260310",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:27'></a>
> Me. My machine is a MacOSX 10.5.8. I have read that note in the SPKG. When I did the review, I confirmed that the patch was needed with the earlier spkg but not with the new one which I gave a positive review.
  
Oh!  And indeed if I had been more careful I would have seen that you were responsible for #13313 and so knew what you were talking about.
> I am sorry for having cause you trouble today. Maybe we should add more documentation in the patch to re-add saying for what machine exactly it is mandatory. Because to me, it is not needed for 10.5.8 anymore.

I apologize also, because I was snippy in my comment.  I had left the machine compiling all night, only to discover this (relatively early) error.

I think that the question is in when they add these flags.  What do you get for

```
import platform
platform.architecture()
```
on my Lion computer (10.7) I get `('64bit', '')`.  I will see what I get on my other one.  My guess is that probably Dima's machine was already building a 64-bit Python (see e.g. [the SAGE64 flag](http://www.sagemath.org/doc/installation/source.html)), and that in the meantime maybe your 10.5 computer also is doing that, maybe we are building Python 64-bit by default or you are using `SAGE64='yes'` all the time on that computer? In principle if you don't have the patch but you get `if platform.architecture()[0]=='32bit':` then you should be getting the bad Apple-gcc-only flags.



---

archive/issue_comments_260311.json:
```json
{
    "body": "<a id='comment:28'></a>\n@kcrisman: I pinged Sebastien on that ticket because he was the author of the patch and i have no mac to test. If there is some problem with some particular version of OSX, i think this is worth opening a new ticket for that issue now, or the information you will provide on the current thread will be less visible there.",
    "created_at": "2014-12-15T15:17:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16455#issuecomment-260311",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:28'></a>
@kcrisman: I pinged Sebastien on that ticket because he was the author of the patch and i have no mac to test. If there is some problem with some particular version of OSX, i think this is worth opening a new ticket for that issue now, or the information you will provide on the current thread will be less visible there.



---

archive/issue_comments_260312.json:
```json
{
    "body": "<a id='comment:29'></a>\nNaturally, just wanting to confirm before opening a new ticket.  See #17510.",
    "created_at": "2014-12-15T15:21:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16455#issuecomment-260312",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:29'></a>
Naturally, just wanting to confirm before opening a new ticket.  See #17510.



---

archive/issue_comments_260313.json:
```json
{
    "body": "<a id='comment:30'></a>\nNo problem. I should have thought of adding you in cc of this ticket by the time of the review, since I remember that #13313 was also useful for you.",
    "created_at": "2014-12-15T16:39:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16455#issuecomment-260313",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:30'></a>
No problem. I should have thought of adding you in cc of this ticket by the time of the review, since I remember that #13313 was also useful for you.



---

archive/issue_comments_260314.json:
```json
{
    "body": "<a id='comment:31'></a>\nReplying to [kcrisman](#comment%3A27):\n> > Me. My machine is a MacOSX 10.5.8. I have read that note in the SPKG. When I did the review, I confirmed that the patch was needed with the earlier spkg but not with the new one which I gave a positive review.\n  \n> Oh!  And indeed if I had been more careful I would have seen that you were responsible for #13313 and so knew what you were talking about.\n> > I am sorry for having cause you trouble today. Maybe we should add more documentation in the patch to re-add saying for what machine exactly it is mandatory. Because to me, it is not needed for 10.5.8 anymore.\n\n> I apologize also, because I was snippy in my comment.  I had left the machine compiling all night, only to discover this (relatively early) error.\n> \n> I think that the question is in when they add these flags.  What do you get for\n> \n> ```\n> import platform\n> platform.architecture()\n> ```\n> on my Lion computer (10.7) I get `('64bit', '')`.  I will see what I get on my other one.  My guess is that probably Dima's machine was already building a 64-bit Python (see e.g. [the SAGE64 flag](http://www.sagemath.org/doc/installation/source.html)), and that in the meantime maybe your 10.5 computer also is doing that, maybe we are building Python 64-bit by default or you are using `SAGE64='yes'` all the time on that computer?\n\n\nWhen I reported that (cf the link to sage-devel in #13313) I tried that on an PPC OSX 10.5.8 machine, which is 32-bit all the way. I don't think I did build anything with SAGE64.",
    "created_at": "2014-12-15T21:28:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16455#issuecomment-260314",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:31'></a>
Replying to [kcrisman](#comment%3A27):
> > Me. My machine is a MacOSX 10.5.8. I have read that note in the SPKG. When I did the review, I confirmed that the patch was needed with the earlier spkg but not with the new one which I gave a positive review.
  
> Oh!  And indeed if I had been more careful I would have seen that you were responsible for #13313 and so knew what you were talking about.
> > I am sorry for having cause you trouble today. Maybe we should add more documentation in the patch to re-add saying for what machine exactly it is mandatory. Because to me, it is not needed for 10.5.8 anymore.

> I apologize also, because I was snippy in my comment.  I had left the machine compiling all night, only to discover this (relatively early) error.
> 
> I think that the question is in when they add these flags.  What do you get for
> 
> ```
> import platform
> platform.architecture()
> ```
> on my Lion computer (10.7) I get `('64bit', '')`.  I will see what I get on my other one.  My guess is that probably Dima's machine was already building a 64-bit Python (see e.g. [the SAGE64 flag](http://www.sagemath.org/doc/installation/source.html)), and that in the meantime maybe your 10.5 computer also is doing that, maybe we are building Python 64-bit by default or you are using `SAGE64='yes'` all the time on that computer?


When I reported that (cf the link to sage-devel in #13313) I tried that on an PPC OSX 10.5.8 machine, which is 32-bit all the way. I don't think I did build anything with SAGE64.
