# Issue 16507: Better handling of subspace construction in pushout

archive/issues_016270.json:
```json
{
    "body": "CC:  simonking @nthiery jpflori\n\nKeywords: pushout subspace, sd59\n\nWhen taking a pushout of two modules in the case where the construction of exactly one of them involves a subspace construction, the result does not have a coercion map from the other object:\n\n```\nsage: A = ZZ^2\nsage: V = span([[1, 2]], QQ)\nsage: P = sage.categories.pushout.pushout(A, V)\nsage: P\nVector space of degree 2 and dimension 1 over Rational Field\nUser basis matrix:\n[1 2]\nsage: P.has_coerce_map_from(A)\nFalse\n```\nThe explanation is that for the other currently existing constructions `F`, the result `F(X)` of applying the construction to `X` has a coercion map *from* `X`, but for the subspace construction, `F(X)` only has a coercion map *to* `X`.\n\nThis ticket addresses this by equipping the class `ConstructionFunctor` with an attribute `coercion_reversed`, which is `False` by default; if it is `True` for a construction `F`, then the pushout of two objects omits `F` in the case where (at a given step of constructing the pushout) including it would not yield a coercion to the final domain.  Of course, we set `coercion_reversed = True` for the subspace construction.\n\nNo change is necessary in the case where both constructions involve `F`, since this situation should be taken care of by `F.merge()`.  This is indeed true for the subspace construction, where `F.merge()` takes the sum of the two subspaces.\n\nThe situation described above can be viewed as the case where one of the two constructions involves a \"trivial\" application of `F`, i.e. with the subspace equal to the whole space.  Hence we should interpret our situation as a case where the effect of `merge()` with one trivial argument is desired.\n\nIn the above example, this strategy will cause `P` to be equal to `QQ^2`, as might be expected.\n\nIssue created by migration from https://trac.sagemath.org/ticket/16507\n\n",
    "closed_at": "2014-12-18T00:57:08Z",
    "created_at": "2014-06-21T00:08:58Z",
    "labels": [
        "component: categories",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Better handling of subspace construction in pushout",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16507",
    "user": "https://github.com/pjbruin"
}
```
CC:  simonking @nthiery jpflori

Keywords: pushout subspace, sd59

When taking a pushout of two modules in the case where the construction of exactly one of them involves a subspace construction, the result does not have a coercion map from the other object:

```
sage: A = ZZ^2
sage: V = span([[1, 2]], QQ)
sage: P = sage.categories.pushout.pushout(A, V)
sage: P
Vector space of degree 2 and dimension 1 over Rational Field
User basis matrix:
[1 2]
sage: P.has_coerce_map_from(A)
False
```
The explanation is that for the other currently existing constructions `F`, the result `F(X)` of applying the construction to `X` has a coercion map *from* `X`, but for the subspace construction, `F(X)` only has a coercion map *to* `X`.

This ticket addresses this by equipping the class `ConstructionFunctor` with an attribute `coercion_reversed`, which is `False` by default; if it is `True` for a construction `F`, then the pushout of two objects omits `F` in the case where (at a given step of constructing the pushout) including it would not yield a coercion to the final domain.  Of course, we set `coercion_reversed = True` for the subspace construction.

No change is necessary in the case where both constructions involve `F`, since this situation should be taken care of by `F.merge()`.  This is indeed true for the subspace construction, where `F.merge()` takes the sum of the two subspaces.

The situation described above can be viewed as the case where one of the two constructions involves a "trivial" application of `F`, i.e. with the subspace equal to the whole space.  Hence we should interpret our situation as a case where the effect of `merge()` with one trivial argument is desired.

In the above example, this strategy will cause `P` to be equal to `QQ^2`, as might be expected.

Issue created by migration from https://trac.sagemath.org/ticket/16507





---

archive/issue_comments_212591.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-06-21T00:12:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16507#issuecomment-212591",
    "user": "https://github.com/pjbruin"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_212592.json:
```json
{
    "body": "I think this is good, but Simon/Nicolas, could I get a second opinion on this?",
    "created_at": "2014-06-23T00:07:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16507#issuecomment-212592",
    "user": "https://github.com/tscrim"
}
```

I think this is good, but Simon/Nicolas, could I get a second opinion on this?



---

archive/issue_comments_212593.json:
```json
{
    "body": "Changing keywords from \"pushout subspace\" to \"pushout subspace, sd59\".",
    "created_at": "2014-06-23T00:07:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16507#issuecomment-212593",
    "user": "https://github.com/tscrim"
}
```

Changing keywords from "pushout subspace" to "pushout subspace, sd59".



---

archive/issue_events_048496.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16507",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16507#event-48496"
}
```



---

archive/issue_comments_212594.json:
```json
{
    "body": "What about the discussion we had on sage-devel / the example 1.1 + x^2\n\nI liked the suggestion of doing a coercion check for exceptional cases.\nThat would however involve applying/evaluating (part of) the functor prematurely\n(which is not necessarily wrong/bad).",
    "created_at": "2014-08-29T22:37:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16507#issuecomment-212594",
    "user": "https://github.com/jjermann"
}
```

What about the discussion we had on sage-devel / the example 1.1 + x^2

I liked the suggestion of doing a coercion check for exceptional cases.
That would however involve applying/evaluating (part of) the functor prematurely
(which is not necessarily wrong/bad).



---

archive/issue_comments_212595.json:
```json
{
    "body": "Replying to [comment:4 jj]:\n> What about the discussion we had on sage-devel / the example 1.1 + x^2\n\nI was planning to come back to this, but I'm currently slightly busy (moving house)...\n> I liked the suggestion of doing a coercion check for exceptional cases.\n> That would however involve applying/evaluating (part of) the functor prematurely\n> (which is not necessarily wrong/bad).\n\nYes, but as you say it is not a bad thing; in the end we have to apply the \"merged\" functor anyway, so the consequence of this coercion checking is just that the logic becomes a little bit more complicated.\n\nIf you feel like implementing this, feel free to go ahead; I'm not sure if I'll have enough time very soon.",
    "created_at": "2014-08-29T22:51:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16507#issuecomment-212595",
    "user": "https://github.com/pjbruin"
}
```

Replying to [comment:4 jj]:
> What about the discussion we had on sage-devel / the example 1.1 + x^2

I was planning to come back to this, but I'm currently slightly busy (moving house)...
> I liked the suggestion of doing a coercion check for exceptional cases.
> That would however involve applying/evaluating (part of) the functor prematurely
> (which is not necessarily wrong/bad).

Yes, but as you say it is not a bad thing; in the end we have to apply the "merged" functor anyway, so the consequence of this coercion checking is just that the logic becomes a little bit more complicated.

If you feel like implementing this, feel free to go ahead; I'm not sure if I'll have enough time very soon.



---

archive/issue_comments_212596.json:
```json
{
    "body": "Replying to [ticket:16507 pbruin]:\n> This ticket addresses this by equipping the class `ConstructionFunctor` with an attribute `coercion_reversed`, which is `False` by default; if it is `True` for a construction `F`, then the pushout of two objects omits `F` in the case where (at a given step of constructing the pushout) exactly one of the two constructions is `F`.  Of course, we set `coercion_reversed = True` for the subspace construction.\n\n\nI hope this will not end up with a pullback construction.\n\nWhat do you mean by \"exactly one of the two constructions is `F`\"? Isn't it the case that one can simply drop all \"reversed\" construction functors, *before* constructing the pushout? Say, if you have direct construction functors F1,...,F5 and reversed construction functors R1,R2, and consider `(F5*R2*F4*F3*R1*F2*F1)(ZZ)`, then `(R2*F4*F3*R1*F2*F1)(ZZ)` coerces into `(F4*F3*R1*F2*F1)(ZZ)` and `(F4*F3*R1*F2*F1)(ZZ)` coerces into `(F5*F4*F3*R1*F2*F1)(ZZ)`. Would this already imply that `(F5*R2*F4*F3*R1*F2*F1)(ZZ)` coerces into `(F5*F4*F3*R1*F2*F1)(ZZ)`? If yes, then one could inductively remove all the reversed construction functors, and will eventually construct the pushout of `(F5*F4*F3*F2*F1)(ZZ)` with the other given parent.",
    "created_at": "2014-08-30T07:49:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16507#issuecomment-212596",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [ticket:16507 pbruin]:
> This ticket addresses this by equipping the class `ConstructionFunctor` with an attribute `coercion_reversed`, which is `False` by default; if it is `True` for a construction `F`, then the pushout of two objects omits `F` in the case where (at a given step of constructing the pushout) exactly one of the two constructions is `F`.  Of course, we set `coercion_reversed = True` for the subspace construction.


I hope this will not end up with a pullback construction.

What do you mean by "exactly one of the two constructions is `F`"? Isn't it the case that one can simply drop all "reversed" construction functors, *before* constructing the pushout? Say, if you have direct construction functors F1,...,F5 and reversed construction functors R1,R2, and consider `(F5*R2*F4*F3*R1*F2*F1)(ZZ)`, then `(R2*F4*F3*R1*F2*F1)(ZZ)` coerces into `(F4*F3*R1*F2*F1)(ZZ)` and `(F4*F3*R1*F2*F1)(ZZ)` coerces into `(F5*F4*F3*R1*F2*F1)(ZZ)`. Would this already imply that `(F5*R2*F4*F3*R1*F2*F1)(ZZ)` coerces into `(F5*F4*F3*R1*F2*F1)(ZZ)`? If yes, then one could inductively remove all the reversed construction functors, and will eventually construct the pushout of `(F5*F4*F3*F2*F1)(ZZ)` with the other given parent.



---

archive/issue_comments_212597.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-08-30T09:20:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16507#issuecomment-212597",
    "user": "https://github.com/robertwb"
}
```

New commits:



---

archive/issue_comments_212598.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-08-30T09:22:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16507#issuecomment-212598",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_212599.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-08-30T23:47:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16507#issuecomment-212599",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_212600.json:
```json
{
    "body": "Replying to [comment:6 SimonKing]:\n> I hope this will not end up with a pullback construction.\n\nIt definitely won't; this algorithm is far from being symmetric.\n> Isn't it the case that one can simply drop all \"reversed\" construction functors, *before* constructing the pushout?\n\nIn that case you would end up with some object admitting coercion maps from both original objects, but the idea is to try to get something as close as possible to the \"real\" push-out.  Hopefully Robert's list of examples makes it clear that one shouldn't just throw away all \"coercion-reversed\" constructions.",
    "created_at": "2014-09-04T15:02:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16507#issuecomment-212600",
    "user": "https://github.com/pjbruin"
}
```

Replying to [comment:6 SimonKing]:
> I hope this will not end up with a pullback construction.

It definitely won't; this algorithm is far from being symmetric.
> Isn't it the case that one can simply drop all "reversed" construction functors, *before* constructing the pushout?

In that case you would end up with some object admitting coercion maps from both original objects, but the idea is to try to get something as close as possible to the "real" push-out.  Hopefully Robert's list of examples makes it clear that one shouldn't just throw away all "coercion-reversed" constructions.



---

archive/issue_comments_212601.json:
```json
{
    "body": "Replying to [comment:18:ticket:10513 jpflori (#10513)]:\n> Could you add a little documentation about the `coercion_reverse` thing?\n> Or rather, move it in the actual code, rather than in comments?\n> Not that the category/coercion stuff is already obscure, but...\n\nIt's a bit annoying to document member variables, one would have to do it in the class docstring.  Anyway, I'll try if I can do this in a reasonable way.",
    "created_at": "2014-12-08T21:16:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16507#issuecomment-212601",
    "user": "https://github.com/pjbruin"
}
```

Replying to [comment:18:ticket:10513 jpflori (#10513)]:
> Could you add a little documentation about the `coercion_reverse` thing?
> Or rather, move it in the actual code, rather than in comments?
> Not that the category/coercion stuff is already obscure, but...

It's a bit annoying to document member variables, one would have to do it in the class docstring.  Anyway, I'll try if I can do this in a reasonable way.



---

archive/issue_comments_212602.json:
```json
{
    "body": "I ended up moving this explanation to the docstring of `pushout()` instead, and also made a number of other documentation improvements.",
    "created_at": "2014-12-08T22:58:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16507#issuecomment-212602",
    "user": "https://github.com/pjbruin"
}
```

I ended up moving this explanation to the docstring of `pushout()` instead, and also made a number of other documentation improvements.



---

archive/issue_comments_212603.json:
```json
{
    "body": "Looks better to me!",
    "created_at": "2014-12-10T13:16:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16507#issuecomment-212603",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Looks better to me!



---

archive/issue_comments_212604.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-12-10T13:16:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16507#issuecomment-212604",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_048497.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-12-18T00:57:08Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16507",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16507#event-48497"
}
```



---

archive/issue_comments_212605.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-12-18T00:57:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16507",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16507#issuecomment-212605",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
