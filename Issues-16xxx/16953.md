# Issue 16953: Faster enumeration of points for toric varieties

archive/issues_016716.json:
```json
{
    "body": "This ticket implements a specialized enumerator for points of a toric variety over a finite field. It uses linear algebra to solve the rescaling relations. It also parallelizes the enumeration of points for subvarieties of toric varieties. \n\nFor example:\n\n```\n$ cat quintic.sage \np = 3\nfor k in range(1, 5):\n    F = GF(p^k, 'a')\n    P4.<z0,z1,z2,z3,z4> = toric_varieties.P(4, base_ring=F)\n    X = P4.subscheme(z0^5+z1^5+z2^5+z3^5+z4^5-5*z0*z1*z2*z3*z4)\n    print k, X.point_set().cardinality()\n\n$ time sage quintic.sage \n1 36\n2 816\n3 20691\n4 688800\n\nreal 14m37.378s\nuser 136m37.989s\nsys 0m18.268s\n```\n\nCC:  @novoselt jpflori ursula\n\nReviewer: Ursula Whitcher\n\nAuthor: Volker Braun\n\nBranch: 49a72410a19784c05c9fe320e28382df7e5b7338\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/16953\n\n",
    "closed_at": "2015-05-26T23:34:29Z",
    "created_at": "2014-09-09T16:59:09Z",
    "labels": [
        "component: algebraic geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Faster enumeration of points for toric varieties",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16953",
    "user": "https://github.com/vbraun"
}
```
This ticket implements a specialized enumerator for points of a toric variety over a finite field. It uses linear algebra to solve the rescaling relations. It also parallelizes the enumeration of points for subvarieties of toric varieties. 

For example:

```
$ cat quintic.sage 
p = 3
for k in range(1, 5):
    F = GF(p^k, 'a')
    P4.<z0,z1,z2,z3,z4> = toric_varieties.P(4, base_ring=F)
    X = P4.subscheme(z0^5+z1^5+z2^5+z3^5+z4^5-5*z0*z1*z2*z3*z4)
    print k, X.point_set().cardinality()

$ time sage quintic.sage 
1 36
2 816
3 20691
4 688800

real 14m37.378s
user 136m37.989s
sys 0m18.268s
```

CC:  @novoselt jpflori ursula

Reviewer: Ursula Whitcher

Author: Volker Braun

Branch: 49a72410a19784c05c9fe320e28382df7e5b7338

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/16953





---

archive/issue_comments_235182.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-09-11T22:47:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16953#issuecomment-235182",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_235183.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-09-11T23:14:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16953#issuecomment-235183",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_235184.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-This ticket implements a specialized enumerator for points of a toric variety over a finite field. It uses linear algebra to solve the rescaling relations.\n+This ticket implements a specialized enumerator for points of a toric variety over a finite field. It uses linear algebra to solve the rescaling relations. It also parallelizes the enumeration of points for subvarieties of toric varieties.\n \n Author: Volker Braun\n \n```\n",
    "created_at": "2014-09-11T23:14:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16953#issuecomment-235184",
    "user": "https://github.com/vbraun"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,4 @@
-This ticket implements a specialized enumerator for points of a toric variety over a finite field. It uses linear algebra to solve the rescaling relations.
+This ticket implements a specialized enumerator for points of a toric variety over a finite field. It uses linear algebra to solve the rescaling relations. It also parallelizes the enumeration of points for subvarieties of toric varieties.
 
 Author: Volker Braun
 
```




---

archive/issue_comments_235185.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,26 @@\n+This ticket implements a specialized enumerator for points of a toric variety over a finite field. It uses linear algebra to solve the rescaling relations. It also parallelizes the enumeration of points for subvarieties of toric varieties. \n \n+For example:\n+\n+```\n+$ cat quintic.sage \n+p = 3\n+for k in range(1, 5):\n+    F = GF(p^k, 'a')\n+    P4.<z0,z1,z2,z3,z4> = toric_varieties.P(4, base_ring=F)\n+    X = P4.subscheme(z0^5+z1^5+z2^5+z3^5+z4^5-5*z0*z1*z2*z3*z4)\n+    print k, X.point_set().cardinality()\n+\n+$ time sage quintic.sage \n+1 36\n+2 816\n+3 20691\n+4 688800\n+\n+real\t14m37.378s\n+user\t136m37.989s\n+sys\t0m18.268s\n+```\n \n Author: Volker Braun\n \n```\n",
    "created_at": "2014-09-12T10:18:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16953#issuecomment-235185",
    "user": "https://github.com/vbraun"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,26 @@
+This ticket implements a specialized enumerator for points of a toric variety over a finite field. It uses linear algebra to solve the rescaling relations. It also parallelizes the enumeration of points for subvarieties of toric varieties. 
 
+For example:
+
+```
+$ cat quintic.sage 
+p = 3
+for k in range(1, 5):
+    F = GF(p^k, 'a')
+    P4.<z0,z1,z2,z3,z4> = toric_varieties.P(4, base_ring=F)
+    X = P4.subscheme(z0^5+z1^5+z2^5+z3^5+z4^5-5*z0*z1*z2*z3*z4)
+    print k, X.point_set().cardinality()
+
+$ time sage quintic.sage 
+1 36
+2 816
+3 20691
+4 688800
+
+real	14m37.378s
+user	136m37.989s
+sys	0m18.268s
+```
 
 Author: Volker Braun
 
```




---

archive/issue_comments_235186.json:
```json
{
    "body": "<a id='comment:5'></a>Asking for the cardinality of a toric variety raises a Not Implemented Error:\n\n```\nP4.<z0,z1,z2,z3,z4> = toric_varieties.P(4)\n11\nP4.cardinality()\n12\nError in lines 2-2\nTraceback (most recent call last):\n  File \"/projects/fbc7bfa1-2c3e-4abc-b8d5-3a0b959a311d/.sagemathcloud/sage_server.py\", line 865, in execute\n    exec compile(block+'\\n', '', 'single') in namespace, locals\n  File \"\", line 1, in <module>\n  File \"/projects/fbc7bfa1-2c3e-4abc-b8d5-3a0b959a311d/sage-6.3-x86_64-Linux/local/lib/python2.7/site-packages/sage/categories/sets_cat.py\", line 1322, in cardinality\n    raise NotImplementedError(\"unknown cardinality\")\nNotImplementedError: unknown cardinality\n```\n\nShould P4.cardinality() have the same output as P4.point_set().cardinality()?",
    "created_at": "2014-11-04T17:47:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16953#issuecomment-235186",
    "user": "https://trac.sagemath.org/admin/accounts/users/ursula"
}
```

<a id='comment:5'></a>Asking for the cardinality of a toric variety raises a Not Implemented Error:

```
P4.<z0,z1,z2,z3,z4> = toric_varieties.P(4)
11
P4.cardinality()
12
Error in lines 2-2
Traceback (most recent call last):
  File "/projects/fbc7bfa1-2c3e-4abc-b8d5-3a0b959a311d/.sagemathcloud/sage_server.py", line 865, in execute
    exec compile(block+'\n', '', 'single') in namespace, locals
  File "", line 1, in <module>
  File "/projects/fbc7bfa1-2c3e-4abc-b8d5-3a0b959a311d/sage-6.3-x86_64-Linux/local/lib/python2.7/site-packages/sage/categories/sets_cat.py", line 1322, in cardinality
    raise NotImplementedError("unknown cardinality")
NotImplementedError: unknown cardinality
```

Should P4.cardinality() have the same output as P4.point_set().cardinality()?



---

archive/issue_comments_235187.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-11-05T16:51:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16953#issuecomment-235187",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_235188.json:
```json
{
    "body": "<a id='comment:7'></a>The cardinality method is just inherited from the category framework. I've hooked it up to do the right thing.",
    "created_at": "2014-11-05T16:52:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16953#issuecomment-235188",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:7'></a>The cardinality method is just inherited from the category framework. I've hooked it up to do the right thing.



---

archive/issue_comments_235189.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-05-24T20:48:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16953#issuecomment-235189",
    "user": "https://trac.sagemath.org/admin/accounts/users/ursula"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_235190.json:
```json
{
    "body": "<a id='comment:8'></a>When I install this ticket with Sage 6.7, I get the following error on build:\n\nTraceback (most recent call last):\n  File \"setup.py\", line 559, in <module>\n    run_cythonize()\n  File \"setup.py\", line 551, in run_cythonize\n    'profile': profile,\n  File \"/projects/fbc7bfa1-2c3e-4abc-b8d5-3a0b959a311d/sage-6.7-x86_64-Linux/local/lib/python2.7/site-packages/Cython-0.22-py2.7-linux-x86_64.egg/Cython/Build/Dependencies.py\", line 754, in cytho\nnize\n    aliases=aliases)\n  File \"/projects/fbc7bfa1-2c3e-4abc-b8d5-3a0b959a311d/sage-6.7-x86_64-Linux/local/lib/python2.7/site-packages/Cython-0.22-py2.7-linux-x86_64.egg/Cython/Build/Dependencies.py\", line 649, in creat\ne_extension_list\n    for file in nonempty(extended_iglob(filepattern), \"'%s' doesn't match any files\" % filepattern):\n  File \"/projects/fbc7bfa1-2c3e-4abc-b8d5-3a0b959a311d/sage-6.7-x86_64-Linux/local/lib/python2.7/site-packages/Cython-0.22-py2.7-linux-x86_64.egg/Cython/Build/Dependencies.py\", line 103, in nonem\npty\n    raise ValueError(error_msg)\nValueError: 'sage/tests/parallel.pyx' doesn't match any files",
    "created_at": "2015-05-24T20:48:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16953#issuecomment-235190",
    "user": "https://trac.sagemath.org/admin/accounts/users/ursula"
}
```

<a id='comment:8'></a>When I install this ticket with Sage 6.7, I get the following error on build:

Traceback (most recent call last):
  File "setup.py", line 559, in <module>
    run_cythonize()
  File "setup.py", line 551, in run_cythonize
    'profile': profile,
  File "/projects/fbc7bfa1-2c3e-4abc-b8d5-3a0b959a311d/sage-6.7-x86_64-Linux/local/lib/python2.7/site-packages/Cython-0.22-py2.7-linux-x86_64.egg/Cython/Build/Dependencies.py", line 754, in cytho
nize
    aliases=aliases)
  File "/projects/fbc7bfa1-2c3e-4abc-b8d5-3a0b959a311d/sage-6.7-x86_64-Linux/local/lib/python2.7/site-packages/Cython-0.22-py2.7-linux-x86_64.egg/Cython/Build/Dependencies.py", line 649, in creat
e_extension_list
    for file in nonempty(extended_iglob(filepattern), "'%s' doesn't match any files" % filepattern):
  File "/projects/fbc7bfa1-2c3e-4abc-b8d5-3a0b959a311d/sage-6.7-x86_64-Linux/local/lib/python2.7/site-packages/Cython-0.22-py2.7-linux-x86_64.egg/Cython/Build/Dependencies.py", line 103, in nonem
pty
    raise ValueError(error_msg)
ValueError: 'sage/tests/parallel.pyx' doesn't match any files



---

archive/issue_comments_235191.json:
```json
{
    "body": "<a id='comment:9'></a>The actual functionality works fine, albeit slowly.  I would find it helpful if there were a way to save partial progress when computing a point set: I'm interested in examples that are large enough that the Sage cloud may kill the process before I'm done.",
    "created_at": "2015-05-24T20:55:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16953#issuecomment-235191",
    "user": "https://trac.sagemath.org/admin/accounts/users/ursula"
}
```

<a id='comment:9'></a>The actual functionality works fine, albeit slowly.  I would find it helpful if there were a way to save partial progress when computing a point set: I'm interested in examples that are large enough that the Sage cloud may kill the process before I'm done.



---

archive/issue_comments_235192.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-24T22:28:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16953#issuecomment-235192",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_235193.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-05-24T22:31:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16953#issuecomment-235193",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_235194.json:
```json
{
    "body": "<a id='comment:11'></a>I fixed the merge conflict. You probably need to run \"make\" when building with the patch.",
    "created_at": "2015-05-24T22:31:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16953#issuecomment-235194",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:11'></a>I fixed the merge conflict. You probably need to run "make" when building with the patch.



---

archive/issue_comments_235195.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-05-25T21:33:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16953#issuecomment-235195",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_235196.json:
```json
{
    "body": "<a id='comment:12'></a>Hello,\n\nSome quick comments (I will not be able to check most of the mathematical contents of the code).\n\nSome cached method are really not needed. The multiplicative generator of finite field is already cached. So you could remove the `FiniteFieldPointEnumerator.multiplicative_generator`. And the multiplicative order of the multiplicative generator is `q-1` (where `q` is the cardinality of the field), isn't it?\n\nInstead of using `CartesianProduct`, use `itertools.product` (actually this is indirectely used). `CartesianProduct` is about to disappear.\n\nIf you want to copy a list, the fastest is by far `zero[:]` and not `copy(zero)`.\n\n```\nsage: timeit(\"copy(zero)\")\n625 loops, best of 3: 2.59 \u00b5s per loop\nsage: timeit(\"zero[:]\")\n625 loops, best of 3: 248 ns per loop\n```\n\nThe fastest way for zero test is `X.is_zero()` and not `X == 0`. The latter might involves coercion.\n\n```\nsage: K = GF(53**3, 'a')\nsage: b = K('a')+3*K('a')**2+12\nsage: timeit(\"b == 0\")\n625 loops, best of 3: 2.17 \u00b5s per loop\nsage: timeit(\"b.is_zero()\")\n625 loops, best of 3: 317 ns per loop\n```\n\nVincent\n\nPS: the hook for modifying the category code was very funny! Hopefully I erase the `Sets.ParentMethods.cardinality` before this ticket gets in ;-)",
    "created_at": "2015-05-25T21:33:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16953#issuecomment-235196",
    "user": "https://github.com/videlec"
}
```

<a id='comment:12'></a>Hello,

Some quick comments (I will not be able to check most of the mathematical contents of the code).

Some cached method are really not needed. The multiplicative generator of finite field is already cached. So you could remove the `FiniteFieldPointEnumerator.multiplicative_generator`. And the multiplicative order of the multiplicative generator is `q-1` (where `q` is the cardinality of the field), isn't it?

Instead of using `CartesianProduct`, use `itertools.product` (actually this is indirectely used). `CartesianProduct` is about to disappear.

If you want to copy a list, the fastest is by far `zero[:]` and not `copy(zero)`.

```
sage: timeit("copy(zero)")
625 loops, best of 3: 2.59 µs per loop
sage: timeit("zero[:]")
625 loops, best of 3: 248 ns per loop
```

The fastest way for zero test is `X.is_zero()` and not `X == 0`. The latter might involves coercion.

```
sage: K = GF(53**3, 'a')
sage: b = K('a')+3*K('a')**2+12
sage: timeit("b == 0")
625 loops, best of 3: 2.17 µs per loop
sage: timeit("b.is_zero()")
625 loops, best of 3: 317 ns per loop
```

Vincent

PS: the hook for modifying the category code was very funny! Hopefully I erase the `Sets.ParentMethods.cardinality` before this ticket gets in ;-)



---

archive/issue_comments_235197.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-05-25T22:27:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16953#issuecomment-235197",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_235198.json:
```json
{
    "body": "<a id='comment:13'></a>IMHO `copy(zero)` is much more readable that `zero[:]`. And `X.is_zero()` doesn't work for all numeric datatypes. Both are premature optimizations for something that isn't even cythonized. \n\nAlso, there isn't even a patch that deprecates CartesianProduct. You are getting ahead of yourself.",
    "created_at": "2015-05-25T22:27:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16953#issuecomment-235198",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:13'></a>IMHO `copy(zero)` is much more readable that `zero[:]`. And `X.is_zero()` doesn't work for all numeric datatypes. Both are premature optimizations for something that isn't even cythonized. 

Also, there isn't even a patch that deprecates CartesianProduct. You are getting ahead of yourself.



---

archive/issue_comments_235199.json:
```json
{
    "body": "<a id='comment:14'></a>I got this working with Sage 6.8; it behaves as advertised.",
    "created_at": "2015-05-25T23:36:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16953#issuecomment-235199",
    "user": "https://trac.sagemath.org/admin/accounts/users/ursula"
}
```

<a id='comment:14'></a>I got this working with Sage 6.8; it behaves as advertised.



---

archive/issue_comments_235200.json:
```json
{
    "body": "<a id='comment:15'></a>Replying to [comment:13 vbraun]:\n> IMHO `copy(zero)` is much more readable that `zero[:]`. And `X.is_zero()` doesn't work for all numeric datatypes. Both are premature optimizations for something that isn't even cythonized. \n\n\nAnd you forgot that `copy(X)` needs `from copy import copy` which is very readable. Doing `[zero]*n` each time would even be faster...\n\n> Also, there isn't even a patch that deprecates CartesianProduct. You are getting ahead of yourself.\n\n\nReally? what about #18411? Citation:\n\n```\nsage.combinat.cartesian_product.CartesianProduct is deprecated.\n```\n\nAnd these were not my only remarks...",
    "created_at": "2015-05-26T07:11:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16953#issuecomment-235200",
    "user": "https://github.com/videlec"
}
```

<a id='comment:15'></a>Replying to [comment:13 vbraun]:
> IMHO `copy(zero)` is much more readable that `zero[:]`. And `X.is_zero()` doesn't work for all numeric datatypes. Both are premature optimizations for something that isn't even cythonized. 


And you forgot that `copy(X)` needs `from copy import copy` which is very readable. Doing `[zero]*n` each time would even be faster...

> Also, there isn't even a patch that deprecates CartesianProduct. You are getting ahead of yourself.


Really? what about #18411? Citation:

```
sage.combinat.cartesian_product.CartesianProduct is deprecated.
```

And these were not my only remarks...



---

archive/issue_comments_235201.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-05-26T07:11:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16953#issuecomment-235201",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_235202.json:
```json
{
    "body": "<a id='comment:16'></a>Replying to [comment:15 vdelecroix]:\n> Replying to [comment:13 vbraun]:\n> > IMHO `copy(zero)` is much more readable that `zero[:]`.ething that isn't even cythonized. \n\n> \n> And you forgot that `copy(X)` needs `from copy import copy` which is very readable\n\n\nI don't see how mixing up function bodies with import statements is ever going to yield a viable argument. In any case, I stand by my opinion that `copy(zero)` is much more readable that `zero[:]`.\n\n> Really? what about #18411? \n\n\nThere is no code on that ticket, and even if there were it depends on unfinished tickets. Its also unclear to me if it is ever going to be merged as some people have previously expressed a strong opinion on sage-devel for something that is named after cartesian product instead of `itertools.product`. In any case, this ticket long predates #18411 and is ready to be merged right now.",
    "created_at": "2015-05-26T07:18:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16953#issuecomment-235202",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:16'></a>Replying to [comment:15 vdelecroix]:
> Replying to [comment:13 vbraun]:
> > IMHO `copy(zero)` is much more readable that `zero[:]`.ething that isn't even cythonized. 

> 
> And you forgot that `copy(X)` needs `from copy import copy` which is very readable


I don't see how mixing up function bodies with import statements is ever going to yield a viable argument. In any case, I stand by my opinion that `copy(zero)` is much more readable that `zero[:]`.

> Really? what about #18411? 


There is no code on that ticket, and even if there were it depends on unfinished tickets. Its also unclear to me if it is ever going to be merged as some people have previously expressed a strong opinion on sage-devel for something that is named after cartesian product instead of `itertools.product`. In any case, this ticket long predates #18411 and is ready to be merged right now.



---

archive/issue_comments_235203.json:
```json
{
    "body": "<a id='comment:17'></a>Replying to [comment:16 vbraun]:\n> Replying to [comment:15 vdelecroix]:\n> > Replying to [comment:13 vbraun]:\n> > > IMHO `copy(zero)` is much more readable that `zero[:]`.ething that isn't even cythonized. \n\n> > \n> > And you forgot that `copy(X)` needs `from copy import copy` which is very readable\n\n> \n> I don't see how mixing up function bodies with import statements is ever going to yield a viable argument. In any case, I stand by my opinion that `copy(zero)` is much more readable that `zero[:]`.\n> \n> > Really? what about #18411? \n\n> \n> There is no code on that ticket, and even if there were it depends on unfinished tickets. Its also unclear to me if it is ever going to be merged as some people have previously expressed a strong opinion on sage-devel for something that is named after cartesian product instead of `itertools.product`. In any case, this ticket long predates #18411 and is ready to be merged right now.\n\n\nThen there is `cartesian_product_iterator`.\n\nWhat about all your useless `cached_method`?",
    "created_at": "2015-05-26T07:20:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16953#issuecomment-235203",
    "user": "https://github.com/videlec"
}
```

<a id='comment:17'></a>Replying to [comment:16 vbraun]:
> Replying to [comment:15 vdelecroix]:
> > Replying to [comment:13 vbraun]:
> > > IMHO `copy(zero)` is much more readable that `zero[:]`.ething that isn't even cythonized. 

> > 
> > And you forgot that `copy(X)` needs `from copy import copy` which is very readable

> 
> I don't see how mixing up function bodies with import statements is ever going to yield a viable argument. In any case, I stand by my opinion that `copy(zero)` is much more readable that `zero[:]`.
> 
> > Really? what about #18411? 

> 
> There is no code on that ticket, and even if there were it depends on unfinished tickets. Its also unclear to me if it is ever going to be merged as some people have previously expressed a strong opinion on sage-devel for something that is named after cartesian product instead of `itertools.product`. In any case, this ticket long predates #18411 and is ready to be merged right now.


Then there is `cartesian_product_iterator`.

What about all your useless `cached_method`?



---

archive/issue_comments_235204.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [comment:17 vdelecroix]:\n> Then there is `cartesian_product_iterator`.\n\n\nHow about you discuss what to do with cartesian products on #18411?\n \n> What about all your useless `cached_method`?\n\n\nThey give names to quantities. Its true that you can replace the multiplicative order with q-1 everywhere, but it is not true that q-1 in a formula always refers to the order. Giving names to quantities makes code more readable as it explains the \"why\". And I'm using the general pattern of caching frequently-accessed methods, an extra `cached_method` has no performance impact but a forgotten `cached_method` can be very bad. Also, why should you have to read the finite fields implementation just to decide whether to cache something in this module?",
    "created_at": "2015-05-26T07:32:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16953#issuecomment-235204",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:18'></a>Replying to [comment:17 vdelecroix]:
> Then there is `cartesian_product_iterator`.


How about you discuss what to do with cartesian products on #18411?
 
> What about all your useless `cached_method`?


They give names to quantities. Its true that you can replace the multiplicative order with q-1 everywhere, but it is not true that q-1 in a formula always refers to the order. Giving names to quantities makes code more readable as it explains the "why". And I'm using the general pattern of caching frequently-accessed methods, an extra `cached_method` has no performance impact but a forgotten `cached_method` can be very bad. Also, why should you have to read the finite fields implementation just to decide whether to cache something in this module?



---

archive/issue_comments_235205.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-05-26T07:36:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16953#issuecomment-235205",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_235206.json:
```json
{
    "body": "<a id='comment:20'></a>Replying to [comment:18 vbraun]:\n> Replying to [comment:17 vdelecroix]:\n> > What about all your useless `cached_method`?\n\n> \n> They give names to quantities. Its true that you can replace the multiplicative order with q-1 everywhere, but it is not true that q-1 in a formula always refers to the order. Giving names to quantities makes code more readable as it explains the \"why\".\n\n\nWhat annoys me is that you add 20 lines of code + documentation + a non documented function for something which can be replaced by `self.ring.cardinality() - 1` and `self.ring.multiplicative_generator()` for which the names are not at all mysterious.\n\n> And I'm using the general pattern of caching frequently-accessed methods, an extra `cached_method` has no performance impact but a forgotten `cached_method` can be very bad.\n\n\n`cached_method` can also have **negative** impact on performances (for not that frequently-accessed methods). Creating dictionaries is costly, object creation is costly, function call is costly.\n\n> Also, why should you have to read the finite fields implementation just to decide whether to cache something in this module?\n\n\nHopefully I did it for you. It is clear that `multiplicative_generator` is something critical in many application and it looks natural to cache this method at the level of finite fields. And as a finite field is mostly defined by its cardinality, you can expect the method `cardinality` to be fast.\n\nVincent",
    "created_at": "2015-05-26T07:46:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16953#issuecomment-235206",
    "user": "https://github.com/videlec"
}
```

<a id='comment:20'></a>Replying to [comment:18 vbraun]:
> Replying to [comment:17 vdelecroix]:
> > What about all your useless `cached_method`?

> 
> They give names to quantities. Its true that you can replace the multiplicative order with q-1 everywhere, but it is not true that q-1 in a formula always refers to the order. Giving names to quantities makes code more readable as it explains the "why".


What annoys me is that you add 20 lines of code + documentation + a non documented function for something which can be replaced by `self.ring.cardinality() - 1` and `self.ring.multiplicative_generator()` for which the names are not at all mysterious.

> And I'm using the general pattern of caching frequently-accessed methods, an extra `cached_method` has no performance impact but a forgotten `cached_method` can be very bad.


`cached_method` can also have **negative** impact on performances (for not that frequently-accessed methods). Creating dictionaries is costly, object creation is costly, function call is costly.

> Also, why should you have to read the finite fields implementation just to decide whether to cache something in this module?


Hopefully I did it for you. It is clear that `multiplicative_generator` is something critical in many application and it looks natural to cache this method at the level of finite fields. And as a finite field is mostly defined by its cardinality, you can expect the method `cardinality` to be fast.

Vincent



---

archive/issue_comments_235207.json:
```json
{
    "body": "<a id='comment:21'></a>Replying to [comment:20 vdelecroix]:\n> What annoys me is that you add 20 lines of code + documentation + a non documented function for something which can be replaced by `self.ring.cardinality() - 1`\n\n\nLet me copy&paste what I sad before: Its true that you can replace the multiplicative order with q-1 everywhere, but it is not true that q-1 in a formula always refers to the order\n\n> `cached_method` can also have **negative** impact on performances (for not that frequently-accessed methods). Creating dictionaries is costly, object creation is costly, function call is costly.\n\n\nBenchmark or it is simply not true. There is no point in wasting effort on O(1) things. In fact it saves the `.ring` dictionary lookup but I didn't want to point that out since I consider that a stupid argument.\n\n> > Also, why should you have to read the finite fields implementation just to decide whether to cache something in this module?\n\n> Hopefully I did it for you.\n\nYou are missing the point, it is for the benefit of somebody reading the code in the future.",
    "created_at": "2015-05-26T07:53:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16953#issuecomment-235207",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:21'></a>Replying to [comment:20 vdelecroix]:
> What annoys me is that you add 20 lines of code + documentation + a non documented function for something which can be replaced by `self.ring.cardinality() - 1`


Let me copy&paste what I sad before: Its true that you can replace the multiplicative order with q-1 everywhere, but it is not true that q-1 in a formula always refers to the order

> `cached_method` can also have **negative** impact on performances (for not that frequently-accessed methods). Creating dictionaries is costly, object creation is costly, function call is costly.


Benchmark or it is simply not true. There is no point in wasting effort on O(1) things. In fact it saves the `.ring` dictionary lookup but I didn't want to point that out since I consider that a stupid argument.

> > Also, why should you have to read the finite fields implementation just to decide whether to cache something in this module?

> Hopefully I did it for you.

You are missing the point, it is for the benefit of somebody reading the code in the future.



---

archive/issue_comments_235208.json:
```json
{
    "body": "<a id='comment:22'></a>As the person most interested in the functionality of this ticket, let me reiterate that the ability to save partial progress would be far more important to me than optimization around the edges.",
    "created_at": "2015-05-26T14:49:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16953#issuecomment-235208",
    "user": "https://trac.sagemath.org/admin/accounts/users/ursula"
}
```

<a id='comment:22'></a>As the person most interested in the functionality of this ticket, let me reiterate that the ability to save partial progress would be far more important to me than optimization around the edges.



---

archive/issue_comments_235209.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-05-26T14:49:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16953#issuecomment-235209",
    "user": "https://trac.sagemath.org/admin/accounts/users/ursula"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_235210.json:
```json
{
    "body": "<a id='comment:24'></a>I hear you, and I agree that checkpointing is an important feature. But its not really clear how that should be implemented or how the interface would look like. I guess the iterator is (or can be made) pickleable, but really checkpointing needs to be added on the ``@`parallel` level. In the short run its probably easier to email William to request a longer timeout on your project...",
    "created_at": "2015-05-26T19:44:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16953#issuecomment-235210",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:24'></a>I hear you, and I agree that checkpointing is an important feature. But its not really clear how that should be implemented or how the interface would look like. I guess the iterator is (or can be made) pickleable, but really checkpointing needs to be added on the ``@`parallel` level. In the short run its probably easier to email William to request a longer timeout on your project...



---

archive/issue_comments_235211.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-05-26T23:34:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16953#issuecomment-235211",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_049456.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-05-26T23:34:29Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16953",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16953#event-49456"
}
```



---

archive/issue_comments_235212.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,26 @@\n+This ticket implements a specialized enumerator for points of a toric variety over a finite field. It uses linear algebra to solve the rescaling relations. It also parallelizes the enumeration of points for subvarieties of toric varieties. \n \n+For example:\n+\n+```\n+$ cat quintic.sage \n+p = 3\n+for k in range(1, 5):\n+    F = GF(p^k, 'a')\n+    P4.<z0,z1,z2,z3,z4> = toric_varieties.P(4, base_ring=F)\n+    X = P4.subscheme(z0^5+z1^5+z2^5+z3^5+z4^5-5*z0*z1*z2*z3*z4)\n+    print k, X.point_set().cardinality()\n+\n+$ time sage quintic.sage \n+1 36\n+2 816\n+3 20691\n+4 688800\n+\n+real 14m37.378s\n+user 136m37.989s\n+sys 0m18.268s\n+```\n \n Author: Volker Braun\n \n```\n",
    "created_at": "2015-09-06T16:25:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16953#issuecomment-235212",
    "user": "https://github.com/fchapoton"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,26 @@
+This ticket implements a specialized enumerator for points of a toric variety over a finite field. It uses linear algebra to solve the rescaling relations. It also parallelizes the enumeration of points for subvarieties of toric varieties. 
 
+For example:
+
+```
+$ cat quintic.sage 
+p = 3
+for k in range(1, 5):
+    F = GF(p^k, 'a')
+    P4.<z0,z1,z2,z3,z4> = toric_varieties.P(4, base_ring=F)
+    X = P4.subscheme(z0^5+z1^5+z2^5+z3^5+z4^5-5*z0*z1*z2*z3*z4)
+    print k, X.point_set().cardinality()
+
+$ time sage quintic.sage 
+1 36
+2 816
+3 20691
+4 688800
+
+real 14m37.378s
+user 136m37.989s
+sys 0m18.268s
+```
 
 Author: Volker Braun
 
```

