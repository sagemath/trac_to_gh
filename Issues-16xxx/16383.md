# Issue 16383: Can't evaluate a polynomial on a finite field if representation is not "poly"

archive/issues_016146.json:
```json
{
    "body": "Evaluating a polynomial on a finite field does not work if the finite\nfield was created with a 'repr' argument in the constructor different\nthan the default one (poly).\n\nCurently using sage 6.1.1 on ubuntu 12.04 but same behaviour in 6.2.\n\nHere is the code that works :\n\n```\nsage: F.<a>=GF(2**8)\nsage: PR.<x>=PolynomialRing(F)\nsage: f=PR.random_element(9)\nsage: b=F.random_element()\nsage: f(b)\na^6 + a^5 + a^4 + a^3 + a^2 + 1\n```\n\n\n\nAnd the same code with the repr parameter changed (same behaviour with\nrepr=\"int\") :\n\n```\nsage: F.<a>=GF(2**8, repr=\"log\")\nsage: PR.<x>=PolynomialRing(F)\nsage: f=PR.random_element(9)\nsage: b=F.random_element()\nsage: f(b)\n---------------------------------------------------------------------------\nNameError                                 Traceback (most recent call last)\n<ipython-input-5-a6714ffdcf66> in <module>()\n----> 1 f(b)\n\n/home/local/user/sage/sage-6.2-x86_64-Linux/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_zz_pex.so in sage.rings.polynomial.polynomial_zz_pex.Polynomial_ZZ_pEX.__call__ (sage/rings/polynomial/polynomial_zz_pex.cpp:14427)()\n\n/home/local/user/sage/sage-6.2-x86_64-Linux/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:8858)()\n\n/home/local/user/sage/sage-6.2-x86_64-Linux/local/lib/python2.7/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:4206)()\n\n/home/local/user/sage/sage-6.2-x86_64-Linux/local/lib/python2.7/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:4113)()\n\n/home/local/user/sage/sage-6.2-x86_64-Linux/local/lib/python2.7/site-packages/sage/rings/finite_rings/finite_field_givaro.pyc in _element_constructor_(self, e)\n    355             2*a4^3 + 2*a4^2 + 1\n    356         \"\"\"\n--> 357         return self._cache.element_from_data(e)\n    358 \n    359     def gen(self, n=0):\n\n/home/local/user/sage/sage-6.2-x86_64-Linux/local/lib/python2.7/site-packages/sage/rings/finite_rings/element_givaro.so in sage.rings.finite_rings.element_givaro.Cache_givaro.element_from_data (sage/rings/finite_rings/element_givaro.cpp:6459)()\n\n/home/local/user/sage/sage-6.2-x86_64-Linux/local/lib/python2.7/site-packages/sage/rings/finite_rings/element_givaro.so in sage.rings.finite_rings.element_givaro.Cache_givaro.element_from_data (sage/rings/finite_rings/element_givaro.cpp:5381)()\n\n<string> in <module>()\n```\n\n\n\n\n**CC:**  jpflori\n\n**Keywords:** polynomial finite field\n\n**Branch/Commit:** [193ae19bd7b1f3cb917e45297a7b60d764c3322a](https://github.com/sagemath/sagetrac-mirror/commit/193ae19bd7b1f3cb917e45297a7b60d764c3322a)\n\n**Reviewer:** Ralf Stephan\n\n**Author:** Peter Bruin\n\nIssue created by migration from https://trac.sagemath.org/ticket/16383\n\n",
    "closed_at": "2014-06-08T15:43:51Z",
    "created_at": "2014-05-21T09:55:05Z",
    "labels": [
        "component: finite rings",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.3",
    "title": "Can't evaluate a polynomial on a finite field if representation is not \"poly\"",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/16383",
    "user": "https://trac.sagemath.org/admin/accounts/users/landais"
}
```
Evaluating a polynomial on a finite field does not work if the finite
field was created with a 'repr' argument in the constructor different
than the default one (poly).

Curently using sage 6.1.1 on ubuntu 12.04 but same behaviour in 6.2.

Here is the code that works :

```
sage: F.<a>=GF(2**8)
sage: PR.<x>=PolynomialRing(F)
sage: f=PR.random_element(9)
sage: b=F.random_element()
sage: f(b)
a^6 + a^5 + a^4 + a^3 + a^2 + 1
```



And the same code with the repr parameter changed (same behaviour with
repr="int") :

```
sage: F.<a>=GF(2**8, repr="log")
sage: PR.<x>=PolynomialRing(F)
sage: f=PR.random_element(9)
sage: b=F.random_element()
sage: f(b)
---------------------------------------------------------------------------
NameError                                 Traceback (most recent call last)
<ipython-input-5-a6714ffdcf66> in <module>()
----> 1 f(b)

/home/local/user/sage/sage-6.2-x86_64-Linux/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_zz_pex.so in sage.rings.polynomial.polynomial_zz_pex.Polynomial_ZZ_pEX.__call__ (sage/rings/polynomial/polynomial_zz_pex.cpp:14427)()

/home/local/user/sage/sage-6.2-x86_64-Linux/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:8858)()

/home/local/user/sage/sage-6.2-x86_64-Linux/local/lib/python2.7/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:4206)()

/home/local/user/sage/sage-6.2-x86_64-Linux/local/lib/python2.7/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:4113)()

/home/local/user/sage/sage-6.2-x86_64-Linux/local/lib/python2.7/site-packages/sage/rings/finite_rings/finite_field_givaro.pyc in _element_constructor_(self, e)
    355             2*a4^3 + 2*a4^2 + 1
    356         """
--> 357         return self._cache.element_from_data(e)
    358 
    359     def gen(self, n=0):

/home/local/user/sage/sage-6.2-x86_64-Linux/local/lib/python2.7/site-packages/sage/rings/finite_rings/element_givaro.so in sage.rings.finite_rings.element_givaro.Cache_givaro.element_from_data (sage/rings/finite_rings/element_givaro.cpp:6459)()

/home/local/user/sage/sage-6.2-x86_64-Linux/local/lib/python2.7/site-packages/sage/rings/finite_rings/element_givaro.so in sage.rings.finite_rings.element_givaro.Cache_givaro.element_from_data (sage/rings/finite_rings/element_givaro.cpp:5381)()

<string> in <module>()
```




**CC:**  jpflori

**Keywords:** polynomial finite field

**Branch/Commit:** [193ae19bd7b1f3cb917e45297a7b60d764c3322a](https://github.com/sagemath/sagetrac-mirror/commit/193ae19bd7b1f3cb917e45297a7b60d764c3322a)

**Reviewer:** Ralf Stephan

**Author:** Peter Bruin

Issue created by migration from https://trac.sagemath.org/ticket/16383





---

archive/issue_comments_213814.json:
```json
{
    "body": "<a id='comment:1'></a>\nA strange workaround :\n\nCreate the finite field with repr=\"poly\" then evaluate any polynomial in any point then change the representation of finite field elements.\n\nDemo : \n\n```\nsage: F.<a>=GF(2**8)\nsage: PR.<x>=PolynomialRing(F)\nsage: f=PR.random_element(9)\nsage: b=F.random_element()\nsage: f(b)\na^6 + a^5 + a^4 + a^3\nsage: F._cache.repr=1\nsage: f(b)\n78\nsage: f=PR.random_element(9)\nsage: f(b)\n204\nsage: f=PR.random_element(7)\nsage: b=F.random_element()\nsage: f(b)\n151\n```\n\nIf you don't evaluate a polynomial before changing the representation, it does not work. I don't know if changing the representation this way has any side effect.",
    "created_at": "2014-05-22T15:01:01Z",
    "issue": "https://github.com/sagemath/sage/issues/16383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16383#issuecomment-213814",
    "user": "https://trac.sagemath.org/admin/accounts/users/landais"
}
```

<a id='comment:1'></a>
A strange workaround :

Create the finite field with repr="poly" then evaluate any polynomial in any point then change the representation of finite field elements.

Demo : 

```
sage: F.<a>=GF(2**8)
sage: PR.<x>=PolynomialRing(F)
sage: f=PR.random_element(9)
sage: b=F.random_element()
sage: f(b)
a^6 + a^5 + a^4 + a^3
sage: F._cache.repr=1
sage: f(b)
78
sage: f=PR.random_element(9)
sage: f(b)
204
sage: f=PR.random_element(7)
sage: b=F.random_element()
sage: f(b)
151
```

If you don't evaluate a polynomial before changing the representation, it does not work. I don't know if changing the representation this way has any side effect.



---

archive/issue_events_146337.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/landais",
    "created_at": "2014-05-22T15:03:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16383",
    "label": "component: misc",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16383#event-146337"
}
```



---

archive/issue_events_146338.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/landais",
    "created_at": "2014-05-22T15:03:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16383",
    "label": "component: finite rings",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16383#event-146338"
}
```



---

archive/issue_comments_213815.json:
```json
{
    "body": "<a id='comment:3'></a>\nIt turns out that this is caused by a stupid string-based conversion between different implementations of the same finite field.  I'm now testing a patch that uses a more direct conversion instead, which also makes evaluation 20% faster in your example.",
    "created_at": "2014-05-22T17:41:48Z",
    "issue": "https://github.com/sagemath/sage/issues/16383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16383#issuecomment-213815",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:3'></a>
It turns out that this is caused by a stupid string-based conversion between different implementations of the same finite field.  I'm now testing a patch that uses a more direct conversion instead, which also makes evaluation 20% faster in your example.



---

archive/issue_events_146339.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-05-22T18:08:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16383",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16383#event-146339"
}
```



---

archive/issue_comments_213816.json:
```json
{
    "body": "**Author:** Peter Bruin",
    "created_at": "2014-05-22T18:08:10Z",
    "issue": "https://github.com/sagemath/sage/issues/16383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16383#issuecomment-213816",
    "user": "https://github.com/pjbruin"
}
```

**Author:** Peter Bruin



---

archive/issue_events_146340.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-05-22T18:08:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16383",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16383#event-146340"
}
```



---

archive/issue_comments_213817.json:
```json
{
    "body": "**Commit:** [193ae19bd7b1f3cb917e45297a7b60d764c3322a](https://github.com/sagemath/sagetrac-mirror/commit/193ae19bd7b1f3cb917e45297a7b60d764c3322a)",
    "created_at": "2014-05-22T18:08:10Z",
    "issue": "https://github.com/sagemath/sage/issues/16383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16383#issuecomment-213817",
    "user": "https://github.com/pjbruin"
}
```

**Commit:** [193ae19bd7b1f3cb917e45297a7b60d764c3322a](https://github.com/sagemath/sagetrac-mirror/commit/193ae19bd7b1f3cb917e45297a7b60d764c3322a)



---

archive/issue_comments_213818.json:
```json
{
    "body": "**Branch:** [u/pbruin/16383-polynomial_evaluation](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/16383-polynomial_evaluation)",
    "created_at": "2014-05-22T18:08:10Z",
    "issue": "https://github.com/sagemath/sage/issues/16383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16383#issuecomment-213818",
    "user": "https://github.com/pjbruin"
}
```

**Branch:** [u/pbruin/16383-polynomial_evaluation](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/16383-polynomial_evaluation)



---

archive/issue_events_146341.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-06-07T14:29:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16383",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16383#event-146341"
}
```



---

archive/issue_events_146342.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-06-07T14:29:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16383",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16383#event-146342"
}
```



---

archive/issue_comments_213819.json:
```json
{
    "body": "**Reviewer:** Ralf Stephan",
    "created_at": "2014-06-07T14:29:55Z",
    "issue": "https://github.com/sagemath/sage/issues/16383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16383#issuecomment-213819",
    "user": "https://github.com/rwst"
}
```

**Reviewer:** Ralf Stephan



---

archive/issue_comments_213820.json:
```json
{
    "body": "<a id='comment:6'></a>\nPatchbot is happy with this, doctest is included with reference to ticket, and the changes are so minimal that I can immediately accept it.",
    "created_at": "2014-06-07T14:29:55Z",
    "issue": "https://github.com/sagemath/sage/issues/16383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16383#issuecomment-213820",
    "user": "https://github.com/rwst"
}
```

<a id='comment:6'></a>
Patchbot is happy with this, doctest is included with reference to ticket, and the changes are so minimal that I can immediately accept it.



---

archive/issue_comments_213821.json:
```json
{
    "body": "**Changing branch** from \"[u/pbruin/16383-polynomial_evaluation](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/16383-polynomial_evaluation)\" to \"[193ae19bd7b1f3cb917e45297a7b60d764c3322a](https://github.com/sagemath/sagetrac-mirror/commit/193ae19bd7b1f3cb917e45297a7b60d764c3322a)\".",
    "created_at": "2014-06-08T15:43:51Z",
    "issue": "https://github.com/sagemath/sage/issues/16383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16383#issuecomment-213821",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/pbruin/16383-polynomial_evaluation](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/16383-polynomial_evaluation)" to "[193ae19bd7b1f3cb917e45297a7b60d764c3322a](https://github.com/sagemath/sagetrac-mirror/commit/193ae19bd7b1f3cb917e45297a7b60d764c3322a)".



---

archive/issue_events_146343.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-06-08T15:43:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16383",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16383#event-146343"
}
```



---

archive/issue_events_146344.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "c794e8b99fdc3f681c9b19e20497b3686b48bfed",
    "created_at": "2014-06-08T15:43:51Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/16383",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16383#event-146344"
}
```
