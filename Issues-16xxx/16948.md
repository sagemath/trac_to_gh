# Issue 16948: Construct a quaternion algebra over a number field by specifying its ramification

archive/issues_016711.json:
```json
{
    "body": "There is a need for the constructor QuaternionAlgebra to take as input a number field F and a ramification (specified by an ideal D in F and a set of real places S of F) and which constructs a quaternion algebra over F with ramified precisely at the primes dividing D and at the places in S.\n\nWe have code to add here, which is now being tested and documented.\n\nCC:  @tornaria\n\nKeywords: quaternion algebra, ramification, number fields\n\nAuthor: Marc Masdeu, Xavier Guitart\n\nBranch: u/mmasdeu/16948-review\n\nStatus: needs_work\n\nCommit: fcf1a69ad070ee4528138ef95f1d4d22190aa4ae\n\nIssue created by migration from https://trac.sagemath.org/ticket/16948\n\n",
    "created_at": "2014-09-09T13:03:35Z",
    "labels": [
        "component: number theory",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.4",
    "title": "Construct a quaternion algebra over a number field by specifying its ramification",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16948",
    "user": "https://github.com/mmasdeu"
}
```
There is a need for the constructor QuaternionAlgebra to take as input a number field F and a ramification (specified by an ideal D in F and a set of real places S of F) and which constructs a quaternion algebra over F with ramified precisely at the primes dividing D and at the places in S.

We have code to add here, which is now being tested and documented.

CC:  @tornaria

Keywords: quaternion algebra, ramification, number fields

Author: Marc Masdeu, Xavier Guitart

Branch: u/mmasdeu/16948-review

Status: needs_work

Commit: fcf1a69ad070ee4528138ef95f1d4d22190aa4ae

Issue created by migration from https://trac.sagemath.org/ticket/16948





---

archive/issue_comments_235104.json:
```json
{
    "body": "<a id='comment:1'></a>The code passes all doctests and runs in reasonable time. I think it is ready for review.",
    "created_at": "2014-09-16T09:40:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16948#issuecomment-235104",
    "user": "https://github.com/mmasdeu"
}
```

<a id='comment:1'></a>The code passes all doctests and runs in reasonable time. I think it is ready for review.



---

archive/issue_comments_235105.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-09-16T09:40:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16948#issuecomment-235105",
    "user": "https://github.com/mmasdeu"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_235106.json:
```json
{
    "body": "<a id='comment:2'></a>Just a remark: this functionality is in PARI now, so you could just try to wrap PARI.",
    "created_at": "2015-05-30T10:33:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16948#issuecomment-235106",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>Just a remark: this functionality is in PARI now, so you could just try to wrap PARI.



---

archive/issue_comments_235107.json:
```json
{
    "body": "<a id='comment:3'></a>Please use python3 raise syntax: `raise Error('msg')`\n\nsee patchbot report in `plugin raise_statement` for the lines with a bad raise syntax",
    "created_at": "2015-07-08T12:14:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16948#issuecomment-235107",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:3'></a>Please use python3 raise syntax: `raise Error('msg')`

see patchbot report in `plugin raise_statement` for the lines with a bad raise syntax



---

archive/issue_events_049437.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2015-07-08T12:15:33Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16948",
    "milestone": "sage-6.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16948#event-49437"
}
```



---

archive/issue_comments_235108.json:
```json
{
    "body": "<a id='comment:5'></a>New commits:",
    "created_at": "2015-07-27T19:59:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16948#issuecomment-235108",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:5'></a>New commits:



---

archive/issue_events_049438.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2015-07-27T19:59:10Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16948",
    "milestone": "sage-6.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16948#event-49438"
}
```



---

archive/issue_events_049439.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2015-07-27T19:59:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16948",
    "milestone": "sage-6.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16948#event-49439"
}
```



---

archive/issue_comments_235109.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-28T08:24:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16948#issuecomment-235109",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_235110.json:
```json
{
    "body": "<a id='comment:7'></a>New commits:",
    "created_at": "2016-04-14T12:50:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16948#issuecomment-235110",
    "user": "https://github.com/mmasdeu"
}
```

<a id='comment:7'></a>New commits:



---

archive/issue_events_049440.json:
```json
{
    "actor": "https://github.com/mmasdeu",
    "created_at": "2016-04-14T12:50:50Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16948",
    "milestone": "sage-6.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16948#event-49440"
}
```



---

archive/issue_events_049441.json:
```json
{
    "actor": "https://github.com/mmasdeu",
    "created_at": "2016-04-14T12:50:50Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16948",
    "milestone": "sage-7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16948#event-49441"
}
```



---

archive/issue_comments_235111.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-07-14T19:12:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16948#issuecomment-235111",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_235112.json:
```json
{
    "body": "<a id='comment:9'></a>This no longer merges with sage 7.2 (according to trac).",
    "created_at": "2016-07-14T19:12:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16948#issuecomment-235112",
    "user": "https://github.com/roed314"
}
```

<a id='comment:9'></a>This no longer merges with sage 7.2 (according to trac).



---

archive/issue_comments_235113.json:
```json
{
    "body": "<a id='comment:10'></a>merge done, was easy\n\n---\nNew commits:",
    "created_at": "2016-07-14T19:16:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16948#issuecomment-235113",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:10'></a>merge done, was easy

---
New commits:



---

archive/issue_comments_235114.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-07-14T19:16:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16948#issuecomment-235114",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_events_049442.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-07-14T19:17:07Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16948",
    "milestone": "sage-7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16948#event-49442"
}
```



---

archive/issue_events_049443.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-07-14T19:17:07Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16948",
    "milestone": "sage-7.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16948#event-49443"
}
```



---

archive/issue_events_049444.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-08-10T08:04:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16948",
    "milestone": "sage-7.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16948#event-49444"
}
```



---

archive/issue_events_049445.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-08-10T08:04:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16948",
    "milestone": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16948#event-49445"
}
```



---

archive/issue_comments_235115.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-21T19:56:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16948#issuecomment-235115",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_235116.json:
```json
{
    "body": "<a id='comment:14'></a>A small remark regarding the ValueError in line 636: the exponents in the \ndiscriminant factorization should be equal to 1, and not just odd.\n\nBy the way, is there a reason why the input is an ideal of F instead of a list \nof prime ideals of F? If I want to construct a quaternion algebra with a \nprescribed ramification set of finite primes, I'd have to use their product as \ninput, and then the constructor would have to factor it back (see line 634).",
    "created_at": "2017-02-14T20:43:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16948#issuecomment-235116",
    "user": "https://github.com/nsirolli"
}
```

<a id='comment:14'></a>A small remark regarding the ValueError in line 636: the exponents in the 
discriminant factorization should be equal to 1, and not just odd.

By the way, is there a reason why the input is an ideal of F instead of a list 
of prime ideals of F? If I want to construct a quaternion algebra with a 
prescribed ramification set of finite primes, I'd have to use their product as 
input, and then the constructor would have to factor it back (see line 634).



---

archive/issue_comments_235117.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-02-14T20:49:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16948#issuecomment-235117",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_235118.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-02-14T20:53:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16948#issuecomment-235118",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_235119.json:
```json
{
    "body": "<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-02-14T20:59:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16948#issuecomment-235119",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_235120.json:
```json
{
    "body": "<a id='comment:18'></a>Thanks for the comments! Please take a look at the changes I have introduced.\n\nReplying to [comment:14 nmsirolli]:\n> A small remark regarding the ValueError in line 636: the exponents in the \n> discriminant factorization should be equal to 1, and not just odd.\n> \n> By the way, is there a reason why the input is an ideal of F instead of a list \n> of prime ideals of F? If I want to construct a quaternion algebra with a \n> prescribed ramification set of finite primes, I'd have to use their product as \n> input, and then the constructor would have to factor it back (see line 634).\n\n----\nNew commits:",
    "created_at": "2017-02-23T09:11:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16948#issuecomment-235120",
    "user": "https://github.com/mmasdeu"
}
```

<a id='comment:18'></a>Thanks for the comments! Please take a look at the changes I have introduced.

Replying to [comment:14 nmsirolli]:
> A small remark regarding the ValueError in line 636: the exponents in the 
> discriminant factorization should be equal to 1, and not just odd.
> 
> By the way, is there a reason why the input is an ideal of F instead of a list 
> of prime ideals of F? If I want to construct a quaternion algebra with a 
> prescribed ramification set of finite primes, I'd have to use their product as 
> input, and then the constructor would have to factor it back (see line 634).

----
New commits:



---

archive/issue_comments_235121.json:
```json
{
    "body": "<a id='comment:19'></a>Thanks for accepting my proposal.\n\nNow the new input format, QuaternionAlgebra(K, \"list of primes\", S) is quite different from the one you are extending to number fields other than QQ, QuaternionAlgebra(D). I feel this controversy should be avoided. The problem  could be addressed by letting this new constructor accept *both* a discriminant and a list of primes as input. A more radical solution would be to change the classical QuaternionAlgebra(D) to take a list of primes as input, but I guess that it could cause trouble.\n\nBesides this, here are some remarks about the changes introduced in this commit:\n\n- Line 245 of quaternion_algebra.py should be fixed, since it does not reflect the new input format.\n\n- The documentation needs to take account of these changes; see lines 92-94, 605-607, 625 of quaternion_algebra.py and line 1835 of number_fields.py\n\n- Line 589 of quaternion_algebra.py and lines 1804, 1815, 1817 of number_fields.py: shouldn't the name of the list of prime ideales be L or P instead of I?",
    "created_at": "2017-03-01T16:54:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16948#issuecomment-235121",
    "user": "https://github.com/nsirolli"
}
```

<a id='comment:19'></a>Thanks for accepting my proposal.

Now the new input format, QuaternionAlgebra(K, "list of primes", S) is quite different from the one you are extending to number fields other than QQ, QuaternionAlgebra(D). I feel this controversy should be avoided. The problem  could be addressed by letting this new constructor accept *both* a discriminant and a list of primes as input. A more radical solution would be to change the classical QuaternionAlgebra(D) to take a list of primes as input, but I guess that it could cause trouble.

Besides this, here are some remarks about the changes introduced in this commit:

- Line 245 of quaternion_algebra.py should be fixed, since it does not reflect the new input format.

- The documentation needs to take account of these changes; see lines 92-94, 605-607, 625 of quaternion_algebra.py and line 1835 of number_fields.py

- Line 589 of quaternion_algebra.py and lines 1804, 1815, 1817 of number_fields.py: shouldn't the name of the list of prime ideales be L or P instead of I?



---

archive/issue_comments_235122.json:
```json
{
    "body": "<a id='comment:20'></a>needs rebase, does not apply",
    "created_at": "2018-01-30T08:36:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16948#issuecomment-235122",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:20'></a>needs rebase, does not apply



---

archive/issue_comments_235123.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-01-30T08:36:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16948",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16948#issuecomment-235123",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.
