# Issue 16499: Cheap speedup in the OA recursive constructions

archive/issues_016262.json:
```json
{
    "body": "There is a lot to save by not trying to build an Orthogonal Array when ... we already know that we are going to fail.\n\nThis is the case when `orthogonal_arrays(k-1,n)` was called and returned \"Unknown\" : there is no point in trying to build an `orthogonal_array(k,n)` later.\n\nThis can be cheaply fixed by querying the cache before trying to build the design.\n\nThe \"clean\" fix would be to introduce a `is_available` along with the `existence` parameter, but this interface will probably change very soon so it is not the right time to touch all functions and deal with all combinations of existence/available/etc because of that. Besides, the current fix already does the job quite well.\n\nThis will all become an Object Oriented Hell quite soon anyway .... `:-P`\n\nNathann\n\nCC:  @videlec\n\nBranch/Commit: b3293519d314c2bd98c8074a4bd24f1535d92247\n\nReviewer: Vincent Delecroix\n\nAuthor: Nathann Cohen\n\nDependencies: #16423\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/16499\n\n",
    "closed_at": "2014-06-26T19:38:09Z",
    "created_at": "2014-06-19T14:57:07Z",
    "labels": [
        "component: combinatorial designs"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.3",
    "title": "Cheap speedup in the OA recursive constructions",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16499",
    "user": "https://github.com/nathanncohen"
}
```
There is a lot to save by not trying to build an Orthogonal Array when ... we already know that we are going to fail.

This is the case when `orthogonal_arrays(k-1,n)` was called and returned "Unknown" : there is no point in trying to build an `orthogonal_array(k,n)` later.

This can be cheaply fixed by querying the cache before trying to build the design.

The "clean" fix would be to introduce a `is_available` along with the `existence` parameter, but this interface will probably change very soon so it is not the right time to touch all functions and deal with all combinations of existence/available/etc because of that. Besides, the current fix already does the job quite well.

This will all become an Object Oriented Hell quite soon anyway .... `:-P`

Nathann

CC:  @videlec

Branch/Commit: b3293519d314c2bd98c8074a4bd24f1535d92247

Reviewer: Vincent Delecroix

Author: Nathann Cohen

Dependencies: #16423

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/16499





---

archive/issue_comments_272137.json:
```json
{
    "body": "<a id='comment:1'></a>Oh. And this patch also renames some private methods in a more \"object oriented\" way. Maybe it will become a real object, someday. Or be rewritten in Cython. \n\nLife.\n\nYou never know.\n\nNathann",
    "created_at": "2014-06-19T15:01:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16499#issuecomment-272137",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:1'></a>Oh. And this patch also renames some private methods in a more "object oriented" way. Maybe it will become a real object, someday. Or be rewritten in Cython. 

Life.

You never know.

Nathann



---

archive/issue_comments_272138.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-06-19T15:02:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16499#issuecomment-272138",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_272139.json:
```json
{
    "body": "Changing branch from \"\" to \"u/ncohen/16499\"",
    "created_at": "2014-06-19T15:02:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16499#issuecomment-272139",
    "user": "https://github.com/nathanncohen"
}
```

Changing branch from "" to "u/ncohen/16499"



---

archive/issue_comments_272140.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-06-19T15:03:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16499#issuecomment-272140",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_272141.json:
```json
{
    "body": "Changing commit from \"\" to \"f182d3691892b0b1cdde8f4ab61df26845eb3e8b\"",
    "created_at": "2014-06-19T15:03:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16499#issuecomment-272141",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "" to "f182d3691892b0b1cdde8f4ab61df26845eb3e8b"



---

archive/issue_comments_272142.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#16347\"",
    "created_at": "2014-06-19T15:04:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16499#issuecomment-272142",
    "user": "https://github.com/nathanncohen"
}
```

Changing dependencies from "" to "#16347"



---

archive/issue_comments_272143.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-06-25T10:57:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16499#issuecomment-272143",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_272144.json:
```json
{
    "body": "<a id='comment:5'></a>Needs non-trivial rebase over #16347.",
    "created_at": "2014-06-25T10:57:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16499#issuecomment-272144",
    "user": "https://github.com/videlec"
}
```

<a id='comment:5'></a>Needs non-trivial rebase over #16347.



---

archive/issue_comments_272145.json:
```json
{
    "body": "<a id='comment:6'></a>Rebased !\n\nNathann",
    "created_at": "2014-06-25T11:51:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16499#issuecomment-272145",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:6'></a>Rebased !

Nathann



---

archive/issue_comments_272146.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-06-25T11:51:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16499#issuecomment-272146",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_272147.json:
```json
{
    "body": "Changing commit from \"f182d3691892b0b1cdde8f4ab61df26845eb3e8b\" to \"934014ca028dfacf625284d401cd4c82aa9a0c39\"",
    "created_at": "2014-06-25T11:52:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16499#issuecomment-272147",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "f182d3691892b0b1cdde8f4ab61df26845eb3e8b" to "934014ca028dfacf625284d401cd4c82aa9a0c39"



---

archive/issue_comments_272148.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-06-25T11:52:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16499#issuecomment-272148",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_272149.json:
```json
{
    "body": "Changing commit from \"934014ca028dfacf625284d401cd4c82aa9a0c39\" to \"ee77d8e216b43560d0f22263cd4822ec7c5d5d91\"",
    "created_at": "2014-06-25T12:08:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16499#issuecomment-272149",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "934014ca028dfacf625284d401cd4c82aa9a0c39" to "ee77d8e216b43560d0f22263cd4822ec7c5d5d91"



---

archive/issue_comments_272150.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-06-25T12:08:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16499#issuecomment-272150",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_272151.json:
```json
{
    "body": "<a id='comment:9'></a>Hi Nathann,\n\nI propose to\n- move this over #16423\n- remove the `# long time` for the `MOLS_table` test\n- change 15 to 20 or 30 in the `MOLS_table`\nTimings are now\n\n```\nsage: from sage.combinat.designs.latin_squares import MOLS_table\nsage: from time import time\nsage: t0 = time(); MOLS_table(30); t1 = time()\n...\nsage: print t1 - t0\n3.6996819973\n```\nImpressive!\n\nVincent",
    "created_at": "2014-06-25T13:27:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16499#issuecomment-272151",
    "user": "https://github.com/videlec"
}
```

<a id='comment:9'></a>Hi Nathann,

I propose to
- move this over #16423
- remove the `# long time` for the `MOLS_table` test
- change 15 to 20 or 30 in the `MOLS_table`
Timings are now

```
sage: from sage.combinat.designs.latin_squares import MOLS_table
sage: from time import time
sage: t0 = time(); MOLS_table(30); t1 = time()
...
sage: print t1 - t0
3.6996819973
```
Impressive!

Vincent



---

archive/issue_comments_272152.json:
```json
{
    "body": "<a id='comment:10'></a>Yo !\n\n> - move this over #16423\n\n\nI will do this as soon as #16423 is reviewed.\n\n> - remove the `# long time` for the `MOLS_table` test\n> - change 15 to 20 or 30 in the `MOLS_table`\n\n\nNo need. We will have to set it back the way it is now as soon as #16500 is reviewed, unless there is a way to save time there.\n\n> Timings are now\n> \n> ```\n> sage: from sage.combinat.designs.latin_squares import MOLS_table\n> sage: from time import time\n> sage: t0 = time(); MOLS_table(30); t1 = time()\n> ...\n> sage: print t1 - t0\n> 3.6996819973\n> ```\n> Impressive!\n\n\nToo bad it will not last `:-/`\n\nNathann",
    "created_at": "2014-06-25T13:33:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16499#issuecomment-272152",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:10'></a>Yo !

> - move this over #16423


I will do this as soon as #16423 is reviewed.

> - remove the `# long time` for the `MOLS_table` test
> - change 15 to 20 or 30 in the `MOLS_table`


No need. We will have to set it back the way it is now as soon as #16500 is reviewed, unless there is a way to save time there.

> Timings are now
> 
> ```
> sage: from sage.combinat.designs.latin_squares import MOLS_table
> sage: from time import time
> sage: t0 = time(); MOLS_table(30); t1 = time()
> ...
> sage: print t1 - t0
> 3.6996819973
> ```
> Impressive!


Too bad it will not last `:-/`

Nathann



---

archive/issue_comments_272153.json:
```json
{
    "body": "Changing dependencies from \"#16347\" to \"#16423\"",
    "created_at": "2014-06-25T13:34:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16499#issuecomment-272153",
    "user": "https://github.com/nathanncohen"
}
```

Changing dependencies from "#16347" to "#16423"



---

archive/issue_comments_272154.json:
```json
{
    "body": "Changing commit from \"ee77d8e216b43560d0f22263cd4822ec7c5d5d91\" to \"b3293519d314c2bd98c8074a4bd24f1535d92247\"",
    "created_at": "2014-06-25T13:39:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16499#issuecomment-272154",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "ee77d8e216b43560d0f22263cd4822ec7c5d5d91" to "b3293519d314c2bd98c8074a4bd24f1535d92247"



---

archive/issue_comments_272155.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-06-25T13:39:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16499#issuecomment-272155",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_272156.json:
```json
{
    "body": "<a id='comment:13'></a>Good to me!\n\nVincent",
    "created_at": "2014-06-25T14:26:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16499#issuecomment-272156",
    "user": "https://github.com/videlec"
}
```

<a id='comment:13'></a>Good to me!

Vincent



---

archive/issue_comments_272157.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Vincent Delecroix\"",
    "created_at": "2014-06-25T14:26:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16499#issuecomment-272157",
    "user": "https://github.com/videlec"
}
```

Changing reviewer from "" to "Vincent Delecroix"



---

archive/issue_comments_272158.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-06-25T14:26:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16499#issuecomment-272158",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_272159.json:
```json
{
    "body": "Changing branch from \"u/ncohen/16499\" to \"b3293519d314c2bd98c8074a4bd24f1535d92247\"",
    "created_at": "2014-06-26T19:38:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16499#issuecomment-272159",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/ncohen/16499" to "b3293519d314c2bd98c8074a4bd24f1535d92247"



---

archive/issue_comments_272160.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-06-26T19:38:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16499",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16499#issuecomment-272160",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_048481.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-06-26T19:38:09Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16499",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16499#event-48481"
}
```
