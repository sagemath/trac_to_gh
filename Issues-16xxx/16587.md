# Issue 16587: f(expr,hold).n() fails for all generalized functions

archive/issues_016350.json:
```json
{
    "assignees": [],
    "body": "\n```\nsage: M = sgn((3/2),hold=True); M.n()\n...\nTypeError: cannot evaluate symbolic expression numerically\n```\nThe original problem is now resolved, it was reported in http://ask.sagemath.org/question/8535/problem-with-sign-sgn-and-n/ by Louis Cypher:\n\n```\nsage: M = sgn(cos(3/2))\nsage: M.n()\nTypeError                                 Traceback (most recent call last)\n<ipython-input-5-0f11e9bd1e87> in <module>()\n----> 1 M.n()\n\n/home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/expression.so in sage.symbolic.expression.Expression._numerical_approx (build/cythonized/sage/symbolic/expression.cpp:24086)()\n\nTypeError: cannot evaluate symbolic expression numerically\n```\nkcrisman:\n\nProblem seems to be that in `M.n??` we see that it's looking for `is_a_numeric(x._gobj)` but apparently that fails, as does the constant, so it thinks we are looking at evaluating `sgn(cos(x))` instead of `sgn(cos(3/2))`.\n\n\nDepends on #17130\nDepends on #17285\n\nCC:  @kcrisman\n\nKeywords: **sgn, evaluation**\n\nBranch/Commit: **[`e7880b7`](https://github.com/sagemath/sagetrac-mirror/commit/e7880b7caa636ff4d24bccacb5c21f4285d1164c)**\n\nReviewer: **Paul Masson**\n\nAuthor: **Ralf Stephan**\n\nComponent: **symbolics**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/16587_\n\n",
    "closed_at": "2016-07-09T16:29:25Z",
    "created_at": "2014-06-29T16:16:48Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "f(expr,hold).n() fails for all generalized functions",
    "type": "issue",
    "updated_at": "2016-07-09T16:29:25Z",
    "url": "https://github.com/sagemath/sage/issues/16587",
    "user": "https://github.com/rwst"
}
```

```
sage: M = sgn((3/2),hold=True); M.n()
...
TypeError: cannot evaluate symbolic expression numerically
```
The original problem is now resolved, it was reported in http://ask.sagemath.org/question/8535/problem-with-sign-sgn-and-n/ by Louis Cypher:

```
sage: M = sgn(cos(3/2))
sage: M.n()
TypeError                                 Traceback (most recent call last)
<ipython-input-5-0f11e9bd1e87> in <module>()
----> 1 M.n()

/home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/expression.so in sage.symbolic.expression.Expression._numerical_approx (build/cythonized/sage/symbolic/expression.cpp:24086)()

TypeError: cannot evaluate symbolic expression numerically
```
kcrisman:

Problem seems to be that in `M.n??` we see that it's looking for `is_a_numeric(x._gobj)` but apparently that fails, as does the constant, so it thinks we are looking at evaluating `sgn(cos(x))` instead of `sgn(cos(3/2))`.


Depends on #17130
Depends on #17285

CC:  @kcrisman

Keywords: **sgn, evaluation**

Branch/Commit: **[`e7880b7`](https://github.com/sagemath/sagetrac-mirror/commit/e7880b7caa636ff4d24bccacb5c21f4285d1164c)**

Reviewer: **Paul Masson**

Author: **Ralf Stephan**

Component: **symbolics**

_Issue created by migration from https://trac.sagemath.org/ticket/16587_





---

archive/issue_events_234942.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-06-29T16:16:48Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16587#event-234942"
}
```



---

archive/issue_events_234943.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-06-29T16:16:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
    "label_color": "0000ff",
    "label_name": "c: symbolics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16587#event-234943"
}
```



---

archive/issue_events_234944.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-06-29T16:16:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16587#event-234944"
}
```



---

archive/issue_events_234945.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-06-29T16:16:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16587#event-234945"
}
```



---

archive/issue_comments_215851.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nYou can always feel free to cc: me on any ticket coming from something I was involved in :)",
    "created_at": "2014-06-30T13:00:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16587#issuecomment-215851",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:1" align="right">comment:1</div>

You can always feel free to cc: me on any ticket coming from something I was involved in :)



---

archive/issue_events_234946.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16587#event-234946"
}
```



---

archive/issue_events_234947.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16587#event-234947"
}
```



---

archive/issue_events_234948.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-11-02T16:56:08Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "title_is": "f(expr).n() fails for all generalized functions",
    "title_was": "evaluation of sgn(expr) fails",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16587#event-234948"
}
```



---

archive/issue_comments_215852.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nActually all functions in `generalized.py` show this problem. Moreover, the `cos` can be left out:\n\n```\nsage: M = sgn((3/2),hold=True); M.n()\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-18-b9940d9ad473> in <module>()\n----> 1 M = sgn((Integer(3)/Integer(2)),hold=True); M.n()\n\n/home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/expression.so in sage.symbolic.expression.Expression._numerical_approx (build/cythonized/sage/symbolic/expression.cpp:27093)()\n\nTypeError: cannot evaluate symbolic expression numerically\n```\nAll the generalized functions have this code in `_eval_()` and I believe the bug to be there:\n\n```\n        try:\n            approx_x = ComplexIntervalField()(x)\n            if bool(approx_x.imag() == 0):      # x is real\n                if bool(approx_x.real() == 0):  # x is zero\n                    return ...\n                else:\n                    return ...\n            else:\n                return ...            # x is complex\n        except Exception:                     # x is symbolic\n            pass\n        return None\n```",
    "created_at": "2014-11-02T16:56:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16587#issuecomment-215852",
    "user": "https://github.com/rwst"
}
```

<div id="comment:3" align="right">comment:3</div>

Actually all functions in `generalized.py` show this problem. Moreover, the `cos` can be left out:

```
sage: M = sgn((3/2),hold=True); M.n()
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-18-b9940d9ad473> in <module>()
----> 1 M = sgn((Integer(3)/Integer(2)),hold=True); M.n()

/home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/expression.so in sage.symbolic.expression.Expression._numerical_approx (build/cythonized/sage/symbolic/expression.cpp:27093)()

TypeError: cannot evaluate symbolic expression numerically
```
All the generalized functions have this code in `_eval_()` and I believe the bug to be there:

```
        try:
            approx_x = ComplexIntervalField()(x)
            if bool(approx_x.imag() == 0):      # x is real
                if bool(approx_x.real() == 0):  # x is zero
                    return ...
                else:
                    return ...
            else:
                return ...            # x is complex
        except Exception:                     # x is symbolic
            pass
        return None
```



---

archive/issue_comments_215853.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nIsn't the problem simply that these functions are missing an `_evalf_()` method?",
    "created_at": "2014-11-03T09:39:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16587#issuecomment-215853",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:4" align="right">comment:4</div>

Isn't the problem simply that these functions are missing an `_evalf_()` method?



---

archive/issue_comments_215854.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nThanks. This begs for a subclass of `BuiltinFunction`.",
    "created_at": "2014-11-03T17:05:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16587#issuecomment-215854",
    "user": "https://github.com/rwst"
}
```

<div id="comment:5" align="right">comment:5</div>

Thanks. This begs for a subclass of `BuiltinFunction`.



---

archive/issue_comments_215855.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@rwst](#comment:5):\n> Thanks. This begs for a subclass of `BuiltinFunction`.\n\nI don't see why.",
    "created_at": "2014-11-03T19:59:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16587#issuecomment-215855",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@rwst](#comment:5):
> Thanks. This begs for a subclass of `BuiltinFunction`.

I don't see why.



---

archive/issue_comments_215856.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nLet me also mention that this ticket touches on similar issues as #17130. So if you make a patch, I would prefer it to be based on #17130 (although that ticket is still in needs_review).",
    "created_at": "2014-11-03T20:00:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16587#issuecomment-215856",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:7" align="right">comment:7</div>

Let me also mention that this ticket touches on similar issues as #17130. So if you make a patch, I would prefer it to be based on #17130 (although that ticket is still in needs_review).



---

archive/issue_comments_215857.json:
```json
{
    "body": "Branch: **[u/rws/f_expr__n___fails_for_all_generalized_functions](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/f_expr__n___fails_for_all_generalized_functions)**",
    "created_at": "2014-11-04T09:54:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16587#issuecomment-215857",
    "user": "https://github.com/rwst"
}
```

Branch: **[u/rws/f_expr__n___fails_for_all_generalized_functions](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/f_expr__n___fails_for_all_generalized_functions)**



---

archive/issue_comments_215858.json:
```json
{
    "body": "Commit: **[`44ca3ad`](https://github.com/sagemath/sagetrac-mirror/commit/44ca3ad0846f9e991e1cc54db796db304efc6938)**",
    "created_at": "2014-11-04T09:56:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16587#issuecomment-215858",
    "user": "https://github.com/rwst"
}
```

Commit: **[`44ca3ad`](https://github.com/sagemath/sagetrac-mirror/commit/44ca3ad0846f9e991e1cc54db796db304efc6938)**



---

archive/issue_comments_215859.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@jdemeyer](#comment:6):\n> Replying to [@rwst](#comment:5):\n> > Thanks. This begs for a subclass of `BuiltinFunction`.\n\n> I don't see why.\n\nBecause I didn't want to create an `evalf` for everyone of these. Documentation writing is pending your approval of this construct.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6d107297a5d8867f1a1e9996678ffa441adc8a2d\"><code>6d10729</code></a></td><td><code>Simplify numerical evaluation of BuiltinFunctions</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b6e1ed44a663f7410fddb2e3e4c134aa3a0ce8cf\"><code>b6e1ed4</code></a></td><td><code>Merge remote-tracking branches 'origin/u/jdemeyer/ticket/17131' and 'origin/u/jdemeyer/ticket/17133' into ticket/17130</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b83feedfb20cd22f0762b0476540bfd2aed48987\"><code>b83feed</code></a></td><td><code>Merge branch 'u/jdemeyer/ticket/17130' of trac.sagemath.org:sage into t/16587/f_expr__n___fails_for_all_generalized_functions</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/44ca3ad0846f9e991e1cc54db796db304efc6938\"><code>44ca3ad</code></a></td><td><code>16587: factor out general evalf</code></td></tr></table>\n",
    "created_at": "2014-11-04T09:56:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16587#issuecomment-215859",
    "user": "https://github.com/rwst"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@jdemeyer](#comment:6):
> Replying to [@rwst](#comment:5):
> > Thanks. This begs for a subclass of `BuiltinFunction`.

> I don't see why.

Because I didn't want to create an `evalf` for everyone of these. Documentation writing is pending your approval of this construct.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6d107297a5d8867f1a1e9996678ffa441adc8a2d"><code>6d10729</code></a></td><td><code>Simplify numerical evaluation of BuiltinFunctions</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b6e1ed44a663f7410fddb2e3e4c134aa3a0ce8cf"><code>b6e1ed4</code></a></td><td><code>Merge remote-tracking branches 'origin/u/jdemeyer/ticket/17131' and 'origin/u/jdemeyer/ticket/17133' into ticket/17130</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b83feedfb20cd22f0762b0476540bfd2aed48987"><code>b83feed</code></a></td><td><code>Merge branch 'u/jdemeyer/ticket/17130' of trac.sagemath.org:sage into t/16587/f_expr__n___fails_for_all_generalized_functions</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/44ca3ad0846f9e991e1cc54db796db304efc6938"><code>44ca3ad</code></a></td><td><code>16587: factor out general evalf</code></td></tr></table>




---

archive/issue_comments_215860.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@rwst](#comment:9):\n> Because I didn't want to create an `evalf` for everyone of these.\n\nBut now you create a `gen_eval()` method for everyone of those, why is that better?\n\n> Documentation writing is pending your approval of this construct.\n\nNo, I still do not see the reason for a new class.",
    "created_at": "2014-11-04T10:20:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16587#issuecomment-215860",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@rwst](#comment:9):
> Because I didn't want to create an `evalf` for everyone of these.

But now you create a `gen_eval()` method for everyone of those, why is that better?

> Documentation writing is pending your approval of this construct.

No, I still do not see the reason for a new class.



---

archive/issue_comments_215861.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nAlso, do we really need the `ComplexIntervalField` stuff in `_eval_`? I would replace it by a simple `if x == 0` or something like other functions...",
    "created_at": "2014-11-04T10:26:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16587#issuecomment-215861",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:11" align="right">comment:11</div>

Also, do we really need the `ComplexIntervalField` stuff in `_eval_`? I would replace it by a simple `if x == 0` or something like other functions...



---

archive/issue_comments_215862.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nWe also should decide whether\n\n```\nsage: sgn(cos(3/2))\n```\nshould automatically simplify to\n\n```\n1\n```\nor remain unevaluated.",
    "created_at": "2014-11-04T10:32:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16587#issuecomment-215862",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:12" align="right">comment:12</div>

We also should decide whether

```
sage: sgn(cos(3/2))
```
should automatically simplify to

```
1
```
or remain unevaluated.



---

archive/issue_comments_215863.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nRelated: #17285",
    "created_at": "2014-11-04T10:37:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16587#issuecomment-215863",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:13" align="right">comment:13</div>

Related: #17285



---

archive/issue_comments_215864.json:
```json
{
    "body": "Changed commit from **[`44ca3ad`](https://github.com/sagemath/sagetrac-mirror/commit/44ca3ad0846f9e991e1cc54db796db304efc6938)** to **[`cc22a9b`](https://github.com/sagemath/sagetrac-mirror/commit/cc22a9b489a841b23a6e9455bfea80a0b423c0e1)**",
    "created_at": "2014-11-04T16:06:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16587#issuecomment-215864",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`44ca3ad`](https://github.com/sagemath/sagetrac-mirror/commit/44ca3ad0846f9e991e1cc54db796db304efc6938)** to **[`cc22a9b`](https://github.com/sagemath/sagetrac-mirror/commit/cc22a9b489a841b23a6e9455bfea80a0b423c0e1)**



---

archive/issue_comments_215865.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cc22a9b489a841b23a6e9455bfea80a0b423c0e1\"><code>cc22a9b</code></a></td><td><code>16587: roll back previous commit, less the small fixes</code></td></tr></table>\n",
    "created_at": "2014-11-04T16:06:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16587#issuecomment-215865",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cc22a9b489a841b23a6e9455bfea80a0b423c0e1"><code>cc22a9b</code></a></td><td><code>16587: roll back previous commit, less the small fixes</code></td></tr></table>




---

archive/issue_comments_215866.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nPlease confirm this is what you think should go in as basic change to address the original issue. I feel `sgn(cos(3/2))` should give `1`. I'll try now if this works without `ComplexIntervalField`.",
    "created_at": "2014-11-04T16:09:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16587#issuecomment-215866",
    "user": "https://github.com/rwst"
}
```

<div id="comment:15" align="right">comment:15</div>

Please confirm this is what you think should go in as basic change to address the original issue. I feel `sgn(cos(3/2))` should give `1`. I'll try now if this works without `ComplexIntervalField`.



---

archive/issue_comments_215867.json:
```json
{
    "body": "Dependencies: **#17130, #17285**",
    "created_at": "2014-11-05T20:30:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16587#issuecomment-215867",
    "user": "https://github.com/jdemeyer"
}
```

Dependencies: **#17130, #17285**



---

archive/issue_comments_215868.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nAfter thinking about this more, perhaps the `ComplexIntervalField` solution isn't so bad after all. In any case, #17285 is the main reason that\n\n```\nsgn(cos(3/2))\n```\ndoesn't currently simplify to `1`.",
    "created_at": "2014-11-05T20:30:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16587#issuecomment-215868",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:16" align="right">comment:16</div>

After thinking about this more, perhaps the `ComplexIntervalField` solution isn't so bad after all. In any case, #17285 is the main reason that

```
sgn(cos(3/2))
```
doesn't currently simplify to `1`.



---

archive/issue_comments_215869.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nIs this related?\nhttps://groups.google.com/forum/?hl=en#!topic/sage-devel/rkkdK5qbPY0",
    "created_at": "2015-03-31T06:04:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16587#issuecomment-215869",
    "user": "https://github.com/rwst"
}
```

<div id="comment:17" align="right">comment:17</div>

Is this related?
https://groups.google.com/forum/?hl=en#!topic/sage-devel/rkkdK5qbPY0



---

archive/issue_comments_215870.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@jdemeyer](#comment:4):\n> Isn't the problem simply that these functions are missing an `_evalf_()` method?\n\nTo finally answer this, no, it will still trigger the exception with `M = sgn((3/2),hold=True); M.n()` and with `M = sgn(cos(3/2)); M.n()`.",
    "created_at": "2015-03-31T07:27:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16587#issuecomment-215870",
    "user": "https://github.com/rwst"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@jdemeyer](#comment:4):
> Isn't the problem simply that these functions are missing an `_evalf_()` method?

To finally answer this, no, it will still trigger the exception with `M = sgn((3/2),hold=True); M.n()` and with `M = sgn(cos(3/2)); M.n()`.



---

archive/issue_comments_215871.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -14,3 +14,6 @@\n kcrisman:\n \n Problem seems to be that in `M.n??` we see that it's looking for `is_a_numeric(x._gobj)` but apparently that fails, as does the constant, so it thinks we are looking at evaluating `sgn(cos(x))` instead of `sgn(cos(3/2))`.\n+\n+UPDATE:\n+The problem also appears with `polylog(2.,.9).n()` for example.\n``````\n",
    "created_at": "2015-05-27T05:52:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16587#issuecomment-215871",
    "user": "https://github.com/rwst"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -14,3 +14,6 @@
 kcrisman:
 
 Problem seems to be that in `M.n??` we see that it's looking for `is_a_numeric(x._gobj)` but apparently that fails, as does the constant, so it thinks we are looking at evaluating `sgn(cos(x))` instead of `sgn(cos(3/2))`.
+
+UPDATE:
+The problem also appears with `polylog(2.,.9).n()` for example.
``````




---

archive/issue_comments_215872.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,14 @@\n-As reported in http://ask.sagemath.org/question/8535/problem-with-sign-sgn-and-n/ by Louis Cypher:\n+\n+```\n+sage: M = sgn((3/2),hold=True); M.n()\n+...\n+TypeError: cannot evaluate symbolic expression numerically\n+sage: polylog(2.,.9).n()\n+...\n+TypeError: cannot evaluate symbolic expression numerically\n+\n+```\n+The original problem is now resolved, it was reported in http://ask.sagemath.org/question/8535/problem-with-sign-sgn-and-n/ by Louis Cypher:\n \n ```\n sage: M = sgn(cos(3/2))\n@@ -15,5 +25,3 @@\n \n Problem seems to be that in `M.n??` we see that it's looking for `is_a_numeric(x._gobj)` but apparently that fails, as does the constant, so it thinks we are looking at evaluating `sgn(cos(x))` instead of `sgn(cos(3/2))`.\n \n-UPDATE:\n-The problem also appears with `polylog(2.,.9).n()` for example.\n``````\n",
    "created_at": "2015-07-06T15:07:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16587#issuecomment-215872",
    "user": "https://github.com/rwst"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,14 @@
-As reported in http://ask.sagemath.org/question/8535/problem-with-sign-sgn-and-n/ by Louis Cypher:
+
+```
+sage: M = sgn((3/2),hold=True); M.n()
+...
+TypeError: cannot evaluate symbolic expression numerically
+sage: polylog(2.,.9).n()
+...
+TypeError: cannot evaluate symbolic expression numerically
+
+```
+The original problem is now resolved, it was reported in http://ask.sagemath.org/question/8535/problem-with-sign-sgn-and-n/ by Louis Cypher:
 
 ```
 sage: M = sgn(cos(3/2))
@@ -15,5 +25,3 @@
 
 Problem seems to be that in `M.n??` we see that it's looking for `is_a_numeric(x._gobj)` but apparently that fails, as does the constant, so it thinks we are looking at evaluating `sgn(cos(x))` instead of `sgn(cos(3/2))`.
 
-UPDATE:
-The problem also appears with `polylog(2.,.9).n()` for example.
``````




---

archive/issue_events_234949.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-07-06T15:07:15Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "title_is": "f(expr,hold).n() fails for all generalized functions",
    "title_was": "f(expr).n() fails for all generalized functions",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16587#event-234949"
}
```



---

archive/issue_comments_215873.json:
```json
{
    "body": "Changed branch from **[u/rws/f_expr__n___fails_for_all_generalized_functions](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/f_expr__n___fails_for_all_generalized_functions)** to **[u/rws/16587](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/16587)**",
    "created_at": "2015-07-08T13:03:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16587#issuecomment-215873",
    "user": "https://github.com/rwst"
}
```

Changed branch from **[u/rws/f_expr__n___fails_for_all_generalized_functions](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/f_expr__n___fails_for_all_generalized_functions)** to **[u/rws/16587](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/16587)**



---

archive/issue_comments_215874.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,10 +3,6 @@\n sage: M = sgn((3/2),hold=True); M.n()\n ...\n TypeError: cannot evaluate symbolic expression numerically\n-sage: polylog(2.,.9).n()\n-...\n-TypeError: cannot evaluate symbolic expression numerically\n-\n ```\n The original problem is now resolved, it was reported in http://ask.sagemath.org/question/8535/problem-with-sign-sgn-and-n/ by Louis Cypher:\n \n``````\n",
    "created_at": "2015-07-08T13:06:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16587#issuecomment-215874",
    "user": "https://github.com/rwst"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,10 +3,6 @@
 sage: M = sgn((3/2),hold=True); M.n()
 ...
 TypeError: cannot evaluate symbolic expression numerically
-sage: polylog(2.,.9).n()
-...
-TypeError: cannot evaluate symbolic expression numerically
-
 ```
 The original problem is now resolved, it was reported in http://ask.sagemath.org/question/8535/problem-with-sign-sgn-and-n/ by Louis Cypher:
 
``````




---

archive/issue_events_234950.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-07-08T13:06:04Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16587#event-234950"
}
```



---

archive/issue_events_234951.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-07-08T13:06:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "milestone_number": null,
    "milestone_title": "sage-6.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16587#event-234951"
}
```



---

archive/issue_comments_215875.json:
```json
{
    "body": "Changed commit from **[`cc22a9b`](https://github.com/sagemath/sagetrac-mirror/commit/cc22a9b489a841b23a6e9455bfea80a0b423c0e1)** to **[`7ef7c92`](https://github.com/sagemath/sagetrac-mirror/commit/7ef7c92cba5293f3d2c9f84e8488164b390b2458)**",
    "created_at": "2015-07-08T13:06:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16587#issuecomment-215875",
    "user": "https://github.com/rwst"
}
```

Changed commit from **[`cc22a9b`](https://github.com/sagemath/sagetrac-mirror/commit/cc22a9b489a841b23a6e9455bfea80a0b423c0e1)** to **[`7ef7c92`](https://github.com/sagemath/sagetrac-mirror/commit/7ef7c92cba5293f3d2c9f84e8488164b390b2458)**



---

archive/issue_events_234952.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-07-08T13:06:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16587#event-234952"
}
```



---

archive/issue_comments_215876.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@jdemeyer](#comment:4):\n> Isn't the problem simply that these functions are missing an `_evalf_()` method?\n\nYou were of course right. Please review. The polylog issue mentioned previously is part of #18386.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7ef7c92cba5293f3d2c9f84e8488164b390b2458\"><code>7ef7c92</code></a></td><td><code>16587: f(expr,hold).n() fails for all generalized functions</code></td></tr></table>\n",
    "created_at": "2015-07-08T13:06:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16587#issuecomment-215876",
    "user": "https://github.com/rwst"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@jdemeyer](#comment:4):
> Isn't the problem simply that these functions are missing an `_evalf_()` method?

You were of course right. Please review. The polylog issue mentioned previously is part of #18386.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7ef7c92cba5293f3d2c9f84e8488164b390b2458"><code>7ef7c92</code></a></td><td><code>16587: f(expr,hold).n() fails for all generalized functions</code></td></tr></table>




---

archive/issue_comments_215877.json:
```json
{
    "body": "Author: **Ralf Stephan**",
    "created_at": "2015-07-08T13:06:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16587#issuecomment-215877",
    "user": "https://github.com/rwst"
}
```

Author: **Ralf Stephan**



---

archive/issue_comments_215878.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nI tried to checkout this ticket and rebuild Sage but that failed. Branch needs updating.",
    "created_at": "2016-07-07T01:39:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16587#issuecomment-215878",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:23" align="right">comment:23</div>

I tried to checkout this ticket and rebuild Sage but that failed. Branch needs updating.



---

archive/issue_comments_215879.json:
```json
{
    "body": "Reviewer: **Paul Masson**",
    "created_at": "2016-07-07T01:39:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16587#issuecomment-215879",
    "user": "https://github.com/paulmasson"
}
```

Reviewer: **Paul Masson**



---

archive/issue_events_234953.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2016-07-07T01:39:23Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "milestone_number": null,
    "milestone_title": "sage-6.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16587#event-234953"
}
```



---

archive/issue_events_234954.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2016-07-07T01:39:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "milestone_number": null,
    "milestone_title": "sage-7.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16587#event-234954"
}
```



---

archive/issue_comments_215880.json:
```json
{
    "body": "<div id=\"comment:24\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e7159eb400a9ddf09b36c7a7c2d4b42be24df3bd\"><code>e7159eb</code></a></td><td><code>Merge branch 'develop' into t/16587/16587</code></td></tr></table>\n",
    "created_at": "2016-07-07T05:43:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16587#issuecomment-215880",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:24"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e7159eb400a9ddf09b36c7a7c2d4b42be24df3bd"><code>e7159eb</code></a></td><td><code>Merge branch 'develop' into t/16587/16587</code></td></tr></table>




---

archive/issue_comments_215881.json:
```json
{
    "body": "Changed commit from **[`7ef7c92`](https://github.com/sagemath/sagetrac-mirror/commit/7ef7c92cba5293f3d2c9f84e8488164b390b2458)** to **[`e7159eb`](https://github.com/sagemath/sagetrac-mirror/commit/e7159eb400a9ddf09b36c7a7c2d4b42be24df3bd)**",
    "created_at": "2016-07-07T05:43:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16587#issuecomment-215881",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`7ef7c92`](https://github.com/sagemath/sagetrac-mirror/commit/7ef7c92cba5293f3d2c9f84e8488164b390b2458)** to **[`e7159eb`](https://github.com/sagemath/sagetrac-mirror/commit/e7159eb400a9ddf09b36c7a7c2d4b42be24df3bd)**



---

archive/issue_comments_215882.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nThe branch merges cleanly with develop (green link) so it should have worked after `git merge develop` on your machine. However, I've done it for you in the branch now, so you can simply check out.",
    "created_at": "2016-07-07T05:46:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16587#issuecomment-215882",
    "user": "https://github.com/rwst"
}
```

<div id="comment:25" align="right">comment:25</div>

The branch merges cleanly with develop (green link) so it should have worked after `git merge develop` on your machine. However, I've done it for you in the branch now, so you can simply check out.



---

archive/issue_comments_215883.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nDoctests pass. `dirac_delta`, `heaviside`, `unit_step` and `sign` function as expected for real arguments.\n\n`kronecker_delta` returns an unexpected error for real arguments:\n\n```\nsage: kronecker_delta(1,2,hold=True).n()\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-27-089ce283036d> in <module>()\n----> 1 kronecker_delta(Integer(1),Integer(2),hold=True).n()\n\n/Users/Masson/Downloads/GitHub/sage/src/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression._numerical_approx (/Users/Masson/Downloads/GitHub/sage/src/build/cythonized/sage/symbolic/expression.cpp:31167)()\n   5430             pass          # try again with complex\n   5431             kwds['parent'] = R.complex_field()\n-> 5432             x = x._convert(kwds)\n   5433 \n   5434         # we have to consider constants as well, since infinity is a constant\n\n/Users/Masson/Downloads/GitHub/sage/src/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression._convert (/Users/Masson/Downloads/GitHub/sage/src/build/cythonized/sage/symbolic/expression.cpp:9677)()\n   1242             -0.989992496600445*sqrt(2)\n   1243         \"\"\"\n-> 1244         cdef GEx res = self._gobj.evalf(0, kwds)\n   1245         return new_Expression_from_GEx(self._parent, res)\n   1246 \n\nTypeError: _evalf_() takes exactly 2 arguments (5 given)\n\n```\n\nLooks like its trying to evaluate arguments as complex numbers.\n\nAnd for future reference, is it expected practice for people to merge the current develop branch before pushing to Trac? Or is it a matter of how the branch is assembled, especially for older tickets, and I just need to pay attention to what gets pulled?",
    "created_at": "2016-07-08T01:31:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16587#issuecomment-215883",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:26" align="right">comment:26</div>

Doctests pass. `dirac_delta`, `heaviside`, `unit_step` and `sign` function as expected for real arguments.

`kronecker_delta` returns an unexpected error for real arguments:

```
sage: kronecker_delta(1,2,hold=True).n()
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-27-089ce283036d> in <module>()
----> 1 kronecker_delta(Integer(1),Integer(2),hold=True).n()

/Users/Masson/Downloads/GitHub/sage/src/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression._numerical_approx (/Users/Masson/Downloads/GitHub/sage/src/build/cythonized/sage/symbolic/expression.cpp:31167)()
   5430             pass          # try again with complex
   5431             kwds['parent'] = R.complex_field()
-> 5432             x = x._convert(kwds)
   5433 
   5434         # we have to consider constants as well, since infinity is a constant

/Users/Masson/Downloads/GitHub/sage/src/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression._convert (/Users/Masson/Downloads/GitHub/sage/src/build/cythonized/sage/symbolic/expression.cpp:9677)()
   1242             -0.989992496600445*sqrt(2)
   1243         """
-> 1244         cdef GEx res = self._gobj.evalf(0, kwds)
   1245         return new_Expression_from_GEx(self._parent, res)
   1246 

TypeError: _evalf_() takes exactly 2 arguments (5 given)

```

Looks like its trying to evaluate arguments as complex numbers.

And for future reference, is it expected practice for people to merge the current develop branch before pushing to Trac? Or is it a matter of how the branch is assembled, especially for older tickets, and I just need to pay attention to what gets pulled?



---

archive/issue_comments_215884.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [@paulmasson](#comment:26):\n> And for future reference, is it expected practice for people to merge the current develop branch before pushing to Trac? Or is it a matter of how the branch is assembled, especially for older tickets, and I just need to pay attention to what gets pulled?\n\nThere should be as few merge commits as possible but you can't always adhere to that.\n\nAs author, you of course need to merge if what you uploaded before doesn't with develop (red link on ticket). But as you saw, there was a branch that was so old that it could no longer be compiled so I needed to merge it too. Note that as a reviewer you do not need to do `git trac checkout 12345; git merge develop` to get an up-to-date version of an older branch (that still merges cleanly). You can also branch from develop and pull changes: `git checkout -b tmp; git trac pull 12345`. This way your local Sage is not changed to the version of the branch and only the specific branch changes need to be compiled in.\n\nSo, to answer, in principle you need not merge the current develop branch before pushing as long as the branch merges cleanly with develop. A good reason to do it nevertheless would be that you want to make sure your changes pass tests (which are always done by patchbot or the RM with develop). What you want to pay attention to as reviewer OTOH is the age of the last merge commit (or the first commit if none) and rather pull (see above) than checkout if older than say 18 months.",
    "created_at": "2016-07-08T13:12:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16587#issuecomment-215884",
    "user": "https://github.com/rwst"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [@paulmasson](#comment:26):
> And for future reference, is it expected practice for people to merge the current develop branch before pushing to Trac? Or is it a matter of how the branch is assembled, especially for older tickets, and I just need to pay attention to what gets pulled?

There should be as few merge commits as possible but you can't always adhere to that.

As author, you of course need to merge if what you uploaded before doesn't with develop (red link on ticket). But as you saw, there was a branch that was so old that it could no longer be compiled so I needed to merge it too. Note that as a reviewer you do not need to do `git trac checkout 12345; git merge develop` to get an up-to-date version of an older branch (that still merges cleanly). You can also branch from develop and pull changes: `git checkout -b tmp; git trac pull 12345`. This way your local Sage is not changed to the version of the branch and only the specific branch changes need to be compiled in.

So, to answer, in principle you need not merge the current develop branch before pushing as long as the branch merges cleanly with develop. A good reason to do it nevertheless would be that you want to make sure your changes pass tests (which are always done by patchbot or the RM with develop). What you want to pay attention to as reviewer OTOH is the age of the last merge commit (or the first commit if none) and rather pull (see above) than checkout if older than say 18 months.



---

archive/issue_comments_215885.json:
```json
{
    "body": "Changed branch from **[u/rws/16587](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/16587)** to **[u/rws/16587-1](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/16587-1)**",
    "created_at": "2016-07-08T14:28:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16587#issuecomment-215885",
    "user": "https://github.com/rwst"
}
```

Changed branch from **[u/rws/16587](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/16587)** to **[u/rws/16587-1](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/16587-1)**



---

archive/issue_comments_215886.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nI rewrote it all and pushed a new branch (this is also a way to get rid of merge commits). There was danger of infinite loops (see #12121). It also resolved the `kronecker` issue. Please review.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e7880b7caa636ff4d24bccacb5c21f4285d1164c\"><code>e7880b7</code></a></td><td><code>16587: f(expr,hold).n() fails for all generalized functions</code></td></tr></table>\n",
    "created_at": "2016-07-08T14:31:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16587#issuecomment-215886",
    "user": "https://github.com/rwst"
}
```

<div id="comment:29" align="right">comment:29</div>

I rewrote it all and pushed a new branch (this is also a way to get rid of merge commits). There was danger of infinite loops (see #12121). It also resolved the `kronecker` issue. Please review.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e7880b7caa636ff4d24bccacb5c21f4285d1164c"><code>e7880b7</code></a></td><td><code>16587: f(expr,hold).n() fails for all generalized functions</code></td></tr></table>




---

archive/issue_comments_215887.json:
```json
{
    "body": "Changed commit from **[`e7159eb`](https://github.com/sagemath/sagetrac-mirror/commit/e7159eb400a9ddf09b36c7a7c2d4b42be24df3bd)** to **[`e7880b7`](https://github.com/sagemath/sagetrac-mirror/commit/e7880b7caa636ff4d24bccacb5c21f4285d1164c)**",
    "created_at": "2016-07-08T14:31:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16587#issuecomment-215887",
    "user": "https://github.com/rwst"
}
```

Changed commit from **[`e7159eb`](https://github.com/sagemath/sagetrac-mirror/commit/e7159eb400a9ddf09b36c7a7c2d4b42be24df3bd)** to **[`e7880b7`](https://github.com/sagemath/sagetrac-mirror/commit/e7880b7caa636ff4d24bccacb5c21f4285d1164c)**



---

archive/issue_comments_215888.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nDoctests pass. Functions behaved as expected as per ticket. Ready to go.",
    "created_at": "2016-07-08T21:47:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16587#issuecomment-215888",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:30" align="right">comment:30</div>

Doctests pass. Functions behaved as expected as per ticket. Ready to go.



---

archive/issue_events_234955.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2016-07-08T21:47:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16587#event-234955"
}
```



---

archive/issue_events_234956.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2016-07-08T21:47:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16587#event-234956"
}
```



---

archive/issue_comments_215889.json:
```json
{
    "body": "Changed branch from **[u/rws/16587-1](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/16587-1)** to **[`e7880b7`](https://github.com/sagemath/sagetrac-mirror/commit/e7880b7caa636ff4d24bccacb5c21f4285d1164c)**",
    "created_at": "2016-07-09T16:29:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16587#issuecomment-215889",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/rws/16587-1](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/16587-1)** to **[`e7880b7`](https://github.com/sagemath/sagetrac-mirror/commit/e7880b7caa636ff4d24bccacb5c21f4285d1164c)**



---

archive/issue_events_234957.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-07-09T16:29:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16587#event-234957"
}
```



---

archive/issue_events_234958.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "70e22c7c73390c4d4116bc9b875747733f943df6",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2016-07-09T16:29:25Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/16587",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16587#event-234958"
}
```
