# Issue 16992: Direct Fixdoctests

archive/issues_016755.json:
```json
{
    "body": "Now that we are actually using a versions control system as it is intended, the `sage --fixdoctests` workflow is a bit antiquated:\n\n* Run `sage --fixdoctests src/sage/foo.py`\n* Get a diff printed to stdout\n* copy `src/sage/foo.py.out` to `src/sage/foo.py`\n* Run `git diff` to get the same diff again\n\nInstead, just overwrite the file directly. Use version control for the rest.\n\nBranch/Commit: 1b99c68fdfe02cbbbc57fe4dab882505a136d3e6\n\nReviewer: Jeroen Demeyer\n\nAuthor: Volker Braun\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/16992\n\n",
    "closed_at": "2014-09-19T15:08:56Z",
    "created_at": "2014-09-16T11:33:55Z",
    "labels": [
        "component: scripts"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Direct Fixdoctests",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16992",
    "user": "https://github.com/vbraun"
}
```
Now that we are actually using a versions control system as it is intended, the `sage --fixdoctests` workflow is a bit antiquated:

* Run `sage --fixdoctests src/sage/foo.py`
* Get a diff printed to stdout
* copy `src/sage/foo.py.out` to `src/sage/foo.py`
* Run `git diff` to get the same diff again

Instead, just overwrite the file directly. Use version control for the rest.

Branch/Commit: 1b99c68fdfe02cbbbc57fe4dab882505a136d3e6

Reviewer: Jeroen Demeyer

Author: Volker Braun

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/16992





---

archive/issue_comments_285284.json:
```json
{
    "body": "Changing branch from \"\" to \"u/vbraun/direct_fixdoctests\"",
    "created_at": "2014-09-16T13:07:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16992",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16992#issuecomment-285284",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "" to "u/vbraun/direct_fixdoctests"



---

archive/issue_comments_285285.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2014-09-16T13:10:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16992",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16992#issuecomment-285285",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_285286.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to scripts.",
    "created_at": "2014-09-16T13:10:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16992",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16992#issuecomment-285286",
    "user": "https://github.com/vbraun"
}
```

Changing component from PLEASE CHANGE to scripts.



---

archive/issue_comments_285287.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-09-16T13:10:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16992",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16992#issuecomment-285287",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_285288.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,11 @@\n+Now that we are actually using a versions control system as it is intended, the `sage --fixdoctests` workflow is a bit antiquated:\n \n+* Run `sage --fixdoctests src/sage/foo.py`\n+* Get a diff printed to stdout\n+* copy `src/sage/foo.py.out` to `src/sage/foo.py`\n+* Run `git diff` to get the same diff again\n+\n+Instead, just overwrite the file directly. Use version control for the rest.\n \n Comment: 1\n \n``````\n",
    "created_at": "2014-09-16T13:10:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16992",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16992#issuecomment-285288",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,11 @@
+Now that we are actually using a versions control system as it is intended, the `sage --fixdoctests` workflow is a bit antiquated:
 
+* Run `sage --fixdoctests src/sage/foo.py`
+* Get a diff printed to stdout
+* copy `src/sage/foo.py.out` to `src/sage/foo.py`
+* Run `git diff` to get the same diff again
+
+Instead, just overwrite the file directly. Use version control for the rest.
 
 Comment: 1
 
``````




---

archive/issue_comments_285289.json:
```json
{
    "body": "Changing author from \"\" to \"Volker Braun\"",
    "created_at": "2014-09-16T13:10:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16992",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16992#issuecomment-285289",
    "user": "https://github.com/vbraun"
}
```

Changing author from "" to "Volker Braun"



---

archive/issue_comments_285290.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2014-09-16T13:10:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16992",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16992#issuecomment-285290",
    "user": "https://github.com/vbraun"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_285291.json:
```json
{
    "body": "Changing commit from \"\" to \"8c5f2b0e915d525b7984b43721a869b6040ed20f\"",
    "created_at": "2014-09-16T13:10:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16992",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16992#issuecomment-285291",
    "user": "https://github.com/vbraun"
}
```

Changing commit from "" to "8c5f2b0e915d525b7984b43721a869b6040ed20f"



---

archive/issue_comments_285292.json:
```json
{
    "body": "<a id='comment:3'></a>I would replace `sage -git` by `git` since this is supposed to be run from a Sage shell anyway.",
    "created_at": "2014-09-16T13:22:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16992",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16992#issuecomment-285292",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>I would replace `sage -git` by `git` since this is supposed to be run from a Sage shell anyway.



---

archive/issue_comments_285293.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-09-16T13:46:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16992",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16992#issuecomment-285293",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_285294.json:
```json
{
    "body": "Changing commit from \"8c5f2b0e915d525b7984b43721a869b6040ed20f\" to \"da59f20583c9a9aeb0ca64c9a1403da412666bd6\"",
    "created_at": "2014-09-16T13:46:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16992",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16992#issuecomment-285294",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "8c5f2b0e915d525b7984b43721a869b6040ed20f" to "da59f20583c9a9aeb0ca64c9a1403da412666bd6"



---

archive/issue_comments_285295.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-09-16T16:47:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16992",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16992#issuecomment-285295",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_285296.json:
```json
{
    "body": "<a id='comment:5'></a>You also need to fix the documentation (output of `./sage --advanced`)",
    "created_at": "2014-09-16T16:47:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16992",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16992#issuecomment-285296",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>You also need to fix the documentation (output of `./sage --advanced`)



---

archive/issue_comments_285297.json:
```json
{
    "body": "<a id='comment:6'></a>And could you please add a `\\n` to the output file, because otherwise you always get\n\n```diff\ndiff --git a/src/sage/rings/integer.pyx b/src/sage/rings/integer.pyx\nindex c85ba09..59cb6c1 100644\n--- a/src/sage/rings/integer.pyx\n+++ b/src/sage/rings/integer.pyx\n@@ -6515,4 +6515,4 @@ cdef double mpz_get_d_nearest(mpz_t x) except? -648555075988944.5:\n     cdef double d = <double>q64\n     if resultsign < 0:\n         d = -d\n-    return ldexp(d, shift)\n+    return ldexp(d, shift)\n\\ No newline at end of file\n```\n(I know you didn't introduce this bug, but it's such a trivial fix...)",
    "created_at": "2014-09-16T16:51:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16992",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16992#issuecomment-285297",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>And could you please add a `\n` to the output file, because otherwise you always get

```diff
diff --git a/src/sage/rings/integer.pyx b/src/sage/rings/integer.pyx
index c85ba09..59cb6c1 100644
--- a/src/sage/rings/integer.pyx
+++ b/src/sage/rings/integer.pyx
@@ -6515,4 +6515,4 @@ cdef double mpz_get_d_nearest(mpz_t x) except? -648555075988944.5:
     cdef double d = <double>q64
     if resultsign < 0:
         d = -d
-    return ldexp(d, shift)
+    return ldexp(d, shift)
\ No newline at end of file
```
(I know you didn't introduce this bug, but it's such a trivial fix...)



---

archive/issue_comments_285298.json:
```json
{
    "body": "<a id='comment:7'></a>Shouldn't\n\n```\nif relative.startswith('.'):\n```\nbe\n\n```\nif relative.startswith('..'):\n```\n(although it seems that `relpath` strips `./`)",
    "created_at": "2014-09-16T16:59:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16992",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16992#issuecomment-285298",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>Shouldn't

```
if relative.startswith('.'):
```
be

```
if relative.startswith('..'):
```
(although it seems that `relpath` strips `./`)



---

archive/issue_comments_285299.json:
```json
{
    "body": "<a id='comment:8'></a>There is of course a large margin for improvement in the `sage-fixdoctests` script (ideally, it should be integrated within the doctesting framework), but if you make the small changes I mentioned, I'm happy with this ticket.",
    "created_at": "2014-09-16T17:02:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16992",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16992#issuecomment-285299",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>There is of course a large margin for improvement in the `sage-fixdoctests` script (ideally, it should be integrated within the doctesting framework), but if you make the small changes I mentioned, I'm happy with this ticket.



---

archive/issue_comments_285300.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Jeroen Demeyer\"",
    "created_at": "2014-09-16T17:02:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16992",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16992#issuecomment-285300",
    "user": "https://github.com/jdemeyer"
}
```

Changing reviewer from "" to "Jeroen Demeyer"



---

archive/issue_comments_285301.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2014-09-16T18:33:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16992",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16992#issuecomment-285301",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_285302.json:
```json
{
    "body": "<a id='comment:9'></a>done",
    "created_at": "2014-09-16T18:33:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16992",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16992#issuecomment-285302",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:9'></a>done



---

archive/issue_comments_285303.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2014-09-16T18:33:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16992",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16992#issuecomment-285303",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_285304.json:
```json
{
    "body": "Changing commit from \"da59f20583c9a9aeb0ca64c9a1403da412666bd6\" to \"e397b3e6b1dfa0c0a7877adb89efa278495000f9\"",
    "created_at": "2014-09-16T18:33:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16992",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16992#issuecomment-285304",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "da59f20583c9a9aeb0ca64c9a1403da412666bd6" to "e397b3e6b1dfa0c0a7877adb89efa278495000f9"



---

archive/issue_comments_285305.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2014-09-16T18:33:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16992",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16992#issuecomment-285305",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_285306.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-09-16T19:35:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16992",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16992#issuecomment-285306",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_285307.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2014-09-18T14:35:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16992",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16992#issuecomment-285307",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_285308.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2014-09-18T14:35:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16992",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16992#issuecomment-285308",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_285309.json:
```json
{
    "body": "Changing commit from \"e397b3e6b1dfa0c0a7877adb89efa278495000f9\" to \"1b99c68fdfe02cbbbc57fe4dab882505a136d3e6\"",
    "created_at": "2014-09-18T14:35:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16992",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16992#issuecomment-285309",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e397b3e6b1dfa0c0a7877adb89efa278495000f9" to "1b99c68fdfe02cbbbc57fe4dab882505a136d3e6"



---

archive/issue_comments_285310.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-09-18T14:36:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16992",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16992#issuecomment-285310",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_285311.json:
```json
{
    "body": "<a id='comment:13'></a>Forgot the cmdline test...",
    "created_at": "2014-09-18T14:36:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16992",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16992#issuecomment-285311",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:13'></a>Forgot the cmdline test...



---

archive/issue_comments_285312.json:
```json
{
    "body": "<a id='comment:14'></a>Any reason you write\n\n```\nwith open(test_file, 'r') as f:\n    fixed_test = f.read()\n```\ninstead of\n\n```\n    fixed_test = open(test_file).read()\n```",
    "created_at": "2014-09-18T16:35:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16992",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16992#issuecomment-285312",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'></a>Any reason you write

```
with open(test_file, 'r') as f:
    fixed_test = f.read()
```
instead of

```
    fixed_test = open(test_file).read()
```



---

archive/issue_comments_285313.json:
```json
{
    "body": "<a id='comment:15'></a>I don't really care either way much, but to me the first version makes it clearer how long the file is actually open for.",
    "created_at": "2014-09-18T16:37:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16992",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16992#issuecomment-285313",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:15'></a>I don't really care either way much, but to me the first version makes it clearer how long the file is actually open for.



---

archive/issue_comments_285314.json:
```json
{
    "body": "<a id='comment:16'></a>lgtm (I was going to set positive_review but apparently you already did that :-p)",
    "created_at": "2014-09-18T19:23:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16992",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16992#issuecomment-285314",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>lgtm (I was going to set positive_review but apparently you already did that :-p)



---

archive/issue_comments_285315.json:
```json
{
    "body": "Changing branch from \"u/vbraun/direct_fixdoctests\" to \"1b99c68fdfe02cbbbc57fe4dab882505a136d3e6\"",
    "created_at": "2014-09-19T15:08:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16992",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16992#issuecomment-285315",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/vbraun/direct_fixdoctests" to "1b99c68fdfe02cbbbc57fe4dab882505a136d3e6"



---

archive/issue_comments_285316.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-09-19T15:08:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16992",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16992#issuecomment-285316",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_049507.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-09-19T15:08:56Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16992",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16992#event-49507"
}
```
