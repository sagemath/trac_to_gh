# Issue 16220: Waste of time in iterator_edges 3

archive/issues_015983.json:
```json
{
    "body": "Further optimizations for graph iterations following #16005.\n\nThe sparse graph backend (i.e. `sage.graphs.base.sparse_graph.SparseGraph` and `sage.graphs.base.sparse_graph.SparseGraphBackend`) lacks optimization especially for edge iteration. We need to see what is the best we can do and work on it!\n\nAssignee: @videlec\n\nCC:  @nathanncohen\n\nKeywords: graphs, datastructure\n\nReviewer: David Coudert\n\nResolution: duplicate\n\nIssue created by migration from https://trac.sagemath.org/ticket/16220\n\n",
    "closed_at": "2020-10-11T17:16:57Z",
    "created_at": "2014-04-23T13:32:39Z",
    "labels": [
        "component: graph theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Waste of time in iterator_edges 3",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16220",
    "user": "https://github.com/videlec"
}
```
Further optimizations for graph iterations following #16005.

The sparse graph backend (i.e. `sage.graphs.base.sparse_graph.SparseGraph` and `sage.graphs.base.sparse_graph.SparseGraphBackend`) lacks optimization especially for edge iteration. We need to see what is the best we can do and work on it!

Assignee: @videlec

CC:  @nathanncohen

Keywords: graphs, datastructure

Reviewer: David Coudert

Resolution: duplicate

Issue created by migration from https://trac.sagemath.org/ticket/16220





---

archive/issue_comments_207175.json:
```json
{
    "body": "Changing keywords from \"\" to \"graphs, datastructure\".",
    "created_at": "2014-04-23T13:39:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16220",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16220#issuecomment-207175",
    "user": "https://github.com/videlec"
}
```

Changing keywords from "" to "graphs, datastructure".



---

archive/issue_comments_207176.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2014-04-23T13:39:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16220",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16220#issuecomment-207176",
    "user": "https://github.com/videlec"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_207177.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2014-04-23T13:39:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16220",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16220#issuecomment-207177",
    "user": "https://github.com/videlec"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_207178.json:
```json
{
    "body": "<a id='comment:2'></a>Isn't there a problem if you want to iterate over the edges but stop midway ? Isn't it the case that the array is never deallocated ?\n\nNathann",
    "created_at": "2014-04-23T15:09:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16220",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16220#issuecomment-207178",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:2'></a>Isn't there a problem if you want to iterate over the edges but stop midway ? Isn't it the case that the array is never deallocated ?

Nathann



---

archive/issue_comments_207179.json:
```json
{
    "body": "<a id='comment:3'></a>Replying to [comment:2 ncohen]:\n> Isn't there a problem if you want to iterate over the edges but stop midway ? Isn't it the case that the array is never deallocated ?\n\n\nYou are right, with a code like\n\n```\nsage: it = build_me_an_edge_iterator()\nsage: it.next()\nsage: del it\n```\nwe keep an array never deallocated. But what happens for alloc/dealloc inside cdef functions?\n\nA solution would be to implement an iterator in Cython with direct access to the `SparseGraph` (doing all proper deallocation in `__dealloc__`). Is it worth it?",
    "created_at": "2014-04-23T15:18:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16220",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16220#issuecomment-207179",
    "user": "https://github.com/videlec"
}
```

<a id='comment:3'></a>Replying to [comment:2 ncohen]:
> Isn't there a problem if you want to iterate over the edges but stop midway ? Isn't it the case that the array is never deallocated ?


You are right, with a code like

```
sage: it = build_me_an_edge_iterator()
sage: it.next()
sage: del it
```
we keep an array never deallocated. But what happens for alloc/dealloc inside cdef functions?

A solution would be to implement an iterator in Cython with direct access to the `SparseGraph` (doing all proper deallocation in `__dealloc__`). Is it worth it?



---

archive/issue_comments_207180.json:
```json
{
    "body": "<a id='comment:4'></a>> we keep an array never deallocated. But what happens for alloc/dealloc inside cdef functions?\n\n\nI would say that it never happens, and that the only way is to create a class with a constructor/destructor. Which is a lot of code.\n\n> A solution would be to implement an iterator in Cython with direct access to the `SparseGraph` (doing all proper deallocation in `__dealloc__`). Is it worth it?\n\n\nWell, the question is whether an iterator is cheaper than a malloc.\n\nNathann",
    "created_at": "2014-04-23T15:21:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16220",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16220#issuecomment-207180",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:4'></a>> we keep an array never deallocated. But what happens for alloc/dealloc inside cdef functions?


I would say that it never happens, and that the only way is to create a class with a constructor/destructor. Which is a lot of code.

> A solution would be to implement an iterator in Cython with direct access to the `SparseGraph` (doing all proper deallocation in `__dealloc__`). Is it worth it?


Well, the question is whether an iterator is cheaper than a malloc.

Nathann



---

archive/issue_events_047804.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16220",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16220#event-47804"
}
```



---

archive/issue_events_047805.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16220",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16220#event-47805"
}
```



---

archive/issue_events_047806.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16220",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16220#event-47806"
}
```



---

archive/issue_comments_207181.json:
```json
{
    "body": "<a id='comment:7'></a>#30665 does some improvements to the edge iterator. It is surely not optimized out. Not sure, if we want to close this ticket here. Or keep it for further improvements.",
    "created_at": "2020-09-29T03:49:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16220",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16220#issuecomment-207181",
    "user": "https://github.com/kliem"
}
```

<a id='comment:7'></a>#30665 does some improvements to the edge iterator. It is surely not optimized out. Not sure, if we want to close this ticket here. Or keep it for further improvements.



---

archive/issue_comments_207182.json:
```json
{
    "body": "<a id='comment:8'></a>We can certainly close it.",
    "created_at": "2020-10-02T15:47:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16220",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16220#issuecomment-207182",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:8'></a>We can certainly close it.



---

archive/issue_events_047807.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-10-02T18:08:22Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16220",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16220#event-47807"
}
```



---

archive/issue_events_047808.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-10-02T18:08:22Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16220",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16220#event-47808"
}
```



---

archive/issue_comments_207183.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-10-02T18:08:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16220",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16220#issuecomment-207183",
    "user": "https://github.com/kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_207184.json:
```json
{
    "body": "<a id='comment:9'></a>With #30665, I think this can be closed. The branch certainly doesn't work anymore after redesign.",
    "created_at": "2020-10-02T18:08:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16220",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16220#issuecomment-207184",
    "user": "https://github.com/kliem"
}
```

<a id='comment:9'></a>With #30665, I think this can be closed. The branch certainly doesn't work anymore after redesign.



---

archive/issue_comments_207185.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-10-03T17:35:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16220",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16220#issuecomment-207185",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_207186.json:
```json
{
    "body": "<a id='comment:10'></a>Agreed.",
    "created_at": "2020-10-03T17:35:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16220",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16220#issuecomment-207186",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:10'></a>Agreed.



---

archive/issue_comments_207187.json:
```json
{
    "body": "Resolution: duplicate",
    "created_at": "2020-10-11T17:16:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16220",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16220#issuecomment-207187",
    "user": "https://github.com/slel"
}
```

Resolution: duplicate



---

archive/issue_events_047809.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2020-10-11T17:16:57Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16220",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16220#event-47809"
}
```
