# Issue 16650: Integrate APNG into show and save methods

archive/issues_016413.json:
```json
{
    "body": "Once #16571 and #7298 get merged, it is time to add support for animapted PNGs (APNG) to the `Animation.show()` and `Animation.save()` methods, and also to update the doctests to use `show(format=\"png\")` for these.\n\nCC:  @nilesjohnson\n\nKeywords: notebook, animate\n\nAuthor: Martin von Gagern\n\nBranch: u/gagern/ticket/16650\n\nStatus: needs_work\n\nDependencies: #7298, #16571\n\nCommit: 6c6eee310cbf66cbb954f423eb4d14592ef6e1fc\n\nIssue created by migration from https://trac.sagemath.org/ticket/16650\n\n",
    "created_at": "2014-07-12T18:32:18Z",
    "labels": [
        "component: graphics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Integrate APNG into show and save methods",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16650",
    "user": "https://github.com/gagern"
}
```
Once #16571 and #7298 get merged, it is time to add support for animapted PNGs (APNG) to the `Animation.show()` and `Animation.save()` methods, and also to update the doctests to use `show(format="png")` for these.

CC:  @nilesjohnson

Keywords: notebook, animate

Author: Martin von Gagern

Branch: u/gagern/ticket/16650

Status: needs_work

Dependencies: #7298, #16571

Commit: 6c6eee310cbf66cbb954f423eb4d14592ef6e1fc

Issue created by migration from https://trac.sagemath.org/ticket/16650





---

archive/issue_comments_276432.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-07-12T21:31:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16650#issuecomment-276432",
    "user": "https://github.com/gagern"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_276433.json:
```json
{
    "body": "Changing branch from \"\" to \"u/gagern/ticket/16650\"",
    "created_at": "2014-07-12T21:31:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16650#issuecomment-276433",
    "user": "https://github.com/gagern"
}
```

Changing branch from "" to "u/gagern/ticket/16650"



---

archive/issue_comments_276434.json:
```json
{
    "body": "<a id='comment:3'></a>Only the last commit is really new. The merge before that did resolve a conflict, but in a pretty obvious way. Everything else is from the named dependencies.\n\n---\nLast 10 new commits:",
    "created_at": "2014-07-12T21:33:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16650#issuecomment-276434",
    "user": "https://github.com/gagern"
}
```

<a id='comment:3'></a>Only the last commit is really new. The merge before that did resolve a conflict, but in a pretty obvious way. Everything else is from the named dependencies.

---
Last 10 new commits:



---

archive/issue_comments_276435.json:
```json
{
    "body": "Changing commit from \"\" to \"83d734ce657f10bdc7472d88aa4ab2035a8e4c66\"",
    "created_at": "2014-07-12T21:33:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16650#issuecomment-276435",
    "user": "https://github.com/gagern"
}
```

Changing commit from "" to "83d734ce657f10bdc7472d88aa4ab2035a8e4c66"



---

archive/issue_events_048824.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16650",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16650#event-48824"
}
```



---

archive/issue_comments_276436.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-09-02T21:25:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16650#issuecomment-276436",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_276437.json:
```json
{
    "body": "Changing commit from \"83d734ce657f10bdc7472d88aa4ab2035a8e4c66\" to \"1e4de99ab3ab7f16cb4451015d3b975135ff81df\"",
    "created_at": "2014-09-02T21:25:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16650#issuecomment-276437",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "83d734ce657f10bdc7472d88aa4ab2035a8e4c66" to "1e4de99ab3ab7f16cb4451015d3b975135ff81df"



---

archive/issue_comments_276438.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-01-06T17:40:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16650#issuecomment-276438",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_276439.json:
```json
{
    "body": "Changing commit from \"1e4de99ab3ab7f16cb4451015d3b975135ff81df\" to \"f5fc85780877227c7c5abecec684f102595a5d33\"",
    "created_at": "2015-01-06T17:40:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16650#issuecomment-276439",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "1e4de99ab3ab7f16cb4451015d3b975135ff81df" to "f5fc85780877227c7c5abecec684f102595a5d33"



---

archive/issue_comments_276440.json:
```json
{
    "body": "<a id='comment:8'></a>The recent changes from #17234 prevent our dependency #7298 from being merged, and at the moment I'm far from sure how to rebase that code, see[comment:48](#comment%3A48):ticket:7298. Once I get that rebased, there is one question regarding this ticket here as well:\n\nShould we reuse the PNG format description, or introduce a new one?\n\nOn the one hand, APNG (as opposed to MNG) is very much about graceful degradation, so it makes sense to treat it as PNG in most places. On the other hand, perhaps the display manager can decide whether a client is actually capable of displaying APNG or not. If so, we might prefer supported APNG over GIF, but GIF over unsupported APNG interpreted as still PNG. If the display manager does not know about APNG support, but does know that PNG is supported, then the user should at least be able to choose APNG format manually, even though it might not be the auto-selected default in that case.",
    "created_at": "2015-03-12T00:57:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16650#issuecomment-276440",
    "user": "https://github.com/gagern"
}
```

<a id='comment:8'></a>The recent changes from #17234 prevent our dependency #7298 from being merged, and at the moment I'm far from sure how to rebase that code, see[comment:48](#comment%3A48):ticket:7298. Once I get that rebased, there is one question regarding this ticket here as well:

Should we reuse the PNG format description, or introduce a new one?

On the one hand, APNG (as opposed to MNG) is very much about graceful degradation, so it makes sense to treat it as PNG in most places. On the other hand, perhaps the display manager can decide whether a client is actually capable of displaying APNG or not. If so, we might prefer supported APNG over GIF, but GIF over unsupported APNG interpreted as still PNG. If the display manager does not know about APNG support, but does know that PNG is supported, then the user should at least be able to choose APNG format manually, even though it might not be the auto-selected default in that case.



---

archive/issue_comments_276441.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-03-12T00:57:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16650#issuecomment-276441",
    "user": "https://github.com/gagern"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_276442.json:
```json
{
    "body": "<a id='comment:9'></a>Do not reuse `OutputImagePng`, that is for non-animated png.\n\nAnother basic output format should be a sequence of PNG, which can easily be displayed in a web browser with javascript (embed images as necessary). Perhaps the easiest animation format.",
    "created_at": "2015-03-12T10:49:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16650#issuecomment-276442",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:9'></a>Do not reuse `OutputImagePng`, that is for non-animated png.

Another basic output format should be a sequence of PNG, which can easily be displayed in a web browser with javascript (embed images as necessary). Perhaps the easiest animation format.



---

archive/issue_comments_276443.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [vbraun](#comment%3A9):\n> Another basic output format should be a sequence of PNG, which can easily be displayed in a web browser with javascript (embed images as necessary). Perhaps the easiest animation format.\n\n\nI'm not sure how much such a format would suffer from HTTP overhead, particularly for a large number of small frames. I guess it depends on the network connection (for the cloud in particular) whether that factor outweights the overhead of concatenating all PNGs to a single APNG file.\n\nBut if you are willing to use custom JavaScript code for animations, you could also use [existing code](http://www.devthought.com/projects/mootools/apng/) which provides APNG support on browsers which don't support it natively.",
    "created_at": "2015-03-12T11:07:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16650#issuecomment-276443",
    "user": "https://github.com/gagern"
}
```

<a id='comment:10'></a>Replying to [vbraun](#comment%3A9):
> Another basic output format should be a sequence of PNG, which can easily be displayed in a web browser with javascript (embed images as necessary). Perhaps the easiest animation format.


I'm not sure how much such a format would suffer from HTTP overhead, particularly for a large number of small frames. I guess it depends on the network connection (for the cloud in particular) whether that factor outweights the overhead of concatenating all PNGs to a single APNG file.

But if you are willing to use custom JavaScript code for animations, you could also use [existing code](http://www.devthought.com/projects/mootools/apng/) which provides APNG support on browsers which don't support it natively.



---

archive/issue_comments_276444.json:
```json
{
    "body": "<a id='comment:11'></a>I'm thinking about base64-encoded inline images, especially since IPython doesn't allow you to return arbitrary collections of files. Though an apng polyfill would work, too.",
    "created_at": "2015-03-12T12:11:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16650#issuecomment-276444",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:11'></a>I'm thinking about base64-encoded inline images, especially since IPython doesn't allow you to return arbitrary collections of files. Though an apng polyfill would work, too.



---

archive/issue_comments_276445.json:
```json
{
    "body": "<a id='comment:12'></a>I intend not to work on this until #7298 gets reviewed and ready for merge.",
    "created_at": "2015-08-26T07:15:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16650#issuecomment-276445",
    "user": "https://github.com/gagern"
}
```

<a id='comment:12'></a>I intend not to work on this until #7298 gets reviewed and ready for merge.



---

archive/issue_comments_276446.json:
```json
{
    "body": "Changing commit from \"f5fc85780877227c7c5abecec684f102595a5d33\" to \"de1dcbb0c93ab5364001b361d3616ed87a46a0da\"",
    "created_at": "2015-08-26T15:06:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16650#issuecomment-276446",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "f5fc85780877227c7c5abecec684f102595a5d33" to "de1dcbb0c93ab5364001b361d3616ed87a46a0da"



---

archive/issue_comments_276447.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-08-26T15:06:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16650#issuecomment-276447",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_276448.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-08-26T15:07:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16650#issuecomment-276448",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_276449.json:
```json
{
    "body": "Changing commit from \"de1dcbb0c93ab5364001b361d3616ed87a46a0da\" to \"6c6eee310cbf66cbb954f423eb4d14592ef6e1fc\"",
    "created_at": "2015-08-26T15:07:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16650#issuecomment-276449",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "de1dcbb0c93ab5364001b361d3616ed87a46a0da" to "6c6eee310cbf66cbb954f423eb4d14592ef6e1fc"



---

archive/issue_comments_276450.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-08-26T15:10:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16650#issuecomment-276450",
    "user": "https://github.com/gagern"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_276451.json:
```json
{
    "body": "<a id='comment:15'></a>Since #7298 received a positive review just now, here is a rebased version of this modification here. With the new rich representations framework, there was a lot more to do than in the original commits. But it integrates APNG nicely with all the rest.",
    "created_at": "2015-08-26T15:10:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16650#issuecomment-276451",
    "user": "https://github.com/gagern"
}
```

<a id='comment:15'></a>Since #7298 received a positive review just now, here is a rebased version of this modification here. With the new rich representations framework, there was a lot more to do than in the original commits. But it integrates APNG nicely with all the rest.



---

archive/issue_comments_276452.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-04-15T11:50:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16650#issuecomment-276452",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_276453.json:
```json
{
    "body": "<a id='comment:16'></a>does not apply",
    "created_at": "2018-04-15T11:50:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16650#issuecomment-276453",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:16'></a>does not apply
