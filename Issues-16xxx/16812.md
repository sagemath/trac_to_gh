# Issue 16812: use FLINT to speed up Chebyshev T polynomial creation

archive/issues_016575.json:
```json
{
    "body": "In #16670 the superiority of FLINT for creation of big Chebyshev-T-polynomials was confirmed. At T_10000 the speedup is already about 50x versus the present implementation. The issue is outsourced to this ticket.\n\nKeywords: flint, speedup\n\nAuthor: Ralf Stephan\n\nBranch: u/rws/16812\n\nDependencies: #24554, #24668\n\nCommit: d7a055df9b360f1f4941046bc99020455f4da09d\n\nIssue created by migration from https://trac.sagemath.org/ticket/16812\n\n",
    "created_at": "2014-08-13T14:07:44Z",
    "labels": [
        "component: symbolics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "use FLINT to speed up Chebyshev T polynomial creation",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16812",
    "user": "https://github.com/rwst"
}
```
In #16670 the superiority of FLINT for creation of big Chebyshev-T-polynomials was confirmed. At T_10000 the speedup is already about 50x versus the present implementation. The issue is outsourced to this ticket.

Keywords: flint, speedup

Author: Ralf Stephan

Branch: u/rws/16812

Dependencies: #24554, #24668

Commit: d7a055df9b360f1f4941046bc99020455f4da09d

Issue created by migration from https://trac.sagemath.org/ticket/16812





---

archive/issue_comments_217923.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-08-13T15:02:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217923",
    "user": "https://github.com/rwst"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_217924.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2014-08-13T15:02:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217924",
    "user": "https://github.com/rwst"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_217925.json:
```json
{
    "body": "Changing keywords from \"\" to \"flint, speedup\".",
    "created_at": "2014-08-13T15:02:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217925",
    "user": "https://github.com/rwst"
}
```

Changing keywords from "" to "flint, speedup".



---

archive/issue_comments_217926.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-08-13T15:39:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217926",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_217927.json:
```json
{
    "body": "<a id='comment:3'></a>Documentation is missing:\n\n```\ndef chebyshev_T(unsigned long n, var='x'):\n    \"\"\"\n    \"\"\"\n```",
    "created_at": "2014-08-13T15:39:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217927",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>Documentation is missing:

```
def chebyshev_T(unsigned long n, var='x'):
    """
    """
```



---

archive/issue_comments_217928.json:
```json
{
    "body": "<a id='comment:4'></a>Also the obvious question: can this be made to work also for `chebyshev_U`?",
    "created_at": "2014-08-13T15:42:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217928",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>Also the obvious question: can this be made to work also for `chebyshev_U`?



---

archive/issue_comments_217929.json:
```json
{
    "body": "<a id='comment:5'></a>I think the conditions `n>10 and is_PolynomialRing(P) and P.base() == ZZ and P.ngens() == 1 and x == P.gen()` should be generalized:\n\n1. It should work for any `n`, at least negative `n` should be supported.\n\n2. It should work for any ring of characteristic 0, not just `ZZ`.\n\n3. Ideally, it should work for any kind of non-constant polynomial, not just generators of univariate polynomial rings.\n\nPoint 2 and 3 could be supported by first computing the polynomial in `ZZ[x]` and then substituting and/or changing the base ring as needed. I'm not saying this is needed on this ticket, but it would be the right thing to do.",
    "created_at": "2014-08-13T15:49:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217929",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>I think the conditions `n>10 and is_PolynomialRing(P) and P.base() == ZZ and P.ngens() == 1 and x == P.gen()` should be generalized:

1. It should work for any `n`, at least negative `n` should be supported.

2. It should work for any ring of characteristic 0, not just `ZZ`.

3. Ideally, it should work for any kind of non-constant polynomial, not just generators of univariate polynomial rings.

Point 2 and 3 could be supported by first computing the polynomial in `ZZ[x]` and then substituting and/or changing the base ring as needed. I'm not saying this is needed on this ticket, but it would be the right thing to do.



---

archive/issue_comments_217930.json:
```json
{
    "body": "<a id='comment:6'></a>Why does flint_arith.chebyshev_T create an fmpz_poly, convert it to an array of ZZs, and then convert it back to a polynomial? Over ZZ[x], the roundtrip is probably more expensive than the actual computation. It should be enough to create a new Polynomial_integer_dense_flint instance and apply arith_chebyshev_t to its `.__poly` (the n > 10 condition can certainly be dropped).",
    "created_at": "2014-08-13T15:54:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217930",
    "user": "https://github.com/fredrik-johansson"
}
```

<a id='comment:6'></a>Why does flint_arith.chebyshev_T create an fmpz_poly, convert it to an array of ZZs, and then convert it back to a polynomial? Over ZZ[x], the roundtrip is probably more expensive than the actual computation. It should be enough to create a new Polynomial_integer_dense_flint instance and apply arith_chebyshev_t to its `.__poly` (the n > 10 condition can certainly be dropped).



---

archive/issue_comments_217931.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-08-13T15:55:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217931",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_217932.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:6 fredrik.johansson]:\n> ...It should be enough to create a new Polynomial_integer_dense_flint instance and apply arith_chebyshev_t to its `.__poly`\n\nWell, I tried that but needed to cast `polynomial.__poly` to `fmpz_poly_t` which is not possible in Cython because the type is an array. OTOH `cimport`ing the whole `class Polynomial_integer_dense_flint` declaration needs instances of the member functions defined. If I don't do that and just declare\n\n```\ncdef class Polynomial_integer_dense_flint(Polynomial):\n    cdef fmpz_poly_t __poly\n```\nthe function `libs.flint.arith.chebyshev_T` will finally compile but the result is not a `rings.polynomial.Polynomial_integer_dense_flint` and returning it and assigning it as such will bomb Sage.\n\nI will now add a member function `chebyshev_T` to `rings...Polynomial_integer_dense_flint` to avoid all that hassle. My first forage into Cython which certainly presents itself as a fickle customer.",
    "created_at": "2014-08-14T08:15:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217932",
    "user": "https://github.com/rwst"
}
```

<a id='comment:8'></a>Replying to [comment:6 fredrik.johansson]:
> ...It should be enough to create a new Polynomial_integer_dense_flint instance and apply arith_chebyshev_t to its `.__poly`

Well, I tried that but needed to cast `polynomial.__poly` to `fmpz_poly_t` which is not possible in Cython because the type is an array. OTOH `cimport`ing the whole `class Polynomial_integer_dense_flint` declaration needs instances of the member functions defined. If I don't do that and just declare

```
cdef class Polynomial_integer_dense_flint(Polynomial):
    cdef fmpz_poly_t __poly
```
the function `libs.flint.arith.chebyshev_T` will finally compile but the result is not a `rings.polynomial.Polynomial_integer_dense_flint` and returning it and assigning it as such will bomb Sage.

I will now add a member function `chebyshev_T` to `rings...Polynomial_integer_dense_flint` to avoid all that hassle. My first forage into Cython which certainly presents itself as a fickle customer.



---

archive/issue_comments_217933.json:
```json
{
    "body": "<a id='comment:9'></a>Putting a method on Polynomial_integer_dense_flint sounds like the easiest way to do it.",
    "created_at": "2014-08-14T08:22:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217933",
    "user": "https://github.com/fredrik-johansson"
}
```

<a id='comment:9'></a>Putting a method on Polynomial_integer_dense_flint sounds like the easiest way to do it.



---

archive/issue_comments_217934.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-08-14T09:00:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217934",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_217935.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-08-17T16:35:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217935",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_217936.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:5 jdemeyer]:\n> I think the conditions `n>10 and is_PolynomialRing(P) and P.base() == ZZ and P.ngens() == 1 and x == P.gen()` should be generalized:\n> \n> 1. It should work for any `n`, at least negative `n` should be supported.\n> \n> 2. It should work for any ring of characteristic 0, not just `ZZ`.\n> \n> 3. Ideally, it should work for any kind of non-constant polynomial, not just generators of univariate polynomial rings.\n> \n> Point 2 and 3 could be supported by first computing the polynomial in `ZZ[x]` and then substituting and/or changing the base ring as needed. I'm not saying this is needed on this ticket, but it would be the right thing to do.\n\nI have implemented this now and see no reason for the restriction in (2) to characteristic 0, as it seems to me that changing the base ring to, e.g., a finite field works nicely too.\n\nIn the process I uncovered at least two bugs.\n\nI have removed the padics doctest for the moment because it was evaluated using the new FLINT code and the subsequent substitution was a bit too much. In this case the recursive evaulation is actually faster. But I have no idea at the moment when to select which algorithm, in order to not to fall in this trap.",
    "created_at": "2014-08-17T16:36:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217936",
    "user": "https://github.com/rwst"
}
```

<a id='comment:12'></a>Replying to [comment:5 jdemeyer]:
> I think the conditions `n>10 and is_PolynomialRing(P) and P.base() == ZZ and P.ngens() == 1 and x == P.gen()` should be generalized:
> 
> 1. It should work for any `n`, at least negative `n` should be supported.
> 
> 2. It should work for any ring of characteristic 0, not just `ZZ`.
> 
> 3. Ideally, it should work for any kind of non-constant polynomial, not just generators of univariate polynomial rings.
> 
> Point 2 and 3 could be supported by first computing the polynomial in `ZZ[x]` and then substituting and/or changing the base ring as needed. I'm not saying this is needed on this ticket, but it would be the right thing to do.

I have implemented this now and see no reason for the restriction in (2) to characteristic 0, as it seems to me that changing the base ring to, e.g., a finite field works nicely too.

In the process I uncovered at least two bugs.

I have removed the padics doctest for the moment because it was evaluated using the new FLINT code and the subsequent substitution was a bit too much. In this case the recursive evaulation is actually faster. But I have no idea at the moment when to select which algorithm, in order to not to fall in this trap.



---

archive/issue_comments_217937.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-08-17T16:37:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217937",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_217938.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-08-18T09:34:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217938",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_217939.json:
```json
{
    "body": "<a id='comment:15'></a>Replying to [comment:12 rws]:\n> I have removed the padics doctest for the moment because it was evaluated using the new FLINT code and the subsequent substitution was a bit too much. In this case the recursive evaulation is actually faster. But I have no idea at the moment when to select which algorithm, in order to not to fall in this trap.\n\nneeds_work for exactly this reason.",
    "created_at": "2014-08-18T09:52:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217939",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>Replying to [comment:12 rws]:
> I have removed the padics doctest for the moment because it was evaluated using the new FLINT code and the subsequent substitution was a bit too much. In this case the recursive evaulation is actually faster. But I have no idea at the moment when to select which algorithm, in order to not to fall in this trap.

needs_work for exactly this reason.



---

archive/issue_comments_217940.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-08-18T09:52:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217940",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_217941.json:
```json
{
    "body": "<a id='comment:16'></a>For the p-adics, how about this: compute the leading term of the resulting polynomial, which is `2^(n-1)`. If that result is zero, use the recursive algorithm. Otherwise, use the FLINT algorithm.\n\nAs a general rule, one should **never** remove doctests to \"fix\" something, unless you can show that there is a problem with the doctest itself.",
    "created_at": "2014-08-18T09:56:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217941",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>For the p-adics, how about this: compute the leading term of the resulting polynomial, which is `2^(n-1)`. If that result is zero, use the recursive algorithm. Otherwise, use the FLINT algorithm.

As a general rule, one should **never** remove doctests to "fix" something, unless you can show that there is a problem with the doctest itself.



---

archive/issue_comments_217942.json:
```json
{
    "body": "<a id='comment:17'></a>Replying to [comment:12 rws]:\n> I have implemented this now and see no reason for the restriction in (2) to characteristic 0, as it seems to me that changing the base ring to, e.g., a finite field works nicely too.\n\nIt would certainly work in theory, but I just don't know if the FLINT algorithm is also faster in this case (I have not tried it).",
    "created_at": "2014-08-18T10:01:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217942",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>Replying to [comment:12 rws]:
> I have implemented this now and see no reason for the restriction in (2) to characteristic 0, as it seems to me that changing the base ring to, e.g., a finite field works nicely too.

It would certainly work in theory, but I just don't know if the FLINT algorithm is also faster in this case (I have not tried it).



---

archive/issue_comments_217943.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [comment:16 jdemeyer]:\n> As a general rule, one should **never** remove doctests to \"fix\" something, unless you can show that there is a problem with the doctest itself.\n\nI think you haven't noticed that I fixed a different doctest, not the p-adic one. Actually I was aware that the p-adic doctest should go in again, that's why I wrote \"for the moment\" earlier. I just wanted to have a version that passes all doctests (I failed to note that another doctest in a different file was bad).",
    "created_at": "2014-08-18T12:51:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217943",
    "user": "https://github.com/rwst"
}
```

<a id='comment:18'></a>Replying to [comment:16 jdemeyer]:
> As a general rule, one should **never** remove doctests to "fix" something, unless you can show that there is a problem with the doctest itself.

I think you haven't noticed that I fixed a different doctest, not the p-adic one. Actually I was aware that the p-adic doctest should go in again, that's why I wrote "for the moment" earlier. I just wanted to have a version that passes all doctests (I failed to note that another doctest in a different file was bad).



---

archive/issue_comments_217944.json:
```json
{
    "body": "<a id='comment:19'></a>Replying to [comment:18 rws]:\n> I think you haven't noticed that I fixed a different doctest, not the p-adic one.\n\nI don't understand what you're trying to say. Fixing one doctest is not an excuse for breaking a different doctest.\n\n> Actually I was aware that the p-adic doctest should go in again, that's why I wrote \"for the moment\" earlier. I just wanted to have a version that passes all doctests.\n\nOK fine, I understand that. But as long as not all those temporarily-removed doctests pass, a ticket should remain needs_work.",
    "created_at": "2014-08-18T13:25:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217944",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:19'></a>Replying to [comment:18 rws]:
> I think you haven't noticed that I fixed a different doctest, not the p-adic one.

I don't understand what you're trying to say. Fixing one doctest is not an excuse for breaking a different doctest.

> Actually I was aware that the p-adic doctest should go in again, that's why I wrote "for the moment" earlier. I just wanted to have a version that passes all doctests.

OK fine, I understand that. But as long as not all those temporarily-removed doctests pass, a ticket should remain needs_work.



---

archive/issue_comments_217945.json:
```json
{
    "body": "<a id='comment:20'></a>On another note, the behaviour of the function up to this is unexpectedly complicated and not documented. Given integer n, if the second argument is symbolic then if `n<32` a formula is applied else the recursive algorithm. With this ticket, additionally polynomials are handled with FLINT (modulo the refinements discussed).\n\nNow, I have a patch ready for an `algorithm` keyword (`flint`/`recursive`). Also, I want to remove that `n<32` bit together with the `eval_formula` method that really is no longer necessary now we have FLINT. It also leads to such inconsistencies as\n\n```\n            sage: var('n,x')\n            (n, x)\n            sage: chebyshev_T(5,x)\n            16*x^5 - 20*x^3 + 5*x\n            sage: chebyshev_T(64, x)\n            2*(2*(2*(2*(2*(2*x^2 - 1)^2 - 1)^2 - 1)^2 - 1)^2 - 1)^2 - 1\n```\nwhich I would like to have either so or so, not both.\n\nI think I propose to handle a symbolic argument exactly as a polynomial. No one expects such a nested result except if explicitly requested. It's also only faster because it's not expanded.\n\nDo you have any objections?",
    "created_at": "2014-08-18T13:46:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217945",
    "user": "https://github.com/rwst"
}
```

<a id='comment:20'></a>On another note, the behaviour of the function up to this is unexpectedly complicated and not documented. Given integer n, if the second argument is symbolic then if `n<32` a formula is applied else the recursive algorithm. With this ticket, additionally polynomials are handled with FLINT (modulo the refinements discussed).

Now, I have a patch ready for an `algorithm` keyword (`flint`/`recursive`). Also, I want to remove that `n<32` bit together with the `eval_formula` method that really is no longer necessary now we have FLINT. It also leads to such inconsistencies as

```
            sage: var('n,x')
            (n, x)
            sage: chebyshev_T(5,x)
            16*x^5 - 20*x^3 + 5*x
            sage: chebyshev_T(64, x)
            2*(2*(2*(2*(2*(2*x^2 - 1)^2 - 1)^2 - 1)^2 - 1)^2 - 1)^2 - 1
```
which I would like to have either so or so, not both.

I think I propose to handle a symbolic argument exactly as a polynomial. No one expects such a nested result except if explicitly requested. It's also only faster because it's not expanded.

Do you have any objections?



---

archive/issue_comments_217946.json:
```json
{
    "body": "<a id='comment:21'></a>Replying to [comment:20 rws]:\n> I think I propose to handle a symbolic argument exactly as a polynomial.\n> \n> Do you have any objections?\n\nNot at all, your suggestion sounds like a good idea.",
    "created_at": "2014-08-18T14:44:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217946",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:21'></a>Replying to [comment:20 rws]:
> I think I propose to handle a symbolic argument exactly as a polynomial.
> 
> Do you have any objections?

Not at all, your suggestion sounds like a good idea.



---

archive/issue_comments_217947.json:
```json
{
    "body": "<a id='comment:22'></a>Another bug: special values apply only to integer `n`, as `T(1/2, 0)` shows, where the formula for `x==0` in `_eval_special_values_()` gives complex values, while the correct result is `1/sqrt(2)`. So, assumptions have to be checked or the function restricted to `n in ZZ`.\n\nUpdate: changed `n==0` to `x==0` in the above.",
    "created_at": "2014-08-21T14:50:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217947",
    "user": "https://github.com/rwst"
}
```

<a id='comment:22'></a>Another bug: special values apply only to integer `n`, as `T(1/2, 0)` shows, where the formula for `x==0` in `_eval_special_values_()` gives complex values, while the correct result is `1/sqrt(2)`. So, assumptions have to be checked or the function restricted to `n in ZZ`.

Update: changed `n==0` to `x==0` in the above.



---

archive/issue_comments_217948.json:
```json
{
    "body": "<a id='comment:23'></a>I would also say there is a bug in mpmath because it cannot evaluate `chebyshev_T(10^6, 0.1)` without throwing a `mpmath.NoConvergence` while Sage's recursive algorithm is happy:\n\n```\nsage: chebyshev_T(10^6, 0.1, algorithm=\"recursive\")\n0.636384327171504\nsage: timeit('chebyshev_T(10^6, 0.1, algorithm=\"recursive\")')\n625 loops, best of 3: 229 \u00b5s per loop\n```\nThe result agrees with Wolfram to the 9th place which has `0.636384327247008190135495327481582817644932547700768253402752...`",
    "created_at": "2014-08-21T15:50:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217948",
    "user": "https://github.com/rwst"
}
```

<a id='comment:23'></a>I would also say there is a bug in mpmath because it cannot evaluate `chebyshev_T(10^6, 0.1)` without throwing a `mpmath.NoConvergence` while Sage's recursive algorithm is happy:

```
sage: chebyshev_T(10^6, 0.1, algorithm="recursive")
0.636384327171504
sage: timeit('chebyshev_T(10^6, 0.1, algorithm="recursive")')
625 loops, best of 3: 229 µs per loop
```
The result agrees with Wolfram to the 9th place which has `0.636384327247008190135495327481582817644932547700768253402752...`



---

archive/issue_comments_217949.json:
```json
{
    "body": "<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-08-22T09:17:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217949",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_217950.json:
```json
{
    "body": "<a id='comment:25'></a>This still needs some doctest cleanup.",
    "created_at": "2014-08-22T09:19:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217950",
    "user": "https://github.com/rwst"
}
```

<a id='comment:25'></a>This still needs some doctest cleanup.



---

archive/issue_comments_217951.json:
```json
{
    "body": "<a id='comment:26'></a>Replying to [comment:23 rws]:\n> I would also say there is a bug in mpmath because it cannot evaluate `chebyshev_T(10^6, 0.1)` without throwing a `mpmath.NoConvergence` while Sage's recursive algorithm is happy:\n\n\nYep, mpmath currently doesn't optimize Chebyshev polynomials in any way for integer n (it always just calls 2F1). So there's no reason for Sage to use it for numerical evaluation.",
    "created_at": "2014-08-22T10:53:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217951",
    "user": "https://github.com/fredrik-johansson"
}
```

<a id='comment:26'></a>Replying to [comment:23 rws]:
> I would also say there is a bug in mpmath because it cannot evaluate `chebyshev_T(10^6, 0.1)` without throwing a `mpmath.NoConvergence` while Sage's recursive algorithm is happy:


Yep, mpmath currently doesn't optimize Chebyshev polynomials in any way for integer n (it always just calls 2F1). So there's no reason for Sage to use it for numerical evaluation.



---

archive/issue_comments_217952.json:
```json
{
    "body": "<a id='comment:27'></a>Replying to [comment:20 rws]:\n> On another note, the behaviour of the function up to this is unexpectedly complicated and not documented. Given integer n, if the second argument is symbolic then if `n<32` a formula is applied else the recursive algorithm. With this ticket, additionally polynomials are handled with FLINT (modulo the refinements discussed).\n> \n> Now, I have a patch ready for an `algorithm` keyword (`flint`/`recursive`). Also, I want to remove that `n<32` bit together with the `eval_formula` method that really is no longer necessary now we have FLINT. It also leads to such inconsistencies as\n> \n> ```\n>             sage: var('n,x')\n>             (n, x)\n>             sage: chebyshev_T(5,x)\n>             16*x^5 - 20*x^3 + 5*x\n>             sage: chebyshev_T(64, x)\n>             2*(2*(2*(2*(2*(2*x^2 - 1)^2 - 1)^2 - 1)^2 - 1)^2 - 1)^2 - 1\n> ```\n> which I would like to have either so or so, not both.\n> \n> I think I propose to handle a symbolic argument exactly as a polynomial. No one expects such a nested result except if explicitly requested. It's also only faster because it's not expanded.\n> \n> Do you have any objections?\n\n\n\nYes I have. There are users (like me) who want the possibility to switch between this representations, especially for large values of n.\nSo please still allow to call the method explicitely.",
    "created_at": "2014-08-24T19:54:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217952",
    "user": "https://trac.sagemath.org/admin/accounts/users/maldun"
}
```

<a id='comment:27'></a>Replying to [comment:20 rws]:
> On another note, the behaviour of the function up to this is unexpectedly complicated and not documented. Given integer n, if the second argument is symbolic then if `n<32` a formula is applied else the recursive algorithm. With this ticket, additionally polynomials are handled with FLINT (modulo the refinements discussed).
> 
> Now, I have a patch ready for an `algorithm` keyword (`flint`/`recursive`). Also, I want to remove that `n<32` bit together with the `eval_formula` method that really is no longer necessary now we have FLINT. It also leads to such inconsistencies as
> 
> ```
>             sage: var('n,x')
>             (n, x)
>             sage: chebyshev_T(5,x)
>             16*x^5 - 20*x^3 + 5*x
>             sage: chebyshev_T(64, x)
>             2*(2*(2*(2*(2*(2*x^2 - 1)^2 - 1)^2 - 1)^2 - 1)^2 - 1)^2 - 1
> ```
> which I would like to have either so or so, not both.
> 
> I think I propose to handle a symbolic argument exactly as a polynomial. No one expects such a nested result except if explicitly requested. It's also only faster because it's not expanded.
> 
> Do you have any objections?



Yes I have. There are users (like me) who want the possibility to switch between this representations, especially for large values of n.
So please still allow to call the method explicitely.



---

archive/issue_comments_217953.json:
```json
{
    "body": "<a id='comment:28'></a>Replying to [comment:27 maldun]\n> Yes I have. There are users (like me) who want the possibility to switch between this representations, especially for large values of n.\n> So please still allow to call the method explicitely.\n\nExactly this is implemented. You can call the method, or you can say `algorithm=recursive`.",
    "created_at": "2014-08-25T03:30:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217953",
    "user": "https://github.com/rwst"
}
```

<a id='comment:28'></a>Replying to [comment:27 maldun]
> Yes I have. There are users (like me) who want the possibility to switch between this representations, especially for large values of n.
> So please still allow to call the method explicitely.

Exactly this is implemented. You can call the method, or you can say `algorithm=recursive`.



---

archive/issue_comments_217954.json:
```json
{
    "body": "<a id='comment:29'></a>Replying to [comment:28 rws]:\n> Replying to [comment:27 maldun]\n> > Yes I have. There are users (like me) who want the possibility to switch between this representations, especially for large values of n.\n> > So please still allow to call the method explicitely.\n\n> Exactly this is implemented. You can call the method, or you can say `algorithm=recursive`.\n\nGood to hear! And thank you for your work! As mentioned in the other ticket: Don't hesitate to ask for help.",
    "created_at": "2014-08-25T07:34:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217954",
    "user": "https://trac.sagemath.org/admin/accounts/users/maldun"
}
```

<a id='comment:29'></a>Replying to [comment:28 rws]:
> Replying to [comment:27 maldun]
> > Yes I have. There are users (like me) who want the possibility to switch between this representations, especially for large values of n.
> > So please still allow to call the method explicitely.

> Exactly this is implemented. You can call the method, or you can say `algorithm=recursive`.

Good to hear! And thank you for your work! As mentioned in the other ticket: Don't hesitate to ask for help.



---

archive/issue_comments_217955.json:
```json
{
    "body": "<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-08-27T16:34:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217955",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_217956.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-08-27T16:38:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217956",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_217957.json:
```json
{
    "body": "<a id='comment:31'></a>The FLINT routines are now called on polynomials with exact base ring and used for symbolic input. Everything else gets the recursive treatment which is really fast if you don't have to expand afterwards.\n\nPlease review.",
    "created_at": "2014-08-27T16:38:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217957",
    "user": "https://github.com/rwst"
}
```

<a id='comment:31'></a>The FLINT routines are now called on polynomials with exact base ring and used for symbolic input. Everything else gets the recursive treatment which is really fast if you don't have to expand afterwards.

Please review.



---

archive/issue_comments_217958.json:
```json
{
    "body": "<a id='comment:32'></a>Typing\n\n```\nchebyshev_T(1000000,x)\n```\nin the old version gives a proper result in 7.52\nThe exact same input gives me full memory (8GB on my machine) and about 1GB swap + a frozen system in the new version.\nHigher input gives a an error of flint (Memory allocation error)\n\nSome switch would be nice. I guess the best measure would be the break even point on memory consumption.\n\nEdit: I think a good point would be about order 5000-10000: It is reasonable from view of speed/memory and an explicit representation would be too cluttered anyway",
    "created_at": "2014-08-27T18:08:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217958",
    "user": "https://trac.sagemath.org/admin/accounts/users/maldun"
}
```

<a id='comment:32'></a>Typing

```
chebyshev_T(1000000,x)
```
in the old version gives a proper result in 7.52
The exact same input gives me full memory (8GB on my machine) and about 1GB swap + a frozen system in the new version.
Higher input gives a an error of flint (Memory allocation error)

Some switch would be nice. I guess the best measure would be the break even point on memory consumption.

Edit: I think a good point would be about order 5000-10000: It is reasonable from view of speed/memory and an explicit representation would be too cluttered anyway



---

archive/issue_comments_217959.json:
```json
{
    "body": "<a id='comment:33'></a>New commits:",
    "created_at": "2014-08-27T19:29:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217959",
    "user": "https://trac.sagemath.org/admin/accounts/users/maldun"
}
```

<a id='comment:33'></a>New commits:



---

archive/issue_comments_217960.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-08-27T19:29:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217960",
    "user": "https://trac.sagemath.org/admin/accounts/users/maldun"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_217961.json:
```json
{
    "body": "<a id='comment:34'></a>I proposed a patch for that",
    "created_at": "2014-08-27T19:30:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217961",
    "user": "https://trac.sagemath.org/admin/accounts/users/maldun"
}
```

<a id='comment:34'></a>I proposed a patch for that



---

archive/issue_comments_217962.json:
```json
{
    "body": "<a id='comment:35'></a>Replying to [comment:32 maldun]:\n> Typing\n> \n> \n> ```\n> chebyshev_T(1000000,x)\n> ```\n> in the old version gives a proper result in 7.52\n> The exact same input gives me full memory (8GB on my machine) and about 1GB swap + a frozen system in the new version.\n\nThat result may be proper for a symbolic `x` but the times are completely different for ring elements because expansion, which is avoided with symbolic `x`, happens automatically. This speed difference for polynomial ring elements actually is the reason for this ticket (see description).\n\n> Higher input gives a an error of flint (Memory allocation error)\n> \n> Some switch would be nice. I guess the best measure would be the break even point on memory consumption.\n> \n> Edit: I think a good point would be about order 5000-10000: It is reasonable from view of speed/memory and an explicit representation would be too cluttered anyway\n\nI don't think Sage has to anticipate user memory size, I can go happily to 150.000 with 8GB:\n\n```\nsage: R.<x> = ZZ[]\nsage: timeit('chebyshev_T(10^5,x)')\n5 loops, best of 3: 454 ms per loop\nsage: timeit('chebyshev_T(150000,x)')\n5 loops, best of 3: 1.01 s per loop\n```\nWho knows what will be in ten years? Note also that noone displays such results, and that's good because the output process takes near all memory and CPU, not FLINT.\n\nNow, it might have been a bad idea by me to use FLINT on symbolic input but I thought users might appreciate unconvoluted polynomials as output. OTOH, they might get another motivation from this to use rings if they want straight output of polys. So I'll roll back the symbolic involvement, no limit is needed, and Bob's your uncle.",
    "created_at": "2014-08-28T09:47:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217962",
    "user": "https://github.com/rwst"
}
```

<a id='comment:35'></a>Replying to [comment:32 maldun]:
> Typing
> 
> 
> ```
> chebyshev_T(1000000,x)
> ```
> in the old version gives a proper result in 7.52
> The exact same input gives me full memory (8GB on my machine) and about 1GB swap + a frozen system in the new version.

That result may be proper for a symbolic `x` but the times are completely different for ring elements because expansion, which is avoided with symbolic `x`, happens automatically. This speed difference for polynomial ring elements actually is the reason for this ticket (see description).

> Higher input gives a an error of flint (Memory allocation error)
> 
> Some switch would be nice. I guess the best measure would be the break even point on memory consumption.
> 
> Edit: I think a good point would be about order 5000-10000: It is reasonable from view of speed/memory and an explicit representation would be too cluttered anyway

I don't think Sage has to anticipate user memory size, I can go happily to 150.000 with 8GB:

```
sage: R.<x> = ZZ[]
sage: timeit('chebyshev_T(10^5,x)')
5 loops, best of 3: 454 ms per loop
sage: timeit('chebyshev_T(150000,x)')
5 loops, best of 3: 1.01 s per loop
```
Who knows what will be in ten years? Note also that noone displays such results, and that's good because the output process takes near all memory and CPU, not FLINT.

Now, it might have been a bad idea by me to use FLINT on symbolic input but I thought users might appreciate unconvoluted polynomials as output. OTOH, they might get another motivation from this to use rings if they want straight output of polys. So I'll roll back the symbolic involvement, no limit is needed, and Bob's your uncle.



---

archive/issue_comments_217963.json:
```json
{
    "body": "<a id='comment:36'></a>Replying to [comment:35 rws]:\n>\n> Who knows what will be in ten years? Note also that noone displays such results, and that's good because the output process takes near all memory and CPU, not FLINT.\n> \n> Now, it might have been a bad idea by me to use FLINT on symbolic input but I thought users might appreciate unconvoluted polynomials as output. OTOH, they might get another motivation from this to use rings if they want straight output of polys. So I'll roll back the symbolic involvement, no limit is needed, and Bob's your uncle.\n\n\n\nThan the solution is clear: Make a type check on the input type: If symbolic + higher order use recursion, if Polynomial Ring use flint\n\nIt's not about availabilty of RAM: no one wants that a Chebyshev polynomal consumes 1GB of RAM, and no one wants a freezing system, especially if there is a compact represention which only needs the logarithmical amount of time and memory.\nAnd also: You don't have much use with an expanded symbolic Cheby poly of order 1e+5, only a cluttered screen, whereas the unexpanded style still is human readable.\n\nAlways consider: The main input method should provide some more or less smart default behaviour  \n\nOn another note: Encourage people to use polynomial ring by putting proper examples in the docstring",
    "created_at": "2014-08-28T10:50:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217963",
    "user": "https://trac.sagemath.org/admin/accounts/users/maldun"
}
```

<a id='comment:36'></a>Replying to [comment:35 rws]:
>
> Who knows what will be in ten years? Note also that noone displays such results, and that's good because the output process takes near all memory and CPU, not FLINT.
> 
> Now, it might have been a bad idea by me to use FLINT on symbolic input but I thought users might appreciate unconvoluted polynomials as output. OTOH, they might get another motivation from this to use rings if they want straight output of polys. So I'll roll back the symbolic involvement, no limit is needed, and Bob's your uncle.



Than the solution is clear: Make a type check on the input type: If symbolic + higher order use recursion, if Polynomial Ring use flint

It's not about availabilty of RAM: no one wants that a Chebyshev polynomal consumes 1GB of RAM, and no one wants a freezing system, especially if there is a compact represention which only needs the logarithmical amount of time and memory.
And also: You don't have much use with an expanded symbolic Cheby poly of order 1e+5, only a cluttered screen, whereas the unexpanded style still is human readable.

Always consider: The main input method should provide some more or less smart default behaviour  

On another note: Encourage people to use polynomial ring by putting proper examples in the docstring



---

archive/issue_comments_217964.json:
```json
{
    "body": "<a id='comment:37'></a>```\nsage: T = chebyshev_T(100000000000,x)\nException (FLINT memory_manager). Unable to allocate memory.\n---------------------------------------------------------------------------\nRuntimeError                              Traceback (most recent call last)\n<ipython-input-1-bef10d0acafb> in <module>()\n----> 1 T = chebyshev_T(Integer(100000000000),x)\n\n/home/maldun/sage/sage-6.3/local/lib/python2.7/site-packages/sage/functions/orthogonal_polys.pyc in __call__(self, n, *args, **kwds)\n    624         # If n is an integer: consider the polynomial as an algebraic (not symbolic) object\n    625         if n in ZZ and not kwds.get('hold', False):\n--> 626             ret = self._eval_(n, *args, **kwds)\n    627             if ret is not None:\n    628                 return ret\n\n/home/maldun/sage/sage-6.3/local/lib/python2.7/site-packages/sage/functions/orthogonal_polys.pyc in _eval_(self, n, x, *args, **kwds)\n    679             if ((is_Polynomial(x) and x.parent().base_ring().is_exact()) or\n    680                 (is_Expression(x) and (not x.is_numeric()) and ((n > 10000) or (n < -10000)))):\n--> 681                 return self.eval_algebraic(n, x)\n    682             else:\n    683                 return self.eval_recursive(n, x)\n\n/home/maldun/sage/sage-6.3/local/lib/python2.7/site-packages/sage/functions/orthogonal_polys.pyc in eval_algebraic(self, n, arg)\n    918                 n = -n\n    919             R = PolynomialRing(ZZ, 'x')\n--> 920             pol = Polynomial_integer_dense_flint.chebyshev_T(n, R, R.gen())\n    921             if is_PolynomialRing(P):\n    922                 pol = pol.subs({pol.parent().gen():arg})\n\n/home/maldun/sage/sage-6.3/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_integer_dense_flint.so in sage.rings.polynomial.polynomial_integer_dense_flint.Polynomial_integer_dense_flint.chebyshev_T (build/cythonized/sage/rings/polynomial/polynomial_integer_dense_flint.cpp:14398)()\n\n/home/maldun/sage/sage-6.3/local/lib/python2.7/site-packages/sage/ext/c_lib.so in sage.ext.c_lib.sig_raise_exception (build/cythonized/sage/ext/c_lib.c:1040)()\n\nRuntimeError: Aborted\n\n```\n\nRecursive version works without abort\n\n\nThis kills my system:\n\n```\nsage: R.<x> = ZZ[]\nsage: timeit('chebyshev_T(10^7,x)')\n\nso it is not only the use of symbolic expressions\n```",
    "created_at": "2014-08-28T12:19:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217964",
    "user": "https://trac.sagemath.org/admin/accounts/users/maldun"
}
```

<a id='comment:37'></a>```
sage: T = chebyshev_T(100000000000,x)
Exception (FLINT memory_manager). Unable to allocate memory.
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
<ipython-input-1-bef10d0acafb> in <module>()
----> 1 T = chebyshev_T(Integer(100000000000),x)

/home/maldun/sage/sage-6.3/local/lib/python2.7/site-packages/sage/functions/orthogonal_polys.pyc in __call__(self, n, *args, **kwds)
    624         # If n is an integer: consider the polynomial as an algebraic (not symbolic) object
    625         if n in ZZ and not kwds.get('hold', False):
--> 626             ret = self._eval_(n, *args, **kwds)
    627             if ret is not None:
    628                 return ret

/home/maldun/sage/sage-6.3/local/lib/python2.7/site-packages/sage/functions/orthogonal_polys.pyc in _eval_(self, n, x, *args, **kwds)
    679             if ((is_Polynomial(x) and x.parent().base_ring().is_exact()) or
    680                 (is_Expression(x) and (not x.is_numeric()) and ((n > 10000) or (n < -10000)))):
--> 681                 return self.eval_algebraic(n, x)
    682             else:
    683                 return self.eval_recursive(n, x)

/home/maldun/sage/sage-6.3/local/lib/python2.7/site-packages/sage/functions/orthogonal_polys.pyc in eval_algebraic(self, n, arg)
    918                 n = -n
    919             R = PolynomialRing(ZZ, 'x')
--> 920             pol = Polynomial_integer_dense_flint.chebyshev_T(n, R, R.gen())
    921             if is_PolynomialRing(P):
    922                 pol = pol.subs({pol.parent().gen():arg})

/home/maldun/sage/sage-6.3/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_integer_dense_flint.so in sage.rings.polynomial.polynomial_integer_dense_flint.Polynomial_integer_dense_flint.chebyshev_T (build/cythonized/sage/rings/polynomial/polynomial_integer_dense_flint.cpp:14398)()

/home/maldun/sage/sage-6.3/local/lib/python2.7/site-packages/sage/ext/c_lib.so in sage.ext.c_lib.sig_raise_exception (build/cythonized/sage/ext/c_lib.c:1040)()

RuntimeError: Aborted

```

Recursive version works without abort


This kills my system:

```
sage: R.<x> = ZZ[]
sage: timeit('chebyshev_T(10^7,x)')

so it is not only the use of symbolic expressions
```



---

archive/issue_comments_217965.json:
```json
{
    "body": "<a id='comment:38'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-08-28T12:44:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217965",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:38'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_217966.json:
```json
{
    "body": "<a id='comment:39'></a>I propose the following switch mechanism: \nIf the input is symbolic and deg > 10000 return the recursive result else use the regular algorithm\n\nFor other input the user has to take responsibility\nOf course polynomials don't work good with the python recursion, flint does a better job.\nFor symbolic expressions for very high degree the recursion algorithm does a quite good job",
    "created_at": "2014-08-28T12:48:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217966",
    "user": "https://trac.sagemath.org/admin/accounts/users/maldun"
}
```

<a id='comment:39'></a>I propose the following switch mechanism: 
If the input is symbolic and deg > 10000 return the recursive result else use the regular algorithm

For other input the user has to take responsibility
Of course polynomials don't work good with the python recursion, flint does a better job.
For symbolic expressions for very high degree the recursion algorithm does a quite good job



---

archive/issue_comments_217967.json:
```json
{
    "body": "<a id='comment:41'></a>I fixed your doctest. Let's see what the reviewer/s say.\n\n---\nNew commits:",
    "created_at": "2014-08-28T13:39:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217967",
    "user": "https://github.com/rwst"
}
```

<a id='comment:41'></a>I fixed your doctest. Let's see what the reviewer/s say.

---
New commits:



---

archive/issue_comments_217968.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-08-28T13:39:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217968",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_217969.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-02-24T13:52:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217969",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_217970.json:
```json
{
    "body": "<a id='comment:42'></a>```\nsage -t --long src/sage/graphs/bipartite_graph.py  # 1 doctest failed\nsage -t --long src/sage/functions/orthogonal_polys.py  # 11 doctests failed\n```",
    "created_at": "2015-02-24T13:52:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217970",
    "user": "https://github.com/rwst"
}
```

<a id='comment:42'></a>```
sage -t --long src/sage/graphs/bipartite_graph.py  # 1 doctest failed
sage -t --long src/sage/functions/orthogonal_polys.py  # 11 doctests failed
```



---

archive/issue_comments_217971.json:
```json
{
    "body": "<a id='comment:44'></a>It maybe better to just make the Chebys `GinacFunctions` and use Flint from within Pynac.",
    "created_at": "2017-01-14T08:55:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217971",
    "user": "https://github.com/rwst"
}
```

<a id='comment:44'></a>It maybe better to just make the Chebys `GinacFunctions` and use Flint from within Pynac.



---

archive/issue_comments_217972.json:
```json
{
    "body": "<a id='comment:45'></a>While other orthogonal polynomial functions (as well as almost all other symbolic functions) are simply `BuiltinFunction`s or `GinacFunction`s this ticket suffers from the fact that the Cheby functions in Sage allow the `algorithm` keyword (by using a `__call__` method in the superclass). The way such polymorphisms are resolved in other functions is by having the interface (the callable global function `chebyshev_T()`) dispatching on the keyword. This refactoring step (#24554) should be done before all items of this ticket can be implemented.",
    "created_at": "2018-01-17T08:28:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217972",
    "user": "https://github.com/rwst"
}
```

<a id='comment:45'></a>While other orthogonal polynomial functions (as well as almost all other symbolic functions) are simply `BuiltinFunction`s or `GinacFunction`s this ticket suffers from the fact that the Cheby functions in Sage allow the `algorithm` keyword (by using a `__call__` method in the superclass). The way such polymorphisms are resolved in other functions is by having the interface (the callable global function `chebyshev_T()`) dispatching on the keyword. This refactoring step (#24554) should be done before all items of this ticket can be implemented.



---

archive/issue_events_049199.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2018-01-21T08:17:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "milestone": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16812#event-49199"
}
```



---

archive/issue_comments_217973.json:
```json
{
    "body": "<a id='comment:46'></a>We will convert the Chebyshevs to `GinacFunction`s and call Flint from Pynac, which also will be the fastest way of creating the expression polynomial.",
    "created_at": "2018-01-21T08:17:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217973",
    "user": "https://github.com/rwst"
}
```

<a id='comment:46'></a>We will convert the Chebyshevs to `GinacFunction`s and call Flint from Pynac, which also will be the fastest way of creating the expression polynomial.



---

archive/issue_comments_217974.json:
```json
{
    "body": "<a id='comment:48'></a>New commits:",
    "created_at": "2018-01-24T09:15:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217974",
    "user": "https://github.com/rwst"
}
```

<a id='comment:48'></a>New commits:



---

archive/issue_comments_217975.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-02-19T07:45:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217975",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_217976.json:
```json
{
    "body": "<a id='comment:50'></a>Branch sems corrupt.",
    "created_at": "2018-06-30T12:46:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217976",
    "user": "https://github.com/rwst"
}
```

<a id='comment:50'></a>Branch sems corrupt.



---

archive/issue_comments_217977.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-06-30T12:46:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16812",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16812#issuecomment-217977",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_review to needs_work.
