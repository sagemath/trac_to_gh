# Issue 16196: dedent pasted sage prompts

archive/issues_015959.json:
```json
{
    "body": "Sage prompts with leading whitespace are not removed correctly:\n\n```\nsage:    1+1     # works\n2\nsage: sage: 1+1     # works\n2\nsage:    sage: 1+1     # indent + prompt = fail\n  File \"<ipython-input-34-360e106e9b2f>\", line 1\n    sage: Integer(1)+Integer(1)     # indent + prompt = fail\n        ^\nSyntaxError: invalid syntax\n```\nPossibly due to #16050\n\n**CC:**  @ohanar\n\n**Branch/Commit:** [101a6beaae0109dffad9a8d93f8ebd44843794e5](https://github.com/sagemath/sagetrac-mirror/commit/101a6beaae0109dffad9a8d93f8ebd44843794e5)\n\n**Reviewer:** John Palmieri\n\n**Author:** R. Andrew Ohana\n\nIssue created by migration from https://trac.sagemath.org/ticket/16196\n\n",
    "closed_at": "2014-05-04T13:56:38Z",
    "created_at": "2014-04-21T12:32:52Z",
    "labels": [
        "component: misc",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.2",
    "title": "dedent pasted sage prompts",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16196",
    "user": "https://github.com/vbraun"
}
```
Sage prompts with leading whitespace are not removed correctly:

```
sage:    1+1     # works
2
sage: sage: 1+1     # works
2
sage:    sage: 1+1     # indent + prompt = fail
  File "<ipython-input-34-360e106e9b2f>", line 1
    sage: Integer(1)+Integer(1)     # indent + prompt = fail
        ^
SyntaxError: invalid syntax
```
Possibly due to #16050

**CC:**  @ohanar

**Branch/Commit:** [101a6beaae0109dffad9a8d93f8ebd44843794e5](https://github.com/sagemath/sagetrac-mirror/commit/101a6beaae0109dffad9a8d93f8ebd44843794e5)

**Reviewer:** John Palmieri

**Author:** R. Andrew Ohana

Issue created by migration from https://trac.sagemath.org/ticket/16196





---

archive/issue_comments_210930.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -10,5 +10,5 @@\n     sage: Integer(1)+Integer(1)     # indent + prompt = fail\n         ^\n SyntaxError: invalid syntax\n-}}}o\n+```\n Possibly due to #16050\n``````\n",
    "created_at": "2014-04-21T16:07:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16196#issuecomment-210930",
    "user": "https://github.com/kcrisman"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -10,5 +10,5 @@
     sage: Integer(1)+Integer(1)     # indent + prompt = fail
         ^
 SyntaxError: invalid syntax
-}}}o
+```
 Possibly due to #16050
``````




---

archive/issue_comments_210931.json:
```json
{
    "body": "<a id='comment:2'></a>\nIt looks like the change from #16154 broke this (ipython's leading indent stripper is now being run after our prompt stripper). I can look into this sometime later this week.",
    "created_at": "2014-04-21T18:36:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16196#issuecomment-210931",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:2'></a>
It looks like the change from #16154 broke this (ipython's leading indent stripper is now being run after our prompt stripper). I can look into this sometime later this week.



---

archive/issue_comments_210932.json:
```json
{
    "body": "**Branch:** [u/ohanar/ge_prompt_dedents](https://github.com/sagemath/sagetrac-mirror/tree/u/ohanar/ge_prompt_dedents)",
    "created_at": "2014-04-24T22:26:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16196#issuecomment-210932",
    "user": "https://github.com/ohanar"
}
```

**Branch:** [u/ohanar/ge_prompt_dedents](https://github.com/sagemath/sagetrac-mirror/tree/u/ohanar/ge_prompt_dedents)



---

archive/issue_events_147277.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2014-04-24T22:28:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/16196",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16196#event-147277"
}
```



---

archive/issue_comments_210933.json:
```json
{
    "body": "<a id='comment:4'></a>\nThis should work for now, although I looked a bit into the upstream code, and that should probably be changed to be more configurable (since after all the prompt is configurable).\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a1354669efb14821dda9c9c4c5d9361dc7d08bb2\">a135466</a></td><td><code>fix to dedent pasted sage prompts</code></td></tr></table>\n",
    "created_at": "2014-04-24T22:28:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16196#issuecomment-210933",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:4'></a>
This should work for now, although I looked a bit into the upstream code, and that should probably be changed to be more configurable (since after all the prompt is configurable).

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a1354669efb14821dda9c9c4c5d9361dc7d08bb2">a135466</a></td><td><code>fix to dedent pasted sage prompts</code></td></tr></table>




---

archive/issue_comments_210934.json:
```json
{
    "body": "**Commit:** [a1354669efb14821dda9c9c4c5d9361dc7d08bb2](https://github.com/sagemath/sagetrac-mirror/commit/a1354669efb14821dda9c9c4c5d9361dc7d08bb2)",
    "created_at": "2014-04-24T22:28:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16196#issuecomment-210934",
    "user": "https://github.com/ohanar"
}
```

**Commit:** [a1354669efb14821dda9c9c4c5d9361dc7d08bb2](https://github.com/sagemath/sagetrac-mirror/commit/a1354669efb14821dda9c9c4c5d9361dc7d08bb2)



---

archive/issue_comments_210935.json:
```json
{
    "body": "**Author:** R. Andrew Ohana",
    "created_at": "2014-04-24T22:28:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16196#issuecomment-210935",
    "user": "https://github.com/ohanar"
}
```

**Author:** R. Andrew Ohana



---

archive/issue_comments_210936.json:
```json
{
    "body": "<a id='comment:5'></a>\nOh, sorry, I didn't see this ticket and introduced #16232 which strips leading whitespace. Do we close that one as a duplicate? (Meanwhile, it has a positive review, by the way.)\n\n- Why only strip one prompt? I see the explanation that we are trying to match IPython's behavior, but do we need to preserve backward-compatibility?\n\n- What is the point of the change to `src/sage/repl/ipython_extension.py`? Just changing the regular expression (as at #16232) seems to solve the problem.",
    "created_at": "2014-04-24T22:46:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16196#issuecomment-210936",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:5'></a>
Oh, sorry, I didn't see this ticket and introduced #16232 which strips leading whitespace. Do we close that one as a duplicate? (Meanwhile, it has a positive review, by the way.)

- Why only strip one prompt? I see the explanation that we are trying to match IPython's behavior, but do we need to preserve backward-compatibility?

- What is the point of the change to `src/sage/repl/ipython_extension.py`? Just changing the regular expression (as at #16232) seems to solve the problem.



---

archive/issue_comments_210937.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [jhpalmieri](#comment%3A5):\n> Oh, sorry, I didn't see this ticket and introduced #16232 which strips leading whitespace. Do we close that one as a duplicate? (Meanwhile, it has a positive review, by the way.)\n> \n> - Why only strip one prompt? I see the explanation that we are trying to match IPython's behavior, but do we need to preserve backward-compatibility?\n\n\nIs there sage code that is being written with sage (duplicate) prompts? Really duplicate prompts should only come about by copying something into a terminal session, and then copying that pasted content again -- this seems like a complete edge case that wouldn't (and certainly shouldn't) show up in some code that is meant to be used for a long period of time.\n\n> \n> - What is the point of the change to `src/sage/repl/ipython_extension.py`? Just changing the regular expression (as at #16232) seems to solve the problem.\n\n\nIPython already has a dedenter, and it is smart (it strips an equal amount from each line), so all we need to do is strip our prompts after ipython dedents, and for the moment, that means insert after position 0 (and before position 1, so as to not re-break #16154).",
    "created_at": "2014-04-24T22:59:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16196#issuecomment-210937",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:6'></a>
Replying to [jhpalmieri](#comment%3A5):
> Oh, sorry, I didn't see this ticket and introduced #16232 which strips leading whitespace. Do we close that one as a duplicate? (Meanwhile, it has a positive review, by the way.)
> 
> - Why only strip one prompt? I see the explanation that we are trying to match IPython's behavior, but do we need to preserve backward-compatibility?


Is there sage code that is being written with sage (duplicate) prompts? Really duplicate prompts should only come about by copying something into a terminal session, and then copying that pasted content again -- this seems like a complete edge case that wouldn't (and certainly shouldn't) show up in some code that is meant to be used for a long period of time.

> 
> - What is the point of the change to `src/sage/repl/ipython_extension.py`? Just changing the regular expression (as at #16232) seems to solve the problem.


IPython already has a dedenter, and it is smart (it strips an equal amount from each line), so all we need to do is strip our prompts after ipython dedents, and for the moment, that means insert after position 0 (and before position 1, so as to not re-break #16154).



---

archive/issue_comments_210938.json:
```json
{
    "body": "<a id='comment:7'></a>\nLike I mentioned, this should just be configurable with IPython itself -- we shouldn't have to be pulling this internal `_strip_prompts` function in the first place. I'll make a patch if I ever find the time to fix this upstream, but I'm much to busy at the moment.",
    "created_at": "2014-04-24T23:03:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16196#issuecomment-210938",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:7'></a>
Like I mentioned, this should just be configurable with IPython itself -- we shouldn't have to be pulling this internal `_strip_prompts` function in the first place. I'll make a patch if I ever find the time to fix this upstream, but I'm much to busy at the moment.



---

archive/issue_comments_210939.json:
```json
{
    "body": "**Changing commit** from \"[a1354669efb14821dda9c9c4c5d9361dc7d08bb2](https://github.com/sagemath/sagetrac-mirror/commit/a1354669efb14821dda9c9c4c5d9361dc7d08bb2)\" to \"[fc520709f1682205ac55f7c75f31eb84d9781587](https://github.com/sagemath/sagetrac-mirror/commit/fc520709f1682205ac55f7c75f31eb84d9781587)\".",
    "created_at": "2014-04-30T22:52:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16196#issuecomment-210939",
    "user": "https://github.com/jhpalmieri"
}
```

**Changing commit** from "[a1354669efb14821dda9c9c4c5d9361dc7d08bb2](https://github.com/sagemath/sagetrac-mirror/commit/a1354669efb14821dda9c9c4c5d9361dc7d08bb2)" to "[fc520709f1682205ac55f7c75f31eb84d9781587](https://github.com/sagemath/sagetrac-mirror/commit/fc520709f1682205ac55f7c75f31eb84d9781587)".



---

archive/issue_comments_210940.json:
```json
{
    "body": "**Changing branch** from \"[u/ohanar/ge_prompt_dedents](https://github.com/sagemath/sagetrac-mirror/tree/u/ohanar/ge_prompt_dedents)\" to \"[u/jhpalmieri/dedent](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/dedent)\".",
    "created_at": "2014-04-30T22:52:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16196#issuecomment-210940",
    "user": "https://github.com/jhpalmieri"
}
```

**Changing branch** from "[u/ohanar/ge_prompt_dedents](https://github.com/sagemath/sagetrac-mirror/tree/u/ohanar/ge_prompt_dedents)" to "[u/jhpalmieri/dedent](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/dedent)".



---

archive/issue_comments_210941.json:
```json
{
    "body": "**Reviewer:** John Palmieri",
    "created_at": "2014-04-30T22:52:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16196#issuecomment-210941",
    "user": "https://github.com/jhpalmieri"
}
```

**Reviewer:** John Palmieri



---

archive/issue_comments_210942.json:
```json
{
    "body": "<a id='comment:8'></a>\nRebased (w.r.t. #16232).",
    "created_at": "2014-04-30T22:52:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16196#issuecomment-210942",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:8'></a>
Rebased (w.r.t. #16232).



---

archive/issue_events_147278.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2014-04-30T22:52:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/16196",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16196#event-147278"
}
```



---

archive/issue_events_147279.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2014-04-30T22:52:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/16196",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16196#event-147279"
}
```



---

archive/issue_events_147280.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/git",
    "created_at": "2014-04-30T22:53:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/16196",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16196#event-147280"
}
```



---

archive/issue_events_147281.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/git",
    "created_at": "2014-04-30T22:53:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/16196",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16196#event-147281"
}
```



---

archive/issue_comments_210943.json:
```json
{
    "body": "**Changing commit** from \"[fc520709f1682205ac55f7c75f31eb84d9781587](https://github.com/sagemath/sagetrac-mirror/commit/fc520709f1682205ac55f7c75f31eb84d9781587)\" to \"[101a6beaae0109dffad9a8d93f8ebd44843794e5](https://github.com/sagemath/sagetrac-mirror/commit/101a6beaae0109dffad9a8d93f8ebd44843794e5)\".",
    "created_at": "2014-04-30T22:53:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16196#issuecomment-210943",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[fc520709f1682205ac55f7c75f31eb84d9781587](https://github.com/sagemath/sagetrac-mirror/commit/fc520709f1682205ac55f7c75f31eb84d9781587)" to "[101a6beaae0109dffad9a8d93f8ebd44843794e5](https://github.com/sagemath/sagetrac-mirror/commit/101a6beaae0109dffad9a8d93f8ebd44843794e5)".



---

archive/issue_comments_210944.json:
```json
{
    "body": "<a id='comment:9'></a>\n**Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/101a6beaae0109dffad9a8d93f8ebd44843794e5\">101a6be</a></td><td><code>#16196: rebased to #16232</code></td></tr></table>\n",
    "created_at": "2014-04-30T22:53:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16196#issuecomment-210944",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
**Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/101a6beaae0109dffad9a8d93f8ebd44843794e5">101a6be</a></td><td><code>#16196: rebased to #16232</code></td></tr></table>




---

archive/issue_events_147282.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2014-04-30T22:54:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/16196",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16196#event-147282"
}
```



---

archive/issue_events_147283.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2014-04-30T22:54:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/16196",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16196#event-147283"
}
```



---

archive/issue_comments_210945.json:
```json
{
    "body": "<a id='comment:11'></a>\nAh, ok... :-)",
    "created_at": "2014-04-30T23:14:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16196#issuecomment-210945",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:11'></a>
Ah, ok... :-)



---

archive/issue_comments_210946.json:
```json
{
    "body": "**Changing branch** from \"[u/jhpalmieri/dedent](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/dedent)\" to \"[101a6beaae0109dffad9a8d93f8ebd44843794e5](https://github.com/sagemath/sagetrac-mirror/commit/101a6beaae0109dffad9a8d93f8ebd44843794e5)\".",
    "created_at": "2014-05-04T13:56:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16196#issuecomment-210946",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/jhpalmieri/dedent](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/dedent)" to "[101a6beaae0109dffad9a8d93f8ebd44843794e5](https://github.com/sagemath/sagetrac-mirror/commit/101a6beaae0109dffad9a8d93f8ebd44843794e5)".



---

archive/issue_events_147284.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-05-04T13:56:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/16196",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16196#event-147284"
}
```



---

archive/issue_events_147285.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-05-04T13:56:38Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16196",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16196#event-147285"
}
```
