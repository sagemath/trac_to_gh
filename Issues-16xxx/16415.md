# Issue 16415: Ignore case in package directory

archive/issues_016178.json:
```json
{
    "body": "The python tarball contains a upper-case `Python-x.y.z` directory. Our build system does not handle that case. Worse, it works differently on OSX and real OS'es because of filesystem case sensitivity.\n\nBranch/Commit: 9b315855498609b254807fc74fc3bcfcca57af6b\n\nReviewer: John Palmieri, Leif Leonhardy\n\nAuthor: Volker Braun\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/16415\n\n",
    "closed_at": "2014-06-18T12:00:26Z",
    "created_at": "2014-05-30T15:32:13Z",
    "labels": [
        "component: build",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.3",
    "title": "Ignore case in package directory",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16415",
    "user": "https://github.com/vbraun"
}
```
The python tarball contains a upper-case `Python-x.y.z` directory. Our build system does not handle that case. Worse, it works differently on OSX and real OS'es because of filesystem case sensitivity.

Branch/Commit: 9b315855498609b254807fc74fc3bcfcca57af6b

Reviewer: John Palmieri, Leif Leonhardy

Author: Volker Braun

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/16415





---

archive/issue_comments_269994.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-\n+The python tarball contains a upper-case `Python-x.y.z` directory. Our build system does not handle that case. Worse, it works differently on OSX and real OS'es because of filesystem case sensitivity.\n``````\n",
    "created_at": "2014-05-30T15:33:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16415#issuecomment-269994",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-
+The python tarball contains a upper-case `Python-x.y.z` directory. Our build system does not handle that case. Worse, it works differently on OSX and real OS'es because of filesystem case sensitivity.
``````




---

archive/issue_comments_269995.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to build.",
    "created_at": "2014-05-30T15:33:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16415#issuecomment-269995",
    "user": "https://github.com/vbraun"
}
```

Changing component from PLEASE CHANGE to build.



---

archive/issue_comments_269996.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2014-05-30T15:33:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16415#issuecomment-269996",
    "user": "https://github.com/vbraun"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_269997.json:
```json
{
    "body": "Changing author from \"\" to \"Volker Braun\"",
    "created_at": "2014-05-30T15:33:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16415#issuecomment-269997",
    "user": "https://github.com/vbraun"
}
```

Changing author from "" to "Volker Braun"



---

archive/issue_comments_269998.json:
```json
{
    "body": "Changing branch from \"\" to \"u/vbraun/ignore_case_in_package_directory\"",
    "created_at": "2014-05-30T15:36:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16415#issuecomment-269998",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "" to "u/vbraun/ignore_case_in_package_directory"



---

archive/issue_comments_269999.json:
```json
{
    "body": "Changing commit from \"\" to \"e9aa3c608f1407fc5ff36236b442e7db42f8f871\"",
    "created_at": "2014-05-30T17:01:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16415#issuecomment-269999",
    "user": "https://github.com/vbraun"
}
```

Changing commit from "" to "e9aa3c608f1407fc5ff36236b442e7db42f8f871"



---

archive/issue_comments_270000.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-05-30T17:01:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16415#issuecomment-270000",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_270001.json:
```json
{
    "body": "<a id='comment:3'></a>New commits:",
    "created_at": "2014-05-30T17:01:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16415#issuecomment-270001",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:3'></a>New commits:



---

archive/issue_comments_270002.json:
```json
{
    "body": "<a id='comment:4'></a>Is this supposed to be a temporary (=ad-hoc) solution?\n\nIn the long run, the actual folder name should probably be part of Sage's \"package metadata\".",
    "created_at": "2014-05-31T13:23:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16415#issuecomment-270002",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:4'></a>Is this supposed to be a temporary (=ad-hoc) solution?

In the long run, the actual folder name should probably be part of Sage's "package metadata".



---

archive/issue_comments_270003.json:
```json
{
    "body": "<a id='comment:5'></a>If there is a single top-level directory then we don't need to store the name (and manually maintain) it elsewhere. There should be some checking, of course. And if you don't have a single top-level directory then I'd consider that to be an upstream bug.",
    "created_at": "2014-05-31T13:28:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16415#issuecomment-270003",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:5'></a>If there is a single top-level directory then we don't need to store the name (and manually maintain) it elsewhere. There should be some checking, of course. And if you don't have a single top-level directory then I'd consider that to be an upstream bug.



---

archive/issue_comments_270004.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:5 vbraun]:\n> If there is a single top-level directory then we don't need to store the name\n\n\nYep, but that's NYI.\n\n> (and manually maintain) it elsewhere.\n\n\nWell, we \"manually\" maintain the \"checksums\" for each specific upstream tarball anyway (in a **central** repo, tied to specific Sage versions, which is IMHO a bad thing to do anyway). \n\n> There should be some checking, of course.\n\n\nSure.\n\n> And if you don't have a single top-level directory then I'd consider that to be an upstream bug.\n\n\n:-)",
    "created_at": "2014-05-31T13:46:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16415#issuecomment-270004",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:6'></a>Replying to [comment:5 vbraun]:
> If there is a single top-level directory then we don't need to store the name


Yep, but that's NYI.

> (and manually maintain) it elsewhere.


Well, we "manually" maintain the "checksums" for each specific upstream tarball anyway (in a **central** repo, tied to specific Sage versions, which is IMHO a bad thing to do anyway). 

> There should be some checking, of course.


Sure.

> And if you don't have a single top-level directory then I'd consider that to be an upstream bug.


:-)



---

archive/issue_comments_270005.json:
```json
{
    "body": "<a id='comment:7'></a>P.S.:  FWIW, requiring `foo-x.y.pN.spkg` to have a `foo-x.y.pN/` folder was used as a consistency check (although I didn't like it, as it just made testing spkgs slightly harder).",
    "created_at": "2014-05-31T13:50:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16415#issuecomment-270005",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:7'></a>P.S.:  FWIW, requiring `foo-x.y.pN.spkg` to have a `foo-x.y.pN/` folder was used as a consistency check (although I didn't like it, as it just made testing spkgs slightly harder).



---

archive/issue_comments_270006.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-31T16:51:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16415#issuecomment-270006",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_270007.json:
```json
{
    "body": "Changing commit from \"e9aa3c608f1407fc5ff36236b442e7db42f8f871\" to \"9b315855498609b254807fc74fc3bcfcca57af6b\"",
    "created_at": "2014-05-31T16:51:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16415#issuecomment-270007",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e9aa3c608f1407fc5ff36236b442e7db42f8f871" to "9b315855498609b254807fc74fc3bcfcca57af6b"



---

archive/issue_comments_270008.json:
```json
{
    "body": "<a id='comment:9'></a>Also removed the hiding-of-errors, I want to know which packages don't work...",
    "created_at": "2014-05-31T16:53:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16415#issuecomment-270008",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:9'></a>Also removed the hiding-of-errors, I want to know which packages don't work...



---

archive/issue_comments_270009.json:
```json
{
    "body": "<a id='comment:10'></a>Probably immediately go with `find . -type d -a -not -name . -exec mv {} src \\; 2>/dev/null` ;-) (and afterwards `test -d ...`)\n\n(Haven't checked right now, but I guess `-iname` isn't portable.)",
    "created_at": "2014-05-31T17:08:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16415#issuecomment-270009",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:10'></a>Probably immediately go with `find . -type d -a -not -name . -exec mv {} src \; 2>/dev/null` ;-) (and afterwards `test -d ...`)

(Haven't checked right now, but I guess `-iname` isn't portable.)



---

archive/issue_comments_270010.json:
```json
{
    "body": "<a id='comment:11'></a>Besides not portable, its IMHO not readable. The whole contraption should be rewritten in Python with some proper doctesting.",
    "created_at": "2014-05-31T17:13:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16415#issuecomment-270010",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:11'></a>Besides not portable, its IMHO not readable. The whole contraption should be rewritten in Python with some proper doctesting.



---

archive/issue_comments_270011.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:11 vbraun]:\n> Besides not portable, its IMHO not readable.\n\n\nWell, the `find` version above is portable, although I'd just use it to get the folder name.  (Or some flavour of `(cd * && basename `pwd`)`.)\n\n> The whole contraption should be rewritten in Python with some proper doctesting.\n\n\nIn Lisp, please.\n\n\n\n\nAnyway, I'd really explicitly check whether `src/` afterwards exists (and is a directory); we already have\n\n```sh\n    echo \"Finished extraction\"\n\n    cd \"$PKG_NAME\"\n    if [ $? -ne 0 ]; then\n        echo >&2 \"Error: after extracting, the directory $PKG_NAME does not exist\"\n        exit 1\n    fi\n```\nright below for legacy spkgs.\n\n\n\n\nJust out of curiosity:  Which bash version(s) did the original change work with?\n\nI tried older (3.2.*) as well as newer (4.3.11*) bashs; with none of them it worked.",
    "created_at": "2014-05-31T18:01:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16415#issuecomment-270011",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:12'></a>Replying to [comment:11 vbraun]:
> Besides not portable, its IMHO not readable.


Well, the `find` version above is portable, although I'd just use it to get the folder name.  (Or some flavour of `(cd * && basename `pwd`)`.)

> The whole contraption should be rewritten in Python with some proper doctesting.


In Lisp, please.




Anyway, I'd really explicitly check whether `src/` afterwards exists (and is a directory); we already have

```sh
    echo "Finished extraction"

    cd "$PKG_NAME"
    if [ $? -ne 0 ]; then
        echo >&2 "Error: after extracting, the directory $PKG_NAME does not exist"
        exit 1
    fi
```
right below for legacy spkgs.




Just out of curiosity:  Which bash version(s) did the original change work with?

I tried older (3.2.*) as well as newer (4.3.11*) bashs; with none of them it worked.



---

archive/issue_comments_270012.json:
```json
{
    "body": "<a id='comment:13'></a>$ bash --version\nGNU bash, version 4.2.47(1)-release (x86_64-redhat-linux-gnu)\n\nReplying to [comment:12 leif]:\n> In Lisp, please.\n\n\nSage is a Python project. And Python is actually pretty good for sysadmin-type scripts. Unlike lisp. And unlike Bash it can be tested in a sane way.",
    "created_at": "2014-05-31T18:13:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16415#issuecomment-270012",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:13'></a>$ bash --version
GNU bash, version 4.2.47(1)-release (x86_64-redhat-linux-gnu)

Replying to [comment:12 leif]:
> In Lisp, please.


Sage is a Python project. And Python is actually pretty good for sysadmin-type scripts. Unlike lisp. And unlike Bash it can be tested in a sane way.



---

archive/issue_comments_270013.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:13 vbraun]:\n> {{{\n> $ bash --version\n> GNU bash, version 4.2.47(1)-release (x86_64-redhat-linux-gnu)\n> }}}\n\n\nFWIW, `\"${PKG_NAME_UPSTREAM%.tar*}\"` doesn't work with\n\n```\nGNU bash, version 4.2.28(1)-release (x86_64-redhat-linux-gnu)\nCopyright (C) 2011 Free Software Foundation, Inc.\nLicense GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>\n```\neither.  (So it's probably a bug in your bash that it works for you. ;-) )",
    "created_at": "2014-06-02T16:25:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16415#issuecomment-270013",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:14'></a>Replying to [comment:13 vbraun]:
> {{{
> $ bash --version
> GNU bash, version 4.2.47(1)-release (x86_64-redhat-linux-gnu)
> }}}


FWIW, `"${PKG_NAME_UPSTREAM%.tar*}"` doesn't work with

```
GNU bash, version 4.2.28(1)-release (x86_64-redhat-linux-gnu)
Copyright (C) 2011 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
```
either.  (So it's probably a bug in your bash that it works for you. ;-) )



---

archive/issue_comments_270014.json:
```json
{
    "body": "<a id='comment:15'></a>I'd still add a check (with an appropriate error message) that `src/` afterwards really exists (and is a directory ;-) ); cf. [comment:12 my comment above].",
    "created_at": "2014-06-03T13:39:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16415#issuecomment-270014",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:15'></a>I'd still add a check (with an appropriate error message) that `src/` afterwards really exists (and is a directory ;-) ); cf. [comment:12 my comment above].



---

archive/issue_comments_270015.json:
```json
{
    "body": "<a id='comment:16'></a>We don't need a double check, either building the package will break if the rename fails or the rename is not necessary (and, really, wtf do we rename the tarball directory to start with, afaik nobody else does that). In particular, there is no need to check that the renamed directory is still a directory.",
    "created_at": "2014-06-04T09:32:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16415#issuecomment-270015",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:16'></a>We don't need a double check, either building the package will break if the rename fails or the rename is not necessary (and, really, wtf do we rename the tarball directory to start with, afaik nobody else does that). In particular, there is no need to check that the renamed directory is still a directory.



---

archive/issue_comments_270016.json:
```json
{
    "body": "<a id='comment:17'></a>Looks okay to me.",
    "created_at": "2014-06-17T01:51:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16415#issuecomment-270016",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:17'></a>Looks okay to me.



---

archive/issue_comments_270017.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-06-17T01:51:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16415#issuecomment-270017",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_270018.json:
```json
{
    "body": "Changing reviewer from \"\" to \"John Palmieri, Leif Leonhardy\"",
    "created_at": "2014-06-17T01:51:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16415#issuecomment-270018",
    "user": "https://github.com/jhpalmieri"
}
```

Changing reviewer from "" to "John Palmieri, Leif Leonhardy"



---

archive/issue_comments_270019.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-06-18T12:00:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16415#issuecomment-270019",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_048312.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-06-18T12:00:26Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16415",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16415#event-48312"
}
```



---

archive/issue_comments_270020.json:
```json
{
    "body": "Changing branch from \"u/vbraun/ignore_case_in_package_directory\" to \"9b315855498609b254807fc74fc3bcfcca57af6b\"",
    "created_at": "2014-06-18T12:00:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16415",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16415#issuecomment-270020",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/vbraun/ignore_case_in_package_directory" to "9b315855498609b254807fc74fc3bcfcca57af6b"
