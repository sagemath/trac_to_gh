# Issue 16381: primary decomposition doesn't work when ideal is in a quotient polynomial ring

archive/issues_016144.json:
```json
{
    "body": "I was trying to do a simple example on page 51 of Atiyah-Macdonald using Sage, and it fails:\n\n```\nR.<x,y,z> = QQ[]\nI = R.ideal([x*y - z^2])\nA.<xbar,ybar,zbar> = R.quotient(I)\np = A.ideal([x,z])\np.primary_decomposition()\n```\nboom! ---\n\n```\nError in lines 5-5\nTraceback (most recent call last):\n  File \"/projects/71755b5a-fde1-45bc-9ca8-d06d5b9749f1/.sagemathcloud/sage_server.py\", line 733, in execute\n    exec compile(block+'\\n', '', 'single') in namespace, locals\n  File \"\", line 1, in <module>\n  File \"/usr/local/sage/sage-6.2.rc0/local/lib/python2.7/site-packages/sage/rings/polynomial/multi_polynomial_ideal.py\", line 604, in __call__\n    return self.f(self._instance, *args, **kwds)\n  File \"/usr/local/sage/sage-6.2.rc0/local/lib/python2.7/site-packages/sage/rings/polynomial/multi_polynomial_ideal.py\", line 1146, in primary_decomposition\n    return [I for I, _ in self.complete_primary_decomposition(algorithm)]\n  File \"/usr/local/sage/sage-6.2.rc0/local/lib/python2.7/site-packages/sage/rings/polynomial/multi_polynomial_ideal.py\", line 604, in __call__\n    return self.f(self._instance, *args, **kwds)\n  File \"/usr/local/sage/sage-6.2.rc0/local/lib/python2.7/site-packages/sage/rings/polynomial/multi_polynomial_ideal.py\", line 505, in wrapper\n    return func(*args, **kwds)\n  File \"/usr/local/sage/sage-6.2.rc0/local/lib/python2.7/site-packages/sage/rings/polynomial/multi_polynomial_ideal.py\", line 1068, in complete_primary_decomposition\n    P = primdecSY(self)\n  File \"function.pyx\", line 1285, in sage.libs.singular.function.SingularFunction.__call__ (sage/libs/singular/function.cpp:13025)\nTypeError: Cannot call Singular function 'primdecSY' with ring parameter of type '<class 'sage.rings.quotient_ring.QuotientRing_generic_with_category'>'\n```\n\nAssignee: @malb\n\nKeywords: sd59\n\nUpstream: Reported upstream. Developers acknowledge bug.\n\nAuthor: Martin Albrecht\n\nBranch: u/malb/trac_16381\n\nStatus: needs_info\n\nCommit: c237b07be5568f9f19b2333f12dc46efe8a82ea5\n\nIssue created by migration from https://trac.sagemath.org/ticket/16381\n\n",
    "created_at": "2014-05-20T17:39:52Z",
    "labels": [
        "component: commutative algebra",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "primary decomposition doesn't work when ideal is in a quotient polynomial ring",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16381",
    "user": "https://github.com/williamstein"
}
```
I was trying to do a simple example on page 51 of Atiyah-Macdonald using Sage, and it fails:

```
R.<x,y,z> = QQ[]
I = R.ideal([x*y - z^2])
A.<xbar,ybar,zbar> = R.quotient(I)
p = A.ideal([x,z])
p.primary_decomposition()
```
boom! ---

```
Error in lines 5-5
Traceback (most recent call last):
  File "/projects/71755b5a-fde1-45bc-9ca8-d06d5b9749f1/.sagemathcloud/sage_server.py", line 733, in execute
    exec compile(block+'\n', '', 'single') in namespace, locals
  File "", line 1, in <module>
  File "/usr/local/sage/sage-6.2.rc0/local/lib/python2.7/site-packages/sage/rings/polynomial/multi_polynomial_ideal.py", line 604, in __call__
    return self.f(self._instance, *args, **kwds)
  File "/usr/local/sage/sage-6.2.rc0/local/lib/python2.7/site-packages/sage/rings/polynomial/multi_polynomial_ideal.py", line 1146, in primary_decomposition
    return [I for I, _ in self.complete_primary_decomposition(algorithm)]
  File "/usr/local/sage/sage-6.2.rc0/local/lib/python2.7/site-packages/sage/rings/polynomial/multi_polynomial_ideal.py", line 604, in __call__
    return self.f(self._instance, *args, **kwds)
  File "/usr/local/sage/sage-6.2.rc0/local/lib/python2.7/site-packages/sage/rings/polynomial/multi_polynomial_ideal.py", line 505, in wrapper
    return func(*args, **kwds)
  File "/usr/local/sage/sage-6.2.rc0/local/lib/python2.7/site-packages/sage/rings/polynomial/multi_polynomial_ideal.py", line 1068, in complete_primary_decomposition
    P = primdecSY(self)
  File "function.pyx", line 1285, in sage.libs.singular.function.SingularFunction.__call__ (sage/libs/singular/function.cpp:13025)
TypeError: Cannot call Singular function 'primdecSY' with ring parameter of type '<class 'sage.rings.quotient_ring.QuotientRing_generic_with_category'>'
```

Assignee: @malb

Keywords: sd59

Upstream: Reported upstream. Developers acknowledge bug.

Author: Martin Albrecht

Branch: u/malb/trac_16381

Status: needs_info

Commit: c237b07be5568f9f19b2333f12dc46efe8a82ea5

Issue created by migration from https://trac.sagemath.org/ticket/16381





---

archive/issue_comments_265634.json:
```json
{
    "body": "<a id='comment:1'></a>\nSo we'd want somthing like this?\n\n```python\nsage: R.<x,y,z> = QQ[]\nsage: I = R.ideal([x*y - z^2])\nsage: A.<xbar,ybar,zbar> = R.quotient(I)\nsage: J = A.ideal([x,z])\n# primary decomposition starts here\nsage: J = Ideal(f.lift() for f in p.gens())\nsage: Q = Sequence(Ideal(A(f) for f in q.gens()) for q in (I + J).primary_decomposition())\n```",
    "created_at": "2014-05-21T11:08:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16381#issuecomment-265634",
    "user": "https://github.com/malb"
}
```

<a id='comment:1'></a>
So we'd want somthing like this?

```python
sage: R.<x,y,z> = QQ[]
sage: I = R.ideal([x*y - z^2])
sage: A.<xbar,ybar,zbar> = R.quotient(I)
sage: J = A.ideal([x,z])
# primary decomposition starts here
sage: J = Ideal(f.lift() for f in p.gens())
sage: Q = Sequence(Ideal(A(f) for f in q.gens()) for q in (I + J).primary_decomposition())
```



---

archive/issue_comments_265635.json:
```json
{
    "body": "Changing author from \"\" to \"Martin Albrecht\"",
    "created_at": "2014-06-25T20:19:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16381#issuecomment-265635",
    "user": "https://github.com/malb"
}
```

Changing author from "" to "Martin Albrecht"



---

archive/issue_comments_265636.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-06-25T20:19:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16381#issuecomment-265636",
    "user": "https://github.com/malb"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_265637.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd59\".",
    "created_at": "2014-06-25T20:20:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16381#issuecomment-265637",
    "user": "https://github.com/malb"
}
```

Changing keywords from "" to "sd59".



---

archive/issue_comments_265638.json:
```json
{
    "body": "Changing branch from \"\" to \"u/malb/trac_16381\"",
    "created_at": "2014-06-25T20:41:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16381#issuecomment-265638",
    "user": "https://github.com/malb"
}
```

Changing branch from "" to "u/malb/trac_16381"



---

archive/issue_comments_265639.json:
```json
{
    "body": "Changing commit from \"\" to \"c237b07be5568f9f19b2333f12dc46efe8a82ea5\"",
    "created_at": "2014-06-25T20:41:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16381#issuecomment-265639",
    "user": "https://github.com/malb"
}
```

Changing commit from "" to "c237b07be5568f9f19b2333f12dc46efe8a82ea5"



---

archive/issue_comments_265640.json:
```json
{
    "body": "<a id='comment:4'></a>\nNew commits:\n|                                                                                                                                          |                                                         |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------|\n|[c237b07](https://github.com/sagemath/sagetrac-mirror/commit/c237b07be5568f9f19b2333f12dc46efe8a82ea5)|`fixing #16381: primary decomposition for quotient rings`|",
    "created_at": "2014-06-25T20:41:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16381#issuecomment-265640",
    "user": "https://github.com/malb"
}
```

<a id='comment:4'></a>
New commits:
|                                                                                                                                          |                                                         |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------|
|[c237b07](https://github.com/sagemath/sagetrac-mirror/commit/c237b07be5568f9f19b2333f12dc46efe8a82ea5)|`fixing #16381: primary decomposition for quotient rings`|



---

archive/issue_comments_265641.json:
```json
{
    "body": "<a id='comment:5'></a>\nAm i missing something or singular can give incorrect anwers in this case? :\n\n```\n                     SINGULAR                                 /  Development\n A Computer Algebra System for Polynomial Computations       /   version 3-1-6\n                                                           0<\n by: W. Decker, G.-M. Greuel, G. Pfister, H. Schoenemann     \\   Dec 2012\nFB Mathematik der Universitaet, D-67653 Kaiserslautern        \\\n> ring r=0,(x,y,z),dp;\n> ideal i=z2-x2-y2;\n> qring  q = i;\n> setring q;\n> ideal j0=y2;\n> ideal j1=x-z;\n> ideal j2=x+z;\n> LIB \"primdec.lib\";\n// ** loaded /home/mmarco/sage/local/share/singular/primdec.lib (14732,2012-03-30)\n// ** loaded /home/mmarco/sage/local/share/singular/ring.lib (15322,2012-10-12)\n// ** loaded /home/mmarco/sage/local/share/singular/absfact.lib (14191,2011-05-04)\n// ** loaded /home/mmarco/sage/local/share/singular/triang.lib (13499,2010-10-15)\n// ** loaded /home/mmarco/sage/local/share/singular/matrix.lib (13658,2010-11-16)\n// ** loaded /home/mmarco/sage/local/share/singular/nctools.lib (14246,2011-05-26)\n// ** loaded /home/mmarco/sage/local/share/singular/inout.lib (13499,2010-10-15)\n// ** loaded /home/mmarco/sage/local/share/singular/random.lib (14661,2012-03-05)\n// ** loaded /home/mmarco/sage/local/share/singular/poly.lib (14852,2012-04-30)\n// ** loaded /home/mmarco/sage/local/share/singular/elim.lib (14661,2012-03-05)\n// ** loaded /home/mmarco/sage/local/share/singular/general.lib (14191,2011-05-04)\n> primdecGTZ(j0);\n[1]:\n   [1]:\n      _[1]=y2\n   [2]:\n      _[1]=y\n```\n\nbut j0 is the inttersection of j1 and j2, which are prime ideals:\n\n```\n> intersect(j1,j2);\n_[1]=x2-z2\n_[2]=xy2+y2z\n> factorize(xy2+y2z);\n[1]:\n   _[1]=1\n   _[2]=x+z\n   _[3]=y\n[2]:\n   1,1,2\n> primdecGTZ(j1);\n[1]:\n   [1]:\n      _[1]=x-z\n   [2]:\n      _[1]=x-z\n> primdecGTZ(j2);\n[1]:\n   [1]:\n      _[1]=x+z\n   [2]:\n      _[1]=x+z\n\n```",
    "created_at": "2014-06-26T07:17:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16381#issuecomment-265641",
    "user": "https://github.com/miguelmarco"
}
```

<a id='comment:5'></a>
Am i missing something or singular can give incorrect anwers in this case? :

```
                     SINGULAR                                 /  Development
 A Computer Algebra System for Polynomial Computations       /   version 3-1-6
                                                           0<
 by: W. Decker, G.-M. Greuel, G. Pfister, H. Schoenemann     \   Dec 2012
FB Mathematik der Universitaet, D-67653 Kaiserslautern        \
> ring r=0,(x,y,z),dp;
> ideal i=z2-x2-y2;
> qring  q = i;
> setring q;
> ideal j0=y2;
> ideal j1=x-z;
> ideal j2=x+z;
> LIB "primdec.lib";
// ** loaded /home/mmarco/sage/local/share/singular/primdec.lib (14732,2012-03-30)
// ** loaded /home/mmarco/sage/local/share/singular/ring.lib (15322,2012-10-12)
// ** loaded /home/mmarco/sage/local/share/singular/absfact.lib (14191,2011-05-04)
// ** loaded /home/mmarco/sage/local/share/singular/triang.lib (13499,2010-10-15)
// ** loaded /home/mmarco/sage/local/share/singular/matrix.lib (13658,2010-11-16)
// ** loaded /home/mmarco/sage/local/share/singular/nctools.lib (14246,2011-05-26)
// ** loaded /home/mmarco/sage/local/share/singular/inout.lib (13499,2010-10-15)
// ** loaded /home/mmarco/sage/local/share/singular/random.lib (14661,2012-03-05)
// ** loaded /home/mmarco/sage/local/share/singular/poly.lib (14852,2012-04-30)
// ** loaded /home/mmarco/sage/local/share/singular/elim.lib (14661,2012-03-05)
// ** loaded /home/mmarco/sage/local/share/singular/general.lib (14191,2011-05-04)
> primdecGTZ(j0);
[1]:
   [1]:
      _[1]=y2
   [2]:
      _[1]=y
```

but j0 is the inttersection of j1 and j2, which are prime ideals:

```
> intersect(j1,j2);
_[1]=x2-z2
_[2]=xy2+y2z
> factorize(xy2+y2z);
[1]:
   _[1]=1
   _[2]=x+z
   _[3]=y
[2]:
   1,1,2
> primdecGTZ(j1);
[1]:
   [1]:
      _[1]=x-z
   [2]:
      _[1]=x-z
> primdecGTZ(j2);
[1]:
   [1]:
      _[1]=x+z
   [2]:
      _[1]=x+z

```



---

archive/issue_comments_265642.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2014-06-26T17:39:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16381#issuecomment-265642",
    "user": "https://github.com/malb"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_265643.json:
```json
{
    "body": "Changing upstream from \"N/A\" to \"Reported upstream. No feedback yet.\"",
    "created_at": "2014-06-26T17:39:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16381#issuecomment-265643",
    "user": "https://github.com/malb"
}
```

Changing upstream from "N/A" to "Reported upstream. No feedback yet."



---

archive/issue_comments_265644.json:
```json
{
    "body": "Changing upstream from \"Reported upstream. No feedback yet.\" to \"Reported upstream. Developers acknowledge bug.\"",
    "created_at": "2014-06-28T03:35:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16381#issuecomment-265644",
    "user": "https://github.com/malb"
}
```

Changing upstream from "Reported upstream. No feedback yet." to "Reported upstream. Developers acknowledge bug."



---

archive/issue_comments_265645.json:
```json
{
    "body": "<a id='comment:7'></a>\nIt's confirmed as a bug in upstream.",
    "created_at": "2014-06-28T03:35:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16381#issuecomment-265645",
    "user": "https://github.com/malb"
}
```

<a id='comment:7'></a>
It's confirmed as a bug in upstream.



---

archive/issue_events_062627.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16381",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16381#event-62627"
}
```



---

archive/issue_comments_265646.json:
```json
{
    "body": "<a id='comment:9'></a>\nPrimary decomposition in quotient rings is not yet supported by Singular, see documentation.\n\nConsider that Singular usually never checks if used parameters are valid or allowed!!\nTheir philosophy is/was that the user should know what he is doing, a very unfortunate one from my point of view. \n\nParameter check is now (since ver 4.0 ) done for primary decomposition.\nMaybe I will add support for primary decomposition in quotient rings, so bug me continuously to get this done.",
    "created_at": "2014-10-29T11:19:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16381",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16381#issuecomment-265646",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:9'></a>
Primary decomposition in quotient rings is not yet supported by Singular, see documentation.

Consider that Singular usually never checks if used parameters are valid or allowed!!
Their philosophy is/was that the user should know what he is doing, a very unfortunate one from my point of view. 

Parameter check is now (since ver 4.0 ) done for primary decomposition.
Maybe I will add support for primary decomposition in quotient rings, so bug me continuously to get this done.
