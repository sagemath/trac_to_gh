# Issue 16044: Fix install_name for R preventing build of rpy2 on OS X 10.4 PPC

archive/issues_015807.json:
```json
{
    "assignees": [],
    "body": "Okay, here we can just do all fixes for any remaining libraries which for [whatever](https://github.com/sagemath/sage/issues/16017#comment:39) [reason](https://github.com/sagemath/sage/issues/16017#comment:42) don't have the right [install_name](https://groups.google.com/d/msg/sage-release/q1DPhL8WQiM/tXZs-byQBRUJ).\n\nR will be needed for rpy to build.\n\nPari became #17588 and in any case wasn't *necessary* for building.\n\nCC:  @kiwifb @nexttime @sagetrac-jpflori\n\nReviewer: **Fran\u00e7ois Bissey**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/16044_\n\n",
    "closed_at": "2015-10-23T17:30:57Z",
    "created_at": "2014-04-02T02:14:44Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/invalid"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Fix install_name for R preventing build of rpy2 on OS X 10.4 PPC",
    "type": "issue",
    "updated_at": "2015-10-23T17:30:57Z",
    "url": "https://github.com/sagemath/sage/issues/16044",
    "user": "https://github.com/kcrisman"
}
```
Okay, here we can just do all fixes for any remaining libraries which for [whatever](https://github.com/sagemath/sage/issues/16017#comment:39) [reason](https://github.com/sagemath/sage/issues/16017#comment:42) don't have the right [install_name](https://groups.google.com/d/msg/sage-release/q1DPhL8WQiM/tXZs-byQBRUJ).

R will be needed for rpy to build.

Pari became #17588 and in any case wasn't *necessary* for building.

CC:  @kiwifb @nexttime @sagetrac-jpflori

Reviewer: **François Bissey**

_Issue created by migration from https://trac.sagemath.org/ticket/16044_





---

archive/issue_events_211472.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2014-04-02T02:14:44Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16044#event-211472"
}
```



---

archive/issue_events_211473.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2014-04-02T02:14:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
    "label_color": "000080",
    "label_name": "component: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16044#event-211473"
}
```



---

archive/issue_events_211474.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2014-04-02T02:14:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "label": "https://github.com/sagemath/sage/labels/p1%20%E2%80%93%20blocker",
    "label_color": "ff0000",
    "label_name": "p1 \u2013 blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16044#event-211474"
}
```



---

archive/issue_events_211475.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2014-04-02T02:14:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16044#event-211475"
}
```



---

archive/issue_comments_206638.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">Comment 1</div>\n\nJust wonder what changed overall in Sage that makes these changes necessary now.\n\n`DYLD_LIBRARY_PATH` not set when it was previously?  Should we perhaps set `DYLD_FALLBACK_LIBRARY_PATH`?   (Not sure whether the latter applies to MacOS X 10.4 at all.)\n\nAnd whenever the Sage installation moves, we'll have to update all those paths / `install_name`s, too.",
    "created_at": "2014-04-02T08:35:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206638",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:1" align="right">Comment 1</div>

Just wonder what changed overall in Sage that makes these changes necessary now.

`DYLD_LIBRARY_PATH` not set when it was previously?  Should we perhaps set `DYLD_FALLBACK_LIBRARY_PATH`?   (Not sure whether the latter applies to MacOS X 10.4 at all.)

And whenever the Sage installation moves, we'll have to update all those paths / `install_name`s, too.



---

archive/issue_comments_206639.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nIt is a fair question. DYLD_LIBRARY_PATH is defined in sage-env but I don't think it would have the kind of effects we see at building time. I will point my big (not so fat) finger at gcc. A OS X install will, by necessity, build a recent gcc. When did we switch to 4.7.3?\n\nTechnically all those install_name could be relative [http://blog.onesadcookie.com/2008/01/installname-magic.html](http://blog.onesadcookie.com/2008/01/installname-magic.html) but that would be a lot of work. The best way to do something like that would be to have skpg-install systematically change the install_name of all libraries. Never mind that spkg-install is not aware of what it installs.",
    "created_at": "2014-04-02T09:52:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206639",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:2" align="right">Comment 2</div>

It is a fair question. DYLD_LIBRARY_PATH is defined in sage-env but I don't think it would have the kind of effects we see at building time. I will point my big (not so fat) finger at gcc. A OS X install will, by necessity, build a recent gcc. When did we switch to 4.7.3?

Technically all those install_name could be relative [http://blog.onesadcookie.com/2008/01/installname-magic.html](http://blog.onesadcookie.com/2008/01/installname-magic.html) but that would be a lot of work. The best way to do something like that would be to have skpg-install systematically change the install_name of all libraries. Never mind that spkg-install is not aware of what it installs.



---

archive/issue_comments_206640.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nReplying to [@kiwifb](#comment%3A2):\n> It is a fair question. DYLD_LIBRARY_PATH is defined in sage-env but I don't think it would have the kind of effects we see at building time. I will point my big (not so fat) finger at gcc. A OS X install will, by necessity, build a recent gcc. When did we switch to 4.7.3?\n\nUh, don't know; but Sage 5.10 already contained it.  (And if a change in GCC -- more precisely, the compiler driver I think -- would be relevant at all, it presumably would have happened when switching from 4.6.x to 4.7.x.)\n\n\n\n\n> The best way to do something like that would be to have skpg-install systematically change the install_name of all libraries. Never mind that spkg-install is not aware of what it installs.\n\nWell, we used to have odd scripts like `sage-make_relative`, called after any package installation, unconditionally retrying to rewrite everything... :-)\n\n(Not to mention completely uselessly rerunning `ranlib` on all static libraries each time Sage thought its location might have changed...)",
    "created_at": "2014-04-02T11:15:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206640",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:3" align="right">Comment 3</div>

Replying to [@kiwifb](#comment%3A2):
> It is a fair question. DYLD_LIBRARY_PATH is defined in sage-env but I don't think it would have the kind of effects we see at building time. I will point my big (not so fat) finger at gcc. A OS X install will, by necessity, build a recent gcc. When did we switch to 4.7.3?

Uh, don't know; but Sage 5.10 already contained it.  (And if a change in GCC -- more precisely, the compiler driver I think -- would be relevant at all, it presumably would have happened when switching from 4.6.x to 4.7.x.)




> The best way to do something like that would be to have skpg-install systematically change the install_name of all libraries. Never mind that spkg-install is not aware of what it installs.

Well, we used to have odd scripts like `sage-make_relative`, called after any package installation, unconditionally retrying to rewrite everything... :-)

(Not to mention completely uselessly rerunning `ranlib` on all static libraries each time Sage thought its location might have changed...)



---

archive/issue_comments_206641.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\n> And whenever the Sage installation moves, we'll have to update all those paths / `install_name`s, too.\n\nSo you're saying that any solution that fixes this is brittle?  Sage should be relocatable, at least that is the usual expectation (and is why the `sage-location` script is/was always run, though with the reorganized structure I'm still getting used to a few changes that may have happened recently.)",
    "created_at": "2014-04-02T14:42:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206641",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:4" align="right">Comment 4</div>

> And whenever the Sage installation moves, we'll have to update all those paths / `install_name`s, too.

So you're saying that any solution that fixes this is brittle?  Sage should be relocatable, at least that is the usual expectation (and is why the `sage-location` script is/was always run, though with the reorganized structure I'm still getting used to a few changes that may have happened recently.)



---

archive/issue_comments_206642.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nReplying to [@kcrisman](#comment%3A4):\n> > And whenever the Sage installation moves, we'll have to update all those paths / `install_name`s, too.\n\n> So you're saying that any solution that fixes this is brittle?  Sage should be relocatable, at least that is the usual expectation (and is why the `sage-location` script is/was always run, though with the reorganized structure I'm still getting used to a few changes that may have happened recently.)\n\nWell, as mentioned on the original ticket, Darwin's `install_name` mechanism also supports flavours of *relative* paths, but Fran\u00e7ois told me that those features are only available on MacOS X 10.5 (or probably 10.6) and later, so we'll presumably have to treat 10.4 specially (at least if we want to avoid useless rewrites or effectively no-ops).  `dyld`'s manpage on your 10.4 system should tell what's supported, not necessarily `ld`'s.  (It would also be interesting whether it supports `DYLD_FALLBACK_LIBRARY_PATH`.)",
    "created_at": "2014-04-02T18:08:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206642",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:5" align="right">Comment 5</div>

Replying to [@kcrisman](#comment%3A4):
> > And whenever the Sage installation moves, we'll have to update all those paths / `install_name`s, too.

> So you're saying that any solution that fixes this is brittle?  Sage should be relocatable, at least that is the usual expectation (and is why the `sage-location` script is/was always run, though with the reorganized structure I'm still getting used to a few changes that may have happened recently.)

Well, as mentioned on the original ticket, Darwin's `install_name` mechanism also supports flavours of *relative* paths, but François told me that those features are only available on MacOS X 10.5 (or probably 10.6) and later, so we'll presumably have to treat 10.4 specially (at least if we want to avoid useless rewrites or effectively no-ops).  `dyld`'s manpage on your 10.4 system should tell what's supported, not necessarily `ld`'s.  (It would also be interesting whether it supports `DYLD_FALLBACK_LIBRARY_PATH`.)



---

archive/issue_comments_206643.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nReplying to [@nexttime](#comment%3A3):\n> Well, we used to have odd scripts like `sage-make_relative`, called after any package installation, unconditionally retrying to rewrite everything... :-)\n> \n> (Not to mention completely uselessly rerunning `ranlib` on all static libraries each time Sage thought its location might have changed...)\n\nFor the record, that bu!**sh!** is still in Sage 6.2.beta6's `sage-location`:\n\n```python\n\ndef update_library_files():\n    \"\"\"\n    Run ``ranlib`` on all static libraries (``*.a``) in the library\n    directory, and manually change the paths in all ``.la`` libtool\n    archives.\n    \"\"\"\n    for libdir in [\"lib\", \"lib32\", \"lib64\"]:\n        LIB = os.path.join(SAGE_LOCAL, libdir)\n        if not os.path.isdir(LIB):\n            continue\n\n        # The .a files should be re-ranlib'd:\n        os.system('cd \"%s\"; ranlib *.a 1>/dev/null 2>/dev/null' % LIB)\n\n        ...\n\n```",
    "created_at": "2014-04-02T18:18:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206643",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:6" align="right">Comment 6</div>

Replying to [@nexttime](#comment%3A3):
> Well, we used to have odd scripts like `sage-make_relative`, called after any package installation, unconditionally retrying to rewrite everything... :-)
> 
> (Not to mention completely uselessly rerunning `ranlib` on all static libraries each time Sage thought its location might have changed...)

For the record, that bu!**sh!** is still in Sage 6.2.beta6's `sage-location`:

```python

def update_library_files():
    """
    Run ``ranlib`` on all static libraries (``*.a``) in the library
    directory, and manually change the paths in all ``.la`` libtool
    archives.
    """
    for libdir in ["lib", "lib32", "lib64"]:
        LIB = os.path.join(SAGE_LOCAL, libdir)
        if not os.path.isdir(LIB):
            continue

        # The .a files should be re-ranlib'd:
        os.system('cd "%s"; ranlib *.a 1>/dev/null 2>/dev/null' % LIB)

        ...

```



---

archive/issue_comments_206644.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\n...  while it **doesn't** touch hardcoded (absolute) `install_name`s (also seen on MacOS X 10.6) in Darwin's dynamic library files (`.dylib`, `.so`).\n\nm)",
    "created_at": "2014-04-02T18:33:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206644",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:7" align="right">Comment 7</div>

...  while it **doesn't** touch hardcoded (absolute) `install_name`s (also seen on MacOS X 10.6) in Darwin's dynamic library files (`.dylib`, `.so`).

m)



---

archive/issue_comments_206645.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nSCNR:\n\n```\nleif@bsd:~/Sage$ mv sage-6.2.beta5 sage-6.2.beta5-foo-bar\nleif@bsd:~/Sage$ cd sage-6.2.beta5-foo-bar/\nleif@bsd:~/Sage/sage-6.2.beta5-foo-bar$ ./sage \n/Users/leif/Sage/sage-6.2.beta5-foo-bar/src/bin/sage-env: line 391: 55381 Trace/BPT trap          \"$SAGE_ROOT/local/bin/python\" -c 'import pkg_resources; pkg_resources.get_distribution(\"matplotlib\").version' 2> /dev/null\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Sage Version 6.2.beta5, Release Date: 2014-03-23                   \u2502\n\u2502 Type \"notebook()\" for the browser-based notebook interface.        \u2502\n\u2502 Type \"help()\" for help.                                            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Warning: this is a prerelease version, and it may be unstable.     \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\nThe Sage installation tree has moved\nfrom /Users/leif/Sage/sage-6.2.beta5\n  to /Users/leif/Sage/sage-6.2.beta5-foo-bar\nUpdating various hardcoded paths...\n(Please wait at most a few minutes.)\nDO NOT INTERRUPT THIS.\nDone updating paths.\nsage: \nExiting Sage (CPU time 0m0.03s, Wall time 0m5.47s).\nleif@bsd:~/Sage/sage-6.2.beta5-foo-bar$ otool -L local/lib/libcsage.dylib \nlocal/lib/libcsage.dylib:\n\tlibcsage.dylib (compatibility version 0.0.0, current version 0.0.0)\n\t/Users/leif/Sage/sage-6.2.beta5/local/lib/libntl.2.dylib (compatibility version 3.0.0, current version 3.0.0)\n\t/Users/leif/Sage/sage-6.2.beta5/local/var/tmp/sage/build/pari-2.5.5b.p1/src/Odarwin-i386/libpari-gmp.dylib (compatibility version 2.5.0, current version 2.5.5)\n\t/Users/leif/Sage/sage-6.2.beta5/local/lib/libgmp.11.dylib (compatibility version 12.0.0, current version 12.0.0)\n\t/Users/leif/Sage/sage-6.2.beta5/local/lib/libpython2.7.dylib (compatibility version 2.7.0, current version 2.7.0)\n\t/Users/leif/Sage/sage-6.2.beta5/local/lib/libstdc++.6.dylib (compatibility version 7.0.0, current version 7.17.0)\n\t/usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 125.2.11)\n\t/Users/leif/Sage/sage-6.2.beta5/local/lib/libgcc_s.1.dylib (compatibility version 1.0.0, current version 1.0.0)\n```",
    "created_at": "2014-04-02T18:43:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206645",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:8" align="right">Comment 8</div>

SCNR:

```
leif@bsd:~/Sage$ mv sage-6.2.beta5 sage-6.2.beta5-foo-bar
leif@bsd:~/Sage$ cd sage-6.2.beta5-foo-bar/
leif@bsd:~/Sage/sage-6.2.beta5-foo-bar$ ./sage 
/Users/leif/Sage/sage-6.2.beta5-foo-bar/src/bin/sage-env: line 391: 55381 Trace/BPT trap          "$SAGE_ROOT/local/bin/python" -c 'import pkg_resources; pkg_resources.get_distribution("matplotlib").version' 2> /dev/null
┌────────────────────────────────────────────────────────────────────┐
│ Sage Version 6.2.beta5, Release Date: 2014-03-23                   │
│ Type "notebook()" for the browser-based notebook interface.        │
│ Type "help()" for help.                                            │
└────────────────────────────────────────────────────────────────────┘
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Warning: this is a prerelease version, and it may be unstable.     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
The Sage installation tree has moved
from /Users/leif/Sage/sage-6.2.beta5
  to /Users/leif/Sage/sage-6.2.beta5-foo-bar
Updating various hardcoded paths...
(Please wait at most a few minutes.)
DO NOT INTERRUPT THIS.
Done updating paths.
sage: 
Exiting Sage (CPU time 0m0.03s, Wall time 0m5.47s).
leif@bsd:~/Sage/sage-6.2.beta5-foo-bar$ otool -L local/lib/libcsage.dylib 
local/lib/libcsage.dylib:
	libcsage.dylib (compatibility version 0.0.0, current version 0.0.0)
	/Users/leif/Sage/sage-6.2.beta5/local/lib/libntl.2.dylib (compatibility version 3.0.0, current version 3.0.0)
	/Users/leif/Sage/sage-6.2.beta5/local/var/tmp/sage/build/pari-2.5.5b.p1/src/Odarwin-i386/libpari-gmp.dylib (compatibility version 2.5.0, current version 2.5.5)
	/Users/leif/Sage/sage-6.2.beta5/local/lib/libgmp.11.dylib (compatibility version 12.0.0, current version 12.0.0)
	/Users/leif/Sage/sage-6.2.beta5/local/lib/libpython2.7.dylib (compatibility version 2.7.0, current version 2.7.0)
	/Users/leif/Sage/sage-6.2.beta5/local/lib/libstdc++.6.dylib (compatibility version 7.0.0, current version 7.17.0)
	/usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 125.2.11)
	/Users/leif/Sage/sage-6.2.beta5/local/lib/libgcc_s.1.dylib (compatibility version 1.0.0, current version 1.0.0)
```



---

archive/issue_comments_206646.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\nFurthermore, restarting the \"relocated\" Sage installation, the \"BPT/trap\" remains; with `2>/dev/null` removed from line 391 of `sage-env`:\n\n```\nleif@bsd:~/Sage/sage-6.2.beta5-foo-bar$ ./sage \ndyld: Library not loaded: /Users/leif/Sage/sage-6.2.beta5/local/lib/libpython2.7.dylib\n  Referenced from: /Users/leif/Sage/sage-6.2.beta5-foo-bar/local/bin/python\n  Reason: image not found\n/Users/leif/Sage/sage-6.2.beta5-foo-bar/src/bin/sage-env: line 392: 55537 Trace/BPT trap          \"$SAGE_ROOT/local/bin/python\" -c 'import pkg_resources; pkg_resources.get_distribution(\"matplotlib\").version'\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Sage Version 6.2.beta5, Release Date: 2014-03-23                   \u2502\n\u2502 Type \"notebook()\" for the browser-based notebook interface.        \u2502\n\u2502 Type \"help()\" for help.                                            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Warning: this is a prerelease version, and it may be unstable.     \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\nsage: \n```",
    "created_at": "2014-04-02T18:57:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206646",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:9" align="right">Comment 9</div>

Furthermore, restarting the "relocated" Sage installation, the "BPT/trap" remains; with `2>/dev/null` removed from line 391 of `sage-env`:

```
leif@bsd:~/Sage/sage-6.2.beta5-foo-bar$ ./sage 
dyld: Library not loaded: /Users/leif/Sage/sage-6.2.beta5/local/lib/libpython2.7.dylib
  Referenced from: /Users/leif/Sage/sage-6.2.beta5-foo-bar/local/bin/python
  Reason: image not found
/Users/leif/Sage/sage-6.2.beta5-foo-bar/src/bin/sage-env: line 392: 55537 Trace/BPT trap          "$SAGE_ROOT/local/bin/python" -c 'import pkg_resources; pkg_resources.get_distribution("matplotlib").version'
┌────────────────────────────────────────────────────────────────────┐
│ Sage Version 6.2.beta5, Release Date: 2014-03-23                   │
│ Type "notebook()" for the browser-based notebook interface.        │
│ Type "help()" for help.                                            │
└────────────────────────────────────────────────────────────────────┘
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Warning: this is a prerelease version, and it may be unstable.     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
sage: 
```



---

archive/issue_comments_206647.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\n\n```\n/Users/leif/Sage/sage-6.2.beta5/local/var/tmp/sage/build/pari-2.5.5b.p1/src/Odarwin-i386/libpari-gmp.dylib (compatibility version 2.5.0, current version 2.5.5)\n```\nThink that one is still available? (tmp?)\n\nI think that having a non-movable OS X 10.4 is probably ok, since it's such an unusual platform nowadays.  I largely want to keep it going now because it has a chip that is not Intel nor ARM.\n\n---\n\n`man dyld` definitely gives `DYLD_FALLBACK_LIBRARY_PATH` under synopsis.  \"By default set to `$(HOME)/lib:/usr/local/lib:/lib:/usr/lib`.\"  And apparently that is honored by `ld`.  The only useful info in `man install_name_tool` is that if you want to change the names to long ones is that you want to pass the `-header-pad_max_install_names` option to `ld`.",
    "created_at": "2014-04-02T19:03:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206647",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:10" align="right">Comment 10</div>


```
/Users/leif/Sage/sage-6.2.beta5/local/var/tmp/sage/build/pari-2.5.5b.p1/src/Odarwin-i386/libpari-gmp.dylib (compatibility version 2.5.0, current version 2.5.5)
```
Think that one is still available? (tmp?)

I think that having a non-movable OS X 10.4 is probably ok, since it's such an unusual platform nowadays.  I largely want to keep it going now because it has a chip that is not Intel nor ARM.

---

`man dyld` definitely gives `DYLD_FALLBACK_LIBRARY_PATH` under synopsis.  "By default set to `$(HOME)/lib:/usr/local/lib:/lib:/usr/lib`."  And apparently that is honored by `ld`.  The only useful info in `man install_name_tool` is that if you want to change the names to long ones is that you want to pass the `-header-pad_max_install_names` option to `ld`.



---

archive/issue_comments_206648.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\nReplying to [@nexttime](#comment%3A5):\n> Replying to [@kcrisman](#comment%3A4):\n> > > And whenever the Sage installation moves, we'll have to update all those paths / `install_name`s, too.\n\n> > So you're saying that any solution that fixes this is brittle?  Sage should be relocatable, at least that is the usual expectation (and is why the `sage-location` script is/was always run, though with the reorganized structure I'm still getting used to a few changes that may have happened recently.)\n\n> \n> Well, as mentioned on the original ticket, Darwin's `install_name` mechanism also supports flavours of *relative* paths, but Fran\u00e7ois told me that those features are only available on MacOS X 10.5 (or probably 10.6) and later, so we'll presumably have to treat 10.4 specially (at least if we want to avoid useless rewrites or effectively no-ops).  `dyld`'s manpage on your 10.4 system should tell what's supported, not necessarily `ld`'s.  (It would also be interesting whether it supports `DYLD_FALLBACK_LIBRARY_PATH`.)\n> \n\n`@`rpath is OS X 10.5+ but `@`loader_path and `@`execute_path are in 10.4. As it happens we wouldn't want `@`rpath I think. `@`loader_path is apparently filling the same role as \"Origin\" under linux. And `@`loader_path is what is in polybori. I just don't know if it is correct in there.",
    "created_at": "2014-04-02T20:26:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206648",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:11" align="right">Comment 11</div>

Replying to [@nexttime](#comment%3A5):
> Replying to [@kcrisman](#comment%3A4):
> > > And whenever the Sage installation moves, we'll have to update all those paths / `install_name`s, too.

> > So you're saying that any solution that fixes this is brittle?  Sage should be relocatable, at least that is the usual expectation (and is why the `sage-location` script is/was always run, though with the reorganized structure I'm still getting used to a few changes that may have happened recently.)

> 
> Well, as mentioned on the original ticket, Darwin's `install_name` mechanism also supports flavours of *relative* paths, but François told me that those features are only available on MacOS X 10.5 (or probably 10.6) and later, so we'll presumably have to treat 10.4 specially (at least if we want to avoid useless rewrites or effectively no-ops).  `dyld`'s manpage on your 10.4 system should tell what's supported, not necessarily `ld`'s.  (It would also be interesting whether it supports `DYLD_FALLBACK_LIBRARY_PATH`.)
> 

`@`rpath is OS X 10.5+ but `@`loader_path and `@`execute_path are in 10.4. As it happens we wouldn't want `@`rpath I think. `@`loader_path is apparently filling the same role as "Origin" under linux. And `@`loader_path is what is in polybori. I just don't know if it is correct in there.



---

archive/issue_comments_206649.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">Comment 12</div>\n\nReplying to [@kcrisman](#comment%3A10):\n> \n> ```\n> /Users/leif/Sage/sage-6.2.beta5/local/var/tmp/sage/build/pari-2.5.5b.p1/src/Odarwin-i386/libpari-gmp.dylib (compatibility version 2.5.0, current version 2.5.5)\n> ```\n> Think that one is still available? (tmp?)\n\n?\n\n(`$SAGE_LOCAL/var/tmp/` gets cleaned up, so the library won't be there, if you meant that.)",
    "created_at": "2014-04-02T20:50:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206649",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:12" align="right">Comment 12</div>

Replying to [@kcrisman](#comment%3A10):
> 
> ```
> /Users/leif/Sage/sage-6.2.beta5/local/var/tmp/sage/build/pari-2.5.5b.p1/src/Odarwin-i386/libpari-gmp.dylib (compatibility version 2.5.0, current version 2.5.5)
> ```
> Think that one is still available? (tmp?)

?

(`$SAGE_LOCAL/var/tmp/` gets cleaned up, so the library won't be there, if you meant that.)



---

archive/issue_comments_206650.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nReplying to [@kcrisman](#comment%3A10):\n> I think that having a non-movable OS X 10.4 is probably ok, since it's such an unusual platform nowadays.  I largely want to keep it going now because it has a chip that is not Intel nor ARM.\n\nLooks as if relocation was currently broken on **any** Darwin (at least MacOS X 10.6, too) anyway.  Not going to tell you what happened when trying `make [p]testlong` in the renamed beta5 installation...\n\n\n\n\n> `man dyld` definitely gives `DYLD_FALLBACK_LIBRARY_PATH` under synopsis.  \"By default set to `$(HOME)/lib:/usr/local/lib:/lib:/usr/lib`.\"  And apparently that is honored by `ld`.\n\nI think that's good news.  We could prepend `$SAGE_LOCAL/lib` (and probably some R subdirs) to that.\n\n\n\n\n> The only useful info in `man install_name_tool` is that if you want to change the names to long ones is that you want to pass the `-header-pad_max_install_names` option to `ld`.\n\n:-)  Depends on what weird paths users decide to install / move Sage into.\n\nFWIW, `chrpath` (for ELF objects) also needs (or used to need) some \"workspace\".",
    "created_at": "2014-04-02T21:02:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206650",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:13" align="right">Comment 13</div>

Replying to [@kcrisman](#comment%3A10):
> I think that having a non-movable OS X 10.4 is probably ok, since it's such an unusual platform nowadays.  I largely want to keep it going now because it has a chip that is not Intel nor ARM.

Looks as if relocation was currently broken on **any** Darwin (at least MacOS X 10.6, too) anyway.  Not going to tell you what happened when trying `make [p]testlong` in the renamed beta5 installation...




> `man dyld` definitely gives `DYLD_FALLBACK_LIBRARY_PATH` under synopsis.  "By default set to `$(HOME)/lib:/usr/local/lib:/lib:/usr/lib`."  And apparently that is honored by `ld`.

I think that's good news.  We could prepend `$SAGE_LOCAL/lib` (and probably some R subdirs) to that.




> The only useful info in `man install_name_tool` is that if you want to change the names to long ones is that you want to pass the `-header-pad_max_install_names` option to `ld`.

:-)  Depends on what weird paths users decide to install / move Sage into.

FWIW, `chrpath` (for ELF objects) also needs (or used to need) some "workspace".



---

archive/issue_comments_206651.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\n> Looks as if relocation was currently broken on **any** Darwin (at least MacOS X 10.6, too) anyway.  Not going to tell you what happened when trying `make [p]testlong` in the renamed beta5 installation...\n\nOh, that is bad.  Especially since people download binaries and might move them a few times.  I'm going to ask on sage-release about that.\n> > The only useful info in `man install_name_tool` is that if you want to change the names to long ones is that you want to pass the `-header-pad_max_install_names` option to `ld`.\n\n> \n> :-)  Depends on what weird paths users decide to install / move Sage into.\n\nWe already don't allow spaces very much, so this is not too big of a restriction I think.",
    "created_at": "2014-04-03T01:40:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206651",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:14" align="right">Comment 14</div>

> Looks as if relocation was currently broken on **any** Darwin (at least MacOS X 10.6, too) anyway.  Not going to tell you what happened when trying `make [p]testlong` in the renamed beta5 installation...

Oh, that is bad.  Especially since people download binaries and might move them a few times.  I'm going to ask on sage-release about that.
> > The only useful info in `man install_name_tool` is that if you want to change the names to long ones is that you want to pass the `-header-pad_max_install_names` option to `ld`.

> 
> :-)  Depends on what weird paths users decide to install / move Sage into.

We already don't allow spaces very much, so this is not too big of a restriction I think.



---

archive/issue_comments_206652.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\nW.r.t. relocation on Darwin, fbissey could perhaps confirm I'm not telling nonsense (nor made some stupid mistake).",
    "created_at": "2014-04-03T02:34:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206652",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:15" align="right">Comment 15</div>

W.r.t. relocation on Darwin, fbissey could perhaps confirm I'm not telling nonsense (nor made some stupid mistake).



---

archive/issue_comments_206653.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">Comment 16</div>\n\nHave to give it a go. I cannot say I haven't worried about relocation but I am not a practioner.",
    "created_at": "2014-04-03T02:41:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206653",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:16" align="right">Comment 16</div>

Have to give it a go. I cannot say I haven't worried about relocation but I am not a practioner.



---

archive/issue_comments_206654.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">Comment 17</div>\n\nQuick-testing a moved (definitely vanilla / virgin) Sage 6.1.1 installation (again on bsd.math), apparently only git- and trac-related doctests fail (and I don't see the exception from `sage-env`):\n\n```\n----------------------------------------------------------------------\nsage -t src/sage/dev/sagedev.py  # 273 doctests failed\nsage -t src/sage/dev/git_interface.py  # 27 doctests failed\nsage -t src/sage/dev/patch.py  # 9 doctests failed\nsage -t src/sage/dev/test/server_proxy.py  # 26 doctests failed\nsage -t src/sage/dev/trac_interface.py  # 27 doctests failed\nsage -t src/sage/dev/test/sagedev.py  # 10 doctests failed\nsage -t src/sage/dev/config.py  # 18 doctests failed\nsage -t src/sage/dev/user_interface.py  # 13 doctests failed\nsage -t src/sage/dev/cmd_line_interface.py  # 14 doctests failed\nsage -t src/sage/dev/test/trac_interface.py  # 8 doctests failed\nsage -t src/sage/dev/sagedev_wrapper.py  # 4 doctests failed\nsage -t src/sage/dev/test/user_interface.py  # 4 doctests failed\nsage -t src/sage/dev/test/trac_server.py  # 2 doctests failed\nsage -t src/sage/dev/sagedev_instance.py  # 1 doctest failed\nsage -t src/sage/dev/test/config.py  # 2 doctests failed\n----------------------------------------------------------------------\n```\n\nOverall, a more limited disaster there... :-)",
    "created_at": "2014-04-03T03:33:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206654",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:17" align="right">Comment 17</div>

Quick-testing a moved (definitely vanilla / virgin) Sage 6.1.1 installation (again on bsd.math), apparently only git- and trac-related doctests fail (and I don't see the exception from `sage-env`):

```
----------------------------------------------------------------------
sage -t src/sage/dev/sagedev.py  # 273 doctests failed
sage -t src/sage/dev/git_interface.py  # 27 doctests failed
sage -t src/sage/dev/patch.py  # 9 doctests failed
sage -t src/sage/dev/test/server_proxy.py  # 26 doctests failed
sage -t src/sage/dev/trac_interface.py  # 27 doctests failed
sage -t src/sage/dev/test/sagedev.py  # 10 doctests failed
sage -t src/sage/dev/config.py  # 18 doctests failed
sage -t src/sage/dev/user_interface.py  # 13 doctests failed
sage -t src/sage/dev/cmd_line_interface.py  # 14 doctests failed
sage -t src/sage/dev/test/trac_interface.py  # 8 doctests failed
sage -t src/sage/dev/sagedev_wrapper.py  # 4 doctests failed
sage -t src/sage/dev/test/user_interface.py  # 4 doctests failed
sage -t src/sage/dev/test/trac_server.py  # 2 doctests failed
sage -t src/sage/dev/sagedev_instance.py  # 1 doctest failed
sage -t src/sage/dev/test/config.py  # 2 doctests failed
----------------------------------------------------------------------
```

Overall, a more limited disaster there... :-)



---

archive/issue_comments_206655.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">Comment 18</div>\n\nMy compilerwrapper https://bitbucket.org/vbraun/compilerwrapper is designed to correctly set install_name / rpaths globally.",
    "created_at": "2014-04-03T10:34:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206655",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:18" align="right">Comment 18</div>

My compilerwrapper https://bitbucket.org/vbraun/compilerwrapper is designed to correctly set install_name / rpaths globally.



---

archive/issue_comments_206656.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">Comment 19</div>\n\nReplying to [@vbraun](#comment%3A18):\n> My compilerwrapper https://bitbucket.org/vbraun/compilerwrapper is designed to correctly set install_name / rpaths globally.\n\nYou use `@`loader_path on OS X?",
    "created_at": "2014-04-03T10:41:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206656",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:19" align="right">Comment 19</div>

Replying to [@vbraun](#comment%3A18):
> My compilerwrapper https://bitbucket.org/vbraun/compilerwrapper is designed to correctly set install_name / rpaths globally.

You use `@`loader_path on OS X?



---

archive/issue_comments_206657.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">Comment 20</div>\n\nReplying to [@nexttime](#comment%3A17):\n> Quick-testing a moved (definitely vanilla / virgin) Sage 6.1.1 installation (again on bsd.math), apparently only git- and trac-related doctests fail (and I don't see the exception from `sage-env`):\n> \n> ```\n> ----------------------------------------------------------------------\n> sage -t src/sage/dev/sagedev.py  # 273 doctests failed\n> sage -t src/sage/dev/git_interface.py  # 27 doctests failed\n> sage -t src/sage/dev/patch.py  # 9 doctests failed\n> sage -t src/sage/dev/test/server_proxy.py  # 26 doctests failed\n> sage -t src/sage/dev/trac_interface.py  # 27 doctests failed\n> sage -t src/sage/dev/test/sagedev.py  # 10 doctests failed\n> sage -t src/sage/dev/config.py  # 18 doctests failed\n> sage -t src/sage/dev/user_interface.py  # 13 doctests failed\n> sage -t src/sage/dev/cmd_line_interface.py  # 14 doctests failed\n> sage -t src/sage/dev/test/trac_interface.py  # 8 doctests failed\n> sage -t src/sage/dev/sagedev_wrapper.py  # 4 doctests failed\n> sage -t src/sage/dev/test/user_interface.py  # 4 doctests failed\n> sage -t src/sage/dev/test/trac_server.py  # 2 doctests failed\n> sage -t src/sage/dev/sagedev_instance.py  # 1 doctest failed\n> sage -t src/sage/dev/test/config.py  # 2 doctests failed\n> ----------------------------------------------------------------------\n> ```\n> \n> Overall, a more limited disaster there... :-)\n\nIt reminds of of something... Are errors (un)pickling related?",
    "created_at": "2014-04-03T11:20:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206657",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:20" align="right">Comment 20</div>

Replying to [@nexttime](#comment%3A17):
> Quick-testing a moved (definitely vanilla / virgin) Sage 6.1.1 installation (again on bsd.math), apparently only git- and trac-related doctests fail (and I don't see the exception from `sage-env`):
> 
> ```
> ----------------------------------------------------------------------
> sage -t src/sage/dev/sagedev.py  # 273 doctests failed
> sage -t src/sage/dev/git_interface.py  # 27 doctests failed
> sage -t src/sage/dev/patch.py  # 9 doctests failed
> sage -t src/sage/dev/test/server_proxy.py  # 26 doctests failed
> sage -t src/sage/dev/trac_interface.py  # 27 doctests failed
> sage -t src/sage/dev/test/sagedev.py  # 10 doctests failed
> sage -t src/sage/dev/config.py  # 18 doctests failed
> sage -t src/sage/dev/user_interface.py  # 13 doctests failed
> sage -t src/sage/dev/cmd_line_interface.py  # 14 doctests failed
> sage -t src/sage/dev/test/trac_interface.py  # 8 doctests failed
> sage -t src/sage/dev/sagedev_wrapper.py  # 4 doctests failed
> sage -t src/sage/dev/test/user_interface.py  # 4 doctests failed
> sage -t src/sage/dev/test/trac_server.py  # 2 doctests failed
> sage -t src/sage/dev/sagedev_instance.py  # 1 doctest failed
> sage -t src/sage/dev/test/config.py  # 2 doctests failed
> ----------------------------------------------------------------------
> ```
> 
> Overall, a more limited disaster there... :-)

It reminds of of something... Are errors (un)pickling related?



---

archive/issue_comments_206658.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">Comment 21</div>\n\nReplying to [@kiwifb](#comment%3A19):\n> You use `@`loader_path on OS X?\n\nNo, `@`rpath.",
    "created_at": "2014-04-03T11:46:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206658",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:21" align="right">Comment 21</div>

Replying to [@kiwifb](#comment%3A19):
> You use `@`loader_path on OS X?

No, `@`rpath.



---

archive/issue_comments_206659.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">Comment 22</div>\n\n> > Looks as if relocation was currently broken on **any** Darwin (at least MacOS X 10.6, too) anyway.  Not going to tell you what happened when trying `make [p]testlong` in the renamed beta5 installation...\n\n> Oh, that is bad.  Especially since people download binaries and might move them a few times.  I'm going to ask on sage-release about that.\n\nAgain, my concern here is especially that when people download binaries that they work, since those are technically relocated (by actual miles, not just bits).",
    "created_at": "2014-04-03T14:52:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206659",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:22" align="right">Comment 22</div>

> > Looks as if relocation was currently broken on **any** Darwin (at least MacOS X 10.6, too) anyway.  Not going to tell you what happened when trying `make [p]testlong` in the renamed beta5 installation...

> Oh, that is bad.  Especially since people download binaries and might move them a few times.  I'm going to ask on sage-release about that.

Again, my concern here is especially that when people download binaries that they work, since those are technically relocated (by actual miles, not just bits).



---

archive/issue_comments_206660.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">Comment 23</div>\n\nI see these, too, after relocating. If I rebuild just git and run tests again, everything passes.",
    "created_at": "2014-04-03T15:00:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206660",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:23" align="right">Comment 23</div>

I see these, too, after relocating. If I rebuild just git and run tests again, everything passes.



---

archive/issue_comments_206661.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">Comment 24</div>\n\nReplying to [@jhpalmieri](#comment%3A23):\n> I see these, too, after relocating. If I rebuild just git and run tests again, everything passes.\n\nWith 6.1.1: Yes, apparently some hardcoded paths in config files.\n\nWhat Sage version did you test?  With 6.2.beta?, I'd expect at least the exception in `sage-env` to occur.  (MPL-related;  to get MPL's version, Python is called apparently before anything gets \"repaired\".)  Not sure whether that (or removing `2>/dev/null` there) caused the rest of the disaster that happened on bsd.math afterwards; clearly a lot of git-unrelated stuff failed, too.  My impression was that the whole doctesting framework got broken somehow.  Don't recall whether doc[re]building was also affected.",
    "created_at": "2014-04-03T16:03:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206661",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:24" align="right">Comment 24</div>

Replying to [@jhpalmieri](#comment%3A23):
> I see these, too, after relocating. If I rebuild just git and run tests again, everything passes.

With 6.1.1: Yes, apparently some hardcoded paths in config files.

What Sage version did you test?  With 6.2.beta?, I'd expect at least the exception in `sage-env` to occur.  (MPL-related;  to get MPL's version, Python is called apparently before anything gets "repaired".)  Not sure whether that (or removing `2>/dev/null` there) caused the rest of the disaster that happened on bsd.math afterwards; clearly a lot of git-unrelated stuff failed, too.  My impression was that the whole doctesting framework got broken somehow.  Don't recall whether doc[re]building was also affected.



---

archive/issue_comments_206662.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">Comment 25</div>\n\nIt was some beta for 6.2, I think 6.2.beta3. I have since deleted it. To be clear:\n\n- I moved it and ran `make ptestlong`. I got the above failures.\n- Then I did `./sage -f git`, did `make ptestlong` again, and everything passed. No other packages were rebuilt when I did `make ptestlong`.\n\nI'll try again, to confirm this.",
    "created_at": "2014-04-03T16:22:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206662",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:25" align="right">Comment 25</div>

It was some beta for 6.2, I think 6.2.beta3. I have since deleted it. To be clear:

- I moved it and ran `make ptestlong`. I got the above failures.
- Then I did `./sage -f git`, did `make ptestlong` again, and everything passed. No other packages were rebuilt when I did `make ptestlong`.

I'll try again, to confirm this.



---

archive/issue_comments_206663.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">Comment 26</div>\n\nReplying to [@jhpalmieri](#comment%3A23):\n> I see these, too, after relocating. If I rebuild just git and run tests again, everything passes.\n\nThis is #15901 (already reported for 6.1.1; the platform doesn't matter).  And also Volker mentioned somewhere he was aware of this, but binary distributions (which *always* \"move\" upon installation) shouldn't ship the dev scripts (nor git) anyway.",
    "created_at": "2014-04-03T18:52:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206663",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:26" align="right">Comment 26</div>

Replying to [@jhpalmieri](#comment%3A23):
> I see these, too, after relocating. If I rebuild just git and run tests again, everything passes.

This is #15901 (already reported for 6.1.1; the platform doesn't matter).  And also Volker mentioned somewhere he was aware of this, but binary distributions (which *always* "move" upon installation) shouldn't ship the dev scripts (nor git) anyway.



---

archive/issue_comments_206664.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">Comment 27</div>\n\nThere are two different meanings to binary\n* Our \"Binary tarball\" is supposed to be a pre-compiled development setup and includes the whole git repo.\n* A real binary wouldn't include dev scripts or any self-modifying stuff...",
    "created_at": "2014-04-03T20:56:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206664",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:27" align="right">Comment 27</div>

There are two different meanings to binary
* Our "Binary tarball" is supposed to be a pre-compiled development setup and includes the whole git repo.
* A real binary wouldn't include dev scripts or any self-modifying stuff...



---

archive/issue_events_211476.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-04-20T23:41:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "label": "https://github.com/sagemath/sage/labels/p1%20%E2%80%93%20blocker",
    "label_color": "ff0000",
    "label_name": "p1 \u2013 blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16044#event-211476"
}
```



---

archive/issue_events_211477.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-04-20T23:41:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16044#event-211477"
}
```



---

archive/issue_comments_206665.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">Comment 28</div>\n\nNormal priority as it does not affect a first-class platform",
    "created_at": "2014-04-20T23:41:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206665",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:28" align="right">Comment 28</div>

Normal priority as it does not affect a first-class platform



---

archive/issue_comments_206666.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">Comment 29</div>\n\nOkay, with 6.2.rc0 the only build failure continues to be rpy2.  So... I would be happy to just have this ticket fix that.  Can anyone give me a quick lead as to some \"easy\" way to fix it just for rpy2?  A couple pieces from [the appropriate sage-release thread](https://groups.google.com/forum/#!msg/sage-release/q1DPhL8WQiM/):\nLeif:\n\n```\n\n> $ ls local/lib/R/lib/ \n> libR.dylib              libRblas.dylib          libRlapack.dylib \n> \n> $ otool -L local/lib/R/lib/libRblas.dylib \n> local/lib/R/lib/libRblas.dylib: \n>          libRblas.dylib (compatibility version 0.0.0, current version 0.0.0) \n            ^^^^^^^^^^^^^^ \n\nYou have to change this to an absolute path ($SAGE_LOCAL/lib/R/lib/...), \nwith 'install_name_tool -id ...'. \n\nPresumably the same for libRlapack.dylib, probably libR.dylib as well. \n```\nand fbissey\n\n```\n\nIndeed from the corresponding gentoo ebuild: \n        if use prefix; then \n                if [[ ${CHOST} == *-darwin* ]] ; then \n                        sed -i \\ \n                                -e 's:-install_name libR.dylib:-install_name \n${libdir}/R/lib/libR.dylib:' \\ \n                                -e 's:-install_name libRlapack.dylib:-install_name \n${libdir}/R/lib/libRlapack.dylib:' \\ \n                                -e 's:-install_name libRblas.dylib:-install_name \n${libdir}/R/lib/libRblas.dylib:' \\ \n                                -e \"/SHLIB_EXT/s/\\.so/.dylib/\" \\ \n                                configure.ac || die \n                        # sort of \"undo\" 2.14.1-rmath-shared.patch \n                        sed -i \\ \n                                -e \"s:-Wl,-soname=libRmath.so:-install_name \n${EROOT%/}/usr/$(get_libdir)/libRmath.dylib:\" \\ \n                                src/nmath/standalone/Makefile.in || die \n                else \n                        append-ldflags -Wl,-rpath=\"${EROOT%/}/usr/$(get_libdir)/R/lib\" \n                fi \n        fi \n```\nThanks for any assistance.",
    "created_at": "2014-05-02T18:18:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206666",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:29" align="right">Comment 29</div>

Okay, with 6.2.rc0 the only build failure continues to be rpy2.  So... I would be happy to just have this ticket fix that.  Can anyone give me a quick lead as to some "easy" way to fix it just for rpy2?  A couple pieces from [the appropriate sage-release thread](https://groups.google.com/forum/#!msg/sage-release/q1DPhL8WQiM/):
Leif:

```

> $ ls local/lib/R/lib/ 
> libR.dylib              libRblas.dylib          libRlapack.dylib 
> 
> $ otool -L local/lib/R/lib/libRblas.dylib 
> local/lib/R/lib/libRblas.dylib: 
>          libRblas.dylib (compatibility version 0.0.0, current version 0.0.0) 
            ^^^^^^^^^^^^^^ 

You have to change this to an absolute path ($SAGE_LOCAL/lib/R/lib/...), 
with 'install_name_tool -id ...'. 

Presumably the same for libRlapack.dylib, probably libR.dylib as well. 
```
and fbissey

```

Indeed from the corresponding gentoo ebuild: 
        if use prefix; then 
                if [[ ${CHOST} == *-darwin* ]] ; then 
                        sed -i \ 
                                -e 's:-install_name libR.dylib:-install_name 
${libdir}/R/lib/libR.dylib:' \ 
                                -e 's:-install_name libRlapack.dylib:-install_name 
${libdir}/R/lib/libRlapack.dylib:' \ 
                                -e 's:-install_name libRblas.dylib:-install_name 
${libdir}/R/lib/libRblas.dylib:' \ 
                                -e "/SHLIB_EXT/s/\.so/.dylib/" \ 
                                configure.ac || die 
                        # sort of "undo" 2.14.1-rmath-shared.patch 
                        sed -i \ 
                                -e "s:-Wl,-soname=libRmath.so:-install_name 
${EROOT%/}/usr/$(get_libdir)/libRmath.dylib:" \ 
                                src/nmath/standalone/Makefile.in || die 
                else 
                        append-ldflags -Wl,-rpath="${EROOT%/}/usr/$(get_libdir)/R/lib" 
                fi 
        fi 
```
Thanks for any assistance.



---

archive/issue_comments_206667.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">Comment 30</div>\n\nReplying to [@kcrisman](#comment%3A29):\n> Okay, with 6.2.rc0 the only build failure continues to be rpy2.  So... I would be happy to just have this ticket fix that.  Can anyone give me a quick lead as to some \"easy\" way to fix it just for rpy2?\n\n\nHmmm, there are at least two (temporary?) solutions, modifying R's `spkg-install`:\n\n* Patch R's `configure[.ac]`.\n\n* Fix R's libraries (on Darwin) with `install_name_tool` afterwards.",
    "created_at": "2014-05-02T19:12:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206667",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:30" align="right">Comment 30</div>

Replying to [@kcrisman](#comment%3A29):
> Okay, with 6.2.rc0 the only build failure continues to be rpy2.  So... I would be happy to just have this ticket fix that.  Can anyone give me a quick lead as to some "easy" way to fix it just for rpy2?


Hmmm, there are at least two (temporary?) solutions, modifying R's `spkg-install`:

* Patch R's `configure[.ac]`.

* Fix R's libraries (on Darwin) with `install_name_tool` afterwards.



---

archive/issue_comments_206668.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">Comment 31</div>\n\nIf / while you're at it:\n\nLine 152 of R's `spkg-install` currently gives a \"command not found\" error:\n\n```sh\n        RINSTALL_MOVED = yes\n```\nThis should be:\n\n```sh\n        RINSTALL_MOVED=yes\n```",
    "created_at": "2014-05-02T20:35:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206668",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:31" align="right">Comment 31</div>

If / while you're at it:

Line 152 of R's `spkg-install` currently gives a "command not found" error:

```sh
        RINSTALL_MOVED = yes
```
This should be:

```sh
        RINSTALL_MOVED=yes
```



---

archive/issue_comments_206669.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">Comment 32</div>\n\nKarl-Dieter, could you paste the relevant part of the rpy2 install log?\n\n---\n\nIf you don't want to mess with R, a work-around could be setting `DYLD_FALLBACK_LIBRARY_PATH` to the relevant folders in **rpy2's** `spkg-install`.",
    "created_at": "2014-05-02T20:53:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206669",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:32" align="right">Comment 32</div>

Karl-Dieter, could you paste the relevant part of the rpy2 install log?

---

If you don't want to mess with R, a work-around could be setting `DYLD_FALLBACK_LIBRARY_PATH` to the relevant folders in **rpy2's** `spkg-install`.



---

archive/issue_events_211478.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16044#event-211478"
}
```



---

archive/issue_events_211479.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16044#event-211479"
}
```



---

archive/issue_comments_206670.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">Comment 34</div>\n\n> Karl-Dieter, could you paste the relevant part of the rpy2 install log? \n\nHere you go.\n\n```\n/usr/bin/ld: warning can't open dynamic library: libRblas.dylib referenced from: /Users/student/Desktop/sage-6.2.rc0/loca$\n/usr/bin/ld: Undefined symbols:\n_dgemm_ referenced from libR expected to be defined in libRblas.dylib\n_dsyrk_ referenced from libR expected to be defined in libRblas.dylib\n_dtrsm_ referenced from libR expected to be defined in libRblas.dylib\n_zgemm_ referenced from libR expected to be defined in libRblas.dylib\n_daxpy_ referenced from libR expected to be defined in libRblas.dylib\n_dswap_ referenced from libR expected to be defined in libRblas.dylib\n_ddot_ referenced from libR expected to be defined in libRblas.dylib\n_dasum_ referenced from libR expected to be defined in libRblas.dylib\n_dscal_ referenced from libR expected to be defined in libRblas.dylib\n_dnrm2_ referenced from libR expected to be defined in libRblas.dylib\n_dcopy_ referenced from libR expected to be defined in libRblas.dylib\n_drot_ referenced from libR expected to be defined in libRblas.dylib\n_drotg_ referenced from libR expected to be defined in libRblas.dylib\ncollect2: error: ld returned 1 exit status\nerror: command 'gcc' failed with exit status 1\n```\nI think the easiest thing would be to special-case this platform and do something akin to what fbissey does on gentoo.",
    "created_at": "2014-05-13T15:46:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206670",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:34" align="right">Comment 34</div>

> Karl-Dieter, could you paste the relevant part of the rpy2 install log? 

Here you go.

```
/usr/bin/ld: warning can't open dynamic library: libRblas.dylib referenced from: /Users/student/Desktop/sage-6.2.rc0/loca$
/usr/bin/ld: Undefined symbols:
_dgemm_ referenced from libR expected to be defined in libRblas.dylib
_dsyrk_ referenced from libR expected to be defined in libRblas.dylib
_dtrsm_ referenced from libR expected to be defined in libRblas.dylib
_zgemm_ referenced from libR expected to be defined in libRblas.dylib
_daxpy_ referenced from libR expected to be defined in libRblas.dylib
_dswap_ referenced from libR expected to be defined in libRblas.dylib
_ddot_ referenced from libR expected to be defined in libRblas.dylib
_dasum_ referenced from libR expected to be defined in libRblas.dylib
_dscal_ referenced from libR expected to be defined in libRblas.dylib
_dnrm2_ referenced from libR expected to be defined in libRblas.dylib
_dcopy_ referenced from libR expected to be defined in libRblas.dylib
_drot_ referenced from libR expected to be defined in libRblas.dylib
_drotg_ referenced from libR expected to be defined in libRblas.dylib
collect2: error: ld returned 1 exit status
error: command 'gcc' failed with exit status 1
```
I think the easiest thing would be to special-case this platform and do something akin to what fbissey does on gentoo.



---

archive/issue_comments_206671.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">Comment 35</div>\n\nOK I have started a branch for pari. Should we split the ticket of should I give a go at R and all the others on the same branch and ticket?",
    "created_at": "2014-05-14T01:18:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206671",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:35" align="right">Comment 35</div>

OK I have started a branch for pari. Should we split the ticket of should I give a go at R and all the others on the same branch and ticket?



---

archive/issue_comments_206672.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">Comment 36</div>\n\nIn this event, I'd prefer a minimally invasive thing here for PPC and just rpy (which means fixing R, of course) so it is easy for me to test.  And indeed this is the only library preventing build (or even doctest failures, this is one of only a few) on the platform in the ticket.\n\nDoesn't mean we shouldn't fix the rest!  This is purely for my convenience in testing.",
    "created_at": "2014-05-14T01:25:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206672",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:36" align="right">Comment 36</div>

In this event, I'd prefer a minimally invasive thing here for PPC and just rpy (which means fixing R, of course) so it is easy for me to test.  And indeed this is the only library preventing build (or even doctest failures, this is one of only a few) on the platform in the ticket.

Doesn't mean we shouldn't fix the rest!  This is purely for my convenience in testing.



---

archive/issue_comments_206673.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">Comment 37</div>\n\nWell the ticket title is a bit broader than R but I will look at doing something for it now. If we decide to split for convenience later is another matter.",
    "created_at": "2014-05-14T01:30:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206673",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:37" align="right">Comment 37</div>

Well the ticket title is a bit broader than R but I will look at doing something for it now. If we decide to split for convenience later is another matter.



---

archive/issue_comments_206674.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">Comment 38</div>\n\nI have a hack. The like of I just vetoed Leif from using in cddlib. The main issue here is that the stuff we need to change is set in configure/configure.ac. In effect we would have to change the sources and re-run autoconf.\n\nBecause we don't want to do that we have to apply some work around. Either passing some variables to make to override the stuff set by autoconf or possibly patching Makefile.in in the various affected sub-folder. In both case we have to be careful each time we change the version of R. It is a royal pain. Do we know anyone upstream in R (and no I don't in spite of being in New Zealand).",
    "created_at": "2014-05-14T03:10:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206674",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:38" align="right">Comment 38</div>

I have a hack. The like of I just vetoed Leif from using in cddlib. The main issue here is that the stuff we need to change is set in configure/configure.ac. In effect we would have to change the sources and re-run autoconf.

Because we don't want to do that we have to apply some work around. Either passing some variables to make to override the stuff set by autoconf or possibly patching Makefile.in in the various affected sub-folder. In both case we have to be careful each time we change the version of R. It is a royal pain. Do we know anyone upstream in R (and no I don't in spite of being in New Zealand).



---

archive/issue_comments_206675.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">Comment 39</div>\n\nAnd it actually only worked for libR.dylib because of the way substitutions are done...\nWill have to patch Makefile.in to avoid triggering autoreconf...",
    "created_at": "2014-05-14T03:19:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206675",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:39" align="right">Comment 39</div>

And it actually only worked for libR.dylib because of the way substitutions are done...
Will have to patch Makefile.in to avoid triggering autoreconf...



---

archive/issue_comments_206676.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">Comment 40</div>\n\nWe already patch configure so I will do that.",
    "created_at": "2014-05-14T03:27:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206676",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:40" align="right">Comment 40</div>

We already patch configure so I will do that.



---

archive/issue_comments_206677.json:
```json
{
    "body": "Attachment: **[configure_installname.patch.gz](https://github.com/sagemath/sage/files/ticket16044/configure_installname.patch.gz)**\n\ncorrect installname in configure",
    "created_at": "2014-05-14T09:28:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206677",
    "user": "https://github.com/kiwifb"
}
```

Attachment: **[configure_installname.patch.gz](https://github.com/sagemath/sage/files/ticket16044/configure_installname.patch.gz)**

correct installname in configure



---

archive/issue_comments_206678.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">Comment 41</div>\n\nTry the patch in attachment. Just drop it in the patches folder of r and do\n\n```\n ./sage -f r-3.0.2.p0\n```\nand your problem should be solved I'll do a proper push to a branch with patch description later.",
    "created_at": "2014-05-14T09:29:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206678",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:41" align="right">Comment 41</div>

Try the patch in attachment. Just drop it in the patches folder of r and do

```
 ./sage -f r-3.0.2.p0
```
and your problem should be solved I'll do a proper push to a branch with patch description later.



---

archive/issue_comments_206679.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">Comment 42</div>\n\nI think I'm pretty confident this will work properly; I'll try it tomorrow (the next time I'll have access to that machine).    I agree that it's a bit of a hack but I doubt upstream will be interested in something proper.  Thank YOU :-)",
    "created_at": "2014-05-14T17:29:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206679",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:42" align="right">Comment 42</div>

I think I'm pretty confident this will work properly; I'll try it tomorrow (the next time I'll have access to that machine).    I agree that it's a bit of a hack but I doubt upstream will be interested in something proper.  Thank YOU :-)



---

archive/issue_comments_206680.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">Comment 43</div>\n\nUnintended consequences?\n\n```\ngcc -std=gnu99 -dynamiclib -Wl,-headerpad_max_install_names  -undefined dynamic_lookup -single_module -multiply_defined suppress -L/Users/student/Desktop/sage-6.2.rc0/local/lib/  -o internet.so Rhttpd.o Rsock.o internet.o nanoftp.o nanohttp.o sock.o sockconn.o -L../../../lib -lR -dylib_file libRblas.dylib:../../../lib/libRblas.dylib  -Wl,-framework -Wl,CoreFoundation\n/usr/bin/ld: warning can't open dynamic library: /Users/student/Desktop/sage-6.2.rc0/local/lib/R/lib/libRblas.dylib referenced from: ../../../lib/libR.dylib (checking for undefined symbols may be affected) (No such file or directory, errno = 2)\n/usr/bin/ld: Undefined symbols:\n_dgemm_ referenced from libR expected to be defined in /Users/student/Desktop/sage-6.2.rc0/local/lib/R/lib/libRblas.dylib\n_dsyrk_ referenced from libR expected to be defined in /Users/student/Desktop/sage-6.2.rc0/local/lib/R/lib/libRblas.dylib\n_dtrsm_ referenced from libR expected to be defined in /Users/student/Desktop/sage-6.2.rc0/local/lib/R/lib/libRblas.dylib\n_zgemm_ referenced from libR expected to be defined in /Users/student/Desktop/sage-6.2.rc0/local/lib/R/lib/libRblas.dylib\n_daxpy_ referenced from libR expected to be defined in /Users/student/Desktop/sage-6.2.rc0/local/lib/R/lib/libRblas.dylib\n_dswap_ referenced from libR expected to be defined in /Users/student/Desktop/sage-6.2.rc0/local/lib/R/lib/libRblas.dylib\n_ddot_ referenced from libR expected to be defined in /Users/student/Desktop/sage-6.2.rc0/local/lib/R/lib/libRblas.dylib\n_dasum_ referenced from libR expected to be defined in /Users/student/Desktop/sage-6.2.rc0/local/lib/R/lib/libRblas.dylib\n_dscal_ referenced from libR expected to be defined in /Users/student/Desktop/sage-6.2.rc0/local/lib/R/lib/libRblas.dylib\n_dnrm2_ referenced from libR expected to be defined in /Users/student/Desktop/sage-6.2.rc0/local/lib/R/lib/libRblas.dylib\n_dcopy_ referenced from libR expected to be defined in /Users/student/Desktop/sage-6.2.rc0/local/lib/R/lib/libRblas.dylib\n_drot_ referenced from libR expected to be defined in /Users/student/Desktop/sage-6.2.rc0/local/lib/R/lib/libRblas.dylib\n_drotg_ referenced from libR expected to be defined in /Users/student/Desktop/sage-6.2.rc0/local/lib/R/lib/libRblas.dylib\ncollect2: error: ld returned 1 exit status\nmake[4]: *** [internet.so] Error 1\nmake[3]: *** [R] Error 2\nmake[2]: *** [make.internet] Error 2\nmake[1]: *** [R] Error 1\nmake: *** [R] Error 1\nError building R.\n\n```\nI'll point out this was building p1, not p0, but I don't see how that would make a difference.",
    "created_at": "2014-05-15T14:46:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206680",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:43" align="right">Comment 43</div>

Unintended consequences?

```
gcc -std=gnu99 -dynamiclib -Wl,-headerpad_max_install_names  -undefined dynamic_lookup -single_module -multiply_defined suppress -L/Users/student/Desktop/sage-6.2.rc0/local/lib/  -o internet.so Rhttpd.o Rsock.o internet.o nanoftp.o nanohttp.o sock.o sockconn.o -L../../../lib -lR -dylib_file libRblas.dylib:../../../lib/libRblas.dylib  -Wl,-framework -Wl,CoreFoundation
/usr/bin/ld: warning can't open dynamic library: /Users/student/Desktop/sage-6.2.rc0/local/lib/R/lib/libRblas.dylib referenced from: ../../../lib/libR.dylib (checking for undefined symbols may be affected) (No such file or directory, errno = 2)
/usr/bin/ld: Undefined symbols:
_dgemm_ referenced from libR expected to be defined in /Users/student/Desktop/sage-6.2.rc0/local/lib/R/lib/libRblas.dylib
_dsyrk_ referenced from libR expected to be defined in /Users/student/Desktop/sage-6.2.rc0/local/lib/R/lib/libRblas.dylib
_dtrsm_ referenced from libR expected to be defined in /Users/student/Desktop/sage-6.2.rc0/local/lib/R/lib/libRblas.dylib
_zgemm_ referenced from libR expected to be defined in /Users/student/Desktop/sage-6.2.rc0/local/lib/R/lib/libRblas.dylib
_daxpy_ referenced from libR expected to be defined in /Users/student/Desktop/sage-6.2.rc0/local/lib/R/lib/libRblas.dylib
_dswap_ referenced from libR expected to be defined in /Users/student/Desktop/sage-6.2.rc0/local/lib/R/lib/libRblas.dylib
_ddot_ referenced from libR expected to be defined in /Users/student/Desktop/sage-6.2.rc0/local/lib/R/lib/libRblas.dylib
_dasum_ referenced from libR expected to be defined in /Users/student/Desktop/sage-6.2.rc0/local/lib/R/lib/libRblas.dylib
_dscal_ referenced from libR expected to be defined in /Users/student/Desktop/sage-6.2.rc0/local/lib/R/lib/libRblas.dylib
_dnrm2_ referenced from libR expected to be defined in /Users/student/Desktop/sage-6.2.rc0/local/lib/R/lib/libRblas.dylib
_dcopy_ referenced from libR expected to be defined in /Users/student/Desktop/sage-6.2.rc0/local/lib/R/lib/libRblas.dylib
_drot_ referenced from libR expected to be defined in /Users/student/Desktop/sage-6.2.rc0/local/lib/R/lib/libRblas.dylib
_drotg_ referenced from libR expected to be defined in /Users/student/Desktop/sage-6.2.rc0/local/lib/R/lib/libRblas.dylib
collect2: error: ld returned 1 exit status
make[4]: *** [internet.so] Error 1
make[3]: *** [R] Error 2
make[2]: *** [make.internet] Error 2
make[1]: *** [R] Error 1
make: *** [R] Error 1
Error building R.

```
I'll point out this was building p1, not p0, but I don't see how that would make a difference.



---

archive/issue_comments_206681.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">Comment 44</div>\n\nI didn't have that problem on maverick but I can see how the problem occurs. We may have to change the install_name from spkg-install after the install proper. I am glad I didn't push anything.",
    "created_at": "2014-05-15T21:56:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206681",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:44" align="right">Comment 44</div>

I didn't have that problem on maverick but I can see how the problem occurs. We may have to change the install_name from spkg-install after the install proper. I am glad I didn't push anything.



---

archive/issue_events_211480.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16044#event-211480"
}
```



---

archive/issue_events_211481.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16044#event-211481"
}
```



---

archive/issue_comments_206682.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">Comment 46</div>\n\nThis continues to be the only thing preventing Sage from building on this platform... passes many tests!  (Mostly those not are timeouts.)  I won't be able to check on this again for a month, but if something pops up in the meantime that'd be swell ;-)",
    "created_at": "2014-09-17T19:18:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206682",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:46" align="right">Comment 46</div>

This continues to be the only thing preventing Sage from building on this platform... passes many tests!  (Mostly those not are timeouts.)  I won't be able to check on this again for a month, but if something pops up in the meantime that'd be swell ;-)



---

archive/issue_comments_206683.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">Comment 47</div>\n\nHey Fran\u00e7ois,\nIs there some easy hack that is a true hack that would at least allow this to build programmatically?  Not something nice, just something that works even if ugly.",
    "created_at": "2014-12-16T02:13:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206683",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:47" align="right">Comment 47</div>

Hey François,
Is there some easy hack that is a true hack that would at least allow this to build programmatically?  Not something nice, just something that works even if ugly.



---

archive/issue_comments_206684.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">Comment 48</div>\n\nNot 100% sure. Especially since I am guessing you want to produce a working sage for OS X 10.4. One thing to try. Instead of building with just \"make\", try:\n\n```\nLDFLAGS=\"-Wl,-rpath=$path_to_sage_local_lib\" make\n```\nif rpath is supported by ld that may work. Otherwise I may need to have the full man page for ld on the machine in question to try to figure out something.",
    "created_at": "2014-12-16T02:30:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206684",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:48" align="right">Comment 48</div>

Not 100% sure. Especially since I am guessing you want to produce a working sage for OS X 10.4. One thing to try. Instead of building with just "make", try:

```
LDFLAGS="-Wl,-rpath=$path_to_sage_local_lib" make
```
if rpath is supported by ld that may work. Otherwise I may need to have the full man page for ld on the machine in question to try to figure out something.



---

archive/issue_comments_206685.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">Comment 49</div>\n\n\n```\n$ man ld | grep rpath\n$\n```\nOn the other hand, it isn't horrible - `rpy2` is virtually not needed at all for Sage, I'm still not sure why we included it.  Sage itself works fine, and so does at least the basic R.\n\n```\n> 2+2 \n[1] 4\n> a <- c(1,2,3)\n> a\n[1] 1 2 3\n```\n\n\nThe best I could do in compiling was\n\n```\n$ LDFLAGS=\"-Wl,$(SAGE_LOCAL)/lib/R/lib/\" make\n```\n\nwhich however ran into this problem again, I guess.\n\n```\ngcc -bundle -undefined dynamic_lookup -L/Users/crisman/Desktop/sage-6.4.1/local/lib -Wl,/lib/R/lib/ build/temp.macosx-10.4-ppc-2.7/./rpy/rinterface/_rinterface.o -L/Users/crisman/Desktop/sage-6.4.1/local/lib -L/Users/crisman/Desktop/sage-6.4.1/local/lib/R//lib -L/Users/crisman/Desktop/sage-6.4.1/local/lib/R/modules -lR -lreadline -licucore -lR -lm -liconv -o build/lib.macosx-10.4-ppc-2.7/rpy2/rinterface/_rinterface.so\n/usr/bin/ld: can't open: /lib/R/lib/ (No such file or directory, errno = 2)\n/usr/bin/ld: warning can't open dynamic library: libRblas.dylib referenced from: /Users/crisman/Desktop/sage-6.4.1/local/lib/R//lib/libR.dylib (checking for undefined symbols may be affected) (No such file or directory, errno = 2)\n/usr/bin/ld: warning multiple definitions of symbol _locale_charset\n/Users/crisman/Desktop/sage-6.4.1/local/lib/R//lib/libR.dylib(single module) definition of _locale_charset\n/usr/lib/libiconv.dylib(localcharset.o) definition of _locale_charset\ncollect2: error: ld returned 1 exit status\n<snip>\n$ otool -L local/lib/R/lib/libR.dylib \nlocal/lib/R/lib/libR.dylib:\n        libR.dylib (compatibility version 3.1.0, current version 3.1.1)\n        libRblas.dylib (compatibility version 0.0.0, current version 0.0.0)\n        /Users/crisman/Desktop/sage-6.4.1/local/lib/libgfortran.3.dylib (compatibility version 4.0.0, current version 4.0.0)\n<snip>\n$ otool -L local/lib/R/lib/libRblas.dylib \nlocal/lib/R/lib/libRblas.dylib:\n        libRblas.dylib (compatibility version 0.0.0, current version 0.0.0)\n        /Users/crisman/Desktop/sage-6.4.1/local/lib/libgfortran.3.dylib (compatibility version 4.0.0, current version 4.0.0)\n        /Users/crisman/Desktop/sage-6.4.1/local/lib/libgomp.1.dylib (compatibility version 2.0.0, current version 2.0.0)\n        /usr/lib/libgcc_s.1.dylib (compatibility version 1.0.0, current version 1.0.0)\n        /Users/crisman/Desktop/sage-6.4.1/local/lib/libgcc_s.1.dylib (compatibility version 1.0.0, current version 1.0.0)\n        /usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 88.1.12)\n```\nthough perhaps the thing that made it die is the `locale_charset` thing.  Who knows.  Yuck.",
    "created_at": "2014-12-16T02:51:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206685",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:49" align="right">Comment 49</div>


```
$ man ld | grep rpath
$
```
On the other hand, it isn't horrible - `rpy2` is virtually not needed at all for Sage, I'm still not sure why we included it.  Sage itself works fine, and so does at least the basic R.

```
> 2+2 
[1] 4
> a <- c(1,2,3)
> a
[1] 1 2 3
```


The best I could do in compiling was

```
$ LDFLAGS="-Wl,$(SAGE_LOCAL)/lib/R/lib/" make
```

which however ran into this problem again, I guess.

```
gcc -bundle -undefined dynamic_lookup -L/Users/crisman/Desktop/sage-6.4.1/local/lib -Wl,/lib/R/lib/ build/temp.macosx-10.4-ppc-2.7/./rpy/rinterface/_rinterface.o -L/Users/crisman/Desktop/sage-6.4.1/local/lib -L/Users/crisman/Desktop/sage-6.4.1/local/lib/R//lib -L/Users/crisman/Desktop/sage-6.4.1/local/lib/R/modules -lR -lreadline -licucore -lR -lm -liconv -o build/lib.macosx-10.4-ppc-2.7/rpy2/rinterface/_rinterface.so
/usr/bin/ld: can't open: /lib/R/lib/ (No such file or directory, errno = 2)
/usr/bin/ld: warning can't open dynamic library: libRblas.dylib referenced from: /Users/crisman/Desktop/sage-6.4.1/local/lib/R//lib/libR.dylib (checking for undefined symbols may be affected) (No such file or directory, errno = 2)
/usr/bin/ld: warning multiple definitions of symbol _locale_charset
/Users/crisman/Desktop/sage-6.4.1/local/lib/R//lib/libR.dylib(single module) definition of _locale_charset
/usr/lib/libiconv.dylib(localcharset.o) definition of _locale_charset
collect2: error: ld returned 1 exit status
<snip>
$ otool -L local/lib/R/lib/libR.dylib 
local/lib/R/lib/libR.dylib:
        libR.dylib (compatibility version 3.1.0, current version 3.1.1)
        libRblas.dylib (compatibility version 0.0.0, current version 0.0.0)
        /Users/crisman/Desktop/sage-6.4.1/local/lib/libgfortran.3.dylib (compatibility version 4.0.0, current version 4.0.0)
<snip>
$ otool -L local/lib/R/lib/libRblas.dylib 
local/lib/R/lib/libRblas.dylib:
        libRblas.dylib (compatibility version 0.0.0, current version 0.0.0)
        /Users/crisman/Desktop/sage-6.4.1/local/lib/libgfortran.3.dylib (compatibility version 4.0.0, current version 4.0.0)
        /Users/crisman/Desktop/sage-6.4.1/local/lib/libgomp.1.dylib (compatibility version 2.0.0, current version 2.0.0)
        /usr/lib/libgcc_s.1.dylib (compatibility version 1.0.0, current version 1.0.0)
        /Users/crisman/Desktop/sage-6.4.1/local/lib/libgcc_s.1.dylib (compatibility version 1.0.0, current version 1.0.0)
        /usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 88.1.12)
```
though perhaps the thing that made it die is the `locale_charset` thing.  Who knows.  Yuck.



---

archive/issue_comments_206686.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">Comment 50</div>\n\nI am not sure that -Wl argument would do anything apart confusing ld. You can always fix the problem after the install. The install_name_tool can be used to do the fix. And for your R case the problem is that SAGE_LOCAL isn't expanded. You shouldn't have used a variable there. I thought it would be problematic and it appears it is.",
    "created_at": "2014-12-16T03:33:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206686",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:50" align="right">Comment 50</div>

I am not sure that -Wl argument would do anything apart confusing ld. You can always fix the problem after the install. The install_name_tool can be used to do the fix. And for your R case the problem is that SAGE_LOCAL isn't expanded. You shouldn't have used a variable there. I thought it would be problematic and it appears it is.



---

archive/issue_comments_206687.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">Comment 51</div>\n\n> OK I have started a branch for pari. Should we split the ticket of should I give a go at R and all the others on the same branch and ticket? \n\nI think that for now, given other incompatibilities (see #17513) it would be best to keep this for R and open a different ticket to do the more mundane ones, in particular your branch for Pari which is probably still a good idea, right?",
    "created_at": "2015-01-05T17:35:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206687",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:51" align="right">Comment 51</div>

> OK I have started a branch for pari. Should we split the ticket of should I give a go at R and all the others on the same branch and ticket? 

I think that for now, given other incompatibilities (see #17513) it would be best to keep this for R and open a different ticket to do the more mundane ones, in particular your branch for Pari which is probably still a good idea, right?



---

archive/issue_comments_206688.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">Comment 52</div>\n\nHum I am not sure that exist anymore locally. Now I remember what happened with pari. We had settings in the pari spkg, inherited from William, that \"destroyed\" the correct build flags. We fixed pari if I remember correctly.",
    "created_at": "2015-01-05T18:58:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206688",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:52" align="right">Comment 52</div>

Hum I am not sure that exist anymore locally. Now I remember what happened with pari. We had settings in the pari spkg, inherited from William, that "destroyed" the correct build flags. We fixed pari if I remember correctly.



---

archive/issue_comments_206689.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">Comment 53</div>\n\n> Hum I am not sure that exist anymore locally. Now I remember what happened with pari. We had settings in the pari spkg, inherited from William, that \"destroyed\" the correct build flags. We fixed pari if I remember correctly.\n\nYou mean [this](https://github.com/sagemath/sage/issues/16017#comment:42) was fixed?",
    "created_at": "2015-01-05T20:38:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206689",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:53" align="right">Comment 53</div>

> Hum I am not sure that exist anymore locally. Now I remember what happened with pari. We had settings in the pari spkg, inherited from William, that "destroyed" the correct build flags. We fixed pari if I remember correctly.

You mean [this](https://github.com/sagemath/sage/issues/16017#comment:42) was fixed?



---

archive/issue_comments_206690.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">Comment 54</div>\n\nBother I thought it was. I'll make an issue to remove this braindamage ASAP.",
    "created_at": "2015-01-05T21:42:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206690",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:54" align="right">Comment 54</div>

Bother I thought it was. I'll make an issue to remove this braindamage ASAP.



---

archive/issue_comments_206691.json:
```json
{
    "body": "Dependencies: **17588**",
    "created_at": "2015-01-05T21:49:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206691",
    "user": "https://github.com/kiwifb"
}
```

Dependencies: **17588**



---

archive/issue_comments_206692.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">Comment 55</div>\n\nIt is now #17588.",
    "created_at": "2015-01-05T21:49:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206692",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:55" align="right">Comment 55</div>

It is now #17588.



---

archive/issue_comments_206693.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">Comment 56</div>\n\nEven using the tool doesn't seem to work.  I'm not sure why; it *did* change the name, anyway...\n\n```\nDasher-03:~/Desktop/sage-6.4.1-gcc-4.7 student$ install_name_tool -id /Users/student/Desktop/sage-6.4.1-gcc-4.7/local/lib/R/lib/libRblas.dylib local/lib/R/lib/libRblas.dylib \nDasher-03:~/Desktop/sage-6.4.1-gcc-4.7 student$ otool -L local/lib/R/lib/libRblas.dylib local/lib/R/lib/libRblas.dylib:\n        /Users/student/Desktop/sage-6.4.1-gcc-4.7/local/lib/R/lib/libRblas.dylib (compatibility version 0.0.0, current version 0.0.0)\n        /Users/student/Desktop/sage-6.4.1-gcc-4.7/local/lib/libgfortran.3.dylib (compatibility version 4.0.0, current version 4.0.0)\n        /Users/student/Desktop/sage-6.4.1-gcc-4.7/local/lib/libgomp.1.dylib (compatibility version 2.0.0, current version 2.0.0)\n        /usr/lib/libgcc_s.1.dylib (compatibility version 1.0.0, current version 1.0.0)\n        /Users/student/Desktop/sage-6.4.1-gcc-4.7/local/lib/libgcc_s.1.dylib (compatibility version 1.0.0, current version 1.0.0)\n        /usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 88.1.12)\n```\nand of course I still get the same error with stuff like\n\n```\n_drot_ referenced from libR expected to be defined in libRblas.dylib\n_drotg_ referenced from libR expected to be defined in libRblas.dylib\ncollect2: error: ld returned 1 exit status\n```",
    "created_at": "2015-01-06T14:04:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206693",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:56" align="right">Comment 56</div>

Even using the tool doesn't seem to work.  I'm not sure why; it *did* change the name, anyway...

```
Dasher-03:~/Desktop/sage-6.4.1-gcc-4.7 student$ install_name_tool -id /Users/student/Desktop/sage-6.4.1-gcc-4.7/local/lib/R/lib/libRblas.dylib local/lib/R/lib/libRblas.dylib 
Dasher-03:~/Desktop/sage-6.4.1-gcc-4.7 student$ otool -L local/lib/R/lib/libRblas.dylib local/lib/R/lib/libRblas.dylib:
        /Users/student/Desktop/sage-6.4.1-gcc-4.7/local/lib/R/lib/libRblas.dylib (compatibility version 0.0.0, current version 0.0.0)
        /Users/student/Desktop/sage-6.4.1-gcc-4.7/local/lib/libgfortran.3.dylib (compatibility version 4.0.0, current version 4.0.0)
        /Users/student/Desktop/sage-6.4.1-gcc-4.7/local/lib/libgomp.1.dylib (compatibility version 2.0.0, current version 2.0.0)
        /usr/lib/libgcc_s.1.dylib (compatibility version 1.0.0, current version 1.0.0)
        /Users/student/Desktop/sage-6.4.1-gcc-4.7/local/lib/libgcc_s.1.dylib (compatibility version 1.0.0, current version 1.0.0)
        /usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 88.1.12)
```
and of course I still get the same error with stuff like

```
_drot_ referenced from libR expected to be defined in libRblas.dylib
_drotg_ referenced from libR expected to be defined in libRblas.dylib
collect2: error: ld returned 1 exit status
```



---

archive/issue_events_211482.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2015-01-06T14:07:53Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "title_is": "Fix install_name for R preventing build of rpy2 on OS X 10.4 PPC",
    "title_was": "Fix install_name for remaining libraries preventing build on OS X 10.4 PPC",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16044#event-211482"
}
```



---

archive/issue_comments_206694.json:
```json
{
    "body": "Changed dependencies from **17588** to none",
    "created_at": "2015-01-06T14:07:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206694",
    "user": "https://github.com/kcrisman"
}
```

Changed dependencies from **17588** to none



---

archive/issue_comments_206695.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n Okay, here we can just do all fixes for any remaining libraries which for [whatever](https://github.com/sagemath/sage/issues/16017#comment:39) [reason](https://github.com/sagemath/sage/issues/16017#comment:42) don't have the right [install_name](https://groups.google.com/d/msg/sage-release/q1DPhL8WQiM/tXZs-byQBRUJ).\n \n-R will be needed for rpy to build; Pari isn't immediately necessary but probably a good idea, assuming the fix doesn't break anything.\n+R will be needed for rpy to build.\n+\n+Pari became #17588 and in any case wasn't *necessary* for building.\n``````\n",
    "created_at": "2015-01-06T14:07:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206695",
    "user": "https://github.com/kcrisman"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
 Okay, here we can just do all fixes for any remaining libraries which for [whatever](https://github.com/sagemath/sage/issues/16017#comment:39) [reason](https://github.com/sagemath/sage/issues/16017#comment:42) don't have the right [install_name](https://groups.google.com/d/msg/sage-release/q1DPhL8WQiM/tXZs-byQBRUJ).
 
-R will be needed for rpy to build; Pari isn't immediately necessary but probably a good idea, assuming the fix doesn't break anything.
+R will be needed for rpy to build.
+
+Pari became #17588 and in any case wasn't *necessary* for building.
``````




---

archive/issue_comments_206696.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">Comment 58</div>\n\noutput of\n\n```\nnm libRblas.dylib | grep drot\n```\n?",
    "created_at": "2015-01-06T18:51:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206696",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:58" align="right">Comment 58</div>

output of

```
nm libRblas.dylib | grep drot
```
?



---

archive/issue_comments_206697.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">Comment 59</div>\n\n\n```\n$ nm local/lib/R/lib/libRblas.dylib | grep drot\n00003934 T _drot_\n00003a38 T _drotg_\n00003be8 T _drotm_\n00003ed0 T _drotmg_\n00013d8c T _zdrot_\n```",
    "created_at": "2015-01-06T19:06:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206697",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:59" align="right">Comment 59</div>


```
$ nm local/lib/R/lib/libRblas.dylib | grep drot
00003934 T _drot_
00003a38 T _drotg_
00003be8 T _drotm_
00003ed0 T _drotmg_
00013d8c T _zdrot_
```



---

archive/issue_comments_206698.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">Comment 60</div>\n\nThe problem is that `install_name_tool` didn't seem to do the right thing.  See above from `otool`\n\n```\n/Users/student/Desktop/sage-6.4.1-gcc-4.7/local/lib/R/lib/libRblas.dylib\n(compatibility version 0.0.0, current version 0.0.0)\n```",
    "created_at": "2015-01-06T19:07:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206698",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:60" align="right">Comment 60</div>

The problem is that `install_name_tool` didn't seem to do the right thing.  See above from `otool`

```
/Users/student/Desktop/sage-6.4.1-gcc-4.7/local/lib/R/lib/libRblas.dylib
(compatibility version 0.0.0, current version 0.0.0)
```



---

archive/issue_comments_206699.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">Comment 61</div>\n\n#19370 apparently is quite relevant.",
    "created_at": "2015-10-16T01:45:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206699",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:61" align="right">Comment 61</div>

#19370 apparently is quite relevant.



---

archive/issue_comments_206700.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">Comment 62</div>\n\nIt is, it makes this a duplicate. Once #19370 is closed we should mark this as a duplicate. In my opinion there are still stuff that is hard to fix in `R` (`install_names` of all the `R` packages are missing) but really that becomes upstream's job at this point.",
    "created_at": "2015-10-16T01:48:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206700",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:62" align="right">Comment 62</div>

It is, it makes this a duplicate. Once #19370 is closed we should mark this as a duplicate. In my opinion there are still stuff that is hard to fix in `R` (`install_names` of all the `R` packages are missing) but really that becomes upstream's job at this point.



---

archive/issue_events_211483.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2015-10-22T19:38:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16044#event-211483"
}
```



---

archive/issue_events_211484.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2015-10-22T19:38:35Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16044#event-211484"
}
```



---

archive/issue_events_211485.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2015-10-22T19:38:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16044#event-211485"
}
```



---

archive/issue_events_211486.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2015-10-22T19:38:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "a6a6a6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16044#event-211486"
}
```



---

archive/issue_comments_206701.json:
```json
{
    "body": "Reviewer: **Fran\u00e7ois Bissey**",
    "created_at": "2015-10-22T19:38:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16044#issuecomment-206701",
    "user": "https://github.com/kcrisman"
}
```

Reviewer: **François Bissey**



---

archive/issue_events_211487.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2015-10-22T19:38:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16044#event-211487"
}
```



---

archive/issue_events_211488.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2015-10-22T19:38:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16044#event-211488"
}
```



---

archive/issue_events_211489.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-10-23T17:30:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16044#event-211489"
}
```



---

archive/issue_events_211490.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-10-23T17:30:57Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/16044",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16044#event-211490"
}
```
