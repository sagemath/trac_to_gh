# Issue 16165: old pari triggers segfault in Expression.roots(rings=CC)

archive/issues_015928.json:
```json
{
    "body": "\n```\nsage: f=(1+x+x^2)^3\nsage: f.roots(ring=CC)\n---------------------------------------------------------------------------\nSignalError                               Traceback (most recent call last)\n<ipython-input-2-e28890a572d2> in <module>()\n----> 1 f.roots(ring=CC)\n\n/home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/expression.so in sage.symbolic.expression.Expression.roots (sage/symbolic/expression.cpp:38111)()\n\n/home/ralf/sage/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_element.so in sage.rings.polynomial.polynomial_element.Polynomial.roots (sage/rings/polynomial/polynomial_element.c:36164)()\n\n/home/ralf/sage/local/lib/python2.7/site-packages/sage/libs/pari/gen.so in sage.libs.pari.gen.gen.polroots (sage/libs/pari/gen.c:42565)()\n\n/home/ralf/sage/local/lib/python2.7/site-packages/sage/ext/c_lib.so in sage.ext.c_lib.sig_raise_exception (sage/ext/c_lib.c:1208)()\n\nSignalError: Segmentation fault\nsage: gp_version()\n((2, 5, 5), 'GP/PARI CALCULATOR Version 2.5.5 (released)')\n```\n\n\nKeywords: pari, roots\n\nBranch/Commit: [5ae104354f3375f1fbc7076252c0d30282a68952](https://github.com/sagemath/sagetrac-mirror/commit/5ae104354f3375f1fbc7076252c0d30282a68952)\n\nReviewer: Peter Bruin\n\nAuthor: Ralf Stephan\n\nDependencies: #15767\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/16165\n\n",
    "closed_at": "2014-08-20T20:21:51Z",
    "created_at": "2014-04-15T07:39:03Z",
    "labels": [
        "component: interfaces",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "old pari triggers segfault in Expression.roots(rings=CC)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16165",
    "user": "https://github.com/rwst"
}
```

```
sage: f=(1+x+x^2)^3
sage: f.roots(ring=CC)
---------------------------------------------------------------------------
SignalError                               Traceback (most recent call last)
<ipython-input-2-e28890a572d2> in <module>()
----> 1 f.roots(ring=CC)

/home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/expression.so in sage.symbolic.expression.Expression.roots (sage/symbolic/expression.cpp:38111)()

/home/ralf/sage/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_element.so in sage.rings.polynomial.polynomial_element.Polynomial.roots (sage/rings/polynomial/polynomial_element.c:36164)()

/home/ralf/sage/local/lib/python2.7/site-packages/sage/libs/pari/gen.so in sage.libs.pari.gen.gen.polroots (sage/libs/pari/gen.c:42565)()

/home/ralf/sage/local/lib/python2.7/site-packages/sage/ext/c_lib.so in sage.ext.c_lib.sig_raise_exception (sage/ext/c_lib.c:1208)()

SignalError: Segmentation fault
sage: gp_version()
((2, 5, 5), 'GP/PARI CALCULATOR Version 2.5.5 (released)')
```


Keywords: pari, roots

Branch/Commit: [5ae104354f3375f1fbc7076252c0d30282a68952](https://github.com/sagemath/sagetrac-mirror/commit/5ae104354f3375f1fbc7076252c0d30282a68952)

Reviewer: Peter Bruin

Author: Ralf Stephan

Dependencies: #15767

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/16165





---

archive/issue_comments_268039.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#15767\"",
    "created_at": "2014-04-17T16:18:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16165#issuecomment-268039",
    "user": "https://github.com/rwst"
}
```

Changing dependencies from "" to "#15767"



---

archive/issue_comments_268040.json:
```json
{
    "body": "<a id='comment:1'></a>\nThis goes away with pari-2.7.0 (#15767), so dependency set.\n\n```\nsage: f=(1+x+x^2)^3\nsage: f.roots(ring=CC)\n[(-0.500000000000000 - 0.866025403784439*I, 3),\n (-0.500000000000000 + 0.866025403784439*I, 3)]\n```",
    "created_at": "2014-04-17T16:18:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16165#issuecomment-268040",
    "user": "https://github.com/rwst"
}
```

<a id='comment:1'></a>
This goes away with pari-2.7.0 (#15767), so dependency set.

```
sage: f=(1+x+x^2)^3
sage: f.roots(ring=CC)
[(-0.500000000000000 - 0.866025403784439*I, 3),
 (-0.500000000000000 + 0.866025403784439*I, 3)]
```



---

archive/issue_events_054202.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/16165",
    "rename": {
        "from": "segfault in Expression.roots(rings=CC)",
        "to": "old pari triggers segfault in Expression.roots(rings=CC)"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16165#event-54202"
}
```



---

archive/issue_comments_268041.json:
```json
{
    "body": "Changing branch from \"\" to \"u/rws/segfault_in_expression_roots_rings_cc_\"",
    "created_at": "2014-04-17T16:46:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16165#issuecomment-268041",
    "user": "https://github.com/rwst"
}
```

Changing branch from "" to "u/rws/segfault_in_expression_roots_rings_cc_"



---

archive/issue_comments_268042.json:
```json
{
    "body": "<a id='comment:3'></a>\nNew commits:\n|                                                                                                                                          |                    |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------|\n|[5ae1043](https://github.com/sagemath/sagetrac-mirror/commit/5ae104354f3375f1fbc7076252c0d30282a68952)|`16165: add doctest`|",
    "created_at": "2014-04-17T16:47:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16165#issuecomment-268042",
    "user": "https://github.com/rwst"
}
```

<a id='comment:3'></a>
New commits:
|                                                                                                                                          |                    |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------|
|[5ae1043](https://github.com/sagemath/sagetrac-mirror/commit/5ae104354f3375f1fbc7076252c0d30282a68952)|`16165: add doctest`|



---

archive/issue_comments_268043.json:
```json
{
    "body": "Changing commit from \"\" to \"5ae104354f3375f1fbc7076252c0d30282a68952\"",
    "created_at": "2014-04-17T16:47:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16165#issuecomment-268043",
    "user": "https://github.com/rwst"
}
```

Changing commit from "" to "5ae104354f3375f1fbc7076252c0d30282a68952"



---

archive/issue_comments_268044.json:
```json
{
    "body": "Changing author from \"\" to \"Ralf Stephan\"",
    "created_at": "2014-04-17T16:47:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16165#issuecomment-268044",
    "user": "https://github.com/rwst"
}
```

Changing author from "" to "Ralf Stephan"



---

archive/issue_comments_268045.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-04-17T16:47:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16165#issuecomment-268045",
    "user": "https://github.com/rwst"
}
```

Changing status from new to needs_review.



---

archive/issue_events_054203.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-04-17T16:47:45Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16165",
    "milestone": "sage-pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16165#event-54203"
}
```



---

archive/issue_comments_268046.json:
```json
{
    "body": "<a id='comment:4'></a>\nThat is interesting; I can reproduce this in Sage, but it doesn't happen when trying it directly in GP:\n\n```\nsage -gp\n...\n(18:33) gp > f=(1+x+x^2)^3\n%1 = x^6 + 3*x^5 + 6*x^4 + 7*x^3 + 6*x^2 + 3*x + 1\n(18:33) gp > polroots(f)\n%2 = [-0.50000000000000000000000000000000000000 - 0.86602540378443864676372317075293618348*I, -0.50000000000000000000000000000000000000 + 0.86602540378443864676372317075293618348*I, -0.50000000000000000000000000000000000000 - 0.86602540378443864676372317075293618348*I, -0.50000000000000000000000000000000000000 + 0.86602540378443864676372317075293618348*I, -0.50000000000000000000000000000000000000 - 0.86602540378443864676372317075293618348*I, -0.50000000000000000000000000000000000000 + 0.86602540378443864676372317075293618348*I]~\n```\nFirst multiplying `f` by `1.0 + 0.0*I` makes no difference.  The Sage -> PARI conversion isn't the problem either:\n\n```\nsage: f=(1+x+x^2)^3\nsage: pari(f).polroots()\n[-0.500000000000000 - 0.866025403784439*I, -0.500000000000000 + 0.866025403784439*I, -0.500000000000000 - 0.866025403784439*I, -0.500000000000000 + 0.866025403784439*I, -0.500000000000000 - 0.866025403784439*I, -0.500000000000000 + 0.866025403784439*I]~\n```",
    "created_at": "2014-04-17T17:37:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16165#issuecomment-268046",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:4'></a>
That is interesting; I can reproduce this in Sage, but it doesn't happen when trying it directly in GP:

```
sage -gp
...
(18:33) gp > f=(1+x+x^2)^3
%1 = x^6 + 3*x^5 + 6*x^4 + 7*x^3 + 6*x^2 + 3*x + 1
(18:33) gp > polroots(f)
%2 = [-0.50000000000000000000000000000000000000 - 0.86602540378443864676372317075293618348*I, -0.50000000000000000000000000000000000000 + 0.86602540378443864676372317075293618348*I, -0.50000000000000000000000000000000000000 - 0.86602540378443864676372317075293618348*I, -0.50000000000000000000000000000000000000 + 0.86602540378443864676372317075293618348*I, -0.50000000000000000000000000000000000000 - 0.86602540378443864676372317075293618348*I, -0.50000000000000000000000000000000000000 + 0.86602540378443864676372317075293618348*I]~
```
First multiplying `f` by `1.0 + 0.0*I` makes no difference.  The Sage -> PARI conversion isn't the problem either:

```
sage: f=(1+x+x^2)^3
sage: pari(f).polroots()
[-0.500000000000000 - 0.866025403784439*I, -0.500000000000000 + 0.866025403784439*I, -0.500000000000000 - 0.866025403784439*I, -0.500000000000000 + 0.866025403784439*I, -0.500000000000000 - 0.866025403784439*I, -0.500000000000000 + 0.866025403784439*I]~
```



---

archive/issue_comments_268047.json:
```json
{
    "body": "<a id='comment:5'></a>\nIt is reproducible in GP if one first changes the precision from 128 bits (38 digits, PARI's default) to 64 bits (19 digits), which is the precision used to handle Sage's 53-bit precision reals:\n\n```\n(20:43) gp > \\p19\n(20:43) gp > polroots(1.0*(1+x+x^2)^3)\n  ***   at top-level: polroots(1.0*(1+x+x^\n  ***                 ^--------------------\n  *** polroots: bug in PARI/GP (Segmentation Fault), please report\n```\nThis is indeed fixed in PARI/GP 2.7.0.",
    "created_at": "2014-04-17T19:47:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16165#issuecomment-268047",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:5'></a>
It is reproducible in GP if one first changes the precision from 128 bits (38 digits, PARI's default) to 64 bits (19 digits), which is the precision used to handle Sage's 53-bit precision reals:

```
(20:43) gp > \p19
(20:43) gp > polroots(1.0*(1+x+x^2)^3)
  ***   at top-level: polroots(1.0*(1+x+x^
  ***                 ^--------------------
  *** polroots: bug in PARI/GP (Segmentation Fault), please report
```
This is indeed fixed in PARI/GP 2.7.0.



---

archive/issue_comments_268048.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Peter Bruin\"",
    "created_at": "2014-08-18T23:14:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16165#issuecomment-268048",
    "user": "https://github.com/pjbruin"
}
```

Changing reviewer from "" to "Peter Bruin"



---

archive/issue_events_054204.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-08-18T23:14:04Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16165",
    "milestone": "sage-pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16165#event-54204"
}
```



---

archive/issue_events_054205.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-08-18T23:14:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16165",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16165#event-54205"
}
```



---

archive/issue_comments_268049.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-08-18T23:14:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16165#issuecomment-268049",
    "user": "https://github.com/pjbruin"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_054206.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-08-20T20:21:51Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16165",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16165#event-54206"
}
```



---

archive/issue_comments_268050.json:
```json
{
    "body": "Changing branch from \"u/rws/segfault_in_expression_roots_rings_cc_\" to \"5ae104354f3375f1fbc7076252c0d30282a68952\"",
    "created_at": "2014-08-20T20:21:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16165#issuecomment-268050",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/rws/segfault_in_expression_roots_rings_cc_" to "5ae104354f3375f1fbc7076252c0d30282a68952"



---

archive/issue_comments_268051.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-08-20T20:21:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16165#issuecomment-268051",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
