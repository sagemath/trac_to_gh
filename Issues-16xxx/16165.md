# Issue 16165: old pari triggers segfault in Expression.roots(rings=CC)

archive/issues_015928.json:
```json
{
    "body": "\n```\nsage: f=(1+x+x^2)^3\nsage: f.roots(ring=CC)\n---------------------------------------------------------------------------\nSignalError                               Traceback (most recent call last)\n<ipython-input-2-e28890a572d2> in <module>()\n----> 1 f.roots(ring=CC)\n\n/home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/expression.so in sage.symbolic.expression.Expression.roots (sage/symbolic/expression.cpp:38111)()\n\n/home/ralf/sage/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_element.so in sage.rings.polynomial.polynomial_element.Polynomial.roots (sage/rings/polynomial/polynomial_element.c:36164)()\n\n/home/ralf/sage/local/lib/python2.7/site-packages/sage/libs/pari/gen.so in sage.libs.pari.gen.gen.polroots (sage/libs/pari/gen.c:42565)()\n\n/home/ralf/sage/local/lib/python2.7/site-packages/sage/ext/c_lib.so in sage.ext.c_lib.sig_raise_exception (sage/ext/c_lib.c:1208)()\n\nSignalError: Segmentation fault\nsage: gp_version()\n((2, 5, 5), 'GP/PARI CALCULATOR Version 2.5.5 (released)')\n```\n\n\n**Keywords:** pari, roots\n\n**Branch/Commit:** [5ae104354f3375f1fbc7076252c0d30282a68952](https://github.com/sagemath/sagetrac-mirror/commit/5ae104354f3375f1fbc7076252c0d30282a68952)\n\n**Reviewer:** Peter Bruin\n\n**Author:** Ralf Stephan\n\n**Dependencies:** #15767\n\nIssue created by migration from https://trac.sagemath.org/ticket/16165\n\n",
    "closed_at": "2014-08-20T20:21:51Z",
    "created_at": "2014-04-15T07:39:03Z",
    "labels": [
        "component: interfaces",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "old pari triggers segfault in Expression.roots(rings=CC)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16165",
    "user": "https://github.com/rwst"
}
```

```
sage: f=(1+x+x^2)^3
sage: f.roots(ring=CC)
---------------------------------------------------------------------------
SignalError                               Traceback (most recent call last)
<ipython-input-2-e28890a572d2> in <module>()
----> 1 f.roots(ring=CC)

/home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/expression.so in sage.symbolic.expression.Expression.roots (sage/symbolic/expression.cpp:38111)()

/home/ralf/sage/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_element.so in sage.rings.polynomial.polynomial_element.Polynomial.roots (sage/rings/polynomial/polynomial_element.c:36164)()

/home/ralf/sage/local/lib/python2.7/site-packages/sage/libs/pari/gen.so in sage.libs.pari.gen.gen.polroots (sage/libs/pari/gen.c:42565)()

/home/ralf/sage/local/lib/python2.7/site-packages/sage/ext/c_lib.so in sage.ext.c_lib.sig_raise_exception (sage/ext/c_lib.c:1208)()

SignalError: Segmentation fault
sage: gp_version()
((2, 5, 5), 'GP/PARI CALCULATOR Version 2.5.5 (released)')
```


**Keywords:** pari, roots

**Branch/Commit:** [5ae104354f3375f1fbc7076252c0d30282a68952](https://github.com/sagemath/sagetrac-mirror/commit/5ae104354f3375f1fbc7076252c0d30282a68952)

**Reviewer:** Peter Bruin

**Author:** Ralf Stephan

**Dependencies:** #15767

Issue created by migration from https://trac.sagemath.org/ticket/16165





---

archive/issue_comments_252429.json:
```json
{
    "body": "**Dependencies:** #15767",
    "created_at": "2014-04-17T16:18:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16165#issuecomment-252429",
    "user": "https://github.com/rwst"
}
```

**Dependencies:** #15767



---

archive/issue_comments_252430.json:
```json
{
    "body": "<a id='comment:1'></a>\nThis goes away with pari-2.7.0 (#15767), so dependency set.\n\n```\nsage: f=(1+x+x^2)^3\nsage: f.roots(ring=CC)\n[(-0.500000000000000 - 0.866025403784439*I, 3),\n (-0.500000000000000 + 0.866025403784439*I, 3)]\n```",
    "created_at": "2014-04-17T16:18:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16165#issuecomment-252430",
    "user": "https://github.com/rwst"
}
```

<a id='comment:1'></a>
This goes away with pari-2.7.0 (#15767), so dependency set.

```
sage: f=(1+x+x^2)^3
sage: f.roots(ring=CC)
[(-0.500000000000000 - 0.866025403784439*I, 3),
 (-0.500000000000000 + 0.866025403784439*I, 3)]
```



---

archive/issue_events_054448.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/16165",
    "rename": {
        "from": "segfault in Expression.roots(rings=CC)",
        "to": "old pari triggers segfault in Expression.roots(rings=CC)"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16165#event-54448"
}
```



---

archive/issue_comments_252431.json:
```json
{
    "body": "**Branch:** [u/rws/segfault_in_expression_roots_rings_cc_](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/segfault_in_expression_roots_rings_cc_)",
    "created_at": "2014-04-17T16:46:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16165#issuecomment-252431",
    "user": "https://github.com/rwst"
}
```

**Branch:** [u/rws/segfault_in_expression_roots_rings_cc_](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/segfault_in_expression_roots_rings_cc_)



---

archive/issue_comments_252432.json:
```json
{
    "body": "<a id='comment:3'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5ae104354f3375f1fbc7076252c0d30282a68952\">5ae1043</a></td><td><code>16165: add doctest</code></td></tr></table>\n",
    "created_at": "2014-04-17T16:47:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16165#issuecomment-252432",
    "user": "https://github.com/rwst"
}
```

<a id='comment:3'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5ae104354f3375f1fbc7076252c0d30282a68952">5ae1043</a></td><td><code>16165: add doctest</code></td></tr></table>




---

archive/issue_comments_252433.json:
```json
{
    "body": "**Commit:** [5ae104354f3375f1fbc7076252c0d30282a68952](https://github.com/sagemath/sagetrac-mirror/commit/5ae104354f3375f1fbc7076252c0d30282a68952)",
    "created_at": "2014-04-17T16:47:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16165#issuecomment-252433",
    "user": "https://github.com/rwst"
}
```

**Commit:** [5ae104354f3375f1fbc7076252c0d30282a68952](https://github.com/sagemath/sagetrac-mirror/commit/5ae104354f3375f1fbc7076252c0d30282a68952)



---

archive/issue_comments_252434.json:
```json
{
    "body": "**Author:** Ralf Stephan",
    "created_at": "2014-04-17T16:47:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16165#issuecomment-252434",
    "user": "https://github.com/rwst"
}
```

**Author:** Ralf Stephan



---

archive/issue_comments_252435.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2014-04-17T16:47:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16165#issuecomment-252435",
    "user": "https://github.com/rwst"
}
```

**Changing status** from new to needs_review.



---

archive/issue_events_054449.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-04-17T16:47:45Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16165",
    "milestone": "sage-pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16165#event-54449"
}
```



---

archive/issue_comments_252436.json:
```json
{
    "body": "<a id='comment:4'></a>\nThat is interesting; I can reproduce this in Sage, but it doesn't happen when trying it directly in GP:\n\n```\nsage -gp\n...\n(18:33) gp > f=(1+x+x^2)^3\n%1 = x^6 + 3*x^5 + 6*x^4 + 7*x^3 + 6*x^2 + 3*x + 1\n(18:33) gp > polroots(f)\n%2 = [-0.50000000000000000000000000000000000000 - 0.86602540378443864676372317075293618348*I, -0.50000000000000000000000000000000000000 + 0.86602540378443864676372317075293618348*I, -0.50000000000000000000000000000000000000 - 0.86602540378443864676372317075293618348*I, -0.50000000000000000000000000000000000000 + 0.86602540378443864676372317075293618348*I, -0.50000000000000000000000000000000000000 - 0.86602540378443864676372317075293618348*I, -0.50000000000000000000000000000000000000 + 0.86602540378443864676372317075293618348*I]~\n```\nFirst multiplying `f` by `1.0 + 0.0*I` makes no difference.  The Sage -> PARI conversion isn't the problem either:\n\n```\nsage: f=(1+x+x^2)^3\nsage: pari(f).polroots()\n[-0.500000000000000 - 0.866025403784439*I, -0.500000000000000 + 0.866025403784439*I, -0.500000000000000 - 0.866025403784439*I, -0.500000000000000 + 0.866025403784439*I, -0.500000000000000 - 0.866025403784439*I, -0.500000000000000 + 0.866025403784439*I]~\n```",
    "created_at": "2014-04-17T17:37:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16165#issuecomment-252436",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:4'></a>
That is interesting; I can reproduce this in Sage, but it doesn't happen when trying it directly in GP:

```
sage -gp
...
(18:33) gp > f=(1+x+x^2)^3
%1 = x^6 + 3*x^5 + 6*x^4 + 7*x^3 + 6*x^2 + 3*x + 1
(18:33) gp > polroots(f)
%2 = [-0.50000000000000000000000000000000000000 - 0.86602540378443864676372317075293618348*I, -0.50000000000000000000000000000000000000 + 0.86602540378443864676372317075293618348*I, -0.50000000000000000000000000000000000000 - 0.86602540378443864676372317075293618348*I, -0.50000000000000000000000000000000000000 + 0.86602540378443864676372317075293618348*I, -0.50000000000000000000000000000000000000 - 0.86602540378443864676372317075293618348*I, -0.50000000000000000000000000000000000000 + 0.86602540378443864676372317075293618348*I]~
```
First multiplying `f` by `1.0 + 0.0*I` makes no difference.  The Sage -> PARI conversion isn't the problem either:

```
sage: f=(1+x+x^2)^3
sage: pari(f).polroots()
[-0.500000000000000 - 0.866025403784439*I, -0.500000000000000 + 0.866025403784439*I, -0.500000000000000 - 0.866025403784439*I, -0.500000000000000 + 0.866025403784439*I, -0.500000000000000 - 0.866025403784439*I, -0.500000000000000 + 0.866025403784439*I]~
```



---

archive/issue_comments_252437.json:
```json
{
    "body": "<a id='comment:5'></a>\nIt is reproducible in GP if one first changes the precision from 128 bits (38 digits, PARI's default) to 64 bits (19 digits), which is the precision used to handle Sage's 53-bit precision reals:\n\n```\n(20:43) gp > \\p19\n(20:43) gp > polroots(1.0*(1+x+x^2)^3)\n  ***   at top-level: polroots(1.0*(1+x+x^\n  ***                 ^--------------------\n  *** polroots: bug in PARI/GP (Segmentation Fault), please report\n```\nThis is indeed fixed in PARI/GP 2.7.0.",
    "created_at": "2014-04-17T19:47:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16165#issuecomment-252437",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:5'></a>
It is reproducible in GP if one first changes the precision from 128 bits (38 digits, PARI's default) to 64 bits (19 digits), which is the precision used to handle Sage's 53-bit precision reals:

```
(20:43) gp > \p19
(20:43) gp > polroots(1.0*(1+x+x^2)^3)
  ***   at top-level: polroots(1.0*(1+x+x^
  ***                 ^--------------------
  *** polroots: bug in PARI/GP (Segmentation Fault), please report
```
This is indeed fixed in PARI/GP 2.7.0.



---

archive/issue_comments_252438.json:
```json
{
    "body": "**Reviewer:** Peter Bruin",
    "created_at": "2014-08-18T23:14:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16165#issuecomment-252438",
    "user": "https://github.com/pjbruin"
}
```

**Reviewer:** Peter Bruin



---

archive/issue_events_054450.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-08-18T23:14:04Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16165",
    "milestone": "sage-pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16165#event-54450"
}
```



---

archive/issue_events_054451.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-08-18T23:14:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16165",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16165#event-54451"
}
```



---

archive/issue_comments_252439.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2014-08-18T23:14:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16165#issuecomment-252439",
    "user": "https://github.com/pjbruin"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_events_054452.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-08-20T20:21:51Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16165",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16165#event-54452"
}
```



---

archive/issue_comments_252440.json:
```json
{
    "body": "**Changing branch** from \"[u/rws/segfault_in_expression_roots_rings_cc_](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/segfault_in_expression_roots_rings_cc_)\" to \"[5ae104354f3375f1fbc7076252c0d30282a68952](https://github.com/sagemath/sagetrac-mirror/commit/5ae104354f3375f1fbc7076252c0d30282a68952)\".",
    "created_at": "2014-08-20T20:21:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16165",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16165#issuecomment-252440",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/rws/segfault_in_expression_roots_rings_cc_](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/segfault_in_expression_roots_rings_cc_)" to "[5ae104354f3375f1fbc7076252c0d30282a68952](https://github.com/sagemath/sagetrac-mirror/commit/5ae104354f3375f1fbc7076252c0d30282a68952)".
