# Issue 16408: Map database

archive/issues_016171.json:
```json
{
    "body": "The current implementation of `combinatorial_map` modifies some methods of objects in order to tag them as being a \"combinatorial map\" (it might be not the case anymore with #16410). In this ticket we propose an implementation of a database (`sage.databases.map_database`) and a decorator (``@`register_method_as_map`) which register the methods but do not modify them. Contrarily to the previous implementation, the version proposed here is centralized. Which is actually consistent with the fact that we want to do some queries.\n\nProblems:\n- the database is built in two times. At startup, (more precisely when the code is executed) the decorator fills a list of constructions. Then, at the first call of `MapDatabase()` the corresponding maps are actually built.\n- some objects have no general enough parents: `AlternatingSignMatrix`, `Core`, `OrderedSetPartition` and the more delicate `Poset`, `Graph` (Vincent: I think that we might fix the three first in some tickets and use a hack for the two last with `Set_PythonType`).\n\nFurther development:\n- add more information into morphisms (especially injectivity/surjectivity, order for endomorphism, ...)\n\nCC:  pdehaye stumpc5 vivianepons @mantepse\n\nBranch: u/vdelecroix/experimental-combinatorial_map_database\n\nStatus: new\n\nDependencies: #16410\n\nCommit: 26142c40aec12804c9d744b5807057a9e57b780d\n\nIssue created by migration from https://trac.sagemath.org/ticket/16408\n\n",
    "created_at": "2014-05-29T08:11:56Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Map database",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16408",
    "user": "https://github.com/videlec"
}
```
The current implementation of `combinatorial_map` modifies some methods of objects in order to tag them as being a "combinatorial map" (it might be not the case anymore with #16410). In this ticket we propose an implementation of a database (`sage.databases.map_database`) and a decorator (``@`register_method_as_map`) which register the methods but do not modify them. Contrarily to the previous implementation, the version proposed here is centralized. Which is actually consistent with the fact that we want to do some queries.

Problems:
- the database is built in two times. At startup, (more precisely when the code is executed) the decorator fills a list of constructions. Then, at the first call of `MapDatabase()` the corresponding maps are actually built.
- some objects have no general enough parents: `AlternatingSignMatrix`, `Core`, `OrderedSetPartition` and the more delicate `Poset`, `Graph` (Vincent: I think that we might fix the three first in some tickets and use a hack for the two last with `Set_PythonType`).

Further development:
- add more information into morphisms (especially injectivity/surjectivity, order for endomorphism, ...)

CC:  pdehaye stumpc5 vivianepons @mantepse

Branch: u/vdelecroix/experimental-combinatorial_map_database

Status: new

Dependencies: #16410

Commit: 26142c40aec12804c9d744b5807057a9e57b780d

Issue created by migration from https://trac.sagemath.org/ticket/16408





---

archive/issue_comments_224947.json:
```json
{
    "body": "<a id='comment:1'></a>This looks great! Thanks Vincent for doing this.",
    "created_at": "2014-05-29T08:43:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16408#issuecomment-224947",
    "user": "https://trac.sagemath.org/admin/accounts/users/pdehaye"
}
```

<a id='comment:1'></a>This looks great! Thanks Vincent for doing this.



---

archive/issue_comments_224948.json:
```json
{
    "body": "<a id='comment:2'></a>I will not work on this anymore before having some **constructive** comments. Or even better, somebody else contribution. If you apply my branch the file `sage/combinat/combinatorial_map.py` becomes almost empty and I might fix it later on.\n\nVincent\n\n---\nNew commits:",
    "created_at": "2014-05-29T20:14:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16408#issuecomment-224948",
    "user": "https://github.com/videlec"
}
```

<a id='comment:2'></a>I will not work on this anymore before having some **constructive** comments. Or even better, somebody else contribution. If you apply my branch the file `sage/combinat/combinatorial_map.py` becomes almost empty and I might fix it later on.

Vincent

---
New commits:



---

archive/issue_comments_224949.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,8 +1,11 @@\n-The current implementation of \\`combinatorial_map\\` modifies some methods of objects in order to tag them as being a \"combinatorial map\". In this ticket we propose an implementation of a database and a decorator which register the methods but do not modify them.\n+The current implementation of \\`combinatorial_map\\` modifies some methods of objects in order to tag them as being a \"combinatorial map\" (it might be not the case anymore with #16410). In this ticket we propose an implementation of a database (\\`sage.databases.map_database\\`) and a decorator (\\`\\`@\\`register_method_as_map\\`) which register the methods but do not modify them. Contrarily to the previous implementation, the version proposed here is centralized. Which is actually consistent with the fact that we want to do some queries.\n \n-Currently we have the following proposals\n-- \\`u/vdelecroix/experimental-combinatorial_map_database\\`\n-- ... [add yours]\n+Problems:\n+- the database is built in two times. At startup, (more precisely when the code is executed) the decorator fills a list of constructions. Then, at the first call of \\`MapDatabase()\\` the corresponding maps are actually built.\n+- some objects have no general enough parents: \\`AlternatingSignMatrix\\`, \\`Core\\`, \\`OrderedSetPartition\\` and the more delicate \\`Poset\\`, \\`Graph\\` (Vincent: I think that we might fix the three first in some tickets and use a hack for the two last with \\`Set_PythonType\\`).\n+\n+Further development:\n+- add more information into morphisms (especially injectivity/surjectivity, order for endomorphism, ...)\n \n Comment: 1\n \n```\n",
    "created_at": "2014-05-29T20:14:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16408",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16408#issuecomment-224949",
    "user": "https://github.com/videlec"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,8 +1,11 @@
-The current implementation of \`combinatorial_map\` modifies some methods of objects in order to tag them as being a "combinatorial map". In this ticket we propose an implementation of a database and a decorator which register the methods but do not modify them.
+The current implementation of \`combinatorial_map\` modifies some methods of objects in order to tag them as being a "combinatorial map" (it might be not the case anymore with #16410). In this ticket we propose an implementation of a database (\`sage.databases.map_database\`) and a decorator (\`\`@\`register_method_as_map\`) which register the methods but do not modify them. Contrarily to the previous implementation, the version proposed here is centralized. Which is actually consistent with the fact that we want to do some queries.
 
-Currently we have the following proposals
-- \`u/vdelecroix/experimental-combinatorial_map_database\`
-- ... [add yours]
+Problems:
+- the database is built in two times. At startup, (more precisely when the code is executed) the decorator fills a list of constructions. Then, at the first call of \`MapDatabase()\` the corresponding maps are actually built.
+- some objects have no general enough parents: \`AlternatingSignMatrix\`, \`Core\`, \`OrderedSetPartition\` and the more delicate \`Poset\`, \`Graph\` (Vincent: I think that we might fix the three first in some tickets and use a hack for the two last with \`Set_PythonType\`).
+
+Further development:
+- add more information into morphisms (especially injectivity/surjectivity, order for endomorphism, ...)
 
 Comment: 1
 
```




---

archive/issue_events_048296.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16408",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16408#event-48296"
}
```
