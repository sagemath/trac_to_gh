# Issue 16803: Reimplement matrix_integer_dense using FLINT

archive/issues_016566.json:
```json
{
    "assignees": [],
    "body": "In this ticket we reimplement all of matrix_integer_dense using FLINT fmpz_mat_t.\n\nThe speed-up is substantial. With the new code:\n\n```\nsage: A = Matrix(ZZ,1000,1000,range(10^6))\nsage: %time B = A*A\nCPU times: user 883 ms, sys: 3.33 ms, total: 887 ms\nWall time: 888 ms\n```\n\nThis takes more than 1 minute in the same computer using Sage 6.3.\n\nCC:  @pjbruin\n\nKeywords: **flint, matrix**\n\nBranch: **[`812a509`](https://github.com/sagemath/sagetrac-mirror/commit/812a5099731dd5e819ebce0b19ee744de439a6ea)**\n\nReviewer: **William Stein, Jeroen Demeyer**\n\nAuthor: **Marc Masdeu**\n\nComponent: **linear algebra**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/16803_\n\n",
    "closed_at": "2014-09-19T15:08:52Z",
    "created_at": "2014-08-12T16:39:14Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20linear%20algebra",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Reimplement matrix_integer_dense using FLINT",
    "type": "issue",
    "updated_at": "2014-10-03T20:00:29Z",
    "url": "https://github.com/sagemath/sage/issues/16803",
    "user": "https://github.com/mmasdeu"
}
```
In this ticket we reimplement all of matrix_integer_dense using FLINT fmpz_mat_t.

The speed-up is substantial. With the new code:

```
sage: A = Matrix(ZZ,1000,1000,range(10^6))
sage: %time B = A*A
CPU times: user 883 ms, sys: 3.33 ms, total: 887 ms
Wall time: 888 ms
```

This takes more than 1 minute in the same computer using Sage 6.3.

CC:  @pjbruin

Keywords: **flint, matrix**

Branch: **[`812a509`](https://github.com/sagemath/sagetrac-mirror/commit/812a5099731dd5e819ebce0b19ee744de439a6ea)**

Reviewer: **William Stein, Jeroen Demeyer**

Author: **Marc Masdeu**

Component: **linear algebra**

_Issue created by migration from https://trac.sagemath.org/ticket/16803_





---

archive/issue_events_237957.json:
```json
{
    "actor": "https://github.com/mmasdeu",
    "created_at": "2014-08-12T16:39:14Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-237957"
}
```



---

archive/issue_events_237958.json:
```json
{
    "actor": "https://github.com/mmasdeu",
    "created_at": "2014-08-12T16:39:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20linear%20algebra",
    "label_color": "0000ff",
    "label_name": "c: linear algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-237958"
}
```



---

archive/issue_events_237959.json:
```json
{
    "actor": "https://github.com/mmasdeu",
    "created_at": "2014-08-12T16:39:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-237959"
}
```



---

archive/issue_events_237960.json:
```json
{
    "actor": "https://github.com/mmasdeu",
    "created_at": "2014-08-12T16:39:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-237960"
}
```



---

archive/issue_comments_220135.json:
```json
{
    "body": "Branch: **[u/mmasdeu/16803-matrix_integer_dense_flint](https://github.com/sagemath/sagetrac-mirror/tree/u/mmasdeu/16803-matrix_integer_dense_flint)**",
    "created_at": "2014-08-12T17:02:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220135",
    "user": "https://github.com/mmasdeu"
}
```

Branch: **[u/mmasdeu/16803-matrix_integer_dense_flint](https://github.com/sagemath/sagetrac-mirror/tree/u/mmasdeu/16803-matrix_integer_dense_flint)**



---

archive/issue_comments_220136.json:
```json
{
    "body": "Commit: **[`a51a2fb`](https://github.com/sagemath/sagetrac-mirror/commit/a51a2fb4f4576685c13f9ec01bd252b04e6dd503)**",
    "created_at": "2014-08-12T17:02:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220136",
    "user": "https://github.com/mmasdeu"
}
```

Commit: **[`a51a2fb`](https://github.com/sagemath/sagetrac-mirror/commit/a51a2fb4f4576685c13f9ec01bd252b04e6dd503)**



---

archive/issue_comments_220137.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nBy the way, after rebasing it does not compile. I will fix it tomorrow hopefully.",
    "created_at": "2014-08-12T18:21:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220137",
    "user": "https://github.com/mmasdeu"
}
```

<div id="comment:2" align="right">comment:2</div>

By the way, after rebasing it does not compile. I will fix it tomorrow hopefully.



---

archive/issue_comments_220138.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nA word of caution about algorithm defaults: FLINT should generally be faster for small input but IML/Linbox etc. probably have much better code for things like nullspace, charpoly... as soon as the matrices start to get large.\n\nReplacing _rational_kernel_iml with _rational_kernel_flint, for example, is strange. Surely both algorithms should be available.",
    "created_at": "2014-08-12T22:06:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220138",
    "user": "https://github.com/fredrik-johansson"
}
```

<div id="comment:3" align="right">comment:3</div>

A word of caution about algorithm defaults: FLINT should generally be faster for small input but IML/Linbox etc. probably have much better code for things like nullspace, charpoly... as soon as the matrices start to get large.

Replacing _rational_kernel_iml with _rational_kernel_flint, for example, is strange. Surely both algorithms should be available.



---

archive/issue_comments_220139.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f1862b3a24167bc09cbab9d04f24a9d08bd30fca\"><code>f1862b3</code></a></td><td><code>Trac 16803: Fixed compilation problems.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d180ee24dc9547212762499ff271b5a119dadfa9\"><code>d180ee2</code></a></td><td><code>Trac 16803: Finished re-adding legacy functionality.</code></td></tr></table>\n",
    "created_at": "2014-08-15T18:11:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220139",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f1862b3a24167bc09cbab9d04f24a9d08bd30fca"><code>f1862b3</code></a></td><td><code>Trac 16803: Fixed compilation problems.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d180ee24dc9547212762499ff271b5a119dadfa9"><code>d180ee2</code></a></td><td><code>Trac 16803: Finished re-adding legacy functionality.</code></td></tr></table>




---

archive/issue_comments_220140.json:
```json
{
    "body": "Changed commit from **[`a51a2fb`](https://github.com/sagemath/sagetrac-mirror/commit/a51a2fb4f4576685c13f9ec01bd252b04e6dd503)** to **[`d180ee2`](https://github.com/sagemath/sagetrac-mirror/commit/d180ee24dc9547212762499ff271b5a119dadfa9)**",
    "created_at": "2014-08-15T18:11:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220140",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a51a2fb`](https://github.com/sagemath/sagetrac-mirror/commit/a51a2fb4f4576685c13f9ec01bd252b04e6dd503)** to **[`d180ee2`](https://github.com/sagemath/sagetrac-mirror/commit/d180ee24dc9547212762499ff271b5a119dadfa9)**



---

archive/issue_comments_220141.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nI rewrote the code to have all the previous functionality available. The code compiles and passes all the doctests in the matrix/ folder. I will have it run all the doctests during the weekend.",
    "created_at": "2014-08-15T18:23:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220141",
    "user": "https://github.com/mmasdeu"
}
```

<div id="comment:5" align="right">comment:5</div>

I rewrote the code to have all the previous functionality available. The code compiles and passes all the doctests in the matrix/ folder. I will have it run all the doctests during the weekend.



---

archive/issue_comments_220142.json:
```json
{
    "body": "Changed commit from **[`d180ee2`](https://github.com/sagemath/sagetrac-mirror/commit/d180ee24dc9547212762499ff271b5a119dadfa9)** to **[`e26c347`](https://github.com/sagemath/sagetrac-mirror/commit/e26c3472968016bc9dcb82cca70803bbd946b886)**",
    "created_at": "2014-08-19T17:11:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220142",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d180ee2`](https://github.com/sagemath/sagetrac-mirror/commit/d180ee24dc9547212762499ff271b5a119dadfa9)** to **[`e26c347`](https://github.com/sagemath/sagetrac-mirror/commit/e26c3472968016bc9dcb82cca70803bbd946b886)**



---

archive/issue_comments_220143.json:
```json
{
    "body": "<div id=\"comment:6\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e26c3472968016bc9dcb82cca70803bbd946b886\"><code>e26c347</code></a></td><td><code>Trac 16803: Modified to pass doctests from outside matrix folder.</code></td></tr></table>\n",
    "created_at": "2014-08-19T17:11:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220143",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:6"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e26c3472968016bc9dcb82cca70803bbd946b886"><code>e26c347</code></a></td><td><code>Trac 16803: Modified to pass doctests from outside matrix folder.</code></td></tr></table>




---

archive/issue_comments_220144.json:
```json
{
    "body": "Changed commit from **[`e26c347`](https://github.com/sagemath/sagetrac-mirror/commit/e26c3472968016bc9dcb82cca70803bbd946b886)** to **[`f2ac03c`](https://github.com/sagemath/sagetrac-mirror/commit/f2ac03c5052e46df91afa80420ed2b08d43d2823)**",
    "created_at": "2014-08-21T14:07:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220144",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e26c347`](https://github.com/sagemath/sagetrac-mirror/commit/e26c3472968016bc9dcb82cca70803bbd946b886)** to **[`f2ac03c`](https://github.com/sagemath/sagetrac-mirror/commit/f2ac03c5052e46df91afa80420ed2b08d43d2823)**



---

archive/issue_comments_220145.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a6e9a3daa1cbf2f70f8b90792317aea87a571a0b\"><code>a6e9a3d</code></a></td><td><code>Moved ntl dependency inside the pyx file.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f2ac03c5052e46df91afa80420ed2b08d43d2823\"><code>f2ac03c</code></a></td><td><code>Trac 16803: Added sig_on/off, changed some defaults after benchmarking.</code></td></tr></table>\n",
    "created_at": "2014-08-21T14:07:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220145",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a6e9a3daa1cbf2f70f8b90792317aea87a571a0b"><code>a6e9a3d</code></a></td><td><code>Moved ntl dependency inside the pyx file.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f2ac03c5052e46df91afa80420ed2b08d43d2823"><code>f2ac03c</code></a></td><td><code>Trac 16803: Added sig_on/off, changed some defaults after benchmarking.</code></td></tr></table>




---

archive/issue_comments_220146.json:
```json
{
    "body": "<div id=\"comment:8\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/888451b5be36727e88cc6154b02b67ee77ddea52\"><code>888451b</code></a></td><td><code>Trac 16803: Fixed a missing sig_off() and doctests.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/166bae537c52aa4eee968275dcd2f2aef9f52a82\"><code>166bae5</code></a></td><td><code>All doctests pass, documentation builds well also.</code></td></tr></table>\n",
    "created_at": "2014-08-22T12:54:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220146",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:8"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/888451b5be36727e88cc6154b02b67ee77ddea52"><code>888451b</code></a></td><td><code>Trac 16803: Fixed a missing sig_off() and doctests.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/166bae537c52aa4eee968275dcd2f2aef9f52a82"><code>166bae5</code></a></td><td><code>All doctests pass, documentation builds well also.</code></td></tr></table>




---

archive/issue_comments_220147.json:
```json
{
    "body": "Changed commit from **[`f2ac03c`](https://github.com/sagemath/sagetrac-mirror/commit/f2ac03c5052e46df91afa80420ed2b08d43d2823)** to **[`166bae5`](https://github.com/sagemath/sagetrac-mirror/commit/166bae537c52aa4eee968275dcd2f2aef9f52a82)**",
    "created_at": "2014-08-22T12:54:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220147",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f2ac03c`](https://github.com/sagemath/sagetrac-mirror/commit/f2ac03c5052e46df91afa80420ed2b08d43d2823)** to **[`166bae5`](https://github.com/sagemath/sagetrac-mirror/commit/166bae537c52aa4eee968275dcd2f2aef9f52a82)**



---

archive/issue_comments_220148.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nHi,\n\nA first remark playing around with timings is that in sage-6.3 somebody or something has definitely *completely massively screwed* up Linbox, or how Linbox is built, or how we use linbox, which was the default representation and library for arithmetic. Consider this:\n\n```\nsage: n=200; set_random_seed(0); a = random_matrix(ZZ,n); b = random_matrix(ZZ,n)\nsage: %time c=a._multiply_linbox(b)\nCPU times: user 326 ms, sys: 3.63 ms, total: 330 ms\nWall time: 347 ms\nsage: %time c=a._multiply_multi_modular(b)\nCPU times: user 51.5 ms, sys: 1.6 ms, total: 53.1 ms\nWall time: 56.1 ms\nsage: n=400; set_random_seed(0); a = random_matrix(ZZ,n); b = random_matrix(ZZ,n)\nsage: %time c=a._multiply_linbox(b)\nCPU times: user 5.28 s, sys: 22.8 ms, total: 5.3 s\nWall time: 5.37 s\nsage: %time c=a._multiply_multi_modular(b)\nCPU times: user 230 ms, sys: 6.08 ms, total: 236 ms\nWall time: 248 ms\n```\n\nLinbox should easily beat the multiply_multi_modular approach -- that's just basically a naive version of the same thing linbox would be doing if it were properly built and linked.  Instead, Linbox is massively slower.   In fact, almost exactly as much slower as I would expect if the wrong BLAS were being linked.    Note that I tested against the new flint backend and now a._multiply_multi_modular(b) is asymptotically similar to flint, though asymptotically (for n=2000 already), they are pretty close to the same in speed (8.55s versus 11.4s).      In any case, somebody should really look into why linbox is so screwed up -- we switched to it initially since it was much better than doing a._multiply_multi_modular(b) and also our own strassen implementation.",
    "created_at": "2014-08-29T07:41:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220148",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:9" align="right">comment:9</div>

Hi,

A first remark playing around with timings is that in sage-6.3 somebody or something has definitely *completely massively screwed* up Linbox, or how Linbox is built, or how we use linbox, which was the default representation and library for arithmetic. Consider this:

```
sage: n=200; set_random_seed(0); a = random_matrix(ZZ,n); b = random_matrix(ZZ,n)
sage: %time c=a._multiply_linbox(b)
CPU times: user 326 ms, sys: 3.63 ms, total: 330 ms
Wall time: 347 ms
sage: %time c=a._multiply_multi_modular(b)
CPU times: user 51.5 ms, sys: 1.6 ms, total: 53.1 ms
Wall time: 56.1 ms
sage: n=400; set_random_seed(0); a = random_matrix(ZZ,n); b = random_matrix(ZZ,n)
sage: %time c=a._multiply_linbox(b)
CPU times: user 5.28 s, sys: 22.8 ms, total: 5.3 s
Wall time: 5.37 s
sage: %time c=a._multiply_multi_modular(b)
CPU times: user 230 ms, sys: 6.08 ms, total: 236 ms
Wall time: 248 ms
```

Linbox should easily beat the multiply_multi_modular approach -- that's just basically a naive version of the same thing linbox would be doing if it were properly built and linked.  Instead, Linbox is massively slower.   In fact, almost exactly as much slower as I would expect if the wrong BLAS were being linked.    Note that I tested against the new flint backend and now a._multiply_multi_modular(b) is asymptotically similar to flint, though asymptotically (for n=2000 already), they are pretty close to the same in speed (8.55s versus 11.4s).      In any case, somebody should really look into why linbox is so screwed up -- we switched to it initially since it was much better than doing a._multiply_multi_modular(b) and also our own strassen implementation.



---

archive/issue_comments_220149.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nOK, I've been skeptically looking at and testing this patch much of today.  I made a few  tiny changes, but frankly I think this is overall AWESOME.   FLINT's linear algebra seems quite good. \n\nThe following three methods are now still gone.  Add them back so I can run some randomized consistency tests more easily...\n\n```\n     a._multiply_classical      a._multiply_linbox         a._multiply_multi_modular\n```\n\nWhen these are added back, and I run tests of correctness by comparing with them, then I'll give this an enthusiastic positive review.",
    "created_at": "2014-08-29T16:15:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220149",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:10" align="right">comment:10</div>

OK, I've been skeptically looking at and testing this patch much of today.  I made a few  tiny changes, but frankly I think this is overall AWESOME.   FLINT's linear algebra seems quite good. 

The following three methods are now still gone.  Add them back so I can run some randomized consistency tests more easily...

```
     a._multiply_classical      a._multiply_linbox         a._multiply_multi_modular
```

When these are added back, and I run tests of correctness by comparing with them, then I'll give this an enthusiastic positive review.



---

archive/issue_events_237961.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2014-08-29T16:15:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-237961"
}
```



---

archive/issue_events_237962.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2014-08-29T16:15:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-237962"
}
```



---

archive/issue_events_237963.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2014-08-29T16:15:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-237963"
}
```



---

archive/issue_comments_220150.json:
```json
{
    "body": "<div id=\"comment:13\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7f4f903da13aa6e32ed5a573606bb8a0c817e1df\"><code>7f4f903</code></a></td><td><code>Merge branch 'develop' into matflint</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5f21e3dbfda7a126d4ba388681c75f7c559a1e24\"><code>5f21e3d</code></a></td><td><code>Minor changes during review. Put back old multiplication functionality.</code></td></tr></table>\n",
    "created_at": "2014-09-01T08:34:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220150",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:13"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7f4f903da13aa6e32ed5a573606bb8a0c817e1df"><code>7f4f903</code></a></td><td><code>Merge branch 'develop' into matflint</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5f21e3dbfda7a126d4ba388681c75f7c559a1e24"><code>5f21e3d</code></a></td><td><code>Minor changes during review. Put back old multiplication functionality.</code></td></tr></table>




---

archive/issue_comments_220151.json:
```json
{
    "body": "Changed commit from **[`166bae5`](https://github.com/sagemath/sagetrac-mirror/commit/166bae537c52aa4eee968275dcd2f2aef9f52a82)** to **[`5f21e3d`](https://github.com/sagemath/sagetrac-mirror/commit/5f21e3dbfda7a126d4ba388681c75f7c559a1e24)**",
    "created_at": "2014-09-01T08:34:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220151",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`166bae5`](https://github.com/sagemath/sagetrac-mirror/commit/166bae537c52aa4eee968275dcd2f2aef9f52a82)** to **[`5f21e3d`](https://github.com/sagemath/sagetrac-mirror/commit/5f21e3dbfda7a126d4ba388681c75f7c559a1e24)**



---

archive/issue_comments_220152.json:
```json
{
    "body": "Changed commit from **[`5f21e3d`](https://github.com/sagemath/sagetrac-mirror/commit/5f21e3dbfda7a126d4ba388681c75f7c559a1e24)** to **[`a13b79c`](https://github.com/sagemath/sagetrac-mirror/commit/a13b79c9decdba47551a70f2ce1822a4e7e082bd)**",
    "created_at": "2014-09-01T10:55:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220152",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`5f21e3d`](https://github.com/sagemath/sagetrac-mirror/commit/5f21e3dbfda7a126d4ba388681c75f7c559a1e24)** to **[`a13b79c`](https://github.com/sagemath/sagetrac-mirror/commit/a13b79c9decdba47551a70f2ce1822a4e7e082bd)**



---

archive/issue_comments_220153.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a13b79c9decdba47551a70f2ce1822a4e7e082bd\"><code>a13b79c</code></a></td><td><code>Fixed errors, all doctests pass now.</code></td></tr></table>\n",
    "created_at": "2014-09-01T10:55:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220153",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a13b79c9decdba47551a70f2ce1822a4e7e082bd"><code>a13b79c</code></a></td><td><code>Fixed errors, all doctests pass now.</code></td></tr></table>




---

archive/issue_events_237964.json:
```json
{
    "actor": "https://github.com/mmasdeu",
    "created_at": "2014-09-01T10:59:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-237964"
}
```



---

archive/issue_events_237965.json:
```json
{
    "actor": "https://github.com/mmasdeu",
    "created_at": "2014-09-01T10:59:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-237965"
}
```



---

archive/issue_comments_220154.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nI have added the three functions back, and run the long tests in sage/matrix/.",
    "created_at": "2014-09-01T10:59:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220154",
    "user": "https://github.com/mmasdeu"
}
```

<div id="comment:15" align="right">comment:15</div>

I have added the three functions back, and run the long tests in sage/matrix/.



---

archive/issue_comments_220155.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nMAJOR PROBLEM!  Now that multiply_multi_modular is back, I wrote code to do some random testing of correctness.  I did not find situations where things are wrong... however, I quickly ran into major trouble because this ticket introduces a huge memory leak.    I just defined two matrices and multiplied them a few hundred times, and had major ram problems.  In particular, in sage-6.3 (without this branch):\n\n```\nsage: get_memory_usage()\n1047.1875\nsage: for i in range(50):\n....:         a=random_matrix(ZZ,300); del a\n....: \nsage: get_memory_usage()\n1047.1875\n```\n\nWith this ticket:\n\n```\nsage: get_memory_usage()\n2132.09765625\nsage: for i in range(50):\n    a=random_matrix(ZZ,300); del a\n....: \nsage: get_memory_usage()\n2231.3203125\n```\n\n**Conclusion: making nontrivial use of the code on this ticket will very quickly use up all RAM on your computer.**\n\nSo... needs work until that is fixed.",
    "created_at": "2014-09-01T11:13:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220155",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:16" align="right">comment:16</div>

MAJOR PROBLEM!  Now that multiply_multi_modular is back, I wrote code to do some random testing of correctness.  I did not find situations where things are wrong... however, I quickly ran into major trouble because this ticket introduces a huge memory leak.    I just defined two matrices and multiplied them a few hundred times, and had major ram problems.  In particular, in sage-6.3 (without this branch):

```
sage: get_memory_usage()
1047.1875
sage: for i in range(50):
....:         a=random_matrix(ZZ,300); del a
....: 
sage: get_memory_usage()
1047.1875
```

With this ticket:

```
sage: get_memory_usage()
2132.09765625
sage: for i in range(50):
    a=random_matrix(ZZ,300); del a
....: 
sage: get_memory_usage()
2231.3203125
```

**Conclusion: making nontrivial use of the code on this ticket will very quickly use up all RAM on your computer.**

So... needs work until that is fixed.



---

archive/issue_comments_220156.json:
```json
{
    "body": "<div id=\"comment:17\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0d37b701fbd845ee36fdaa6dcf62bae71bf4d6af\"><code>0d37b70</code></a></td><td><code>Fixed memory leak.</code></td></tr></table>\n",
    "created_at": "2014-09-01T13:21:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220156",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:17"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0d37b701fbd845ee36fdaa6dcf62bae71bf4d6af"><code>0d37b70</code></a></td><td><code>Fixed memory leak.</code></td></tr></table>




---

archive/issue_comments_220157.json:
```json
{
    "body": "Changed commit from **[`a13b79c`](https://github.com/sagemath/sagetrac-mirror/commit/a13b79c9decdba47551a70f2ce1822a4e7e082bd)** to **[`0d37b70`](https://github.com/sagemath/sagetrac-mirror/commit/0d37b701fbd845ee36fdaa6dcf62bae71bf4d6af)**",
    "created_at": "2014-09-01T13:21:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220157",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a13b79c`](https://github.com/sagemath/sagetrac-mirror/commit/a13b79c9decdba47551a70f2ce1822a4e7e082bd)** to **[`0d37b70`](https://github.com/sagemath/sagetrac-mirror/commit/0d37b701fbd845ee36fdaa6dcf62bae71bf4d6af)**



---

archive/issue_comments_220158.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nI don't think the changeset with name \"Fixed memory leak\" fixes the memory leak, at least not for matrix multiplication.  I'm not sure if you're done yet.  With your fix, if you run the functions `test1`, `test2` or `test3` in the script `2014-08-29-180550-stupid-test.sage` below, then the memory usage (print out second) grows quite rapidly and doesn't go down.  Doing the same thing in sage-6.3 results in almost no leakage of the heap.    In particular, with your patch after running those 3 tests I ended up with over 2GB extra memory used (oer startup), even after doing `import gc; gc.collect()`.  Doing the identical thing with sage-6.3 uses only a few MB's. \n\n```\ndef t0(n):\n    a = random_matrix(ZZ,n)\n    b = random_matrix(ZZ,n)\n    assert a*b == a*b\n\ndef t(n):\n    a = random_matrix(ZZ,n)\n    b = random_matrix(ZZ,n)\n    assert a*b == a._multiply_multi_modular(b)\n\ndef test1():\n    for n in range(1,50):\n        print n, get_memory_usage()\n        set_random_seed(0)\n        for i in range(100):\n            t(n)\n\ndef test2():\n    for n in range(51,150):\n        print n, get_memory_usage()\n        set_random_seed(0)\n        for i in range(10):\n            t(n)\n\n\ndef t2(n):\n    a = random_matrix(ZZ,n,2*n)\n    b = random_matrix(ZZ,2*n,n)\n    at = a.transpose()\n    bt = b.transpose()\n    assert a*b == a._multiply_multi_modular(b)\n    assert bt*at == bt._multiply_multi_modular(at)\n\ndef test3():\n    for n in range(1,50):\n        print n, get_memory_usage()\n        set_random_seed(0)\n        for i in range(50):\n            t2(n)\n```",
    "created_at": "2014-09-01T15:11:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220158",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:18" align="right">comment:18</div>

I don't think the changeset with name "Fixed memory leak" fixes the memory leak, at least not for matrix multiplication.  I'm not sure if you're done yet.  With your fix, if you run the functions `test1`, `test2` or `test3` in the script `2014-08-29-180550-stupid-test.sage` below, then the memory usage (print out second) grows quite rapidly and doesn't go down.  Doing the same thing in sage-6.3 results in almost no leakage of the heap.    In particular, with your patch after running those 3 tests I ended up with over 2GB extra memory used (oer startup), even after doing `import gc; gc.collect()`.  Doing the identical thing with sage-6.3 uses only a few MB's. 

```
def t0(n):
    a = random_matrix(ZZ,n)
    b = random_matrix(ZZ,n)
    assert a*b == a*b

def t(n):
    a = random_matrix(ZZ,n)
    b = random_matrix(ZZ,n)
    assert a*b == a._multiply_multi_modular(b)

def test1():
    for n in range(1,50):
        print n, get_memory_usage()
        set_random_seed(0)
        for i in range(100):
            t(n)

def test2():
    for n in range(51,150):
        print n, get_memory_usage()
        set_random_seed(0)
        for i in range(10):
            t(n)


def t2(n):
    a = random_matrix(ZZ,n,2*n)
    b = random_matrix(ZZ,2*n,n)
    at = a.transpose()
    bt = b.transpose()
    assert a*b == a._multiply_multi_modular(b)
    assert bt*at == bt._multiply_multi_modular(at)

def test3():
    for n in range(1,50):
        print n, get_memory_usage()
        set_random_seed(0)
        for i in range(50):
            t2(n)
```



---

archive/issue_comments_220159.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nJust from a quick glance at the code, it looks like _lift_crt doesn't mpz_clear out tmp.",
    "created_at": "2014-09-02T13:45:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220159",
    "user": "https://github.com/fredrik-johansson"
}
```

<div id="comment:19" align="right">comment:19</div>

Just from a quick glance at the code, it looks like _lift_crt doesn't mpz_clear out tmp.



---

archive/issue_comments_220160.json:
```json
{
    "body": "<div id=\"comment:20\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2f2fa14024b495395bac2549e9274dd0d47e19dd\"><code>2f2fa14</code></a></td><td><code>Merge branch 'develop' into matflint</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f6ac760964f32d4e1105a541333e4df38a22aecd\"><code>f6ac760</code></a></td><td><code>Fixed other memory leaks. Now all doctests pass again as well.</code></td></tr></table>\n",
    "created_at": "2014-09-02T16:33:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220160",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:20"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2f2fa14024b495395bac2549e9274dd0d47e19dd"><code>2f2fa14</code></a></td><td><code>Merge branch 'develop' into matflint</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f6ac760964f32d4e1105a541333e4df38a22aecd"><code>f6ac760</code></a></td><td><code>Fixed other memory leaks. Now all doctests pass again as well.</code></td></tr></table>




---

archive/issue_comments_220161.json:
```json
{
    "body": "Changed commit from **[`0d37b70`](https://github.com/sagemath/sagetrac-mirror/commit/0d37b701fbd845ee36fdaa6dcf62bae71bf4d6af)** to **[`f6ac760`](https://github.com/sagemath/sagetrac-mirror/commit/f6ac760964f32d4e1105a541333e4df38a22aecd)**",
    "created_at": "2014-09-02T16:33:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220161",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0d37b70`](https://github.com/sagemath/sagetrac-mirror/commit/0d37b701fbd845ee36fdaa6dcf62bae71bf4d6af)** to **[`f6ac760`](https://github.com/sagemath/sagetrac-mirror/commit/f6ac760964f32d4e1105a541333e4df38a22aecd)**



---

archive/issue_comments_220162.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nThanks Fredrik, I fixed that (although it was not the only problem, by far).\n\nThe previous commit was not finished yet (sorry for the confusing commit message). I believe that now the memory leaks are gone (at least those that were detected by William's tests). The main problem was that the get_unsafe_mpz function was initializing the value that it modifies in place, and all functions calling it were also mpz_init'ing it as well. All should be good now.",
    "created_at": "2014-09-02T16:37:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220162",
    "user": "https://github.com/mmasdeu"
}
```

<div id="comment:21" align="right">comment:21</div>

Thanks Fredrik, I fixed that (although it was not the only problem, by far).

The previous commit was not finished yet (sorry for the confusing commit message). I believe that now the memory leaks are gone (at least those that were detected by William's tests). The main problem was that the get_unsafe_mpz function was initializing the value that it modifies in place, and all functions calling it were also mpz_init'ing it as well. All should be good now.



---

archive/issue_comments_220163.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@williamstein](#comment%3A9):\n> A first remark playing around with timings is that in sage-6.3 somebody or something has definitely *completely massively screwed* up Linbox, or how Linbox is built, or how we use linbox, which was the default representation and library for arithmetic.\n\nAre you sure this isn't an imaginary slow-down?  Just for fun, I installed some old versions of Sage on boxen and executed the command\n\n```\n$ time ./sage -c '_ = Matrix(ZZ,1000,1000,range(10^6))^5'\n```\n\nI tested Sage versions 2.9(*), 2.11(*), 3.0.6, 3.2.3, 4.1, 4.5, 4.7, 5.0, 5.12, 6.1.1, 6.3 and the above command always took about 12 minutes. Note that boxen is not an idle machine, so it's difficult to get accurate timings, but there is certainly no massive slow-down.\n\n(*) For these versions, ATLAS didn't compile so I used the ATLAS package from Sage 3.0.6.",
    "created_at": "2014-09-03T12:39:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220163",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@williamstein](#comment%3A9):
> A first remark playing around with timings is that in sage-6.3 somebody or something has definitely *completely massively screwed* up Linbox, or how Linbox is built, or how we use linbox, which was the default representation and library for arithmetic.

Are you sure this isn't an imaginary slow-down?  Just for fun, I installed some old versions of Sage on boxen and executed the command

```
$ time ./sage -c '_ = Matrix(ZZ,1000,1000,range(10^6))^5'
```

I tested Sage versions 2.9(*), 2.11(*), 3.0.6, 3.2.3, 4.1, 4.5, 4.7, 5.0, 5.12, 6.1.1, 6.3 and the above command always took about 12 minutes. Note that boxen is not an idle machine, so it's difficult to get accurate timings, but there is certainly no massive slow-down.

(*) For these versions, ATLAS didn't compile so I used the ATLAS package from Sage 3.0.6.



---

archive/issue_comments_220164.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@jdemeyer](#comment%3A22):\n> Replying to [@williamstein](#comment%3A9):\n> > A first remark playing around with timings is that in sage-6.3 somebody or something has definitely *completely massively screwed* up Linbox, or how Linbox is built, or how we use linbox, which was the default representation and library for arithmetic.\n\n> Are you sure this isn't an imaginary slow-down?  Just for fun, I installed some old versions of Sage on boxen and executed the command\n> \n> ```\n> $ time ./sage -c '_ = Matrix(ZZ,1000,1000,range(10^6))^5'\n> ```\n> \n> I tested Sage versions 2.9(*), 2.11(*), 3.0.6, 3.2.3, 4.1, 4.5, 4.7, 5.0, 5.12, 6.1.1, 6.3 and the above command always took about 12 minutes. Note that boxen is not an idle machine, so it's difficult to get accurate timings, but there is certainly no massive slow-down.\n> \n> (*) For these versions, ATLAS didn't compile so I used the ATLAS package from Sage 3.0.6.\n\nThanks for testing.   I wouldn't be at all surprised if the problem was introduced quite a long time ago -- I haven't benchmarked sage linear algebra at all since around the time when Clement was my postdoc (about 2007-2008), and at that time definitely a properly built linbox provided the fastest matrix multiply (and many other things).   It might still today -- I don't know.",
    "created_at": "2014-09-03T14:04:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220164",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@jdemeyer](#comment%3A22):
> Replying to [@williamstein](#comment%3A9):
> > A first remark playing around with timings is that in sage-6.3 somebody or something has definitely *completely massively screwed* up Linbox, or how Linbox is built, or how we use linbox, which was the default representation and library for arithmetic.

> Are you sure this isn't an imaginary slow-down?  Just for fun, I installed some old versions of Sage on boxen and executed the command
> 
> ```
> $ time ./sage -c '_ = Matrix(ZZ,1000,1000,range(10^6))^5'
> ```
> 
> I tested Sage versions 2.9(*), 2.11(*), 3.0.6, 3.2.3, 4.1, 4.5, 4.7, 5.0, 5.12, 6.1.1, 6.3 and the above command always took about 12 minutes. Note that boxen is not an idle machine, so it's difficult to get accurate timings, but there is certainly no massive slow-down.
> 
> (*) For these versions, ATLAS didn't compile so I used the ATLAS package from Sage 3.0.6.

Thanks for testing.   I wouldn't be at all surprised if the problem was introduced quite a long time ago -- I haven't benchmarked sage linear algebra at all since around the time when Clement was my postdoc (about 2007-2008), and at that time definitely a properly built linbox provided the fastest matrix multiply (and many other things).   It might still today -- I don't know.



---

archive/issue_comments_220165.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@mmasdeu](#comment%3A21):\n> Thanks Fredrik, I fixed that (although it was not the only problem, by far).\n> \n> The previous commit was not finished yet (sorry for the confusing commit message). I believe that now the memory leaks are gone (at least those that were detected by William's tests). The main problem was that the get_unsafe_mpz function was initializing the value that it modifies in place, and all functions calling it were also mpz_init'ing it as well. All should be good now.\n\nMarc -- can you update the code in our SD61 project in sagetest-marc so I can test this out.  I tried what was there, and it leaked like a sieve.",
    "created_at": "2014-09-03T14:04:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220165",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@mmasdeu](#comment%3A21):
> Thanks Fredrik, I fixed that (although it was not the only problem, by far).
> 
> The previous commit was not finished yet (sorry for the confusing commit message). I believe that now the memory leaks are gone (at least those that were detected by William's tests). The main problem was that the get_unsafe_mpz function was initializing the value that it modifies in place, and all functions calling it were also mpz_init'ing it as well. All should be good now.

Marc -- can you update the code in our SD61 project in sagetest-marc so I can test this out.  I tried what was there, and it leaked like a sieve.



---

archive/issue_comments_220166.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nIt just finished compiling now. I got tired of bug-fixing in the cloud (some things are better done in private), and worked from my local copy in the last bit.",
    "created_at": "2014-09-03T15:18:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220166",
    "user": "https://github.com/mmasdeu"
}
```

<div id="comment:25" align="right">comment:25</div>

It just finished compiling now. I got tired of bug-fixing in the cloud (some things are better done in private), and worked from my local copy in the last bit.



---

archive/issue_comments_220167.json:
```json
{
    "body": "Reviewer: **William Stein**",
    "created_at": "2014-09-03T22:33:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220167",
    "user": "https://github.com/williamstein"
}
```

Reviewer: **William Stein**



---

archive/issue_events_237966.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2014-09-03T22:33:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-237966"
}
```



---

archive/issue_events_237967.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2014-09-03T22:33:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-237967"
}
```



---

archive/issue_comments_220168.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nOK, I'm now officially thrilled/very happy by this code :-)",
    "created_at": "2014-09-03T22:33:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220168",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:26" align="right">comment:26</div>

OK, I'm now officially thrilled/very happy by this code :-)



---

archive/issue_comments_220169.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nMerge conflict, probably from #16583",
    "created_at": "2014-09-05T11:02:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220169",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:27" align="right">comment:27</div>

Merge conflict, probably from #16583



---

archive/issue_events_237968.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-09-05T11:03:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-237968"
}
```



---

archive/issue_events_237969.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-09-05T11:03:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-237969"
}
```



---

archive/issue_comments_220170.json:
```json
{
    "body": "Changed branch from **[u/mmasdeu/16803-matrix_integer_dense_flint](https://github.com/sagemath/sagetrac-mirror/tree/u/mmasdeu/16803-matrix_integer_dense_flint)** to **[u/jdemeyer/ticket/16803](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/16803)**",
    "created_at": "2014-09-05T11:41:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220170",
    "user": "https://github.com/jdemeyer"
}
```

Changed branch from **[u/mmasdeu/16803-matrix_integer_dense_flint](https://github.com/sagemath/sagetrac-mirror/tree/u/mmasdeu/16803-matrix_integer_dense_flint)** to **[u/jdemeyer/ticket/16803](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/16803)**



---

archive/issue_comments_220171.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nMerged with\n\n```\ngit merge ticket/16583 -X theirs\n```\n\nCompiles fine, not tested again.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3bda21c2d9a39e08546e36af519e7e79b2f5c19d\"><code>3bda21c</code></a></td><td><code>cleanup of fmpz_t and fmpz_poly_t to avoid Cython warnings about referencing before assignment</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dfc8ce1e411eee34ce50f69f37fe37c73cbe1f79\"><code>dfc8ce1</code></a></td><td><code>silence Cython warning about complicated declaration</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8bb6b48617d5e8cdf2a8f50f269332d591dcd8a7\"><code>8bb6b48</code></a></td><td><code>merge</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/14e730e84c2df7b5ccbe4aca490ae8c78d9fa43d\"><code>14e730e</code></a></td><td><code>Merge with 6.4.beta1</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/18a48429757e11afd32818b8940114e83a511824\"><code>18a4842</code></a></td><td><code>trac #16583, oops, correcting wrong merge</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c416fee312ff1d8ab43b3a3c650f44688a17c7b9\"><code>c416fee</code></a></td><td><code>Remove stuff which is not needed</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b3d6aa2c24defa7cd22675f5540659b07a25401c\"><code>b3d6aa2</code></a></td><td><code>Further cleanup</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/20c767c6a446b441b1551a03a10fb09e1e4bb711\"><code>20c767c</code></a></td><td><code>Fix include of fmpq_poly.pxi in Cython doctest</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2e66cee05777a1565f8aa012730df777f798cb0f\"><code>2e66cee</code></a></td><td><code>Merge branch 'ticket/16583' into ticket/16803</code></td></tr></table>\n",
    "created_at": "2014-09-05T11:41:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220171",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:30" align="right">comment:30</div>

Merged with

```
git merge ticket/16583 -X theirs
```

Compiles fine, not tested again.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3bda21c2d9a39e08546e36af519e7e79b2f5c19d"><code>3bda21c</code></a></td><td><code>cleanup of fmpz_t and fmpz_poly_t to avoid Cython warnings about referencing before assignment</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dfc8ce1e411eee34ce50f69f37fe37c73cbe1f79"><code>dfc8ce1</code></a></td><td><code>silence Cython warning about complicated declaration</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8bb6b48617d5e8cdf2a8f50f269332d591dcd8a7"><code>8bb6b48</code></a></td><td><code>merge</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/14e730e84c2df7b5ccbe4aca490ae8c78d9fa43d"><code>14e730e</code></a></td><td><code>Merge with 6.4.beta1</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/18a48429757e11afd32818b8940114e83a511824"><code>18a4842</code></a></td><td><code>trac #16583, oops, correcting wrong merge</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c416fee312ff1d8ab43b3a3c650f44688a17c7b9"><code>c416fee</code></a></td><td><code>Remove stuff which is not needed</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b3d6aa2c24defa7cd22675f5540659b07a25401c"><code>b3d6aa2</code></a></td><td><code>Further cleanup</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/20c767c6a446b441b1551a03a10fb09e1e4bb711"><code>20c767c</code></a></td><td><code>Fix include of fmpq_poly.pxi in Cython doctest</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2e66cee05777a1565f8aa012730df777f798cb0f"><code>2e66cee</code></a></td><td><code>Merge branch 'ticket/16583' into ticket/16803</code></td></tr></table>




---

archive/issue_comments_220172.json:
```json
{
    "body": "Changed commit from **[`f6ac760`](https://github.com/sagemath/sagetrac-mirror/commit/f6ac760964f32d4e1105a541333e4df38a22aecd)** to **[`2e66cee`](https://github.com/sagemath/sagetrac-mirror/commit/2e66cee05777a1565f8aa012730df777f798cb0f)**",
    "created_at": "2014-09-05T11:41:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220172",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[`f6ac760`](https://github.com/sagemath/sagetrac-mirror/commit/f6ac760964f32d4e1105a541333e4df38a22aecd)** to **[`2e66cee`](https://github.com/sagemath/sagetrac-mirror/commit/2e66cee05777a1565f8aa012730df777f798cb0f)**



---

archive/issue_events_237970.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-09-05T11:41:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-237970"
}
```



---

archive/issue_events_237971.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-09-05T11:41:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-237971"
}
```



---

archive/issue_events_237972.json:
```json
{
    "actor": "https://github.com/mmasdeu",
    "created_at": "2014-09-05T15:11:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-237972"
}
```



---

archive/issue_events_237973.json:
```json
{
    "actor": "https://github.com/mmasdeu",
    "created_at": "2014-09-05T15:11:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-237973"
}
```



---

archive/issue_comments_220173.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nI have just realized that (in a bad design choice) I was initializing allocating _rows and _entries for every single matrix created, which is not very efficient. Now it is only done when needed (i.e. when calling _init_linbox()). Changes are minimal, and I ran the tests (long version) in /matrix/ for safety, but I will resubmit for review.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/22e6896aadf0d6f99aeebc29041d6fd247569738\"><code>22e6896</code></a></td><td><code>Trac 16803: Initialize _rows and _entries only when needed (to save memory).</code></td></tr></table>\n",
    "created_at": "2014-09-05T15:11:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220173",
    "user": "https://github.com/mmasdeu"
}
```

<div id="comment:32" align="right">comment:32</div>

I have just realized that (in a bad design choice) I was initializing allocating _rows and _entries for every single matrix created, which is not very efficient. Now it is only done when needed (i.e. when calling _init_linbox()). Changes are minimal, and I ran the tests (long version) in /matrix/ for safety, but I will resubmit for review.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/22e6896aadf0d6f99aeebc29041d6fd247569738"><code>22e6896</code></a></td><td><code>Trac 16803: Initialize _rows and _entries only when needed (to save memory).</code></td></tr></table>




---

archive/issue_comments_220174.json:
```json
{
    "body": "Changed commit from **[`2e66cee`](https://github.com/sagemath/sagetrac-mirror/commit/2e66cee05777a1565f8aa012730df777f798cb0f)** to **[`22e6896`](https://github.com/sagemath/sagetrac-mirror/commit/22e6896aadf0d6f99aeebc29041d6fd247569738)**",
    "created_at": "2014-09-05T15:11:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220174",
    "user": "https://github.com/mmasdeu"
}
```

Changed commit from **[`2e66cee`](https://github.com/sagemath/sagetrac-mirror/commit/2e66cee05777a1565f8aa012730df777f798cb0f)** to **[`22e6896`](https://github.com/sagemath/sagetrac-mirror/commit/22e6896aadf0d6f99aeebc29041d6fd247569738)**



---

archive/issue_comments_220175.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/ticket/16803](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/16803)** to **[u/mmasdeu/ticket/16803](https://github.com/sagemath/sagetrac-mirror/tree/u/mmasdeu/ticket/16803)**",
    "created_at": "2014-09-05T15:11:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220175",
    "user": "https://github.com/mmasdeu"
}
```

Changed branch from **[u/jdemeyer/ticket/16803](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/16803)** to **[u/mmasdeu/ticket/16803](https://github.com/sagemath/sagetrac-mirror/tree/u/mmasdeu/ticket/16803)**



---

archive/issue_comments_220176.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nBe more careful about freeing.  Right now, in all cases, you do\n\n```\nsage_free(self._rows)\nsage_free(self._entries)\n```\n\nYou're depending on self._rows being automatically initialized to NULL (?), and sage_free doing the right thing when passed NULL.   Maybe that works, but I would be more comfortable if it was explicit, e.g., put self._rows=NULL and only free self._rows if not NULL (or check the source code and see whether it already works that way).",
    "created_at": "2014-09-05T16:24:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220176",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:33" align="right">comment:33</div>

Be more careful about freeing.  Right now, in all cases, you do

```
sage_free(self._rows)
sage_free(self._entries)
```

You're depending on self._rows being automatically initialized to NULL (?), and sage_free doing the right thing when passed NULL.   Maybe that works, but I would be more comfortable if it was explicit, e.g., put self._rows=NULL and only free self._rows if not NULL (or check the source code and see whether it already works that way).



---

archive/issue_comments_220177.json:
```json
{
    "body": "Changed commit from **[`22e6896`](https://github.com/sagemath/sagetrac-mirror/commit/22e6896aadf0d6f99aeebc29041d6fd247569738)** to **[`70afcd6`](https://github.com/sagemath/sagetrac-mirror/commit/70afcd6d8a4092515da48e2e33d7024a80c8ec8e)**",
    "created_at": "2014-09-05T16:49:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220177",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`22e6896`](https://github.com/sagemath/sagetrac-mirror/commit/22e6896aadf0d6f99aeebc29041d6fd247569738)** to **[`70afcd6`](https://github.com/sagemath/sagetrac-mirror/commit/70afcd6d8a4092515da48e2e33d7024a80c8ec8e)**



---

archive/issue_comments_220178.json:
```json
{
    "body": "<div id=\"comment:34\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/70afcd6d8a4092515da48e2e33d7024a80c8ec8e\"><code>70afcd6</code></a></td><td><code>Trac 16803: free _rows and _entries only when needed.</code></td></tr></table>\n",
    "created_at": "2014-09-05T16:49:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220178",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:34"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/70afcd6d8a4092515da48e2e33d7024a80c8ec8e"><code>70afcd6</code></a></td><td><code>Trac 16803: free _rows and _entries only when needed.</code></td></tr></table>




---

archive/issue_comments_220179.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nDone.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/70afcd6d8a4092515da48e2e33d7024a80c8ec8e\"><code>70afcd6</code></a></td><td><code>Trac 16803: free _rows and _entries only when needed.</code></td></tr></table>\n",
    "created_at": "2014-09-05T16:49:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220179",
    "user": "https://github.com/mmasdeu"
}
```

<div id="comment:35" align="right">comment:35</div>

Done.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/70afcd6d8a4092515da48e2e33d7024a80c8ec8e"><code>70afcd6</code></a></td><td><code>Trac 16803: free _rows and _entries only when needed.</code></td></tr></table>




---

archive/issue_comments_220180.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nIts safe to call `sage_free` with `NULL`, but an unintialized pointer can have a non-null value. You should explicitly set all pointers to NULL in `__cinit__`.",
    "created_at": "2014-09-05T16:52:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220180",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:36" align="right">comment:36</div>

Its safe to call `sage_free` with `NULL`, but an unintialized pointer can have a non-null value. You should explicitly set all pointers to NULL in `__cinit__`.



---

archive/issue_events_237974.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2014-09-05T16:54:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-237974"
}
```



---

archive/issue_events_237975.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2014-09-05T16:54:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-237975"
}
```



---

archive/issue_comments_220181.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nReplying to [@vbraun](#comment%3A36):\n> Its safe to call `sage_free` with `NULL`, but an unintialized pointer can have a non-null value. You should explicitly set all pointers to NULL in `__cinit__`.\n\nThanks for clarifying this.  The change he made does explicitly set pointers to NULL now, but it also checks for NULL before calling sage_free.  He should probably change that part back.\n\nAnyway, positive review.",
    "created_at": "2014-09-05T16:54:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220181",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:37" align="right">comment:37</div>

Replying to [@vbraun](#comment%3A36):
> Its safe to call `sage_free` with `NULL`, but an unintialized pointer can have a non-null value. You should explicitly set all pointers to NULL in `__cinit__`.

Thanks for clarifying this.  The change he made does explicitly set pointers to NULL now, but it also checks for NULL before calling sage_free.  He should probably change that part back.

Anyway, positive review.



---

archive/issue_comments_220182.json:
```json
{
    "body": "Changed commit from **[`70afcd6`](https://github.com/sagemath/sagetrac-mirror/commit/70afcd6d8a4092515da48e2e33d7024a80c8ec8e)** to **[`5dd0b79`](https://github.com/sagemath/sagetrac-mirror/commit/5dd0b79e71c51367c1602cb70e0d92291e12e931)**",
    "created_at": "2014-09-05T17:26:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220182",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`70afcd6`](https://github.com/sagemath/sagetrac-mirror/commit/70afcd6d8a4092515da48e2e33d7024a80c8ec8e)** to **[`5dd0b79`](https://github.com/sagemath/sagetrac-mirror/commit/5dd0b79e71c51367c1602cb70e0d92291e12e931)**



---

archive/issue_comments_220183.json:
```json
{
    "body": "<div id=\"comment:38\"></div>\n\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5dd0b79e71c51367c1602cb70e0d92291e12e931\"><code>5dd0b79</code></a></td><td><code>Trac 16803: No need to check for uninitialized pointers, so reverting</code></td></tr></table>\n",
    "created_at": "2014-09-05T17:26:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220183",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:38"></div>

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5dd0b79e71c51367c1602cb70e0d92291e12e931"><code>5dd0b79</code></a></td><td><code>Trac 16803: No need to check for uninitialized pointers, so reverting</code></td></tr></table>




---

archive/issue_events_237976.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2014-09-05T17:26:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-237976"
}
```



---

archive/issue_events_237977.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2014-09-05T17:26:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-237977"
}
```



---

archive/issue_comments_220184.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nI cleaned that up.",
    "created_at": "2014-09-05T17:27:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220184",
    "user": "https://github.com/mmasdeu"
}
```

<div id="comment:39" align="right">comment:39</div>

I cleaned that up.



---

archive/issue_events_237978.json:
```json
{
    "actor": "https://github.com/mmasdeu",
    "created_at": "2014-09-05T17:27:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-237978"
}
```



---

archive/issue_events_237979.json:
```json
{
    "actor": "https://github.com/mmasdeu",
    "created_at": "2014-09-05T17:27:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-237979"
}
```



---

archive/issue_comments_220185.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nThe commit is ok but the commit message is wrong ;-)   You initialize it to NULL, thats the whole point.",
    "created_at": "2014-09-05T17:28:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220185",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:40" align="right">comment:40</div>

The commit is ok but the commit message is wrong ;-)   You initialize it to NULL, thats the whole point.



---

archive/issue_comments_220186.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nArgh! By uninitialized I meant unallocated. Sorry...",
    "created_at": "2014-09-05T18:01:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220186",
    "user": "https://github.com/mmasdeu"
}
```

<div id="comment:41" align="right">comment:41</div>

Argh! By uninitialized I meant unallocated. Sorry...



---

archive/issue_events_237980.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-09-06T11:04:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-237980"
}
```



---

archive/issue_events_237981.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-09-06T11:04:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-237981"
}
```



---

archive/issue_comments_220187.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nConflicts with #15946, please fix.",
    "created_at": "2014-09-06T11:04:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220187",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:42" align="right">comment:42</div>

Conflicts with #15946, please fix.



---

archive/issue_comments_220188.json:
```json
{
    "body": "Changed branch from **[u/mmasdeu/ticket/16803](https://github.com/sagemath/sagetrac-mirror/tree/u/mmasdeu/ticket/16803)** to **[u/jdemeyer/ticket/16803](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/16803)**",
    "created_at": "2014-09-07T17:34:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220188",
    "user": "https://github.com/jdemeyer"
}
```

Changed branch from **[u/mmasdeu/ticket/16803](https://github.com/sagemath/sagetrac-mirror/tree/u/mmasdeu/ticket/16803)** to **[u/jdemeyer/ticket/16803](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/16803)**



---

archive/issue_comments_220189.json:
```json
{
    "body": "Changed commit from **[`5dd0b79`](https://github.com/sagemath/sagetrac-mirror/commit/5dd0b79e71c51367c1602cb70e0d92291e12e931)** to **[`6d81923`](https://github.com/sagemath/sagetrac-mirror/commit/6d819238634f4ca885827df0ce217344899d415b)**",
    "created_at": "2014-09-07T18:10:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220189",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[`5dd0b79`](https://github.com/sagemath/sagetrac-mirror/commit/5dd0b79e71c51367c1602cb70e0d92291e12e931)** to **[`6d81923`](https://github.com/sagemath/sagetrac-mirror/commit/6d819238634f4ca885827df0ce217344899d415b)**



---

archive/issue_comments_220190.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nI merged with #15946, but that revealed some genuine bugs with this ticket, hang on...\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6fc03e3ea73f1a472b37661ae9ba9a72b4579dcc\"><code>6fc03e3</code></a></td><td><code>Get rid of mpz_t_offset hacks</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4a5d820ab2f296b0de1718690b2b13af30b719cf\"><code>4a5d820</code></a></td><td><code>Merge branch 'ticket/16910' into HEAD</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d76f8e7be8ad8f8a1a95b96e9413567f4389067e\"><code>d76f8e7</code></a></td><td><code>Fix mpz_t, mpq_t, mpf_t declarations</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a52cff291917bb738f781768be622de146905e0b\"><code>a52cff2</code></a></td><td><code>Use mpz_srcptr for padics pow_computer</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6d819238634f4ca885827df0ce217344899d415b\"><code>6d81923</code></a></td><td><code>Merge branch 'ticket/15946' into ticket/16803</code></td></tr></table>\n",
    "created_at": "2014-09-07T18:10:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220190",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:44" align="right">comment:44</div>

I merged with #15946, but that revealed some genuine bugs with this ticket, hang on...

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6fc03e3ea73f1a472b37661ae9ba9a72b4579dcc"><code>6fc03e3</code></a></td><td><code>Get rid of mpz_t_offset hacks</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4a5d820ab2f296b0de1718690b2b13af30b719cf"><code>4a5d820</code></a></td><td><code>Merge branch 'ticket/16910' into HEAD</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d76f8e7be8ad8f8a1a95b96e9413567f4389067e"><code>d76f8e7</code></a></td><td><code>Fix mpz_t, mpq_t, mpf_t declarations</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a52cff291917bb738f781768be622de146905e0b"><code>a52cff2</code></a></td><td><code>Use mpz_srcptr for padics pow_computer</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6d819238634f4ca885827df0ce217344899d415b"><code>6d81923</code></a></td><td><code>Merge branch 'ticket/15946' into ticket/16803</code></td></tr></table>




---

archive/issue_comments_220191.json:
```json
{
    "body": "Changed commit from **[`6d81923`](https://github.com/sagemath/sagetrac-mirror/commit/6d819238634f4ca885827df0ce217344899d415b)** to **[`0c75c2b`](https://github.com/sagemath/sagetrac-mirror/commit/0c75c2ba9475a2eb02807387375b88140d1137c3)**",
    "created_at": "2014-09-07T18:44:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220191",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6d81923`](https://github.com/sagemath/sagetrac-mirror/commit/6d819238634f4ca885827df0ce217344899d415b)** to **[`0c75c2b`](https://github.com/sagemath/sagetrac-mirror/commit/0c75c2ba9475a2eb02807387375b88140d1137c3)**



---

archive/issue_comments_220192.json:
```json
{
    "body": "<div id=\"comment:45\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0c75c2ba9475a2eb02807387375b88140d1137c3\"><code>0c75c2b</code></a></td><td><code>Remove unused _lift_crt_rr_with_lcm() function</code></td></tr></table>\n",
    "created_at": "2014-09-07T18:44:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220192",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:45"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0c75c2ba9475a2eb02807387375b88140d1137c3"><code>0c75c2b</code></a></td><td><code>Remove unused _lift_crt_rr_with_lcm() function</code></td></tr></table>




---

archive/issue_comments_220193.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nStill needs work because of\n\n```\nsage -t src/sage/combinat/q_analogues.py\n**********************************************************************\nFile \"src/sage/combinat/q_analogues.py\", line 200, in sage.combinat.q_analogues.q_binomial\nFailed example:\n    q_binomial(4,2,matrix([[2,1],[-1,3]]))\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 480, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 843, in compile_and_execute\n        exec compiled in globs\n      File \"<doctest sage.combinat.q_analogues.q_binomial[14]>\", line 1, in <module>\n        q_binomial(Integer(4),Integer(2),matrix([[Integer(2),Integer(1)],[-Integer(1),Integer(3)]]))\n      File \"/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/combinat/q_analogues.py\", line 308, in q_binomial\n        return numerat/denomin\n      File \"element.pyx\", line 2743, in sage.structure.element.Matrix.__div__ (build/cythonized/sage/structure/element.c:20137)\n      File \"matrix_integer_dense.pyx\", line 923, in sage.matrix.matrix_integer_dense.Matrix_integer_dense._matrix_times_matrix_ (build/cythonized/sage/matrix/matrix_integer_dense.c:11570)\n      File \"c_lib.pyx\", line 97, in sage.ext.c_lib.sig_raise_exception (build/cythonized/sage/ext/c_lib.c:1208)\n    SignalError: Segmentation fault\n**********************************************************************\n```\n\nGiven that this test also fails (not with a segfault though) in the patchbot, I guess the merging isn't to blame.\n\nPlease fix this...",
    "created_at": "2014-09-07T19:09:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220193",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:46" align="right">comment:46</div>

Still needs work because of

```
sage -t src/sage/combinat/q_analogues.py
**********************************************************************
File "src/sage/combinat/q_analogues.py", line 200, in sage.combinat.q_analogues.q_binomial
Failed example:
    q_binomial(4,2,matrix([[2,1],[-1,3]]))
Exception raised:
    Traceback (most recent call last):
      File "/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 480, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 843, in compile_and_execute
        exec compiled in globs
      File "<doctest sage.combinat.q_analogues.q_binomial[14]>", line 1, in <module>
        q_binomial(Integer(4),Integer(2),matrix([[Integer(2),Integer(1)],[-Integer(1),Integer(3)]]))
      File "/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/combinat/q_analogues.py", line 308, in q_binomial
        return numerat/denomin
      File "element.pyx", line 2743, in sage.structure.element.Matrix.__div__ (build/cythonized/sage/structure/element.c:20137)
      File "matrix_integer_dense.pyx", line 923, in sage.matrix.matrix_integer_dense.Matrix_integer_dense._matrix_times_matrix_ (build/cythonized/sage/matrix/matrix_integer_dense.c:11570)
      File "c_lib.pyx", line 97, in sage.ext.c_lib.sig_raise_exception (build/cythonized/sage/ext/c_lib.c:1208)
    SignalError: Segmentation fault
**********************************************************************
```

Given that this test also fails (not with a segfault though) in the patchbot, I guess the merging isn't to blame.

Please fix this...



---

archive/issue_comments_220194.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/ticket/16803](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/16803)** to **[u/mmasdeu/16803-2](https://github.com/sagemath/sagetrac-mirror/tree/u/mmasdeu/16803-2)**",
    "created_at": "2014-09-08T12:05:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220194",
    "user": "https://github.com/mmasdeu"
}
```

Changed branch from **[u/jdemeyer/ticket/16803](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/16803)** to **[u/mmasdeu/16803-2](https://github.com/sagemath/sagetrac-mirror/tree/u/mmasdeu/16803-2)**



---

archive/issue_events_237982.json:
```json
{
    "actor": "https://github.com/mmasdeu",
    "created_at": "2014-09-08T12:05:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-237982"
}
```



---

archive/issue_events_237983.json:
```json
{
    "actor": "https://github.com/mmasdeu",
    "created_at": "2014-09-08T12:05:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-237983"
}
```



---

archive/issue_comments_220195.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nI have fixed this by changing the code of sage.structure.element.Matrix.__div__, which was assuming that the _matrix_times_matrix method of matrix.matrix_integer_dense would know how to deal with matrices over the rationals. This is a low-level private function which doesn't do type checking, which I think is the right thing to do.\n\nWhat the current patch does is, when writing something like A/B for matrices A and B, to take the denominator out of ~B, multiply and then put it back. I have run make ptest and all passed **except** for some that have nothing to do with matrices, for example this one:\n\n```\nsage -t src/sage/rings/integer.pyx\n**********************************************************************\nFile \"src/sage/rings/integer.pyx\", line 1954, in sage.rings.integer.Integer.__pow__\nFailed example:\n    2^(2^63-2)\nExpected:\n    Traceback (most recent call last):\n    ...\n    MemoryError: failed to allocate 1152921504606847008 bytes\nGot:\n    Fatal Python error: Insufficient memory\n    Traceback (most recent call last):\n      File \"/usr/local/sage/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 480, in _run\n        self.execute(example, compiled, test.globs)\n      File \"/usr/local/sage/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 839, in execute\n        exec compiled in globs\n      File \"<doctest sage.rings.integer.Integer.__pow__[27]>\", line 1, in <module>\n        Integer(2)**(Integer(2)**Integer(63)-Integer(2))\n      File \"integer.pyx\", line 1999, in sage.rings.integer.Integer.__pow__ (build/cythonized/sage/rings/integer.c:14710)\n      File \"c_lib.pyx\", line 85, in sage.ext.c_lib.sig_raise_exception (build/cythonized/sage/ext/c_lib.c:1040)\n    RuntimeError: Aborted\n**********************************************************************\n```",
    "created_at": "2014-09-08T12:05:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220195",
    "user": "https://github.com/mmasdeu"
}
```

<div id="comment:47" align="right">comment:47</div>

I have fixed this by changing the code of sage.structure.element.Matrix.__div__, which was assuming that the _matrix_times_matrix method of matrix.matrix_integer_dense would know how to deal with matrices over the rationals. This is a low-level private function which doesn't do type checking, which I think is the right thing to do.

What the current patch does is, when writing something like A/B for matrices A and B, to take the denominator out of ~B, multiply and then put it back. I have run make ptest and all passed **except** for some that have nothing to do with matrices, for example this one:

```
sage -t src/sage/rings/integer.pyx
**********************************************************************
File "src/sage/rings/integer.pyx", line 1954, in sage.rings.integer.Integer.__pow__
Failed example:
    2^(2^63-2)
Expected:
    Traceback (most recent call last):
    ...
    MemoryError: failed to allocate 1152921504606847008 bytes
Got:
    Fatal Python error: Insufficient memory
    Traceback (most recent call last):
      File "/usr/local/sage/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 480, in _run
        self.execute(example, compiled, test.globs)
      File "/usr/local/sage/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 839, in execute
        exec compiled in globs
      File "<doctest sage.rings.integer.Integer.__pow__[27]>", line 1, in <module>
        Integer(2)**(Integer(2)**Integer(63)-Integer(2))
      File "integer.pyx", line 1999, in sage.rings.integer.Integer.__pow__ (build/cythonized/sage/rings/integer.c:14710)
      File "c_lib.pyx", line 85, in sage.ext.c_lib.sig_raise_exception (build/cythonized/sage/ext/c_lib.c:1040)
    RuntimeError: Aborted
**********************************************************************
```



---

archive/issue_comments_220196.json:
```json
{
    "body": "Changed commit from **[`0c75c2b`](https://github.com/sagemath/sagetrac-mirror/commit/0c75c2ba9475a2eb02807387375b88140d1137c3)** to **[`fcb36b1`](https://github.com/sagemath/sagetrac-mirror/commit/fcb36b1e57fc645c0372617711b2a9ec0423b77f)**",
    "created_at": "2014-09-08T12:05:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220196",
    "user": "https://github.com/mmasdeu"
}
```

Changed commit from **[`0c75c2b`](https://github.com/sagemath/sagetrac-mirror/commit/0c75c2ba9475a2eb02807387375b88140d1137c3)** to **[`fcb36b1`](https://github.com/sagemath/sagetrac-mirror/commit/fcb36b1e57fc645c0372617711b2a9ec0423b77f)**



---

archive/issue_events_237984.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-09-09T07:51:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-237984"
}
```



---

archive/issue_events_237985.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-09-09T07:51:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-237985"
}
```



---

archive/issue_comments_220197.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nThe patchbot reports a segmentation fault in `matrix_integer_dense.pyx`, which is likely due to this ticket.",
    "created_at": "2014-09-09T07:51:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220197",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:48" align="right">comment:48</div>

The patchbot reports a segmentation fault in `matrix_integer_dense.pyx`, which is likely due to this ticket.



---

archive/issue_comments_220198.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nI cannot reproduce it. And I don't know where the error comes from, other than the coercion model not checking for types before calling the low-level functions...\n\n```\n~/sagetest-marc$ ./sage -t --long src/sage/modular/modform/ambient_R.py\nRunning doctests with ID 2014-09-09-08-48-58-b66cd1ea.\nDoctesting 1 file.\nsage -t --long --warn-long 26.1 src/sage/modular/modform/ambient_R.py\n    [26 tests, 29.09 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 29.2 seconds\n    cpu time: 27.7 seconds\n    cumulative wall time: 29.1 seconds\n```",
    "created_at": "2014-09-09T08:51:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220198",
    "user": "https://github.com/mmasdeu"
}
```

<div id="comment:49" align="right">comment:49</div>

I cannot reproduce it. And I don't know where the error comes from, other than the coercion model not checking for types before calling the low-level functions...

```
~/sagetest-marc$ ./sage -t --long src/sage/modular/modform/ambient_R.py
Running doctests with ID 2014-09-09-08-48-58-b66cd1ea.
Doctesting 1 file.
sage -t --long --warn-long 26.1 src/sage/modular/modform/ambient_R.py
    [26 tests, 29.09 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 29.2 seconds
    cpu time: 27.7 seconds
    cumulative wall time: 29.1 seconds
```



---

archive/issue_comments_220199.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nYour last fix is almost certainly going to break over other rings. In any case, this change requires extra doctests over other rings.\n\nI would advise the following: the matrix division coercion model bug is independent of this ticket. I recommend you to create a new ticket for that and make this ticket depend on that.",
    "created_at": "2014-09-09T14:04:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220199",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:50" align="right">comment:50</div>

Your last fix is almost certainly going to break over other rings. In any case, this change requires extra doctests over other rings.

I would advise the following: the matrix division coercion model bug is independent of this ticket. I recommend you to create a new ticket for that and make this ticket depend on that.



---

archive/issue_comments_220200.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nI propose the following, which I think is a good solution (especially since the plan is to move matrices over rationals also to FLINT).\n\n```\ndef __div__(left,right):\n    return left * (~right)\n```\n\nI have tried this and it passes the tests. I will push the code in a minute.",
    "created_at": "2014-09-09T17:36:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220200",
    "user": "https://github.com/mmasdeu"
}
```

<div id="comment:51" align="right">comment:51</div>

I propose the following, which I think is a good solution (especially since the plan is to move matrices over rationals also to FLINT).

```
def __div__(left,right):
    return left * (~right)
```

I have tried this and it passes the tests. I will push the code in a minute.



---

archive/issue_events_237986.json:
```json
{
    "actor": "https://github.com/mmasdeu",
    "created_at": "2014-09-09T17:36:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-237986"
}
```



---

archive/issue_events_237987.json:
```json
{
    "actor": "https://github.com/mmasdeu",
    "created_at": "2014-09-09T17:36:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-237987"
}
```



---

archive/issue_comments_220201.json:
```json
{
    "body": "Changed commit from **[`fcb36b1`](https://github.com/sagemath/sagetrac-mirror/commit/fcb36b1e57fc645c0372617711b2a9ec0423b77f)** to **[`4cf706d`](https://github.com/sagemath/sagetrac-mirror/commit/4cf706d0974ffc39af15e4b24b6e77b8bc984d53)**",
    "created_at": "2014-09-09T17:45:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220201",
    "user": "https://github.com/mmasdeu"
}
```

Changed commit from **[`fcb36b1`](https://github.com/sagemath/sagetrac-mirror/commit/fcb36b1e57fc645c0372617711b2a9ec0423b77f)** to **[`4cf706d`](https://github.com/sagemath/sagetrac-mirror/commit/4cf706d0974ffc39af15e4b24b6e77b8bc984d53)**



---

archive/issue_comments_220202.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nLast 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7069aec939ce8f870f4fb66e9752cc14185fddb4\"><code>7069aec</code></a></td><td><code>Further cleanup</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f1756fb17bde5ed36c363025d9548779dfafcaaf\"><code>f1756fb</code></a></td><td><code>Fix include of fmpq_poly.pxi in Cython doctest</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/78d9bfc034dfe2af6758fb14dc3a5218bcba171e\"><code>78d9bfc</code></a></td><td><code>Trac 16803: Initialize _rows and _entries only when needed (to save memory).</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/42243b22fa71a40bfe28ca1e8d61353a096d4ad8\"><code>42243b2</code></a></td><td><code>Trac 16803: free _rows and _entries only when needed.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/902fcc5399c02c4ab62ba9fb583edf39e6ce33f9\"><code>902fcc5</code></a></td><td><code>Trac 16803: No need to check for uninitialized pointers, so reverting</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1df2b4d8f03e4055a03059b693295f9d64c8166d\"><code>1df2b4d</code></a></td><td><code>Get rid of mpz_t_offset hacks</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dc9ef8c5ce5f58a649c52ed7e33eb6887b7e9224\"><code>dc9ef8c</code></a></td><td><code>Fix mpz_t, mpq_t, mpf_t declarations</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c2d5546babd242c07aaf3f91a2a79fcdec73c0c9\"><code>c2d5546</code></a></td><td><code>Use mpz_srcptr for padics pow_computer</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d1635d487c767bf54f2ba1c450dd93c8dccee36c\"><code>d1635d4</code></a></td><td><code>Remove unused _lift_crt_rr_with_lcm() function</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4cf706d0974ffc39af15e4b24b6e77b8bc984d53\"><code>4cf706d</code></a></td><td><code>Trac 16803: fixed `__div__` function.</code></td></tr></table>\n",
    "created_at": "2014-09-09T17:45:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220202",
    "user": "https://github.com/mmasdeu"
}
```

<div id="comment:52" align="right">comment:52</div>

Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7069aec939ce8f870f4fb66e9752cc14185fddb4"><code>7069aec</code></a></td><td><code>Further cleanup</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f1756fb17bde5ed36c363025d9548779dfafcaaf"><code>f1756fb</code></a></td><td><code>Fix include of fmpq_poly.pxi in Cython doctest</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/78d9bfc034dfe2af6758fb14dc3a5218bcba171e"><code>78d9bfc</code></a></td><td><code>Trac 16803: Initialize _rows and _entries only when needed (to save memory).</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/42243b22fa71a40bfe28ca1e8d61353a096d4ad8"><code>42243b2</code></a></td><td><code>Trac 16803: free _rows and _entries only when needed.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/902fcc5399c02c4ab62ba9fb583edf39e6ce33f9"><code>902fcc5</code></a></td><td><code>Trac 16803: No need to check for uninitialized pointers, so reverting</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1df2b4d8f03e4055a03059b693295f9d64c8166d"><code>1df2b4d</code></a></td><td><code>Get rid of mpz_t_offset hacks</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dc9ef8c5ce5f58a649c52ed7e33eb6887b7e9224"><code>dc9ef8c</code></a></td><td><code>Fix mpz_t, mpq_t, mpf_t declarations</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c2d5546babd242c07aaf3f91a2a79fcdec73c0c9"><code>c2d5546</code></a></td><td><code>Use mpz_srcptr for padics pow_computer</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d1635d487c767bf54f2ba1c450dd93c8dccee36c"><code>d1635d4</code></a></td><td><code>Remove unused _lift_crt_rr_with_lcm() function</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4cf706d0974ffc39af15e4b24b6e77b8bc984d53"><code>4cf706d</code></a></td><td><code>Trac 16803: fixed `__div__` function.</code></td></tr></table>




---

archive/issue_comments_220203.json:
```json
{
    "body": "Changed branch from **[u/mmasdeu/16803-2](https://github.com/sagemath/sagetrac-mirror/tree/u/mmasdeu/16803-2)** to **[u/mmasdeu/16803-matflint-3](https://github.com/sagemath/sagetrac-mirror/tree/u/mmasdeu/16803-matflint-3)**",
    "created_at": "2014-09-09T17:45:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220203",
    "user": "https://github.com/mmasdeu"
}
```

Changed branch from **[u/mmasdeu/16803-2](https://github.com/sagemath/sagetrac-mirror/tree/u/mmasdeu/16803-2)** to **[u/mmasdeu/16803-matflint-3](https://github.com/sagemath/sagetrac-mirror/tree/u/mmasdeu/16803-matflint-3)**



---

archive/issue_comments_220204.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nReplying to [@mmasdeu](#comment%3A51):\n> I propose the following, which I think is a good solution (especially since the plan is to move matrices over rationals also to FLINT).\n> \n> ```\n> def __div__(left,right):\n>     return left * (~right)\n> ```\n> \n> I have tried this and it passes the tests.\n\nYou need to add more doctests to this `__div__` function.",
    "created_at": "2014-09-09T19:18:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220204",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:53" align="right">comment:53</div>

Replying to [@mmasdeu](#comment%3A51):
> I propose the following, which I think is a good solution (especially since the plan is to move matrices over rationals also to FLINT).
> 
> ```
> def __div__(left,right):
>     return left * (~right)
> ```
> 
> I have tried this and it passes the tests.

You need to add more doctests to this `__div__` function.



---

archive/issue_events_237988.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-09-09T19:18:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-237988"
}
```



---

archive/issue_events_237989.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-09-09T19:18:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-237989"
}
```



---

archive/issue_comments_220205.json:
```json
{
    "body": "Changed commit from **[`4cf706d`](https://github.com/sagemath/sagetrac-mirror/commit/4cf706d0974ffc39af15e4b24b6e77b8bc984d53)** to **[`59d2a7b`](https://github.com/sagemath/sagetrac-mirror/commit/59d2a7b11c45338c59b5ed16c09167c2dec6809d)**",
    "created_at": "2014-09-10T08:35:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220205",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4cf706d`](https://github.com/sagemath/sagetrac-mirror/commit/4cf706d0974ffc39af15e4b24b6e77b8bc984d53)** to **[`59d2a7b`](https://github.com/sagemath/sagetrac-mirror/commit/59d2a7b11c45338c59b5ed16c09167c2dec6809d)**



---

archive/issue_comments_220206.json:
```json
{
    "body": "<div id=\"comment:54\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/59d2a7b11c45338c59b5ed16c09167c2dec6809d\"><code>59d2a7b</code></a></td><td><code>Trac 16803: added doctests to `__div__` function in structure/element.pyx</code></td></tr></table>\n",
    "created_at": "2014-09-10T08:35:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220206",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:54"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/59d2a7b11c45338c59b5ed16c09167c2dec6809d"><code>59d2a7b</code></a></td><td><code>Trac 16803: added doctests to `__div__` function in structure/element.pyx</code></td></tr></table>




---

archive/issue_events_237990.json:
```json
{
    "actor": "https://github.com/mmasdeu",
    "created_at": "2014-09-10T08:36:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-237990"
}
```



---

archive/issue_events_237991.json:
```json
{
    "actor": "https://github.com/mmasdeu",
    "created_at": "2014-09-10T08:36:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-237991"
}
```



---

archive/issue_comments_220207.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nDone.",
    "created_at": "2014-09-10T08:36:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220207",
    "user": "https://github.com/mmasdeu"
}
```

<div id="comment:55" align="right">comment:55</div>

Done.



---

archive/issue_events_237992.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-09-10T08:46:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-237992"
}
```



---

archive/issue_events_237993.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-09-10T08:46:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-237993"
}
```



---

archive/issue_comments_220208.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">comment:56</div>\n\nI really think more doctests are needed, also over rings which are not `ZZ` or `QQ` (see also comment [comment:50]). Perhaps `GF(3)` and `RDF` and `ZZ['t']` to have some wider coverage?\n\nAnd you should use the <code>:trac:\\`16803\\`</code> syntax to refer to Trac tickets (but given that this ticket has nothing to do with division of matrices, perhaps it makes more sense to just remove that comment).",
    "created_at": "2014-09-10T08:46:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220208",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:56" align="right">comment:56</div>

I really think more doctests are needed, also over rings which are not `ZZ` or `QQ` (see also comment [comment:50]). Perhaps `GF(3)` and `RDF` and `ZZ['t']` to have some wider coverage?

And you should use the <code>:trac:\`16803\`</code> syntax to refer to Trac tickets (but given that this ticket has nothing to do with division of matrices, perhaps it makes more sense to just remove that comment).



---

archive/issue_comments_220209.json:
```json
{
    "body": "Changed reviewer from **William Stein** to **William Stein, Jeroen Demeyer**",
    "created_at": "2014-09-10T08:46:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220209",
    "user": "https://github.com/jdemeyer"
}
```

Changed reviewer from **William Stein** to **William Stein, Jeroen Demeyer**



---

archive/issue_comments_220210.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">comment:57</div>\n\nAlso, doctest division of a matrix by a scalar...",
    "created_at": "2014-09-10T08:52:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220210",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:57" align="right">comment:57</div>

Also, doctest division of a matrix by a scalar...



---

archive/issue_comments_220211.json:
```json
{
    "body": "<div id=\"comment:58\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6095b103e1bf20752a58926a63a492bbf81cb004\"><code>6095b10</code></a></td><td><code>Added more tests.</code></td></tr></table>\n",
    "created_at": "2014-09-10T08:53:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220211",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:58"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6095b103e1bf20752a58926a63a492bbf81cb004"><code>6095b10</code></a></td><td><code>Added more tests.</code></td></tr></table>




---

archive/issue_comments_220212.json:
```json
{
    "body": "Changed commit from **[`59d2a7b`](https://github.com/sagemath/sagetrac-mirror/commit/59d2a7b11c45338c59b5ed16c09167c2dec6809d)** to **[`6095b10`](https://github.com/sagemath/sagetrac-mirror/commit/6095b103e1bf20752a58926a63a492bbf81cb004)**",
    "created_at": "2014-09-10T08:53:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220212",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`59d2a7b`](https://github.com/sagemath/sagetrac-mirror/commit/59d2a7b11c45338c59b5ed16c09167c2dec6809d)** to **[`6095b10`](https://github.com/sagemath/sagetrac-mirror/commit/6095b103e1bf20752a58926a63a492bbf81cb004)**



---

archive/issue_comments_220213.json:
```json
{
    "body": "Changed commit from **[`6095b10`](https://github.com/sagemath/sagetrac-mirror/commit/6095b103e1bf20752a58926a63a492bbf81cb004)** to **[`f9974ba`](https://github.com/sagemath/sagetrac-mirror/commit/f9974ba608c96861627c3f01cc58c5030536e9bd)**",
    "created_at": "2014-09-10T08:55:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220213",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6095b10`](https://github.com/sagemath/sagetrac-mirror/commit/6095b103e1bf20752a58926a63a492bbf81cb004)** to **[`f9974ba`](https://github.com/sagemath/sagetrac-mirror/commit/f9974ba608c96861627c3f01cc58c5030536e9bd)**



---

archive/issue_comments_220214.json:
```json
{
    "body": "<div id=\"comment:59\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f9974ba608c96861627c3f01cc58c5030536e9bd\"><code>f9974ba</code></a></td><td><code>And some more.</code></td></tr></table>\n",
    "created_at": "2014-09-10T08:55:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220214",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:59"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f9974ba608c96861627c3f01cc58c5030536e9bd"><code>f9974ba</code></a></td><td><code>And some more.</code></td></tr></table>




---

archive/issue_comments_220215.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">comment:60</div>\n\nDone!",
    "created_at": "2014-09-10T08:55:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220215",
    "user": "https://github.com/mmasdeu"
}
```

<div id="comment:60" align="right">comment:60</div>

Done!



---

archive/issue_events_237994.json:
```json
{
    "actor": "https://github.com/mmasdeu",
    "created_at": "2014-09-10T08:55:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-237994"
}
```



---

archive/issue_events_237995.json:
```json
{
    "actor": "https://github.com/mmasdeu",
    "created_at": "2014-09-10T08:55:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-237995"
}
```



---

archive/issue_events_237996.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-09-10T09:16:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-237996"
}
```



---

archive/issue_events_237997.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-09-10T09:16:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-237997"
}
```



---

archive/issue_comments_220216.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">comment:62</div>\n\nIn the last patches, you messed up the indentation from 4 to 3 spaces.",
    "created_at": "2014-09-10T09:16:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220216",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:62" align="right">comment:62</div>

In the last patches, you messed up the indentation from 4 to 3 spaces.



---

archive/issue_comments_220217.json:
```json
{
    "body": "<div id=\"comment:63\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/17bb2b784da9b2cecc40e8593fb32047ed6ae9cb\"><code>17bb2b7</code></a></td><td><code>Fixed wrong indentation.</code></td></tr></table>\n",
    "created_at": "2014-09-10T10:05:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220217",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:63"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/17bb2b784da9b2cecc40e8593fb32047ed6ae9cb"><code>17bb2b7</code></a></td><td><code>Fixed wrong indentation.</code></td></tr></table>




---

archive/issue_comments_220218.json:
```json
{
    "body": "Changed commit from **[`f9974ba`](https://github.com/sagemath/sagetrac-mirror/commit/f9974ba608c96861627c3f01cc58c5030536e9bd)** to **[`17bb2b7`](https://github.com/sagemath/sagetrac-mirror/commit/17bb2b784da9b2cecc40e8593fb32047ed6ae9cb)**",
    "created_at": "2014-09-10T10:05:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220218",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f9974ba`](https://github.com/sagemath/sagetrac-mirror/commit/f9974ba608c96861627c3f01cc58c5030536e9bd)** to **[`17bb2b7`](https://github.com/sagemath/sagetrac-mirror/commit/17bb2b784da9b2cecc40e8593fb32047ed6ae9cb)**



---

archive/issue_events_237998.json:
```json
{
    "actor": "https://github.com/mmasdeu",
    "created_at": "2014-09-10T10:07:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-237998"
}
```



---

archive/issue_events_237999.json:
```json
{
    "actor": "https://github.com/mmasdeu",
    "created_at": "2014-09-10T10:07:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-237999"
}
```



---

archive/issue_comments_220219.json:
```json
{
    "body": "<div id=\"comment:64\" align=\"right\">comment:64</div>\n\nSorry. Fixed that.",
    "created_at": "2014-09-10T10:07:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220219",
    "user": "https://github.com/mmasdeu"
}
```

<div id="comment:64" align="right">comment:64</div>

Sorry. Fixed that.



---

archive/issue_events_238000.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-09-10T10:10:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-238000"
}
```



---

archive/issue_events_238001.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-09-10T10:10:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-238001"
}
```



---

archive/issue_comments_220220.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">comment:65</div>\n\nI think this still leaks memory.\n\nThe following command works without this patch, but fails with this patch:\n\n```\n( ulimit -v 2000000; ./sage -t --long src/sage/combinat/root_system/branching_rules.py )\n```",
    "created_at": "2014-09-10T10:10:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220220",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:65" align="right">comment:65</div>

I think this still leaks memory.

The following command works without this patch, but fails with this patch:

```
( ulimit -v 2000000; ./sage -t --long src/sage/combinat/root_system/branching_rules.py )
```



---

archive/issue_comments_220221.json:
```json
{
    "body": "Changed commit from **[`17bb2b7`](https://github.com/sagemath/sagetrac-mirror/commit/17bb2b784da9b2cecc40e8593fb32047ed6ae9cb)** to **[`cd81521`](https://github.com/sagemath/sagetrac-mirror/commit/cd815217e562f84118f53458b18cfd9b68c975a2)**",
    "created_at": "2014-09-10T13:37:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220221",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`17bb2b7`](https://github.com/sagemath/sagetrac-mirror/commit/17bb2b784da9b2cecc40e8593fb32047ed6ae9cb)** to **[`cd81521`](https://github.com/sagemath/sagetrac-mirror/commit/cd815217e562f84118f53458b18cfd9b68c975a2)**



---

archive/issue_comments_220222.json:
```json
{
    "body": "<div id=\"comment:66\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/83bec69ddf0391b6b26ce67de2ba4de4d4cc3f71\"><code>83bec69</code></a></td><td><code>Fixed typo in polynomial.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cd815217e562f84118f53458b18cfd9b68c975a2\"><code>cd81521</code></a></td><td><code>Fixed bug introduced in outside package.</code></td></tr></table>\n",
    "created_at": "2014-09-10T13:37:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220222",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:66"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/83bec69ddf0391b6b26ce67de2ba4de4d4cc3f71"><code>83bec69</code></a></td><td><code>Fixed typo in polynomial.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cd815217e562f84118f53458b18cfd9b68c975a2"><code>cd81521</code></a></td><td><code>Fixed bug introduced in outside package.</code></td></tr></table>




---

archive/issue_comments_220223.json:
```json
{
    "body": "<div id=\"comment:67\" align=\"right\">comment:67</div>\n\nThe bug reported in [comment:65](#comment%3A65) may be related to an issue with infinite recursion. I traced it down to the modification of the `__div__` function. With the current patch the command in [comment:65](#comment%3A65) works, and all the tests in sage/structure and sage/matrix pass. I am now running make ptest and will report if something arises.",
    "created_at": "2014-09-10T13:44:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220223",
    "user": "https://github.com/mmasdeu"
}
```

<div id="comment:67" align="right">comment:67</div>

The bug reported in [comment:65](#comment%3A65) may be related to an issue with infinite recursion. I traced it down to the modification of the `__div__` function. With the current patch the command in [comment:65](#comment%3A65) works, and all the tests in sage/structure and sage/matrix pass. I am now running make ptest and will report if something arises.



---

archive/issue_events_238002.json:
```json
{
    "actor": "https://github.com/mmasdeu",
    "created_at": "2014-09-10T13:44:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-238002"
}
```



---

archive/issue_events_238003.json:
```json
{
    "actor": "https://github.com/mmasdeu",
    "created_at": "2014-09-10T13:44:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-238003"
}
```



---

archive/issue_comments_220224.json:
```json
{
    "body": "Changed commit from **[`cd81521`](https://github.com/sagemath/sagetrac-mirror/commit/cd815217e562f84118f53458b18cfd9b68c975a2)** to **[`6359d72`](https://github.com/sagemath/sagetrac-mirror/commit/6359d72733219492dccba27caf10a04b909eda97)**",
    "created_at": "2014-09-18T13:43:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220224",
    "user": "https://github.com/mmasdeu"
}
```

Changed commit from **[`cd81521`](https://github.com/sagemath/sagetrac-mirror/commit/cd815217e562f84118f53458b18cfd9b68c975a2)** to **[`6359d72`](https://github.com/sagemath/sagetrac-mirror/commit/6359d72733219492dccba27caf10a04b909eda97)**



---

archive/issue_comments_220225.json:
```json
{
    "body": "Changed branch from **[u/mmasdeu/16803-matflint-3](https://github.com/sagemath/sagetrac-mirror/tree/u/mmasdeu/16803-matflint-3)** to **[u/mmasdeu/16803-matflint-4](https://github.com/sagemath/sagetrac-mirror/tree/u/mmasdeu/16803-matflint-4)**",
    "created_at": "2014-09-18T13:43:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220225",
    "user": "https://github.com/mmasdeu"
}
```

Changed branch from **[u/mmasdeu/16803-matflint-3](https://github.com/sagemath/sagetrac-mirror/tree/u/mmasdeu/16803-matflint-3)** to **[u/mmasdeu/16803-matflint-4](https://github.com/sagemath/sagetrac-mirror/tree/u/mmasdeu/16803-matflint-4)**



---

archive/issue_comments_220226.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">comment:68</div>\n\nI have rebased it again. It looks like some other code is a moving target and it is hard to keep pace...\n\n---\nLast 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2b873709cb5bfbab8995940c1db798a28c71eb9e\"><code>2b87370</code></a></td><td><code>Trac 16803: No need to check for uninitialized pointers, so reverting</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/50cb2ae5189e030fe325c07908f92d2020415c5e\"><code>50cb2ae</code></a></td><td><code>Fix mpz_t, mpq_t, mpf_t declarations</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e52c1ff94c63d12c4b0ed5274a96a9b91f20f0c2\"><code>e52c1ff</code></a></td><td><code>Remove unused _lift_crt_rr_with_lcm() function</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fa5a4afaf77648f06d3c0d120769e4b77b9ed5ba\"><code>fa5a4af</code></a></td><td><code>Trac 16803: fixed `__div__` function.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1b86766c84819be47be1c5b12e189970de153c94\"><code>1b86766</code></a></td><td><code>Trac 16803: added doctests to `__div__` function in structure/element.pyx</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3c6f808191511a009b744e89a00e9e52295e2a1c\"><code>3c6f808</code></a></td><td><code>Added more tests.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d87e348b06fcccf6f9ffa4ea455d87babcd22d0a\"><code>d87e348</code></a></td><td><code>And some more.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5b8ee2db4114f87b6873f88e5e7786d35771ef8d\"><code>5b8ee2d</code></a></td><td><code>Fixed wrong indentation.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/eab8a1ebc2c98973b5b019b8d85b7688a9a50510\"><code>eab8a1e</code></a></td><td><code>Fixed bug introduced in outside package.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6359d72733219492dccba27caf10a04b909eda97\"><code>6359d72</code></a></td><td><code>Fixed compilation errors.</code></td></tr></table>\n",
    "created_at": "2014-09-18T13:43:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220226",
    "user": "https://github.com/mmasdeu"
}
```

<div id="comment:68" align="right">comment:68</div>

I have rebased it again. It looks like some other code is a moving target and it is hard to keep pace...

---
Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2b873709cb5bfbab8995940c1db798a28c71eb9e"><code>2b87370</code></a></td><td><code>Trac 16803: No need to check for uninitialized pointers, so reverting</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/50cb2ae5189e030fe325c07908f92d2020415c5e"><code>50cb2ae</code></a></td><td><code>Fix mpz_t, mpq_t, mpf_t declarations</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e52c1ff94c63d12c4b0ed5274a96a9b91f20f0c2"><code>e52c1ff</code></a></td><td><code>Remove unused _lift_crt_rr_with_lcm() function</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fa5a4afaf77648f06d3c0d120769e4b77b9ed5ba"><code>fa5a4af</code></a></td><td><code>Trac 16803: fixed `__div__` function.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1b86766c84819be47be1c5b12e189970de153c94"><code>1b86766</code></a></td><td><code>Trac 16803: added doctests to `__div__` function in structure/element.pyx</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3c6f808191511a009b744e89a00e9e52295e2a1c"><code>3c6f808</code></a></td><td><code>Added more tests.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d87e348b06fcccf6f9ffa4ea455d87babcd22d0a"><code>d87e348</code></a></td><td><code>And some more.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5b8ee2db4114f87b6873f88e5e7786d35771ef8d"><code>5b8ee2d</code></a></td><td><code>Fixed wrong indentation.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/eab8a1ebc2c98973b5b019b8d85b7688a9a50510"><code>eab8a1e</code></a></td><td><code>Fixed bug introduced in outside package.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6359d72733219492dccba27caf10a04b909eda97"><code>6359d72</code></a></td><td><code>Fixed compilation errors.</code></td></tr></table>




---

archive/issue_events_238004.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2014-09-18T13:47:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-238004"
}
```



---

archive/issue_events_238005.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2014-09-18T13:47:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-238005"
}
```



---

archive/issue_comments_220227.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">comment:69</div>\n\nSince test pass, and the issues Jereon found were addressed, I'm switching this back to positive review.",
    "created_at": "2014-09-18T13:47:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220227",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:69" align="right">comment:69</div>

Since test pass, and the issues Jereon found were addressed, I'm switching this back to positive review.



---

archive/issue_events_238006.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-09-18T15:21:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-238006"
}
```



---

archive/issue_events_238007.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-09-18T15:21:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-238007"
}
```



---

archive/issue_comments_220228.json:
```json
{
    "body": "<div id=\"comment:70\" align=\"right\">comment:70</div>\n\nThis still fails, I'm pretty sure just or your branch as well:\n\n```\nsage -t --long --warn-long 70.7 src/sage/structure/element.pyx\n**********************************************************************\nFile \"src/sage/structure/element.pyx\", line 2770, in sage.structure.element.Matrix.__div__\nFailed example:\n    a / b\nExpected:\n    [-0.159090909091 -0.295454545455]\n    [  2.86363636364 -0.681818181818]\nGot:\n    [-0.15909090909090906 -0.29545454545454547]\n    [   2.863636363636364  -0.6818181818181817]\n**********************************************************************\n1 item had failures:\n   1 of  22 in sage.structure.element.Matrix.__div__\n    [455 tests, 1 failure, 38.78 s]\n```",
    "created_at": "2014-09-18T15:21:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220228",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:70" align="right">comment:70</div>

This still fails, I'm pretty sure just or your branch as well:

```
sage -t --long --warn-long 70.7 src/sage/structure/element.pyx
**********************************************************************
File "src/sage/structure/element.pyx", line 2770, in sage.structure.element.Matrix.__div__
Failed example:
    a / b
Expected:
    [-0.159090909091 -0.295454545455]
    [  2.86363636364 -0.681818181818]
Got:
    [-0.15909090909090906 -0.29545454545454547]
    [   2.863636363636364  -0.6818181818181817]
**********************************************************************
1 item had failures:
   1 of  22 in sage.structure.element.Matrix.__div__
    [455 tests, 1 failure, 38.78 s]
```



---

archive/issue_comments_220229.json:
```json
{
    "body": "<div id=\"comment:71\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6757e11b36f7bc647eae1adcf636bed76fb3e85d\"><code>6757e11</code></a></td><td><code>Trac 16803: Fix a doctest for RDF matrices.</code></td></tr></table>\n",
    "created_at": "2014-09-18T16:38:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220229",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:71"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6757e11b36f7bc647eae1adcf636bed76fb3e85d"><code>6757e11</code></a></td><td><code>Trac 16803: Fix a doctest for RDF matrices.</code></td></tr></table>




---

archive/issue_comments_220230.json:
```json
{
    "body": "Changed commit from **[`6359d72`](https://github.com/sagemath/sagetrac-mirror/commit/6359d72733219492dccba27caf10a04b909eda97)** to **[`6757e11`](https://github.com/sagemath/sagetrac-mirror/commit/6757e11b36f7bc647eae1adcf636bed76fb3e85d)**",
    "created_at": "2014-09-18T16:38:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220230",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6359d72`](https://github.com/sagemath/sagetrac-mirror/commit/6359d72733219492dccba27caf10a04b909eda97)** to **[`6757e11`](https://github.com/sagemath/sagetrac-mirror/commit/6757e11b36f7bc647eae1adcf636bed76fb3e85d)**



---

archive/issue_comments_220231.json:
```json
{
    "body": "<div id=\"comment:72\" align=\"right\">comment:72</div>\n\nIf I am not mistaken, it is the current output which is correct (I checked with Magma also). I had myself added this doctest last week, sorry!",
    "created_at": "2014-09-18T16:40:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220231",
    "user": "https://github.com/mmasdeu"
}
```

<div id="comment:72" align="right">comment:72</div>

If I am not mistaken, it is the current output which is correct (I checked with Magma also). I had myself added this doctest last week, sorry!



---

archive/issue_events_238008.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-09-18T16:42:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-238008"
}
```



---

archive/issue_events_238009.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-09-18T16:42:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-238009"
}
```



---

archive/issue_comments_220232.json:
```json
{
    "body": "<div id=\"comment:74\" align=\"right\">comment:74</div>\n\nNumerical noise on 32-bit, should be marked with a suitable `# rel tol`\n\n```\nsage -t --long src/sage/structure/element.pyx\n**********************************************************************\nFile \"src/sage/structure/element.pyx\", line 2770, in sage.structure.element.Matrix.__div__\nFailed example:\n    a / b\nExpected:\n    [-0.15909090909090906 -0.29545454545454547]\n    [   2.863636363636364  -0.6818181818181817]\nGot:\n    [ -0.1590909090909091 -0.29545454545454547]\n    [   2.863636363636364  -0.6818181818181815]\n**********************************************************************\n1 item had failures:\n```",
    "created_at": "2014-09-18T20:00:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220232",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:74" align="right">comment:74</div>

Numerical noise on 32-bit, should be marked with a suitable `# rel tol`

```
sage -t --long src/sage/structure/element.pyx
**********************************************************************
File "src/sage/structure/element.pyx", line 2770, in sage.structure.element.Matrix.__div__
Failed example:
    a / b
Expected:
    [-0.15909090909090906 -0.29545454545454547]
    [   2.863636363636364  -0.6818181818181817]
Got:
    [ -0.1590909090909091 -0.29545454545454547]
    [   2.863636363636364  -0.6818181818181815]
**********************************************************************
1 item had failures:
```



---

archive/issue_events_238010.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-09-18T20:00:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-238010"
}
```



---

archive/issue_events_238011.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-09-18T20:00:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-238011"
}
```



---

archive/issue_comments_220233.json:
```json
{
    "body": "<div id=\"comment:76\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/812a5099731dd5e819ebce0b19ee744de439a6ea\"><code>812a509</code></a></td><td><code>Trac 16803: Added rel tol to doctest.</code></td></tr></table>\n",
    "created_at": "2014-09-19T08:49:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220233",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:76"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/812a5099731dd5e819ebce0b19ee744de439a6ea"><code>812a509</code></a></td><td><code>Trac 16803: Added rel tol to doctest.</code></td></tr></table>




---

archive/issue_comments_220234.json:
```json
{
    "body": "Changed commit from **[`6757e11`](https://github.com/sagemath/sagetrac-mirror/commit/6757e11b36f7bc647eae1adcf636bed76fb3e85d)** to **[`812a509`](https://github.com/sagemath/sagetrac-mirror/commit/812a5099731dd5e819ebce0b19ee744de439a6ea)**",
    "created_at": "2014-09-19T08:49:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220234",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6757e11`](https://github.com/sagemath/sagetrac-mirror/commit/6757e11b36f7bc647eae1adcf636bed76fb3e85d)** to **[`812a509`](https://github.com/sagemath/sagetrac-mirror/commit/812a5099731dd5e819ebce0b19ee744de439a6ea)**



---

archive/issue_comments_220235.json:
```json
{
    "body": "<div id=\"comment:77\" align=\"right\">comment:77</div>\n\nDone.",
    "created_at": "2014-09-19T08:50:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220235",
    "user": "https://github.com/mmasdeu"
}
```

<div id="comment:77" align="right">comment:77</div>

Done.



---

archive/issue_events_238012.json:
```json
{
    "actor": "https://github.com/mmasdeu",
    "created_at": "2014-09-19T08:51:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-238012"
}
```



---

archive/issue_events_238013.json:
```json
{
    "actor": "https://github.com/mmasdeu",
    "created_at": "2014-09-19T08:51:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-238013"
}
```



---

archive/issue_comments_220236.json:
```json
{
    "body": "<div id=\"comment:79\" align=\"right\">comment:79</div>\n\nLinear algebra should really give the right answer to a few ulp, and not just 1e-10. But the test is about testing that the division operator works, so ok.",
    "created_at": "2014-09-19T10:41:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220236",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:79" align="right">comment:79</div>

Linear algebra should really give the right answer to a few ulp, and not just 1e-10. But the test is about testing that the division operator works, so ok.



---

archive/issue_events_238014.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-09-19T10:41:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-238014"
}
```



---

archive/issue_events_238015.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-09-19T10:41:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-238015"
}
```



---

archive/issue_events_238016.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-09-19T15:08:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-238016"
}
```



---

archive/issue_events_238017.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "1f70c1881c79f2ae1d7850ebfca89aff88803265",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2014-09-19T15:08:52Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16803#event-238017"
}
```



---

archive/issue_comments_220237.json:
```json
{
    "body": "Changed branch from **[u/mmasdeu/16803-matflint-4](https://github.com/sagemath/sagetrac-mirror/tree/u/mmasdeu/16803-matflint-4)** to **[`812a509`](https://github.com/sagemath/sagetrac-mirror/commit/812a5099731dd5e819ebce0b19ee744de439a6ea)**",
    "created_at": "2014-09-19T15:08:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220237",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mmasdeu/16803-matflint-4](https://github.com/sagemath/sagetrac-mirror/tree/u/mmasdeu/16803-matflint-4)** to **[`812a509`](https://github.com/sagemath/sagetrac-mirror/commit/812a5099731dd5e819ebce0b19ee744de439a6ea)**



---

archive/issue_comments_220238.json:
```json
{
    "body": "Changed commit from **[`812a509`](https://github.com/sagemath/sagetrac-mirror/commit/812a5099731dd5e819ebce0b19ee744de439a6ea)** to none",
    "created_at": "2014-10-02T14:00:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220238",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[`812a509`](https://github.com/sagemath/sagetrac-mirror/commit/812a5099731dd5e819ebce0b19ee744de439a6ea)** to none



---

archive/issue_comments_220239.json:
```json
{
    "body": "<div id=\"comment:81\" align=\"right\">comment:81</div>\n\nFollow-ups: #17080 and #17090.",
    "created_at": "2014-10-02T14:00:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220239",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:81" align="right">comment:81</div>

Follow-ups: #17080 and #17090.



---

archive/issue_comments_220240.json:
```json
{
    "body": "<div id=\"comment:82\" align=\"right\">comment:82</div>\n\nDid any of the reviewers (Volker?) actually read the code on this ticket? I've started doing this and there are many things to be improved... perhaps this ticket was merged too fast.",
    "created_at": "2014-10-02T18:09:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220240",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:82" align="right">comment:82</div>

Did any of the reviewers (Volker?) actually read the code on this ticket? I've started doing this and there are many things to be improved... perhaps this ticket was merged too fast.



---

archive/issue_comments_220241.json:
```json
{
    "body": "<div id=\"comment:83\" align=\"right\">comment:83</div>\n\nIs it perfect? No. But better than before? IMHO yes. Faster? For sure.",
    "created_at": "2014-10-02T18:17:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220241",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:83" align="right">comment:83</div>

Is it perfect? No. But better than before? IMHO yes. Faster? For sure.



---

archive/issue_comments_220242.json:
```json
{
    "body": "<div id=\"comment:84\" align=\"right\">comment:84</div>\n\nReplying to [@jdemeyer](#comment%3A82):\n> Did any of the reviewers (Volker?) actually read the code on this ticket? I've started doing this and there are many things to be improved... \n\nI certainly read the version of the code 5 weeks ago, and had many, many, many suggestions for improvement, found numerous major bugs, etc.     \n\n> perhaps this ticket was merged too fast.\n\nOne has to balance that with the fact that for whatever reason, without this ticket a vast range of linear algebra in Sage is so utterly orders of magnitude too slow, as to make it painful and useless for research work.    This new code is **dramatically** faster than before.",
    "created_at": "2014-10-02T18:18:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220242",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:84" align="right">comment:84</div>

Replying to [@jdemeyer](#comment%3A82):
> Did any of the reviewers (Volker?) actually read the code on this ticket? I've started doing this and there are many things to be improved... 

I certainly read the version of the code 5 weeks ago, and had many, many, many suggestions for improvement, found numerous major bugs, etc.     

> perhaps this ticket was merged too fast.

One has to balance that with the fact that for whatever reason, without this ticket a vast range of linear algebra in Sage is so utterly orders of magnitude too slow, as to make it painful and useless for research work.    This new code is **dramatically** faster than before.



---

archive/issue_comments_220243.json:
```json
{
    "body": "<div id=\"comment:85\" align=\"right\">comment:85</div>\n\nReplying to [@williamstein](#comment%3A84):\n> This new code is **dramatically** faster than before.\n\nI only hope we're not trading correctness for speed.",
    "created_at": "2014-10-02T18:20:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220243",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:85" align="right">comment:85</div>

Replying to [@williamstein](#comment%3A84):
> This new code is **dramatically** faster than before.

I only hope we're not trading correctness for speed.



---

archive/issue_comments_220244.json:
```json
{
    "body": "<div id=\"comment:86\" align=\"right\">comment:86</div>\n\nReplying to [@jdemeyer](#comment%3A85):\n> Replying to [@williamstein](#comment%3A84):\n> > This new code is **dramatically** faster than before.\n\n> I only hope we're not trading correctness for speed.\n\nWell when I looked over the code 5 weeks ago there are numerous  memory leaks and other causes for concern (e.g., unitialized memory assumed to be 0). But those were I think all addressed.   Did you find anything that is actually incorrect?  Or does the overall code just make you unhappy and nervous?  Or are you not happy building on FLINT?",
    "created_at": "2014-10-02T18:25:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220244",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:86" align="right">comment:86</div>

Replying to [@jdemeyer](#comment%3A85):
> Replying to [@williamstein](#comment%3A84):
> > This new code is **dramatically** faster than before.

> I only hope we're not trading correctness for speed.

Well when I looked over the code 5 weeks ago there are numerous  memory leaks and other causes for concern (e.g., unitialized memory assumed to be 0). But those were I think all addressed.   Did you find anything that is actually incorrect?  Or does the overall code just make you unhappy and nervous?  Or are you not happy building on FLINT?



---

archive/issue_comments_220245.json:
```json
{
    "body": "<div id=\"comment:87\" align=\"right\">comment:87</div>\n\nI just have to add jdemeyer that I'm really glad you're looking at this too, since you have an amazing eye for quality (similar to your recent remarks about the pexpect interfaces).",
    "created_at": "2014-10-02T18:36:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220245",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:87" align="right">comment:87</div>

I just have to add jdemeyer that I'm really glad you're looking at this too, since you have an amazing eye for quality (similar to your recent remarks about the pexpect interfaces).



---

archive/issue_comments_220246.json:
```json
{
    "body": "<div id=\"comment:88\" align=\"right\">comment:88</div>\n\nReplying to [@williamstein](#comment%3A86):\n> Did you find anything that is actually incorrect?\n\nThe segmentation fault in `_lmul_`, which is the reason for creating #17090.\n\n> Or does the overall code just make you unhappy and nervous?\n\nWhen looking at this code, there are some sloppy things (like why is the `_det_pari()` function duplicated?). Overall, I have less faith in sloppy code than clear code.\n\n> Or are you not happy building on FLINT?\n\nThat's not the problem. In general, I think it's good to rely on external packages if they do a good job (which seems to be the case here).",
    "created_at": "2014-10-02T20:29:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220246",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:88" align="right">comment:88</div>

Replying to [@williamstein](#comment%3A86):
> Did you find anything that is actually incorrect?

The segmentation fault in `_lmul_`, which is the reason for creating #17090.

> Or does the overall code just make you unhappy and nervous?

When looking at this code, there are some sloppy things (like why is the `_det_pari()` function duplicated?). Overall, I have less faith in sloppy code than clear code.

> Or are you not happy building on FLINT?

That's not the problem. In general, I think it's good to rely on external packages if they do a good job (which seems to be the case here).



---

archive/issue_comments_220247.json:
```json
{
    "body": "<div id=\"comment:90\" align=\"right\">comment:90</div>\n\nWhat's with the changes in padics in this ticket? Surely, yet another mistake...",
    "created_at": "2014-10-02T21:30:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220247",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:90" align="right">comment:90</div>

What's with the changes in padics in this ticket? Surely, yet another mistake...



---

archive/issue_comments_220248.json:
```json
{
    "body": "<div id=\"comment:91\" align=\"right\">comment:91</div>\n\nYet another follow-up: #17094",
    "created_at": "2014-10-03T09:03:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220248",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:91" align="right">comment:91</div>

Yet another follow-up: #17094



---

archive/issue_comments_220249.json:
```json
{
    "body": "<div id=\"comment:92\" align=\"right\">comment:92</div>\n\nI must say that IMO some of the comments (82 and 90) made above are not very constructive. jdemeyer questions the thoroughness of the reviewing process, while clearly he himself didn't read the comments at the beginning of the ticket (at least those that refer to the convenience of leaving in the legacy functions).\n\nAfter the experience with this ticket I feel less inclined to take on the analogous job for matrix_rational_dense. Sorry!",
    "created_at": "2014-10-03T09:46:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220249",
    "user": "https://github.com/mmasdeu"
}
```

<div id="comment:92" align="right">comment:92</div>

I must say that IMO some of the comments (82 and 90) made above are not very constructive. jdemeyer questions the thoroughness of the reviewing process, while clearly he himself didn't read the comments at the beginning of the ticket (at least those that refer to the convenience of leaving in the legacy functions).

After the experience with this ticket I feel less inclined to take on the analogous job for matrix_rational_dense. Sorry!



---

archive/issue_comments_220250.json:
```json
{
    "body": "<div id=\"comment:93\" align=\"right\">comment:93</div>\n\nReplying to [@mmasdeu](#comment%3A92):\n> I must say that IMO some of the comments (82 and 90) made above are not very constructive.\n\n[comment:82] was made out of frustration by seeing so many things here which are dubious. So okay, that's not constructive.\n\nHowever in [comment:90], I noticed a mistake, mentioned it in the comment and fixed it in #17090. How is that not constructive?\n\n> while clearly he himself didn't read the comments at the beginning of the ticket (at least those that refer to the convenience of leaving in the legacy functions).\n\nThat's true, but after William Stein's comment, I have fixed that back in #17090.\n\n> I feel less inclined to take on the analogous job for matrix_rational_dense.\n\nPlease don't. I think it's absolutely good to improve matrices like you did here. The fact that I am making so many comments and creating follow-up tickets means that I care. I make mistakes, you make mistakes, that's normal and that's why have this review process.\n\nMy only complaint (and I still stand behind this) is that this ticket was given positive_review too soon. Ideally, those 3 follow-up tickets should have been reviewer patches on this ticket.",
    "created_at": "2014-10-03T10:36:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220250",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:93" align="right">comment:93</div>

Replying to [@mmasdeu](#comment%3A92):
> I must say that IMO some of the comments (82 and 90) made above are not very constructive.

[comment:82] was made out of frustration by seeing so many things here which are dubious. So okay, that's not constructive.

However in [comment:90], I noticed a mistake, mentioned it in the comment and fixed it in #17090. How is that not constructive?

> while clearly he himself didn't read the comments at the beginning of the ticket (at least those that refer to the convenience of leaving in the legacy functions).

That's true, but after William Stein's comment, I have fixed that back in #17090.

> I feel less inclined to take on the analogous job for matrix_rational_dense.

Please don't. I think it's absolutely good to improve matrices like you did here. The fact that I am making so many comments and creating follow-up tickets means that I care. I make mistakes, you make mistakes, that's normal and that's why have this review process.

My only complaint (and I still stand behind this) is that this ticket was given positive_review too soon. Ideally, those 3 follow-up tickets should have been reviewer patches on this ticket.



---

archive/issue_comments_220251.json:
```json
{
    "body": "<div id=\"comment:94\" align=\"right\">comment:94</div>\n\nReplying to [@jdemeyer](#comment%3A93):\n\n> [comment:82] was made out of frustration by seeing so many things here which are dubious. So okay, that's not constructive.\n\nI can understand your frustration. But the bar is high enough (python + cython + sage oddities + legacy code + git + trac, and I am probably missing something here) that makes it very hard for people to contribute, and these comments do not help. But I take your last comment in good faith :-).\n\nAlso, if there are other things that are dubious please share them because I (and possibly others!) would like to learn from it.\n\n> However in [comment:90], I noticed a mistake, mentioned it in the comment and fixed it in #17090. How is that not constructive?\n\nSurely I did not go and touch p-adics for no reason. These changes weren't there in the first version of the my patch, and I had to add them because during the time it took to from the first version until this ticket got closed other changes were being merged, and these made the patch to stop compiling. Changing those lines in p-adics is how I managed to fix it, but the hackish idea was not mine, I saw it used elsewhere. I appreciate you having fixed it back.",
    "created_at": "2014-10-03T11:10:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220251",
    "user": "https://github.com/mmasdeu"
}
```

<div id="comment:94" align="right">comment:94</div>

Replying to [@jdemeyer](#comment%3A93):

> [comment:82] was made out of frustration by seeing so many things here which are dubious. So okay, that's not constructive.

I can understand your frustration. But the bar is high enough (python + cython + sage oddities + legacy code + git + trac, and I am probably missing something here) that makes it very hard for people to contribute, and these comments do not help. But I take your last comment in good faith :-).

Also, if there are other things that are dubious please share them because I (and possibly others!) would like to learn from it.

> However in [comment:90], I noticed a mistake, mentioned it in the comment and fixed it in #17090. How is that not constructive?

Surely I did not go and touch p-adics for no reason. These changes weren't there in the first version of the my patch, and I had to add them because during the time it took to from the first version until this ticket got closed other changes were being merged, and these made the patch to stop compiling. Changing those lines in p-adics is how I managed to fix it, but the hackish idea was not mine, I saw it used elsewhere. I appreciate you having fixed it back.



---

archive/issue_comments_220252.json:
```json
{
    "body": "<div id=\"comment:95\" align=\"right\">comment:95</div>\n\nReplying to [@mmasdeu](#comment%3A94):\n> Surely I did not go and touch p-adics for no reason. These changes weren't there in the first version of the my patch, and I had to add them because during the time it took to from the first version until this ticket got closed other changes were being merged, and these made the patch to stop compiling.\n\nI think you simply did something compiling Sage, because those changes to p-adics are totally unrelated to matrices. I cannot imagine how the change to matrices could break building p-adics or vice versa. And indeed, I simply undid the changes in #17090 without any bad consequences.",
    "created_at": "2014-10-03T11:29:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220252",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:95" align="right">comment:95</div>

Replying to [@mmasdeu](#comment%3A94):
> Surely I did not go and touch p-adics for no reason. These changes weren't there in the first version of the my patch, and I had to add them because during the time it took to from the first version until this ticket got closed other changes were being merged, and these made the patch to stop compiling.

I think you simply did something compiling Sage, because those changes to p-adics are totally unrelated to matrices. I cannot imagine how the change to matrices could break building p-adics or vice versa. And indeed, I simply undid the changes in #17090 without any bad consequences.



---

archive/issue_comments_220253.json:
```json
{
    "body": "<div id=\"comment:96\" align=\"right\">comment:96</div>\n\nReplying to [@mmasdeu](#comment%3A94):\n> Replying to [@jdemeyer](#comment%3A93):\n> \n> > [comment:82] was made out of frustration by seeing so many things here which are dubious. So okay, that's not constructive.\n\n> \n> I can understand your frustration. But the bar is high enough (python + cython + sage oddities + legacy code + git + trac, and I am probably missing something here) that makes it very hard for people to contribute, and these comments do not help. But I take your last comment in good faith :-).\n> \n\nMarc -- don't you want to be a bad ass computer programmer, in addition to mathematician?   Just redo matrix_rational_dense, and you'll be way closer :-)",
    "created_at": "2014-10-03T15:26:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220253",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:96" align="right">comment:96</div>

Replying to [@mmasdeu](#comment%3A94):
> Replying to [@jdemeyer](#comment%3A93):
> 
> > [comment:82] was made out of frustration by seeing so many things here which are dubious. So okay, that's not constructive.

> 
> I can understand your frustration. But the bar is high enough (python + cython + sage oddities + legacy code + git + trac, and I am probably missing something here) that makes it very hard for people to contribute, and these comments do not help. But I take your last comment in good faith :-).
> 

Marc -- don't you want to be a bad ass computer programmer, in addition to mathematician?   Just redo matrix_rational_dense, and you'll be way closer :-)



---

archive/issue_comments_220254.json:
```json
{
    "body": "<div id=\"comment:97\" align=\"right\">comment:97</div>\n\nReplying to [@mmasdeu](#comment%3A94):\n> Also, if there are other things that are dubious please share them because I (and possibly others!) would like to learn from it.\n\nWell, you can look at the follow-up tickets #17090 and #17094 and see what I changed (and preferably review those tickets).\n\nSome general things which haven't been mentioned yet:\n1. clean-up your code when you change things: when you remove code, try to remove everything related to the old code. When you change code, the old structure might not be applicable anymore, so refactor if needed (e.g. the sepatate branch for `n <= 4` in `determinant()` no longer serves any purpose)\n2. also fix documentation: when you change something, also change the corresponding documentation. When you copy/paste something, be sure to update documentation and doctests (see the various `set_unsafe` methods).\n3. don't add unneeded import statements or includes, those add needless extra dependencies. Like, why did you add `include \"sage/libs/ntl/decl.pxi\"` in several places when you don't use any NTL code?\n4. try to use correct formatting: spacing, indentation, docstring formatting (this was mostly good, but a bit messed up in `src/module_list.py`). If anything, this makes your code look more professional and less sloppy.\n5. don't use `assert` for checking user input: use `assert` for when you *know* that something is true (but want to check just in case), not when you need to check that something is true.",
    "created_at": "2014-10-03T19:23:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220254",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:97" align="right">comment:97</div>

Replying to [@mmasdeu](#comment%3A94):
> Also, if there are other things that are dubious please share them because I (and possibly others!) would like to learn from it.

Well, you can look at the follow-up tickets #17090 and #17094 and see what I changed (and preferably review those tickets).

Some general things which haven't been mentioned yet:
1. clean-up your code when you change things: when you remove code, try to remove everything related to the old code. When you change code, the old structure might not be applicable anymore, so refactor if needed (e.g. the sepatate branch for `n <= 4` in `determinant()` no longer serves any purpose)
2. also fix documentation: when you change something, also change the corresponding documentation. When you copy/paste something, be sure to update documentation and doctests (see the various `set_unsafe` methods).
3. don't add unneeded import statements or includes, those add needless extra dependencies. Like, why did you add `include "sage/libs/ntl/decl.pxi"` in several places when you don't use any NTL code?
4. try to use correct formatting: spacing, indentation, docstring formatting (this was mostly good, but a bit messed up in `src/module_list.py`). If anything, this makes your code look more professional and less sloppy.
5. don't use `assert` for checking user input: use `assert` for when you *know* that something is true (but want to check just in case), not when you need to check that something is true.



---

archive/issue_comments_220255.json:
```json
{
    "body": "<div id=\"comment:98\" align=\"right\">comment:98</div>\n\nReplying to [@jdemeyer](#comment%3A97):\n\nThanks! These comments are helpful indeed.\n\nWilliam -- I rather try to be a better mathematician...it has the advantage that although you get constantly evaluated, the evaluations are mostly anonymous :-). But that was in my to-do list. And it still is, despite my previous comments in this ticket!",
    "created_at": "2014-10-03T20:00:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16803#issuecomment-220255",
    "user": "https://github.com/mmasdeu"
}
```

<div id="comment:98" align="right">comment:98</div>

Replying to [@jdemeyer](#comment%3A97):

Thanks! These comments are helpful indeed.

William -- I rather try to be a better mathematician...it has the advantage that although you get constantly evaluated, the evaluations are mostly anonymous :-). But that was in my to-do list. And it still is, despite my previous comments in this ticket!
