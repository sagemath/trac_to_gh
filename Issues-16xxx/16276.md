# Issue 16276: fixes PolynomialElement.mod()

archive/issues_016039.json:
```json
{
    "body": "Before : \n\n```\n           sage: R.<x> = PolynomialRing(ZZ)\n            sage: f = x^3 + x + 1\n            sage: f.mod(x + 1)\n            x^3 + x + 1\n```\n\nAfter : \n\n```\n           sage: R.<x> = PolynomialRing(ZZ)\n            sage: f = x^3 + x + 1\n            sage: f.mod(x + 1)\n            -1\n```\n\n\n**Branch/Commit:** [dca4cc51ea0d0a6b9f321de8e7815ec5602b0593](https://github.com/sagemath/sagetrac-mirror/commit/dca4cc51ea0d0a6b9f321de8e7815ec5602b0593)\n\n**Reviewer:** John Cremona, Jean-Pierre Flori, Peter Bruin\n\n**Author:** Charles Bouillaguet\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/16276\n\n",
    "closed_at": "2014-05-19T12:53:21Z",
    "created_at": "2014-05-02T06:17:22Z",
    "labels": [
        "component: basic arithmetic",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.3",
    "title": "fixes PolynomialElement.mod()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16276",
    "user": "https://trac.sagemath.org/admin/accounts/users/Bouillaguet"
}
```
Before : 

```
           sage: R.<x> = PolynomialRing(ZZ)
            sage: f = x^3 + x + 1
            sage: f.mod(x + 1)
            x^3 + x + 1
```

After : 

```
           sage: R.<x> = PolynomialRing(ZZ)
            sage: f = x^3 + x + 1
            sage: f.mod(x + 1)
            -1
```


**Branch/Commit:** [dca4cc51ea0d0a6b9f321de8e7815ec5602b0593](https://github.com/sagemath/sagetrac-mirror/commit/dca4cc51ea0d0a6b9f321de8e7815ec5602b0593)

**Reviewer:** John Cremona, Jean-Pierre Flori, Peter Bruin

**Author:** Charles Bouillaguet

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/16276





---

archive/issue_comments_270794.json:
```json
{
    "body": "**Branch:** [u/Bouillaguet/ticket/16276](https://github.com/sagemath/sagetrac-mirror/tree/u/Bouillaguet/ticket/16276)",
    "created_at": "2014-05-02T06:23:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16276#issuecomment-270794",
    "user": "https://trac.sagemath.org/admin/accounts/users/Bouillaguet"
}
```

**Branch:** [u/Bouillaguet/ticket/16276](https://github.com/sagemath/sagetrac-mirror/tree/u/Bouillaguet/ticket/16276)



---

archive/issue_comments_270795.json:
```json
{
    "body": "**Commit:** [e48396c79625bb06a06e27552e2cce9ab8bb60e1](https://github.com/sagemath/sagetrac-mirror/commit/e48396c79625bb06a06e27552e2cce9ab8bb60e1)",
    "created_at": "2014-05-02T06:24:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16276#issuecomment-270795",
    "user": "https://trac.sagemath.org/admin/accounts/users/Bouillaguet"
}
```

**Commit:** [e48396c79625bb06a06e27552e2cce9ab8bb60e1](https://github.com/sagemath/sagetrac-mirror/commit/e48396c79625bb06a06e27552e2cce9ab8bb60e1)



---

archive/issue_comments_270796.json:
```json
{
    "body": "<a id='comment:2'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e48396c79625bb06a06e27552e2cce9ab8bb60e1\">e48396c</a></td><td><code>replace broken default PolynomialElement.mod() with already-present reasonable code</code></td></tr></table>\n",
    "created_at": "2014-05-02T06:24:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16276#issuecomment-270796",
    "user": "https://trac.sagemath.org/admin/accounts/users/Bouillaguet"
}
```

<a id='comment:2'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e48396c79625bb06a06e27552e2cce9ab8bb60e1">e48396c</a></td><td><code>replace broken default PolynomialElement.mod() with already-present reasonable code</code></td></tr></table>




---

archive/issue_comments_270797.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2014-05-02T06:24:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16276#issuecomment-270797",
    "user": "https://trac.sagemath.org/admin/accounts/users/Bouillaguet"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_270798.json:
```json
{
    "body": "<a id='comment:3'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/07221cbd32a822e7d4ba40762bcf843a10a6c715\">07221cb</a></td><td><code>fix corresponding doctest</code></td></tr></table>\n",
    "created_at": "2014-05-02T06:43:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16276#issuecomment-270798",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/07221cbd32a822e7d4ba40762bcf843a10a6c715">07221cb</a></td><td><code>fix corresponding doctest</code></td></tr></table>




---

archive/issue_comments_270799.json:
```json
{
    "body": "**Changing commit** from \"[e48396c79625bb06a06e27552e2cce9ab8bb60e1](https://github.com/sagemath/sagetrac-mirror/commit/e48396c79625bb06a06e27552e2cce9ab8bb60e1)\" to \"[07221cbd32a822e7d4ba40762bcf843a10a6c715](https://github.com/sagemath/sagetrac-mirror/commit/07221cbd32a822e7d4ba40762bcf843a10a6c715)\".",
    "created_at": "2014-05-02T06:43:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16276#issuecomment-270799",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[e48396c79625bb06a06e27552e2cce9ab8bb60e1](https://github.com/sagemath/sagetrac-mirror/commit/e48396c79625bb06a06e27552e2cce9ab8bb60e1)" to "[07221cbd32a822e7d4ba40762bcf843a10a6c715](https://github.com/sagemath/sagetrac-mirror/commit/07221cbd32a822e7d4ba40762bcf843a10a6c715)".



---

archive/issue_comments_270800.json:
```json
{
    "body": "<a id='comment:4'></a>\nQuestion:  are we 100% certain that every instance of the class which has this method does have a valid quo_rem method?  If not (and may even if so) it would be good to wrap the call to quo_rem in a try...except block with a failsafe default to just return self.",
    "created_at": "2014-05-02T09:08:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16276#issuecomment-270800",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:4'></a>
Question:  are we 100% certain that every instance of the class which has this method does have a valid quo_rem method?  If not (and may even if so) it would be good to wrap the call to quo_rem in a try...except block with a failsafe default to just return self.



---

archive/issue_comments_270801.json:
```json
{
    "body": "<a id='comment:5'></a>\nNo we are not. As you pointed out, in ZZ[X], quo_rem cannot work reliably in all cases. By design, it does \"something\" when b is not monic and does not divides a exactly (it tries to reduce \"as much as possible\").\n\nDo you think we should also patch quo_rem to return an `ArithmeticError` exception in this case where the result is not well-defined?",
    "created_at": "2014-05-02T09:44:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16276#issuecomment-270801",
    "user": "https://trac.sagemath.org/admin/accounts/users/Bouillaguet"
}
```

<a id='comment:5'></a>
No we are not. As you pointed out, in ZZ[X], quo_rem cannot work reliably in all cases. By design, it does "something" when b is not monic and does not divides a exactly (it tries to reduce "as much as possible").

Do you think we should also patch quo_rem to return an `ArithmeticError` exception in this case where the result is not well-defined?



---

archive/issue_comments_270802.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [cremona](#comment%3A4):\n> it would be good to wrap the call to quo_rem in a try...except block with a failsafe default to just return self.\n\n\nMy opinion is that it is better to raise an exception that to return mathematical nonsense (if only for \"pedagogical\" reasons)",
    "created_at": "2014-05-02T09:48:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16276#issuecomment-270802",
    "user": "https://trac.sagemath.org/admin/accounts/users/Bouillaguet"
}
```

<a id='comment:6'></a>
Replying to [cremona](#comment%3A4):
> it would be good to wrap the call to quo_rem in a try...except block with a failsafe default to just return self.


My opinion is that it is better to raise an exception that to return mathematical nonsense (if only for "pedagogical" reasons)



---

archive/issue_comments_270803.json:
```json
{
    "body": "<a id='comment:7'></a>\nNo, I don't think that would be helpful.  We agreed (I think) that for the reduction of `X^100 mod 2*X+1` in ZZ[X] there was no better result than leaving it as `X^100`, so would we really want to raise an error when someone types \n\n```\nsage: x = polygen(ZZ)\nsage: (x^100) % (2*x+1)\n```\ninstead of just returning\n\n```\nx^100\n```\nas happens now?  Even this\n\n```\nsage: x = polygen(QQ)\nsage: (x^100) % (2*x+1)\n1/1267650600228229401496703205376\n```\nwhile being quite valid mathematically, is slightly surprising...",
    "created_at": "2014-05-02T09:52:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16276#issuecomment-270803",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:7'></a>
No, I don't think that would be helpful.  We agreed (I think) that for the reduction of `X^100 mod 2*X+1` in ZZ[X] there was no better result than leaving it as `X^100`, so would we really want to raise an error when someone types 

```
sage: x = polygen(ZZ)
sage: (x^100) % (2*x+1)
```
instead of just returning

```
x^100
```
as happens now?  Even this

```
sage: x = polygen(QQ)
sage: (x^100) % (2*x+1)
1/1267650600228229401496703205376
```
while being quite valid mathematically, is slightly surprising...



---

archive/issue_comments_270804.json:
```json
{
    "body": "<a id='comment:8'></a>\nIt turns out that `quo_rem` does not always have the same specification (which seems bad in my opinion). Examples :\n\n```\nsage: R.<X> = ZZ[]\nsage: (2*X^2 + 3*X + 1).quo_rem(2*X + 1)\n(X + 1, 0)\n```\nSo, here, Sage \"silently\" performs a partial reduction.\n\n```\nsage: RR.<Y> = R[]\nRR.random_element().quo_rem((3*X+1)*Y + X + 2)\n---------------------------------------------------------------------------\nTraceback (most recent call last)\n...\nArithmeticError: Nonunit leading coefficient\n```\nAnd indeed, the \"generic polynomial\" quo_rem (as in src/sage/ring/polynomial/polynomial_element.pyx) advertises that an arithmetic exception shall be raised when a division by a non-monic polynomial is attempted).",
    "created_at": "2014-05-02T10:05:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16276#issuecomment-270804",
    "user": "https://trac.sagemath.org/admin/accounts/users/Bouillaguet"
}
```

<a id='comment:8'></a>
It turns out that `quo_rem` does not always have the same specification (which seems bad in my opinion). Examples :

```
sage: R.<X> = ZZ[]
sage: (2*X^2 + 3*X + 1).quo_rem(2*X + 1)
(X + 1, 0)
```
So, here, Sage "silently" performs a partial reduction.

```
sage: RR.<Y> = R[]
RR.random_element().quo_rem((3*X+1)*Y + X + 2)
---------------------------------------------------------------------------
Traceback (most recent call last)
...
ArithmeticError: Nonunit leading coefficient
```
And indeed, the "generic polynomial" quo_rem (as in src/sage/ring/polynomial/polynomial_element.pyx) advertises that an arithmetic exception shall be raised when a division by a non-monic polynomial is attempted).



---

archive/issue_comments_270805.json:
```json
{
    "body": "<a id='comment:9'></a>\nAs far as the current commit is concerned, I'd say a simple addition of\n\n```\n    mod = __mod__\n```\nwould do the trick rather than copying the `__mod__` function.\nOtherwise, as there is a `quo_rem`function defined, I would say we can rely on that, and let it raise an exception if it wants.\nNote that you can already issue:\n\n```\nf % g\n```\nand trigger the call to `quo_rem`.",
    "created_at": "2014-05-02T13:25:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16276#issuecomment-270805",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:9'></a>
As far as the current commit is concerned, I'd say a simple addition of

```
    mod = __mod__
```
would do the trick rather than copying the `__mod__` function.
Otherwise, as there is a `quo_rem`function defined, I would say we can rely on that, and let it raise an exception if it wants.
Note that you can already issue:

```
f % g
```
and trigger the call to `quo_rem`.



---

archive/issue_comments_270806.json:
```json
{
    "body": "**Changing commit** from \"[07221cbd32a822e7d4ba40762bcf843a10a6c715](https://github.com/sagemath/sagetrac-mirror/commit/07221cbd32a822e7d4ba40762bcf843a10a6c715)\" to \"[7e902de0445ec47ce835f3cb202b361793c621f5](https://github.com/sagemath/sagetrac-mirror/commit/7e902de0445ec47ce835f3cb202b361793c621f5)\".",
    "created_at": "2014-05-06T08:23:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16276#issuecomment-270806",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[07221cbd32a822e7d4ba40762bcf843a10a6c715](https://github.com/sagemath/sagetrac-mirror/commit/07221cbd32a822e7d4ba40762bcf843a10a6c715)" to "[7e902de0445ec47ce835f3cb202b361793c621f5](https://github.com/sagemath/sagetrac-mirror/commit/7e902de0445ec47ce835f3cb202b361793c621f5)".



---

archive/issue_comments_270807.json:
```json
{
    "body": "<a id='comment:10'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7e902de0445ec47ce835f3cb202b361793c621f5\">7e902de</a></td><td><code>avoid code duplication</code></td></tr></table>\n",
    "created_at": "2014-05-06T08:23:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16276#issuecomment-270807",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7e902de0445ec47ce835f3cb202b361793c621f5">7e902de</a></td><td><code>avoid code duplication</code></td></tr></table>




---

archive/issue_comments_270808.json:
```json
{
    "body": "<a id='comment:11'></a>\n`@`jpflori : I implemented your suggestion.",
    "created_at": "2014-05-06T08:26:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16276#issuecomment-270808",
    "user": "https://trac.sagemath.org/admin/accounts/users/Bouillaguet"
}
```

<a id='comment:11'></a>
`@`jpflori : I implemented your suggestion.



---

archive/issue_comments_270809.json:
```json
{
    "body": "<a id='comment:12'></a>\nGreat.\nI would be happy to close the ticket as is cos it's a first step toward something better.\nCompletely fixing pow, powmod, mod, quo_rem and so one looks like it needs more work and thoughts.\nJohn: would you mind taking this route?",
    "created_at": "2014-05-06T08:29:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16276#issuecomment-270809",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:12'></a>
Great.
I would be happy to close the ticket as is cos it's a first step toward something better.
Completely fixing pow, powmod, mod, quo_rem and so one looks like it needs more work and thoughts.
John: would you mind taking this route?



---

archive/issue_events_054601.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16276",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16276#event-54601"
}
```



---

archive/issue_comments_270810.json:
```json
{
    "body": "<a id='comment:14'></a>\nIs `mod = __mod__` the correct way to say that these two functions should behave identically?  If `C` is a subclass of `Polynomial` implementing `__mod__` but not `mod`, then `C.mod` will still be equal to `Polynomial.__mod__`, not to `C.__mod__`, if I'm not mistaken.\n\nThis is currently the case for `Polynomial_dense_modn_ntl_zz`, `Polynomial_dense_modn_ntl_ZZ` and `Polynomial_rational_flint`.  To automatically make `mod == __mod__` for these classes, I think `Polynomial.mod` would have to be defined as\n\n```\ndef mod(self, other):\n    return self.__mod__(other)\n```",
    "created_at": "2014-05-09T17:49:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16276#issuecomment-270810",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:14'></a>
Is `mod = __mod__` the correct way to say that these two functions should behave identically?  If `C` is a subclass of `Polynomial` implementing `__mod__` but not `mod`, then `C.mod` will still be equal to `Polynomial.__mod__`, not to `C.__mod__`, if I'm not mistaken.

This is currently the case for `Polynomial_dense_modn_ntl_zz`, `Polynomial_dense_modn_ntl_ZZ` and `Polynomial_rational_flint`.  To automatically make `mod == __mod__` for these classes, I think `Polynomial.mod` would have to be defined as

```
def mod(self, other):
    return self.__mod__(other)
```



---

archive/issue_comments_270811.json:
```json
{
    "body": "<a id='comment:15'></a>\nThanks Peter, you might be right, my comment was just a quick remark about code duplication.",
    "created_at": "2014-05-12T13:48:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16276#issuecomment-270811",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:15'></a>
Thanks Peter, you might be right, my comment was just a quick remark about code duplication.



---

archive/issue_comments_270812.json:
```json
{
    "body": "<a id='comment:16'></a>\nAnd I can confirm that just putting `mod = __mod__` gives the behavior you mention.",
    "created_at": "2014-05-12T15:02:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16276#issuecomment-270812",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:16'></a>
And I can confirm that just putting `mod = __mod__` gives the behavior you mention.



---

archive/issue_comments_270813.json:
```json
{
    "body": "<a id='comment:17'></a>\nDuly noted. I have made the change. I can't see how to avoid doctest duplication though.",
    "created_at": "2014-05-14T06:19:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16276#issuecomment-270813",
    "user": "https://trac.sagemath.org/admin/accounts/users/Bouillaguet"
}
```

<a id='comment:17'></a>
Duly noted. I have made the change. I can't see how to avoid doctest duplication though.



---

archive/issue_comments_270814.json:
```json
{
    "body": "**Changing commit** from \"[7e902de0445ec47ce835f3cb202b361793c621f5](https://github.com/sagemath/sagetrac-mirror/commit/7e902de0445ec47ce835f3cb202b361793c621f5)\" to \"[0061d17ca5e04465c1189d62aa032f98a0c120cf](https://github.com/sagemath/sagetrac-mirror/commit/0061d17ca5e04465c1189d62aa032f98a0c120cf)\".",
    "created_at": "2014-05-14T06:26:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16276#issuecomment-270814",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[7e902de0445ec47ce835f3cb202b361793c621f5](https://github.com/sagemath/sagetrac-mirror/commit/7e902de0445ec47ce835f3cb202b361793c621f5)" to "[0061d17ca5e04465c1189d62aa032f98a0c120cf](https://github.com/sagemath/sagetrac-mirror/commit/0061d17ca5e04465c1189d62aa032f98a0c120cf)".



---

archive/issue_comments_270815.json:
```json
{
    "body": "<a id='comment:18'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ff93a0a47a4524c14e301376972cb469e6fbb83f\">ff93a0a</a></td><td><code>Modify FLINT implementation of ZZ[X] so that quo_rem() match specification</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d64e7a32a5403e2e0ccd95e6c5f0d7b77257b83d\">d64e7a3</a></td><td><code>Correcting corresponding doctests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0061d17ca5e04465c1189d62aa032f98a0c120cf\">0061d17</a></td><td><code>too much code deduplication kills code semantics</code></td></tr></table>\n",
    "created_at": "2014-05-14T06:26:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16276#issuecomment-270815",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ff93a0a47a4524c14e301376972cb469e6fbb83f">ff93a0a</a></td><td><code>Modify FLINT implementation of ZZ[X] so that quo_rem() match specification</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d64e7a32a5403e2e0ccd95e6c5f0d7b77257b83d">d64e7a3</a></td><td><code>Correcting corresponding doctests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0061d17ca5e04465c1189d62aa032f98a0c120cf">0061d17</a></td><td><code>too much code deduplication kills code semantics</code></td></tr></table>




---

archive/issue_comments_270816.json:
```json
{
    "body": "<a id='comment:19'></a>\nI don't think the approach in commit ff93a0a (Modify FLINT implementation...) is the right one.  While **Z**[*x*] is not a Euclidean domain, it is undoubtedly useful for it to have a `quo_rem()` method that does as much as it can.  It is certainly more useful than raising an exception, in my opinion.\n\nIf I understand it correctly (I haven't read the code, only the doctests), the existing algorithm for `quo_rem(f, g)` effectively computes the Hermite normal form of the matrix whose columns (or rows, if you use the Sage convention) are the coefficient vectors of the polynomials `f` and `x^i * g` for `0 <= i <= deg f - deg g`.  One can do this more generally for *A*[*x*] with *A* a Euclidean domain.  This is quite well-defined mathematically, and reduces to the Euclidean algorithm in two interesting cases: either (1) the polynomials are constant, or (2) the base ring is a field.\n\nSo I think it would be better to change the documentation of `quo_rem()` to clarify what it actually does, and to keep the code unchanged.  Hopefully this can be done while also keeping `mod` and `__mod__` identical to each other and to the `rem` part of `quo_rem()`.",
    "created_at": "2014-05-14T08:42:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16276#issuecomment-270816",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:19'></a>
I don't think the approach in commit ff93a0a (Modify FLINT implementation...) is the right one.  While **Z**[*x*] is not a Euclidean domain, it is undoubtedly useful for it to have a `quo_rem()` method that does as much as it can.  It is certainly more useful than raising an exception, in my opinion.

If I understand it correctly (I haven't read the code, only the doctests), the existing algorithm for `quo_rem(f, g)` effectively computes the Hermite normal form of the matrix whose columns (or rows, if you use the Sage convention) are the coefficient vectors of the polynomials `f` and `x^i * g` for `0 <= i <= deg f - deg g`.  One can do this more generally for *A*[*x*] with *A* a Euclidean domain.  This is quite well-defined mathematically, and reduces to the Euclidean algorithm in two interesting cases: either (1) the polynomials are constant, or (2) the base ring is a field.

So I think it would be better to change the documentation of `quo_rem()` to clarify what it actually does, and to keep the code unchanged.  Hopefully this can be done while also keeping `mod` and `__mod__` identical to each other and to the `rem` part of `quo_rem()`.



---

archive/issue_comments_270817.json:
```json
{
    "body": "<a id='comment:20'></a>\nHi pbruin,\n\nI made a case for `quo_rem()` implementing **euclidean division** in https://groups.google.com/d/msg/sage-devel/UVrx5CG4qA0/WUz2RItJtF8J Nobody complained (and John approved).\n\nWhat you ask for can be obtained (as you suggested) by other means.\n\nNote that depending on the ring, and on the implementation, quo_rem does not do the same thing. For instance, the NTL implementation of ZZ[X] does what I ask for, but the FLINT implementation of ZZ[X] does what you requested. This situation calls for clarification.\n\nNote that `src/sage/structure/element.pyx` asks that `quo_rem()` and `mod()` implement euclidean division, or fail if the result is not mathematically defined... I think that this is fine (if anything, it may help students realize that the result is not defined !).",
    "created_at": "2014-05-15T13:03:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16276#issuecomment-270817",
    "user": "https://trac.sagemath.org/admin/accounts/users/Bouillaguet"
}
```

<a id='comment:20'></a>
Hi pbruin,

I made a case for `quo_rem()` implementing **euclidean division** in https://groups.google.com/d/msg/sage-devel/UVrx5CG4qA0/WUz2RItJtF8J Nobody complained (and John approved).

What you ask for can be obtained (as you suggested) by other means.

Note that depending on the ring, and on the implementation, quo_rem does not do the same thing. For instance, the NTL implementation of ZZ[X] does what I ask for, but the FLINT implementation of ZZ[X] does what you requested. This situation calls for clarification.

Note that `src/sage/structure/element.pyx` asks that `quo_rem()` and `mod()` implement euclidean division, or fail if the result is not mathematically defined... I think that this is fine (if anything, it may help students realize that the result is not defined !).



---

archive/issue_comments_270818.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [Bouillaguet](#comment%3A20):\n> I made a case for `quo_rem()` implementing **euclidean division** in https://groups.google.com/d/msg/sage-devel/UVrx5CG4qA0/WUz2RItJtF8J Nobody complained (and John approved).\n\n\nSorry, I did not closely follow the sage-devel discussion and only realised I didn't like this approach after seeing your patch.\n\nActually I interpreted John's[comment:7](#comment%3A7) as saying that he was against raising an error given that there is also a reasonable answer that we can return without raising an error.  Maybe he can clarify his opinion?\n\n> What you ask for can be obtained (as you suggested) by other means.\n\n\nWhat I'm most concerned about is that examples which used to work now raise an error.  For example, I think the following examples (of the FLINT implementation) are mathematically perfectly valid:\n\n```\nsage: R.<x> = ZZ[]\nsage: (x^100).quo_rem(2*x+1)\n(0, x^100)\nsage: (5*x+7).quo_rem(3)\n(x + 2, 2*x + 1)\n```\nIs there a simple way to obtain these results after your patch?\n\n> Note that depending on the ring, and on the implementation, quo_rem does not do the same thing. For instance, the NTL implementation of ZZ[X] does what I ask for, but the FLINT implementation of ZZ[X] does what you requested. This situation calls for clarification.\n\n\nYes, I agree that we should come up with a consistent approach.  I can see that **Z**[*x*] (in the FLINT implementation) and *K*[*t*][*x*] (for a field *K*) behave inconsistently and that this should be fixed.\n\nHowever, I also think one should think twice before choosing a solution that fails in more cases, rather than a solution that returns a result in more cases.\n\n> Note that `src/sage/structure/element.pyx` asks that `quo_rem()` and `mod()` implement euclidean division, or fail if the result is not mathematically defined... I think that this is fine (if anything, it may help students realize that the result is not defined !).\n\n\nI don't agree that the result is necessarily undefined; that depends on what definition you use.  FLINT in fact uses a definition of `quo_rem(f, g)` which is valid for all `f` and `g != 0` (the one I described), and with your patch we would simply refuse to return this answer in many cases.  (Note that the current version of the patch does not seem to conform to the documentation either: you check for the leading coefficient being 1 instead of any unit, and you don't raise an error if the remainder is 0.)\n\nI think that we should interpret the documentation as what it is, namely *documentation* (descriptive), not a *specification* (prescriptive).  In particular, it may be clarified/amended if necessary, and it should not force methods in derived classes to raise errors in all cases where the original method would raise an error.  In this particular case it should allow (not necessarily force) `quo_rem()` to use a more general algorithm if the base ring is a Euclidean domain that is not a field, e.g. if the polynomial ring is **Z**[*x*] (base ring **Z**) or *K*[*t*][*x*] (base ring *K*[*t*]).",
    "created_at": "2014-05-15T14:09:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16276#issuecomment-270818",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:21'></a>
Replying to [Bouillaguet](#comment%3A20):
> I made a case for `quo_rem()` implementing **euclidean division** in https://groups.google.com/d/msg/sage-devel/UVrx5CG4qA0/WUz2RItJtF8J Nobody complained (and John approved).


Sorry, I did not closely follow the sage-devel discussion and only realised I didn't like this approach after seeing your patch.

Actually I interpreted John's[comment:7](#comment%3A7) as saying that he was against raising an error given that there is also a reasonable answer that we can return without raising an error.  Maybe he can clarify his opinion?

> What you ask for can be obtained (as you suggested) by other means.


What I'm most concerned about is that examples which used to work now raise an error.  For example, I think the following examples (of the FLINT implementation) are mathematically perfectly valid:

```
sage: R.<x> = ZZ[]
sage: (x^100).quo_rem(2*x+1)
(0, x^100)
sage: (5*x+7).quo_rem(3)
(x + 2, 2*x + 1)
```
Is there a simple way to obtain these results after your patch?

> Note that depending on the ring, and on the implementation, quo_rem does not do the same thing. For instance, the NTL implementation of ZZ[X] does what I ask for, but the FLINT implementation of ZZ[X] does what you requested. This situation calls for clarification.


Yes, I agree that we should come up with a consistent approach.  I can see that **Z**[*x*] (in the FLINT implementation) and *K*[*t*][*x*] (for a field *K*) behave inconsistently and that this should be fixed.

However, I also think one should think twice before choosing a solution that fails in more cases, rather than a solution that returns a result in more cases.

> Note that `src/sage/structure/element.pyx` asks that `quo_rem()` and `mod()` implement euclidean division, or fail if the result is not mathematically defined... I think that this is fine (if anything, it may help students realize that the result is not defined !).


I don't agree that the result is necessarily undefined; that depends on what definition you use.  FLINT in fact uses a definition of `quo_rem(f, g)` which is valid for all `f` and `g != 0` (the one I described), and with your patch we would simply refuse to return this answer in many cases.  (Note that the current version of the patch does not seem to conform to the documentation either: you check for the leading coefficient being 1 instead of any unit, and you don't raise an error if the remainder is 0.)

I think that we should interpret the documentation as what it is, namely *documentation* (descriptive), not a *specification* (prescriptive).  In particular, it may be clarified/amended if necessary, and it should not force methods in derived classes to raise errors in all cases where the original method would raise an error.  In this particular case it should allow (not necessarily force) `quo_rem()` to use a more general algorithm if the base ring is a Euclidean domain that is not a field, e.g. if the polynomial ring is **Z**[*x*] (base ring **Z**) or *K*[*t*][*x*] (base ring *K*[*t*]).



---

archive/issue_comments_270819.json:
```json
{
    "body": "<a id='comment:22'></a>\nI'm not sure which John is which,a nd I cannot remember exactly what I said before.  However:  please let us not raise errors in quo_rem unless there is something really invalid in the input such as quotient by 0!  If there is nothing else available having q=0 and r = dividend is surely better.  And as Peter says, we swrite the documentation afterwards.",
    "created_at": "2014-05-15T14:43:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16276#issuecomment-270819",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:22'></a>
I'm not sure which John is which,a nd I cannot remember exactly what I said before.  However:  please let us not raise errors in quo_rem unless there is something really invalid in the input such as quotient by 0!  If there is nothing else available having q=0 and r = dividend is surely better.  And as Peter says, we swrite the documentation afterwards.



---

archive/issue_comments_270820.json:
```json
{
    "body": "<a id='comment:23'></a>\nHi all,\n\nIn fact, most of my rant comes of out of the following: the name \"quo_rem\" strongly suggests euclidean division (at least for me). In particular, the QUOtient bit. Because of how the system works, the `quo_rem()` method is also available on non-euclidean rings, where euclidean division does not make sense (but where exact division sometimes make sense, e.g. over integral domains).\n\nI thought that the \"remainder\" (which makes sense mathematically as everyone agrees) could be obtained by :\n\n```\nsage: R.<x> = ZZ[]\nsage: Ideal(2*x+1).reduce(x^100)\nx^100\n```\n(and given the remainder, the \"quotient\" part could be obtained by exact division).\n\nBut it turns out that this is not always the case:\n\n```\nsage: Ideal(3).reduce(5*x+7)\nTraceback (most recent call last)\n...\nTypeError: not a constant polynomial\n\nsage: Ideal(R(3)).reduce(5*x+7)\n5*x + 7  # <--- not what you want, and probably incorrect?\n```\n\nThis is yet another inconsistency.\n\nLastly, let me mention that the NTL implementation of ZZ[X] already does what I thought was right (git blame tells dmharvey wrote it):\n\n```\nR.<x> = PolynomialRing(ZZ, implementation=\"NTL\")\nsage: sage: (x^100).quo_rem(2*x+1)\nTraceback (most recent call last)\n...\nArithmeticError: division not exact in Z[x] (consider coercing to Q[x] first)\n```\nThis is actually where I copied-pasted the error message (and some of the code I think).\n\nAnyway, I don't want to put up a fight about this. I don't care. I will thus retract the modifications to FLINT's polynomial (which will remain inconsistent with NTL). The fix to the \"mod\" method should still be accepted by everyone though.",
    "created_at": "2014-05-15T18:02:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16276#issuecomment-270820",
    "user": "https://trac.sagemath.org/admin/accounts/users/Bouillaguet"
}
```

<a id='comment:23'></a>
Hi all,

In fact, most of my rant comes of out of the following: the name "quo_rem" strongly suggests euclidean division (at least for me). In particular, the QUOtient bit. Because of how the system works, the `quo_rem()` method is also available on non-euclidean rings, where euclidean division does not make sense (but where exact division sometimes make sense, e.g. over integral domains).

I thought that the "remainder" (which makes sense mathematically as everyone agrees) could be obtained by :

```
sage: R.<x> = ZZ[]
sage: Ideal(2*x+1).reduce(x^100)
x^100
```
(and given the remainder, the "quotient" part could be obtained by exact division).

But it turns out that this is not always the case:

```
sage: Ideal(3).reduce(5*x+7)
Traceback (most recent call last)
...
TypeError: not a constant polynomial

sage: Ideal(R(3)).reduce(5*x+7)
5*x + 7  # <--- not what you want, and probably incorrect?
```

This is yet another inconsistency.

Lastly, let me mention that the NTL implementation of ZZ[X] already does what I thought was right (git blame tells dmharvey wrote it):

```
R.<x> = PolynomialRing(ZZ, implementation="NTL")
sage: sage: (x^100).quo_rem(2*x+1)
Traceback (most recent call last)
...
ArithmeticError: division not exact in Z[x] (consider coercing to Q[x] first)
```
This is actually where I copied-pasted the error message (and some of the code I think).

Anyway, I don't want to put up a fight about this. I don't care. I will thus retract the modifications to FLINT's polynomial (which will remain inconsistent with NTL). The fix to the "mod" method should still be accepted by everyone though.



---

archive/issue_comments_270821.json:
```json
{
    "body": "<a id='comment:24'></a>\nI also suggest to close this one to get `mod` fixed and open a follow up ticket to unify `quo_rem` behavior.",
    "created_at": "2014-05-15T18:17:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16276#issuecomment-270821",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:24'></a>
I also suggest to close this one to get `mod` fixed and open a follow up ticket to unify `quo_rem` behavior.



---

archive/issue_comments_270822.json:
```json
{
    "body": "<a id='comment:25'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dca4cc51ea0d0a6b9f321de8e7815ec5602b0593\">dca4cc5</a></td><td><code>revert non-consensual modification to quo_rem() for FLINT's implementation of ZZ[X]</code></td></tr></table>\n",
    "created_at": "2014-05-15T18:50:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16276#issuecomment-270822",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dca4cc51ea0d0a6b9f321de8e7815ec5602b0593">dca4cc5</a></td><td><code>revert non-consensual modification to quo_rem() for FLINT's implementation of ZZ[X]</code></td></tr></table>




---

archive/issue_comments_270823.json:
```json
{
    "body": "**Changing commit** from \"[0061d17ca5e04465c1189d62aa032f98a0c120cf](https://github.com/sagemath/sagetrac-mirror/commit/0061d17ca5e04465c1189d62aa032f98a0c120cf)\" to \"[dca4cc51ea0d0a6b9f321de8e7815ec5602b0593](https://github.com/sagemath/sagetrac-mirror/commit/dca4cc51ea0d0a6b9f321de8e7815ec5602b0593)\".",
    "created_at": "2014-05-15T18:50:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16276#issuecomment-270823",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[0061d17ca5e04465c1189d62aa032f98a0c120cf](https://github.com/sagemath/sagetrac-mirror/commit/0061d17ca5e04465c1189d62aa032f98a0c120cf)" to "[dca4cc51ea0d0a6b9f321de8e7815ec5602b0593](https://github.com/sagemath/sagetrac-mirror/commit/dca4cc51ea0d0a6b9f321de8e7815ec5602b0593)".



---

archive/issue_comments_270824.json:
```json
{
    "body": "<a id='comment:26'></a>\nThat should do it",
    "created_at": "2014-05-15T18:51:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16276#issuecomment-270824",
    "user": "https://trac.sagemath.org/admin/accounts/users/Bouillaguet"
}
```

<a id='comment:26'></a>
That should do it



---

archive/issue_comments_270825.json:
```json
{
    "body": "**Reviewer:** John Cremona, Jean-Pierre Flori, Peter Bruin",
    "created_at": "2014-05-15T19:06:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16276#issuecomment-270825",
    "user": "https://github.com/pjbruin"
}
```

**Reviewer:** John Cremona, Jean-Pierre Flori, Peter Bruin



---

archive/issue_comments_270826.json:
```json
{
    "body": "<a id='comment:27'></a>\nThanks!  I think we all agree that this neatly solves the original problem.  The patchbot doesn't seem to have tested the current state of affairs yet; now running doctests.",
    "created_at": "2014-05-15T19:06:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16276#issuecomment-270826",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:27'></a>
Thanks!  I think we all agree that this neatly solves the original problem.  The patchbot doesn't seem to have tested the current state of affairs yet; now running doctests.



---

archive/issue_comments_270827.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2014-05-15T19:37:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16276#issuecomment-270827",
    "user": "https://github.com/pjbruin"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_270828.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2014-05-19T12:53:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16276#issuecomment-270828",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** fixed



---

archive/issue_events_054602.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-05-19T12:53:21Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16276",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16276#event-54602"
}
```



---

archive/issue_comments_270829.json:
```json
{
    "body": "**Changing branch** from \"[u/Bouillaguet/ticket/16276](https://github.com/sagemath/sagetrac-mirror/tree/u/Bouillaguet/ticket/16276)\" to \"[dca4cc51ea0d0a6b9f321de8e7815ec5602b0593](https://github.com/sagemath/sagetrac-mirror/commit/dca4cc51ea0d0a6b9f321de8e7815ec5602b0593)\".",
    "created_at": "2014-05-19T12:53:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16276",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16276#issuecomment-270829",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/Bouillaguet/ticket/16276](https://github.com/sagemath/sagetrac-mirror/tree/u/Bouillaguet/ticket/16276)" to "[dca4cc51ea0d0a6b9f321de8e7815ec5602b0593](https://github.com/sagemath/sagetrac-mirror/commit/dca4cc51ea0d0a6b9f321de8e7815ec5602b0593)".
