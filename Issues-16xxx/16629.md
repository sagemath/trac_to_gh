# Issue 16629: Improve sage-fix-pkg-checksums

archive/issues_016392.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\nThe current version of `sage-fix-pkg-checksums` incorrectly sets the package version to the **literal** `\"VERSION\"` in `checksums.ini`, which is confusing and not helpful.\n\nThis patch correcly computes the version string and puts it at the right place in `checksums.ini`.\n\nComponent: **build**\n\nBranch/Commit: **[u/charpent/sage_fix_pkg_checksums_munches_build_pkgs__packagename__checksums](https://github.com/sagemath/sagetrac-mirror/tree/u/charpent/sage_fix_pkg_checksums_munches_build_pkgs__packagename__checksums) @ [`a046905`](https://github.com/sagemath/sagetrac-mirror/commit/a0469055a4f293df53e6f6ae42ac9dc0e761f7c8)**\n\nReviewer: **Emmanuel Charpentier, Volker Braun, J. H. Palmieri, Jeroen Demeyer**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/16629_\n\n",
    "closed_at": "2015-04-23T01:43:56Z",
    "created_at": "2014-07-08T21:12:58Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/c%3A%20build",
        "https://github.com/sagemath/sage/labels/wontfix"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Improve sage-fix-pkg-checksums",
    "type": "issue",
    "updated_at": "2015-04-23T01:43:56Z",
    "url": "https://github.com/sagemath/sage/issues/16629",
    "user": "https://github.com/EmmanuelCharpentier"
}
```
<div id="comment:0"></div>

The current version of `sage-fix-pkg-checksums` incorrectly sets the package version to the **literal** `"VERSION"` in `checksums.ini`, which is confusing and not helpful.

This patch correcly computes the version string and puts it at the right place in `checksums.ini`.

Component: **build**

Branch/Commit: **[u/charpent/sage_fix_pkg_checksums_munches_build_pkgs__packagename__checksums](https://github.com/sagemath/sagetrac-mirror/tree/u/charpent/sage_fix_pkg_checksums_munches_build_pkgs__packagename__checksums) @ [`a046905`](https://github.com/sagemath/sagetrac-mirror/commit/a0469055a4f293df53e6f6ae42ac9dc0e761f7c8)**

Reviewer: **Emmanuel Charpentier, Volker Braun, J. H. Palmieri, Jeroen Demeyer**

_Issue created by migration from https://trac.sagemath.org/ticket/16629_





---

archive/issue_events_235565.json:
```json
{
    "actor": "https://github.com/EmmanuelCharpentier",
    "created_at": "2014-07-08T21:12:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16629#event-235565"
}
```



---

archive/issue_events_235566.json:
```json
{
    "actor": "https://github.com/EmmanuelCharpentier",
    "created_at": "2014-07-08T21:12:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "0000b0",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16629#event-235566"
}
```



---

archive/issue_events_235567.json:
```json
{
    "actor": "https://github.com/EmmanuelCharpentier",
    "created_at": "2014-07-08T21:12:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
    "label_color": "ffe799",
    "label_name": "p: minor / 4",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16629#event-235567"
}
```



---

archive/issue_events_235568.json:
```json
{
    "actor": "https://github.com/EmmanuelCharpentier",
    "created_at": "2014-07-08T21:12:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16629#event-235568"
}
```



---

archive/issue_comments_216750.json:
```json
{
    "body": "Branch: **[u/charpent/sage_fix_pkg_checksums_munches_build_pkgs__packagename__checksums](https://github.com/sagemath/sagetrac-mirror/tree/u/charpent/sage_fix_pkg_checksums_munches_build_pkgs__packagename__checksums)**",
    "created_at": "2014-07-08T21:38:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16629#issuecomment-216750",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

Branch: **[u/charpent/sage_fix_pkg_checksums_munches_build_pkgs__packagename__checksums](https://github.com/sagemath/sagetrac-mirror/tree/u/charpent/sage_fix_pkg_checksums_munches_build_pkgs__packagename__checksums)**



---

archive/issue_comments_216751.json:
```json
{
    "body": "Commit: **[`b607718`](https://github.com/sagemath/sagetrac-mirror/commit/b607718bd7be120232547f34549750d557e35c4c)**",
    "created_at": "2014-07-08T21:40:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16629#issuecomment-216751",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

Commit: **[`b607718`](https://github.com/sagemath/sagetrac-mirror/commit/b607718bd7be120232547f34549750d557e35c4c)**



---

archive/issue_comments_216752.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nThe proposed solution needs to be reviewed by someone more knowledgeable in the sage building system than I am.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/08c39b27e2c68272a75ab1f98f0316e4bbeac5ce\"><code>08c39b2</code></a></td><td><code>Point d'\u00e9tape avant test.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b607718bd7be120232547f34549750d557e35c4c\"><code>b607718</code></a></td><td><code>Fixed package checksums munching by /src/bin/sage-fix-pkg-checksums</code></td></tr></table>\n",
    "created_at": "2014-07-08T21:40:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16629#issuecomment-216752",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<div id="comment:2" align="right">comment:2</div>

The proposed solution needs to be reviewed by someone more knowledgeable in the sage building system than I am.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/08c39b27e2c68272a75ab1f98f0316e4bbeac5ce"><code>08c39b2</code></a></td><td><code>Point d'étape avant test.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b607718bd7be120232547f34549750d557e35c4c"><code>b607718</code></a></td><td><code>Fixed package checksums munching by /src/bin/sage-fix-pkg-checksums</code></td></tr></table>




---

archive/issue_events_235569.json:
```json
{
    "actor": "https://github.com/EmmanuelCharpentier",
    "created_at": "2014-07-08T21:40:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16629#event-235569"
}
```



---

archive/issue_comments_216753.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nFrench commit messages are verboten ;-)",
    "created_at": "2014-07-08T22:16:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16629#issuecomment-216753",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:3" align="right">comment:3</div>

French commit messages are verboten ;-)



---

archive/issue_comments_216754.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nHmm \"fubar\"?\n\nHaving old tarballs in upstream/ is normal and shouldn't lead to endless warnings.\n\nIMHO there shouldn't be any warnings, anything that is not correct ought to be a hard error. If we aren't strict about it we are bound to get track tickets with invalid checksums.ini.",
    "created_at": "2014-07-08T22:29:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16629#issuecomment-216754",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:4" align="right">comment:4</div>

Hmm "fubar"?

Having old tarballs in upstream/ is normal and shouldn't lead to endless warnings.

IMHO there shouldn't be any warnings, anything that is not correct ought to be a hard error. If we aren't strict about it we are bound to get track tickets with invalid checksums.ini.



---

archive/issue_events_235570.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-07-08T22:29:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16629#event-235570"
}
```



---

archive/issue_events_235571.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-07-08T22:29:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16629#event-235571"
}
```



---

archive/issue_comments_216755.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nReplying to [@vbraun](#comment%3A4):\n> Hmm \"fubar\"?\n\nWups. Oversight. Fixed...\n\n> Having old tarballs in upstream/ is normal and shouldn't lead to endless warnings.\n\nWhat do you mean ? \n\n> IMHO there shouldn't be any warnings, anything that is not correct ought to be a hard error. If we aren't strict about it we are bound to get track tickets with invalid checksums.ini.\n\nFix underway : orders rather than suggestions.",
    "created_at": "2014-07-08T22:48:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16629#issuecomment-216755",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<div id="comment:5" align="right">comment:5</div>

Replying to [@vbraun](#comment%3A4):
> Hmm "fubar"?

Wups. Oversight. Fixed...

> Having old tarballs in upstream/ is normal and shouldn't lead to endless warnings.

What do you mean ? 

> IMHO there shouldn't be any warnings, anything that is not correct ought to be a hard error. If we aren't strict about it we are bound to get track tickets with invalid checksums.ini.

Fix underway : orders rather than suggestions.



---

archive/issue_comments_216756.json:
```json
{
    "body": "Changed commit from **[`b607718`](https://github.com/sagemath/sagetrac-mirror/commit/b607718bd7be120232547f34549750d557e35c4c)** to **[`d941afd`](https://github.com/sagemath/sagetrac-mirror/commit/d941afd9150164e979b7df98b2e574cdacd78053)**",
    "created_at": "2014-07-08T22:54:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16629#issuecomment-216756",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b607718`](https://github.com/sagemath/sagetrac-mirror/commit/b607718bd7be120232547f34549750d557e35c4c)** to **[`d941afd`](https://github.com/sagemath/sagetrac-mirror/commit/d941afd9150164e979b7df98b2e574cdacd78053)**



---

archive/issue_comments_216757.json:
```json
{
    "body": "<div id=\"comment:6\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d941afd9150164e979b7df98b2e574cdacd78053\"><code>d941afd</code></a></td><td><code>All discrepancies ==> error and abort (+ cleanup of oversight).</code></td></tr></table>\n",
    "created_at": "2014-07-08T22:54:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16629#issuecomment-216757",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:6"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d941afd9150164e979b7df98b2e574cdacd78053"><code>d941afd</code></a></td><td><code>All discrepancies ==> error and abort (+ cleanup of oversight).</code></td></tr></table>




---

archive/issue_comments_216758.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\n\"Tous vos ordres, Seigneur, seront ex\u00e9cut\u00e9s\" (Jean Racine) [ Hey, it's not a commit message... ]\n\nFollowed Volker's suggestions.",
    "created_at": "2014-07-08T22:57:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16629#issuecomment-216758",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<div id="comment:7" align="right">comment:7</div>

"Tous vos ordres, Seigneur, seront exécutés" (Jean Racine) [ Hey, it's not a commit message... ]

Followed Volker's suggestions.



---

archive/issue_events_235572.json:
```json
{
    "actor": "https://github.com/EmmanuelCharpentier",
    "created_at": "2014-07-08T22:57:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16629#event-235572"
}
```



---

archive/issue_events_235573.json:
```json
{
    "actor": "https://github.com/EmmanuelCharpentier",
    "created_at": "2014-07-08T22:57:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16629#event-235573"
}
```



---

archive/issue_comments_216759.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nI've got various tarball versions of most packages. I don't want to delete them because I might want to go back to an older ticket. Yet I get: \n\n```\n(sage-sh) vbraun@localhost:upstream$ sage-fix-pkg-checksums \natlas-3.10.1.20140128.tar.bz2\nVersion mismatch between tarball 3.10.1.20140128 and directory build/pkgs/atlas.\nNewer version ? You must put 3.10.1.20140128.p0 in package-version.txt.\n```",
    "created_at": "2014-07-12T00:23:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16629#issuecomment-216759",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:8" align="right">comment:8</div>

I've got various tarball versions of most packages. I don't want to delete them because I might want to go back to an older ticket. Yet I get: 

```
(sage-sh) vbraun@localhost:upstream$ sage-fix-pkg-checksums 
atlas-3.10.1.20140128.tar.bz2
Version mismatch between tarball 3.10.1.20140128 and directory build/pkgs/atlas.
Newer version ? You must put 3.10.1.20140128.p0 in package-version.txt.
```



---

archive/issue_comments_216760.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@vbraun](#comment%3A8):\n> I've got various tarball versions of most packages. I don't want to delete them because I might want to go back to an older ticket. Yet I get: \n> \n> ```\n> (sage-sh) vbraun@localhost:upstream$ sage-fix-pkg-checksums \n> atlas-3.10.1.20140128.tar.bz2\n> Version mismatch between tarball 3.10.1.20140128 and directory build/pkgs/atlas.\n> Newer version ? You must put 3.10.1.20140128.p0 in package-version.txt.\n> ```\n\nHmmm... Now we have a conflict on intended usage(s) (and therefore designs) :\n* The `builg/pkgs/<pkgname>/...` structure implies at most one version per package name.\n* The relevant snippet of the [Developer's guide](http://www.sagemath.org/doc/developer/packaging.html#checksums) hints at a \"batch\" usage of `src/bin/sage-fix-pkg-checksums.`\nSo far, that's consistent with `upstream/` as **the** set of active (i. e. built by Sage's build system) Sage's external packages source tarballs.\n* Your intended usage amounts to use `upstream/` as **a** cache of potential external packages, the set of **active** Sage external packages being determined otherwise.\n    a. This might be the `build/pkgs/*/package-version.txt` set, in which case the `sage-fix-pkg-checksums` script should loop over this set and try to find a relevant tarball. At most, it might spit a warning (or fail) when no such tarball exists. No automatic rewriting possible.\n    b. It might be an external file listing each package and the relevant version. That makes `build/pkgs/<pkgname>/package-version.txt` redundant (and a possible source of conflicts).\nThe case 1. is consistent, but needs a script like `sage-fix-one-pkg-checksum-Volkers-style` to generate the right checksums. As said before, the current batch-style script should loop on the `build/pkgs/...` tree.\n\nIn any case, it appears that the consistency of the proposed change (use `upstream/` as a cache and not as a reference set) needs modifying the use of this script (and, quite possibly, the rest of the build subsystem for external packages). Since I do not yet know my way in this system, fixing this is, for now, out of my reach. At a minimum, I need advice from someone knowing what it does.\n\nBy the way, what is wrong with an external (`.gitignore`d) directory and `mv` ing the right tarball at the right time ? An even lazier solution is, of course, to symlink the right tarball in `upstream/`, but I doubt one can get `git` to follow this transparently.\n\nSince we are playing redesigning this subsystem, may I ask why we have to have `package-version.txt` and `checksums.ini` to describe different attributes of the same tarball ? Why not one file ?",
    "created_at": "2014-07-12T01:35:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16629#issuecomment-216760",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@vbraun](#comment%3A8):
> I've got various tarball versions of most packages. I don't want to delete them because I might want to go back to an older ticket. Yet I get: 
> 
> ```
> (sage-sh) vbraun@localhost:upstream$ sage-fix-pkg-checksums 
> atlas-3.10.1.20140128.tar.bz2
> Version mismatch between tarball 3.10.1.20140128 and directory build/pkgs/atlas.
> Newer version ? You must put 3.10.1.20140128.p0 in package-version.txt.
> ```

Hmmm... Now we have a conflict on intended usage(s) (and therefore designs) :
* The `builg/pkgs/<pkgname>/...` structure implies at most one version per package name.
* The relevant snippet of the [Developer's guide](http://www.sagemath.org/doc/developer/packaging.html#checksums) hints at a "batch" usage of `src/bin/sage-fix-pkg-checksums.`
So far, that's consistent with `upstream/` as **the** set of active (i. e. built by Sage's build system) Sage's external packages source tarballs.
* Your intended usage amounts to use `upstream/` as **a** cache of potential external packages, the set of **active** Sage external packages being determined otherwise.
    a. This might be the `build/pkgs/*/package-version.txt` set, in which case the `sage-fix-pkg-checksums` script should loop over this set and try to find a relevant tarball. At most, it might spit a warning (or fail) when no such tarball exists. No automatic rewriting possible.
    b. It might be an external file listing each package and the relevant version. That makes `build/pkgs/<pkgname>/package-version.txt` redundant (and a possible source of conflicts).
The case 1. is consistent, but needs a script like `sage-fix-one-pkg-checksum-Volkers-style` to generate the right checksums. As said before, the current batch-style script should loop on the `build/pkgs/...` tree.

In any case, it appears that the consistency of the proposed change (use `upstream/` as a cache and not as a reference set) needs modifying the use of this script (and, quite possibly, the rest of the build subsystem for external packages). Since I do not yet know my way in this system, fixing this is, for now, out of my reach. At a minimum, I need advice from someone knowing what it does.

By the way, what is wrong with an external (`.gitignore`d) directory and `mv` ing the right tarball at the right time ? An even lazier solution is, of course, to symlink the right tarball in `upstream/`, but I doubt one can get `git` to follow this transparently.

Since we are playing redesigning this subsystem, may I ask why we have to have `package-version.txt` and `checksums.ini` to describe different attributes of the same tarball ? Why not one file ?



---

archive/issue_comments_216761.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nThe upstream/ directory has always been meant as a cache where possibly multiple versions of tarballs are stored, potentially even shared between different sage installations. This is also how the sage-fix-pkg-checksums script works right now, it looks for a tarball matching `build/pkgs/*/package-version.txt` and ignores the rest.\n\nThe split package-version.txt and checksums.ini is to make reading the version easier from scripts. I didn't vote for it...",
    "created_at": "2014-07-12T01:39:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16629#issuecomment-216761",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:10" align="right">comment:10</div>

The upstream/ directory has always been meant as a cache where possibly multiple versions of tarballs are stored, potentially even shared between different sage installations. This is also how the sage-fix-pkg-checksums script works right now, it looks for a tarball matching `build/pkgs/*/package-version.txt` and ignores the rest.

The split package-version.txt and checksums.ini is to make reading the version easier from scripts. I didn't vote for it...



---

archive/issue_comments_216762.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@vbraun](#comment%3A8) with a bit of \"esprit de l'escalier\"...:\n> I've got various tarball versions of most packages. I don't want to delete them because I might want to go back to an older ticket. \n\nDifferent branches, I suppose ? If so, why not let `git` track the change of tarball ?\n\n> Yet I get: \n> \n> ```\n> (sage-sh) vbraun@localhost:upstream$ sage-fix-pkg-checksums \n> atlas-3.10.1.20140128.tar.bz2\n> Version mismatch between tarball 3.10.1.20140128 and directory build/pkgs/atlas.\n> Newer version ? You must put 3.10.1.20140128.p0 in package-version.txt.\n> ```",
    "created_at": "2014-07-12T01:48:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16629#issuecomment-216762",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@vbraun](#comment%3A8) with a bit of "esprit de l'escalier"...:
> I've got various tarball versions of most packages. I don't want to delete them because I might want to go back to an older ticket. 

Different branches, I suppose ? If so, why not let `git` track the change of tarball ?

> Yet I get: 
> 
> ```
> (sage-sh) vbraun@localhost:upstream$ sage-fix-pkg-checksums 
> atlas-3.10.1.20140128.tar.bz2
> Version mismatch between tarball 3.10.1.20140128 and directory build/pkgs/atlas.
> Newer version ? You must put 3.10.1.20140128.p0 in package-version.txt.
> ```



---

archive/issue_comments_216763.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nI think I'm not clear, so let me try again. Git **does** track the package version, because `package-version.txt` is checked into the repository. For any given Sage commit, `build/pkgs/*/package-version.txt` is the only relevant set of tarball versions. The upstream/ directory content is irrelevant, and only used to cache downloaded tarballs.",
    "created_at": "2014-07-12T03:19:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16629#issuecomment-216763",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:12" align="right">comment:12</div>

I think I'm not clear, so let me try again. Git **does** track the package version, because `package-version.txt` is checked into the repository. For any given Sage commit, `build/pkgs/*/package-version.txt` is the only relevant set of tarball versions. The upstream/ directory content is irrelevant, and only used to cache downloaded tarballs.



---

archive/issue_comments_216764.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nI agree with Volker that nothing in `upstream` should be tracked; we should be free to have tarballs for many versions of each package there. I mean, it might be nice to have a script which cleaned this directory up, deleting all out of date versions, but that would be (1) a very low priority (since you can just delete the whole directory if you have a good internet connection) and (2) for another ticket.",
    "created_at": "2014-07-12T03:58:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16629#issuecomment-216764",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:13" align="right">comment:13</div>

I agree with Volker that nothing in `upstream` should be tracked; we should be free to have tarballs for many versions of each package there. I mean, it might be nice to have a script which cleaned this directory up, deleting all out of date versions, but that would be (1) a very low priority (since you can just delete the whole directory if you have a good internet connection) and (2) for another ticket.



---

archive/issue_comments_216765.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@vbraun](#comment%3A10):\n> ... it looks for a tarball matching `build/pkgs/*/package-version.txt` and ignores the rest.\n\nMinus the patchlevel, to be exact.",
    "created_at": "2014-07-12T07:12:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16629#issuecomment-216765",
    "user": "https://github.com/rwst"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@vbraun](#comment%3A10):
> ... it looks for a tarball matching `build/pkgs/*/package-version.txt` and ignores the rest.

Minus the patchlevel, to be exact.



---

archive/issue_comments_216766.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@vbraun](#comment%3A12):\n> I think I'm not clear, so let me try again. Git **does** track the package version, because `package-version.txt` is checked into the repository. For any given Sage commit, `build/pkgs/*/package-version.txt` is the only relevant set of tarball versions. The upstream/ directory content is irrelevant, and only used to cache downloaded tarballs.\n> \n\nI beg to differ : From the current `sage-fix-pkg-checksum`, (as in the `develop` branch) :\n\n```\n#!/usr/bin/env bash\n\n# If any command-line arguments are present, treat them as files to be\n# checksummed. If no arguments are present, all tarballs in\n# $SAGE_ROOT/upstream are checksummed.\nif [ $# -eq 0 ]; then\n    cd \"$SAGE_ROOT\"\n    set upstream/*.tar*\nfi\n```\n\nIn other words, the current version is driven by the content of `upstream/` if no argument is given. If an (some) argument(s) is|are given, it uses the beginning of each argument up to the first dash as a package name and whatever follows `tar` in this argument as the compression method. Therefore, this will produce the expected behaviour IF AND ONLY IF the script is passed tarball filenames.\n\nIt will also produce the expected result if given arguments **containing the package version**. But not with arguments containing the package name only : there is no information available to choose which version is to be documented in `build/pkgs/<pkgname>/package-version.txt|checksums.ini`.\n\nA simple fix is to ignore package version mismatchs (i. e. removing the error message an the abort). In this case, the tarball ultimately documented in `build/pkgs/<pkgname>/checksums.ini` will be the one passed in argument, or the last matching the package name in the `upstream/` file list (lexicographic order).\n\nAnother possibility is to use `build/pkgs` ad the corresponding `package-version.txt` to get the necessary information, and search `upstream/` for a relevant tarball. In this case, one might find one tarball (and process it as before), none (one type of error) or more than one (another type of error).\n\nWhich one do you want ?",
    "created_at": "2014-07-12T08:15:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16629#issuecomment-216766",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@vbraun](#comment%3A12):
> I think I'm not clear, so let me try again. Git **does** track the package version, because `package-version.txt` is checked into the repository. For any given Sage commit, `build/pkgs/*/package-version.txt` is the only relevant set of tarball versions. The upstream/ directory content is irrelevant, and only used to cache downloaded tarballs.
> 

I beg to differ : From the current `sage-fix-pkg-checksum`, (as in the `develop` branch) :

```
#!/usr/bin/env bash

# If any command-line arguments are present, treat them as files to be
# checksummed. If no arguments are present, all tarballs in
# $SAGE_ROOT/upstream are checksummed.
if [ $# -eq 0 ]; then
    cd "$SAGE_ROOT"
    set upstream/*.tar*
fi
```

In other words, the current version is driven by the content of `upstream/` if no argument is given. If an (some) argument(s) is|are given, it uses the beginning of each argument up to the first dash as a package name and whatever follows `tar` in this argument as the compression method. Therefore, this will produce the expected behaviour IF AND ONLY IF the script is passed tarball filenames.

It will also produce the expected result if given arguments **containing the package version**. But not with arguments containing the package name only : there is no information available to choose which version is to be documented in `build/pkgs/<pkgname>/package-version.txt|checksums.ini`.

A simple fix is to ignore package version mismatchs (i. e. removing the error message an the abort). In this case, the tarball ultimately documented in `build/pkgs/<pkgname>/checksums.ini` will be the one passed in argument, or the last matching the package name in the `upstream/` file list (lexicographic order).

Another possibility is to use `build/pkgs` ad the corresponding `package-version.txt` to get the necessary information, and search `upstream/` for a relevant tarball. In this case, one might find one tarball (and process it as before), none (one type of error) or more than one (another type of error).

Which one do you want ?



---

archive/issue_comments_216767.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@rwst](#comment%3A14):\n> Minus the patchlevel, to be exact. \n\nExactly, which is another reason for why the `package-version.txt` is the authorative version. Also, the Sage build process uses the `package-version.txt` timestamp to determine whether a package needs to be rebuilt, which is why you need to add the patch level here.\n\nThe `sage-fix-pkg-checksum` iterates over upstream/ and then ignores any entries for which there is no corresponding `build/pkgs/*/package-version.txt`. So that it can auto-generate the entire checksums.ini (though it trips over cases). E.g. hashdist has a much more sensible system of caching upstream sources.",
    "created_at": "2014-07-12T13:57:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16629#issuecomment-216767",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@rwst](#comment%3A14):
> Minus the patchlevel, to be exact. 

Exactly, which is another reason for why the `package-version.txt` is the authorative version. Also, the Sage build process uses the `package-version.txt` timestamp to determine whether a package needs to be rebuilt, which is why you need to add the patch level here.

The `sage-fix-pkg-checksum` iterates over upstream/ and then ignores any entries for which there is no corresponding `build/pkgs/*/package-version.txt`. So that it can auto-generate the entire checksums.ini (though it trips over cases). E.g. hashdist has a much more sensible system of caching upstream sources.



---

archive/issue_comments_216768.json:
```json
{
    "body": "Changed commit from **[`d941afd`](https://github.com/sagemath/sagetrac-mirror/commit/d941afd9150164e979b7df98b2e574cdacd78053)** to **[`50697bf`](https://github.com/sagemath/sagetrac-mirror/commit/50697bf4b64ce0cf0a185c15ffce539d1392a80f)**",
    "created_at": "2014-07-12T14:23:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16629#issuecomment-216768",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d941afd`](https://github.com/sagemath/sagetrac-mirror/commit/d941afd9150164e979b7df98b2e574cdacd78053)** to **[`50697bf`](https://github.com/sagemath/sagetrac-mirror/commit/50697bf4b64ce0cf0a185c15ffce539d1392a80f)**



---

archive/issue_comments_216769.json:
```json
{
    "body": "<div id=\"comment:17\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/50697bf4b64ce0cf0a185c15ffce539d1392a80f\"><code>50697bf</code></a></td><td><code>Back to original behaviour (minus tolerance for mixed-case tarball names).</code></td></tr></table>\n",
    "created_at": "2014-07-12T14:23:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16629#issuecomment-216769",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:17"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/50697bf4b64ce0cf0a185c15ffce539d1392a80f"><code>50697bf</code></a></td><td><code>Back to original behaviour (minus tolerance for mixed-case tarball names).</code></td></tr></table>




---

archive/issue_comments_216770.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nOkay. New commit ==> back to previous behaviour.\n\nI still kept the ability to accept mixed-case tarball names (with no warning).\n\nWhen called without arguments, the script will treat all tarballs. Therefore, for a given package, the last package treated (i. e. last in the lexicographic order) will be the one used for the final `checksums.ini` for that package. Is that what you wanted ?\n\nWhen called with explicit tarball names, these tarballs will generate `checksums.ini`.\n\nStatus still `needs_review`.",
    "created_at": "2014-07-12T14:32:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16629#issuecomment-216770",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<div id="comment:18" align="right">comment:18</div>

Okay. New commit ==> back to previous behaviour.

I still kept the ability to accept mixed-case tarball names (with no warning).

When called without arguments, the script will treat all tarballs. Therefore, for a given package, the last package treated (i. e. last in the lexicographic order) will be the one used for the final `checksums.ini` for that package. Is that what you wanted ?

When called with explicit tarball names, these tarballs will generate `checksums.ini`.

Status still `needs_review`.



---

archive/issue_comments_216771.json:
```json
{
    "body": "Author: **Emmanuel Charpentier, Volker Braun (with input from J. H. Palmieri)**",
    "created_at": "2014-07-12T14:32:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16629#issuecomment-216771",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

Author: **Emmanuel Charpentier, Volker Braun (with input from J. H. Palmieri)**



---

archive/issue_comments_216772.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nNo, the last in lex order is wrong. Version 3.9 is older than 3.10. Really, you need to get the version from the `package-version.txt` file.",
    "created_at": "2014-07-13T05:00:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16629#issuecomment-216772",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:19" align="right">comment:19</div>

No, the last in lex order is wrong. Version 3.9 is older than 3.10. Really, you need to get the version from the `package-version.txt` file.



---

archive/issue_comments_216773.json:
```json
{
    "body": "<div id=\"comment:20\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/214941f6443a352a00f6b84acf6f029bdba67d85\"><code>214941f</code></a></td><td><code>Process if versions match.</code></td></tr></table>\n",
    "created_at": "2014-07-13T07:15:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16629#issuecomment-216773",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:20"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/214941f6443a352a00f6b84acf6f029bdba67d85"><code>214941f</code></a></td><td><code>Process if versions match.</code></td></tr></table>




---

archive/issue_comments_216774.json:
```json
{
    "body": "Changed commit from **[`50697bf`](https://github.com/sagemath/sagetrac-mirror/commit/50697bf4b64ce0cf0a185c15ffce539d1392a80f)** to **[`214941f`](https://github.com/sagemath/sagetrac-mirror/commit/214941f6443a352a00f6b84acf6f029bdba67d85)**",
    "created_at": "2014-07-13T07:15:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16629#issuecomment-216774",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`50697bf`](https://github.com/sagemath/sagetrac-mirror/commit/50697bf4b64ce0cf0a185c15ffce539d1392a80f)** to **[`214941f`](https://github.com/sagemath/sagetrac-mirror/commit/214941f6443a352a00f6b84acf6f029bdba67d85)**



---

archive/issue_comments_216775.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nDone. I hope I've guessed the specs right this time...",
    "created_at": "2014-07-13T07:16:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16629#issuecomment-216775",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<div id="comment:21" align="right">comment:21</div>

Done. I hope I've guessed the specs right this time...



---

archive/issue_comments_216776.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nThe \"fubar\" file is still in the branch...",
    "created_at": "2014-07-16T19:55:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16629#issuecomment-216776",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:22" align="right">comment:22</div>

The "fubar" file is still in the branch...



---

archive/issue_comments_216777.json:
```json
{
    "body": "<div id=\"comment:23\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7a2c9da063f353392d4b6629a1172b162de4c2f5\"><code>7a2c9da</code></a></td><td><code>Final cleanup of my distractions.</code></td></tr></table>\n",
    "created_at": "2014-07-16T20:52:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16629#issuecomment-216777",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:23"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7a2c9da063f353392d4b6629a1172b162de4c2f5"><code>7a2c9da</code></a></td><td><code>Final cleanup of my distractions.</code></td></tr></table>




---

archive/issue_comments_216778.json:
```json
{
    "body": "Changed commit from **[`214941f`](https://github.com/sagemath/sagetrac-mirror/commit/214941f6443a352a00f6b84acf6f029bdba67d85)** to **[`7a2c9da`](https://github.com/sagemath/sagetrac-mirror/commit/7a2c9da063f353392d4b6629a1172b162de4c2f5)**",
    "created_at": "2014-07-16T20:52:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16629#issuecomment-216778",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`214941f`](https://github.com/sagemath/sagetrac-mirror/commit/214941f6443a352a00f6b84acf6f029bdba67d85)** to **[`7a2c9da`](https://github.com/sagemath/sagetrac-mirror/commit/7a2c9da063f353392d4b6629a1172b162de4c2f5)**



---

archive/issue_comments_216779.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@vbraun](#comment%3A22):\n> The \"fubar\" file is still in the branch...\n\nRe-wups ! I didn't saw **that** when I checked before committing/pushing. Should be good now.",
    "created_at": "2014-07-16T20:56:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16629#issuecomment-216779",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@vbraun](#comment%3A22):
> The "fubar" file is still in the branch...

Re-wups ! I didn't saw **that** when I checked before committing/pushing. Should be good now.



---

archive/issue_events_235574.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16629#event-235574"
}
```



---

archive/issue_events_235575.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16629#event-235575"
}
```



---

archive/issue_events_235576.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-09-17T10:40:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16629#event-235576"
}
```



---

archive/issue_events_235577.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-09-17T10:40:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16629#event-235577"
}
```



---

archive/issue_comments_216780.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1 @@\n-The current (as of sage-6.3.beta5) version of sage-fix-pkg-checksums replaces the package version in build/pkgs/<package-name>/package-version.txt and checksums.ini\n \n-An example of the result can be found in comment 27 of [https://github.com/sagemath/sage/issues/16611](https://github.com/sagemath/sage/issues/16611). It is also germane to [https://github.com/sagemath/sage/issues/16489](https://github.com/sagemath/sage/issues/16489).\n``````\n",
    "created_at": "2014-09-17T10:40:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16629#issuecomment-216780",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1 @@
-The current (as of sage-6.3.beta5) version of sage-fix-pkg-checksums replaces the package version in build/pkgs/<package-name>/package-version.txt and checksums.ini
 
-An example of the result can be found in comment 27 of [https://github.com/sagemath/sage/issues/16611](https://github.com/sagemath/sage/issues/16611). It is also germane to [https://github.com/sagemath/sage/issues/16489](https://github.com/sagemath/sage/issues/16489).
``````




---

archive/issue_events_235578.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-09-17T10:40:46Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "title_is": "Improve sage-fix-pkg-checksums",
    "title_was": "sage-fix-pkg-checksums munches build/pkgs/<packagename>/checksums",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16629#event-235578"
}
```



---

archive/issue_comments_216781.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nAuthors: please describe what this patch is supposed to do, because the previous description was wrong (`package-version.txt` isn't changed by `sage-fix-pkg-checksums`)  and confusing! It's easier to review when I know what this patch is supposed to achieve.\n\nAnd fix the indentation please: no TABS, use indents of 4 spaces\n\nAnd I would like to add an additional change:\n\n```\nupstream_pkg_name=${tarball%-*}\n```\nshould become\n\n```\nupstream_pkg_name=${tarball%%-*}\n```\nto allow upstream versions with dashes (package-abc-1 should have package name \"package\" and version \"abc-1\").",
    "created_at": "2014-09-17T10:40:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16629#issuecomment-216781",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:26" align="right">comment:26</div>

Authors: please describe what this patch is supposed to do, because the previous description was wrong (`package-version.txt` isn't changed by `sage-fix-pkg-checksums`)  and confusing! It's easier to review when I know what this patch is supposed to achieve.

And fix the indentation please: no TABS, use indents of 4 spaces

And I would like to add an additional change:

```
upstream_pkg_name=${tarball%-*}
```
should become

```
upstream_pkg_name=${tarball%%-*}
```
to allow upstream versions with dashes (package-abc-1 should have package name "package" and version "abc-1").



---

archive/issue_comments_216782.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2014-09-17T10:40:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16629#issuecomment-216782",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**



---

archive/issue_comments_216783.json:
```json
{
    "body": "<div id=\"comment:27\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a0469055a4f293df53e6f6ae42ac9dc0e761f7c8\"><code>a046905</code></a></td><td><code>Trac #16629: improve sage-fix-pkg-checksums</code></td></tr></table>\n",
    "created_at": "2014-12-01T11:35:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16629#issuecomment-216783",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:27"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a0469055a4f293df53e6f6ae42ac9dc0e761f7c8"><code>a046905</code></a></td><td><code>Trac #16629: improve sage-fix-pkg-checksums</code></td></tr></table>




---

archive/issue_comments_216784.json:
```json
{
    "body": "Changed commit from **[`7a2c9da`](https://github.com/sagemath/sagetrac-mirror/commit/7a2c9da063f353392d4b6629a1172b162de4c2f5)** to **[`a046905`](https://github.com/sagemath/sagetrac-mirror/commit/a0469055a4f293df53e6f6ae42ac9dc0e761f7c8)**",
    "created_at": "2014-12-01T11:35:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16629#issuecomment-216784",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`7a2c9da`](https://github.com/sagemath/sagetrac-mirror/commit/7a2c9da063f353392d4b6629a1172b162de4c2f5)** to **[`a046905`](https://github.com/sagemath/sagetrac-mirror/commit/a0469055a4f293df53e6f6ae42ac9dc0e761f7c8)**



---

archive/issue_comments_216785.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nReplying to [@jdemeyer](#comment%3A26):\n> Authors: please describe what this patch is supposed to do, because the previous description was wrong (`package-version.txt` isn't changed by `sage-fix-pkg-checksums`)  and confusing! It's easier to review when I know what this patch is supposed to achieve.\n\nDone\n\n> And fix the indentation please: no TABS, use indents of 4 spaces\n\nAlso done. Although I wonder why this recommendation, which is sensible for python (and sage) programs, should apply to shell scripts, which are a horse of a totally different color...\n\n> And I would like to add an additional change:\n> \n> ```\n> upstream_pkg_name=${tarball%-*}\n> ```\n> should become\n> \n> ```\n> upstream_pkg_name=${tarball%%-*}\n> ```\n> to allow upstream versions with dashes (package-abc-1 should have package name \"package\" and version \"abc-1\").\n\nAlso done (although I'm not sure of the pertinence...).\n\nHTH,",
    "created_at": "2014-12-01T11:46:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16629#issuecomment-216785",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<div id="comment:28" align="right">comment:28</div>

Replying to [@jdemeyer](#comment%3A26):
> Authors: please describe what this patch is supposed to do, because the previous description was wrong (`package-version.txt` isn't changed by `sage-fix-pkg-checksums`)  and confusing! It's easier to review when I know what this patch is supposed to achieve.

Done

> And fix the indentation please: no TABS, use indents of 4 spaces

Also done. Although I wonder why this recommendation, which is sensible for python (and sage) programs, should apply to shell scripts, which are a horse of a totally different color...

> And I would like to add an additional change:
> 
> ```
> upstream_pkg_name=${tarball%-*}
> ```
> should become
> 
> ```
> upstream_pkg_name=${tarball%%-*}
> ```
> to allow upstream versions with dashes (package-abc-1 should have package name "package" and version "abc-1").

Also done (although I'm not sure of the pertinence...).

HTH,



---

archive/issue_comments_216786.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n+The current version of sage-fix-pkg-checksums incorrectly sets the package version to the *litteral* \"VERSION\" in checksums.ini, which is confusing and not helpful. Curiously, this is still (sort of) functional.\n \n+This patch correcly computes the version string and puts it at the right place in checksums.ini.\n``````\n",
    "created_at": "2014-12-01T11:46:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16629#issuecomment-216786",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,3 @@
+The current version of sage-fix-pkg-checksums incorrectly sets the package version to the *litteral* "VERSION" in checksums.ini, which is confusing and not helpful. Curiously, this is still (sort of) functional.
 
+This patch correcly computes the version string and puts it at the right place in checksums.ini.
``````




---

archive/issue_events_235579.json:
```json
{
    "actor": "https://github.com/EmmanuelCharpentier",
    "created_at": "2014-12-01T11:46:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16629#event-235579"
}
```



---

archive/issue_events_235580.json:
```json
{
    "actor": "https://github.com/EmmanuelCharpentier",
    "created_at": "2014-12-01T11:46:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16629#event-235580"
}
```



---

archive/issue_comments_216787.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n-The current version of sage-fix-pkg-checksums incorrectly sets the package version to the *litteral* \"VERSION\" in checksums.ini, which is confusing and not helpful. Curiously, this is still (sort of) functional.\n+The current version of `sage-fix-pkg-checksums` incorrectly sets the package version to the **literal** `\"VERSION\"` in `checksums.ini`, which is confusing and not helpful.\n \n-This patch correcly computes the version string and puts it at the right place in checksums.ini.\n+This patch correcly computes the version string and puts it at the right place in `checksums.ini`.\n``````\n",
    "created_at": "2014-12-01T22:34:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16629#issuecomment-216787",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
-The current version of sage-fix-pkg-checksums incorrectly sets the package version to the *litteral* "VERSION" in checksums.ini, which is confusing and not helpful. Curiously, this is still (sort of) functional.
+The current version of `sage-fix-pkg-checksums` incorrectly sets the package version to the **literal** `"VERSION"` in `checksums.ini`, which is confusing and not helpful.
 
-This patch correcly computes the version string and puts it at the right place in checksums.ini.
+This patch correcly computes the version string and puts it at the right place in `checksums.ini`.
``````




---

archive/issue_comments_216788.json:
```json
{
    "body": "Replying to [@EmmanuelCharpentier](https://github.com/sagemath/sage/issues/16629#comment:0):\n> The current version of `sage-fix-pkg-checksums` incorrectly sets the package version to the **literal** `\"VERSION\"` in `checksums.ini`, which is confusing and not helpful.\n\nIt's a feature, not a bug. It ensures that version info is stored in exactly one place, namely `package-version.txt`.",
    "created_at": "2014-12-01T22:34:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16629#issuecomment-216788",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [@EmmanuelCharpentier](https://github.com/sagemath/sage/issues/16629#comment:0):
> The current version of `sage-fix-pkg-checksums` incorrectly sets the package version to the **literal** `"VERSION"` in `checksums.ini`, which is confusing and not helpful.

It's a feature, not a bug. It ensures that version info is stored in exactly one place, namely `package-version.txt`.



---

archive/issue_events_235581.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-12-01T22:36:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16629#event-235581"
}
```



---

archive/issue_events_235582.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-12-01T22:36:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16629#event-235582"
}
```



---

archive/issue_comments_216789.json:
```json
{
    "body": "Changed author from **Emmanuel Charpentier, Volker Braun (with input from J. H. Palmieri)** to **Emmanuel Charpentier, Volker Braun, J. H. Palmieri**",
    "created_at": "2014-12-02T07:50:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16629#issuecomment-216789",
    "user": "https://github.com/jdemeyer"
}
```

Changed author from **Emmanuel Charpentier, Volker Braun (with input from J. H. Palmieri)** to **Emmanuel Charpentier, Volker Braun, J. H. Palmieri**



---

archive/issue_comments_216790.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nReplying to [@jdemeyer](#comment%3A29):\n> Replying to [@EmmanuelCharpentier](https://github.com/sagemath/sage/issues/16629#comment:0):\n> > The current version of `sage-fix-pkg-checksums` incorrectly sets the package version to the **literal** `\"VERSION\"` in `checksums.ini`, which is confusing and not helpful.\n> \n> It's a feature, not a bug. It ensures that version info is stored in exactly one place, namely `package-version.txt`.\n\nSo, you think it's wontfix?",
    "created_at": "2015-04-12T14:40:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16629#issuecomment-216790",
    "user": "https://github.com/rwst"
}
```

<div id="comment:32" align="right">comment:32</div>

Replying to [@jdemeyer](#comment%3A29):
> Replying to [@EmmanuelCharpentier](https://github.com/sagemath/sage/issues/16629#comment:0):
> > The current version of `sage-fix-pkg-checksums` incorrectly sets the package version to the **literal** `"VERSION"` in `checksums.ini`, which is confusing and not helpful.
> 
> It's a feature, not a bug. It ensures that version info is stored in exactly one place, namely `package-version.txt`.

So, you think it's wontfix?



---

archive/issue_events_235583.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-04-12T14:40:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16629#event-235583"
}
```



---

archive/issue_events_235584.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-04-12T14:40:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16629#event-235584"
}
```



---

archive/issue_events_235585.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-22T09:31:41Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16629#event-235585"
}
```



---

archive/issue_events_235586.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-22T09:31:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16629#event-235586"
}
```



---

archive/issue_events_235587.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-04-22T09:31:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16629#event-235587"
}
```



---

archive/issue_comments_216791.json:
```json
{
    "body": "Changed reviewer from **Jeroen Demeyer** to **Emmanuel Charpentier, Volker Braun, J. H. Palmieri, Jeroen Demeyer**",
    "created_at": "2015-04-22T09:31:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16629#issuecomment-216791",
    "user": "https://github.com/jdemeyer"
}
```

Changed reviewer from **Jeroen Demeyer** to **Emmanuel Charpentier, Volker Braun, J. H. Palmieri, Jeroen Demeyer**



---

archive/issue_comments_216792.json:
```json
{
    "body": "Changed author from **Emmanuel Charpentier, Volker Braun, J. H. Palmieri** to none",
    "created_at": "2015-04-22T09:31:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16629#issuecomment-216792",
    "user": "https://github.com/jdemeyer"
}
```

Changed author from **Emmanuel Charpentier, Volker Braun, J. H. Palmieri** to none



---

archive/issue_events_235588.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-23T01:43:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16629#event-235588"
}
```



---

archive/issue_events_235589.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-23T01:43:56Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16629#event-235589"
}
```



---

archive/issue_events_235590.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-23T01:43:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
    "label_color": "ffe799",
    "label_name": "p: minor / 4",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16629#event-235590"
}
```



---

archive/issue_events_235591.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-23T01:43:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16629",
    "label": "https://github.com/sagemath/sage/labels/wontfix",
    "label_color": "c6c6c6",
    "label_name": "wontfix",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16629#event-235591"
}
```
