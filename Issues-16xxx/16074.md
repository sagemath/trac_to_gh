# Issue 16074: Metaclass syntax changed in Python 3

archive/issues_015837.json:
```json
{
    "assignees": [],
    "body": "The tool 2to3 changes the code to the new Py3 syntax. \n\n\nBut the code has to depend on the Python version!\n\nThere are 30 affected modules. \n\nThis ticket is tracked as a dependency of meta-ticket ticket:16052.\n\nREFERENCE: http://stackoverflow.com/questions/18513821/python-metaclass-understanding-the-with-metaclass\n\nCC:  @tscrim @jdemeyer\n\nComponent: **python3**\n\nAuthor: **Jeroen Demeyer**\n\nBranch/Commit: **[`f1ca05f`](https://github.com/sagemath/sagetrac-mirror/commit/f1ca05f39db7d8ca8afc379808858c568619b9eb)**\n\nReviewer: **Travis Scrimshaw**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/16074_\n\n",
    "closed_at": "2017-04-14T19:56:17Z",
    "created_at": "2014-04-07T08:50:31Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20python3",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/c%3A%20python3"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Metaclass syntax changed in Python 3",
    "type": "issue",
    "updated_at": "2017-04-14T19:56:17Z",
    "url": "https://github.com/sagemath/sage/issues/16074",
    "user": "https://github.com/wluebbe"
}
```
The tool 2to3 changes the code to the new Py3 syntax. 


But the code has to depend on the Python version!

There are 30 affected modules. 

This ticket is tracked as a dependency of meta-ticket ticket:16052.

REFERENCE: http://stackoverflow.com/questions/18513821/python-metaclass-understanding-the-with-metaclass

CC:  @tscrim @jdemeyer

Component: **python3**

Author: **Jeroen Demeyer**

Branch/Commit: **[`f1ca05f`](https://github.com/sagemath/sagetrac-mirror/commit/f1ca05f39db7d8ca8afc379808858c568619b9eb)**

Reviewer: **Travis Scrimshaw**

_Issue created by migration from https://trac.sagemath.org/ticket/16074_





---

archive/issue_events_227369.json:
```json
{
    "actor": "https://github.com/wluebbe",
    "created_at": "2014-04-07T08:50:31Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16074#event-227369"
}
```



---

archive/issue_events_227370.json:
```json
{
    "actor": "https://github.com/wluebbe",
    "created_at": "2014-04-07T08:50:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20distribution",
    "label_color": "0000b0",
    "label_name": "c: distribution",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16074#event-227370"
}
```



---

archive/issue_events_227371.json:
```json
{
    "actor": "https://github.com/wluebbe",
    "created_at": "2014-04-07T08:50:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16074#event-227371"
}
```



---

archive/issue_events_227372.json:
```json
{
    "actor": "https://github.com/wluebbe",
    "created_at": "2014-04-07T08:50:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16074#event-227372"
}
```



---

archive/issue_events_227373.json:
```json
{
    "actor": "https://github.com/wluebbe",
    "created_at": "2014-04-07T08:50:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20python3",
    "label_color": "0000b0",
    "label_name": "c: python3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16074#event-227373"
}
```



---

archive/issue_events_227374.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16074#event-227374"
}
```



---

archive/issue_events_227375.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16074#event-227375"
}
```



---

archive/issue_events_227376.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16074#event-227376"
}
```



---

archive/issue_events_227377.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16074#event-227377"
}
```



---

archive/issue_comments_204735.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,6 +3,6 @@\n \n But the code has to depend on the Python version!\n \n-There are 30 effected modules. \n+There are 30 affected modules. \n \n This ticket is tracked as a dependency of meta-ticket ticket:16052.\n``````\n",
    "created_at": "2016-05-02T13:35:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-204735",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,6 +3,6 @@
 
 But the code has to depend on the Python version!
 
-There are 30 effected modules. 
+There are 30 affected modules. 
 
 This ticket is tracked as a dependency of meta-ticket ticket:16052.
``````




---

archive/issue_events_227378.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-05-02T13:35:05Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "title_is": "Metaclass syntax changed in Python 3",
    "title_was": "Python 3 preparation: The metaclass syntax has changed in Py",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16074#event-227378"
}
```



---

archive/issue_events_227379.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-05-02T13:35:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20distribution",
    "label_color": "0000b0",
    "label_name": "c: distribution",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16074#event-227379"
}
```



---

archive/issue_comments_204736.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,3 +6,5 @@\n There are 30 affected modules. \n \n This ticket is tracked as a dependency of meta-ticket ticket:16052.\n+\n+REFERENCE: http://stackoverflow.com/questions/18513821/python-metaclass-understanding-the-with-metaclass\n``````\n",
    "created_at": "2017-02-28T19:44:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-204736",
    "user": "https://github.com/fchapoton"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,3 +6,5 @@
 There are 30 affected modules. 
 
 This ticket is tracked as a dependency of meta-ticket ticket:16052.
+
+REFERENCE: http://stackoverflow.com/questions/18513821/python-metaclass-understanding-the-with-metaclass
``````




---

archive/issue_events_227380.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-02-28T19:44:45Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16074#event-227380"
}
```



---

archive/issue_events_227381.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-02-28T19:44:45Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "milestone_number": null,
    "milestone_title": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16074#event-227381"
}
```



---

archive/issue_comments_204737.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nfirst half in #22474 (combinat folder)",
    "created_at": "2017-02-28T21:20:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-204737",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:5" align="right">comment:5</div>

first half in #22474 (combinat folder)



---

archive/issue_comments_204738.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nanother easy step in #22479\n\nthen there remains more difficult cases",
    "created_at": "2017-03-01T08:14:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-204738",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:6" align="right">comment:6</div>

another easy step in #22479

then there remains more difficult cases



---

archive/issue_comments_204739.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nCython files: #22537",
    "created_at": "2017-03-07T10:59:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-204739",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:7" align="right">comment:7</div>

Cython files: #22537



---

archive/issue_comments_204740.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\n@tscrim: I have not been able to fix the use of metaclass in \n\n```\n* src/sage/algebras/clifford_algebra.py\n* src/sage/algebras/commutative_dga.py\n* src/sage/modular/modform_hecketriangle/graded_ring_element.py\n```\nThe expected python3 replacement is\n\n```\nfrom six import add_metaclass\n\n@add_metaclass(name_of_metaclass)\nclass something\n```\nBut this does not work for the three mentioned files.",
    "created_at": "2017-04-06T11:56:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-204740",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:8" align="right">comment:8</div>

@tscrim: I have not been able to fix the use of metaclass in 

```
* src/sage/algebras/clifford_algebra.py
* src/sage/algebras/commutative_dga.py
* src/sage/modular/modform_hecketriangle/graded_ring_element.py
```
The expected python3 replacement is

```
from six import add_metaclass

@add_metaclass(name_of_metaclass)
class something
```
But this does not work for the three mentioned files.



---

archive/issue_comments_204741.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nFor reference, can you at least push the non-working branch?",
    "created_at": "2017-04-06T11:59:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-204741",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:9" align="right">comment:9</div>

For reference, can you at least push the non-working branch?



---

archive/issue_events_227382.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-04-06T12:02:21Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "milestone_number": null,
    "milestone_title": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16074#event-227382"
}
```



---

archive/issue_events_227383.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-04-06T12:02:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16074#event-227383"
}
```



---

archive/issue_comments_204742.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nhere it is\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c9bb275589209c5da4b16c475c076f12a2557816\"><code>c9bb275</code></a></td><td><code>metaclass tentative for clifford algebras</code></td></tr></table>\n",
    "created_at": "2017-04-06T12:02:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-204742",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:10" align="right">comment:10</div>

here it is

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c9bb275589209c5da4b16c475c076f12a2557816"><code>c9bb275</code></a></td><td><code>metaclass tentative for clifford algebras</code></td></tr></table>




---

archive/issue_comments_204743.json:
```json
{
    "body": "Branch: **[public/16074](https://github.com/sagemath/sagetrac-mirror/tree/public/16074)**",
    "created_at": "2017-04-06T12:02:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-204743",
    "user": "https://github.com/fchapoton"
}
```

Branch: **[public/16074](https://github.com/sagemath/sagetrac-mirror/tree/public/16074)**



---

archive/issue_comments_204744.json:
```json
{
    "body": "Commit: **[`c9bb275`](https://github.com/sagemath/sagetrac-mirror/commit/c9bb275589209c5da4b16c475c076f12a2557816)**",
    "created_at": "2017-04-06T12:02:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-204744",
    "user": "https://github.com/fchapoton"
}
```

Commit: **[`c9bb275`](https://github.com/sagemath/sagetrac-mirror/commit/c9bb275589209c5da4b16c475c076f12a2557816)**



---

archive/issue_comments_204745.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nfailing as follows\n\n```\n  File \"/home/chapoton/sage/local/lib/python2.7/site-packages/sage/algebras/clifford_algebra.py\", line 2163, in <module>\n    class ExteriorAlgebraDifferential(ModuleMorphismByLinearity, UniqueRepresentation):\nTypeError: Error when calling the metaclass bases\n    metaclass conflict: the metaclass of a derived class must be a (non-strict) subclass of the metaclasses of all its bases\n```",
    "created_at": "2017-04-06T12:03:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-204745",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:11" align="right">comment:11</div>

failing as follows

```
  File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage/algebras/clifford_algebra.py", line 2163, in <module>
    class ExteriorAlgebraDifferential(ModuleMorphismByLinearity, UniqueRepresentation):
TypeError: Error when calling the metaclass bases
    metaclass conflict: the metaclass of a derived class must be a (non-strict) subclass of the metaclasses of all its bases
```



---

archive/issue_comments_204746.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\n`@add_metaclass` probably does something with the metaclass. Unless it is because of our heirarchy of metaclass...but I doubt it is that. It might be a decorator that needs to be added to the subclasses as well.",
    "created_at": "2017-04-06T22:01:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-204746",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:12" align="right">comment:12</div>

`@add_metaclass` probably does something with the metaclass. Unless it is because of our heirarchy of metaclass...but I doubt it is that. It might be a decorator that needs to be added to the subclasses as well.



---

archive/issue_comments_204747.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nThe problem is the decorator, because it works in 2 steps:\n\n1. The class is created the usual way.\n\n2. The decorator modifies the class to have a new metaclass.\n\nThe problem is that step 1. already fails, so the decorator cannot do anything.",
    "created_at": "2017-04-07T07:27:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-204747",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:13" align="right">comment:13</div>

The problem is the decorator, because it works in 2 steps:

1. The class is created the usual way.

2. The decorator modifies the class to have a new metaclass.

The problem is that step 1. already fails, so the decorator cannot do anything.



---

archive/issue_comments_204748.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nI'll look into this.",
    "created_at": "2017-04-07T08:11:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-204748",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:14" align="right">comment:14</div>

I'll look into this.



---

archive/issue_comments_204749.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@fchapoton](#comment%3A8):\n> @tscrim: I have not been able to fix the use of metaclass in \n> \n> ```\n> * src/sage/algebras/clifford_algebra.py\n> * src/sage/algebras/commutative_dga.py\n> * src/sage/modular/modform_hecketriangle/graded_ring_element.py\n> ```\n\nThere are some other files with `__metaclass__`, such as `src/sage/structure/unique_representation.py`. Should I try to fix these on this ticket too or is there a different ticket?",
    "created_at": "2017-04-07T08:23:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-204749",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@fchapoton](#comment%3A8):
> @tscrim: I have not been able to fix the use of metaclass in 
> 
> ```
> * src/sage/algebras/clifford_algebra.py
> * src/sage/algebras/commutative_dga.py
> * src/sage/modular/modform_hecketriangle/graded_ring_element.py
> ```

There are some other files with `__metaclass__`, such as `src/sage/structure/unique_representation.py`. Should I try to fix these on this ticket too or is there a different ticket?



---

archive/issue_comments_204750.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nPlease fix the metaclass issue in all places where you can. There is no other ticket. I only listed the algebraic use cases. The rest is more like \"sage infrastructure\".",
    "created_at": "2017-04-07T08:25:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-204750",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:16" align="right">comment:16</div>

Please fix the metaclass issue in all places where you can. There is no other ticket. I only listed the algebraic use cases. The rest is more like "sage infrastructure".



---

archive/issue_comments_204751.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nHmm, I agree that it's not easy :-) I'm making some progress, but I'm not quite there yet.",
    "created_at": "2017-04-07T09:48:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-204751",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:17" align="right">comment:17</div>

Hmm, I agree that it's not easy :-) I'm making some progress, but I'm not quite there yet.



---

archive/issue_comments_204752.json:
```json
{
    "body": "Author: **Jeroen Demeyer**",
    "created_at": "2017-04-07T09:48:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-204752",
    "user": "https://github.com/jdemeyer"
}
```

Author: **Jeroen Demeyer**



---

archive/issue_comments_204753.json:
```json
{
    "body": "Changed commit from **[`c9bb275`](https://github.com/sagemath/sagetrac-mirror/commit/c9bb275589209c5da4b16c475c076f12a2557816)** to **[`36009e4`](https://github.com/sagemath/sagetrac-mirror/commit/36009e4e7fef4cf8136695279af1e8b17cc7cd5c)**",
    "created_at": "2017-04-07T09:58:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-204753",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`c9bb275`](https://github.com/sagemath/sagetrac-mirror/commit/c9bb275589209c5da4b16c475c076f12a2557816)** to **[`36009e4`](https://github.com/sagemath/sagetrac-mirror/commit/36009e4e7fef4cf8136695279af1e8b17cc7cd5c)**



---

archive/issue_comments_204754.json:
```json
{
    "body": "<div id=\"comment:18\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f61a1ae2d056931fb92bb9a448ae39bb28e735a2\"><code>f61a1ae</code></a></td><td><code>Replace `__metaclass__` with six.with_metaclass</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/677cc66dbfe0534e7ea66f47c4f578a5f62caefd\"><code>677cc66</code></a></td><td><code>Check for metaclass by checking types instead of __metaclass__</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/36009e4e7fef4cf8136695279af1e8b17cc7cd5c\"><code>36009e4</code></a></td><td><code>six.with_metaclass: use type.__call__ instead of type.__new__</code></td></tr></table>\n",
    "created_at": "2017-04-07T09:58:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-204754",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:18"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f61a1ae2d056931fb92bb9a448ae39bb28e735a2"><code>f61a1ae</code></a></td><td><code>Replace `__metaclass__` with six.with_metaclass</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/677cc66dbfe0534e7ea66f47c4f578a5f62caefd"><code>677cc66</code></a></td><td><code>Check for metaclass by checking types instead of __metaclass__</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/36009e4e7fef4cf8136695279af1e8b17cc7cd5c"><code>36009e4</code></a></td><td><code>six.with_metaclass: use type.__call__ instead of type.__new__</code></td></tr></table>




---

archive/issue_comments_204755.json:
```json
{
    "body": "<div id=\"comment:19\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b2beb0478bbc9511039dd524f9c92a4170b0063b\"><code>b2beb04</code></a></td><td><code>six.with_metaclass: override `__call__` instead of __new__</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b2108e6ba357a38ac475b2def651ad9720fd24e8\"><code>b2108e6</code></a></td><td><code>Replace `__metaclass__` with six.with_metaclass</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9635fb408451c3a6aca1d26deafed6461ac62f01\"><code>9635fb4</code></a></td><td><code>Check for metaclass by checking types instead of __metaclass__</code></td></tr></table>\n",
    "created_at": "2017-04-11T11:54:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-204755",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:19"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b2beb0478bbc9511039dd524f9c92a4170b0063b"><code>b2beb04</code></a></td><td><code>six.with_metaclass: override `__call__` instead of __new__</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b2108e6ba357a38ac475b2def651ad9720fd24e8"><code>b2108e6</code></a></td><td><code>Replace `__metaclass__` with six.with_metaclass</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9635fb408451c3a6aca1d26deafed6461ac62f01"><code>9635fb4</code></a></td><td><code>Check for metaclass by checking types instead of __metaclass__</code></td></tr></table>




---

archive/issue_comments_204756.json:
```json
{
    "body": "Changed commit from **[`36009e4`](https://github.com/sagemath/sagetrac-mirror/commit/36009e4e7fef4cf8136695279af1e8b17cc7cd5c)** to **[`9635fb4`](https://github.com/sagemath/sagetrac-mirror/commit/9635fb408451c3a6aca1d26deafed6461ac62f01)**",
    "created_at": "2017-04-11T11:54:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-204756",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`36009e4`](https://github.com/sagemath/sagetrac-mirror/commit/36009e4e7fef4cf8136695279af1e8b17cc7cd5c)** to **[`9635fb4`](https://github.com/sagemath/sagetrac-mirror/commit/9635fb408451c3a6aca1d26deafed6461ac62f01)**



---

archive/issue_events_227384.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-04-11T11:56:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16074#event-227384"
}
```



---

archive/issue_comments_204757.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nDone. The main effort here is fixing `sage.misc.six.with_metaclass` (the first of 3 commits).\n\nAfter this ticket, there is no remaining Sage code using `__metaclass__`. Some doctests still use `__metaclass__`, but I suggest to fix that later.",
    "created_at": "2017-04-11T11:59:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-204757",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:21" align="right">comment:21</div>

Done. The main effort here is fixing `sage.misc.six.with_metaclass` (the first of 3 commits).

After this ticket, there is no remaining Sage code using `__metaclass__`. Some doctests still use `__metaclass__`, but I suggest to fix that later.



---

archive/issue_comments_204758.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nI don't agree with this change (and subsequent changes from this):\n\n```diff\ndiff --git a/src/sage/misc/six.py b/src/sage/misc/six.py\nindex 8273d91..5f03a96 100644\n--- a/src/sage/misc/six.py\n+++ b/src/sage/misc/six.py\n@@ -8,7 +8,7 @@ from __future__ import absolute_import\n from six import *\n \n \n-def with_metaclass(meta, *bases):\n+def with_metaclass(*args):\n     \"\"\"\n     Create a base class with a metaclass.\n \n```\nas later we require the first argument to be the meta class. So if someone happened to pass nothing, it would get an error message starting much later in the code. IMO, it also obfuscates the code a little bit too.",
    "created_at": "2017-04-11T15:40:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-204758",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:22" align="right">comment:22</div>

I don't agree with this change (and subsequent changes from this):

```diff
diff --git a/src/sage/misc/six.py b/src/sage/misc/six.py
index 8273d91..5f03a96 100644
--- a/src/sage/misc/six.py
+++ b/src/sage/misc/six.py
@@ -8,7 +8,7 @@ from __future__ import absolute_import
 from six import *
 
 
-def with_metaclass(meta, *bases):
+def with_metaclass(*args):
     """
     Create a base class with a metaclass.
 
```
as later we require the first argument to be the meta class. So if someone happened to pass nothing, it would get an error message starting much later in the code. IMO, it also obfuscates the code a little bit too.



---

archive/issue_comments_204759.json:
```json
{
    "body": "<div id=\"comment:23\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f1ca05f39db7d8ca8afc379808858c568619b9eb\"><code>f1ca05f</code></a></td><td><code>Restore (meta, *bases) arguments for with_metaclass()</code></td></tr></table>\n",
    "created_at": "2017-04-12T07:53:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-204759",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:23"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f1ca05f39db7d8ca8afc379808858c568619b9eb"><code>f1ca05f</code></a></td><td><code>Restore (meta, *bases) arguments for with_metaclass()</code></td></tr></table>




---

archive/issue_comments_204760.json:
```json
{
    "body": "Changed commit from **[`9635fb4`](https://github.com/sagemath/sagetrac-mirror/commit/9635fb408451c3a6aca1d26deafed6461ac62f01)** to **[`f1ca05f`](https://github.com/sagemath/sagetrac-mirror/commit/f1ca05f39db7d8ca8afc379808858c568619b9eb)**",
    "created_at": "2017-04-12T07:53:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-204760",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9635fb4`](https://github.com/sagemath/sagetrac-mirror/commit/9635fb408451c3a6aca1d26deafed6461ac62f01)** to **[`f1ca05f`](https://github.com/sagemath/sagetrac-mirror/commit/f1ca05f39db7d8ca8afc379808858c568619b9eb)**



---

archive/issue_comments_204761.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@tscrim](#comment%3A22):\n> I don't agree with this change\n\nFixed.",
    "created_at": "2017-04-12T07:54:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-204761",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@tscrim](#comment%3A22):
> I don't agree with this change

Fixed.



---

archive/issue_comments_204762.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nI wanted to submit these fixes to `with_metaclass` upstream to `six`. However, when looking at the original `six` code, I understood what was going wrong and it is really simple.\n\nI also realized that it was #18503 which is the cause for the metaclass breakage. In other words, #18503 did the wrong thing and actually made everything more complicated.\n\nIt turns out that #18503 can be fixed in a much simpler way, see https://github.com/benjaminp/six/pull/191 and then this issue (#16074) simply does not occur.",
    "created_at": "2017-04-13T08:22:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-204762",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:25" align="right">comment:25</div>

I wanted to submit these fixes to `with_metaclass` upstream to `six`. However, when looking at the original `six` code, I understood what was going wrong and it is really simple.

I also realized that it was #18503 which is the cause for the metaclass breakage. In other words, #18503 did the wrong thing and actually made everything more complicated.

It turns out that #18503 can be fixed in a much simpler way, see https://github.com/benjaminp/six/pull/191 and then this issue (#16074) simply does not occur.



---

archive/issue_comments_204763.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nThat being said, I think the current solution on this ticket is structurally better than upstream's `with_metaclass`: upstream is overriding `__new__` with `__call__` which is a bit fishy. Instead, I am overriding `__call__` with `__call__` which makes more sense.",
    "created_at": "2017-04-13T08:24:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-204763",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:26" align="right">comment:26</div>

That being said, I think the current solution on this ticket is structurally better than upstream's `with_metaclass`: upstream is overriding `__new__` with `__call__` which is a bit fishy. Instead, I am overriding `__call__` with `__call__` which makes more sense.



---

archive/issue_comments_204764.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nMakes sense to me. It's somewhat less pretty than the decorator, but this works for now and gets us closer to Python3.",
    "created_at": "2017-04-14T05:57:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-204764",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:27" align="right">comment:27</div>

Makes sense to me. It's somewhat less pretty than the decorator, but this works for now and gets us closer to Python3.



---

archive/issue_events_227385.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-04-14T05:57:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16074#event-227385"
}
```



---

archive/issue_events_227386.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-04-14T05:57:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16074#event-227386"
}
```



---

archive/issue_comments_204765.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2017-04-14T05:57:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-204765",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_events_227387.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-14T19:56:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16074#event-227387"
}
```



---

archive/issue_events_227388.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "fc13f244694f1973e8b3543011fdb1cf295e74c8",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-04-14T19:56:17Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16074#event-227388"
}
```



---

archive/issue_comments_204766.json:
```json
{
    "body": "Changed branch from **[public/16074](https://github.com/sagemath/sagetrac-mirror/tree/public/16074)** to **[`f1ca05f`](https://github.com/sagemath/sagetrac-mirror/commit/f1ca05f39db7d8ca8afc379808858c568619b9eb)**",
    "created_at": "2017-04-14T19:56:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-204766",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/16074](https://github.com/sagemath/sagetrac-mirror/tree/public/16074)** to **[`f1ca05f`](https://github.com/sagemath/sagetrac-mirror/commit/f1ca05f39db7d8ca8afc379808858c568619b9eb)**
