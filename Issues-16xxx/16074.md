# Issue 16074: Metaclass syntax changed in Python 3

archive/issues_015837.json:
```json
{
    "assignees": [],
    "body": "The tool 2to3 changes the code to the new Py3 syntax. \n\n\nBut the code has to depend on the Python version!\n\nThere are 30 affected modules. \n\nThis ticket is tracked as a dependency of meta-ticket ticket:16052.\n\nREFERENCE: http://stackoverflow.com/questions/18513821/python-metaclass-understanding-the-with-metaclass\n\nCC:  @tscrim @jdemeyer\n\nKeywords: **python3**\n\nBranch/Commit: **[f1ca05f](https://github.com/sagemath/sagetrac-mirror/commit/f1ca05f39db7d8ca8afc379808858c568619b9eb)**\n\nReviewer: **Travis Scrimshaw**\n\nAuthor: **Jeroen Demeyer**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/16074_\n\n",
    "closed_at": "2017-04-14T19:56:17Z",
    "created_at": "2014-04-07T08:50:31Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20python3",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Metaclass syntax changed in Python 3",
    "type": "issue",
    "updated_at": "2017-04-14T19:56:17Z",
    "url": "https://github.com/sagemath/sage/issues/16074",
    "user": "https://github.com/wluebbe"
}
```
The tool 2to3 changes the code to the new Py3 syntax. 


But the code has to depend on the Python version!

There are 30 affected modules. 

This ticket is tracked as a dependency of meta-ticket ticket:16052.

REFERENCE: http://stackoverflow.com/questions/18513821/python-metaclass-understanding-the-with-metaclass

CC:  @tscrim @jdemeyer

Keywords: **python3**

Branch/Commit: **[f1ca05f](https://github.com/sagemath/sagetrac-mirror/commit/f1ca05f39db7d8ca8afc379808858c568619b9eb)**

Reviewer: **Travis Scrimshaw**

Author: **Jeroen Demeyer**

_Issue created by migration from https://trac.sagemath.org/ticket/16074_





---

archive/issue_events_211957.json:
```json
{
    "actor": "https://github.com/wluebbe",
    "created_at": "2014-04-07T08:50:31Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16074#event-211957"
}
```



---

archive/issue_events_211958.json:
```json
{
    "actor": "https://github.com/wluebbe",
    "created_at": "2014-04-07T08:50:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20distribution",
    "label_color": "000080",
    "label_name": "component: distribution",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16074#event-211958"
}
```



---

archive/issue_events_211959.json:
```json
{
    "actor": "https://github.com/wluebbe",
    "created_at": "2014-04-07T08:50:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16074#event-211959"
}
```



---

archive/issue_events_211960.json:
```json
{
    "actor": "https://github.com/wluebbe",
    "created_at": "2014-04-07T08:50:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16074#event-211960"
}
```



---

archive/issue_events_211961.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16074#event-211961"
}
```



---

archive/issue_events_211962.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16074#event-211962"
}
```



---

archive/issue_events_211963.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16074#event-211963"
}
```



---

archive/issue_events_211964.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16074#event-211964"
}
```



---

archive/issue_comments_207266.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,6 +3,6 @@\n \n But the code has to depend on the Python version!\n \n-There are 30 effected modules. \n+There are 30 affected modules. \n \n This ticket is tracked as a dependency of meta-ticket ticket:16052.\n``````\n",
    "created_at": "2016-05-02T13:35:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-207266",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,6 +3,6 @@
 
 But the code has to depend on the Python version!
 
-There are 30 effected modules. 
+There are 30 affected modules. 
 
 This ticket is tracked as a dependency of meta-ticket ticket:16052.
``````




---

archive/issue_events_211965.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-05-02T13:35:05Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "title_is": "Metaclass syntax changed in Python 3",
    "title_was": "Python 3 preparation: The metaclass syntax has changed in Py",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16074#event-211965"
}
```



---

archive/issue_events_211966.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-05-02T13:35:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20distribution",
    "label_color": "000080",
    "label_name": "component: distribution",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16074#event-211966"
}
```



---

archive/issue_events_211967.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-05-02T13:35:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20python3",
    "label_color": "000080",
    "label_name": "component: python3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16074#event-211967"
}
```



---

archive/issue_comments_207267.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,3 +6,5 @@\n There are 30 affected modules. \n \n This ticket is tracked as a dependency of meta-ticket ticket:16052.\n+\n+REFERENCE: http://stackoverflow.com/questions/18513821/python-metaclass-understanding-the-with-metaclass\n``````\n",
    "created_at": "2017-02-28T19:44:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-207267",
    "user": "https://github.com/fchapoton"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,3 +6,5 @@
 There are 30 affected modules. 
 
 This ticket is tracked as a dependency of meta-ticket ticket:16052.
+
+REFERENCE: http://stackoverflow.com/questions/18513821/python-metaclass-understanding-the-with-metaclass
``````




---

archive/issue_events_211968.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-02-28T19:44:45Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16074#event-211968"
}
```



---

archive/issue_events_211969.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-02-28T19:44:45Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "milestone_number": null,
    "milestone_title": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16074#event-211969"
}
```



---

archive/issue_comments_207268.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nfirst half in #22474 (combinat folder)",
    "created_at": "2017-02-28T21:20:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-207268",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:5'>Comment 5:</a>
first half in #22474 (combinat folder)



---

archive/issue_comments_207269.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nanother easy step in #22479\n\nthen there remains more difficult cases",
    "created_at": "2017-03-01T08:14:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-207269",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:6'>Comment 6:</a>
another easy step in #22479

then there remains more difficult cases



---

archive/issue_comments_207270.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nCython files: #22537",
    "created_at": "2017-03-07T10:59:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-207270",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'>Comment 7:</a>
Cython files: #22537



---

archive/issue_comments_207271.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\n@tscrim: I have not been able to fix the use of metaclass in \n\n```\n* src/sage/algebras/clifford_algebra.py\n* src/sage/algebras/commutative_dga.py\n* src/sage/modular/modform_hecketriangle/graded_ring_element.py\n```\nThe expected python3 replacement is\n\n```\nfrom six import add_metaclass\n\n@add_metaclass(name_of_metaclass)\nclass something\n```\nBut this does not work for the three mentioned files.",
    "created_at": "2017-04-06T11:56:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-207271",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:8'>Comment 8:</a>
@tscrim: I have not been able to fix the use of metaclass in 

```
* src/sage/algebras/clifford_algebra.py
* src/sage/algebras/commutative_dga.py
* src/sage/modular/modform_hecketriangle/graded_ring_element.py
```
The expected python3 replacement is

```
from six import add_metaclass

@add_metaclass(name_of_metaclass)
class something
```
But this does not work for the three mentioned files.



---

archive/issue_comments_207272.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nFor reference, can you at least push the non-working branch?",
    "created_at": "2017-04-06T11:59:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-207272",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'>Comment 9:</a>
For reference, can you at least push the non-working branch?



---

archive/issue_events_211970.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-04-06T12:02:21Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "milestone_number": null,
    "milestone_title": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16074#event-211970"
}
```



---

archive/issue_events_211971.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-04-06T12:02:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "milestone_number": null,
    "milestone_title": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16074#event-211971"
}
```



---

archive/issue_comments_207273.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nhere it is\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c9bb275589209c5da4b16c475c076f12a2557816\">c9bb275</a></td><td><code>metaclass tentative for clifford algebras</code></td></tr></table>\n",
    "created_at": "2017-04-06T12:02:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-207273",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:10'>Comment 10:</a>
here it is

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c9bb275589209c5da4b16c475c076f12a2557816">c9bb275</a></td><td><code>metaclass tentative for clifford algebras</code></td></tr></table>




---

archive/issue_comments_207274.json:
```json
{
    "body": "Branch: **[public/16074](https://github.com/sagemath/sagetrac-mirror/tree/public/16074)**",
    "created_at": "2017-04-06T12:02:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-207274",
    "user": "https://github.com/fchapoton"
}
```

Branch: **[public/16074](https://github.com/sagemath/sagetrac-mirror/tree/public/16074)**



---

archive/issue_comments_207275.json:
```json
{
    "body": "Commit: **[c9bb275](https://github.com/sagemath/sagetrac-mirror/commit/c9bb275589209c5da4b16c475c076f12a2557816)**",
    "created_at": "2017-04-06T12:02:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-207275",
    "user": "https://github.com/fchapoton"
}
```

Commit: **[c9bb275](https://github.com/sagemath/sagetrac-mirror/commit/c9bb275589209c5da4b16c475c076f12a2557816)**



---

archive/issue_comments_207276.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nfailing as follows\n\n```\n  File \"/home/chapoton/sage/local/lib/python2.7/site-packages/sage/algebras/clifford_algebra.py\", line 2163, in <module>\n    class ExteriorAlgebraDifferential(ModuleMorphismByLinearity, UniqueRepresentation):\nTypeError: Error when calling the metaclass bases\n    metaclass conflict: the metaclass of a derived class must be a (non-strict) subclass of the metaclasses of all its bases\n```",
    "created_at": "2017-04-06T12:03:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-207276",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:11'>Comment 11:</a>
failing as follows

```
  File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage/algebras/clifford_algebra.py", line 2163, in <module>
    class ExteriorAlgebraDifferential(ModuleMorphismByLinearity, UniqueRepresentation):
TypeError: Error when calling the metaclass bases
    metaclass conflict: the metaclass of a derived class must be a (non-strict) subclass of the metaclasses of all its bases
```



---

archive/issue_comments_207277.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\n`@add_metaclass` probably does something with the metaclass. Unless it is because of our heirarchy of metaclass...but I doubt it is that. It might be a decorator that needs to be added to the subclasses as well.",
    "created_at": "2017-04-06T22:01:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-207277",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:12'>Comment 12:</a>
`@add_metaclass` probably does something with the metaclass. Unless it is because of our heirarchy of metaclass...but I doubt it is that. It might be a decorator that needs to be added to the subclasses as well.



---

archive/issue_comments_207278.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nThe problem is the decorator, because it works in 2 steps:\n\n1. The class is created the usual way.\n\n2. The decorator modifies the class to have a new metaclass.\n\nThe problem is that step 1. already fails, so the decorator cannot do anything.",
    "created_at": "2017-04-07T07:27:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-207278",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'>Comment 13:</a>
The problem is the decorator, because it works in 2 steps:

1. The class is created the usual way.

2. The decorator modifies the class to have a new metaclass.

The problem is that step 1. already fails, so the decorator cannot do anything.



---

archive/issue_comments_207279.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nI'll look into this.",
    "created_at": "2017-04-07T08:11:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-207279",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'>Comment 14:</a>
I'll look into this.



---

archive/issue_comments_207280.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nReplying to [@fchapoton](#comment%3A8):\n> @tscrim: I have not been able to fix the use of metaclass in \n> \n> ```\n> * src/sage/algebras/clifford_algebra.py\n> * src/sage/algebras/commutative_dga.py\n> * src/sage/modular/modform_hecketriangle/graded_ring_element.py\n> ```\n\nThere are some other files with `__metaclass__`, such as `src/sage/structure/unique_representation.py`. Should I try to fix these on this ticket too or is there a different ticket?",
    "created_at": "2017-04-07T08:23:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-207280",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'>Comment 15:</a>
Replying to [@fchapoton](#comment%3A8):
> @tscrim: I have not been able to fix the use of metaclass in 
> 
> ```
> * src/sage/algebras/clifford_algebra.py
> * src/sage/algebras/commutative_dga.py
> * src/sage/modular/modform_hecketriangle/graded_ring_element.py
> ```

There are some other files with `__metaclass__`, such as `src/sage/structure/unique_representation.py`. Should I try to fix these on this ticket too or is there a different ticket?



---

archive/issue_comments_207281.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nPlease fix the metaclass issue in all places where you can. There is no other ticket. I only listed the algebraic use cases. The rest is more like \"sage infrastructure\".",
    "created_at": "2017-04-07T08:25:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-207281",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:16'>Comment 16:</a>
Please fix the metaclass issue in all places where you can. There is no other ticket. I only listed the algebraic use cases. The rest is more like "sage infrastructure".



---

archive/issue_comments_207282.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nHmm, I agree that it's not easy :-) I'm making some progress, but I'm not quite there yet.",
    "created_at": "2017-04-07T09:48:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-207282",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'>Comment 17:</a>
Hmm, I agree that it's not easy :-) I'm making some progress, but I'm not quite there yet.



---

archive/issue_comments_207283.json:
```json
{
    "body": "Author: **Jeroen Demeyer**",
    "created_at": "2017-04-07T09:48:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-207283",
    "user": "https://github.com/jdemeyer"
}
```

Author: **Jeroen Demeyer**



---

archive/issue_comments_207284.json:
```json
{
    "body": "Changed commit from **[c9bb275](https://github.com/sagemath/sagetrac-mirror/commit/c9bb275589209c5da4b16c475c076f12a2557816)** to **[36009e4](https://github.com/sagemath/sagetrac-mirror/commit/36009e4e7fef4cf8136695279af1e8b17cc7cd5c)**",
    "created_at": "2017-04-07T09:58:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-207284",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[c9bb275](https://github.com/sagemath/sagetrac-mirror/commit/c9bb275589209c5da4b16c475c076f12a2557816)** to **[36009e4](https://github.com/sagemath/sagetrac-mirror/commit/36009e4e7fef4cf8136695279af1e8b17cc7cd5c)**



---

archive/issue_comments_207285.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f61a1ae2d056931fb92bb9a448ae39bb28e735a2\">f61a1ae</a></td><td><code>Replace `__metaclass__` with six.with_metaclass</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/677cc66dbfe0534e7ea66f47c4f578a5f62caefd\">677cc66</a></td><td><code>Check for metaclass by checking types instead of __metaclass__</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/36009e4e7fef4cf8136695279af1e8b17cc7cd5c\">36009e4</a></td><td><code>six.with_metaclass: use type.__call__ instead of type.__new__</code></td></tr></table>\n",
    "created_at": "2017-04-07T09:58:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-207285",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:18'>Comment 18:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f61a1ae2d056931fb92bb9a448ae39bb28e735a2">f61a1ae</a></td><td><code>Replace `__metaclass__` with six.with_metaclass</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/677cc66dbfe0534e7ea66f47c4f578a5f62caefd">677cc66</a></td><td><code>Check for metaclass by checking types instead of __metaclass__</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/36009e4e7fef4cf8136695279af1e8b17cc7cd5c">36009e4</a></td><td><code>six.with_metaclass: use type.__call__ instead of type.__new__</code></td></tr></table>




---

archive/issue_comments_207286.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b2beb0478bbc9511039dd524f9c92a4170b0063b\">b2beb04</a></td><td><code>six.with_metaclass: override `__call__` instead of __new__</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b2108e6ba357a38ac475b2def651ad9720fd24e8\">b2108e6</a></td><td><code>Replace `__metaclass__` with six.with_metaclass</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9635fb408451c3a6aca1d26deafed6461ac62f01\">9635fb4</a></td><td><code>Check for metaclass by checking types instead of __metaclass__</code></td></tr></table>\n",
    "created_at": "2017-04-11T11:54:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-207286",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:19'>Comment 19:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b2beb0478bbc9511039dd524f9c92a4170b0063b">b2beb04</a></td><td><code>six.with_metaclass: override `__call__` instead of __new__</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b2108e6ba357a38ac475b2def651ad9720fd24e8">b2108e6</a></td><td><code>Replace `__metaclass__` with six.with_metaclass</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9635fb408451c3a6aca1d26deafed6461ac62f01">9635fb4</a></td><td><code>Check for metaclass by checking types instead of __metaclass__</code></td></tr></table>




---

archive/issue_comments_207287.json:
```json
{
    "body": "Changed commit from **[36009e4](https://github.com/sagemath/sagetrac-mirror/commit/36009e4e7fef4cf8136695279af1e8b17cc7cd5c)** to **[9635fb4](https://github.com/sagemath/sagetrac-mirror/commit/9635fb408451c3a6aca1d26deafed6461ac62f01)**",
    "created_at": "2017-04-11T11:54:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-207287",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[36009e4](https://github.com/sagemath/sagetrac-mirror/commit/36009e4e7fef4cf8136695279af1e8b17cc7cd5c)** to **[9635fb4](https://github.com/sagemath/sagetrac-mirror/commit/9635fb408451c3a6aca1d26deafed6461ac62f01)**



---

archive/issue_events_211972.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-04-11T11:56:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16074#event-211972"
}
```



---

archive/issue_comments_207288.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nDone. The main effort here is fixing `sage.misc.six.with_metaclass` (the first of 3 commits).\n\nAfter this ticket, there is no remaining Sage code using `__metaclass__`. Some doctests still use `__metaclass__`, but I suggest to fix that later.",
    "created_at": "2017-04-11T11:59:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-207288",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:21'>Comment 21:</a>
Done. The main effort here is fixing `sage.misc.six.with_metaclass` (the first of 3 commits).

After this ticket, there is no remaining Sage code using `__metaclass__`. Some doctests still use `__metaclass__`, but I suggest to fix that later.



---

archive/issue_comments_207289.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nI don't agree with this change (and subsequent changes from this):\n\n```diff\ndiff --git a/src/sage/misc/six.py b/src/sage/misc/six.py\nindex 8273d91..5f03a96 100644\n--- a/src/sage/misc/six.py\n+++ b/src/sage/misc/six.py\n@@ -8,7 +8,7 @@ from __future__ import absolute_import\n from six import *\n \n \n-def with_metaclass(meta, *bases):\n+def with_metaclass(*args):\n     \"\"\"\n     Create a base class with a metaclass.\n \n```\nas later we require the first argument to be the meta class. So if someone happened to pass nothing, it would get an error message starting much later in the code. IMO, it also obfuscates the code a little bit too.",
    "created_at": "2017-04-11T15:40:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-207289",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:22'>Comment 22:</a>
I don't agree with this change (and subsequent changes from this):

```diff
diff --git a/src/sage/misc/six.py b/src/sage/misc/six.py
index 8273d91..5f03a96 100644
--- a/src/sage/misc/six.py
+++ b/src/sage/misc/six.py
@@ -8,7 +8,7 @@ from __future__ import absolute_import
 from six import *
 
 
-def with_metaclass(meta, *bases):
+def with_metaclass(*args):
     """
     Create a base class with a metaclass.
 
```
as later we require the first argument to be the meta class. So if someone happened to pass nothing, it would get an error message starting much later in the code. IMO, it also obfuscates the code a little bit too.



---

archive/issue_comments_207290.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f1ca05f39db7d8ca8afc379808858c568619b9eb\">f1ca05f</a></td><td><code>Restore (meta, *bases) arguments for with_metaclass()</code></td></tr></table>\n",
    "created_at": "2017-04-12T07:53:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-207290",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:23'>Comment 23:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f1ca05f39db7d8ca8afc379808858c568619b9eb">f1ca05f</a></td><td><code>Restore (meta, *bases) arguments for with_metaclass()</code></td></tr></table>




---

archive/issue_comments_207291.json:
```json
{
    "body": "Changed commit from **[9635fb4](https://github.com/sagemath/sagetrac-mirror/commit/9635fb408451c3a6aca1d26deafed6461ac62f01)** to **[f1ca05f](https://github.com/sagemath/sagetrac-mirror/commit/f1ca05f39db7d8ca8afc379808858c568619b9eb)**",
    "created_at": "2017-04-12T07:53:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-207291",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[9635fb4](https://github.com/sagemath/sagetrac-mirror/commit/9635fb408451c3a6aca1d26deafed6461ac62f01)** to **[f1ca05f](https://github.com/sagemath/sagetrac-mirror/commit/f1ca05f39db7d8ca8afc379808858c568619b9eb)**



---

archive/issue_comments_207292.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\nReplying to [@tscrim](#comment%3A22):\n> I don't agree with this change\n\nFixed.",
    "created_at": "2017-04-12T07:54:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-207292",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:24'>Comment 24:</a>
Replying to [@tscrim](#comment%3A22):
> I don't agree with this change

Fixed.



---

archive/issue_comments_207293.json:
```json
{
    "body": "<a id='comment:25'>Comment 25:</a>\nI wanted to submit these fixes to `with_metaclass` upstream to `six`. However, when looking at the original `six` code, I understood what was going wrong and it is really simple.\n\nI also realized that it was #18503 which is the cause for the metaclass breakage. In other words, #18503 did the wrong thing and actually made everything more complicated.\n\nIt turns out that #18503 can be fixed in a much simpler way, see https://github.com/benjaminp/six/pull/191 and then this issue (#16074) simply does not occur.",
    "created_at": "2017-04-13T08:22:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-207293",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:25'>Comment 25:</a>
I wanted to submit these fixes to `with_metaclass` upstream to `six`. However, when looking at the original `six` code, I understood what was going wrong and it is really simple.

I also realized that it was #18503 which is the cause for the metaclass breakage. In other words, #18503 did the wrong thing and actually made everything more complicated.

It turns out that #18503 can be fixed in a much simpler way, see https://github.com/benjaminp/six/pull/191 and then this issue (#16074) simply does not occur.



---

archive/issue_comments_207294.json:
```json
{
    "body": "<a id='comment:26'>Comment 26:</a>\nThat being said, I think the current solution on this ticket is structurally better than upstream's `with_metaclass`: upstream is overriding `__new__` with `__call__` which is a bit fishy. Instead, I am overriding `__call__` with `__call__` which makes more sense.",
    "created_at": "2017-04-13T08:24:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-207294",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:26'>Comment 26:</a>
That being said, I think the current solution on this ticket is structurally better than upstream's `with_metaclass`: upstream is overriding `__new__` with `__call__` which is a bit fishy. Instead, I am overriding `__call__` with `__call__` which makes more sense.



---

archive/issue_comments_207295.json:
```json
{
    "body": "<a id='comment:27'>Comment 27:</a>\nMakes sense to me. It's somewhat less pretty than the decorator, but this works for now and gets us closer to Python3.",
    "created_at": "2017-04-14T05:57:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-207295",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:27'>Comment 27:</a>
Makes sense to me. It's somewhat less pretty than the decorator, but this works for now and gets us closer to Python3.



---

archive/issue_events_211973.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-04-14T05:57:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16074#event-211973"
}
```



---

archive/issue_events_211974.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-04-14T05:57:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16074#event-211974"
}
```



---

archive/issue_comments_207296.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2017-04-14T05:57:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-207296",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_events_211975.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-14T19:56:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16074#event-211975"
}
```



---

archive/issue_events_211976.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "fc13f244694f1973e8b3543011fdb1cf295e74c8",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-04-14T19:56:17Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16074#event-211976"
}
```



---

archive/issue_comments_207297.json:
```json
{
    "body": "Changed branch from **[public/16074](https://github.com/sagemath/sagetrac-mirror/tree/public/16074)** to **[f1ca05f](https://github.com/sagemath/sagetrac-mirror/commit/f1ca05f39db7d8ca8afc379808858c568619b9eb)**",
    "created_at": "2017-04-14T19:56:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16074#issuecomment-207297",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/16074](https://github.com/sagemath/sagetrac-mirror/tree/public/16074)** to **[f1ca05f](https://github.com/sagemath/sagetrac-mirror/commit/f1ca05f39db7d8ca8afc379808858c568619b9eb)**
