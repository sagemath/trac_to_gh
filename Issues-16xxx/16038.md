# Issue 16038: C function profiler

archive/issues_015801.json:
```json
{
    "body": "This ticket complements the `%prun` magic for Python profiler with a `%crun` magic that given C function profile information using gperftools (optional, expected to be provided by the OS).\n\nBranch/Commit: 29db6cd46bce1751011613a6b4d99eb47656b6d0\n\nReviewer: Nathann Cohen\n\nAuthor: Volker Braun\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/16038\n\n",
    "closed_at": "2014-04-05T10:43:42Z",
    "created_at": "2014-03-31T23:55:11Z",
    "labels": [
        "component: performance"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.2",
    "title": "C function profiler",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16038",
    "user": "https://github.com/vbraun"
}
```
This ticket complements the `%prun` magic for Python profiler with a `%crun` magic that given C function profile information using gperftools (optional, expected to be provided by the OS).

Branch/Commit: 29db6cd46bce1751011613a6b4d99eb47656b6d0

Reviewer: Nathann Cohen

Author: Volker Braun

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/16038





---

archive/issue_comments_260481.json:
```json
{
    "body": "Changing branch from \"\" to \"u/vbraun/c_profiler\"",
    "created_at": "2014-03-31T23:55:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16038#issuecomment-260481",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "" to "u/vbraun/c_profiler"



---

archive/issue_comments_260482.json:
```json
{
    "body": "Changing commit from \"\" to \"8dd0d7dac47688c398b3e837d42751aecff3ced4\"",
    "created_at": "2014-04-01T08:18:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16038#issuecomment-260482",
    "user": "https://github.com/nathanncohen"
}
```

Changing commit from "" to "8dd0d7dac47688c398b3e837d42751aecff3ced4"



---

archive/issue_comments_260483.json:
```json
{
    "body": "<a id='comment:2'></a>\n(DEAD curious)\n\n---\nNew commits:\n|                                                                                                                                          |               |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------|\n|[86fe787](http://git.sagemath.org/sage.git/commit/?id=86fe787e0d0be0d54e9abd01ee5469f60c17a88d)|`fix sage -gdb`|\n|[234b6c9](http://git.sagemath.org/sage.git/commit/?id=234b6c9db5c360994d2cd3628aa74695108164f8)|`Do not import prun, it is provided by IPython`|\n|[8dd0d7d](http://git.sagemath.org/sage.git/commit/?id=8dd0d7dac47688c398b3e837d42751aecff3ced4)|`initial implementation of a gperftools profiler interface`|",
    "created_at": "2014-04-01T08:18:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16038#issuecomment-260483",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:2'></a>
(DEAD curious)

---
New commits:
|                                                                                                                                          |               |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------|
|[86fe787](http://git.sagemath.org/sage.git/commit/?id=86fe787e0d0be0d54e9abd01ee5469f60c17a88d)|`fix sage -gdb`|
|[234b6c9](http://git.sagemath.org/sage.git/commit/?id=234b6c9db5c360994d2cd3628aa74695108164f8)|`Do not import prun, it is provided by IPython`|
|[8dd0d7d](http://git.sagemath.org/sage.git/commit/?id=8dd0d7dac47688c398b3e837d42751aecff3ced4)|`initial implementation of a gperftools profiler interface`|



---

archive/issue_comments_260484.json:
```json
{
    "body": "Changing commit from \"8dd0d7dac47688c398b3e837d42751aecff3ced4\" to \"3f98bd01c2399b2633efb75e3d554195095df915\"",
    "created_at": "2014-04-01T14:15:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16038#issuecomment-260484",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "8dd0d7dac47688c398b3e837d42751aecff3ced4" to "3f98bd01c2399b2633efb75e3d554195095df915"



---

archive/issue_comments_260485.json:
```json
{
    "body": "<a id='comment:3'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                              |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------|\n|[3f98bd0](http://git.sagemath.org/sage.git/commit/?id=3f98bd01c2399b2633efb75e3d554195095df915)|`seach for alternatively-named pprof binaries`|",
    "created_at": "2014-04-01T14:15:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16038#issuecomment-260485",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                              |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------|
|[3f98bd0](http://git.sagemath.org/sage.git/commit/?id=3f98bd01c2399b2633efb75e3d554195095df915)|`seach for alternatively-named pprof binaries`|



---

archive/issue_comments_260486.json:
```json
{
    "body": "<a id='comment:4'></a>\nHelloooooooooo !!!\n\nIt would be cool to have an explicit error message when there is no output due to this 10ms thing. Could you also add this new file to the reference manual ?\n\nBy the way, what it this `:param s:/:type s:` ? I never saw them before. Could you wrap that in a \"INPUT\" block btw (the two crun functions need one) ?\n\nAlso : the gif output is cool but would there  be a way to make it available through %crun directly ? Or at least crun(\"cmd\") ?\n\nThere is also an unfinished sentence in the doc :\n\n```\nBy default, a if \n```\n\nNathann\n\n(super nice tool !)",
    "created_at": "2014-04-01T17:20:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16038#issuecomment-260486",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:4'></a>
Helloooooooooo !!!

It would be cool to have an explicit error message when there is no output due to this 10ms thing. Could you also add this new file to the reference manual ?

By the way, what it this `:param s:/:type s:` ? I never saw them before. Could you wrap that in a "INPUT" block btw (the two crun functions need one) ?

Also : the gif output is cool but would there  be a way to make it available through %crun directly ? Or at least crun("cmd") ?

There is also an unfinished sentence in the doc :

```
By default, a if 
```

Nathann

(super nice tool !)



---

archive/issue_comments_260487.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2014-04-01T17:20:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16038#issuecomment-260487",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_260488.json:
```json
{
    "body": "<a id='comment:5'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                       |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------|\n|[f8513e7](http://git.sagemath.org/sage.git/commit/?id=f8513e781b057c77a8636a2069bb95cceb225909)|`improve documentation`|\n|[1f045f7](http://git.sagemath.org/sage.git/commit/?id=1f045f735de959ffa0bac7534add23fe91b38208)|`add the Sage IPython extension to the manual`|\n|[acebf36](http://git.sagemath.org/sage.git/commit/?id=acebf369954b89a6c21e9324b4c7dbae5c009e9c)|`warn if profiled command finishes < 100ms`|",
    "created_at": "2014-04-04T16:51:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16038#issuecomment-260488",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                       |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------|
|[f8513e7](http://git.sagemath.org/sage.git/commit/?id=f8513e781b057c77a8636a2069bb95cceb225909)|`improve documentation`|
|[1f045f7](http://git.sagemath.org/sage.git/commit/?id=1f045f735de959ffa0bac7534add23fe91b38208)|`add the Sage IPython extension to the manual`|
|[acebf36](http://git.sagemath.org/sage.git/commit/?id=acebf369954b89a6c21e9324b4c7dbae5c009e9c)|`warn if profiled command finishes < 100ms`|



---

archive/issue_comments_260489.json:
```json
{
    "body": "Changing commit from \"3f98bd01c2399b2633efb75e3d554195095df915\" to \"acebf369954b89a6c21e9324b4c7dbae5c009e9c\"",
    "created_at": "2014-04-04T16:51:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16038#issuecomment-260489",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "3f98bd01c2399b2633efb75e3d554195095df915" to "acebf369954b89a6c21e9324b4c7dbae5c009e9c"



---

archive/issue_comments_260490.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2014-04-04T16:52:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16038#issuecomment-260490",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_260491.json:
```json
{
    "body": "<a id='comment:6'></a>\nDone.\n\nThe `:param` is standard Python syntax which we don't use in Sage. I changed it to our conventions.",
    "created_at": "2014-04-04T16:52:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16038#issuecomment-260491",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:6'></a>
Done.

The `:param` is standard Python syntax which we don't use in Sage. I changed it to our conventions.



---

archive/issue_comments_260492.json:
```json
{
    "body": "<a id='comment:7'></a>\nYoooooooooooo !\n\n> Done.\n\n\nThanks ! And we'll add this .gif output some later day if we need it `:-)`\n\nNathann\n\nP.S. : By the way, why didn't you raise an exception when the program runs <100ms ?",
    "created_at": "2014-04-04T17:25:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16038#issuecomment-260492",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:7'></a>
Yoooooooooooo !

> Done.


Thanks ! And we'll add this .gif output some later day if we need it `:-)`

Nathann

P.S. : By the way, why didn't you raise an exception when the program runs <100ms ?



---

archive/issue_comments_260493.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-04-04T17:25:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16038#issuecomment-260493",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_260494.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Nathann Cohen\"",
    "created_at": "2014-04-04T17:25:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16038#issuecomment-260494",
    "user": "https://github.com/nathanncohen"
}
```

Changing reviewer from "" to "Nathann Cohen"



---

archive/issue_comments_260495.json:
```json
{
    "body": "<a id='comment:9'></a>\nIts not really an error, maybe you know what you are doing. The user might have changed the sampling frequency, for example.",
    "created_at": "2014-04-04T18:51:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16038#issuecomment-260495",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:9'></a>
Its not really an error, maybe you know what you are doing. The user might have changed the sampling frequency, for example.



---

archive/issue_comments_260496.json:
```json
{
    "body": "Changing commit from \"acebf369954b89a6c21e9324b4c7dbae5c009e9c\" to \"1569bafefd2cbedabe723d5cb37db04c200e72cc\"",
    "created_at": "2014-04-04T19:41:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16038#issuecomment-260496",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "acebf369954b89a6c21e9324b4c7dbae5c009e9c" to "1569bafefd2cbedabe723d5cb37db04c200e72cc"



---

archive/issue_comments_260497.json:
```json
{
    "body": "<a id='comment:10'></a>\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:\n|                                                                                                                                          |                                           |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------|\n|[1569baf](http://git.sagemath.org/sage.git/commit/?id=1569bafefd2cbedabe723d5cb37db04c200e72cc)|`doctest failure if pperf is not installed`|",
    "created_at": "2014-04-04T19:41:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16038#issuecomment-260497",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>
Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:
|                                                                                                                                          |                                           |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------|
|[1569baf](http://git.sagemath.org/sage.git/commit/?id=1569bafefd2cbedabe723d5cb37db04c200e72cc)|`doctest failure if pperf is not installed`|



---

archive/issue_comments_260498.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2014-04-04T19:41:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16038#issuecomment-260498",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_260499.json:
```json
{
    "body": "<a id='comment:11'></a>\nAhahah. Is that for sage -coverage ? :-P\n\nNathann",
    "created_at": "2014-04-04T19:56:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16038#issuecomment-260499",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:11'></a>
Ahahah. Is that for sage -coverage ? :-P

Nathann



---

archive/issue_comments_260500.json:
```json
{
    "body": "<a id='comment:12'></a>\nNo, `# random output` still fails if there is an exception raised...",
    "created_at": "2014-04-04T19:58:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16038#issuecomment-260500",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:12'></a>
No, `# random output` still fails if there is an exception raised...



---

archive/issue_comments_260501.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-04-04T21:23:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16038#issuecomment-260501",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_260502.json:
```json
{
    "body": "<a id='comment:13'></a>\noops, right !\n\nPasses all tests, with/without gperftools installed. Good to go again.\n\nNathann",
    "created_at": "2014-04-04T21:23:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16038#issuecomment-260502",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:13'></a>
oops, right !

Passes all tests, with/without gperftools installed. Good to go again.

Nathann



---

archive/issue_comments_260503.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2014-04-04T21:54:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16038#issuecomment-260503",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_260504.json:
```json
{
    "body": "<a id='comment:14'></a>\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:\n|                                                                                                                                          |         |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------|\n|[29db6cd](http://git.sagemath.org/sage.git/commit/?id=29db6cd46bce1751011613a6b4d99eb47656b6d0)|`OSX fix`|",
    "created_at": "2014-04-04T21:54:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16038#issuecomment-260504",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>
Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:
|                                                                                                                                          |         |
|------------------------------------------------------------------------------------------------------------------------------------------|---------|
|[29db6cd](http://git.sagemath.org/sage.git/commit/?id=29db6cd46bce1751011613a6b4d99eb47656b6d0)|`OSX fix`|



---

archive/issue_comments_260505.json:
```json
{
    "body": "Changing commit from \"1569bafefd2cbedabe723d5cb37db04c200e72cc\" to \"29db6cd46bce1751011613a6b4d99eb47656b6d0\"",
    "created_at": "2014-04-04T21:54:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16038#issuecomment-260505",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "1569bafefd2cbedabe723d5cb37db04c200e72cc" to "29db6cd46bce1751011613a6b4d99eb47656b6d0"



---

archive/issue_events_047155.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-04-05T10:43:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16038",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16038#event-47155"
}
```



---

archive/issue_comments_260506.json:
```json
{
    "body": "Changing branch from \"u/vbraun/c_profiler\" to \"29db6cd46bce1751011613a6b4d99eb47656b6d0\"",
    "created_at": "2014-04-05T10:43:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16038#issuecomment-260506",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/vbraun/c_profiler" to "29db6cd46bce1751011613a6b4d99eb47656b6d0"



---

archive/issue_comments_260507.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-04-05T10:43:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16038",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16038#issuecomment-260507",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
