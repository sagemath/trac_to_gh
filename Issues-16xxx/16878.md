# Issue 16878: faster is_prime

archive/issues_016641.json:
```json
{
    "assignees": [],
    "body": "Right now to test if a Sage integer is prime it is faster to call `prime_range` rather than `.is_prime()`...\n\n```\nsage: timeit(\"bool(prime_range(121,122))\", number=10000)\n10000 loops, best of 3: 1.09 \u00b5s per loop\nsage:  timeit(\"bool(prime_range(1009,1010))\", number=10000)\n10000 loops, best of 3: 1.2 \u00b5s per loop\n```\nversus\n\n```\nsage: timeit(\"121.is_prime()\", number=10000)\n10000 loops, best of 3: 5.3 \u00b5s per loop\nsage: timeit(\"1009.is_prime()\", number=10000)\n10000 loops, best of 3: 4.19 \u00b5s per loop\n```\n\nThe patch does some tiny modifications in `integer.pyx` and we get\n\n```\nsage: timeit(\"121.is_prime()\", number=10000)\n10000 loops, best of 3: 812 ns per loop\nsage: timeit(\"1009.is_prime()\", number=10000)\n10000 loops, best of 3: 730 ns per loop\n```\n\nWe also modify `is_prime_power()` to return `False` for 1 and raise an error for non-integral rationals like `1/2`.\n\nSee also [this sage-devel discussion](https://groups.google.com/forum/#!topic/sage-devel/v6s2RI4dd1Q).\n\nDepends on #16997\n\nCC:  @nathanncohen\n\nComponent: **number theory**\n\nAuthor: **Vincent Delecroix, Jeroen Demeyer**\n\nBranch: **[`1f8abd9`](https://github.com/sagemath/sagetrac-mirror/commit/1f8abd999dcf4935f92b2d83aad01684397e62d1)**\n\nReviewer: **Jeroen Demeyer, Vincent Delecroix**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/16878_\n\n",
    "closed_at": "2015-03-05T09:02:09Z",
    "created_at": "2014-08-25T10:31:53Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20number%20theory",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.6",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "faster is_prime",
    "type": "issue",
    "updated_at": "2023-01-08T08:38:03Z",
    "url": "https://github.com/sagemath/sage/issues/16878",
    "user": "https://github.com/videlec"
}
```
Right now to test if a Sage integer is prime it is faster to call `prime_range` rather than `.is_prime()`...

```
sage: timeit("bool(prime_range(121,122))", number=10000)
10000 loops, best of 3: 1.09 µs per loop
sage:  timeit("bool(prime_range(1009,1010))", number=10000)
10000 loops, best of 3: 1.2 µs per loop
```
versus

```
sage: timeit("121.is_prime()", number=10000)
10000 loops, best of 3: 5.3 µs per loop
sage: timeit("1009.is_prime()", number=10000)
10000 loops, best of 3: 4.19 µs per loop
```

The patch does some tiny modifications in `integer.pyx` and we get

```
sage: timeit("121.is_prime()", number=10000)
10000 loops, best of 3: 812 ns per loop
sage: timeit("1009.is_prime()", number=10000)
10000 loops, best of 3: 730 ns per loop
```

We also modify `is_prime_power()` to return `False` for 1 and raise an error for non-integral rationals like `1/2`.

See also [this sage-devel discussion](https://groups.google.com/forum/#!topic/sage-devel/v6s2RI4dd1Q).

Depends on #16997

CC:  @nathanncohen

Component: **number theory**

Author: **Vincent Delecroix, Jeroen Demeyer**

Branch: **[`1f8abd9`](https://github.com/sagemath/sagetrac-mirror/commit/1f8abd999dcf4935f92b2d83aad01684397e62d1)**

Reviewer: **Jeroen Demeyer, Vincent Delecroix**

_Issue created by migration from https://trac.sagemath.org/ticket/16878_





---

archive/issue_events_239043.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2014-08-25T10:31:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16878#event-239043"
}
```



---

archive/issue_events_239044.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2014-08-25T10:31:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20number%20theory",
    "label_color": "0000ff",
    "label_name": "c: number theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16878#event-239044"
}
```



---

archive/issue_events_239045.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2014-08-25T10:31:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16878#event-239045"
}
```



---

archive/issue_events_239046.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2014-08-25T10:31:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16878#event-239046"
}
```



---

archive/issue_comments_221952.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dd44a7e8d05a2b3978c679c363a2729bf0cf5e93\"><code>dd44a7e</code></a></td><td><code>trac #16878: faster is_prime</code></td></tr></table>\n",
    "created_at": "2014-08-25T10:32:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-221952",
    "user": "https://github.com/videlec"
}
```

<div id="comment:1"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dd44a7e8d05a2b3978c679c363a2729bf0cf5e93"><code>dd44a7e</code></a></td><td><code>trac #16878: faster is_prime</code></td></tr></table>




---

archive/issue_comments_221953.json:
```json
{
    "body": "Branch: **[u/vdelecroix/16878](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/16878)**",
    "created_at": "2014-08-25T10:32:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-221953",
    "user": "https://github.com/videlec"
}
```

Branch: **[u/vdelecroix/16878](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/16878)**



---

archive/issue_comments_221954.json:
```json
{
    "body": "Commit: **[`dd44a7e`](https://github.com/sagemath/sagetrac-mirror/commit/dd44a7e8d05a2b3978c679c363a2729bf0cf5e93)**",
    "created_at": "2014-08-25T10:32:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-221954",
    "user": "https://github.com/videlec"
}
```

Commit: **[`dd44a7e`](https://github.com/sagemath/sagetrac-mirror/commit/dd44a7e8d05a2b3978c679c363a2729bf0cf5e93)**



---

archive/issue_events_239047.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2014-08-25T10:32:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16878#event-239047"
}
```



---

archive/issue_comments_221955.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -15,7 +15,7 @@\n 10000 loops, best of 3: 4.19 \u00b5s per loop\n ```\n \n-The patch do some tiny modifications in `integer.pyx` and we get\n+The patch does some tiny modifications in `integer.pyx` and we get\n \n ```\n sage: timeit(\"121.is_prime()\", number=10000)\n``````\n",
    "created_at": "2014-08-25T10:36:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-221955",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -15,7 +15,7 @@
 10000 loops, best of 3: 4.19 µs per loop
 ```
 
-The patch do some tiny modifications in `integer.pyx` and we get
+The patch does some tiny modifications in `integer.pyx` and we get
 
 ```
 sage: timeit("121.is_prime()", number=10000)
``````




---

archive/issue_comments_221956.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nI would prefer not to include stuff from `pari/pari.h` directly, but instead use the declarations from `src/sage/libs/pari/decl.pxi`. And please rebase this over #15767.",
    "created_at": "2014-08-25T10:42:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-221956",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:3" align="right">comment:3</div>

I would prefer not to include stuff from `pari/pari.h` directly, but instead use the declarations from `src/sage/libs/pari/decl.pxi`. And please rebase this over #15767.



---

archive/issue_comments_221957.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2014-08-25T10:42:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-221957",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**



---

archive/issue_events_239048.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-08-25T10:42:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16878#event-239048"
}
```



---

archive/issue_events_239049.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-08-25T10:42:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16878#event-239049"
}
```



---

archive/issue_comments_221958.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nCan you also change the value of `PARI_PSEUDOPRIME_LIMIT` (see PARI docs) to `2^64` and use `mpz_fits_ui()` before calling `mpz_get_ui()`",
    "created_at": "2014-08-25T10:51:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-221958",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:4" align="right">comment:4</div>

Can you also change the value of `PARI_PSEUDOPRIME_LIMIT` (see PARI docs) to `2^64` and use `mpz_fits_ui()` before calling `mpz_get_ui()`



---

archive/issue_comments_221959.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nInstead of changing `_pari_()` to `_pari_c()` everywhere, wouldn't\n\n```\ncpdef _pari_(self)\n```\naccomplish the same thing?",
    "created_at": "2014-08-25T10:53:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-221959",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:5" align="right">comment:5</div>

Instead of changing `_pari_()` to `_pari_c()` everywhere, wouldn't

```
cpdef _pari_(self)
```
accomplish the same thing?



---

archive/issue_comments_221960.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nThanks for the remark. One question: are we sure that 2<sup>64</sup> fits into an unsigned long on any platform? Otherwise we can not safely call `uisprime` and `uisprimepower`. If not I will use a double check\n\n```\nif mpz_cmp(PARI_PSEUDOPRIME_LIMIT, v) > 0 and mpz_cmp_ui(v, ULONG_MAX) < 0:\n     # use uisprime or uisprimepower\n```\n\nVincent",
    "created_at": "2014-08-25T11:05:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-221960",
    "user": "https://github.com/videlec"
}
```

<div id="comment:6" align="right">comment:6</div>

Thanks for the remark. One question: are we sure that 2<sup>64</sup> fits into an unsigned long on any platform? Otherwise we can not safely call `uisprime` and `uisprimepower`. If not I will use a double check

```
if mpz_cmp(PARI_PSEUDOPRIME_LIMIT, v) > 0 and mpz_cmp_ui(v, ULONG_MAX) < 0:
     # use uisprime or uisprimepower
```

Vincent



---

archive/issue_comments_221961.json:
```json
{
    "body": "Changed commit from **[`dd44a7e`](https://github.com/sagemath/sagetrac-mirror/commit/dd44a7e8d05a2b3978c679c363a2729bf0cf5e93)** to **[`d7dc389`](https://github.com/sagemath/sagetrac-mirror/commit/d7dc38918903a97af742a90050ce87c58f6f222a)**",
    "created_at": "2014-08-25T11:49:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-221961",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`dd44a7e`](https://github.com/sagemath/sagetrac-mirror/commit/dd44a7e8d05a2b3978c679c363a2729bf0cf5e93)** to **[`d7dc389`](https://github.com/sagemath/sagetrac-mirror/commit/d7dc38918903a97af742a90050ce87c58f6f222a)**



---

archive/issue_comments_221962.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/37fc8e88689a0197c5513161b85b8bbadd5630ab\"><code>37fc8e8</code></a></td><td><code>Upgrade to PARI-2.7.1</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5db54b63a2e694423f33bd50819e46157be636db\"><code>5db54b6</code></a></td><td><code>Trac 15767: reviewer patch</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1d103da9fc0cc1629750e421a07cdfed4b94b040\"><code>1d103da</code></a></td><td><code>Trac 15767: fix doctest in Ser()</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/62ca8211de7d43d0686edf0d77f55a23aaeee5c7\"><code>62ca821</code></a></td><td><code>Trac 15767: explain application of Sturm's theorem</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bf435f8db1537f63c001894fb4949879617b71f2\"><code>bf435f8</code></a></td><td><code>Merge tag '6.4.beta1' into ticket/15767</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6e9f686d323671a4927cdc081cf7b473e6d356fe\"><code>6e9f686</code></a></td><td><code>trac #16878: faster is_prime</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d7dc38918903a97af742a90050ce87c58f6f222a\"><code>d7dc389</code></a></td><td><code>trac #16878: review</code></td></tr></table>\n",
    "created_at": "2014-08-25T11:49:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-221962",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/37fc8e88689a0197c5513161b85b8bbadd5630ab"><code>37fc8e8</code></a></td><td><code>Upgrade to PARI-2.7.1</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5db54b63a2e694423f33bd50819e46157be636db"><code>5db54b6</code></a></td><td><code>Trac 15767: reviewer patch</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1d103da9fc0cc1629750e421a07cdfed4b94b040"><code>1d103da</code></a></td><td><code>Trac 15767: fix doctest in Ser()</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/62ca8211de7d43d0686edf0d77f55a23aaeee5c7"><code>62ca821</code></a></td><td><code>Trac 15767: explain application of Sturm's theorem</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bf435f8db1537f63c001894fb4949879617b71f2"><code>bf435f8</code></a></td><td><code>Merge tag '6.4.beta1' into ticket/15767</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6e9f686d323671a4927cdc081cf7b473e6d356fe"><code>6e9f686</code></a></td><td><code>trac #16878: faster is_prime</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d7dc38918903a97af742a90050ce87c58f6f222a"><code>d7dc389</code></a></td><td><code>trac #16878: review</code></td></tr></table>




---

archive/issue_comments_221963.json:
```json
{
    "body": "Dependencies: **#15767**",
    "created_at": "2014-08-25T11:50:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-221963",
    "user": "https://github.com/videlec"
}
```

Dependencies: **#15767**



---

archive/issue_events_239050.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2014-08-25T11:50:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16878#event-239050"
}
```



---

archive/issue_events_239051.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2014-08-25T11:50:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16878#event-239051"
}
```



---

archive/issue_comments_221964.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\n`10000000000000000 != 2^64` :-)\n\nI don't think we should lower `PARI_PSEUDOPRIME_LIMIT` because it's also used in places where it's not bounded by `ULONG_MAX`, see `next_prime()` for example.\n\nPersonally, I would assume that `ULONG_MAX` < `2^64` and just use `mpz_fits_uint_p()`.",
    "created_at": "2014-08-25T11:56:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-221964",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:9" align="right">comment:9</div>

`10000000000000000 != 2^64` :-)

I don't think we should lower `PARI_PSEUDOPRIME_LIMIT` because it's also used in places where it's not bounded by `ULONG_MAX`, see `next_prime()` for example.

Personally, I would assume that `ULONG_MAX` < `2^64` and just use `mpz_fits_uint_p()`.



---

archive/issue_events_239052.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-08-25T11:56:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16878#event-239052"
}
```



---

archive/issue_events_239053.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-08-25T11:56:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16878#event-239053"
}
```



---

archive/issue_comments_221965.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nAlso, you wrote \"set set\" instead of \"set\".",
    "created_at": "2014-08-25T11:57:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-221965",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:10" align="right">comment:10</div>

Also, you wrote "set set" instead of "set".



---

archive/issue_comments_221966.json:
```json
{
    "body": "Changed commit from **[`d7dc389`](https://github.com/sagemath/sagetrac-mirror/commit/d7dc38918903a97af742a90050ce87c58f6f222a)** to **[`175d6b5`](https://github.com/sagemath/sagetrac-mirror/commit/175d6b5fd339989df12ec9c1f26d3b0d7e6dd82c)**",
    "created_at": "2014-08-25T12:28:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-221966",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d7dc389`](https://github.com/sagemath/sagetrac-mirror/commit/d7dc38918903a97af742a90050ce87c58f6f222a)** to **[`175d6b5`](https://github.com/sagemath/sagetrac-mirror/commit/175d6b5fd339989df12ec9c1f26d3b0d7e6dd82c)**



---

archive/issue_comments_221967.json:
```json
{
    "body": "<div id=\"comment:11\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/175d6b5fd339989df12ec9c1f26d3b0d7e6dd82c\"><code>175d6b5</code></a></td><td><code>trac #16878: review 2</code></td></tr></table>\n",
    "created_at": "2014-08-25T12:28:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-221967",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:11"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/175d6b5fd339989df12ec9c1f26d3b0d7e6dd82c"><code>175d6b5</code></a></td><td><code>trac #16878: review 2</code></td></tr></table>




---

archive/issue_events_239054.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2014-08-25T12:28:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16878#event-239054"
}
```



---

archive/issue_events_239055.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2014-08-25T12:28:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16878#event-239055"
}
```



---

archive/issue_comments_221968.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nThis is bikeshedding I know, but wouldn't\n\n```\nmpz_ui_pow_ui(PARI_PSEUDOPRIME_LIMIT, 2, 64)\n```\nbe easier to understand?",
    "created_at": "2014-08-25T12:46:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-221968",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:13" align="right">comment:13</div>

This is bikeshedding I know, but wouldn't

```
mpz_ui_pow_ui(PARI_PSEUDOPRIME_LIMIT, 2, 64)
```
be easier to understand?



---

archive/issue_comments_221969.json:
```json
{
    "body": "Changed commit from **[`175d6b5`](https://github.com/sagemath/sagetrac-mirror/commit/175d6b5fd339989df12ec9c1f26d3b0d7e6dd82c)** to **[`d55dc67`](https://github.com/sagemath/sagetrac-mirror/commit/d55dc6737936077eeee903687207f7af54588439)**",
    "created_at": "2014-08-25T12:56:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-221969",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`175d6b5`](https://github.com/sagemath/sagetrac-mirror/commit/175d6b5fd339989df12ec9c1f26d3b0d7e6dd82c)** to **[`d55dc67`](https://github.com/sagemath/sagetrac-mirror/commit/d55dc6737936077eeee903687207f7af54588439)**



---

archive/issue_comments_221970.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d55dc6737936077eeee903687207f7af54588439\"><code>d55dc67</code></a></td><td><code>trac #16878: bikeshedding</code></td></tr></table>\n",
    "created_at": "2014-08-25T12:56:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-221970",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d55dc6737936077eeee903687207f7af54588439"><code>d55dc67</code></a></td><td><code>trac #16878: bikeshedding</code></td></tr></table>




---

archive/issue_comments_221971.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nI don't mind...\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d55dc6737936077eeee903687207f7af54588439\"><code>d55dc67</code></a></td><td><code>trac #16878: bikeshedding</code></td></tr></table>\n",
    "created_at": "2014-08-25T12:56:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-221971",
    "user": "https://github.com/videlec"
}
```

<div id="comment:15" align="right">comment:15</div>

I don't mind...

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d55dc6737936077eeee903687207f7af54588439"><code>d55dc67</code></a></td><td><code>trac #16878: bikeshedding</code></td></tr></table>




---

archive/issue_comments_221972.json:
```json
{
    "body": "Changed commit from **[`175d6b5`](https://github.com/sagemath/sagetrac-mirror/commit/175d6b5fd339989df12ec9c1f26d3b0d7e6dd82c)** to **[`d55dc67`](https://github.com/sagemath/sagetrac-mirror/commit/d55dc6737936077eeee903687207f7af54588439)**",
    "created_at": "2014-08-25T12:56:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-221972",
    "user": "https://github.com/videlec"
}
```

Changed commit from **[`175d6b5`](https://github.com/sagemath/sagetrac-mirror/commit/175d6b5fd339989df12ec9c1f26d3b0d7e6dd82c)** to **[`d55dc67`](https://github.com/sagemath/sagetrac-mirror/commit/d55dc6737936077eeee903687207f7af54588439)**



---

archive/issue_comments_221973.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nping! (applies cleanly on 6.4.beta2)",
    "created_at": "2014-08-28T19:38:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-221973",
    "user": "https://github.com/videlec"
}
```

<div id="comment:16" align="right">comment:16</div>

ping! (applies cleanly on 6.4.beta2)



---

archive/issue_comments_221974.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -23,3 +23,5 @@\n sage: timeit(\"1009.is_prime()\", number=10000)\n 10000 loops, best of 3: 730 ns per loop\n ```\n+\n+We also modify `is_prime_power()` to return `False` for 1.\n``````\n",
    "created_at": "2014-08-29T09:26:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-221974",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -23,3 +23,5 @@
 sage: timeit("1009.is_prime()", number=10000)
 10000 loops, best of 3: 730 ns per loop
 ```
+
+We also modify `is_prime_power()` to return `False` for 1.
``````




---

archive/issue_comments_221975.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nBig reviewer patch coming up...",
    "created_at": "2014-08-29T09:26:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-221975",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:17" align="right">comment:17</div>

Big reviewer patch coming up...



---

archive/issue_comments_221976.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -24,4 +24,4 @@\n 10000 loops, best of 3: 730 ns per loop\n ```\n \n-We also modify `is_prime_power()` to return `False` for 1.\n+We also modify `is_prime_power()` to return `False` for 1 or non-integral rationals like `1/2`.\n``````\n",
    "created_at": "2014-08-29T10:31:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-221976",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -24,4 +24,4 @@
 10000 loops, best of 3: 730 ns per loop
 ```
 
-We also modify `is_prime_power()` to return `False` for 1.
+We also modify `is_prime_power()` to return `False` for 1 or non-integral rationals like `1/2`.
``````




---

archive/issue_comments_221977.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -24,4 +24,4 @@\n 10000 loops, best of 3: 730 ns per loop\n ```\n \n-We also modify `is_prime_power()` to return `False` for 1 or non-integral rationals like `1/2`.\n+We also modify `is_prime_power()` to return `False` for 1 and raise an error for non-integral rationals like `1/2`.\n``````\n",
    "created_at": "2014-08-29T10:34:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-221977",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -24,4 +24,4 @@
 10000 loops, best of 3: 730 ns per loop
 ```
 
-We also modify `is_prime_power()` to return `False` for 1 or non-integral rationals like `1/2`.
+We also modify `is_prime_power()` to return `False` for 1 and raise an error for non-integral rationals like `1/2`.
``````




---

archive/issue_comments_221978.json:
```json
{
    "body": "Changed branch from **[u/vdelecroix/16878](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/16878)** to **[u/jdemeyer/ticket/16878](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/16878)**",
    "created_at": "2014-08-29T11:27:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-221978",
    "user": "https://github.com/jdemeyer"
}
```

Changed branch from **[u/vdelecroix/16878](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/16878)** to **[u/jdemeyer/ticket/16878](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/16878)**



---

archive/issue_comments_221979.json:
```json
{
    "body": "Changed author from **Vincent Delecroix** to **Vincent Delecroix, Jeroen Demeyer**",
    "created_at": "2014-08-29T11:29:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-221979",
    "user": "https://github.com/jdemeyer"
}
```

Changed author from **Vincent Delecroix** to **Vincent Delecroix, Jeroen Demeyer**



---

archive/issue_comments_221980.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nAs you can see, I made quite a lot of additional changes, mostly trying to make the code cleaner. I am currently running doctests.\n\nCan you review this extra commit?\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7f6132188b7ddafd97630aaf721875f9d60a7106\"><code>7f61321</code></a></td><td><code>Reorganize is_prime_power() and next_prime() logic</code></td></tr></table>\n",
    "created_at": "2014-08-29T11:29:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-221980",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:21" align="right">comment:21</div>

As you can see, I made quite a lot of additional changes, mostly trying to make the code cleaner. I am currently running doctests.

Can you review this extra commit?

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7f6132188b7ddafd97630aaf721875f9d60a7106"><code>7f61321</code></a></td><td><code>Reorganize is_prime_power() and next_prime() logic</code></td></tr></table>




---

archive/issue_comments_221981.json:
```json
{
    "body": "Changed commit from **[`d55dc67`](https://github.com/sagemath/sagetrac-mirror/commit/d55dc6737936077eeee903687207f7af54588439)** to **[`7f61321`](https://github.com/sagemath/sagetrac-mirror/commit/7f6132188b7ddafd97630aaf721875f9d60a7106)**",
    "created_at": "2014-08-29T11:29:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-221981",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[`d55dc67`](https://github.com/sagemath/sagetrac-mirror/commit/d55dc6737936077eeee903687207f7af54588439)** to **[`7f61321`](https://github.com/sagemath/sagetrac-mirror/commit/7f6132188b7ddafd97630aaf721875f9d60a7106)**



---

archive/issue_comments_221982.json:
```json
{
    "body": "Changed commit from **[`7f61321`](https://github.com/sagemath/sagetrac-mirror/commit/7f6132188b7ddafd97630aaf721875f9d60a7106)** to **[`5937af5`](https://github.com/sagemath/sagetrac-mirror/commit/5937af54afa0562007d710c495ecd0f1160f7498)**",
    "created_at": "2014-08-29T12:38:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-221982",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`7f61321`](https://github.com/sagemath/sagetrac-mirror/commit/7f6132188b7ddafd97630aaf721875f9d60a7106)** to **[`5937af5`](https://github.com/sagemath/sagetrac-mirror/commit/5937af54afa0562007d710c495ecd0f1160f7498)**



---

archive/issue_comments_221983.json:
```json
{
    "body": "<div id=\"comment:22\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5937af54afa0562007d710c495ecd0f1160f7498\"><code>5937af5</code></a></td><td><code>Sloane considers 1 to be a prime power</code></td></tr></table>\n",
    "created_at": "2014-08-29T12:38:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-221983",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:22"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5937af54afa0562007d710c495ecd0f1160f7498"><code>5937af5</code></a></td><td><code>Sloane considers 1 to be a prime power</code></td></tr></table>




---

archive/issue_comments_221984.json:
```json
{
    "body": "Changed commit from **[`5937af5`](https://github.com/sagemath/sagetrac-mirror/commit/5937af54afa0562007d710c495ecd0f1160f7498)** to **[`f0d716f`](https://github.com/sagemath/sagetrac-mirror/commit/f0d716fd34029f65d0be0aa45d5cb1783f8da2f5)**",
    "created_at": "2014-08-29T13:20:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-221984",
    "user": "https://github.com/videlec"
}
```

Changed commit from **[`5937af5`](https://github.com/sagemath/sagetrac-mirror/commit/5937af54afa0562007d710c495ecd0f1160f7498)** to **[`f0d716f`](https://github.com/sagemath/sagetrac-mirror/commit/f0d716fd34029f65d0be0aa45d5cb1783f8da2f5)**



---

archive/issue_comments_221985.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nGreat! I especially like that now `isprimepower` is accessible.\n\nIn my last commit, I added the keyword `certificate` to `is_prime_power` in order to get back the pair (n,p) such that the integer is p<sup>n</sup> (following pari convention). I think it is worth it!\n\nVincent\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f0d716fd34029f65d0be0aa45d5cb1783f8da2f5\"><code>f0d716f</code></a></td><td><code>trac #16878: certificate flag in is_prime_power</code></td></tr></table>\n",
    "created_at": "2014-08-29T13:20:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-221985",
    "user": "https://github.com/videlec"
}
```

<div id="comment:23" align="right">comment:23</div>

Great! I especially like that now `isprimepower` is accessible.

In my last commit, I added the keyword `certificate` to `is_prime_power` in order to get back the pair (n,p) such that the integer is p<sup>n</sup> (following pari convention). I think it is worth it!

Vincent

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f0d716fd34029f65d0be0aa45d5cb1783f8da2f5"><code>f0d716f</code></a></td><td><code>trac #16878: certificate flag in is_prime_power</code></td></tr></table>




---

archive/issue_comments_221986.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/ticket/16878](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/16878)** to **[u/vdelecroix/16878](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/16878)**",
    "created_at": "2014-08-29T13:20:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-221986",
    "user": "https://github.com/videlec"
}
```

Changed branch from **[u/jdemeyer/ticket/16878](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/16878)** to **[u/vdelecroix/16878](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/16878)**



---

archive/issue_comments_221987.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nNote the treatment of 1 is different in`is_prime_powers` and `prime_powers`... either we fix it in that ticket or it can wait #16880.\n\nVincent",
    "created_at": "2014-08-29T13:30:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-221987",
    "user": "https://github.com/videlec"
}
```

<div id="comment:24" align="right">comment:24</div>

Note the treatment of 1 is different in`is_prime_powers` and `prime_powers`... either we fix it in that ticket or it can wait #16880.

Vincent



---

archive/issue_comments_221988.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReplying to [@videlec](#comment%3A23):\n> Great! I especially like that now `isprimepower` is accessible.\n> \n> In my last commit, I added the keyword `certificate` to `is_prime_power` in order to get back the pair (n,p) such that the integer is p<sup>n</sup> (following pari convention). I think it is worth it!\n\nI like the idea, but I'm not sure that I like the interface with the `certificate` keyword.\n\nHow about a separate method `write_as_prime_power()` (raising `ArithmeticError` if it's not a prime power) or something?",
    "created_at": "2014-08-29T13:36:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-221988",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:25" align="right">comment:25</div>

Replying to [@videlec](#comment%3A23):
> Great! I especially like that now `isprimepower` is accessible.
> 
> In my last commit, I added the keyword `certificate` to `is_prime_power` in order to get back the pair (n,p) such that the integer is p<sup>n</sup> (following pari convention). I think it is worth it!

I like the idea, but I'm not sure that I like the interface with the `certificate` keyword.

How about a separate method `write_as_prime_power()` (raising `ArithmeticError` if it's not a prime power) or something?



---

archive/issue_comments_221989.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nReplying to [@videlec](#comment%3A24):\n> Note the treatment of 1 is different in`is_prime_powers` and `prime_powers`... either we fix it in that ticket or it can wait #16880.\n\nLet's ignore that for now and try to merge this ticket first.",
    "created_at": "2014-08-29T13:36:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-221989",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:26" align="right">comment:26</div>

Replying to [@videlec](#comment%3A24):
> Note the treatment of 1 is different in`is_prime_powers` and `prime_powers`... either we fix it in that ticket or it can wait #16880.

Let's ignore that for now and try to merge this ticket first.



---

archive/issue_comments_221990.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [@jdemeyer](#comment%3A25):\n> Replying to [@videlec](#comment%3A23):\n> > Great! I especially like that now `isprimepower` is accessible.\n> > \n> > In my last commit, I added the keyword `certificate` to `is_prime_power` in order to get back the pair (n,p) such that the integer is p<sup>n</sup> (following pari convention). I think it is worth it!\n\n> I like the idea, but I'm not sure that I like the interface with the `certificate` keyword.\n> \n> How about a separate method `write_as_prime_power()` (raising `ArithmeticError` if it's not a prime power) or something?\n\nNote that there is already `factor` that does the job. Moreover, having two methods (`is_prime_power` and `write_as_prime_power`) with the exact same code looks bad as well. From my implementation, it is clear that the `certificate` keyword only modifies the output.\n\nMy design choice also comes from the fact that this `certifcate` keyword is already in use (see `sage.graphs` or `sage.combinat.designs`). I am not particularly happy with it but I find it better than having two functions.\n\nOn the other hand, treating a Python exception takes time, and this `is_prime_power` is the kind of function that I might use in time critical code.\n\nVincent",
    "created_at": "2014-08-29T14:20:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-221990",
    "user": "https://github.com/videlec"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [@jdemeyer](#comment%3A25):
> Replying to [@videlec](#comment%3A23):
> > Great! I especially like that now `isprimepower` is accessible.
> > 
> > In my last commit, I added the keyword `certificate` to `is_prime_power` in order to get back the pair (n,p) such that the integer is p<sup>n</sup> (following pari convention). I think it is worth it!

> I like the idea, but I'm not sure that I like the interface with the `certificate` keyword.
> 
> How about a separate method `write_as_prime_power()` (raising `ArithmeticError` if it's not a prime power) or something?

Note that there is already `factor` that does the job. Moreover, having two methods (`is_prime_power` and `write_as_prime_power`) with the exact same code looks bad as well. From my implementation, it is clear that the `certificate` keyword only modifies the output.

My design choice also comes from the fact that this `certifcate` keyword is already in use (see `sage.graphs` or `sage.combinat.designs`). I am not particularly happy with it but I find it better than having two functions.

On the other hand, treating a Python exception takes time, and this `is_prime_power` is the kind of function that I might use in time critical code.

Vincent



---

archive/issue_comments_221991.json:
```json
{
    "body": "Changed branch from **[u/vdelecroix/16878](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/16878)** to **[u/jdemeyer/ticket/16878](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/16878)**",
    "created_at": "2014-08-30T11:48:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-221991",
    "user": "https://github.com/jdemeyer"
}
```

Changed branch from **[u/vdelecroix/16878](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/16878)** to **[u/jdemeyer/ticket/16878](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/16878)**



---

archive/issue_comments_221992.json:
```json
{
    "body": "Changed commit from **[`f0d716f`](https://github.com/sagemath/sagetrac-mirror/commit/f0d716fd34029f65d0be0aa45d5cb1783f8da2f5)** to **[`bfd69d3`](https://github.com/sagemath/sagetrac-mirror/commit/bfd69d3b188a8ec36ab373b4e958b54c74b64d2b)**",
    "created_at": "2014-08-30T13:30:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-221992",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[`f0d716f`](https://github.com/sagemath/sagetrac-mirror/commit/f0d716fd34029f65d0be0aa45d5cb1783f8da2f5)** to **[`bfd69d3`](https://github.com/sagemath/sagetrac-mirror/commit/bfd69d3b188a8ec36ab373b4e958b54c74b64d2b)**



---

archive/issue_comments_221993.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nOne more reviewer patch...\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bfd69d3b188a8ec36ab373b4e958b54c74b64d2b\"><code>bfd69d3</code></a></td><td><code>is_prime_power() reviewer fixes</code></td></tr></table>\n",
    "created_at": "2014-08-30T13:30:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-221993",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:29" align="right">comment:29</div>

One more reviewer patch...

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bfd69d3b188a8ec36ab373b4e958b54c74b64d2b"><code>bfd69d3</code></a></td><td><code>is_prime_power() reviewer fixes</code></td></tr></table>




---

archive/issue_comments_221994.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nI am happy with the current version (at commit bfd69d3). Do you agree to set to positive review?\n\nVincent",
    "created_at": "2014-08-30T13:58:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-221994",
    "user": "https://github.com/videlec"
}
```

<div id="comment:30" align="right">comment:30</div>

I am happy with the current version (at commit bfd69d3). Do you agree to set to positive review?

Vincent



---

archive/issue_events_239056.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-08-30T14:19:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16878#event-239056"
}
```



---

archive/issue_events_239057.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-08-30T14:19:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16878#event-239057"
}
```



---

archive/issue_comments_221995.json:
```json
{
    "body": "Changed reviewer from **Jeroen Demeyer** to **Jeroen Demeyer, Vincent Delecroix**",
    "created_at": "2014-08-30T14:19:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-221995",
    "user": "https://github.com/jdemeyer"
}
```

Changed reviewer from **Jeroen Demeyer** to **Jeroen Demeyer, Vincent Delecroix**



---

archive/issue_events_239058.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-09-06T11:02:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16878#event-239058"
}
```



---

archive/issue_events_239059.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-09-06T11:02:49Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16878#event-239059"
}
```



---

archive/issue_comments_221996.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/ticket/16878](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/16878)** to **[`bfd69d3`](https://github.com/sagemath/sagetrac-mirror/commit/bfd69d3b188a8ec36ab373b4e958b54c74b64d2b)**",
    "created_at": "2014-09-06T11:02:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-221996",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jdemeyer/ticket/16878](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/16878)** to **[`bfd69d3`](https://github.com/sagemath/sagetrac-mirror/commit/bfd69d3b188a8ec36ab373b4e958b54c74b64d2b)**



---

archive/issue_comments_221997.json:
```json
{
    "body": "Changed commit from **[`bfd69d3`](https://github.com/sagemath/sagetrac-mirror/commit/bfd69d3b188a8ec36ab373b4e958b54c74b64d2b)** to none",
    "created_at": "2014-09-06T22:49:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-221997",
    "user": "https://github.com/vbraun"
}
```

Changed commit from **[`bfd69d3`](https://github.com/sagemath/sagetrac-mirror/commit/bfd69d3b188a8ec36ab373b4e958b54c74b64d2b)** to none



---

archive/issue_comments_221998.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nThis takes about a second before this ticket and really long after this ticket:\n\n```\nsage: with proof.WithProof('arithmetic', False):  \n....:    sage.rings.arith.is_prime_power((10^1000 + 453)^2)\n```\nIn fact, it get so slow that the ARM buildbot times out in \n\n```\nsage -t --long src/sage/rings/finite_rings/constructor.py\n    Timed out\n**********************************************************************\n...\nsage: k = FiniteField(10^1000 + 453, proof=False) ## line 230 ##\nsage: k = FiniteField((10^1000 + 453)^2, 'a', proof=False)      # long time -- about 5 seconds ## line 231 ##\n\n**********************************************************************\n```",
    "created_at": "2014-09-06T22:49:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-221998",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:33" align="right">comment:33</div>

This takes about a second before this ticket and really long after this ticket:

```
sage: with proof.WithProof('arithmetic', False):  
....:    sage.rings.arith.is_prime_power((10^1000 + 453)^2)
```
In fact, it get so slow that the ARM buildbot times out in 

```
sage -t --long src/sage/rings/finite_rings/constructor.py
    Timed out
**********************************************************************
...
sage: k = FiniteField(10^1000 + 453, proof=False) ## line 230 ##
sage: k = FiniteField((10^1000 + 453)^2, 'a', proof=False)      # long time -- about 5 seconds ## line 231 ##

**********************************************************************
```



---

archive/issue_events_239060.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-09-06T22:49:52Z",
    "event": "reopened",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16878#event-239060"
}
```



---

archive/issue_comments_221999.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nvery strange indeed\n\n```\nsage: sage.rings.arith.is_prime_power((10^999 + 453)^2)   # very fast\nFalse\nsage: sage.rings.arith.is_prime_power((10^1001 + 453)^2)  # very fast\nFalse\nsage: sage.rings.arith.is_prime_power((10^1000 + 453)^2)\n... <still waiting> ...\n```",
    "created_at": "2014-09-07T08:26:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-221999",
    "user": "https://github.com/videlec"
}
```

<div id="comment:34" align="right">comment:34</div>

very strange indeed

```
sage: sage.rings.arith.is_prime_power((10^999 + 453)^2)   # very fast
False
sage: sage.rings.arith.is_prime_power((10^1001 + 453)^2)  # very fast
False
sage: sage.rings.arith.is_prime_power((10^1000 + 453)^2)
... <still waiting> ...
```



---

archive/issue_comments_222000.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nI see... seems to be because we do not care about the flag `proof=True` or `proof=False` anymore in `is_prime_power`. We should still rely on `is_pseudoprime_small_power` when `proof=False`.\n\nAnd by the way, in `is_pseudoprime_small_power` the choice of the keyword to return `(n,p)` is `get_data`. I guess we should change the `certificate` in `is_prime_power` to `get_data` as well.\n\nVincent",
    "created_at": "2014-09-07T08:33:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-222000",
    "user": "https://github.com/videlec"
}
```

<div id="comment:35" align="right">comment:35</div>

I see... seems to be because we do not care about the flag `proof=True` or `proof=False` anymore in `is_prime_power`. We should still rely on `is_pseudoprime_small_power` when `proof=False`.

And by the way, in `is_pseudoprime_small_power` the choice of the keyword to return `(n,p)` is `get_data`. I guess we should change the `certificate` in `is_prime_power` to `get_data` as well.

Vincent



---

archive/issue_comments_222001.json:
```json
{
    "body": "Changed branch from **[`bfd69d3`](https://github.com/sagemath/sagetrac-mirror/commit/bfd69d3b188a8ec36ab373b4e958b54c74b64d2b)** to **[u/vdelecroix/16878](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/16878)**",
    "created_at": "2014-09-07T20:19:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-222001",
    "user": "https://github.com/videlec"
}
```

Changed branch from **[`bfd69d3`](https://github.com/sagemath/sagetrac-mirror/commit/bfd69d3b188a8ec36ab373b4e958b54c74b64d2b)** to **[u/vdelecroix/16878](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/16878)**



---

archive/issue_events_239061.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2014-09-07T20:19:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16878#event-239061"
}
```



---

archive/issue_comments_222002.json:
```json
{
    "body": "Commit: **[`e6f88c5`](https://github.com/sagemath/sagetrac-mirror/commit/e6f88c5f9adef669ede74e3c161e19fe37203276)**",
    "created_at": "2014-09-07T20:19:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-222002",
    "user": "https://github.com/videlec"
}
```

Commit: **[`e6f88c5`](https://github.com/sagemath/sagetrac-mirror/commit/e6f88c5f9adef669ede74e3c161e19fe37203276)**



---

archive/issue_comments_222003.json:
```json
{
    "body": "<div id=\"comment:36\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6e9f686d323671a4927cdc081cf7b473e6d356fe\"><code>6e9f686</code></a></td><td><code>trac #16878: faster is_prime</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d7dc38918903a97af742a90050ce87c58f6f222a\"><code>d7dc389</code></a></td><td><code>trac #16878: review</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/175d6b5fd339989df12ec9c1f26d3b0d7e6dd82c\"><code>175d6b5</code></a></td><td><code>trac #16878: review 2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d55dc6737936077eeee903687207f7af54588439\"><code>d55dc67</code></a></td><td><code>trac #16878: bikeshedding</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7f6132188b7ddafd97630aaf721875f9d60a7106\"><code>7f61321</code></a></td><td><code>Reorganize is_prime_power() and next_prime() logic</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5937af54afa0562007d710c495ecd0f1160f7498\"><code>5937af5</code></a></td><td><code>Sloane considers 1 to be a prime power</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f0d716fd34029f65d0be0aa45d5cb1783f8da2f5\"><code>f0d716f</code></a></td><td><code>trac #16878: certificate flag in is_prime_power</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bfd69d3b188a8ec36ab373b4e958b54c74b64d2b\"><code>bfd69d3</code></a></td><td><code>is_prime_power() reviewer fixes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e6f88c5f9adef669ede74e3c161e19fe37203276\"><code>e6f88c5</code></a></td><td><code>trac #16878: test is_pseudoprime_small_power + clean</code></td></tr></table>\n",
    "created_at": "2014-09-07T20:19:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-222003",
    "user": "https://github.com/videlec"
}
```

<div id="comment:36"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6e9f686d323671a4927cdc081cf7b473e6d356fe"><code>6e9f686</code></a></td><td><code>trac #16878: faster is_prime</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d7dc38918903a97af742a90050ce87c58f6f222a"><code>d7dc389</code></a></td><td><code>trac #16878: review</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/175d6b5fd339989df12ec9c1f26d3b0d7e6dd82c"><code>175d6b5</code></a></td><td><code>trac #16878: review 2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d55dc6737936077eeee903687207f7af54588439"><code>d55dc67</code></a></td><td><code>trac #16878: bikeshedding</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7f6132188b7ddafd97630aaf721875f9d60a7106"><code>7f61321</code></a></td><td><code>Reorganize is_prime_power() and next_prime() logic</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5937af54afa0562007d710c495ecd0f1160f7498"><code>5937af5</code></a></td><td><code>Sloane considers 1 to be a prime power</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f0d716fd34029f65d0be0aa45d5cb1783f8da2f5"><code>f0d716f</code></a></td><td><code>trac #16878: certificate flag in is_prime_power</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bfd69d3b188a8ec36ab373b4e958b54c74b64d2b"><code>bfd69d3</code></a></td><td><code>is_prime_power() reviewer fixes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e6f88c5f9adef669ede74e3c161e19fe37203276"><code>e6f88c5</code></a></td><td><code>trac #16878: test is_pseudoprime_small_power + clean</code></td></tr></table>




---

archive/issue_comments_222004.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nIn `is_pseudoprime_small_power`, the fixed exponent bound of 1024 is clearly not acceptable.\n\nThe PARI implementation of `isprimepower()` is as follows: first do trial division by small primes up to 100. If we do not find a divisor, then find out if the number is a perfect power. This is now a lot cheaper since the exponent can be at most `log(n)/log(p)`, where `n` is the number to check and `p` the smallest prime that we didn't check in the trial division.\n\nBut overall, I would prefer PARI to add a new function `ispseudoprimepower()` such that Sage can interface it.",
    "created_at": "2014-09-09T09:14:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-222004",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:37" align="right">comment:37</div>

In `is_pseudoprime_small_power`, the fixed exponent bound of 1024 is clearly not acceptable.

The PARI implementation of `isprimepower()` is as follows: first do trial division by small primes up to 100. If we do not find a divisor, then find out if the number is a perfect power. This is now a lot cheaper since the exponent can be at most `log(n)/log(p)`, where `n` is the number to check and `p` the smallest prime that we didn't check in the trial division.

But overall, I would prefer PARI to add a new function `ispseudoprimepower()` such that Sage can interface it.



---

archive/issue_comments_222005.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nReplying to [@jdemeyer](#comment%3A37):\n> In `is_pseudoprime_small_power`, the fixed exponent bound of 1024 is clearly not acceptable.\n> \n> The PARI implementation of `isprimepower()` is as follows: first do trial division by small primes up to 100. If we do not find a divisor, then find out if the number is a perfect power. This is now a lot cheaper since the exponent can be at most `log(n)/log(p)`, where `n` is the number to check and `p` the smallest prime that we didn't check in the trial division.\n> \n> But overall, I would prefer PARI to add a new function `ispseudoprimepower()` such that Sage can interface it.\n\nMe too. I saw that you already submit the question [http://pari.math.u-bordeaux.fr/archives/pari-dev-1409/msg00011.html](http://pari.math.u-bordeaux.fr/archives/pari-dev-1409/msg00011.html)...\n\nOn the other hand, we need a reasonable fix in order to get this ticket in.\n\nVincent",
    "created_at": "2014-09-09T16:56:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-222005",
    "user": "https://github.com/videlec"
}
```

<div id="comment:38" align="right">comment:38</div>

Replying to [@jdemeyer](#comment%3A37):
> In `is_pseudoprime_small_power`, the fixed exponent bound of 1024 is clearly not acceptable.
> 
> The PARI implementation of `isprimepower()` is as follows: first do trial division by small primes up to 100. If we do not find a divisor, then find out if the number is a perfect power. This is now a lot cheaper since the exponent can be at most `log(n)/log(p)`, where `n` is the number to check and `p` the smallest prime that we didn't check in the trial division.
> 
> But overall, I would prefer PARI to add a new function `ispseudoprimepower()` such that Sage can interface it.

Me too. I saw that you already submit the question [http://pari.math.u-bordeaux.fr/archives/pari-dev-1409/msg00011.html](http://pari.math.u-bordeaux.fr/archives/pari-dev-1409/msg00011.html)...

On the other hand, we need a reasonable fix in order to get this ticket in.

Vincent



---

archive/issue_comments_222006.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nJeroen, did you end up writing a pari patch? Maybe we can use the current `is_pseudoprime_small_power` until there is a better implementation?",
    "created_at": "2014-09-23T11:26:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-222006",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:39" align="right">comment:39</div>

Jeroen, did you end up writing a pari patch? Maybe we can use the current `is_pseudoprime_small_power` until there is a better implementation?



---

archive/issue_comments_222007.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nReplying to [@vbraun](#comment%3A39):\n> Jeroen, did you end up writing a pari patch?\n\nNot yet, but it would be trivial to do that. I will add it to #16997.",
    "created_at": "2014-09-23T15:06:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-222007",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:40" align="right">comment:40</div>

Replying to [@vbraun](#comment%3A39):
> Jeroen, did you end up writing a pari patch?

Not yet, but it would be trivial to do that. I will add it to #16997.



---

archive/issue_comments_222008.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nOn the other hand, perhaps better add the patch here...",
    "created_at": "2014-09-23T16:09:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-222008",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:41" align="right">comment:41</div>

On the other hand, perhaps better add the patch here...



---

archive/issue_comments_222009.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\n...or a new ticket.",
    "created_at": "2014-09-23T16:09:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-222009",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:42" align="right">comment:42</div>

...or a new ticket.



---

archive/issue_comments_222010.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nTurns out adding the PARI patch to #16997 was the easiest (since there would have been merge conflicts otherwise). It's now done.",
    "created_at": "2014-09-23T16:29:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-222010",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:43" align="right">comment:43</div>

Turns out adding the PARI patch to #16997 was the easiest (since there would have been merge conflicts otherwise). It's now done.



---

archive/issue_events_239062.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-09-24T12:28:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16878#event-239062"
}
```



---

archive/issue_events_239063.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-09-24T12:28:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16878#event-239063"
}
```



---

archive/issue_comments_222011.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nI have now a version of #16997 which is ready for review. For this ticket, I would wait until that ticket is settled and then have a look again at this.",
    "created_at": "2014-09-24T12:28:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-222011",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:44" align="right">comment:44</div>

I have now a version of #16997 which is ready for review. For this ticket, I would wait until that ticket is settled and then have a look again at this.



---

archive/issue_comments_222012.json:
```json
{
    "body": "Changed dependencies from **#15767** to **#15767, #16997**",
    "created_at": "2014-10-21T16:55:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-222012",
    "user": "https://github.com/videlec"
}
```

Changed dependencies from **#15767** to **#15767, #16997**



---

archive/issue_comments_222013.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nHi,\n\nGood news: Karim recently committed a `ispseudoprimepower` in pari ([commit 0f20474](http://pari.math.u-bordeaux.fr/cgi-bin/gitweb.cgi?p=pari.git;a=commitdiff;h=0f20474)).\n\nVincent",
    "created_at": "2014-12-03T15:31:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-222013",
    "user": "https://github.com/videlec"
}
```

<div id="comment:46" align="right">comment:46</div>

Hi,

Good news: Karim recently committed a `ispseudoprimepower` in pari ([commit 0f20474](http://pari.math.u-bordeaux.fr/cgi-bin/gitweb.cgi?p=pari.git;a=commitdiff;h=0f20474)).

Vincent



---

archive/issue_comments_222014.json:
```json
{
    "body": "Changed dependencies from **#15767, #16997** to **#16997, #17852**",
    "created_at": "2015-02-26T10:23:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-222014",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#15767, #16997** to **#16997, #17852**



---

archive/issue_comments_222015.json:
```json
{
    "body": "Changed branch from **[u/vdelecroix/16878](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/16878)** to **[u/jdemeyer/16878](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/16878)**",
    "created_at": "2015-02-26T10:24:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-222015",
    "user": "https://github.com/jdemeyer"
}
```

Changed branch from **[u/vdelecroix/16878](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/16878)** to **[u/jdemeyer/16878](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/16878)**



---

archive/issue_comments_222016.json:
```json
{
    "body": "Changed dependencies from **#16997, #17852** to **#16997**",
    "created_at": "2015-02-26T10:25:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-222016",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#16997, #17852** to **#16997**



---

archive/issue_comments_222017.json:
```json
{
    "body": "<div id=\"comment:49\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ade4f7521ad77c03e9791bc3768d9a9e3a2daca4\"><code>ade4f75</code></a></td><td><code>Upgrade PARI to git master</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9751ee8ccf4887970ed5cea1e6f52447b633e2c3\"><code>9751ee8</code></a></td><td><code>Trac #16878: faster is_prime</code></td></tr></table>\n",
    "created_at": "2015-02-26T10:25:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-222017",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:49"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ade4f7521ad77c03e9791bc3768d9a9e3a2daca4"><code>ade4f75</code></a></td><td><code>Upgrade PARI to git master</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9751ee8ccf4887970ed5cea1e6f52447b633e2c3"><code>9751ee8</code></a></td><td><code>Trac #16878: faster is_prime</code></td></tr></table>




---

archive/issue_events_239064.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-02-26T10:25:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16878#event-239064"
}
```



---

archive/issue_events_239065.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-02-26T10:25:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16878#event-239065"
}
```



---

archive/issue_comments_222018.json:
```json
{
    "body": "Changed commit from **[`e6f88c5`](https://github.com/sagemath/sagetrac-mirror/commit/e6f88c5f9adef669ede74e3c161e19fe37203276)** to **[`9751ee8`](https://github.com/sagemath/sagetrac-mirror/commit/9751ee8ccf4887970ed5cea1e6f52447b633e2c3)**",
    "created_at": "2015-02-26T10:25:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-222018",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[`e6f88c5`](https://github.com/sagemath/sagetrac-mirror/commit/e6f88c5f9adef669ede74e3c161e19fe37203276)** to **[`9751ee8`](https://github.com/sagemath/sagetrac-mirror/commit/9751ee8ccf4887970ed5cea1e6f52447b633e2c3)**



---

archive/issue_events_239066.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-02-26T10:27:39Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16878#event-239066"
}
```



---

archive/issue_events_239067.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-02-26T10:27:39Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "milestone_number": null,
    "milestone_title": "sage-6.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16878#event-239067"
}
```



---

archive/issue_events_239068.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-02-26T10:27:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16878#event-239068"
}
```



---

archive/issue_events_239069.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-02-26T10:27:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16878#event-239069"
}
```



---

archive/issue_comments_222019.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\n(I guess you did it because of conflicts with #17852)",
    "created_at": "2015-02-26T10:30:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-222019",
    "user": "https://github.com/videlec"
}
```

<div id="comment:51" align="right">comment:51</div>

(I guess you did it because of conflicts with #17852)



---

archive/issue_comments_222020.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nI'm doing various fixes, like remove `is_pseudoprime_small_power`.\n\nI think it would be better to rebase #17852 on this ticket, since this ticket removes lots of things that #17852 fixes.",
    "created_at": "2015-02-26T10:54:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-222020",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:52" align="right">comment:52</div>

I'm doing various fixes, like remove `is_pseudoprime_small_power`.

I think it would be better to rebase #17852 on this ticket, since this ticket removes lots of things that #17852 fixes.



---

archive/issue_comments_222021.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nReplying to [@jdemeyer](#comment%3A52):\n> I'm doing various fixes, like remove `is_pseudoprime_small_power`.\n> \n> I think it would be better to rebase #17852 on this ticket, since this ticket removes lots of things that #17852 fixes.\n\nFine for me.",
    "created_at": "2015-02-26T10:57:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-222021",
    "user": "https://github.com/videlec"
}
```

<div id="comment:53" align="right">comment:53</div>

Replying to [@jdemeyer](#comment%3A52):
> I'm doing various fixes, like remove `is_pseudoprime_small_power`.
> 
> I think it would be better to rebase #17852 on this ticket, since this ticket removes lots of things that #17852 fixes.

Fine for me.



---

archive/issue_comments_222022.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nI would also like to switch around the `get_data` result: when given `p^n` as input, I would find it more natural to return `(p, n)` instead of `(n, p)`. What do you think?",
    "created_at": "2015-02-26T10:58:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-222022",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:54" align="right">comment:54</div>

I would also like to switch around the `get_data` result: when given `p^n` as input, I would find it more natural to return `(p, n)` instead of `(n, p)`. What do you think?



---

archive/issue_comments_222023.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\ngp is doing the other way around: it returns `k` as the main argument since it is compatible with the boolean answer. But doing `(p,n)` will be consistent with `Integer.perfect_power` so I would go for it.",
    "created_at": "2015-02-26T11:07:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-222023",
    "user": "https://github.com/videlec"
}
```

<div id="comment:55" align="right">comment:55</div>

gp is doing the other way around: it returns `k` as the main argument since it is compatible with the boolean answer. But doing `(p,n)` will be consistent with `Integer.perfect_power` so I would go for it.



---

archive/issue_comments_222024.json:
```json
{
    "body": "Changed commit from **[`9751ee8`](https://github.com/sagemath/sagetrac-mirror/commit/9751ee8ccf4887970ed5cea1e6f52447b633e2c3)** to **[`96f1f50`](https://github.com/sagemath/sagetrac-mirror/commit/96f1f5037d18eb3b2e4c8e0e2a9c7a5cdac0d643)**",
    "created_at": "2015-02-26T11:37:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-222024",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9751ee8`](https://github.com/sagemath/sagetrac-mirror/commit/9751ee8ccf4887970ed5cea1e6f52447b633e2c3)** to **[`96f1f50`](https://github.com/sagemath/sagetrac-mirror/commit/96f1f5037d18eb3b2e4c8e0e2a9c7a5cdac0d643)**



---

archive/issue_comments_222025.json:
```json
{
    "body": "<div id=\"comment:56\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/96f1f5037d18eb3b2e4c8e0e2a9c7a5cdac0d643\"><code>96f1f50</code></a></td><td><code>Trac #16878: further fixes to is_prime() and friends</code></td></tr></table>\n",
    "created_at": "2015-02-26T11:37:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-222025",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:56"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/96f1f5037d18eb3b2e4c8e0e2a9c7a5cdac0d643"><code>96f1f50</code></a></td><td><code>Trac #16878: further fixes to is_prime() and friends</code></td></tr></table>




---

archive/issue_comments_222026.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">comment:57</div>\n\nAs far as I'm concerned, this is the final version. If you agree, then you can set this to positive_review.\n\nI haven't yet run all doctests, doing that right now...",
    "created_at": "2015-02-26T11:38:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-222026",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:57" align="right">comment:57</div>

As far as I'm concerned, this is the final version. If you agree, then you can set this to positive_review.

I haven't yet run all doctests, doing that right now...



---

archive/issue_events_239070.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-02-26T11:38:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16878#event-239070"
}
```



---

archive/issue_events_239071.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-02-26T11:38:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16878#event-239071"
}
```



---

archive/issue_comments_222027.json:
```json
{
    "body": "Changed commit from **[`96f1f50`](https://github.com/sagemath/sagetrac-mirror/commit/96f1f5037d18eb3b2e4c8e0e2a9c7a5cdac0d643)** to **[`1f8abd9`](https://github.com/sagemath/sagetrac-mirror/commit/1f8abd999dcf4935f92b2d83aad01684397e62d1)**",
    "created_at": "2015-02-26T12:24:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-222027",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`96f1f50`](https://github.com/sagemath/sagetrac-mirror/commit/96f1f5037d18eb3b2e4c8e0e2a9c7a5cdac0d643)** to **[`1f8abd9`](https://github.com/sagemath/sagetrac-mirror/commit/1f8abd999dcf4935f92b2d83aad01684397e62d1)**



---

archive/issue_comments_222028.json:
```json
{
    "body": "<div id=\"comment:59\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1f8abd999dcf4935f92b2d83aad01684397e62d1\"><code>1f8abd9</code></a></td><td><code>Doctest fix</code></td></tr></table>\n",
    "created_at": "2015-02-26T12:24:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-222028",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:59"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1f8abd999dcf4935f92b2d83aad01684397e62d1"><code>1f8abd9</code></a></td><td><code>Doctest fix</code></td></tr></table>




---

archive/issue_comments_222029.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">comment:60</div>\n\nNow all doctests pass.",
    "created_at": "2015-02-26T12:24:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-222029",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:60" align="right">comment:60</div>

Now all doctests pass.



---

archive/issue_events_239072.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-02-26T12:28:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16878#event-239072"
}
```



---

archive/issue_events_239073.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-02-26T12:28:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16878#event-239073"
}
```



---

archive/issue_comments_222030.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">comment:61</div>\n\n1. Now `arith.is_prime_power` and `arith.is_pseudoprime_power` do not handle negative powers anymore (i.e. rational numbers `p^-n`). This is different from previous versions.\n\n2. In `Integer.is_prime_power` why did you use a `long` for `n` and `p` instead of an `unsigned long`. Is pari `uisprimepower` not able to handle up to `ULONG_MAX`?",
    "created_at": "2015-02-26T12:28:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-222030",
    "user": "https://github.com/videlec"
}
```

<div id="comment:61" align="right">comment:61</div>

1. Now `arith.is_prime_power` and `arith.is_pseudoprime_power` do not handle negative powers anymore (i.e. rational numbers `p^-n`). This is different from previous versions.

2. In `Integer.is_prime_power` why did you use a `long` for `n` and `p` instead of an `unsigned long`. Is pari `uisprimepower` not able to handle up to `ULONG_MAX`?



---

archive/issue_comments_222031.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">comment:62</div>\n\nReplying to [@videlec](#comment%3A61):\n> 1. Now `arith.is_prime_power` and `arith.is_pseudoprime_power` do not handle negative powers anymore (i.e. rational numbers `p^-n`). This is different from previous versions.\n\nYes, this was discussed on `sage-devel` and the former behaviour was considered to be a bug => no deprecation needed\n\n> 2. In `Integer.is_prime_power` why did you use a `long` for `n` and `p` instead of an `unsigned long`. Is pari `uisprimepower` not able to handle up to `ULONG_MAX`?\n\nI assume that `pari` can handle it, but `smallInteger()` for the result takes a `long`.",
    "created_at": "2015-02-26T12:32:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-222031",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:62" align="right">comment:62</div>

Replying to [@videlec](#comment%3A61):
> 1. Now `arith.is_prime_power` and `arith.is_pseudoprime_power` do not handle negative powers anymore (i.e. rational numbers `p^-n`). This is different from previous versions.

Yes, this was discussed on `sage-devel` and the former behaviour was considered to be a bug => no deprecation needed

> 2. In `Integer.is_prime_power` why did you use a `long` for `n` and `p` instead of an `unsigned long`. Is pari `uisprimepower` not able to handle up to `ULONG_MAX`?

I assume that `pari` can handle it, but `smallInteger()` for the result takes a `long`.



---

archive/issue_comments_222032.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">comment:63</div>\n\nReplying to [@jdemeyer](#comment%3A62):\n> Replying to [@videlec](#comment%3A61):\n> > 1. Now `arith.is_prime_power` and `arith.is_pseudoprime_power` do not handle negative powers anymore (i.e. rational numbers `p^-n`). This is different from previous versions.\n\n> Yes, this was discussed on `sage-devel` and the former behaviour was considered to be a bug => no deprecation needed\n\nTrue, I forgot about here and it is [this thread](https://groups.google.com/forum/#!topic/sage-devel/v6s2RI4dd1Q).\n\n> > 2. In `Integer.is_prime_power` why did you use a `long` for `n` and `p` instead of an `unsigned long`. Is pari `uisprimepower` not able to handle up to `ULONG_MAX`?\n\n> I assume that `pari` can handle it, but `smallInteger()` for the result takes a `long`.\n\nI see... I do not like the fact that we avoid pari `uisprimepower` for the range between `LONG_MAX` and `ULONG_MAX`. Especially because otherwise we import the `proof` module which takes some non negligible amount of time. We can either get rid of `smallInteger` (that would be bad if either `p` or `n` would be below `256`) or add a `smallunsignedInteger`\n\n```\ncdef inline Integer smallunsignedInteger(unsigned long value):\n    \"\"\"\n    This is the fastest way to create a (likely) small positive Integer.\n    \"\"\"\n    cdef Integer z\n    if value <= small_pool_max:\n        return <Integer>small_pool[value - small_pool_min]\n    else:\n        z = PY_NEW(Integer)\n        mpz_set_ui(z.value, value)\n        return z\n```\n\nWhat do you think?",
    "created_at": "2015-02-26T13:00:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-222032",
    "user": "https://github.com/videlec"
}
```

<div id="comment:63" align="right">comment:63</div>

Replying to [@jdemeyer](#comment%3A62):
> Replying to [@videlec](#comment%3A61):
> > 1. Now `arith.is_prime_power` and `arith.is_pseudoprime_power` do not handle negative powers anymore (i.e. rational numbers `p^-n`). This is different from previous versions.

> Yes, this was discussed on `sage-devel` and the former behaviour was considered to be a bug => no deprecation needed

True, I forgot about here and it is [this thread](https://groups.google.com/forum/#!topic/sage-devel/v6s2RI4dd1Q).

> > 2. In `Integer.is_prime_power` why did you use a `long` for `n` and `p` instead of an `unsigned long`. Is pari `uisprimepower` not able to handle up to `ULONG_MAX`?

> I assume that `pari` can handle it, but `smallInteger()` for the result takes a `long`.

I see... I do not like the fact that we avoid pari `uisprimepower` for the range between `LONG_MAX` and `ULONG_MAX`. Especially because otherwise we import the `proof` module which takes some non negligible amount of time. We can either get rid of `smallInteger` (that would be bad if either `p` or `n` would be below `256`) or add a `smallunsignedInteger`

```
cdef inline Integer smallunsignedInteger(unsigned long value):
    """
    This is the fastest way to create a (likely) small positive Integer.
    """
    cdef Integer z
    if value <= small_pool_max:
        return <Integer>small_pool[value - small_pool_min]
    else:
        z = PY_NEW(Integer)
        mpz_set_ui(z.value, value)
        return z
```

What do you think?



---

archive/issue_comments_222033.json:
```json
{
    "body": "<div id=\"comment:64\" align=\"right\">comment:64</div>\n\nTo be honest, I think introducing `smallunsignedInteger` is just overkill. I don't think it makes a big difference if the limit for a fast `is_prime_power` is `2^63` or `2^64`.",
    "created_at": "2015-02-26T13:02:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-222033",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:64" align="right">comment:64</div>

To be honest, I think introducing `smallunsignedInteger` is just overkill. I don't think it makes a big difference if the limit for a fast `is_prime_power` is `2^63` or `2^64`.



---

archive/issue_comments_222034.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -25,3 +25,5 @@\n ```\n \n We also modify `is_prime_power()` to return `False` for 1 and raise an error for non-integral rationals like `1/2`.\n+\n+See also [this sage-devel discussion](https://groups.google.com/forum/#!topic/sage-devel/v6s2RI4dd1Q).\n``````\n",
    "created_at": "2015-02-26T13:03:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-222034",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -25,3 +25,5 @@
 ```
 
 We also modify `is_prime_power()` to return `False` for 1 and raise an error for non-integral rationals like `1/2`.
+
+See also [this sage-devel discussion](https://groups.google.com/forum/#!topic/sage-devel/v6s2RI4dd1Q).
``````




---

archive/issue_events_239074.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-02-26T21:45:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16878#event-239074"
}
```



---

archive/issue_events_239075.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-02-26T21:45:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16878#event-239075"
}
```



---

archive/issue_events_239076.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-02-27T07:08:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16878#event-239076"
}
```



---

archive/issue_events_239077.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-02-27T07:08:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16878#event-239077"
}
```



---

archive/issue_comments_222035.json:
```json
{
    "body": "<div id=\"comment:67\" align=\"right\">comment:67</div>\n\nThe buildbot is complaining about a digit\n\n```\nsage -t --long --warn-long 35.8 src/sage/libs/pari/gen.pyx\n**********************************************************************\nFile \"src/sage/libs/pari/gen.pyx\", line 6237, in sage.libs.pari.gen.gen.ellheight\nFailed example:\n    e.ellheight([1,0], precision=128).sage()\nExpected:\n    0.47671165934373953737948605888465305945902294217            \nGot:\n    0.47671165934373953737948605888465305945902294218\n**********************************************************************\n```\nMight be related to the doctest failure in pari update in #16997.",
    "created_at": "2015-02-27T07:08:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-222035",
    "user": "https://github.com/videlec"
}
```

<div id="comment:67" align="right">comment:67</div>

The buildbot is complaining about a digit

```
sage -t --long --warn-long 35.8 src/sage/libs/pari/gen.pyx
**********************************************************************
File "src/sage/libs/pari/gen.pyx", line 6237, in sage.libs.pari.gen.gen.ellheight
Failed example:
    e.ellheight([1,0], precision=128).sage()
Expected:
    0.47671165934373953737948605888465305945902294217            
Got:
    0.47671165934373953737948605888465305945902294218
**********************************************************************
```
Might be related to the doctest failure in pari update in #16997.



---

archive/issue_comments_222036.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">comment:68</div>\n\nReplying to [@videlec](#comment%3A67):\n> The buildbot is complaining about a digit\n\nFixed by #16997.",
    "created_at": "2015-02-27T16:33:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-222036",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:68" align="right">comment:68</div>

Replying to [@videlec](#comment%3A67):
> The buildbot is complaining about a digit

Fixed by #16997.



---

archive/issue_events_239078.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-02-27T16:33:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16878#event-239078"
}
```



---

archive/issue_events_239079.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-02-27T16:33:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16878#event-239079"
}
```



---

archive/issue_comments_222037.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">comment:69</div>\n\nMerges cleanly with #16997 and all tests pass! Cool.\n\nVincent",
    "created_at": "2015-03-04T09:52:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-222037",
    "user": "https://github.com/videlec"
}
```

<div id="comment:69" align="right">comment:69</div>

Merges cleanly with #16997 and all tests pass! Cool.

Vincent



---

archive/issue_events_239080.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-03-04T09:52:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16878#event-239080"
}
```



---

archive/issue_events_239081.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2015-03-04T09:52:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16878#event-239081"
}
```



---

archive/issue_comments_222038.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/16878](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/16878)** to **[`1f8abd9`](https://github.com/sagemath/sagetrac-mirror/commit/1f8abd999dcf4935f92b2d83aad01684397e62d1)**",
    "created_at": "2015-03-05T09:02:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-222038",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jdemeyer/16878](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/16878)** to **[`1f8abd9`](https://github.com/sagemath/sagetrac-mirror/commit/1f8abd999dcf4935f92b2d83aad01684397e62d1)**



---

archive/issue_events_239082.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-03-05T09:02:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16878#event-239082"
}
```



---

archive/issue_events_239083.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "6f61838eafe23e7cea0880ab3a5b68a63843e318",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2015-03-05T09:02:09Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16878#event-239083"
}
```



---

archive/issue_comments_222039.json:
```json
{
    "body": "Changed commit from **[`1f8abd9`](https://github.com/sagemath/sagetrac-mirror/commit/1f8abd999dcf4935f92b2d83aad01684397e62d1)** to none",
    "created_at": "2023-01-08T08:38:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16878#issuecomment-222039",
    "user": "https://github.com/fchapoton"
}
```

Changed commit from **[`1f8abd9`](https://github.com/sagemath/sagetrac-mirror/commit/1f8abd999dcf4935f92b2d83aad01684397e62d1)** to none
