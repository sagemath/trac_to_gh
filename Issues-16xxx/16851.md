# Issue 16851: Implement direct sum and tensor products for chain complexes and Koszul complexes

archive/issues_016614.json:
```json
{
    "assignees": [
        "https://github.com/tscrim"
    ],
    "body": "There is a natural way to construct a chain complex from the direct sum (Cartesian product) and tensor product of chain complexes. This also implements Koszul complexes.\n\nCC:  @jhpalmieri\n\nComponent: **algebraic topology**\n\nAuthor: **Travis Scrimshaw**\n\nBranch/Commit: **[`2253260`](https://github.com/sagemath/sagetrac-mirror/commit/22532605d2973f86ec8f45f2f68f31c1f96481ae)**\n\nReviewer: **John Palmieri**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/16851_\n\n",
    "closed_at": "2014-09-08T08:49:00Z",
    "created_at": "2014-08-19T05:34:20Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20algebraic%20topology",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Implement direct sum and tensor products for chain complexes and Koszul complexes",
    "type": "issue",
    "updated_at": "2014-09-08T08:49:00Z",
    "url": "https://github.com/sagemath/sage/issues/16851",
    "user": "https://github.com/tscrim"
}
```
There is a natural way to construct a chain complex from the direct sum (Cartesian product) and tensor product of chain complexes. This also implements Koszul complexes.

CC:  @jhpalmieri

Component: **algebraic topology**

Author: **Travis Scrimshaw**

Branch/Commit: **[`2253260`](https://github.com/sagemath/sagetrac-mirror/commit/22532605d2973f86ec8f45f2f68f31c1f96481ae)**

Reviewer: **John Palmieri**

_Issue created by migration from https://trac.sagemath.org/ticket/16851_





---

archive/issue_events_238717.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2014-08-19T05:34:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16851",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16851#event-238717"
}
```



---

archive/issue_events_238718.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2014-08-19T05:34:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16851",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20algebraic%20topology",
    "label_color": "0000ff",
    "label_name": "c: algebraic topology",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16851#event-238718"
}
```



---

archive/issue_events_238719.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2014-08-19T05:34:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16851",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16851#event-238719"
}
```



---

archive/issue_events_238720.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2014-08-19T05:34:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16851",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16851#event-238720"
}
```



---

archive/issue_events_238721.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2014-08-19T05:34:20Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/16851",
    "subject": "https://github.com/tscrim",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16851#event-238721"
}
```



---

archive/issue_comments_221507.json:
```json
{
    "body": "Changed commit from **[`c392d1c`](https://github.com/sagemath/sagetrac-mirror/commit/c392d1c6dcd603c925ffdfbc27d26d089f422526)** to **[`0115835`](https://github.com/sagemath/sagetrac-mirror/commit/01158352cb6751e7286023c3031ad1120fa3cca1)**",
    "created_at": "2014-08-19T05:34:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16851#issuecomment-221507",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`c392d1c`](https://github.com/sagemath/sagetrac-mirror/commit/c392d1c6dcd603c925ffdfbc27d26d089f422526)** to **[`0115835`](https://github.com/sagemath/sagetrac-mirror/commit/01158352cb6751e7286023c3031ad1120fa3cca1)**



---

archive/issue_comments_221508.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e05aa556fb2d9ff0d9d3b06eed17ec38d88f3bb7\"><code>e05aa55</code></a></td><td><code>Merge branch 'develop' into u/tscrim/koszul_complexes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/01158352cb6751e7286023c3031ad1120fa3cca1\"><code>0115835</code></a></td><td><code>Finalizing for review.</code></td></tr></table>\n",
    "created_at": "2014-08-19T05:34:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16851#issuecomment-221508",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:1"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e05aa556fb2d9ff0d9d3b06eed17ec38d88f3bb7"><code>e05aa55</code></a></td><td><code>Merge branch 'develop' into u/tscrim/koszul_complexes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/01158352cb6751e7286023c3031ad1120fa3cca1"><code>0115835</code></a></td><td><code>Finalizing for review.</code></td></tr></table>




---

archive/issue_events_238722.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2014-08-19T05:35:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16851",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16851#event-238722"
}
```



---

archive/issue_comments_221509.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nFor `cartesian_product`, I think that the requirement that the degrees of the differentials of the factors must agree is completely natural, but it should be mentioned in the docstring and it should probably be doctested. Same for `tensor`.\n\nI think you can delete the line `zero = R.zero()` in `cartesian_product`.\n\nThis is odd behavior when `subdivide=True` and there is more than one factor:\n\n```\nsage: m = identity_matrix(QQ, 2)\nsage: C = ChainComplex({0:m})\nsage: ascii_art(C.cartesian_product([C,C], subdivide=True))\n            [1 0 0 0|0 0]      \n            [0 1 0 0|0 0]      \n            [0 0 1 0|0 0]      \n            [0 0 0 1|0 0]      \n            [-------+---]      \n            [0 0 0 0|1 0]      \n            [0 0 0 0|0 1]      \n 0 <-- C_1 <-------------- C_0 <-- 0 \n```\nI was expecting the matrix to have subdivisions for each factor, not just the last one. I guess iterating `matrix.block_diagonal` doesn't preserve earlier subdivisions as you add more blocks. Something similar happens with `tensor`.\n\nShould it be `tensor` or `tensor_product`?\n\nIn `cartesian_product`, is it worth pointing out that `subdivide` must be specified explicitly? That is, you can't do `C.cartesian_product(D, True)`.\n\nIn `koszul_complex.py`, is the dot intentional in\n\n```\n###################################################.#####################\n```\nIn that file, people have different styles, but I prefer importing functions only when you need them, not at the top-level. Having them at the top-level could potentially slow down startup times, I think.\n\nIn the `__classcall_private__` method for Koszul complexes, I don't understand the lines\n\n```\nif elements is None:\n    elements = R\n    if not elements:\n        ...\n```\nIf you call `KoszulComplex` with no arguments, you get an error before you reach this stage, so I think the second `if` can be skipped. I also gets various unhelpful error messages if I call `KoszulComplex(ZZ)` or `KoszulComplex(QQ)` without specifying `elements`. Maybe if `elements` is not specified, set it to an empty tuple instead? That is, if only one argument is passed, if it's an iterable, set `R` to be the parent of the first entry. Otherwise, set `R` to be that argument and set `elements` to be `()`. Or something like that.\n\nI was a little surprised that your code for Koszul complexes didn't use the tensor product you had just defined. I'm guess that your way is faster?",
    "created_at": "2014-08-30T22:37:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16851#issuecomment-221509",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:3" align="right">comment:3</div>

For `cartesian_product`, I think that the requirement that the degrees of the differentials of the factors must agree is completely natural, but it should be mentioned in the docstring and it should probably be doctested. Same for `tensor`.

I think you can delete the line `zero = R.zero()` in `cartesian_product`.

This is odd behavior when `subdivide=True` and there is more than one factor:

```
sage: m = identity_matrix(QQ, 2)
sage: C = ChainComplex({0:m})
sage: ascii_art(C.cartesian_product([C,C], subdivide=True))
            [1 0 0 0|0 0]      
            [0 1 0 0|0 0]      
            [0 0 1 0|0 0]      
            [0 0 0 1|0 0]      
            [-------+---]      
            [0 0 0 0|1 0]      
            [0 0 0 0|0 1]      
 0 <-- C_1 <-------------- C_0 <-- 0 
```
I was expecting the matrix to have subdivisions for each factor, not just the last one. I guess iterating `matrix.block_diagonal` doesn't preserve earlier subdivisions as you add more blocks. Something similar happens with `tensor`.

Should it be `tensor` or `tensor_product`?

In `cartesian_product`, is it worth pointing out that `subdivide` must be specified explicitly? That is, you can't do `C.cartesian_product(D, True)`.

In `koszul_complex.py`, is the dot intentional in

```
###################################################.#####################
```
In that file, people have different styles, but I prefer importing functions only when you need them, not at the top-level. Having them at the top-level could potentially slow down startup times, I think.

In the `__classcall_private__` method for Koszul complexes, I don't understand the lines

```
if elements is None:
    elements = R
    if not elements:
        ...
```
If you call `KoszulComplex` with no arguments, you get an error before you reach this stage, so I think the second `if` can be skipped. I also gets various unhelpful error messages if I call `KoszulComplex(ZZ)` or `KoszulComplex(QQ)` without specifying `elements`. Maybe if `elements` is not specified, set it to an empty tuple instead? That is, if only one argument is passed, if it's an iterable, set `R` to be the parent of the first entry. Otherwise, set `R` to be that argument and set `elements` to be `()`. Or something like that.

I was a little surprised that your code for Koszul complexes didn't use the tensor product you had just defined. I'm guess that your way is faster?



---

archive/issue_comments_221510.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nThanks for taking a look at this!\n\nI will make all of these changes once my Sage rebuilds (probably late tonight or tomorrow).\n\nReplying to [@jhpalmieri](#comment%3A3):\n> For `cartesian_product`, I think that the requirement that the degrees of the differentials of the factors must agree is completely natural, but it should be mentioned in the docstring and it should probably be doctested. Same for `tensor`.\n\nGood point. Will do.\n\n> I think you can delete the line `zero = R.zero()` in `cartesian_product`.\n\nNo, it's used when constructing the differentials.\n\n> This is odd behavior when `subdivide=True` and there is more than one factor:\n> \n> ```\n> sage: m = identity_matrix(QQ, 2)\n> sage: C = ChainComplex({0:m})\n> sage: ascii_art(C.cartesian_product([C,C], subdivide=True))\n>             [1 0 0 0|0 0]      \n>             [0 1 0 0|0 0]      \n>             [0 0 1 0|0 0]      \n>             [0 0 0 1|0 0]      \n>             [-------+---]      \n>             [0 0 0 0|1 0]      \n>             [0 0 0 0|0 1]      \n>  0 <-- C_1 <-------------- C_0 <-- 0 \n> ```\n> I was expecting the matrix to have subdivisions for each factor, not just the last one. I guess iterating `matrix.block_diagonal` doesn't preserve earlier subdivisions as you add more blocks.\n\nI can fix this for the Cartesian product (which I could actually make smarter and faster). Will change.\n\n> Something similar happens with `tensor`.\n\nThis one I'm not entirely sure I can fix. Would you be okay with just a `TODO` comment in the doc about this if I can't fix it?\n\n> Should it be `tensor` or `tensor_product`?\n\nThe functorial construction is `tensor`, so I have to use that.\n\n> In `cartesian_product`, is it worth pointing out that `subdivide` must be specified explicitly? That is, you can't do `C.cartesian_product(D, True)`.\n\nSince it is part of the explicit arguments (which shows up under `?`), and we expect the user to have a basic knowledge of python syntax, I don't want to put any comments about this.\n\n> In `koszul_complex.py`, is the dot intentional in\n> \n> ```\n> ###################################################.#####################\n> ```\n\nNo, that's a typo.\n\n> In that file, people have different styles, but I prefer importing functions only when you need them, not at the top-level. Having them at the top-level could potentially slow down startup times, I think.\n\nImporting them at the top-level makes the call to the function faster, which is much more important in this case. However we can lazy import the `koszul_complex.py` module, which we should do since I feel that it's not likely too many people will use this.\n\n> In the `__classcall_private__` method for Koszul complexes, I don't understand the lines\n> \n> ```\n> if elements is None:\n>     elements = R\n>     if not elements:\n>         ...\n> ```\n> If you call `KoszulComplex` with no arguments, you get an error before you reach this stage, so I think the second `if` can be skipped. I also gets various unhelpful error messages if I call `KoszulComplex(ZZ)` or `KoszulComplex(QQ)` without specifying `elements`. Maybe if `elements` is not specified, set it to an empty tuple instead? That is, if only one argument is passed, if it's an iterable, set `R` to be the parent of the first entry. Otherwise, set `R` to be that argument and set `elements` to be `()`. Or something like that.\n\nIt was for passing in a list (tuple) of 0 elements. You are right and that I should better handle when passing a base ring with no arguments. Will fix.\n\n> I was a little surprised that your code for Koszul complexes didn't use the tensor product you had just defined. I'm guess that your way is faster?\n\nYes, especially for large number of elements (I don't believe that my code for the tensor product is fast at all and probably could be improved).",
    "created_at": "2014-08-31T00:40:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16851#issuecomment-221510",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:4" align="right">comment:4</div>

Thanks for taking a look at this!

I will make all of these changes once my Sage rebuilds (probably late tonight or tomorrow).

Replying to [@jhpalmieri](#comment%3A3):
> For `cartesian_product`, I think that the requirement that the degrees of the differentials of the factors must agree is completely natural, but it should be mentioned in the docstring and it should probably be doctested. Same for `tensor`.

Good point. Will do.

> I think you can delete the line `zero = R.zero()` in `cartesian_product`.

No, it's used when constructing the differentials.

> This is odd behavior when `subdivide=True` and there is more than one factor:
> 
> ```
> sage: m = identity_matrix(QQ, 2)
> sage: C = ChainComplex({0:m})
> sage: ascii_art(C.cartesian_product([C,C], subdivide=True))
>             [1 0 0 0|0 0]      
>             [0 1 0 0|0 0]      
>             [0 0 1 0|0 0]      
>             [0 0 0 1|0 0]      
>             [-------+---]      
>             [0 0 0 0|1 0]      
>             [0 0 0 0|0 1]      
>  0 <-- C_1 <-------------- C_0 <-- 0 
> ```
> I was expecting the matrix to have subdivisions for each factor, not just the last one. I guess iterating `matrix.block_diagonal` doesn't preserve earlier subdivisions as you add more blocks.

I can fix this for the Cartesian product (which I could actually make smarter and faster). Will change.

> Something similar happens with `tensor`.

This one I'm not entirely sure I can fix. Would you be okay with just a `TODO` comment in the doc about this if I can't fix it?

> Should it be `tensor` or `tensor_product`?

The functorial construction is `tensor`, so I have to use that.

> In `cartesian_product`, is it worth pointing out that `subdivide` must be specified explicitly? That is, you can't do `C.cartesian_product(D, True)`.

Since it is part of the explicit arguments (which shows up under `?`), and we expect the user to have a basic knowledge of python syntax, I don't want to put any comments about this.

> In `koszul_complex.py`, is the dot intentional in
> 
> ```
> ###################################################.#####################
> ```

No, that's a typo.

> In that file, people have different styles, but I prefer importing functions only when you need them, not at the top-level. Having them at the top-level could potentially slow down startup times, I think.

Importing them at the top-level makes the call to the function faster, which is much more important in this case. However we can lazy import the `koszul_complex.py` module, which we should do since I feel that it's not likely too many people will use this.

> In the `__classcall_private__` method for Koszul complexes, I don't understand the lines
> 
> ```
> if elements is None:
>     elements = R
>     if not elements:
>         ...
> ```
> If you call `KoszulComplex` with no arguments, you get an error before you reach this stage, so I think the second `if` can be skipped. I also gets various unhelpful error messages if I call `KoszulComplex(ZZ)` or `KoszulComplex(QQ)` without specifying `elements`. Maybe if `elements` is not specified, set it to an empty tuple instead? That is, if only one argument is passed, if it's an iterable, set `R` to be the parent of the first entry. Otherwise, set `R` to be that argument and set `elements` to be `()`. Or something like that.

It was for passing in a list (tuple) of 0 elements. You are right and that I should better handle when passing a base ring with no arguments. Will fix.

> I was a little surprised that your code for Koszul complexes didn't use the tensor product you had just defined. I'm guess that your way is faster?

Yes, especially for large number of elements (I don't believe that my code for the tensor product is fast at all and probably could be improved).



---

archive/issue_comments_221511.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nReplying to [@tscrim](#comment%3A4):\n> > I think you can delete the line `zero = R.zero()` in `cartesian_product`.\n\n> \n> No, it's used when constructing the differentials.\n\nBefore it gets used, `zero` is redefined by `zero = matrix(R, [])`, isn't it?\n\n> > Something similar happens with `tensor`.\n\n> \n> This one I'm not entirely sure I can fix. Would you be okay with just a `TODO` comment in the doc about this if I can't fix it?\n\nSure.\n\n> > In that file, people have different styles, but I prefer importing functions only when you need them, not at the top-level. Having them at the top-level could potentially slow down startup times, I think.\n\n> \n> Importing them at the top-level makes the call to the function faster\n\nJust for the first call, right?\n\n> However we can lazy import the `koszul_complex.py` module, which we should do since I feel that it's not likely too many people will use this.\n\nSounds good.",
    "created_at": "2014-08-31T01:10:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16851#issuecomment-221511",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:5" align="right">comment:5</div>

Replying to [@tscrim](#comment%3A4):
> > I think you can delete the line `zero = R.zero()` in `cartesian_product`.

> 
> No, it's used when constructing the differentials.

Before it gets used, `zero` is redefined by `zero = matrix(R, [])`, isn't it?

> > Something similar happens with `tensor`.

> 
> This one I'm not entirely sure I can fix. Would you be okay with just a `TODO` comment in the doc about this if I can't fix it?

Sure.

> > In that file, people have different styles, but I prefer importing functions only when you need them, not at the top-level. Having them at the top-level could potentially slow down startup times, I think.

> 
> Importing them at the top-level makes the call to the function faster

Just for the first call, right?

> However we can lazy import the `koszul_complex.py` module, which we should do since I feel that it's not likely too many people will use this.

Sounds good.



---

archive/issue_comments_221512.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@jhpalmieri](#comment%3A5):\n> Before it gets used, `zero` is redefined by `zero = matrix(R, [])`, isn't it?\n\n*facepalm*\n\n> > Importing them at the top-level makes the call to the function faster\n\n> \n> Just for the first call, right?\n\nNo, every call. If we lazily import them, then its only on the first call. However this is moot because...\n\n> > However we can lazy import the `koszul_complex.py` module, which we should do since I feel that it's not likely too many people will use this.\n\n> \n> Sounds good.\n\n...it will only get imported (into the module's scope) when the lazy import gets resolved.",
    "created_at": "2014-08-31T01:19:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16851#issuecomment-221512",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@jhpalmieri](#comment%3A5):
> Before it gets used, `zero` is redefined by `zero = matrix(R, [])`, isn't it?

*facepalm*

> > Importing them at the top-level makes the call to the function faster

> 
> Just for the first call, right?

No, every call. If we lazily import them, then its only on the first call. However this is moot because...

> > However we can lazy import the `koszul_complex.py` module, which we should do since I feel that it's not likely too many people will use this.

> 
> Sounds good.

...it will only get imported (into the module's scope) when the lazy import gets resolved.



---

archive/issue_comments_221513.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/58bf48c180cf3fe8de2d18bcfe35a12b185782f3\"><code>58bf48c</code></a></td><td><code>Merge branch 'u/tscrim/koszul_complexes' of trac.sagemath.org:sage into u/tscrim/koszul_complexes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/990c0dce6e53a005eb2b3cd44709379f5d7bf242\"><code>990c0dc</code></a></td><td><code>Fixes from John's comments.</code></td></tr></table>\n",
    "created_at": "2014-08-31T02:44:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16851#issuecomment-221513",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/58bf48c180cf3fe8de2d18bcfe35a12b185782f3"><code>58bf48c</code></a></td><td><code>Merge branch 'u/tscrim/koszul_complexes' of trac.sagemath.org:sage into u/tscrim/koszul_complexes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/990c0dce6e53a005eb2b3cd44709379f5d7bf242"><code>990c0dc</code></a></td><td><code>Fixes from John's comments.</code></td></tr></table>




---

archive/issue_comments_221514.json:
```json
{
    "body": "Changed commit from **[`0115835`](https://github.com/sagemath/sagetrac-mirror/commit/01158352cb6751e7286023c3031ad1120fa3cca1)** to **[`990c0dc`](https://github.com/sagemath/sagetrac-mirror/commit/990c0dce6e53a005eb2b3cd44709379f5d7bf242)**",
    "created_at": "2014-08-31T02:44:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16851#issuecomment-221514",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0115835`](https://github.com/sagemath/sagetrac-mirror/commit/01158352cb6751e7286023c3031ad1120fa3cca1)** to **[`990c0dc`](https://github.com/sagemath/sagetrac-mirror/commit/990c0dce6e53a005eb2b3cd44709379f5d7bf242)**



---

archive/issue_comments_221515.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nOkay, now with a smarter algorithm for `cartesian_product` (it is probably faster than before too, but I didn't check), we can now do `KoszulComplex()`, `KoszulComplex(ZZ)`, `KoszulComplex([])`, and `KoszulComplex(ZZ, [])` and get the same results (plus `KoszulComplex(QQ)` works too), and other fixes based off your comments.",
    "created_at": "2014-08-31T02:47:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16851#issuecomment-221515",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:8" align="right">comment:8</div>

Okay, now with a smarter algorithm for `cartesian_product` (it is probably faster than before too, but I didn't check), we can now do `KoszulComplex()`, `KoszulComplex(ZZ)`, `KoszulComplex([])`, and `KoszulComplex(ZZ, [])` and get the same results (plus `KoszulComplex(QQ)` works too), and other fixes based off your comments.



---

archive/issue_comments_221516.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nThe tensor product doesn't work if the chain complex is graded over a free abelian group: computing `(-1)^a` fails in this case, because `a` is a group element, not an integer. So you need to test for this case and replace `a` with `sum(a)` or something similar. (See also the `total_degree` function in my branch at #16508.)\n\nA related problem: if the differential has degree `d`, then I think the correct formula for the differential on the tensor product `x tensor y` involves the sign `(-1)^(|x| * |d|)`, where `|d|` is the degree of the differential on the second factor. With this sign convention (or with your choice of `(-1)^|x|`), if `C` and `D` are chain complexes with differentials of even degree, their tensor product will probably not be a chain complex any more, because the differential won't square to zero. It would be a good idea to add a warning about this in the documentation. (I know why you might want to grade over an arbitrary free abelian group, but I don't know why you would want a differential of even degree, so this is probably not a big deal.)\n\nOh, and `cartesian_product` fails if graded over something other than `ZZ`, because the grading group needs to be explicitly stated if it's not `ZZ`. So something like this should fix it:\n\n```diff\ndiff --git a/src/sage/homology/chain_complex.py b/src/sage/homology/chain_complex.py\nindex 1c6fdfb..29ce6e7 100644\n--- a/src/sage/homology/chain_complex.py\n+++ b/src/sage/homology/chain_complex.py\n@@ -1758,7 +1758,8 @@ class ChainComplex_class(Parent):\n         ret = {k: matrix.block_diagonal([d.get(k, zero) for d in diffs],\n                                          subdivide=subdivide)\n                for k in keys}\n-        return ChainComplex(ret, degree_of_differential=deg_diff)\n+        return ChainComplex(ret, degree_of_differential=deg_diff,\n+                            grading_group=self._grading_group)\n \n     def tensor(self, *factors, **kwds):\n         r\"\"\"\n```\nYou'll need a similar change at the end of the `tensor` method.",
    "created_at": "2014-09-04T19:37:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16851#issuecomment-221516",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:9" align="right">comment:9</div>

The tensor product doesn't work if the chain complex is graded over a free abelian group: computing `(-1)^a` fails in this case, because `a` is a group element, not an integer. So you need to test for this case and replace `a` with `sum(a)` or something similar. (See also the `total_degree` function in my branch at #16508.)

A related problem: if the differential has degree `d`, then I think the correct formula for the differential on the tensor product `x tensor y` involves the sign `(-1)^(|x| * |d|)`, where `|d|` is the degree of the differential on the second factor. With this sign convention (or with your choice of `(-1)^|x|`), if `C` and `D` are chain complexes with differentials of even degree, their tensor product will probably not be a chain complex any more, because the differential won't square to zero. It would be a good idea to add a warning about this in the documentation. (I know why you might want to grade over an arbitrary free abelian group, but I don't know why you would want a differential of even degree, so this is probably not a big deal.)

Oh, and `cartesian_product` fails if graded over something other than `ZZ`, because the grading group needs to be explicitly stated if it's not `ZZ`. So something like this should fix it:

```diff
diff --git a/src/sage/homology/chain_complex.py b/src/sage/homology/chain_complex.py
index 1c6fdfb..29ce6e7 100644
--- a/src/sage/homology/chain_complex.py
+++ b/src/sage/homology/chain_complex.py
@@ -1758,7 +1758,8 @@ class ChainComplex_class(Parent):
         ret = {k: matrix.block_diagonal([d.get(k, zero) for d in diffs],
                                          subdivide=subdivide)
                for k in keys}
-        return ChainComplex(ret, degree_of_differential=deg_diff)
+        return ChainComplex(ret, degree_of_differential=deg_diff,
+                            grading_group=self._grading_group)
 
     def tensor(self, *factors, **kwds):
         r"""
```
You'll need a similar change at the end of the `tensor` method.



---

archive/issue_comments_221517.json:
```json
{
    "body": "<div id=\"comment:10\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/58b45d9b8aa6366b5d8c54edc320e0ec503b3d93\"><code>58b45d9</code></a></td><td><code>Added support for general grading groups.</code></td></tr></table>\n",
    "created_at": "2014-09-05T23:11:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16851#issuecomment-221517",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:10"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/58b45d9b8aa6366b5d8c54edc320e0ec503b3d93"><code>58b45d9</code></a></td><td><code>Added support for general grading groups.</code></td></tr></table>




---

archive/issue_comments_221518.json:
```json
{
    "body": "Changed commit from **[`990c0dc`](https://github.com/sagemath/sagetrac-mirror/commit/990c0dce6e53a005eb2b3cd44709379f5d7bf242)** to **[`58b45d9`](https://github.com/sagemath/sagetrac-mirror/commit/58b45d9b8aa6366b5d8c54edc320e0ec503b3d93)**",
    "created_at": "2014-09-05T23:11:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16851#issuecomment-221518",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`990c0dc`](https://github.com/sagemath/sagetrac-mirror/commit/990c0dce6e53a005eb2b3cd44709379f5d7bf242)** to **[`58b45d9`](https://github.com/sagemath/sagetrac-mirror/commit/58b45d9b8aa6366b5d8c54edc320e0ec503b3d93)**



---

archive/issue_comments_221519.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nFixed<sup>3</sup>.",
    "created_at": "2014-09-05T23:11:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16851#issuecomment-221519",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:11" align="right">comment:11</div>

Fixed<sup>3</sup>.



---

archive/issue_comments_221520.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nIt looks like the sign in the tensor product doesn't involve the degree of the differential. Otherwise, everything looks okay.",
    "created_at": "2014-09-06T02:42:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16851#issuecomment-221520",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:12" align="right">comment:12</div>

It looks like the sign in the tensor product doesn't involve the degree of the differential. Otherwise, everything looks okay.



---

archive/issue_comments_221521.json:
```json
{
    "body": "<div id=\"comment:13\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/22532605d2973f86ec8f45f2f68f31c1f96481ae\"><code>2253260</code></a></td><td><code>Added the diff degree to the scalar computation.</code></td></tr></table>\n",
    "created_at": "2014-09-06T04:01:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16851#issuecomment-221521",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:13"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/22532605d2973f86ec8f45f2f68f31c1f96481ae"><code>2253260</code></a></td><td><code>Added the diff degree to the scalar computation.</code></td></tr></table>




---

archive/issue_comments_221522.json:
```json
{
    "body": "Changed commit from **[`58b45d9`](https://github.com/sagemath/sagetrac-mirror/commit/58b45d9b8aa6366b5d8c54edc320e0ec503b3d93)** to **[`2253260`](https://github.com/sagemath/sagetrac-mirror/commit/22532605d2973f86ec8f45f2f68f31c1f96481ae)**",
    "created_at": "2014-09-06T04:01:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16851#issuecomment-221522",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`58b45d9`](https://github.com/sagemath/sagetrac-mirror/commit/58b45d9b8aa6366b5d8c54edc320e0ec503b3d93)** to **[`2253260`](https://github.com/sagemath/sagetrac-mirror/commit/22532605d2973f86ec8f45f2f68f31c1f96481ae)**



---

archive/issue_comments_221523.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nWhoops; fixed.",
    "created_at": "2014-09-06T04:03:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16851#issuecomment-221523",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:14" align="right">comment:14</div>

Whoops; fixed.



---

archive/issue_comments_221524.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nOkay, I'm happy with this now.",
    "created_at": "2014-09-06T04:46:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16851#issuecomment-221524",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:15" align="right">comment:15</div>

Okay, I'm happy with this now.



---

archive/issue_events_238723.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2014-09-06T04:46:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16851",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16851#event-238723"
}
```



---

archive/issue_events_238724.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2014-09-06T04:46:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16851",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16851#event-238724"
}
```



---

archive/issue_comments_221525.json:
```json
{
    "body": "Reviewer: **John Palmieri**",
    "created_at": "2014-09-06T04:46:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16851#issuecomment-221525",
    "user": "https://github.com/jhpalmieri"
}
```

Reviewer: **John Palmieri**



---

archive/issue_comments_221526.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nThanks for doing the review.",
    "created_at": "2014-09-06T05:06:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16851#issuecomment-221526",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:16" align="right">comment:16</div>

Thanks for doing the review.



---

archive/issue_events_238725.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-09-08T08:49:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16851",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16851#event-238725"
}
```



---

archive/issue_events_238726.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "3e181a6668096f4e269f84805774cfda665af0c1",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2014-09-08T08:49:00Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/16851",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16851#event-238726"
}
```



---

archive/issue_comments_221527.json:
```json
{
    "body": "Changed branch from **[u/tscrim/koszul_complexes](https://github.com/sagemath/sagetrac-mirror/tree/u/tscrim/koszul_complexes)** to **[`2253260`](https://github.com/sagemath/sagetrac-mirror/commit/22532605d2973f86ec8f45f2f68f31c1f96481ae)**",
    "created_at": "2014-09-08T08:49:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16851",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16851#issuecomment-221527",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/tscrim/koszul_complexes](https://github.com/sagemath/sagetrac-mirror/tree/u/tscrim/koszul_complexes)** to **[`2253260`](https://github.com/sagemath/sagetrac-mirror/commit/22532605d2973f86ec8f45f2f68f31c1f96481ae)**
