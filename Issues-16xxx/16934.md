# Issue 16934: Fix factory keys for finite fields to avoid repeated construction

archive/issues_016697.json:
```json
{
    "body": "The following sequence of commands somehow breaks the coercion framework. This is on vanilla Sage 6.4.beta1. The problem only occurs if `impl=\"pari_ffelt\"` is explicitly given, even though that is the default:\n\n```\nsage: k1.<a> = GF(17^14, impl=\"pari_ffelt\")\nsage: _ = PolynomialRing(k1, 'x')(a/2)\nsage: k2.<a> = GF(17^14, impl=\"pari_ffelt\")\nsage: _ = PolynomialRing(k2, 'x')(a/2)\nTraceback (most recent call last):\n...\nTypeError: no coercion defined\n```\n\nThe underlying reason is:\n\n```\nsage: k1 is k2\nFalse\n```\nThis double construction of the same finite field is caused by slightly different `UniqueFactory` keys arising during the construction of a common parent (for the computation of `a/2`) by the coercion system.\n\nRelated: #16855\n\nBranch/Commit: 9cbdcde41b4783e7adf3f56451b9dedd36842f1d\n\nReviewer: Jeroen Demeyer\n\nAuthor: Peter Bruin\n\nDependencies: #16930\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/16934\n\n",
    "closed_at": "2014-09-16T18:46:36Z",
    "created_at": "2014-09-04T14:44:21Z",
    "labels": [
        "component: finite rings",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Fix factory keys for finite fields to avoid repeated construction",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16934",
    "user": "https://github.com/jdemeyer"
}
```
The following sequence of commands somehow breaks the coercion framework. This is on vanilla Sage 6.4.beta1. The problem only occurs if `impl="pari_ffelt"` is explicitly given, even though that is the default:

```
sage: k1.<a> = GF(17^14, impl="pari_ffelt")
sage: _ = PolynomialRing(k1, 'x')(a/2)
sage: k2.<a> = GF(17^14, impl="pari_ffelt")
sage: _ = PolynomialRing(k2, 'x')(a/2)
Traceback (most recent call last):
...
TypeError: no coercion defined
```

The underlying reason is:

```
sage: k1 is k2
False
```
This double construction of the same finite field is caused by slightly different `UniqueFactory` keys arising during the construction of a common parent (for the computation of `a/2`) by the coercion system.

Related: #16855

Branch/Commit: 9cbdcde41b4783e7adf3f56451b9dedd36842f1d

Reviewer: Jeroen Demeyer

Author: Peter Bruin

Dependencies: #16930

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/16934





---

archive/issue_comments_288259.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,7 +4,7 @@\n sage: k.<a> = GF(17^14, impl=\"pari_ffelt\")\n sage: _ = EllipticCurve_from_j(a^584645231109031).cardinality()\n sage: k.<a> = GF(17^14, impl=\"pari_ffelt\")\n-sage: _ = EllipticCurve_from_j(a^584645231109031).cardinality()\n+sage: E = EllipticCurve_from_j(a^584645231109031)\n TypeError                                 Traceback (most recent call last)\n [...]\n TypeError: no coercion defined\n``````\n",
    "created_at": "2014-09-04T14:52:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-288259",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,7 +4,7 @@
 sage: k.<a> = GF(17^14, impl="pari_ffelt")
 sage: _ = EllipticCurve_from_j(a^584645231109031).cardinality()
 sage: k.<a> = GF(17^14, impl="pari_ffelt")
-sage: _ = EllipticCurve_from_j(a^584645231109031).cardinality()
+sage: E = EllipticCurve_from_j(a^584645231109031)
 TypeError                                 Traceback (most recent call last)
 [...]
 TypeError: no coercion defined
``````




---

archive/issue_comments_288260.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,9 +2,11 @@\n \n ```\n sage: k.<a> = GF(17^14, impl=\"pari_ffelt\")\n-sage: _ = EllipticCurve_from_j(a^584645231109031).cardinality()\n+sage: E1 = EllipticCurve_from_j(a^584645231109031)\n+sage: E2 = EllipticCurve_from_j(a^584645231109031)\n+sage: _ = E1.is_isomorphic(E2)\n sage: k.<a> = GF(17^14, impl=\"pari_ffelt\")\n-sage: E = EllipticCurve_from_j(a^584645231109031)\n+sage: E3 = EllipticCurve_from_j(a^584645231109031)\n TypeError                                 Traceback (most recent call last)\n [...]\n TypeError: no coercion defined\n``````\n",
    "created_at": "2014-09-04T14:55:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-288260",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,9 +2,11 @@
 
 ```
 sage: k.<a> = GF(17^14, impl="pari_ffelt")
-sage: _ = EllipticCurve_from_j(a^584645231109031).cardinality()
+sage: E1 = EllipticCurve_from_j(a^584645231109031)
+sage: E2 = EllipticCurve_from_j(a^584645231109031)
+sage: _ = E1.is_isomorphic(E2)
 sage: k.<a> = GF(17^14, impl="pari_ffelt")
-sage: E = EllipticCurve_from_j(a^584645231109031)
+sage: E3 = EllipticCurve_from_j(a^584645231109031)
 TypeError                                 Traceback (most recent call last)
 [...]
 TypeError: no coercion defined
``````




---

archive/issue_comments_288261.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -12,4 +12,4 @@\n TypeError: no coercion defined\n ```\n \n-Remark: the value `a^584645231109031` is chosen to lie in the subfield `GF(17^2)`, an elliptic curve over this field is created in the `cardinality()` call.\n+Remark: the value `a^584645231109031` is chosen to lie in the subfield `GF(17^2)`.\n``````\n",
    "created_at": "2014-09-04T14:55:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-288261",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -12,4 +12,4 @@
 TypeError: no coercion defined
 ```
 
-Remark: the value `a^584645231109031` is chosen to lie in the subfield `GF(17^2)`, an elliptic curve over this field is created in the `cardinality()` call.
+Remark: the value `a^584645231109031` is chosen to lie in the subfield `GF(17^2)`.
``````




---

archive/issue_comments_288262.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,11 +2,10 @@\n \n ```\n sage: k.<a> = GF(17^14, impl=\"pari_ffelt\")\n-sage: E1 = EllipticCurve_from_j(a^584645231109031)\n-sage: E2 = EllipticCurve_from_j(a^584645231109031)\n-sage: _ = E1.is_isomorphic(E2)\n+sage: E = EllipticCurve_from_j(a)\n+sage: _ = E.is_isomorphic(E)\n sage: k.<a> = GF(17^14, impl=\"pari_ffelt\")\n-sage: E3 = EllipticCurve_from_j(a^584645231109031)\n+sage: E = EllipticCurve_from_j(a)\n TypeError                                 Traceback (most recent call last)\n [...]\n TypeError: no coercion defined\n``````\n",
    "created_at": "2014-09-04T14:57:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-288262",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,11 +2,10 @@
 
 ```
 sage: k.<a> = GF(17^14, impl="pari_ffelt")
-sage: E1 = EllipticCurve_from_j(a^584645231109031)
-sage: E2 = EllipticCurve_from_j(a^584645231109031)
-sage: _ = E1.is_isomorphic(E2)
+sage: E = EllipticCurve_from_j(a)
+sage: _ = E.is_isomorphic(E)
 sage: k.<a> = GF(17^14, impl="pari_ffelt")
-sage: E3 = EllipticCurve_from_j(a^584645231109031)
+sage: E = EllipticCurve_from_j(a)
 TypeError                                 Traceback (most recent call last)
 [...]
 TypeError: no coercion defined
``````




---

archive/issue_comments_288263.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -10,5 +10,3 @@\n [...]\n TypeError: no coercion defined\n ```\n-\n-Remark: the value `a^584645231109031` is chosen to lie in the subfield `GF(17^2)`.\n``````\n",
    "created_at": "2014-09-04T14:57:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-288263",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -10,5 +10,3 @@
 [...]
 TypeError: no coercion defined
 ```
-
-Remark: the value `a^584645231109031` is chosen to lie in the subfield `GF(17^2)`.
``````




---

archive/issue_comments_288264.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,10 +2,9 @@\n \n ```\n sage: k.<a> = GF(17^14, impl=\"pari_ffelt\")\n-sage: E = EllipticCurve_from_j(a)\n-sage: _ = E.is_isomorphic(E)\n+sage: E = EllipticCurve_from_j(a/2)\n sage: k.<a> = GF(17^14, impl=\"pari_ffelt\")\n-sage: E = EllipticCurve_from_j(a)\n+sage: E = EllipticCurve_from_j(a/2)\n TypeError                                 Traceback (most recent call last)\n [...]\n TypeError: no coercion defined\n``````\n",
    "created_at": "2014-09-04T15:08:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-288264",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,10 +2,9 @@
 
 ```
 sage: k.<a> = GF(17^14, impl="pari_ffelt")
-sage: E = EllipticCurve_from_j(a)
-sage: _ = E.is_isomorphic(E)
+sage: E = EllipticCurve_from_j(a/2)
 sage: k.<a> = GF(17^14, impl="pari_ffelt")
-sage: E = EllipticCurve_from_j(a)
+sage: E = EllipticCurve_from_j(a/2)
 TypeError                                 Traceback (most recent call last)
 [...]
 TypeError: no coercion defined
``````




---

archive/issue_comments_288265.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,9 +2,9 @@\n \n ```\n sage: k.<a> = GF(17^14, impl=\"pari_ffelt\")\n-sage: E = EllipticCurve_from_j(a/2)\n+sage: _ = PolynomialRing(k, 'x')(a/2)\n sage: k.<a> = GF(17^14, impl=\"pari_ffelt\")\n-sage: E = EllipticCurve_from_j(a/2)\n+sage: _ = PolynomialRing(k, 'x')(a/2)\n TypeError                                 Traceback (most recent call last)\n [...]\n TypeError: no coercion defined\n``````\n",
    "created_at": "2014-09-04T15:20:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-288265",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,9 +2,9 @@
 
 ```
 sage: k.<a> = GF(17^14, impl="pari_ffelt")
-sage: E = EllipticCurve_from_j(a/2)
+sage: _ = PolynomialRing(k, 'x')(a/2)
 sage: k.<a> = GF(17^14, impl="pari_ffelt")
-sage: E = EllipticCurve_from_j(a/2)
+sage: _ = PolynomialRing(k, 'x')(a/2)
 TypeError                                 Traceback (most recent call last)
 [...]
 TypeError: no coercion defined
``````




---

archive/issue_comments_288266.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,7 +5,7 @@\n sage: _ = PolynomialRing(k, 'x')(a/2)\n sage: k.<a> = GF(17^14, impl=\"pari_ffelt\")\n sage: _ = PolynomialRing(k, 'x')(a/2)\n-TypeError                                 Traceback (most recent call last)\n-[...]\n+Traceback (most recent call last):\n+...\n TypeError: no coercion defined\n ```\n``````\n",
    "created_at": "2014-09-04T15:21:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-288266",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,7 +5,7 @@
 sage: _ = PolynomialRing(k, 'x')(a/2)
 sage: k.<a> = GF(17^14, impl="pari_ffelt")
 sage: _ = PolynomialRing(k, 'x')(a/2)
-TypeError                                 Traceback (most recent call last)
-[...]
+Traceback (most recent call last):
+...
 TypeError: no coercion defined
 ```
``````




---

archive/issue_comments_288267.json:
```json
{
    "body": "<a id='comment:9'></a>\nI don't claim to know what is going on, but it may be caused by equality and identity not being the same for finite fields; #16855 seems to fix this bug.",
    "created_at": "2014-09-04T15:37:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-288267",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:9'></a>
I don't claim to know what is going on, but it may be caused by equality and identity not being the same for finite fields; #16855 seems to fix this bug.



---

archive/issue_comments_288268.json:
```json
{
    "body": "<a id='comment:10'></a>\nThis guess is corroborated by the fact that the following change also appears to fix the bug:\n\n```diff\n--- a/src/sage/rings/finite_rings/element_pari_ffelt.pyx\n+++ b/src/sage/rings/finite_rings/element_pari_ffelt.pyx\n@@ -202,7 +202,7 @@ cdef class FiniteFieldElement_pari_ffelt(FinitePolyExtElement):\n         cdef Integer xi\n\n         if isinstance(x, FiniteFieldElement_pari_ffelt):\n-            if self._parent is (<FiniteFieldElement_pari_ffelt>x)._parent:\n+            if self._parent == (<FiniteFieldElement_pari_ffelt>x)._parent:\n                 pari_catch_sig_on()\n                 self.construct((<FiniteFieldElement_pari_ffelt>x).val)\n             else:\n```\nAfter #16855, this change effectively does nothing.",
    "created_at": "2014-09-04T16:08:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-288268",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:10'></a>
This guess is corroborated by the fact that the following change also appears to fix the bug:

```diff
--- a/src/sage/rings/finite_rings/element_pari_ffelt.pyx
+++ b/src/sage/rings/finite_rings/element_pari_ffelt.pyx
@@ -202,7 +202,7 @@ cdef class FiniteFieldElement_pari_ffelt(FinitePolyExtElement):
         cdef Integer xi

         if isinstance(x, FiniteFieldElement_pari_ffelt):
-            if self._parent is (<FiniteFieldElement_pari_ffelt>x)._parent:
+            if self._parent == (<FiniteFieldElement_pari_ffelt>x)._parent:
                 pari_catch_sig_on()
                 self.construct((<FiniteFieldElement_pari_ffelt>x).val)
             else:
```
After #16855, this change effectively does nothing.



---

archive/issue_comments_288269.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [pbruin](#comment%3A10):\n> {{{\n> #!diff\n> --- a/src/sage/rings/finite_rings/element_pari_ffelt.pyx\n> +++ b/src/sage/rings/finite_rings/element_pari_ffelt.pyx\n> `@``@` -202,7 +202,7 `@``@` cdef class FiniteFieldElement_pari_ffelt(FinitePolyExtElement):\n>          cdef Integer xi\n> \n>          if isinstance(x, FiniteFieldElement_pari_ffelt):\n> -            if self._parent is (<FiniteFieldElement_pari_ffelt>x)._parent:\n> +            if self._parent == (<FiniteFieldElement_pari_ffelt>x)._parent:\n>                  pari_catch_sig_on()\n>                  self.construct((<FiniteFieldElement_pari_ffelt>x).val)\n>              else:\n> }}}\n\n\nWould you propose to make the above change, or simply to close as ticket as dupe of #16855?",
    "created_at": "2014-09-04T18:12:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-288269",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>
Replying to [pbruin](#comment%3A10):
> {{{
> #!diff
> --- a/src/sage/rings/finite_rings/element_pari_ffelt.pyx
> +++ b/src/sage/rings/finite_rings/element_pari_ffelt.pyx
> `@``@` -202,7 +202,7 `@``@` cdef class FiniteFieldElement_pari_ffelt(FinitePolyExtElement):
>          cdef Integer xi
> 
>          if isinstance(x, FiniteFieldElement_pari_ffelt):
> -            if self._parent is (<FiniteFieldElement_pari_ffelt>x)._parent:
> +            if self._parent == (<FiniteFieldElement_pari_ffelt>x)._parent:
>                  pari_catch_sig_on()
>                  self.construct((<FiniteFieldElement_pari_ffelt>x).val)
>              else:
> }}}


Would you propose to make the above change, or simply to close as ticket as dupe of #16855?



---

archive/issue_comments_288270.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,11 +1,18 @@\n The following sequence of commands somehow breaks the coercion framework. This is on vanilla Sage 6.4.beta1. The problem only occurs if `impl=\"pari_ffelt\"` is explicitly given, even though that is the default:\n \n ```\n-sage: k.<a> = GF(17^14, impl=\"pari_ffelt\")\n-sage: _ = PolynomialRing(k, 'x')(a/2)\n-sage: k.<a> = GF(17^14, impl=\"pari_ffelt\")\n-sage: _ = PolynomialRing(k, 'x')(a/2)\n+sage: k1.<a> = GF(17^14, impl=\"pari_ffelt\")\n+sage: _ = PolynomialRing(k1, 'x')(a/2)\n+sage: k2.<a> = GF(17^14, impl=\"pari_ffelt\")\n+sage: _ = PolynomialRing(k2, 'x')(a/2)\n Traceback (most recent call last):\n ...\n TypeError: no coercion defined\n ```\n+\n+The underlying reason is #16855:\n+\n+```\n+sage: k1 is k2\n+False\n+```\n``````\n",
    "created_at": "2014-09-04T20:02:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-288270",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,11 +1,18 @@
 The following sequence of commands somehow breaks the coercion framework. This is on vanilla Sage 6.4.beta1. The problem only occurs if `impl="pari_ffelt"` is explicitly given, even though that is the default:
 
 ```
-sage: k.<a> = GF(17^14, impl="pari_ffelt")
-sage: _ = PolynomialRing(k, 'x')(a/2)
-sage: k.<a> = GF(17^14, impl="pari_ffelt")
-sage: _ = PolynomialRing(k, 'x')(a/2)
+sage: k1.<a> = GF(17^14, impl="pari_ffelt")
+sage: _ = PolynomialRing(k1, 'x')(a/2)
+sage: k2.<a> = GF(17^14, impl="pari_ffelt")
+sage: _ = PolynomialRing(k2, 'x')(a/2)
 Traceback (most recent call last):
 ...
 TypeError: no coercion defined
 ```
+
+The underlying reason is #16855:
+
+```
+sage: k1 is k2
+False
+```
``````




---

archive/issue_comments_288271.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -10,9 +10,11 @@\n TypeError: no coercion defined\n ```\n \n-The underlying reason is #16855:\n+The underlying reason is:\n \n ```\n sage: k1 is k2\n False\n ```\n+\n+Related: #16855\n``````\n",
    "created_at": "2014-09-04T20:14:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-288271",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -10,9 +10,11 @@
 TypeError: no coercion defined
 ```
 
-The underlying reason is #16855:
+The underlying reason is:
 
 ```
 sage: k1 is k2
 False
 ```
+
+Related: #16855
``````




---

archive/issue_comments_288272.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [jdemeyer](#comment%3A11):\n> Would you propose to make the above change, or simply to close as ticket as dupe of #16855?\n\nI would say either we close this as a duplicate of #16855, or we try to fix the other bug (comment:11:ticket:16855) here:\n\n```\nsage: k1.<a> = GF(17^14, impl=\"pari_ffelt\")\nsage: _ = a/2\nsage: k2.<a> = GF(17^14, impl=\"pari_ffelt\")\nsage: k1 is k2\nFalse\n```",
    "created_at": "2014-09-05T08:06:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-288272",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:14'></a>
Replying to [jdemeyer](#comment%3A11):
> Would you propose to make the above change, or simply to close as ticket as dupe of #16855?

I would say either we close this as a duplicate of #16855, or we try to fix the other bug (comment:11:ticket:16855) here:

```
sage: k1.<a> = GF(17^14, impl="pari_ffelt")
sage: _ = a/2
sage: k2.<a> = GF(17^14, impl="pari_ffelt")
sage: k1 is k2
False
```



---

archive/issue_comments_288273.json:
```json
{
    "body": "<a id='comment:15'></a>\nOK, let's wait and see what happens with #16855 then...",
    "created_at": "2014-09-05T08:39:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-288273",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>
OK, let's wait and see what happens with #16855 then...



---

archive/issue_comments_288274.json:
```json
{
    "body": "<a id='comment:16'></a>\nThe construction of the non-identical `k1` and `k2` appears to be due to a subtlety involving the `FiniteFieldFactory.other_keys()` method and an intermediate construction of another finite field (defined by the same data but with `impl=None`) during the construction of a common parent for the computation of `a/2`.  The keys returned by `other_keys()` only differ in the `impl` keyword.  I think the best solution is to always set the `impl` keyword when constructing the key (as opposed to allowing it to be `None`).  Then the use of this `other_keys()` method, which feels to me somewhat like a hack, can be avoided.",
    "created_at": "2014-09-05T13:29:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-288274",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:16'></a>
The construction of the non-identical `k1` and `k2` appears to be due to a subtlety involving the `FiniteFieldFactory.other_keys()` method and an intermediate construction of another finite field (defined by the same data but with `impl=None`) during the construction of a common parent for the computation of `a/2`.  The keys returned by `other_keys()` only differ in the `impl` keyword.  I think the best solution is to always set the `impl` keyword when constructing the key (as opposed to allowing it to be `None`).  Then the use of this `other_keys()` method, which feels to me somewhat like a hack, can be avoided.



---

archive/issue_comments_288275.json:
```json
{
    "body": "<a id='comment:17'></a>\nThis branch depends on #16930 to avoid merge conflicts.  It merges with, and works independently of, #16855.",
    "created_at": "2014-09-05T13:44:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-288275",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:17'></a>
This branch depends on #16930 to avoid merge conflicts.  It merges with, and works independently of, #16855.



---

archive/issue_comments_288276.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-09-05T13:44:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-288276",
    "user": "https://github.com/pjbruin"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_288277.json:
```json
{
    "body": "Changing branch from \"\" to \"u/pbruin/16934-FiniteField_factory_key\"",
    "created_at": "2014-09-05T13:44:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-288277",
    "user": "https://github.com/pjbruin"
}
```

Changing branch from "" to "u/pbruin/16934-FiniteField_factory_key"



---

archive/issue_comments_288278.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#16930\"",
    "created_at": "2014-09-05T13:44:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-288278",
    "user": "https://github.com/pjbruin"
}
```

Changing dependencies from "" to "#16930"



---

archive/issue_comments_288279.json:
```json
{
    "body": "Changing commit from \"\" to \"c33a718235e86d268b025a01561a2f14b7dc5937\"",
    "created_at": "2014-09-05T13:44:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-288279",
    "user": "https://github.com/pjbruin"
}
```

Changing commit from "" to "c33a718235e86d268b025a01561a2f14b7dc5937"



---

archive/issue_comments_288280.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -16,5 +16,6 @@\n sage: k1 is k2\n False\n ```\n+This double construction of the same finite field is caused by slightly different `UniqueFactory` keys arising during the construction of a common parent (for the computation of `a/2`) by the coercion system.\n \n Related: #16855\n``````\n",
    "created_at": "2014-09-05T13:44:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-288280",
    "user": "https://github.com/pjbruin"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -16,5 +16,6 @@
 sage: k1 is k2
 False
 ```
+This double construction of the same finite field is caused by slightly different `UniqueFactory` keys arising during the construction of a common parent (for the computation of `a/2`) by the coercion system.
 
 Related: #16855
``````




---

archive/issue_events_056198.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "rename": {
        "from": "Finite fields coercion bug",
        "to": "Fix factory keys for finite fields to avoid repeated construction"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16934#event-56198"
}
```



---

archive/issue_comments_288281.json:
```json
{
    "body": "Changing author from \"\" to \"Peter Bruin\"",
    "created_at": "2014-09-05T13:44:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-288281",
    "user": "https://github.com/pjbruin"
}
```

Changing author from "" to "Peter Bruin"



---

archive/issue_comments_288282.json:
```json
{
    "body": "<a id='comment:18'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                          |                                                           |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------|\n|[8923777](https://github.com/sagemath/sagetrac-mirror/commit/8923777303eeee0c48736316f03bf55f4bde2380)|`Trac 16934: remove method FiniteFieldFactory.other_keys()`|\n|[5e2681e](https://github.com/sagemath/sagetrac-mirror/commit/5e2681e0df90efaeb294a2010943cfe2c0e1bdc3)|`Trac 16934: more cleaning up`|\n|[ffb74fa](https://github.com/sagemath/sagetrac-mirror/commit/ffb74fa8116d1a60e255300370ca4467e3b36732)|`Trac 16934: add doctest`|",
    "created_at": "2014-09-05T13:52:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-288282",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                          |                                                           |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------|
|[8923777](https://github.com/sagemath/sagetrac-mirror/commit/8923777303eeee0c48736316f03bf55f4bde2380)|`Trac 16934: remove method FiniteFieldFactory.other_keys()`|
|[5e2681e](https://github.com/sagemath/sagetrac-mirror/commit/5e2681e0df90efaeb294a2010943cfe2c0e1bdc3)|`Trac 16934: more cleaning up`|
|[ffb74fa](https://github.com/sagemath/sagetrac-mirror/commit/ffb74fa8116d1a60e255300370ca4467e3b36732)|`Trac 16934: add doctest`|



---

archive/issue_comments_288283.json:
```json
{
    "body": "Changing commit from \"c33a718235e86d268b025a01561a2f14b7dc5937\" to \"ffb74fa8116d1a60e255300370ca4467e3b36732\"",
    "created_at": "2014-09-05T13:52:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-288283",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "c33a718235e86d268b025a01561a2f14b7dc5937" to "ffb74fa8116d1a60e255300370ca4467e3b36732"



---

archive/issue_comments_288284.json:
```json
{
    "body": "<a id='comment:19'></a>\nDiff for easier reviewing: [http://git.sagemath.org/sage.git/diff/?id2=8cdbd7920c73713a3a8dbea697451649f0434f0a&id=ffb74fa8116d1a60e255300370ca4467e3b36732](http://git.sagemath.org/sage.git/diff/?id2=8cdbd7920c73713a3a8dbea697451649f0434f0a&id=ffb74fa8116d1a60e255300370ca4467e3b36732)",
    "created_at": "2014-09-05T13:56:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-288284",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:19'></a>
Diff for easier reviewing: [http://git.sagemath.org/sage.git/diff/?id2=8cdbd7920c73713a3a8dbea697451649f0434f0a&id=ffb74fa8116d1a60e255300370ca4467e3b36732](http://git.sagemath.org/sage.git/diff/?id2=8cdbd7920c73713a3a8dbea697451649f0434f0a&id=ffb74fa8116d1a60e255300370ca4467e3b36732)



---

archive/issue_comments_288285.json:
```json
{
    "body": "Changing branch from \"u/pbruin/16934-FiniteField_factory_key\" to \"u/jdemeyer/ticket/16934\"",
    "created_at": "2014-09-12T08:59:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-288285",
    "user": "https://github.com/jdemeyer"
}
```

Changing branch from "u/pbruin/16934-FiniteField_factory_key" to "u/jdemeyer/ticket/16934"



---

archive/issue_comments_288286.json:
```json
{
    "body": "<a id='comment:21'></a>\nPlease restore the warning\n\n```\nwarn(\"the 'modulus' argument is ignored when constructing prime finite fields\")\n```\nfor all prime finite field implementations because the modulus really is ignored:\n\n```\nsage: x = polygen(GF(7)); GF(7, modulus=x-2, impl=\"givaro\").modulus()\nx + 6\n```\n\nOf course we could change that behaviour (perhaps we should), but let's do that on a new ticket.\n\n---\nNew commits:\n|                                                                                                                                          |                                                                 |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|\n|[33c86ef](https://github.com/sagemath/sagetrac-mirror/commit/33c86ef572ea686782d5167d58c29a7e0b2d1f6c)|`Merge remote-tracking branch 'origin/develop' into ticket/16934`|",
    "created_at": "2014-09-12T09:00:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-288286",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:21'></a>
Please restore the warning

```
warn("the 'modulus' argument is ignored when constructing prime finite fields")
```
for all prime finite field implementations because the modulus really is ignored:

```
sage: x = polygen(GF(7)); GF(7, modulus=x-2, impl="givaro").modulus()
x + 6
```

Of course we could change that behaviour (perhaps we should), but let's do that on a new ticket.

---
New commits:
|                                                                                                                                          |                                                                 |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|
|[33c86ef](https://github.com/sagemath/sagetrac-mirror/commit/33c86ef572ea686782d5167d58c29a7e0b2d1f6c)|`Merge remote-tracking branch 'origin/develop' into ticket/16934`|



---

archive/issue_comments_288287.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-09-12T09:00:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-288287",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_288288.json:
```json
{
    "body": "Changing commit from \"ffb74fa8116d1a60e255300370ca4467e3b36732\" to \"33c86ef572ea686782d5167d58c29a7e0b2d1f6c\"",
    "created_at": "2014-09-12T09:00:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-288288",
    "user": "https://github.com/jdemeyer"
}
```

Changing commit from "ffb74fa8116d1a60e255300370ca4467e3b36732" to "33c86ef572ea686782d5167d58c29a7e0b2d1f6c"



---

archive/issue_comments_288289.json:
```json
{
    "body": "Changing commit from \"33c86ef572ea686782d5167d58c29a7e0b2d1f6c\" to \"bf36ec118ee0c97dbfae0aed177c1014430b7a07\"",
    "created_at": "2014-09-12T11:20:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-288289",
    "user": "https://github.com/pjbruin"
}
```

Changing commit from "33c86ef572ea686782d5167d58c29a7e0b2d1f6c" to "bf36ec118ee0c97dbfae0aed177c1014430b7a07"



---

archive/issue_comments_288290.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-09-12T11:20:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-288290",
    "user": "https://github.com/pjbruin"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_288291.json:
```json
{
    "body": "Changing branch from \"u/jdemeyer/ticket/16934\" to \"u/pbruin/16934-FiniteField_factory_key\"",
    "created_at": "2014-09-12T11:20:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-288291",
    "user": "https://github.com/pjbruin"
}
```

Changing branch from "u/jdemeyer/ticket/16934" to "u/pbruin/16934-FiniteField_factory_key"



---

archive/issue_comments_288292.json:
```json
{
    "body": "<a id='comment:22'></a>\nThis commit adds back the warning.  Alternatively, it could have been put outside the `if impl == 'modn'`, but in this way it is easier to remove again for non-`modn` implementations.",
    "created_at": "2014-09-12T11:20:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-288292",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:22'></a>
This commit adds back the warning.  Alternatively, it could have been put outside the `if impl == 'modn'`, but in this way it is easier to remove again for non-`modn` implementations.



---

archive/issue_comments_288293.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-09-12T13:18:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-288293",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_288294.json:
```json
{
    "body": "<a id='comment:23'></a>\n\n```\nsage: GF(7, impl=\"givaro\", modulus=\"primitive\")\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n<ipython-input-2-c6a1d2461111> in <module>()\n----> 1 GF(Integer(7), impl=\"givaro\", modulus=\"primitive\")\n\n/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/structure/factory.so in sage.structure.factory.UniqueFactory.__call__ (build/cythonized/sage/structure/factory.c:1160)()\n                                                                                                                                                                        \n/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/rings/finite_rings/constructor.pyc in create_key_and_extra_args(self, order, name, modulus, names, impl, proof, check_irreducible, **kwds)                                                                                                                                       \n    521                 if not modulus.is_irreducible():                                                                                                                \n    522                     raise ValueError(\"finite field modulus must be irreducible but it is not.\")\n--> 523             if modulus is not None and modulus.degree() != n:\n    524                 raise ValueError(\"the degree of the modulus does not equal the degree of the field.\")\n    525 \n\nAttributeError: 'str' object has no attribute 'degree'\n```",
    "created_at": "2014-09-12T13:18:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-288294",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'></a>

```
sage: GF(7, impl="givaro", modulus="primitive")
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-2-c6a1d2461111> in <module>()
----> 1 GF(Integer(7), impl="givaro", modulus="primitive")

/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/structure/factory.so in sage.structure.factory.UniqueFactory.__call__ (build/cythonized/sage/structure/factory.c:1160)()
                                                                                                                                                                        
/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/rings/finite_rings/constructor.pyc in create_key_and_extra_args(self, order, name, modulus, names, impl, proof, check_irreducible, **kwds)                                                                                                                                       
    521                 if not modulus.is_irreducible():                                                                                                                
    522                     raise ValueError("finite field modulus must be irreducible but it is not.")
--> 523             if modulus is not None and modulus.degree() != n:
    524                 raise ValueError("the degree of the modulus does not equal the degree of the field.")
    525 

AttributeError: 'str' object has no attribute 'degree'
```



---

archive/issue_comments_288295.json:
```json
{
    "body": "<a id='comment:24'></a>\nReplying to [pbruin](#comment%3A22):\n> This commit adds back the warning.  Alternatively, it could have been put outside the `if impl == 'modn'`, but in this way it is easier to remove again for non-`modn` implementations.\n\nI would prefer to have the warning in one place. If we ever allow a custom modulus, we should allow it for all implementations.\n\nMy vision for this \"modulus\" argument is that the following should assign to `a` a primitive root:\n\n```\nsage: K.<a> = GF(7, modulus='primitive')\n```\nso perhaps we should expand the warning to say\n\n```\nwarn(\"currently, the 'modulus' argument is ignored when constructing prime finite fields. This might change in the future and this will probably also change the output of the .gen() and .modulus() methods on the finite field.\\nSee http://trac.sagemath.org/16930 for details.\")\n```",
    "created_at": "2014-09-12T13:23:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-288295",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:24'></a>
Replying to [pbruin](#comment%3A22):
> This commit adds back the warning.  Alternatively, it could have been put outside the `if impl == 'modn'`, but in this way it is easier to remove again for non-`modn` implementations.

I would prefer to have the warning in one place. If we ever allow a custom modulus, we should allow it for all implementations.

My vision for this "modulus" argument is that the following should assign to `a` a primitive root:

```
sage: K.<a> = GF(7, modulus='primitive')
```
so perhaps we should expand the warning to say

```
warn("currently, the 'modulus' argument is ignored when constructing prime finite fields. This might change in the future and this will probably also change the output of the .gen() and .modulus() methods on the finite field.\nSee http://trac.sagemath.org/16930 for details.")
```



---

archive/issue_comments_288296.json:
```json
{
    "body": "<a id='comment:25'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                                          |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------|\n|[9cbdcde](https://github.com/sagemath/sagetrac-mirror/commit/9cbdcde41b4783e7adf3f56451b9dedd36842f1d)|`Trac 16934: fix warning about ignored 'modulus' argument`|",
    "created_at": "2014-09-12T16:46:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-288296",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                                          |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------|
|[9cbdcde](https://github.com/sagemath/sagetrac-mirror/commit/9cbdcde41b4783e7adf3f56451b9dedd36842f1d)|`Trac 16934: fix warning about ignored 'modulus' argument`|



---

archive/issue_comments_288297.json:
```json
{
    "body": "Changing commit from \"bf36ec118ee0c97dbfae0aed177c1014430b7a07\" to \"9cbdcde41b4783e7adf3f56451b9dedd36842f1d\"",
    "created_at": "2014-09-12T16:46:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-288297",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "bf36ec118ee0c97dbfae0aed177c1014430b7a07" to "9cbdcde41b4783e7adf3f56451b9dedd36842f1d"



---

archive/issue_comments_288298.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-09-12T16:47:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-288298",
    "user": "https://github.com/pjbruin"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_288299.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-09-15T08:58:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-288299",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_288300.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Jeroen Demeyer\"",
    "created_at": "2014-09-15T08:58:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-288300",
    "user": "https://github.com/jdemeyer"
}
```

Changing reviewer from "" to "Jeroen Demeyer"



---

archive/issue_comments_288301.json:
```json
{
    "body": "<a id='comment:28'></a>\nReplying to [jdemeyer](#comment%3A24):\n> Replying to [pbruin](#comment%3A22):\n> > This commit adds back the warning.  Alternatively, it could have been put outside the `if impl == 'modn'`, but in this way it is easier to remove again for non-`modn` implementations.\n\n> I would prefer to have the warning in one place. If we ever allow a custom modulus, we should allow it for all implementations.\n> \n> My vision for this \"modulus\" argument is that the following should assign to `a` a primitive root:\n> \n> ```\n> sage: K.<a> = GF(7, modulus='primitive')\n> ```\n\n\nThe word \"modulus\" here is definitely wrong. If anything is a modulus for `GF(7)`, it is 7, because the natural way to construct `GF(7)` as *quotient* of `ZZ` by `7ZZ`.\n\nIn general, even for field *extensions*, the word modulus is confusing. That only applies if you're making the field as a quotient of a polynomial ring. For the purpose proposed, `generator` would cover the notion much better. I see from the doc that we have legacy against us on this one.",
    "created_at": "2014-09-15T18:05:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-288301",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:28'></a>
Replying to [jdemeyer](#comment%3A24):
> Replying to [pbruin](#comment%3A22):
> > This commit adds back the warning.  Alternatively, it could have been put outside the `if impl == 'modn'`, but in this way it is easier to remove again for non-`modn` implementations.

> I would prefer to have the warning in one place. If we ever allow a custom modulus, we should allow it for all implementations.
> 
> My vision for this "modulus" argument is that the following should assign to `a` a primitive root:
> 
> ```
> sage: K.<a> = GF(7, modulus='primitive')
> ```


The word "modulus" here is definitely wrong. If anything is a modulus for `GF(7)`, it is 7, because the natural way to construct `GF(7)` as *quotient* of `ZZ` by `7ZZ`.

In general, even for field *extensions*, the word modulus is confusing. That only applies if you're making the field as a quotient of a polynomial ring. For the purpose proposed, `generator` would cover the notion much better. I see from the doc that we have legacy against us on this one.



---

archive/issue_comments_288302.json:
```json
{
    "body": "<a id='comment:29'></a>\nReplying to [nbruin](#comment%3A28):\n> Replying to [jdemeyer](#comment%3A24):\n> > My vision for this \"modulus\" argument is that the following should assign to `a` a primitive root:\n> > \n> > ```\n> > sage: K.<a> = GF(7, modulus='primitive')\n> > ```\n\n> \n> The word \"modulus\" here is definitely wrong. If anything is a modulus for `GF(7)`, it is 7, because the natural way to construct `GF(7)` as *quotient* of `ZZ` by `7ZZ`.\n\nDepends on how you look at it. For me, there is a big philosophical difference between `IntegerModRing(p)` and `GF(p)`. I see `IntegerModRing(m)` as `ZZ/(m)`, while `GF(p^n)` is `IntegerModRing(p)[x]/(f(x))` for an irreducible polynomial `f(x)` of degree `n`.\n\nFor fields `GF(p^n)` (n > 1), the word \"modulus\" for `f(x)` is certainly more standard than \"generator\". For me, the \"generator\" is the image of `x` in `GF(p^n) = IntegerModRing(p)[x]/(f(x))`, which is returned by the `gen()` method.",
    "created_at": "2014-09-16T15:48:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-288302",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:29'></a>
Replying to [nbruin](#comment%3A28):
> Replying to [jdemeyer](#comment%3A24):
> > My vision for this "modulus" argument is that the following should assign to `a` a primitive root:
> > 
> > ```
> > sage: K.<a> = GF(7, modulus='primitive')
> > ```

> 
> The word "modulus" here is definitely wrong. If anything is a modulus for `GF(7)`, it is 7, because the natural way to construct `GF(7)` as *quotient* of `ZZ` by `7ZZ`.

Depends on how you look at it. For me, there is a big philosophical difference between `IntegerModRing(p)` and `GF(p)`. I see `IntegerModRing(m)` as `ZZ/(m)`, while `GF(p^n)` is `IntegerModRing(p)[x]/(f(x))` for an irreducible polynomial `f(x)` of degree `n`.

For fields `GF(p^n)` (n > 1), the word "modulus" for `f(x)` is certainly more standard than "generator". For me, the "generator" is the image of `x` in `GF(p^n) = IntegerModRing(p)[x]/(f(x))`, which is returned by the `gen()` method.



---

archive/issue_comments_288303.json:
```json
{
    "body": "<a id='comment:30'></a>\nReplying to [jdemeyer](#comment%3A24):\n> My vision for this \"modulus\" argument is that the following should assign to `a` a primitive root:\n> \n> ```\n> sage: K.<a> = GF(7, modulus='primitive')\n> ```\n\nBy the way, this is now implemented at #16983.",
    "created_at": "2014-09-16T15:56:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-288303",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:30'></a>
Replying to [jdemeyer](#comment%3A24):
> My vision for this "modulus" argument is that the following should assign to `a` a primitive root:
> 
> ```
> sage: K.<a> = GF(7, modulus='primitive')
> ```

By the way, this is now implemented at #16983.



---

archive/issue_comments_288304.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-09-16T18:46:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-288304",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_056199.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-09-16T18:46:36Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16934#event-56199"
}
```



---

archive/issue_comments_288305.json:
```json
{
    "body": "Changing branch from \"u/pbruin/16934-FiniteField_factory_key\" to \"9cbdcde41b4783e7adf3f56451b9dedd36842f1d\"",
    "created_at": "2014-09-16T18:46:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-288305",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/pbruin/16934-FiniteField_factory_key" to "9cbdcde41b4783e7adf3f56451b9dedd36842f1d"
