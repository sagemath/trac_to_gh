# Issue 16934: Fix factory keys for finite fields to avoid repeated construction

archive/issues_016697.json:
```json
{
    "assignees": [],
    "body": "The following sequence of commands somehow breaks the coercion framework. This is on vanilla Sage 6.4.beta1. The problem only occurs if `impl=\"pari_ffelt\"` is explicitly given, even though that is the default:\n\n```\nsage: k1.<a> = GF(17^14, impl=\"pari_ffelt\")\nsage: _ = PolynomialRing(k1, 'x')(a/2)\nsage: k2.<a> = GF(17^14, impl=\"pari_ffelt\")\nsage: _ = PolynomialRing(k2, 'x')(a/2)\nTraceback (most recent call last):\n...\nTypeError: no coercion defined\n```\n\nThe underlying reason is:\n\n```\nsage: k1 is k2\nFalse\n```\nThis double construction of the same finite field is caused by slightly different `UniqueFactory` keys arising during the construction of a common parent (for the computation of `a/2`) by the coercion system.\n\nRelated: #16855\n\nDepends on #16930\n\nBranch/Commit: **[`9cbdcde`](https://github.com/sagemath/sagetrac-mirror/commit/9cbdcde41b4783e7adf3f56451b9dedd36842f1d)**\n\nReviewer: **Jeroen Demeyer**\n\nAuthor: **Peter Bruin**\n\nComponent: **finite rings**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/16934_\n\n",
    "closed_at": "2014-09-16T18:46:36Z",
    "created_at": "2014-09-04T14:44:21Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20finite%20rings",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Fix factory keys for finite fields to avoid repeated construction",
    "type": "issue",
    "updated_at": "2014-09-16T18:46:36Z",
    "url": "https://github.com/sagemath/sage/issues/16934",
    "user": "https://github.com/jdemeyer"
}
```
The following sequence of commands somehow breaks the coercion framework. This is on vanilla Sage 6.4.beta1. The problem only occurs if `impl="pari_ffelt"` is explicitly given, even though that is the default:

```
sage: k1.<a> = GF(17^14, impl="pari_ffelt")
sage: _ = PolynomialRing(k1, 'x')(a/2)
sage: k2.<a> = GF(17^14, impl="pari_ffelt")
sage: _ = PolynomialRing(k2, 'x')(a/2)
Traceback (most recent call last):
...
TypeError: no coercion defined
```

The underlying reason is:

```
sage: k1 is k2
False
```
This double construction of the same finite field is caused by slightly different `UniqueFactory` keys arising during the construction of a common parent (for the computation of `a/2`) by the coercion system.

Related: #16855

Depends on #16930

Branch/Commit: **[`9cbdcde`](https://github.com/sagemath/sagetrac-mirror/commit/9cbdcde41b4783e7adf3f56451b9dedd36842f1d)**

Reviewer: **Jeroen Demeyer**

Author: **Peter Bruin**

Component: **finite rings**

_Issue created by migration from https://trac.sagemath.org/ticket/16934_





---

archive/issue_events_243214.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-09-04T14:44:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16934#event-243214"
}
```



---

archive/issue_events_243215.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-09-04T14:44:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20coercion",
    "label_color": "eeeeee",
    "label_name": "c: coercion",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16934#event-243215"
}
```



---

archive/issue_events_243216.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-09-04T14:44:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16934#event-243216"
}
```



---

archive/issue_events_243217.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-09-04T14:44:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16934#event-243217"
}
```



---

archive/issue_comments_223379.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,7 +4,7 @@\n sage: k.<a> = GF(17^14, impl=\"pari_ffelt\")\n sage: _ = EllipticCurve_from_j(a^584645231109031).cardinality()\n sage: k.<a> = GF(17^14, impl=\"pari_ffelt\")\n-sage: _ = EllipticCurve_from_j(a^584645231109031).cardinality()\n+sage: E = EllipticCurve_from_j(a^584645231109031)\n TypeError                                 Traceback (most recent call last)\n [...]\n TypeError: no coercion defined\n``````\n",
    "created_at": "2014-09-04T14:52:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-223379",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,7 +4,7 @@
 sage: k.<a> = GF(17^14, impl="pari_ffelt")
 sage: _ = EllipticCurve_from_j(a^584645231109031).cardinality()
 sage: k.<a> = GF(17^14, impl="pari_ffelt")
-sage: _ = EllipticCurve_from_j(a^584645231109031).cardinality()
+sage: E = EllipticCurve_from_j(a^584645231109031)
 TypeError                                 Traceback (most recent call last)
 [...]
 TypeError: no coercion defined
``````




---

archive/issue_comments_223380.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,9 +2,11 @@\n \n ```\n sage: k.<a> = GF(17^14, impl=\"pari_ffelt\")\n-sage: _ = EllipticCurve_from_j(a^584645231109031).cardinality()\n+sage: E1 = EllipticCurve_from_j(a^584645231109031)\n+sage: E2 = EllipticCurve_from_j(a^584645231109031)\n+sage: _ = E1.is_isomorphic(E2)\n sage: k.<a> = GF(17^14, impl=\"pari_ffelt\")\n-sage: E = EllipticCurve_from_j(a^584645231109031)\n+sage: E3 = EllipticCurve_from_j(a^584645231109031)\n TypeError                                 Traceback (most recent call last)\n [...]\n TypeError: no coercion defined\n``````\n",
    "created_at": "2014-09-04T14:55:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-223380",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,9 +2,11 @@
 
 ```
 sage: k.<a> = GF(17^14, impl="pari_ffelt")
-sage: _ = EllipticCurve_from_j(a^584645231109031).cardinality()
+sage: E1 = EllipticCurve_from_j(a^584645231109031)
+sage: E2 = EllipticCurve_from_j(a^584645231109031)
+sage: _ = E1.is_isomorphic(E2)
 sage: k.<a> = GF(17^14, impl="pari_ffelt")
-sage: E = EllipticCurve_from_j(a^584645231109031)
+sage: E3 = EllipticCurve_from_j(a^584645231109031)
 TypeError                                 Traceback (most recent call last)
 [...]
 TypeError: no coercion defined
``````




---

archive/issue_comments_223381.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -12,4 +12,4 @@\n TypeError: no coercion defined\n ```\n \n-Remark: the value `a^584645231109031` is chosen to lie in the subfield `GF(17^2)`, an elliptic curve over this field is created in the `cardinality()` call.\n+Remark: the value `a^584645231109031` is chosen to lie in the subfield `GF(17^2)`.\n``````\n",
    "created_at": "2014-09-04T14:55:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-223381",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -12,4 +12,4 @@
 TypeError: no coercion defined
 ```
 
-Remark: the value `a^584645231109031` is chosen to lie in the subfield `GF(17^2)`, an elliptic curve over this field is created in the `cardinality()` call.
+Remark: the value `a^584645231109031` is chosen to lie in the subfield `GF(17^2)`.
``````




---

archive/issue_comments_223382.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,11 +2,10 @@\n \n ```\n sage: k.<a> = GF(17^14, impl=\"pari_ffelt\")\n-sage: E1 = EllipticCurve_from_j(a^584645231109031)\n-sage: E2 = EllipticCurve_from_j(a^584645231109031)\n-sage: _ = E1.is_isomorphic(E2)\n+sage: E = EllipticCurve_from_j(a)\n+sage: _ = E.is_isomorphic(E)\n sage: k.<a> = GF(17^14, impl=\"pari_ffelt\")\n-sage: E3 = EllipticCurve_from_j(a^584645231109031)\n+sage: E = EllipticCurve_from_j(a)\n TypeError                                 Traceback (most recent call last)\n [...]\n TypeError: no coercion defined\n``````\n",
    "created_at": "2014-09-04T14:57:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-223382",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,11 +2,10 @@
 
 ```
 sage: k.<a> = GF(17^14, impl="pari_ffelt")
-sage: E1 = EllipticCurve_from_j(a^584645231109031)
-sage: E2 = EllipticCurve_from_j(a^584645231109031)
-sage: _ = E1.is_isomorphic(E2)
+sage: E = EllipticCurve_from_j(a)
+sage: _ = E.is_isomorphic(E)
 sage: k.<a> = GF(17^14, impl="pari_ffelt")
-sage: E3 = EllipticCurve_from_j(a^584645231109031)
+sage: E = EllipticCurve_from_j(a)
 TypeError                                 Traceback (most recent call last)
 [...]
 TypeError: no coercion defined
``````




---

archive/issue_comments_223383.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -10,5 +10,3 @@\n [...]\n TypeError: no coercion defined\n ```\n-\n-Remark: the value `a^584645231109031` is chosen to lie in the subfield `GF(17^2)`.\n``````\n",
    "created_at": "2014-09-04T14:57:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-223383",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -10,5 +10,3 @@
 [...]
 TypeError: no coercion defined
 ```
-
-Remark: the value `a^584645231109031` is chosen to lie in the subfield `GF(17^2)`.
``````




---

archive/issue_comments_223384.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,10 +2,9 @@\n \n ```\n sage: k.<a> = GF(17^14, impl=\"pari_ffelt\")\n-sage: E = EllipticCurve_from_j(a)\n-sage: _ = E.is_isomorphic(E)\n+sage: E = EllipticCurve_from_j(a/2)\n sage: k.<a> = GF(17^14, impl=\"pari_ffelt\")\n-sage: E = EllipticCurve_from_j(a)\n+sage: E = EllipticCurve_from_j(a/2)\n TypeError                                 Traceback (most recent call last)\n [...]\n TypeError: no coercion defined\n``````\n",
    "created_at": "2014-09-04T15:08:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-223384",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,10 +2,9 @@
 
 ```
 sage: k.<a> = GF(17^14, impl="pari_ffelt")
-sage: E = EllipticCurve_from_j(a)
-sage: _ = E.is_isomorphic(E)
+sage: E = EllipticCurve_from_j(a/2)
 sage: k.<a> = GF(17^14, impl="pari_ffelt")
-sage: E = EllipticCurve_from_j(a)
+sage: E = EllipticCurve_from_j(a/2)
 TypeError                                 Traceback (most recent call last)
 [...]
 TypeError: no coercion defined
``````




---

archive/issue_comments_223385.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,9 +2,9 @@\n \n ```\n sage: k.<a> = GF(17^14, impl=\"pari_ffelt\")\n-sage: E = EllipticCurve_from_j(a/2)\n+sage: _ = PolynomialRing(k, 'x')(a/2)\n sage: k.<a> = GF(17^14, impl=\"pari_ffelt\")\n-sage: E = EllipticCurve_from_j(a/2)\n+sage: _ = PolynomialRing(k, 'x')(a/2)\n TypeError                                 Traceback (most recent call last)\n [...]\n TypeError: no coercion defined\n``````\n",
    "created_at": "2014-09-04T15:20:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-223385",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,9 +2,9 @@
 
 ```
 sage: k.<a> = GF(17^14, impl="pari_ffelt")
-sage: E = EllipticCurve_from_j(a/2)
+sage: _ = PolynomialRing(k, 'x')(a/2)
 sage: k.<a> = GF(17^14, impl="pari_ffelt")
-sage: E = EllipticCurve_from_j(a/2)
+sage: _ = PolynomialRing(k, 'x')(a/2)
 TypeError                                 Traceback (most recent call last)
 [...]
 TypeError: no coercion defined
``````




---

archive/issue_comments_223386.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,7 +5,7 @@\n sage: _ = PolynomialRing(k, 'x')(a/2)\n sage: k.<a> = GF(17^14, impl=\"pari_ffelt\")\n sage: _ = PolynomialRing(k, 'x')(a/2)\n-TypeError                                 Traceback (most recent call last)\n-[...]\n+Traceback (most recent call last):\n+...\n TypeError: no coercion defined\n ```\n``````\n",
    "created_at": "2014-09-04T15:21:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-223386",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,7 +5,7 @@
 sage: _ = PolynomialRing(k, 'x')(a/2)
 sage: k.<a> = GF(17^14, impl="pari_ffelt")
 sage: _ = PolynomialRing(k, 'x')(a/2)
-TypeError                                 Traceback (most recent call last)
-[...]
+Traceback (most recent call last):
+...
 TypeError: no coercion defined
 ```
``````




---

archive/issue_comments_223387.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI don't claim to know what is going on, but it may be caused by equality and identity not being the same for finite fields; #16855 seems to fix this bug.",
    "created_at": "2014-09-04T15:37:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-223387",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:9" align="right">comment:9</div>

I don't claim to know what is going on, but it may be caused by equality and identity not being the same for finite fields; #16855 seems to fix this bug.



---

archive/issue_comments_223388.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nThis guess is corroborated by the fact that the following change also appears to fix the bug:\n\n```diff\n--- a/src/sage/rings/finite_rings/element_pari_ffelt.pyx\n+++ b/src/sage/rings/finite_rings/element_pari_ffelt.pyx\n@@ -202,7 +202,7 @@ cdef class FiniteFieldElement_pari_ffelt(FinitePolyExtElement):\n         cdef Integer xi\n\n         if isinstance(x, FiniteFieldElement_pari_ffelt):\n-            if self._parent is (<FiniteFieldElement_pari_ffelt>x)._parent:\n+            if self._parent == (<FiniteFieldElement_pari_ffelt>x)._parent:\n                 pari_catch_sig_on()\n                 self.construct((<FiniteFieldElement_pari_ffelt>x).val)\n             else:\n```\nAfter #16855, this change effectively does nothing.",
    "created_at": "2014-09-04T16:08:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-223388",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:10" align="right">comment:10</div>

This guess is corroborated by the fact that the following change also appears to fix the bug:

```diff
--- a/src/sage/rings/finite_rings/element_pari_ffelt.pyx
+++ b/src/sage/rings/finite_rings/element_pari_ffelt.pyx
@@ -202,7 +202,7 @@ cdef class FiniteFieldElement_pari_ffelt(FinitePolyExtElement):
         cdef Integer xi

         if isinstance(x, FiniteFieldElement_pari_ffelt):
-            if self._parent is (<FiniteFieldElement_pari_ffelt>x)._parent:
+            if self._parent == (<FiniteFieldElement_pari_ffelt>x)._parent:
                 pari_catch_sig_on()
                 self.construct((<FiniteFieldElement_pari_ffelt>x).val)
             else:
```
After #16855, this change effectively does nothing.



---

archive/issue_comments_223389.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@pjbruin](#comment:10):\n> \n> ```diff\n> --- a/src/sage/rings/finite_rings/element_pari_ffelt.pyx\n> +++ b/src/sage/rings/finite_rings/element_pari_ffelt.pyx\n> @@ -202,7 +202,7 @@ cdef class FiniteFieldElement_pari_ffelt(FinitePolyExtElement):\n>          cdef Integer xi\n> \n>          if isinstance(x, FiniteFieldElement_pari_ffelt):\n> -            if self._parent is (<FiniteFieldElement_pari_ffelt>x)._parent:\n> +            if self._parent == (<FiniteFieldElement_pari_ffelt>x)._parent:\n>                  pari_catch_sig_on()\n>                  self.construct((<FiniteFieldElement_pari_ffelt>x).val)\n>              else:\n> ```\n\nWould you propose to make the above change, or simply to close as ticket as dupe of #16855?",
    "created_at": "2014-09-04T18:12:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-223389",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@pjbruin](#comment:10):
> 
> ```diff
> --- a/src/sage/rings/finite_rings/element_pari_ffelt.pyx
> +++ b/src/sage/rings/finite_rings/element_pari_ffelt.pyx
> @@ -202,7 +202,7 @@ cdef class FiniteFieldElement_pari_ffelt(FinitePolyExtElement):
>          cdef Integer xi
> 
>          if isinstance(x, FiniteFieldElement_pari_ffelt):
> -            if self._parent is (<FiniteFieldElement_pari_ffelt>x)._parent:
> +            if self._parent == (<FiniteFieldElement_pari_ffelt>x)._parent:
>                  pari_catch_sig_on()
>                  self.construct((<FiniteFieldElement_pari_ffelt>x).val)
>              else:
> ```

Would you propose to make the above change, or simply to close as ticket as dupe of #16855?



---

archive/issue_comments_223390.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,11 +1,18 @@\n The following sequence of commands somehow breaks the coercion framework. This is on vanilla Sage 6.4.beta1. The problem only occurs if `impl=\"pari_ffelt\"` is explicitly given, even though that is the default:\n \n ```\n-sage: k.<a> = GF(17^14, impl=\"pari_ffelt\")\n-sage: _ = PolynomialRing(k, 'x')(a/2)\n-sage: k.<a> = GF(17^14, impl=\"pari_ffelt\")\n-sage: _ = PolynomialRing(k, 'x')(a/2)\n+sage: k1.<a> = GF(17^14, impl=\"pari_ffelt\")\n+sage: _ = PolynomialRing(k1, 'x')(a/2)\n+sage: k2.<a> = GF(17^14, impl=\"pari_ffelt\")\n+sage: _ = PolynomialRing(k2, 'x')(a/2)\n Traceback (most recent call last):\n ...\n TypeError: no coercion defined\n ```\n+\n+The underlying reason is #16855:\n+\n+```\n+sage: k1 is k2\n+False\n+```\n``````\n",
    "created_at": "2014-09-04T20:02:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-223390",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,11 +1,18 @@
 The following sequence of commands somehow breaks the coercion framework. This is on vanilla Sage 6.4.beta1. The problem only occurs if `impl="pari_ffelt"` is explicitly given, even though that is the default:
 
 ```
-sage: k.<a> = GF(17^14, impl="pari_ffelt")
-sage: _ = PolynomialRing(k, 'x')(a/2)
-sage: k.<a> = GF(17^14, impl="pari_ffelt")
-sage: _ = PolynomialRing(k, 'x')(a/2)
+sage: k1.<a> = GF(17^14, impl="pari_ffelt")
+sage: _ = PolynomialRing(k1, 'x')(a/2)
+sage: k2.<a> = GF(17^14, impl="pari_ffelt")
+sage: _ = PolynomialRing(k2, 'x')(a/2)
 Traceback (most recent call last):
 ...
 TypeError: no coercion defined
 ```
+
+The underlying reason is #16855:
+
+```
+sage: k1 is k2
+False
+```
``````




---

archive/issue_comments_223391.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -10,9 +10,11 @@\n TypeError: no coercion defined\n ```\n \n-The underlying reason is #16855:\n+The underlying reason is:\n \n ```\n sage: k1 is k2\n False\n ```\n+\n+Related: #16855\n``````\n",
    "created_at": "2014-09-04T20:14:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-223391",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -10,9 +10,11 @@
 TypeError: no coercion defined
 ```
 
-The underlying reason is #16855:
+The underlying reason is:
 
 ```
 sage: k1 is k2
 False
 ```
+
+Related: #16855
``````




---

archive/issue_comments_223392.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@jdemeyer](#comment:11):\n> Would you propose to make the above change, or simply to close as ticket as dupe of #16855?\n\nI would say either we close this as a duplicate of #16855, or we try to fix the other bug ([#16855 comment:11](https://github.com/sagemath/sage/issues/16855#comment:11)) here:\n\n```\nsage: k1.<a> = GF(17^14, impl=\"pari_ffelt\")\nsage: _ = a/2\nsage: k2.<a> = GF(17^14, impl=\"pari_ffelt\")\nsage: k1 is k2\nFalse\n```",
    "created_at": "2014-09-05T08:06:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-223392",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@jdemeyer](#comment:11):
> Would you propose to make the above change, or simply to close as ticket as dupe of #16855?

I would say either we close this as a duplicate of #16855, or we try to fix the other bug ([#16855 comment:11](https://github.com/sagemath/sage/issues/16855#comment:11)) here:

```
sage: k1.<a> = GF(17^14, impl="pari_ffelt")
sage: _ = a/2
sage: k2.<a> = GF(17^14, impl="pari_ffelt")
sage: k1 is k2
False
```



---

archive/issue_comments_223393.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nOK, let's wait and see what happens with #16855 then...",
    "created_at": "2014-09-05T08:39:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-223393",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:15" align="right">comment:15</div>

OK, let's wait and see what happens with #16855 then...



---

archive/issue_comments_223394.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nThe construction of the non-identical `k1` and `k2` appears to be due to a subtlety involving the `FiniteFieldFactory.other_keys()` method and an intermediate construction of another finite field (defined by the same data but with `impl=None`) during the construction of a common parent for the computation of `a/2`.  The keys returned by `other_keys()` only differ in the `impl` keyword.  I think the best solution is to always set the `impl` keyword when constructing the key (as opposed to allowing it to be `None`).  Then the use of this `other_keys()` method, which feels to me somewhat like a hack, can be avoided.",
    "created_at": "2014-09-05T13:29:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-223394",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:16" align="right">comment:16</div>

The construction of the non-identical `k1` and `k2` appears to be due to a subtlety involving the `FiniteFieldFactory.other_keys()` method and an intermediate construction of another finite field (defined by the same data but with `impl=None`) during the construction of a common parent for the computation of `a/2`.  The keys returned by `other_keys()` only differ in the `impl` keyword.  I think the best solution is to always set the `impl` keyword when constructing the key (as opposed to allowing it to be `None`).  Then the use of this `other_keys()` method, which feels to me somewhat like a hack, can be avoided.



---

archive/issue_comments_223395.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nThis branch depends on #16930 to avoid merge conflicts.  It merges with, and works independently of, #16855.",
    "created_at": "2014-09-05T13:44:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-223395",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:17" align="right">comment:17</div>

This branch depends on #16930 to avoid merge conflicts.  It merges with, and works independently of, #16855.



---

archive/issue_events_243218.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-09-05T13:44:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20coercion",
    "label_color": "eeeeee",
    "label_name": "c: coercion",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16934#event-243218"
}
```



---

archive/issue_events_243219.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-09-05T13:44:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20finite%20rings",
    "label_color": "0000ff",
    "label_name": "c: finite rings",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16934#event-243219"
}
```



---

archive/issue_events_243220.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-09-05T13:44:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16934#event-243220"
}
```



---

archive/issue_comments_223396.json:
```json
{
    "body": "Branch: **[u/pbruin/16934-FiniteField_factory_key](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/16934-FiniteField_factory_key)**",
    "created_at": "2014-09-05T13:44:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-223396",
    "user": "https://github.com/pjbruin"
}
```

Branch: **[u/pbruin/16934-FiniteField_factory_key](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/16934-FiniteField_factory_key)**



---

archive/issue_comments_223397.json:
```json
{
    "body": "Dependencies: **#16930**",
    "created_at": "2014-09-05T13:44:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-223397",
    "user": "https://github.com/pjbruin"
}
```

Dependencies: **#16930**



---

archive/issue_comments_223398.json:
```json
{
    "body": "Commit: **[`c33a718`](https://github.com/sagemath/sagetrac-mirror/commit/c33a718235e86d268b025a01561a2f14b7dc5937)**",
    "created_at": "2014-09-05T13:44:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-223398",
    "user": "https://github.com/pjbruin"
}
```

Commit: **[`c33a718`](https://github.com/sagemath/sagetrac-mirror/commit/c33a718235e86d268b025a01561a2f14b7dc5937)**



---

archive/issue_comments_223399.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -16,5 +16,6 @@\n sage: k1 is k2\n False\n ```\n+This double construction of the same finite field is caused by slightly different `UniqueFactory` keys arising during the construction of a common parent (for the computation of `a/2`) by the coercion system.\n \n Related: #16855\n``````\n",
    "created_at": "2014-09-05T13:44:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-223399",
    "user": "https://github.com/pjbruin"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -16,5 +16,6 @@
 sage: k1 is k2
 False
 ```
+This double construction of the same finite field is caused by slightly different `UniqueFactory` keys arising during the construction of a common parent (for the computation of `a/2`) by the coercion system.
 
 Related: #16855
``````




---

archive/issue_events_243221.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-09-05T13:44:34Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "title_is": "Fix factory keys for finite fields to avoid repeated construction",
    "title_was": "Finite fields coercion bug",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16934#event-243221"
}
```



---

archive/issue_comments_223400.json:
```json
{
    "body": "Author: **Peter Bruin**",
    "created_at": "2014-09-05T13:44:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-223400",
    "user": "https://github.com/pjbruin"
}
```

Author: **Peter Bruin**



---

archive/issue_comments_223401.json:
```json
{
    "body": "<div id=\"comment:18\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8923777303eeee0c48736316f03bf55f4bde2380\"><code>8923777</code></a></td><td><code>Trac 16934: remove method FiniteFieldFactory.other_keys()</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5e2681e0df90efaeb294a2010943cfe2c0e1bdc3\"><code>5e2681e</code></a></td><td><code>Trac 16934: more cleaning up</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ffb74fa8116d1a60e255300370ca4467e3b36732\"><code>ffb74fa</code></a></td><td><code>Trac 16934: add doctest</code></td></tr></table>\n",
    "created_at": "2014-09-05T13:52:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-223401",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:18"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8923777303eeee0c48736316f03bf55f4bde2380"><code>8923777</code></a></td><td><code>Trac 16934: remove method FiniteFieldFactory.other_keys()</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5e2681e0df90efaeb294a2010943cfe2c0e1bdc3"><code>5e2681e</code></a></td><td><code>Trac 16934: more cleaning up</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ffb74fa8116d1a60e255300370ca4467e3b36732"><code>ffb74fa</code></a></td><td><code>Trac 16934: add doctest</code></td></tr></table>




---

archive/issue_comments_223402.json:
```json
{
    "body": "Changed commit from **[`c33a718`](https://github.com/sagemath/sagetrac-mirror/commit/c33a718235e86d268b025a01561a2f14b7dc5937)** to **[`ffb74fa`](https://github.com/sagemath/sagetrac-mirror/commit/ffb74fa8116d1a60e255300370ca4467e3b36732)**",
    "created_at": "2014-09-05T13:52:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-223402",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`c33a718`](https://github.com/sagemath/sagetrac-mirror/commit/c33a718235e86d268b025a01561a2f14b7dc5937)** to **[`ffb74fa`](https://github.com/sagemath/sagetrac-mirror/commit/ffb74fa8116d1a60e255300370ca4467e3b36732)**



---

archive/issue_comments_223403.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nDiff for easier reviewing: [https://github.com/sagemath/sagetrac-mirror/compare/8cdbd7920c73713a3a8dbea697451649f0434f0a...ffb74fa8116d1a60e255300370ca4467e3b36732](https://github.com/sagemath/sagetrac-mirror/compare/8cdbd7920c73713a3a8dbea697451649f0434f0a...ffb74fa8116d1a60e255300370ca4467e3b36732)",
    "created_at": "2014-09-05T13:56:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-223403",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:19" align="right">comment:19</div>

Diff for easier reviewing: [https://github.com/sagemath/sagetrac-mirror/compare/8cdbd7920c73713a3a8dbea697451649f0434f0a...ffb74fa8116d1a60e255300370ca4467e3b36732](https://github.com/sagemath/sagetrac-mirror/compare/8cdbd7920c73713a3a8dbea697451649f0434f0a...ffb74fa8116d1a60e255300370ca4467e3b36732)



---

archive/issue_comments_223404.json:
```json
{
    "body": "Changed branch from **[u/pbruin/16934-FiniteField_factory_key](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/16934-FiniteField_factory_key)** to **[u/jdemeyer/ticket/16934](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/16934)**",
    "created_at": "2014-09-12T08:59:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-223404",
    "user": "https://github.com/jdemeyer"
}
```

Changed branch from **[u/pbruin/16934-FiniteField_factory_key](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/16934-FiniteField_factory_key)** to **[u/jdemeyer/ticket/16934](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/16934)**



---

archive/issue_comments_223405.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nPlease restore the warning\n\n```\nwarn(\"the 'modulus' argument is ignored when constructing prime finite fields\")\n```\nfor all prime finite field implementations because the modulus really is ignored:\n\n```\nsage: x = polygen(GF(7)); GF(7, modulus=x-2, impl=\"givaro\").modulus()\nx + 6\n```\n\nOf course we could change that behaviour (perhaps we should), but let's do that on a new ticket.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/33c86ef572ea686782d5167d58c29a7e0b2d1f6c\"><code>33c86ef</code></a></td><td><code>Merge remote-tracking branch 'origin/develop' into ticket/16934</code></td></tr></table>\n",
    "created_at": "2014-09-12T09:00:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-223405",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:21" align="right">comment:21</div>

Please restore the warning

```
warn("the 'modulus' argument is ignored when constructing prime finite fields")
```
for all prime finite field implementations because the modulus really is ignored:

```
sage: x = polygen(GF(7)); GF(7, modulus=x-2, impl="givaro").modulus()
x + 6
```

Of course we could change that behaviour (perhaps we should), but let's do that on a new ticket.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/33c86ef572ea686782d5167d58c29a7e0b2d1f6c"><code>33c86ef</code></a></td><td><code>Merge remote-tracking branch 'origin/develop' into ticket/16934</code></td></tr></table>




---

archive/issue_events_243222.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-09-12T09:00:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16934#event-243222"
}
```



---

archive/issue_events_243223.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-09-12T09:00:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16934#event-243223"
}
```



---

archive/issue_comments_223406.json:
```json
{
    "body": "Changed commit from **[`ffb74fa`](https://github.com/sagemath/sagetrac-mirror/commit/ffb74fa8116d1a60e255300370ca4467e3b36732)** to **[`33c86ef`](https://github.com/sagemath/sagetrac-mirror/commit/33c86ef572ea686782d5167d58c29a7e0b2d1f6c)**",
    "created_at": "2014-09-12T09:00:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-223406",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[`ffb74fa`](https://github.com/sagemath/sagetrac-mirror/commit/ffb74fa8116d1a60e255300370ca4467e3b36732)** to **[`33c86ef`](https://github.com/sagemath/sagetrac-mirror/commit/33c86ef572ea686782d5167d58c29a7e0b2d1f6c)**



---

archive/issue_comments_223407.json:
```json
{
    "body": "Changed commit from **[`33c86ef`](https://github.com/sagemath/sagetrac-mirror/commit/33c86ef572ea686782d5167d58c29a7e0b2d1f6c)** to **[`bf36ec1`](https://github.com/sagemath/sagetrac-mirror/commit/bf36ec118ee0c97dbfae0aed177c1014430b7a07)**",
    "created_at": "2014-09-12T11:20:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-223407",
    "user": "https://github.com/pjbruin"
}
```

Changed commit from **[`33c86ef`](https://github.com/sagemath/sagetrac-mirror/commit/33c86ef572ea686782d5167d58c29a7e0b2d1f6c)** to **[`bf36ec1`](https://github.com/sagemath/sagetrac-mirror/commit/bf36ec118ee0c97dbfae0aed177c1014430b7a07)**



---

archive/issue_events_243224.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-09-12T11:20:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16934#event-243224"
}
```



---

archive/issue_events_243225.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-09-12T11:20:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16934#event-243225"
}
```



---

archive/issue_comments_223408.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/ticket/16934](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/16934)** to **[u/pbruin/16934-FiniteField_factory_key](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/16934-FiniteField_factory_key)**",
    "created_at": "2014-09-12T11:20:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-223408",
    "user": "https://github.com/pjbruin"
}
```

Changed branch from **[u/jdemeyer/ticket/16934](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/16934)** to **[u/pbruin/16934-FiniteField_factory_key](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/16934-FiniteField_factory_key)**



---

archive/issue_comments_223409.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nThis commit adds back the warning.  Alternatively, it could have been put outside the `if impl == 'modn'`, but in this way it is easier to remove again for non-`modn` implementations.",
    "created_at": "2014-09-12T11:20:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-223409",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:22" align="right">comment:22</div>

This commit adds back the warning.  Alternatively, it could have been put outside the `if impl == 'modn'`, but in this way it is easier to remove again for non-`modn` implementations.



---

archive/issue_events_243226.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-09-12T13:18:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16934#event-243226"
}
```



---

archive/issue_events_243227.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-09-12T13:18:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16934#event-243227"
}
```



---

archive/issue_comments_223410.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\n\n```\nsage: GF(7, impl=\"givaro\", modulus=\"primitive\")\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n<ipython-input-2-c6a1d2461111> in <module>()\n----> 1 GF(Integer(7), impl=\"givaro\", modulus=\"primitive\")\n\n/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/structure/factory.so in sage.structure.factory.UniqueFactory.__call__ (build/cythonized/sage/structure/factory.c:1160)()\n                                                                                                                                                                        \n/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/rings/finite_rings/constructor.pyc in create_key_and_extra_args(self, order, name, modulus, names, impl, proof, check_irreducible, **kwds)                                                                                                                                       \n    521                 if not modulus.is_irreducible():                                                                                                                \n    522                     raise ValueError(\"finite field modulus must be irreducible but it is not.\")\n--> 523             if modulus is not None and modulus.degree() != n:\n    524                 raise ValueError(\"the degree of the modulus does not equal the degree of the field.\")\n    525 \n\nAttributeError: 'str' object has no attribute 'degree'\n```",
    "created_at": "2014-09-12T13:18:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-223410",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:23" align="right">comment:23</div>


```
sage: GF(7, impl="givaro", modulus="primitive")
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-2-c6a1d2461111> in <module>()
----> 1 GF(Integer(7), impl="givaro", modulus="primitive")

/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/structure/factory.so in sage.structure.factory.UniqueFactory.__call__ (build/cythonized/sage/structure/factory.c:1160)()
                                                                                                                                                                        
/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/rings/finite_rings/constructor.pyc in create_key_and_extra_args(self, order, name, modulus, names, impl, proof, check_irreducible, **kwds)                                                                                                                                       
    521                 if not modulus.is_irreducible():                                                                                                                
    522                     raise ValueError("finite field modulus must be irreducible but it is not.")
--> 523             if modulus is not None and modulus.degree() != n:
    524                 raise ValueError("the degree of the modulus does not equal the degree of the field.")
    525 

AttributeError: 'str' object has no attribute 'degree'
```



---

archive/issue_comments_223411.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@pjbruin](#comment:22):\n> This commit adds back the warning.  Alternatively, it could have been put outside the `if impl == 'modn'`, but in this way it is easier to remove again for non-`modn` implementations.\n\nI would prefer to have the warning in one place. If we ever allow a custom modulus, we should allow it for all implementations.\n\nMy vision for this \"modulus\" argument is that the following should assign to `a` a primitive root:\n\n```\nsage: K.<a> = GF(7, modulus='primitive')\n```\nso perhaps we should expand the warning to say\n\n```\nwarn(\"currently, the 'modulus' argument is ignored when constructing prime finite fields. This might change in the future and this will probably also change the output of the .gen() and .modulus() methods on the finite field.\\nSee http://trac.sagemath.org/16930 for details.\")\n```",
    "created_at": "2014-09-12T13:23:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-223411",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@pjbruin](#comment:22):
> This commit adds back the warning.  Alternatively, it could have been put outside the `if impl == 'modn'`, but in this way it is easier to remove again for non-`modn` implementations.

I would prefer to have the warning in one place. If we ever allow a custom modulus, we should allow it for all implementations.

My vision for this "modulus" argument is that the following should assign to `a` a primitive root:

```
sage: K.<a> = GF(7, modulus='primitive')
```
so perhaps we should expand the warning to say

```
warn("currently, the 'modulus' argument is ignored when constructing prime finite fields. This might change in the future and this will probably also change the output of the .gen() and .modulus() methods on the finite field.\nSee http://trac.sagemath.org/16930 for details.")
```



---

archive/issue_comments_223412.json:
```json
{
    "body": "<div id=\"comment:25\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9cbdcde41b4783e7adf3f56451b9dedd36842f1d\"><code>9cbdcde</code></a></td><td><code>Trac 16934: fix warning about ignored 'modulus' argument</code></td></tr></table>\n",
    "created_at": "2014-09-12T16:46:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-223412",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:25"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9cbdcde41b4783e7adf3f56451b9dedd36842f1d"><code>9cbdcde</code></a></td><td><code>Trac 16934: fix warning about ignored 'modulus' argument</code></td></tr></table>




---

archive/issue_comments_223413.json:
```json
{
    "body": "Changed commit from **[`bf36ec1`](https://github.com/sagemath/sagetrac-mirror/commit/bf36ec118ee0c97dbfae0aed177c1014430b7a07)** to **[`9cbdcde`](https://github.com/sagemath/sagetrac-mirror/commit/9cbdcde41b4783e7adf3f56451b9dedd36842f1d)**",
    "created_at": "2014-09-12T16:46:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-223413",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`bf36ec1`](https://github.com/sagemath/sagetrac-mirror/commit/bf36ec118ee0c97dbfae0aed177c1014430b7a07)** to **[`9cbdcde`](https://github.com/sagemath/sagetrac-mirror/commit/9cbdcde41b4783e7adf3f56451b9dedd36842f1d)**



---

archive/issue_events_243228.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-09-12T16:47:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16934#event-243228"
}
```



---

archive/issue_events_243229.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-09-12T16:47:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16934#event-243229"
}
```



---

archive/issue_events_243230.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-09-15T08:58:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16934#event-243230"
}
```



---

archive/issue_events_243231.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-09-15T08:58:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16934#event-243231"
}
```



---

archive/issue_comments_223414.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2014-09-15T08:58:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-223414",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**



---

archive/issue_comments_223415.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nReplying to [@jdemeyer](#comment:24):\n> Replying to [@pjbruin](#comment:22):\n> > This commit adds back the warning.  Alternatively, it could have been put outside the `if impl == 'modn'`, but in this way it is easier to remove again for non-`modn` implementations.\n\n> I would prefer to have the warning in one place. If we ever allow a custom modulus, we should allow it for all implementations.\n> \n> My vision for this \"modulus\" argument is that the following should assign to `a` a primitive root:\n> \n> ```\n> sage: K.<a> = GF(7, modulus='primitive')\n> ```\n\nThe word \"modulus\" here is definitely wrong. If anything is a modulus for `GF(7)`, it is 7, because the natural way to construct `GF(7)` as *quotient* of `ZZ` by `7ZZ`.\n\nIn general, even for field *extensions*, the word modulus is confusing. That only applies if you're making the field as a quotient of a polynomial ring. For the purpose proposed, `generator` would cover the notion much better. I see from the doc that we have legacy against us on this one.",
    "created_at": "2014-09-15T18:05:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-223415",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:28" align="right">comment:28</div>

Replying to [@jdemeyer](#comment:24):
> Replying to [@pjbruin](#comment:22):
> > This commit adds back the warning.  Alternatively, it could have been put outside the `if impl == 'modn'`, but in this way it is easier to remove again for non-`modn` implementations.

> I would prefer to have the warning in one place. If we ever allow a custom modulus, we should allow it for all implementations.
> 
> My vision for this "modulus" argument is that the following should assign to `a` a primitive root:
> 
> ```
> sage: K.<a> = GF(7, modulus='primitive')
> ```

The word "modulus" here is definitely wrong. If anything is a modulus for `GF(7)`, it is 7, because the natural way to construct `GF(7)` as *quotient* of `ZZ` by `7ZZ`.

In general, even for field *extensions*, the word modulus is confusing. That only applies if you're making the field as a quotient of a polynomial ring. For the purpose proposed, `generator` would cover the notion much better. I see from the doc that we have legacy against us on this one.



---

archive/issue_comments_223416.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nReplying to [@nbruin](#comment:28):\n> Replying to [@jdemeyer](#comment:24):\n> > My vision for this \"modulus\" argument is that the following should assign to `a` a primitive root:\n> > \n> > ```\n> > sage: K.<a> = GF(7, modulus='primitive')\n> > ```\n\n> \n> The word \"modulus\" here is definitely wrong. If anything is a modulus for `GF(7)`, it is 7, because the natural way to construct `GF(7)` as *quotient* of `ZZ` by `7ZZ`.\n\nDepends on how you look at it. For me, there is a big philosophical difference between `IntegerModRing(p)` and `GF(p)`. I see `IntegerModRing(m)` as `ZZ/(m)`, while `GF(p^n)` is `IntegerModRing(p)[x]/(f(x))` for an irreducible polynomial `f(x)` of degree `n`.\n\nFor fields `GF(p^n)` (n > 1), the word \"modulus\" for `f(x)` is certainly more standard than \"generator\". For me, the \"generator\" is the image of `x` in `GF(p^n) = IntegerModRing(p)[x]/(f(x))`, which is returned by the `gen()` method.",
    "created_at": "2014-09-16T15:48:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-223416",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:29" align="right">comment:29</div>

Replying to [@nbruin](#comment:28):
> Replying to [@jdemeyer](#comment:24):
> > My vision for this "modulus" argument is that the following should assign to `a` a primitive root:
> > 
> > ```
> > sage: K.<a> = GF(7, modulus='primitive')
> > ```

> 
> The word "modulus" here is definitely wrong. If anything is a modulus for `GF(7)`, it is 7, because the natural way to construct `GF(7)` as *quotient* of `ZZ` by `7ZZ`.

Depends on how you look at it. For me, there is a big philosophical difference between `IntegerModRing(p)` and `GF(p)`. I see `IntegerModRing(m)` as `ZZ/(m)`, while `GF(p^n)` is `IntegerModRing(p)[x]/(f(x))` for an irreducible polynomial `f(x)` of degree `n`.

For fields `GF(p^n)` (n > 1), the word "modulus" for `f(x)` is certainly more standard than "generator". For me, the "generator" is the image of `x` in `GF(p^n) = IntegerModRing(p)[x]/(f(x))`, which is returned by the `gen()` method.



---

archive/issue_comments_223417.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nReplying to [@jdemeyer](#comment:24):\n> My vision for this \"modulus\" argument is that the following should assign to `a` a primitive root:\n> \n> ```\n> sage: K.<a> = GF(7, modulus='primitive')\n> ```\n\nBy the way, this is now implemented at #16983.",
    "created_at": "2014-09-16T15:56:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-223417",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:30" align="right">comment:30</div>

Replying to [@jdemeyer](#comment:24):
> My vision for this "modulus" argument is that the following should assign to `a` a primitive root:
> 
> ```
> sage: K.<a> = GF(7, modulus='primitive')
> ```

By the way, this is now implemented at #16983.



---

archive/issue_events_243232.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-09-16T18:46:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16934#event-243232"
}
```



---

archive/issue_events_243233.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "8a8c35c2fd46bd76f75e00dc506033630cfe025b",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2014-09-16T18:46:36Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16934#event-243233"
}
```



---

archive/issue_comments_223418.json:
```json
{
    "body": "Changed branch from **[u/pbruin/16934-FiniteField_factory_key](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/16934-FiniteField_factory_key)** to **[`9cbdcde`](https://github.com/sagemath/sagetrac-mirror/commit/9cbdcde41b4783e7adf3f56451b9dedd36842f1d)**",
    "created_at": "2014-09-16T18:46:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-223418",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/pbruin/16934-FiniteField_factory_key](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/16934-FiniteField_factory_key)** to **[`9cbdcde`](https://github.com/sagemath/sagetrac-mirror/commit/9cbdcde41b4783e7adf3f56451b9dedd36842f1d)**
