# Issue 16934: Fix factory keys for finite fields to avoid repeated construction

archive/issues_016697.json:
```json
{
    "body": "The following sequence of commands somehow breaks the coercion framework. This is on vanilla Sage 6.4.beta1. The problem only occurs if `impl=\"pari_ffelt\"` is explicitly given, even though that is the default:\n\n```\nsage: k1.<a> = GF(17^14, impl=\"pari_ffelt\")\nsage: _ = PolynomialRing(k1, 'x')(a/2)\nsage: k2.<a> = GF(17^14, impl=\"pari_ffelt\")\nsage: _ = PolynomialRing(k2, 'x')(a/2)\nTraceback (most recent call last):\n...\nTypeError: no coercion defined\n```\n\nThe underlying reason is:\n\n```\nsage: k1 is k2\nFalse\n```\nThis double construction of the same finite field is caused by slightly different `UniqueFactory` keys arising during the construction of a common parent (for the computation of `a/2`) by the coercion system.\n\nRelated: #16855\n\nReviewer: Jeroen Demeyer\n\nAuthor: Peter Bruin\n\nBranch: 9cbdcde41b4783e7adf3f56451b9dedd36842f1d\n\nDependencies: #16930\n\nCommit: 9cbdcde41b4783e7adf3f56451b9dedd36842f1d\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/16934\n\n",
    "closed_at": "2014-09-16T18:46:36Z",
    "created_at": "2014-09-04T14:44:21Z",
    "labels": [
        "component: finite rings",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Fix factory keys for finite fields to avoid repeated construction",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16934",
    "user": "https://github.com/jdemeyer"
}
```
The following sequence of commands somehow breaks the coercion framework. This is on vanilla Sage 6.4.beta1. The problem only occurs if `impl="pari_ffelt"` is explicitly given, even though that is the default:

```
sage: k1.<a> = GF(17^14, impl="pari_ffelt")
sage: _ = PolynomialRing(k1, 'x')(a/2)
sage: k2.<a> = GF(17^14, impl="pari_ffelt")
sage: _ = PolynomialRing(k2, 'x')(a/2)
Traceback (most recent call last):
...
TypeError: no coercion defined
```

The underlying reason is:

```
sage: k1 is k2
False
```
This double construction of the same finite field is caused by slightly different `UniqueFactory` keys arising during the construction of a common parent (for the computation of `a/2`) by the coercion system.

Related: #16855

Reviewer: Jeroen Demeyer

Author: Peter Bruin

Branch: 9cbdcde41b4783e7adf3f56451b9dedd36842f1d

Dependencies: #16930

Commit: 9cbdcde41b4783e7adf3f56451b9dedd36842f1d

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/16934





---

archive/issue_comments_220302.json:
```json
{
    "body": "<a id='comment:9'></a>I don't claim to know what is going on, but it may be caused by equality and identity not being the same for finite fields; #16855 seems to fix this bug.",
    "created_at": "2014-09-04T15:37:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-220302",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:9'></a>I don't claim to know what is going on, but it may be caused by equality and identity not being the same for finite fields; #16855 seems to fix this bug.



---

archive/issue_comments_220303.json:
```json
{
    "body": "<a id='comment:10'></a>This guess is corroborated by the fact that the following change also appears to fix the bug:\n\n```diff\n--- a/src/sage/rings/finite_rings/element_pari_ffelt.pyx\n+++ b/src/sage/rings/finite_rings/element_pari_ffelt.pyx\n@@ -202,7 +202,7 @@ cdef class FiniteFieldElement_pari_ffelt(FinitePolyExtElement):\n         cdef Integer xi\n\n         if isinstance(x, FiniteFieldElement_pari_ffelt):\n-            if self._parent is (<FiniteFieldElement_pari_ffelt>x)._parent:\n+            if self._parent == (<FiniteFieldElement_pari_ffelt>x)._parent:\n                 pari_catch_sig_on()\n                 self.construct((<FiniteFieldElement_pari_ffelt>x).val)\n             else:\n```\nAfter #16855, this change effectively does nothing.",
    "created_at": "2014-09-04T16:08:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-220303",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:10'></a>This guess is corroborated by the fact that the following change also appears to fix the bug:

```diff
--- a/src/sage/rings/finite_rings/element_pari_ffelt.pyx
+++ b/src/sage/rings/finite_rings/element_pari_ffelt.pyx
@@ -202,7 +202,7 @@ cdef class FiniteFieldElement_pari_ffelt(FinitePolyExtElement):
         cdef Integer xi

         if isinstance(x, FiniteFieldElement_pari_ffelt):
-            if self._parent is (<FiniteFieldElement_pari_ffelt>x)._parent:
+            if self._parent == (<FiniteFieldElement_pari_ffelt>x)._parent:
                 pari_catch_sig_on()
                 self.construct((<FiniteFieldElement_pari_ffelt>x).val)
             else:
```
After #16855, this change effectively does nothing.



---

archive/issue_comments_220304.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [comment:10 pbruin]:\n> {{{\n> #!diff\n> --- a/src/sage/rings/finite_rings/element_pari_ffelt.pyx\n> +++ b/src/sage/rings/finite_rings/element_pari_ffelt.pyx\n> `@``@` -202,7 +202,7 `@``@` cdef class FiniteFieldElement_pari_ffelt(FinitePolyExtElement):\n>          cdef Integer xi\n> \n>          if isinstance(x, FiniteFieldElement_pari_ffelt):\n> -            if self._parent is (<FiniteFieldElement_pari_ffelt>x)._parent:\n> +            if self._parent == (<FiniteFieldElement_pari_ffelt>x)._parent:\n>                  pari_catch_sig_on()\n>                  self.construct((<FiniteFieldElement_pari_ffelt>x).val)\n>              else:\n> }}}\n\n\nWould you propose to make the above change, or simply to close as ticket as dupe of #16855?",
    "created_at": "2014-09-04T18:12:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-220304",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>Replying to [comment:10 pbruin]:
> {{{
> #!diff
> --- a/src/sage/rings/finite_rings/element_pari_ffelt.pyx
> +++ b/src/sage/rings/finite_rings/element_pari_ffelt.pyx
> `@``@` -202,7 +202,7 `@``@` cdef class FiniteFieldElement_pari_ffelt(FinitePolyExtElement):
>          cdef Integer xi
> 
>          if isinstance(x, FiniteFieldElement_pari_ffelt):
> -            if self._parent is (<FiniteFieldElement_pari_ffelt>x)._parent:
> +            if self._parent == (<FiniteFieldElement_pari_ffelt>x)._parent:
>                  pari_catch_sig_on()
>                  self.construct((<FiniteFieldElement_pari_ffelt>x).val)
>              else:
> }}}


Would you propose to make the above change, or simply to close as ticket as dupe of #16855?



---

archive/issue_comments_220305.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:11 jdemeyer]:\n> Would you propose to make the above change, or simply to close as ticket as dupe of #16855?\n\nI would say either we close this as a duplicate of #16855, or we try to fix the other bug (comment:11:ticket:16855) here:\n\n```\nsage: k1.<a> = GF(17^14, impl=\"pari_ffelt\")\nsage: _ = a/2\nsage: k2.<a> = GF(17^14, impl=\"pari_ffelt\")\nsage: k1 is k2\nFalse\n```",
    "created_at": "2014-09-05T08:06:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-220305",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:14'></a>Replying to [comment:11 jdemeyer]:
> Would you propose to make the above change, or simply to close as ticket as dupe of #16855?

I would say either we close this as a duplicate of #16855, or we try to fix the other bug (comment:11:ticket:16855) here:

```
sage: k1.<a> = GF(17^14, impl="pari_ffelt")
sage: _ = a/2
sage: k2.<a> = GF(17^14, impl="pari_ffelt")
sage: k1 is k2
False
```



---

archive/issue_comments_220306.json:
```json
{
    "body": "<a id='comment:15'></a>OK, let's wait and see what happens with #16855 then...",
    "created_at": "2014-09-05T08:39:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-220306",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>OK, let's wait and see what happens with #16855 then...



---

archive/issue_comments_220307.json:
```json
{
    "body": "<a id='comment:16'></a>The construction of the non-identical `k1` and `k2` appears to be due to a subtlety involving the `FiniteFieldFactory.other_keys()` method and an intermediate construction of another finite field (defined by the same data but with `impl=None`) during the construction of a common parent for the computation of `a/2`.  The keys returned by `other_keys()` only differ in the `impl` keyword.  I think the best solution is to always set the `impl` keyword when constructing the key (as opposed to allowing it to be `None`).  Then the use of this `other_keys()` method, which feels to me somewhat like a hack, can be avoided.",
    "created_at": "2014-09-05T13:29:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-220307",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:16'></a>The construction of the non-identical `k1` and `k2` appears to be due to a subtlety involving the `FiniteFieldFactory.other_keys()` method and an intermediate construction of another finite field (defined by the same data but with `impl=None`) during the construction of a common parent for the computation of `a/2`.  The keys returned by `other_keys()` only differ in the `impl` keyword.  I think the best solution is to always set the `impl` keyword when constructing the key (as opposed to allowing it to be `None`).  Then the use of this `other_keys()` method, which feels to me somewhat like a hack, can be avoided.



---

archive/issue_comments_220308.json:
```json
{
    "body": "<a id='comment:17'></a>This branch depends on #16930 to avoid merge conflicts.  It merges with, and works independently of, #16855.",
    "created_at": "2014-09-05T13:44:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-220308",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:17'></a>This branch depends on #16930 to avoid merge conflicts.  It merges with, and works independently of, #16855.



---

archive/issue_comments_220309.json:
```json
{
    "body": "Changing component from coercion to finite rings.",
    "created_at": "2014-09-05T13:44:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-220309",
    "user": "https://github.com/pjbruin"
}
```

Changing component from coercion to finite rings.



---

archive/issue_comments_220310.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-09-05T13:44:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-220310",
    "user": "https://github.com/pjbruin"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_220311.json:
```json
{
    "body": "<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-09-05T13:52:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-220311",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_220312.json:
```json
{
    "body": "<a id='comment:19'></a>Diff for easier reviewing: [http://git.sagemath.org/sage.git/diff/?id2=8cdbd7920c73713a3a8dbea697451649f0434f0a&id=ffb74fa8116d1a60e255300370ca4467e3b36732](http://git.sagemath.org/sage.git/diff/?id2=8cdbd7920c73713a3a8dbea697451649f0434f0a&id=ffb74fa8116d1a60e255300370ca4467e3b36732)",
    "created_at": "2014-09-05T13:56:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-220312",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:19'></a>Diff for easier reviewing: [http://git.sagemath.org/sage.git/diff/?id2=8cdbd7920c73713a3a8dbea697451649f0434f0a&id=ffb74fa8116d1a60e255300370ca4467e3b36732](http://git.sagemath.org/sage.git/diff/?id2=8cdbd7920c73713a3a8dbea697451649f0434f0a&id=ffb74fa8116d1a60e255300370ca4467e3b36732)



---

archive/issue_comments_220313.json:
```json
{
    "body": "<a id='comment:21'></a>Please restore the warning\n\n```\nwarn(\"the 'modulus' argument is ignored when constructing prime finite fields\")\n```\nfor all prime finite field implementations because the modulus really is ignored:\n\n```\nsage: x = polygen(GF(7)); GF(7, modulus=x-2, impl=\"givaro\").modulus()\nx + 6\n```\n\nOf course we could change that behaviour (perhaps we should), but let's do that on a new ticket.\n\n---\nNew commits:",
    "created_at": "2014-09-12T09:00:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-220313",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:21'></a>Please restore the warning

```
warn("the 'modulus' argument is ignored when constructing prime finite fields")
```
for all prime finite field implementations because the modulus really is ignored:

```
sage: x = polygen(GF(7)); GF(7, modulus=x-2, impl="givaro").modulus()
x + 6
```

Of course we could change that behaviour (perhaps we should), but let's do that on a new ticket.

---
New commits:



---

archive/issue_comments_220314.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-09-12T09:00:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-220314",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_220315.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-09-12T11:20:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-220315",
    "user": "https://github.com/pjbruin"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_220316.json:
```json
{
    "body": "<a id='comment:22'></a>This commit adds back the warning.  Alternatively, it could have been put outside the `if impl == 'modn'`, but in this way it is easier to remove again for non-`modn` implementations.",
    "created_at": "2014-09-12T11:20:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-220316",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:22'></a>This commit adds back the warning.  Alternatively, it could have been put outside the `if impl == 'modn'`, but in this way it is easier to remove again for non-`modn` implementations.



---

archive/issue_comments_220317.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-09-12T13:18:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-220317",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_220318.json:
```json
{
    "body": "<a id='comment:23'></a>```\nsage: GF(7, impl=\"givaro\", modulus=\"primitive\")\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n<ipython-input-2-c6a1d2461111> in <module>()\n----> 1 GF(Integer(7), impl=\"givaro\", modulus=\"primitive\")\n\n/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/structure/factory.so in sage.structure.factory.UniqueFactory.__call__ (build/cythonized/sage/structure/factory.c:1160)()\n                                                                                                                                                                        \n/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/rings/finite_rings/constructor.pyc in create_key_and_extra_args(self, order, name, modulus, names, impl, proof, check_irreducible, **kwds)                                                                                                                                       \n    521                 if not modulus.is_irreducible():                                                                                                                \n    522                     raise ValueError(\"finite field modulus must be irreducible but it is not.\")\n--> 523             if modulus is not None and modulus.degree() != n:\n    524                 raise ValueError(\"the degree of the modulus does not equal the degree of the field.\")\n    525 \n\nAttributeError: 'str' object has no attribute 'degree'\n```",
    "created_at": "2014-09-12T13:18:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-220318",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'></a>```
sage: GF(7, impl="givaro", modulus="primitive")
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-2-c6a1d2461111> in <module>()
----> 1 GF(Integer(7), impl="givaro", modulus="primitive")

/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/structure/factory.so in sage.structure.factory.UniqueFactory.__call__ (build/cythonized/sage/structure/factory.c:1160)()
                                                                                                                                                                        
/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/rings/finite_rings/constructor.pyc in create_key_and_extra_args(self, order, name, modulus, names, impl, proof, check_irreducible, **kwds)                                                                                                                                       
    521                 if not modulus.is_irreducible():                                                                                                                
    522                     raise ValueError("finite field modulus must be irreducible but it is not.")
--> 523             if modulus is not None and modulus.degree() != n:
    524                 raise ValueError("the degree of the modulus does not equal the degree of the field.")
    525 

AttributeError: 'str' object has no attribute 'degree'
```



---

archive/issue_comments_220319.json:
```json
{
    "body": "<a id='comment:24'></a>Replying to [comment:22 pbruin]:\n> This commit adds back the warning.  Alternatively, it could have been put outside the `if impl == 'modn'`, but in this way it is easier to remove again for non-`modn` implementations.\n\nI would prefer to have the warning in one place. If we ever allow a custom modulus, we should allow it for all implementations.\n\nMy vision for this \"modulus\" argument is that the following should assign to `a` a primitive root:\n\n```\nsage: K.<a> = GF(7, modulus='primitive')\n```\nso perhaps we should expand the warning to say\n\n```\nwarn(\"currently, the 'modulus' argument is ignored when constructing prime finite fields. This might change in the future and this will probably also change the output of the .gen() and .modulus() methods on the finite field.\\nSee http://trac.sagemath.org/16930 for details.\")\n```",
    "created_at": "2014-09-12T13:23:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-220319",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:24'></a>Replying to [comment:22 pbruin]:
> This commit adds back the warning.  Alternatively, it could have been put outside the `if impl == 'modn'`, but in this way it is easier to remove again for non-`modn` implementations.

I would prefer to have the warning in one place. If we ever allow a custom modulus, we should allow it for all implementations.

My vision for this "modulus" argument is that the following should assign to `a` a primitive root:

```
sage: K.<a> = GF(7, modulus='primitive')
```
so perhaps we should expand the warning to say

```
warn("currently, the 'modulus' argument is ignored when constructing prime finite fields. This might change in the future and this will probably also change the output of the .gen() and .modulus() methods on the finite field.\nSee http://trac.sagemath.org/16930 for details.")
```



---

archive/issue_comments_220320.json:
```json
{
    "body": "<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-09-12T16:46:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-220320",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_220321.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-09-12T16:47:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-220321",
    "user": "https://github.com/pjbruin"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_220322.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-09-15T08:58:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-220322",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_220323.json:
```json
{
    "body": "<a id='comment:28'></a>Replying to [comment:24 jdemeyer]:\n> Replying to [comment:22 pbruin]:\n> > This commit adds back the warning.  Alternatively, it could have been put outside the `if impl == 'modn'`, but in this way it is easier to remove again for non-`modn` implementations.\n\n> I would prefer to have the warning in one place. If we ever allow a custom modulus, we should allow it for all implementations.\n> \n> My vision for this \"modulus\" argument is that the following should assign to `a` a primitive root:\n> \n> ```\n> sage: K.<a> = GF(7, modulus='primitive')\n> ```\n\n\nThe word \"modulus\" here is definitely wrong. If anything is a modulus for `GF(7)`, it is 7, because the natural way to construct `GF(7)` as *quotient* of `ZZ` by `7ZZ`.\n\nIn general, even for field *extensions*, the word modulus is confusing. That only applies if you're making the field as a quotient of a polynomial ring. For the purpose proposed, `generator` would cover the notion much better. I see from the doc that we have legacy against us on this one.",
    "created_at": "2014-09-15T18:05:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-220323",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:28'></a>Replying to [comment:24 jdemeyer]:
> Replying to [comment:22 pbruin]:
> > This commit adds back the warning.  Alternatively, it could have been put outside the `if impl == 'modn'`, but in this way it is easier to remove again for non-`modn` implementations.

> I would prefer to have the warning in one place. If we ever allow a custom modulus, we should allow it for all implementations.
> 
> My vision for this "modulus" argument is that the following should assign to `a` a primitive root:
> 
> ```
> sage: K.<a> = GF(7, modulus='primitive')
> ```


The word "modulus" here is definitely wrong. If anything is a modulus for `GF(7)`, it is 7, because the natural way to construct `GF(7)` as *quotient* of `ZZ` by `7ZZ`.

In general, even for field *extensions*, the word modulus is confusing. That only applies if you're making the field as a quotient of a polynomial ring. For the purpose proposed, `generator` would cover the notion much better. I see from the doc that we have legacy against us on this one.



---

archive/issue_comments_220324.json:
```json
{
    "body": "<a id='comment:29'></a>Replying to [comment:28 nbruin]:\n> Replying to [comment:24 jdemeyer]:\n> > My vision for this \"modulus\" argument is that the following should assign to `a` a primitive root:\n> > \n> > ```\n> > sage: K.<a> = GF(7, modulus='primitive')\n> > ```\n\n> \n> The word \"modulus\" here is definitely wrong. If anything is a modulus for `GF(7)`, it is 7, because the natural way to construct `GF(7)` as *quotient* of `ZZ` by `7ZZ`.\n\nDepends on how you look at it. For me, there is a big philosophical difference between `IntegerModRing(p)` and `GF(p)`. I see `IntegerModRing(m)` as `ZZ/(m)`, while `GF(p^n)` is `IntegerModRing(p)[x]/(f(x))` for an irreducible polynomial `f(x)` of degree `n`.\n\nFor fields `GF(p^n)` (n > 1), the word \"modulus\" for `f(x)` is certainly more standard than \"generator\". For me, the \"generator\" is the image of `x` in `GF(p^n) = IntegerModRing(p)[x]/(f(x))`, which is returned by the `gen()` method.",
    "created_at": "2014-09-16T15:48:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-220324",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:29'></a>Replying to [comment:28 nbruin]:
> Replying to [comment:24 jdemeyer]:
> > My vision for this "modulus" argument is that the following should assign to `a` a primitive root:
> > 
> > ```
> > sage: K.<a> = GF(7, modulus='primitive')
> > ```

> 
> The word "modulus" here is definitely wrong. If anything is a modulus for `GF(7)`, it is 7, because the natural way to construct `GF(7)` as *quotient* of `ZZ` by `7ZZ`.

Depends on how you look at it. For me, there is a big philosophical difference between `IntegerModRing(p)` and `GF(p)`. I see `IntegerModRing(m)` as `ZZ/(m)`, while `GF(p^n)` is `IntegerModRing(p)[x]/(f(x))` for an irreducible polynomial `f(x)` of degree `n`.

For fields `GF(p^n)` (n > 1), the word "modulus" for `f(x)` is certainly more standard than "generator". For me, the "generator" is the image of `x` in `GF(p^n) = IntegerModRing(p)[x]/(f(x))`, which is returned by the `gen()` method.



---

archive/issue_comments_220325.json:
```json
{
    "body": "<a id='comment:30'></a>Replying to [comment:24 jdemeyer]:\n> My vision for this \"modulus\" argument is that the following should assign to `a` a primitive root:\n> \n> ```\n> sage: K.<a> = GF(7, modulus='primitive')\n> ```\n\nBy the way, this is now implemented at #16983.",
    "created_at": "2014-09-16T15:56:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-220325",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:30'></a>Replying to [comment:24 jdemeyer]:
> My vision for this "modulus" argument is that the following should assign to `a` a primitive root:
> 
> ```
> sage: K.<a> = GF(7, modulus='primitive')
> ```

By the way, this is now implemented at #16983.



---

archive/issue_comments_220326.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-09-16T18:46:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16934#issuecomment-220326",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_049419.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-09-16T18:46:36Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16934",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16934#event-49419"
}
```
