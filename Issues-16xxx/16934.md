# Issue 16934: Fix factory keys for finite fields to avoid repeated construction

archive/issues_016697.json:
```json
{
    "assignees": [],
    "body": "The following sequence of commands somehow breaks the coercion framework. This is on vanilla Sage 6.4.beta1. The problem only occurs if `impl=\"pari_ffelt\"` is explicitly given, even though that is the default:\n\n```\nsage: k1.<a> = GF(17^14, impl=\"pari_ffelt\")\nsage: _ = PolynomialRing(k1, 'x')(a/2)\nsage: k2.<a> = GF(17^14, impl=\"pari_ffelt\")\nsage: _ = PolynomialRing(k2, 'x')(a/2)\nTraceback (most recent call last):\n...\nTypeError: no coercion defined\n```\n\nThe underlying reason is:\n\n```\nsage: k1 is k2\nFalse\n```\nThis double construction of the same finite field is caused by slightly different `UniqueFactory` keys arising during the construction of a common parent (for the computation of `a/2`) by the coercion system.\n\nRelated: #16855\n\nDepends on #16930\n\n**Branch/Commit:** [9cbdcde41b4783e7adf3f56451b9dedd36842f1d](https://github.com/sagemath/sagetrac-mirror/commit/9cbdcde41b4783e7adf3f56451b9dedd36842f1d)\n\n**Reviewer:** Jeroen Demeyer\n\n**Author:** Peter Bruin\n\nIssue created by migration from https://trac.sagemath.org/ticket/16934\n\n",
    "closed_at": "2014-09-16T18:46:36Z",
    "created_at": "2014-09-04T14:44:21Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20finite%20rings",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Fix factory keys for finite fields to avoid repeated construction",
    "type": "issue",
    "updated_at": "2014-09-16T18:46:36Z",
    "url": "https://github.com/sagemath/sage/issues/16934",
    "user": "https://github.com/jdemeyer"
}
```
The following sequence of commands somehow breaks the coercion framework. This is on vanilla Sage 6.4.beta1. The problem only occurs if `impl="pari_ffelt"` is explicitly given, even though that is the default:

```
sage: k1.<a> = GF(17^14, impl="pari_ffelt")
sage: _ = PolynomialRing(k1, 'x')(a/2)
sage: k2.<a> = GF(17^14, impl="pari_ffelt")
sage: _ = PolynomialRing(k2, 'x')(a/2)
Traceback (most recent call last):
...
TypeError: no coercion defined
```

The underlying reason is:

```
sage: k1 is k2
False
```
This double construction of the same finite field is caused by slightly different `UniqueFactory` keys arising during the construction of a common parent (for the computation of `a/2`) by the coercion system.

Related: #16855

Depends on #16930

**Branch/Commit:** [9cbdcde41b4783e7adf3f56451b9dedd36842f1d](https://github.com/sagemath/sagetrac-mirror/commit/9cbdcde41b4783e7adf3f56451b9dedd36842f1d)

**Reviewer:** Jeroen Demeyer

**Author:** Peter Bruin

Issue created by migration from https://trac.sagemath.org/ticket/16934





---

archive/issue_events_207310.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-09-04T14:44:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16934#event-207310"
}
```



---

archive/issue_events_207311.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-09-04T14:44:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20coercion",
    "label_color": "08517b",
    "label_name": "component: coercion",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16934#event-207311"
}
```



---

archive/issue_events_207312.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-09-04T14:44:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "008080",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16934#event-207312"
}
```



---

archive/issue_comments_225873.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -4,7 +4,7 @@\n sage: k.<a> = GF(17^14, impl=\"pari_ffelt\")\n sage: _ = EllipticCurve_from_j(a^584645231109031).cardinality()\n sage: k.<a> = GF(17^14, impl=\"pari_ffelt\")\n-sage: _ = EllipticCurve_from_j(a^584645231109031).cardinality()\n+sage: E = EllipticCurve_from_j(a^584645231109031)\n TypeError                                 Traceback (most recent call last)\n [...]\n TypeError: no coercion defined\n``````\n",
    "created_at": "2014-09-04T14:52:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-225873",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -4,7 +4,7 @@
 sage: k.<a> = GF(17^14, impl="pari_ffelt")
 sage: _ = EllipticCurve_from_j(a^584645231109031).cardinality()
 sage: k.<a> = GF(17^14, impl="pari_ffelt")
-sage: _ = EllipticCurve_from_j(a^584645231109031).cardinality()
+sage: E = EllipticCurve_from_j(a^584645231109031)
 TypeError                                 Traceback (most recent call last)
 [...]
 TypeError: no coercion defined
``````




---

archive/issue_comments_225874.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,9 +2,11 @@\n \n ```\n sage: k.<a> = GF(17^14, impl=\"pari_ffelt\")\n-sage: _ = EllipticCurve_from_j(a^584645231109031).cardinality()\n+sage: E1 = EllipticCurve_from_j(a^584645231109031)\n+sage: E2 = EllipticCurve_from_j(a^584645231109031)\n+sage: _ = E1.is_isomorphic(E2)\n sage: k.<a> = GF(17^14, impl=\"pari_ffelt\")\n-sage: E = EllipticCurve_from_j(a^584645231109031)\n+sage: E3 = EllipticCurve_from_j(a^584645231109031)\n TypeError                                 Traceback (most recent call last)\n [...]\n TypeError: no coercion defined\n``````\n",
    "created_at": "2014-09-04T14:55:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-225874",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,9 +2,11 @@
 
 ```
 sage: k.<a> = GF(17^14, impl="pari_ffelt")
-sage: _ = EllipticCurve_from_j(a^584645231109031).cardinality()
+sage: E1 = EllipticCurve_from_j(a^584645231109031)
+sage: E2 = EllipticCurve_from_j(a^584645231109031)
+sage: _ = E1.is_isomorphic(E2)
 sage: k.<a> = GF(17^14, impl="pari_ffelt")
-sage: E = EllipticCurve_from_j(a^584645231109031)
+sage: E3 = EllipticCurve_from_j(a^584645231109031)
 TypeError                                 Traceback (most recent call last)
 [...]
 TypeError: no coercion defined
``````




---

archive/issue_comments_225875.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -12,4 +12,4 @@\n TypeError: no coercion defined\n ```\n \n-Remark: the value `a^584645231109031` is chosen to lie in the subfield `GF(17^2)`, an elliptic curve over this field is created in the `cardinality()` call.\n+Remark: the value `a^584645231109031` is chosen to lie in the subfield `GF(17^2)`.\n``````\n",
    "created_at": "2014-09-04T14:55:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-225875",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -12,4 +12,4 @@
 TypeError: no coercion defined
 ```
 
-Remark: the value `a^584645231109031` is chosen to lie in the subfield `GF(17^2)`, an elliptic curve over this field is created in the `cardinality()` call.
+Remark: the value `a^584645231109031` is chosen to lie in the subfield `GF(17^2)`.
``````




---

archive/issue_comments_225876.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,11 +2,10 @@\n \n ```\n sage: k.<a> = GF(17^14, impl=\"pari_ffelt\")\n-sage: E1 = EllipticCurve_from_j(a^584645231109031)\n-sage: E2 = EllipticCurve_from_j(a^584645231109031)\n-sage: _ = E1.is_isomorphic(E2)\n+sage: E = EllipticCurve_from_j(a)\n+sage: _ = E.is_isomorphic(E)\n sage: k.<a> = GF(17^14, impl=\"pari_ffelt\")\n-sage: E3 = EllipticCurve_from_j(a^584645231109031)\n+sage: E = EllipticCurve_from_j(a)\n TypeError                                 Traceback (most recent call last)\n [...]\n TypeError: no coercion defined\n``````\n",
    "created_at": "2014-09-04T14:57:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-225876",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,11 +2,10 @@
 
 ```
 sage: k.<a> = GF(17^14, impl="pari_ffelt")
-sage: E1 = EllipticCurve_from_j(a^584645231109031)
-sage: E2 = EllipticCurve_from_j(a^584645231109031)
-sage: _ = E1.is_isomorphic(E2)
+sage: E = EllipticCurve_from_j(a)
+sage: _ = E.is_isomorphic(E)
 sage: k.<a> = GF(17^14, impl="pari_ffelt")
-sage: E3 = EllipticCurve_from_j(a^584645231109031)
+sage: E = EllipticCurve_from_j(a)
 TypeError                                 Traceback (most recent call last)
 [...]
 TypeError: no coercion defined
``````




---

archive/issue_comments_225877.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -10,5 +10,3 @@\n [...]\n TypeError: no coercion defined\n ```\n-\n-Remark: the value `a^584645231109031` is chosen to lie in the subfield `GF(17^2)`.\n``````\n",
    "created_at": "2014-09-04T14:57:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-225877",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -10,5 +10,3 @@
 [...]
 TypeError: no coercion defined
 ```
-
-Remark: the value `a^584645231109031` is chosen to lie in the subfield `GF(17^2)`.
``````




---

archive/issue_comments_225878.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,10 +2,9 @@\n \n ```\n sage: k.<a> = GF(17^14, impl=\"pari_ffelt\")\n-sage: E = EllipticCurve_from_j(a)\n-sage: _ = E.is_isomorphic(E)\n+sage: E = EllipticCurve_from_j(a/2)\n sage: k.<a> = GF(17^14, impl=\"pari_ffelt\")\n-sage: E = EllipticCurve_from_j(a)\n+sage: E = EllipticCurve_from_j(a/2)\n TypeError                                 Traceback (most recent call last)\n [...]\n TypeError: no coercion defined\n``````\n",
    "created_at": "2014-09-04T15:08:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-225878",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,10 +2,9 @@
 
 ```
 sage: k.<a> = GF(17^14, impl="pari_ffelt")
-sage: E = EllipticCurve_from_j(a)
-sage: _ = E.is_isomorphic(E)
+sage: E = EllipticCurve_from_j(a/2)
 sage: k.<a> = GF(17^14, impl="pari_ffelt")
-sage: E = EllipticCurve_from_j(a)
+sage: E = EllipticCurve_from_j(a/2)
 TypeError                                 Traceback (most recent call last)
 [...]
 TypeError: no coercion defined
``````




---

archive/issue_comments_225879.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,9 +2,9 @@\n \n ```\n sage: k.<a> = GF(17^14, impl=\"pari_ffelt\")\n-sage: E = EllipticCurve_from_j(a/2)\n+sage: _ = PolynomialRing(k, 'x')(a/2)\n sage: k.<a> = GF(17^14, impl=\"pari_ffelt\")\n-sage: E = EllipticCurve_from_j(a/2)\n+sage: _ = PolynomialRing(k, 'x')(a/2)\n TypeError                                 Traceback (most recent call last)\n [...]\n TypeError: no coercion defined\n``````\n",
    "created_at": "2014-09-04T15:20:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-225879",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,9 +2,9 @@
 
 ```
 sage: k.<a> = GF(17^14, impl="pari_ffelt")
-sage: E = EllipticCurve_from_j(a/2)
+sage: _ = PolynomialRing(k, 'x')(a/2)
 sage: k.<a> = GF(17^14, impl="pari_ffelt")
-sage: E = EllipticCurve_from_j(a/2)
+sage: _ = PolynomialRing(k, 'x')(a/2)
 TypeError                                 Traceback (most recent call last)
 [...]
 TypeError: no coercion defined
``````




---

archive/issue_comments_225880.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -5,7 +5,7 @@\n sage: _ = PolynomialRing(k, 'x')(a/2)\n sage: k.<a> = GF(17^14, impl=\"pari_ffelt\")\n sage: _ = PolynomialRing(k, 'x')(a/2)\n-TypeError                                 Traceback (most recent call last)\n-[...]\n+Traceback (most recent call last):\n+...\n TypeError: no coercion defined\n ```\n``````\n",
    "created_at": "2014-09-04T15:21:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-225880",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -5,7 +5,7 @@
 sage: _ = PolynomialRing(k, 'x')(a/2)
 sage: k.<a> = GF(17^14, impl="pari_ffelt")
 sage: _ = PolynomialRing(k, 'x')(a/2)
-TypeError                                 Traceback (most recent call last)
-[...]
+Traceback (most recent call last):
+...
 TypeError: no coercion defined
 ```
``````




---

archive/issue_comments_225881.json:
```json
{
    "body": "<a id='comment:9'>**Comment 9:**</a>\nI don't claim to know what is going on, but it may be caused by equality and identity not being the same for finite fields; #16855 seems to fix this bug.",
    "created_at": "2014-09-04T15:37:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-225881",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:9'>**Comment 9:**</a>
I don't claim to know what is going on, but it may be caused by equality and identity not being the same for finite fields; #16855 seems to fix this bug.



---

archive/issue_comments_225882.json:
```json
{
    "body": "<a id='comment:10'>**Comment 10:**</a>\nThis guess is corroborated by the fact that the following change also appears to fix the bug:\n\n```diff\n--- a/src/sage/rings/finite_rings/element_pari_ffelt.pyx\n+++ b/src/sage/rings/finite_rings/element_pari_ffelt.pyx\n@@ -202,7 +202,7 @@ cdef class FiniteFieldElement_pari_ffelt(FinitePolyExtElement):\n         cdef Integer xi\n\n         if isinstance(x, FiniteFieldElement_pari_ffelt):\n-            if self._parent is (<FiniteFieldElement_pari_ffelt>x)._parent:\n+            if self._parent == (<FiniteFieldElement_pari_ffelt>x)._parent:\n                 pari_catch_sig_on()\n                 self.construct((<FiniteFieldElement_pari_ffelt>x).val)\n             else:\n```\nAfter #16855, this change effectively does nothing.",
    "created_at": "2014-09-04T16:08:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-225882",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:10'>**Comment 10:**</a>
This guess is corroborated by the fact that the following change also appears to fix the bug:

```diff
--- a/src/sage/rings/finite_rings/element_pari_ffelt.pyx
+++ b/src/sage/rings/finite_rings/element_pari_ffelt.pyx
@@ -202,7 +202,7 @@ cdef class FiniteFieldElement_pari_ffelt(FinitePolyExtElement):
         cdef Integer xi

         if isinstance(x, FiniteFieldElement_pari_ffelt):
-            if self._parent is (<FiniteFieldElement_pari_ffelt>x)._parent:
+            if self._parent == (<FiniteFieldElement_pari_ffelt>x)._parent:
                 pari_catch_sig_on()
                 self.construct((<FiniteFieldElement_pari_ffelt>x).val)
             else:
```
After #16855, this change effectively does nothing.



---

archive/issue_comments_225883.json:
```json
{
    "body": "<a id='comment:11'>**Comment 11:**</a>\nReplying to [@pjbruin](#comment%3A10):\n> \n> ```diff\n> --- a/src/sage/rings/finite_rings/element_pari_ffelt.pyx\n> +++ b/src/sage/rings/finite_rings/element_pari_ffelt.pyx\n> @@ -202,7 +202,7 @@ cdef class FiniteFieldElement_pari_ffelt(FinitePolyExtElement):\n>          cdef Integer xi\n> \n>          if isinstance(x, FiniteFieldElement_pari_ffelt):\n> -            if self._parent is (<FiniteFieldElement_pari_ffelt>x)._parent:\n> +            if self._parent == (<FiniteFieldElement_pari_ffelt>x)._parent:\n>                  pari_catch_sig_on()\n>                  self.construct((<FiniteFieldElement_pari_ffelt>x).val)\n>              else:\n> ```\n\nWould you propose to make the above change, or simply to close as ticket as dupe of #16855?",
    "created_at": "2014-09-04T18:12:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-225883",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'>**Comment 11:**</a>
Replying to [@pjbruin](#comment%3A10):
> 
> ```diff
> --- a/src/sage/rings/finite_rings/element_pari_ffelt.pyx
> +++ b/src/sage/rings/finite_rings/element_pari_ffelt.pyx
> @@ -202,7 +202,7 @@ cdef class FiniteFieldElement_pari_ffelt(FinitePolyExtElement):
>          cdef Integer xi
> 
>          if isinstance(x, FiniteFieldElement_pari_ffelt):
> -            if self._parent is (<FiniteFieldElement_pari_ffelt>x)._parent:
> +            if self._parent == (<FiniteFieldElement_pari_ffelt>x)._parent:
>                  pari_catch_sig_on()
>                  self.construct((<FiniteFieldElement_pari_ffelt>x).val)
>              else:
> ```

Would you propose to make the above change, or simply to close as ticket as dupe of #16855?



---

archive/issue_comments_225884.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,11 +1,18 @@\n The following sequence of commands somehow breaks the coercion framework. This is on vanilla Sage 6.4.beta1. The problem only occurs if `impl=\"pari_ffelt\"` is explicitly given, even though that is the default:\n \n ```\n-sage: k.<a> = GF(17^14, impl=\"pari_ffelt\")\n-sage: _ = PolynomialRing(k, 'x')(a/2)\n-sage: k.<a> = GF(17^14, impl=\"pari_ffelt\")\n-sage: _ = PolynomialRing(k, 'x')(a/2)\n+sage: k1.<a> = GF(17^14, impl=\"pari_ffelt\")\n+sage: _ = PolynomialRing(k1, 'x')(a/2)\n+sage: k2.<a> = GF(17^14, impl=\"pari_ffelt\")\n+sage: _ = PolynomialRing(k2, 'x')(a/2)\n Traceback (most recent call last):\n ...\n TypeError: no coercion defined\n ```\n+\n+The underlying reason is #16855:\n+\n+```\n+sage: k1 is k2\n+False\n+```\n``````\n",
    "created_at": "2014-09-04T20:02:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-225884",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,11 +1,18 @@
 The following sequence of commands somehow breaks the coercion framework. This is on vanilla Sage 6.4.beta1. The problem only occurs if `impl="pari_ffelt"` is explicitly given, even though that is the default:
 
 ```
-sage: k.<a> = GF(17^14, impl="pari_ffelt")
-sage: _ = PolynomialRing(k, 'x')(a/2)
-sage: k.<a> = GF(17^14, impl="pari_ffelt")
-sage: _ = PolynomialRing(k, 'x')(a/2)
+sage: k1.<a> = GF(17^14, impl="pari_ffelt")
+sage: _ = PolynomialRing(k1, 'x')(a/2)
+sage: k2.<a> = GF(17^14, impl="pari_ffelt")
+sage: _ = PolynomialRing(k2, 'x')(a/2)
 Traceback (most recent call last):
 ...
 TypeError: no coercion defined
 ```
+
+The underlying reason is #16855:
+
+```
+sage: k1 is k2
+False
+```
``````




---

archive/issue_comments_225885.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -10,9 +10,11 @@\n TypeError: no coercion defined\n ```\n \n-The underlying reason is #16855:\n+The underlying reason is:\n \n ```\n sage: k1 is k2\n False\n ```\n+\n+Related: #16855\n``````\n",
    "created_at": "2014-09-04T20:14:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-225885",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -10,9 +10,11 @@
 TypeError: no coercion defined
 ```
 
-The underlying reason is #16855:
+The underlying reason is:
 
 ```
 sage: k1 is k2
 False
 ```
+
+Related: #16855
``````




---

archive/issue_comments_225886.json:
```json
{
    "body": "<a id='comment:14'>**Comment 14:**</a>\nReplying to [@jdemeyer](#comment%3A11):\n> Would you propose to make the above change, or simply to close as ticket as dupe of #16855?\n\nI would say either we close this as a duplicate of #16855, or we try to fix the other bug ([#16855 comment:11](https://github.com/sagemath/sage/issues/16855#comment:11)) here:\n\n```\nsage: k1.<a> = GF(17^14, impl=\"pari_ffelt\")\nsage: _ = a/2\nsage: k2.<a> = GF(17^14, impl=\"pari_ffelt\")\nsage: k1 is k2\nFalse\n```",
    "created_at": "2014-09-05T08:06:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-225886",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:14'>**Comment 14:**</a>
Replying to [@jdemeyer](#comment%3A11):
> Would you propose to make the above change, or simply to close as ticket as dupe of #16855?

I would say either we close this as a duplicate of #16855, or we try to fix the other bug ([#16855 comment:11](https://github.com/sagemath/sage/issues/16855#comment:11)) here:

```
sage: k1.<a> = GF(17^14, impl="pari_ffelt")
sage: _ = a/2
sage: k2.<a> = GF(17^14, impl="pari_ffelt")
sage: k1 is k2
False
```



---

archive/issue_comments_225887.json:
```json
{
    "body": "<a id='comment:15'>**Comment 15:**</a>\nOK, let's wait and see what happens with #16855 then...",
    "created_at": "2014-09-05T08:39:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-225887",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'>**Comment 15:**</a>
OK, let's wait and see what happens with #16855 then...



---

archive/issue_comments_225888.json:
```json
{
    "body": "<a id='comment:16'>**Comment 16:**</a>\nThe construction of the non-identical `k1` and `k2` appears to be due to a subtlety involving the `FiniteFieldFactory.other_keys()` method and an intermediate construction of another finite field (defined by the same data but with `impl=None`) during the construction of a common parent for the computation of `a/2`.  The keys returned by `other_keys()` only differ in the `impl` keyword.  I think the best solution is to always set the `impl` keyword when constructing the key (as opposed to allowing it to be `None`).  Then the use of this `other_keys()` method, which feels to me somewhat like a hack, can be avoided.",
    "created_at": "2014-09-05T13:29:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-225888",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:16'>**Comment 16:**</a>
The construction of the non-identical `k1` and `k2` appears to be due to a subtlety involving the `FiniteFieldFactory.other_keys()` method and an intermediate construction of another finite field (defined by the same data but with `impl=None`) during the construction of a common parent for the computation of `a/2`.  The keys returned by `other_keys()` only differ in the `impl` keyword.  I think the best solution is to always set the `impl` keyword when constructing the key (as opposed to allowing it to be `None`).  Then the use of this `other_keys()` method, which feels to me somewhat like a hack, can be avoided.



---

archive/issue_comments_225889.json:
```json
{
    "body": "<a id='comment:17'>**Comment 17:**</a>\nThis branch depends on #16930 to avoid merge conflicts.  It merges with, and works independently of, #16855.",
    "created_at": "2014-09-05T13:44:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-225889",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:17'>**Comment 17:**</a>
This branch depends on #16930 to avoid merge conflicts.  It merges with, and works independently of, #16855.



---

archive/issue_events_207313.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-09-05T13:44:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20coercion",
    "label_color": "08517b",
    "label_name": "component: coercion",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16934#event-207313"
}
```



---

archive/issue_events_207314.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-09-05T13:44:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20finite%20rings",
    "label_color": "08517b",
    "label_name": "component: finite rings",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16934#event-207314"
}
```



---

archive/issue_events_207315.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-09-05T13:44:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16934#event-207315"
}
```



---

archive/issue_comments_225890.json:
```json
{
    "body": "**Branch:** [u/pbruin/16934-FiniteField_factory_key](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/16934-FiniteField_factory_key)",
    "created_at": "2014-09-05T13:44:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-225890",
    "user": "https://github.com/pjbruin"
}
```

**Branch:** [u/pbruin/16934-FiniteField_factory_key](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/16934-FiniteField_factory_key)



---

archive/issue_comments_225891.json:
```json
{
    "body": "**Dependencies:** #16930",
    "created_at": "2014-09-05T13:44:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-225891",
    "user": "https://github.com/pjbruin"
}
```

**Dependencies:** #16930



---

archive/issue_comments_225892.json:
```json
{
    "body": "**Commit:** [c33a718235e86d268b025a01561a2f14b7dc5937](https://github.com/sagemath/sagetrac-mirror/commit/c33a718235e86d268b025a01561a2f14b7dc5937)",
    "created_at": "2014-09-05T13:44:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-225892",
    "user": "https://github.com/pjbruin"
}
```

**Commit:** [c33a718235e86d268b025a01561a2f14b7dc5937](https://github.com/sagemath/sagetrac-mirror/commit/c33a718235e86d268b025a01561a2f14b7dc5937)



---

archive/issue_comments_225893.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -16,5 +16,6 @@\n sage: k1 is k2\n False\n ```\n+This double construction of the same finite field is caused by slightly different `UniqueFactory` keys arising during the construction of a common parent (for the computation of `a/2`) by the coercion system.\n \n Related: #16855\n``````\n",
    "created_at": "2014-09-05T13:44:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-225893",
    "user": "https://github.com/pjbruin"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -16,5 +16,6 @@
 sage: k1 is k2
 False
 ```
+This double construction of the same finite field is caused by slightly different `UniqueFactory` keys arising during the construction of a common parent (for the computation of `a/2`) by the coercion system.
 
 Related: #16855
``````




---

archive/issue_events_207316.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-09-05T13:44:34Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "rename": {
        "from": "Finite fields coercion bug",
        "to": "Fix factory keys for finite fields to avoid repeated construction"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16934#event-207316"
}
```



---

archive/issue_comments_225894.json:
```json
{
    "body": "**Author:** Peter Bruin",
    "created_at": "2014-09-05T13:44:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-225894",
    "user": "https://github.com/pjbruin"
}
```

**Author:** Peter Bruin



---

archive/issue_comments_225895.json:
```json
{
    "body": "<a id='comment:18'>**Comment 18:**</a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8923777303eeee0c48736316f03bf55f4bde2380\">8923777</a></td><td><code>Trac 16934: remove method FiniteFieldFactory.other_keys()</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5e2681e0df90efaeb294a2010943cfe2c0e1bdc3\">5e2681e</a></td><td><code>Trac 16934: more cleaning up</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ffb74fa8116d1a60e255300370ca4467e3b36732\">ffb74fa</a></td><td><code>Trac 16934: add doctest</code></td></tr></table>\n",
    "created_at": "2014-09-05T13:52:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-225895",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:18'>**Comment 18:**</a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8923777303eeee0c48736316f03bf55f4bde2380">8923777</a></td><td><code>Trac 16934: remove method FiniteFieldFactory.other_keys()</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5e2681e0df90efaeb294a2010943cfe2c0e1bdc3">5e2681e</a></td><td><code>Trac 16934: more cleaning up</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ffb74fa8116d1a60e255300370ca4467e3b36732">ffb74fa</a></td><td><code>Trac 16934: add doctest</code></td></tr></table>




---

archive/issue_comments_225896.json:
```json
{
    "body": "**Changing commit** from \"[c33a718235e86d268b025a01561a2f14b7dc5937](https://github.com/sagemath/sagetrac-mirror/commit/c33a718235e86d268b025a01561a2f14b7dc5937)\" to \"[ffb74fa8116d1a60e255300370ca4467e3b36732](https://github.com/sagemath/sagetrac-mirror/commit/ffb74fa8116d1a60e255300370ca4467e3b36732)\".",
    "created_at": "2014-09-05T13:52:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-225896",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[c33a718235e86d268b025a01561a2f14b7dc5937](https://github.com/sagemath/sagetrac-mirror/commit/c33a718235e86d268b025a01561a2f14b7dc5937)" to "[ffb74fa8116d1a60e255300370ca4467e3b36732](https://github.com/sagemath/sagetrac-mirror/commit/ffb74fa8116d1a60e255300370ca4467e3b36732)".



---

archive/issue_comments_225897.json:
```json
{
    "body": "<a id='comment:19'>**Comment 19:**</a>\nDiff for easier reviewing: [https://github.com/sagemath/sagetrac-mirror/compare/8cdbd7920c73713a3a8dbea697451649f0434f0a...ffb74fa8116d1a60e255300370ca4467e3b36732](https://github.com/sagemath/sagetrac-mirror/compare/8cdbd7920c73713a3a8dbea697451649f0434f0a...ffb74fa8116d1a60e255300370ca4467e3b36732)",
    "created_at": "2014-09-05T13:56:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-225897",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:19'>**Comment 19:**</a>
Diff for easier reviewing: [https://github.com/sagemath/sagetrac-mirror/compare/8cdbd7920c73713a3a8dbea697451649f0434f0a...ffb74fa8116d1a60e255300370ca4467e3b36732](https://github.com/sagemath/sagetrac-mirror/compare/8cdbd7920c73713a3a8dbea697451649f0434f0a...ffb74fa8116d1a60e255300370ca4467e3b36732)



---

archive/issue_comments_225898.json:
```json
{
    "body": "**Changing branch** from \"[u/pbruin/16934-FiniteField_factory_key](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/16934-FiniteField_factory_key)\" to \"[u/jdemeyer/ticket/16934](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/16934)\".",
    "created_at": "2014-09-12T08:59:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-225898",
    "user": "https://github.com/jdemeyer"
}
```

**Changing branch** from "[u/pbruin/16934-FiniteField_factory_key](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/16934-FiniteField_factory_key)" to "[u/jdemeyer/ticket/16934](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/16934)".



---

archive/issue_comments_225899.json:
```json
{
    "body": "<a id='comment:21'>**Comment 21:**</a>\nPlease restore the warning\n\n```\nwarn(\"the 'modulus' argument is ignored when constructing prime finite fields\")\n```\nfor all prime finite field implementations because the modulus really is ignored:\n\n```\nsage: x = polygen(GF(7)); GF(7, modulus=x-2, impl=\"givaro\").modulus()\nx + 6\n```\n\nOf course we could change that behaviour (perhaps we should), but let's do that on a new ticket.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/33c86ef572ea686782d5167d58c29a7e0b2d1f6c\">33c86ef</a></td><td><code>Merge remote-tracking branch 'origin/develop' into ticket/16934</code></td></tr></table>\n",
    "created_at": "2014-09-12T09:00:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-225899",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:21'>**Comment 21:**</a>
Please restore the warning

```
warn("the 'modulus' argument is ignored when constructing prime finite fields")
```
for all prime finite field implementations because the modulus really is ignored:

```
sage: x = polygen(GF(7)); GF(7, modulus=x-2, impl="givaro").modulus()
x + 6
```

Of course we could change that behaviour (perhaps we should), but let's do that on a new ticket.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/33c86ef572ea686782d5167d58c29a7e0b2d1f6c">33c86ef</a></td><td><code>Merge remote-tracking branch 'origin/develop' into ticket/16934</code></td></tr></table>




---

archive/issue_events_207317.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-09-12T09:00:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16934#event-207317"
}
```



---

archive/issue_events_207318.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-09-12T09:00:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16934#event-207318"
}
```



---

archive/issue_comments_225900.json:
```json
{
    "body": "**Changing commit** from \"[ffb74fa8116d1a60e255300370ca4467e3b36732](https://github.com/sagemath/sagetrac-mirror/commit/ffb74fa8116d1a60e255300370ca4467e3b36732)\" to \"[33c86ef572ea686782d5167d58c29a7e0b2d1f6c](https://github.com/sagemath/sagetrac-mirror/commit/33c86ef572ea686782d5167d58c29a7e0b2d1f6c)\".",
    "created_at": "2014-09-12T09:00:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-225900",
    "user": "https://github.com/jdemeyer"
}
```

**Changing commit** from "[ffb74fa8116d1a60e255300370ca4467e3b36732](https://github.com/sagemath/sagetrac-mirror/commit/ffb74fa8116d1a60e255300370ca4467e3b36732)" to "[33c86ef572ea686782d5167d58c29a7e0b2d1f6c](https://github.com/sagemath/sagetrac-mirror/commit/33c86ef572ea686782d5167d58c29a7e0b2d1f6c)".



---

archive/issue_comments_225901.json:
```json
{
    "body": "**Changing commit** from \"[33c86ef572ea686782d5167d58c29a7e0b2d1f6c](https://github.com/sagemath/sagetrac-mirror/commit/33c86ef572ea686782d5167d58c29a7e0b2d1f6c)\" to \"[bf36ec118ee0c97dbfae0aed177c1014430b7a07](https://github.com/sagemath/sagetrac-mirror/commit/bf36ec118ee0c97dbfae0aed177c1014430b7a07)\".",
    "created_at": "2014-09-12T11:20:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-225901",
    "user": "https://github.com/pjbruin"
}
```

**Changing commit** from "[33c86ef572ea686782d5167d58c29a7e0b2d1f6c](https://github.com/sagemath/sagetrac-mirror/commit/33c86ef572ea686782d5167d58c29a7e0b2d1f6c)" to "[bf36ec118ee0c97dbfae0aed177c1014430b7a07](https://github.com/sagemath/sagetrac-mirror/commit/bf36ec118ee0c97dbfae0aed177c1014430b7a07)".



---

archive/issue_events_207319.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-09-12T11:20:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16934#event-207319"
}
```



---

archive/issue_events_207320.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-09-12T11:20:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16934#event-207320"
}
```



---

archive/issue_comments_225902.json:
```json
{
    "body": "**Changing branch** from \"[u/jdemeyer/ticket/16934](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/16934)\" to \"[u/pbruin/16934-FiniteField_factory_key](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/16934-FiniteField_factory_key)\".",
    "created_at": "2014-09-12T11:20:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-225902",
    "user": "https://github.com/pjbruin"
}
```

**Changing branch** from "[u/jdemeyer/ticket/16934](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/16934)" to "[u/pbruin/16934-FiniteField_factory_key](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/16934-FiniteField_factory_key)".



---

archive/issue_comments_225903.json:
```json
{
    "body": "<a id='comment:22'>**Comment 22:**</a>\nThis commit adds back the warning.  Alternatively, it could have been put outside the `if impl == 'modn'`, but in this way it is easier to remove again for non-`modn` implementations.",
    "created_at": "2014-09-12T11:20:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-225903",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:22'>**Comment 22:**</a>
This commit adds back the warning.  Alternatively, it could have been put outside the `if impl == 'modn'`, but in this way it is easier to remove again for non-`modn` implementations.



---

archive/issue_events_207321.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-09-12T13:18:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16934#event-207321"
}
```



---

archive/issue_events_207322.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-09-12T13:18:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16934#event-207322"
}
```



---

archive/issue_comments_225904.json:
```json
{
    "body": "<a id='comment:23'>**Comment 23:**</a>\n\n```\nsage: GF(7, impl=\"givaro\", modulus=\"primitive\")\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n<ipython-input-2-c6a1d2461111> in <module>()\n----> 1 GF(Integer(7), impl=\"givaro\", modulus=\"primitive\")\n\n/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/structure/factory.so in sage.structure.factory.UniqueFactory.__call__ (build/cythonized/sage/structure/factory.c:1160)()\n                                                                                                                                                                        \n/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/rings/finite_rings/constructor.pyc in create_key_and_extra_args(self, order, name, modulus, names, impl, proof, check_irreducible, **kwds)                                                                                                                                       \n    521                 if not modulus.is_irreducible():                                                                                                                \n    522                     raise ValueError(\"finite field modulus must be irreducible but it is not.\")\n--> 523             if modulus is not None and modulus.degree() != n:\n    524                 raise ValueError(\"the degree of the modulus does not equal the degree of the field.\")\n    525 \n\nAttributeError: 'str' object has no attribute 'degree'\n```",
    "created_at": "2014-09-12T13:18:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-225904",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'>**Comment 23:**</a>

```
sage: GF(7, impl="givaro", modulus="primitive")
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-2-c6a1d2461111> in <module>()
----> 1 GF(Integer(7), impl="givaro", modulus="primitive")

/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/structure/factory.so in sage.structure.factory.UniqueFactory.__call__ (build/cythonized/sage/structure/factory.c:1160)()
                                                                                                                                                                        
/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/rings/finite_rings/constructor.pyc in create_key_and_extra_args(self, order, name, modulus, names, impl, proof, check_irreducible, **kwds)                                                                                                                                       
    521                 if not modulus.is_irreducible():                                                                                                                
    522                     raise ValueError("finite field modulus must be irreducible but it is not.")
--> 523             if modulus is not None and modulus.degree() != n:
    524                 raise ValueError("the degree of the modulus does not equal the degree of the field.")
    525 

AttributeError: 'str' object has no attribute 'degree'
```



---

archive/issue_comments_225905.json:
```json
{
    "body": "<a id='comment:24'>**Comment 24:**</a>\nReplying to [@pjbruin](#comment%3A22):\n> This commit adds back the warning.  Alternatively, it could have been put outside the `if impl == 'modn'`, but in this way it is easier to remove again for non-`modn` implementations.\n\nI would prefer to have the warning in one place. If we ever allow a custom modulus, we should allow it for all implementations.\n\nMy vision for this \"modulus\" argument is that the following should assign to `a` a primitive root:\n\n```\nsage: K.<a> = GF(7, modulus='primitive')\n```\nso perhaps we should expand the warning to say\n\n```\nwarn(\"currently, the 'modulus' argument is ignored when constructing prime finite fields. This might change in the future and this will probably also change the output of the .gen() and .modulus() methods on the finite field.\\nSee http://trac.sagemath.org/16930 for details.\")\n```",
    "created_at": "2014-09-12T13:23:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-225905",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:24'>**Comment 24:**</a>
Replying to [@pjbruin](#comment%3A22):
> This commit adds back the warning.  Alternatively, it could have been put outside the `if impl == 'modn'`, but in this way it is easier to remove again for non-`modn` implementations.

I would prefer to have the warning in one place. If we ever allow a custom modulus, we should allow it for all implementations.

My vision for this "modulus" argument is that the following should assign to `a` a primitive root:

```
sage: K.<a> = GF(7, modulus='primitive')
```
so perhaps we should expand the warning to say

```
warn("currently, the 'modulus' argument is ignored when constructing prime finite fields. This might change in the future and this will probably also change the output of the .gen() and .modulus() methods on the finite field.\nSee http://trac.sagemath.org/16930 for details.")
```



---

archive/issue_comments_225906.json:
```json
{
    "body": "<a id='comment:25'>**Comment 25:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9cbdcde41b4783e7adf3f56451b9dedd36842f1d\">9cbdcde</a></td><td><code>Trac 16934: fix warning about ignored 'modulus' argument</code></td></tr></table>\n",
    "created_at": "2014-09-12T16:46:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-225906",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:25'>**Comment 25:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9cbdcde41b4783e7adf3f56451b9dedd36842f1d">9cbdcde</a></td><td><code>Trac 16934: fix warning about ignored 'modulus' argument</code></td></tr></table>




---

archive/issue_comments_225907.json:
```json
{
    "body": "**Changing commit** from \"[bf36ec118ee0c97dbfae0aed177c1014430b7a07](https://github.com/sagemath/sagetrac-mirror/commit/bf36ec118ee0c97dbfae0aed177c1014430b7a07)\" to \"[9cbdcde41b4783e7adf3f56451b9dedd36842f1d](https://github.com/sagemath/sagetrac-mirror/commit/9cbdcde41b4783e7adf3f56451b9dedd36842f1d)\".",
    "created_at": "2014-09-12T16:46:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-225907",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[bf36ec118ee0c97dbfae0aed177c1014430b7a07](https://github.com/sagemath/sagetrac-mirror/commit/bf36ec118ee0c97dbfae0aed177c1014430b7a07)" to "[9cbdcde41b4783e7adf3f56451b9dedd36842f1d](https://github.com/sagemath/sagetrac-mirror/commit/9cbdcde41b4783e7adf3f56451b9dedd36842f1d)".



---

archive/issue_events_207323.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-09-12T16:47:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16934#event-207323"
}
```



---

archive/issue_events_207324.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-09-12T16:47:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16934#event-207324"
}
```



---

archive/issue_events_207325.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-09-15T08:58:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16934#event-207325"
}
```



---

archive/issue_events_207326.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-09-15T08:58:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16934#event-207326"
}
```



---

archive/issue_comments_225908.json:
```json
{
    "body": "**Reviewer:** Jeroen Demeyer",
    "created_at": "2014-09-15T08:58:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-225908",
    "user": "https://github.com/jdemeyer"
}
```

**Reviewer:** Jeroen Demeyer



---

archive/issue_comments_225909.json:
```json
{
    "body": "<a id='comment:28'>**Comment 28:**</a>\nReplying to [@jdemeyer](#comment%3A24):\n> Replying to [@pjbruin](#comment%3A22):\n> > This commit adds back the warning.  Alternatively, it could have been put outside the `if impl == 'modn'`, but in this way it is easier to remove again for non-`modn` implementations.\n\n> I would prefer to have the warning in one place. If we ever allow a custom modulus, we should allow it for all implementations.\n> \n> My vision for this \"modulus\" argument is that the following should assign to `a` a primitive root:\n> \n> ```\n> sage: K.<a> = GF(7, modulus='primitive')\n> ```\n\nThe word \"modulus\" here is definitely wrong. If anything is a modulus for `GF(7)`, it is 7, because the natural way to construct `GF(7)` as *quotient* of `ZZ` by `7ZZ`.\n\nIn general, even for field *extensions*, the word modulus is confusing. That only applies if you're making the field as a quotient of a polynomial ring. For the purpose proposed, `generator` would cover the notion much better. I see from the doc that we have legacy against us on this one.",
    "created_at": "2014-09-15T18:05:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-225909",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:28'>**Comment 28:**</a>
Replying to [@jdemeyer](#comment%3A24):
> Replying to [@pjbruin](#comment%3A22):
> > This commit adds back the warning.  Alternatively, it could have been put outside the `if impl == 'modn'`, but in this way it is easier to remove again for non-`modn` implementations.

> I would prefer to have the warning in one place. If we ever allow a custom modulus, we should allow it for all implementations.
> 
> My vision for this "modulus" argument is that the following should assign to `a` a primitive root:
> 
> ```
> sage: K.<a> = GF(7, modulus='primitive')
> ```

The word "modulus" here is definitely wrong. If anything is a modulus for `GF(7)`, it is 7, because the natural way to construct `GF(7)` as *quotient* of `ZZ` by `7ZZ`.

In general, even for field *extensions*, the word modulus is confusing. That only applies if you're making the field as a quotient of a polynomial ring. For the purpose proposed, `generator` would cover the notion much better. I see from the doc that we have legacy against us on this one.



---

archive/issue_comments_225910.json:
```json
{
    "body": "<a id='comment:29'>**Comment 29:**</a>\nReplying to [@nbruin](#comment%3A28):\n> Replying to [@jdemeyer](#comment%3A24):\n> > My vision for this \"modulus\" argument is that the following should assign to `a` a primitive root:\n> > \n> > ```\n> > sage: K.<a> = GF(7, modulus='primitive')\n> > ```\n\n> \n> The word \"modulus\" here is definitely wrong. If anything is a modulus for `GF(7)`, it is 7, because the natural way to construct `GF(7)` as *quotient* of `ZZ` by `7ZZ`.\n\nDepends on how you look at it. For me, there is a big philosophical difference between `IntegerModRing(p)` and `GF(p)`. I see `IntegerModRing(m)` as `ZZ/(m)`, while `GF(p^n)` is `IntegerModRing(p)[x]/(f(x))` for an irreducible polynomial `f(x)` of degree `n`.\n\nFor fields `GF(p^n)` (n > 1), the word \"modulus\" for `f(x)` is certainly more standard than \"generator\". For me, the \"generator\" is the image of `x` in `GF(p^n) = IntegerModRing(p)[x]/(f(x))`, which is returned by the `gen()` method.",
    "created_at": "2014-09-16T15:48:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-225910",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:29'>**Comment 29:**</a>
Replying to [@nbruin](#comment%3A28):
> Replying to [@jdemeyer](#comment%3A24):
> > My vision for this "modulus" argument is that the following should assign to `a` a primitive root:
> > 
> > ```
> > sage: K.<a> = GF(7, modulus='primitive')
> > ```

> 
> The word "modulus" here is definitely wrong. If anything is a modulus for `GF(7)`, it is 7, because the natural way to construct `GF(7)` as *quotient* of `ZZ` by `7ZZ`.

Depends on how you look at it. For me, there is a big philosophical difference between `IntegerModRing(p)` and `GF(p)`. I see `IntegerModRing(m)` as `ZZ/(m)`, while `GF(p^n)` is `IntegerModRing(p)[x]/(f(x))` for an irreducible polynomial `f(x)` of degree `n`.

For fields `GF(p^n)` (n > 1), the word "modulus" for `f(x)` is certainly more standard than "generator". For me, the "generator" is the image of `x` in `GF(p^n) = IntegerModRing(p)[x]/(f(x))`, which is returned by the `gen()` method.



---

archive/issue_comments_225911.json:
```json
{
    "body": "<a id='comment:30'>**Comment 30:**</a>\nReplying to [@jdemeyer](#comment%3A24):\n> My vision for this \"modulus\" argument is that the following should assign to `a` a primitive root:\n> \n> ```\n> sage: K.<a> = GF(7, modulus='primitive')\n> ```\n\nBy the way, this is now implemented at #16983.",
    "created_at": "2014-09-16T15:56:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-225911",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:30'>**Comment 30:**</a>
Replying to [@jdemeyer](#comment%3A24):
> My vision for this "modulus" argument is that the following should assign to `a` a primitive root:
> 
> ```
> sage: K.<a> = GF(7, modulus='primitive')
> ```

By the way, this is now implemented at #16983.



---

archive/issue_events_207327.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-09-16T18:46:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16934#event-207327"
}
```



---

archive/issue_events_207328.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "8a8c35c2fd46bd76f75e00dc506033630cfe025b",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2014-09-16T18:46:36Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16934#event-207328"
}
```



---

archive/issue_comments_225912.json:
```json
{
    "body": "**Changing branch** from \"[u/pbruin/16934-FiniteField_factory_key](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/16934-FiniteField_factory_key)\" to \"[9cbdcde41b4783e7adf3f56451b9dedd36842f1d](https://github.com/sagemath/sagetrac-mirror/commit/9cbdcde41b4783e7adf3f56451b9dedd36842f1d)\".",
    "created_at": "2014-09-16T18:46:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16934",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16934#issuecomment-225912",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/pbruin/16934-FiniteField_factory_key](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/16934-FiniteField_factory_key)" to "[9cbdcde41b4783e7adf3f56451b9dedd36842f1d](https://github.com/sagemath/sagetrac-mirror/commit/9cbdcde41b4783e7adf3f56451b9dedd36842f1d)".
