# Issue 16764: Add CM detection for elliptic curves over number fields

archive/issues_016527.json:
```json
{
    "assignees": [],
    "body": "Elliptic curves over the rationals have mathods ``has_cm()`` and ``cm_discriminant()``.  We extend these to curves over number fields, and add a function ``has_rational_cm()`` to indicate the the curve has CM which is defined over its base field (i.e. the CM discriminant is a square in that field), which is always False over QQ.\n\nKeywords: **complex multiplication**\n\nBranch: **[4aea367](https://github.com/sagemath/sagetrac-mirror/commit/4aea367970e8f902845ed4837a6dd9697619a35e)**\n\nReviewer: **Marco Streng, Chris Wuthrich**\n\nAuthor: **John Cremona**\n\nComponent: **elliptic curves**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/16764_\n\n",
    "closed_at": "2014-09-25T12:05:42Z",
    "created_at": "2014-08-05T13:17:45Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20elliptic%20curves",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Add CM detection for elliptic curves over number fields",
    "type": "issue",
    "updated_at": "2014-10-01T08:38:04Z",
    "url": "https://github.com/sagemath/sage/issues/16764",
    "user": "https://github.com/JohnCremona"
}
```
Elliptic curves over the rationals have mathods ``has_cm()`` and ``cm_discriminant()``.  We extend these to curves over number fields, and add a function ``has_rational_cm()`` to indicate the the curve has CM which is defined over its base field (i.e. the CM discriminant is a square in that field), which is always False over QQ.

Keywords: **complex multiplication**

Branch: **[4aea367](https://github.com/sagemath/sagetrac-mirror/commit/4aea367970e8f902845ed4837a6dd9697619a35e)**

Reviewer: **Marco Streng, Chris Wuthrich**

Author: **John Cremona**

Component: **elliptic curves**

_Issue created by migration from https://trac.sagemath.org/ticket/16764_





---

archive/issue_events_239618.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2014-08-05T13:17:45Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16764",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16764#event-239618"
}
```



---

archive/issue_events_239619.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2014-08-05T13:17:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16764",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20elliptic%20curves",
    "label_color": "0000ff",
    "label_name": "c: elliptic curves",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16764#event-239619"
}
```



---

archive/issue_events_239620.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2014-08-05T13:17:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16764",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16764#event-239620"
}
```



---

archive/issue_events_239621.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2014-08-05T13:17:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16764",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16764#event-239621"
}
```



---

archive/issue_comments_219630.json:
```json
{
    "body": "Branch: **[u/cremona/ticket/16764](https://github.com/sagemath/sagetrac-mirror/tree/u/cremona/ticket/16764)**",
    "created_at": "2014-08-05T13:22:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16764#issuecomment-219630",
    "user": "https://github.com/JohnCremona"
}
```

Branch: **[u/cremona/ticket/16764](https://github.com/sagemath/sagetrac-mirror/tree/u/cremona/ticket/16764)**



---

archive/issue_comments_219631.json:
```json
{
    "body": "Commit: **[8dff296](https://github.com/sagemath/sagetrac-mirror/commit/8dff2965d46e6f1e6b25d7b9b950f3d3525a7418)**",
    "created_at": "2014-08-05T13:22:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16764#issuecomment-219631",
    "user": "https://github.com/JohnCremona"
}
```

Commit: **[8dff296](https://github.com/sagemath/sagetrac-mirror/commit/8dff2965d46e6f1e6b25d7b9b950f3d3525a7418)**



---

archive/issue_comments_219632.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/552f37aa03a6e4dda00a78d08b837d4b84f64431\">552f37a</a></td><td><code>Work in progress on CM and isogeny classes for EC/NF</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5ea36bf9ca4cef6873d604159ff0b626361a27cf\">5ea36bf</a></td><td><code>Merge branch 'develop' into isogs-ecnf</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8dff2965d46e6f1e6b25d7b9b950f3d3525a7418\">8dff296</a></td><td><code>#16764: CM detection over number fields</code></td></tr></table>\n",
    "created_at": "2014-08-05T13:22:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16764#issuecomment-219632",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:1"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/552f37aa03a6e4dda00a78d08b837d4b84f64431">552f37a</a></td><td><code>Work in progress on CM and isogeny classes for EC/NF</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5ea36bf9ca4cef6873d604159ff0b626361a27cf">5ea36bf</a></td><td><code>Merge branch 'develop' into isogs-ecnf</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8dff2965d46e6f1e6b25d7b9b950f3d3525a7418">8dff296</a></td><td><code>#16764: CM detection over number fields</code></td></tr></table>




---

archive/issue_comments_219633.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nThe changes in isogeny_class.py belong to #16743, not here, and should be ignored.  I'll fix this.",
    "created_at": "2014-08-05T13:23:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16764#issuecomment-219633",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:2" align="right">comment:2</div>

The changes in isogeny_class.py belong to #16743, not here, and should be ignored.  I'll fix this.



---

archive/issue_comments_219634.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/caf41e68e76a753268ce4f4dae36555f0003017b\">caf41e6</a></td><td><code>#16764 revert changes to isogeny_class.py which belong in #16743</code></td></tr></table>\n",
    "created_at": "2014-08-05T13:44:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16764#issuecomment-219634",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:3"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/caf41e68e76a753268ce4f4dae36555f0003017b">caf41e6</a></td><td><code>#16764 revert changes to isogeny_class.py which belong in #16743</code></td></tr></table>




---

archive/issue_comments_219635.json:
```json
{
    "body": "Changed commit from **[8dff296](https://github.com/sagemath/sagetrac-mirror/commit/8dff2965d46e6f1e6b25d7b9b950f3d3525a7418)** to **[caf41e6](https://github.com/sagemath/sagetrac-mirror/commit/caf41e68e76a753268ce4f4dae36555f0003017b)**",
    "created_at": "2014-08-05T13:44:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16764#issuecomment-219635",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[8dff296](https://github.com/sagemath/sagetrac-mirror/commit/8dff2965d46e6f1e6b25d7b9b950f3d3525a7418)** to **[caf41e6](https://github.com/sagemath/sagetrac-mirror/commit/caf41e68e76a753268ce4f4dae36555f0003017b)**



---

archive/issue_events_239622.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2014-08-05T13:46:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16764",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16764#event-239622"
}
```



---

archive/issue_comments_219636.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nReplying to [@JohnCremona](#comment:2):\n> The changes in isogeny_class.py belong to #16743, not here, and should be ignored.  I'll fix this.\n\nDone.  This probably counts as rewriting history, too bad.  #16743 will depend on this anyway.",
    "created_at": "2014-08-05T13:46:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16764#issuecomment-219636",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:4" align="right">comment:4</div>

Replying to [@JohnCremona](#comment:2):
> The changes in isogeny_class.py belong to #16743, not here, and should be ignored.  I'll fix this.

Done.  This probably counts as rewriting history, too bad.  #16743 will depend on this anyway.



---

archive/issue_comments_219637.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nHello,\n\nLines after a `.. NOTE::` should be indented by 4 spaces (not 3).",
    "created_at": "2014-08-06T16:56:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16764#issuecomment-219637",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:5" align="right">comment:5</div>

Hello,

Lines after a `.. NOTE::` should be indented by 4 spaces (not 3).



---

archive/issue_comments_219638.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@fchapoton](#comment:5):\n> Hello,\n> \n> Lines after a `.. NOTE::` should be indented by 4 spaces (not 3).\n\nAre you sure?  See http://sphinx-doc.org/markup/para.html.  I was aligning the following text under the n of \"note\".",
    "created_at": "2014-08-06T18:40:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16764#issuecomment-219638",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@fchapoton](#comment:5):
> Hello,
> 
> Lines after a `.. NOTE::` should be indented by 4 spaces (not 3).

Are you sure?  See http://sphinx-doc.org/markup/para.html.  I was aligning the following text under the n of "note".



---

archive/issue_comments_219639.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nOh, well. I was trusting\n\nhttp://www.sagemath.org/doc/developer/coding_basics.html\n\nbut I wonder now who is right.",
    "created_at": "2014-08-06T18:49:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16764#issuecomment-219639",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:7" align="right">comment:7</div>

Oh, well. I was trusting

http://www.sagemath.org/doc/developer/coding_basics.html

but I wonder now who is right.



---

archive/issue_comments_219640.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nWhile you're at it, could you change the wording in the first line of the documentation of has_cm for elliptic curves over the rationals to be less ambiguous?\n\nI've seen Complex Multiplication to mean over the base field and to mean over the algebraic closure, so \"Returns True iff this elliptic curve has Complex Multiplication.\" is ambiguous. It could be \"Returns True iff this elliptic curve has Complex Multiplication over the algebraic closure.\" or \"Returns True iff this elliptic curve has a CM j-invariant.\" as in the number field case.",
    "created_at": "2014-08-08T08:08:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16764#issuecomment-219640",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:8" align="right">comment:8</div>

While you're at it, could you change the wording in the first line of the documentation of has_cm for elliptic curves over the rationals to be less ambiguous?

I've seen Complex Multiplication to mean over the base field and to mean over the algebraic closure, so "Returns True iff this elliptic curve has Complex Multiplication." is ambiguous. It could be "Returns True iff this elliptic curve has Complex Multiplication over the algebraic closure." or "Returns True iff this elliptic curve has a CM j-invariant." as in the number field case.



---

archive/issue_comments_219641.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@mstreng](#comment:8):\n> While you're at it, could you change the wording in the first line of the documentation of has_cm for elliptic curves over the rationals to be less ambiguous?\n> \n> I've seen Complex Multiplication to mean over the base field and to mean over the algebraic closure, so \"Returns True iff this elliptic curve has Complex Multiplication.\" is ambiguous. It could be \"Returns True iff this elliptic curve has Complex Multiplication over the algebraic closure.\" or \"Returns True iff this elliptic curve has a CM j-invariant.\" as in the number field case.\n\nGood point!  Thanks.  A suitable change for a reviewer's patch (as they used to be called)?",
    "created_at": "2014-08-08T08:32:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16764#issuecomment-219641",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@mstreng](#comment:8):
> While you're at it, could you change the wording in the first line of the documentation of has_cm for elliptic curves over the rationals to be less ambiguous?
> 
> I've seen Complex Multiplication to mean over the base field and to mean over the algebraic closure, so "Returns True iff this elliptic curve has Complex Multiplication." is ambiguous. It could be "Returns True iff this elliptic curve has Complex Multiplication over the algebraic closure." or "Returns True iff this elliptic curve has a CM j-invariant." as in the number field case.

Good point!  Thanks.  A suitable change for a reviewer's patch (as they used to be called)?



---

archive/issue_comments_219642.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nI will follow Marco's suggestion about the documentation for has_cm, and also add a field parameter to has_rational_cm (defaulting to the base_field) as William had suggested.",
    "created_at": "2014-08-10T10:29:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16764#issuecomment-219642",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:10" align="right">comment:10</div>

I will follow Marco's suggestion about the documentation for has_cm, and also add a field parameter to has_rational_cm (defaulting to the base_field) as William had suggested.



---

archive/issue_comments_219643.json:
```json
{
    "body": "<div id=\"comment:11\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8e203af8213626f39376cfca7742943bbb19c8c4\">8e203af</a></td><td><code>Merge branch 'develop' into cm</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3cacdb2fe8a32114e13c26f50c3556800b4668fe\">3cacdb2</a></td><td><code>#16764: adjustments after review</code></td></tr></table>\n",
    "created_at": "2014-08-10T11:55:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16764#issuecomment-219643",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:11"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8e203af8213626f39376cfca7742943bbb19c8c4">8e203af</a></td><td><code>Merge branch 'develop' into cm</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3cacdb2fe8a32114e13c26f50c3556800b4668fe">3cacdb2</a></td><td><code>#16764: adjustments after review</code></td></tr></table>




---

archive/issue_comments_219644.json:
```json
{
    "body": "Changed commit from **[caf41e6](https://github.com/sagemath/sagetrac-mirror/commit/caf41e68e76a753268ce4f4dae36555f0003017b)** to **[3cacdb2](https://github.com/sagemath/sagetrac-mirror/commit/3cacdb2fe8a32114e13c26f50c3556800b4668fe)**",
    "created_at": "2014-08-10T11:55:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16764#issuecomment-219644",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[caf41e6](https://github.com/sagemath/sagetrac-mirror/commit/caf41e68e76a753268ce4f4dae36555f0003017b)** to **[3cacdb2](https://github.com/sagemath/sagetrac-mirror/commit/3cacdb2fe8a32114e13c26f50c3556800b4668fe)**



---

archive/issue_comments_219645.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nDone as above;  also merged 6.3.rc1 into the branch.",
    "created_at": "2014-08-10T11:56:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16764#issuecomment-219645",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:12" align="right">comment:12</div>

Done as above;  also merged 6.3.rc1 into the branch.



---

archive/issue_events_239623.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/16764",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16764#event-239623"
}
```



---

archive/issue_events_239624.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16764",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16764#event-239624"
}
```



---

archive/issue_comments_219646.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7852e0f54cf117014392095bf623bf76976b4015\">7852e0f</a></td><td><code>Merge branch 'develop' into cm</code></td></tr></table>\n",
    "created_at": "2014-08-27T12:53:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16764#issuecomment-219646",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7852e0f54cf117014392095bf623bf76976b4015">7852e0f</a></td><td><code>Merge branch 'develop' into cm</code></td></tr></table>




---

archive/issue_comments_219647.json:
```json
{
    "body": "Changed commit from **[3cacdb2](https://github.com/sagemath/sagetrac-mirror/commit/3cacdb2fe8a32114e13c26f50c3556800b4668fe)** to **[7852e0f](https://github.com/sagemath/sagetrac-mirror/commit/7852e0f54cf117014392095bf623bf76976b4015)**",
    "created_at": "2014-08-27T12:53:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16764#issuecomment-219647",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[3cacdb2](https://github.com/sagemath/sagetrac-mirror/commit/3cacdb2fe8a32114e13c26f50c3556800b4668fe)** to **[7852e0f](https://github.com/sagemath/sagetrac-mirror/commit/7852e0f54cf117014392095bf623bf76976b4015)**



---

archive/issue_comments_219648.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nI hope that merging in the develop branch (as at version 6.4.beta1) will make this easier to review and not harder!",
    "created_at": "2014-08-27T12:54:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16764#issuecomment-219648",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:15" align="right">comment:15</div>

I hope that merging in the develop branch (as at version 6.4.beta1) will make this easier to review and not harder!



---

archive/issue_comments_219649.json:
```json
{
    "body": "Reviewer: **Marco Streng**",
    "created_at": "2014-08-29T10:19:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16764#issuecomment-219649",
    "user": "https://github.com/mstreng"
}
```

Reviewer: **Marco Streng**



---

archive/issue_comments_219650.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nThe documentation has three references to \"the `j`-invariant of an immaginary quadratic order\",\nwhich is either a whole Galois orbit or one specific complex number. In all those places it\nshould be \"a `j`-invariant of an imaginary quadratic order\". I'm writing a reviewer patch\nthat corrects this.",
    "created_at": "2014-08-29T12:58:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16764#issuecomment-219650",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:17" align="right">comment:17</div>

The documentation has three references to "the `j`-invariant of an immaginary quadratic order",
which is either a whole Galois orbit or one specific complex number. In all those places it
should be "a `j`-invariant of an imaginary quadratic order". I'm writing a reviewer patch
that corrects this.



---

archive/issue_comments_219651.json:
```json
{
    "body": "Changed branch from **[u/cremona/ticket/16764](https://github.com/sagemath/sagetrac-mirror/tree/u/cremona/ticket/16764)** to **[u/mstreng/ticket/16764](https://github.com/sagemath/sagetrac-mirror/tree/u/mstreng/ticket/16764)**",
    "created_at": "2014-08-29T13:03:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16764#issuecomment-219651",
    "user": "https://github.com/mstreng"
}
```

Changed branch from **[u/cremona/ticket/16764](https://github.com/sagemath/sagetrac-mirror/tree/u/cremona/ticket/16764)** to **[u/mstreng/ticket/16764](https://github.com/sagemath/sagetrac-mirror/tree/u/mstreng/ticket/16764)**



---

archive/issue_comments_219652.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nThanks, Marco.  If that's the only thing you found I am delighted!\n\nAt some point a better implementation of the basic function (detecting whether an algebraic integer is a CM j-invariant) would be good, but the one there is fine for small degrees which is likely to be all that is needed most of the time.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4aea367970e8f902845ed4837a6dd9697619a35e\">4aea367</a></td><td><code>Reviewer patch for ticket 16764 with minor documentation fixes.</code></td></tr></table>\n",
    "created_at": "2014-08-29T13:06:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16764#issuecomment-219652",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:19" align="right">comment:19</div>

Thanks, Marco.  If that's the only thing you found I am delighted!

At some point a better implementation of the basic function (detecting whether an algebraic integer is a CM j-invariant) would be good, but the one there is fine for small degrees which is likely to be all that is needed most of the time.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4aea367970e8f902845ed4837a6dd9697619a35e">4aea367</a></td><td><code>Reviewer patch for ticket 16764 with minor documentation fixes.</code></td></tr></table>




---

archive/issue_comments_219653.json:
```json
{
    "body": "Changed commit from **[7852e0f](https://github.com/sagemath/sagetrac-mirror/commit/7852e0f54cf117014392095bf623bf76976b4015)** to **[4aea367](https://github.com/sagemath/sagetrac-mirror/commit/4aea367970e8f902845ed4837a6dd9697619a35e)**",
    "created_at": "2014-08-29T13:06:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16764#issuecomment-219653",
    "user": "https://github.com/JohnCremona"
}
```

Changed commit from **[7852e0f](https://github.com/sagemath/sagetrac-mirror/commit/7852e0f54cf117014392095bf623bf76976b4015)** to **[4aea367](https://github.com/sagemath/sagetrac-mirror/commit/4aea367970e8f902845ed4837a6dd9697619a35e)**



---

archive/issue_comments_219654.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nHi John. If you agree with my reviewer patch, you can set the ticket to postive_review.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4aea367970e8f902845ed4837a6dd9697619a35e\">4aea367</a></td><td><code>Reviewer patch for ticket 16764 with minor documentation fixes.</code></td></tr></table>\n",
    "created_at": "2014-08-29T13:10:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16764#issuecomment-219654",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:20" align="right">comment:20</div>

Hi John. If you agree with my reviewer patch, you can set the ticket to postive_review.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4aea367970e8f902845ed4837a6dd9697619a35e">4aea367</a></td><td><code>Reviewer patch for ticket 16764 with minor documentation fixes.</code></td></tr></table>




---

archive/issue_comments_219655.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nOops, I haven't set up my editor properly on this machine. Let me remove the tab character first...",
    "created_at": "2014-08-29T13:17:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16764#issuecomment-219655",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:21" align="right">comment:21</div>

Oops, I haven't set up my editor properly on this machine. Let me remove the tab character first...



---

archive/issue_comments_219656.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@mstreng](#comment:21):\n> Oops, I haven't set up my editor properly on this machine. Let me remove the tab character first...\n\nNever mind, the tab character is in some kind of xcode temp file, not in the actual source code.",
    "created_at": "2014-08-29T13:22:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16764#issuecomment-219656",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@mstreng](#comment:21):
> Oops, I haven't set up my editor properly on this machine. Let me remove the tab character first...

Never mind, the tab character is in some kind of xcode temp file, not in the actual source code.



---

archive/issue_comments_219657.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nAll tests pass for me, the documentation builds nicely (I can see a tab character). So this all looks fine to me.",
    "created_at": "2014-09-22T10:59:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16764#issuecomment-219657",
    "user": "https://github.com/categorie"
}
```

<div id="comment:23" align="right">comment:23</div>

All tests pass for me, the documentation builds nicely (I can see a tab character). So this all looks fine to me.



---

archive/issue_comments_219658.json:
```json
{
    "body": "Changed reviewer from **Marco Streng** to **Marco Streng, Chris Wuthrich**",
    "created_at": "2014-09-22T10:59:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16764#issuecomment-219658",
    "user": "https://github.com/categorie"
}
```

Changed reviewer from **Marco Streng** to **Marco Streng, Chris Wuthrich**



---

archive/issue_events_239625.json:
```json
{
    "actor": "https://github.com/categorie",
    "created_at": "2014-09-22T10:59:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16764",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16764#event-239625"
}
```



---

archive/issue_events_239626.json:
```json
{
    "actor": "https://github.com/categorie",
    "created_at": "2014-09-22T10:59:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16764",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16764#event-239626"
}
```



---

archive/issue_events_239627.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-09-25T12:05:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16764",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16764#event-239627"
}
```



---

archive/issue_events_239628.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "ecca3404e17f8953fc8736109f1f55c307b789ff",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2014-09-25T12:05:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/16764",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16764#event-239628"
}
```



---

archive/issue_comments_219659.json:
```json
{
    "body": "Changed branch from **[u/mstreng/ticket/16764](https://github.com/sagemath/sagetrac-mirror/tree/u/mstreng/ticket/16764)** to **[4aea367](https://github.com/sagemath/sagetrac-mirror/commit/4aea367970e8f902845ed4837a6dd9697619a35e)**",
    "created_at": "2014-09-25T12:05:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16764#issuecomment-219659",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mstreng/ticket/16764](https://github.com/sagemath/sagetrac-mirror/tree/u/mstreng/ticket/16764)** to **[4aea367](https://github.com/sagemath/sagetrac-mirror/commit/4aea367970e8f902845ed4837a6dd9697619a35e)**



---

archive/issue_comments_219660.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nWhat's the intention of the code\n\n```\ntry:\n    D = self._CMD\n    if D:\n        return D\n    else:\n        raise ValueError(\"%s does not have CM\"%self)\nexcept:\n    pass\n```\n\nwhich is obviously equivalent to\n\n```\ntry:\n    D = self._CMD\n    if D:\n        return D\nexcept:\n    pass\n```\n\nI assume you meant something like\n\n```\ntry:\n    D = self._CMD\nexcept AttributeError:\n    pass\nelse:\n    if D:\n        return D\n    else:\n        raise ValueError(\"%s does not have CM\"%self)\n```\n\nApart from this issue, you really should never use `except:` since that catches also `KeyboardInterrupt`.",
    "created_at": "2014-09-30T20:53:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16764#issuecomment-219660",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:25" align="right">comment:25</div>

What's the intention of the code

```
try:
    D = self._CMD
    if D:
        return D
    else:
        raise ValueError("%s does not have CM"%self)
except:
    pass
```

which is obviously equivalent to

```
try:
    D = self._CMD
    if D:
        return D
except:
    pass
```

I assume you meant something like

```
try:
    D = self._CMD
except AttributeError:
    pass
else:
    if D:
        return D
    else:
        raise ValueError("%s does not have CM"%self)
```

Apart from this issue, you really should never use `except:` since that catches also `KeyboardInterrupt`.



---

archive/issue_comments_219661.json:
```json
{
    "body": "Changed commit from **[4aea367](https://github.com/sagemath/sagetrac-mirror/commit/4aea367970e8f902845ed4837a6dd9697619a35e)** to none",
    "created_at": "2014-09-30T20:53:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16764#issuecomment-219661",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[4aea367](https://github.com/sagemath/sagetrac-mirror/commit/4aea367970e8f902845ed4837a6dd9697619a35e)** to none



---

archive/issue_comments_219662.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nReplying to [@jdemeyer](#comment:25):\n> Apart from this issue, you really should never use `except:` since that catches also `KeyboardInterrupt`.\n\nYou are right. Could you reopen this ticket? This should not be merged into a stable version without fixing that code.",
    "created_at": "2014-10-01T07:40:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16764#issuecomment-219662",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:26" align="right">comment:26</div>

Replying to [@jdemeyer](#comment:25):
> Apart from this issue, you really should never use `except:` since that catches also `KeyboardInterrupt`.

You are right. Could you reopen this ticket? This should not be merged into a stable version without fixing that code.



---

archive/issue_comments_219663.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nI will fix it in #17076.",
    "created_at": "2014-10-01T07:49:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16764#issuecomment-219663",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:27" align="right">comment:27</div>

I will fix it in #17076.



---

archive/issue_comments_219664.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nApologies, of course I meant to write \"except AttributeError\".  I do know the rules.\n\nTo make absolutely sure:  the field _CMD stores 0 if it has already been determined that E does not have CM, and in this case the method cm_discriminant raises an error -- not my choice but for compatibility with curves over Q.  (I would have preferred to return 0 which is easy for other coed to check).\n\nI'll be happy to review #17076 (though I seem to have forfeited my right to give any code a trustworthy review with this lapse).",
    "created_at": "2014-10-01T08:38:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16764#issuecomment-219664",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:28" align="right">comment:28</div>

Apologies, of course I meant to write "except AttributeError".  I do know the rules.

To make absolutely sure:  the field _CMD stores 0 if it has already been determined that E does not have CM, and in this case the method cm_discriminant raises an error -- not my choice but for compatibility with curves over Q.  (I would have preferred to return 0 which is easy for other coed to check).

I'll be happy to review #17076 (though I seem to have forfeited my right to give any code a trustworthy review with this lapse).
