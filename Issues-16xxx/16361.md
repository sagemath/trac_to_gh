# Issue 16361: OA(7,66), OA(7,68), OA(8,69), OA(7,74) and OA(8,76)

archive/issues_016124.json:
```json
{
    "assignees": [],
    "body": "New designs, and a new \"TD from PBD\" construction ! Too bad this construction cannot be called automatically (yet) `:-P`\n\nNathann\n\nDepends on #16461\n\nDepends on #16388\n\n**CC:**  @videlec @KPanComputes @dimpase @brettpim\n\n**Branch/Commit:** [5d4607aad0675c6ea4afd914796bc78d043a1600](https://github.com/sagemath/sagetrac-mirror/commit/5d4607aad0675c6ea4afd914796bc78d043a1600)\n\n**Reviewer:** Vincent Delecroix\n\n**Author:** Nathann Cohen\n\nIssue created by migration from https://trac.sagemath.org/ticket/16361\n\n",
    "closed_at": "2014-06-18T14:11:22Z",
    "created_at": "2014-05-16T12:54:21Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20combinatorial%20designs",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "OA(7,66), OA(7,68), OA(8,69), OA(7,74) and OA(8,76)",
    "type": "issue",
    "updated_at": "2014-06-18T14:11:22Z",
    "url": "https://github.com/sagemath/sage/issues/16361",
    "user": "https://github.com/nathanncohen"
}
```
New designs, and a new "TD from PBD" construction ! Too bad this construction cannot be called automatically (yet) `:-P`

Nathann

Depends on #16461

Depends on #16388

**CC:**  @videlec @KPanComputes @dimpase @brettpim

**Branch/Commit:** [5d4607aad0675c6ea4afd914796bc78d043a1600](https://github.com/sagemath/sagetrac-mirror/commit/5d4607aad0675c6ea4afd914796bc78d043a1600)

**Reviewer:** Vincent Delecroix

**Author:** Nathann Cohen

Issue created by migration from https://trac.sagemath.org/ticket/16361





---

archive/issue_events_146147.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2014-05-16T12:54:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16361",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16361#event-146147"
}
```



---

archive/issue_comments_213424.json:
```json
{
    "body": "**Branch:** [u/ncohen/16361](https://github.com/sagemath/sagetrac-mirror/tree/u/ncohen/16361)",
    "created_at": "2014-05-16T12:54:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16361",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16361#issuecomment-213424",
    "user": "https://github.com/nathanncohen"
}
```

**Branch:** [u/ncohen/16361](https://github.com/sagemath/sagetrac-mirror/tree/u/ncohen/16361)



---

archive/issue_comments_213425.json:
```json
{
    "body": "**Author:** Nathann Cohen",
    "created_at": "2014-05-16T12:54:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16361",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16361#issuecomment-213425",
    "user": "https://github.com/nathanncohen"
}
```

**Author:** Nathann Cohen



---

archive/issue_comments_213426.json:
```json
{
    "body": "**Commit:** [20ef21682cfe8b6532e2e2621b88d921236528f2](https://github.com/sagemath/sagetrac-mirror/commit/20ef21682cfe8b6532e2e2621b88d921236528f2)",
    "created_at": "2014-05-16T12:55:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16361",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16361#issuecomment-213426",
    "user": "https://github.com/sagetrac-git"
}
```

**Commit:** [20ef21682cfe8b6532e2e2621b88d921236528f2](https://github.com/sagemath/sagetrac-mirror/commit/20ef21682cfe8b6532e2e2621b88d921236528f2)



---

archive/issue_comments_213427.json:
```json
{
    "body": "<a id='comment:2'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/973b926f14224d464da1abba065fd5b78690142c\">973b926</a></td><td><code>trac #16236: Merged with #16272</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/37681e278ccc71e0c70f74bb3b48b178a0c3c792\">37681e2</a></td><td><code>trac #16295 : Faster is_orthogonal_array</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/994324e77dbe8f3126aeba9059dc847feaebe8bc\">994324e</a></td><td><code>trac #16295: Doctests and review</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fc6de7365d89bfa33903bd4c00d58f5757578c6b\">fc6de73</a></td><td><code>trac #16295: Merged with 6.3.beta1</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b9f8b0388a8cd333bfaf4160896b09be5550896a\">b9f8b03</a></td><td><code>trac #16295: bugfix in wilson's construction</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f9690032a77345bd0d370a3099503574fbf6c96e\">f969003</a></td><td><code>trac #16356: MOLS for n=18,57,154,276,298,342</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/20ef21682cfe8b6532e2e2621b88d921236528f2\">20ef216</a></td><td><code>trac #16361: OA(7,66), OA(7,68), OA(8,69), OA(7,74) and OA(8,76)</code></td></tr></table>\n",
    "created_at": "2014-05-16T12:55:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16361",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16361#issuecomment-213427",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:2'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/973b926f14224d464da1abba065fd5b78690142c">973b926</a></td><td><code>trac #16236: Merged with #16272</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/37681e278ccc71e0c70f74bb3b48b178a0c3c792">37681e2</a></td><td><code>trac #16295 : Faster is_orthogonal_array</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/994324e77dbe8f3126aeba9059dc847feaebe8bc">994324e</a></td><td><code>trac #16295: Doctests and review</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fc6de7365d89bfa33903bd4c00d58f5757578c6b">fc6de73</a></td><td><code>trac #16295: Merged with 6.3.beta1</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b9f8b0388a8cd333bfaf4160896b09be5550896a">b9f8b03</a></td><td><code>trac #16295: bugfix in wilson's construction</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f9690032a77345bd0d370a3099503574fbf6c96e">f969003</a></td><td><code>trac #16356: MOLS for n=18,57,154,276,298,342</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/20ef21682cfe8b6532e2e2621b88d921236528f2">20ef216</a></td><td><code>trac #16361: OA(7,66), OA(7,68), OA(8,69), OA(7,74) and OA(8,76)</code></td></tr></table>




---

archive/issue_events_146148.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2014-05-16T21:13:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16361",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20combinatorics",
    "label_color": "08517b",
    "label_name": "component: combinatorics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16361#event-146148"
}
```



---

archive/issue_events_146149.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2014-05-16T21:13:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16361",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20combinatorial%20designs",
    "label_color": "08517b",
    "label_name": "component: combinatorial designs",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16361#event-146149"
}
```



---

archive/issue_comments_213428.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n New designs, and a new \"TD from PBD\" construction ! Too bad this construction cannot be called automatically (yet) `:-P`\n \n Nathann\n+\n+TODO : Update #16423 when this patch is reviewed\n``````\n",
    "created_at": "2014-06-02T09:21:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16361",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16361#issuecomment-213428",
    "user": "https://github.com/nathanncohen"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
 New designs, and a new "TD from PBD" construction ! Too bad this construction cannot be called automatically (yet) `:-P`
 
 Nathann
+
+TODO : Update #16423 when this patch is reviewed
``````




---

archive/issue_events_146150.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2014-06-02T17:03:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16361",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16361#event-146150"
}
```



---

archive/issue_events_146151.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2014-06-02T17:03:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16361",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16361#event-146151"
}
```



---

archive/issue_comments_213429.json:
```json
{
    "body": "<a id='comment:5'></a>\nHi Nathann,\n\nThe function `OA_from_PBD` is sensitive to the output of `orthogonal_array`. More precisely, the function needs a `TD(k,i) - i TD(k,1)`. But right now, it is just a matter of luck whether the answer of `orthogonal_array(k,i)` actually is... and tomorrow the answer might change. So you could not rely on that. For the current purpose of the ticket, a fix would be to feed explicitly the function `OA_from_PBD` with the corresponding list of `TD(k,i) - i TD(k,1)`.\n\nVincent",
    "created_at": "2014-06-02T17:03:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16361",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16361#issuecomment-213429",
    "user": "https://github.com/videlec"
}
```

<a id='comment:5'></a>
Hi Nathann,

The function `OA_from_PBD` is sensitive to the output of `orthogonal_array`. More precisely, the function needs a `TD(k,i) - i TD(k,1)`. But right now, it is just a matter of luck whether the answer of `orthogonal_array(k,i)` actually is... and tomorrow the answer might change. So you could not rely on that. For the current purpose of the ticket, a fix would be to feed explicitly the function `OA_from_PBD` with the corresponding list of `TD(k,i) - i TD(k,1)`.

Vincent



---

archive/issue_comments_213430.json:
```json
{
    "body": "<a id='comment:6'></a>\nHellooooooooo !!\n\n> The function `OA_from_PBD` is sensitive to the output of `orthogonal_array`.\n\nIndeed. And sensitive to the labelling of the design, which I guess is what bothers you.\n\n> More precisely, the function needs a `TD(k,i) - i TD(k,1)`. But right now, it is just a matter of luck whether the answer of `orthogonal_array(k,i)` actually is... and tomorrow the answer might change. So you could not rely on that. For the current purpose of the ticket, a fix would be to feed explicitly the function `OA_from_PBD` with the corresponding list of `TD(k,i) - i TD(k,1)`.\n\nFirst, it is not true that \"this can change and that I cannot rely on that\" because there is a doctest. So if the constructions for which we need `OA_from_PBD` work now, they will continue working for as long as the doctest is there.\n\nSecondly, you are right that the least we can do is solve this problem \"up to relabelling\" of the original design. This is what is being done in #16391 (it depends on #16370), which also implements another technique to find `TD(k,n)-x.TD(k,1)`. This patch #16391 is also a dependency of #16347 (wilson's construction), and the patch on which we talk right now is also a dependency of #16347 (wilson's construction). You can see that in Wilson's construction the lines that are a problem to you have been changed and that the function `OA_with_holes` is called instead.\n\n```\n+    # Building the OA\n+    OAs ={i:list(OA_with_holes(k,i,i)) for i in K}\n+\n+    # Turning them into IMOLS\n+    for i,OA in OAs.items():\n+        for ii in range(i):\n+            OAs[i].remove((ii,)*k)\n```\n\nSooooooooooo given that \n1) the current construction will work for as long as they are doctested\n2) What bothers you is already fix a bit above\n\nittttttt would be cool if you could consider that this problem does not matter as it is already fixed above.  It just comes from the fact that I write all my code in the same file but that I try to split it into small bits that are easier to review... And in this case I probably removed the call to `OA_with_PBD` so that this patch could be reviewed without the \"Helper functions\" patch as a dependency.\n\nNathann",
    "created_at": "2014-06-03T08:42:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16361",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16361#issuecomment-213430",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:6'></a>
Hellooooooooo !!

> The function `OA_from_PBD` is sensitive to the output of `orthogonal_array`.

Indeed. And sensitive to the labelling of the design, which I guess is what bothers you.

> More precisely, the function needs a `TD(k,i) - i TD(k,1)`. But right now, it is just a matter of luck whether the answer of `orthogonal_array(k,i)` actually is... and tomorrow the answer might change. So you could not rely on that. For the current purpose of the ticket, a fix would be to feed explicitly the function `OA_from_PBD` with the corresponding list of `TD(k,i) - i TD(k,1)`.

First, it is not true that "this can change and that I cannot rely on that" because there is a doctest. So if the constructions for which we need `OA_from_PBD` work now, they will continue working for as long as the doctest is there.

Secondly, you are right that the least we can do is solve this problem "up to relabelling" of the original design. This is what is being done in #16391 (it depends on #16370), which also implements another technique to find `TD(k,n)-x.TD(k,1)`. This patch #16391 is also a dependency of #16347 (wilson's construction), and the patch on which we talk right now is also a dependency of #16347 (wilson's construction). You can see that in Wilson's construction the lines that are a problem to you have been changed and that the function `OA_with_holes` is called instead.

```
+    # Building the OA
+    OAs ={i:list(OA_with_holes(k,i,i)) for i in K}
+
+    # Turning them into IMOLS
+    for i,OA in OAs.items():
+        for ii in range(i):
+            OAs[i].remove((ii,)*k)
```

Sooooooooooo given that 
1) the current construction will work for as long as they are doctested
2) What bothers you is already fix a bit above

ittttttt would be cool if you could consider that this problem does not matter as it is already fixed above.  It just comes from the fact that I write all my code in the same file but that I try to split it into small bits that are easier to review... And in this case I probably removed the call to `OA_with_PBD` so that this patch could be reviewed without the "Helper functions" patch as a dependency.

Nathann



---

archive/issue_events_146152.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2014-06-03T11:36:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16361",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16361#event-146152"
}
```



---

archive/issue_events_146153.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2014-06-03T11:36:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16361",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16361#event-146153"
}
```



---

archive/issue_comments_213431.json:
```json
{
    "body": "<a id='comment:8'></a>\nEDIT: post removed",
    "created_at": "2014-06-12T13:44:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16361",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16361#issuecomment-213431",
    "user": "https://github.com/videlec"
}
```

<a id='comment:8'></a>
EDIT: post removed



---

archive/issue_comments_213432.json:
```json
{
    "body": "<a id='comment:9'></a>\nHello,\n\n`incomplete_orthogonal_array`:\n\n- Under the condition `x <= 3 and n > k-1 and k >= 3` it should return `orthogonal_array(k,n,existence=True)` and not `True`.\n\n- If `k=n+1` then we have a projective planes and all blocks intersect... so there is no `OA(n+1,n) - 2.OA(n+1,1)`. I added the appropriate test in `incomplete_orthogonal_array`.\n\n`OA_from_PBD`:\n\n- it makes more sense to use the function `incomplete_orthogonal_array` since it is here!!\n\n- I changed the end of the if/elif to forward the non-existence (and also avoid doctest error because of #16388)\n\n- I changed the doctest (which was just a copy of the one in `database.py`!!) to be something non-trivial\n\nsee the changes on the branch `public/16361` (where #16461 is merged). I was able to build the doc and all test pass...\n\nDo you have further remarks? Otherwise it deserves a positive review.\n\nVincent",
    "created_at": "2014-06-12T19:43:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16361",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16361#issuecomment-213432",
    "user": "https://github.com/videlec"
}
```

<a id='comment:9'></a>
Hello,

`incomplete_orthogonal_array`:

- Under the condition `x <= 3 and n > k-1 and k >= 3` it should return `orthogonal_array(k,n,existence=True)` and not `True`.

- If `k=n+1` then we have a projective planes and all blocks intersect... so there is no `OA(n+1,n) - 2.OA(n+1,1)`. I added the appropriate test in `incomplete_orthogonal_array`.

`OA_from_PBD`:

- it makes more sense to use the function `incomplete_orthogonal_array` since it is here!!

- I changed the end of the if/elif to forward the non-existence (and also avoid doctest error because of #16388)

- I changed the doctest (which was just a copy of the one in `database.py`!!) to be something non-trivial

see the changes on the branch `public/16361` (where #16461 is merged). I was able to build the doc and all test pass...

Do you have further remarks? Otherwise it deserves a positive review.

Vincent



---

archive/issue_comments_213433.json:
```json
{
    "body": "<a id='comment:10'></a>\nHello !\n\n> `incomplete_orthogonal_array`:\n> \n> - Under the condition `x <= 3 and n > k-1 and k >= 3` it should return `orthogonal_array(k,n,existence=True)` and not `True`.\n\n+1\n\n> - If `k=n+1` then we have a projective planes and all blocks intersect... so there is no `OA(n+1,n) - 2.OA(n+1,1)`. I added the appropriate test in `incomplete_orthogonal_array`.\n\nSee [1]\n\n> `OA_from_PBD`:\n> \n> - it makes more sense to use the function `incomplete_orthogonal_array` since it is here!!\n\n+1\n\n> - I changed the end of the if/elif to forward the non-existence (and also avoid doctest error because of #16388)\n\nSee below\n\n> - I changed the doctest (which was just a copy of the one in `database.py`!!) to be something non-trivial\n\n+1\n\n> see the changes on the branch `public/16361` (where #16461 is merged). I was able to build the doc and all test pass...\n> \n> Do you have further remarks? Otherwise it deserves a positive review.\n\nWell... Actually, I think that you should not intercept all exceptions in order to return specific error messages... I believe that you should let the subfunction raise its own exception. That's going too far I think `:-/`\n\nIf the user requests a construction that requires other construction, let the other constructions raise an exception ! The user will see a message like \"Impossible to build a OA(....)\", meaning that the function needed one and it did not exist. \n\n```\n+    for i in K:\n+        if incomplete_orthogonal_array(k,i,(1,)*i,existence=True) is False:\n+            raise EmptySetError(\"The construction is impossible since there is no OA({},{})-{}.OA({},1)\".format(k,i,i,k))\n+        elif incomplete_orthogonal_array(k,i,(1,)*i,existence=True) is Unknown:\n+            raise NotImplementedError(\"I was not able to build an OA({},{})-{}.OA({},1)\".format(k,i,i,k))\n+        else:\n+            OAs[i] = incomplete_orthogonal_array(k,i,(1,)*i)\n```\n\nIn the first two situations, you return manually the exception that should be raised by incomplete_orthogonal_array. Why do it again manually ? Why not just call it ?\n\nSame here \n\n```\n+    elif orthogonal_array(k,n,existence=existence) is False:\n+        if existence:\n+            return False\n+        raise EmptySetError(\"There is no OA({},{}) and hence no OA({},{})-{}.OA({},1)\".format(k,n,k,n,k))\n+\n+    elif orthogonal_array(k,n,existence=existence) is Unknown:\n+        if existence:\n+            return Unknown\n+        raise NotImplementedError(\"I do not know how to build this OA({},{})-{}.OA({},1)\".format(k,n,k))\n+\n     else:\n-        return orthogonal_array(k,n,existence=existence)\n+        raise RuntimeError(\"This should not happen!\")\n```\n\nThe line you removed was doing the very same job, i.e. forwarding the non-existence results ! All you did was rewrite the exception, and the user sees :\n\n\"There is no OA(k,n) and this no OA(k,n)-xOA(k,1)\"\n\ninstead of\n\n\"There is no OA(k,n)\"\n\nI believe that you should let the subfunction raise its exception. What do you think ?\n\nNathann",
    "created_at": "2014-06-12T20:27:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16361",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16361#issuecomment-213433",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:10'></a>
Hello !

> `incomplete_orthogonal_array`:
> 
> - Under the condition `x <= 3 and n > k-1 and k >= 3` it should return `orthogonal_array(k,n,existence=True)` and not `True`.

+1

> - If `k=n+1` then we have a projective planes and all blocks intersect... so there is no `OA(n+1,n) - 2.OA(n+1,1)`. I added the appropriate test in `incomplete_orthogonal_array`.

See [1]

> `OA_from_PBD`:
> 
> - it makes more sense to use the function `incomplete_orthogonal_array` since it is here!!

+1

> - I changed the end of the if/elif to forward the non-existence (and also avoid doctest error because of #16388)

See below

> - I changed the doctest (which was just a copy of the one in `database.py`!!) to be something non-trivial

+1

> see the changes on the branch `public/16361` (where #16461 is merged). I was able to build the doc and all test pass...
> 
> Do you have further remarks? Otherwise it deserves a positive review.

Well... Actually, I think that you should not intercept all exceptions in order to return specific error messages... I believe that you should let the subfunction raise its own exception. That's going too far I think `:-/`

If the user requests a construction that requires other construction, let the other constructions raise an exception ! The user will see a message like "Impossible to build a OA(....)", meaning that the function needed one and it did not exist. 

```
+    for i in K:
+        if incomplete_orthogonal_array(k,i,(1,)*i,existence=True) is False:
+            raise EmptySetError("The construction is impossible since there is no OA({},{})-{}.OA({},1)".format(k,i,i,k))
+        elif incomplete_orthogonal_array(k,i,(1,)*i,existence=True) is Unknown:
+            raise NotImplementedError("I was not able to build an OA({},{})-{}.OA({},1)".format(k,i,i,k))
+        else:
+            OAs[i] = incomplete_orthogonal_array(k,i,(1,)*i)
```

In the first two situations, you return manually the exception that should be raised by incomplete_orthogonal_array. Why do it again manually ? Why not just call it ?

Same here 

```
+    elif orthogonal_array(k,n,existence=existence) is False:
+        if existence:
+            return False
+        raise EmptySetError("There is no OA({},{}) and hence no OA({},{})-{}.OA({},1)".format(k,n,k,n,k))
+
+    elif orthogonal_array(k,n,existence=existence) is Unknown:
+        if existence:
+            return Unknown
+        raise NotImplementedError("I do not know how to build this OA({},{})-{}.OA({},1)".format(k,n,k))
+
     else:
-        return orthogonal_array(k,n,existence=existence)
+        raise RuntimeError("This should not happen!")
```

The line you removed was doing the very same job, i.e. forwarding the non-existence results ! All you did was rewrite the exception, and the user sees :

"There is no OA(k,n) and this no OA(k,n)-xOA(k,1)"

instead of

"There is no OA(k,n)"

I believe that you should let the subfunction raise its exception. What do you think ?

Nathann



---

archive/issue_comments_213434.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [@nathanncohen](#comment%3A10):\n> Hello !\n> \n> > `incomplete_orthogonal_array`:\n> > \n\n> \n> > - If `k=n+1` then we have a projective planes and all blocks intersect... so there is no `OA(n+1,n) - 2.OA(n+1,1)`. I added the appropriate test in `incomplete_orthogonal_array`.\n\n> \n> See `[1]`\n\nWhat is `[1]`?\n \n> > `OA_from_PBD`:\n> > \n> > - I changed the end of the if/elif to forward the non-existence (and also avoid doctest error because of #16388)\n\n> \n> See below\n> \n> \n> > see the changes on the branch `public/16361` (where #16461 is merged). I was able to build the doc and all test pass...\n> > \n> > Do you have further remarks? Otherwise it deserves a positive review.\n\n> \n> Well... Actually, I think that you should not intercept all exceptions in order to return specific error messages... I believe that you should let the subfunction raise its own exception. That's going too far I think `:-/`\n> \n> I believe that you should let the subfunction raise its exception. What do you think ?\n> \n\nAll right, but then you should put #16388 as a dependency and adapt the doctests...\n\nVincent",
    "created_at": "2014-06-12T20:36:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16361",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16361#issuecomment-213434",
    "user": "https://github.com/videlec"
}
```

<a id='comment:11'></a>
Replying to [@nathanncohen](#comment%3A10):
> Hello !
> 
> > `incomplete_orthogonal_array`:
> > 

> 
> > - If `k=n+1` then we have a projective planes and all blocks intersect... so there is no `OA(n+1,n) - 2.OA(n+1,1)`. I added the appropriate test in `incomplete_orthogonal_array`.

> 
> See `[1]`

What is `[1]`?
 
> > `OA_from_PBD`:
> > 
> > - I changed the end of the if/elif to forward the non-existence (and also avoid doctest error because of #16388)

> 
> See below
> 
> 
> > see the changes on the branch `public/16361` (where #16461 is merged). I was able to build the doc and all test pass...
> > 
> > Do you have further remarks? Otherwise it deserves a positive review.

> 
> Well... Actually, I think that you should not intercept all exceptions in order to return specific error messages... I believe that you should let the subfunction raise its own exception. That's going too far I think `:-/`
> 
> I believe that you should let the subfunction raise its exception. What do you think ?
> 

All right, but then you should put #16388 as a dependency and adapt the doctests...

Vincent



---

archive/issue_comments_213435.json:
```json
{
    "body": "<a id='comment:12'></a>\n**Branch pushed to git repo; I updated commit sha1.** **Last 10 new commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4007157c565986546edaebc2a760fbfba74212ed\">4007157</a></td><td><code>trac #16361: merge with #16461</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/191aaabe087b23136588139fd4d0e7e3a69baf17\">191aaab</a></td><td><code>trac #16361: fix bug in IOA + better OA_from_PBD</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0380ead2db09b903f25ef9204ed8b2f1f66cfd20\">0380ead</a></td><td><code>trac #16461: fix documentation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8704b9cdc1c8ae606f81b8613da6db379061a51b\">8704b9c</a></td><td><code>trac #16361: merge updated #16461</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/767e0911107e5b374ad182acd0e5dac79ae8c874\">767e091</a></td><td><code>trac #16388: Specify the values of k,n in the exceptions</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a46016940e56a1d56bb0542c1320f87c057862da\">a460169</a></td><td><code>merge Sage version 6.3.beta3</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c365a39d76ea00e63e1f11de86ad3474fc3f77b9\">c365a39</a></td><td><code>trac #16388: use format for OA + specify (k,n) for BIBD</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ec26ca23d2549d6dc111c6d69d03df739115ee9f\">ec26ca2</a></td><td><code>trac #16388: a missing one in BIBD_from_TD</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/79178b62b55c9d38b4ee015118e1cbc6acefb8f8\">79178b6</a></td><td><code>trac #16388: (v,k,1)-BIBD instead of BIBD(v,k,1)</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/02ecf51a3101880f34db39cf4ed38f19c7fd34f3\">02ecf51</a></td><td><code>trac #16361: Merged with #16388</code></td></tr></table>\n",
    "created_at": "2014-06-13T07:43:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16361",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16361#issuecomment-213435",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:12'></a>
**Branch pushed to git repo; I updated commit sha1.** **Last 10 new commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4007157c565986546edaebc2a760fbfba74212ed">4007157</a></td><td><code>trac #16361: merge with #16461</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/191aaabe087b23136588139fd4d0e7e3a69baf17">191aaab</a></td><td><code>trac #16361: fix bug in IOA + better OA_from_PBD</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0380ead2db09b903f25ef9204ed8b2f1f66cfd20">0380ead</a></td><td><code>trac #16461: fix documentation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8704b9cdc1c8ae606f81b8613da6db379061a51b">8704b9c</a></td><td><code>trac #16361: merge updated #16461</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/767e0911107e5b374ad182acd0e5dac79ae8c874">767e091</a></td><td><code>trac #16388: Specify the values of k,n in the exceptions</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a46016940e56a1d56bb0542c1320f87c057862da">a460169</a></td><td><code>merge Sage version 6.3.beta3</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c365a39d76ea00e63e1f11de86ad3474fc3f77b9">c365a39</a></td><td><code>trac #16388: use format for OA + specify (k,n) for BIBD</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ec26ca23d2549d6dc111c6d69d03df739115ee9f">ec26ca2</a></td><td><code>trac #16388: a missing one in BIBD_from_TD</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/79178b62b55c9d38b4ee015118e1cbc6acefb8f8">79178b6</a></td><td><code>trac #16388: (v,k,1)-BIBD instead of BIBD(v,k,1)</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/02ecf51a3101880f34db39cf4ed38f19c7fd34f3">02ecf51</a></td><td><code>trac #16361: Merged with #16388</code></td></tr></table>




---

archive/issue_comments_213436.json:
```json
{
    "body": "**Changing commit** from \"[20ef21682cfe8b6532e2e2621b88d921236528f2](https://github.com/sagemath/sagetrac-mirror/commit/20ef21682cfe8b6532e2e2621b88d921236528f2)\" to \"[02ecf51a3101880f34db39cf4ed38f19c7fd34f3](https://github.com/sagemath/sagetrac-mirror/commit/02ecf51a3101880f34db39cf4ed38f19c7fd34f3)\".",
    "created_at": "2014-06-13T07:43:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16361",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16361#issuecomment-213436",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[20ef21682cfe8b6532e2e2621b88d921236528f2](https://github.com/sagemath/sagetrac-mirror/commit/20ef21682cfe8b6532e2e2621b88d921236528f2)" to "[02ecf51a3101880f34db39cf4ed38f19c7fd34f3](https://github.com/sagemath/sagetrac-mirror/commit/02ecf51a3101880f34db39cf4ed38f19c7fd34f3)".



---

archive/issue_comments_213437.json:
```json
{
    "body": "<a id='comment:13'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5d4607aad0675c6ea4afd914796bc78d043a1600\">5d4607a</a></td><td><code>trac #16361: Don't re-raise the exceptions</code></td></tr></table>\n",
    "created_at": "2014-06-13T07:43:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16361",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16361#issuecomment-213437",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:13'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5d4607aad0675c6ea4afd914796bc78d043a1600">5d4607a</a></td><td><code>trac #16361: Don't re-raise the exceptions</code></td></tr></table>




---

archive/issue_comments_213438.json:
```json
{
    "body": "**Changing commit** from \"[02ecf51a3101880f34db39cf4ed38f19c7fd34f3](https://github.com/sagemath/sagetrac-mirror/commit/02ecf51a3101880f34db39cf4ed38f19c7fd34f3)\" to \"[5d4607aad0675c6ea4afd914796bc78d043a1600](https://github.com/sagemath/sagetrac-mirror/commit/5d4607aad0675c6ea4afd914796bc78d043a1600)\".",
    "created_at": "2014-06-13T07:43:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16361",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16361#issuecomment-213438",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[02ecf51a3101880f34db39cf4ed38f19c7fd34f3](https://github.com/sagemath/sagetrac-mirror/commit/02ecf51a3101880f34db39cf4ed38f19c7fd34f3)" to "[5d4607aad0675c6ea4afd914796bc78d043a1600](https://github.com/sagemath/sagetrac-mirror/commit/5d4607aad0675c6ea4afd914796bc78d043a1600)".



---

archive/issue_comments_213439.json:
```json
{
    "body": "<a id='comment:14'></a>\nHere it is !\n\nNathann",
    "created_at": "2014-06-13T07:44:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16361",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16361#issuecomment-213439",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:14'></a>
Here it is !

Nathann



---

archive/issue_events_146154.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2014-06-13T08:07:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16361",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16361#event-146154"
}
```



---

archive/issue_events_146155.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2014-06-13T08:07:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16361",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16361#event-146155"
}
```



---

archive/issue_comments_213440.json:
```json
{
    "body": "<a id='comment:15'></a>\nHi,\n\nLooks good to me. All test pass and documentation builds!\n\nDo you know if there is an `OA(n,n)` for some `n` which is not a prime power? (it is not in Sage).\n\nVincent",
    "created_at": "2014-06-13T08:07:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16361",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16361#issuecomment-213440",
    "user": "https://github.com/videlec"
}
```

<a id='comment:15'></a>
Hi,

Looks good to me. All test pass and documentation builds!

Do you know if there is an `OA(n,n)` for some `n` which is not a prime power? (it is not in Sage).

Vincent



---

archive/issue_comments_213441.json:
```json
{
    "body": "<a id='comment:16'></a>\nYo !\n\n> Looks good to me. All test pass and documentation builds!\n\nI hope that Volker will merge it soon... I had not noticed that some tickets had been closed already in an unreleased beta `:-/`\n\n> Do you know if there is an `OA(n,n)` for some `n` which is not a prime power? (it is not in Sage).\n\nHMmmm.... No idea, but there is a partial answer as Theorem III.3.32 in the handbook. Looks like we will call \"is_sum_of_squares\" again `:-P`\n\nNathann",
    "created_at": "2014-06-13T08:12:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16361",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16361#issuecomment-213441",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:16'></a>
Yo !

> Looks good to me. All test pass and documentation builds!

I hope that Volker will merge it soon... I had not noticed that some tickets had been closed already in an unreleased beta `:-/`

> Do you know if there is an `OA(n,n)` for some `n` which is not a prime power? (it is not in Sage).

HMmmm.... No idea, but there is a partial answer as Theorem III.3.32 in the handbook. Looks like we will call "is_sum_of_squares" again `:-P`

Nathann



---

archive/issue_comments_213442.json:
```json
{
    "body": "**Changing dependencies** from \"#16356\" to \"#16461, #16388\".",
    "created_at": "2014-06-13T08:32:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16361",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16361#issuecomment-213442",
    "user": "https://github.com/nathanncohen"
}
```

**Changing dependencies** from "#16356" to "#16461, #16388".



---

archive/issue_comments_213443.json:
```json
{
    "body": "<a id='comment:18'></a>\nReviewer name\n\nWhats up with the TODO?",
    "created_at": "2014-06-14T13:22:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16361",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16361#issuecomment-213443",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:18'></a>
Reviewer name

Whats up with the TODO?



---

archive/issue_comments_213444.json:
```json
{
    "body": "<a id='comment:19'></a>\n> Whats up with the TODO?\n\nSorry, it was a \"note to self\". I did that when I rebased everything above.\n\nNathann",
    "created_at": "2014-06-14T13:28:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16361",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16361#issuecomment-213444",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:19'></a>
> Whats up with the TODO?

Sorry, it was a "note to self". I did that when I rebased everything above.

Nathann



---

archive/issue_comments_213445.json:
```json
{
    "body": "**Reviewer:** Vincent Delecroix",
    "created_at": "2014-06-14T13:28:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16361",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16361#issuecomment-213445",
    "user": "https://github.com/nathanncohen"
}
```

**Reviewer:** Vincent Delecroix



---

archive/issue_comments_213446.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,5 +1,3 @@\n New designs, and a new \"TD from PBD\" construction ! Too bad this construction cannot be called automatically (yet) `:-P`\n \n Nathann\n-\n-TODO : Update #16423 when this patch is reviewed\n``````\n",
    "created_at": "2014-06-14T13:31:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16361",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16361#issuecomment-213446",
    "user": "https://github.com/nathanncohen"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,5 +1,3 @@
 New designs, and a new "TD from PBD" construction ! Too bad this construction cannot be called automatically (yet) `:-P`
 
 Nathann
-
-TODO : Update #16423 when this patch is reviewed
``````




---

archive/issue_events_146156.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-06-18T14:11:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16361",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16361#event-146156"
}
```



---

archive/issue_events_146157.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "fa45133889cb4c37802dac0f9fbc0ee9d8321f79",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2014-06-18T14:11:22Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/16361",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16361#event-146157"
}
```



---

archive/issue_comments_213447.json:
```json
{
    "body": "**Changing branch** from \"[u/ncohen/16361](https://github.com/sagemath/sagetrac-mirror/tree/u/ncohen/16361)\" to \"[5d4607aad0675c6ea4afd914796bc78d043a1600](https://github.com/sagemath/sagetrac-mirror/commit/5d4607aad0675c6ea4afd914796bc78d043a1600)\".",
    "created_at": "2014-06-18T14:11:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16361",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16361#issuecomment-213447",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/ncohen/16361](https://github.com/sagemath/sagetrac-mirror/tree/u/ncohen/16361)" to "[5d4607aad0675c6ea4afd914796bc78d043a1600](https://github.com/sagemath/sagetrac-mirror/commit/5d4607aad0675c6ea4afd914796bc78d043a1600)".
