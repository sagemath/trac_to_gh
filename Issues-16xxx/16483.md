# Issue 16483: New Build/Packaging System

archive/issues_016246.json:
```json
{
    "assignees": [],
    "body": "Our current build/packaging system is at the limits of what one can do just with a Makefile and shell scripts. This ticket aims to implement a new system\n* Git-aware: use SHA1 hashes instead of timestamps for dependency calculations\n* Unified machine-readable package configuration using YAML\n* Dependency handling also for optional packages\n* Distinction between different types of dependencies: build time, runtime hard/soft, testing.\n* Modular, allowing for easy experimentation with per-package backends\n* written in pure Python without any dependencies\n* doctested for Python 2.6, 2.7, 3.3, and 3.4.\n\nThe entire package configuration will be in a file `SAGE_ROOT/build/pkgs/<name>/package.yaml`, for example\n\n```\nname:\n    matplotlib\n\ncategory:\n    standard\n\nsource:\n    version:  \n        1.3.1\n    tarball:\n        name:     matplotlib-{source.version}.tar.gz\n        sha1:     f340378c43c4c3f6219ef9fd84af4ebbe18f8feb\n\nbuilder:\n    type:            SpkgInstallScript\n    install_script:  spkg-install\n\ndepends:\n    build:\n        - pkgconf\n        - setuptools\n    hard:\n        - python\n        - numpy\n        - freetype\n        - libpng\n        - gdmodule\n        - dateutil\n        - pyparsing\n```\n\n\nBranch/Commit: **[u/vbraun/buildsystem](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/buildsystem) @ [145ebed](https://github.com/sagemath/sagetrac-mirror/commit/145ebed1c2aa07ea5346448a59752019b902349d)**\n\nReviewer: **Michael Orlitzky**\n\nAuthor: **Volker Braun**\n\nComponent: **build**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/16483_\n\n",
    "closed_at": "2021-09-18T17:51:47Z",
    "created_at": "2014-06-15T20:37:45Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/invalid"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "New Build/Packaging System",
    "type": "issue",
    "updated_at": "2021-09-18T17:51:47Z",
    "url": "https://github.com/sagemath/sage/issues/16483",
    "user": "https://github.com/vbraun"
}
```
Our current build/packaging system is at the limits of what one can do just with a Makefile and shell scripts. This ticket aims to implement a new system
* Git-aware: use SHA1 hashes instead of timestamps for dependency calculations
* Unified machine-readable package configuration using YAML
* Dependency handling also for optional packages
* Distinction between different types of dependencies: build time, runtime hard/soft, testing.
* Modular, allowing for easy experimentation with per-package backends
* written in pure Python without any dependencies
* doctested for Python 2.6, 2.7, 3.3, and 3.4.

The entire package configuration will be in a file `SAGE_ROOT/build/pkgs/<name>/package.yaml`, for example

```
name:
    matplotlib

category:
    standard

source:
    version:  
        1.3.1
    tarball:
        name:     matplotlib-{source.version}.tar.gz
        sha1:     f340378c43c4c3f6219ef9fd84af4ebbe18f8feb

builder:
    type:            SpkgInstallScript
    install_script:  spkg-install

depends:
    build:
        - pkgconf
        - setuptools
    hard:
        - python
        - numpy
        - freetype
        - libpng
        - gdmodule
        - dateutil
        - pyparsing
```


Branch/Commit: **[u/vbraun/buildsystem](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/buildsystem) @ [145ebed](https://github.com/sagemath/sagetrac-mirror/commit/145ebed1c2aa07ea5346448a59752019b902349d)**

Reviewer: **Michael Orlitzky**

Author: **Volker Braun**

Component: **build**

_Issue created by migration from https://trac.sagemath.org/ticket/16483_





---

archive/issue_events_235430.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-06-15T20:37:45Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16483",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16483#event-235430"
}
```



---

archive/issue_events_235431.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-06-15T20:37:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16483",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "000080",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16483#event-235431"
}
```



---

archive/issue_events_235432.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-06-15T20:37:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16483",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16483#event-235432"
}
```



---

archive/issue_events_235433.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-06-15T20:37:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16483",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16483#event-235433"
}
```



---

archive/issue_comments_213509.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f23fa75b74a19e682477fa2e9fa1636814ef3dd5\">f23fa75</a></td><td><code>add the sage_c_library package</code></td></tr></table>\n",
    "created_at": "2014-06-16T00:25:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16483#issuecomment-213509",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:1"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f23fa75b74a19e682477fa2e9fa1636814ef3dd5">f23fa75</a></td><td><code>add the sage_c_library package</code></td></tr></table>




---

archive/issue_comments_213510.json:
```json
{
    "body": "Changed commit from **[6000c99](https://github.com/sagemath/sagetrac-mirror/commit/6000c999ce03b8a86281615312db40f01e59181c)** to **[f23fa75](https://github.com/sagemath/sagetrac-mirror/commit/f23fa75b74a19e682477fa2e9fa1636814ef3dd5)**",
    "created_at": "2014-06-16T00:25:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16483#issuecomment-213510",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[6000c99](https://github.com/sagemath/sagetrac-mirror/commit/6000c999ce03b8a86281615312db40f01e59181c)** to **[f23fa75](https://github.com/sagemath/sagetrac-mirror/commit/f23fa75b74a19e682477fa2e9fa1636814ef3dd5)**



---

archive/issue_comments_213511.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f3438e5997720bd98b797324bfe7749636087628\">f3438e5</a></td><td><code>build -> compile</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bc71b579a66095cdc4f65e3593609ae636fdd084\">bc71b57</a></td><td><code>add sage_python_library and sage_noarch packages</code></td></tr></table>\n",
    "created_at": "2014-06-16T14:17:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16483#issuecomment-213511",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:2"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f3438e5997720bd98b797324bfe7749636087628">f3438e5</a></td><td><code>build -> compile</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bc71b579a66095cdc4f65e3593609ae636fdd084">bc71b57</a></td><td><code>add sage_python_library and sage_noarch packages</code></td></tr></table>




---

archive/issue_comments_213512.json:
```json
{
    "body": "Changed commit from **[f23fa75](https://github.com/sagemath/sagetrac-mirror/commit/f23fa75b74a19e682477fa2e9fa1636814ef3dd5)** to **[bc71b57](https://github.com/sagemath/sagetrac-mirror/commit/bc71b579a66095cdc4f65e3593609ae636fdd084)**",
    "created_at": "2014-06-16T14:17:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16483#issuecomment-213512",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[f23fa75](https://github.com/sagemath/sagetrac-mirror/commit/f23fa75b74a19e682477fa2e9fa1636814ef3dd5)** to **[bc71b57](https://github.com/sagemath/sagetrac-mirror/commit/bc71b579a66095cdc4f65e3593609ae636fdd084)**



---

archive/issue_comments_213513.json:
```json
{
    "body": "Changed commit from **[bc71b57](https://github.com/sagemath/sagetrac-mirror/commit/bc71b579a66095cdc4f65e3593609ae636fdd084)** to **[6c582be](https://github.com/sagemath/sagetrac-mirror/commit/6c582bed9de479130f357c3052afdddbea8a6389)**",
    "created_at": "2014-06-16T15:51:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16483#issuecomment-213513",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[bc71b57](https://github.com/sagemath/sagetrac-mirror/commit/bc71b579a66095cdc4f65e3593609ae636fdd084)** to **[6c582be](https://github.com/sagemath/sagetrac-mirror/commit/6c582bed9de479130f357c3052afdddbea8a6389)**



---

archive/issue_comments_213514.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e94c3c9e8fcdc74d11c249b904a8deadff7d82d4\">e94c3c9</a></td><td><code>fix zn_poly typo</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6c582bed9de479130f357c3052afdddbea8a6389\">6c582be</a></td><td><code>proper gitignore support</code></td></tr></table>\n",
    "created_at": "2014-06-16T15:51:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16483#issuecomment-213514",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:3"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e94c3c9e8fcdc74d11c249b904a8deadff7d82d4">e94c3c9</a></td><td><code>fix zn_poly typo</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6c582bed9de479130f357c3052afdddbea8a6389">6c582be</a></td><td><code>proper gitignore support</code></td></tr></table>




---

archive/issue_comments_213515.json:
```json
{
    "body": "Changed commit from **[6c582be](https://github.com/sagemath/sagetrac-mirror/commit/6c582bed9de479130f357c3052afdddbea8a6389)** to **[145ebed](https://github.com/sagemath/sagetrac-mirror/commit/145ebed1c2aa07ea5346448a59752019b902349d)**",
    "created_at": "2014-06-16T22:20:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16483#issuecomment-213515",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[6c582be](https://github.com/sagemath/sagetrac-mirror/commit/6c582bed9de479130f357c3052afdddbea8a6389)** to **[145ebed](https://github.com/sagemath/sagetrac-mirror/commit/145ebed1c2aa07ea5346448a59752019b902349d)**



---

archive/issue_comments_213516.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/78418ad9f68612b886314a816aab1b1f27b25444\">78418ad</a></td><td><code>fix doctest</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0ce75858d3fbf5f769ed55d150af0092cdb352e0\">0ce7585</a></td><td><code>working on clean build</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1f0eeebb10c17b3cc8d9c4b2edb394d84c9a3878\">1f0eeeb</a></td><td><code>switch the install metadata directory</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/145ebed1c2aa07ea5346448a59752019b902349d\">145ebed</a></td><td><code>towards a successful build</code></td></tr></table>\n",
    "created_at": "2014-06-16T22:20:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16483#issuecomment-213516",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/78418ad9f68612b886314a816aab1b1f27b25444">78418ad</a></td><td><code>fix doctest</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0ce75858d3fbf5f769ed55d150af0092cdb352e0">0ce7585</a></td><td><code>working on clean build</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1f0eeebb10c17b3cc8d9c4b2edb394d84c9a3878">1f0eeeb</a></td><td><code>switch the install metadata directory</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/145ebed1c2aa07ea5346448a59752019b902349d">145ebed</a></td><td><code>towards a successful build</code></td></tr></table>




---

archive/issue_events_235434.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/16483",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16483#event-235434"
}
```



---

archive/issue_events_235435.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16483",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16483#event-235435"
}
```



---

archive/issue_events_235436.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-07T08:02:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/16483",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16483#event-235436"
}
```



---

archive/issue_events_235437.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-07T08:02:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16483",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16483#event-235437"
}
```



---

archive/issue_events_235438.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-07T08:02:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16483",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "a6a6a6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16483#event-235438"
}
```



---

archive/issue_comments_213517.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\noutdated, should close",
    "created_at": "2021-09-07T08:02:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16483#issuecomment-213517",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:6" align="right">comment:6</div>

outdated, should close



---

archive/issue_events_235439.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-07T08:02:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16483",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16483#event-235439"
}
```



---

archive/issue_comments_213518.json:
```json
{
    "body": "Reviewer: **Michael Orlitzky**",
    "created_at": "2021-09-18T11:03:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16483#issuecomment-213518",
    "user": "https://github.com/orlitzky"
}
```

Reviewer: **Michael Orlitzky**



---

archive/issue_events_235440.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-09-18T11:03:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16483",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16483#event-235440"
}
```



---

archive/issue_events_235441.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-09-18T11:03:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16483",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16483#event-235441"
}
```



---

archive/issue_events_235442.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-18T17:51:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16483",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16483#event-235442"
}
```



---

archive/issue_events_235443.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-18T17:51:47Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/16483",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16483#event-235443"
}
```
