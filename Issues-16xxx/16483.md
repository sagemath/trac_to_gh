# Issue 16483: New Build/Packaging System

archive/issues_016246.json:
```json
{
    "body": "Our current build/packaging system is at the limits of what one can do just with a Makefile and shell scripts. This ticket aims to implement a new system\n* Git-aware: use SHA1 hashes instead of timestamps for dependency calculations\n* Unified machine-readable package configuration using YAML\n* Dependency handling also for optional packages\n* Distinction between different types of dependencies: build time, runtime hard/soft, testing.\n* Modular, allowing for easy experimentation with per-package backends\n* written in pure Python without any dependencies\n* doctested for Python 2.6, 2.7, 3.3, and 3.4.\n\nThe entire package configuration will be in a file `SAGE_ROOT/build/pkgs/<name>/package.yaml`, for example\n\n```\nname:\n    matplotlib\n\ncategory:\n    standard\n\nsource:\n    version:  \n        1.3.1\n    tarball:\n        name:     matplotlib-{source.version}.tar.gz\n        sha1:     f340378c43c4c3f6219ef9fd84af4ebbe18f8feb\n\nbuilder:\n    type:            SpkgInstallScript\n    install_script:  spkg-install\n\ndepends:\n    build:\n        - pkgconf\n        - setuptools\n    hard:\n        - python\n        - numpy\n        - freetype\n        - libpng\n        - gdmodule\n        - dateutil\n        - pyparsing\n```\n\n\nBranch: [u/vbraun/buildsystem](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/buildsystem)\n\nCommit: [145ebed1c2aa07ea5346448a59752019b902349d](https://github.com/sagemath/sagetrac-mirror/commit/145ebed1c2aa07ea5346448a59752019b902349d)\n\nReviewer: Michael Orlitzky\n\nAuthor: Volker Braun\n\nResolution: invalid\n\nIssue created by migration from https://trac.sagemath.org/ticket/16483\n\n",
    "closed_at": "2021-09-18T17:51:47Z",
    "created_at": "2014-06-15T20:37:45Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "New Build/Packaging System",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16483",
    "user": "https://github.com/vbraun"
}
```
Our current build/packaging system is at the limits of what one can do just with a Makefile and shell scripts. This ticket aims to implement a new system
* Git-aware: use SHA1 hashes instead of timestamps for dependency calculations
* Unified machine-readable package configuration using YAML
* Dependency handling also for optional packages
* Distinction between different types of dependencies: build time, runtime hard/soft, testing.
* Modular, allowing for easy experimentation with per-package backends
* written in pure Python without any dependencies
* doctested for Python 2.6, 2.7, 3.3, and 3.4.

The entire package configuration will be in a file `SAGE_ROOT/build/pkgs/<name>/package.yaml`, for example

```
name:
    matplotlib

category:
    standard

source:
    version:  
        1.3.1
    tarball:
        name:     matplotlib-{source.version}.tar.gz
        sha1:     f340378c43c4c3f6219ef9fd84af4ebbe18f8feb

builder:
    type:            SpkgInstallScript
    install_script:  spkg-install

depends:
    build:
        - pkgconf
        - setuptools
    hard:
        - python
        - numpy
        - freetype
        - libpng
        - gdmodule
        - dateutil
        - pyparsing
```


Branch: [u/vbraun/buildsystem](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/buildsystem)

Commit: [145ebed1c2aa07ea5346448a59752019b902349d](https://github.com/sagemath/sagetrac-mirror/commit/145ebed1c2aa07ea5346448a59752019b902349d)

Reviewer: Michael Orlitzky

Author: Volker Braun

Resolution: invalid

Issue created by migration from https://trac.sagemath.org/ticket/16483





---

archive/issue_comments_276284.json:
```json
{
    "body": "<a id='comment:1'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------|\n|[f23fa75](https://github.com/sagemath/sagetrac-mirror/commit/f23fa75b74a19e682477fa2e9fa1636814ef3dd5)|`add the sage_c_library package`|",
    "created_at": "2014-06-16T00:25:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16483#issuecomment-276284",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:1'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------|
|[f23fa75](https://github.com/sagemath/sagetrac-mirror/commit/f23fa75b74a19e682477fa2e9fa1636814ef3dd5)|`add the sage_c_library package`|



---

archive/issue_comments_276285.json:
```json
{
    "body": "Changing commit from \"6000c999ce03b8a86281615312db40f01e59181c\" to \"f23fa75b74a19e682477fa2e9fa1636814ef3dd5\"",
    "created_at": "2014-06-16T00:25:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16483#issuecomment-276285",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "6000c999ce03b8a86281615312db40f01e59181c" to "f23fa75b74a19e682477fa2e9fa1636814ef3dd5"



---

archive/issue_comments_276286.json:
```json
{
    "body": "<a id='comment:2'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                  |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------|\n|[f3438e5](https://github.com/sagemath/sagetrac-mirror/commit/f3438e5997720bd98b797324bfe7749636087628)|`build -> compile`|\n|[bc71b57](https://github.com/sagemath/sagetrac-mirror/commit/bc71b579a66095cdc4f65e3593609ae636fdd084)|`add sage_python_library and sage_noarch packages`|",
    "created_at": "2014-06-16T14:17:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16483#issuecomment-276286",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                  |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------|
|[f3438e5](https://github.com/sagemath/sagetrac-mirror/commit/f3438e5997720bd98b797324bfe7749636087628)|`build -> compile`|
|[bc71b57](https://github.com/sagemath/sagetrac-mirror/commit/bc71b579a66095cdc4f65e3593609ae636fdd084)|`add sage_python_library and sage_noarch packages`|



---

archive/issue_comments_276287.json:
```json
{
    "body": "Changing commit from \"f23fa75b74a19e682477fa2e9fa1636814ef3dd5\" to \"bc71b579a66095cdc4f65e3593609ae636fdd084\"",
    "created_at": "2014-06-16T14:17:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16483#issuecomment-276287",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "f23fa75b74a19e682477fa2e9fa1636814ef3dd5" to "bc71b579a66095cdc4f65e3593609ae636fdd084"



---

archive/issue_comments_276288.json:
```json
{
    "body": "Changing commit from \"bc71b579a66095cdc4f65e3593609ae636fdd084\" to \"6c582bed9de479130f357c3052afdddbea8a6389\"",
    "created_at": "2014-06-16T15:51:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16483#issuecomment-276288",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "bc71b579a66095cdc4f65e3593609ae636fdd084" to "6c582bed9de479130f357c3052afdddbea8a6389"



---

archive/issue_comments_276289.json:
```json
{
    "body": "<a id='comment:3'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                  |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------|\n|[e94c3c9](https://github.com/sagemath/sagetrac-mirror/commit/e94c3c9e8fcdc74d11c249b904a8deadff7d82d4)|`fix zn_poly typo`|\n|[6c582be](https://github.com/sagemath/sagetrac-mirror/commit/6c582bed9de479130f357c3052afdddbea8a6389)|`proper gitignore support`|",
    "created_at": "2014-06-16T15:51:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16483#issuecomment-276289",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                  |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------|
|[e94c3c9](https://github.com/sagemath/sagetrac-mirror/commit/e94c3c9e8fcdc74d11c249b904a8deadff7d82d4)|`fix zn_poly typo`|
|[6c582be](https://github.com/sagemath/sagetrac-mirror/commit/6c582bed9de479130f357c3052afdddbea8a6389)|`proper gitignore support`|



---

archive/issue_comments_276290.json:
```json
{
    "body": "Changing commit from \"6c582bed9de479130f357c3052afdddbea8a6389\" to \"145ebed1c2aa07ea5346448a59752019b902349d\"",
    "created_at": "2014-06-16T22:20:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16483#issuecomment-276290",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "6c582bed9de479130f357c3052afdddbea8a6389" to "145ebed1c2aa07ea5346448a59752019b902349d"



---

archive/issue_comments_276291.json:
```json
{
    "body": "<a id='comment:4'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |             |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------|\n|[78418ad](https://github.com/sagemath/sagetrac-mirror/commit/78418ad9f68612b886314a816aab1b1f27b25444)|`fix doctest`|\n|[0ce7585](https://github.com/sagemath/sagetrac-mirror/commit/0ce75858d3fbf5f769ed55d150af0092cdb352e0)|`working on clean build`|\n|[1f0eeeb](https://github.com/sagemath/sagetrac-mirror/commit/1f0eeebb10c17b3cc8d9c4b2edb394d84c9a3878)|`switch the install metadata directory`|\n|[145ebed](https://github.com/sagemath/sagetrac-mirror/commit/145ebed1c2aa07ea5346448a59752019b902349d)|`towards a successful build`|",
    "created_at": "2014-06-16T22:20:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16483#issuecomment-276291",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |             |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------|
|[78418ad](https://github.com/sagemath/sagetrac-mirror/commit/78418ad9f68612b886314a816aab1b1f27b25444)|`fix doctest`|
|[0ce7585](https://github.com/sagemath/sagetrac-mirror/commit/0ce75858d3fbf5f769ed55d150af0092cdb352e0)|`working on clean build`|
|[1f0eeeb](https://github.com/sagemath/sagetrac-mirror/commit/1f0eeebb10c17b3cc8d9c4b2edb394d84c9a3878)|`switch the install metadata directory`|
|[145ebed](https://github.com/sagemath/sagetrac-mirror/commit/145ebed1c2aa07ea5346448a59752019b902349d)|`towards a successful build`|



---

archive/issue_events_055103.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16483",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16483#event-55103"
}
```



---

archive/issue_events_055104.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-07T08:02:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16483",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16483#event-55104"
}
```



---

archive/issue_events_055105.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-07T08:02:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16483",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16483#event-55105"
}
```



---

archive/issue_comments_276292.json:
```json
{
    "body": "<a id='comment:6'></a>\noutdated, should close",
    "created_at": "2021-09-07T08:02:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16483#issuecomment-276292",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>
outdated, should close



---

archive/issue_comments_276293.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-09-07T08:02:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16483#issuecomment-276293",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_276294.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Michael Orlitzky\"",
    "created_at": "2021-09-18T11:03:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16483#issuecomment-276294",
    "user": "https://github.com/orlitzky"
}
```

Changing reviewer from "" to "Michael Orlitzky"



---

archive/issue_comments_276295.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-09-18T11:03:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16483#issuecomment-276295",
    "user": "https://github.com/orlitzky"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_055106.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-18T17:51:47Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16483",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16483#event-55106"
}
```



---

archive/issue_comments_276296.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2021-09-18T17:51:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16483",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16483#issuecomment-276296",
    "user": "https://github.com/mkoeppe"
}
```

Resolution: invalid
