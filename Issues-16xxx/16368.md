# Issue 16368: Missing pkgconf dependencies

archive/issues_016131.json:
```json
{
    "body": "We should build the pkgconf package before anything that uses pkg-config.\n\n**Keywords:** pkg-config pkgconfig\n\n**Branch/Commit:** [b65b9590227626ad4392ba988fd514c113085d7b](https://github.com/sagemath/sagetrac-mirror/commit/b65b9590227626ad4392ba988fd514c113085d7b)\n\n**Reviewer:** Martin Albrecht\n\n**Author:** Volker Braun\n\nIssue created by migration from https://trac.sagemath.org/ticket/16368\n\n",
    "closed_at": "2014-05-25T10:09:22Z",
    "created_at": "2014-05-16T20:41:36Z",
    "labels": [
        "component: build",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.3",
    "title": "Missing pkgconf dependencies",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16368",
    "user": "https://trac.sagemath.org/admin/accounts/users/stephen"
}
```
We should build the pkgconf package before anything that uses pkg-config.

**Keywords:** pkg-config pkgconfig

**Branch/Commit:** [b65b9590227626ad4392ba988fd514c113085d7b](https://github.com/sagemath/sagetrac-mirror/commit/b65b9590227626ad4392ba988fd514c113085d7b)

**Reviewer:** Martin Albrecht

**Author:** Volker Braun

Issue created by migration from https://trac.sagemath.org/ticket/16368





---

archive/issue_comments_258359.json:
```json
{
    "body": "<a id='comment:1'></a>\nWe should IMHO repurpose this ticket to either make many if not almost all packages depend on `pkgconf` (which currently also creates the `pkg-config` wrapper script in `$SAGE_LOCAL/bin/`), or to reenable setting `PKG_CONFIG_PATH` in `sage-env`.",
    "created_at": "2014-05-16T23:39:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16368#issuecomment-258359",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:1'></a>
We should IMHO repurpose this ticket to either make many if not almost all packages depend on `pkgconf` (which currently also creates the `pkg-config` wrapper script in `$SAGE_LOCAL/bin/`), or to reenable setting `PKG_CONFIG_PATH` in `sage-env`.



---

archive/issue_events_054438.json:
```json
{
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/16368",
    "label": "critical",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16368#event-54438"
}
```



---

archive/issue_comments_258360.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"pkg-config pkgconfig\".",
    "created_at": "2014-05-16T23:44:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16368#issuecomment-258360",
    "user": "https://github.com/nexttime"
}
```

**Changing keywords** from "" to "pkg-config pkgconfig".



---

archive/issue_comments_258361.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,8 +2,8 @@\n \n It can be fixed by this simple patch, which tells the configure script where to find libpng.pc.\n \n-```\n---- build/pkgs/libm4ri/spkg-install-orig        2014-05-16 18:34:53.000000000 +0000\n+```patch\n+--- build/pkgs/libm4ri/spkg-install        2014-05-16 18:34:53.000000000 +0000\n +++ build/pkgs/libm4ri/spkg-install     2014-05-16 18:48:25.000000000 +0000\n @@ -54,6 +54,7 @@\n \n``````\n",
    "created_at": "2014-05-16T23:44:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16368#issuecomment-258361",
    "user": "https://github.com/nexttime"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,8 +2,8 @@
 
 It can be fixed by this simple patch, which tells the configure script where to find libpng.pc.
 
-```
---- build/pkgs/libm4ri/spkg-install-orig        2014-05-16 18:34:53.000000000 +0000
+```patch
+--- build/pkgs/libm4ri/spkg-install        2014-05-16 18:34:53.000000000 +0000
 +++ build/pkgs/libm4ri/spkg-install     2014-05-16 18:48:25.000000000 +0000
 @@ -54,6 +54,7 @@
 
``````




---

archive/issue_comments_258362.json:
```json
{
    "body": "<a id='comment:3'></a>\nEnabling `PKG_CONFIG_PATH` would still break on OSX, we need to get the dependencies right.",
    "created_at": "2014-05-17T10:21:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16368#issuecomment-258362",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:3'></a>
Enabling `PKG_CONFIG_PATH` would still break on OSX, we need to get the dependencies right.



---

archive/issue_comments_258363.json:
```json
{
    "body": "**Branch:** [u/vbraun/pkgconf_deps](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/pkgconf_deps)",
    "created_at": "2014-05-17T19:31:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16368#issuecomment-258363",
    "user": "https://github.com/vbraun"
}
```

**Branch:** [u/vbraun/pkgconf_deps](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/pkgconf_deps)



---

archive/issue_comments_258364.json:
```json
{
    "body": "<a id='comment:5'></a>\nI've grepped the logs for \"pkg-config\" and added the relevant dependencies. \n\nAlso, whitespace fix. In fact I'm surprised that spaces before the tab in make rules are not a hard error.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b65b9590227626ad4392ba988fd514c113085d7b\">b65b959</a></td><td><code>add dependencies on pkgconf</code></td></tr></table>\n",
    "created_at": "2014-05-17T19:33:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16368#issuecomment-258364",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:5'></a>
I've grepped the logs for "pkg-config" and added the relevant dependencies. 

Also, whitespace fix. In fact I'm surprised that spaces before the tab in make rules are not a hard error.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b65b9590227626ad4392ba988fd514c113085d7b">b65b959</a></td><td><code>add dependencies on pkgconf</code></td></tr></table>




---

archive/issue_comments_258365.json:
```json
{
    "body": "**Commit:** [b65b9590227626ad4392ba988fd514c113085d7b](https://github.com/sagemath/sagetrac-mirror/commit/b65b9590227626ad4392ba988fd514c113085d7b)",
    "created_at": "2014-05-17T19:33:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16368#issuecomment-258365",
    "user": "https://github.com/vbraun"
}
```

**Commit:** [b65b9590227626ad4392ba988fd514c113085d7b](https://github.com/sagemath/sagetrac-mirror/commit/b65b9590227626ad4392ba988fd514c113085d7b)



---

archive/issue_comments_258366.json:
```json
{
    "body": "<a id='comment:6'></a>\nFull rebuild worked and now all log entries point to our pkg-config.",
    "created_at": "2014-05-17T20:30:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16368#issuecomment-258366",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:6'></a>
Full rebuild worked and now all log entries point to our pkg-config.



---

archive/issue_comments_258367.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2014-05-17T20:30:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16368#issuecomment-258367",
    "user": "https://github.com/vbraun"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_258368.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,16 +1 @@\n-When building sage-6.2 under FreeBSD, the configure script in libm4ri links to the system libpng rather than the sage libpng.  If the system libpng is a different version (e.g. in FreeBSD it is version 1.5 instead of 1.2), then many of the tests fail.\n-\n-It can be fixed by this simple patch, which tells the configure script where to find libpng.pc.\n-\n-```patch\n---- build/pkgs/libm4ri/spkg-install        2014-05-16 18:34:53.000000000 +0000\n-+++ build/pkgs/libm4ri/spkg-install     2014-05-16 18:48:25.000000000 +0000\n-@@ -54,6 +54,7 @@\n-\n- cd $ROOT_DIR/src/\n-\n-+env PKG_CONFIG_LIBDIR=$SAGE_LOCAL/lib/pkgconfig \\\n- ./configure --prefix=\"$SAGE_LOCAL\" --libdir=\"$SAGE_LOCAL/lib\" $ENABLE_DEBUG $DISABLE_SSE2\n-\n- if [ $? -ne 0 ]; then\n-```\n+We should build the pkgconf package before anything that uses pkg-config.\n``````\n",
    "created_at": "2014-05-17T20:34:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16368#issuecomment-258368",
    "user": "https://github.com/vbraun"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,16 +1 @@
-When building sage-6.2 under FreeBSD, the configure script in libm4ri links to the system libpng rather than the sage libpng.  If the system libpng is a different version (e.g. in FreeBSD it is version 1.5 instead of 1.2), then many of the tests fail.
-
-It can be fixed by this simple patch, which tells the configure script where to find libpng.pc.
-
-```patch
---- build/pkgs/libm4ri/spkg-install        2014-05-16 18:34:53.000000000 +0000
-+++ build/pkgs/libm4ri/spkg-install     2014-05-16 18:48:25.000000000 +0000
-@@ -54,6 +54,7 @@
-
- cd $ROOT_DIR/src/
-
-+env PKG_CONFIG_LIBDIR=$SAGE_LOCAL/lib/pkgconfig \
- ./configure --prefix="$SAGE_LOCAL" --libdir="$SAGE_LOCAL/lib" $ENABLE_DEBUG $DISABLE_SSE2
-
- if [ $? -ne 0 ]; then
-```
+We should build the pkgconf package before anything that uses pkg-config.
``````




---

archive/issue_comments_258369.json:
```json
{
    "body": "**Author:** Volker Braun",
    "created_at": "2014-05-17T20:34:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16368#issuecomment-258369",
    "user": "https://github.com/vbraun"
}
```

**Author:** Volker Braun



---

archive/issue_events_054439.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/16368",
    "rename": {
        "from": "Build of libm4ri autodetects system libpng instead of sage libpng",
        "to": "Missing pkgconf dependencies"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16368#event-54439"
}
```



---

archive/issue_events_054440.json:
```json
{
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/16368",
    "label": "critical",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16368#event-54440"
}
```



---

archive/issue_comments_258370.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2014-05-23T15:21:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16368#issuecomment-258370",
    "user": "https://github.com/malb"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_258371.json:
```json
{
    "body": "<a id='comment:9'></a>\nLooks okay to me.",
    "created_at": "2014-05-23T15:21:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16368#issuecomment-258371",
    "user": "https://github.com/malb"
}
```

<a id='comment:9'></a>
Looks okay to me.



---

archive/issue_comments_258372.json:
```json
{
    "body": "**Reviewer:** Martin Albrecht",
    "created_at": "2014-05-23T16:02:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16368#issuecomment-258372",
    "user": "https://github.com/vbraun"
}
```

**Reviewer:** Martin Albrecht



---

archive/issue_comments_258373.json:
```json
{
    "body": "<a id='comment:11'></a>\nShould ncurses install .pc files in `SAGE_LOCAL/lib/pkgconfig`? If that's a good idea, I can create a followup ticket to do that.",
    "created_at": "2014-05-23T17:28:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16368#issuecomment-258373",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:11'></a>
Should ncurses install .pc files in `SAGE_LOCAL/lib/pkgconfig`? If that's a good idea, I can create a followup ticket to do that.



---

archive/issue_comments_258374.json:
```json
{
    "body": "<a id='comment:12'></a>\nYes, please do!",
    "created_at": "2014-05-23T17:56:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16368#issuecomment-258374",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:12'></a>
Yes, please do!



---

archive/issue_comments_258375.json:
```json
{
    "body": "<a id='comment:13'></a>\nSee #16392.",
    "created_at": "2014-05-23T23:04:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16368#issuecomment-258375",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:13'></a>
See #16392.



---

archive/issue_events_054441.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-05-25T10:09:22Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16368",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16368#event-54441"
}
```



---

archive/issue_comments_258376.json:
```json
{
    "body": "**Changing branch** from \"[u/vbraun/pkgconf_deps](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/pkgconf_deps)\" to \"[b65b9590227626ad4392ba988fd514c113085d7b](https://github.com/sagemath/sagetrac-mirror/commit/b65b9590227626ad4392ba988fd514c113085d7b)\".",
    "created_at": "2014-05-25T10:09:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16368#issuecomment-258376",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/vbraun/pkgconf_deps](https://github.com/sagemath/sagetrac-mirror/tree/u/vbraun/pkgconf_deps)" to "[b65b9590227626ad4392ba988fd514c113085d7b](https://github.com/sagemath/sagetrac-mirror/commit/b65b9590227626ad4392ba988fd514c113085d7b)".
