# Issue 16454: Update openssl package to latest version.

archive/issues_016217.json:
```json
{
    "body": "The current (optional) openssl package we ship is still 1.0.1e, which is heartbleed vulnerable, let us update it to latest version.\n\nLink to the latest tarball is https://www.openssl.org/source/openssl-1.0.1h.tar.gz\n\n\nCC:  @jhpalmieri mariah @williamstein\n\nReviewer: S\u00e9bastien Labb\u00e9\n\nAuthor: Thierry Monteil\n\nBranch: f8701162940876cc82278d1802c09fb3ec3a2901\n\nCommit: f8701162940876cc82278d1802c09fb3ec3a2901\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/16454\n\n",
    "closed_at": "2014-07-03T12:41:32Z",
    "created_at": "2014-06-07T12:11:58Z",
    "labels": [
        "component: packages: optional",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.3",
    "title": "Update openssl package to latest version.",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16454",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```
The current (optional) openssl package we ship is still 1.0.1e, which is heartbleed vulnerable, let us update it to latest version.

Link to the latest tarball is https://www.openssl.org/source/openssl-1.0.1h.tar.gz


CC:  @jhpalmieri mariah @williamstein

Reviewer: Sébastien Labbé

Author: Thierry Monteil

Branch: f8701162940876cc82278d1802c09fb3ec3a2901

Commit: f8701162940876cc82278d1802c09fb3ec3a2901

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/16454





---

archive/issue_comments_211629.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2014-06-07T12:13:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16454#issuecomment-211629",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_211630.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to packages: optional.",
    "created_at": "2014-06-07T12:13:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16454#issuecomment-211630",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Changing component from PLEASE CHANGE to packages: optional.



---

archive/issue_comments_211631.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-06-07T12:48:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16454#issuecomment-211631",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_211632.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2014-06-07T12:48:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16454#issuecomment-211632",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Changing priority from major to critical.



---

archive/issue_comments_211633.json:
```json
{
    "body": "<a id='comment:4'></a>New commits:",
    "created_at": "2014-06-07T12:48:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16454#issuecomment-211633",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:4'></a>New commits:



---

archive/issue_comments_211634.json:
```json
{
    "body": "<a id='comment:5'></a>Why do you delete the changelog part?",
    "created_at": "2014-06-10T18:51:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16454#issuecomment-211634",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:5'></a>Why do you delete the changelog part?



---

archive/issue_comments_211635.json:
```json
{
    "body": "<a id='comment:6'></a>See http://www.sagemath.org/doc/developer/packaging.html#the-spkg-txt-file (last sentence) and https://groups.google.com/forum/#!searchin/sage-devel/numpy/sage-devel/FNjYGRCxaUc/WDKM0pM9QJYJ\n\nBy the way, could you check whether the `Configure.patch` is still needed for Darwin (looks like the same `-arch` fix as in `pyzmq`) ?",
    "created_at": "2014-06-10T19:17:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16454#issuecomment-211635",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:6'></a>See http://www.sagemath.org/doc/developer/packaging.html#the-spkg-txt-file (last sentence) and https://groups.google.com/forum/#!searchin/sage-devel/numpy/sage-devel/FNjYGRCxaUc/WDKM0pM9QJYJ

By the way, could you check whether the `Configure.patch` is still needed for Darwin (looks like the same `-arch` fix as in `pyzmq`) ?



---

archive/issue_comments_211636.json:
```json
{
    "body": "<a id='comment:7'></a>With the current branch, running `./sage -i openssl` on my (32bit) machine ends with the following error:\n\n```\nFound local metadata for openssl-1.0.1h\nFound local sources at /Users/slabbe/Applications/sage-review/upstream/openssl-1.0.1h.tar.gz\nChecksum: 8d6d684a9430d5cc98a62a5d8fbda8cf vs 8d6d684a9430d5cc98a62a5d8fbda8cf\nopenssl-1.0.1h\n====================================================\nSetting up build directory for openssl-1.0.1h\nFinished set up\n****************************************************\nHost system:\nDarwin pol 9.8.0 Darwin Kernel Version 9.8.0: Wed Jul 15 16:55:01 PDT 2009; root:xnu-1228.15.4~1/RELEASE_I386 i386\n****************************************************\nC compiler: gcc\nC compiler version:\nUsing built-in specs.\nCOLLECT_GCC=/Users/slabbe/Applications/sage-review/local/bin/gcc\nCOLLECT_LTO_WRAPPER=/Users/slabbe/Applications/sage-review/local/libexec/gcc/i386-apple-darwin9.8.0/4.7.3/lto-wrapper\nTarget: i386-apple-darwin9.8.0\nConfigured with: ../src/configure --prefix=/Users/slabbe/Applications/sage-review/local --with-local-prefix=/Users/slabbe/Applications/sage-review/local --with-gmp=/Users/slabbe/Applications/sage-review/local --with-mpfr=/Users/slabbe/Applications/sage-review/local --with-mpc=/Users/slabbe/Applications/sage-review/local --with-system-zlib --disable-multilib --disable-nls  \nThread model: posix\ngcc version 4.7.3 (GCC) \n****************************************************\n\n[...]\nConfigured for darwin64-x86_64-cc.\n[...]\nx86_64cpuid.s:85:`movzbq' is only supported in 64-bit mode\n[...]\nx86_64cpuid.s:209:bad register name `%xmm14'\nx86_64cpuid.s:210:bad register name `%xmm15'\nx86_64cpuid.s:211:bad register name `%rcx'\nx86_64cpuid.s:212:bad register name `%rdx'\nx86_64cpuid.s:213:bad register name `%rsi'\nx86_64cpuid.s:214:bad register name `%rdi'\nx86_64cpuid.s:215:bad register name `%r8'\nx86_64cpuid.s:216:bad register name `%r9'\nx86_64cpuid.s:217:bad register name `%r10'\nx86_64cpuid.s:218:bad register name `%r11'\nx86_64cpuid.s:219:bad register name `%rsp)'\nx86_64cpuid.s:232:bad register name `%rax'\nx86_64cpuid.s:233:bad register name `%rcx'\nmake[1]: *** [x86_64cpuid.o] Error 1\nmake: *** [build_crypto] Error 1\nError building openssl.\n\nreal\t0m8.937s\nuser\t0m3.822s\nsys\t0m1.561s\n************************************************************************\nError installing package openssl-1.0.1h\n************************************************************************\n```\n\nAs you suggested me, I tried after deleting the `Configure.patch`, and it worked:\n\n```\n$ ./sage -i openssl\n\n[...]\n\nreal\t4m9.688s\nuser\t2m47.278s\nsys\t0m49.557s\nSuccessfully installed openssl-1.0.1h\n```\n\nHere is my git status:\n\n```\n10 slabbe@pol ~/Applications/sage-review $ git status\n# On branch t/16454\n# Changes not staged for commit:\n#   (use \"git add/rm <file>...\" to update what will be committed)\n#   (use \"git checkout -- <file>...\" to discard changes in working directory)\n#\n#\tdeleted:    build/pkgs/openssl/patches/Configure.patch\n#\nno changes added to commit (use \"git add\" and/or \"git commit -a\")\n```",
    "created_at": "2014-06-10T20:23:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16454#issuecomment-211636",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:7'></a>With the current branch, running `./sage -i openssl` on my (32bit) machine ends with the following error:

```
Found local metadata for openssl-1.0.1h
Found local sources at /Users/slabbe/Applications/sage-review/upstream/openssl-1.0.1h.tar.gz
Checksum: 8d6d684a9430d5cc98a62a5d8fbda8cf vs 8d6d684a9430d5cc98a62a5d8fbda8cf
openssl-1.0.1h
====================================================
Setting up build directory for openssl-1.0.1h
Finished set up
****************************************************
Host system:
Darwin pol 9.8.0 Darwin Kernel Version 9.8.0: Wed Jul 15 16:55:01 PDT 2009; root:xnu-1228.15.4~1/RELEASE_I386 i386
****************************************************
C compiler: gcc
C compiler version:
Using built-in specs.
COLLECT_GCC=/Users/slabbe/Applications/sage-review/local/bin/gcc
COLLECT_LTO_WRAPPER=/Users/slabbe/Applications/sage-review/local/libexec/gcc/i386-apple-darwin9.8.0/4.7.3/lto-wrapper
Target: i386-apple-darwin9.8.0
Configured with: ../src/configure --prefix=/Users/slabbe/Applications/sage-review/local --with-local-prefix=/Users/slabbe/Applications/sage-review/local --with-gmp=/Users/slabbe/Applications/sage-review/local --with-mpfr=/Users/slabbe/Applications/sage-review/local --with-mpc=/Users/slabbe/Applications/sage-review/local --with-system-zlib --disable-multilib --disable-nls  
Thread model: posix
gcc version 4.7.3 (GCC) 
****************************************************

[...]
Configured for darwin64-x86_64-cc.
[...]
x86_64cpuid.s:85:`movzbq' is only supported in 64-bit mode
[...]
x86_64cpuid.s:209:bad register name `%xmm14'
x86_64cpuid.s:210:bad register name `%xmm15'
x86_64cpuid.s:211:bad register name `%rcx'
x86_64cpuid.s:212:bad register name `%rdx'
x86_64cpuid.s:213:bad register name `%rsi'
x86_64cpuid.s:214:bad register name `%rdi'
x86_64cpuid.s:215:bad register name `%r8'
x86_64cpuid.s:216:bad register name `%r9'
x86_64cpuid.s:217:bad register name `%r10'
x86_64cpuid.s:218:bad register name `%r11'
x86_64cpuid.s:219:bad register name `%rsp)'
x86_64cpuid.s:232:bad register name `%rax'
x86_64cpuid.s:233:bad register name `%rcx'
make[1]: *** [x86_64cpuid.o] Error 1
make: *** [build_crypto] Error 1
Error building openssl.

real	0m8.937s
user	0m3.822s
sys	0m1.561s
************************************************************************
Error installing package openssl-1.0.1h
************************************************************************
```

As you suggested me, I tried after deleting the `Configure.patch`, and it worked:

```
$ ./sage -i openssl

[...]

real	4m9.688s
user	2m47.278s
sys	0m49.557s
Successfully installed openssl-1.0.1h
```

Here is my git status:

```
10 slabbe@pol ~/Applications/sage-review $ git status
# On branch t/16454
# Changes not staged for commit:
#   (use "git add/rm <file>..." to update what will be committed)
#   (use "git checkout -- <file>..." to discard changes in working directory)
#
#	deleted:    build/pkgs/openssl/patches/Configure.patch
#
no changes added to commit (use "git add" and/or "git commit -a")
```



---

archive/issue_comments_211637.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-06-11T09:38:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16454#issuecomment-211637",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_211638.json:
```json
{
    "body": "<a id='comment:9'></a>Thanks for testing, so i removed `Configure.patch`. Could you also try if tests work without the patch:\n\n```\nexport SAGE_CHECK='yes'\nsage -f openssl\n```",
    "created_at": "2014-06-11T09:42:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16454#issuecomment-211638",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:9'></a>Thanks for testing, so i removed `Configure.patch`. Could you also try if tests work without the patch:

```
export SAGE_CHECK='yes'
sage -f openssl
```



---

archive/issue_comments_211639.json:
```json
{
    "body": "<a id='comment:10'></a>\n```\n$ export SAGE_CHECK='yes'\n$ ./sage -f openssl\n\n[...]\n\nreal\t1m34.519s\nuser\t0m16.406s\nsys\t0m18.216s\nSuccessfully installed openssl-1.0.1h\nRunning the test suite for openssl-1.0.1h...\n\n[...]\n\ndata content test streaming PEM format: OK\nencrypted content test streaming PEM format, 128 bit RC2 key: OK\nencrypted content test streaming PEM format, 40 bit RC2 key: OK\nencrypted content test streaming PEM format, triple DES key: OK\nencrypted content test streaming PEM format, 128 bit AES key: OK\nZlib not supported: compression tests skipped\nALL TESTS SUCCESSFUL.\n../util/shlib_wrap.sh ./heartbeat_test\nOPENSSL_CONF=apps/openssl.cnf util/opensslwrap.sh version -a\nOpenSSL 1.0.1h 5 Jun 2014\nbuilt on: Fri Jun 13 10:36:56 CEST 2014\nplatform: darwin64-x86_64-cc\noptions:  bn(64,64) rc4(ptr,char) des(idx,cisc,16,int) idea(int) blowfish(idx) \ncompiler: gcc -fPIC -fno-common -DOPENSSL_PIC -DOPENSSL_THREADS -D_REENTRANT -DDSO_DLFCN -DHAVE_DLFCN_H -arch x86_64 -O3 -DL_ENDIAN -Wall -DOPENSSL_IA32_SSE2 -DOPENSSL_BN_ASM_MONT -DOPENSSL_BN_ASM_MONT5 -DOPENSSL_BN_ASM_GF2m -DSHA1_ASM -DSHA256_ASM -DSHA512_ASM -DMD5_ASM -DAES_ASM -DVPAES_ASM -DBSAES_ASM -DWHIRLPOOL_ASM -DGHASH_ASM\nOPENSSLDIR: \"/Users/slabbe/Applications/sage-review/local/openssl\"\n\nreal\t1m17.717s\nuser\t0m40.606s\nsys\t0m31.799s\nDeleting temporary build directory\n/Users/slabbe/Applications/sage-review/local/var/tmp/sage/build/openssl-1.0.1h\nFinished installing openssl-1.0.1h.spkg\n```\n\nIt works! ... on my old 32 bit machine. For me it is a positive review. Do jhpalmieri, mariah or \u200bwas want to double check on other machine before closing this ticket?",
    "created_at": "2014-06-13T08:50:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16454#issuecomment-211639",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:10'></a>
```
$ export SAGE_CHECK='yes'
$ ./sage -f openssl

[...]

real	1m34.519s
user	0m16.406s
sys	0m18.216s
Successfully installed openssl-1.0.1h
Running the test suite for openssl-1.0.1h...

[...]

data content test streaming PEM format: OK
encrypted content test streaming PEM format, 128 bit RC2 key: OK
encrypted content test streaming PEM format, 40 bit RC2 key: OK
encrypted content test streaming PEM format, triple DES key: OK
encrypted content test streaming PEM format, 128 bit AES key: OK
Zlib not supported: compression tests skipped
ALL TESTS SUCCESSFUL.
../util/shlib_wrap.sh ./heartbeat_test
OPENSSL_CONF=apps/openssl.cnf util/opensslwrap.sh version -a
OpenSSL 1.0.1h 5 Jun 2014
built on: Fri Jun 13 10:36:56 CEST 2014
platform: darwin64-x86_64-cc
options:  bn(64,64) rc4(ptr,char) des(idx,cisc,16,int) idea(int) blowfish(idx) 
compiler: gcc -fPIC -fno-common -DOPENSSL_PIC -DOPENSSL_THREADS -D_REENTRANT -DDSO_DLFCN -DHAVE_DLFCN_H -arch x86_64 -O3 -DL_ENDIAN -Wall -DOPENSSL_IA32_SSE2 -DOPENSSL_BN_ASM_MONT -DOPENSSL_BN_ASM_MONT5 -DOPENSSL_BN_ASM_GF2m -DSHA1_ASM -DSHA256_ASM -DSHA512_ASM -DMD5_ASM -DAES_ASM -DVPAES_ASM -DBSAES_ASM -DWHIRLPOOL_ASM -DGHASH_ASM
OPENSSLDIR: "/Users/slabbe/Applications/sage-review/local/openssl"

real	1m17.717s
user	0m40.606s
sys	0m31.799s
Deleting temporary build directory
/Users/slabbe/Applications/sage-review/local/var/tmp/sage/build/openssl-1.0.1h
Finished installing openssl-1.0.1h.spkg
```

It works! ... on my old 32 bit machine. For me it is a positive review. Do jhpalmieri, mariah or ​was want to double check on other machine before closing this ticket?



---

archive/issue_comments_211640.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-07-01T13:56:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16454#issuecomment-211640",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_211641.json:
```json
{
    "body": "<a id='comment:12'></a>Reviewer name",
    "created_at": "2014-07-02T00:34:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16454#issuecomment-211641",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:12'></a>Reviewer name



---

archive/issue_comments_211642.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2014-07-02T00:34:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16454#issuecomment-211642",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_211643.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2014-07-02T14:49:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16454#issuecomment-211643",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_211644.json:
```json
{
    "body": "<a id='comment:14'></a>Sorry, my bad.\n\nS\u00e9bastien",
    "created_at": "2014-07-02T14:49:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16454#issuecomment-211644",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:14'></a>Sorry, my bad.

Sébastien



---

archive/issue_events_048380.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-07-03T12:41:32Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16454",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16454#event-48380"
}
```



---

archive/issue_comments_211645.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-07-03T12:41:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16454#issuecomment-211645",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
