# Issue 16671: implement harmonic number function H(n,m)

archive/issues_016434.json:
```json
{
    "assignees": [],
    "body": "H(n,m) belongs to the holonomic repertoir and should be available in Sage, both numerically and symbolically. For some info, see https://groups.google.com/forum/#!topic/sage-devel/uaA0yU7dZHU and https://en.wikipedia.org/wiki/Harmonic_number\n\nThis is actually a defect because we leave a Maxima result undefined:\n\n```\nsage: sum(1/k^3,k,1,n)\ngen_harmonic_number(3, n)\nsage: gen_harmonic_number?\nObject `gen_harmonic_number` not found.\n```\n\n\nCC:  @eviatarbach @dkrenn\n\nKeywords: **special, log**\n\nBranch/Commit: **[`9042104`](https://github.com/sagemath/sagetrac-mirror/commit/9042104196f2d3b9822b3827aa2bbd70097f7b95)**\n\nReviewer: **Ralf Stephan, Armin Straub**\n\nAuthor: **Ralf Stephan, Armin Straub**\n\nComponent: **symbolics**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/16671_\n\n",
    "closed_at": "2016-08-21T13:14:00Z",
    "created_at": "2014-07-17T16:03:35Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "implement harmonic number function H(n,m)",
    "type": "issue",
    "updated_at": "2016-08-21T13:14:00Z",
    "url": "https://github.com/sagemath/sage/issues/16671",
    "user": "https://github.com/rwst"
}
```
H(n,m) belongs to the holonomic repertoir and should be available in Sage, both numerically and symbolically. For some info, see https://groups.google.com/forum/#!topic/sage-devel/uaA0yU7dZHU and https://en.wikipedia.org/wiki/Harmonic_number

This is actually a defect because we leave a Maxima result undefined:

```
sage: sum(1/k^3,k,1,n)
gen_harmonic_number(3, n)
sage: gen_harmonic_number?
Object `gen_harmonic_number` not found.
```


CC:  @eviatarbach @dkrenn

Keywords: **special, log**

Branch/Commit: **[`9042104`](https://github.com/sagemath/sagetrac-mirror/commit/9042104196f2d3b9822b3827aa2bbd70097f7b95)**

Reviewer: **Ralf Stephan, Armin Straub**

Author: **Ralf Stephan, Armin Straub**

Component: **symbolics**

_Issue created by migration from https://trac.sagemath.org/ticket/16671_





---

archive/issue_events_236161.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-07-17T16:03:35Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-236161"
}
```



---

archive/issue_events_236162.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-07-17T16:03:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
    "label_color": "0000ff",
    "label_name": "c: symbolics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-236162"
}
```



---

archive/issue_events_236163.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-07-17T16:03:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-236163"
}
```



---

archive/issue_events_236164.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-07-17T16:03:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-236164"
}
```



---

archive/issue_comments_217686.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nFor exact values, FLINT has arith_harmonic_number()",
    "created_at": "2014-07-17T16:37:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217686",
    "user": "https://github.com/fredrik-johansson"
}
```

<div id="comment:1" align="right">comment:1</div>

For exact values, FLINT has arith_harmonic_number()



---

archive/issue_comments_217687.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nReplying to [@fredrik-johansson](#comment%3A1):\n> For exact values, FLINT has arith_harmonic_number()\n\nUnfortunately, neither FLINT nor mpmath implements the generalized H(m,n) returned by Maxima in the code example.",
    "created_at": "2014-07-26T13:54:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217687",
    "user": "https://github.com/rwst"
}
```

<div id="comment:2" align="right">comment:2</div>

Replying to [@fredrik-johansson](#comment%3A1):
> For exact values, FLINT has arith_harmonic_number()

Unfortunately, neither FLINT nor mpmath implements the generalized H(m,n) returned by Maxima in the code example.



---

archive/issue_comments_217688.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,11 @@\n H_n belongs to the holonomic repertoir and should be available in Sage, both numerically and symbolically. For some info, see https://groups.google.com/forum/#!topic/sage-devel/uaA0yU7dZHU and https://en.wikipedia.org/wiki/Harmonic_number\n+\n+This is actually a defect because we leave a Maxima result undefined:\n+\n+```\n+sage: sum(1/k^3,k,1,n)\n+gen_harmonic_number(3, n)\n+sage: gen_harmonic_number?\n+Object `gen_harmonic_number` not found.\n+```\n+\n``````\n",
    "created_at": "2014-07-26T13:54:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217688",
    "user": "https://github.com/rwst"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,11 @@
 H_n belongs to the holonomic repertoir and should be available in Sage, both numerically and symbolically. For some info, see https://groups.google.com/forum/#!topic/sage-devel/uaA0yU7dZHU and https://en.wikipedia.org/wiki/Harmonic_number
+
+This is actually a defect because we leave a Maxima result undefined:
+
+```
+sage: sum(1/k^3,k,1,n)
+gen_harmonic_number(3, n)
+sage: gen_harmonic_number?
+Object `gen_harmonic_number` not found.
+```
+
``````




---

archive/issue_events_236165.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-07-26T13:54:54Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "title_is": "implement harmonic number function H(n,m)",
    "title_was": "implement harmonic number function H_n",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-236165"
}
```



---

archive/issue_comments_217689.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-H_n belongs to the holonomic repertoir and should be available in Sage, both numerically and symbolically. For some info, see https://groups.google.com/forum/#!topic/sage-devel/uaA0yU7dZHU and https://en.wikipedia.org/wiki/Harmonic_number\n+H(n,m) belongs to the holonomic repertoir and should be available in Sage, both numerically and symbolically. For some info, see https://groups.google.com/forum/#!topic/sage-devel/uaA0yU7dZHU and https://en.wikipedia.org/wiki/Harmonic_number\n \n This is actually a defect because we leave a Maxima result undefined:\n \n``````\n",
    "created_at": "2014-07-26T13:55:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217689",
    "user": "https://github.com/rwst"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-H_n belongs to the holonomic repertoir and should be available in Sage, both numerically and symbolically. For some info, see https://groups.google.com/forum/#!topic/sage-devel/uaA0yU7dZHU and https://en.wikipedia.org/wiki/Harmonic_number
+H(n,m) belongs to the holonomic repertoir and should be available in Sage, both numerically and symbolically. For some info, see https://groups.google.com/forum/#!topic/sage-devel/uaA0yU7dZHU and https://en.wikipedia.org/wiki/Harmonic_number
 
 This is actually a defect because we leave a Maxima result undefined:
 
``````




---

archive/issue_events_236166.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-07-26T13:55:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-236166"
}
```



---

archive/issue_events_236167.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-07-26T13:55:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-236167"
}
```



---

archive/issue_comments_217690.json:
```json
{
    "body": "Branch: **[u/rws/implement_harmonic_number_function_h_n_m_](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/implement_harmonic_number_function_h_n_m_)**",
    "created_at": "2014-07-27T16:04:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217690",
    "user": "https://github.com/rwst"
}
```

Branch: **[u/rws/implement_harmonic_number_function_h_n_m_](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/implement_harmonic_number_function_h_n_m_)**



---

archive/issue_events_236168.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-07-27T16:06:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-236168"
}
```



---

archive/issue_comments_217691.json:
```json
{
    "body": "Commit: **[`5310ca1`](https://github.com/sagemath/sagetrac-mirror/commit/5310ca10a440c2536da3f043deba80f5c35d041a)**",
    "created_at": "2014-07-27T16:06:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217691",
    "user": "https://github.com/rwst"
}
```

Commit: **[`5310ca1`](https://github.com/sagemath/sagetrac-mirror/commit/5310ca10a440c2536da3f043deba80f5c35d041a)**



---

archive/issue_comments_217692.json:
```json
{
    "body": "Author: **Ralf Stephan**",
    "created_at": "2014-07-27T16:06:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217692",
    "user": "https://github.com/rwst"
}
```

Author: **Ralf Stephan**



---

archive/issue_comments_217693.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nIt is already implemented, I'm just waiting for https://groups.google.com/forum/?hl=en#!topic/sage-devel/SM_FLL33t2g as to argument order of the generalized version.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5310ca10a440c2536da3f043deba80f5c35d041a\"><code>5310ca1</code></a></td><td><code>16671: implement harmonic number function H(n,m) (modulo argument order)</code></td></tr></table>\n",
    "created_at": "2014-07-27T16:06:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217693",
    "user": "https://github.com/rwst"
}
```

<div id="comment:5" align="right">comment:5</div>

It is already implemented, I'm just waiting for https://groups.google.com/forum/?hl=en#!topic/sage-devel/SM_FLL33t2g as to argument order of the generalized version.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5310ca10a440c2536da3f043deba80f5c35d041a"><code>5310ca1</code></a></td><td><code>16671: implement harmonic number function H(n,m) (modulo argument order)</code></td></tr></table>




---

archive/issue_comments_217694.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@rwst](#comment%3A5):\n> It is already implemented, I'm just waiting for https://groups.google.com/forum/?hl=en#!topic/sage-devel/SM_FLL33t2g as to argument order of the generalized version.\n> \n> ---\n> New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5310ca10a440c2536da3f043deba80f5c35d041a\"><code>5310ca1</code></a></td><td><code>16671: implement harmonic number function H(n,m) (modulo argument order)</code></td></tr></table>\n\nFor `maxima_lib` you definitely have to implement a special conversion rule (in both `special_max_to_sage` and `special_sage_to_max`). It'll be a very simple conversion rule, though, so it should be quick to write. There are plenty of examples of entries there already that have to do more complicated manipulations, so just swapping arguments will be easy to figure out.\n\nFor conversions to other maxima interfaces a good start may the special examples in `maxima_lib`. It seems that implementing `_maxima_init_evaled_` might do the trick for conversion to maxima.\n\nThe workhorse for the other direction is `sage.calculus.calculus.symbolic_expression_from_maxima_string` which defines regexes for `polylog` etc., so it seems that any special conversion rules would need to be added there.\n\nYour conversion is not *that* strange though. You just need to swap arguments, which means no special conversion at all as long as you can get it converted to a sage function that expects the arguments in the required order and produces the desired symbolic expression.\n\nIt seems that as long as you can get an entry into `sage.symbolic.pynac.symbol_table.get('maxima', {})` that has a argument-swapping function associated with it, you might be good to go. `sage.symbolic.pynac.register_symbol` might do the trick for that.",
    "created_at": "2014-07-27T18:32:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217694",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@rwst](#comment%3A5):
> It is already implemented, I'm just waiting for https://groups.google.com/forum/?hl=en#!topic/sage-devel/SM_FLL33t2g as to argument order of the generalized version.
> 
> ---
> New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5310ca10a440c2536da3f043deba80f5c35d041a"><code>5310ca1</code></a></td><td><code>16671: implement harmonic number function H(n,m) (modulo argument order)</code></td></tr></table>

For `maxima_lib` you definitely have to implement a special conversion rule (in both `special_max_to_sage` and `special_sage_to_max`). It'll be a very simple conversion rule, though, so it should be quick to write. There are plenty of examples of entries there already that have to do more complicated manipulations, so just swapping arguments will be easy to figure out.

For conversions to other maxima interfaces a good start may the special examples in `maxima_lib`. It seems that implementing `_maxima_init_evaled_` might do the trick for conversion to maxima.

The workhorse for the other direction is `sage.calculus.calculus.symbolic_expression_from_maxima_string` which defines regexes for `polylog` etc., so it seems that any special conversion rules would need to be added there.

Your conversion is not *that* strange though. You just need to swap arguments, which means no special conversion at all as long as you can get it converted to a sage function that expects the arguments in the required order and produces the desired symbolic expression.

It seems that as long as you can get an entry into `sage.symbolic.pynac.symbol_table.get('maxima', {})` that has a argument-swapping function associated with it, you might be good to go. `sage.symbolic.pynac.register_symbol` might do the trick for that.



---

archive/issue_comments_217695.json:
```json
{
    "body": "Changed commit from **[`5310ca1`](https://github.com/sagemath/sagetrac-mirror/commit/5310ca10a440c2536da3f043deba80f5c35d041a)** to **[`ebc93ec`](https://github.com/sagemath/sagetrac-mirror/commit/ebc93ecacf652b5b83077ba20c22b37f8178ca78)**",
    "created_at": "2014-07-28T09:05:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217695",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`5310ca1`](https://github.com/sagemath/sagetrac-mirror/commit/5310ca10a440c2536da3f043deba80f5c35d041a)** to **[`ebc93ec`](https://github.com/sagemath/sagetrac-mirror/commit/ebc93ecacf652b5b83077ba20c22b37f8178ca78)**



---

archive/issue_comments_217696.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/61572c9a3a2e0a1a812fb97d95dc4a992700334b\"><code>61572c9</code></a></td><td><code>16671: swap arguments wrt maxima(_lib); add more documentation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ebc93ecacf652b5b83077ba20c22b37f8178ca78\"><code>ebc93ec</code></a></td><td><code>16671: fix doc typo</code></td></tr></table>\n",
    "created_at": "2014-07-28T09:05:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217696",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/61572c9a3a2e0a1a812fb97d95dc4a992700334b"><code>61572c9</code></a></td><td><code>16671: swap arguments wrt maxima(_lib); add more documentation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ebc93ecacf652b5b83077ba20c22b37f8178ca78"><code>ebc93ec</code></a></td><td><code>16671: fix doc typo</code></td></tr></table>




---

archive/issue_comments_217697.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nThanks, that was absolutely helpful. I'll put a link on the symbolics wiki page.\n\nPlease review.",
    "created_at": "2014-07-28T09:08:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217697",
    "user": "https://github.com/rwst"
}
```

<div id="comment:8" align="right">comment:8</div>

Thanks, that was absolutely helpful. I'll put a link on the symbolics wiki page.

Please review.



---

archive/issue_comments_217698.json:
```json
{
    "body": "Changed keywords from none to **special, log**",
    "created_at": "2014-07-28T09:08:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217698",
    "user": "https://github.com/rwst"
}
```

Changed keywords from none to **special, log**



---

archive/issue_events_236169.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-07-28T09:08:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-236169"
}
```



---

archive/issue_events_236170.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-07-28T09:08:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-236170"
}
```



---

archive/issue_comments_217699.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nA few remarks.\n- in the `maxima_harmonic` regular expression you seem to be trying to find the argument by matching subexpressions. I'm afraid that won't work reliably. If you put in arguments that use parentheses and commas itself and you'll find the regex gets it wrong. Indeed, the example you've taken it from is equally broken:\n\n```\nsage: maxima_calculus(psi(psi(x,x),x))._sage_()\nTypeError: unable to make sense of Maxima expression 'psi[psi(x,x)](x)' in Sage\n```\n(never mind that this is a ValueError and not a TypeError). The maxima_lib specific translator does not have trouble with this:\n\n```\nsage: max_to_sr(maxima_calculus(psi(psi(x,x),x)).ecl())\npsi(psi(x, x), x)\n```\nRegular languages are not sufficient to describe expression languages (the nested parentheses can't be expressed in a regular language--they need a stack or something similar). Can't you get that conversion by giving an appropriate `sage.symbolic.pynac.register_symbol`? then you get to use the parentheses parser that is already in place.\n\n- for this line, you took a way too complicated example.\n\n```\nsage.functions.log.harmonic_number : lambda N,X : [[mqapply],[[max_harmo, max_array],X],N],\n```\nfrom\n\n```\nsage: maxima_calculus(\"gen_harmonic_number(a,b)\").ecl()\n<ECL: (($GEN_HARMONIC_NUMBER SIMP) $A $B)>\n```\nyou see that this should simply be\n\n```\nsage.functions.log.harmonic_number : lambda N,X : [[max_harmo],X,N],\n```\nWith your version one gets:\n\n```\nsage: maxima_calculus(EclObject([[\"mqapply\"],[[\"$gen_harmonic_number\",\"array\"],10],20]))\ngen_harmonic_number[10](20)\n```\nwhich is not the desired form, and you'll find this form can't be converted back either.",
    "created_at": "2014-07-28T16:19:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217699",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:9" align="right">comment:9</div>

A few remarks.
- in the `maxima_harmonic` regular expression you seem to be trying to find the argument by matching subexpressions. I'm afraid that won't work reliably. If you put in arguments that use parentheses and commas itself and you'll find the regex gets it wrong. Indeed, the example you've taken it from is equally broken:

```
sage: maxima_calculus(psi(psi(x,x),x))._sage_()
TypeError: unable to make sense of Maxima expression 'psi[psi(x,x)](x)' in Sage
```
(never mind that this is a ValueError and not a TypeError). The maxima_lib specific translator does not have trouble with this:

```
sage: max_to_sr(maxima_calculus(psi(psi(x,x),x)).ecl())
psi(psi(x, x), x)
```
Regular languages are not sufficient to describe expression languages (the nested parentheses can't be expressed in a regular language--they need a stack or something similar). Can't you get that conversion by giving an appropriate `sage.symbolic.pynac.register_symbol`? then you get to use the parentheses parser that is already in place.

- for this line, you took a way too complicated example.

```
sage.functions.log.harmonic_number : lambda N,X : [[mqapply],[[max_harmo, max_array],X],N],
```
from

```
sage: maxima_calculus("gen_harmonic_number(a,b)").ecl()
<ECL: (($GEN_HARMONIC_NUMBER SIMP) $A $B)>
```
you see that this should simply be

```
sage.functions.log.harmonic_number : lambda N,X : [[max_harmo],X,N],
```
With your version one gets:

```
sage: maxima_calculus(EclObject([["mqapply"],[["$gen_harmonic_number","array"],10],20]))
gen_harmonic_number[10](20)
```
which is not the desired form, and you'll find this form can't be converted back either.



---

archive/issue_comments_217700.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nBy the way, what's your most convincing argument to use an argument order opposite to that of maxima? I think your ordering agrees with what maple and mathematica have chosen, so it may well be that that is indeed the ordering that has most consensus. The wikipedia page is ambiguous since it lists `H_{n,m}=H_n^m=H_m(n)`. Referencing explicitly which convention we follow will make for a better motivated and more stable interface.",
    "created_at": "2014-07-28T19:50:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217700",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:10" align="right">comment:10</div>

By the way, what's your most convincing argument to use an argument order opposite to that of maxima? I think your ordering agrees with what maple and mathematica have chosen, so it may well be that that is indeed the ordering that has most consensus. The wikipedia page is ambiguous since it lists `H_{n,m}=H_n^m=H_m(n)`. Referencing explicitly which convention we follow will make for a better motivated and more stable interface.



---

archive/issue_comments_217701.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nThe paper I looked at had H_n<sup>(m)</sup>, and Wikipedia has mostly H_n,m and H_n<sup>(m)</sup>, but the paper would not be relevant. WP is, and it's listed as reference.",
    "created_at": "2014-07-28T20:01:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217701",
    "user": "https://github.com/rwst"
}
```

<div id="comment:11" align="right">comment:11</div>

The paper I looked at had H_n<sup>(m)</sup>, and Wikipedia has mostly H_n,m and H_n<sup>(m)</sup>, but the paper would not be relevant. WP is, and it's listed as reference.



---

archive/issue_comments_217702.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0b15dd1ab86552cc65d1e8d249c5ad97acb7520d\"><code>0b15dd1</code></a></td><td><code>Merge branch 'develop' into t/16671/implement_harmonic_number_function_h_n_m_</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0c93bfe4da1bd2b3a77865ae0a6878007726fff8\"><code>0c93bfe</code></a></td><td><code>16671: fix maxima_lib interface</code></td></tr></table>\n",
    "created_at": "2014-07-29T14:45:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217702",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0b15dd1ab86552cc65d1e8d249c5ad97acb7520d"><code>0b15dd1</code></a></td><td><code>Merge branch 'develop' into t/16671/implement_harmonic_number_function_h_n_m_</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0c93bfe4da1bd2b3a77865ae0a6878007726fff8"><code>0c93bfe</code></a></td><td><code>16671: fix maxima_lib interface</code></td></tr></table>




---

archive/issue_comments_217703.json:
```json
{
    "body": "Changed commit from **[`ebc93ec`](https://github.com/sagemath/sagetrac-mirror/commit/ebc93ecacf652b5b83077ba20c22b37f8178ca78)** to **[`0c93bfe`](https://github.com/sagemath/sagetrac-mirror/commit/0c93bfe4da1bd2b3a77865ae0a6878007726fff8)**",
    "created_at": "2014-07-29T14:45:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217703",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`ebc93ec`](https://github.com/sagemath/sagetrac-mirror/commit/ebc93ecacf652b5b83077ba20c22b37f8178ca78)** to **[`0c93bfe`](https://github.com/sagemath/sagetrac-mirror/commit/0c93bfe4da1bd2b3a77865ae0a6878007726fff8)**



---

archive/issue_comments_217704.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@nbruin](#comment%3A9):\n> Regular languages are not sufficient to describe expression languages (the nested parentheses can't be expressed in a regular language--they need a stack or something similar). Can't you get that conversion by giving an appropriate `sage.symbolic.pynac.register_symbol`? then you get to use the parentheses parser that is already in place.\n\nIs there ready mechanics for this? I can't find one. Do you expect me to implement it?\n> you see that this should simply be\n> \n> ```\n> sage.functions.log.harmonic_number : lambda N,X : [[max_harmo],X,N],\n> ```\n\nThanks, included.",
    "created_at": "2014-07-29T14:46:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217704",
    "user": "https://github.com/rwst"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@nbruin](#comment%3A9):
> Regular languages are not sufficient to describe expression languages (the nested parentheses can't be expressed in a regular language--they need a stack or something similar). Can't you get that conversion by giving an appropriate `sage.symbolic.pynac.register_symbol`? then you get to use the parentheses parser that is already in place.

Is there ready mechanics for this? I can't find one. Do you expect me to implement it?
> you see that this should simply be
> 
> ```
> sage.functions.log.harmonic_number : lambda N,X : [[max_harmo],X,N],
> ```

Thanks, included.



---

archive/issue_comments_217705.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@rwst](#comment%3A13):\n> Replying to [@nbruin](#comment%3A9):\n> > Can't you get that conversion by giving an appropriate `sage.symbolic.pynac.register_symbol`?\n\n> Is there ready mechanics for this? I can't find one. Do you expect me to implement it?\n\nNo, just use it. If you do `search_src(\"register_symbol\")` you get a few hits on its use. The following seems to basically work without your patch so I hope you can adjust it for your purposes:\n\n```\nsage: var('x,t,s')\n(x, t, s)\nsage: function('g')\ng\nsage: def swap(a,b): return g(b,a)\nsage: sage.symbolic.pynac.register_symbol(swap,{'maxima':'gen_harmonic_number'})\nsage: sum(1/t^2,t,1,s)\ng(s, 2)\n```\nThat way, the parsing won't be more broken than for other functions (and it seems we're doing fine for most expressions nowadays). The regex for `psi` isn't really wrong, because it specifies there should be only digits between the square brackets. It is perhaps a little overly restrictive, though:\n\n```\nsage: psi(x,s)\npsi(x, s)\nsage: maxima_calculus(psi(x,s))\npsi[x](s)\nsage: maxima_calculus(psi(x,s))._sage_()\nTypeError: unable to make sense of Maxima expression 'psi[x](s)' in Sage\nsage: from sage.interfaces.maxima_lib import max_to_sr\nsage: max_to_sr(maxima_calculus(psi(x,s)).ecl()) #this doesn't rely on parsing or regexes\npsi(x, s)\n```\nI think \"parsing\" psi via regex was just a quick fix around the fact that the expression parser doesn't know what to do with square brackets (and since they're rare, you can get away with not really parsing them properly). In your case, round brackets are so common that you'll quickly get caught if you don't deal with them properly. Luckily, the parser knows how to deal with them, you just have to swap the arguments.",
    "created_at": "2014-07-29T15:33:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217705",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@rwst](#comment%3A13):
> Replying to [@nbruin](#comment%3A9):
> > Can't you get that conversion by giving an appropriate `sage.symbolic.pynac.register_symbol`?

> Is there ready mechanics for this? I can't find one. Do you expect me to implement it?

No, just use it. If you do `search_src("register_symbol")` you get a few hits on its use. The following seems to basically work without your patch so I hope you can adjust it for your purposes:

```
sage: var('x,t,s')
(x, t, s)
sage: function('g')
g
sage: def swap(a,b): return g(b,a)
sage: sage.symbolic.pynac.register_symbol(swap,{'maxima':'gen_harmonic_number'})
sage: sum(1/t^2,t,1,s)
g(s, 2)
```
That way, the parsing won't be more broken than for other functions (and it seems we're doing fine for most expressions nowadays). The regex for `psi` isn't really wrong, because it specifies there should be only digits between the square brackets. It is perhaps a little overly restrictive, though:

```
sage: psi(x,s)
psi(x, s)
sage: maxima_calculus(psi(x,s))
psi[x](s)
sage: maxima_calculus(psi(x,s))._sage_()
TypeError: unable to make sense of Maxima expression 'psi[x](s)' in Sage
sage: from sage.interfaces.maxima_lib import max_to_sr
sage: max_to_sr(maxima_calculus(psi(x,s)).ecl()) #this doesn't rely on parsing or regexes
psi(x, s)
```
I think "parsing" psi via regex was just a quick fix around the fact that the expression parser doesn't know what to do with square brackets (and since they're rare, you can get away with not really parsing them properly). In your case, round brackets are so common that you'll quickly get caught if you don't deal with them properly. Luckily, the parser knows how to deal with them, you just have to swap the arguments.



---

archive/issue_comments_217706.json:
```json
{
    "body": "Changed commit from **[`0c93bfe`](https://github.com/sagemath/sagetrac-mirror/commit/0c93bfe4da1bd2b3a77865ae0a6878007726fff8)** to **[`fd0ccd6`](https://github.com/sagemath/sagetrac-mirror/commit/fd0ccd6ea2e7f6a0abf92ee85207c011250b9496)**",
    "created_at": "2014-07-29T15:55:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217706",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0c93bfe`](https://github.com/sagemath/sagetrac-mirror/commit/0c93bfe4da1bd2b3a77865ae0a6878007726fff8)** to **[`fd0ccd6`](https://github.com/sagemath/sagetrac-mirror/commit/fd0ccd6ea2e7f6a0abf92ee85207c011250b9496)**



---

archive/issue_comments_217707.json:
```json
{
    "body": "<div id=\"comment:15\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e90d77bb7cb262f7c8170d2a79a28fd78561ce86\"><code>e90d77b</code></a></td><td><code>16671: replace maxima interface arg swap with pynac conversion</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fd0ccd6ea2e7f6a0abf92ee85207c011250b9496\"><code>fd0ccd6</code></a></td><td><code>16671: improve previous patch; handle maple swap too</code></td></tr></table>\n",
    "created_at": "2014-07-29T15:55:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217707",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:15"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e90d77bb7cb262f7c8170d2a79a28fd78561ce86"><code>e90d77b</code></a></td><td><code>16671: replace maxima interface arg swap with pynac conversion</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fd0ccd6ea2e7f6a0abf92ee85207c011250b9496"><code>fd0ccd6</code></a></td><td><code>16671: improve previous patch; handle maple swap too</code></td></tr></table>




---

archive/issue_comments_217708.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nThanks again. I completely missed this trick, although I already created a dummy function there.",
    "created_at": "2014-07-29T15:56:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217708",
    "user": "https://github.com/rwst"
}
```

<div id="comment:16" align="right">comment:16</div>

Thanks again. I completely missed this trick, although I already created a dummy function there.



---

archive/issue_comments_217709.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nSorry, this isn't really your fault, but as it turns out the whole `_maxima_init_evaled_` mechanism gets used in a way that's broken: parameters do not get processed recursively. See #16732. As an illustration:\n\n```\nsage:sage: maxima_calculus(polylog(3,polylog(3,x)))\nli[3](polylog(3,x))\n```\nNote that the second argument doesn't get appropriately processed. Your implementation suffers from the same problem.\n\nEither we change the way that `_maxima_init_evaled_` gets called (i.e., we pass it arguments that are processed by the maxima translator itself) or we must change all the `_maxima_init_evaled_` implementations to do that properly (at least a bunch presently don't). An argument against giving `_maxima_init_evaled_` preprocessed arguments is that in principle it's conceivable that a function has an argument that needs special treatment. So letting `_maxima_init_evaled_` do the recursive argument processing under its own control is the more flexible (but more onerous) scheme.",
    "created_at": "2014-07-29T20:07:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217709",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:17" align="right">comment:17</div>

Sorry, this isn't really your fault, but as it turns out the whole `_maxima_init_evaled_` mechanism gets used in a way that's broken: parameters do not get processed recursively. See #16732. As an illustration:

```
sage:sage: maxima_calculus(polylog(3,polylog(3,x)))
li[3](polylog(3,x))
```
Note that the second argument doesn't get appropriately processed. Your implementation suffers from the same problem.

Either we change the way that `_maxima_init_evaled_` gets called (i.e., we pass it arguments that are processed by the maxima translator itself) or we must change all the `_maxima_init_evaled_` implementations to do that properly (at least a bunch presently don't). An argument against giving `_maxima_init_evaled_` preprocessed arguments is that in principle it's conceivable that a function has an argument that needs special treatment. So letting `_maxima_init_evaled_` do the recursive argument processing under its own control is the more flexible (but more onerous) scheme.



---

archive/issue_comments_217710.json:
```json
{
    "body": "Changed commit from **[`fd0ccd6`](https://github.com/sagemath/sagetrac-mirror/commit/fd0ccd6ea2e7f6a0abf92ee85207c011250b9496)** to **[`4fa8dd8`](https://github.com/sagemath/sagetrac-mirror/commit/4fa8dd871063de9d658a11135861d3564d215b4c)**",
    "created_at": "2014-07-30T07:10:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217710",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`fd0ccd6`](https://github.com/sagemath/sagetrac-mirror/commit/fd0ccd6ea2e7f6a0abf92ee85207c011250b9496)** to **[`4fa8dd8`](https://github.com/sagemath/sagetrac-mirror/commit/4fa8dd871063de9d658a11135861d3564d215b4c)**



---

archive/issue_comments_217711.json:
```json
{
    "body": "<div id=\"comment:18\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/019257d05fe189efa3a8fcf156102e3af43be9da\"><code>019257d</code></a></td><td><code>16671: `_maxima_init_evaled_` fix and doctest</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4fa8dd871063de9d658a11135861d3564d215b4c\"><code>4fa8dd8</code></a></td><td><code>16671: fix call with m an expression: allow complex m</code></td></tr></table>\n",
    "created_at": "2014-07-30T07:10:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217711",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:18"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/019257d05fe189efa3a8fcf156102e3af43be9da"><code>019257d</code></a></td><td><code>16671: `_maxima_init_evaled_` fix and doctest</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4fa8dd871063de9d658a11135861d3564d215b4c"><code>4fa8dd8</code></a></td><td><code>16671: fix call with m an expression: allow complex m</code></td></tr></table>




---

archive/issue_comments_217712.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nDone. I'm not sure if Maxima does the right thing here by expanding the sum. This can get messy for big integers:\n\n```\nsage: maxima_calculus(harmonic_number(3,harmonic_number(x,3),hold=True)).sage()\n1/3^harmonic_number(x, 3) + 1/2^harmonic_number(x, 3) + 1\n```\n\nI also removed the restriction on the second argument.",
    "created_at": "2014-07-30T07:15:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217712",
    "user": "https://github.com/rwst"
}
```

<div id="comment:19" align="right">comment:19</div>

Done. I'm not sure if Maxima does the right thing here by expanding the sum. This can get messy for big integers:

```
sage: maxima_calculus(harmonic_number(3,harmonic_number(x,3),hold=True)).sage()
1/3^harmonic_number(x, 3) + 1/2^harmonic_number(x, 3) + 1
```

I also removed the restriction on the second argument.



---

archive/issue_comments_217713.json:
```json
{
    "body": "Changed commit from **[`4fa8dd8`](https://github.com/sagemath/sagetrac-mirror/commit/4fa8dd871063de9d658a11135861d3564d215b4c)** to **[`e263ac4`](https://github.com/sagemath/sagetrac-mirror/commit/e263ac41caa14a9ba4b537f0f5091cf012d64c3b)**",
    "created_at": "2014-08-05T14:09:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217713",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4fa8dd8`](https://github.com/sagemath/sagetrac-mirror/commit/4fa8dd871063de9d658a11135861d3564d215b4c)** to **[`e263ac4`](https://github.com/sagemath/sagetrac-mirror/commit/e263ac41caa14a9ba4b537f0f5091cf012d64c3b)**



---

archive/issue_comments_217714.json:
```json
{
    "body": "<div id=\"comment:20\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e263ac41caa14a9ba4b537f0f5091cf012d64c3b\"><code>e263ac4</code></a></td><td><code>Merge branch 'develop' into t/16671/implement_harmonic_number_function_h_n_m_</code></td></tr></table>\n",
    "created_at": "2014-08-05T14:09:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217714",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:20"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e263ac41caa14a9ba4b537f0f5091cf012d64c3b"><code>e263ac4</code></a></td><td><code>Merge branch 'develop' into t/16671/implement_harmonic_number_function_h_n_m_</code></td></tr></table>




---

archive/issue_comments_217715.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nOuch, given what we've just run into on #16697 with derivatives, our `_maxima_init_evaled_` hack for swapping arguments would fail in the presence of derivatives:\n\n```\nmaxima_calculus(harmonic_number(x,y).diff(x))\n```\nShould we disallow differentiating harmonic numbers? Otherwise I think we need to rewrite how differential operators get translated. Currently, given:\n\n```\nD[0,1,2](f)(u,v,w)\n```\ngets translated basically to\n\n```\n\"diff(\"+\"f\"+\"(u,v,w)\"+\",u,1,v,1,w,1)\"\n```\nInstead, we could make the *expression* f(u,v,w) and convert that to a maxima string *as a whole* and compose that with the rest. Then we WOULD be going through `_maxima_init_evaled_` etc. There are situations where this is a little more complicated: when \"u,v,w\" are not pure, distinct, variables, then sage needs to substitute temporary place holder variables in order to express the `D[0,1,2]` operator in Leibnitz notation. (and then, after differentiation, substitute the values). Example:\n\n```\nsage: function('f')\nsage: diff( f(x+1),x)._maxima_init_()\n\"at(diff(''f(t0), t0, 1), [t0 = x + 1])\"\nsage: maxima_calculus(diff( f(x+1),x))\n?%at('diff(f(t0),t0,1),[t0=x+1])\n```\nPresently, those temporary variables `t0` do not live in Sage at all. With this change, we would have to instantiate them as symbolic variables in sage to get them converted. (I have checked before, and the `at` substitutions in maxima happen simultaneously, so symbol clashes shouldn't be an issue, other than the possibility of assumptions interfering)",
    "created_at": "2014-08-08T19:10:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217715",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:21" align="right">comment:21</div>

Ouch, given what we've just run into on #16697 with derivatives, our `_maxima_init_evaled_` hack for swapping arguments would fail in the presence of derivatives:

```
maxima_calculus(harmonic_number(x,y).diff(x))
```
Should we disallow differentiating harmonic numbers? Otherwise I think we need to rewrite how differential operators get translated. Currently, given:

```
D[0,1,2](f)(u,v,w)
```
gets translated basically to

```
"diff("+"f"+"(u,v,w)"+",u,1,v,1,w,1)"
```
Instead, we could make the *expression* f(u,v,w) and convert that to a maxima string *as a whole* and compose that with the rest. Then we WOULD be going through `_maxima_init_evaled_` etc. There are situations where this is a little more complicated: when "u,v,w" are not pure, distinct, variables, then sage needs to substitute temporary place holder variables in order to express the `D[0,1,2]` operator in Leibnitz notation. (and then, after differentiation, substitute the values). Example:

```
sage: function('f')
sage: diff( f(x+1),x)._maxima_init_()
"at(diff(''f(t0), t0, 1), [t0 = x + 1])"
sage: maxima_calculus(diff( f(x+1),x))
?%at('diff(f(t0),t0,1),[t0=x+1])
```
Presently, those temporary variables `t0` do not live in Sage at all. With this change, we would have to instantiate them as symbolic variables in sage to get them converted. (I have checked before, and the `at` substitutions in maxima happen simultaneously, so symbol clashes shouldn't be an issue, other than the possibility of assumptions interfering)



---

archive/issue_comments_217716.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nOuch, this actually shows a missed conversion:\n\n```\nsage: maxima_calculus(f(x).diff(x))\n'diff(f(_SAGE_VAR_x),_SAGE_VAR_x,1)\nsage: maxima_calculus(f(x+1).diff(x)) #this is bad!\n?%at('diff(f(t0),t0,1),[t0=x+1])\n```\nand to compare:\n\n```\nsage: from sage.interfaces.maxima_lib import sr_to_max\nsage: maxima_calculus(sr_to_max(f(x+1).diff(x)))\n?%at('diff(f(_SAGE_VAR_t0),_SAGE_VAR_t0,1),[_SAGE_VAR_t0=_SAGE_VAR_x+1])\nsage: maxima_calculus(sr_to_max(f(x).diff(x)))\n'diff(f(_SAGE_VAR_x),_SAGE_VAR_x,1)\n```\nHow the temporary variable t0 gets represented doesn't matter, but `x` should absolutely be converted to `_SAGE_VAR_x`, in all cases.\n\nThe problem is in [line 505](https://github.com/sagemath/sagetrac-mirror/blob/develop/src/sage/symbolic/expression_conversions.py#n505). Changing it like this:\n\n```diff\n-            subs = [\"%s = %s\"%(t,a) for t,a in zip(temp_args,args)]\n+            subs = [\"%s = %s\"%(t._maxima_init_(),a._maxima_init_()) for t,a in zip(temp_args,args)]\n```\nand some more changes of the same nature should do the trick.\n\nThis code also shows that the temporary variables are instantiated in sage anyway, so changing the conversion wouldn't be so bad.",
    "created_at": "2014-08-08T21:15:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217716",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:22" align="right">comment:22</div>

Ouch, this actually shows a missed conversion:

```
sage: maxima_calculus(f(x).diff(x))
'diff(f(_SAGE_VAR_x),_SAGE_VAR_x,1)
sage: maxima_calculus(f(x+1).diff(x)) #this is bad!
?%at('diff(f(t0),t0,1),[t0=x+1])
```
and to compare:

```
sage: from sage.interfaces.maxima_lib import sr_to_max
sage: maxima_calculus(sr_to_max(f(x+1).diff(x)))
?%at('diff(f(_SAGE_VAR_t0),_SAGE_VAR_t0,1),[_SAGE_VAR_t0=_SAGE_VAR_x+1])
sage: maxima_calculus(sr_to_max(f(x).diff(x)))
'diff(f(_SAGE_VAR_x),_SAGE_VAR_x,1)
```
How the temporary variable t0 gets represented doesn't matter, but `x` should absolutely be converted to `_SAGE_VAR_x`, in all cases.

The problem is in [line 505](https://github.com/sagemath/sagetrac-mirror/blob/develop/src/sage/symbolic/expression_conversions.py#n505). Changing it like this:

```diff
-            subs = ["%s = %s"%(t,a) for t,a in zip(temp_args,args)]
+            subs = ["%s = %s"%(t._maxima_init_(),a._maxima_init_()) for t,a in zip(temp_args,args)]
```
and some more changes of the same nature should do the trick.

This code also shows that the temporary variables are instantiated in sage anyway, so changing the conversion wouldn't be so bad.



---

archive/issue_comments_217717.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nSee #16785 for differential operator translation fix.",
    "created_at": "2014-08-08T22:47:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217717",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:23" align="right">comment:23</div>

See #16785 for differential operator translation fix.



---

archive/issue_comments_217718.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@nbruin](#comment%3A21):\n> Ouch, given what we've just run into on #16697 with derivatives, our `_maxima_init_evaled_` hack for swapping arguments would fail in the presence of derivatives:\n> \n> ```\n> maxima_calculus(harmonic_number(x,y).diff(x))\n> ```\n> Should we disallow differentiating harmonic numbers?\n\nI think so, there's really no need for it.",
    "created_at": "2014-08-09T15:29:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217718",
    "user": "https://github.com/rwst"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@nbruin](#comment%3A21):
> Ouch, given what we've just run into on #16697 with derivatives, our `_maxima_init_evaled_` hack for swapping arguments would fail in the presence of derivatives:
> 
> ```
> maxima_calculus(harmonic_number(x,y).diff(x))
> ```
> Should we disallow differentiating harmonic numbers?

I think so, there's really no need for it.



---

archive/issue_comments_217719.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReplying to [@rwst](#comment%3A24):\n> > Should we disallow differentiating harmonic numbers?\n\n> I think so, there's really no need for it.\n\nWith #16785 (which needs to be merged anyway) the urgency is reduced. Given the complex continuations that exist for the harmonic number function, perhaps we shouldn't go out of our way prohibiting it, even if we don't have any functionality for it (yet).",
    "created_at": "2014-08-09T18:07:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217719",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:25" align="right">comment:25</div>

Replying to [@rwst](#comment%3A24):
> > Should we disallow differentiating harmonic numbers?

> I think so, there's really no need for it.

With #16785 (which needs to be merged anyway) the urgency is reduced. Given the complex continuations that exist for the harmonic number function, perhaps we shouldn't go out of our way prohibiting it, even if we don't have any functionality for it (yet).



---

archive/issue_events_236171.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-236171"
}
```



---

archive/issue_events_236172.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-236172"
}
```



---

archive/issue_comments_217720.json:
```json
{
    "body": "<div id=\"comment:27\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9c0f66dca5d59aef571c69fe7561b6446ec23d71\"><code>9c0f66d</code></a></td><td><code>trac #16785: improve differential operator translation to maxima</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ef6d620a9d75cc9c32904255db7da93d698967f5\"><code>ef6d620</code></a></td><td><code>Merge commit '9c0f66dca5d59aef571c69fe7561b6446ec23d71' of trac.sagemath.org:sage into t/16671/implement_harmonic_number_function_h_n_m_</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/860820fd5d454bfd4e2e8f40af82e724537f45dc\"><code>860820f</code></a></td><td><code>Merge branch 'develop' into t/16671/implement_harmonic_number_function_h_n_m_</code></td></tr></table>\n",
    "created_at": "2014-08-12T07:09:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217720",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:27"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9c0f66dca5d59aef571c69fe7561b6446ec23d71"><code>9c0f66d</code></a></td><td><code>trac #16785: improve differential operator translation to maxima</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ef6d620a9d75cc9c32904255db7da93d698967f5"><code>ef6d620</code></a></td><td><code>Merge commit '9c0f66dca5d59aef571c69fe7561b6446ec23d71' of trac.sagemath.org:sage into t/16671/implement_harmonic_number_function_h_n_m_</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/860820fd5d454bfd4e2e8f40af82e724537f45dc"><code>860820f</code></a></td><td><code>Merge branch 'develop' into t/16671/implement_harmonic_number_function_h_n_m_</code></td></tr></table>




---

archive/issue_comments_217721.json:
```json
{
    "body": "Changed commit from **[`e263ac4`](https://github.com/sagemath/sagetrac-mirror/commit/e263ac41caa14a9ba4b537f0f5091cf012d64c3b)** to **[`860820f`](https://github.com/sagemath/sagetrac-mirror/commit/860820fd5d454bfd4e2e8f40af82e724537f45dc)**",
    "created_at": "2014-08-12T07:09:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217721",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e263ac4`](https://github.com/sagemath/sagetrac-mirror/commit/e263ac41caa14a9ba4b537f0f5091cf012d64c3b)** to **[`860820f`](https://github.com/sagemath/sagetrac-mirror/commit/860820fd5d454bfd4e2e8f40af82e724537f45dc)**



---

archive/issue_comments_217722.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nThis looks good with #16785:\n\n```\nsage: maxima_calculus(harmonic_number(x,y).diff(x))\n'diff(gen_harmonic_number(_SAGE_VAR_y,_SAGE_VAR_x),_SAGE_VAR_x,1)\n```\nSo, thanks for your review so far. Is there anything missing?",
    "created_at": "2014-08-12T07:11:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217722",
    "user": "https://github.com/rwst"
}
```

<div id="comment:28" align="right">comment:28</div>

This looks good with #16785:

```
sage: maxima_calculus(harmonic_number(x,y).diff(x))
'diff(gen_harmonic_number(_SAGE_VAR_y,_SAGE_VAR_x),_SAGE_VAR_x,1)
```
So, thanks for your review so far. Is there anything missing?



---

archive/issue_comments_217723.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nPatchbot complains about a failing doctest\n\n```\nFile \"src/sage/interfaces/maxima_lib.py\", line 1458, in sage.interfaces.maxima_lib.max_harmonic_to_sage\nFailed example:\n    c.ecl()\nExpected:\n    <ECL: (($GEN_HARMONIC_NUMBER SIMP) 2 $X)>\nGot:\n    <ECL: (($GEN_HARMONIC_NUMBER SIMP) 2 |$_SAGE_VAR_x|)>\n```",
    "created_at": "2014-08-12T15:50:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217723",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:29" align="right">comment:29</div>

Patchbot complains about a failing doctest

```
File "src/sage/interfaces/maxima_lib.py", line 1458, in sage.interfaces.maxima_lib.max_harmonic_to_sage
Failed example:
    c.ecl()
Expected:
    <ECL: (($GEN_HARMONIC_NUMBER SIMP) 2 $X)>
Got:
    <ECL: (($GEN_HARMONIC_NUMBER SIMP) 2 |$_SAGE_VAR_x|)>
```



---

archive/issue_comments_217724.json:
```json
{
    "body": "<div id=\"comment:30\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/26652819bf557f1daed5e01d892d7ad982e09d29\"><code>2665281</code></a></td><td><code>16671: doctest fix (appeared due to 16785 merge)</code></td></tr></table>\n",
    "created_at": "2014-08-12T16:18:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217724",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:30"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/26652819bf557f1daed5e01d892d7ad982e09d29"><code>2665281</code></a></td><td><code>16671: doctest fix (appeared due to 16785 merge)</code></td></tr></table>




---

archive/issue_comments_217725.json:
```json
{
    "body": "Changed commit from **[`860820f`](https://github.com/sagemath/sagetrac-mirror/commit/860820fd5d454bfd4e2e8f40af82e724537f45dc)** to **[`2665281`](https://github.com/sagemath/sagetrac-mirror/commit/26652819bf557f1daed5e01d892d7ad982e09d29)**",
    "created_at": "2014-08-12T16:18:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217725",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`860820f`](https://github.com/sagemath/sagetrac-mirror/commit/860820fd5d454bfd4e2e8f40af82e724537f45dc)** to **[`2665281`](https://github.com/sagemath/sagetrac-mirror/commit/26652819bf557f1daed5e01d892d7ad982e09d29)**



---

archive/issue_comments_217726.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nAh thanks, the `$X` should have rung a bell much earlier.",
    "created_at": "2014-08-12T16:19:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217726",
    "user": "https://github.com/rwst"
}
```

<div id="comment:31" align="right">comment:31</div>

Ah thanks, the `$X` should have rung a bell much earlier.



---

archive/issue_comments_217727.json:
```json
{
    "body": "<div id=\"comment:32\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fd8c09c4be9334f4fd9af3225aa3a2898dd8366d\"><code>fd8c09c</code></a></td><td><code>Merge branch 'develop' into t/16671/implement_harmonic_number_function_h_n_m_</code></td></tr></table>\n",
    "created_at": "2014-08-20T14:22:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217727",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:32"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fd8c09c4be9334f4fd9af3225aa3a2898dd8366d"><code>fd8c09c</code></a></td><td><code>Merge branch 'develop' into t/16671/implement_harmonic_number_function_h_n_m_</code></td></tr></table>




---

archive/issue_comments_217728.json:
```json
{
    "body": "Changed commit from **[`2665281`](https://github.com/sagemath/sagetrac-mirror/commit/26652819bf557f1daed5e01d892d7ad982e09d29)** to **[`fd8c09c`](https://github.com/sagemath/sagetrac-mirror/commit/fd8c09c4be9334f4fd9af3225aa3a2898dd8366d)**",
    "created_at": "2014-08-20T14:22:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217728",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`2665281`](https://github.com/sagemath/sagetrac-mirror/commit/26652819bf557f1daed5e01d892d7ad982e09d29)** to **[`fd8c09c`](https://github.com/sagemath/sagetrac-mirror/commit/fd8c09c4be9334f4fd9af3225aa3a2898dd8366d)**



---

archive/issue_comments_217729.json:
```json
{
    "body": "Changed commit from **[`fd8c09c`](https://github.com/sagemath/sagetrac-mirror/commit/fd8c09c4be9334f4fd9af3225aa3a2898dd8366d)** to **[`87597bd`](https://github.com/sagemath/sagetrac-mirror/commit/87597bde4c041766a26674a3a8be1d4b076180d5)**",
    "created_at": "2014-12-20T08:20:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217729",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`fd8c09c`](https://github.com/sagemath/sagetrac-mirror/commit/fd8c09c4be9334f4fd9af3225aa3a2898dd8366d)** to **[`87597bd`](https://github.com/sagemath/sagetrac-mirror/commit/87597bde4c041766a26674a3a8be1d4b076180d5)**



---

archive/issue_comments_217730.json:
```json
{
    "body": "<div id=\"comment:33\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fa73dde760a97179944c7717d6cd952d93aa2056\"><code>fa73dde</code></a></td><td><code>Merge branch 'develop' into t/16671/implement_harmonic_number_function_h_n_m_</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/87597bde4c041766a26674a3a8be1d4b076180d5\"><code>87597bd</code></a></td><td><code>16671: adaptations due to improved BuiltinFunction</code></td></tr></table>\n",
    "created_at": "2014-12-20T08:20:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217730",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:33"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fa73dde760a97179944c7717d6cd952d93aa2056"><code>fa73dde</code></a></td><td><code>Merge branch 'develop' into t/16671/implement_harmonic_number_function_h_n_m_</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/87597bde4c041766a26674a3a8be1d4b076180d5"><code>87597bd</code></a></td><td><code>16671: adaptations due to improved BuiltinFunction</code></td></tr></table>




---

archive/issue_comments_217731.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nYou don't need this:\n\n```diff\ndiff --git a/src/sage/libs/flint/arith.pyx b/src/sage/libs/flint/arith.pyx\nindex 7280536..91caf32 100644\n--- a/src/sage/libs/flint/arith.pyx\n+++ b/src/sage/libs/flint/arith.pyx\n@@ -10,10 +10,23 @@ FLINT Arithmetic Functions\ninclude \"sage/ext/interrupt.pxi\"\n+cdef extern from \"flint/fmpq.h\":\n+ ctypedef void * fmpq_t\n+ void fmpq_init(fmpq_t)\n+ void fmpq_clear(fmpq_t)\n+ void fmpq_get_mpq(mpq_t, fmpq_t)\n+ void fmpq_set_mpq(fmpq_t, mpq_t)\n+\n+cdef extern from \"flint/arith.h\":\n+ void arith_number_of_partitions(fmpz_t x, unsigned long n)\n+ void arith_dedekind_sum(fmpq_t, fmpz_t, fmpz_t)\n+ void arith_harmonic_number(fmpq_t, unsigned long n)\n+\nfrom fmpz cimport *\nfrom fmpq cimport *\nfrom arith cimport *\n+\nfrom sage.rings.integer cimport Integer\nfrom sage.rings.rational cimport Rational\n```\n\nAdd the functions you need (only `arith_harmonic_number` in this case) to `src/sage/libs/flint/arith.pxd` instead.",
    "created_at": "2015-02-14T15:31:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217731",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:35" align="right">comment:35</div>

You don't need this:

```diff
diff --git a/src/sage/libs/flint/arith.pyx b/src/sage/libs/flint/arith.pyx
index 7280536..91caf32 100644
--- a/src/sage/libs/flint/arith.pyx
+++ b/src/sage/libs/flint/arith.pyx
@@ -10,10 +10,23 @@ FLINT Arithmetic Functions
include "sage/ext/interrupt.pxi"
+cdef extern from "flint/fmpq.h":
+ ctypedef void * fmpq_t
+ void fmpq_init(fmpq_t)
+ void fmpq_clear(fmpq_t)
+ void fmpq_get_mpq(mpq_t, fmpq_t)
+ void fmpq_set_mpq(fmpq_t, mpq_t)
+
+cdef extern from "flint/arith.h":
+ void arith_number_of_partitions(fmpz_t x, unsigned long n)
+ void arith_dedekind_sum(fmpq_t, fmpz_t, fmpz_t)
+ void arith_harmonic_number(fmpq_t, unsigned long n)
+
from fmpz cimport *
from fmpq cimport *
from arith cimport *
+
from sage.rings.integer cimport Integer
from sage.rings.rational cimport Rational
```

Add the functions you need (only `arith_harmonic_number` in this case) to `src/sage/libs/flint/arith.pxd` instead.



---

archive/issue_events_236173.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-02-14T15:31:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-236173"
}
```



---

archive/issue_events_236174.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-02-14T15:31:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-236174"
}
```



---

archive/issue_comments_217732.json:
```json
{
    "body": "Changed branch from **[u/rws/implement_harmonic_number_function_h_n_m_](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/implement_harmonic_number_function_h_n_m_)** to **[u/rws/16671](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/16671)**",
    "created_at": "2015-02-15T08:34:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217732",
    "user": "https://github.com/rwst"
}
```

Changed branch from **[u/rws/implement_harmonic_number_function_h_n_m_](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/implement_harmonic_number_function_h_n_m_)** to **[u/rws/16671](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/16671)**



---

archive/issue_comments_217733.json:
```json
{
    "body": "Changed commit from **[`87597bd`](https://github.com/sagemath/sagetrac-mirror/commit/87597bde4c041766a26674a3a8be1d4b076180d5)** to **[`c26cd0b`](https://github.com/sagemath/sagetrac-mirror/commit/c26cd0b047aef2446737587bd784e38851277ed4)**",
    "created_at": "2015-02-15T08:35:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217733",
    "user": "https://github.com/rwst"
}
```

Changed commit from **[`87597bd`](https://github.com/sagemath/sagetrac-mirror/commit/87597bde4c041766a26674a3a8be1d4b076180d5)** to **[`c26cd0b`](https://github.com/sagemath/sagetrac-mirror/commit/c26cd0b047aef2446737587bd784e38851277ed4)**



---

archive/issue_comments_217734.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nDone. Squashed it all into one commit.\n  \n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c26cd0b047aef2446737587bd784e38851277ed4\"><code>c26cd0b</code></a></td><td><code>16671: implement harmonic number function H(n,m)</code></td></tr></table>\n",
    "created_at": "2015-02-15T08:35:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217734",
    "user": "https://github.com/rwst"
}
```

<div id="comment:37" align="right">comment:37</div>

Done. Squashed it all into one commit.
  
---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c26cd0b047aef2446737587bd784e38851277ed4"><code>c26cd0b</code></a></td><td><code>16671: implement harmonic number function H(n,m)</code></td></tr></table>




---

archive/issue_events_236175.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-02-15T08:35:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-236175"
}
```



---

archive/issue_events_236176.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-02-15T08:35:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-236176"
}
```



---

archive/issue_comments_217735.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nIn `flint/arith.pyx`, you're missing actual examples.",
    "created_at": "2015-02-15T12:50:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217735",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:38" align="right">comment:38</div>

In `flint/arith.pyx`, you're missing actual examples.



---

archive/issue_events_236177.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-02-15T12:50:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-236177"
}
```



---

archive/issue_events_236178.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-02-15T12:50:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-236178"
}
```



---

archive/issue_comments_217736.json:
```json
{
    "body": "<div id=\"comment:39\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3ec7fbba6b2c095ef2aa38cec5ffc47c9ba0cae6\"><code>3ec7fbb</code></a></td><td><code>16671: add missing doctest</code></td></tr></table>\n",
    "created_at": "2015-02-15T13:56:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217736",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:39"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3ec7fbba6b2c095ef2aa38cec5ffc47c9ba0cae6"><code>3ec7fbb</code></a></td><td><code>16671: add missing doctest</code></td></tr></table>




---

archive/issue_comments_217737.json:
```json
{
    "body": "Changed commit from **[`c26cd0b`](https://github.com/sagemath/sagetrac-mirror/commit/c26cd0b047aef2446737587bd784e38851277ed4)** to **[`3ec7fbb`](https://github.com/sagemath/sagetrac-mirror/commit/3ec7fbba6b2c095ef2aa38cec5ffc47c9ba0cae6)**",
    "created_at": "2015-02-15T13:56:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217737",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`c26cd0b`](https://github.com/sagemath/sagetrac-mirror/commit/c26cd0b047aef2446737587bd784e38851277ed4)** to **[`3ec7fbb`](https://github.com/sagemath/sagetrac-mirror/commit/3ec7fbba6b2c095ef2aa38cec5ffc47c9ba0cae6)**



---

archive/issue_events_236179.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-02-15T13:56:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-236179"
}
```



---

archive/issue_events_236180.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-02-15T13:56:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-236180"
}
```



---

archive/issue_comments_217738.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nIndeed.",
    "created_at": "2015-02-15T13:56:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217738",
    "user": "https://github.com/rwst"
}
```

<div id="comment:40" align="right">comment:40</div>

Indeed.



---

archive/issue_comments_217739.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nIn `__call__`, why mess with `len(args)`? Why not simply something like\n\n```\ndef __call__(self, z, m=1, **kwds):\n    return BuiltinFunction.__call__(self, z, m, **kwds)\n```",
    "created_at": "2015-02-16T09:09:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217739",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:41" align="right">comment:41</div>

In `__call__`, why mess with `len(args)`? Why not simply something like

```
def __call__(self, z, m=1, **kwds):
    return BuiltinFunction.__call__(self, z, m, **kwds)
```



---

archive/issue_comments_217740.json:
```json
{
    "body": "<div id=\"comment:42\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fabf86397adf8c07ce9b63b64c64e5f724702d21\"><code>fabf863</code></a></td><td><code>16671: code tightened</code></td></tr></table>\n",
    "created_at": "2015-02-16T09:26:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217740",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:42"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fabf86397adf8c07ce9b63b64c64e5f724702d21"><code>fabf863</code></a></td><td><code>16671: code tightened</code></td></tr></table>




---

archive/issue_comments_217741.json:
```json
{
    "body": "Changed commit from **[`3ec7fbb`](https://github.com/sagemath/sagetrac-mirror/commit/3ec7fbba6b2c095ef2aa38cec5ffc47c9ba0cae6)** to **[`fabf863`](https://github.com/sagemath/sagetrac-mirror/commit/fabf86397adf8c07ce9b63b64c64e5f724702d21)**",
    "created_at": "2015-02-16T09:26:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217741",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3ec7fbb`](https://github.com/sagemath/sagetrac-mirror/commit/3ec7fbba6b2c095ef2aa38cec5ffc47c9ba0cae6)** to **[`fabf863`](https://github.com/sagemath/sagetrac-mirror/commit/fabf86397adf8c07ce9b63b64c64e5f724702d21)**



---

archive/issue_comments_217742.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nWhat's with the condition `elif z < 2**20:`??",
    "created_at": "2015-02-16T09:30:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217742",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:43" align="right">comment:43</div>

What's with the condition `elif z < 2**20:`??



---

archive/issue_comments_217743.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nIn `flint/arith.pyx`, you should add\n\n```diff\n+sig_on()\n arith_harmonic_number(s_fmpq, n)\n\n fmpq_get_mpq((<Rational>s).value, s_fmpq)\n+sig_off()\n```",
    "created_at": "2015-02-16T09:33:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217743",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:44" align="right">comment:44</div>

In `flint/arith.pyx`, you should add

```diff
+sig_on()
 arith_harmonic_number(s_fmpq, n)

 fmpq_get_mpq((<Rational>s).value, s_fmpq)
+sig_off()
```



---

archive/issue_events_236181.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-02-16T09:33:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-236181"
}
```



---

archive/issue_events_236182.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-02-16T09:33:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-236182"
}
```



---

archive/issue_comments_217744.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nWhy doesn't this work?\n\n```\nsage: harmonic_number(x).diff(x)\nD[0]harmonic_number(x)\n```",
    "created_at": "2015-02-16T09:34:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217744",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:46" align="right">comment:46</div>

Why doesn't this work?

```
sage: harmonic_number(x).diff(x)
D[0]harmonic_number(x)
```



---

archive/issue_comments_217745.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nI don't agree with `sum(QQ(1)/(k**m) for k in range(1,z+1))` since the result is always in `QQ`. I would use `srange` to respect the input type (`foo in ZZ` does not imply that the type of `foo` is `ZZ`):\n\n```\nsum(1/(k**m) for k in srange(1,z+1))\n```\n\nArtificial example (this could be a doctest):\n\n```\nsage: harmonic_number._eval_(10, Qp(5)(1))\n7381/2520\n```\nbut the answer should be\n\n```\nsage: Qp(5)(harmonic_number(10))\n4*5^-1 + 2 + 2*5 + 4*5^2 + 3*5^3 + 5^4 + 4*5^5 + 4*5^6 + 5^7 + 4*5^8 + 3*5^9 + 5^10 + 4*5^11 + 4*5^12 + 5^13 + 4*5^14 + 3*5^15 + 5^16 + 4*5^17 + 4*5^18 + O(5^19)\n```",
    "created_at": "2015-02-16T09:39:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217745",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:47" align="right">comment:47</div>

I don't agree with `sum(QQ(1)/(k**m) for k in range(1,z+1))` since the result is always in `QQ`. I would use `srange` to respect the input type (`foo in ZZ` does not imply that the type of `foo` is `ZZ`):

```
sum(1/(k**m) for k in srange(1,z+1))
```

Artificial example (this could be a doctest):

```
sage: harmonic_number._eval_(10, Qp(5)(1))
7381/2520
```
but the answer should be

```
sage: Qp(5)(harmonic_number(10))
4*5^-1 + 2 + 2*5 + 4*5^2 + 3*5^3 + 5^4 + 4*5^5 + 4*5^6 + 5^7 + 4*5^8 + 3*5^9 + 5^10 + 4*5^11 + 4*5^12 + 5^13 + 4*5^14 + 3*5^15 + 5^16 + 4*5^17 + 4*5^18 + O(5^19)
```



---

archive/issue_comments_217746.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nAlso please fix `\\ No newline at end of file`",
    "created_at": "2015-02-16T09:40:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217746",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:48" align="right">comment:48</div>

Also please fix `\ No newline at end of file`



---

archive/issue_comments_217747.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nI don't know what `SR('x')` does, but I think it's better to use `SR.var('x')` instead.",
    "created_at": "2015-02-16T09:43:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217747",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:49" align="right">comment:49</div>

I don't know what `SR('x')` does, but I think it's better to use `SR.var('x')` instead.



---

archive/issue_comments_217748.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nSame comment as above: are you sure you want `elif z in QQ:` and not `elif isinstance(z, Rational)`?",
    "created_at": "2015-02-16T09:44:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217748",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:50" align="right">comment:50</div>

Same comment as above: are you sure you want `elif z in QQ:` and not `elif isinstance(z, Rational)`?



---

archive/issue_comments_217749.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nReplying to [@jdemeyer](#comment%3A50):\n> Same comment as above: are you sure you want `elif z in QQ:` and not `elif isinstance(z, Rational)`?\n\nBTW I would think this `if var in ZZ/QQ` appears more often throughout the Sage code. Is there a manual page that deals with this?",
    "created_at": "2015-02-16T10:11:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217749",
    "user": "https://github.com/rwst"
}
```

<div id="comment:51" align="right">comment:51</div>

Replying to [@jdemeyer](#comment%3A50):
> Same comment as above: are you sure you want `elif z in QQ:` and not `elif isinstance(z, Rational)`?

BTW I would think this `if var in ZZ/QQ` appears more often throughout the Sage code. Is there a manual page that deals with this?



---

archive/issue_comments_217750.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nReplying to [@rwst](#comment%3A51):\n> BTW I would think this `if var in ZZ/QQ` appears more often throughout the Sage code.\n\nPerhaps, but it's not always wrong. It just depends on what you want to do with it.",
    "created_at": "2015-02-16T10:17:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217750",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:52" align="right">comment:52</div>

Replying to [@rwst](#comment%3A51):
> BTW I would think this `if var in ZZ/QQ` appears more often throughout the Sage code.

Perhaps, but it's not always wrong. It just depends on what you want to do with it.



---

archive/issue_comments_217751.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nThe general rule for functions should be: whenever the answer is non-symbolic, the answer should have a parent which \"matches\" the parent of the input.",
    "created_at": "2015-02-16T11:09:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217751",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:53" align="right">comment:53</div>

The general rule for functions should be: whenever the answer is non-symbolic, the answer should have a parent which "matches" the parent of the input.



---

archive/issue_comments_217752.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nReplying to [@jdemeyer](#comment%3A47):\n> Artificial example (this could be a doctest):\n> \n> ```\n> sage: harmonic_number._eval_(10, Qp(5)(1))\n> 7381/2520\n> ```\n> but the answer should be\n> \n> ```\n> sage: Qp(5)(harmonic_number(10))\n> 4*5^-1 + 2 + 2*5 + 4*5^2 + 3*5^3 + 5^4 + 4*5^5 + 4*5^6 + 5^7 + 4*5^8 + 3*5^9 + 5^10 + 4*5^11 + 4*5^12 + 5^13 + 4*5^14 + 3*5^15 + 5^16 + 4*5^17 + 4*5^18 + O(5^19)\n> ```\n\nI think this is the only example where `H(n,m)` would have a useful meaning, and it can be computed, as you show, by staying in the rationals and converting the result. Trying to support this case however will fail in `BuiltinFunction.__call__`:\n\n```\nsage: harmonic_number(5,Qp(5)(8))\nTraceback (most recent call last):\n  File \"<ipython-input-9-03dbaa59749c>\", line 1, in <module>\n    harmonic_number(Integer(5),Qp(Integer(5))(Integer(8)))\n  File \"/home/ralf/sage/local/lib/python2.7/site-packages/sage/functions/log.py\", line 886, in __call__\n    return BuiltinFunction.__call__(self, z, m, **kwds)\n  File \"sage/symbolic/function.pyx\", line 993, in sage.symbolic.function.BuiltinFunction.__call__ (build/cythonized/sage/symbolic/function.cpp:10572)\n    res = super(BuiltinFunction, self).__call__(\n  File \"sage/symbolic/function.pyx\", line 487, in sage.symbolic.function.Function.__call__ (build/cythonized/sage/symbolic/function.cpp:6301)\n    raise TypeError, \"cannot coerce arguments: %s\"%(err)\nTypeError: cannot coerce arguments: no canonical coercion from 5-adic Field with capped relative precision 20 to Symbolic Ring\n```",
    "created_at": "2015-02-16T14:44:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217752",
    "user": "https://github.com/rwst"
}
```

<div id="comment:54" align="right">comment:54</div>

Replying to [@jdemeyer](#comment%3A47):
> Artificial example (this could be a doctest):
> 
> ```
> sage: harmonic_number._eval_(10, Qp(5)(1))
> 7381/2520
> ```
> but the answer should be
> 
> ```
> sage: Qp(5)(harmonic_number(10))
> 4*5^-1 + 2 + 2*5 + 4*5^2 + 3*5^3 + 5^4 + 4*5^5 + 4*5^6 + 5^7 + 4*5^8 + 3*5^9 + 5^10 + 4*5^11 + 4*5^12 + 5^13 + 4*5^14 + 3*5^15 + 5^16 + 4*5^17 + 4*5^18 + O(5^19)
> ```

I think this is the only example where `H(n,m)` would have a useful meaning, and it can be computed, as you show, by staying in the rationals and converting the result. Trying to support this case however will fail in `BuiltinFunction.__call__`:

```
sage: harmonic_number(5,Qp(5)(8))
Traceback (most recent call last):
  File "<ipython-input-9-03dbaa59749c>", line 1, in <module>
    harmonic_number(Integer(5),Qp(Integer(5))(Integer(8)))
  File "/home/ralf/sage/local/lib/python2.7/site-packages/sage/functions/log.py", line 886, in __call__
    return BuiltinFunction.__call__(self, z, m, **kwds)
  File "sage/symbolic/function.pyx", line 993, in sage.symbolic.function.BuiltinFunction.__call__ (build/cythonized/sage/symbolic/function.cpp:10572)
    res = super(BuiltinFunction, self).__call__(
  File "sage/symbolic/function.pyx", line 487, in sage.symbolic.function.Function.__call__ (build/cythonized/sage/symbolic/function.cpp:6301)
    raise TypeError, "cannot coerce arguments: %s"%(err)
TypeError: cannot coerce arguments: no canonical coercion from 5-adic Field with capped relative precision 20 to Symbolic Ring
```



---

archive/issue_comments_217753.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nReplying to [@rwst](#comment%3A54):\n> it can be computed, as you show, by staying in the rationals and converting the result.\n\nBut that wouldn't be the optimal way to compute it. I think it's easy to make the formula work for arbitrary types.\n\n> Trying to support this case however will fail in `BuiltinFunction.__call__`:\n\nI know, but that doesn't mean we shouldn't adapt `_eval_`.",
    "created_at": "2015-02-16T15:29:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217753",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:55" align="right">comment:55</div>

Replying to [@rwst](#comment%3A54):
> it can be computed, as you show, by staying in the rationals and converting the result.

But that wouldn't be the optimal way to compute it. I think it's easy to make the formula work for arbitrary types.

> Trying to support this case however will fail in `BuiltinFunction.__call__`:

I know, but that doesn't mean we shouldn't adapt `_eval_`.



---

archive/issue_comments_217754.json:
```json
{
    "body": "Changed commit from **[`fabf863`](https://github.com/sagemath/sagetrac-mirror/commit/fabf86397adf8c07ce9b63b64c64e5f724702d21)** to **[`309660a`](https://github.com/sagemath/sagetrac-mirror/commit/309660a11c0929f223087f5f208a2ea8f14e7625)**",
    "created_at": "2015-02-16T16:44:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217754",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`fabf863`](https://github.com/sagemath/sagetrac-mirror/commit/fabf86397adf8c07ce9b63b64c64e5f724702d21)** to **[`309660a`](https://github.com/sagemath/sagetrac-mirror/commit/309660a11c0929f223087f5f208a2ea8f14e7625)**



---

archive/issue_comments_217755.json:
```json
{
    "body": "<div id=\"comment:56\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/309660a11c0929f223087f5f208a2ea8f14e7625\"><code>309660a</code></a></td><td><code>16671: generalize evaluation of H(n,m); add its derivative; several fixes; document FLINT computation limit</code></td></tr></table>\n",
    "created_at": "2015-02-16T16:44:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217755",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:56"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/309660a11c0929f223087f5f208a2ea8f14e7625"><code>309660a</code></a></td><td><code>16671: generalize evaluation of H(n,m); add its derivative; several fixes; document FLINT computation limit</code></td></tr></table>




---

archive/issue_events_236183.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-02-16T16:46:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-236183"
}
```



---

archive/issue_events_236184.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-02-16T16:46:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-236184"
}
```



---

archive/issue_comments_217756.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">comment:57</div>\n\n> > Trying to support this case however will fail in `BuiltinFunction.__call__`:\n\n> I know, but that doesn't mean we shouldn't adapt `_eval_`.\n\nThat means it will be fixed elsewhere?",
    "created_at": "2015-02-16T16:46:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217756",
    "user": "https://github.com/rwst"
}
```

<div id="comment:57" align="right">comment:57</div>

> > Trying to support this case however will fail in `BuiltinFunction.__call__`:

> I know, but that doesn't mean we shouldn't adapt `_eval_`.

That means it will be fixed elsewhere?



---

archive/issue_comments_217757.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">comment:58</div>\n\nI still don't understand the point of this:\n\n```\nIf the argument is an integer greater than `2^20` no rational\nevaluation is done, in order to allow for high-precision floating\npoint computation using `.n()`\n```",
    "created_at": "2015-02-16T17:44:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217757",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:58" align="right">comment:58</div>

I still don't understand the point of this:

```
If the argument is an integer greater than `2^20` no rational
evaluation is done, in order to allow for high-precision floating
point computation using `.n()`
```



---

archive/issue_comments_217758.json:
```json
{
    "body": "<div id=\"comment:59\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ca696281c6d2425b72d72b6408e4a787b32d637a\"><code>ca69628</code></a></td><td><code>16671: remove restriction</code></td></tr></table>\n",
    "created_at": "2015-02-17T06:37:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217758",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:59"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ca696281c6d2425b72d72b6408e4a787b32d637a"><code>ca69628</code></a></td><td><code>16671: remove restriction</code></td></tr></table>




---

archive/issue_comments_217759.json:
```json
{
    "body": "Changed commit from **[`309660a`](https://github.com/sagemath/sagetrac-mirror/commit/309660a11c0929f223087f5f208a2ea8f14e7625)** to **[`ca69628`](https://github.com/sagemath/sagetrac-mirror/commit/ca696281c6d2425b72d72b6408e4a787b32d637a)**",
    "created_at": "2015-02-17T06:37:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217759",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`309660a`](https://github.com/sagemath/sagetrac-mirror/commit/309660a11c0929f223087f5f208a2ea8f14e7625)** to **[`ca69628`](https://github.com/sagemath/sagetrac-mirror/commit/ca696281c6d2425b72d72b6408e4a787b32d637a)**



---

archive/issue_comments_217760.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">comment:60</div>\n\nReplying to [@jdemeyer](#comment%3A58):\n> I still don't understand the point of this:\n\nOK, me neither. Presumably I had a memory error at the time ...",
    "created_at": "2015-02-17T06:38:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217760",
    "user": "https://github.com/rwst"
}
```

<div id="comment:60" align="right">comment:60</div>

Replying to [@jdemeyer](#comment%3A58):
> I still don't understand the point of this:

OK, me neither. Presumably I had a memory error at the time ...



---

archive/issue_comments_217761.json:
```json
{
    "body": "Dependencies: **#17790**",
    "created_at": "2015-02-17T06:46:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217761",
    "user": "https://github.com/rwst"
}
```

Dependencies: **#17790**



---

archive/issue_comments_217762.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">comment:61</div>\n\nReplying to [@rwst](#comment%3A57):\n> > > Trying to support this case however will fail in `BuiltinFunction.__call__`:\n\n> > I know, but that doesn't mean we shouldn't adapt `_eval_`.\n\n> That means it will be fixed elsewhere?\n\nSee #17790",
    "created_at": "2015-02-17T06:46:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217762",
    "user": "https://github.com/rwst"
}
```

<div id="comment:61" align="right">comment:61</div>

Replying to [@rwst](#comment%3A57):
> > > Trying to support this case however will fail in `BuiltinFunction.__call__`:

> > I know, but that doesn't mean we shouldn't adapt `_eval_`.

> That means it will be fixed elsewhere?

See #17790



---

archive/issue_comments_217763.json:
```json
{
    "body": "Work Issues: **merge fix for #17790**",
    "created_at": "2015-03-05T08:23:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217763",
    "user": "https://github.com/rwst"
}
```

Work Issues: **merge fix for #17790**



---

archive/issue_events_236185.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-03-05T08:23:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-236185"
}
```



---

archive/issue_events_236186.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-03-05T08:23:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-236186"
}
```



---

archive/issue_comments_217764.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">comment:63</div>\n\nLet's document here that both forms for the generalized harmonic numbers\n\n```\nH(q/p,m) = zeta(m) - p^m * sum(1/(q+p*k)^m, k, 1, oo)   (Wikipedia 2015-Mar-07)\n\nH(k,n) = binomial(n+k-1,k-1)*(harmonic_number(n+k-1)-harmonic_number(k-1))\n         (http://mathworld.wolfram.com/HarmonicNumber.html eq. 55)\n```\nare both wrong, with the counterexamples `H(5/2,3)=1/27*sqrt(3) + 1/8*sqrt(2) + 1` and `H(5,3)=256103/216000`.\n\nEDIT. no, the first is right, my implementation was wrong.",
    "created_at": "2015-03-07T08:53:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217764",
    "user": "https://github.com/rwst"
}
```

<div id="comment:63" align="right">comment:63</div>

Let's document here that both forms for the generalized harmonic numbers

```
H(q/p,m) = zeta(m) - p^m * sum(1/(q+p*k)^m, k, 1, oo)   (Wikipedia 2015-Mar-07)

H(k,n) = binomial(n+k-1,k-1)*(harmonic_number(n+k-1)-harmonic_number(k-1))
         (http://mathworld.wolfram.com/HarmonicNumber.html eq. 55)
```
are both wrong, with the counterexamples `H(5/2,3)=1/27*sqrt(3) + 1/8*sqrt(2) + 1` and `H(5,3)=256103/216000`.

EDIT. no, the first is right, my implementation was wrong.



---

archive/issue_comments_217765.json:
```json
{
    "body": "<div id=\"comment:64\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5eb502d6f631ccab4045b9ba8e375815ea355231\"><code>5eb502d</code></a></td><td><code>Merge branch 'develop' into t/16671/16671</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a808a0e68bdf345cc8b182c68a55c48755603e3f\"><code>a808a0e</code></a></td><td><code>Merge branch 'develop' into t/16671/16671</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f6e21137f97771b916ceae7f16a59805af78291f\"><code>f6e2113</code></a></td><td><code>17790: add padics to the conversion workaround for symbolic function arguments</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/05ad72bbacb57896af1be0d8f8002f61c3d52420\"><code>05ad72b</code></a></td><td><code>Merge branch 'u/rws/builtinfunction_doesn_t_pass_non_sr_coercible_arguments_to_function_code' of trac.sagemath.org:sage into t/16671/16671</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ca1a03d0e4a38ad9bec0475b2382ab0642f81f8f\"><code>ca1a03d</code></a></td><td><code>Merge branch 'develop' into t/16671/16671</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d60311eda7cce822b74480550498da09b34b7a63\"><code>d60311e</code></a></td><td><code>16671: handle more argument types; fix num. H(n,m); cosmetics</code></td></tr></table>\n",
    "created_at": "2015-03-07T09:22:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217765",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:64"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5eb502d6f631ccab4045b9ba8e375815ea355231"><code>5eb502d</code></a></td><td><code>Merge branch 'develop' into t/16671/16671</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a808a0e68bdf345cc8b182c68a55c48755603e3f"><code>a808a0e</code></a></td><td><code>Merge branch 'develop' into t/16671/16671</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f6e21137f97771b916ceae7f16a59805af78291f"><code>f6e2113</code></a></td><td><code>17790: add padics to the conversion workaround for symbolic function arguments</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/05ad72bbacb57896af1be0d8f8002f61c3d52420"><code>05ad72b</code></a></td><td><code>Merge branch 'u/rws/builtinfunction_doesn_t_pass_non_sr_coercible_arguments_to_function_code' of trac.sagemath.org:sage into t/16671/16671</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ca1a03d0e4a38ad9bec0475b2382ab0642f81f8f"><code>ca1a03d</code></a></td><td><code>Merge branch 'develop' into t/16671/16671</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d60311eda7cce822b74480550498da09b34b7a63"><code>d60311e</code></a></td><td><code>16671: handle more argument types; fix num. H(n,m); cosmetics</code></td></tr></table>




---

archive/issue_comments_217766.json:
```json
{
    "body": "Changed commit from **[`ca69628`](https://github.com/sagemath/sagetrac-mirror/commit/ca696281c6d2425b72d72b6408e4a787b32d637a)** to **[`d60311e`](https://github.com/sagemath/sagetrac-mirror/commit/d60311eda7cce822b74480550498da09b34b7a63)**",
    "created_at": "2015-03-07T09:22:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217766",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`ca69628`](https://github.com/sagemath/sagetrac-mirror/commit/ca696281c6d2425b72d72b6408e4a787b32d637a)** to **[`d60311e`](https://github.com/sagemath/sagetrac-mirror/commit/d60311eda7cce822b74480550498da09b34b7a63)**



---

archive/issue_comments_217767.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">comment:65</div>\n\nReplying to [@jdemeyer](#comment%3A47):\n> \n> ```\n> sage: harmonic_number._eval_(10, Qp(5)(1))\n> 7381/2520\n> ```\n> but the answer should be\n> \n> ```\n> sage: Qp(5)(harmonic_number(10))\n> ```\n\nDisagree. That should be the result of `harmonic_number._eval_(Qp(5)(10), 1)`. Anything else than a rational as second argument makes no sense.\n\nI have now adapted the code so it gives back the same type as the input, but wrapped as `Expression`. Also, you can expect that only if it can be converted back, which is not the case for `H(p/q)` or `H(anything, p/q)` as the result is not rational.",
    "created_at": "2015-03-07T09:31:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217767",
    "user": "https://github.com/rwst"
}
```

<div id="comment:65" align="right">comment:65</div>

Replying to [@jdemeyer](#comment%3A47):
> 
> ```
> sage: harmonic_number._eval_(10, Qp(5)(1))
> 7381/2520
> ```
> but the answer should be
> 
> ```
> sage: Qp(5)(harmonic_number(10))
> ```

Disagree. That should be the result of `harmonic_number._eval_(Qp(5)(10), 1)`. Anything else than a rational as second argument makes no sense.

I have now adapted the code so it gives back the same type as the input, but wrapped as `Expression`. Also, you can expect that only if it can be converted back, which is not the case for `H(p/q)` or `H(anything, p/q)` as the result is not rational.



---

archive/issue_events_236187.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-03-07T09:31:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-236187"
}
```



---

archive/issue_events_236188.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-03-07T09:31:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-236188"
}
```



---

archive/issue_comments_217768.json:
```json
{
    "body": "Changed work issues from **merge fix for #17790** to none",
    "created_at": "2015-03-07T09:31:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217768",
    "user": "https://github.com/rwst"
}
```

Changed work issues from **merge fix for #17790** to none



---

archive/issue_events_236189.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-03-07T09:31:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-236189"
}
```



---

archive/issue_events_236190.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-03-07T09:31:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "milestone_number": null,
    "milestone_title": "sage-6.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-236190"
}
```



---

archive/issue_events_236191.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-06-11T07:32:39Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "milestone_number": null,
    "milestone_title": "sage-6.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-236191"
}
```



---

archive/issue_events_236192.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-06-11T07:32:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/pending",
    "label_color": "008080",
    "label_name": "pending",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-236192"
}
```



---

archive/issue_events_236193.json:
```json
{
    "actor": "https://github.com/dkrenn",
    "created_at": "2015-11-29T11:29:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-236193"
}
```



---

archive/issue_events_236194.json:
```json
{
    "actor": "https://github.com/dkrenn",
    "created_at": "2015-11-29T11:29:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-236194"
}
```



---

archive/issue_comments_217769.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">comment:68</div>\n\n\n```\nsage -t src/sage/symbolic/function.pyx\n**********************************************************************\nFile \"src/sage/symbolic/function.pyx\", line 394, in sage.symbolic.function.Function.__call__\nFailed example:\n    binomial(Qp(2)(9),5)\nException raised:\n    Traceback (most recent call last):\n      File \"/local/dakrenn/sage/6.9/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 496, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/local/dakrenn/sage/6.9/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 858, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.symbolic.function.Function.__call__[20]>\", line 1, in <module>\n        binomial(Qp(Integer(2))(Integer(9)),Integer(5))\n      File \"sage/symbolic/function.pyx\", line 851, in sage.symbolic.function.GinacFunction.__call__ (build/cythonized/sage/symbolic/function.cpp:9858)\n        res = super(GinacFunction, self).__call__(*args, **kwds)\n      File \"sage/symbolic/function.pyx\", line 998, in sage.symbolic.function.BuiltinFunction.__call__ (build/cythonized/sage/symbolic/function.cpp:11421)\n        res = super(BuiltinFunction, self).__call__(\n      File \"sage/symbolic/function.pyx\", line 511, in sage.symbolic.function.Function.__call__ (build/cythonized/sage/symbolic/function.cpp:7288)\n        res = g_function_eval2(self._serial, (<Expression>args[0])._gobj,\n      File \"sage/symbolic/pynac.pyx\", line 187, in sage.symbolic.pynac.pyExpression_to_ex (build/cythonized/sage/symbolic/pynac.cpp:4108)\n        raise TypeError(\"function did not return a symbolic expression or an element that can be coerced into a symbolic expression\")\n    TypeError: function did not return a symbolic expression or an element that can be coerced into a symbolic expression\n```",
    "created_at": "2015-11-29T11:29:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217769",
    "user": "https://github.com/dkrenn"
}
```

<div id="comment:68" align="right">comment:68</div>


```
sage -t src/sage/symbolic/function.pyx
**********************************************************************
File "src/sage/symbolic/function.pyx", line 394, in sage.symbolic.function.Function.__call__
Failed example:
    binomial(Qp(2)(9),5)
Exception raised:
    Traceback (most recent call last):
      File "/local/dakrenn/sage/6.9/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 496, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/local/dakrenn/sage/6.9/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 858, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.symbolic.function.Function.__call__[20]>", line 1, in <module>
        binomial(Qp(Integer(2))(Integer(9)),Integer(5))
      File "sage/symbolic/function.pyx", line 851, in sage.symbolic.function.GinacFunction.__call__ (build/cythonized/sage/symbolic/function.cpp:9858)
        res = super(GinacFunction, self).__call__(*args, **kwds)
      File "sage/symbolic/function.pyx", line 998, in sage.symbolic.function.BuiltinFunction.__call__ (build/cythonized/sage/symbolic/function.cpp:11421)
        res = super(BuiltinFunction, self).__call__(
      File "sage/symbolic/function.pyx", line 511, in sage.symbolic.function.Function.__call__ (build/cythonized/sage/symbolic/function.cpp:7288)
        res = g_function_eval2(self._serial, (<Expression>args[0])._gobj,
      File "sage/symbolic/pynac.pyx", line 187, in sage.symbolic.pynac.pyExpression_to_ex (build/cythonized/sage/symbolic/pynac.cpp:4108)
        raise TypeError("function did not return a symbolic expression or an element that can be coerced into a symbolic expression")
    TypeError: function did not return a symbolic expression or an element that can be coerced into a symbolic expression
```



---

archive/issue_events_236195.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-11-29T13:37:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-236195"
}
```



---

archive/issue_events_236196.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-11-29T13:37:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-236196"
}
```



---

archive/issue_comments_217770.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">comment:69</div>\n\nYes, this is because of #17790, and for that reason this ticket is pending (but needs review for everything else).",
    "created_at": "2015-11-29T13:37:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217770",
    "user": "https://github.com/rwst"
}
```

<div id="comment:69" align="right">comment:69</div>

Yes, this is because of #17790, and for that reason this ticket is pending (but needs review for everything else).



---

archive/issue_events_236197.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-06-14T05:46:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-236197"
}
```



---

archive/issue_events_236198.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-06-14T05:46:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-236198"
}
```



---

archive/issue_comments_217771.json:
```json
{
    "body": "Changed branch from **[u/rws/16671](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/16671)** to **[u/arminstraub/ticket/16671/harmonic_numbers](https://github.com/sagemath/sagetrac-mirror/tree/u/arminstraub/ticket/16671/harmonic_numbers)**",
    "created_at": "2016-08-17T22:33:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217771",
    "user": "https://github.com/arminstraub"
}
```

Changed branch from **[u/rws/16671](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/16671)** to **[u/arminstraub/ticket/16671/harmonic_numbers](https://github.com/sagemath/sagetrac-mirror/tree/u/arminstraub/ticket/16671/harmonic_numbers)**



---

archive/issue_events_236199.json:
```json
{
    "actor": "https://github.com/arminstraub",
    "created_at": "2016-08-17T22:33:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-236199"
}
```



---

archive/issue_events_236200.json:
```json
{
    "actor": "https://github.com/arminstraub",
    "created_at": "2016-08-17T22:33:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-236200"
}
```



---

archive/issue_events_236201.json:
```json
{
    "actor": "https://github.com/arminstraub",
    "created_at": "2016-08-17T22:33:37Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "milestone_number": null,
    "milestone_title": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-236201"
}
```



---

archive/issue_events_236202.json:
```json
{
    "actor": "https://github.com/arminstraub",
    "created_at": "2016-08-17T22:33:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/pending",
    "label_color": "008080",
    "label_name": "pending",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-236202"
}
```



---

archive/issue_comments_217772.json:
```json
{
    "body": "<div id=\"comment:71\" align=\"right\">comment:71</div>\n\nI have merged the code with the current codebase and simplified `Function_harmonic_number_generalized._eval_` and ` Function_harmonic_number._eval_` (please check that I didn't oversimplify).\n\nWhen merging the code into the current codebase, there was the following conflict in `symbolic/function.pyx`:\n\n```\n<<<<<<< HEAD\n=======\n                # There is no natural coercion from QQbar to the symbolic ring\n                # in order to support\n                #     sage: QQbar(sqrt(2)) + sqrt(3)\n                #     3.146264369941973?\n                # to work around this limitation, we manually convert\n                # elements of QQbar to symbolic expressions here\n                from sage.rings.qqbar import QQbar, AA\n                from sage.rings.padics.padic_generic_element import pAdicGenericElement\n                nargs = [None]*len(args)\n                for i in range(len(args)):\n                    carg = args[i]\n                    if (isinstance(carg, Element) and\n                            ((<Element>carg)._parent is QQbar or\n                            (<Element>carg)._parent is AA or\n                            isinstance(carg, pAdicGenericElement))):\n                        nargs[i] = SR(carg)\n                    else:\n                        try:\n                            nargs[i] = SR.coerce(carg)\n                        except Exception:\n                            raise TypeError, \"cannot coerce arguments: %s\"%(err)\n                args = nargs\n>>>>>>> FETCH_HEAD\n```\nIt was unclear to me to which degree the underlying code had changed, which is why this code for working with `QQbar` over the symbolic ring is not merged into the branch I posted.\n\nIn any case, it seems to me that any such change might be better suited for a separate ticket because it is not specific to harmonic numbers.  Consequently, I also removed from `symbolic/function.pyx` the doctest\n\n```\n            sage: binomial(Qp(2)(9),5)\n            126\n```\nas well as from `functions/log.py` the doctests:\n\n```\n            sage: harmonic_number(Qp(5)(10),1)\n            4*5^-1 + 2 + 2*5 + 4*5^2 + 3*5^3 + 5^4 + ...\n            sage: harmonic_number(Qp(5)(10),2)\n            4*5^-1 + 3 + 5 + 3*5^2 + 2*5^3 + 3*5^5 + ...\n...\n            sage: harmonic_number(Qp(5)(3))\n            1 + 5 + 4*5^2 + 4*5^4 + 4*5^6 + ...\n```\nI think that a separate ticket should be used for uniformly fixing the coercion/conversion of p-adics to the symbolic ring.  Since the present code doesn't touch these issues, I have removed the dependency on #17790.\n\nBy the way, I liked the symbolic sum you were using for computing `harmonic_number(n)` when `n` is a rational number.  While testing this, I noticed that `sum(1/x/(1/5+x),x,1,infinity)` results in an error.  On the other hand, using the present code, we have:\n\n```\nsage: harmonic_number(1/5)\neuler_gamma + psi(6/5)\nsage: _.full_simplify()\n-1/4*(sqrt(5) + 1)*log(1/2*sqrt(5) + 5/2) + 1/4*(sqrt(5) - 1)*log(-1/2*sqrt(5) + 5/2) - 1/10*pi*sqrt(10*sqrt(5) + 25) - log(5) + 5\n```\n\nThe only other changes I made were small touches to the doc strings.  A quick `sage -t src/sage/functions` did not reveal any troubles.\n\nThank you for the nice work!  It would be great to finally have harmonic numbers in Sage.",
    "created_at": "2016-08-17T22:33:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217772",
    "user": "https://github.com/arminstraub"
}
```

<div id="comment:71" align="right">comment:71</div>

I have merged the code with the current codebase and simplified `Function_harmonic_number_generalized._eval_` and ` Function_harmonic_number._eval_` (please check that I didn't oversimplify).

When merging the code into the current codebase, there was the following conflict in `symbolic/function.pyx`:

```
<<<<<<< HEAD
=======
                # There is no natural coercion from QQbar to the symbolic ring
                # in order to support
                #     sage: QQbar(sqrt(2)) + sqrt(3)
                #     3.146264369941973?
                # to work around this limitation, we manually convert
                # elements of QQbar to symbolic expressions here
                from sage.rings.qqbar import QQbar, AA
                from sage.rings.padics.padic_generic_element import pAdicGenericElement
                nargs = [None]*len(args)
                for i in range(len(args)):
                    carg = args[i]
                    if (isinstance(carg, Element) and
                            ((<Element>carg)._parent is QQbar or
                            (<Element>carg)._parent is AA or
                            isinstance(carg, pAdicGenericElement))):
                        nargs[i] = SR(carg)
                    else:
                        try:
                            nargs[i] = SR.coerce(carg)
                        except Exception:
                            raise TypeError, "cannot coerce arguments: %s"%(err)
                args = nargs
>>>>>>> FETCH_HEAD
```
It was unclear to me to which degree the underlying code had changed, which is why this code for working with `QQbar` over the symbolic ring is not merged into the branch I posted.

In any case, it seems to me that any such change might be better suited for a separate ticket because it is not specific to harmonic numbers.  Consequently, I also removed from `symbolic/function.pyx` the doctest

```
            sage: binomial(Qp(2)(9),5)
            126
```
as well as from `functions/log.py` the doctests:

```
            sage: harmonic_number(Qp(5)(10),1)
            4*5^-1 + 2 + 2*5 + 4*5^2 + 3*5^3 + 5^4 + ...
            sage: harmonic_number(Qp(5)(10),2)
            4*5^-1 + 3 + 5 + 3*5^2 + 2*5^3 + 3*5^5 + ...
...
            sage: harmonic_number(Qp(5)(3))
            1 + 5 + 4*5^2 + 4*5^4 + 4*5^6 + ...
```
I think that a separate ticket should be used for uniformly fixing the coercion/conversion of p-adics to the symbolic ring.  Since the present code doesn't touch these issues, I have removed the dependency on #17790.

By the way, I liked the symbolic sum you were using for computing `harmonic_number(n)` when `n` is a rational number.  While testing this, I noticed that `sum(1/x/(1/5+x),x,1,infinity)` results in an error.  On the other hand, using the present code, we have:

```
sage: harmonic_number(1/5)
euler_gamma + psi(6/5)
sage: _.full_simplify()
-1/4*(sqrt(5) + 1)*log(1/2*sqrt(5) + 5/2) + 1/4*(sqrt(5) - 1)*log(-1/2*sqrt(5) + 5/2) - 1/10*pi*sqrt(10*sqrt(5) + 25) - log(5) + 5
```

The only other changes I made were small touches to the doc strings.  A quick `sage -t src/sage/functions` did not reveal any troubles.

Thank you for the nice work!  It would be great to finally have harmonic numbers in Sage.



---

archive/issue_comments_217773.json:
```json
{
    "body": "Changed commit from **[`d60311e`](https://github.com/sagemath/sagetrac-mirror/commit/d60311eda7cce822b74480550498da09b34b7a63)** to **[`9042104`](https://github.com/sagemath/sagetrac-mirror/commit/9042104196f2d3b9822b3827aa2bbd70097f7b95)**",
    "created_at": "2016-08-17T22:33:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217773",
    "user": "https://github.com/arminstraub"
}
```

Changed commit from **[`d60311e`](https://github.com/sagemath/sagetrac-mirror/commit/d60311eda7cce822b74480550498da09b34b7a63)** to **[`9042104`](https://github.com/sagemath/sagetrac-mirror/commit/9042104196f2d3b9822b3827aa2bbd70097f7b95)**



---

archive/issue_comments_217774.json:
```json
{
    "body": "Changed dependencies from **#17790** to none",
    "created_at": "2016-08-17T22:33:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217774",
    "user": "https://github.com/arminstraub"
}
```

Changed dependencies from **#17790** to none



---

archive/issue_comments_217775.json:
```json
{
    "body": "Reviewer: **Ralf Stephan**",
    "created_at": "2016-08-18T06:49:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217775",
    "user": "https://github.com/rwst"
}
```

Reviewer: **Ralf Stephan**



---

archive/issue_events_236203.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-08-18T06:49:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-236203"
}
```



---

archive/issue_events_236204.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-08-18T06:49:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-236204"
}
```



---

archive/issue_comments_217776.json:
```json
{
    "body": "<div id=\"comment:72\" align=\"right\">comment:72</div>\n\nI agree with your changes, especially the removal of the dependency on #17790, this specialty is stuff for another ticket. I'm assuming you reviewed my code, so I set positive now, after more extensive tests pass here.\n\nPlease add your name in the Author and Reviewer fields. Thanks.",
    "created_at": "2016-08-18T06:49:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217776",
    "user": "https://github.com/rwst"
}
```

<div id="comment:72" align="right">comment:72</div>

I agree with your changes, especially the removal of the dependency on #17790, this specialty is stuff for another ticket. I'm assuming you reviewed my code, so I set positive now, after more extensive tests pass here.

Please add your name in the Author and Reviewer fields. Thanks.



---

archive/issue_comments_217777.json:
```json
{
    "body": "Changed author from **Ralf Stephan** to **Ralf Stephan, Armin Straub**",
    "created_at": "2016-08-18T10:35:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217777",
    "user": "https://github.com/arminstraub"
}
```

Changed author from **Ralf Stephan** to **Ralf Stephan, Armin Straub**



---

archive/issue_comments_217778.json:
```json
{
    "body": "<div id=\"comment:73\" align=\"right\">comment:73</div>\n\nThanks for checking!\n\nYes, I did also review your code.  I don't know enough about maxima and the intricacies of interfacing it, but it is my understanding that that part of the code was checked by you and Nils, and I didn't run into any additional trouble.",
    "created_at": "2016-08-18T10:35:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217778",
    "user": "https://github.com/arminstraub"
}
```

<div id="comment:73" align="right">comment:73</div>

Thanks for checking!

Yes, I did also review your code.  I don't know enough about maxima and the intricacies of interfacing it, but it is my understanding that that part of the code was checked by you and Nils, and I didn't run into any additional trouble.



---

archive/issue_comments_217779.json:
```json
{
    "body": "Changed reviewer from **Ralf Stephan** to **Ralf Stephan, Armin Straub**",
    "created_at": "2016-08-18T10:35:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217779",
    "user": "https://github.com/arminstraub"
}
```

Changed reviewer from **Ralf Stephan** to **Ralf Stephan, Armin Straub**



---

archive/issue_comments_217780.json:
```json
{
    "body": "<div id=\"comment:74\" align=\"right\">comment:74</div>\n\nThe patchbot complains about `_swap_harmonic` not having a doctest.  Do we need to add one despite the underscore in the name?\n\nAlso, the bot indicates an issue with startup_modules, but I couldn't make sense of it...",
    "created_at": "2016-08-19T21:25:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217780",
    "user": "https://github.com/arminstraub"
}
```

<div id="comment:74" align="right">comment:74</div>

The patchbot complains about `_swap_harmonic` not having a doctest.  Do we need to add one despite the underscore in the name?

Also, the bot indicates an issue with startup_modules, but I couldn't make sense of it...



---

archive/issue_comments_217781.json:
```json
{
    "body": "<div id=\"comment:75\" align=\"right\">comment:75</div>\n\nI would ignore both but let's wait for the release manager.",
    "created_at": "2016-08-20T06:18:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217781",
    "user": "https://github.com/rwst"
}
```

<div id="comment:75" align="right">comment:75</div>

I would ignore both but let's wait for the release manager.



---

archive/issue_comments_217782.json:
```json
{
    "body": "Changed branch from **[u/arminstraub/ticket/16671/harmonic_numbers](https://github.com/sagemath/sagetrac-mirror/tree/u/arminstraub/ticket/16671/harmonic_numbers)** to **[`9042104`](https://github.com/sagemath/sagetrac-mirror/commit/9042104196f2d3b9822b3827aa2bbd70097f7b95)**",
    "created_at": "2016-08-21T13:14:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-217782",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/arminstraub/ticket/16671/harmonic_numbers](https://github.com/sagemath/sagetrac-mirror/tree/u/arminstraub/ticket/16671/harmonic_numbers)** to **[`9042104`](https://github.com/sagemath/sagetrac-mirror/commit/9042104196f2d3b9822b3827aa2bbd70097f7b95)**



---

archive/issue_events_236205.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-08-21T13:14:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-236205"
}
```



---

archive/issue_events_236206.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "699518a5f291070f465658f0a514450232ddca39",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2016-08-21T13:14:00Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-236206"
}
```
