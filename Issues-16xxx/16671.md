# Issue 16671: implement harmonic number function H(n,m)

archive/issues_016434.json:
```json
{
    "assignees": [],
    "body": "H(n,m) belongs to the holonomic repertoir and should be available in Sage, both numerically and symbolically. For some info, see https://groups.google.com/forum/#!topic/sage-devel/uaA0yU7dZHU and https://en.wikipedia.org/wiki/Harmonic_number\n\nThis is actually a defect because we leave a Maxima result undefined:\n\n```\nsage: sum(1/k^3,k,1,n)\ngen_harmonic_number(3, n)\nsage: gen_harmonic_number?\nObject `gen_harmonic_number` not found.\n```\n\n\nCC:  @eviatarbach @dkrenn\n\nKeywords: **special, log**\n\nBranch/Commit: **[9042104](https://github.com/sagemath/sagetrac-mirror/commit/9042104196f2d3b9822b3827aa2bbd70097f7b95)**\n\nReviewer: **Ralf Stephan, Armin Straub**\n\nAuthor: **Ralf Stephan, Armin Straub**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/16671_\n\n",
    "closed_at": "2016-08-21T13:14:00Z",
    "created_at": "2014-07-17T16:03:35Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20symbolics",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "implement harmonic number function H(n,m)",
    "type": "issue",
    "updated_at": "2016-08-21T13:14:00Z",
    "url": "https://github.com/sagemath/sage/issues/16671",
    "user": "https://github.com/rwst"
}
```
H(n,m) belongs to the holonomic repertoir and should be available in Sage, both numerically and symbolically. For some info, see https://groups.google.com/forum/#!topic/sage-devel/uaA0yU7dZHU and https://en.wikipedia.org/wiki/Harmonic_number

This is actually a defect because we leave a Maxima result undefined:

```
sage: sum(1/k^3,k,1,n)
gen_harmonic_number(3, n)
sage: gen_harmonic_number?
Object `gen_harmonic_number` not found.
```


CC:  @eviatarbach @dkrenn

Keywords: **special, log**

Branch/Commit: **[9042104](https://github.com/sagemath/sagetrac-mirror/commit/9042104196f2d3b9822b3827aa2bbd70097f7b95)**

Reviewer: **Ralf Stephan, Armin Straub**

Author: **Ralf Stephan, Armin Straub**

_Issue created by migration from https://trac.sagemath.org/ticket/16671_





---

archive/issue_events_220732.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-07-17T16:03:35Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-220732"
}
```



---

archive/issue_events_220733.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-07-17T16:03:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20symbolics",
    "label_color": "0000ff",
    "label_name": "component: symbolics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-220733"
}
```



---

archive/issue_events_220734.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-07-17T16:03:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-220734"
}
```



---

archive/issue_events_220735.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-07-17T16:03:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-220735"
}
```



---

archive/issue_comments_220235.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nFor exact values, FLINT has arith_harmonic_number()",
    "created_at": "2014-07-17T16:37:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220235",
    "user": "https://github.com/fredrik-johansson"
}
```

<a id='comment:1'>Comment 1:</a>
For exact values, FLINT has arith_harmonic_number()



---

archive/issue_comments_220236.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nReplying to [@fredrik-johansson](#comment%3A1):\n> For exact values, FLINT has arith_harmonic_number()\n\nUnfortunately, neither FLINT nor mpmath implements the generalized H(m,n) returned by Maxima in the code example.",
    "created_at": "2014-07-26T13:54:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220236",
    "user": "https://github.com/rwst"
}
```

<a id='comment:2'>Comment 2:</a>
Replying to [@fredrik-johansson](#comment%3A1):
> For exact values, FLINT has arith_harmonic_number()

Unfortunately, neither FLINT nor mpmath implements the generalized H(m,n) returned by Maxima in the code example.



---

archive/issue_comments_220237.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,11 @@\n H_n belongs to the holonomic repertoir and should be available in Sage, both numerically and symbolically. For some info, see https://groups.google.com/forum/#!topic/sage-devel/uaA0yU7dZHU and https://en.wikipedia.org/wiki/Harmonic_number\n+\n+This is actually a defect because we leave a Maxima result undefined:\n+\n+```\n+sage: sum(1/k^3,k,1,n)\n+gen_harmonic_number(3, n)\n+sage: gen_harmonic_number?\n+Object `gen_harmonic_number` not found.\n+```\n+\n``````\n",
    "created_at": "2014-07-26T13:54:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220237",
    "user": "https://github.com/rwst"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,11 @@
 H_n belongs to the holonomic repertoir and should be available in Sage, both numerically and symbolically. For some info, see https://groups.google.com/forum/#!topic/sage-devel/uaA0yU7dZHU and https://en.wikipedia.org/wiki/Harmonic_number
+
+This is actually a defect because we leave a Maxima result undefined:
+
+```
+sage: sum(1/k^3,k,1,n)
+gen_harmonic_number(3, n)
+sage: gen_harmonic_number?
+Object `gen_harmonic_number` not found.
+```
+
``````




---

archive/issue_events_220736.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-07-26T13:54:54Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "title_is": "implement harmonic number function H(n,m)",
    "title_was": "implement harmonic number function H_n",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-220736"
}
```



---

archive/issue_comments_220238.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-H_n belongs to the holonomic repertoir and should be available in Sage, both numerically and symbolically. For some info, see https://groups.google.com/forum/#!topic/sage-devel/uaA0yU7dZHU and https://en.wikipedia.org/wiki/Harmonic_number\n+H(n,m) belongs to the holonomic repertoir and should be available in Sage, both numerically and symbolically. For some info, see https://groups.google.com/forum/#!topic/sage-devel/uaA0yU7dZHU and https://en.wikipedia.org/wiki/Harmonic_number\n \n This is actually a defect because we leave a Maxima result undefined:\n \n``````\n",
    "created_at": "2014-07-26T13:55:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220238",
    "user": "https://github.com/rwst"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-H_n belongs to the holonomic repertoir and should be available in Sage, both numerically and symbolically. For some info, see https://groups.google.com/forum/#!topic/sage-devel/uaA0yU7dZHU and https://en.wikipedia.org/wiki/Harmonic_number
+H(n,m) belongs to the holonomic repertoir and should be available in Sage, both numerically and symbolically. For some info, see https://groups.google.com/forum/#!topic/sage-devel/uaA0yU7dZHU and https://en.wikipedia.org/wiki/Harmonic_number
 
 This is actually a defect because we leave a Maxima result undefined:
 
``````




---

archive/issue_events_220737.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-07-26T13:55:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-220737"
}
```



---

archive/issue_events_220738.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-07-26T13:55:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-220738"
}
```



---

archive/issue_comments_220239.json:
```json
{
    "body": "Branch: **[u/rws/implement_harmonic_number_function_h_n_m_](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/implement_harmonic_number_function_h_n_m_)**",
    "created_at": "2014-07-27T16:04:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220239",
    "user": "https://github.com/rwst"
}
```

Branch: **[u/rws/implement_harmonic_number_function_h_n_m_](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/implement_harmonic_number_function_h_n_m_)**



---

archive/issue_events_220739.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-07-27T16:06:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-220739"
}
```



---

archive/issue_comments_220240.json:
```json
{
    "body": "Commit: **[5310ca1](https://github.com/sagemath/sagetrac-mirror/commit/5310ca10a440c2536da3f043deba80f5c35d041a)**",
    "created_at": "2014-07-27T16:06:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220240",
    "user": "https://github.com/rwst"
}
```

Commit: **[5310ca1](https://github.com/sagemath/sagetrac-mirror/commit/5310ca10a440c2536da3f043deba80f5c35d041a)**



---

archive/issue_comments_220241.json:
```json
{
    "body": "Author: **Ralf Stephan**",
    "created_at": "2014-07-27T16:06:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220241",
    "user": "https://github.com/rwst"
}
```

Author: **Ralf Stephan**



---

archive/issue_comments_220242.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nIt is already implemented, I'm just waiting for https://groups.google.com/forum/?hl=en#!topic/sage-devel/SM_FLL33t2g as to argument order of the generalized version.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5310ca10a440c2536da3f043deba80f5c35d041a\">5310ca1</a></td><td><code>16671: implement harmonic number function H(n,m) (modulo argument order)</code></td></tr></table>\n",
    "created_at": "2014-07-27T16:06:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220242",
    "user": "https://github.com/rwst"
}
```

<a id='comment:5'>Comment 5:</a>
It is already implemented, I'm just waiting for https://groups.google.com/forum/?hl=en#!topic/sage-devel/SM_FLL33t2g as to argument order of the generalized version.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5310ca10a440c2536da3f043deba80f5c35d041a">5310ca1</a></td><td><code>16671: implement harmonic number function H(n,m) (modulo argument order)</code></td></tr></table>




---

archive/issue_comments_220243.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nReplying to [@rwst](#comment%3A5):\n> It is already implemented, I'm just waiting for https://groups.google.com/forum/?hl=en#!topic/sage-devel/SM_FLL33t2g as to argument order of the generalized version.\n> \n> ---\n> New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5310ca10a440c2536da3f043deba80f5c35d041a\">5310ca1</a></td><td><code>16671: implement harmonic number function H(n,m) (modulo argument order)</code></td></tr></table>\n\nFor `maxima_lib` you definitely have to implement a special conversion rule (in both `special_max_to_sage` and `special_sage_to_max`). It'll be a very simple conversion rule, though, so it should be quick to write. There are plenty of examples of entries there already that have to do more complicated manipulations, so just swapping arguments will be easy to figure out.\n\nFor conversions to other maxima interfaces a good start may the special examples in `maxima_lib`. It seems that implementing `_maxima_init_evaled_` might do the trick for conversion to maxima.\n\nThe workhorse for the other direction is `sage.calculus.calculus.symbolic_expression_from_maxima_string` which defines regexes for `polylog` etc., so it seems that any special conversion rules would need to be added there.\n\nYour conversion is not *that* strange though. You just need to swap arguments, which means no special conversion at all as long as you can get it converted to a sage function that expects the arguments in the required order and produces the desired symbolic expression.\n\nIt seems that as long as you can get an entry into `sage.symbolic.pynac.symbol_table.get('maxima', {})` that has a argument-swapping function associated with it, you might be good to go. `sage.symbolic.pynac.register_symbol` might do the trick for that.",
    "created_at": "2014-07-27T18:32:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220243",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:6'>Comment 6:</a>
Replying to [@rwst](#comment%3A5):
> It is already implemented, I'm just waiting for https://groups.google.com/forum/?hl=en#!topic/sage-devel/SM_FLL33t2g as to argument order of the generalized version.
> 
> ---
> New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5310ca10a440c2536da3f043deba80f5c35d041a">5310ca1</a></td><td><code>16671: implement harmonic number function H(n,m) (modulo argument order)</code></td></tr></table>

For `maxima_lib` you definitely have to implement a special conversion rule (in both `special_max_to_sage` and `special_sage_to_max`). It'll be a very simple conversion rule, though, so it should be quick to write. There are plenty of examples of entries there already that have to do more complicated manipulations, so just swapping arguments will be easy to figure out.

For conversions to other maxima interfaces a good start may the special examples in `maxima_lib`. It seems that implementing `_maxima_init_evaled_` might do the trick for conversion to maxima.

The workhorse for the other direction is `sage.calculus.calculus.symbolic_expression_from_maxima_string` which defines regexes for `polylog` etc., so it seems that any special conversion rules would need to be added there.

Your conversion is not *that* strange though. You just need to swap arguments, which means no special conversion at all as long as you can get it converted to a sage function that expects the arguments in the required order and produces the desired symbolic expression.

It seems that as long as you can get an entry into `sage.symbolic.pynac.symbol_table.get('maxima', {})` that has a argument-swapping function associated with it, you might be good to go. `sage.symbolic.pynac.register_symbol` might do the trick for that.



---

archive/issue_comments_220244.json:
```json
{
    "body": "Changed commit from **[5310ca1](https://github.com/sagemath/sagetrac-mirror/commit/5310ca10a440c2536da3f043deba80f5c35d041a)** to **[ebc93ec](https://github.com/sagemath/sagetrac-mirror/commit/ebc93ecacf652b5b83077ba20c22b37f8178ca78)**",
    "created_at": "2014-07-28T09:05:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220244",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[5310ca1](https://github.com/sagemath/sagetrac-mirror/commit/5310ca10a440c2536da3f043deba80f5c35d041a)** to **[ebc93ec](https://github.com/sagemath/sagetrac-mirror/commit/ebc93ecacf652b5b83077ba20c22b37f8178ca78)**



---

archive/issue_comments_220245.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/61572c9a3a2e0a1a812fb97d95dc4a992700334b\">61572c9</a></td><td><code>16671: swap arguments wrt maxima(_lib); add more documentation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ebc93ecacf652b5b83077ba20c22b37f8178ca78\">ebc93ec</a></td><td><code>16671: fix doc typo</code></td></tr></table>\n",
    "created_at": "2014-07-28T09:05:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220245",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:7'>Comment 7:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/61572c9a3a2e0a1a812fb97d95dc4a992700334b">61572c9</a></td><td><code>16671: swap arguments wrt maxima(_lib); add more documentation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ebc93ecacf652b5b83077ba20c22b37f8178ca78">ebc93ec</a></td><td><code>16671: fix doc typo</code></td></tr></table>




---

archive/issue_comments_220246.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nThanks, that was absolutely helpful. I'll put a link on the symbolics wiki page.\n\nPlease review.",
    "created_at": "2014-07-28T09:08:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220246",
    "user": "https://github.com/rwst"
}
```

<a id='comment:8'>Comment 8:</a>
Thanks, that was absolutely helpful. I'll put a link on the symbolics wiki page.

Please review.



---

archive/issue_comments_220247.json:
```json
{
    "body": "Changed keywords from **** to **special, log**",
    "created_at": "2014-07-28T09:08:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220247",
    "user": "https://github.com/rwst"
}
```

Changed keywords from **** to **special, log**



---

archive/issue_events_220740.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-07-28T09:08:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-220740"
}
```



---

archive/issue_events_220741.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-07-28T09:08:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-220741"
}
```



---

archive/issue_comments_220248.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nA few remarks.\n- in the `maxima_harmonic` regular expression you seem to be trying to find the argument by matching subexpressions. I'm afraid that won't work reliably. If you put in arguments that use parentheses and commas itself and you'll find the regex gets it wrong. Indeed, the example you've taken it from is equally broken:\n\n```\nsage: maxima_calculus(psi(psi(x,x),x))._sage_()\nTypeError: unable to make sense of Maxima expression 'psi[psi(x,x)](x)' in Sage\n```\n(never mind that this is a ValueError and not a TypeError). The maxima_lib specific translator does not have trouble with this:\n\n```\nsage: max_to_sr(maxima_calculus(psi(psi(x,x),x)).ecl())\npsi(psi(x, x), x)\n```\nRegular languages are not sufficient to describe expression languages (the nested parentheses can't be expressed in a regular language--they need a stack or something similar). Can't you get that conversion by giving an appropriate `sage.symbolic.pynac.register_symbol`? then you get to use the parentheses parser that is already in place.\n\n- for this line, you took a way too complicated example.\n\n```\nsage.functions.log.harmonic_number : lambda N,X : [[mqapply],[[max_harmo, max_array],X],N],\n```\nfrom\n\n```\nsage: maxima_calculus(\"gen_harmonic_number(a,b)\").ecl()\n<ECL: (($GEN_HARMONIC_NUMBER SIMP) $A $B)>\n```\nyou see that this should simply be\n\n```\nsage.functions.log.harmonic_number : lambda N,X : [[max_harmo],X,N],\n```\nWith your version one gets:\n\n```\nsage: maxima_calculus(EclObject([[\"mqapply\"],[[\"$gen_harmonic_number\",\"array\"],10],20]))\ngen_harmonic_number[10](20)\n```\nwhich is not the desired form, and you'll find this form can't be converted back either.",
    "created_at": "2014-07-28T16:19:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220248",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:9'>Comment 9:</a>
A few remarks.
- in the `maxima_harmonic` regular expression you seem to be trying to find the argument by matching subexpressions. I'm afraid that won't work reliably. If you put in arguments that use parentheses and commas itself and you'll find the regex gets it wrong. Indeed, the example you've taken it from is equally broken:

```
sage: maxima_calculus(psi(psi(x,x),x))._sage_()
TypeError: unable to make sense of Maxima expression 'psi[psi(x,x)](x)' in Sage
```
(never mind that this is a ValueError and not a TypeError). The maxima_lib specific translator does not have trouble with this:

```
sage: max_to_sr(maxima_calculus(psi(psi(x,x),x)).ecl())
psi(psi(x, x), x)
```
Regular languages are not sufficient to describe expression languages (the nested parentheses can't be expressed in a regular language--they need a stack or something similar). Can't you get that conversion by giving an appropriate `sage.symbolic.pynac.register_symbol`? then you get to use the parentheses parser that is already in place.

- for this line, you took a way too complicated example.

```
sage.functions.log.harmonic_number : lambda N,X : [[mqapply],[[max_harmo, max_array],X],N],
```
from

```
sage: maxima_calculus("gen_harmonic_number(a,b)").ecl()
<ECL: (($GEN_HARMONIC_NUMBER SIMP) $A $B)>
```
you see that this should simply be

```
sage.functions.log.harmonic_number : lambda N,X : [[max_harmo],X,N],
```
With your version one gets:

```
sage: maxima_calculus(EclObject([["mqapply"],[["$gen_harmonic_number","array"],10],20]))
gen_harmonic_number[10](20)
```
which is not the desired form, and you'll find this form can't be converted back either.



---

archive/issue_comments_220249.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nBy the way, what's your most convincing argument to use an argument order opposite to that of maxima? I think your ordering agrees with what maple and mathematica have chosen, so it may well be that that is indeed the ordering that has most consensus. The wikipedia page is ambiguous since it lists `H_{n,m}=H_n^m=H_m(n)`. Referencing explicitly which convention we follow will make for a better motivated and more stable interface.",
    "created_at": "2014-07-28T19:50:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220249",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:10'>Comment 10:</a>
By the way, what's your most convincing argument to use an argument order opposite to that of maxima? I think your ordering agrees with what maple and mathematica have chosen, so it may well be that that is indeed the ordering that has most consensus. The wikipedia page is ambiguous since it lists `H_{n,m}=H_n^m=H_m(n)`. Referencing explicitly which convention we follow will make for a better motivated and more stable interface.



---

archive/issue_comments_220250.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nThe paper I looked at had H_n<sup>(m)</sup>, and Wikipedia has mostly H_n,m and H_n<sup>(m)</sup>, but the paper would not be relevant. WP is, and it's listed as reference.",
    "created_at": "2014-07-28T20:01:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220250",
    "user": "https://github.com/rwst"
}
```

<a id='comment:11'>Comment 11:</a>
The paper I looked at had H_n<sup>(m)</sup>, and Wikipedia has mostly H_n,m and H_n<sup>(m)</sup>, but the paper would not be relevant. WP is, and it's listed as reference.



---

archive/issue_comments_220251.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0b15dd1ab86552cc65d1e8d249c5ad97acb7520d\">0b15dd1</a></td><td><code>Merge branch 'develop' into t/16671/implement_harmonic_number_function_h_n_m_</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0c93bfe4da1bd2b3a77865ae0a6878007726fff8\">0c93bfe</a></td><td><code>16671: fix maxima_lib interface</code></td></tr></table>\n",
    "created_at": "2014-07-29T14:45:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220251",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:12'>Comment 12:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0b15dd1ab86552cc65d1e8d249c5ad97acb7520d">0b15dd1</a></td><td><code>Merge branch 'develop' into t/16671/implement_harmonic_number_function_h_n_m_</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0c93bfe4da1bd2b3a77865ae0a6878007726fff8">0c93bfe</a></td><td><code>16671: fix maxima_lib interface</code></td></tr></table>




---

archive/issue_comments_220252.json:
```json
{
    "body": "Changed commit from **[ebc93ec](https://github.com/sagemath/sagetrac-mirror/commit/ebc93ecacf652b5b83077ba20c22b37f8178ca78)** to **[0c93bfe](https://github.com/sagemath/sagetrac-mirror/commit/0c93bfe4da1bd2b3a77865ae0a6878007726fff8)**",
    "created_at": "2014-07-29T14:45:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220252",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[ebc93ec](https://github.com/sagemath/sagetrac-mirror/commit/ebc93ecacf652b5b83077ba20c22b37f8178ca78)** to **[0c93bfe](https://github.com/sagemath/sagetrac-mirror/commit/0c93bfe4da1bd2b3a77865ae0a6878007726fff8)**



---

archive/issue_comments_220253.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nReplying to [@nbruin](#comment%3A9):\n> Regular languages are not sufficient to describe expression languages (the nested parentheses can't be expressed in a regular language--they need a stack or something similar). Can't you get that conversion by giving an appropriate `sage.symbolic.pynac.register_symbol`? then you get to use the parentheses parser that is already in place.\n\nIs there ready mechanics for this? I can't find one. Do you expect me to implement it?\n> you see that this should simply be\n> \n> ```\n> sage.functions.log.harmonic_number : lambda N,X : [[max_harmo],X,N],\n> ```\n\nThanks, included.",
    "created_at": "2014-07-29T14:46:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220253",
    "user": "https://github.com/rwst"
}
```

<a id='comment:13'>Comment 13:</a>
Replying to [@nbruin](#comment%3A9):
> Regular languages are not sufficient to describe expression languages (the nested parentheses can't be expressed in a regular language--they need a stack or something similar). Can't you get that conversion by giving an appropriate `sage.symbolic.pynac.register_symbol`? then you get to use the parentheses parser that is already in place.

Is there ready mechanics for this? I can't find one. Do you expect me to implement it?
> you see that this should simply be
> 
> ```
> sage.functions.log.harmonic_number : lambda N,X : [[max_harmo],X,N],
> ```

Thanks, included.



---

archive/issue_comments_220254.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nReplying to [@rwst](#comment%3A13):\n> Replying to [@nbruin](#comment%3A9):\n> > Can't you get that conversion by giving an appropriate `sage.symbolic.pynac.register_symbol`?\n\n> Is there ready mechanics for this? I can't find one. Do you expect me to implement it?\n\nNo, just use it. If you do `search_src(\"register_symbol\")` you get a few hits on its use. The following seems to basically work without your patch so I hope you can adjust it for your purposes:\n\n```\nsage: var('x,t,s')\n(x, t, s)\nsage: function('g')\ng\nsage: def swap(a,b): return g(b,a)\nsage: sage.symbolic.pynac.register_symbol(swap,{'maxima':'gen_harmonic_number'})\nsage: sum(1/t^2,t,1,s)\ng(s, 2)\n```\nThat way, the parsing won't be more broken than for other functions (and it seems we're doing fine for most expressions nowadays). The regex for `psi` isn't really wrong, because it specifies there should be only digits between the square brackets. It is perhaps a little overly restrictive, though:\n\n```\nsage: psi(x,s)\npsi(x, s)\nsage: maxima_calculus(psi(x,s))\npsi[x](s)\nsage: maxima_calculus(psi(x,s))._sage_()\nTypeError: unable to make sense of Maxima expression 'psi[x](s)' in Sage\nsage: from sage.interfaces.maxima_lib import max_to_sr\nsage: max_to_sr(maxima_calculus(psi(x,s)).ecl()) #this doesn't rely on parsing or regexes\npsi(x, s)\n```\nI think \"parsing\" psi via regex was just a quick fix around the fact that the expression parser doesn't know what to do with square brackets (and since they're rare, you can get away with not really parsing them properly). In your case, round brackets are so common that you'll quickly get caught if you don't deal with them properly. Luckily, the parser knows how to deal with them, you just have to swap the arguments.",
    "created_at": "2014-07-29T15:33:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220254",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:14'>Comment 14:</a>
Replying to [@rwst](#comment%3A13):
> Replying to [@nbruin](#comment%3A9):
> > Can't you get that conversion by giving an appropriate `sage.symbolic.pynac.register_symbol`?

> Is there ready mechanics for this? I can't find one. Do you expect me to implement it?

No, just use it. If you do `search_src("register_symbol")` you get a few hits on its use. The following seems to basically work without your patch so I hope you can adjust it for your purposes:

```
sage: var('x,t,s')
(x, t, s)
sage: function('g')
g
sage: def swap(a,b): return g(b,a)
sage: sage.symbolic.pynac.register_symbol(swap,{'maxima':'gen_harmonic_number'})
sage: sum(1/t^2,t,1,s)
g(s, 2)
```
That way, the parsing won't be more broken than for other functions (and it seems we're doing fine for most expressions nowadays). The regex for `psi` isn't really wrong, because it specifies there should be only digits between the square brackets. It is perhaps a little overly restrictive, though:

```
sage: psi(x,s)
psi(x, s)
sage: maxima_calculus(psi(x,s))
psi[x](s)
sage: maxima_calculus(psi(x,s))._sage_()
TypeError: unable to make sense of Maxima expression 'psi[x](s)' in Sage
sage: from sage.interfaces.maxima_lib import max_to_sr
sage: max_to_sr(maxima_calculus(psi(x,s)).ecl()) #this doesn't rely on parsing or regexes
psi(x, s)
```
I think "parsing" psi via regex was just a quick fix around the fact that the expression parser doesn't know what to do with square brackets (and since they're rare, you can get away with not really parsing them properly). In your case, round brackets are so common that you'll quickly get caught if you don't deal with them properly. Luckily, the parser knows how to deal with them, you just have to swap the arguments.



---

archive/issue_comments_220255.json:
```json
{
    "body": "Changed commit from **[0c93bfe](https://github.com/sagemath/sagetrac-mirror/commit/0c93bfe4da1bd2b3a77865ae0a6878007726fff8)** to **[fd0ccd6](https://github.com/sagemath/sagetrac-mirror/commit/fd0ccd6ea2e7f6a0abf92ee85207c011250b9496)**",
    "created_at": "2014-07-29T15:55:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220255",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[0c93bfe](https://github.com/sagemath/sagetrac-mirror/commit/0c93bfe4da1bd2b3a77865ae0a6878007726fff8)** to **[fd0ccd6](https://github.com/sagemath/sagetrac-mirror/commit/fd0ccd6ea2e7f6a0abf92ee85207c011250b9496)**



---

archive/issue_comments_220256.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e90d77bb7cb262f7c8170d2a79a28fd78561ce86\">e90d77b</a></td><td><code>16671: replace maxima interface arg swap with pynac conversion</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fd0ccd6ea2e7f6a0abf92ee85207c011250b9496\">fd0ccd6</a></td><td><code>16671: improve previous patch; handle maple swap too</code></td></tr></table>\n",
    "created_at": "2014-07-29T15:55:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220256",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:15'>Comment 15:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e90d77bb7cb262f7c8170d2a79a28fd78561ce86">e90d77b</a></td><td><code>16671: replace maxima interface arg swap with pynac conversion</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fd0ccd6ea2e7f6a0abf92ee85207c011250b9496">fd0ccd6</a></td><td><code>16671: improve previous patch; handle maple swap too</code></td></tr></table>




---

archive/issue_comments_220257.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nThanks again. I completely missed this trick, although I already created a dummy function there.",
    "created_at": "2014-07-29T15:56:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220257",
    "user": "https://github.com/rwst"
}
```

<a id='comment:16'>Comment 16:</a>
Thanks again. I completely missed this trick, although I already created a dummy function there.



---

archive/issue_comments_220258.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nSorry, this isn't really your fault, but as it turns out the whole `_maxima_init_evaled_` mechanism gets used in a way that's broken: parameters do not get processed recursively. See #16732. As an illustration:\n\n```\nsage:sage: maxima_calculus(polylog(3,polylog(3,x)))\nli[3](polylog(3,x))\n```\nNote that the second argument doesn't get appropriately processed. Your implementation suffers from the same problem.\n\nEither we change the way that `_maxima_init_evaled_` gets called (i.e., we pass it arguments that are processed by the maxima translator itself) or we must change all the `_maxima_init_evaled_` implementations to do that properly (at least a bunch presently don't). An argument against giving `_maxima_init_evaled_` preprocessed arguments is that in principle it's conceivable that a function has an argument that needs special treatment. So letting `_maxima_init_evaled_` do the recursive argument processing under its own control is the more flexible (but more onerous) scheme.",
    "created_at": "2014-07-29T20:07:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220258",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:17'>Comment 17:</a>
Sorry, this isn't really your fault, but as it turns out the whole `_maxima_init_evaled_` mechanism gets used in a way that's broken: parameters do not get processed recursively. See #16732. As an illustration:

```
sage:sage: maxima_calculus(polylog(3,polylog(3,x)))
li[3](polylog(3,x))
```
Note that the second argument doesn't get appropriately processed. Your implementation suffers from the same problem.

Either we change the way that `_maxima_init_evaled_` gets called (i.e., we pass it arguments that are processed by the maxima translator itself) or we must change all the `_maxima_init_evaled_` implementations to do that properly (at least a bunch presently don't). An argument against giving `_maxima_init_evaled_` preprocessed arguments is that in principle it's conceivable that a function has an argument that needs special treatment. So letting `_maxima_init_evaled_` do the recursive argument processing under its own control is the more flexible (but more onerous) scheme.



---

archive/issue_comments_220259.json:
```json
{
    "body": "Changed commit from **[fd0ccd6](https://github.com/sagemath/sagetrac-mirror/commit/fd0ccd6ea2e7f6a0abf92ee85207c011250b9496)** to **[4fa8dd8](https://github.com/sagemath/sagetrac-mirror/commit/4fa8dd871063de9d658a11135861d3564d215b4c)**",
    "created_at": "2014-07-30T07:10:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220259",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[fd0ccd6](https://github.com/sagemath/sagetrac-mirror/commit/fd0ccd6ea2e7f6a0abf92ee85207c011250b9496)** to **[4fa8dd8](https://github.com/sagemath/sagetrac-mirror/commit/4fa8dd871063de9d658a11135861d3564d215b4c)**



---

archive/issue_comments_220260.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/019257d05fe189efa3a8fcf156102e3af43be9da\">019257d</a></td><td><code>16671: `_maxima_init_evaled_` fix and doctest</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4fa8dd871063de9d658a11135861d3564d215b4c\">4fa8dd8</a></td><td><code>16671: fix call with m an expression: allow complex m</code></td></tr></table>\n",
    "created_at": "2014-07-30T07:10:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220260",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:18'>Comment 18:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/019257d05fe189efa3a8fcf156102e3af43be9da">019257d</a></td><td><code>16671: `_maxima_init_evaled_` fix and doctest</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4fa8dd871063de9d658a11135861d3564d215b4c">4fa8dd8</a></td><td><code>16671: fix call with m an expression: allow complex m</code></td></tr></table>




---

archive/issue_comments_220261.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nDone. I'm not sure if Maxima does the right thing here by expanding the sum. This can get messy for big integers:\n\n```\nsage: maxima_calculus(harmonic_number(3,harmonic_number(x,3),hold=True)).sage()\n1/3^harmonic_number(x, 3) + 1/2^harmonic_number(x, 3) + 1\n```\n\nI also removed the restriction on the second argument.",
    "created_at": "2014-07-30T07:15:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220261",
    "user": "https://github.com/rwst"
}
```

<a id='comment:19'>Comment 19:</a>
Done. I'm not sure if Maxima does the right thing here by expanding the sum. This can get messy for big integers:

```
sage: maxima_calculus(harmonic_number(3,harmonic_number(x,3),hold=True)).sage()
1/3^harmonic_number(x, 3) + 1/2^harmonic_number(x, 3) + 1
```

I also removed the restriction on the second argument.



---

archive/issue_comments_220262.json:
```json
{
    "body": "Changed commit from **[4fa8dd8](https://github.com/sagemath/sagetrac-mirror/commit/4fa8dd871063de9d658a11135861d3564d215b4c)** to **[e263ac4](https://github.com/sagemath/sagetrac-mirror/commit/e263ac41caa14a9ba4b537f0f5091cf012d64c3b)**",
    "created_at": "2014-08-05T14:09:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220262",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[4fa8dd8](https://github.com/sagemath/sagetrac-mirror/commit/4fa8dd871063de9d658a11135861d3564d215b4c)** to **[e263ac4](https://github.com/sagemath/sagetrac-mirror/commit/e263ac41caa14a9ba4b537f0f5091cf012d64c3b)**



---

archive/issue_comments_220263.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e263ac41caa14a9ba4b537f0f5091cf012d64c3b\">e263ac4</a></td><td><code>Merge branch 'develop' into t/16671/implement_harmonic_number_function_h_n_m_</code></td></tr></table>\n",
    "created_at": "2014-08-05T14:09:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220263",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:20'>Comment 20:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e263ac41caa14a9ba4b537f0f5091cf012d64c3b">e263ac4</a></td><td><code>Merge branch 'develop' into t/16671/implement_harmonic_number_function_h_n_m_</code></td></tr></table>




---

archive/issue_comments_220264.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nOuch, given what we've just run into on #16697 with derivatives, our `_maxima_init_evaled_` hack for swapping arguments would fail in the presence of derivatives:\n\n```\nmaxima_calculus(harmonic_number(x,y).diff(x))\n```\nShould we disallow differentiating harmonic numbers? Otherwise I think we need to rewrite how differential operators get translated. Currently, given:\n\n```\nD[0,1,2](f)(u,v,w)\n```\ngets translated basically to\n\n```\n\"diff(\"+\"f\"+\"(u,v,w)\"+\",u,1,v,1,w,1)\"\n```\nInstead, we could make the *expression* f(u,v,w) and convert that to a maxima string *as a whole* and compose that with the rest. Then we WOULD be going through `_maxima_init_evaled_` etc. There are situations where this is a little more complicated: when \"u,v,w\" are not pure, distinct, variables, then sage needs to substitute temporary place holder variables in order to express the `D[0,1,2]` operator in Leibnitz notation. (and then, after differentiation, substitute the values). Example:\n\n```\nsage: function('f')\nsage: diff( f(x+1),x)._maxima_init_()\n\"at(diff(''f(t0), t0, 1), [t0 = x + 1])\"\nsage: maxima_calculus(diff( f(x+1),x))\n?%at('diff(f(t0),t0,1),[t0=x+1])\n```\nPresently, those temporary variables `t0` do not live in Sage at all. With this change, we would have to instantiate them as symbolic variables in sage to get them converted. (I have checked before, and the `at` substitutions in maxima happen simultaneously, so symbol clashes shouldn't be an issue, other than the possibility of assumptions interfering)",
    "created_at": "2014-08-08T19:10:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220264",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:21'>Comment 21:</a>
Ouch, given what we've just run into on #16697 with derivatives, our `_maxima_init_evaled_` hack for swapping arguments would fail in the presence of derivatives:

```
maxima_calculus(harmonic_number(x,y).diff(x))
```
Should we disallow differentiating harmonic numbers? Otherwise I think we need to rewrite how differential operators get translated. Currently, given:

```
D[0,1,2](f)(u,v,w)
```
gets translated basically to

```
"diff("+"f"+"(u,v,w)"+",u,1,v,1,w,1)"
```
Instead, we could make the *expression* f(u,v,w) and convert that to a maxima string *as a whole* and compose that with the rest. Then we WOULD be going through `_maxima_init_evaled_` etc. There are situations where this is a little more complicated: when "u,v,w" are not pure, distinct, variables, then sage needs to substitute temporary place holder variables in order to express the `D[0,1,2]` operator in Leibnitz notation. (and then, after differentiation, substitute the values). Example:

```
sage: function('f')
sage: diff( f(x+1),x)._maxima_init_()
"at(diff(''f(t0), t0, 1), [t0 = x + 1])"
sage: maxima_calculus(diff( f(x+1),x))
?%at('diff(f(t0),t0,1),[t0=x+1])
```
Presently, those temporary variables `t0` do not live in Sage at all. With this change, we would have to instantiate them as symbolic variables in sage to get them converted. (I have checked before, and the `at` substitutions in maxima happen simultaneously, so symbol clashes shouldn't be an issue, other than the possibility of assumptions interfering)



---

archive/issue_comments_220265.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nOuch, this actually shows a missed conversion:\n\n```\nsage: maxima_calculus(f(x).diff(x))\n'diff(f(_SAGE_VAR_x),_SAGE_VAR_x,1)\nsage: maxima_calculus(f(x+1).diff(x)) #this is bad!\n?%at('diff(f(t0),t0,1),[t0=x+1])\n```\nand to compare:\n\n```\nsage: from sage.interfaces.maxima_lib import sr_to_max\nsage: maxima_calculus(sr_to_max(f(x+1).diff(x)))\n?%at('diff(f(_SAGE_VAR_t0),_SAGE_VAR_t0,1),[_SAGE_VAR_t0=_SAGE_VAR_x+1])\nsage: maxima_calculus(sr_to_max(f(x).diff(x)))\n'diff(f(_SAGE_VAR_x),_SAGE_VAR_x,1)\n```\nHow the temporary variable t0 gets represented doesn't matter, but `x` should absolutely be converted to `_SAGE_VAR_x`, in all cases.\n\nThe problem is in [line 505](https://github.com/sagemath/sagetrac-mirror/blob/develop/src/sage/symbolic/expression_conversions.py#n505). Changing it like this:\n\n```diff\n-            subs = [\"%s = %s\"%(t,a) for t,a in zip(temp_args,args)]\n+            subs = [\"%s = %s\"%(t._maxima_init_(),a._maxima_init_()) for t,a in zip(temp_args,args)]\n```\nand some more changes of the same nature should do the trick.\n\nThis code also shows that the temporary variables are instantiated in sage anyway, so changing the conversion wouldn't be so bad.",
    "created_at": "2014-08-08T21:15:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220265",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:22'>Comment 22:</a>
Ouch, this actually shows a missed conversion:

```
sage: maxima_calculus(f(x).diff(x))
'diff(f(_SAGE_VAR_x),_SAGE_VAR_x,1)
sage: maxima_calculus(f(x+1).diff(x)) #this is bad!
?%at('diff(f(t0),t0,1),[t0=x+1])
```
and to compare:

```
sage: from sage.interfaces.maxima_lib import sr_to_max
sage: maxima_calculus(sr_to_max(f(x+1).diff(x)))
?%at('diff(f(_SAGE_VAR_t0),_SAGE_VAR_t0,1),[_SAGE_VAR_t0=_SAGE_VAR_x+1])
sage: maxima_calculus(sr_to_max(f(x).diff(x)))
'diff(f(_SAGE_VAR_x),_SAGE_VAR_x,1)
```
How the temporary variable t0 gets represented doesn't matter, but `x` should absolutely be converted to `_SAGE_VAR_x`, in all cases.

The problem is in [line 505](https://github.com/sagemath/sagetrac-mirror/blob/develop/src/sage/symbolic/expression_conversions.py#n505). Changing it like this:

```diff
-            subs = ["%s = %s"%(t,a) for t,a in zip(temp_args,args)]
+            subs = ["%s = %s"%(t._maxima_init_(),a._maxima_init_()) for t,a in zip(temp_args,args)]
```
and some more changes of the same nature should do the trick.

This code also shows that the temporary variables are instantiated in sage anyway, so changing the conversion wouldn't be so bad.



---

archive/issue_comments_220266.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nSee #16785 for differential operator translation fix.",
    "created_at": "2014-08-08T22:47:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220266",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:23'>Comment 23:</a>
See #16785 for differential operator translation fix.



---

archive/issue_comments_220267.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\nReplying to [@nbruin](#comment%3A21):\n> Ouch, given what we've just run into on #16697 with derivatives, our `_maxima_init_evaled_` hack for swapping arguments would fail in the presence of derivatives:\n> \n> ```\n> maxima_calculus(harmonic_number(x,y).diff(x))\n> ```\n> Should we disallow differentiating harmonic numbers?\n\nI think so, there's really no need for it.",
    "created_at": "2014-08-09T15:29:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220267",
    "user": "https://github.com/rwst"
}
```

<a id='comment:24'>Comment 24:</a>
Replying to [@nbruin](#comment%3A21):
> Ouch, given what we've just run into on #16697 with derivatives, our `_maxima_init_evaled_` hack for swapping arguments would fail in the presence of derivatives:
> 
> ```
> maxima_calculus(harmonic_number(x,y).diff(x))
> ```
> Should we disallow differentiating harmonic numbers?

I think so, there's really no need for it.



---

archive/issue_comments_220268.json:
```json
{
    "body": "<a id='comment:25'>Comment 25:</a>\nReplying to [@rwst](#comment%3A24):\n> > Should we disallow differentiating harmonic numbers?\n\n> I think so, there's really no need for it.\n\nWith #16785 (which needs to be merged anyway) the urgency is reduced. Given the complex continuations that exist for the harmonic number function, perhaps we shouldn't go out of our way prohibiting it, even if we don't have any functionality for it (yet).",
    "created_at": "2014-08-09T18:07:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220268",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:25'>Comment 25:</a>
Replying to [@rwst](#comment%3A24):
> > Should we disallow differentiating harmonic numbers?

> I think so, there's really no need for it.

With #16785 (which needs to be merged anyway) the urgency is reduced. Given the complex continuations that exist for the harmonic number function, perhaps we shouldn't go out of our way prohibiting it, even if we don't have any functionality for it (yet).



---

archive/issue_events_220742.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-220742"
}
```



---

archive/issue_events_220743.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-220743"
}
```



---

archive/issue_comments_220269.json:
```json
{
    "body": "<a id='comment:27'>Comment 27:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9c0f66dca5d59aef571c69fe7561b6446ec23d71\">9c0f66d</a></td><td><code>trac #16785: improve differential operator translation to maxima</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ef6d620a9d75cc9c32904255db7da93d698967f5\">ef6d620</a></td><td><code>Merge commit '9c0f66dca5d59aef571c69fe7561b6446ec23d71' of trac.sagemath.org:sage into t/16671/implement_harmonic_number_function_h_n_m_</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/860820fd5d454bfd4e2e8f40af82e724537f45dc\">860820f</a></td><td><code>Merge branch 'develop' into t/16671/implement_harmonic_number_function_h_n_m_</code></td></tr></table>\n",
    "created_at": "2014-08-12T07:09:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220269",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:27'>Comment 27:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9c0f66dca5d59aef571c69fe7561b6446ec23d71">9c0f66d</a></td><td><code>trac #16785: improve differential operator translation to maxima</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ef6d620a9d75cc9c32904255db7da93d698967f5">ef6d620</a></td><td><code>Merge commit '9c0f66dca5d59aef571c69fe7561b6446ec23d71' of trac.sagemath.org:sage into t/16671/implement_harmonic_number_function_h_n_m_</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/860820fd5d454bfd4e2e8f40af82e724537f45dc">860820f</a></td><td><code>Merge branch 'develop' into t/16671/implement_harmonic_number_function_h_n_m_</code></td></tr></table>




---

archive/issue_comments_220270.json:
```json
{
    "body": "Changed commit from **[e263ac4](https://github.com/sagemath/sagetrac-mirror/commit/e263ac41caa14a9ba4b537f0f5091cf012d64c3b)** to **[860820f](https://github.com/sagemath/sagetrac-mirror/commit/860820fd5d454bfd4e2e8f40af82e724537f45dc)**",
    "created_at": "2014-08-12T07:09:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220270",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[e263ac4](https://github.com/sagemath/sagetrac-mirror/commit/e263ac41caa14a9ba4b537f0f5091cf012d64c3b)** to **[860820f](https://github.com/sagemath/sagetrac-mirror/commit/860820fd5d454bfd4e2e8f40af82e724537f45dc)**



---

archive/issue_comments_220271.json:
```json
{
    "body": "<a id='comment:28'>Comment 28:</a>\nThis looks good with #16785:\n\n```\nsage: maxima_calculus(harmonic_number(x,y).diff(x))\n'diff(gen_harmonic_number(_SAGE_VAR_y,_SAGE_VAR_x),_SAGE_VAR_x,1)\n```\nSo, thanks for your review so far. Is there anything missing?",
    "created_at": "2014-08-12T07:11:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220271",
    "user": "https://github.com/rwst"
}
```

<a id='comment:28'>Comment 28:</a>
This looks good with #16785:

```
sage: maxima_calculus(harmonic_number(x,y).diff(x))
'diff(gen_harmonic_number(_SAGE_VAR_y,_SAGE_VAR_x),_SAGE_VAR_x,1)
```
So, thanks for your review so far. Is there anything missing?



---

archive/issue_comments_220272.json:
```json
{
    "body": "<a id='comment:29'>Comment 29:</a>\nPatchbot complains about a failing doctest\n\n```\nFile \"src/sage/interfaces/maxima_lib.py\", line 1458, in sage.interfaces.maxima_lib.max_harmonic_to_sage\nFailed example:\n    c.ecl()\nExpected:\n    <ECL: (($GEN_HARMONIC_NUMBER SIMP) 2 $X)>\nGot:\n    <ECL: (($GEN_HARMONIC_NUMBER SIMP) 2 |$_SAGE_VAR_x|)>\n```",
    "created_at": "2014-08-12T15:50:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220272",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:29'>Comment 29:</a>
Patchbot complains about a failing doctest

```
File "src/sage/interfaces/maxima_lib.py", line 1458, in sage.interfaces.maxima_lib.max_harmonic_to_sage
Failed example:
    c.ecl()
Expected:
    <ECL: (($GEN_HARMONIC_NUMBER SIMP) 2 $X)>
Got:
    <ECL: (($GEN_HARMONIC_NUMBER SIMP) 2 |$_SAGE_VAR_x|)>
```



---

archive/issue_comments_220273.json:
```json
{
    "body": "<a id='comment:30'>Comment 30:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/26652819bf557f1daed5e01d892d7ad982e09d29\">2665281</a></td><td><code>16671: doctest fix (appeared due to 16785 merge)</code></td></tr></table>\n",
    "created_at": "2014-08-12T16:18:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220273",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:30'>Comment 30:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/26652819bf557f1daed5e01d892d7ad982e09d29">2665281</a></td><td><code>16671: doctest fix (appeared due to 16785 merge)</code></td></tr></table>




---

archive/issue_comments_220274.json:
```json
{
    "body": "Changed commit from **[860820f](https://github.com/sagemath/sagetrac-mirror/commit/860820fd5d454bfd4e2e8f40af82e724537f45dc)** to **[2665281](https://github.com/sagemath/sagetrac-mirror/commit/26652819bf557f1daed5e01d892d7ad982e09d29)**",
    "created_at": "2014-08-12T16:18:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220274",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[860820f](https://github.com/sagemath/sagetrac-mirror/commit/860820fd5d454bfd4e2e8f40af82e724537f45dc)** to **[2665281](https://github.com/sagemath/sagetrac-mirror/commit/26652819bf557f1daed5e01d892d7ad982e09d29)**



---

archive/issue_comments_220275.json:
```json
{
    "body": "<a id='comment:31'>Comment 31:</a>\nAh thanks, the `$X` should have rung a bell much earlier.",
    "created_at": "2014-08-12T16:19:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220275",
    "user": "https://github.com/rwst"
}
```

<a id='comment:31'>Comment 31:</a>
Ah thanks, the `$X` should have rung a bell much earlier.



---

archive/issue_comments_220276.json:
```json
{
    "body": "<a id='comment:32'>Comment 32:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fd8c09c4be9334f4fd9af3225aa3a2898dd8366d\">fd8c09c</a></td><td><code>Merge branch 'develop' into t/16671/implement_harmonic_number_function_h_n_m_</code></td></tr></table>\n",
    "created_at": "2014-08-20T14:22:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220276",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:32'>Comment 32:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fd8c09c4be9334f4fd9af3225aa3a2898dd8366d">fd8c09c</a></td><td><code>Merge branch 'develop' into t/16671/implement_harmonic_number_function_h_n_m_</code></td></tr></table>




---

archive/issue_comments_220277.json:
```json
{
    "body": "Changed commit from **[2665281](https://github.com/sagemath/sagetrac-mirror/commit/26652819bf557f1daed5e01d892d7ad982e09d29)** to **[fd8c09c](https://github.com/sagemath/sagetrac-mirror/commit/fd8c09c4be9334f4fd9af3225aa3a2898dd8366d)**",
    "created_at": "2014-08-20T14:22:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220277",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[2665281](https://github.com/sagemath/sagetrac-mirror/commit/26652819bf557f1daed5e01d892d7ad982e09d29)** to **[fd8c09c](https://github.com/sagemath/sagetrac-mirror/commit/fd8c09c4be9334f4fd9af3225aa3a2898dd8366d)**



---

archive/issue_comments_220278.json:
```json
{
    "body": "Changed commit from **[fd8c09c](https://github.com/sagemath/sagetrac-mirror/commit/fd8c09c4be9334f4fd9af3225aa3a2898dd8366d)** to **[87597bd](https://github.com/sagemath/sagetrac-mirror/commit/87597bde4c041766a26674a3a8be1d4b076180d5)**",
    "created_at": "2014-12-20T08:20:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220278",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[fd8c09c](https://github.com/sagemath/sagetrac-mirror/commit/fd8c09c4be9334f4fd9af3225aa3a2898dd8366d)** to **[87597bd](https://github.com/sagemath/sagetrac-mirror/commit/87597bde4c041766a26674a3a8be1d4b076180d5)**



---

archive/issue_comments_220279.json:
```json
{
    "body": "<a id='comment:33'>Comment 33:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fa73dde760a97179944c7717d6cd952d93aa2056\">fa73dde</a></td><td><code>Merge branch 'develop' into t/16671/implement_harmonic_number_function_h_n_m_</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/87597bde4c041766a26674a3a8be1d4b076180d5\">87597bd</a></td><td><code>16671: adaptations due to improved BuiltinFunction</code></td></tr></table>\n",
    "created_at": "2014-12-20T08:20:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220279",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:33'>Comment 33:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fa73dde760a97179944c7717d6cd952d93aa2056">fa73dde</a></td><td><code>Merge branch 'develop' into t/16671/implement_harmonic_number_function_h_n_m_</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/87597bde4c041766a26674a3a8be1d4b076180d5">87597bd</a></td><td><code>16671: adaptations due to improved BuiltinFunction</code></td></tr></table>




---

archive/issue_comments_220280.json:
```json
{
    "body": "<a id='comment:35'>Comment 35:</a>\nYou don't need this:\n\n```diff\ndiff --git a/src/sage/libs/flint/arith.pyx b/src/sage/libs/flint/arith.pyx\nindex 7280536..91caf32 100644\n--- a/src/sage/libs/flint/arith.pyx\n+++ b/src/sage/libs/flint/arith.pyx\n@@ -10,10 +10,23 @@ FLINT Arithmetic Functions\ninclude \"sage/ext/interrupt.pxi\"\n+cdef extern from \"flint/fmpq.h\":\n+ ctypedef void * fmpq_t\n+ void fmpq_init(fmpq_t)\n+ void fmpq_clear(fmpq_t)\n+ void fmpq_get_mpq(mpq_t, fmpq_t)\n+ void fmpq_set_mpq(fmpq_t, mpq_t)\n+\n+cdef extern from \"flint/arith.h\":\n+ void arith_number_of_partitions(fmpz_t x, unsigned long n)\n+ void arith_dedekind_sum(fmpq_t, fmpz_t, fmpz_t)\n+ void arith_harmonic_number(fmpq_t, unsigned long n)\n+\nfrom fmpz cimport *\nfrom fmpq cimport *\nfrom arith cimport *\n+\nfrom sage.rings.integer cimport Integer\nfrom sage.rings.rational cimport Rational\n```\n\nAdd the functions you need (only `arith_harmonic_number` in this case) to `src/sage/libs/flint/arith.pxd` instead.",
    "created_at": "2015-02-14T15:31:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220280",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:35'>Comment 35:</a>
You don't need this:

```diff
diff --git a/src/sage/libs/flint/arith.pyx b/src/sage/libs/flint/arith.pyx
index 7280536..91caf32 100644
--- a/src/sage/libs/flint/arith.pyx
+++ b/src/sage/libs/flint/arith.pyx
@@ -10,10 +10,23 @@ FLINT Arithmetic Functions
include "sage/ext/interrupt.pxi"
+cdef extern from "flint/fmpq.h":
+ ctypedef void * fmpq_t
+ void fmpq_init(fmpq_t)
+ void fmpq_clear(fmpq_t)
+ void fmpq_get_mpq(mpq_t, fmpq_t)
+ void fmpq_set_mpq(fmpq_t, mpq_t)
+
+cdef extern from "flint/arith.h":
+ void arith_number_of_partitions(fmpz_t x, unsigned long n)
+ void arith_dedekind_sum(fmpq_t, fmpz_t, fmpz_t)
+ void arith_harmonic_number(fmpq_t, unsigned long n)
+
from fmpz cimport *
from fmpq cimport *
from arith cimport *
+
from sage.rings.integer cimport Integer
from sage.rings.rational cimport Rational
```

Add the functions you need (only `arith_harmonic_number` in this case) to `src/sage/libs/flint/arith.pxd` instead.



---

archive/issue_events_220744.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-02-14T15:31:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-220744"
}
```



---

archive/issue_events_220745.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-02-14T15:31:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-220745"
}
```



---

archive/issue_comments_220281.json:
```json
{
    "body": "Changed branch from **[u/rws/implement_harmonic_number_function_h_n_m_](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/implement_harmonic_number_function_h_n_m_)** to **[u/rws/16671](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/16671)**",
    "created_at": "2015-02-15T08:34:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220281",
    "user": "https://github.com/rwst"
}
```

Changed branch from **[u/rws/implement_harmonic_number_function_h_n_m_](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/implement_harmonic_number_function_h_n_m_)** to **[u/rws/16671](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/16671)**



---

archive/issue_comments_220282.json:
```json
{
    "body": "Changed commit from **[87597bd](https://github.com/sagemath/sagetrac-mirror/commit/87597bde4c041766a26674a3a8be1d4b076180d5)** to **[c26cd0b](https://github.com/sagemath/sagetrac-mirror/commit/c26cd0b047aef2446737587bd784e38851277ed4)**",
    "created_at": "2015-02-15T08:35:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220282",
    "user": "https://github.com/rwst"
}
```

Changed commit from **[87597bd](https://github.com/sagemath/sagetrac-mirror/commit/87597bde4c041766a26674a3a8be1d4b076180d5)** to **[c26cd0b](https://github.com/sagemath/sagetrac-mirror/commit/c26cd0b047aef2446737587bd784e38851277ed4)**



---

archive/issue_comments_220283.json:
```json
{
    "body": "<a id='comment:37'>Comment 37:</a>\nDone. Squashed it all into one commit.\n  \n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c26cd0b047aef2446737587bd784e38851277ed4\">c26cd0b</a></td><td><code>16671: implement harmonic number function H(n,m)</code></td></tr></table>\n",
    "created_at": "2015-02-15T08:35:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220283",
    "user": "https://github.com/rwst"
}
```

<a id='comment:37'>Comment 37:</a>
Done. Squashed it all into one commit.
  
---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c26cd0b047aef2446737587bd784e38851277ed4">c26cd0b</a></td><td><code>16671: implement harmonic number function H(n,m)</code></td></tr></table>




---

archive/issue_events_220746.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-02-15T08:35:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-220746"
}
```



---

archive/issue_events_220747.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-02-15T08:35:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-220747"
}
```



---

archive/issue_comments_220284.json:
```json
{
    "body": "<a id='comment:38'>Comment 38:</a>\nIn `flint/arith.pyx`, you're missing actual examples.",
    "created_at": "2015-02-15T12:50:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220284",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:38'>Comment 38:</a>
In `flint/arith.pyx`, you're missing actual examples.



---

archive/issue_events_220748.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-02-15T12:50:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-220748"
}
```



---

archive/issue_events_220749.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-02-15T12:50:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-220749"
}
```



---

archive/issue_comments_220285.json:
```json
{
    "body": "<a id='comment:39'>Comment 39:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3ec7fbba6b2c095ef2aa38cec5ffc47c9ba0cae6\">3ec7fbb</a></td><td><code>16671: add missing doctest</code></td></tr></table>\n",
    "created_at": "2015-02-15T13:56:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220285",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:39'>Comment 39:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3ec7fbba6b2c095ef2aa38cec5ffc47c9ba0cae6">3ec7fbb</a></td><td><code>16671: add missing doctest</code></td></tr></table>




---

archive/issue_comments_220286.json:
```json
{
    "body": "Changed commit from **[c26cd0b](https://github.com/sagemath/sagetrac-mirror/commit/c26cd0b047aef2446737587bd784e38851277ed4)** to **[3ec7fbb](https://github.com/sagemath/sagetrac-mirror/commit/3ec7fbba6b2c095ef2aa38cec5ffc47c9ba0cae6)**",
    "created_at": "2015-02-15T13:56:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220286",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[c26cd0b](https://github.com/sagemath/sagetrac-mirror/commit/c26cd0b047aef2446737587bd784e38851277ed4)** to **[3ec7fbb](https://github.com/sagemath/sagetrac-mirror/commit/3ec7fbba6b2c095ef2aa38cec5ffc47c9ba0cae6)**



---

archive/issue_events_220750.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-02-15T13:56:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-220750"
}
```



---

archive/issue_events_220751.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-02-15T13:56:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-220751"
}
```



---

archive/issue_comments_220287.json:
```json
{
    "body": "<a id='comment:40'>Comment 40:</a>\nIndeed.",
    "created_at": "2015-02-15T13:56:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220287",
    "user": "https://github.com/rwst"
}
```

<a id='comment:40'>Comment 40:</a>
Indeed.



---

archive/issue_comments_220288.json:
```json
{
    "body": "<a id='comment:41'>Comment 41:</a>\nIn `__call__`, why mess with `len(args)`? Why not simply something like\n\n```\ndef __call__(self, z, m=1, **kwds):\n    return BuiltinFunction.__call__(self, z, m, **kwds)\n```",
    "created_at": "2015-02-16T09:09:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220288",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:41'>Comment 41:</a>
In `__call__`, why mess with `len(args)`? Why not simply something like

```
def __call__(self, z, m=1, **kwds):
    return BuiltinFunction.__call__(self, z, m, **kwds)
```



---

archive/issue_comments_220289.json:
```json
{
    "body": "<a id='comment:42'>Comment 42:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fabf86397adf8c07ce9b63b64c64e5f724702d21\">fabf863</a></td><td><code>16671: code tightened</code></td></tr></table>\n",
    "created_at": "2015-02-16T09:26:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220289",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:42'>Comment 42:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fabf86397adf8c07ce9b63b64c64e5f724702d21">fabf863</a></td><td><code>16671: code tightened</code></td></tr></table>




---

archive/issue_comments_220290.json:
```json
{
    "body": "Changed commit from **[3ec7fbb](https://github.com/sagemath/sagetrac-mirror/commit/3ec7fbba6b2c095ef2aa38cec5ffc47c9ba0cae6)** to **[fabf863](https://github.com/sagemath/sagetrac-mirror/commit/fabf86397adf8c07ce9b63b64c64e5f724702d21)**",
    "created_at": "2015-02-16T09:26:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220290",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[3ec7fbb](https://github.com/sagemath/sagetrac-mirror/commit/3ec7fbba6b2c095ef2aa38cec5ffc47c9ba0cae6)** to **[fabf863](https://github.com/sagemath/sagetrac-mirror/commit/fabf86397adf8c07ce9b63b64c64e5f724702d21)**



---

archive/issue_comments_220291.json:
```json
{
    "body": "<a id='comment:43'>Comment 43:</a>\nWhat's with the condition `elif z < 2**20:`??",
    "created_at": "2015-02-16T09:30:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220291",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:43'>Comment 43:</a>
What's with the condition `elif z < 2**20:`??



---

archive/issue_comments_220292.json:
```json
{
    "body": "<a id='comment:44'>Comment 44:</a>\nIn `flint/arith.pyx`, you should add\n\n```diff\n+sig_on()\n arith_harmonic_number(s_fmpq, n)\n\n fmpq_get_mpq((<Rational>s).value, s_fmpq)\n+sig_off()\n```",
    "created_at": "2015-02-16T09:33:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220292",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:44'>Comment 44:</a>
In `flint/arith.pyx`, you should add

```diff
+sig_on()
 arith_harmonic_number(s_fmpq, n)

 fmpq_get_mpq((<Rational>s).value, s_fmpq)
+sig_off()
```



---

archive/issue_events_220752.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-02-16T09:33:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-220752"
}
```



---

archive/issue_events_220753.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-02-16T09:33:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-220753"
}
```



---

archive/issue_comments_220293.json:
```json
{
    "body": "<a id='comment:46'>Comment 46:</a>\nWhy doesn't this work?\n\n```\nsage: harmonic_number(x).diff(x)\nD[0]harmonic_number(x)\n```",
    "created_at": "2015-02-16T09:34:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220293",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:46'>Comment 46:</a>
Why doesn't this work?

```
sage: harmonic_number(x).diff(x)
D[0]harmonic_number(x)
```



---

archive/issue_comments_220294.json:
```json
{
    "body": "<a id='comment:47'>Comment 47:</a>\nI don't agree with `sum(QQ(1)/(k**m) for k in range(1,z+1))` since the result is always in `QQ`. I would use `srange` to respect the input type (`foo in ZZ` does not imply that the type of `foo` is `ZZ`):\n\n```\nsum(1/(k**m) for k in srange(1,z+1))\n```\n\nArtificial example (this could be a doctest):\n\n```\nsage: harmonic_number._eval_(10, Qp(5)(1))\n7381/2520\n```\nbut the answer should be\n\n```\nsage: Qp(5)(harmonic_number(10))\n4*5^-1 + 2 + 2*5 + 4*5^2 + 3*5^3 + 5^4 + 4*5^5 + 4*5^6 + 5^7 + 4*5^8 + 3*5^9 + 5^10 + 4*5^11 + 4*5^12 + 5^13 + 4*5^14 + 3*5^15 + 5^16 + 4*5^17 + 4*5^18 + O(5^19)\n```",
    "created_at": "2015-02-16T09:39:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220294",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:47'>Comment 47:</a>
I don't agree with `sum(QQ(1)/(k**m) for k in range(1,z+1))` since the result is always in `QQ`. I would use `srange` to respect the input type (`foo in ZZ` does not imply that the type of `foo` is `ZZ`):

```
sum(1/(k**m) for k in srange(1,z+1))
```

Artificial example (this could be a doctest):

```
sage: harmonic_number._eval_(10, Qp(5)(1))
7381/2520
```
but the answer should be

```
sage: Qp(5)(harmonic_number(10))
4*5^-1 + 2 + 2*5 + 4*5^2 + 3*5^3 + 5^4 + 4*5^5 + 4*5^6 + 5^7 + 4*5^8 + 3*5^9 + 5^10 + 4*5^11 + 4*5^12 + 5^13 + 4*5^14 + 3*5^15 + 5^16 + 4*5^17 + 4*5^18 + O(5^19)
```



---

archive/issue_comments_220295.json:
```json
{
    "body": "<a id='comment:48'>Comment 48:</a>\nAlso please fix `\\ No newline at end of file`",
    "created_at": "2015-02-16T09:40:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220295",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:48'>Comment 48:</a>
Also please fix `\ No newline at end of file`



---

archive/issue_comments_220296.json:
```json
{
    "body": "<a id='comment:49'>Comment 49:</a>\nI don't know what `SR('x')` does, but I think it's better to use `SR.var('x')` instead.",
    "created_at": "2015-02-16T09:43:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220296",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:49'>Comment 49:</a>
I don't know what `SR('x')` does, but I think it's better to use `SR.var('x')` instead.



---

archive/issue_comments_220297.json:
```json
{
    "body": "<a id='comment:50'>Comment 50:</a>\nSame comment as above: are you sure you want `elif z in QQ:` and not `elif isinstance(z, Rational)`?",
    "created_at": "2015-02-16T09:44:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220297",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:50'>Comment 50:</a>
Same comment as above: are you sure you want `elif z in QQ:` and not `elif isinstance(z, Rational)`?



---

archive/issue_comments_220298.json:
```json
{
    "body": "<a id='comment:51'>Comment 51:</a>\nReplying to [@jdemeyer](#comment%3A50):\n> Same comment as above: are you sure you want `elif z in QQ:` and not `elif isinstance(z, Rational)`?\n\nBTW I would think this `if var in ZZ/QQ` appears more often throughout the Sage code. Is there a manual page that deals with this?",
    "created_at": "2015-02-16T10:11:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220298",
    "user": "https://github.com/rwst"
}
```

<a id='comment:51'>Comment 51:</a>
Replying to [@jdemeyer](#comment%3A50):
> Same comment as above: are you sure you want `elif z in QQ:` and not `elif isinstance(z, Rational)`?

BTW I would think this `if var in ZZ/QQ` appears more often throughout the Sage code. Is there a manual page that deals with this?



---

archive/issue_comments_220299.json:
```json
{
    "body": "<a id='comment:52'>Comment 52:</a>\nReplying to [@rwst](#comment%3A51):\n> BTW I would think this `if var in ZZ/QQ` appears more often throughout the Sage code.\n\nPerhaps, but it's not always wrong. It just depends on what you want to do with it.",
    "created_at": "2015-02-16T10:17:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220299",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:52'>Comment 52:</a>
Replying to [@rwst](#comment%3A51):
> BTW I would think this `if var in ZZ/QQ` appears more often throughout the Sage code.

Perhaps, but it's not always wrong. It just depends on what you want to do with it.



---

archive/issue_comments_220300.json:
```json
{
    "body": "<a id='comment:53'>Comment 53:</a>\nThe general rule for functions should be: whenever the answer is non-symbolic, the answer should have a parent which \"matches\" the parent of the input.",
    "created_at": "2015-02-16T11:09:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220300",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:53'>Comment 53:</a>
The general rule for functions should be: whenever the answer is non-symbolic, the answer should have a parent which "matches" the parent of the input.



---

archive/issue_comments_220301.json:
```json
{
    "body": "<a id='comment:54'>Comment 54:</a>\nReplying to [@jdemeyer](#comment%3A47):\n> Artificial example (this could be a doctest):\n> \n> ```\n> sage: harmonic_number._eval_(10, Qp(5)(1))\n> 7381/2520\n> ```\n> but the answer should be\n> \n> ```\n> sage: Qp(5)(harmonic_number(10))\n> 4*5^-1 + 2 + 2*5 + 4*5^2 + 3*5^3 + 5^4 + 4*5^5 + 4*5^6 + 5^7 + 4*5^8 + 3*5^9 + 5^10 + 4*5^11 + 4*5^12 + 5^13 + 4*5^14 + 3*5^15 + 5^16 + 4*5^17 + 4*5^18 + O(5^19)\n> ```\n\nI think this is the only example where `H(n,m)` would have a useful meaning, and it can be computed, as you show, by staying in the rationals and converting the result. Trying to support this case however will fail in `BuiltinFunction.__call__`:\n\n```\nsage: harmonic_number(5,Qp(5)(8))\nTraceback (most recent call last):\n  File \"<ipython-input-9-03dbaa59749c>\", line 1, in <module>\n    harmonic_number(Integer(5),Qp(Integer(5))(Integer(8)))\n  File \"/home/ralf/sage/local/lib/python2.7/site-packages/sage/functions/log.py\", line 886, in __call__\n    return BuiltinFunction.__call__(self, z, m, **kwds)\n  File \"sage/symbolic/function.pyx\", line 993, in sage.symbolic.function.BuiltinFunction.__call__ (build/cythonized/sage/symbolic/function.cpp:10572)\n    res = super(BuiltinFunction, self).__call__(\n  File \"sage/symbolic/function.pyx\", line 487, in sage.symbolic.function.Function.__call__ (build/cythonized/sage/symbolic/function.cpp:6301)\n    raise TypeError, \"cannot coerce arguments: %s\"%(err)\nTypeError: cannot coerce arguments: no canonical coercion from 5-adic Field with capped relative precision 20 to Symbolic Ring\n```",
    "created_at": "2015-02-16T14:44:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220301",
    "user": "https://github.com/rwst"
}
```

<a id='comment:54'>Comment 54:</a>
Replying to [@jdemeyer](#comment%3A47):
> Artificial example (this could be a doctest):
> 
> ```
> sage: harmonic_number._eval_(10, Qp(5)(1))
> 7381/2520
> ```
> but the answer should be
> 
> ```
> sage: Qp(5)(harmonic_number(10))
> 4*5^-1 + 2 + 2*5 + 4*5^2 + 3*5^3 + 5^4 + 4*5^5 + 4*5^6 + 5^7 + 4*5^8 + 3*5^9 + 5^10 + 4*5^11 + 4*5^12 + 5^13 + 4*5^14 + 3*5^15 + 5^16 + 4*5^17 + 4*5^18 + O(5^19)
> ```

I think this is the only example where `H(n,m)` would have a useful meaning, and it can be computed, as you show, by staying in the rationals and converting the result. Trying to support this case however will fail in `BuiltinFunction.__call__`:

```
sage: harmonic_number(5,Qp(5)(8))
Traceback (most recent call last):
  File "<ipython-input-9-03dbaa59749c>", line 1, in <module>
    harmonic_number(Integer(5),Qp(Integer(5))(Integer(8)))
  File "/home/ralf/sage/local/lib/python2.7/site-packages/sage/functions/log.py", line 886, in __call__
    return BuiltinFunction.__call__(self, z, m, **kwds)
  File "sage/symbolic/function.pyx", line 993, in sage.symbolic.function.BuiltinFunction.__call__ (build/cythonized/sage/symbolic/function.cpp:10572)
    res = super(BuiltinFunction, self).__call__(
  File "sage/symbolic/function.pyx", line 487, in sage.symbolic.function.Function.__call__ (build/cythonized/sage/symbolic/function.cpp:6301)
    raise TypeError, "cannot coerce arguments: %s"%(err)
TypeError: cannot coerce arguments: no canonical coercion from 5-adic Field with capped relative precision 20 to Symbolic Ring
```



---

archive/issue_comments_220302.json:
```json
{
    "body": "<a id='comment:55'>Comment 55:</a>\nReplying to [@rwst](#comment%3A54):\n> it can be computed, as you show, by staying in the rationals and converting the result.\n\nBut that wouldn't be the optimal way to compute it. I think it's easy to make the formula work for arbitrary types.\n\n> Trying to support this case however will fail in `BuiltinFunction.__call__`:\n\nI know, but that doesn't mean we shouldn't adapt `_eval_`.",
    "created_at": "2015-02-16T15:29:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220302",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:55'>Comment 55:</a>
Replying to [@rwst](#comment%3A54):
> it can be computed, as you show, by staying in the rationals and converting the result.

But that wouldn't be the optimal way to compute it. I think it's easy to make the formula work for arbitrary types.

> Trying to support this case however will fail in `BuiltinFunction.__call__`:

I know, but that doesn't mean we shouldn't adapt `_eval_`.



---

archive/issue_comments_220303.json:
```json
{
    "body": "Changed commit from **[fabf863](https://github.com/sagemath/sagetrac-mirror/commit/fabf86397adf8c07ce9b63b64c64e5f724702d21)** to **[309660a](https://github.com/sagemath/sagetrac-mirror/commit/309660a11c0929f223087f5f208a2ea8f14e7625)**",
    "created_at": "2015-02-16T16:44:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220303",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[fabf863](https://github.com/sagemath/sagetrac-mirror/commit/fabf86397adf8c07ce9b63b64c64e5f724702d21)** to **[309660a](https://github.com/sagemath/sagetrac-mirror/commit/309660a11c0929f223087f5f208a2ea8f14e7625)**



---

archive/issue_comments_220304.json:
```json
{
    "body": "<a id='comment:56'>Comment 56:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/309660a11c0929f223087f5f208a2ea8f14e7625\">309660a</a></td><td><code>16671: generalize evaluation of H(n,m); add its derivative; several fixes; document FLINT computation limit</code></td></tr></table>\n",
    "created_at": "2015-02-16T16:44:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220304",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:56'>Comment 56:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/309660a11c0929f223087f5f208a2ea8f14e7625">309660a</a></td><td><code>16671: generalize evaluation of H(n,m); add its derivative; several fixes; document FLINT computation limit</code></td></tr></table>




---

archive/issue_events_220754.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-02-16T16:46:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-220754"
}
```



---

archive/issue_events_220755.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-02-16T16:46:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-220755"
}
```



---

archive/issue_comments_220305.json:
```json
{
    "body": "<a id='comment:57'>Comment 57:</a>\n> > Trying to support this case however will fail in `BuiltinFunction.__call__`:\n\n> I know, but that doesn't mean we shouldn't adapt `_eval_`.\n\nThat means it will be fixed elsewhere?",
    "created_at": "2015-02-16T16:46:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220305",
    "user": "https://github.com/rwst"
}
```

<a id='comment:57'>Comment 57:</a>
> > Trying to support this case however will fail in `BuiltinFunction.__call__`:

> I know, but that doesn't mean we shouldn't adapt `_eval_`.

That means it will be fixed elsewhere?



---

archive/issue_comments_220306.json:
```json
{
    "body": "<a id='comment:58'>Comment 58:</a>\nI still don't understand the point of this:\n\n```\nIf the argument is an integer greater than `2^20` no rational\nevaluation is done, in order to allow for high-precision floating\npoint computation using `.n()`\n```",
    "created_at": "2015-02-16T17:44:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220306",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:58'>Comment 58:</a>
I still don't understand the point of this:

```
If the argument is an integer greater than `2^20` no rational
evaluation is done, in order to allow for high-precision floating
point computation using `.n()`
```



---

archive/issue_comments_220307.json:
```json
{
    "body": "<a id='comment:59'>Comment 59:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ca696281c6d2425b72d72b6408e4a787b32d637a\">ca69628</a></td><td><code>16671: remove restriction</code></td></tr></table>\n",
    "created_at": "2015-02-17T06:37:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220307",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:59'>Comment 59:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ca696281c6d2425b72d72b6408e4a787b32d637a">ca69628</a></td><td><code>16671: remove restriction</code></td></tr></table>




---

archive/issue_comments_220308.json:
```json
{
    "body": "Changed commit from **[309660a](https://github.com/sagemath/sagetrac-mirror/commit/309660a11c0929f223087f5f208a2ea8f14e7625)** to **[ca69628](https://github.com/sagemath/sagetrac-mirror/commit/ca696281c6d2425b72d72b6408e4a787b32d637a)**",
    "created_at": "2015-02-17T06:37:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220308",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[309660a](https://github.com/sagemath/sagetrac-mirror/commit/309660a11c0929f223087f5f208a2ea8f14e7625)** to **[ca69628](https://github.com/sagemath/sagetrac-mirror/commit/ca696281c6d2425b72d72b6408e4a787b32d637a)**



---

archive/issue_comments_220309.json:
```json
{
    "body": "<a id='comment:60'>Comment 60:</a>\nReplying to [@jdemeyer](#comment%3A58):\n> I still don't understand the point of this:\n\nOK, me neither. Presumably I had a memory error at the time ...",
    "created_at": "2015-02-17T06:38:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220309",
    "user": "https://github.com/rwst"
}
```

<a id='comment:60'>Comment 60:</a>
Replying to [@jdemeyer](#comment%3A58):
> I still don't understand the point of this:

OK, me neither. Presumably I had a memory error at the time ...



---

archive/issue_comments_220310.json:
```json
{
    "body": "Dependencies: **#17790**",
    "created_at": "2015-02-17T06:46:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220310",
    "user": "https://github.com/rwst"
}
```

Dependencies: **#17790**



---

archive/issue_comments_220311.json:
```json
{
    "body": "<a id='comment:61'>Comment 61:</a>\nReplying to [@rwst](#comment%3A57):\n> > > Trying to support this case however will fail in `BuiltinFunction.__call__`:\n\n> > I know, but that doesn't mean we shouldn't adapt `_eval_`.\n\n> That means it will be fixed elsewhere?\n\nSee #17790",
    "created_at": "2015-02-17T06:46:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220311",
    "user": "https://github.com/rwst"
}
```

<a id='comment:61'>Comment 61:</a>
Replying to [@rwst](#comment%3A57):
> > > Trying to support this case however will fail in `BuiltinFunction.__call__`:

> > I know, but that doesn't mean we shouldn't adapt `_eval_`.

> That means it will be fixed elsewhere?

See #17790



---

archive/issue_comments_220312.json:
```json
{
    "body": "Work Issues: **merge fix for #17790**",
    "created_at": "2015-03-05T08:23:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220312",
    "user": "https://github.com/rwst"
}
```

Work Issues: **merge fix for #17790**



---

archive/issue_events_220756.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-03-05T08:23:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-220756"
}
```



---

archive/issue_events_220757.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-03-05T08:23:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-220757"
}
```



---

archive/issue_comments_220313.json:
```json
{
    "body": "<a id='comment:63'>Comment 63:</a>\nLet's document here that both forms for the generalized harmonic numbers\n\n```\nH(q/p,m) = zeta(m) - p^m * sum(1/(q+p*k)^m, k, 1, oo)   (Wikipedia 2015-Mar-07)\n\nH(k,n) = binomial(n+k-1,k-1)*(harmonic_number(n+k-1)-harmonic_number(k-1))\n         (http://mathworld.wolfram.com/HarmonicNumber.html eq. 55)\n```\nare both wrong, with the counterexamples `H(5/2,3)=1/27*sqrt(3) + 1/8*sqrt(2) + 1` and `H(5,3)=256103/216000`.\n\nEDIT. no, the first is right, my implementation was wrong.",
    "created_at": "2015-03-07T08:53:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220313",
    "user": "https://github.com/rwst"
}
```

<a id='comment:63'>Comment 63:</a>
Let's document here that both forms for the generalized harmonic numbers

```
H(q/p,m) = zeta(m) - p^m * sum(1/(q+p*k)^m, k, 1, oo)   (Wikipedia 2015-Mar-07)

H(k,n) = binomial(n+k-1,k-1)*(harmonic_number(n+k-1)-harmonic_number(k-1))
         (http://mathworld.wolfram.com/HarmonicNumber.html eq. 55)
```
are both wrong, with the counterexamples `H(5/2,3)=1/27*sqrt(3) + 1/8*sqrt(2) + 1` and `H(5,3)=256103/216000`.

EDIT. no, the first is right, my implementation was wrong.



---

archive/issue_comments_220314.json:
```json
{
    "body": "<a id='comment:64'>Comment 64:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5eb502d6f631ccab4045b9ba8e375815ea355231\">5eb502d</a></td><td><code>Merge branch 'develop' into t/16671/16671</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a808a0e68bdf345cc8b182c68a55c48755603e3f\">a808a0e</a></td><td><code>Merge branch 'develop' into t/16671/16671</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f6e21137f97771b916ceae7f16a59805af78291f\">f6e2113</a></td><td><code>17790: add padics to the conversion workaround for symbolic function arguments</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/05ad72bbacb57896af1be0d8f8002f61c3d52420\">05ad72b</a></td><td><code>Merge branch 'u/rws/builtinfunction_doesn_t_pass_non_sr_coercible_arguments_to_function_code' of trac.sagemath.org:sage into t/16671/16671</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ca1a03d0e4a38ad9bec0475b2382ab0642f81f8f\">ca1a03d</a></td><td><code>Merge branch 'develop' into t/16671/16671</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d60311eda7cce822b74480550498da09b34b7a63\">d60311e</a></td><td><code>16671: handle more argument types; fix num. H(n,m); cosmetics</code></td></tr></table>\n",
    "created_at": "2015-03-07T09:22:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220314",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:64'>Comment 64:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5eb502d6f631ccab4045b9ba8e375815ea355231">5eb502d</a></td><td><code>Merge branch 'develop' into t/16671/16671</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a808a0e68bdf345cc8b182c68a55c48755603e3f">a808a0e</a></td><td><code>Merge branch 'develop' into t/16671/16671</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f6e21137f97771b916ceae7f16a59805af78291f">f6e2113</a></td><td><code>17790: add padics to the conversion workaround for symbolic function arguments</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/05ad72bbacb57896af1be0d8f8002f61c3d52420">05ad72b</a></td><td><code>Merge branch 'u/rws/builtinfunction_doesn_t_pass_non_sr_coercible_arguments_to_function_code' of trac.sagemath.org:sage into t/16671/16671</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ca1a03d0e4a38ad9bec0475b2382ab0642f81f8f">ca1a03d</a></td><td><code>Merge branch 'develop' into t/16671/16671</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d60311eda7cce822b74480550498da09b34b7a63">d60311e</a></td><td><code>16671: handle more argument types; fix num. H(n,m); cosmetics</code></td></tr></table>




---

archive/issue_comments_220315.json:
```json
{
    "body": "Changed commit from **[ca69628](https://github.com/sagemath/sagetrac-mirror/commit/ca696281c6d2425b72d72b6408e4a787b32d637a)** to **[d60311e](https://github.com/sagemath/sagetrac-mirror/commit/d60311eda7cce822b74480550498da09b34b7a63)**",
    "created_at": "2015-03-07T09:22:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220315",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[ca69628](https://github.com/sagemath/sagetrac-mirror/commit/ca696281c6d2425b72d72b6408e4a787b32d637a)** to **[d60311e](https://github.com/sagemath/sagetrac-mirror/commit/d60311eda7cce822b74480550498da09b34b7a63)**



---

archive/issue_comments_220316.json:
```json
{
    "body": "<a id='comment:65'>Comment 65:</a>\nReplying to [@jdemeyer](#comment%3A47):\n> \n> ```\n> sage: harmonic_number._eval_(10, Qp(5)(1))\n> 7381/2520\n> ```\n> but the answer should be\n> \n> ```\n> sage: Qp(5)(harmonic_number(10))\n> ```\n\nDisagree. That should be the result of `harmonic_number._eval_(Qp(5)(10), 1)`. Anything else than a rational as second argument makes no sense.\n\nI have now adapted the code so it gives back the same type as the input, but wrapped as `Expression`. Also, you can expect that only if it can be converted back, which is not the case for `H(p/q)` or `H(anything, p/q)` as the result is not rational.",
    "created_at": "2015-03-07T09:31:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220316",
    "user": "https://github.com/rwst"
}
```

<a id='comment:65'>Comment 65:</a>
Replying to [@jdemeyer](#comment%3A47):
> 
> ```
> sage: harmonic_number._eval_(10, Qp(5)(1))
> 7381/2520
> ```
> but the answer should be
> 
> ```
> sage: Qp(5)(harmonic_number(10))
> ```

Disagree. That should be the result of `harmonic_number._eval_(Qp(5)(10), 1)`. Anything else than a rational as second argument makes no sense.

I have now adapted the code so it gives back the same type as the input, but wrapped as `Expression`. Also, you can expect that only if it can be converted back, which is not the case for `H(p/q)` or `H(anything, p/q)` as the result is not rational.



---

archive/issue_events_220758.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-03-07T09:31:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-220758"
}
```



---

archive/issue_events_220759.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-03-07T09:31:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-220759"
}
```



---

archive/issue_comments_220317.json:
```json
{
    "body": "Changed work issues from **merge fix for #17790** to none",
    "created_at": "2015-03-07T09:31:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220317",
    "user": "https://github.com/rwst"
}
```

Changed work issues from **merge fix for #17790** to none



---

archive/issue_events_220760.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-03-07T09:31:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-220760"
}
```



---

archive/issue_events_220761.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-03-07T09:31:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "milestone_number": null,
    "milestone_title": "sage-6.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-220761"
}
```



---

archive/issue_events_220762.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-06-11T07:32:39Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "milestone_number": null,
    "milestone_title": "sage-6.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-220762"
}
```



---

archive/issue_events_220763.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-06-11T07:32:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/pending",
    "label_color": "008080",
    "label_name": "pending",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-220763"
}
```



---

archive/issue_events_220764.json:
```json
{
    "actor": "https://github.com/dkrenn",
    "created_at": "2015-11-29T11:29:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-220764"
}
```



---

archive/issue_events_220765.json:
```json
{
    "actor": "https://github.com/dkrenn",
    "created_at": "2015-11-29T11:29:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-220765"
}
```



---

archive/issue_comments_220318.json:
```json
{
    "body": "<a id='comment:68'>Comment 68:</a>\n\n```\nsage -t src/sage/symbolic/function.pyx\n**********************************************************************\nFile \"src/sage/symbolic/function.pyx\", line 394, in sage.symbolic.function.Function.__call__\nFailed example:\n    binomial(Qp(2)(9),5)\nException raised:\n    Traceback (most recent call last):\n      File \"/local/dakrenn/sage/6.9/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 496, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/local/dakrenn/sage/6.9/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 858, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.symbolic.function.Function.__call__[20]>\", line 1, in <module>\n        binomial(Qp(Integer(2))(Integer(9)),Integer(5))\n      File \"sage/symbolic/function.pyx\", line 851, in sage.symbolic.function.GinacFunction.__call__ (build/cythonized/sage/symbolic/function.cpp:9858)\n        res = super(GinacFunction, self).__call__(*args, **kwds)\n      File \"sage/symbolic/function.pyx\", line 998, in sage.symbolic.function.BuiltinFunction.__call__ (build/cythonized/sage/symbolic/function.cpp:11421)\n        res = super(BuiltinFunction, self).__call__(\n      File \"sage/symbolic/function.pyx\", line 511, in sage.symbolic.function.Function.__call__ (build/cythonized/sage/symbolic/function.cpp:7288)\n        res = g_function_eval2(self._serial, (<Expression>args[0])._gobj,\n      File \"sage/symbolic/pynac.pyx\", line 187, in sage.symbolic.pynac.pyExpression_to_ex (build/cythonized/sage/symbolic/pynac.cpp:4108)\n        raise TypeError(\"function did not return a symbolic expression or an element that can be coerced into a symbolic expression\")\n    TypeError: function did not return a symbolic expression or an element that can be coerced into a symbolic expression\n```",
    "created_at": "2015-11-29T11:29:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220318",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:68'>Comment 68:</a>

```
sage -t src/sage/symbolic/function.pyx
**********************************************************************
File "src/sage/symbolic/function.pyx", line 394, in sage.symbolic.function.Function.__call__
Failed example:
    binomial(Qp(2)(9),5)
Exception raised:
    Traceback (most recent call last):
      File "/local/dakrenn/sage/6.9/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 496, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/local/dakrenn/sage/6.9/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 858, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.symbolic.function.Function.__call__[20]>", line 1, in <module>
        binomial(Qp(Integer(2))(Integer(9)),Integer(5))
      File "sage/symbolic/function.pyx", line 851, in sage.symbolic.function.GinacFunction.__call__ (build/cythonized/sage/symbolic/function.cpp:9858)
        res = super(GinacFunction, self).__call__(*args, **kwds)
      File "sage/symbolic/function.pyx", line 998, in sage.symbolic.function.BuiltinFunction.__call__ (build/cythonized/sage/symbolic/function.cpp:11421)
        res = super(BuiltinFunction, self).__call__(
      File "sage/symbolic/function.pyx", line 511, in sage.symbolic.function.Function.__call__ (build/cythonized/sage/symbolic/function.cpp:7288)
        res = g_function_eval2(self._serial, (<Expression>args[0])._gobj,
      File "sage/symbolic/pynac.pyx", line 187, in sage.symbolic.pynac.pyExpression_to_ex (build/cythonized/sage/symbolic/pynac.cpp:4108)
        raise TypeError("function did not return a symbolic expression or an element that can be coerced into a symbolic expression")
    TypeError: function did not return a symbolic expression or an element that can be coerced into a symbolic expression
```



---

archive/issue_events_220766.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-11-29T13:37:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-220766"
}
```



---

archive/issue_events_220767.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-11-29T13:37:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-220767"
}
```



---

archive/issue_comments_220319.json:
```json
{
    "body": "<a id='comment:69'>Comment 69:</a>\nYes, this is because of #17790, and for that reason this ticket is pending (but needs review for everything else).",
    "created_at": "2015-11-29T13:37:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220319",
    "user": "https://github.com/rwst"
}
```

<a id='comment:69'>Comment 69:</a>
Yes, this is because of #17790, and for that reason this ticket is pending (but needs review for everything else).



---

archive/issue_events_220768.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-06-14T05:46:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-220768"
}
```



---

archive/issue_events_220769.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-06-14T05:46:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-220769"
}
```



---

archive/issue_comments_220320.json:
```json
{
    "body": "Changed branch from **[u/rws/16671](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/16671)** to **[u/arminstraub/ticket/16671/harmonic_numbers](https://github.com/sagemath/sagetrac-mirror/tree/u/arminstraub/ticket/16671/harmonic_numbers)**",
    "created_at": "2016-08-17T22:33:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220320",
    "user": "https://github.com/arminstraub"
}
```

Changed branch from **[u/rws/16671](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/16671)** to **[u/arminstraub/ticket/16671/harmonic_numbers](https://github.com/sagemath/sagetrac-mirror/tree/u/arminstraub/ticket/16671/harmonic_numbers)**



---

archive/issue_events_220770.json:
```json
{
    "actor": "https://github.com/arminstraub",
    "created_at": "2016-08-17T22:33:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-220770"
}
```



---

archive/issue_events_220771.json:
```json
{
    "actor": "https://github.com/arminstraub",
    "created_at": "2016-08-17T22:33:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-220771"
}
```



---

archive/issue_events_220772.json:
```json
{
    "actor": "https://github.com/arminstraub",
    "created_at": "2016-08-17T22:33:37Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "milestone_number": null,
    "milestone_title": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-220772"
}
```



---

archive/issue_events_220773.json:
```json
{
    "actor": "https://github.com/arminstraub",
    "created_at": "2016-08-17T22:33:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/pending",
    "label_color": "008080",
    "label_name": "pending",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-220773"
}
```



---

archive/issue_comments_220321.json:
```json
{
    "body": "<a id='comment:71'>Comment 71:</a>\nI have merged the code with the current codebase and simplified `Function_harmonic_number_generalized._eval_` and ` Function_harmonic_number._eval_` (please check that I didn't oversimplify).\n\nWhen merging the code into the current codebase, there was the following conflict in `symbolic/function.pyx`:\n\n```\n<<<<<<< HEAD\n=======\n                # There is no natural coercion from QQbar to the symbolic ring\n                # in order to support\n                #     sage: QQbar(sqrt(2)) + sqrt(3)\n                #     3.146264369941973?\n                # to work around this limitation, we manually convert\n                # elements of QQbar to symbolic expressions here\n                from sage.rings.qqbar import QQbar, AA\n                from sage.rings.padics.padic_generic_element import pAdicGenericElement\n                nargs = [None]*len(args)\n                for i in range(len(args)):\n                    carg = args[i]\n                    if (isinstance(carg, Element) and\n                            ((<Element>carg)._parent is QQbar or\n                            (<Element>carg)._parent is AA or\n                            isinstance(carg, pAdicGenericElement))):\n                        nargs[i] = SR(carg)\n                    else:\n                        try:\n                            nargs[i] = SR.coerce(carg)\n                        except Exception:\n                            raise TypeError, \"cannot coerce arguments: %s\"%(err)\n                args = nargs\n>>>>>>> FETCH_HEAD\n```\nIt was unclear to me to which degree the underlying code had changed, which is why this code for working with `QQbar` over the symbolic ring is not merged into the branch I posted.\n\nIn any case, it seems to me that any such change might be better suited for a separate ticket because it is not specific to harmonic numbers.  Consequently, I also removed from `symbolic/function.pyx` the doctest\n\n```\n            sage: binomial(Qp(2)(9),5)\n            126\n```\nas well as from `functions/log.py` the doctests:\n\n```\n            sage: harmonic_number(Qp(5)(10),1)\n            4*5^-1 + 2 + 2*5 + 4*5^2 + 3*5^3 + 5^4 + ...\n            sage: harmonic_number(Qp(5)(10),2)\n            4*5^-1 + 3 + 5 + 3*5^2 + 2*5^3 + 3*5^5 + ...\n...\n            sage: harmonic_number(Qp(5)(3))\n            1 + 5 + 4*5^2 + 4*5^4 + 4*5^6 + ...\n```\nI think that a separate ticket should be used for uniformly fixing the coercion/conversion of p-adics to the symbolic ring.  Since the present code doesn't touch these issues, I have removed the dependency on #17790.\n\nBy the way, I liked the symbolic sum you were using for computing `harmonic_number(n)` when `n` is a rational number.  While testing this, I noticed that `sum(1/x/(1/5+x),x,1,infinity)` results in an error.  On the other hand, using the present code, we have:\n\n```\nsage: harmonic_number(1/5)\neuler_gamma + psi(6/5)\nsage: _.full_simplify()\n-1/4*(sqrt(5) + 1)*log(1/2*sqrt(5) + 5/2) + 1/4*(sqrt(5) - 1)*log(-1/2*sqrt(5) + 5/2) - 1/10*pi*sqrt(10*sqrt(5) + 25) - log(5) + 5\n```\n\nThe only other changes I made were small touches to the doc strings.  A quick `sage -t src/sage/functions` did not reveal any troubles.\n\nThank you for the nice work!  It would be great to finally have harmonic numbers in Sage.",
    "created_at": "2016-08-17T22:33:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220321",
    "user": "https://github.com/arminstraub"
}
```

<a id='comment:71'>Comment 71:</a>
I have merged the code with the current codebase and simplified `Function_harmonic_number_generalized._eval_` and ` Function_harmonic_number._eval_` (please check that I didn't oversimplify).

When merging the code into the current codebase, there was the following conflict in `symbolic/function.pyx`:

```
<<<<<<< HEAD
=======
                # There is no natural coercion from QQbar to the symbolic ring
                # in order to support
                #     sage: QQbar(sqrt(2)) + sqrt(3)
                #     3.146264369941973?
                # to work around this limitation, we manually convert
                # elements of QQbar to symbolic expressions here
                from sage.rings.qqbar import QQbar, AA
                from sage.rings.padics.padic_generic_element import pAdicGenericElement
                nargs = [None]*len(args)
                for i in range(len(args)):
                    carg = args[i]
                    if (isinstance(carg, Element) and
                            ((<Element>carg)._parent is QQbar or
                            (<Element>carg)._parent is AA or
                            isinstance(carg, pAdicGenericElement))):
                        nargs[i] = SR(carg)
                    else:
                        try:
                            nargs[i] = SR.coerce(carg)
                        except Exception:
                            raise TypeError, "cannot coerce arguments: %s"%(err)
                args = nargs
>>>>>>> FETCH_HEAD
```
It was unclear to me to which degree the underlying code had changed, which is why this code for working with `QQbar` over the symbolic ring is not merged into the branch I posted.

In any case, it seems to me that any such change might be better suited for a separate ticket because it is not specific to harmonic numbers.  Consequently, I also removed from `symbolic/function.pyx` the doctest

```
            sage: binomial(Qp(2)(9),5)
            126
```
as well as from `functions/log.py` the doctests:

```
            sage: harmonic_number(Qp(5)(10),1)
            4*5^-1 + 2 + 2*5 + 4*5^2 + 3*5^3 + 5^4 + ...
            sage: harmonic_number(Qp(5)(10),2)
            4*5^-1 + 3 + 5 + 3*5^2 + 2*5^3 + 3*5^5 + ...
...
            sage: harmonic_number(Qp(5)(3))
            1 + 5 + 4*5^2 + 4*5^4 + 4*5^6 + ...
```
I think that a separate ticket should be used for uniformly fixing the coercion/conversion of p-adics to the symbolic ring.  Since the present code doesn't touch these issues, I have removed the dependency on #17790.

By the way, I liked the symbolic sum you were using for computing `harmonic_number(n)` when `n` is a rational number.  While testing this, I noticed that `sum(1/x/(1/5+x),x,1,infinity)` results in an error.  On the other hand, using the present code, we have:

```
sage: harmonic_number(1/5)
euler_gamma + psi(6/5)
sage: _.full_simplify()
-1/4*(sqrt(5) + 1)*log(1/2*sqrt(5) + 5/2) + 1/4*(sqrt(5) - 1)*log(-1/2*sqrt(5) + 5/2) - 1/10*pi*sqrt(10*sqrt(5) + 25) - log(5) + 5
```

The only other changes I made were small touches to the doc strings.  A quick `sage -t src/sage/functions` did not reveal any troubles.

Thank you for the nice work!  It would be great to finally have harmonic numbers in Sage.



---

archive/issue_comments_220322.json:
```json
{
    "body": "Changed commit from **[d60311e](https://github.com/sagemath/sagetrac-mirror/commit/d60311eda7cce822b74480550498da09b34b7a63)** to **[9042104](https://github.com/sagemath/sagetrac-mirror/commit/9042104196f2d3b9822b3827aa2bbd70097f7b95)**",
    "created_at": "2016-08-17T22:33:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220322",
    "user": "https://github.com/arminstraub"
}
```

Changed commit from **[d60311e](https://github.com/sagemath/sagetrac-mirror/commit/d60311eda7cce822b74480550498da09b34b7a63)** to **[9042104](https://github.com/sagemath/sagetrac-mirror/commit/9042104196f2d3b9822b3827aa2bbd70097f7b95)**



---

archive/issue_comments_220323.json:
```json
{
    "body": "Changed dependencies from **#17790** to none",
    "created_at": "2016-08-17T22:33:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220323",
    "user": "https://github.com/arminstraub"
}
```

Changed dependencies from **#17790** to none



---

archive/issue_comments_220324.json:
```json
{
    "body": "Reviewer: **Ralf Stephan**",
    "created_at": "2016-08-18T06:49:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220324",
    "user": "https://github.com/rwst"
}
```

Reviewer: **Ralf Stephan**



---

archive/issue_events_220774.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-08-18T06:49:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-220774"
}
```



---

archive/issue_events_220775.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-08-18T06:49:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-220775"
}
```



---

archive/issue_comments_220325.json:
```json
{
    "body": "<a id='comment:72'>Comment 72:</a>\nI agree with your changes, especially the removal of the dependency on #17790, this specialty is stuff for another ticket. I'm assuming you reviewed my code, so I set positive now, after more extensive tests pass here.\n\nPlease add your name in the Author and Reviewer fields. Thanks.",
    "created_at": "2016-08-18T06:49:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220325",
    "user": "https://github.com/rwst"
}
```

<a id='comment:72'>Comment 72:</a>
I agree with your changes, especially the removal of the dependency on #17790, this specialty is stuff for another ticket. I'm assuming you reviewed my code, so I set positive now, after more extensive tests pass here.

Please add your name in the Author and Reviewer fields. Thanks.



---

archive/issue_comments_220326.json:
```json
{
    "body": "Changed author from **Ralf Stephan** to **Ralf Stephan, Armin Straub**",
    "created_at": "2016-08-18T10:35:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220326",
    "user": "https://github.com/arminstraub"
}
```

Changed author from **Ralf Stephan** to **Ralf Stephan, Armin Straub**



---

archive/issue_comments_220327.json:
```json
{
    "body": "<a id='comment:73'>Comment 73:</a>\nThanks for checking!\n\nYes, I did also review your code.  I don't know enough about maxima and the intricacies of interfacing it, but it is my understanding that that part of the code was checked by you and Nils, and I didn't run into any additional trouble.",
    "created_at": "2016-08-18T10:35:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220327",
    "user": "https://github.com/arminstraub"
}
```

<a id='comment:73'>Comment 73:</a>
Thanks for checking!

Yes, I did also review your code.  I don't know enough about maxima and the intricacies of interfacing it, but it is my understanding that that part of the code was checked by you and Nils, and I didn't run into any additional trouble.



---

archive/issue_comments_220328.json:
```json
{
    "body": "Changed reviewer from **Ralf Stephan** to **Ralf Stephan, Armin Straub**",
    "created_at": "2016-08-18T10:35:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220328",
    "user": "https://github.com/arminstraub"
}
```

Changed reviewer from **Ralf Stephan** to **Ralf Stephan, Armin Straub**



---

archive/issue_comments_220329.json:
```json
{
    "body": "<a id='comment:74'>Comment 74:</a>\nThe patchbot complains about `_swap_harmonic` not having a doctest.  Do we need to add one despite the underscore in the name?\n\nAlso, the bot indicates an issue with startup_modules, but I couldn't make sense of it...",
    "created_at": "2016-08-19T21:25:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220329",
    "user": "https://github.com/arminstraub"
}
```

<a id='comment:74'>Comment 74:</a>
The patchbot complains about `_swap_harmonic` not having a doctest.  Do we need to add one despite the underscore in the name?

Also, the bot indicates an issue with startup_modules, but I couldn't make sense of it...



---

archive/issue_comments_220330.json:
```json
{
    "body": "<a id='comment:75'>Comment 75:</a>\nI would ignore both but let's wait for the release manager.",
    "created_at": "2016-08-20T06:18:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220330",
    "user": "https://github.com/rwst"
}
```

<a id='comment:75'>Comment 75:</a>
I would ignore both but let's wait for the release manager.



---

archive/issue_comments_220331.json:
```json
{
    "body": "Changed branch from **[u/arminstraub/ticket/16671/harmonic_numbers](https://github.com/sagemath/sagetrac-mirror/tree/u/arminstraub/ticket/16671/harmonic_numbers)** to **[9042104](https://github.com/sagemath/sagetrac-mirror/commit/9042104196f2d3b9822b3827aa2bbd70097f7b95)**",
    "created_at": "2016-08-21T13:14:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16671#issuecomment-220331",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/arminstraub/ticket/16671/harmonic_numbers](https://github.com/sagemath/sagetrac-mirror/tree/u/arminstraub/ticket/16671/harmonic_numbers)** to **[9042104](https://github.com/sagemath/sagetrac-mirror/commit/9042104196f2d3b9822b3827aa2bbd70097f7b95)**



---

archive/issue_events_220776.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-08-21T13:14:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-220776"
}
```



---

archive/issue_events_220777.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "699518a5f291070f465658f0a514450232ddca39",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2016-08-21T13:14:00Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/16671",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16671#event-220777"
}
```
