# Issue 16045: Polytope volume function engines produce different results

archive/issues_015808.json:
```json
{
    "body": "The volume currently does not distinguish between ambient and induced volume. This should be changed.\n\nDifferent engine yield very different results, and example:\nThe lrs engine for polytope volume calculates volume respective to the dimension of the polytope,\nwhile the auto engine calculates volume respective to the dimension of the ambient space.\n\nExample:\n\n\n```\nm3 = matrix(ZZ, [[0,0,0],[0,0,1]])\np = Polyhedron(m3)\np.volume(engine=\"lrs\")\np.volume()\n\n1.0\n0\n```\n\n(Note: The lrs allows calculation of volumes of facets without reducing the dimension of the ambient space, but it uses non-isometrical projections!)\n\nThe suggested resolution adds a parameter `measure` that essentially behaves as follows:\n\n```\nsage: P = Polyhedron([[0, 0], [1, 1]])\nsage: P.volume()\n0\nsage: P.volume(measure='induced')                                                                                                                                   \nsqrt(2)\nsage: P.volume(measure='induced_rational') # optional -- latte_int\n1\n```\n\nCC:  jakobkroeker @mkoeppe @videlec @jplab @mforets @mo271 @seblabbe\n\nKeywords: polytope, volume, lrs_volume, days88\n\nStopgaps: wrongAnswerMarker\n\nReviewer: Jean-Philippe Labb\u00e9\n\nAuthor: Moritz Firsching\n\nBranch: f5d47cf5576ca2f752aaac47f859b2c997535af3\n\nDependencies: #20887 #22804\n\nCommit: f5d47cf5576ca2f752aaac47f859b2c997535af3\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/16045\n\n",
    "closed_at": "2017-09-10T11:56:41Z",
    "created_at": "2014-04-02T07:50:31Z",
    "labels": [
        "component: geometry",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "Polytope volume function engines produce different results",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16045",
    "user": "https://trac.sagemath.org/admin/accounts/users/wishcow"
}
```
The volume currently does not distinguish between ambient and induced volume. This should be changed.

Different engine yield very different results, and example:
The lrs engine for polytope volume calculates volume respective to the dimension of the polytope,
while the auto engine calculates volume respective to the dimension of the ambient space.

Example:


```
m3 = matrix(ZZ, [[0,0,0],[0,0,1]])
p = Polyhedron(m3)
p.volume(engine="lrs")
p.volume()

1.0
0
```

(Note: The lrs allows calculation of volumes of facets without reducing the dimension of the ambient space, but it uses non-isometrical projections!)

The suggested resolution adds a parameter `measure` that essentially behaves as follows:

```
sage: P = Polyhedron([[0, 0], [1, 1]])
sage: P.volume()
0
sage: P.volume(measure='induced')                                                                                                                                   
sqrt(2)
sage: P.volume(measure='induced_rational') # optional -- latte_int
1
```

CC:  jakobkroeker @mkoeppe @videlec @jplab @mforets @mo271 @seblabbe

Keywords: polytope, volume, lrs_volume, days88

Stopgaps: wrongAnswerMarker

Reviewer: Jean-Philippe Labb√©

Author: Moritz Firsching

Branch: f5d47cf5576ca2f752aaac47f859b2c997535af3

Dependencies: #20887 #22804

Commit: f5d47cf5576ca2f752aaac47f859b2c997535af3

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/16045





---

archive/issue_comments_204827.json:
```json
{
    "body": "<a id='comment:1'></a>what is a rational polytope? defined over rationals?\n\nAt least I could not get from documentation that using engine=\"lrs\"\nimplies  calculates volume respective to the dimension of the polytope\nand using 'auto' implies calculating volume respective to the dimension of the ambient space,\nso for me it is a wrong answer issue.",
    "created_at": "2017-03-04T00:22:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16045#issuecomment-204827",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

<a id='comment:1'></a>what is a rational polytope? defined over rationals?

At least I could not get from documentation that using engine="lrs"
implies  calculates volume respective to the dimension of the polytope
and using 'auto' implies calculating volume respective to the dimension of the ambient space,
so for me it is a wrong answer issue.



---

archive/issue_comments_204828.json:
```json
{
    "body": "<a id='comment:2'></a>This is actually very useful to have this. (I was actually looking for such a function just now).\n\nIt should perhaps be better documented with an optional parameter to switch this on and off and let `lrs` compute the volume of faces.",
    "created_at": "2017-03-09T18:30:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16045#issuecomment-204828",
    "user": "https://github.com/jplab"
}
```

<a id='comment:2'></a>This is actually very useful to have this. (I was actually looking for such a function just now).

It should perhaps be better documented with an optional parameter to switch this on and off and let `lrs` compute the volume of faces.



---

archive/issue_comments_204829.json:
```json
{
    "body": "<a id='comment:3'></a>I agree, a keyword parameter that controls the measure used for lower-dim faces would be useful.\nThere are currently 3 options:\n\n- 0\n- answer according to standard lower-dim measure\n- LattE always returns a rational answer, by normalizing with respect to the intersection lattice.",
    "created_at": "2017-03-09T18:35:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16045#issuecomment-204829",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>I agree, a keyword parameter that controls the measure used for lower-dim faces would be useful.
There are currently 3 options:

- 0
- answer according to standard lower-dim measure
- LattE always returns a rational answer, by normalizing with respect to the intersection lattice.



---

archive/issue_comments_204830.json:
```json
{
    "body": "<a id='comment:4'></a>A few questions:\n\n- What should be the name for the parameter (which is essentially boolean) that controls what measure to be used? \nI can think of `inherent`, `induced`, `relative`, `ambient`... (I think `instrinsic` would not be a good idea.)\n\n- Should the default for the parameter (if none is given) depend on the `engine` chosen? \n- What should happen if the `engine` is not able to compute the inherent volume?",
    "created_at": "2017-03-12T23:04:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16045#issuecomment-204830",
    "user": "https://github.com/mo271"
}
```

<a id='comment:4'></a>A few questions:

- What should be the name for the parameter (which is essentially boolean) that controls what measure to be used? 
I can think of `inherent`, `induced`, `relative`, `ambient`... (I think `instrinsic` would not be a good idea.)

- Should the default for the parameter (if none is given) depend on the `engine` chosen? 
- What should happen if the `engine` is not able to compute the inherent volume?



---

archive/issue_comments_204831.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:4 moritz]:\n> A few questions:\n> \n> - What should be the name for the parameter (which is essentially boolean) that controls what measure to be used?  I can think of `inherent`, `induced`, `relative`, `ambient`... (I think `instrinsic` would not be a good idea.)\n\n\nIt is a troolean (at least for rational polytopes) as mentioned in [comment:3 comment:3] of Marcelo.\n\n>  - Should the default for the parameter (if none is given) depend on the `engine` chosen? \n\n\nNo.\n\n>  - What should happen if the `engine` is not able to compute the inherent volume?\n\n\nA `ValueError` or a `RuntimeError`.",
    "created_at": "2017-03-14T12:23:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16045#issuecomment-204831",
    "user": "https://github.com/videlec"
}
```

<a id='comment:6'></a>Replying to [comment:4 moritz]:
> A few questions:
> 
> - What should be the name for the parameter (which is essentially boolean) that controls what measure to be used?  I can think of `inherent`, `induced`, `relative`, `ambient`... (I think `instrinsic` would not be a good idea.)


It is a troolean (at least for rational polytopes) as mentioned in [comment:3 comment:3] of Marcelo.

>  - Should the default for the parameter (if none is given) depend on the `engine` chosen? 


No.

>  - What should happen if the `engine` is not able to compute the inherent volume?


A `ValueError` or a `RuntimeError`.



---

archive/issue_comments_204832.json:
```json
{
    "body": "<a id='comment:8'></a>So how about the following solve the problem:\n\nWe introduce a parameter \"measure\" with the following options:\n\n- \"ambient\" (the default?!)\n- \"induced\" \n- \"latte_renormalized\" (or something that Matthias likes)\n\nI suppose it would be wisest to catch measure=\"ambient\" if the polytope is not full-dimensional and return \"0\" for all the engines (Even if the engines only can compute the induced volume of the polytope)\n\nShould it could work like:\n\n```\nsage: m3 = matrix(ZZ, [[0,0,0],[0,0,1]])\nsage: p = Polyhedron(m3)\nsage: p.volume()\n0\nsage: p.volume(engine=\"lrs\", measure=\"induced\")\n1.0\nsage: p.volume(engine=\"lrs\", measure=\"ambient\")\n0\nsage: p.volume(measure=\"induced\")\nValueError or a RuntimeError: \"Please choose a different engine.\"\n```\n\nMaybe it would be ok to choose a differnt engine for the last command automatically.\n\nWhat do you think?",
    "created_at": "2017-03-16T17:41:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16045#issuecomment-204832",
    "user": "https://github.com/mo271"
}
```

<a id='comment:8'></a>So how about the following solve the problem:

We introduce a parameter "measure" with the following options:

- "ambient" (the default?!)
- "induced" 
- "latte_renormalized" (or something that Matthias likes)

I suppose it would be wisest to catch measure="ambient" if the polytope is not full-dimensional and return "0" for all the engines (Even if the engines only can compute the induced volume of the polytope)

Should it could work like:

```
sage: m3 = matrix(ZZ, [[0,0,0],[0,0,1]])
sage: p = Polyhedron(m3)
sage: p.volume()
0
sage: p.volume(engine="lrs", measure="induced")
1.0
sage: p.volume(engine="lrs", measure="ambient")
0
sage: p.volume(measure="induced")
ValueError or a RuntimeError: "Please choose a different engine."
```

Maybe it would be ok to choose a differnt engine for the last command automatically.

What do you think?



---

archive/issue_comments_204833.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:8 moritz]:\n> So how about the following solve the problem:\n> \n> We introduce a parameter \"measure\" with the following options:\n> \n> - \"ambient\" (the default?!)\n> - \"induced\" \n> - \"latte_renormalized\" (or something that Matthias likes)\n\n\nNote that \"latte_renormalized\" only make sense for polyhedron defined over Q. I guess it would be better `\"induced_rational\"` rather than any reference to latte. This renormalization is very natural.\n\n> I suppose it would be wisest to catch measure=\"ambient\" if the polytope is not full-dimensional and return \"0\" for all the engines (Even if the engines only can compute the induced volume of the polytope)\n> \n> Should it could work like:\n> \n> ```\n> sage: m3 = matrix(ZZ, [[0,0,0],[0,0,1]])\n> sage: p = Polyhedron(m3)\n> sage: p.volume()\n> 0\n> sage: p.volume(engine=\"lrs\", measure=\"induced\")\n> 1.0\n> sage: p.volume(engine=\"lrs\", measure=\"ambient\")\n> 0\n> sage: p.volume(measure=\"induced\")\n> ValueError or a RuntimeError: \"Please choose a different engine.\"\n> ```\n\n>\n> Maybe it would be ok to choose a differnt engine for the last command automatically.\n\n\n+1. I also do not like the behavior of the last command. The default choice of the engine should take into account the `measure` argument (which should be firt BTW).\n\n```\ndef volume(measure=\"ambient\", engine=None):\n    r\"\"\"\n    Return the volume (or relative volume) of the polytope\n    \"\"\"\n```",
    "created_at": "2017-03-16T17:58:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16045#issuecomment-204833",
    "user": "https://github.com/videlec"
}
```

<a id='comment:9'></a>Replying to [comment:8 moritz]:
> So how about the following solve the problem:
> 
> We introduce a parameter "measure" with the following options:
> 
> - "ambient" (the default?!)
> - "induced" 
> - "latte_renormalized" (or something that Matthias likes)


Note that "latte_renormalized" only make sense for polyhedron defined over Q. I guess it would be better `"induced_rational"` rather than any reference to latte. This renormalization is very natural.

> I suppose it would be wisest to catch measure="ambient" if the polytope is not full-dimensional and return "0" for all the engines (Even if the engines only can compute the induced volume of the polytope)
> 
> Should it could work like:
> 
> ```
> sage: m3 = matrix(ZZ, [[0,0,0],[0,0,1]])
> sage: p = Polyhedron(m3)
> sage: p.volume()
> 0
> sage: p.volume(engine="lrs", measure="induced")
> 1.0
> sage: p.volume(engine="lrs", measure="ambient")
> 0
> sage: p.volume(measure="induced")
> ValueError or a RuntimeError: "Please choose a different engine."
> ```

>
> Maybe it would be ok to choose a differnt engine for the last command automatically.


+1. I also do not like the behavior of the last command. The default choice of the engine should take into account the `measure` argument (which should be firt BTW).

```
def volume(measure="ambient", engine=None):
    r"""
    Return the volume (or relative volume) of the polytope
    """
```



---

archive/issue_comments_204834.json:
```json
{
    "body": "<a id='comment:10'></a>minor remark: ticket #20887 also touches the polyhedron volume function",
    "created_at": "2017-03-16T18:19:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16045#issuecomment-204834",
    "user": "https://github.com/mforets"
}
```

<a id='comment:10'></a>minor remark: ticket #20887 also touches the polyhedron volume function



---

archive/issue_comments_204835.json:
```json
{
    "body": "<a id='comment:11'></a>+1 on `\"induced_rational\"`",
    "created_at": "2017-03-16T18:36:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16045#issuecomment-204835",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>+1 on `"induced_rational"`



---

archive/issue_comments_204836.json:
```json
{
    "body": "<a id='comment:13'></a>I am building on #20887 and introduced a `measure` option.\n\nHere is a test (make sure ou have latte_int, topcom and lrs installed)\n\n```\nsage: C = polytopes.cube()\nsage: P = polytopes.permutahedron(4)\nsage: P\nA 3-dimensional polyhedron in ZZ^4 defined as the convex hull of 24 vertices\nsage: measures = [\"ambient\", \"induced\", \"induced_rational\"]\nsage: engines = [\"auto\", \"internal\", \"TOPCOM\", \"lrs\", \"latte\"]\nsage: for m in measures:\n....:     for e in engines:\n....:         try:\n....:             pvol = P.volume(measure=m, engine=e)\n....:         except TypeError as err:\n....:             pvol = err\n....:         try:\n....:             cvol = C.volume(measure=m, engine=e)\n....:         except Exception as err:\n....:             cvol = err\n....:         print 'measure =',m, 'engine =',e \n....:         print 'not-fulldimensional example: ', pvol\n....:         print 'full-dimensional example: ', cvol\n....:         print '--------------'\n....:         \nmeasure = ambient engine = auto\nnot-fulldimensional example:  0\nfull-dimensional example:  8\n--------------\nmeasure = ambient engine = internal\nnot-fulldimensional example:  0\nfull-dimensional example:  8\n--------------\nmeasure = ambient engine = TOPCOM\nnot-fulldimensional example:  0\nfull-dimensional example:  8\n--------------\nmeasure = ambient engine = lrs\nnot-fulldimensional example:  0\nfull-dimensional example:  8.0\n--------------\nmeasure = ambient engine = latte\nnot-fulldimensional example:  0\nfull-dimensional example:  8\n--------------\nmeasure = induced engine = auto\nnot-fulldimensional example:  16.0\nfull-dimensional example:  8.0\n--------------\nmeasure = induced engine = internal\nnot-fulldimensional example:  The induced measure can only be computed with the engine set to `auto` or `lrs`\nfull-dimensional example:  8.0\n--------------\nmeasure = induced engine = TOPCOM\nnot-fulldimensional example:  The induced measure can only be computed with the engine set to `auto` or `lrs`\nfull-dimensional example:  8.0\n--------------\nmeasure = induced engine = lrs\nnot-fulldimensional example:  16.0\nfull-dimensional example:  8.0\n--------------\nmeasure = induced engine = latte\nnot-fulldimensional example:  The induced measure can only be computed with the engine set to `auto` or `lrs`\nfull-dimensional example:  8.0\n--------------\nmeasure = induced_rational engine = auto\nnot-fulldimensional example:  16\nfull-dimensional example:  8\n--------------\nmeasure = induced_rational engine = internal\nnot-fulldimensional example:  The induced rational measure can only be computed with the engine set to `auto` or `latte`\nfull-dimensional example:  8\n--------------\nmeasure = induced_rational engine = TOPCOM\nnot-fulldimensional example:  The induced rational measure can only be computed with the engine set to `auto` or `latte`\nfull-dimensional example:  8\n--------------\nmeasure = induced_rational engine = lrs\nnot-fulldimensional example:  The induced rational measure can only be computed with the engine set to `auto` or `latte`\nfull-dimensional example:  8\n--------------\nmeasure = induced_rational engine = latte\nnot-fulldimensional example:  16\nfull-dimensional example:  8\n--------------\n```\n\n\nThe options are explained as \n\n```\n        - ``measure`` -- string. The measure to use. Allowed values are:\n\n          * ``ambient``: Lebesgue measure of ambient space (volume)\n          * ``induced``: Lebesgue measure of affine hull (relative volume)\n          * ``induced_rational``: TODO: explanation (only makes sense for integer polytopes?!)\n\n        - ``engine`` -- string. The backend to use. Allowed values are:\n\n          * ``'auto'`` (default): choose engine according to measure\n          * ``'internal'``: see :meth:`triangulate`.\n          * ``'TOPCOM'``: see :meth:`triangulate`.\n          * ``'lrs'``: use David Avis's lrs program (optional).\n          * ``'latte'``: use LattE integrale program (optional).\n```\n\nWhat could I write for `induced_rational`?\n\nI have not yet added doctests.\n\nComments welcome!\n\n---\nNew commits:",
    "created_at": "2017-03-31T16:03:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16045#issuecomment-204836",
    "user": "https://github.com/mo271"
}
```

<a id='comment:13'></a>I am building on #20887 and introduced a `measure` option.

Here is a test (make sure ou have latte_int, topcom and lrs installed)

```
sage: C = polytopes.cube()
sage: P = polytopes.permutahedron(4)
sage: P
A 3-dimensional polyhedron in ZZ^4 defined as the convex hull of 24 vertices
sage: measures = ["ambient", "induced", "induced_rational"]
sage: engines = ["auto", "internal", "TOPCOM", "lrs", "latte"]
sage: for m in measures:
....:     for e in engines:
....:         try:
....:             pvol = P.volume(measure=m, engine=e)
....:         except TypeError as err:
....:             pvol = err
....:         try:
....:             cvol = C.volume(measure=m, engine=e)
....:         except Exception as err:
....:             cvol = err
....:         print 'measure =',m, 'engine =',e 
....:         print 'not-fulldimensional example: ', pvol
....:         print 'full-dimensional example: ', cvol
....:         print '--------------'
....:         
measure = ambient engine = auto
not-fulldimensional example:  0
full-dimensional example:  8
--------------
measure = ambient engine = internal
not-fulldimensional example:  0
full-dimensional example:  8
--------------
measure = ambient engine = TOPCOM
not-fulldimensional example:  0
full-dimensional example:  8
--------------
measure = ambient engine = lrs
not-fulldimensional example:  0
full-dimensional example:  8.0
--------------
measure = ambient engine = latte
not-fulldimensional example:  0
full-dimensional example:  8
--------------
measure = induced engine = auto
not-fulldimensional example:  16.0
full-dimensional example:  8.0
--------------
measure = induced engine = internal
not-fulldimensional example:  The induced measure can only be computed with the engine set to `auto` or `lrs`
full-dimensional example:  8.0
--------------
measure = induced engine = TOPCOM
not-fulldimensional example:  The induced measure can only be computed with the engine set to `auto` or `lrs`
full-dimensional example:  8.0
--------------
measure = induced engine = lrs
not-fulldimensional example:  16.0
full-dimensional example:  8.0
--------------
measure = induced engine = latte
not-fulldimensional example:  The induced measure can only be computed with the engine set to `auto` or `lrs`
full-dimensional example:  8.0
--------------
measure = induced_rational engine = auto
not-fulldimensional example:  16
full-dimensional example:  8
--------------
measure = induced_rational engine = internal
not-fulldimensional example:  The induced rational measure can only be computed with the engine set to `auto` or `latte`
full-dimensional example:  8
--------------
measure = induced_rational engine = TOPCOM
not-fulldimensional example:  The induced rational measure can only be computed with the engine set to `auto` or `latte`
full-dimensional example:  8
--------------
measure = induced_rational engine = lrs
not-fulldimensional example:  The induced rational measure can only be computed with the engine set to `auto` or `latte`
full-dimensional example:  8
--------------
measure = induced_rational engine = latte
not-fulldimensional example:  16
full-dimensional example:  8
--------------
```


The options are explained as 

```
        - ``measure`` -- string. The measure to use. Allowed values are:

          * ``ambient``: Lebesgue measure of ambient space (volume)
          * ``induced``: Lebesgue measure of affine hull (relative volume)
          * ``induced_rational``: TODO: explanation (only makes sense for integer polytopes?!)

        - ``engine`` -- string. The backend to use. Allowed values are:

          * ``'auto'`` (default): choose engine according to measure
          * ``'internal'``: see :meth:`triangulate`.
          * ``'TOPCOM'``: see :meth:`triangulate`.
          * ``'lrs'``: use David Avis's lrs program (optional).
          * ``'latte'``: use LattE integrale program (optional).
```

What could I write for `induced_rational`?

I have not yet added doctests.

Comments welcome!

---
New commits:



---

archive/issue_comments_204837.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2017-03-31T16:03:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16045#issuecomment-204837",
    "user": "https://github.com/mo271"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_204838.json:
```json
{
    "body": "<a id='comment:14'></a>> What could I write for induced_rational? \n\n\n(I think this is describe in the latte manual) Given the polytope P in Z<sup>d</sup> it spans an affine space E. The ambient measure is the only scaling of the Lebesgue measure so that the lattice `E \\cap Z^d` has covolume 1 in E.",
    "created_at": "2017-03-31T16:07:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16045#issuecomment-204838",
    "user": "https://github.com/videlec"
}
```

<a id='comment:14'></a>> What could I write for induced_rational? 


(I think this is describe in the latte manual) Given the polytope P in Z<sup>d</sup> it spans an affine space E. The ambient measure is the only scaling of the Lebesgue measure so that the lattice `E \cap Z^d` has covolume 1 in E.



---

archive/issue_comments_204839.json:
```json
{
    "body": "<a id='comment:15'></a>If you merge commits from #20887 here you should set it as a dependency.",
    "created_at": "2017-03-31T16:11:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16045#issuecomment-204839",
    "user": "https://github.com/videlec"
}
```

<a id='comment:15'></a>If you merge commits from #20887 here you should set it as a dependency.



---

archive/issue_comments_204840.json:
```json
{
    "body": "<a id='comment:16'></a>Note that it's also defined for rational polytopes; and more generally for any (possibly irrational) translation of those.",
    "created_at": "2017-03-31T16:14:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16045#issuecomment-204840",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>Note that it's also defined for rational polytopes; and more generally for any (possibly irrational) translation of those.



---

archive/issue_comments_204841.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2017-04-02T18:15:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16045#issuecomment-204841",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_204842.json:
```json
{
    "body": "<a id='comment:19'></a>I noticed that \"lrs\" is in fact **not** computing the Lebesgue measure of the affine hull. Form the lrs web-page: \n\n\n  If the option is applied to a V-representation of  a polytope that is not full dimensional, the volume of a projected polytope is computed. The projection used is to the lexicographically smallest coordinate subspace, see Avis, Fukuda, Picozzi (2002).  \n\n\nIn fact, this shows already in one of the old doctests:\n\n```\nsage: I = Polyhedron([(0,0), (1,1)])\nsage: I.volume(engine='lrs') #optional - lrslib\n1.0\n```\nThe result with the induced measure should be `sqrt(2)` (or `1.414213562373095` I guess)\n\nSo this should not be used to compute the volume of facets, as mentioned in comment:2 !\n\nIn any case I still think it would be useful to have the option for this measure, except that at the moment, none of the engines is able to actually compute appropriate induced volumes. \n\nPerhaps it would be useful to open a ticket to ask for a function, that does compute the induced measure?! A naive implementation could choose an affine basis of vertices and then some isometry.",
    "created_at": "2017-04-03T09:01:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16045#issuecomment-204842",
    "user": "https://github.com/mo271"
}
```

<a id='comment:19'></a>I noticed that "lrs" is in fact **not** computing the Lebesgue measure of the affine hull. Form the lrs web-page: 


  If the option is applied to a V-representation of  a polytope that is not full dimensional, the volume of a projected polytope is computed. The projection used is to the lexicographically smallest coordinate subspace, see Avis, Fukuda, Picozzi (2002).  


In fact, this shows already in one of the old doctests:

```
sage: I = Polyhedron([(0,0), (1,1)])
sage: I.volume(engine='lrs') #optional - lrslib
1.0
```
The result with the induced measure should be `sqrt(2)` (or `1.414213562373095` I guess)

So this should not be used to compute the volume of facets, as mentioned in comment:2 !

In any case I still think it would be useful to have the option for this measure, except that at the moment, none of the engines is able to actually compute appropriate induced volumes. 

Perhaps it would be useful to open a ticket to ask for a function, that does compute the induced measure?! A naive implementation could choose an affine basis of vertices and then some isometry.



---

archive/issue_comments_204843.json:
```json
{
    "body": "<a id='comment:20'></a>It would be nice to have an explanation of these subtleties in the doc of the function (as shown by Moritz). Consequently, the issue described in the ticket would be resolved so as to address the reason why it returns different results.\n\nIMHO, I guess it is okay to have one method returning different results depending on the value of the parameters. So +1 to have an optional parameter which specifies the measure (and hence the engine in some cases) as Vincent mentionned.\n\nFinally, add a TODO that would ask for the lebesgue measure which would be addressed in a separate ticket and explain what `lrs` is doing with a possible link to the webpage.\n\nWhat do you think?",
    "created_at": "2017-04-04T07:41:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16045#issuecomment-204843",
    "user": "https://github.com/jplab"
}
```

<a id='comment:20'></a>It would be nice to have an explanation of these subtleties in the doc of the function (as shown by Moritz). Consequently, the issue described in the ticket would be resolved so as to address the reason why it returns different results.

IMHO, I guess it is okay to have one method returning different results depending on the value of the parameters. So +1 to have an optional parameter which specifies the measure (and hence the engine in some cases) as Vincent mentionned.

Finally, add a TODO that would ask for the lebesgue measure which would be addressed in a separate ticket and explain what `lrs` is doing with a possible link to the webpage.

What do you think?



---

archive/issue_comments_204844.json:
```json
{
    "body": "<a id='comment:21'></a>One thing that would be useful to have, would be a function, that takes a non full-dimensional poytope and returns a full-dimensional one that is affinely equivalent to the original one. Note that the usual `.affine_hull` method does not achive that goal:\n\n```\nsage: p = Polyhedron([[0,0],[1,1]])\nsage: p.affine_hull()\nA 1-dimensional polyhedron in ZZ^1 defined as the convex hull of 2 vertices\nsage: p.affine_hull().vertices()\n(A vertex at (0), A vertex at (1))\n```\nThe length of the affine hull is not `sqrt(2)` as one might expect. Another example would be \n\n``` \nsage: s = polytopes.simplex()\nsage: s\nA 3-dimensional polyhedron in ZZ^4 defined as the convex hull of 4 vertices\nsage: s.affine_hull()\nA 3-dimensional polyhedron in ZZ^3 defined as the convex hull of 4 vertices\nsage: _.show()\nLaunched jmol viewer for Graphics3d Object\n```\nHere the simplex is not regular after using `.affine_hull`. \n\nConsider this new `affine_hull` function:\n\n```\ndef affine_hull(P, preserve_volume=True):\n    if P.ambient_dim() == P.dim():\n        return P\n    Q = P.translation(-vector(P.vertices()[0]))\n    v = Q.vertices()[0]\n    assert list(v) == P.ambient_dim()*[0]\n    import itertools\n    M = Matrix([list(w) for w in itertools.islice(v.neighbors(), P.dim())])\n    if P.base_ring() in [ZZ,QQ]:\n        M = Matrix(AA,M)\n    A = M.gram_schmidt(orthonormal = True)[0]\n    return Polyhedron([A*vector(v) for v in Q.vertices()])\n```\n\n\nUsing this gets the desired results:\n\n```\nsage: p = Polyhedron([[0,0],[1,1]])\nsage: affine_hull(p)\nA 1-dimensional polyhedron in AA^1 defined as the convex hull of 2 vertices\nsage: affine_hull(p).vertices()\n(A vertex at (0), A vertex at (1.414213562373095?))\n```\nIt is actually useful to plot the permutahedron nicely:\n\n```\nsage: P = polytopes.permutahedron(4)\nsage: P\nA 3-dimensional polyhedron in ZZ^4 defined as the convex hull of 24 vertices\nsage: affine_hull(P)\nA 3-dimensional polyhedron in AA^3 defined as the convex hull of 24 vertices\nsage: _.plot()\nLaunched jmol viewer for Graphics3d Object\n```\n\n\n\n (There is an inherent problem, that considering a rational polytope as full-dimensional polytope in its affine hull might lead to non-rational polyopes: basically you want to work in a field with square roots.)\n\nIn any case I propose to introduce an improved version of the `.affine_hull` method, perhaps with an parameter `preserve_volume=True` (or `isometry=True`) an then use this method to handle the cases of the volume of non full-dimenional polytopes here. \n\n\nWhat do you think?",
    "created_at": "2017-04-12T09:12:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16045#issuecomment-204844",
    "user": "https://github.com/mo271"
}
```

<a id='comment:21'></a>One thing that would be useful to have, would be a function, that takes a non full-dimensional poytope and returns a full-dimensional one that is affinely equivalent to the original one. Note that the usual `.affine_hull` method does not achive that goal:

```
sage: p = Polyhedron([[0,0],[1,1]])
sage: p.affine_hull()
A 1-dimensional polyhedron in ZZ^1 defined as the convex hull of 2 vertices
sage: p.affine_hull().vertices()
(A vertex at (0), A vertex at (1))
```
The length of the affine hull is not `sqrt(2)` as one might expect. Another example would be 

``` 
sage: s = polytopes.simplex()
sage: s
A 3-dimensional polyhedron in ZZ^4 defined as the convex hull of 4 vertices
sage: s.affine_hull()
A 3-dimensional polyhedron in ZZ^3 defined as the convex hull of 4 vertices
sage: _.show()
Launched jmol viewer for Graphics3d Object
```
Here the simplex is not regular after using `.affine_hull`. 

Consider this new `affine_hull` function:

```
def affine_hull(P, preserve_volume=True):
    if P.ambient_dim() == P.dim():
        return P
    Q = P.translation(-vector(P.vertices()[0]))
    v = Q.vertices()[0]
    assert list(v) == P.ambient_dim()*[0]
    import itertools
    M = Matrix([list(w) for w in itertools.islice(v.neighbors(), P.dim())])
    if P.base_ring() in [ZZ,QQ]:
        M = Matrix(AA,M)
    A = M.gram_schmidt(orthonormal = True)[0]
    return Polyhedron([A*vector(v) for v in Q.vertices()])
```


Using this gets the desired results:

```
sage: p = Polyhedron([[0,0],[1,1]])
sage: affine_hull(p)
A 1-dimensional polyhedron in AA^1 defined as the convex hull of 2 vertices
sage: affine_hull(p).vertices()
(A vertex at (0), A vertex at (1.414213562373095?))
```
It is actually useful to plot the permutahedron nicely:

```
sage: P = polytopes.permutahedron(4)
sage: P
A 3-dimensional polyhedron in ZZ^4 defined as the convex hull of 24 vertices
sage: affine_hull(P)
A 3-dimensional polyhedron in AA^3 defined as the convex hull of 24 vertices
sage: _.plot()
Launched jmol viewer for Graphics3d Object
```



 (There is an inherent problem, that considering a rational polytope as full-dimensional polytope in its affine hull might lead to non-rational polyopes: basically you want to work in a field with square roots.)

In any case I propose to introduce an improved version of the `.affine_hull` method, perhaps with an parameter `preserve_volume=True` (or `isometry=True`) an then use this method to handle the cases of the volume of non full-dimenional polytopes here. 


What do you think?



---

archive/issue_comments_204845.json:
```json
{
    "body": "<a id='comment:22'></a>Replying to [comment:21 moritz]:\n> One thing that would be useful to have, would be a function, that takes a non full-dimensional poytope and returns a full-dimensional one that is affinely equivalent to the original one.\n\n>\n> [...]\n> \n> What do you think?\n\n\nI agree that it would be useful and essentially straightforward (ignoring details about base ring). You can open a **new** ticket and move the discussion there.",
    "created_at": "2017-04-12T09:36:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16045#issuecomment-204845",
    "user": "https://github.com/videlec"
}
```

<a id='comment:22'></a>Replying to [comment:21 moritz]:
> One thing that would be useful to have, would be a function, that takes a non full-dimensional poytope and returns a full-dimensional one that is affinely equivalent to the original one.

>
> [...]
> 
> What do you think?


I agree that it would be useful and essentially straightforward (ignoring details about base ring). You can open a **new** ticket and move the discussion there.



---

archive/issue_comments_204846.json:
```json
{
    "body": "<a id='comment:23'></a>Replying to [comment:22 vdelecroix]:\n> I agree that it would be useful and essentially straightforward (ignoring details about base ring). You can open a **new** ticket and move the discussion there.\n\n\nI opened #22804 and already added some code. This could eventually become a depency here (#16045) and we can end up with a '.volume' method that is more useful...",
    "created_at": "2017-04-13T11:58:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16045#issuecomment-204846",
    "user": "https://github.com/mo271"
}
```

<a id='comment:23'></a>Replying to [comment:22 vdelecroix]:
> I agree that it would be useful and essentially straightforward (ignoring details about base ring). You can open a **new** ticket and move the discussion there.


I opened #22804 and already added some code. This could eventually become a depency here (#16045) and we can end up with a '.volume' method that is more useful...



---

archive/issue_comments_204847.json:
```json
{
    "body": "<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-06-29T18:59:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16045#issuecomment-204847",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_204848.json:
```json
{
    "body": "<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-06-29T19:03:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16045#issuecomment-204848",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_204849.json:
```json
{
    "body": "<a id='comment:27'></a>I now used the new affine hull function to provide induced volumes; comments welcome!\n\nI would like to include a good example / doctest for the induced rational volume, any hints? (Also to improve the description ind the section \"Input\"?)",
    "created_at": "2017-06-29T19:13:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16045#issuecomment-204849",
    "user": "https://github.com/mo271"
}
```

<a id='comment:27'></a>I now used the new affine hull function to provide induced volumes; comments welcome!

I would like to include a good example / doctest for the induced rational volume, any hints? (Also to improve the description ind the section "Input"?)



---

archive/issue_comments_204850.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2017-06-29T19:13:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16045#issuecomment-204850",
    "user": "https://github.com/mo271"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_comments_204851.json:
```json
{
    "body": "<a id='comment:28'></a>Replying to [comment:27 moritz]:\n> I now used the new affine hull function to provide induced volumes; comments welcome!\n> \n> I would like to include a good example / doctest for the induced rational volume, any hints? (Also to improve the description ind the section \"Input\"?)\n\n\nVolume of the line segment between `(a,0)` and `(0,b)` are already good examples. Then you can do that for the triangle `(a,0,0)`, `(0,b,0)` and `(0,0,c)`. And you can consider polytopes obtained by permuting the entries of a vector like\n\n```\nsage: Polyhedron(vertices=[(0,0,1,1),(0,1,1,0),(1,1,0,0)])\nA 2-dimensional polyhedron in ZZ^4 defined as the convex hull of 3 vertices\n```",
    "created_at": "2017-06-29T22:29:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16045#issuecomment-204851",
    "user": "https://github.com/videlec"
}
```

<a id='comment:28'></a>Replying to [comment:27 moritz]:
> I now used the new affine hull function to provide induced volumes; comments welcome!
> 
> I would like to include a good example / doctest for the induced rational volume, any hints? (Also to improve the description ind the section "Input"?)


Volume of the line segment between `(a,0)` and `(0,b)` are already good examples. Then you can do that for the triangle `(a,0,0)`, `(0,b,0)` and `(0,0,c)`. And you can consider polytopes obtained by permuting the entries of a vector like

```
sage: Polyhedron(vertices=[(0,0,1,1),(0,1,1,0),(1,1,0,0)])
A 2-dimensional polyhedron in ZZ^4 defined as the convex hull of 3 vertices
```



---

archive/issue_comments_204852.json:
```json
{
    "body": "<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-06-30T08:14:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16045#issuecomment-204852",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_204853.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2017-07-03T09:36:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16045#issuecomment-204853",
    "user": "https://github.com/mo271"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_204854.json:
```json
{
    "body": "<a id='comment:31'></a>Hi Moritz,\n\nSmall comments:\n\n- In the doc: `measure.Different engines`   (add space)\n- Further, right after this sentence, could there be a short sentence, maybe as a note, to say what \"for lattice polytope\" means exactly?.\n- For the example, `P = Polyhedron([[0, 0], [1, 1]])` I would also add the output with the parameter `induced_rational`. This will make it contrast right away, rather than waiting for polyhedron `I`. (It is minor but very instructive).\n-  Perhaps name the second polyhedron `P` differently.\n- `if polyhedron is actually full-dimensional, return volume with ambient measuren` (remove the `n` at the end).\n\nYou have some failed tests:\n\n```\n    **********************************************************************\nFile \"src/sage/geometry/polyhedron/base.py\", line 4373, in sage.geometry.polyhedron.base.Polyhedron_base.volume\nFailed example:\n    w = Dinexact.faces(2)[0].as_polyhedron().volume(measure='induced', engine='internal'); w\nExpected:\n    1.534062710738235\nGot:\n    1.5340627107382352\n```\n\n```\nFailed example:\n    I.volume(measure='induced_rational')\nException raised:\n    NotImplementedError: You must install the optional latte_int package for this function to work.\n```\n\n(add `# optional -- latte_int`)",
    "created_at": "2017-07-12T09:48:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16045#issuecomment-204854",
    "user": "https://github.com/jplab"
}
```

<a id='comment:31'></a>Hi Moritz,

Small comments:

- In the doc: `measure.Different engines`   (add space)
- Further, right after this sentence, could there be a short sentence, maybe as a note, to say what "for lattice polytope" means exactly?.
- For the example, `P = Polyhedron([[0, 0], [1, 1]])` I would also add the output with the parameter `induced_rational`. This will make it contrast right away, rather than waiting for polyhedron `I`. (It is minor but very instructive).
-  Perhaps name the second polyhedron `P` differently.
- `if polyhedron is actually full-dimensional, return volume with ambient measuren` (remove the `n` at the end).

You have some failed tests:

```
    **********************************************************************
File "src/sage/geometry/polyhedron/base.py", line 4373, in sage.geometry.polyhedron.base.Polyhedron_base.volume
Failed example:
    w = Dinexact.faces(2)[0].as_polyhedron().volume(measure='induced', engine='internal'); w
Expected:
    1.534062710738235
Got:
    1.5340627107382352
```

```
Failed example:
    I.volume(measure='induced_rational')
Exception raised:
    NotImplementedError: You must install the optional latte_int package for this function to work.
```

(add `# optional -- latte_int`)



---

archive/issue_comments_204855.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-07-12T09:48:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16045#issuecomment-204855",
    "user": "https://github.com/jplab"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_204856.json:
```json
{
    "body": "<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-07-13T19:31:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16045#issuecomment-204856",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_204857.json:
```json
{
    "body": "<a id='comment:33'></a>Thanks for the comments, JP!\n\nI fixed everything, except perhaps the following; where I was not quite sure what is going on. (Perhaps somehow different machines have different ideas what a real double is..)\n\n```\n    w = Dinexact.faces(2)[0].as_polyhedron().volume(measure='induced', engine='internal'); w\nExpected:\n    1.534062710738235\nGot:\n    1.5340627107382352\n```\n\nI hope I managed to add `# optional -- latte_int` in all relevant places: I didn't test it without `latte_int` installed.",
    "created_at": "2017-07-13T19:36:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16045#issuecomment-204857",
    "user": "https://github.com/mo271"
}
```

<a id='comment:33'></a>Thanks for the comments, JP!

I fixed everything, except perhaps the following; where I was not quite sure what is going on. (Perhaps somehow different machines have different ideas what a real double is..)

```
    w = Dinexact.faces(2)[0].as_polyhedron().volume(measure='induced', engine='internal'); w
Expected:
    1.534062710738235
Got:
    1.5340627107382352
```

I hope I managed to add `# optional -- latte_int` in all relevant places: I didn't test it without `latte_int` installed.



---

archive/issue_comments_204858.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2017-07-13T19:36:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16045#issuecomment-204858",
    "user": "https://github.com/mo271"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_comments_204859.json:
```json
{
    "body": "<a id='comment:34'></a>Use [# abs tol](https://github.com/sagemath/sage/blob/develop/src/sage/symbolic/integration/integral.py#L726) marker in the comment. See [Special Markup to Influence Doctests](http://doc.sagemath.org/html/en/developer/coding_basics.html#special-markup-to-influence-doctests) in the documentation.",
    "created_at": "2017-07-17T08:46:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16045#issuecomment-204859",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:34'></a>Use [# abs tol](https://github.com/sagemath/sage/blob/develop/src/sage/symbolic/integration/integral.py#L726) marker in the comment. See [Special Markup to Influence Doctests](http://doc.sagemath.org/html/en/developer/coding_basics.html#special-markup-to-influence-doctests) in the documentation.



---

archive/issue_comments_204860.json:
```json
{
    "body": "<a id='comment:35'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-07-17T11:17:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16045#issuecomment-204860",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:35'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_204861.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2017-07-17T11:24:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16045#issuecomment-204861",
    "user": "https://github.com/mo271"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_204862.json:
```json
{
    "body": "<a id='comment:36'></a>Thanks, S\u00e9bastian! \nI added the marker..",
    "created_at": "2017-07-17T11:24:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16045#issuecomment-204862",
    "user": "https://github.com/mo271"
}
```

<a id='comment:36'></a>Thanks, S√©bastian! 
I added the marker..



---

archive/issue_comments_204863.json:
```json
{
    "body": "Changing keywords from \"polytope, volume, lrs_volume\" to \"polytope, volume, lrs_volume, days88\".",
    "created_at": "2017-08-21T16:18:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16045#issuecomment-204863",
    "user": "https://github.com/jplab"
}
```

Changing keywords from "polytope, volume, lrs_volume" to "polytope, volume, lrs_volume, days88".



---

archive/issue_comments_204864.json:
```json
{
    "body": "<a id='comment:38'></a>There is a hidden failed test (probably got caught by chance by the bot):\n\n```\nsage -t --long src/sage/geometry/polyhedron/backend_normaliz.py\n**********************************************************************\nFile \"src/sage/geometry/polyhedron/backend_normaliz.py\", line 412, in sage.geometry.polyhedron.backend_normaliz.Polyhedron_normaliz.integral_hull\nFailed example:\n    set(PI.Vrepresentation())                                # optional - pynormaliz\nExpected:\n    {A vertex at (-1, 0), A vertex at (0, 1), A ray in the direction (1, 0)}\nGot:\n    {A ray in the direction (1, 0), A vertex at (-1, 0), A vertex at (0, 1)}\n**********************************************************************\nFile \"src/sage/geometry/polyhedron/backend_normaliz.py\", line 420, in sage.geometry.polyhedron.backend_normaliz.Polyhedron_normaliz.integral_hull\nFailed example:\n    set(PI.Vrepresentation())                                # optional - pynormaliz\nExpected:\n    {A vertex at (1, 0),\n     A ray in the direction (1, 0),\n     A line in the direction (1, -1)}\nGot:\n    {A line in the direction (1, -1),\n     A ray in the direction (1, 0),\n     A vertex at (1, 0)}\n**********************************************************************\n1 item had failures:\n   2 of  10 in sage.geometry.polyhedron.backend_normaliz.Polyhedron_normaliz.integral_hull\n    [100 tests, 2 failures, 4.39 s]\n```\n\nQuestion: I have \"normaliz\" in my optional installed packages but not \"pynormaliz\", is the above naming correct then?\n\nI am aware that this is not the topic of this ticket but since the tests failed here, it is probably best to treat this here.",
    "created_at": "2017-08-21T21:48:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16045#issuecomment-204864",
    "user": "https://github.com/jplab"
}
```

<a id='comment:38'></a>There is a hidden failed test (probably got caught by chance by the bot):

```
sage -t --long src/sage/geometry/polyhedron/backend_normaliz.py
**********************************************************************
File "src/sage/geometry/polyhedron/backend_normaliz.py", line 412, in sage.geometry.polyhedron.backend_normaliz.Polyhedron_normaliz.integral_hull
Failed example:
    set(PI.Vrepresentation())                                # optional - pynormaliz
Expected:
    {A vertex at (-1, 0), A vertex at (0, 1), A ray in the direction (1, 0)}
Got:
    {A ray in the direction (1, 0), A vertex at (-1, 0), A vertex at (0, 1)}
**********************************************************************
File "src/sage/geometry/polyhedron/backend_normaliz.py", line 420, in sage.geometry.polyhedron.backend_normaliz.Polyhedron_normaliz.integral_hull
Failed example:
    set(PI.Vrepresentation())                                # optional - pynormaliz
Expected:
    {A vertex at (1, 0),
     A ray in the direction (1, 0),
     A line in the direction (1, -1)}
Got:
    {A line in the direction (1, -1),
     A ray in the direction (1, 0),
     A vertex at (1, 0)}
**********************************************************************
1 item had failures:
   2 of  10 in sage.geometry.polyhedron.backend_normaliz.Polyhedron_normaliz.integral_hull
    [100 tests, 2 failures, 4.39 s]
```

Question: I have "normaliz" in my optional installed packages but not "pynormaliz", is the above naming correct then?

I am aware that this is not the topic of this ticket but since the tests failed here, it is probably best to treat this here.



---

archive/issue_comments_204865.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-08-21T22:09:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16045#issuecomment-204865",
    "user": "https://github.com/jplab"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_204866.json:
```json
{
    "body": "<a id='comment:40'></a>Replying to [comment:38 jipilab]:\n> {{{\n>     set(PI.Vrepresentation())                                # optional - pynormaliz\n> }}}\n> \n> Question: I have \"normaliz\" in my optional installed packages but not \"pynormaliz\", is the above naming correct then?\n\n\nThe only way that sage accesses normaliz is via pynormaliz, so this is correct.",
    "created_at": "2017-08-22T04:53:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16045#issuecomment-204866",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:40'></a>Replying to [comment:38 jipilab]:
> {{{
>     set(PI.Vrepresentation())                                # optional - pynormaliz
> }}}
> 
> Question: I have "normaliz" in my optional installed packages but not "pynormaliz", is the above naming correct then?


The only way that sage accesses normaliz is via pynormaliz, so this is correct.



---

archive/issue_comments_204867.json:
```json
{
    "body": "<a id='comment:41'></a>> I am aware that this is not the topic of this ticket but since the tests failed here, it is probably best to treat this here.\n\n\nI disagree. This should not be treated here, but a new ticket should be opened. If we proceed as you propose (and everybody else does the same), this random pynormaliz bug will be treated in every ticket that is around. \n\nIn fact it already seems to be fixed here:\n\nhttps://trac.sagemath.org/ticket/23586\n\nsee also:\n\nhttps://trac.sagemath.org/ticket/23637\n\nand \n\nhttps://git.sagemath.org/sage.git/diff?id2=effcedba414f8832b07e6e77cf0b4a6aed6aff9b&id=cb2fcfd6760f74db9dc16def7edfef00c96cf657",
    "created_at": "2017-08-22T07:14:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16045#issuecomment-204867",
    "user": "https://github.com/mo271"
}
```

<a id='comment:41'></a>> I am aware that this is not the topic of this ticket but since the tests failed here, it is probably best to treat this here.


I disagree. This should not be treated here, but a new ticket should be opened. If we proceed as you propose (and everybody else does the same), this random pynormaliz bug will be treated in every ticket that is around. 

In fact it already seems to be fixed here:

https://trac.sagemath.org/ticket/23586

see also:

https://trac.sagemath.org/ticket/23637

and 

https://git.sagemath.org/sage.git/diff?id2=effcedba414f8832b07e6e77cf0b4a6aed6aff9b&id=cb2fcfd6760f74db9dc16def7edfef00c96cf657



---

archive/issue_comments_204868.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-08-22T07:14:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16045#issuecomment-204868",
    "user": "https://github.com/mo271"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_204869.json:
```json
{
    "body": "<a id='comment:42'></a>> The only way that sage accesses normaliz is via pynormaliz, so this is correct.\n\n\nMy bad, I confused both and only installed normaliz. Oh well...",
    "created_at": "2017-08-22T13:46:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16045#issuecomment-204869",
    "user": "https://github.com/jplab"
}
```

<a id='comment:42'></a>> The only way that sage accesses normaliz is via pynormaliz, so this is correct.


My bad, I confused both and only installed normaliz. Oh well...



---

archive/issue_comments_204870.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-08-22T14:33:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16045#issuecomment-204870",
    "user": "https://github.com/jplab"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_204871.json:
```json
{
    "body": "<a id='comment:44'></a>> I disagree. This should not be treated here, but a new ticket should be opened. If we proceed as you propose (and everybody else does the same), this random pynormaliz bug will be treated in every ticket that is around. \n> \n> In fact it already seems to be fixed here:\n> \n> https://trac.sagemath.org/ticket/23586\n> \n> see also:\n> \n> https://trac.sagemath.org/ticket/23637\n> \n> and \n> \n> https://git.sagemath.org/sage.git/diff?id2=effcedba414f8832b07e6e77cf0b4a6aed6aff9b&id=cb2fcfd6760f74db9dc16def7edfef00c96cf657\n\n\nAll right, good to know, thanks for looking it up!\n\nShould we add a dependancy in such cases, or perhaps just wait...?\n\nI corrected two indentations. This looks good to me now, tests pass on my machine with pynormaliz (!).\n\nI extended the description of the ticket a bit, if you believe it should contain some more information you can add it, otherwise, I'd it is ready to go.\n\n---\nNew commits:",
    "created_at": "2017-08-22T14:33:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16045#issuecomment-204871",
    "user": "https://github.com/jplab"
}
```

<a id='comment:44'></a>> I disagree. This should not be treated here, but a new ticket should be opened. If we proceed as you propose (and everybody else does the same), this random pynormaliz bug will be treated in every ticket that is around. 
> 
> In fact it already seems to be fixed here:
> 
> https://trac.sagemath.org/ticket/23586
> 
> see also:
> 
> https://trac.sagemath.org/ticket/23637
> 
> and 
> 
> https://git.sagemath.org/sage.git/diff?id2=effcedba414f8832b07e6e77cf0b4a6aed6aff9b&id=cb2fcfd6760f74db9dc16def7edfef00c96cf657


All right, good to know, thanks for looking it up!

Should we add a dependancy in such cases, or perhaps just wait...?

I corrected two indentations. This looks good to me now, tests pass on my machine with pynormaliz (!).

I extended the description of the ticket a bit, if you believe it should contain some more information you can add it, otherwise, I'd it is ready to go.

---
New commits:



---

archive/issue_comments_204872.json:
```json
{
    "body": "<a id='comment:45'></a>Thanks for the review, JP! I don't think we should put a dependency for the pynormaliz-set-thing.",
    "created_at": "2017-08-22T14:46:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16045#issuecomment-204872",
    "user": "https://github.com/mo271"
}
```

<a id='comment:45'></a>Thanks for the review, JP! I don't think we should put a dependency for the pynormaliz-set-thing.



---

archive/issue_events_047173.json:
```json
{
    "actor": "https://github.com/mo271",
    "created_at": "2017-08-22T20:37:41Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16045",
    "milestone": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16045#event-47173"
}
```



---

archive/issue_comments_204873.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-09-10T11:56:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16045#issuecomment-204873",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_047174.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-09-10T11:56:41Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16045",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16045#event-47174"
}
```
