# Issue 16399: Matrix stack() should coerce to a common parent

archive/issues_016162.json:
```json
{
    "body": "I feel like we shouldn't have to do an explicit ring change to do this. Plus we get (somewhat) different failures for dense versus sparse matrices:\n\n```\nsage: m = matrix([[1,2]])\nsage: m2 = matrix(QQ, [[1/2,2]])\nsage: m.stack(m2)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n...\nTypeError: matrix has denominators so can't change to ZZ.\n```\n\n```\nsage: m = matrix([[1,2]], sparse=True)\nsage: m.stack(m2)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n...\nTypeError: no conversion of this rational to integer\n```\n\nFollow-up: #17595\n\nAssignee: @tscrim\n\nKeywords: matrix stack coercion\n\nBranch/Commit: 810a889f723ae78ee0331cf366e22e2308ebf74e\n\nReviewer: Travis Scrimshaw\n\nAuthor: Fr\u00e9d\u00e9ric Chapoton, Jeroen Demeyer\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/16399\n\n",
    "closed_at": "2015-01-12T18:11:40Z",
    "created_at": "2014-05-26T03:05:59Z",
    "labels": [
        "component: linear algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.5",
    "title": "Matrix stack() should coerce to a common parent",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16399",
    "user": "https://github.com/tscrim"
}
```
I feel like we shouldn't have to do an explicit ring change to do this. Plus we get (somewhat) different failures for dense versus sparse matrices:

```
sage: m = matrix([[1,2]])
sage: m2 = matrix(QQ, [[1/2,2]])
sage: m.stack(m2)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
...
TypeError: matrix has denominators so can't change to ZZ.
```

```
sage: m = matrix([[1,2]], sparse=True)
sage: m.stack(m2)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
...
TypeError: no conversion of this rational to integer
```

Follow-up: #17595

Assignee: @tscrim

Keywords: matrix stack coercion

Branch/Commit: 810a889f723ae78ee0331cf366e22e2308ebf74e

Reviewer: Travis Scrimshaw

Author: Frédéric Chapoton, Jeroen Demeyer

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/16399





---

archive/issue_comments_269755.json:
```json
{
    "body": "Changing commit from \"\" to \"098d574aa98441e4067178a4b8913c88ebc0f6b8\"",
    "created_at": "2014-07-27T08:22:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16399",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16399#issuecomment-269755",
    "user": "https://github.com/fchapoton"
}
```

Changing commit from "" to "098d574aa98441e4067178a4b8913c88ebc0f6b8"



---

archive/issue_comments_269756.json:
```json
{
    "body": "Changing branch from \"\" to \"u/chapoton/16399\"",
    "created_at": "2014-07-27T08:22:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16399",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16399#issuecomment-269756",
    "user": "https://github.com/fchapoton"
}
```

Changing branch from "" to "u/chapoton/16399"



---

archive/issue_comments_269757.json:
```json
{
    "body": "<a id='comment:1'></a>\nI have tried to look at the code. Apparently, one only tries to change the base ring of the bottom matrix. But of course, the coercion could be the other way, or there could be some complicated way to find a common coercion.\n\nI have made a preliminary attempt, very incomplete.\n\n---\nNew commits:\n|                                                                                                                                          |                             |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------|\n|[7b18078](http://git.sagemath.org/sage.git/commit/?id=7b1807808cb638a2f064b78a71ad01f74303bddb)|`trac #16399 first naive try`|\n|[098d574](http://git.sagemath.org/sage.git/commit/?id=098d574aa98441e4067178a4b8913c88ebc0f6b8)|`trac #16399 now for sparse matrices`|",
    "created_at": "2014-07-27T08:22:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16399",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16399#issuecomment-269757",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>
I have tried to look at the code. Apparently, one only tries to change the base ring of the bottom matrix. But of course, the coercion could be the other way, or there could be some complicated way to find a common coercion.

I have made a preliminary attempt, very incomplete.

---
New commits:
|                                                                                                                                          |                             |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------|
|[7b18078](http://git.sagemath.org/sage.git/commit/?id=7b1807808cb638a2f064b78a71ad01f74303bddb)|`trac #16399 first naive try`|
|[098d574](http://git.sagemath.org/sage.git/commit/?id=098d574aa98441e4067178a4b8913c88ebc0f6b8)|`trac #16399 now for sparse matrices`|



---

archive/issue_comments_269758.json:
```json
{
    "body": "<a id='comment:2'></a>\nHere's how to get a common parent:\n\n```\nsage: from sage.structure.element import get_coercion_model\nsage: CM = get_coercion_model()\nsage: CM.common_parent(QQ, ZZ['x'])\nUnivariate Polynomial Ring in x over Rational Field\n```\nand since we're modifying cython files, we could probably use the cdef global coercion model from element.pyx:\n\n```\ncdef CoercionModel coercion_model\n```",
    "created_at": "2014-07-27T15:24:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16399",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16399#issuecomment-269758",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:2'></a>
Here's how to get a common parent:

```
sage: from sage.structure.element import get_coercion_model
sage: CM = get_coercion_model()
sage: CM.common_parent(QQ, ZZ['x'])
Univariate Polynomial Ring in x over Rational Field
```
and since we're modifying cython files, we could probably use the cdef global coercion model from element.pyx:

```
cdef CoercionModel coercion_model
```



---

archive/issue_comments_269759.json:
```json
{
    "body": "Changing commit from \"098d574aa98441e4067178a4b8913c88ebc0f6b8\" to \"bee1968a7bfc534ac1ce216562b8f66df770483e\"",
    "created_at": "2014-07-30T14:11:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16399",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16399#issuecomment-269759",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "098d574aa98441e4067178a4b8913c88ebc0f6b8" to "bee1968a7bfc534ac1ce216562b8f66df770483e"



---

archive/issue_comments_269760.json:
```json
{
    "body": "<a id='comment:3'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                          |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|\n|[bee1968](http://git.sagemath.org/sage.git/commit/?id=bee1968a7bfc534ac1ce216562b8f66df770483e)|`trac #16399 trying to use coercion model`|",
    "created_at": "2014-07-30T14:11:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16399",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16399#issuecomment-269760",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                          |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|
|[bee1968](http://git.sagemath.org/sage.git/commit/?id=bee1968a7bfc534ac1ce216562b8f66df770483e)|`trac #16399 trying to use coercion model`|



---

archive/issue_comments_269761.json:
```json
{
    "body": "<a id='comment:4'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                         |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------|\n|[9986c47](http://git.sagemath.org/sage.git/commit/?id=9986c476c78510e1b98d46890a5b9506f3b62613)|`trac #16399 fixing some obvious errors.`|",
    "created_at": "2014-07-30T14:18:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16399",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16399#issuecomment-269761",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                         |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------|
|[9986c47](http://git.sagemath.org/sage.git/commit/?id=9986c476c78510e1b98d46890a5b9506f3b62613)|`trac #16399 fixing some obvious errors.`|



---

archive/issue_comments_269762.json:
```json
{
    "body": "Changing commit from \"bee1968a7bfc534ac1ce216562b8f66df770483e\" to \"9986c476c78510e1b98d46890a5b9506f3b62613\"",
    "created_at": "2014-07-30T14:18:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16399",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16399#issuecomment-269762",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "bee1968a7bfc534ac1ce216562b8f66df770483e" to "9986c476c78510e1b98d46890a5b9506f3b62613"



---

archive/issue_comments_269763.json:
```json
{
    "body": "<a id='comment:5'></a>\nGiven the syntax, `m.stack(...)` it makes a lot of sense to try and let the result depend as much as possible on m and not on \"...\". The error you get now is quick and it is clear how to avoid it. With coercion, you could get an unexpected base \nring change of the resulting matrix, which might give erroneous results much later.\n\nThe example below gives questionable results, but the change you propose here would break the behaviour we have already:\n\n```\nsage: M=matrix(ZZ,[1]).stack(matrix(GF(3),[1])).stack(matrix(GF(5),[1]))\nsage: M.base_ring()\nInteger Ring\n```\n\nClearly, the current semantics are *conversion* into the base ring of the first matrix. Changing that into *coercion* into a common parent would be a real change, and it's not clear to me the resulting semantics are entirely desirable.\n\nI'm not particularly defending the current semantics either. I'm just pointing out you're proposing an incompatible change and for that to be justified we'd need fairly wide concensus that the change leads to significantly more desirable behaviour.",
    "created_at": "2014-07-30T18:30:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16399",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16399#issuecomment-269763",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:5'></a>
Given the syntax, `m.stack(...)` it makes a lot of sense to try and let the result depend as much as possible on m and not on "...". The error you get now is quick and it is clear how to avoid it. With coercion, you could get an unexpected base 
ring change of the resulting matrix, which might give erroneous results much later.

The example below gives questionable results, but the change you propose here would break the behaviour we have already:

```
sage: M=matrix(ZZ,[1]).stack(matrix(GF(3),[1])).stack(matrix(GF(5),[1]))
sage: M.base_ring()
Integer Ring
```

Clearly, the current semantics are *conversion* into the base ring of the first matrix. Changing that into *coercion* into a common parent would be a real change, and it's not clear to me the resulting semantics are entirely desirable.

I'm not particularly defending the current semantics either. I'm just pointing out you're proposing an incompatible change and for that to be justified we'd need fairly wide concensus that the change leads to significantly more desirable behaviour.



---

archive/issue_events_048267.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16399",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16399#event-48267"
}
```



---

archive/issue_comments_269764.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [nbruin](#comment%3A5):\n> Given the syntax, `m.stack(...)` it makes a lot of sense to try and let the result depend as much as possible on m and not on \"...\".\n\nI disagree with this. That's just a pure syntactical thing, mathematically \"stacking\" could be seen as a binary operator.\n\nI am +1 to coercion, but there could indeed be unexpected consequences.",
    "created_at": "2015-01-06T11:37:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16399",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16399#issuecomment-269764",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>
Replying to [nbruin](#comment%3A5):
> Given the syntax, `m.stack(...)` it makes a lot of sense to try and let the result depend as much as possible on m and not on "...".

I disagree with this. That's just a pure syntactical thing, mathematically "stacking" could be seen as a binary operator.

I am +1 to coercion, but there could indeed be unexpected consequences.



---

archive/issue_comments_269765.json:
```json
{
    "body": "<a id='comment:8'></a>\nNote: I hit the issue on this ticket by working on #17585. Apparently, the `basis_matrix()` method of modules with basis always returns a matrix over the fraction field. Changing this gives errors because of the issue here.",
    "created_at": "2015-01-06T11:39:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16399",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16399#issuecomment-269765",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>
Note: I hit the issue on this ticket by working on #17585. Apparently, the `basis_matrix()` method of modules with basis always returns a matrix over the fraction field. Changing this gives errors because of the issue here.



---

archive/issue_comments_269766.json:
```json
{
    "body": "Changing branch from \"u/chapoton/16399\" to \"u/jdemeyer/ticket/16399\"",
    "created_at": "2015-01-06T12:45:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16399",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16399#issuecomment-269766",
    "user": "https://github.com/jdemeyer"
}
```

Changing branch from "u/chapoton/16399" to "u/jdemeyer/ticket/16399"



---

archive/issue_comments_269767.json:
```json
{
    "body": "<a id='comment:10'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                         |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------|\n|[0f1cbae](http://git.sagemath.org/sage.git/commit/?id=0f1cbae5d63bc2005412f4b2870f7769185252e7)|`Merge tag '6.5.beta5' into ticket/16399`|",
    "created_at": "2015-01-06T12:47:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16399",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16399#issuecomment-269767",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                         |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------|
|[0f1cbae](http://git.sagemath.org/sage.git/commit/?id=0f1cbae5d63bc2005412f4b2870f7769185252e7)|`Merge tag '6.5.beta5' into ticket/16399`|



---

archive/issue_comments_269768.json:
```json
{
    "body": "Changing commit from \"9986c476c78510e1b98d46890a5b9506f3b62613\" to \"0f1cbae5d63bc2005412f4b2870f7769185252e7\"",
    "created_at": "2015-01-06T12:47:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16399",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16399#issuecomment-269768",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "9986c476c78510e1b98d46890a5b9506f3b62613" to "0f1cbae5d63bc2005412f4b2870f7769185252e7"



---

archive/issue_comments_269769.json:
```json
{
    "body": "Changing commit from \"0f1cbae5d63bc2005412f4b2870f7769185252e7\" to \"bf6abd1d1f6203dad05323a4bf0192544861d72b\"",
    "created_at": "2015-01-06T16:23:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16399",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16399#issuecomment-269769",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "0f1cbae5d63bc2005412f4b2870f7769185252e7" to "bf6abd1d1f6203dad05323a4bf0192544861d72b"



---

archive/issue_comments_269770.json:
```json
{
    "body": "<a id='comment:11'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                 |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------|\n|[bf6abd1](http://git.sagemath.org/sage.git/commit/?id=bf6abd1d1f6203dad05323a4bf0192544861d72b)|`Refactor stacking, use coercion`|",
    "created_at": "2015-01-06T16:23:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16399",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16399#issuecomment-269770",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                 |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------|
|[bf6abd1](http://git.sagemath.org/sage.git/commit/?id=bf6abd1d1f6203dad05323a4bf0192544861d72b)|`Refactor stacking, use coercion`|



---

archive/issue_comments_269771.json:
```json
{
    "body": "Changing commit from \"bf6abd1d1f6203dad05323a4bf0192544861d72b\" to \"e3d7bbd479838b2cbc8433509034da0ab864d456\"",
    "created_at": "2015-01-07T08:44:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16399",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16399#issuecomment-269771",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "bf6abd1d1f6203dad05323a4bf0192544861d72b" to "e3d7bbd479838b2cbc8433509034da0ab864d456"



---

archive/issue_comments_269772.json:
```json
{
    "body": "<a id='comment:12'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                          |                                 |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------|\n|[e3d7bbd](http://git.sagemath.org/sage.git/commit/?id=e3d7bbd479838b2cbc8433509034da0ab864d456)|`Refactor stacking, use coercion`|",
    "created_at": "2015-01-07T08:44:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16399",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16399#issuecomment-269772",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                          |                                 |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------|
|[e3d7bbd](http://git.sagemath.org/sage.git/commit/?id=e3d7bbd479838b2cbc8433509034da0ab864d456)|`Refactor stacking, use coercion`|



---

archive/issue_comments_269773.json:
```json
{
    "body": "Changing author from \"\" to \"Fr\u00e9d\u00e9ric Chapoton, Jeroen Demeyer\"",
    "created_at": "2015-01-07T08:45:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16399",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16399#issuecomment-269773",
    "user": "https://github.com/jdemeyer"
}
```

Changing author from "" to "Frédéric Chapoton, Jeroen Demeyer"



---

archive/issue_comments_269774.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-01-07T08:45:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16399",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16399#issuecomment-269774",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_269775.json:
```json
{
    "body": "<a id='comment:14'></a>\nLooks good overall, but there are two things.\n\nThe first is could you keep the \"returns a new matrix\" part of the documentation? Since matrices are mutable, your proposed change makes the result slightly ambiguous to me as we could mutate in place and return `self`.\n\nSecond is about this change:\n\n```diff\ndiff --git a/src/sage/modules/fg_pid/fgp_morphism.py b/src/sage/modules/fg_pid/fgp_morphism.py\nindex 80fe02b..86bbe37 100644\n--- a/src/sage/modules/fg_pid/fgp_morphism.py\n+++ b/src/sage/modules/fg_pid/fgp_morphism.py\n@@ -423,6 +423,7 @@ class FGP_Morphism(Morphism):\n \n             # Stack it on top of the basis for W'.\n             Wp = CD.V().coordinate_module(CD.W()).basis_matrix()\n+            Wp = Wp.change_ring(A.base_ring())\n             B = A.stack(Wp)\n \n             # Compute Hermite form of C with transformation\n```\nIs this necessary for this ticket or is it suppose to be a part of #17585?",
    "created_at": "2015-01-07T17:56:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16399",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16399#issuecomment-269775",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:14'></a>
Looks good overall, but there are two things.

The first is could you keep the "returns a new matrix" part of the documentation? Since matrices are mutable, your proposed change makes the result slightly ambiguous to me as we could mutate in place and return `self`.

Second is about this change:

```diff
diff --git a/src/sage/modules/fg_pid/fgp_morphism.py b/src/sage/modules/fg_pid/fgp_morphism.py
index 80fe02b..86bbe37 100644
--- a/src/sage/modules/fg_pid/fgp_morphism.py
+++ b/src/sage/modules/fg_pid/fgp_morphism.py
@@ -423,6 +423,7 @@ class FGP_Morphism(Morphism):
 
             # Stack it on top of the basis for W'.
             Wp = CD.V().coordinate_module(CD.W()).basis_matrix()
+            Wp = Wp.change_ring(A.base_ring())
             B = A.stack(Wp)
 
             # Compute Hermite form of C with transformation
```
Is this necessary for this ticket or is it suppose to be a part of #17585?



---

archive/issue_comments_269776.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [tscrim](#comment%3A14):\n> {{{#!diff\n> diff --git a/src/sage/modules/fg_pid/fgp_morphism.py b/src/sage/modules/fg_pid/fgp_morphism.py\n> index 80fe02b..86bbe37 100644\n> --- a/src/sage/modules/fg_pid/fgp_morphism.py\n> +++ b/src/sage/modules/fg_pid/fgp_morphism.py\n> `@``@` -423,6 +423,7 `@``@` class FGP_Morphism(Morphism):\n>  \n>              # Stack it on top of the basis for W'.\n>              Wp = CD.V().coordinate_module(CD.W()).basis_matrix()\n> +            Wp = Wp.change_ring(A.base_ring())\n>              B = A.stack(Wp)\n>  \n>              # Compute Hermite form of C with transformation\n> }}}\n> Is this necessary for this ticket or is it suppose to be a part of #17585?\n\nYes, it's necessary for this ticket but it's not needed with #16399 and #17585 *together*. So it could be added here and removed again in #17585.",
    "created_at": "2015-01-07T19:09:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16399",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16399#issuecomment-269776",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>
Replying to [tscrim](#comment%3A14):
> {{{#!diff
> diff --git a/src/sage/modules/fg_pid/fgp_morphism.py b/src/sage/modules/fg_pid/fgp_morphism.py
> index 80fe02b..86bbe37 100644
> --- a/src/sage/modules/fg_pid/fgp_morphism.py
> +++ b/src/sage/modules/fg_pid/fgp_morphism.py
> `@``@` -423,6 +423,7 `@``@` class FGP_Morphism(Morphism):
>  
>              # Stack it on top of the basis for W'.
>              Wp = CD.V().coordinate_module(CD.W()).basis_matrix()
> +            Wp = Wp.change_ring(A.base_ring())
>              B = A.stack(Wp)
>  
>              # Compute Hermite form of C with transformation
> }}}
> Is this necessary for this ticket or is it suppose to be a part of #17585?

Yes, it's necessary for this ticket but it's not needed with #16399 and #17585 *together*. So it could be added here and removed again in #17585.



---

archive/issue_comments_269777.json:
```json
{
    "body": "<a id='comment:16'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                        |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------|\n|[810a889](http://git.sagemath.org/sage.git/commit/?id=810a889f723ae78ee0331cf366e22e2308ebf74e)|`Rephrase documentation`|",
    "created_at": "2015-01-07T19:17:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16399",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16399#issuecomment-269777",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                        |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------|
|[810a889](http://git.sagemath.org/sage.git/commit/?id=810a889f723ae78ee0331cf366e22e2308ebf74e)|`Rephrase documentation`|



---

archive/issue_comments_269778.json:
```json
{
    "body": "Changing commit from \"e3d7bbd479838b2cbc8433509034da0ab864d456\" to \"810a889f723ae78ee0331cf366e22e2308ebf74e\"",
    "created_at": "2015-01-07T19:17:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16399",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16399#issuecomment-269778",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e3d7bbd479838b2cbc8433509034da0ab864d456" to "810a889f723ae78ee0331cf366e22e2308ebf74e"



---

archive/issue_events_048268.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-01-07T21:45:15Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16399",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16399#event-48268"
}
```



---

archive/issue_events_048269.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-01-07T21:45:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16399",
    "milestone": "sage-6.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16399#event-48269"
}
```



---

archive/issue_comments_269779.json:
```json
{
    "body": "Changing component from coercion to linear algebra.",
    "created_at": "2015-01-07T21:46:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16399",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16399#issuecomment-269779",
    "user": "https://github.com/jdemeyer"
}
```

Changing component from coercion to linear algebra.



---

archive/issue_comments_269780.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -18,3 +18,5 @@\n ...\n TypeError: no conversion of this rational to integer\n ```\n+\n+Follow-up: #17595\n``````\n",
    "created_at": "2015-01-07T21:46:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16399",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16399#issuecomment-269780",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -18,3 +18,5 @@
 ...
 TypeError: no conversion of this rational to integer
 ```
+
+Follow-up: #17595
``````




---

archive/issue_comments_269781.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2015-01-08T07:36:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16399",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16399#issuecomment-269781",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw"



---

archive/issue_comments_269782.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-01-08T07:36:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16399",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16399#issuecomment-269782",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_269783.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [jdemeyer](#comment%3A15):\n> > Is this necessary for this ticket or is it suppose to be a part of #17585?\n\n> Yes, it's necessary for this ticket but it's not needed with #16399 and #17585 *together*. So it could be added here and removed again in #17585.\n\nOkay, then positive review. Thanks for making that change to the doc.",
    "created_at": "2015-01-08T07:36:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16399",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16399#issuecomment-269783",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:19'></a>
Replying to [jdemeyer](#comment%3A15):
> > Is this necessary for this ticket or is it suppose to be a part of #17585?

> Yes, it's necessary for this ticket but it's not needed with #16399 and #17585 *together*. So it could be added here and removed again in #17585.

Okay, then positive review. Thanks for making that change to the doc.



---

archive/issue_events_048270.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-01-12T18:11:40Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16399",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16399#event-48270"
}
```



---

archive/issue_comments_269784.json:
```json
{
    "body": "Changing branch from \"u/jdemeyer/ticket/16399\" to \"810a889f723ae78ee0331cf366e22e2308ebf74e\"",
    "created_at": "2015-01-12T18:11:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16399",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16399#issuecomment-269784",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/jdemeyer/ticket/16399" to "810a889f723ae78ee0331cf366e22e2308ebf74e"



---

archive/issue_comments_269785.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-01-12T18:11:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16399",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16399#issuecomment-269785",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
