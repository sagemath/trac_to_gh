# Issue 16384: Multiplication of additive semigroup elements by nonnegative integers

archive/issues_016147.json:
```json
{
    "body": "It's natural to have the following:\n\n```\n                sage: E = CommutativeAdditiveMonoids().example()\n                sage: e = E.an_element()\n                sage: 2*e\n                2*a + 6*c + 4*b + 8*d\n                sage: e*3\n                3*a + 9*c + 6*b + 12*d\n```\n\nCC:  sage-combinat @nathanncohen @jdemeyer\n\nWork_Issues: failing tests, memory usage\n\nBranch: u/nthiery/categories/additive-semigroups-intmul-16384\n\nStatus: new\n\nDependencies: #20767\n\nCommit: 68d43b83000550b26ae1dcf2ee9f8e127f16fde2\n\nIssue created by migration from https://trac.sagemath.org/ticket/16384\n\n",
    "created_at": "2014-05-21T10:18:28Z",
    "labels": [
        "component: categories"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.4",
    "title": "Multiplication of additive semigroup elements by nonnegative integers",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16384",
    "user": "https://github.com/nthiery"
}
```
It's natural to have the following:

```
                sage: E = CommutativeAdditiveMonoids().example()
                sage: e = E.an_element()
                sage: 2*e
                2*a + 6*c + 4*b + 8*d
                sage: e*3
                3*a + 9*c + 6*b + 12*d
```

CC:  sage-combinat @nathanncohen @jdemeyer

Work_Issues: failing tests, memory usage

Branch: u/nthiery/categories/additive-semigroups-intmul-16384

Status: new

Dependencies: #20767

Commit: 68d43b83000550b26ae1dcf2ee9f8e127f16fde2

Issue created by migration from https://trac.sagemath.org/ticket/16384





---

archive/issue_comments_224539.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,13 @@\n+It's natural to have the following:\n \n+\\`\\`\\`\n+                sage: E = CommutativeAdditiveMonoids().example()\n+                sage: e = E.an_element()\n+                sage: 2*e\n+                2*a + 6*c + 4*b + 8*d\n+                sage: e*3\n+                3*a + 9*c + 6*b + 12*d\n+\\`\\`\\`\n \n Comment: 1\n \n```\n",
    "created_at": "2014-05-21T10:19:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16384",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16384#issuecomment-224539",
    "user": "https://github.com/nthiery"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,13 @@
+It's natural to have the following:
 
+\`\`\`
+                sage: E = CommutativeAdditiveMonoids().example()
+                sage: e = E.an_element()
+                sage: 2*e
+                2*a + 6*c + 4*b + 8*d
+                sage: e*3
+                3*a + 9*c + 6*b + 12*d
+\`\`\`
 
 Comment: 1
 
```




---

archive/issue_comments_224540.json:
```json
{
    "body": "<a id='comment:2'></a>Congratulations on ticket `2^14`!",
    "created_at": "2014-05-22T02:05:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16384",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16384#issuecomment-224540",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:2'></a>Congratulations on ticket `2^14`!



---

archive/issue_comments_224541.json:
```json
{
    "body": "<a id='comment:4'></a>The current implementation more or less works. However, given the usage of an action and the current implementation of actions, this will probably leak memory if a lot additive semigroups are temporarily constructed. There are also some failing tests.\n\nStill, reviewing the rest can start.\n\n---\nLast 10 new commits:",
    "created_at": "2014-05-23T22:31:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16384",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16384#issuecomment-224541",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:4'></a>The current implementation more or less works. However, given the usage of an action and the current implementation of actions, this will probably leak memory if a lot additive semigroups are temporarily constructed. There are also some failing tests.

Still, reviewing the rest can start.

---
Last 10 new commits:



---

archive/issue_comments_224542.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:2 kcrisman]:\n> Congratulations on ticket `2^14`!\n\n\nYippee :-)",
    "created_at": "2014-05-23T22:39:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16384",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16384#issuecomment-224542",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:6'></a>Replying to [comment:2 kcrisman]:
> Congratulations on ticket `2^14`!


Yippee :-)



---

archive/issue_comments_224543.json:
```json
{
    "body": "<a id='comment:7'></a>Hi there,\n\nhow much time before ticket `2^15` ?\n\nWhy `__mul__` and `__rmul__` are implemented in the category and not in `element.pyx` like it is done for `ModuleElement` ? It is confusing and moreover, it is the kind of methods that must be fast.\n\nVincent",
    "created_at": "2014-05-28T09:33:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16384",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16384#issuecomment-224543",
    "user": "https://github.com/videlec"
}
```

<a id='comment:7'></a>Hi there,

how much time before ticket `2^15` ?

Why `__mul__` and `__rmul__` are implemented in the category and not in `element.pyx` like it is done for `ModuleElement` ? It is confusing and moreover, it is the kind of methods that must be fast.

Vincent



---

archive/issue_comments_224544.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:7 vdelecroix]:\n> how much time before ticket `2^15` ?\n\n\nGiven the acceleration, it might not be that long :-)\n\n> Why `__mul__` and `__rmul__` are implemented in the category and not in `element.pyx` like it is done for `ModuleElement` ? It is confusing and moreover, it is the kind of methods that must be fast.\n\n\nBecause, due to the single inheritance limitation of Cython classes,\nthe hierarchy of element classes in element.pyx is extremely limited,\nand will ever be. For example, there can be no class for elements of\nan additive magma. Well, there could be one, but RingElement could not\ninherit from it and from MonoidElement at the same time.\n\nThe `*Element` hierarchy of classes is really only there to cover a\nfew very common cases (elements of rings, ...) where speed can be\ncritical. And we should only put there those methods where speed is\ncritical. Note that the `__mul__` method implemented there take\nprecedence over there counterparts in the categories.\n\nThat being said, thanks to relatively recent progress in Cython, it's\nnow possible to define a cython function and make it a method of a\nPython class/category by assigning it there (example courtesy of\nRobert Bradshaw):\n\n```\n%cython\n\nimport cython\n@cython.binding\ndef foo(*args):\n    print args\n\nclass A:\n    x = foo\na = A()\nprint a.x(1, 2, 3)\n```\n\nWith this, we still pay the price of a method call, but the execution\nof the method itself is fast. We could explore the use of this for the\ncritical methods of categories.\n\nCheers,\n                                 Nicolas",
    "created_at": "2014-05-28T15:39:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16384",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16384#issuecomment-224544",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:8'></a>Replying to [comment:7 vdelecroix]:
> how much time before ticket `2^15` ?


Given the acceleration, it might not be that long :-)

> Why `__mul__` and `__rmul__` are implemented in the category and not in `element.pyx` like it is done for `ModuleElement` ? It is confusing and moreover, it is the kind of methods that must be fast.


Because, due to the single inheritance limitation of Cython classes,
the hierarchy of element classes in element.pyx is extremely limited,
and will ever be. For example, there can be no class for elements of
an additive magma. Well, there could be one, but RingElement could not
inherit from it and from MonoidElement at the same time.

The `*Element` hierarchy of classes is really only there to cover a
few very common cases (elements of rings, ...) where speed can be
critical. And we should only put there those methods where speed is
critical. Note that the `__mul__` method implemented there take
precedence over there counterparts in the categories.

That being said, thanks to relatively recent progress in Cython, it's
now possible to define a cython function and make it a method of a
Python class/category by assigning it there (example courtesy of
Robert Bradshaw):

```
%cython

import cython
@cython.binding
def foo(*args):
    print args

class A:
    x = foo
a = A()
print a.x(1, 2, 3)
```

With this, we still pay the price of a method call, but the execution
of the method itself is fast. We could explore the use of this for the
critical methods of categories.

Cheers,
                                 Nicolas



---

archive/issue_events_048240.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16384",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16384#event-48240"
}
```



---

archive/issue_events_048241.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-08-28T15:48:41Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16384",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16384#event-48241"
}
```



---

archive/issue_events_048242.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-08-28T15:48:41Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16384",
    "milestone": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16384#event-48242"
}
```
