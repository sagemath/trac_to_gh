# Issue 16180: Subdivide fans using PPL

archive/issues_015943.json:
```json
{
    "body": "Current `Fan.subdivide()` method cannot deal with fans generated by non-full-dimensional cones since it relies on PALP. In addition it is overly complicated. So let's use PPL cones for subdivision, since our toric cones already rely on them a lot. Speed-wise new method seems to work 2-3 times faster than the old one, but main advantages are brevity of code and absence of artificial limitations.\n\nI've also cleaned up related code a bit and deprecated `Cone.lattice_polytope` whose primary purpose was to use PALP for subdivision.\n\nCC:  @vbraun jkeitel\n\nKeywords: toric\n\nBranch/Commit: 59c8c9475223e98aeb604a79d22427605f20b5fb\n\nReviewer: Jan Keitel\n\nAuthor: Andrey Novoseltsev\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/16180\n\n",
    "closed_at": "2014-07-25T05:05:45Z",
    "created_at": "2014-04-17T20:13:12Z",
    "labels": [
        "component: geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.3",
    "title": "Subdivide fans using PPL",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16180",
    "user": "https://github.com/novoselt"
}
```
Current `Fan.subdivide()` method cannot deal with fans generated by non-full-dimensional cones since it relies on PALP. In addition it is overly complicated. So let's use PPL cones for subdivision, since our toric cones already rely on them a lot. Speed-wise new method seems to work 2-3 times faster than the old one, but main advantages are brevity of code and absence of artificial limitations.

I've also cleaned up related code a bit and deprecated `Cone.lattice_polytope` whose primary purpose was to use PALP for subdivision.

CC:  @vbraun jkeitel

Keywords: toric

Branch/Commit: 59c8c9475223e98aeb604a79d22427605f20b5fb

Reviewer: Jan Keitel

Author: Andrey Novoseltsev

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/16180





---

archive/issue_comments_263692.json:
```json
{
    "body": "Changing branch from \"\" to \"u/novoselt/subdivide_fans_using_ppl\"",
    "created_at": "2014-04-22T22:11:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16180#issuecomment-263692",
    "user": "https://github.com/novoselt"
}
```

Changing branch from "" to "u/novoselt/subdivide_fans_using_ppl"



---

archive/issue_comments_263693.json:
```json
{
    "body": "Changing commit from \"\" to \"dc35d9d1dd0d10678213344f59e38481f934c338\"",
    "created_at": "2014-04-22T22:21:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16180#issuecomment-263693",
    "user": "https://github.com/novoselt"
}
```

Changing commit from "" to "dc35d9d1dd0d10678213344f59e38481f934c338"



---

archive/issue_comments_263694.json:
```json
{
    "body": "Changing author from \"\" to \"Andrey Novoseltsev\"",
    "created_at": "2014-04-22T22:21:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16180#issuecomment-263694",
    "user": "https://github.com/novoselt"
}
```

Changing author from "" to "Andrey Novoseltsev"



---

archive/issue_comments_263695.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-04-22T22:21:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16180#issuecomment-263695",
    "user": "https://github.com/novoselt"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_263696.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n+Current `Fan.subdivide()` method cannot deal with fans generated by non-full-dimensional cones since it relies on PALP. In addition it is overly complicated. So let's use PPL cones for subdivision, since our toric cones already rely on them a lot. Speed-wise new method seems to work 2-3 times faster than the old one, but main advantages are brevity of code and absence of artificial limitations.\n \n+I've also cleaned up related code a bit and deprecated `Cone.lattice_polytope` whose primary purpose was to use PALP for subdivision.\n``````\n",
    "created_at": "2014-04-22T22:21:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16180#issuecomment-263696",
    "user": "https://github.com/novoselt"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,3 @@
+Current `Fan.subdivide()` method cannot deal with fans generated by non-full-dimensional cones since it relies on PALP. In addition it is overly complicated. So let's use PPL cones for subdivision, since our toric cones already rely on them a lot. Speed-wise new method seems to work 2-3 times faster than the old one, but main advantages are brevity of code and absence of artificial limitations.
 
+I've also cleaned up related code a bit and deprecated `Cone.lattice_polytope` whose primary purpose was to use PALP for subdivision.
``````




---

archive/issue_comments_263697.json:
```json
{
    "body": "<a id='comment:2'></a>\nNew commits:\n|                                                                                                                                          |                              |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------|\n|[a692959](http://git.sagemath.org/sage.git/commit/?id=a6929591fdf4f797d7c89a79ba8723d82a58e380)|`Use PPL for fan subdivision.`|\n|[17cb30b](http://git.sagemath.org/sage.git/commit/?id=17cb30b4b18f4422fc976039894bc7568782220d)|`Fix doctests due to different facet ordering in PPL and PALP.`|\n|[dc35d9d](http://git.sagemath.org/sage.git/commit/?id=dc35d9d1dd0d10678213344f59e38481f934c338)|`Deprecate Cone.lattice_polytope() and drop cache for Cone.polyhedron().`|",
    "created_at": "2014-04-22T22:21:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16180#issuecomment-263697",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:2'></a>
New commits:
|                                                                                                                                          |                              |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------|
|[a692959](http://git.sagemath.org/sage.git/commit/?id=a6929591fdf4f797d7c89a79ba8723d82a58e380)|`Use PPL for fan subdivision.`|
|[17cb30b](http://git.sagemath.org/sage.git/commit/?id=17cb30b4b18f4422fc976039894bc7568782220d)|`Fix doctests due to different facet ordering in PPL and PALP.`|
|[dc35d9d](http://git.sagemath.org/sage.git/commit/?id=dc35d9d1dd0d10678213344f59e38481f934c338)|`Deprecate Cone.lattice_polytope() and drop cache for Cone.polyhedron().`|



---

archive/issue_comments_263698.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2014-04-22T22:21:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16180#issuecomment-263698",
    "user": "https://github.com/novoselt"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_263699.json:
```json
{
    "body": "Changing keywords from \"\" to \"toric\".",
    "created_at": "2014-04-22T22:21:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16180#issuecomment-263699",
    "user": "https://github.com/novoselt"
}
```

Changing keywords from "" to "toric".



---

archive/issue_comments_263700.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to geometry.",
    "created_at": "2014-04-22T22:21:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16180#issuecomment-263700",
    "user": "https://github.com/novoselt"
}
```

Changing component from PLEASE CHANGE to geometry.



---

archive/issue_events_047667.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16180",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16180#event-47667"
}
```



---

archive/issue_comments_263701.json:
```json
{
    "body": "<a id='comment:5'></a>\nHi Andrey,\n\nI've looked at the patch at it looks good - it's always nice to get rid of `LatticePolytope`. ;-)\nOne quick question: Is there any reason you're not caching the `polyhedron()` method of `Cone`?\n\n---\nNew commits:\n|                                                                                                                                          |                                                                 |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|\n|[bd66bcd](http://git.sagemath.org/sage.git/commit/?id=bd66bcd54e5a934547cae5f7e848612796a29c86)|`Merge branch 'develop' into u/novoselt/subdivide_fans_using_ppl`|\n|[f7f0dd5](http://git.sagemath.org/sage.git/commit/?id=f7f0dd54706d14d4d909715903581604ad133dc9)|`Ticket 16180: Two minor formatting changes.`|",
    "created_at": "2014-07-24T13:25:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16180#issuecomment-263701",
    "user": "https://trac.sagemath.org/admin/accounts/users/jkeitel"
}
```

<a id='comment:5'></a>
Hi Andrey,

I've looked at the patch at it looks good - it's always nice to get rid of `LatticePolytope`. ;-)
One quick question: Is there any reason you're not caching the `polyhedron()` method of `Cone`?

---
New commits:
|                                                                                                                                          |                                                                 |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|
|[bd66bcd](http://git.sagemath.org/sage.git/commit/?id=bd66bcd54e5a934547cae5f7e848612796a29c86)|`Merge branch 'develop' into u/novoselt/subdivide_fans_using_ppl`|
|[f7f0dd5](http://git.sagemath.org/sage.git/commit/?id=f7f0dd54706d14d4d909715903581604ad133dc9)|`Ticket 16180: Two minor formatting changes.`|



---

archive/issue_comments_263702.json:
```json
{
    "body": "Changing commit from \"dc35d9d1dd0d10678213344f59e38481f934c338\" to \"f7f0dd54706d14d4d909715903581604ad133dc9\"",
    "created_at": "2014-07-24T13:25:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16180#issuecomment-263702",
    "user": "https://trac.sagemath.org/admin/accounts/users/jkeitel"
}
```

Changing commit from "dc35d9d1dd0d10678213344f59e38481f934c338" to "f7f0dd54706d14d4d909715903581604ad133dc9"



---

archive/issue_comments_263703.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Jan Keitel\"",
    "created_at": "2014-07-24T13:25:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16180#issuecomment-263703",
    "user": "https://trac.sagemath.org/admin/accounts/users/jkeitel"
}
```

Changing reviewer from "" to "Jan Keitel"



---

archive/issue_comments_263704.json:
```json
{
    "body": "Changing branch from \"u/novoselt/subdivide_fans_using_ppl\" to \"u/jkeitel/subdivide_fans_using_ppl\"",
    "created_at": "2014-07-24T13:25:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16180#issuecomment-263704",
    "user": "https://trac.sagemath.org/admin/accounts/users/jkeitel"
}
```

Changing branch from "u/novoselt/subdivide_fans_using_ppl" to "u/jkeitel/subdivide_fans_using_ppl"



---

archive/issue_comments_263705.json:
```json
{
    "body": "<a id='comment:6'></a>\nWell don't hate it please, there is nothing wrong with the class, only with its backend which was designed for a quite specific purpose ;-) And of course bounded polytopes are not the best way to represent unbounded cones.\n\nAs for caching - why should we cache `polyhedron()`? It is a complicated data structure which will take memory and can cause issues in pickling (this was the main reason for the change here, if I recall correctly - I was trying to simplify pickling code), it is not used extensively in internal computations, and I don't think there are many reasons for users to construct them. On the other hand it definitely can be handy if you want to do some generic operations like shifting the cone from the origin.\n\nWere there any conflicts during merge? (I never liked what is shown when you click on \"merge commit.\")",
    "created_at": "2014-07-24T15:34:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16180#issuecomment-263705",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:6'></a>
Well don't hate it please, there is nothing wrong with the class, only with its backend which was designed for a quite specific purpose ;-) And of course bounded polytopes are not the best way to represent unbounded cones.

As for caching - why should we cache `polyhedron()`? It is a complicated data structure which will take memory and can cause issues in pickling (this was the main reason for the change here, if I recall correctly - I was trying to simplify pickling code), it is not used extensively in internal computations, and I don't think there are many reasons for users to construct them. On the other hand it definitely can be handy if you want to do some generic operations like shifting the cone from the origin.

Were there any conflicts during merge? (I never liked what is shown when you click on "merge commit.")



---

archive/issue_comments_263706.json:
```json
{
    "body": "Changing commit from \"f7f0dd54706d14d4d909715903581604ad133dc9\" to \"59c8c9475223e98aeb604a79d22427605f20b5fb\"",
    "created_at": "2014-07-24T15:46:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16180#issuecomment-263706",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "f7f0dd54706d14d4d909715903581604ad133dc9" to "59c8c9475223e98aeb604a79d22427605f20b5fb"



---

archive/issue_comments_263707.json:
```json
{
    "body": "<a id='comment:7'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                              |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------|\n|[59c8c94](http://git.sagemath.org/sage.git/commit/?id=59c8c9475223e98aeb604a79d22427605f20b5fb)|`Change two Trac occurences to proper syntax.`|",
    "created_at": "2014-07-24T15:46:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16180#issuecomment-263707",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                              |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------|
|[59c8c94](http://git.sagemath.org/sage.git/commit/?id=59c8c9475223e98aeb604a79d22427605f20b5fb)|`Change two Trac occurences to proper syntax.`|



---

archive/issue_comments_263708.json:
```json
{
    "body": "<a id='comment:8'></a>\nNo, the merge went through cleanly. I just merged the development branch in to see whether it is working with the current version. Otherwise I wouldn't have noticed the doctest warning because of the line number, since that has only recently been included (#16626). And I then based the new commit on the merged branch since it saved a lot of time when building Sage. I hope Volker will forgive the extra commit.\n\nI just noticed that `polytope()` only seems to get used in the doctests - so not caching does make perfect sense. If you're happy, then you can set this to positive review.",
    "created_at": "2014-07-24T15:51:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16180#issuecomment-263708",
    "user": "https://trac.sagemath.org/admin/accounts/users/jkeitel"
}
```

<a id='comment:8'></a>
No, the merge went through cleanly. I just merged the development branch in to see whether it is working with the current version. Otherwise I wouldn't have noticed the doctest warning because of the line number, since that has only recently been included (#16626). And I then based the new commit on the merged branch since it saved a lot of time when building Sage. I hope Volker will forgive the extra commit.

I just noticed that `polytope()` only seems to get used in the doctests - so not caching does make perfect sense. If you're happy, then you can set this to positive review.



---

archive/issue_comments_263709.json:
```json
{
    "body": "<a id='comment:9'></a>\nThanks, lgtm!",
    "created_at": "2014-07-24T15:54:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16180#issuecomment-263709",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:9'></a>
Thanks, lgtm!



---

archive/issue_comments_263710.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-07-24T15:54:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16180#issuecomment-263710",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_263711.json:
```json
{
    "body": "<a id='comment:10'></a>\nThank you! Looking at your changes made me realize that toric stuff existed for 4 years already! Life is fast...",
    "created_at": "2014-07-24T15:56:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16180#issuecomment-263711",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:10'></a>
Thank you! Looking at your changes made me realize that toric stuff existed for 4 years already! Life is fast...



---

archive/issue_events_047668.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-07-25T05:05:45Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16180",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16180#event-47668"
}
```



---

archive/issue_comments_263712.json:
```json
{
    "body": "Changing branch from \"u/jkeitel/subdivide_fans_using_ppl\" to \"59c8c9475223e98aeb604a79d22427605f20b5fb\"",
    "created_at": "2014-07-25T05:05:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16180#issuecomment-263712",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/jkeitel/subdivide_fans_using_ppl" to "59c8c9475223e98aeb604a79d22427605f20b5fb"



---

archive/issue_comments_263713.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-07-25T05:05:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16180#issuecomment-263713",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
