# Issue 16180: Subdivide fans using PPL

archive/issues_015943.json:
```json
{
    "body": "Current `Fan.subdivide()` method cannot deal with fans generated by non-full-dimensional cones since it relies on PALP. In addition it is overly complicated. So let's use PPL cones for subdivision, since our toric cones already rely on them a lot. Speed-wise new method seems to work 2-3 times faster than the old one, but main advantages are brevity of code and absence of artificial limitations.\n\nI've also cleaned up related code a bit and deprecated `Cone.lattice_polytope` whose primary purpose was to use PALP for subdivision.\n\n**CC:**  @vbraun jkeitel\n\n**Keywords:** toric\n\n**Branch/Commit:** [59c8c9475223e98aeb604a79d22427605f20b5fb](https://github.com/sagemath/sagetrac-mirror/commit/59c8c9475223e98aeb604a79d22427605f20b5fb)\n\n**Reviewer:** Jan Keitel\n\n**Author:** Andrey Novoseltsev\n\nIssue created by migration from https://trac.sagemath.org/ticket/16180\n\n",
    "closed_at": "2014-07-25T05:05:45Z",
    "created_at": "2014-04-17T20:13:12Z",
    "labels": [
        "component: geometry",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.3",
    "title": "Subdivide fans using PPL",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/16180",
    "user": "https://github.com/novoselt"
}
```
Current `Fan.subdivide()` method cannot deal with fans generated by non-full-dimensional cones since it relies on PALP. In addition it is overly complicated. So let's use PPL cones for subdivision, since our toric cones already rely on them a lot. Speed-wise new method seems to work 2-3 times faster than the old one, but main advantages are brevity of code and absence of artificial limitations.

I've also cleaned up related code a bit and deprecated `Cone.lattice_polytope` whose primary purpose was to use PALP for subdivision.

**CC:**  @vbraun jkeitel

**Keywords:** toric

**Branch/Commit:** [59c8c9475223e98aeb604a79d22427605f20b5fb](https://github.com/sagemath/sagetrac-mirror/commit/59c8c9475223e98aeb604a79d22427605f20b5fb)

**Reviewer:** Jan Keitel

**Author:** Andrey Novoseltsev

Issue created by migration from https://trac.sagemath.org/ticket/16180





---

archive/issue_comments_209148.json:
```json
{
    "body": "**Branch:** [u/novoselt/subdivide_fans_using_ppl](https://github.com/sagemath/sagetrac-mirror/tree/u/novoselt/subdivide_fans_using_ppl)",
    "created_at": "2014-04-22T22:11:36Z",
    "issue": "https://github.com/sagemath/sage/issues/16180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16180#issuecomment-209148",
    "user": "https://github.com/novoselt"
}
```

**Branch:** [u/novoselt/subdivide_fans_using_ppl](https://github.com/sagemath/sagetrac-mirror/tree/u/novoselt/subdivide_fans_using_ppl)



---

archive/issue_comments_209149.json:
```json
{
    "body": "**Commit:** [dc35d9d1dd0d10678213344f59e38481f934c338](https://github.com/sagemath/sagetrac-mirror/commit/dc35d9d1dd0d10678213344f59e38481f934c338)",
    "created_at": "2014-04-22T22:21:34Z",
    "issue": "https://github.com/sagemath/sage/issues/16180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16180#issuecomment-209149",
    "user": "https://github.com/novoselt"
}
```

**Commit:** [dc35d9d1dd0d10678213344f59e38481f934c338](https://github.com/sagemath/sagetrac-mirror/commit/dc35d9d1dd0d10678213344f59e38481f934c338)



---

archive/issue_comments_209150.json:
```json
{
    "body": "**Author:** Andrey Novoseltsev",
    "created_at": "2014-04-22T22:21:34Z",
    "issue": "https://github.com/sagemath/sage/issues/16180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16180#issuecomment-209150",
    "user": "https://github.com/novoselt"
}
```

**Author:** Andrey Novoseltsev



---

archive/issue_events_144169.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2014-04-22T22:21:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16180",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16180#event-144169"
}
```



---

archive/issue_comments_209151.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n+Current `Fan.subdivide()` method cannot deal with fans generated by non-full-dimensional cones since it relies on PALP. In addition it is overly complicated. So let's use PPL cones for subdivision, since our toric cones already rely on them a lot. Speed-wise new method seems to work 2-3 times faster than the old one, but main advantages are brevity of code and absence of artificial limitations.\n \n+I've also cleaned up related code a bit and deprecated `Cone.lattice_polytope` whose primary purpose was to use PALP for subdivision.\n``````\n",
    "created_at": "2014-04-22T22:21:34Z",
    "issue": "https://github.com/sagemath/sage/issues/16180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16180#issuecomment-209151",
    "user": "https://github.com/novoselt"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,3 @@
+Current `Fan.subdivide()` method cannot deal with fans generated by non-full-dimensional cones since it relies on PALP. In addition it is overly complicated. So let's use PPL cones for subdivision, since our toric cones already rely on them a lot. Speed-wise new method seems to work 2-3 times faster than the old one, but main advantages are brevity of code and absence of artificial limitations.
 
+I've also cleaned up related code a bit and deprecated `Cone.lattice_polytope` whose primary purpose was to use PALP for subdivision.
``````




---

archive/issue_comments_209152.json:
```json
{
    "body": "<a id='comment:2'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a6929591fdf4f797d7c89a79ba8723d82a58e380\">a692959</a></td><td><code>Use PPL for fan subdivision.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/17cb30b4b18f4422fc976039894bc7568782220d\">17cb30b</a></td><td><code>Fix doctests due to different facet ordering in PPL and PALP.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dc35d9d1dd0d10678213344f59e38481f934c338\">dc35d9d</a></td><td><code>Deprecate Cone.lattice_polytope() and drop cache for Cone.polyhedron().</code></td></tr></table>\n",
    "created_at": "2014-04-22T22:21:34Z",
    "issue": "https://github.com/sagemath/sage/issues/16180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16180#issuecomment-209152",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:2'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a6929591fdf4f797d7c89a79ba8723d82a58e380">a692959</a></td><td><code>Use PPL for fan subdivision.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/17cb30b4b18f4422fc976039894bc7568782220d">17cb30b</a></td><td><code>Fix doctests due to different facet ordering in PPL and PALP.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dc35d9d1dd0d10678213344f59e38481f934c338">dc35d9d</a></td><td><code>Deprecate Cone.lattice_polytope() and drop cache for Cone.polyhedron().</code></td></tr></table>




---

archive/issue_events_144170.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2014-04-22T22:21:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16180",
    "label": "enhancement",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16180#event-144170"
}
```



---

archive/issue_comments_209153.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"toric\".",
    "created_at": "2014-04-22T22:21:34Z",
    "issue": "https://github.com/sagemath/sage/issues/16180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16180#issuecomment-209153",
    "user": "https://github.com/novoselt"
}
```

**Changing keywords** from "" to "toric".



---

archive/issue_events_144171.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2014-04-22T22:21:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16180",
    "label": "component: geometry",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16180#event-144171"
}
```



---

archive/issue_events_144172.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/16180",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16180#event-144172"
}
```



---

archive/issue_events_144173.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16180",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16180#event-144173"
}
```



---

archive/issue_comments_209154.json:
```json
{
    "body": "<a id='comment:5'></a>\nHi Andrey,\n\nI've looked at the patch at it looks good - it's always nice to get rid of `LatticePolytope`. ;-)\nOne quick question: Is there any reason you're not caching the `polyhedron()` method of `Cone`?\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bd66bcd54e5a934547cae5f7e848612796a29c86\">bd66bcd</a></td><td><code>Merge branch 'develop' into u/novoselt/subdivide_fans_using_ppl</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f7f0dd54706d14d4d909715903581604ad133dc9\">f7f0dd5</a></td><td><code>Ticket 16180: Two minor formatting changes.</code></td></tr></table>\n",
    "created_at": "2014-07-24T13:25:21Z",
    "issue": "https://github.com/sagemath/sage/issues/16180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16180#issuecomment-209154",
    "user": "https://trac.sagemath.org/admin/accounts/users/jkeitel"
}
```

<a id='comment:5'></a>
Hi Andrey,

I've looked at the patch at it looks good - it's always nice to get rid of `LatticePolytope`. ;-)
One quick question: Is there any reason you're not caching the `polyhedron()` method of `Cone`?

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bd66bcd54e5a934547cae5f7e848612796a29c86">bd66bcd</a></td><td><code>Merge branch 'develop' into u/novoselt/subdivide_fans_using_ppl</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f7f0dd54706d14d4d909715903581604ad133dc9">f7f0dd5</a></td><td><code>Ticket 16180: Two minor formatting changes.</code></td></tr></table>




---

archive/issue_comments_209155.json:
```json
{
    "body": "**Changing commit** from \"[dc35d9d1dd0d10678213344f59e38481f934c338](https://github.com/sagemath/sagetrac-mirror/commit/dc35d9d1dd0d10678213344f59e38481f934c338)\" to \"[f7f0dd54706d14d4d909715903581604ad133dc9](https://github.com/sagemath/sagetrac-mirror/commit/f7f0dd54706d14d4d909715903581604ad133dc9)\".",
    "created_at": "2014-07-24T13:25:21Z",
    "issue": "https://github.com/sagemath/sage/issues/16180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16180#issuecomment-209155",
    "user": "https://trac.sagemath.org/admin/accounts/users/jkeitel"
}
```

**Changing commit** from "[dc35d9d1dd0d10678213344f59e38481f934c338](https://github.com/sagemath/sagetrac-mirror/commit/dc35d9d1dd0d10678213344f59e38481f934c338)" to "[f7f0dd54706d14d4d909715903581604ad133dc9](https://github.com/sagemath/sagetrac-mirror/commit/f7f0dd54706d14d4d909715903581604ad133dc9)".



---

archive/issue_comments_209156.json:
```json
{
    "body": "**Reviewer:** Jan Keitel",
    "created_at": "2014-07-24T13:25:21Z",
    "issue": "https://github.com/sagemath/sage/issues/16180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16180#issuecomment-209156",
    "user": "https://trac.sagemath.org/admin/accounts/users/jkeitel"
}
```

**Reviewer:** Jan Keitel



---

archive/issue_comments_209157.json:
```json
{
    "body": "**Changing branch** from \"[u/novoselt/subdivide_fans_using_ppl](https://github.com/sagemath/sagetrac-mirror/tree/u/novoselt/subdivide_fans_using_ppl)\" to \"[u/jkeitel/subdivide_fans_using_ppl](https://github.com/sagemath/sagetrac-mirror/tree/u/jkeitel/subdivide_fans_using_ppl)\".",
    "created_at": "2014-07-24T13:25:21Z",
    "issue": "https://github.com/sagemath/sage/issues/16180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16180#issuecomment-209157",
    "user": "https://trac.sagemath.org/admin/accounts/users/jkeitel"
}
```

**Changing branch** from "[u/novoselt/subdivide_fans_using_ppl](https://github.com/sagemath/sagetrac-mirror/tree/u/novoselt/subdivide_fans_using_ppl)" to "[u/jkeitel/subdivide_fans_using_ppl](https://github.com/sagemath/sagetrac-mirror/tree/u/jkeitel/subdivide_fans_using_ppl)".



---

archive/issue_comments_209158.json:
```json
{
    "body": "<a id='comment:6'></a>\nWell don't hate it please, there is nothing wrong with the class, only with its backend which was designed for a quite specific purpose ;-) And of course bounded polytopes are not the best way to represent unbounded cones.\n\nAs for caching - why should we cache `polyhedron()`? It is a complicated data structure which will take memory and can cause issues in pickling (this was the main reason for the change here, if I recall correctly - I was trying to simplify pickling code), it is not used extensively in internal computations, and I don't think there are many reasons for users to construct them. On the other hand it definitely can be handy if you want to do some generic operations like shifting the cone from the origin.\n\nWere there any conflicts during merge? (I never liked what is shown when you click on \"merge commit.\")",
    "created_at": "2014-07-24T15:34:06Z",
    "issue": "https://github.com/sagemath/sage/issues/16180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16180#issuecomment-209158",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:6'></a>
Well don't hate it please, there is nothing wrong with the class, only with its backend which was designed for a quite specific purpose ;-) And of course bounded polytopes are not the best way to represent unbounded cones.

As for caching - why should we cache `polyhedron()`? It is a complicated data structure which will take memory and can cause issues in pickling (this was the main reason for the change here, if I recall correctly - I was trying to simplify pickling code), it is not used extensively in internal computations, and I don't think there are many reasons for users to construct them. On the other hand it definitely can be handy if you want to do some generic operations like shifting the cone from the origin.

Were there any conflicts during merge? (I never liked what is shown when you click on "merge commit.")



---

archive/issue_comments_209159.json:
```json
{
    "body": "**Changing commit** from \"[f7f0dd54706d14d4d909715903581604ad133dc9](https://github.com/sagemath/sagetrac-mirror/commit/f7f0dd54706d14d4d909715903581604ad133dc9)\" to \"[59c8c9475223e98aeb604a79d22427605f20b5fb](https://github.com/sagemath/sagetrac-mirror/commit/59c8c9475223e98aeb604a79d22427605f20b5fb)\".",
    "created_at": "2014-07-24T15:46:07Z",
    "issue": "https://github.com/sagemath/sage/issues/16180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16180#issuecomment-209159",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[f7f0dd54706d14d4d909715903581604ad133dc9](https://github.com/sagemath/sagetrac-mirror/commit/f7f0dd54706d14d4d909715903581604ad133dc9)" to "[59c8c9475223e98aeb604a79d22427605f20b5fb](https://github.com/sagemath/sagetrac-mirror/commit/59c8c9475223e98aeb604a79d22427605f20b5fb)".



---

archive/issue_comments_209160.json:
```json
{
    "body": "<a id='comment:7'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/59c8c9475223e98aeb604a79d22427605f20b5fb\">59c8c94</a></td><td><code>Change two Trac occurences to proper syntax.</code></td></tr></table>\n",
    "created_at": "2014-07-24T15:46:07Z",
    "issue": "https://github.com/sagemath/sage/issues/16180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16180#issuecomment-209160",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/59c8c9475223e98aeb604a79d22427605f20b5fb">59c8c94</a></td><td><code>Change two Trac occurences to proper syntax.</code></td></tr></table>




---

archive/issue_comments_209161.json:
```json
{
    "body": "<a id='comment:8'></a>\nNo, the merge went through cleanly. I just merged the development branch in to see whether it is working with the current version. Otherwise I wouldn't have noticed the doctest warning because of the line number, since that has only recently been included (#16626). And I then based the new commit on the merged branch since it saved a lot of time when building Sage. I hope Volker will forgive the extra commit.\n\nI just noticed that `polytope()` only seems to get used in the doctests - so not caching does make perfect sense. If you're happy, then you can set this to positive review.",
    "created_at": "2014-07-24T15:51:13Z",
    "issue": "https://github.com/sagemath/sage/issues/16180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16180#issuecomment-209161",
    "user": "https://trac.sagemath.org/admin/accounts/users/jkeitel"
}
```

<a id='comment:8'></a>
No, the merge went through cleanly. I just merged the development branch in to see whether it is working with the current version. Otherwise I wouldn't have noticed the doctest warning because of the line number, since that has only recently been included (#16626). And I then based the new commit on the merged branch since it saved a lot of time when building Sage. I hope Volker will forgive the extra commit.

I just noticed that `polytope()` only seems to get used in the doctests - so not caching does make perfect sense. If you're happy, then you can set this to positive review.



---

archive/issue_comments_209162.json:
```json
{
    "body": "<a id='comment:9'></a>\nThanks, lgtm!",
    "created_at": "2014-07-24T15:54:50Z",
    "issue": "https://github.com/sagemath/sage/issues/16180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16180#issuecomment-209162",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:9'></a>
Thanks, lgtm!



---

archive/issue_events_144174.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-07-24T15:54:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16180",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16180#event-144174"
}
```



---

archive/issue_events_144175.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-07-24T15:54:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16180",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16180#event-144175"
}
```



---

archive/issue_comments_209163.json:
```json
{
    "body": "<a id='comment:10'></a>\nThank you! Looking at your changes made me realize that toric stuff existed for 4 years already! Life is fast...",
    "created_at": "2014-07-24T15:56:12Z",
    "issue": "https://github.com/sagemath/sage/issues/16180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16180#issuecomment-209163",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:10'></a>
Thank you! Looking at your changes made me realize that toric stuff existed for 4 years already! Life is fast...



---

archive/issue_events_144176.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-07-25T05:05:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16180",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16180#event-144176"
}
```



---

archive/issue_events_144177.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "6937389f6b841d4fe81cfc116abfc6f42c20eed2",
    "created_at": "2014-07-25T05:05:45Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/16180",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16180#event-144177"
}
```



---

archive/issue_comments_209164.json:
```json
{
    "body": "**Changing branch** from \"[u/jkeitel/subdivide_fans_using_ppl](https://github.com/sagemath/sagetrac-mirror/tree/u/jkeitel/subdivide_fans_using_ppl)\" to \"[59c8c9475223e98aeb604a79d22427605f20b5fb](https://github.com/sagemath/sagetrac-mirror/commit/59c8c9475223e98aeb604a79d22427605f20b5fb)\".",
    "created_at": "2014-07-25T05:05:45Z",
    "issue": "https://github.com/sagemath/sage/issues/16180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16180#issuecomment-209164",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/jkeitel/subdivide_fans_using_ppl](https://github.com/sagemath/sagetrac-mirror/tree/u/jkeitel/subdivide_fans_using_ppl)" to "[59c8c9475223e98aeb604a79d22427605f20b5fb](https://github.com/sagemath/sagetrac-mirror/commit/59c8c9475223e98aeb604a79d22427605f20b5fb)".
