# Issue 16935: Faster palindromes function for the Words library

archive/issues_016698.json:
```json
{
    "body": "I've written a faster algorithm to get the set of all the distinct palindromic factors of a given word. There's also a new function called long_lpc (for long method to get the longest palindome centered at a given position) that is added.\n\nYou can see here that the algorithm is factor, especially for long words.\n\nHere is the old version :\n\n```\nsage: f=WordMorphism({'a':['a','b'], 'b':['a']}).fixed_point('a')[:1000]\nsage: %time M=f.palindromes()\nCPU times: user 1.83 s, sys: 22.8 ms, total: 1.85 s\nWall time: 1.83 s\n\nsage: t=WordMorphism({'a':['a','b'], 'b':['b','a']}).fixed_point('a')[:1000]\nsage: %time N=t.palindromes()\nCPU times: user 1.02 s, sys: 8.4 ms, total: 1.03 s\nWall time: 1.02 s\n\nsage: tm=WordMorphism({'a':['a','b'], 'b':['b','a']}).fixed_point('a')[:5000]\nsage: %time N=tm.palindromes()\nCPU times: user 28.5 s, sys: 117 ms, total: 28.7 s\nWall time: 28.6 s\n```\n\nAnd the new version :\n\n```\nsage: f=WordMorphism({'a':['a','b'], 'b':['a']}).fixed_point('a')[:1000]\nsage: %time M=f.palindromes()\nCPU times: user 436 ms, sys: 20 ms, total: 456 ms\nWall time: 450 ms\n\nsage: t=WordMorphism({'a':['a','b'], 'b':['b','a']}).fixed_point('a')[:1000]\nsage: %time N=t.palindromes()\nCPU times: user 362 ms, sys: 19.7 ms, total: 382 ms\nWall time: 371 ms\n\nsage: tm=WordMorphism({'a':['a','b'], 'b':['b','a']}).fixed_point('a')[:5000]                  \nsage: %time N=tm.palindromes()\nCPU times: user 2.94 s, sys: 45.3 ms, total: 2.99 s\nWall time: 2.96 s\n\n```\n\n\nThe principle of the algorithm is to calculate, for every letter and every space between two letters, the longest palindrome centered in that position. Once a longer palindrome is found, the information leftwise to the center is copied to the right because the proper subpalindromes are present at least twice.\n\nAt the same time, there is a list created recording the length of the longest palindromic suffix of each prefix of the word. Since the number of prefixes is bounded by one plus the length of the word, the set of palindromes to be compared is not too big (the comparison is necessary to get the unicity).\n\nThere is still a problem with the palindromes() function already in SAGE that has not been fixed with the new algorithm : For `f`-palindromes (or pseudo-palindromes), the word morphism `f` cannot apply to words generated with the WordGenerator class on the default alphabet (0,1). The main problem is that the type of the letters of these words are `int` (not words, nor any type that can be changed into words). I did not find any way to fix it, except to change the alphabet when generating these words.\n\n```\nsage: fib=words.FibonacciWord()[:1000]\nsage: type(fib)\n<class 'sage.combinat.words.word.FiniteWord_iter_with_caching'>\n\nsage: type(fib[5])\n<type 'int'>\n\nsage: type(words.KolakoskiWord()[2])\n<type 'int'>\n\nsage: type(words.ThueMorseWord()[2])\n<type 'int'>\n```\n\nCC:  @seblabbe @staroste\n\nKeywords: words, finite words, palindromes\n\nBranch/Commit: fcdd2f830906015ddf3c1623bd7a29dde8e1e58e\n\nReviewer: S\u00e9bastien Labb\u00e9\n\nAuthor: Nadia Lafreni\u00e8re\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/16935\n\n",
    "closed_at": "2015-04-14T19:44:09Z",
    "created_at": "2014-09-04T20:30:38Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Faster palindromes function for the Words library",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16935",
    "user": "https://github.com/nadialafreniere"
}
```
I've written a faster algorithm to get the set of all the distinct palindromic factors of a given word. There's also a new function called long_lpc (for long method to get the longest palindome centered at a given position) that is added.

You can see here that the algorithm is factor, especially for long words.

Here is the old version :

```
sage: f=WordMorphism({'a':['a','b'], 'b':['a']}).fixed_point('a')[:1000]
sage: %time M=f.palindromes()
CPU times: user 1.83 s, sys: 22.8 ms, total: 1.85 s
Wall time: 1.83 s

sage: t=WordMorphism({'a':['a','b'], 'b':['b','a']}).fixed_point('a')[:1000]
sage: %time N=t.palindromes()
CPU times: user 1.02 s, sys: 8.4 ms, total: 1.03 s
Wall time: 1.02 s

sage: tm=WordMorphism({'a':['a','b'], 'b':['b','a']}).fixed_point('a')[:5000]
sage: %time N=tm.palindromes()
CPU times: user 28.5 s, sys: 117 ms, total: 28.7 s
Wall time: 28.6 s
```

And the new version :

```
sage: f=WordMorphism({'a':['a','b'], 'b':['a']}).fixed_point('a')[:1000]
sage: %time M=f.palindromes()
CPU times: user 436 ms, sys: 20 ms, total: 456 ms
Wall time: 450 ms

sage: t=WordMorphism({'a':['a','b'], 'b':['b','a']}).fixed_point('a')[:1000]
sage: %time N=t.palindromes()
CPU times: user 362 ms, sys: 19.7 ms, total: 382 ms
Wall time: 371 ms

sage: tm=WordMorphism({'a':['a','b'], 'b':['b','a']}).fixed_point('a')[:5000]                  
sage: %time N=tm.palindromes()
CPU times: user 2.94 s, sys: 45.3 ms, total: 2.99 s
Wall time: 2.96 s

```


The principle of the algorithm is to calculate, for every letter and every space between two letters, the longest palindrome centered in that position. Once a longer palindrome is found, the information leftwise to the center is copied to the right because the proper subpalindromes are present at least twice.

At the same time, there is a list created recording the length of the longest palindromic suffix of each prefix of the word. Since the number of prefixes is bounded by one plus the length of the word, the set of palindromes to be compared is not too big (the comparison is necessary to get the unicity).

There is still a problem with the palindromes() function already in SAGE that has not been fixed with the new algorithm : For `f`-palindromes (or pseudo-palindromes), the word morphism `f` cannot apply to words generated with the WordGenerator class on the default alphabet (0,1). The main problem is that the type of the letters of these words are `int` (not words, nor any type that can be changed into words). I did not find any way to fix it, except to change the alphabet when generating these words.

```
sage: fib=words.FibonacciWord()[:1000]
sage: type(fib)
<class 'sage.combinat.words.word.FiniteWord_iter_with_caching'>

sage: type(fib[5])
<type 'int'>

sage: type(words.KolakoskiWord()[2])
<type 'int'>

sage: type(words.ThueMorseWord()[2])
<type 'int'>
```

CC:  @seblabbe @staroste

Keywords: words, finite words, palindromes

Branch/Commit: fcdd2f830906015ddf3c1623bd7a29dde8e1e58e

Reviewer: Sébastien Labbé

Author: Nadia Lafrenière

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/16935





---

archive/issue_comments_283986.json:
```json
{
    "body": "Changing branch from \"\" to \"u/nadialafreniere/faster_palindromes_function_for_the_words_library\"",
    "created_at": "2014-09-04T20:43:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-283986",
    "user": "https://github.com/nadialafreniere"
}
```

Changing branch from "" to "u/nadialafreniere/faster_palindromes_function_for_the_words_library"



---

archive/issue_comments_283987.json:
```json
{
    "body": "<a id='comment:2'></a>The branch seems empty (it says \"already merged\").",
    "created_at": "2014-09-08T13:54:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-283987",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:2'></a>The branch seems empty (it says "already merged").



---

archive/issue_comments_283988.json:
```json
{
    "body": "Changing commit from \"\" to \"a86cf9334a58fe016e06577e915a5ccf33cce7c7\"",
    "created_at": "2014-09-08T13:54:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-283988",
    "user": "https://github.com/seblabbe"
}
```

Changing commit from "" to "a86cf9334a58fe016e06577e915a5ccf33cce7c7"



---

archive/issue_comments_283989.json:
```json
{
    "body": "Changing branch from \"u/nadialafreniere/faster_palindromes_function_for_the_words_library\" to \"u/nadialafreniere/16935\"",
    "created_at": "2014-09-09T15:24:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-283989",
    "user": "https://github.com/nadialafreniere"
}
```

Changing branch from "u/nadialafreniere/faster_palindromes_function_for_the_words_library" to "u/nadialafreniere/16935"



---

archive/issue_comments_283990.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,46 @@\n I've written a faster algorithm to get the set of all the distinct palindromic factors of a given word. There's also a new function called long_lpc (for long method to get the longest palindome centered at a given position) that is added.\n+\n+You can see here that the algorithm is factor, especially for long words.\n+\n+Here is the old version :\n+\n+```\n+sage: f=WordMorphism({'a':['a','b'], 'b':['a']}).fixed_point('a')[:1000]\n+sage: %time M=f.palindromes()\n+CPU times: user 1.83 s, sys: 22.8 ms, total: 1.85 s\n+Wall time: 1.83 s\n+\n+sage: t=WordMorphism({'a':['a','b'], 'b':['b','a']}).fixed_point('a')[:1000]\n+sage: %time N=t.palindromes()\n+CPU times: user 1.02 s, sys: 8.4 ms, total: 1.03 s\n+Wall time: 1.02 s\n+\n+sage: tm=WordMorphism({'a':['a','b'], 'b':['b','a']}).fixed_point('a')[:5000]\n+sage: %time N=tm.palindromes()\n+CPU times: user 28.5 s, sys: 117 ms, total: 28.7 s\n+Wall time: 28.6 s\n+```\n+\n+And the new version :\n+\n+```\n+sage: f=WordMorphism({'a':['a','b'], 'b':['a']}).fixed_point('a')[:1000]\n+sage: %time M=f.palindromes()\n+CPU times: user 436 ms, sys: 20 ms, total: 456 ms\n+Wall time: 450 ms\n+\n+sage: t=WordMorphism({'a':['a','b'], 'b':['b','a']}).fixed_point('a')[:1000]\n+sage: %time N=t.palindromes()\n+CPU times: user 362 ms, sys: 19.7 ms, total: 382 ms\n+Wall time: 371 ms\n+\n+sage: tm=WordMorphism({'a':['a','b'], 'b':['b','a']}).fixed_point('a')[:5000]                  \n+sage: %time N=tm.palindromes()\n+CPU times: user 2.94 s, sys: 45.3 ms, total: 2.99 s\n+Wall time: 2.96 s\n+\n+```\n+\n \n The principle of the algorithm is to calculate, for every letter and every space between two letters, the longest palindrome centered in that position. Once a longer palindrome is found, the information leftwise to the center is copied to the right because the proper subpalindromes are present at least twice.\n \n@@ -8,17 +50,17 @@\n \n ```\n sage: fib=words.FibonacciWord()[:1000]\n-sage: print \"type de fib : \" + str(type(fib))\n-type de fib : <class 'sage.combinat.words.word.FiniteWord_iter_with_caching'>\n+sage: type(fib)\n+<class 'sage.combinat.words.word.FiniteWord_iter_with_caching'>\n \n-sage: print \"type de fib[5] : \" + str(type(fib[5]))\n-type de fib[5] : <type 'int'>\n+sage: type(fib[5])\n+<type 'int'>\n \n-sage: print \"type de words.KolakoskiWord()[2] : \" + str(type(words.KolakoskiWord()[2]))\n-type de words.KolakoskiWord()[2] : <type 'int'>\n+sage: type(words.KolakoskiWord()[2])\n+<type 'int'>\n \n-sage: print \"type de words.ThueMorseWord()[2] : \" + str(type(words.ThueMorseWord()[2]))\n-type de words.ThueMorseWord()[2] : <type 'int'>\n+sage: type(words.ThueMorseWord()[2])\n+<type 'int'>\n ```\n \n Author: Nadia Lafreni\u00e8re\n``````\n",
    "created_at": "2014-09-10T20:35:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-283990",
    "user": "https://github.com/nadialafreniere"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,46 @@
 I've written a faster algorithm to get the set of all the distinct palindromic factors of a given word. There's also a new function called long_lpc (for long method to get the longest palindome centered at a given position) that is added.
+
+You can see here that the algorithm is factor, especially for long words.
+
+Here is the old version :
+
+```
+sage: f=WordMorphism({'a':['a','b'], 'b':['a']}).fixed_point('a')[:1000]
+sage: %time M=f.palindromes()
+CPU times: user 1.83 s, sys: 22.8 ms, total: 1.85 s
+Wall time: 1.83 s
+
+sage: t=WordMorphism({'a':['a','b'], 'b':['b','a']}).fixed_point('a')[:1000]
+sage: %time N=t.palindromes()
+CPU times: user 1.02 s, sys: 8.4 ms, total: 1.03 s
+Wall time: 1.02 s
+
+sage: tm=WordMorphism({'a':['a','b'], 'b':['b','a']}).fixed_point('a')[:5000]
+sage: %time N=tm.palindromes()
+CPU times: user 28.5 s, sys: 117 ms, total: 28.7 s
+Wall time: 28.6 s
+```
+
+And the new version :
+
+```
+sage: f=WordMorphism({'a':['a','b'], 'b':['a']}).fixed_point('a')[:1000]
+sage: %time M=f.palindromes()
+CPU times: user 436 ms, sys: 20 ms, total: 456 ms
+Wall time: 450 ms
+
+sage: t=WordMorphism({'a':['a','b'], 'b':['b','a']}).fixed_point('a')[:1000]
+sage: %time N=t.palindromes()
+CPU times: user 362 ms, sys: 19.7 ms, total: 382 ms
+Wall time: 371 ms
+
+sage: tm=WordMorphism({'a':['a','b'], 'b':['b','a']}).fixed_point('a')[:5000]                  
+sage: %time N=tm.palindromes()
+CPU times: user 2.94 s, sys: 45.3 ms, total: 2.99 s
+Wall time: 2.96 s
+
+```
+
 
 The principle of the algorithm is to calculate, for every letter and every space between two letters, the longest palindrome centered in that position. Once a longer palindrome is found, the information leftwise to the center is copied to the right because the proper subpalindromes are present at least twice.
 
@@ -8,17 +50,17 @@
 
 ```
 sage: fib=words.FibonacciWord()[:1000]
-sage: print "type de fib : " + str(type(fib))
-type de fib : <class 'sage.combinat.words.word.FiniteWord_iter_with_caching'>
+sage: type(fib)
+<class 'sage.combinat.words.word.FiniteWord_iter_with_caching'>
 
-sage: print "type de fib[5] : " + str(type(fib[5]))
-type de fib[5] : <type 'int'>
+sage: type(fib[5])
+<type 'int'>
 
-sage: print "type de words.KolakoskiWord()[2] : " + str(type(words.KolakoskiWord()[2]))
-type de words.KolakoskiWord()[2] : <type 'int'>
+sage: type(words.KolakoskiWord()[2])
+<type 'int'>
 
-sage: print "type de words.ThueMorseWord()[2] : " + str(type(words.ThueMorseWord()[2]))
-type de words.ThueMorseWord()[2] : <type 'int'>
+sage: type(words.ThueMorseWord()[2])
+<type 'int'>
 ```
 
 Author: Nadia Lafrenière
``````




---

archive/issue_comments_283991.json:
```json
{
    "body": "Changing commit from \"a86cf9334a58fe016e06577e915a5ccf33cce7c7\" to \"ca9a46b527309d80a785b8d0090f66b7691e1c9d\"",
    "created_at": "2014-09-10T20:35:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-283991",
    "user": "https://github.com/nadialafreniere"
}
```

Changing commit from "a86cf9334a58fe016e06577e915a5ccf33cce7c7" to "ca9a46b527309d80a785b8d0090f66b7691e1c9d"



---

archive/issue_comments_283992.json:
```json
{
    "body": "<a id='comment:5'></a>I did a first quick reading of the code. Here are some comments about it. I still need to actually read the code itself, which I will do in another comment not today.\n\n1. There are two failing doctests in `finite_word.py`. Also, some tabulation were introduced in that file. According to the [Python code style](http://sagemath.org/doc/developer/coding_basics.html#python-code-style), the convention is to use 4 spaces for indentation levels.\n\n```\nsage -t src/sage/combinat/words/finite_word.py\n**********************************************************************\nFile \"src/sage/combinat/words/finite_word.py\", line 2736, in sage.combinat.words.finite_word.FiniteWord_class.defect\nFailed example:\n    Word('a').defect(f)\nException raised:\n    Traceback (most recent call last):\n    ...\n    IndexError: list index out of range\n**********************************************************************\nFile \"src/sage/combinat/words/finite_word.py\", line 2740, in sage.combinat.words.finite_word.FiniteWord_class.defect\nFailed example:\n    Word('aa').defect(f)\nException raised:\n    Traceback (most recent call last):\n    ...\n    IndexError: list index out of range\n**********************************************************************\n1 item had failures:\n   2 of  26 in sage.combinat.words.finite_word.FiniteWord_class.defect\n    Error: TAB character found at lines 2463,2488,2509,2554\n    [1116 tests, 2 failures, 13.93 s]\n----------------------------------------------------------------------\nsage -t src/sage/combinat/words/finite_word.py  # Tab character found\nsage -t src/sage/combinat/words/finite_word.py  # 2 doctests failed\n----------------------------------------------------------------------\n```\n\n2. The name of the method `long_lpc` is not communicative. I would suggest to use `length_longest_palindrome` instead.\n\n3. There are missing commas in input docstrings:\n\n```diff\n-        - ``j`` -- integer a position that is the symmetry axis of the palindrome.  \n+        - ``j`` -- integer, position that is the symmetry axis of the palindrome.  \n-        - ``m`` -- integer (default: 0) the minimal length of the palindrome, if known.\n+        - ``m`` -- integer (default: 0), minimal length of the palindrome, if known.\n```\n\n4. Missing spaces in the argument of a function:\n\n```diff\n-            sage: Word('01010').long_lpc(j=3,f='0->1,1->0')\n+            sage: Word('01010').long_lpc(j=3, f='0->1,1->0')\n```\n\n5. [White spaces](http://legacy.python.org/dev/peps/pep-0008/#whitespace-in-expressions-and-statements) are wrong here:\n\n```python\n#Initialize m if set to 0\nif m==0:                 \n    m=-(j%2)             \n```\n\nand many other places.\n\n6. Why? No space was OK.\n\n```diff                 \n-        INPUT:  \n+        INPUT : \n```\n\n7. Why do you erase and modify doctests in the `palindromes` method?\n\n8. There is *a lot* of comments in the code. Are all of them really necessary? I have never seen Sage code with that many comments. If the algorithm is really complicated, the code can be simplified by moving parts into another method. Also, the pseudo code of it can be put in the doctrings. But, I would leave the code with less comments. See also : http://legacy.python.org/dev/peps/pep-0008/#comments",
    "created_at": "2014-09-11T20:06:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-283992",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:5'></a>I did a first quick reading of the code. Here are some comments about it. I still need to actually read the code itself, which I will do in another comment not today.

1. There are two failing doctests in `finite_word.py`. Also, some tabulation were introduced in that file. According to the [Python code style](http://sagemath.org/doc/developer/coding_basics.html#python-code-style), the convention is to use 4 spaces for indentation levels.

```
sage -t src/sage/combinat/words/finite_word.py
**********************************************************************
File "src/sage/combinat/words/finite_word.py", line 2736, in sage.combinat.words.finite_word.FiniteWord_class.defect
Failed example:
    Word('a').defect(f)
Exception raised:
    Traceback (most recent call last):
    ...
    IndexError: list index out of range
**********************************************************************
File "src/sage/combinat/words/finite_word.py", line 2740, in sage.combinat.words.finite_word.FiniteWord_class.defect
Failed example:
    Word('aa').defect(f)
Exception raised:
    Traceback (most recent call last):
    ...
    IndexError: list index out of range
**********************************************************************
1 item had failures:
   2 of  26 in sage.combinat.words.finite_word.FiniteWord_class.defect
    Error: TAB character found at lines 2463,2488,2509,2554
    [1116 tests, 2 failures, 13.93 s]
----------------------------------------------------------------------
sage -t src/sage/combinat/words/finite_word.py  # Tab character found
sage -t src/sage/combinat/words/finite_word.py  # 2 doctests failed
----------------------------------------------------------------------
```

2. The name of the method `long_lpc` is not communicative. I would suggest to use `length_longest_palindrome` instead.

3. There are missing commas in input docstrings:

```diff
-        - ``j`` -- integer a position that is the symmetry axis of the palindrome.  
+        - ``j`` -- integer, position that is the symmetry axis of the palindrome.  
-        - ``m`` -- integer (default: 0) the minimal length of the palindrome, if known.
+        - ``m`` -- integer (default: 0), minimal length of the palindrome, if known.
```

4. Missing spaces in the argument of a function:

```diff
-            sage: Word('01010').long_lpc(j=3,f='0->1,1->0')
+            sage: Word('01010').long_lpc(j=3, f='0->1,1->0')
```

5. [White spaces](http://legacy.python.org/dev/peps/pep-0008/#whitespace-in-expressions-and-statements) are wrong here:

```python
#Initialize m if set to 0
if m==0:                 
    m=-(j%2)             
```

and many other places.

6. Why? No space was OK.

```diff                 
-        INPUT:  
+        INPUT : 
```

7. Why do you erase and modify doctests in the `palindromes` method?

8. There is *a lot* of comments in the code. Are all of them really necessary? I have never seen Sage code with that many comments. If the algorithm is really complicated, the code can be simplified by moving parts into another method. Also, the pseudo code of it can be put in the doctrings. But, I would leave the code with less comments. See also : http://legacy.python.org/dev/peps/pep-0008/#comments



---

archive/issue_comments_283993.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-09-11T20:07:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-283993",
    "user": "https://github.com/seblabbe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_283994.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-09-11T20:07:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-283994",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_283995.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-09-12T15:02:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-283995",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_283996.json:
```json
{
    "body": "Changing commit from \"ca9a46b527309d80a785b8d0090f66b7691e1c9d\" to \"def64a1a59757069be2840256a41dbc5951d5e07\"",
    "created_at": "2014-09-12T15:02:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-283996",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "ca9a46b527309d80a785b8d0090f66b7691e1c9d" to "def64a1a59757069be2840256a41dbc5951d5e07"



---

archive/issue_comments_283997.json:
```json
{
    "body": "<a id='comment:9'></a>If you make any changes to the ticket and you want me to review it again. Then change the status of the ticket to \"needs_review\". This sends me an email and I will come and look. Otherwise, I think that no update was done and I wait. I just learned that you made changes six week ago.",
    "created_at": "2014-10-24T16:23:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-283997",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:9'></a>If you make any changes to the ticket and you want me to review it again. Then change the status of the ticket to "needs_review". This sends me an email and I will come and look. Otherwise, I think that no update was done and I wait. I just learned that you made changes six week ago.



---

archive/issue_comments_283998.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-10-24T16:23:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-283998",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_283999.json:
```json
{
    "body": "<a id='comment:10'></a>It is difficult for me to take a look at the code itself when the syntax convention are not followed.\n\n1. One empty line is nice to separate block of code. Two consecutive empty lines should be avoided.\n\n2. Never put an empty line after a `for` statement.\n\n3. Try to keep comment on one line. Rephrase if necessary.\n\n4. One line should be less than 80 characters.\n\n5. If a comment takes more than one line, then avoid any indentation for the second line.\n\n6. A comment should always start at the actual indentation level.\n\n7. Why do you write `k = Integer(0) ` instead of just `k=0`?\n\n8. `long_lpc` should not appear anymore (code + doctest).\n\n9. Slices of words should not be changed into tuple to make the equality test. The code in that class is mathematical. It should not play with the internal representation. Suppose your word is already represented by a tuple. Why change it into a tuple?\n\n10. Remove useless comment like \n\n```\n# Return the length of the palindrome\nreturn p\n```\n\n11. Add comments where it is necessary:\n\n```\nexcept IndexError:\n    pass          \n```\n\nWhy such an error is not an error? It seems strange to me to choose such an implementation...",
    "created_at": "2014-10-24T16:37:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-283999",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:10'></a>It is difficult for me to take a look at the code itself when the syntax convention are not followed.

1. One empty line is nice to separate block of code. Two consecutive empty lines should be avoided.

2. Never put an empty line after a `for` statement.

3. Try to keep comment on one line. Rephrase if necessary.

4. One line should be less than 80 characters.

5. If a comment takes more than one line, then avoid any indentation for the second line.

6. A comment should always start at the actual indentation level.

7. Why do you write `k = Integer(0) ` instead of just `k=0`?

8. `long_lpc` should not appear anymore (code + doctest).

9. Slices of words should not be changed into tuple to make the equality test. The code in that class is mathematical. It should not play with the internal representation. Suppose your word is already represented by a tuple. Why change it into a tuple?

10. Remove useless comment like 

```
# Return the length of the palindrome
return p
```

11. Add comments where it is necessary:

```
except IndexError:
    pass          
```

Why such an error is not an error? It seems strange to me to choose such an implementation...



---

archive/issue_comments_284000.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-10-24T16:37:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-284000",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_284001.json:
```json
{
    "body": "<a id='comment:12'></a>12. The code of `length_longest_palindrome` method contains the same line four times:\n\n```\nwhile j//2 - i >= 0 and tuple(self[j//2-i : j//2-i+1]) == tuple(f(self[j//2+i : j//2+i+1])):\n    i = i + 1\n```\n\nSomething should be done to factorize the code a little bit. For instance if `j%2 == 1`, then store the result of `j//2` into some variable `K` and else store the variable `j/2` in `K`. Then, use `K` and factorize the code.\n\n13. Anyhow, in the line of code above, avoid the creation of a tuple. Also, I suggest to avoid the slice and simply use a for loop for the indexes you want to compare.\n\nI am thinking of a code that would look like that (it is most probably wrong as I did not think about the limit cases and even vs odd palindrome length, etc.)\n\n```\npossible = max(j, self.length()-j)\ni = m / 2\nwhile i < possible and self[j-i] == self[j+i]:\n    i += 1\nreturn i\n```\n\nBut you get what I mean: short and clean code do not need any comment.",
    "created_at": "2014-10-24T19:39:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-284001",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:12'></a>12. The code of `length_longest_palindrome` method contains the same line four times:

```
while j//2 - i >= 0 and tuple(self[j//2-i : j//2-i+1]) == tuple(f(self[j//2+i : j//2+i+1])):
    i = i + 1
```

Something should be done to factorize the code a little bit. For instance if `j%2 == 1`, then store the result of `j//2` into some variable `K` and else store the variable `j/2` in `K`. Then, use `K` and factorize the code.

13. Anyhow, in the line of code above, avoid the creation of a tuple. Also, I suggest to avoid the slice and simply use a for loop for the indexes you want to compare.

I am thinking of a code that would look like that (it is most probably wrong as I did not think about the limit cases and even vs odd palindrome length, etc.)

```
possible = max(j, self.length()-j)
i = m / 2
while i < possible and self[j-i] == self[j+i]:
    i += 1
return i
```

But you get what I mean: short and clean code do not need any comment.



---

archive/issue_comments_284002.json:
```json
{
    "body": "<a id='comment:13'></a>14. I do not get why there is an odd and even case. What is the definition of `the length of the longest palindrome centered at a given position j`?\n\n    I think that `j` should be a rational number `0<= j < w.length()` such that `2j` is an integer. Like `j=2.5` could be valid. This idea comes from the fact that a word w is symmetric if `w[i]=w[2a-i]` for all indices i and for some value a where 2a is an integer.",
    "created_at": "2014-10-24T19:54:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-284002",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:13'></a>14. I do not get why there is an odd and even case. What is the definition of `the length of the longest palindrome centered at a given position j`?

    I think that `j` should be a rational number `0<= j < w.length()` such that `2j` is an integer. Like `j=2.5` could be valid. This idea comes from the fact that a word w is symmetric if `w[i]=w[2a-i]` for all indices i and for some value a where 2a is an integer.



---

archive/issue_comments_284003.json:
```json
{
    "body": "<a id='comment:14'></a>15. In the code of the `palindromes` method, you compute two tables: `LPS` and `LPC`. If I understand correctly, the computation of `LPS` depends on the computation of `LPC` but not conversely. Therefore, why are they computed in parallel?\n\n    I would rather suggest if it is possible to write a method that computes and return just `LPC`. Then, another method that computes and return just `LPS` if it is possible to compute it from `LPC`. And finally the method `palindromes` that returns all of the factors from the `LPS` method.\n\n    Also, the palindromes method should have a `algorithm` argument allowing to choose between the old and new way of doing things. This facilitates the comparison of efficiency. Otherwise, it is more difficult to see how faster is your new algorithm.",
    "created_at": "2014-10-24T20:04:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-284003",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:14'></a>15. In the code of the `palindromes` method, you compute two tables: `LPS` and `LPC`. If I understand correctly, the computation of `LPS` depends on the computation of `LPC` but not conversely. Therefore, why are they computed in parallel?

    I would rather suggest if it is possible to write a method that computes and return just `LPC`. Then, another method that computes and return just `LPS` if it is possible to compute it from `LPC`. And finally the method `palindromes` that returns all of the factors from the `LPS` method.

    Also, the palindromes method should have a `algorithm` argument allowing to choose between the old and new way of doing things. This facilitates the comparison of efficiency. Otherwise, it is more difficult to see how faster is your new algorithm.



---

archive/issue_comments_284004.json:
```json
{
    "body": "<a id='comment:15'></a>16. Be more brief. For instance replace the 7 lines\n\n```\n# The list LPS records the lengths of the longest\n# `f`-palindromic suffix for each prefix of self.\nLPS = [] \n \n# The list LPC records the lengths of the maximal\n# `f`-palindromes centered at each position j in self.\nLPC = []     \n```\n\nby the 2 lines:\n\n```\nLPS = [] #lengths of longest palindrome suffix of prefixes\nLPC = [] #lengths of maximal palindromes centered at a position\n```\n\nand so on...",
    "created_at": "2014-10-24T20:08:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-284004",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:15'></a>16. Be more brief. For instance replace the 7 lines

```
# The list LPS records the lengths of the longest
# `f`-palindromic suffix for each prefix of self.
LPS = [] 
 
# The list LPC records the lengths of the maximal
# `f`-palindromes centered at each position j in self.
LPC = []     
```

by the 2 lines:

```
LPS = [] #lengths of longest palindrome suffix of prefixes
LPC = [] #lengths of maximal palindromes centered at a position
```

and so on...



---

archive/issue_comments_284005.json:
```json
{
    "body": "Changing commit from \"def64a1a59757069be2840256a41dbc5951d5e07\" to \"05cbe2844498c4c1f3d325e4ac27e637188b8e71\"",
    "created_at": "2015-02-01T18:12:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-284005",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "def64a1a59757069be2840256a41dbc5951d5e07" to "05cbe2844498c4c1f3d325e4ac27e637188b8e71"



---

archive/issue_comments_284006.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-01T18:12:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-284006",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_284007.json:
```json
{
    "body": "<a id='comment:17'></a>I think I've given an answer to almost all the comments in the list above.\n\nHowever, for number 11., I haven't found a better way to do it. The idea is to avoid to count outside of the string. For example, I don't want to test if w[-1]==w[n] for a word w, since I don't want the palindromes in the circular word. Any suggestion would be very welcome!\n\nFor number 15., the reason I pretend the new algorithm is faster is that the list of the lengths of longest palindromic suffixes is computed in linear time for any type of words. With the actual version of the SAGE library, for words having large palindromes, it can be much more than that. For example, let r be is a prefix of w with lps(r) long enough. Then, if the length of lps(ra) is smaller than |lps(r)|, where a is the letter after r in w, it will call p.is_palindrome() on each suffix p (starting with the greatest) of lps(r)a. Just to compute this entry of the list, it could take a time up to (|lps(r)|)^2.",
    "created_at": "2015-02-01T18:42:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-284007",
    "user": "https://github.com/nadialafreniere"
}
```

<a id='comment:17'></a>I think I've given an answer to almost all the comments in the list above.

However, for number 11., I haven't found a better way to do it. The idea is to avoid to count outside of the string. For example, I don't want to test if w[-1]==w[n] for a word w, since I don't want the palindromes in the circular word. Any suggestion would be very welcome!

For number 15., the reason I pretend the new algorithm is faster is that the list of the lengths of longest palindromic suffixes is computed in linear time for any type of words. With the actual version of the SAGE library, for words having large palindromes, it can be much more than that. For example, let r be is a prefix of w with lps(r) long enough. Then, if the length of lps(ra) is smaller than |lps(r)|, where a is the letter after r in w, it will call p.is_palindrome() on each suffix p (starting with the greatest) of lps(r)a. Just to compute this entry of the list, it could take a time up to (|lps(r)|)^2.



---

archive/issue_comments_284008.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-02-01T18:44:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-284008",
    "user": "https://github.com/nadialafreniere"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_284009.json:
```json
{
    "body": "<a id='comment:19'></a>The ticket does not apply on a recent Sage version.\n\nAlso, the branch contains unrelated modifs...",
    "created_at": "2015-03-26T18:15:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-284009",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:19'></a>The ticket does not apply on a recent Sage version.

Also, the branch contains unrelated modifs...



---

archive/issue_comments_284010.json:
```json
{
    "body": "<a id='comment:20'></a>...you can keep the same ticket instead of creating #18060. Just update the branch of this ticket.",
    "created_at": "2015-03-26T18:19:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-284010",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:20'></a>...you can keep the same ticket instead of creating #18060. Just update the branch of this ticket.



---

archive/issue_comments_284011.json:
```json
{
    "body": "<a id='comment:21'></a>Replying to [comment:20 slabbe]:\n> ...you can keep the same ticket instead of creating #18060. Just update the branch of this ticket.\n\n\ncould we just close #18060?",
    "created_at": "2015-03-26T18:30:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-284011",
    "user": "https://github.com/videlec"
}
```

<a id='comment:21'></a>Replying to [comment:20 slabbe]:
> ...you can keep the same ticket instead of creating #18060. Just update the branch of this ticket.


could we just close #18060?



---

archive/issue_comments_284012.json:
```json
{
    "body": "Changing branch from \"u/nadialafreniere/16935\" to \"u/nadialafreniere/palindromes__list_of_lps_lengths_and_list_of_maximal_palindromes_length\"",
    "created_at": "2015-03-27T06:43:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-284012",
    "user": "https://github.com/nadialafreniere"
}
```

Changing branch from "u/nadialafreniere/16935" to "u/nadialafreniere/palindromes__list_of_lps_lengths_and_list_of_maximal_palindromes_length"



---

archive/issue_comments_284013.json:
```json
{
    "body": "Changing commit from \"05cbe2844498c4c1f3d325e4ac27e637188b8e71\" to \"\"",
    "created_at": "2015-03-27T06:43:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-284013",
    "user": "https://github.com/nadialafreniere"
}
```

Changing commit from "05cbe2844498c4c1f3d325e4ac27e637188b8e71" to ""



---

archive/issue_comments_284014.json:
```json
{
    "body": "<a id='comment:22'></a>Replying to [comment:20 slabbe]:\n> ...you can keep the same ticket instead of creating #18060. Just update the branch of this ticket.\n\n\nThat was my first idea, but I probably understood you wrong. I thought you told me to avoid it...\nI really need to learn how to use trac in a proper way!",
    "created_at": "2015-03-27T06:43:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-284014",
    "user": "https://github.com/nadialafreniere"
}
```

<a id='comment:22'></a>Replying to [comment:20 slabbe]:
> ...you can keep the same ticket instead of creating #18060. Just update the branch of this ticket.


That was my first idea, but I probably understood you wrong. I thought you told me to avoid it...
I really need to learn how to use trac in a proper way!



---

archive/issue_comments_284015.json:
```json
{
    "body": "Changing commit from \"\" to \"160ccb0ccfb7580fe5d497b3b049fbf2b3c25523\"",
    "created_at": "2015-03-27T06:47:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-284015",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "" to "160ccb0ccfb7580fe5d497b3b049fbf2b3c25523"



---

archive/issue_comments_284016.json:
```json
{
    "body": "<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-27T06:47:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-284016",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_284017.json:
```json
{
    "body": "<a id='comment:24'></a>Replying to [comment:21 vdelecroix]:\n> Replying to [comment:20 slabbe]:\n> > ...you can keep the same ticket instead of creating #18060. Just update the branch of this ticket.\n\n> \n> could we just close #18060?\n\n\nI don't know how to do it, but it would be a good idea. I added my branch to this ticket.",
    "created_at": "2015-03-27T06:49:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-284017",
    "user": "https://github.com/nadialafreniere"
}
```

<a id='comment:24'></a>Replying to [comment:21 vdelecroix]:
> Replying to [comment:20 slabbe]:
> > ...you can keep the same ticket instead of creating #18060. Just update the branch of this ticket.

> 
> could we just close #18060?


I don't know how to do it, but it would be a good idea. I added my branch to this ticket.



---

archive/issue_comments_284018.json:
```json
{
    "body": "<a id='comment:25'></a>> I really need to learn how to use trac in a proper way!\n\n\nIt is simpler to learn if you are beside us, but your learning will be more persistent if you learn it on your side with our help from internet.\n\nJust don't stop to do what is natural for you to do. If you think you need to create a new ticket, do it:) We will tell you if there is something wrong and that is how you will learn.",
    "created_at": "2015-03-27T11:04:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-284018",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:25'></a>> I really need to learn how to use trac in a proper way!


It is simpler to learn if you are beside us, but your learning will be more persistent if you learn it on your side with our help from internet.

Just don't stop to do what is natural for you to do. If you think you need to create a new ticket, do it:) We will tell you if there is something wrong and that is how you will learn.



---

archive/issue_comments_284019.json:
```json
{
    "body": "Replying to [ticket:16935 nadialafreniere]:\n> You can see here that the algorithm is factor, especially for long words.\n\n\nIndeed, I can see that it is currently twice as fast:\n\n```\nsage: w = words.ThueMorseWord()[:1000]\nsage: %time P = w.palindromic_lacunas_study()[2]\nCPU times: user 903 ms, sys: 11.4 ms, total: 914 ms\nWall time: 895 ms\nsage: %time Q = w.palindromes()\nCPU times: user 516 ms, sys: 34.9 ms, total: 551 ms\nWall time: 472 ms\nsage: P == Q\nTrue\n\nsage: w = words.ThueMorseWord()[:10000]\nsage: %time P = w.palindromic_lacunas_study()[2]\nCPU times: user 40.5 s, sys: 200 ms, total: 40.7 s\nWall time: 40.6 s\nsage: %time Q = w.palindromes()\nCPU times: user 26 s, sys: 256 ms, total: 26.3 s\nWall time: 26.2 s\nsage: P == Q\nTrue\n```\n\n> I did not find any way to fix it, except to change the alphabet when generating these words.\n\n\nI am not sure I understand the problem. But, if `w` is a word of length 1 in sage, then `w[0]` will give the the letter it contains. Using this, you can compare the equality of letters after the application of the function `f`.\n\nI am very happy with the way the code is now separated. Most of the methods are written clearly. I am still not convinced by the  optimality and clarity of the `length_maximal_palindrome` method. I started a new branch where I changed the way the indices are worked out. [My branch is here](http://git.sagemath.org/sage.git/commit/?h=u/slabbe/16935&id=ef438b50865857394a404adf56b3c6218997419a). Tell me what you think.\n\nI added a raise Value Error when the parity of m is the same as the parity of 2j which is an impossible case. I was surprise to realize that it breaks the other methods:\n\n```\nsage: Word('01101001').lengths_maximal_palindromes() \n...\nValueError: j-(m+1)/2(=5/2) must be an integer, i.e., 2*j(=6) and m(=0) can't have the same parity\n```\n\nThis means that the impossible case is in fact used. Do you understand why?\n\nFinally, I think the palindrome method can now be written as a one liner using a list comprehension...",
    "created_at": "2015-04-07T15:59:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-284019",
    "user": "https://github.com/seblabbe"
}
```

Replying to [ticket:16935 nadialafreniere]:
> You can see here that the algorithm is factor, especially for long words.


Indeed, I can see that it is currently twice as fast:

```
sage: w = words.ThueMorseWord()[:1000]
sage: %time P = w.palindromic_lacunas_study()[2]
CPU times: user 903 ms, sys: 11.4 ms, total: 914 ms
Wall time: 895 ms
sage: %time Q = w.palindromes()
CPU times: user 516 ms, sys: 34.9 ms, total: 551 ms
Wall time: 472 ms
sage: P == Q
True

sage: w = words.ThueMorseWord()[:10000]
sage: %time P = w.palindromic_lacunas_study()[2]
CPU times: user 40.5 s, sys: 200 ms, total: 40.7 s
Wall time: 40.6 s
sage: %time Q = w.palindromes()
CPU times: user 26 s, sys: 256 ms, total: 26.3 s
Wall time: 26.2 s
sage: P == Q
True
```

> I did not find any way to fix it, except to change the alphabet when generating these words.


I am not sure I understand the problem. But, if `w` is a word of length 1 in sage, then `w[0]` will give the the letter it contains. Using this, you can compare the equality of letters after the application of the function `f`.

I am very happy with the way the code is now separated. Most of the methods are written clearly. I am still not convinced by the  optimality and clarity of the `length_maximal_palindrome` method. I started a new branch where I changed the way the indices are worked out. [My branch is here](http://git.sagemath.org/sage.git/commit/?h=u/slabbe/16935&id=ef438b50865857394a404adf56b3c6218997419a). Tell me what you think.

I added a raise Value Error when the parity of m is the same as the parity of 2j which is an impossible case. I was surprise to realize that it breaks the other methods:

```
sage: Word('01101001').lengths_maximal_palindromes() 
...
ValueError: j-(m+1)/2(=5/2) must be an integer, i.e., 2*j(=6) and m(=0) can't have the same parity
```

This means that the impossible case is in fact used. Do you understand why?

Finally, I think the palindrome method can now be written as a one liner using a list comprehension...



---

archive/issue_comments_284020.json:
```json
{
    "body": "<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-08T19:11:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-284020",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_284021.json:
```json
{
    "body": "Changing commit from \"160ccb0ccfb7580fe5d497b3b049fbf2b3c25523\" to \"d535b5f2f292d83d1dc952023dffe5506dd8f7f9\"",
    "created_at": "2015-04-08T19:11:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-284021",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "160ccb0ccfb7580fe5d497b3b049fbf2b3c25523" to "d535b5f2f292d83d1dc952023dffe5506dd8f7f9"



---

archive/issue_comments_284022.json:
```json
{
    "body": "<a id='comment:29'></a>Replying to [comment:27 slabbe]:\n\nI prefer the way you present the length_maximal_palindrome. I think it is clearer. I integrated it to the code.\n\n> I added a raise Value Error when the parity of m is the same as the parity of 2j which is an impossible case. I was surprise to realize that it breaks the other methods: [...]\n> This means that the impossible case is in fact used. Do you understand why?\n\n\nI don't know why, but I used a very complicated way to assing a value for `m` in the second case of `lengths_maximal_palindromes`. I changed it so it is easier to see what it does, and it does not use the impossible case.\n\n> Finally, I think the palindrome method can now be written as a one liner using a list comprehension...\n\nI changed it. Tell me what you think.",
    "created_at": "2015-04-08T19:20:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-284022",
    "user": "https://github.com/nadialafreniere"
}
```

<a id='comment:29'></a>Replying to [comment:27 slabbe]:

I prefer the way you present the length_maximal_palindrome. I think it is clearer. I integrated it to the code.

> I added a raise Value Error when the parity of m is the same as the parity of 2j which is an impossible case. I was surprise to realize that it breaks the other methods: [...]
> This means that the impossible case is in fact used. Do you understand why?


I don't know why, but I used a very complicated way to assing a value for `m` in the second case of `lengths_maximal_palindromes`. I changed it so it is easier to see what it does, and it does not use the impossible case.

> Finally, I think the palindrome method can now be written as a one liner using a list comprehension...

I changed it. Tell me what you think.



---

archive/issue_comments_284023.json:
```json
{
    "body": "<a id='comment:30'></a>Great. I think we are almost done now. I just looked at the code. Here are some more fixes to do. Tomorrow (or the day after) after you do the below changes, I will review everything again (doctests, documentation building fine, etc).\n\n1. The call to Integer is not necessary in the first method (sorry my bad):\n\n```diff\n-   return Integer(jj - 2*i - 1)\n+  return jj - 2*i - 1\n```\n\n2. (bis) There should be an empty line after OUTPUT. The reason is that without the empty line, the documentation will not build correctly. You may try to check how it looks on a method of an object by doing this (I do not known if this still works) :\n\n```\nsage: m = matrix(2, range(4))\nsage: browse_sage_doc(m.inverse)\n```\n\n3. spaces:\n\n```diff\n-                if LPC[k]+k-j != LPC[2*k - j]:\n+                if LPC[k] + k - j != LPC[2*k - j]:\n```\n\n4. remove empty lines:\n\n```diff\n-\n-        k = 0\n-\n+        k = 0\n```\n\n5. The creation of the list is not necessary:\n\n```diff\n-        return set([self[i-LPS[i] : i] for i in range(len(self)+1)])\n+        return set(self[i-LPS[i] : i] for i in range(len(self)+1))\n```",
    "created_at": "2015-04-08T20:11:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-284023",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:30'></a>Great. I think we are almost done now. I just looked at the code. Here are some more fixes to do. Tomorrow (or the day after) after you do the below changes, I will review everything again (doctests, documentation building fine, etc).

1. The call to Integer is not necessary in the first method (sorry my bad):

```diff
-   return Integer(jj - 2*i - 1)
+  return jj - 2*i - 1
```

2. (bis) There should be an empty line after OUTPUT. The reason is that without the empty line, the documentation will not build correctly. You may try to check how it looks on a method of an object by doing this (I do not known if this still works) :

```
sage: m = matrix(2, range(4))
sage: browse_sage_doc(m.inverse)
```

3. spaces:

```diff
-                if LPC[k]+k-j != LPC[2*k - j]:
+                if LPC[k] + k - j != LPC[2*k - j]:
```

4. remove empty lines:

```diff
-
-        k = 0
-
+        k = 0
```

5. The creation of the list is not necessary:

```diff
-        return set([self[i-LPS[i] : i] for i in range(len(self)+1)])
+        return set(self[i-LPS[i] : i] for i in range(len(self)+1))
```



---

archive/issue_comments_284024.json:
```json
{
    "body": "<a id='comment:31'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-09T17:48:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-284024",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:31'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_284025.json:
```json
{
    "body": "Changing commit from \"d535b5f2f292d83d1dc952023dffe5506dd8f7f9\" to \"f4cf2f7fa9af3bea0b71583f946851cf4c041582\"",
    "created_at": "2015-04-09T17:48:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-284025",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "d535b5f2f292d83d1dc952023dffe5506dd8f7f9" to "f4cf2f7fa9af3bea0b71583f946851cf4c041582"



---

archive/issue_comments_284026.json:
```json
{
    "body": "<a id='comment:32'></a>Excellent. Since we are dealing with possible float in entry (like 2.5) and since `w[i]` needs `i` to be an integer, I think that we have to keep the following two lines (do the doctests pass for you without them?) :\n\n```\n jj = Integer(jj)\n```\n\n```\n i = Integer(i)\n```\n\nI wanted to remove only the last call to Integer because that one was not necessary.",
    "created_at": "2015-04-09T18:40:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-284026",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:32'></a>Excellent. Since we are dealing with possible float in entry (like 2.5) and since `w[i]` needs `i` to be an integer, I think that we have to keep the following two lines (do the doctests pass for you without them?) :

```
 jj = Integer(jj)
```

```
 i = Integer(i)
```

I wanted to remove only the last call to Integer because that one was not necessary.



---

archive/issue_comments_284027.json:
```json
{
    "body": "<a id='comment:33'></a>The doctests passed without them, but I can put them back just in case it is necessary.",
    "created_at": "2015-04-09T18:45:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-284027",
    "user": "https://github.com/nadialafreniere"
}
```

<a id='comment:33'></a>The doctests passed without them, but I can put them back just in case it is necessary.



---

archive/issue_comments_284028.json:
```json
{
    "body": "Changing commit from \"f4cf2f7fa9af3bea0b71583f946851cf4c041582\" to \"d0ee49ef26ff6277c5ed847e3b03a4c95dd857d6\"",
    "created_at": "2015-04-09T19:04:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-284028",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "f4cf2f7fa9af3bea0b71583f946851cf4c041582" to "d0ee49ef26ff6277c5ed847e3b03a4c95dd857d6"



---

archive/issue_comments_284029.json:
```json
{
    "body": "<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-09T19:04:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-284029",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_284030.json:
```json
{
    "body": "<a id='comment:35'></a>The user does not know what is `jj` : this is an internal variable. It is better to use `2*j` for the message error given to the user.\n\nLast small fix for the doc of `lps_lengths` (remove one space in the second line). Lines must align properly for the doc to render correctly (see the file `SAGE_ROOT/src/doc/output/html/en/reference/combinat/sage/combinat/words/finite_word.html` after you run `sage -b && sage -docbuild reference html`)\n\n```diff\n-        - ``f`` - involution (default: None) on the alphabet of self. It must\n-           be callable on letters as well as words (e.g. WordMorphism).\n+        - ``f`` - involution (default: None) on the alphabet of self. It must\n+          be callable on letters as well as words (e.g. WordMorphism).\n```",
    "created_at": "2015-04-09T19:36:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-284030",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:35'></a>The user does not know what is `jj` : this is an internal variable. It is better to use `2*j` for the message error given to the user.

Last small fix for the doc of `lps_lengths` (remove one space in the second line). Lines must align properly for the doc to render correctly (see the file `SAGE_ROOT/src/doc/output/html/en/reference/combinat/sage/combinat/words/finite_word.html` after you run `sage -b && sage -docbuild reference html`)

```diff
-        - ``f`` - involution (default: None) on the alphabet of self. It must
-           be callable on letters as well as words (e.g. WordMorphism).
+        - ``f`` - involution (default: None) on the alphabet of self. It must
+          be callable on letters as well as words (e.g. WordMorphism).
```



---

archive/issue_comments_284031.json:
```json
{
    "body": "<a id='comment:36'></a>Replying to [comment:33 nadialafreniere]:\n> The doctests passed without them, but I can put them back just in case it is necessary.\n\n\nThat is strange because they did not pass for me... Anyway, now, it works.",
    "created_at": "2015-04-09T19:39:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-284031",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:36'></a>Replying to [comment:33 nadialafreniere]:
> The doctests passed without them, but I can put them back just in case it is necessary.


That is strange because they did not pass for me... Anyway, now, it works.



---

archive/issue_comments_284032.json:
```json
{
    "body": "Changing commit from \"d0ee49ef26ff6277c5ed847e3b03a4c95dd857d6\" to \"fcdd2f830906015ddf3c1623bd7a29dde8e1e58e\"",
    "created_at": "2015-04-09T19:55:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-284032",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "d0ee49ef26ff6277c5ed847e3b03a4c95dd857d6" to "fcdd2f830906015ddf3c1623bd7a29dde8e1e58e"



---

archive/issue_comments_284033.json:
```json
{
    "body": "<a id='comment:37'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-09T19:55:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-284033",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:37'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_284034.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-04-09T20:12:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-284034",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_284035.json:
```json
{
    "body": "<a id='comment:38'></a>Code looks good. Doctests pass. Documentation builds fine. F\u00e9licitations pour ton premier ticket Nadia! Vivement d'autres!",
    "created_at": "2015-04-09T20:12:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-284035",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:38'></a>Code looks good. Doctests pass. Documentation builds fine. Félicitations pour ton premier ticket Nadia! Vivement d'autres!



---

archive/issue_comments_284036.json:
```json
{
    "body": "Changing reviewer from \"\" to \"S\u00e9bastien Labb\u00e9\"",
    "created_at": "2015-04-09T20:12:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-284036",
    "user": "https://github.com/seblabbe"
}
```

Changing reviewer from "" to "Sébastien Labbé"



---

archive/issue_comments_284037.json:
```json
{
    "body": "Changing branch from \"u/nadialafreniere/palindromes__list_of_lps_lengths_and_list_of_maximal_palindromes_length\" to \"fcdd2f830906015ddf3c1623bd7a29dde8e1e58e\"",
    "created_at": "2015-04-14T19:44:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-284037",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/nadialafreniere/palindromes__list_of_lps_lengths_and_list_of_maximal_palindromes_length" to "fcdd2f830906015ddf3c1623bd7a29dde8e1e58e"



---

archive/issue_comments_284038.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-04-14T19:44:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16935#issuecomment-284038",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_049420.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-14T19:44:09Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16935",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16935#event-49420"
}
```
