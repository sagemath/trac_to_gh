# Issue 16618: The optimization Category_over_base._subcategory_hook_ really belongs to Category_over_base_ring

archive/issues_016381.json:
```json
{
    "body": "```\n           sage: from sage.categories.category_types import Category_over_base\n           sage: D = Modules(Rings())\n           sage: class Cs(Category_over_base):\n           ....:    def super_categories(self):\n           ....:        return [D]\n           sage: C = Cs(SymmetricGroup(3))\n           sage: C.is_subcategory(D)         # OOPS\n           False\n```\n\nThis is due to:\n\n```\n           sage: D._subcategory_hook_(C)\n           False\n```\n\nMy analysis is that the optimization implemented in\n`Category_over_base._subcategory_hook_` (if the base is not the same,\nthen they can't be comparable) is only actually valid for\n`Category_over_base_ring`s. So I moved `_subcategory_hook_` down\nthere. This allows for improving the answer in one corner case that\nwas pinpointed in the doctests.\n\nDoes this sound reasonable? Are there `Category_over_base` for which\nwe care about such an optimization that are not\n`Category_over_base_ring`?\n\nFor the record: this issue was detected while trying with Darij to use\ncategories over a base ring category in symmetric functions, while the\nhomset ticket #10668 was applied; this triggered a recursion loop in:\n\n```\n            sage: Sym = SymmetricFunctions(FractionField(QQ['q','t']))\n            sage: P = Sym.macdonald().P()\n            sage: m = Sym.monomial()\n            sage: P.transition_matrix(m,2)\n```\n\n\nCC:  @darijgr simonking\n\nBranch/Commit: 93bc33415b008612e6d4eac6d42747e2f0063835\n\nReviewer: Simon King, Travis Scrimshaw\n\nAuthor: Nicolas M. Thi\u00e9ry\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/16618\n\n",
    "closed_at": "2018-03-04T23:29:14Z",
    "created_at": "2014-07-04T21:42:32Z",
    "labels": [
        "component: categories",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "The optimization Category_over_base._subcategory_hook_ really belongs to Category_over_base_ring",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16618",
    "user": "https://github.com/nthiery"
}
```
```
           sage: from sage.categories.category_types import Category_over_base
           sage: D = Modules(Rings())
           sage: class Cs(Category_over_base):
           ....:    def super_categories(self):
           ....:        return [D]
           sage: C = Cs(SymmetricGroup(3))
           sage: C.is_subcategory(D)         # OOPS
           False
```

This is due to:

```
           sage: D._subcategory_hook_(C)
           False
```

My analysis is that the optimization implemented in
`Category_over_base._subcategory_hook_` (if the base is not the same,
then they can't be comparable) is only actually valid for
`Category_over_base_ring`s. So I moved `_subcategory_hook_` down
there. This allows for improving the answer in one corner case that
was pinpointed in the doctests.

Does this sound reasonable? Are there `Category_over_base` for which
we care about such an optimization that are not
`Category_over_base_ring`?

For the record: this issue was detected while trying with Darij to use
categories over a base ring category in symmetric functions, while the
homset ticket #10668 was applied; this triggered a recursion loop in:

```
            sage: Sym = SymmetricFunctions(FractionField(QQ['q','t']))
            sage: P = Sym.macdonald().P()
            sage: m = Sym.monomial()
            sage: P.transition_matrix(m,2)
```


CC:  @darijgr simonking

Branch/Commit: 93bc33415b008612e6d4eac6d42747e2f0063835

Reviewer: Simon King, Travis Scrimshaw

Author: Nicolas M. Thi√©ry

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/16618





---

archive/issue_comments_214789.json:
```json
{
    "body": "<a id='comment:1'></a>I'll try to push later tonight ...",
    "created_at": "2014-07-04T21:42:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16618#issuecomment-214789",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:1'></a>I'll try to push later tonight ...



---

archive/issue_comments_214790.json:
```json
{
    "body": "<a id='comment:3'></a>Btw: `git diff` is doing a confusing job here: the only thing that I actually changed is the `_subcategory_hook_` method and its location.",
    "created_at": "2014-07-04T22:16:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16618#issuecomment-214790",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:3'></a>Btw: `git diff` is doing a confusing job here: the only thing that I actually changed is the `_subcategory_hook_` method and its location.



---

archive/issue_comments_214791.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-07-04T22:16:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16618#issuecomment-214791",
    "user": "https://github.com/nthiery"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_214792.json:
```json
{
    "body": "<a id='comment:4'></a>Why did you delete the branch field?",
    "created_at": "2014-07-05T08:16:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16618#issuecomment-214792",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:4'></a>Why did you delete the branch field?



---

archive/issue_comments_214793.json:
```json
{
    "body": "<a id='comment:5'></a>PS: How does one download a branch \"the hard way\" (i.e., how do I access your branch ` u/nthiery/the_optimization_category_over_base__subcategory_hook__really_belongs_to_category_over_base_ring` if it is not accessible by `git trac 16618`)?",
    "created_at": "2014-07-05T08:18:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16618#issuecomment-214793",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:5'></a>PS: How does one download a branch "the hard way" (i.e., how do I access your branch ` u/nthiery/the_optimization_category_over_base__subcategory_hook__really_belongs_to_category_over_base_ring` if it is not accessible by `git trac 16618`)?



---

archive/issue_comments_214794.json:
```json
{
    "body": "<a id='comment:6'></a>\n```\ngit fetch trac u/nthiery/the_optimization_category_over_base__subcategory_hook__really_belongs_to_category_over_base_ring:the_new_branch\ngit checkout the_new_branch\n```",
    "created_at": "2014-07-05T17:48:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16618#issuecomment-214794",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:6'></a>
```
git fetch trac u/nthiery/the_optimization_category_over_base__subcategory_hook__really_belongs_to_category_over_base_ring:the_new_branch
git checkout the_new_branch
```



---

archive/issue_comments_214795.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-07-06T21:24:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16618#issuecomment-214795",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_214796.json:
```json
{
    "body": "<a id='comment:9'></a>Argh. I just finished building the `u/nthiery/the_optimization_category_over_base__subcategory_hook__really_belongs_to_category_over_base_ring` branch. Well, I'll switch to the new \"official\" branch now.",
    "created_at": "2014-07-06T21:42:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16618#issuecomment-214796",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:9'></a>Argh. I just finished building the `u/nthiery/the_optimization_category_over_base__subcategory_hook__really_belongs_to_category_over_base_ring` branch. Well, I'll switch to the new "official" branch now.



---

archive/issue_comments_214797.json:
```json
{
    "body": "<a id='comment:10'></a>Hi Simon!\n\nSorry for the mess; I was travelling with an intermitent connection. E.g. the branch field deletion was an accident when merging a manual change in the ticket and a push ...\n\nCheers,\n                                  Nicolas",
    "created_at": "2014-07-09T14:41:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16618#issuecomment-214797",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:10'></a>Hi Simon!

Sorry for the mess; I was travelling with an intermitent connection. E.g. the branch field deletion was an accident when merging a manual change in the ticket and a push ...

Cheers,
                                  Nicolas



---

archive/issue_comments_214798.json:
```json
{
    "body": "<a id='comment:11'></a>For the record: if I read my logs properly, all long tests passed.",
    "created_at": "2014-07-11T08:59:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16618#issuecomment-214798",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:11'></a>For the record: if I read my logs properly, all long tests passed.



---

archive/issue_events_048742.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16618",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16618#event-48742"
}
```



---

archive/issue_comments_214799.json:
```json
{
    "body": "<a id='comment:13'></a>Ping",
    "created_at": "2014-09-03T12:49:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16618#issuecomment-214799",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:13'></a>Ping



---

archive/issue_comments_214800.json:
```json
{
    "body": "<a id='comment:14'></a>Sorry for not reacting 11 months ago.\n\nSome comments:\n- Some methods (`construction(self)`, `_homset(self, X, Y)`, `is_abelian(self)`) need documentation/tests.\n- There is :trac:`???`. Should be :trac:`16618`.",
    "created_at": "2015-07-23T14:17:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16618#issuecomment-214800",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:14'></a>Sorry for not reacting 11 months ago.

Some comments:
- Some methods (`construction(self)`, `_homset(self, X, Y)`, `is_abelian(self)`) need documentation/tests.
- There is :trac:`???`. Should be :trac:`16618`.



---

archive/issue_comments_214801.json:
```json
{
    "body": "<a id='comment:15'></a>I fixed the above comments (and while I was at it, I gave the file full coverage). \n\n---\nNew commits:",
    "created_at": "2015-10-12T16:02:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16618#issuecomment-214801",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:15'></a>I fixed the above comments (and while I was at it, I gave the file full coverage). 

---
New commits:



---

archive/issue_events_048743.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2015-10-12T16:02:21Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16618",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16618#event-48743"
}
```



---

archive/issue_events_048744.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2015-10-12T16:02:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16618",
    "milestone": "sage-6.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16618#event-48744"
}
```



---

archive/issue_comments_214802.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-30T01:23:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16618#issuecomment-214802",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_214803.json:
```json
{
    "body": "<a id='comment:17'></a>Message to self: Review it!",
    "created_at": "2017-01-09T12:43:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16618#issuecomment-214803",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:17'></a>Message to self: Review it!



---

archive/issue_comments_214804.json:
```json
{
    "body": "<a id='comment:18'></a>ping",
    "created_at": "2017-05-21T01:56:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16618#issuecomment-214804",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:18'></a>ping



---

archive/issue_events_048745.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-05-21T01:56:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16618",
    "milestone": "sage-6.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16618#event-48745"
}
```



---

archive/issue_events_048746.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-05-21T01:56:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16618",
    "milestone": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16618#event-48746"
}
```



---

archive/issue_comments_214805.json:
```json
{
    "body": "<a id='comment:19'></a>**ping**",
    "created_at": "2017-10-26T00:23:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16618#issuecomment-214805",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:19'></a>**ping**



---

archive/issue_events_048747.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-02-03T19:34:27Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16618",
    "milestone": "sage-8.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16618#event-48747"
}
```



---

archive/issue_events_048748.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-02-03T19:34:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16618",
    "milestone": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16618#event-48748"
}
```



---

archive/issue_comments_214806.json:
```json
{
    "body": "<a id='comment:20'></a>I had forgotten about this. Pinging again.",
    "created_at": "2018-02-03T19:34:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16618#issuecomment-214806",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:20'></a>I had forgotten about this. Pinging again.



---

archive/issue_comments_214807.json:
```json
{
    "body": "<a id='comment:21'></a>According to the patchbots, it does pass all tests on 8.2.beta6, but fails to build with 8.2.beta7. However, it seems from the patchbot's log that the errors are unrelated with the sage library (the errors occur before building the sage library).\n\nI am thus believe it can be given a positive review.",
    "created_at": "2018-03-03T09:35:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16618#issuecomment-214807",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:21'></a>According to the patchbots, it does pass all tests on 8.2.beta6, but fails to build with 8.2.beta7. However, it seems from the patchbot's log that the errors are unrelated with the sage library (the errors occur before building the sage library).

I am thus believe it can be given a positive review.



---

archive/issue_comments_214808.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-03-03T09:35:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16618#issuecomment-214808",
    "user": "https://github.com/simon-king-jena"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_048749.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-03-04T23:29:14Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16618",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16618#event-48749"
}
```



---

archive/issue_comments_214809.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-03-04T23:29:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16618#issuecomment-214809",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
