# Issue 16424: is_triangular_number() cleanup

archive/issues_016187.json:
```json
{
    "assignees": [],
    "body": "The name implies a boolean return value (contrary to the implementation), and used that way the function is way too slow:\n\n```\nsage: timeit('l=[n for n in range(1000) if is_square(8*(n)+1)]')\n625 loops, best of 3: 909 \u00b5s per loop\nsage: timeit('l=[n for n in range(1000) if is_triangular_number(n)]')\n5 loops, best of 3: 200 ms per loop\nsage: timeit('l=[n for n in range(1000) if is_square(8*(n)+1)]')\n625 loops, best of 3: 903 \u00b5s per loop\nsage: timeit('l=[n for n in range(1000) if is_triangular_number(n)]')\n5 loops, best of 3: 195 ms per loop\n```\nThe reason is that the simple boolean test used above is not performed before the more involved computation of the index.\n\nBranch/Commit: **[`5894592`](https://github.com/sagemath/sagetrac-mirror/commit/5894592f6d380138198c4100fa0d55d7e75f3eb2)**\n\nReviewer: **Ralf Stephan**\n\nAuthor: **Vincent Delecroix**\n\nComponent: **quadratic forms**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/16424_\n\n",
    "closed_at": "2014-06-18T14:11:18Z",
    "created_at": "2014-06-02T07:13:14Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20quadratic%20forms",
        "https://github.com/sagemath/sage/labels/p%3A%204%20%E2%80%93%20minor",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "is_triangular_number() cleanup",
    "type": "issue",
    "updated_at": "2014-06-18T14:11:18Z",
    "url": "https://github.com/sagemath/sage/issues/16424",
    "user": "https://github.com/rwst"
}
```
The name implies a boolean return value (contrary to the implementation), and used that way the function is way too slow:

```
sage: timeit('l=[n for n in range(1000) if is_square(8*(n)+1)]')
625 loops, best of 3: 909 µs per loop
sage: timeit('l=[n for n in range(1000) if is_triangular_number(n)]')
5 loops, best of 3: 200 ms per loop
sage: timeit('l=[n for n in range(1000) if is_square(8*(n)+1)]')
625 loops, best of 3: 903 µs per loop
sage: timeit('l=[n for n in range(1000) if is_triangular_number(n)]')
5 loops, best of 3: 195 ms per loop
```
The reason is that the simple boolean test used above is not performed before the more involved computation of the index.

Branch/Commit: **[`5894592`](https://github.com/sagemath/sagetrac-mirror/commit/5894592f6d380138198c4100fa0d55d7e75f3eb2)**

Reviewer: **Ralf Stephan**

Author: **Vincent Delecroix**

Component: **quadratic forms**

_Issue created by migration from https://trac.sagemath.org/ticket/16424_





---

archive/issue_events_234593.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-06-02T07:13:14Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16424",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16424#event-234593"
}
```



---

archive/issue_events_234594.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-06-02T07:13:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16424",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20quadratic%20forms",
    "label_color": "0000ff",
    "label_name": "c: quadratic forms",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16424#event-234594"
}
```



---

archive/issue_events_234595.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-06-02T07:13:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16424",
    "label": "https://github.com/sagemath/sage/labels/p%3A%204%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p: 4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16424#event-234595"
}
```



---

archive/issue_events_234596.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-06-02T07:13:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16424",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16424#event-234596"
}
```



---

archive/issue_comments_212116.json:
```json
{
    "body": "Branch: **[u/rws/is_triangular_number___speed_up](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/is_triangular_number___speed_up)**",
    "created_at": "2014-06-02T07:20:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16424#issuecomment-212116",
    "user": "https://github.com/rwst"
}
```

Branch: **[u/rws/is_triangular_number___speed_up](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/is_triangular_number___speed_up)**



---

archive/issue_comments_212117.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nNow it's only 10x slower:\n\n```\nsage: timeit('l=[n for n in range(1000) if is_triangular_number(n)]')\n25 loops, best of 3: 10.6 ms per loop\nsage: timeit('l=[n for n in range(1000) if is_triangular_number(n)]')\n25 loops, best of 3: 10.1 ms per loop\n```\nbut that is because the function does more than it should, judging from the name.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/de05b593cb8497493ce92e742a7379bdc8bf8489\"><code>de05b59</code></a></td><td><code>16424: test first if we have a triangular number at all</code></td></tr></table>\n",
    "created_at": "2014-06-02T07:23:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16424#issuecomment-212117",
    "user": "https://github.com/rwst"
}
```

<div id="comment:2" align="right">comment:2</div>

Now it's only 10x slower:

```
sage: timeit('l=[n for n in range(1000) if is_triangular_number(n)]')
25 loops, best of 3: 10.6 ms per loop
sage: timeit('l=[n for n in range(1000) if is_triangular_number(n)]')
25 loops, best of 3: 10.1 ms per loop
```
but that is because the function does more than it should, judging from the name.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/de05b593cb8497493ce92e742a7379bdc8bf8489"><code>de05b59</code></a></td><td><code>16424: test first if we have a triangular number at all</code></td></tr></table>




---

archive/issue_events_234597.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-06-02T07:23:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16424",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16424#event-234597"
}
```



---

archive/issue_comments_212118.json:
```json
{
    "body": "Author: **Ralf Stephan**",
    "created_at": "2014-06-02T07:23:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16424#issuecomment-212118",
    "user": "https://github.com/rwst"
}
```

Author: **Ralf Stephan**



---

archive/issue_comments_212119.json:
```json
{
    "body": "Commit: **[`de05b59`](https://github.com/sagemath/sagetrac-mirror/commit/de05b593cb8497493ce92e742a7379bdc8bf8489)**",
    "created_at": "2014-06-02T07:23:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16424#issuecomment-212119",
    "user": "https://github.com/rwst"
}
```

Commit: **[`de05b59`](https://github.com/sagemath/sagetrac-mirror/commit/de05b593cb8497493ce92e742a7379bdc8bf8489)**



---

archive/issue_comments_212120.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nHi Ralf,\n\nsee my branch at public/16424\n\nI rewrote the function as it can be done in a much cleaner/faster way. Moreover, a function called `is_X` must return a boolean. It makes no sense to have it return boolean or integer values. I decided to add an extra argument `return_value` that does the job. I also rewrite the doc which was very ugly.\n\nTell me what you think...\n\nAnyway, I am not sure it is worth it to have a function which is just equivalent to\n\n```\nis_triangular = lambda n: (8*n+1).is_square()\n```\n\nVincent",
    "created_at": "2014-06-15T17:03:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16424#issuecomment-212120",
    "user": "https://github.com/videlec"
}
```

<div id="comment:3" align="right">comment:3</div>

Hi Ralf,

see my branch at public/16424

I rewrote the function as it can be done in a much cleaner/faster way. Moreover, a function called `is_X` must return a boolean. It makes no sense to have it return boolean or integer values. I decided to add an extra argument `return_value` that does the job. I also rewrite the doc which was very ugly.

Tell me what you think...

Anyway, I am not sure it is worth it to have a function which is just equivalent to

```
is_triangular = lambda n: (8*n+1).is_square()
```

Vincent



---

archive/issue_events_234598.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2014-06-15T17:03:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16424",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16424#event-234598"
}
```



---

archive/issue_events_234599.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2014-06-15T17:03:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16424",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16424#event-234599"
}
```



---

archive/issue_comments_212121.json:
```json
{
    "body": "Reviewer: **Ralf Stephan**",
    "created_at": "2014-06-16T06:13:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16424#issuecomment-212121",
    "user": "https://github.com/rwst"
}
```

Reviewer: **Ralf Stephan**



---

archive/issue_comments_212122.json:
```json
{
    "body": "Changed branch from **[u/rws/is_triangular_number___speed_up](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/is_triangular_number___speed_up)** to **[public/16424](https://github.com/sagemath/sagetrac-mirror/tree/public/16424)**",
    "created_at": "2014-06-16T06:13:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16424#issuecomment-212122",
    "user": "https://github.com/rwst"
}
```

Changed branch from **[u/rws/is_triangular_number___speed_up](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/is_triangular_number___speed_up)** to **[public/16424](https://github.com/sagemath/sagetrac-mirror/tree/public/16424)**



---

archive/issue_events_234600.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-06-16T06:13:12Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/16424",
    "title_is": "is_triangular_number() cleanup",
    "title_was": "is_triangular_number() speed up",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16424#event-234600"
}
```



---

archive/issue_events_234601.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-06-16T06:13:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16424",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16424#event-234601"
}
```



---

archive/issue_events_234602.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-06-16T06:13:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16424",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16424#event-234602"
}
```



---

archive/issue_comments_212123.json:
```json
{
    "body": "Changed author from **Ralf Stephan** to **Vincent Delecroix**",
    "created_at": "2014-06-16T06:13:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16424#issuecomment-212123",
    "user": "https://github.com/rwst"
}
```

Changed author from **Ralf Stephan** to **Vincent Delecroix**



---

archive/issue_comments_212124.json:
```json
{
    "body": "Changed commit from **[`de05b59`](https://github.com/sagemath/sagetrac-mirror/commit/de05b593cb8497493ce92e742a7379bdc8bf8489)** to **[`5894592`](https://github.com/sagemath/sagetrac-mirror/commit/5894592f6d380138198c4100fa0d55d7e75f3eb2)**",
    "created_at": "2014-06-16T06:13:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16424#issuecomment-212124",
    "user": "https://github.com/rwst"
}
```

Changed commit from **[`de05b59`](https://github.com/sagemath/sagetrac-mirror/commit/de05b593cb8497493ce92e742a7379bdc8bf8489)** to **[`5894592`](https://github.com/sagemath/sagetrac-mirror/commit/5894592f6d380138198c4100fa0d55d7e75f3eb2)**



---

archive/issue_comments_212125.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nReplying to [@videlec](#comment:3):\n> see my branch at public/16424\n> \n> I rewrote the function as it can be done in a much cleaner/faster way. Moreover, a function called `is_X` must return a boolean. It makes no sense to have it return boolean or integer values. I decided to add an extra argument `return_value` that does the job. I also rewrite the doc which was very ugly.\n> \n> Tell me what you think...\n> \n> Anyway, I am not sure it is worth it to have a function which is just equivalent to\n> \n> ```\n> is_triangular = lambda n: (8*n+1).is_square()\n> ```\n\nHi Vincent, the branch is fine. I would agree that the function is not worth occupying one of the precious global slots. However, I think it is still good to have, so you can set positive if you also remove it from `quadratic_forms/all.py`.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/33a3e17881cb8f8b286358cd2098cffb4c4aae6e\"><code>33a3e17</code></a></td><td><code>trac #16424: merge sage.6.3.beta3</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5894592f6d380138198c4100fa0d55d7e75f3eb2\"><code>5894592</code></a></td><td><code>trac #16424: revamp 'is_triangular_number'</code></td></tr></table>\n",
    "created_at": "2014-06-16T06:13:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16424#issuecomment-212125",
    "user": "https://github.com/rwst"
}
```

<div id="comment:5" align="right">comment:5</div>

Replying to [@videlec](#comment:3):
> see my branch at public/16424
> 
> I rewrote the function as it can be done in a much cleaner/faster way. Moreover, a function called `is_X` must return a boolean. It makes no sense to have it return boolean or integer values. I decided to add an extra argument `return_value` that does the job. I also rewrite the doc which was very ugly.
> 
> Tell me what you think...
> 
> Anyway, I am not sure it is worth it to have a function which is just equivalent to
> 
> ```
> is_triangular = lambda n: (8*n+1).is_square()
> ```

Hi Vincent, the branch is fine. I would agree that the function is not worth occupying one of the precious global slots. However, I think it is still good to have, so you can set positive if you also remove it from `quadratic_forms/all.py`.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/33a3e17881cb8f8b286358cd2098cffb4c4aae6e"><code>33a3e17</code></a></td><td><code>trac #16424: merge sage.6.3.beta3</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5894592f6d380138198c4100fa0d55d7e75f3eb2"><code>5894592</code></a></td><td><code>trac #16424: revamp 'is_triangular_number'</code></td></tr></table>




---

archive/issue_comments_212126.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nHi Ralf,\n\nI have no problem removing it from the global namespace but then how the user would find it? The path is really unguessable!\n\n```\nsage: from sage.quadratic_forms.extra import is_triangular_number\n```\nVincent",
    "created_at": "2014-06-16T06:42:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16424#issuecomment-212126",
    "user": "https://github.com/videlec"
}
```

<div id="comment:6" align="right">comment:6</div>

Hi Ralf,

I have no problem removing it from the global namespace but then how the user would find it? The path is really unguessable!

```
sage: from sage.quadratic_forms.extra import is_triangular_number
```
Vincent



---

archive/issue_comments_212127.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nI don't know. Searching the reference will turn up lots of other links. I don't think we should put more thought into it, so any outcome is fine with me, as is the branch. Another ticket will resolve the global namespace cleanup.",
    "created_at": "2014-06-16T08:38:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16424#issuecomment-212127",
    "user": "https://github.com/rwst"
}
```

<div id="comment:7" align="right">comment:7</div>

I don't know. Searching the reference will turn up lots of other links. I don't think we should put more thought into it, so any outcome is fine with me, as is the branch. Another ticket will resolve the global namespace cleanup.



---

archive/issue_events_234603.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-06-16T08:38:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16424",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16424#event-234603"
}
```



---

archive/issue_events_234604.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-06-16T08:38:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16424",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16424#event-234604"
}
```



---

archive/issue_events_234605.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-06-18T14:11:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16424",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16424#event-234605"
}
```



---

archive/issue_events_234606.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "0231de97a57e374248ec0b9f55f71dd33cddc1e7",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2014-06-18T14:11:18Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/16424",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16424#event-234606"
}
```



---

archive/issue_comments_212128.json:
```json
{
    "body": "Changed branch from **[public/16424](https://github.com/sagemath/sagetrac-mirror/tree/public/16424)** to **[`5894592`](https://github.com/sagemath/sagetrac-mirror/commit/5894592f6d380138198c4100fa0d55d7e75f3eb2)**",
    "created_at": "2014-06-18T14:11:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16424#issuecomment-212128",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/16424](https://github.com/sagemath/sagetrac-mirror/tree/public/16424)** to **[`5894592`](https://github.com/sagemath/sagetrac-mirror/commit/5894592f6d380138198c4100fa0d55d7e75f3eb2)**
