# Issue 16649: Make `quo_rem` give answers more often

archive/issues_016412.json:
```json
{
    "body": "In generic implementations of `f.quo_rem(g)`, an exception\n\n```python\nArithmeticError: Nonunit leading coefficient\n```\nis raised as soon as the leading coefficient of `g` is not invertible. This was introduced by ticket #11593, and I mimicked the behavior in #16544. \n\nThe change I propose is to try to compute the Euclidean division, and raise an exception\n\n```python\nArithmeticError: division not exact (consider coercing to polynomials over the fraction field first)\n```\nwhen the computation is not possible. Then, `quo_rem` would produce less exceptions, and in particular give an answer each time the answer is not controversial (see below). \n\n**Note on the controverse.** There is a debate to know whether one should raise an exception when the division is not exact (as it is done for dense integer polynomials with the `NTL` implementation), or if one should silently return a result that has a mathematical meaning though it is not a Euclidean division (as it is done with the `flint` implementation). See #16276 as well as https://groups.google.com/d/msg/sage-devel/UVrx5CG4qA0/WUz2RItJtF8J for this debate. My proposition is to already implement a more capable algorithm, and not to wait for the debate to be closed.\n\n\nKeywords: quo_rem\n\nBranch/Commit: dbfb5186d55ad1682014ffc92907fa1af9fc488f\n\nReviewer: Fr\u00e9d\u00e9ric Chapoton, Ralf Stephan\n\nAuthor: Bruno Grenet\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/16649\n\n",
    "closed_at": "2016-04-17T22:48:15Z",
    "created_at": "2014-07-12T15:20:55Z",
    "labels": [
        "component: basic arithmetic",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Make `quo_rem` give answers more often",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16649",
    "user": "https://github.com/bgrenet"
}
```
In generic implementations of `f.quo_rem(g)`, an exception

```python
ArithmeticError: Nonunit leading coefficient
```
is raised as soon as the leading coefficient of `g` is not invertible. This was introduced by ticket #11593, and I mimicked the behavior in #16544. 

The change I propose is to try to compute the Euclidean division, and raise an exception

```python
ArithmeticError: division not exact (consider coercing to polynomials over the fraction field first)
```
when the computation is not possible. Then, `quo_rem` would produce less exceptions, and in particular give an answer each time the answer is not controversial (see below). 

**Note on the controverse.** There is a debate to know whether one should raise an exception when the division is not exact (as it is done for dense integer polynomials with the `NTL` implementation), or if one should silently return a result that has a mathematical meaning though it is not a Euclidean division (as it is done with the `flint` implementation). See #16276 as well as https://groups.google.com/d/msg/sage-devel/UVrx5CG4qA0/WUz2RItJtF8J for this debate. My proposition is to already implement a more capable algorithm, and not to wait for the debate to be closed.


Keywords: quo_rem

Branch/Commit: dbfb5186d55ad1682014ffc92907fa1af9fc488f

Reviewer: Frédéric Chapoton, Ralf Stephan

Author: Bruno Grenet

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/16649





---

archive/issue_comments_276406.json:
```json
{
    "body": "<a id='comment:1'></a>My proposition is as follows (say for the method `quo_rem` of the `class Polynomial_generic_dense`):\n\n- Remove the test\n  {{{#!python\n          if not other.leading_coefficient().is_unit():\n              raise ArithmeticError(\"Nonunit leading coefficient\")\n  }}}\n  on lines 7484-7485 of `sage/rings/polynomial/polynomial_element.pyx`.\n\n- Change the line 7999 (`q = x[n+k-1]/y[n-1]`) by the following:\n  {{{#!python\n              try:\n                  q = R(x[n+k-1]/y[n-1])\n              except TypeError:\n                  raise ArithmeticError(\"Division not exact (consider coercing to polynomial over the fraction field first\")\n  }}}\n\nDoes the change make sense?",
    "created_at": "2014-07-12T15:52:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-276406",
    "user": "https://github.com/bgrenet"
}
```

<a id='comment:1'></a>My proposition is as follows (say for the method `quo_rem` of the `class Polynomial_generic_dense`):

- Remove the test
  {{{#!python
          if not other.leading_coefficient().is_unit():
              raise ArithmeticError("Nonunit leading coefficient")
  }}}
  on lines 7484-7485 of `sage/rings/polynomial/polynomial_element.pyx`.

- Change the line 7999 (`q = x[n+k-1]/y[n-1]`) by the following:
  {{{#!python
              try:
                  q = R(x[n+k-1]/y[n-1])
              except TypeError:
                  raise ArithmeticError("Division not exact (consider coercing to polynomial over the fraction field first")
  }}}

Does the change make sense?



---

archive/issue_comments_276407.json:
```json
{
    "body": "Changing branch from \"\" to \"u/bruno/make__quo_rem__give_answers_more_often\"",
    "created_at": "2014-07-13T18:15:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-276407",
    "user": "https://github.com/bgrenet"
}
```

Changing branch from "" to "u/bruno/make__quo_rem__give_answers_more_often"



---

archive/issue_comments_276408.json:
```json
{
    "body": "Changing author from \"\" to \"Bruno Grenet\"",
    "created_at": "2014-07-13T18:16:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-276408",
    "user": "https://github.com/bgrenet"
}
```

Changing author from "" to "Bruno Grenet"



---

archive/issue_comments_276409.json:
```json
{
    "body": "Changing commit from \"\" to \"17ec8eaa2b7610fb6e8515355ae05abeff048fcd\"",
    "created_at": "2014-07-13T18:16:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-276409",
    "user": "https://github.com/bgrenet"
}
```

Changing commit from "" to "17ec8eaa2b7610fb6e8515355ae05abeff048fcd"



---

archive/issue_comments_276410.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-07-13T18:16:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-276410",
    "user": "https://github.com/bgrenet"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_276411.json:
```json
{
    "body": "<a id='comment:3'></a>New commits:",
    "created_at": "2014-07-13T18:16:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-276411",
    "user": "https://github.com/bgrenet"
}
```

<a id='comment:3'></a>New commits:



---

archive/issue_events_048822.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16649#event-48822"
}
```



---

archive/issue_comments_276412.json:
```json
{
    "body": "<a id='comment:5'></a>needs rebase, does not apply",
    "created_at": "2015-08-05T18:40:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-276412",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:5'></a>needs rebase, does not apply



---

archive/issue_comments_276413.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-08-05T18:40:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-276413",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_276414.json:
```json
{
    "body": "Changing commit from \"17ec8eaa2b7610fb6e8515355ae05abeff048fcd\" to \"98b7ca12cfe9335f9c871eda34ff9dc2ce03d3cf\"",
    "created_at": "2015-08-06T13:21:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-276414",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "17ec8eaa2b7610fb6e8515355ae05abeff048fcd" to "98b7ca12cfe9335f9c871eda34ff9dc2ce03d3cf"



---

archive/issue_comments_276415.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-08-06T13:21:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-276415",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_276416.json:
```json
{
    "body": "<a id='comment:7'></a>I did the rebase. Since it is my first time doing such a thing, I hope I did it the right way, ~~though it is probably not the case: When I make tests, such as `sage -btp 8 src/sage/rings/polynomial/`, I get quite a lot of failures, due to the deprecation of `zero_element`. I do not know why... and I suspect that it is not a great idea to replace all this `zero_element` by `zero` myself in this ticket, since it was done by ticket #17694. I do not know why these changes are not taken into account.~~\n\n[EDIT] see[comment:9](#comment%3A9)",
    "created_at": "2015-08-06T13:24:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-276416",
    "user": "https://github.com/bgrenet"
}
```

<a id='comment:7'></a>I did the rebase. Since it is my first time doing such a thing, I hope I did it the right way, ~~though it is probably not the case: When I make tests, such as `sage -btp 8 src/sage/rings/polynomial/`, I get quite a lot of failures, due to the deprecation of `zero_element`. I do not know why... and I suspect that it is not a great idea to replace all this `zero_element` by `zero` myself in this ticket, since it was done by ticket #17694. I do not know why these changes are not taken into account.~~

[EDIT] see[comment:9](#comment%3A9)



---

archive/issue_comments_276417.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-08-06T13:24:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-276417",
    "user": "https://github.com/bgrenet"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_276418.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-08-07T15:57:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-276418",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_276419.json:
```json
{
    "body": "Changing commit from \"98b7ca12cfe9335f9c871eda34ff9dc2ce03d3cf\" to \"6d0da248d4151d354a47e0a407aa3530dd008e77\"",
    "created_at": "2015-08-07T15:57:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-276419",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "98b7ca12cfe9335f9c871eda34ff9dc2ce03d3cf" to "6d0da248d4151d354a47e0a407aa3530dd008e77"



---

archive/issue_comments_276420.json:
```json
{
    "body": "<a id='comment:9'></a>Ignore the previous comment, my mistake! Should now be OK...",
    "created_at": "2015-08-07T15:58:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-276420",
    "user": "https://github.com/bgrenet"
}
```

<a id='comment:9'></a>Ignore the previous comment, my mistake! Should now be OK...



---

archive/issue_comments_276421.json:
```json
{
    "body": "<a id='comment:10'></a>two many colons after TESTS in\n\n```\n+        TESTS::\n+\n+        The following shows that :trac:`16649` is indeed fixed. ::\n```",
    "created_at": "2015-08-07T16:08:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-276421",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:10'></a>two many colons after TESTS in

```
+        TESTS::
+
+        The following shows that :trac:`16649` is indeed fixed. ::
```



---

archive/issue_comments_276422.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-08-07T16:25:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-276422",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_276423.json:
```json
{
    "body": "Changing commit from \"6d0da248d4151d354a47e0a407aa3530dd008e77\" to \"dbfb5186d55ad1682014ffc92907fa1af9fc488f\"",
    "created_at": "2015-08-07T16:25:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-276423",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "6d0da248d4151d354a47e0a407aa3530dd008e77" to "dbfb5186d55ad1682014ffc92907fa1af9fc488f"



---

archive/issue_comments_276424.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Fr\u00e9d\u00e9ric Chapoton, Ralf Stephan\"",
    "created_at": "2016-04-17T08:17:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-276424",
    "user": "https://github.com/rwst"
}
```

Changing reviewer from "" to "Frédéric Chapoton, Ralf Stephan"



---

archive/issue_comments_276425.json:
```json
{
    "body": "<a id='comment:12'></a>I think this looks good. I'm just toggling needs work/review to give the patchbot another chance because the last run seemed wrong. If it passes without errors you can set positive.",
    "created_at": "2016-04-17T08:17:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-276425",
    "user": "https://github.com/rwst"
}
```

<a id='comment:12'></a>I think this looks good. I'm just toggling needs work/review to give the patchbot another chance because the last run seemed wrong. If it passes without errors you can set positive.



---

archive/issue_comments_276426.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-04-17T08:17:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-276426",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_276427.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-04-17T08:17:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-276427",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_276428.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-04-17T13:06:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-276428",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_276429.json:
```json
{
    "body": "<a id='comment:14'></a>OK, I tested myself and it passes.",
    "created_at": "2016-04-17T13:06:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-276429",
    "user": "https://github.com/rwst"
}
```

<a id='comment:14'></a>OK, I tested myself and it passes.



---

archive/issue_events_048823.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-04-17T22:48:15Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16649#event-48823"
}
```



---

archive/issue_comments_276430.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-04-17T22:48:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-276430",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_276431.json:
```json
{
    "body": "Changing branch from \"u/bruno/make__quo_rem__give_answers_more_often\" to \"dbfb5186d55ad1682014ffc92907fa1af9fc488f\"",
    "created_at": "2016-04-17T22:48:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-276431",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/bruno/make__quo_rem__give_answers_more_often" to "dbfb5186d55ad1682014ffc92907fa1af9fc488f"
