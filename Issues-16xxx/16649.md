# Issue 16649: Make `quo_rem` give answers more often

archive/issues_016412.json:
```json
{
    "body": "In generic implementations of `f.quo_rem(g)`, an exception\n\n```python\nArithmeticError: Nonunit leading coefficient\n```\nis raised as soon as the leading coefficient of `g` is not invertible. This was introduced by ticket #11593, and I mimicked the behavior in #16544. \n\nThe change I propose is to try to compute the Euclidean division, and raise an exception\n\n```python\nArithmeticError: division not exact (consider coercing to polynomials over the fraction field first)\n```\nwhen the computation is not possible. Then, `quo_rem` would produce less exceptions, and in particular give an answer each time the answer is not controversial (see below). \n\n**Note on the controverse.** There is a debate to know whether one should raise an exception when the division is not exact (as it is done for dense integer polynomials with the `NTL` implementation), or if one should silently return a result that has a mathematical meaning though it is not a Euclidean division (as it is done with the `flint` implementation). See #16276 as well as https://groups.google.com/d/msg/sage-devel/UVrx5CG4qA0/WUz2RItJtF8J for this debate. My proposition is to already implement a more capable algorithm, and not to wait for the debate to be closed.\n\n\nKeywords: quo_rem\n\nBranch/Commit: dbfb5186d55ad1682014ffc92907fa1af9fc488f\n\nReviewer: Fr\u00e9d\u00e9ric Chapoton, Ralf Stephan\n\nAuthor: Bruno Grenet\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/16649\n\n",
    "closed_at": "2016-04-17T22:48:15Z",
    "created_at": "2014-07-12T15:20:55Z",
    "labels": [
        "component: basic arithmetic",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Make `quo_rem` give answers more often",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16649",
    "user": "https://github.com/bgrenet"
}
```
In generic implementations of `f.quo_rem(g)`, an exception

```python
ArithmeticError: Nonunit leading coefficient
```
is raised as soon as the leading coefficient of `g` is not invertible. This was introduced by ticket #11593, and I mimicked the behavior in #16544. 

The change I propose is to try to compute the Euclidean division, and raise an exception

```python
ArithmeticError: division not exact (consider coercing to polynomials over the fraction field first)
```
when the computation is not possible. Then, `quo_rem` would produce less exceptions, and in particular give an answer each time the answer is not controversial (see below). 

**Note on the controverse.** There is a debate to know whether one should raise an exception when the division is not exact (as it is done for dense integer polynomials with the `NTL` implementation), or if one should silently return a result that has a mathematical meaning though it is not a Euclidean division (as it is done with the `flint` implementation). See #16276 as well as https://groups.google.com/d/msg/sage-devel/UVrx5CG4qA0/WUz2RItJtF8J for this debate. My proposition is to already implement a more capable algorithm, and not to wait for the debate to be closed.


Keywords: quo_rem

Branch/Commit: dbfb5186d55ad1682014ffc92907fa1af9fc488f

Reviewer: Frédéric Chapoton, Ralf Stephan

Author: Bruno Grenet

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/16649





---

archive/issue_comments_280828.json:
```json
{
    "body": "<a id='comment:1'></a>\nMy proposition is as follows (say for the method `quo_rem` of the `class Polynomial_generic_dense`):\n\n- Remove the test\n  {{{#!python\n          if not other.leading_coefficient().is_unit():\n              raise ArithmeticError(\"Nonunit leading coefficient\")\n  }}}\n  on lines 7484-7485 of `sage/rings/polynomial/polynomial_element.pyx`.\n\n- Change the line 7999 (`q = x[n+k-1]/y[n-1]`) by the following:\n  {{{#!python\n              try:\n                  q = R(x[n+k-1]/y[n-1])\n              except TypeError:\n                  raise ArithmeticError(\"Division not exact (consider coercing to polynomial over the fraction field first\")\n  }}}\n\nDoes the change make sense?",
    "created_at": "2014-07-12T15:52:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-280828",
    "user": "https://github.com/bgrenet"
}
```

<a id='comment:1'></a>
My proposition is as follows (say for the method `quo_rem` of the `class Polynomial_generic_dense`):

- Remove the test
  {{{#!python
          if not other.leading_coefficient().is_unit():
              raise ArithmeticError("Nonunit leading coefficient")
  }}}
  on lines 7484-7485 of `sage/rings/polynomial/polynomial_element.pyx`.

- Change the line 7999 (`q = x[n+k-1]/y[n-1]`) by the following:
  {{{#!python
              try:
                  q = R(x[n+k-1]/y[n-1])
              except TypeError:
                  raise ArithmeticError("Division not exact (consider coercing to polynomial over the fraction field first")
  }}}

Does the change make sense?



---

archive/issue_comments_280829.json:
```json
{
    "body": "Changing branch from \"\" to \"u/bruno/make__quo_rem__give_answers_more_often\"",
    "created_at": "2014-07-13T18:15:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-280829",
    "user": "https://github.com/bgrenet"
}
```

Changing branch from "" to "u/bruno/make__quo_rem__give_answers_more_often"



---

archive/issue_comments_280830.json:
```json
{
    "body": "Changing author from \"\" to \"Bruno Grenet\"",
    "created_at": "2014-07-13T18:16:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-280830",
    "user": "https://github.com/bgrenet"
}
```

Changing author from "" to "Bruno Grenet"



---

archive/issue_comments_280831.json:
```json
{
    "body": "Changing commit from \"\" to \"17ec8eaa2b7610fb6e8515355ae05abeff048fcd\"",
    "created_at": "2014-07-13T18:16:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-280831",
    "user": "https://github.com/bgrenet"
}
```

Changing commit from "" to "17ec8eaa2b7610fb6e8515355ae05abeff048fcd"



---

archive/issue_comments_280832.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-07-13T18:16:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-280832",
    "user": "https://github.com/bgrenet"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_280833.json:
```json
{
    "body": "<a id='comment:3'></a>\nNew commits:\n|                                                                                                                                          |                                                       |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------|\n|[9000fb8](https://github.com/sagemath/sagetrac-mirror/commit/9000fb85706fa54e1dd315b8eab9241e7ea45e8a)|`Add quo_rem method in class Polynomial_generic_sparse`|\n|[84833c9](https://github.com/sagemath/sagetrac-mirror/commit/84833c9ad72727913a0cec5ca1e9f4f9d9e16d73)|`Move inversion of unit`|\n|[fb1d21c](https://github.com/sagemath/sagetrac-mirror/commit/fb1d21cbee05d6be577bf66120aa20d3bd498ace)|`Add doc tests`|\n|[17ec8ea](https://github.com/sagemath/sagetrac-mirror/commit/17ec8eaa2b7610fb6e8515355ae05abeff048fcd)|`Try to compute the euclidean division, even for nonunit leading coefficients, until some non-exact division occurs`|",
    "created_at": "2014-07-13T18:16:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-280833",
    "user": "https://github.com/bgrenet"
}
```

<a id='comment:3'></a>
New commits:
|                                                                                                                                          |                                                       |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------|
|[9000fb8](https://github.com/sagemath/sagetrac-mirror/commit/9000fb85706fa54e1dd315b8eab9241e7ea45e8a)|`Add quo_rem method in class Polynomial_generic_sparse`|
|[84833c9](https://github.com/sagemath/sagetrac-mirror/commit/84833c9ad72727913a0cec5ca1e9f4f9d9e16d73)|`Move inversion of unit`|
|[fb1d21c](https://github.com/sagemath/sagetrac-mirror/commit/fb1d21cbee05d6be577bf66120aa20d3bd498ace)|`Add doc tests`|
|[17ec8ea](https://github.com/sagemath/sagetrac-mirror/commit/17ec8eaa2b7610fb6e8515355ae05abeff048fcd)|`Try to compute the euclidean division, even for nonunit leading coefficients, until some non-exact division occurs`|



---

archive/issue_events_055536.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16649#event-55536"
}
```



---

archive/issue_comments_280834.json:
```json
{
    "body": "<a id='comment:5'></a>\nneeds rebase, does not apply",
    "created_at": "2015-08-05T18:40:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-280834",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:5'></a>
needs rebase, does not apply



---

archive/issue_comments_280835.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-08-05T18:40:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-280835",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_280836.json:
```json
{
    "body": "Changing commit from \"17ec8eaa2b7610fb6e8515355ae05abeff048fcd\" to \"98b7ca12cfe9335f9c871eda34ff9dc2ce03d3cf\"",
    "created_at": "2015-08-06T13:21:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-280836",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "17ec8eaa2b7610fb6e8515355ae05abeff048fcd" to "98b7ca12cfe9335f9c871eda34ff9dc2ce03d3cf"



---

archive/issue_comments_280837.json:
```json
{
    "body": "<a id='comment:6'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                          |                     |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------|\n|[98b7ca1](https://github.com/sagemath/sagetrac-mirror/commit/98b7ca12cfe9335f9c871eda34ff9dc2ce03d3cf)|`Rebased on 6.9beta1`|",
    "created_at": "2015-08-06T13:21:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-280837",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                          |                     |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------|
|[98b7ca1](https://github.com/sagemath/sagetrac-mirror/commit/98b7ca12cfe9335f9c871eda34ff9dc2ce03d3cf)|`Rebased on 6.9beta1`|



---

archive/issue_comments_280838.json:
```json
{
    "body": "<a id='comment:7'></a>\nI did the rebase. Since it is my first time doing such a thing, I hope I did it the right way, ~~though it is probably not the case: When I make tests, such as `sage -btp 8 src/sage/rings/polynomial/`, I get quite a lot of failures, due to the deprecation of `zero_element`. I do not know why... and I suspect that it is not a great idea to replace all this `zero_element` by `zero` myself in this ticket, since it was done by ticket #17694. I do not know why these changes are not taken into account.~~\n\n[EDIT] see[comment:9](#comment%3A9)",
    "created_at": "2015-08-06T13:24:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-280838",
    "user": "https://github.com/bgrenet"
}
```

<a id='comment:7'></a>
I did the rebase. Since it is my first time doing such a thing, I hope I did it the right way, ~~though it is probably not the case: When I make tests, such as `sage -btp 8 src/sage/rings/polynomial/`, I get quite a lot of failures, due to the deprecation of `zero_element`. I do not know why... and I suspect that it is not a great idea to replace all this `zero_element` by `zero` myself in this ticket, since it was done by ticket #17694. I do not know why these changes are not taken into account.~~

[EDIT] see[comment:9](#comment%3A9)



---

archive/issue_comments_280839.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-08-06T13:24:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-280839",
    "user": "https://github.com/bgrenet"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_280840.json:
```json
{
    "body": "<a id='comment:8'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                                                     |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|\n|[6d0da24](https://github.com/sagemath/sagetrac-mirror/commit/6d0da248d4151d354a47e0a407aa3530dd008e77)|`One last zero_element removed + correct one doctest`|",
    "created_at": "2015-08-07T15:57:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-280840",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                                                     |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|
|[6d0da24](https://github.com/sagemath/sagetrac-mirror/commit/6d0da248d4151d354a47e0a407aa3530dd008e77)|`One last zero_element removed + correct one doctest`|



---

archive/issue_comments_280841.json:
```json
{
    "body": "Changing commit from \"98b7ca12cfe9335f9c871eda34ff9dc2ce03d3cf\" to \"6d0da248d4151d354a47e0a407aa3530dd008e77\"",
    "created_at": "2015-08-07T15:57:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-280841",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "98b7ca12cfe9335f9c871eda34ff9dc2ce03d3cf" to "6d0da248d4151d354a47e0a407aa3530dd008e77"



---

archive/issue_comments_280842.json:
```json
{
    "body": "<a id='comment:9'></a>\nIgnore the previous comment, my mistake! Should now be OK...",
    "created_at": "2015-08-07T15:58:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-280842",
    "user": "https://github.com/bgrenet"
}
```

<a id='comment:9'></a>
Ignore the previous comment, my mistake! Should now be OK...



---

archive/issue_comments_280843.json:
```json
{
    "body": "<a id='comment:10'></a>\ntwo many colons after TESTS in\n\n```\n+        TESTS::\n+\n+        The following shows that :trac:`16649` is indeed fixed. ::\n```",
    "created_at": "2015-08-07T16:08:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-280843",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:10'></a>
two many colons after TESTS in

```
+        TESTS::
+
+        The following shows that :trac:`16649` is indeed fixed. ::
```



---

archive/issue_comments_280844.json:
```json
{
    "body": "<a id='comment:11'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                          |                       |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------|\n|[dbfb518](https://github.com/sagemath/sagetrac-mirror/commit/dbfb5186d55ad1682014ffc92907fa1af9fc488f)|`Remove useless colons`|",
    "created_at": "2015-08-07T16:25:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-280844",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                          |                       |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------|
|[dbfb518](https://github.com/sagemath/sagetrac-mirror/commit/dbfb5186d55ad1682014ffc92907fa1af9fc488f)|`Remove useless colons`|



---

archive/issue_comments_280845.json:
```json
{
    "body": "Changing commit from \"6d0da248d4151d354a47e0a407aa3530dd008e77\" to \"dbfb5186d55ad1682014ffc92907fa1af9fc488f\"",
    "created_at": "2015-08-07T16:25:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-280845",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "6d0da248d4151d354a47e0a407aa3530dd008e77" to "dbfb5186d55ad1682014ffc92907fa1af9fc488f"



---

archive/issue_comments_280846.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Fr\u00e9d\u00e9ric Chapoton, Ralf Stephan\"",
    "created_at": "2016-04-17T08:17:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-280846",
    "user": "https://github.com/rwst"
}
```

Changing reviewer from "" to "Frédéric Chapoton, Ralf Stephan"



---

archive/issue_comments_280847.json:
```json
{
    "body": "<a id='comment:12'></a>\nI think this looks good. I'm just toggling needs work/review to give the patchbot another chance because the last run seemed wrong. If it passes without errors you can set positive.",
    "created_at": "2016-04-17T08:17:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-280847",
    "user": "https://github.com/rwst"
}
```

<a id='comment:12'></a>
I think this looks good. I'm just toggling needs work/review to give the patchbot another chance because the last run seemed wrong. If it passes without errors you can set positive.



---

archive/issue_comments_280848.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-04-17T08:17:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-280848",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_280849.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-04-17T08:17:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-280849",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_280850.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-04-17T13:06:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-280850",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_280851.json:
```json
{
    "body": "<a id='comment:14'></a>\nOK, I tested myself and it passes.",
    "created_at": "2016-04-17T13:06:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-280851",
    "user": "https://github.com/rwst"
}
```

<a id='comment:14'></a>
OK, I tested myself and it passes.



---

archive/issue_events_055537.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-04-17T22:48:15Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16649#event-55537"
}
```



---

archive/issue_comments_280852.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-04-17T22:48:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-280852",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_280853.json:
```json
{
    "body": "Changing branch from \"u/bruno/make__quo_rem__give_answers_more_often\" to \"dbfb5186d55ad1682014ffc92907fa1af9fc488f\"",
    "created_at": "2016-04-17T22:48:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16649#issuecomment-280853",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/bruno/make__quo_rem__give_answers_more_often" to "dbfb5186d55ad1682014ffc92907fa1af9fc488f"
