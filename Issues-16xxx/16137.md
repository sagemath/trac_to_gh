# Issue 16137: lazy_list from various input data

archive/issues_015900.json:
```json
{
    "body": "The `lazy_list` in `sage.misc.lazy_list` only deals with infinite list built from iterator. \nIn many situations we want to create infinite list from more various data: \n- **an iterator** (current implementation),\n- **an explicit form** a function n -> n-th term\n- **an update function**: a function that given a buffer of already computed values compute some extra terms (e.g. in the context of words: fixed point of substitutions and in the context of power series: Newton iteration and relaxed multiplication).\n\nThose new lazy lists aim to be very basic Python objects. Their purpose is to be used as fast and reliable data structures in: \n- words (`sage.combinat.words`, see also #19620) \n- continued fraction expansions/binary expansions of real numbers \n- lazy power series (see #15673) \n- ... \n\nSee also: rational o.g.f. #15714, hypergeometric e.g.f. part of #2516\n\nIn the original proposal there was also ultimately periodic lazy lists (that would simply store two attributes for the pre-period and period). In this ticket we focus on the ones that need a cache mechanism.\n\nCC:  matthieudien @videlec @nthiery @mantepse @rwst\n\nKeywords: LazyPowerSeries, lazy_list, days57\n\nBranch/Commit: f7960c1038c1498eca8995a3e39e7c3a4f76e99e\n\nReviewer: Daniel Krenn\n\nAuthor: Matthieu Dien, Vincent Delecroix, Daniel Krenn\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/16137\n\n",
    "closed_at": "2016-02-02T23:06:40Z",
    "created_at": "2014-04-11T18:01:01Z",
    "labels": [
        "component: misc"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.1",
    "title": "lazy_list from various input data",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16137",
    "user": "https://github.com/MatthieuDien"
}
```
The `lazy_list` in `sage.misc.lazy_list` only deals with infinite list built from iterator. 
In many situations we want to create infinite list from more various data: 
- **an iterator** (current implementation),
- **an explicit form** a function n -> n-th term
- **an update function**: a function that given a buffer of already computed values compute some extra terms (e.g. in the context of words: fixed point of substitutions and in the context of power series: Newton iteration and relaxed multiplication).

Those new lazy lists aim to be very basic Python objects. Their purpose is to be used as fast and reliable data structures in: 
- words (`sage.combinat.words`, see also #19620) 
- continued fraction expansions/binary expansions of real numbers 
- lazy power series (see #15673) 
- ... 

See also: rational o.g.f. #15714, hypergeometric e.g.f. part of #2516

In the original proposal there was also ultimately periodic lazy lists (that would simply store two attributes for the pre-period and period). In this ticket we focus on the ones that need a cache mechanism.

CC:  matthieudien @videlec @nthiery @mantepse @rwst

Keywords: LazyPowerSeries, lazy_list, days57

Branch/Commit: f7960c1038c1498eca8995a3e39e7c3a4f76e99e

Reviewer: Daniel Krenn

Author: Matthieu Dien, Vincent Delecroix, Daniel Krenn

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/16137





---

archive/issue_comments_206202.json:
```json
{
    "body": "<a id='comment:3'></a>Hi Ralf,\n\nI think that our third item also includes CFinite sequences. The difference is about how the function `update` is written. It might be either\n\n```\ndef update1(cache):\n    cache.append(cache[-1] + cache[-2])\n```\nor\n\n```\ndef update2(cache):\n    return cache[-1]+cache[-2]\n```\nActually, even a closed form is a special case of `update1` as one can call `len` on the cache. Do you agree or did I miss something?\n\nThe main task of this ticket is to write precise specifications of what we need... adapting the current implementation of `lazy_list` is straightforward.",
    "created_at": "2014-04-13T09:31:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206202",
    "user": "https://github.com/videlec"
}
```

<a id='comment:3'></a>Hi Ralf,

I think that our third item also includes CFinite sequences. The difference is about how the function `update` is written. It might be either

```
def update1(cache):
    cache.append(cache[-1] + cache[-2])
```
or

```
def update2(cache):
    return cache[-1]+cache[-2]
```
Actually, even a closed form is a special case of `update1` as one can call `len` on the cache. Do you agree or did I miss something?

The main task of this ticket is to write precise specifications of what we need... adapting the current implementation of `lazy_list` is straightforward.



---

archive/issue_comments_206203.json:
```json
{
    "body": "<a id='comment:4'></a>OK then please clarify the scope of the ticket. Also a periodic list is a special case of update.",
    "created_at": "2014-04-13T09:56:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206203",
    "user": "https://github.com/rwst"
}
```

<a id='comment:4'></a>OK then please clarify the scope of the ticket. Also a periodic list is a special case of update.



---

archive/issue_comments_206204.json:
```json
{
    "body": "<a id='comment:5'></a>I don't think it is a good design decision to have `lazy_list` include functionality that really belong to formal power series or recursive sequences.  I think that this is one of the things Axiom/FriCAS really got right: there is one class (in Axiom-parlance: `Stream`) which does not require any functionality from the elements.  Formal power series and sequences then use this class, and allow access to it via a method `coefficients`.\n\nIn any case, there is quite a large interesting hierarchy of formal power series and sequences, and it is in my opinion a very bad idea to single out rational or hypergeometric functions.\n\nNote that I am not at all against functionality that allows to define lazy lists recursively (on the contrary!), just please do not limit it to sequences built of numbers then.",
    "created_at": "2014-04-14T14:58:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206204",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:5'></a>I don't think it is a good design decision to have `lazy_list` include functionality that really belong to formal power series or recursive sequences.  I think that this is one of the things Axiom/FriCAS really got right: there is one class (in Axiom-parlance: `Stream`) which does not require any functionality from the elements.  Formal power series and sequences then use this class, and allow access to it via a method `coefficients`.

In any case, there is quite a large interesting hierarchy of formal power series and sequences, and it is in my opinion a very bad idea to single out rational or hypergeometric functions.

Note that I am not at all against functionality that allows to define lazy lists recursively (on the contrary!), just please do not limit it to sequences built of numbers then.



---

archive/issue_comments_206205.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:5 mantepse]:\n> I don't think it is a good design decision to have `lazy_list` include functionality that really belong to formal power series or recursive sequences.  I think that this is one of the things Axiom/FriCAS really got right: there is one class (in Axiom-parlance: `Stream`) which does not require any functionality from the elements.  Formal power series and sequences then use this class, and allow access to it via a method `coefficients`.\n> \n> In any case, there is quite a large interesting hierarchy of formal power series and sequences, and it is in my opinion a very bad idea to single out rational or hypergeometric functions.\n> \n> Note that I am not at all against functionality that allows to define lazy lists recursively (on the contrary!), just please do not limit it to sequences built of numbers then.\n\n\nHey Martin,\n\nThere is no way `lazy_list` would be made only of numbers! My first goal was to have better data structure for words (`sage.combinat.words`). I also had in mind its usage in lazy power series. Do you prefer the new description? Please edit it if there is something wrong. The concrete implementation did not start yet. We are waiting for the best possible specifications...",
    "created_at": "2014-04-14T15:16:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206205",
    "user": "https://github.com/videlec"
}
```

<a id='comment:6'></a>Replying to [comment:5 mantepse]:
> I don't think it is a good design decision to have `lazy_list` include functionality that really belong to formal power series or recursive sequences.  I think that this is one of the things Axiom/FriCAS really got right: there is one class (in Axiom-parlance: `Stream`) which does not require any functionality from the elements.  Formal power series and sequences then use this class, and allow access to it via a method `coefficients`.
> 
> In any case, there is quite a large interesting hierarchy of formal power series and sequences, and it is in my opinion a very bad idea to single out rational or hypergeometric functions.
> 
> Note that I am not at all against functionality that allows to define lazy lists recursively (on the contrary!), just please do not limit it to sequences built of numbers then.


Hey Martin,

There is no way `lazy_list` would be made only of numbers! My first goal was to have better data structure for words (`sage.combinat.words`). I also had in mind its usage in lazy power series. Do you prefer the new description? Please edit it if there is something wrong. The concrete implementation did not start yet. We are waiting for the best possible specifications...



---

archive/issue_comments_206206.json:
```json
{
    "body": "<a id='comment:8'></a>I am aware that it looks like we would only look at numbers. But I was only listing what is already available in code. I would like to have an overview of the hierarchy you mention, not the least because it would help with the design of the code planned here. Where could such an overview (of the hierarchy of formal power series and sequences) be found?",
    "created_at": "2014-04-14T15:21:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206206",
    "user": "https://github.com/rwst"
}
```

<a id='comment:8'></a>I am aware that it looks like we would only look at numbers. But I was only listing what is already available in code. I would like to have an overview of the hierarchy you mention, not the least because it would help with the design of the code planned here. Where could such an overview (of the hierarchy of formal power series and sequences) be found?



---

archive/issue_comments_206207.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:8 rws]:\n> I am aware that it looks like we would only look at numbers. But I was only listing what is already available in code. I would like to have an overview of the hierarchy you mention, not the least because it would help with the design of the code planned here. Where could such an overview (of the hierarchy of formal power series and sequences) be found?\n\n\nRalf,\n\nI do not understand what happened and if you did it on purpose. I modified the description twice and you reverted my changes twice !! It is very annoying.",
    "created_at": "2014-04-14T15:25:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206207",
    "user": "https://github.com/videlec"
}
```

<a id='comment:9'></a>Replying to [comment:8 rws]:
> I am aware that it looks like we would only look at numbers. But I was only listing what is already available in code. I would like to have an overview of the hierarchy you mention, not the least because it would help with the design of the code planned here. Where could such an overview (of the hierarchy of formal power series and sequences) be found?


Ralf,

I do not understand what happened and if you did it on purpose. I modified the description twice and you reverted my changes twice !! It is very annoying.



---

archive/issue_comments_206208.json:
```json
{
    "body": "<a id='comment:10'></a>What. No way.",
    "created_at": "2014-04-14T15:26:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206208",
    "user": "https://github.com/rwst"
}
```

<a id='comment:10'></a>What. No way.



---

archive/issue_comments_206209.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [comment:10 rws]:\n> What. No way.\n\n\nYes you did. But, my mistake, only once. Have a look: http://trac.sagemath.org/ticket/16137?action=diff&version=8. It might really be that we were editing the ticket at the same time and something bad happened. I will roll back the previous version.",
    "created_at": "2014-04-14T15:30:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206209",
    "user": "https://github.com/videlec"
}
```

<a id='comment:11'></a>Replying to [comment:10 rws]:
> What. No way.


Yes you did. But, my mistake, only once. Have a look: http://trac.sagemath.org/ticket/16137?action=diff&version=8. It might really be that we were editing the ticket at the same time and something bad happened. I will roll back the previous version.



---

archive/issue_comments_206210.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:11 vdelecroix]:\n> I will roll back the previous version.\n\nYes, please. Apparently, I opened the 'Modify ticket' form without editing, you saved your change, then (after display of the yellow warning) I saved my comment, and with it the content of the Modify ticket form. Sorry.",
    "created_at": "2014-04-14T15:36:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206210",
    "user": "https://github.com/rwst"
}
```

<a id='comment:12'></a>Replying to [comment:11 vdelecroix]:
> I will roll back the previous version.

Yes, please. Apparently, I opened the 'Modify ticket' form without editing, you saved your change, then (after display of the yellow warning) I saved my comment, and with it the content of the Modify ticket form. Sorry.



---

archive/issue_comments_206211.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:12 rws]:\n> Replying to [comment:11 vdelecroix]:\n> > I will roll back the previous version.\n\n> Yes, please. Apparently, I opened the 'Modify ticket' form without editing, you saved your change, then (after display of the yellow warning) I saved my comment, and with it the content of the Modify ticket form. Sorry.\n\nIt is a bit strange that there is no warning that forbid you to add changes from version 6 when 7 is the current one... No problem, the previous version is back.",
    "created_at": "2014-04-14T15:42:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206211",
    "user": "https://github.com/videlec"
}
```

<a id='comment:13'></a>Replying to [comment:12 rws]:
> Replying to [comment:11 vdelecroix]:
> > I will roll back the previous version.

> Yes, please. Apparently, I opened the 'Modify ticket' form without editing, you saved your change, then (after display of the yellow warning) I saved my comment, and with it the content of the Modify ticket form. Sorry.

It is a bit strange that there is no warning that forbid you to add changes from version 6 when 7 is the current one... No problem, the previous version is back.



---

archive/issue_comments_206212.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:8 rws]:\n> Where could such an overview (of the hierarchy of formal power series and sequences) be found?\n\n\nYou can find some references in [http://arxiv.org/abs/math/0702086](http://arxiv.org/abs/math/0702086).  But this is certainly by no means complete.",
    "created_at": "2014-04-14T16:57:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206212",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:14'></a>Replying to [comment:8 rws]:
> Where could such an overview (of the hierarchy of formal power series and sequences) be found?


You can find some references in [http://arxiv.org/abs/math/0702086](http://arxiv.org/abs/math/0702086).  But this is certainly by no means complete.



---

archive/issue_comments_206213.json:
```json
{
    "body": "<a id='comment:15'></a>I very much like the new description, nothing to add...",
    "created_at": "2014-04-14T17:00:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206213",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:15'></a>I very much like the new description, nothing to add...



---

archive/issue_events_047555.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16137#event-47555"
}
```



---

archive/issue_events_047556.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16137#event-47556"
}
```



---

archive/issue_events_047557.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16137#event-47557"
}
```



---

archive/issue_comments_206214.json:
```json
{
    "body": "<a id='comment:18'></a>Hi there! Is there any news on this front?  I'm especially interested because of the connection with #15673...",
    "created_at": "2014-08-13T09:45:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206214",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:18'></a>Hi there! Is there any news on this front?  I'm especially interested because of the connection with #15673...



---

archive/issue_comments_206215.json:
```json
{
    "body": "<a id='comment:19'></a>Replying to [comment:18 mantepse]:\n> Hi there! Is there any news on this front?  I'm especially interested because of the connection with #15673...\n\n\nI should work on it but I did not have much time since the Sage Days :s\n\nI will work on it during September (I hope).",
    "created_at": "2014-08-20T08:40:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206215",
    "user": "https://github.com/MatthieuDien"
}
```

<a id='comment:19'></a>Replying to [comment:18 mantepse]:
> Hi there! Is there any news on this front?  I'm especially interested because of the connection with #15673...


I should work on it but I did not have much time since the Sage Days :s

I will work on it during September (I hope).



---

archive/issue_comments_206216.json:
```json
{
    "body": "<a id='comment:20'></a>Great!  No hurry, though...",
    "created_at": "2014-08-20T09:02:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206216",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:20'></a>Great!  No hurry, though...



---

archive/issue_comments_206217.json:
```json
{
    "body": "<a id='comment:22'></a>Hi there !\n\nI propose a draft of code for 'lazy_list_from_iterator' and 'lazy_list_from_fun'.\nCurrently, the file is composed of three class : one abstract class (but I don't know how to precise this more formally in Python / Cython / Sage) to facorize the code between lazy_list_from_iterator and lazy_list_from_fun.\n\nI have to do choices :\n- to define lazy list with function I propose to use a fonction which takes 2 arguments : the rank of the element to compute and all the already computed elements\n- Currently, the _add_ method force the computation of all the elements : that's very annoying for not finite iterator. I suppressed it, for the moment.\n\nGive me feedback !\n\nThanks\n\n---\nNew commits:",
    "created_at": "2014-12-09T17:56:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206217",
    "user": "https://github.com/MatthieuDien"
}
```

<a id='comment:22'></a>Hi there !

I propose a draft of code for 'lazy_list_from_iterator' and 'lazy_list_from_fun'.
Currently, the file is composed of three class : one abstract class (but I don't know how to precise this more formally in Python / Cython / Sage) to facorize the code between lazy_list_from_iterator and lazy_list_from_fun.

I have to do choices :
- to define lazy list with function I propose to use a fonction which takes 2 arguments : the rank of the element to compute and all the already computed elements
- Currently, the _add_ method force the computation of all the elements : that's very annoying for not finite iterator. I suppressed it, for the moment.

Give me feedback !

Thanks

---
New commits:



---

archive/issue_comments_206218.json:
```json
{
    "body": "<a id='comment:23'></a>Comments (IMPORTANT: I have hardly any understanding of python/cython necessities, so some of these may be very naive or stupid)\n\n1.) Concerning the *original* `lazy_list`, I would have expected that\n\n\n```\nsage: from sage.misc.lazy_list import lazy_list\nsage: l = lazy_list(Primes())\nsage: l[:100]\n```\n\nreturns a list, not a lazy list.  (I'm aware of `l[:100].list()`, but this seems inconsistent: `l[0]` also returns an element, not a lazy list)\n\nDo you know a reason for this decision?  Possibly it's more practical, right?\n\n2.) Concerning the *new* `lazy_list` some things clearly don't work:\n\n```\nsage: from sage.misc.lazy_list import lazy_list_from_iterator\nsage: from itertools import count\nsage: l2 = lazy_list_from_iterator(count()); l2\nlazy list [0, 1, 2, ...]\nsage: l2[:10]\n(0, 10, 1)\nsage: l2[10]\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-8-02ea92939ca1> in <module>()\n----> 1 l2[Integer(10)]\n\n/home/rubey/sage-lazy_list/local/lib/python2.7/site-packages/sage/misc/lazy_list.so in sage.misc.lazy_list.lazy_list_from_iterator.__getitem__ (build/cythonized/sage/misc/lazy_list.c:6074)()\n\nTypeError: 'int' object is not iterable\n```\n\n3.) Yes, I think that `lazy_list_from_fun` (besides: I would prefer `lazy_list_from_function`) should do precisely as you say.  Currently, it doesn't: I would have expected the following to return\na lazy list full of empty lists...\n\n```\nsage: l3 = lazy_list_from_fun(lambda a, b: b); l3\nlazy list [[[...], [...], [...], [...]], [[...], [...], [...], [...]], [[...], [...], [...], [...]], ...]\n```\n\n4.) There are now two entry points: `lazy_list_from_fun` and `lazy_list_from_iterator`.  I would expect that in the end there is also a general purpose constructor which decides what to use\ndepending on the type of the argument, right?",
    "created_at": "2014-12-10T08:33:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206218",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:23'></a>Comments (IMPORTANT: I have hardly any understanding of python/cython necessities, so some of these may be very naive or stupid)

1.) Concerning the *original* `lazy_list`, I would have expected that


```
sage: from sage.misc.lazy_list import lazy_list
sage: l = lazy_list(Primes())
sage: l[:100]
```

returns a list, not a lazy list.  (I'm aware of `l[:100].list()`, but this seems inconsistent: `l[0]` also returns an element, not a lazy list)

Do you know a reason for this decision?  Possibly it's more practical, right?

2.) Concerning the *new* `lazy_list` some things clearly don't work:

```
sage: from sage.misc.lazy_list import lazy_list_from_iterator
sage: from itertools import count
sage: l2 = lazy_list_from_iterator(count()); l2
lazy list [0, 1, 2, ...]
sage: l2[:10]
(0, 10, 1)
sage: l2[10]
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-8-02ea92939ca1> in <module>()
----> 1 l2[Integer(10)]

/home/rubey/sage-lazy_list/local/lib/python2.7/site-packages/sage/misc/lazy_list.so in sage.misc.lazy_list.lazy_list_from_iterator.__getitem__ (build/cythonized/sage/misc/lazy_list.c:6074)()

TypeError: 'int' object is not iterable
```

3.) Yes, I think that `lazy_list_from_fun` (besides: I would prefer `lazy_list_from_function`) should do precisely as you say.  Currently, it doesn't: I would have expected the following to return
a lazy list full of empty lists...

```
sage: l3 = lazy_list_from_fun(lambda a, b: b); l3
lazy list [[[...], [...], [...], [...]], [[...], [...], [...], [...]], [[...], [...], [...], [...]], ...]
```

4.) There are now two entry points: `lazy_list_from_fun` and `lazy_list_from_iterator`.  I would expect that in the end there is also a general purpose constructor which decides what to use
depending on the type of the argument, right?



---

archive/issue_comments_206219.json:
```json
{
    "body": "<a id='comment:24'></a>Hello,\n\nCool. Thanks Matthieu!\n\n1) Please use complete names `lazy_list_from_function` and not abreviations. (see also item 3 of Martin)\n\n2) For your specifications, I really do not think it is the best way to do. Very often you have functions that update *many* values at a time (think about Newton method, or substitutively defined sequences). I would prefer much more `lazy_list_from_function` whose argument would be a function `f(computed_values)` and which would update the list `computed_values` with one iteration of the algorithm (and return nothing or possibly an error code). And it has no sense to send the size of the cache to that function (since it is a list and a list knows its length).\n\n3) I think we need more classes (I am not convinced by all names). Some of them might be implemented in further tickets\n\n```\nlazy_list: abstract class\n |\n +-- lazy_list_periodic: ultimately periodic lazy list (attributes=two lists)\n |\n +-- lazy_list_explicit: (attribute=function n-> u_n)\n |\n +-- lazy_list_concatenation: a concatenation of a finite liste and a lazy list\n |\n +-- lazy_list_slice: a slice of another lazy list\n |\n +-- lazy_list_with_cache: a cache management\n      |\n      +-- lazy_list_from_iterator: the old lazy_list\n      |\n      +-- lazy_list_from_function: update function (basically what you did)\n```\n\n4) we need a unique entry point for all these classes which must be of course `lazy_list`.\n\n5) In the old implementation `lazy_list` were immutable. It has the advantage of having shared slices. On the other hand it is annoying because they are immutable and hence it will be forbidden to have operations like \"f += 1\" without a (light) copy.\n\nVincent",
    "created_at": "2014-12-10T09:48:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206219",
    "user": "https://github.com/videlec"
}
```

<a id='comment:24'></a>Hello,

Cool. Thanks Matthieu!

1) Please use complete names `lazy_list_from_function` and not abreviations. (see also item 3 of Martin)

2) For your specifications, I really do not think it is the best way to do. Very often you have functions that update *many* values at a time (think about Newton method, or substitutively defined sequences). I would prefer much more `lazy_list_from_function` whose argument would be a function `f(computed_values)` and which would update the list `computed_values` with one iteration of the algorithm (and return nothing or possibly an error code). And it has no sense to send the size of the cache to that function (since it is a list and a list knows its length).

3) I think we need more classes (I am not convinced by all names). Some of them might be implemented in further tickets

```
lazy_list: abstract class
 |
 +-- lazy_list_periodic: ultimately periodic lazy list (attributes=two lists)
 |
 +-- lazy_list_explicit: (attribute=function n-> u_n)
 |
 +-- lazy_list_concatenation: a concatenation of a finite liste and a lazy list
 |
 +-- lazy_list_slice: a slice of another lazy list
 |
 +-- lazy_list_with_cache: a cache management
      |
      +-- lazy_list_from_iterator: the old lazy_list
      |
      +-- lazy_list_from_function: update function (basically what you did)
```

4) we need a unique entry point for all these classes which must be of course `lazy_list`.

5) In the old implementation `lazy_list` were immutable. It has the advantage of having shared slices. On the other hand it is annoying because they are immutable and hence it will be forbidden to have operations like "f += 1" without a (light) copy.

Vincent



---

archive/issue_comments_206220.json:
```json
{
    "body": "<a id='comment:25'></a>Replying to [comment:24 vdelecroix]:\n\n> Cool. Thanks Matthieu!\n\n\na second that!  Sorry about not having mentioned that earlier!\n\n> 2) [...] I would prefer much more `lazy_list_from_function` whose argument would be a function `f(computed_values)` and which would update the list `computed_values` with one iteration of the algorithm (and return nothing or possibly an error code). And it has no sense to send the size of the cache to that function (since it is a list and a list knows its length).\n\n\nOK, I didn't know that python's lists know their length, so +1\n\n> 3) I think we need more classes\n\n\nI think we should try to avoid redundancy.  I guess, redundancy will be obvious once coded...\n\nHowever, I also thought that something like `lazy_list_explicit` would be very useful.  I'm not sure: is turning on caching for a function in python easy enough so that a cached variant of this would not make sense?\n\n> 5) In the old implementation `lazy_list` were immutable. It has the advantage of having shared slices. On the other hand it is annoying because they are immutable and hence it will be forbidden to have operations like \"f += 1\" without a (light) copy.\n\n\nAt least for the applications I have in mind, I think immutability is fine.  For example, we will have lazy formal power series, and I certainly do not want to make assignments to those possible.  (Think of students who prove to me that `exp(z)` equals 2 :-)\n\nMartin",
    "created_at": "2014-12-10T10:05:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206220",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:25'></a>Replying to [comment:24 vdelecroix]:

> Cool. Thanks Matthieu!


a second that!  Sorry about not having mentioned that earlier!

> 2) [...] I would prefer much more `lazy_list_from_function` whose argument would be a function `f(computed_values)` and which would update the list `computed_values` with one iteration of the algorithm (and return nothing or possibly an error code). And it has no sense to send the size of the cache to that function (since it is a list and a list knows its length).


OK, I didn't know that python's lists know their length, so +1

> 3) I think we need more classes


I think we should try to avoid redundancy.  I guess, redundancy will be obvious once coded...

However, I also thought that something like `lazy_list_explicit` would be very useful.  I'm not sure: is turning on caching for a function in python easy enough so that a cached variant of this would not make sense?

> 5) In the old implementation `lazy_list` were immutable. It has the advantage of having shared slices. On the other hand it is annoying because they are immutable and hence it will be forbidden to have operations like "f += 1" without a (light) copy.


At least for the applications I have in mind, I think immutability is fine.  For example, we will have lazy formal power series, and I certainly do not want to make assignments to those possible.  (Think of students who prove to me that `exp(z)` equals 2 :-)

Martin



---

archive/issue_comments_206221.json:
```json
{
    "body": "<a id='comment:26'></a>Another comment: I just killed my sage session by asking for the list of all integers.  Is there a possibility to make `.list()` interruptable?\n\nMartin",
    "created_at": "2014-12-10T10:08:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206221",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:26'></a>Another comment: I just killed my sage session by asking for the list of all integers.  Is there a possibility to make `.list()` interruptable?

Martin



---

archive/issue_comments_206222.json:
```json
{
    "body": "<a id='comment:27'></a>I do not understand what `normalize_slice` does.  If I pass an integer, I get that integer plus one.  Is this intentional?",
    "created_at": "2014-12-10T10:26:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206222",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:27'></a>I do not understand what `normalize_slice` does.  If I pass an integer, I get that integer plus one.  Is this intentional?



---

archive/issue_comments_206223.json:
```json
{
    "body": "<a id='comment:28'></a>Replying to [comment:25 mantepse]:\n> Replying to [comment:24 vdelecroix]:\n\n\n> > 3) I think we need more classes\n\n> \n> I think we should try to avoid redundancy.  I guess, redundancy will be obvious once coded...\n> \n> However, I also thought that something like `lazy_list_explicit` would be very useful.  I'm not sure: is turning on caching for a function in python easy enough so that a cached variant of this would not make sense?\n\n\nyes, but right now only in Sage:\n\n```\nsage: f = lambda n: n*(n+1)/2\nsage: f_cached = cached_function(f)\nsage: f_cached(10)\n55\nsage: f_cached.get_cache()\n{((10,), ()): 55}\n```",
    "created_at": "2014-12-10T11:32:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206223",
    "user": "https://github.com/videlec"
}
```

<a id='comment:28'></a>Replying to [comment:25 mantepse]:
> Replying to [comment:24 vdelecroix]:


> > 3) I think we need more classes

> 
> I think we should try to avoid redundancy.  I guess, redundancy will be obvious once coded...
> 
> However, I also thought that something like `lazy_list_explicit` would be very useful.  I'm not sure: is turning on caching for a function in python easy enough so that a cached variant of this would not make sense?


yes, but right now only in Sage:

```
sage: f = lambda n: n*(n+1)/2
sage: f_cached = cached_function(f)
sage: f_cached(10)
55
sage: f_cached.get_cache()
{((10,), ()): 55}
```



---

archive/issue_comments_206224.json:
```json
{
    "body": "<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-12-10T11:54:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206224",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_206225.json:
```json
{
    "body": "<a id='comment:30'></a>Thanks for the update!  `lazy_list_from_iterator` seems fine now.  Could you nevertheless say what `normalize_slice` does?\n\nFor `lazy_list_from_function` I now get:\n\n```\nsage: from sage.misc.lazy_list import lazy_list_from_function\nsage: from itertools import count\nsage: f = lazy_list_from_function(lambda a, b: a)\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n<ipython-input-96-f1659b043f2a> in <module>()\n----> 1 f = lazy_list_from_function(lambda a, b: a)\n\n/home/rubey/sage-lazy_list/local/lib/python2.7/site-packages/sage/misc/lazy_list.so in sage.misc.lazy_list.lazy_list_from_function.__init__ (build/cythonized/sage/misc/lazy_list.c:6520)()\n\nAttributeError: 'sage.misc.lazy_list.lazy_list_from_function' object has no attribute 'fun'\n```",
    "created_at": "2014-12-10T13:45:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206225",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:30'></a>Thanks for the update!  `lazy_list_from_iterator` seems fine now.  Could you nevertheless say what `normalize_slice` does?

For `lazy_list_from_function` I now get:

```
sage: from sage.misc.lazy_list import lazy_list_from_function
sage: from itertools import count
sage: f = lazy_list_from_function(lambda a, b: a)
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-96-f1659b043f2a> in <module>()
----> 1 f = lazy_list_from_function(lambda a, b: a)

/home/rubey/sage-lazy_list/local/lib/python2.7/site-packages/sage/misc/lazy_list.so in sage.misc.lazy_list.lazy_list_from_function.__init__ (build/cythonized/sage/misc/lazy_list.c:6520)()

AttributeError: 'sage.misc.lazy_list.lazy_list_from_function' object has no attribute 'fun'
```



---

archive/issue_comments_206226.json:
```json
{
    "body": "<a id='comment:31'></a>> For `lazy_list_from_function` I now get: [...]\n\n\nOK, that was easy to fix, in the `pxd` the class was still named `lazy_list_from_fun`.  I actually replaced all occurrences of `fun` by `function` in both files, to obtain uniform coding style.\n\nHowever, it appears that I cannot push my changes.  What should I do?",
    "created_at": "2014-12-10T16:55:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206226",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:31'></a>> For `lazy_list_from_function` I now get: [...]


OK, that was easy to fix, in the `pxd` the class was still named `lazy_list_from_fun`.  I actually replaced all occurrences of `fun` by `function` in both files, to obtain uniform coding style.

However, it appears that I cannot push my changes.  What should I do?



---

archive/issue_comments_206227.json:
```json
{
    "body": "<a id='comment:32'></a>Replying to [comment:31 mantepse]:\n> > For `lazy_list_from_function` I now get: [...]\n\n> \n> OK, that was easy to fix, in the `pxd` the class was still named `lazy_list_from_fun`.  I actually replaced all occurrences of `fun` by `function` in both files, to obtain uniform coding style.\n> \n> However, it appears that I cannot push my changes.  What should I do?\n\n\nWhat do you mean? One solution is to push to another branch.\n\nVincent",
    "created_at": "2014-12-10T17:03:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206227",
    "user": "https://github.com/videlec"
}
```

<a id='comment:32'></a>Replying to [comment:31 mantepse]:
> > For `lazy_list_from_function` I now get: [...]

> 
> OK, that was easy to fix, in the `pxd` the class was still named `lazy_list_from_fun`.  I actually replaced all occurrences of `fun` by `function` in both files, to obtain uniform coding style.
> 
> However, it appears that I cannot push my changes.  What should I do?


What do you mean? One solution is to push to another branch.

Vincent



---

archive/issue_comments_206228.json:
```json
{
    "body": "<a id='comment:33'></a>Thanks for the hint, I pushed to a new branch `public/lazy_list_from_various_input_data`.  Could you check whether this worked?",
    "created_at": "2014-12-10T20:06:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206228",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:33'></a>Thanks for the hint, I pushed to a new branch `public/lazy_list_from_various_input_data`.  Could you check whether this worked?



---

archive/issue_comments_206229.json:
```json
{
    "body": "<a id='comment:34'></a>Replying to [comment:33 mantepse]:\n> Thanks for the hint, I pushed to a new branch `public/lazy_list_from_various_input_data`.  Could you check whether this worked?\n\n\nNo. The branch does exist but the last commit is \u200b46503af (i.e. not different from Matthieu's one). Did you forgot to commit your changes? What does `git log` tell you?",
    "created_at": "2014-12-10T20:31:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206229",
    "user": "https://github.com/videlec"
}
```

<a id='comment:34'></a>Replying to [comment:33 mantepse]:
> Thanks for the hint, I pushed to a new branch `public/lazy_list_from_various_input_data`.  Could you check whether this worked?


No. The branch does exist but the last commit is ​46503af (i.e. not different from Matthieu's one). Did you forgot to commit your changes? What does `git log` tell you?



---

archive/issue_comments_206230.json:
```json
{
    "body": "<a id='comment:35'></a>Oh no!  I thought git push would be enough...  Could you check again now, please...",
    "created_at": "2014-12-10T20:54:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206230",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:35'></a>Oh no!  I thought git push would be enough...  Could you check again now, please...



---

archive/issue_comments_206231.json:
```json
{
    "body": "<a id='comment:36'></a>You can have a look directly there: http://git.sagemath.org/sage.git/log/?h=public/lazy_list_from_various_input_data\nand see that there is no other commit beyond \u200b46503af. If after a `git log` you do not see your commit on your computer, there is no way that something appear after a push on the remote one.",
    "created_at": "2014-12-11T06:36:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206231",
    "user": "https://github.com/videlec"
}
```

<a id='comment:36'></a>You can have a look directly there: http://git.sagemath.org/sage.git/log/?h=public/lazy_list_from_various_input_data
and see that there is no other commit beyond ​46503af. If after a `git log` you do not see your commit on your computer, there is no way that something appear after a push on the remote one.



---

archive/issue_comments_206232.json:
```json
{
    "body": "<a id='comment:37'></a>It worked!  Many thanks for your patience!  I should have rtfm :-)",
    "created_at": "2014-12-11T07:46:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206232",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:37'></a>It worked!  Many thanks for your patience!  I should have rtfm :-)



---

archive/issue_comments_206233.json:
```json
{
    "body": "<a id='comment:38'></a>New commits:",
    "created_at": "2014-12-11T07:55:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206233",
    "user": "https://github.com/MatthieuDien"
}
```

<a id='comment:38'></a>New commits:



---

archive/issue_comments_206234.json:
```json
{
    "body": "<a id='comment:39'></a>Thanks for your feedback and your help.\nI have also set the ticket's branch to the public one.",
    "created_at": "2014-12-11T07:57:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206234",
    "user": "https://github.com/MatthieuDien"
}
```

<a id='comment:39'></a>Thanks for your feedback and your help.
I have also set the ticket's branch to the public one.



---

archive/issue_comments_206235.json:
```json
{
    "body": "<a id='comment:40'></a>Great!  I'm now going to make `function` take one argument only, and I volunteer to clean up the examples there (but probably not right now).\n\nDo you think it's possible to have list comprehensions for `lazy_list`?  FriCAS allows things like:\n\n```\n[i^2 for i in 1.. | prime? i]\n```\n\nOtherwise, we need at least a function that makes a new `lazy_list` by applying a function (`lazy_list_explicit` might do) but also a way to select members from a `lazy_list`.",
    "created_at": "2014-12-11T08:12:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206235",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:40'></a>Great!  I'm now going to make `function` take one argument only, and I volunteer to clean up the examples there (but probably not right now).

Do you think it's possible to have list comprehensions for `lazy_list`?  FriCAS allows things like:

```
[i^2 for i in 1.. | prime? i]
```

Otherwise, we need at least a function that makes a new `lazy_list` by applying a function (`lazy_list_explicit` might do) but also a way to select members from a `lazy_list`.



---

archive/issue_comments_206236.json:
```json
{
    "body": "<a id='comment:41'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-12-11T08:32:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206236",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:41'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_206237.json:
```json
{
    "body": "<a id='comment:42'></a>Although less elegant, we can do the following:\n\n```\nsage: m = lazy_list_from_function(len); m\nlazy list [0, 1, 2, ...]\nsage: m2 = lazy_list_from_iterator(ifilter(is_prime, m)); m2\nlazy list [2, 3, 5, ...]\nsage: m3 = lazy_list_from_iterator(imap(lambda a: a^2, m2)); m3\nlazy list [4, 9, 25, ...]\n```\n\nNow I'm not quite sure anymore what the difference between an iterator and a lazy list is precisely.  Is it just the caching?  How do we want to interact with `itertools`?",
    "created_at": "2014-12-11T09:11:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206237",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:42'></a>Although less elegant, we can do the following:

```
sage: m = lazy_list_from_function(len); m
lazy list [0, 1, 2, ...]
sage: m2 = lazy_list_from_iterator(ifilter(is_prime, m)); m2
lazy list [2, 3, 5, ...]
sage: m3 = lazy_list_from_iterator(imap(lambda a: a^2, m2)); m3
lazy list [4, 9, 25, ...]
```

Now I'm not quite sure anymore what the difference between an iterator and a lazy list is precisely.  Is it just the caching?  How do we want to interact with `itertools`?



---

archive/issue_comments_206238.json:
```json
{
    "body": "<a id='comment:43'></a>From a brief look at `itertools`, it seems to me that we should revisit the design decisions.  If I understand correctly, `itertools` provides all the operations we might want, except caching and therefore also the functionality of `lazy_list_from_function`.\n\nLooking at the example in my previous comment, I'm not quite satisfied with the interaction of `lazy_list` and `itertools` yet.  I'm a bit surprised that `itertools` provides functions, not methods.\n\nEdit: I just found a long discussion about the design of iterators, https://mail.python.org/pipermail/python-3000/2006-November/004301.html.",
    "created_at": "2014-12-11T09:30:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206238",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:43'></a>From a brief look at `itertools`, it seems to me that we should revisit the design decisions.  If I understand correctly, `itertools` provides all the operations we might want, except caching and therefore also the functionality of `lazy_list_from_function`.

Looking at the example in my previous comment, I'm not quite satisfied with the interaction of `lazy_list` and `itertools` yet.  I'm a bit surprised that `itertools` provides functions, not methods.

Edit: I just found a long discussion about the design of iterators, https://mail.python.org/pipermail/python-3000/2006-November/004301.html.



---

archive/issue_comments_206239.json:
```json
{
    "body": "<a id='comment:44'></a>Hi there,\n\nI just checked that, in a very rudimentary way, we can define lazy lists recursively, as follows:\n\n```\nsage: from sage.misc.lazy_list import *\nsage: from itertools import *\nsage: l = lazy_list_recursive(cache = [[]])\nsage: l.define(imap(lambda a: [1] + a, l))\nsage: l[0], l[1], l[2]\n([], [1], [1, 1])\n```\n\nI also had to realise that `itertools.product` is not particularly intelligent what concerns infinite streams...\n\nI'll take a break now and wait for feedback.  In summary, it now seems to me that we want `lazy_list`\nto be\n\n* a model for \"infinite lists\", i.e., support slicing\n* play as well as possible with iterators\n* provide functionality that `itertools` cannot provide: \n    * `next` depending on the previous values\n    * possibly recursive definitions\n    * what else?\n* what else?\n\nIn particular, should `lazy_list` additionally provide wrappers for the functionality in `itertools`?  Currently, I don't think so.",
    "created_at": "2014-12-12T08:45:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206239",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:44'></a>Hi there,

I just checked that, in a very rudimentary way, we can define lazy lists recursively, as follows:

```
sage: from sage.misc.lazy_list import *
sage: from itertools import *
sage: l = lazy_list_recursive(cache = [[]])
sage: l.define(imap(lambda a: [1] + a, l))
sage: l[0], l[1], l[2]
([], [1], [1, 1])
```

I also had to realise that `itertools.product` is not particularly intelligent what concerns infinite streams...

I'll take a break now and wait for feedback.  In summary, it now seems to me that we want `lazy_list`
to be

* a model for "infinite lists", i.e., support slicing
* play as well as possible with iterators
* provide functionality that `itertools` cannot provide: 
    * `next` depending on the previous values
    * possibly recursive definitions
    * what else?
* what else?

In particular, should `lazy_list` additionally provide wrappers for the functionality in `itertools`?  Currently, I don't think so.



---

archive/issue_comments_206240.json:
```json
{
    "body": "<a id='comment:45'></a>Hi there,\n\nI found the bug that avoid me to connect on Sage trac (I used my phone's connection).\nSo, I copy the message which I sent by email.\n\n`@`Martin\nThe diference bewteen lazy_list and iterator is not only the caching.\nThere is also the way to compute an element : if you want the nth element of an iterator you have to compute the (n-1) previous ones, for lazy_list (currently the implementation does not do this but it should in close future) the goal is to compute elements only if it obligatory.\nFor example, you don't want to compute all the coeffcients of a serie if at the end, you will only use the odd (or even) part.\nConcerning recursive definition, we have to allow it but the implementation must not be recursive because recursion is extremly expensive in Python.\n\n`@`Vincent\nTo implement this, I need to overload the `_fit` method and pass it in \"`cdef` mode\". I just have a question : why, in the iterator's class, do you use `update_cache_up_to` and not `_fit` ?\n\nAnd finally, to answer to Martin about \"what is `_normalize_slice` ?\", `_normalize_slice` means nothing it is just a piece of code that I wanted to factorize. In fact I should factorize directly `__getitem__` by adding a method which have to create a slice (last line of code `__getitem__`).",
    "created_at": "2014-12-14T11:53:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206240",
    "user": "https://github.com/MatthieuDien"
}
```

<a id='comment:45'></a>Hi there,

I found the bug that avoid me to connect on Sage trac (I used my phone's connection).
So, I copy the message which I sent by email.

`@`Martin
The diference bewteen lazy_list and iterator is not only the caching.
There is also the way to compute an element : if you want the nth element of an iterator you have to compute the (n-1) previous ones, for lazy_list (currently the implementation does not do this but it should in close future) the goal is to compute elements only if it obligatory.
For example, you don't want to compute all the coeffcients of a serie if at the end, you will only use the odd (or even) part.
Concerning recursive definition, we have to allow it but the implementation must not be recursive because recursion is extremly expensive in Python.

`@`Vincent
To implement this, I need to overload the `_fit` method and pass it in "`cdef` mode". I just have a question : why, in the iterator's class, do you use `update_cache_up_to` and not `_fit` ?

And finally, to answer to Martin about "what is `_normalize_slice` ?", `_normalize_slice` means nothing it is just a piece of code that I wanted to factorize. In fact I should factorize directly `__getitem__` by adding a method which have to create a slice (last line of code `__getitem__`).



---

archive/issue_comments_206241.json:
```json
{
    "body": "<a id='comment:46'></a>Therefore, the answer of Martin :\n\n> `@`Martin\n> The diference bewteen lazy_list and iterator is not only the caching.\n> There is also the way to compute an element : if you want the nth\n> element of an iterator you have to compute the (n-1) previous ones,\n> for lazy_list (currently the implementation does not do this but it\n> should in close future) the goal is to compute elements only if it\n> obligatory.\n\n\n> For example, you don't want to compute all the coeffcients of a serie\n> if at the end, you will only use the odd (or even) part.\n\n\nExcellent point!\n\nYou made me think again about the name - I don't particularly like\n\"lazy_list\".  Of course, from a math point of view I'd call it\n\"Sequence\".  However, I just discovered that this is already taken in\nSage for something related, although not identical.\n\nI then discovered \"Family\", which seems the same but a bit more general.\nIn fact, \"lazy_list\" is a Family having index set natural numbers.\n\nShouldn't we merge these two concepts, at least in the long run?\n\n> Concerning recursive definition, we have to allow it but the\n> implementation must not be recursive because recursion is extremly\n> expensive in Python.\n\n\nI'm not quite sure what you mean.  There is hardly any implementation.\nI want that definitions like s = f(s), where \"s\" is a \"lazy list\"\ndetermined by this equation, can be easily typed into sage.\n\nThus, I think of it as a convenience feature, for rapid prototyping.\nIts usefulness lies in the fact that it's very general.  Thus, from the\nuser's perspective, I wouldn't expect it to do any fancy term-rewriting.\n\n> And finally, to answer to Martin about \"what is `_normalize_slice` ?\n> \", `_normalize_slice` means nothing it is just a piece of code that I\n> wanted to factorize. In fact I should factorize directly `__getitem__\n> ` by adding a method which have to create a slice (last line of code\n> `__getitem__`).\n\n\nOK, thanks!\n\nBest,\n\nMartin",
    "created_at": "2014-12-14T11:54:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206241",
    "user": "https://github.com/MatthieuDien"
}
```

<a id='comment:46'></a>Therefore, the answer of Martin :

> `@`Martin
> The diference bewteen lazy_list and iterator is not only the caching.
> There is also the way to compute an element : if you want the nth
> element of an iterator you have to compute the (n-1) previous ones,
> for lazy_list (currently the implementation does not do this but it
> should in close future) the goal is to compute elements only if it
> obligatory.


> For example, you don't want to compute all the coeffcients of a serie
> if at the end, you will only use the odd (or even) part.


Excellent point!

You made me think again about the name - I don't particularly like
"lazy_list".  Of course, from a math point of view I'd call it
"Sequence".  However, I just discovered that this is already taken in
Sage for something related, although not identical.

I then discovered "Family", which seems the same but a bit more general.
In fact, "lazy_list" is a Family having index set natural numbers.

Shouldn't we merge these two concepts, at least in the long run?

> Concerning recursive definition, we have to allow it but the
> implementation must not be recursive because recursion is extremly
> expensive in Python.


I'm not quite sure what you mean.  There is hardly any implementation.
I want that definitions like s = f(s), where "s" is a "lazy list"
determined by this equation, can be easily typed into sage.

Thus, I think of it as a convenience feature, for rapid prototyping.
Its usefulness lies in the fact that it's very general.  Thus, from the
user's perspective, I wouldn't expect it to do any fancy term-rewriting.

> And finally, to answer to Martin about "what is `_normalize_slice` ?
> ", `_normalize_slice` means nothing it is just a piece of code that I
> wanted to factorize. In fact I should factorize directly `__getitem__
> ` by adding a method which have to create a slice (last line of code
> `__getitem__`).


OK, thanks!

Best,

Martin



---

archive/issue_comments_206242.json:
```json
{
    "body": "<a id='comment:47'></a>Should we ask about the desired relationship between `Family`, `Sequence` and `lazy_list` on sage-devel?",
    "created_at": "2014-12-16T07:45:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206242",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:47'></a>Should we ask about the desired relationship between `Family`, `Sequence` and `lazy_list` on sage-devel?



---

archive/issue_comments_206243.json:
```json
{
    "body": "<a id='comment:48'></a>Replying to [comment:47 mantepse]:\n> Should we ask about the desired relationship between `Family`, `Sequence` and `lazy_list` on sage-devel?\n\n\nThere is already a ticket for that [ticket:16107 #16107] but we can ask on sage-devel for more feedback.\n\nConcerning `Family`, I read documentation and code. That seems cool but not the same goal that `lazy_list`, especially concerning the definitions of such objects (`Family` can only be defined by iterable objects).",
    "created_at": "2014-12-16T09:22:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206243",
    "user": "https://github.com/MatthieuDien"
}
```

<a id='comment:48'></a>Replying to [comment:47 mantepse]:
> Should we ask about the desired relationship between `Family`, `Sequence` and `lazy_list` on sage-devel?


There is already a ticket for that [ticket:16107 #16107] but we can ask on sage-devel for more feedback.

Concerning `Family`, I read documentation and code. That seems cool but not the same goal that `lazy_list`, especially concerning the definitions of such objects (`Family` can only be defined by iterable objects).



---

archive/issue_comments_206244.json:
```json
{
    "body": "<a id='comment:49'></a>Thanks for pointing out #16107, I added the `LazyPowerSeries` keyword there!\n\nI don't understand your assessment of `Family` though, why should it have a different goal?  At the very least, `lazy_list` should inherit from `Family`, no?",
    "created_at": "2014-12-16T10:08:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206244",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:49'></a>Thanks for pointing out #16107, I added the `LazyPowerSeries` keyword there!

I don't understand your assessment of `Family` though, why should it have a different goal?  At the very least, `lazy_list` should inherit from `Family`, no?



---

archive/issue_comments_206245.json:
```json
{
    "body": "<a id='comment:50'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-01-13T15:04:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206245",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:50'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_206246.json:
```json
{
    "body": "<a id='comment:51'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-01-14T14:29:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206246",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:51'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_206247.json:
```json
{
    "body": "<a id='comment:52'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-01-14T21:08:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206247",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:52'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_206248.json:
```json
{
    "body": "<a id='comment:53'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-01-15T09:38:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206248",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:53'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_206249.json:
```json
{
    "body": "<a id='comment:54'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-01-15T14:55:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206249",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:54'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_206250.json:
```json
{
    "body": "<a id='comment:55'></a>Hi there,\n\nI implemented almost everyting. I still have to :\n- make the factory\n- do some factorizations of code\n- document and test the code\n\nI think that is the moment to ask you to try this implementation and tell me if there are any problems with the implementations or the design choices.\n\nBest\n\nMatthieu",
    "created_at": "2015-01-16T08:13:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206250",
    "user": "https://github.com/MatthieuDien"
}
```

<a id='comment:55'></a>Hi there,

I implemented almost everyting. I still have to :
- make the factory
- do some factorizations of code
- document and test the code

I think that is the moment to ask you to try this implementation and tell me if there are any problems with the implementations or the design choices.

Best

Matthieu



---

archive/issue_comments_206251.json:
```json
{
    "body": "<a id='comment:56'></a>Hi Matthieu!\n\nI watched you work :-)  THANK YOU!!!\n\nRight now I have only two comments:\n\n1.)  I think the naming scheme for the classes should be changed:\n\na) `from_iterator` is fine\nb) `from_function` is misleading.  In fact, in analogy to a) I would expect this class to do precisely what `explicit` does.  Isn't it precisely `recursive`?\nc) `explicit` should in my opinion be named `from_function`\nd) `periodic` is fine\n\nI also would suggest to change `stopped` to `terminating` or `finite`.\n\n2.) I still don't understand the relationship with `Family`.  I guess it's fine not to consider `Sequence` right now, but I think the relationship with `Family` should be clarified.  As a concrete question: should `Family` use `lazy_list` for sequences?",
    "created_at": "2015-01-16T08:48:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206251",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:56'></a>Hi Matthieu!

I watched you work :-)  THANK YOU!!!

Right now I have only two comments:

1.)  I think the naming scheme for the classes should be changed:

a) `from_iterator` is fine
b) `from_function` is misleading.  In fact, in analogy to a) I would expect this class to do precisely what `explicit` does.  Isn't it precisely `recursive`?
c) `explicit` should in my opinion be named `from_function`
d) `periodic` is fine

I also would suggest to change `stopped` to `terminating` or `finite`.

2.) I still don't understand the relationship with `Family`.  I guess it's fine not to consider `Sequence` right now, but I think the relationship with `Family` should be clarified.  As a concrete question: should `Family` use `lazy_list` for sequences?



---

archive/issue_comments_206252.json:
```json
{
    "body": "<a id='comment:57'></a>Hi Matthieu,\n\nIt would be nice to write documentation in the classes, particularly\n- what is the input\n- how does it work internally\nIt would help me to read your code.\n\nDo you really want to keep the ``start, stop, step`` for all classes? I would rather add a class `lazy_list_slice` which does the job.\n\nI do not understand anything to `lazy_list_explicit`. Why do you use a cache mechanism for it? Moreover, the following\n\n```\ncdef int update_cache_up_to(self, Py_ssize_t i) except -1:\n    while PyList_GET_SIZE(self.cache) <= i:\n        PyList_Append(self.cache, None)\n```\nis definitely useless since you can use the `self.cache.extend([None]*length)` which would be much faster.\n\nAre you sure you understand the point of `Py_INCREF(object)`? If you call it when you should not, it implies that the object will *never* be garbage collected. The call to this function is generally not needed in Cython file.\n\nNow Cython supports iterator, i.e. you can write\n\n```\ncdef class MyClass(X):\n    def __iter__(self):\n        cdef Py_ssize_t i\n        for i in range(self.x,self.y,self.z):\n            yield self.cache[i]\n```\nSo I would remove all iterators \"XYZ_iterator\" and implement directly the methods `__iter__` when possible.\n\nIf you add the line\n\n```\ninclude \"sage/ext/stdsage.pxi\"\n```\nat the begining of the file you have access to better then \"isinstance\" to test the type of an object\n\n```\nPY_TYPE_CHECK(object)\nPY_TYPE_CHECK_EXACT(object)\n```\n\nI have much more comments. I could also edit directly the file.\n\nVincent",
    "created_at": "2015-01-17T09:38:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206252",
    "user": "https://github.com/videlec"
}
```

<a id='comment:57'></a>Hi Matthieu,

It would be nice to write documentation in the classes, particularly
- what is the input
- how does it work internally
It would help me to read your code.

Do you really want to keep the ``start, stop, step`` for all classes? I would rather add a class `lazy_list_slice` which does the job.

I do not understand anything to `lazy_list_explicit`. Why do you use a cache mechanism for it? Moreover, the following

```
cdef int update_cache_up_to(self, Py_ssize_t i) except -1:
    while PyList_GET_SIZE(self.cache) <= i:
        PyList_Append(self.cache, None)
```
is definitely useless since you can use the `self.cache.extend([None]*length)` which would be much faster.

Are you sure you understand the point of `Py_INCREF(object)`? If you call it when you should not, it implies that the object will *never* be garbage collected. The call to this function is generally not needed in Cython file.

Now Cython supports iterator, i.e. you can write

```
cdef class MyClass(X):
    def __iter__(self):
        cdef Py_ssize_t i
        for i in range(self.x,self.y,self.z):
            yield self.cache[i]
```
So I would remove all iterators "XYZ_iterator" and implement directly the methods `__iter__` when possible.

If you add the line

```
include "sage/ext/stdsage.pxi"
```
at the begining of the file you have access to better then "isinstance" to test the type of an object

```
PY_TYPE_CHECK(object)
PY_TYPE_CHECK_EXACT(object)
```

I have much more comments. I could also edit directly the file.

Vincent



---

archive/issue_comments_206253.json:
```json
{
    "body": "<a id='comment:58'></a>Hi there,\n\nThanks you very much for the answers.\nI will try to justify some of my choices and answer to some of your new questions.\n\nReplying to [comment:57 vdelecroix]:\n> Hi Matthieu,\n> \n> It would be nice to write documentation in the classes, particularly\n> - what is the input\n> - how does it work internally\n> It would help me to read your code.\n\n\nYes, I have to do this\n\n> Do you really want to keep the ``start, stop, step`` for all classes? I would rather add a class `lazy_list_slice` which does the job.\n\n\nI agree.\n\n> I do not understand anything to `lazy_list_explicit`. Why do you use a cache mechanism for it? Moreover, the following\n> \n> ```\n> cdef int update_cache_up_to(self, Py_ssize_t i) except -1:\n>     while PyList_GET_SIZE(self.cache) <= i:\n>         PyList_Append(self.cache, None)\n> ```\n> is definitely useless since you can use the `self.cache.extend([None]*length)` which would be much faster.\n\n\nThanks for the hint, I did not know `extend`.\nConcerning the usage of a cache mechanism for `lazy_list_explicit`, it is because the computation of a list's cell can be long (for example when you compute the Cauchy's product during a lazy series' multiplication). Then, the cache mechanism allows to compute only one time the value contained in a cell.\n\n> Are you sure you understand the point of `Py_INCREF(object)`? If you call it when you should not, it implies that the object will *never* be garbage collected. The call to this function is generally not needed in Cython file.\n\n\nFor this point, I have to check that the value is garbage collected, but without this instruction, the value is garbage collected instantly.\n\n> Now Cython supports iterator, i.e. you can write\n> \n> ```\n> cdef class MyClass(X):\n>     def __iter__(self):\n>         cdef Py_ssize_t i\n>         for i in range(self.x,self.y,self.z):\n>             yield self.cache[i]\n> ```\n> So I would remove all iterators \"XYZ_iterator\" and implement directly the methods `__iter__` when possible.\n\n\nOk, I did not know this. I will benchmark the both approaches.\n\n> If you add the line\n> \n> ```\n> include \"sage/ext/stdsage.pxi\"\n> ```\n> at the begining of the file you have access to better then \"isinstance\" to test the type of an object\n> \n> ```\n> PY_TYPE_CHECK(object)\n> PY_TYPE_CHECK_EXACT(object)\n> ```\n\n\nThanks for the hint.\n\n> I have much more comments. I could also edit directly the file.\n> Vincent\n\n\n\n\nReplying to [comment:56 mantepse]:\n>Hi Matthieu!\n\n\n>I watched you work :-) THANK YOU!!!\n\n\n>Right now I have only two comments:\n\n\n>1.) I think the naming scheme for the classes should be changed:\n\n\n>a) from_iterator is fine\n>b) from_function is misleading. In fact, in analogy to a) I would expect this class to do precisely >what explicit does. Isn't it precisely recursive?\n\n`from_function` is recursive yes. Do you have an idea about the name (I am really bad to choose name ..) ?\n>c) explicit should in my opinion be named from_function\n>d) periodic is fine\n\n\n>I also would suggest to change stopped to terminating or finite.\n\n`finite` looks better to me, if Vincent agrees ?\n\n>2.) I still don't understand the relationship with Family. I guess it's fine not to consider >Sequence right now, but I think the relationship with Family should be clarified. As a concrete >question: should Family use lazy_list for sequences?\n\nI think that this question deserves a new ticket because it can involve modification of the code in an other part of Sage. We can work on it if you want.\n\n\nMatthieu",
    "created_at": "2015-01-19T10:35:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206253",
    "user": "https://github.com/MatthieuDien"
}
```

<a id='comment:58'></a>Hi there,

Thanks you very much for the answers.
I will try to justify some of my choices and answer to some of your new questions.

Replying to [comment:57 vdelecroix]:
> Hi Matthieu,
> 
> It would be nice to write documentation in the classes, particularly
> - what is the input
> - how does it work internally
> It would help me to read your code.


Yes, I have to do this

> Do you really want to keep the ``start, stop, step`` for all classes? I would rather add a class `lazy_list_slice` which does the job.


I agree.

> I do not understand anything to `lazy_list_explicit`. Why do you use a cache mechanism for it? Moreover, the following
> 
> ```
> cdef int update_cache_up_to(self, Py_ssize_t i) except -1:
>     while PyList_GET_SIZE(self.cache) <= i:
>         PyList_Append(self.cache, None)
> ```
> is definitely useless since you can use the `self.cache.extend([None]*length)` which would be much faster.


Thanks for the hint, I did not know `extend`.
Concerning the usage of a cache mechanism for `lazy_list_explicit`, it is because the computation of a list's cell can be long (for example when you compute the Cauchy's product during a lazy series' multiplication). Then, the cache mechanism allows to compute only one time the value contained in a cell.

> Are you sure you understand the point of `Py_INCREF(object)`? If you call it when you should not, it implies that the object will *never* be garbage collected. The call to this function is generally not needed in Cython file.


For this point, I have to check that the value is garbage collected, but without this instruction, the value is garbage collected instantly.

> Now Cython supports iterator, i.e. you can write
> 
> ```
> cdef class MyClass(X):
>     def __iter__(self):
>         cdef Py_ssize_t i
>         for i in range(self.x,self.y,self.z):
>             yield self.cache[i]
> ```
> So I would remove all iterators "XYZ_iterator" and implement directly the methods `__iter__` when possible.


Ok, I did not know this. I will benchmark the both approaches.

> If you add the line
> 
> ```
> include "sage/ext/stdsage.pxi"
> ```
> at the begining of the file you have access to better then "isinstance" to test the type of an object
> 
> ```
> PY_TYPE_CHECK(object)
> PY_TYPE_CHECK_EXACT(object)
> ```


Thanks for the hint.

> I have much more comments. I could also edit directly the file.
> Vincent




Replying to [comment:56 mantepse]:
>Hi Matthieu!


>I watched you work :-) THANK YOU!!!


>Right now I have only two comments:


>1.) I think the naming scheme for the classes should be changed:


>a) from_iterator is fine
>b) from_function is misleading. In fact, in analogy to a) I would expect this class to do precisely >what explicit does. Isn't it precisely recursive?

`from_function` is recursive yes. Do you have an idea about the name (I am really bad to choose name ..) ?
>c) explicit should in my opinion be named from_function
>d) periodic is fine


>I also would suggest to change stopped to terminating or finite.

`finite` looks better to me, if Vincent agrees ?

>2.) I still don't understand the relationship with Family. I guess it's fine not to consider >Sequence right now, but I think the relationship with Family should be clarified. As a concrete >question: should Family use lazy_list for sequences?

I think that this question deserves a new ticket because it can involve modification of the code in an other part of Sage. We can work on it if you want.


Matthieu



---

archive/issue_comments_206254.json:
```json
{
    "body": "<a id='comment:59'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-04T16:29:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206254",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:59'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_206255.json:
```json
{
    "body": "<a id='comment:60'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-05T10:31:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206255",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:60'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_206256.json:
```json
{
    "body": "<a id='comment:61'></a>Hi there,\n\nI did some of the proposed changes :\n- I removed the iterators and use 'yield' instead\n- I changed is_instance by PY_TYPE_CHECK in the __getitem__ method to be faster\n- I removed the \"info\" method\n\nConcerning \"lazy_list_slice\", I have changed my mind : I think it is not necessary because almost all the code managing (start, stop, step) are in the abstract class and the remaining code is dependant of the different class.\n\nAt the end, what do you think about my explanation of why lazy_list_explicit must have a cache ?\n\nMatthieu\n\nPS : Doctests will be coming ;)",
    "created_at": "2015-02-05T10:41:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206256",
    "user": "https://github.com/MatthieuDien"
}
```

<a id='comment:61'></a>Hi there,

I did some of the proposed changes :
- I removed the iterators and use 'yield' instead
- I changed is_instance by PY_TYPE_CHECK in the __getitem__ method to be faster
- I removed the "info" method

Concerning "lazy_list_slice", I have changed my mind : I think it is not necessary because almost all the code managing (start, stop, step) are in the abstract class and the remaining code is dependant of the different class.

At the end, what do you think about my explanation of why lazy_list_explicit must have a cache ?

Matthieu

PS : Doctests will be coming ;)



---

archive/issue_comments_206257.json:
```json
{
    "body": "<a id='comment:62'></a>Hi, shouldn't this class go to `src/sage/data_structures` ?",
    "created_at": "2015-03-18T18:32:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206257",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:62'></a>Hi, shouldn't this class go to `src/sage/data_structures` ?



---

archive/issue_comments_206258.json:
```json
{
    "body": "<a id='comment:63'></a>What is the plan for/status of this the lazy lists of this ticket? (no progress since 10 month now)",
    "created_at": "2016-01-04T17:25:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206258",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:63'></a>What is the plan for/status of this the lazy lists of this ticket? (no progress since 10 month now)



---

archive/issue_comments_206259.json:
```json
{
    "body": "<a id='comment:64'></a>Although I'd also love to see something like this finally be done (I really miss FriCAS here!), I'm afraid that I'm not able to contribute code here.  However, I'm willing to learn, and I'm willing to test.",
    "created_at": "2016-01-04T21:20:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206259",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:64'></a>Although I'd also love to see something like this finally be done (I really miss FriCAS here!), I'm afraid that I'm not able to contribute code here.  However, I'm willing to learn, and I'm willing to test.



---

archive/issue_comments_206260.json:
```json
{
    "body": "<a id='comment:65'></a>Hello,\n\nI don't know what Matthieu is currently doing. Note that I have a similar proposal for infinite words in #19620 (with branch whose tests pass). In that case the underlying data is not a list but a `char *` from C. Though, the idea is exactly the same. It would be nice to have the same conventions in both cases.\n\nI can provide an implementation for this ticket based on the architecture #19620. We might see later on whether power series needs some raw C datatype as well. Are you willing to review Daniel?\n\nVincent",
    "created_at": "2016-01-04T23:05:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206260",
    "user": "https://github.com/videlec"
}
```

<a id='comment:65'></a>Hello,

I don't know what Matthieu is currently doing. Note that I have a similar proposal for infinite words in #19620 (with branch whose tests pass). In that case the underlying data is not a list but a `char *` from C. Though, the idea is exactly the same. It would be nice to have the same conventions in both cases.

I can provide an implementation for this ticket based on the architecture #19620. We might see later on whether power series needs some raw C datatype as well. Are you willing to review Daniel?

Vincent



---

archive/issue_comments_206261.json:
```json
{
    "body": "<a id='comment:66'></a>Other question: do we want a mutability / immutability flag (slice will share memory only if it is set as immutable)?",
    "created_at": "2016-01-04T23:07:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206261",
    "user": "https://github.com/videlec"
}
```

<a id='comment:66'></a>Other question: do we want a mutability / immutability flag (slice will share memory only if it is set as immutable)?



---

archive/issue_comments_206262.json:
```json
{
    "body": "<a id='comment:67'></a>Replying to [comment:65 vdelecroix]:\n> I can provide an implementation for this ticket based on the architecture #19620.\n\n\nOk, what does this mean exactly? (I.e., do you drop the branch attached to this ticket completely and use your own code (from #19620)? Or simply \"merge\" this in some way?)\n\nno drop no merge. Simply follow the same architecture. We can figure out later on if it makes sense to have a common base class.\n\n> Are you willing to review Daniel?\n\n\nYes. Good!",
    "created_at": "2016-01-05T17:57:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206262",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:67'></a>Replying to [comment:65 vdelecroix]:
> I can provide an implementation for this ticket based on the architecture #19620.


Ok, what does this mean exactly? (I.e., do you drop the branch attached to this ticket completely and use your own code (from #19620)? Or simply "merge" this in some way?)

no drop no merge. Simply follow the same architecture. We can figure out later on if it makes sense to have a common base class.

> Are you willing to review Daniel?


Yes. Good!



---

archive/issue_comments_206263.json:
```json
{
    "body": "<a id='comment:68'></a>Replying to [comment:67 dkrenn]:\n> Replying to [comment:65 vdelecroix]:\n> > I can provide an implementation for this ticket based on the architecture #19620.\n\n> \n> Ok, what does this mean exactly? (I.e., do you drop the branch attached to this ticket completely and use your own code (from #19620)? Or simply \"merge\" this in some way?)\n> \n> no drop no merge. Simply follow the same architecture. We can figure out later on if it makes sense to have a common base class.\n\n\nOk, looking forward to your code (I've already had some look at the existing code of this ticket (and very briefly at #19620)...and I think I like the direction where it is going...)",
    "created_at": "2016-01-08T20:05:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206263",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:68'></a>Replying to [comment:67 dkrenn]:
> Replying to [comment:65 vdelecroix]:
> > I can provide an implementation for this ticket based on the architecture #19620.

> 
> Ok, what does this mean exactly? (I.e., do you drop the branch attached to this ticket completely and use your own code (from #19620)? Or simply "merge" this in some way?)
> 
> no drop no merge. Simply follow the same architecture. We can figure out later on if it makes sense to have a common base class.


Ok, looking forward to your code (I've already had some look at the existing code of this ticket (and very briefly at #19620)...and I think I like the direction where it is going...)



---

archive/issue_comments_206264.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-01-08T22:49:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206264",
    "user": "https://github.com/videlec"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_206265.json:
```json
{
    "body": "<a id='comment:69'></a>You can now create lazy lists from iterator and functions. And it is dead simple to create a new class inheriting from `lazy_list_abstract` (there is an example in the documentation).",
    "created_at": "2016-01-08T22:49:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206265",
    "user": "https://github.com/videlec"
}
```

<a id='comment:69'></a>You can now create lazy lists from iterator and functions. And it is dead simple to create a new class inheriting from `lazy_list_abstract` (there is an example in the documentation).



---

archive/issue_events_047558.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-01-08T22:49:26Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16137#event-47558"
}
```



---

archive/issue_events_047559.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-01-08T22:49:26Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "milestone": "sage-7.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16137#event-47559"
}
```



---

archive/issue_comments_206266.json:
```json
{
    "body": "<a id='comment:70'></a>New commits:",
    "created_at": "2016-01-08T22:49:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206266",
    "user": "https://github.com/videlec"
}
```

<a id='comment:70'></a>New commits:



---

archive/issue_comments_206267.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-01-09T15:43:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206267",
    "user": "https://github.com/dkrenn"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_206268.json:
```json
{
    "body": "<a id='comment:72'></a>I made a couple of smaller/minor changes during review; need cross-review. Additionally the following should be addressed/discussed:\n\n1. `_new_slice` and other private methods: `_new_slice_` (underscore at the end as well)?\n\n2. description, INPUT/OUTPUT of `lazy_list` is missing\n\n3. should `list(cache)` appear in the code so that the cache cannot be changed 8accidentally) from outside since only a reference of the list is passed? This would also allow e.g. tuples as well. Or is it meant that `cache` really specifies the cache itself and not only the cached elements. If so, can we make this clear in the doc somewhere (description of `lazy_list`)?\n\n4. `_fit`, last example: looks incomplete\n\n5. `__call__`: write oneline description\n\n6. `update_cache_up_to` everwhere: describe return value\n\n7. `:class:`lazy_list`` appears a couple of times, but `lazy_list` is not a class anymore\n\n8. note-block in `lazy_list_from_iterator` description should (also) be in `lazy_list`\n\n9. `cache` in INPUT-blocks: everywhere mention that this is a list (see also above)\n\n10. `__reduce__`: oneline description missing\n\n21. ticket-description \"a pair of finite lists (pre-period, period)\": remove from description and create separate ticket for this issue?\n\n32. ticket-description \"an update function\": this was addressed here, but when I see this correctly with a different interface as in the original code. \"a function that given a buffer...\" we do not have that here. I am fine with it as it is, but IMHO the description of the ticket does not fit anymore. Should this be a separate ticket as well? Maybe also specifying the old branch there to not forget about it?\n\nMoreover, I've did a partial cherry picking of part of the old code of this ticket: the two iterators are removed and a simple `yield` in `__iter__` now does the job. I adapted it so that it works. Please cross-review.\n\nPS: What about the authorship of this ticket now? MatthieuDien created the original code, that was cherry-picked by me; I've integrated it here and made the necessary changes. I would include us two in the ticket-author field unless you think the changes were too small... (I this case I don't mind)\n\n---\nNew commits:",
    "created_at": "2016-01-09T15:43:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206268",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:72'></a>I made a couple of smaller/minor changes during review; need cross-review. Additionally the following should be addressed/discussed:

1. `_new_slice` and other private methods: `_new_slice_` (underscore at the end as well)?

2. description, INPUT/OUTPUT of `lazy_list` is missing

3. should `list(cache)` appear in the code so that the cache cannot be changed 8accidentally) from outside since only a reference of the list is passed? This would also allow e.g. tuples as well. Or is it meant that `cache` really specifies the cache itself and not only the cached elements. If so, can we make this clear in the doc somewhere (description of `lazy_list`)?

4. `_fit`, last example: looks incomplete

5. `__call__`: write oneline description

6. `update_cache_up_to` everwhere: describe return value

7. `:class:`lazy_list`` appears a couple of times, but `lazy_list` is not a class anymore

8. note-block in `lazy_list_from_iterator` description should (also) be in `lazy_list`

9. `cache` in INPUT-blocks: everywhere mention that this is a list (see also above)

10. `__reduce__`: oneline description missing

21. ticket-description "a pair of finite lists (pre-period, period)": remove from description and create separate ticket for this issue?

32. ticket-description "an update function": this was addressed here, but when I see this correctly with a different interface as in the original code. "a function that given a buffer..." we do not have that here. I am fine with it as it is, but IMHO the description of the ticket does not fit anymore. Should this be a separate ticket as well? Maybe also specifying the old branch there to not forget about it?

Moreover, I've did a partial cherry picking of part of the old code of this ticket: the two iterators are removed and a simple `yield` in `__iter__` now does the job. I adapted it so that it works. Please cross-review.

PS: What about the authorship of this ticket now? MatthieuDien created the original code, that was cherry-picked by me; I've integrated it here and made the necessary changes. I would include us two in the ticket-author field unless you think the changes were too small... (I this case I don't mind)

---
New commits:



---

archive/issue_comments_206269.json:
```json
{
    "body": "<a id='comment:73'></a>Two more issues: \n\n13. Since the code was moved from `sage.misc` to `sage.data_structures`, do we need a deprecation?\n\n24. Since `lazy_list`s are immutable, wouldn't the name `lazy_tuple` be more suitable? To rephrase: Help me understand, what makes it a list and not a tuple?",
    "created_at": "2016-01-09T16:29:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206269",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:73'></a>Two more issues: 

13. Since the code was moved from `sage.misc` to `sage.data_structures`, do we need a deprecation?

24. Since `lazy_list`s are immutable, wouldn't the name `lazy_tuple` be more suitable? To rephrase: Help me understand, what makes it a list and not a tuple?



---

archive/issue_comments_206270.json:
```json
{
    "body": "<a id='comment:74'></a>Concerning 14., I would vote for `lazy_stream` or even just `stream`, because of https://en.wikipedia.org/wiki/Stream_(computing).  There currently is a class `Stream` in the species code, which is really a relatively poor implementation of what the code in this ticket does, and I'm quite eager to replace it.",
    "created_at": "2016-01-09T16:41:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206270",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:74'></a>Concerning 14., I would vote for `lazy_stream` or even just `stream`, because of https://en.wikipedia.org/wiki/Stream_(computing).  There currently is a class `Stream` in the species code, which is really a relatively poor implementation of what the code in this ticket does, and I'm quite eager to replace it.



---

archive/issue_comments_206271.json:
```json
{
    "body": "<a id='comment:75'></a>Replying to [comment:74 mantepse]:\n> Concerning 14., I would vote for `lazy_stream` or even just `stream`, because of https://en.wikipedia.org/wiki/Stream_(computing).  There currently is a class `Stream` in the species code, which is really a relatively poor implementation of what the code in this ticket does, and I'm quite eager to replace it.\n\n\n`stream` sounds good to me (from the definition of `stream` from your wiki link, it seems that they are lazy by default, so no need to put that into the name).",
    "created_at": "2016-01-09T16:50:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206271",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:75'></a>Replying to [comment:74 mantepse]:
> Concerning 14., I would vote for `lazy_stream` or even just `stream`, because of https://en.wikipedia.org/wiki/Stream_(computing).  There currently is a class `Stream` in the species code, which is really a relatively poor implementation of what the code in this ticket does, and I'm quite eager to replace it.


`stream` sounds good to me (from the definition of `stream` from your wiki link, it seems that they are lazy by default, so no need to put that into the name).



---

archive/issue_comments_206272.json:
```json
{
    "body": "<a id='comment:76'></a>Lazy lists might implement a mutable/immutable protocol in the future. In which case the reference to the Python data structure would be appropriate. And it is better to not change the name twice.\n\nStream is a technical computer term mostly used for communications. As it is said on wikipedia this notion is related to time: it is a \"flux of information\". It has the relevant menaing in the language Scheme (which is as far as I know, marginally used among mathematicians). I strongly disaprove its usage here.\n\nOther name like `lazy_sequence` are already too mathematical.\n\nUnless you have a strong need (and arguments) to change the name I am opposed to it.",
    "created_at": "2016-01-09T17:08:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206272",
    "user": "https://github.com/videlec"
}
```

<a id='comment:76'></a>Lazy lists might implement a mutable/immutable protocol in the future. In which case the reference to the Python data structure would be appropriate. And it is better to not change the name twice.

Stream is a technical computer term mostly used for communications. As it is said on wikipedia this notion is related to time: it is a "flux of information". It has the relevant menaing in the language Scheme (which is as far as I know, marginally used among mathematicians). I strongly disaprove its usage here.

Other name like `lazy_sequence` are already too mathematical.

Unless you have a strong need (and arguments) to change the name I am opposed to it.



---

archive/issue_comments_206273.json:
```json
{
    "body": "<a id='comment:77'></a>Replying to [comment:76 vdelecroix]:\n> Lazy lists might implement a mutable/immutable protocol in the future.\n\n\nOk, then let's keep the name.",
    "created_at": "2016-01-09T17:25:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206273",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:77'></a>Replying to [comment:76 vdelecroix]:
> Lazy lists might implement a mutable/immutable protocol in the future.


Ok, then let's keep the name.



---

archive/issue_comments_206274.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-01-09T19:06:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206274",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_206275.json:
```json
{
    "body": "<a id='comment:78'></a>New commits:",
    "created_at": "2016-01-09T19:06:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206275",
    "user": "https://github.com/videlec"
}
```

<a id='comment:78'></a>New commits:



---

archive/issue_comments_206276.json:
```json
{
    "body": "<a id='comment:79'></a>Hola Daniel,\n\nThanks!\n\nReplying to [comment:72 dkrenn]:\n> I made a couple of smaller/minor changes during review; need cross-review. Additionally the following should be addressed/discussed:\n\n>\n> 1. `_new_slice` and other private methods: `_new_slice_` (underscore at the end as well)?\n\n\nI really don't care. But I do not see why it should be with 2 underscores. For me the double underscore methods are saying \"I want to interact with the rest of Sage and cares about coercions\". Like `_add_`, `_cmp_` etc. But it might be a personal feeling.\n\n> 2. description, INPUT/OUTPUT of `lazy_list` is missing\n\n\ndone.\n\n> 3. should `list(cache)` appear in the code so that the cache cannot be changed 8accidentally) from outside since only a reference of the list is passed? This would also allow e.g. tuples as well. Or is it meant that `cache` really specifies the cache itself and not only the cached elements. If so, can we make this clear in the doc somewhere (description of `lazy_list`)?\n\n\nThis is a feature you might actually want to use. In the constructors `__init__` method we clearly want to use the reference to the same list (I made it clear in the doc). In the factory `lazy_list` I am in favour of copying and adapted the code accordingly.\n\n> 4. `_fit`, last example: looks incomplete\n\n\nActually not... I had some non trivial error. This method is subtle as for finite `lazy_list` you want to avoid the `StopIteration`branch. Though I added a `_info()`.\n\n> 5. `__call__`: write oneline description\n\n\ndone",
    "created_at": "2016-01-09T19:14:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206276",
    "user": "https://github.com/videlec"
}
```

<a id='comment:79'></a>Hola Daniel,

Thanks!

Replying to [comment:72 dkrenn]:
> I made a couple of smaller/minor changes during review; need cross-review. Additionally the following should be addressed/discussed:

>
> 1. `_new_slice` and other private methods: `_new_slice_` (underscore at the end as well)?


I really don't care. But I do not see why it should be with 2 underscores. For me the double underscore methods are saying "I want to interact with the rest of Sage and cares about coercions". Like `_add_`, `_cmp_` etc. But it might be a personal feeling.

> 2. description, INPUT/OUTPUT of `lazy_list` is missing


done.

> 3. should `list(cache)` appear in the code so that the cache cannot be changed 8accidentally) from outside since only a reference of the list is passed? This would also allow e.g. tuples as well. Or is it meant that `cache` really specifies the cache itself and not only the cached elements. If so, can we make this clear in the doc somewhere (description of `lazy_list`)?


This is a feature you might actually want to use. In the constructors `__init__` method we clearly want to use the reference to the same list (I made it clear in the doc). In the factory `lazy_list` I am in favour of copying and adapted the code accordingly.

> 4. `_fit`, last example: looks incomplete


Actually not... I had some non trivial error. This method is subtle as for finite `lazy_list` you want to avoid the `StopIteration`branch. Though I added a `_info()`.

> 5. `__call__`: write oneline description


done



---

archive/issue_comments_206277.json:
```json
{
    "body": "<a id='comment:80'></a>> 6. `update_cache_up_to` everwhere: describe return value\n\n\nThe return value was not meaningful (except for Python error handling). I now specified a `0/1` code return and used it in `_fit`.\n\n> 7. `:class:`lazy_list`` appears a couple of times, but `lazy_list` is not a class anymore\n\n\ndone\n\n> 8. note-block in `lazy_list_from_iterator` description should (also) be in `lazy_list`\n\n\nI moved around a lot of documentation. Tell me if there is still a problem.\n\n> 9. `cache` in INPUT-blocks: everywhere mention that this is a list (see also above)\n\n\ndone.\n\n> 10. `__reduce__`: oneline description missing\n\n\nWhat for? A user should not care about it. A developer knows what this function is.\n\n> 11. ticket-description \"a pair of finite lists (pre-period, period)\": remove from description and create separate ticket for this issue?\n\n\nI reformulated the ticket description. I think this ticket should focus on the lazy lists with a cache.",
    "created_at": "2016-01-09T19:15:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206277",
    "user": "https://github.com/videlec"
}
```

<a id='comment:80'></a>> 6. `update_cache_up_to` everwhere: describe return value


The return value was not meaningful (except for Python error handling). I now specified a `0/1` code return and used it in `_fit`.

> 7. `:class:`lazy_list`` appears a couple of times, but `lazy_list` is not a class anymore


done

> 8. note-block in `lazy_list_from_iterator` description should (also) be in `lazy_list`


I moved around a lot of documentation. Tell me if there is still a problem.

> 9. `cache` in INPUT-blocks: everywhere mention that this is a list (see also above)


done.

> 10. `__reduce__`: oneline description missing


What for? A user should not care about it. A developer knows what this function is.

> 11. ticket-description "a pair of finite lists (pre-period, period)": remove from description and create separate ticket for this issue?


I reformulated the ticket description. I think this ticket should focus on the lazy lists with a cache.



---

archive/issue_comments_206278.json:
```json
{
    "body": "<a id='comment:81'></a>> 12. ticket-description \"an update function\": this was addressed here, but when I see this correctly with a different interface as in the original code. \"a function that given a buffer...\" we do not have that here. I am fine with it as it is, but IMHO the description of the ticket does not fit anymore. Should this be a separate ticket as well? Maybe also specifying the old branch there to not forget about it?\n\n\nActually you could do it by inheritance and implementing `_new_slice`. There you have access to the cache with the method `get`. See the Thue-Morse example.\n\nI added 20 lines of code to do it from a function. There is a Thue-Morse bis example which uses this path. But I really find this version artificial. If you have an \"update function\" you generally need some extra variables that are not necesseraily easily deduced from the length of the list. Moreover it is very fragile (since the update function might modify the begining of the list without notice). What do you think? Should I remove it?\n\n> Moreover, I've did a partial cherry picking of part of the old code of this ticket: the two iterators are removed and a simple `yield` in `__iter__` now does the job. I adapted it so that it works. Please cross-review.\n\n\nGreat! Thanks. I modified it though. Cython is somehow confused with the range stuff if `i` is a `Py_ssize_t`. I will investigate this and see if I can fix Cython.",
    "created_at": "2016-01-09T19:15:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206278",
    "user": "https://github.com/videlec"
}
```

<a id='comment:81'></a>> 12. ticket-description "an update function": this was addressed here, but when I see this correctly with a different interface as in the original code. "a function that given a buffer..." we do not have that here. I am fine with it as it is, but IMHO the description of the ticket does not fit anymore. Should this be a separate ticket as well? Maybe also specifying the old branch there to not forget about it?


Actually you could do it by inheritance and implementing `_new_slice`. There you have access to the cache with the method `get`. See the Thue-Morse example.

I added 20 lines of code to do it from a function. There is a Thue-Morse bis example which uses this path. But I really find this version artificial. If you have an "update function" you generally need some extra variables that are not necesseraily easily deduced from the length of the list. Moreover it is very fragile (since the update function might modify the begining of the list without notice). What do you think? Should I remove it?

> Moreover, I've did a partial cherry picking of part of the old code of this ticket: the two iterators are removed and a simple `yield` in `__iter__` now does the job. I adapted it so that it works. Please cross-review.


Great! Thanks. I modified it though. Cython is somehow confused with the range stuff if `i` is a `Py_ssize_t`. I will investigate this and see if I can fix Cython.



---

archive/issue_comments_206279.json:
```json
{
    "body": "<a id='comment:82'></a>Curiously trac freezes when I tried to send all messages in one. Well I splitted it in 3.",
    "created_at": "2016-01-09T19:16:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206279",
    "user": "https://github.com/videlec"
}
```

<a id='comment:82'></a>Curiously trac freezes when I tried to send all messages in one. Well I splitted it in 3.



---

archive/issue_comments_206280.json:
```json
{
    "body": "<a id='comment:84'></a>Replying to [comment:82 vdelecroix]:\n> Curiously trac freezes when I tried to send all messages in one. Well I splitted it in 3.\n\n\nI also sometimes have this problem and no idea what it is (tried to find out, but failed...)\n\n---\nNew commits:",
    "created_at": "2016-01-10T09:25:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206280",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:84'></a>Replying to [comment:82 vdelecroix]:
> Curiously trac freezes when I tried to send all messages in one. Well I splitted it in 3.


I also sometimes have this problem and no idea what it is (tried to find out, but failed...)

---
New commits:



---

archive/issue_comments_206281.json:
```json
{
    "body": "<a id='comment:85'></a>Replying to [comment:79 vdelecroix]:\n> Replying to [comment:72 dkrenn]:\n> > 1. `_new_slice` and other private methods: `_new_slice_` (underscore at the end as well)?\n  \n> \n> I really don't care. But I do not see why it should be with 2 underscores. For me the double underscore methods are saying \"I want to interact with the rest of Sage and cares about coercions\". Like `_add_`, `_cmp_` etc. But it might be a personal feeling.\n\n\nOk, then let's keep them as they are.\n\n> > 3. should `list(cache)` appear in the code so that the cache cannot be changed 8accidentally) from outside since only a reference of the list is passed? This would also allow e.g. tuples as well. Or is it meant that `cache` really specifies the cache itself and not only the cached elements. If so, can we make this clear in the doc somewhere (description of `lazy_list`)?\n  \n> \n> This is a feature you might actually want to use. In the constructors `__init__` method we clearly want to use the reference to the same list (I made it clear in the doc). In the factory `lazy_list` I am in favour of copying and adapted the code accordingly.\n\n\nGood solution.",
    "created_at": "2016-01-10T09:26:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206281",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:85'></a>Replying to [comment:79 vdelecroix]:
> Replying to [comment:72 dkrenn]:
> > 1. `_new_slice` and other private methods: `_new_slice_` (underscore at the end as well)?
  
> 
> I really don't care. But I do not see why it should be with 2 underscores. For me the double underscore methods are saying "I want to interact with the rest of Sage and cares about coercions". Like `_add_`, `_cmp_` etc. But it might be a personal feeling.


Ok, then let's keep them as they are.

> > 3. should `list(cache)` appear in the code so that the cache cannot be changed 8accidentally) from outside since only a reference of the list is passed? This would also allow e.g. tuples as well. Or is it meant that `cache` really specifies the cache itself and not only the cached elements. If so, can we make this clear in the doc somewhere (description of `lazy_list`)?
  
> 
> This is a feature you might actually want to use. In the constructors `__init__` method we clearly want to use the reference to the same list (I made it clear in the doc). In the factory `lazy_list` I am in favour of copying and adapted the code accordingly.


Good solution.



---

archive/issue_comments_206282.json:
```json
{
    "body": "<a id='comment:86'></a>> > 6. `update_cache_up_to` everwhere: describe return value\n  \n> \n> The return value was not meaningful (except for Python error handling). I now specified a `0/1` code return and used it in `_fit`.\n\n\n0/1 vs. !False/True: isn't there a `bint` or something like that?), in particular, since update_cache_up_to is public. If I would change them...\n\n> > 8. note-block in `lazy_list_from_iterator` description should (also) be in `lazy_list`\n  \n> \n> I moved around a lot of documentation. Tell me if there is still a problem.\n\n\nLooks good now.\n\n> > 11. ticket-description \"a pair of finite lists (pre-period, period)\": remove from description and create separate ticket for this issue?\n  \n> \n> I reformulated the ticket description. I think this ticket should focus on the lazy lists with a cache.\n\n\nYes, I think so as well. (I don't see any change in the ticket description)",
    "created_at": "2016-01-10T09:27:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206282",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:86'></a>> > 6. `update_cache_up_to` everwhere: describe return value
  
> 
> The return value was not meaningful (except for Python error handling). I now specified a `0/1` code return and used it in `_fit`.


0/1 vs. !False/True: isn't there a `bint` or something like that?), in particular, since update_cache_up_to is public. If I would change them...

> > 8. note-block in `lazy_list_from_iterator` description should (also) be in `lazy_list`
  
> 
> I moved around a lot of documentation. Tell me if there is still a problem.


Looks good now.

> > 11. ticket-description "a pair of finite lists (pre-period, period)": remove from description and create separate ticket for this issue?
  
> 
> I reformulated the ticket description. I think this ticket should focus on the lazy lists with a cache.


Yes, I think so as well. (I don't see any change in the ticket description)



---

archive/issue_comments_206283.json:
```json
{
    "body": "<a id='comment:87'></a>> > 12. ticket-description \"an update function\": this was addressed here, but when I see this correctly with a different interface as in the original code. \"a function that given a buffer...\" we do not have that here. I am fine with it as it is, but IMHO the description of the ticket does not fit anymore. Should this be a separate ticket as well? Maybe also specifying the old branch there to not forget about it?\n  \n> \n> Actually you could do it by inheritance and implementing `_new_slice`. There you have access to the cache with the method `get`. See the Thue-Morse example.\n> \n> I added 20 lines of code to do it from a function. There is a Thue-Morse bis example which uses this path. But I really find this version artificial. If you have an \"update function\" you generally need some extra variables that are not necesseraily easily deduced from the length of the list. Moreover it is very fragile (since the update function might modify the begining of the list without notice). What do you think? Should I remove it?\n\n\nSince it is already there now, I would keep it. However, I won't need this feature (at this point), so I don't mind if it is removed.\n\n> > Moreover, I've did a partial cherry picking of part of the old code of this ticket: the two iterators are removed and a simple `yield` in `__iter__` now does the job. I adapted it so that it works. Please cross-review.\n\n> \n> Great! Thanks. I modified it though. Cython is somehow confused with the range stuff if `i` is a `Py_ssize_t`. I will investigate this and see if I can fix Cython.\n\n\nOk, thank you.\n\n15. `lazy_list_abstract` vs. for example `lazy_list_generic`: I find it a bit strange to instantiate something with \"abstract\" in its name.\n\n26. `beginning` vs. `inital_values`: I have a slight (but not strong) preference for the latter.\n\nI've also made some minor changes; please cross-review.",
    "created_at": "2016-01-10T09:28:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206283",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:87'></a>> > 12. ticket-description "an update function": this was addressed here, but when I see this correctly with a different interface as in the original code. "a function that given a buffer..." we do not have that here. I am fine with it as it is, but IMHO the description of the ticket does not fit anymore. Should this be a separate ticket as well? Maybe also specifying the old branch there to not forget about it?
  
> 
> Actually you could do it by inheritance and implementing `_new_slice`. There you have access to the cache with the method `get`. See the Thue-Morse example.
> 
> I added 20 lines of code to do it from a function. There is a Thue-Morse bis example which uses this path. But I really find this version artificial. If you have an "update function" you generally need some extra variables that are not necesseraily easily deduced from the length of the list. Moreover it is very fragile (since the update function might modify the begining of the list without notice). What do you think? Should I remove it?


Since it is already there now, I would keep it. However, I won't need this feature (at this point), so I don't mind if it is removed.

> > Moreover, I've did a partial cherry picking of part of the old code of this ticket: the two iterators are removed and a simple `yield` in `__iter__` now does the job. I adapted it so that it works. Please cross-review.

> 
> Great! Thanks. I modified it though. Cython is somehow confused with the range stuff if `i` is a `Py_ssize_t`. I will investigate this and see if I can fix Cython.


Ok, thank you.

15. `lazy_list_abstract` vs. for example `lazy_list_generic`: I find it a bit strange to instantiate something with "abstract" in its name.

26. `beginning` vs. `inital_values`: I have a slight (but not strong) preference for the latter.

I've also made some minor changes; please cross-review.



---

archive/issue_comments_206284.json:
```json
{
    "body": "<a id='comment:88'></a>Is there a reason, why slices are not a separate class? Is it a design choice? Or simply because the earlier version did so? (I am trying to extend sublist extraction of lazy lists; that's why it comes to my mind).",
    "created_at": "2016-01-10T12:42:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206284",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:88'></a>Is there a reason, why slices are not a separate class? Is it a design choice? Or simply because the earlier version did so? (I am trying to extend sublist extraction of lazy lists; that's why it comes to my mind).



---

archive/issue_comments_206285.json:
```json
{
    "body": "<a id='comment:90'></a>Replying to [comment:86 dkrenn]:\n> > > 6. `update_cache_up_to` everwhere: describe return value\n  \n> > \n> > The return value was not meaningful (except for Python error handling). I now specified a `0/1` code return and used it in `_fit`.\n\n> \n> 0/1 vs. !False/True: isn't there a `bint` or something like that?), in particular, since update_cache_up_to is public. If I would change them...\n\n\nNope nope. It can be `-1` if a Python error occurrs (but you will not see it). We can not use `bint` here.",
    "created_at": "2016-01-10T13:17:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206285",
    "user": "https://github.com/videlec"
}
```

<a id='comment:90'></a>Replying to [comment:86 dkrenn]:
> > > 6. `update_cache_up_to` everwhere: describe return value
  
> > 
> > The return value was not meaningful (except for Python error handling). I now specified a `0/1` code return and used it in `_fit`.

> 
> 0/1 vs. !False/True: isn't there a `bint` or something like that?), in particular, since update_cache_up_to is public. If I would change them...


Nope nope. It can be `-1` if a Python error occurrs (but you will not see it). We can not use `bint` here.



---

archive/issue_comments_206286.json:
```json
{
    "body": "<a id='comment:91'></a>Replying to [comment:87 dkrenn]:\n> > > 12. ticket-description \"an update function\": this was addressed here, but when I see this correctly with a different interface as in the original code. \"a function that given a buffer...\" we do not have that here. I am fine with it as it is, but IMHO the description of the ticket does not fit anymore. Should this be a separate ticket as well? Maybe also specifying the old branch there to not forget about it?\n  \n> > \n> > Actually you could do it by inheritance and implementing `_new_slice`. There you have access to the cache with the method `get`. See the Thue-Morse example.\n> > \n> > I added 20 lines of code to do it from a function. There is a Thue-Morse bis example which uses this path. But I really find this version artificial. If you have an \"update function\" you generally need some extra variables that are not necesseraily easily deduced from the length of the list. Moreover it is very fragile (since the update function might modify the begining of the list without notice). What do you think? Should I remove it?\n\n> \n> Since it is already there now, I would keep it. However, I won't need this feature (at this point), so I don't mind if it is removed.\n> \n> > > Moreover, I've did a partial cherry picking of part of the old code of this ticket: the two iterators are removed and a simple `yield` in `__iter__` now does the job. I adapted it so that it works. Please cross-review.\n\n> > \n> > Great! Thanks. I modified it though. Cython is somehow confused with the range stuff if `i` is a `Py_ssize_t`. I will investigate this and see if I can fix Cython.\n\n> \n> Ok, thank you.\n> \n> 15. `lazy_list_abstract` vs. for example `lazy_list_generic`: I find it a bit strange to instantiate something with \"abstract\" in its name.\n\n\nMuch better. I changed it. I was not a fan of the `abstract` as well.\n\n> 16. `beginning` vs. `inital_values`: I have a slight (but not strong) preference for the latter.\n\n\nChanged as well.",
    "created_at": "2016-01-10T13:20:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206286",
    "user": "https://github.com/videlec"
}
```

<a id='comment:91'></a>Replying to [comment:87 dkrenn]:
> > > 12. ticket-description "an update function": this was addressed here, but when I see this correctly with a different interface as in the original code. "a function that given a buffer..." we do not have that here. I am fine with it as it is, but IMHO the description of the ticket does not fit anymore. Should this be a separate ticket as well? Maybe also specifying the old branch there to not forget about it?
  
> > 
> > Actually you could do it by inheritance and implementing `_new_slice`. There you have access to the cache with the method `get`. See the Thue-Morse example.
> > 
> > I added 20 lines of code to do it from a function. There is a Thue-Morse bis example which uses this path. But I really find this version artificial. If you have an "update function" you generally need some extra variables that are not necesseraily easily deduced from the length of the list. Moreover it is very fragile (since the update function might modify the begining of the list without notice). What do you think? Should I remove it?

> 
> Since it is already there now, I would keep it. However, I won't need this feature (at this point), so I don't mind if it is removed.
> 
> > > Moreover, I've did a partial cherry picking of part of the old code of this ticket: the two iterators are removed and a simple `yield` in `__iter__` now does the job. I adapted it so that it works. Please cross-review.

> > 
> > Great! Thanks. I modified it though. Cython is somehow confused with the range stuff if `i` is a `Py_ssize_t`. I will investigate this and see if I can fix Cython.

> 
> Ok, thank you.
> 
> 15. `lazy_list_abstract` vs. for example `lazy_list_generic`: I find it a bit strange to instantiate something with "abstract" in its name.


Much better. I changed it. I was not a fan of the `abstract` as well.

> 16. `beginning` vs. `inital_values`: I have a slight (but not strong) preference for the latter.


Changed as well.



---

archive/issue_comments_206287.json:
```json
{
    "body": "<a id='comment:92'></a>Replying to [comment:88 dkrenn]:\n> Is there a reason, why slices are not a separate class? Is it a design choice? Or simply because the earlier version did so? (I am trying to extend sublist extraction of lazy lists; that's why it comes to my mind).\n\n\nThat is a good design question. I have two reasons:\n- avoid implementing twice `__getitem__` and `get`\n- (not supported at the moment) the user might want to inherit from `lazy_list_generic` in such way that slices are also instances of the inherited object. In that case we could not make it a distinct class.",
    "created_at": "2016-01-10T13:23:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206287",
    "user": "https://github.com/videlec"
}
```

<a id='comment:92'></a>Replying to [comment:88 dkrenn]:
> Is there a reason, why slices are not a separate class? Is it a design choice? Or simply because the earlier version did so? (I am trying to extend sublist extraction of lazy lists; that's why it comes to my mind).


That is a good design question. I have two reasons:
- avoid implementing twice `__getitem__` and `get`
- (not supported at the moment) the user might want to inherit from `lazy_list_generic` in such way that slices are also instances of the inherited object. In that case we could not make it a distinct class.



---

archive/issue_comments_206288.json:
```json
{
    "body": "<a id='comment:93'></a>New commits:",
    "created_at": "2016-01-10T13:25:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206288",
    "user": "https://github.com/videlec"
}
```

<a id='comment:93'></a>New commits:



---

archive/issue_comments_206289.json:
```json
{
    "body": "<a id='comment:95'></a>Replying to [comment:90 vdelecroix]:\n> > 0/1 vs. !False/True: isn't there a `bint` or something like that?), in particular, since update_cache_up_to is public. If I would change them...\n\n> \n> Nope nope. It can be `-1` if a Python error occurrs (but you will not see it). We can not use `bint` here.\n\n\nOk, thank you for the clearification.\n\n---\nNew commits:",
    "created_at": "2016-01-10T15:39:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206289",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:95'></a>Replying to [comment:90 vdelecroix]:
> > 0/1 vs. !False/True: isn't there a `bint` or something like that?), in particular, since update_cache_up_to is public. If I would change them...

> 
> Nope nope. It can be `-1` if a Python error occurrs (but you will not see it). We can not use `bint` here.


Ok, thank you for the clearification.

---
New commits:



---

archive/issue_comments_206290.json:
```json
{
    "body": "<a id='comment:96'></a>Replying to [comment:92 vdelecroix]:\n> That is a good design question. I have two reasons:\n> - avoid implementing twice `__getitem__` and `get`\n> - (not supported at the moment) the user might want to inherit from `lazy_list_generic` in such way that slices are also instances of the inherited object. In that case we could not make it a distinct class.\n\n\nOk.",
    "created_at": "2016-01-10T15:39:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206290",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:96'></a>Replying to [comment:92 vdelecroix]:
> That is a good design question. I have two reasons:
> - avoid implementing twice `__getitem__` and `get`
> - (not supported at the moment) the user might want to inherit from `lazy_list_generic` in such way that slices are also instances of the inherited object. In that case we could not make it a distinct class.


Ok.



---

archive/issue_comments_206291.json:
```json
{
    "body": "<a id='comment:97'></a>LGTM, positive whenever a patchbot confirms no errors.",
    "created_at": "2016-01-10T15:45:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206291",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:97'></a>LGTM, positive whenever a patchbot confirms no errors.



---

archive/issue_comments_206292.json:
```json
{
    "body": "<a id='comment:98'></a>Thanks for the careful review.\n\n`@`Martin: if you start reimplementing streams using lazy list, please put me in cc.",
    "created_at": "2016-01-10T16:17:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206292",
    "user": "https://github.com/videlec"
}
```

<a id='comment:98'></a>Thanks for the careful review.

`@`Martin: if you start reimplementing streams using lazy list, please put me in cc.



---

archive/issue_comments_206293.json:
```json
{
    "body": "<a id='comment:99'></a>This is wonderful!\n\nYes, today I started to recollect what I want to do.  I'm not sure whether there is any need for another object \"stream\".  Rather, I think that the next step is a good lazy power series implementation.\n\nThe main complication is that it is useful to define power series recursively, as in\n\n```\nsage: sage: L = LazyPowerSeriesRing(QQ)\nsage: one = L(1)\nsage: monom = L.gen()\nsage: s = L()\nsage: s._name = 's'\nsage: s.define(one+monom*s*s)\nsage: [s.coefficient(i) for i in range(6)]\n[1, 1, 2, 5, 14, 42]\n```\nIn the current code, this is done by keeping track of the \"approximate order\" of the power series.  Note that there are no initial values provided by the user.\n\nAn earlier attempt was done by Mike Hansen in #15673, so I guess it's best to continue discussion there.  I also have code (for FriCAS, however) that generalizes this using a different approach, via undetermined coefficients and given initial values.\n\nI guess that I am a terrible python programmer, but I think I can give it a try.  I would start with what Mike has written, but first I want to recollect how these recursive definitions worked.",
    "created_at": "2016-01-10T16:37:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206293",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:99'></a>This is wonderful!

Yes, today I started to recollect what I want to do.  I'm not sure whether there is any need for another object "stream".  Rather, I think that the next step is a good lazy power series implementation.

The main complication is that it is useful to define power series recursively, as in

```
sage: sage: L = LazyPowerSeriesRing(QQ)
sage: one = L(1)
sage: monom = L.gen()
sage: s = L()
sage: s._name = 's'
sage: s.define(one+monom*s*s)
sage: [s.coefficient(i) for i in range(6)]
[1, 1, 2, 5, 14, 42]
```
In the current code, this is done by keeping track of the "approximate order" of the power series.  Note that there are no initial values provided by the user.

An earlier attempt was done by Mike Hansen in #15673, so I guess it's best to continue discussion there.  I also have code (for FriCAS, however) that generalizes this using a different approach, via undetermined coefficients and given initial values.

I guess that I am a terrible python programmer, but I think I can give it a try.  I would start with what Mike has written, but first I want to recollect how these recursive definitions worked.



---

archive/issue_comments_206294.json:
```json
{
    "body": "<a id='comment:0'></a>It is perfectly fine to use `lazy_list` recursively. With your example one option is\n\n```\nfrom sage.data_structures.lazy_list import lazy_list_generic\nclass MySerie(lazy_list_generic):\n    def __init__(self):\n        lazy_list_generic.__init__(self, cache=[1])\n        self._n = 0\n    def _new_slice(self):\n        n = self._n\n        self._n += 1\n        return [sum(self.get(i) * self.get(n-i) for i in range(n+1))]\n```\nthen\n\n```\nsage: f = MySerie()\nsage: f[0]\n1\nsage: f[1]\n1\nsage: f[2]\n2\nsage: f[3]\n5\nsage: f[4]\n14\nsage: f[5]\n42\n```",
    "created_at": "2016-01-10T16:56:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206294",
    "user": "https://github.com/videlec"
}
```

<a id='comment:0'></a>It is perfectly fine to use `lazy_list` recursively. With your example one option is

```
from sage.data_structures.lazy_list import lazy_list_generic
class MySerie(lazy_list_generic):
    def __init__(self):
        lazy_list_generic.__init__(self, cache=[1])
        self._n = 0
    def _new_slice(self):
        n = self._n
        self._n += 1
        return [sum(self.get(i) * self.get(n-i) for i in range(n+1))]
```
then

```
sage: f = MySerie()
sage: f[0]
1
sage: f[1]
1
sage: f[2]
2
sage: f[3]
5
sage: f[4]
14
sage: f[5]
42
```



---

archive/issue_comments_206295.json:
```json
{
    "body": "<a id='comment:1'></a>Yes, I know.  The point is that the current user interface does this automatically, and with quite a natural syntax.",
    "created_at": "2016-01-10T18:11:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206295",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:1'></a>Yes, I know.  The point is that the current user interface does this automatically, and with quite a natural syntax.



---

archive/issue_comments_206296.json:
```json
{
    "body": "<a id='comment:2'></a>Why is this moved to `data_structures`? I don't think that \"lazy list\" is a data structure. And I don't want `data_structures` to become yet another \"misc\".",
    "created_at": "2016-01-10T20:14:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206296",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>Why is this moved to `data_structures`? I don't think that "lazy list" is a data structure. And I don't want `data_structures` to become yet another "misc".



---

archive/issue_comments_206297.json:
```json
{
    "body": "<a id='comment:3'></a>Minor comments:\n\n1. insert the standard copyright template.\n\n2. remove this ugly commented-out code:\n\n```\n# in types.pxd\n#    bint PyType_Check(object o)\n#    bint PyType_CheckExact(object o)\n# include \"sage/ext/python_iterator.pxi\"\n```\n\n3. remove the unused\n\n```\nfrom cpython.object cimport *\n```\n\n4. remove the unused\n\n```\nfrom libc import limits\n```",
    "created_at": "2016-01-10T20:17:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206297",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>Minor comments:

1. insert the standard copyright template.

2. remove this ugly commented-out code:

```
# in types.pxd
#    bint PyType_Check(object o)
#    bint PyType_CheckExact(object o)
# include "sage/ext/python_iterator.pxi"
```

3. remove the unused

```
from cpython.object cimport *
```

4. remove the unused

```
from libc import limits
```



---

archive/issue_comments_206298.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-01-10T20:21:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206298",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_206299.json:
```json
{
    "body": "<a id='comment:105'></a>Replying to [comment:102 jdemeyer]:\n> Why is this moved to `data_structures`? I don't think that \"lazy list\" is a data structure. And I don't want `data_structures` to become yet another \"misc\".\n\n\nI don't care. I did it because of [comment:62 comment:62]. What is a data structure? Just excluding lazy list will not help me to know what should I found out there.\n\n---\nNew commits:",
    "created_at": "2016-01-10T21:28:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206299",
    "user": "https://github.com/videlec"
}
```

<a id='comment:105'></a>Replying to [comment:102 jdemeyer]:
> Why is this moved to `data_structures`? I don't think that "lazy list" is a data structure. And I don't want `data_structures` to become yet another "misc".


I don't care. I did it because of [comment:62 comment:62]. What is a data structure? Just excluding lazy list will not help me to know what should I found out there.

---
New commits:



---

archive/issue_comments_206300.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2016-01-10T21:28:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206300",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_comments_206301.json:
```json
{
    "body": "<a id='comment:106'></a>Replying to [comment:102 jdemeyer]:\n> Why is this moved to `data_structures`? I don't think that \"lazy list\" is a data structure. And I don't want `data_structures` to become yet another \"misc\".\n\n\nI don't know about what the motivation of moving it was, but I disagree that it is *not* a data structure. `list` is a data structure for sure, so a variant of it, namely our lazy list, is it as well.\nThe wikipedia says on \"data structure\" in its first sentence:\n    In computer science, a data structure is a particular way of organizing data in a computer so that it can be used efficiently.\nThat's what we have, haven't we?\n\nWhy do you think it is not a data structure?",
    "created_at": "2016-01-11T19:12:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206301",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:106'></a>Replying to [comment:102 jdemeyer]:
> Why is this moved to `data_structures`? I don't think that "lazy list" is a data structure. And I don't want `data_structures` to become yet another "misc".


I don't know about what the motivation of moving it was, but I disagree that it is *not* a data structure. `list` is a data structure for sure, so a variant of it, namely our lazy list, is it as well.
The wikipedia says on "data structure" in its first sentence:
    In computer science, a data structure is a particular way of organizing data in a computer so that it can be used efficiently.
That's what we have, haven't we?

Why do you think it is not a data structure?



---

archive/issue_comments_206302.json:
```json
{
    "body": "<a id='comment:107'></a>Replying to [comment:106 dkrenn]:\n> I don't know about what the motivation of moving it was, but I disagree that it is *not* a data structure. `list` is a data structure for sure, so a variant of it, namely our lazy list, is it as well.\n\nWell, the \"variant\" adds something, but not in terms of the data structure. I would say that a lazy list is some kind of wrapper of a data structure, not a new data structure.\n\n> The wikipedia says on \"data structure\" in its first sentence:\n>     In computer science, a data structure is a particular way of organizing data in a computer so that it can be used efficiently.\n> That's what we have, haven't we?\n\nNot really. I wouldn't call a lazy list \"a way of organizing data\".\n\nIt you think it is, then essentially everything in Sage is a data structure.",
    "created_at": "2016-01-11T19:31:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206302",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:107'></a>Replying to [comment:106 dkrenn]:
> I don't know about what the motivation of moving it was, but I disagree that it is *not* a data structure. `list` is a data structure for sure, so a variant of it, namely our lazy list, is it as well.

Well, the "variant" adds something, but not in terms of the data structure. I would say that a lazy list is some kind of wrapper of a data structure, not a new data structure.

> The wikipedia says on "data structure" in its first sentence:
>     In computer science, a data structure is a particular way of organizing data in a computer so that it can be used efficiently.
> That's what we have, haven't we?

Not really. I wouldn't call a lazy list "a way of organizing data".

It you think it is, then essentially everything in Sage is a data structure.



---

archive/issue_comments_206303.json:
```json
{
    "body": "<a id='comment:8'></a>Data structures should be very basic low-level things. This \"lazy list\" is too specific and too much Python to fit that definition in my opinion.",
    "created_at": "2016-01-11T19:37:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206303",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>Data structures should be very basic low-level things. This "lazy list" is too specific and too much Python to fit that definition in my opinion.



---

archive/issue_comments_206304.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-01-11T22:27:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206304",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_206305.json:
```json
{
    "body": "<a id='comment:0'></a>All right. Let it go back into where it was. Nobody should complain about something not being at its place in misc.",
    "created_at": "2016-01-11T22:28:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206305",
    "user": "https://github.com/videlec"
}
```

<a id='comment:0'></a>All right. Let it go back into where it was. Nobody should complain about something not being at its place in misc.



---

archive/issue_comments_206306.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2016-01-11T22:28:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206306",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_206307.json:
```json
{
    "body": "<a id='comment:111'></a>Replying to [comment:110 vdelecroix]:\n> All right. Let it go back into where it was. Nobody should complain about something not being at its place in misc.\n\n\nThe two `index.rst` need to be reverted as well...",
    "created_at": "2016-01-14T08:28:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206307",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:111'></a>Replying to [comment:110 vdelecroix]:
> All right. Let it go back into where it was. Nobody should complain about something not being at its place in misc.


The two `index.rst` need to be reverted as well...



---

archive/issue_comments_206308.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-01-14T08:28:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206308",
    "user": "https://github.com/dkrenn"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_206309.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-01-14T08:40:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206309",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_206310.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2016-01-14T09:30:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206310",
    "user": "https://github.com/dkrenn"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_206311.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-01-19T17:46:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206311",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_206312.json:
```json
{
    "body": "<a id='comment:5'></a>\n```\nsage -t --long src/sage/misc/lazy_list.pyx\n**********************************************************************\nFile \"src/sage/misc/lazy_list.pyx\", line 543, in sage.misc.lazy_list.lazy_list_generic._fit\nFailed example:\n    l._info()\nExpected:\n    cache length 0\n    start        2\n    stop         9223372036854775807\n    step         3\nGot:\n    cache length 0\n    start        2\n    stop         2147483647\n    step         3\n**********************************************************************\n1 item had failures:\n   1 of  10 in sage.misc.lazy_list.lazy_list_generic._fit\n    [204 tests, 1 failure, 0.05 s]\n```",
    "created_at": "2016-01-19T17:46:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206312",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:5'></a>
```
sage -t --long src/sage/misc/lazy_list.pyx
**********************************************************************
File "src/sage/misc/lazy_list.pyx", line 543, in sage.misc.lazy_list.lazy_list_generic._fit
Failed example:
    l._info()
Expected:
    cache length 0
    start        2
    stop         9223372036854775807
    step         3
Got:
    cache length 0
    start        2
    stop         2147483647
    step         3
**********************************************************************
1 item had failures:
   1 of  10 in sage.misc.lazy_list.lazy_list_generic._fit
    [204 tests, 1 failure, 0.05 s]
```



---

archive/issue_comments_206313.json:
```json
{
    "body": "<a id='comment:6'></a>right. 32 bits vs 64 bits. I am fixing the corresponding doctests.",
    "created_at": "2016-01-20T19:32:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206313",
    "user": "https://github.com/videlec"
}
```

<a id='comment:6'></a>right. 32 bits vs 64 bits. I am fixing the corresponding doctests.



---

archive/issue_comments_206314.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-01-20T19:43:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206314",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_206315.json:
```json
{
    "body": "<a id='comment:7'></a>New commits:",
    "created_at": "2016-01-20T19:43:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206315",
    "user": "https://github.com/videlec"
}
```

<a id='comment:7'></a>New commits:



---

archive/issue_events_047560.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-01-20T19:43:55Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "milestone": "sage-7.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16137#event-47560"
}
```



---

archive/issue_events_047561.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-01-20T19:43:55Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "milestone": "sage-7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16137#event-47561"
}
```



---

archive/issue_comments_206316.json:
```json
{
    "body": "<a id='comment:118'></a>Replying to [comment:116 vdelecroix]:\n> right. 32 bits vs 64 bits. I am fixing the corresponding doctests.\n\n\nAs the first number in\n\n```\nstop         9223372036854775807    # 64-bit\nstop         2147483648             # 32-bit\n```\n`2^63-1`, I believe that the second should be `2^31-1 = 2147483647`. Unfortunately, I don't have a 32-bit system to test.",
    "created_at": "2016-01-21T16:44:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206316",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:118'></a>Replying to [comment:116 vdelecroix]:
> right. 32 bits vs 64 bits. I am fixing the corresponding doctests.


As the first number in

```
stop         9223372036854775807    # 64-bit
stop         2147483648             # 32-bit
```
`2^63-1`, I believe that the second should be `2^31-1 = 2147483647`. Unfortunately, I don't have a 32-bit system to test.



---

archive/issue_comments_206317.json:
```json
{
    "body": "<a id='comment:119'></a>Replying to [comment:117 vdelecroix]:\n> |                                                                                                                                          |                            |\n> |------------------------------------------------------------------------------------------------------------------------------------------|----------------------------|\n> |[f1c6036](http://git.sagemath.org/sage.git/commit/?id=f1c60365a7f71f3394ea820d307a48c5f26b4d2b)|`Trac 16137: merge Sage-7.0`|\n\n\nWhat was the reason for merging? Was there any conflict?\nBTW: You did not merge 7.0 into the branch but the other way round, i.e., you merged this ticket into 7.0 (like the release manager). This makes seeing the changes much more difficult, since the git specifications like `HEAD^` or `HEAD~3` all take the first parent, which now is not the original branch of this ticket anymore.",
    "created_at": "2016-01-21T16:46:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206317",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:119'></a>Replying to [comment:117 vdelecroix]:
> |                                                                                                                                          |                            |
> |------------------------------------------------------------------------------------------------------------------------------------------|----------------------------|
> |[f1c6036](http://git.sagemath.org/sage.git/commit/?id=f1c60365a7f71f3394ea820d307a48c5f26b4d2b)|`Trac 16137: merge Sage-7.0`|


What was the reason for merging? Was there any conflict?
BTW: You did not merge 7.0 into the branch but the other way round, i.e., you merged this ticket into 7.0 (like the release manager). This makes seeing the changes much more difficult, since the git specifications like `HEAD^` or `HEAD~3` all take the first parent, which now is not the original branch of this ticket anymore.



---

archive/issue_comments_206318.json:
```json
{
    "body": "<a id='comment:0'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-01-22T01:13:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206318",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:0'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_206319.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-02-02T16:13:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206319",
    "user": "https://github.com/dkrenn"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_206320.json:
```json
{
    "body": "<a id='comment:121'></a>Replying to [comment:120 git]:\n> Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n> |                                                                                                                                          |                                                |\n> |------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------|\n> |[f7960c1](http://git.sagemath.org/sage.git/commit/?id=f7960c1038c1498eca8995a3e39e7c3a4f76e99e)|`Trac 16137: fixing a doctest and a constructor`|\n\n\nSorry for the delay (for some unknown reason I didn't got a notification about the commit; double-checked). Everything is fine now; thanks.",
    "created_at": "2016-02-02T16:13:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206320",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:121'></a>Replying to [comment:120 git]:
> Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
> |                                                                                                                                          |                                                |
> |------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------|
> |[f7960c1](http://git.sagemath.org/sage.git/commit/?id=f7960c1038c1498eca8995a3e39e7c3a4f76e99e)|`Trac 16137: fixing a doctest and a constructor`|


Sorry for the delay (for some unknown reason I didn't got a notification about the commit; double-checked). Everything is fine now; thanks.



---

archive/issue_comments_206321.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-02-02T23:06:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16137#issuecomment-206321",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_047562.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-02-02T23:06:40Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16137",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16137#event-47562"
}
```
