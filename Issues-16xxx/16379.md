# Issue 16379: Compute Hasse invariant over number fields and fix current implementation

archive/issues_016142.json:
```json
{
    "assignees": [],
    "body": "This patch will enhance the current functions hasse_invariant and hasse_invariant_OMeara to include computations of Hasse invariant for quadratic forms over number fields.  In addition, this patch fixes an indexing error in the original hasse_invariant_OMeara code, which currently reads\n\n```\nfor j in range(n-1):\n    for k in range(j, n):\n```\nbut should read \n\n```\nfor j in range(n):\n    for k in range(j, n):\n```\nto be consistent with OMeara's algorithm. \n\nBranch/Commit: **[f8fec47](https://github.com/sagemath/sagetrac-mirror/commit/f8fec470e7514f2ad4d8400da4006f63a1d9a2ff)**\n\nReviewer: **Peter Bruin**\n\nAuthor: **Anna Haensch**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/16379_\n\n",
    "closed_at": "2014-05-25T10:09:20Z",
    "created_at": "2014-05-20T09:25:46Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20quadratic%20forms",
        "https://github.com/sagemath/sage/labels/p4%20%E2%80%93%20minor",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Compute Hasse invariant over number fields and fix current implementation",
    "type": "issue",
    "updated_at": "2014-05-25T10:09:20Z",
    "url": "https://github.com/sagemath/sage/issues/16379",
    "user": "https://github.com/annahaensch"
}
```
This patch will enhance the current functions hasse_invariant and hasse_invariant_OMeara to include computations of Hasse invariant for quadratic forms over number fields.  In addition, this patch fixes an indexing error in the original hasse_invariant_OMeara code, which currently reads

```
for j in range(n-1):
    for k in range(j, n):
```
but should read 

```
for j in range(n):
    for k in range(j, n):
```
to be consistent with OMeara's algorithm. 

Branch/Commit: **[f8fec47](https://github.com/sagemath/sagetrac-mirror/commit/f8fec470e7514f2ad4d8400da4006f63a1d9a2ff)**

Reviewer: **Peter Bruin**

Author: **Anna Haensch**

_Issue created by migration from https://trac.sagemath.org/ticket/16379_





---

archive/issue_events_208669.json:
```json
{
    "actor": "https://github.com/annahaensch",
    "created_at": "2014-05-20T09:25:46Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16379",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16379#event-208669"
}
```



---

archive/issue_events_208670.json:
```json
{
    "actor": "https://github.com/annahaensch",
    "created_at": "2014-05-20T09:25:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16379",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20quadratic%20forms",
    "label_color": "0000ff",
    "label_name": "component: quadratic forms",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16379#event-208670"
}
```



---

archive/issue_events_208671.json:
```json
{
    "actor": "https://github.com/annahaensch",
    "created_at": "2014-05-20T09:25:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16379",
    "label": "https://github.com/sagemath/sage/labels/p4%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16379#event-208671"
}
```



---

archive/issue_events_208672.json:
```json
{
    "actor": "https://github.com/annahaensch",
    "created_at": "2014-05-20T09:25:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16379",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16379#event-208672"
}
```



---

archive/issue_comments_213844.json:
```json
{
    "body": "Branch: **[u/annahaensch/ticket/16379](https://github.com/sagemath/sagetrac-mirror/tree/u/annahaensch/ticket/16379)**",
    "created_at": "2014-05-20T15:06:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16379",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16379#issuecomment-213844",
    "user": "https://github.com/annahaensch"
}
```

Branch: **[u/annahaensch/ticket/16379](https://github.com/sagemath/sagetrac-mirror/tree/u/annahaensch/ticket/16379)**



---

archive/issue_comments_213845.json:
```json
{
    "body": "Commit: **[471f157](https://github.com/sagemath/sagetrac-mirror/commit/471f15734adb60b20b0bc3d6c37aeaa5c2c2e5f5)**",
    "created_at": "2014-05-21T09:33:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16379",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16379#issuecomment-213845",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[471f157](https://github.com/sagemath/sagetrac-mirror/commit/471f15734adb60b20b0bc3d6c37aeaa5c2c2e5f5)**



---

archive/issue_comments_213846.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/471f15734adb60b20b0bc3d6c37aeaa5c2c2e5f5\">471f157</a></td><td><code>updated examples from last commit</code></td></tr></table>\n",
    "created_at": "2014-05-21T09:33:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16379",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16379#issuecomment-213846",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:2'>Comment 2:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/471f15734adb60b20b0bc3d6c37aeaa5c2c2e5f5">471f157</a></td><td><code>updated examples from last commit</code></td></tr></table>




---

archive/issue_events_208673.json:
```json
{
    "actor": "https://github.com/annahaensch",
    "created_at": "2014-05-21T09:44:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16379",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16379#event-208673"
}
```



---

archive/issue_comments_213847.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nLooks good to me except for two minor points:\n- it is best to keep existing doctests as far as possible; only add new ones, and fix old ones if necessary instead of replacing them;\n- your patch introduces trailing whitespace on several lines (use e.g. `git diff --color develop...YOURBRANCH` to see this); this is discouraged, so could you remove it if and when you make another commit?\n(The patchbot encountered a doctest failure on 6.3.beta1, but it seems to be unrelated to your patch.)",
    "created_at": "2014-05-23T10:03:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16379",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16379#issuecomment-213847",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:4'>Comment 4:</a>
Looks good to me except for two minor points:
- it is best to keep existing doctests as far as possible; only add new ones, and fix old ones if necessary instead of replacing them;
- your patch introduces trailing whitespace on several lines (use e.g. `git diff --color develop...YOURBRANCH` to see this); this is discouraged, so could you remove it if and when you make another commit?
(The patchbot encountered a doctest failure on 6.3.beta1, but it seems to be unrelated to your patch.)



---

archive/issue_comments_213848.json:
```json
{
    "body": "Reviewer: **Peter Bruin**",
    "created_at": "2014-05-23T10:03:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16379",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16379#issuecomment-213848",
    "user": "https://github.com/pjbruin"
}
```

Reviewer: **Peter Bruin**



---

archive/issue_comments_213849.json:
```json
{
    "body": "Changed commit from **[471f157](https://github.com/sagemath/sagetrac-mirror/commit/471f15734adb60b20b0bc3d6c37aeaa5c2c2e5f5)** to **[a6fc438](https://github.com/sagemath/sagetrac-mirror/commit/a6fc438f5ec644581e6ba962bf9cab1a4a4a6253)**",
    "created_at": "2014-05-23T11:48:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16379",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16379#issuecomment-213849",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[471f157](https://github.com/sagemath/sagetrac-mirror/commit/471f15734adb60b20b0bc3d6c37aeaa5c2c2e5f5)** to **[a6fc438](https://github.com/sagemath/sagetrac-mirror/commit/a6fc438f5ec644581e6ba962bf9cab1a4a4a6253)**



---

archive/issue_comments_213850.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a6fc438f5ec644581e6ba962bf9cab1a4a4a6253\">a6fc438</a></td><td><code>Removed trailing whitespace from last commit</code></td></tr></table>\n",
    "created_at": "2014-05-23T11:48:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16379",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16379#issuecomment-213850",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:5'>Comment 5:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a6fc438f5ec644581e6ba962bf9cab1a4a4a6253">a6fc438</a></td><td><code>Removed trailing whitespace from last commit</code></td></tr></table>




---

archive/issue_comments_213851.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nComing back to this point:\n> - it is best to keep existing doctests as far as possible; only add new ones, and fix old ones if necessary instead of replacing them;\n\nI now see that there were two identical doctests (with `DiagonalQuadraticForm(ZZ, [1, -1, -1])`) and you changed `[1, -1, -1]` to `[1, -1, 5]` in both of them.  Could you change one of them back to `[1, -1, -1]`?  Then we get both your new doctest and the old one, instead of duplicates.",
    "created_at": "2014-05-23T12:53:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16379",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16379#issuecomment-213851",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:6'>Comment 6:</a>
Coming back to this point:
> - it is best to keep existing doctests as far as possible; only add new ones, and fix old ones if necessary instead of replacing them;

I now see that there were two identical doctests (with `DiagonalQuadraticForm(ZZ, [1, -1, -1])`) and you changed `[1, -1, -1]` to `[1, -1, 5]` in both of them.  Could you change one of them back to `[1, -1, -1]`?  Then we get both your new doctest and the old one, instead of duplicates.



---

archive/issue_comments_213852.json:
```json
{
    "body": "Changed commit from **[a6fc438](https://github.com/sagemath/sagetrac-mirror/commit/a6fc438f5ec644581e6ba962bf9cab1a4a4a6253)** to **[fb0d360](https://github.com/sagemath/sagetrac-mirror/commit/fb0d36017bc6118efe57935885464790b94c9d23)**",
    "created_at": "2014-05-23T13:45:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16379",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16379#issuecomment-213852",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[a6fc438](https://github.com/sagemath/sagetrac-mirror/commit/a6fc438f5ec644581e6ba962bf9cab1a4a4a6253)** to **[fb0d360](https://github.com/sagemath/sagetrac-mirror/commit/fb0d36017bc6118efe57935885464790b94c9d23)**



---

archive/issue_comments_213853.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fb0d36017bc6118efe57935885464790b94c9d23\">fb0d360</a></td><td><code>Reverted one example in doctest</code></td></tr></table>\n",
    "created_at": "2014-05-23T13:45:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16379",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16379#issuecomment-213853",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:7'>Comment 7:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fb0d36017bc6118efe57935885464790b94c9d23">fb0d360</a></td><td><code>Reverted one example in doctest</code></td></tr></table>




---

archive/issue_comments_213854.json:
```json
{
    "body": "Changed commit from **[fb0d360](https://github.com/sagemath/sagetrac-mirror/commit/fb0d36017bc6118efe57935885464790b94c9d23)** to **[f8fec47](https://github.com/sagemath/sagetrac-mirror/commit/f8fec470e7514f2ad4d8400da4006f63a1d9a2ff)**",
    "created_at": "2014-05-23T13:49:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16379",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16379#issuecomment-213854",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[fb0d360](https://github.com/sagemath/sagetrac-mirror/commit/fb0d36017bc6118efe57935885464790b94c9d23)** to **[f8fec47](https://github.com/sagemath/sagetrac-mirror/commit/f8fec470e7514f2ad4d8400da4006f63a1d9a2ff)**



---

archive/issue_comments_213855.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f8fec470e7514f2ad4d8400da4006f63a1d9a2ff\">f8fec47</a></td><td><code>Reverts one doctest to old example, ignore last commit</code></td></tr></table>\n",
    "created_at": "2014-05-23T13:49:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16379",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16379#issuecomment-213855",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:8'>Comment 8:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f8fec470e7514f2ad4d8400da4006f63a1d9a2ff">f8fec47</a></td><td><code>Reverts one doctest to old example, ignore last commit</code></td></tr></table>




---

archive/issue_events_208674.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-05-23T14:28:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16379",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16379#event-208674"
}
```



---

archive/issue_events_208675.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2014-05-23T14:28:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16379",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16379#event-208675"
}
```



---

archive/issue_events_208676.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-05-25T10:09:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16379",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16379#event-208676"
}
```



---

archive/issue_events_208677.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "42080841b5fd46f1e8d2685b2f2cb7d3448994c1",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2014-05-25T10:09:20Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/16379",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16379#event-208677"
}
```



---

archive/issue_comments_213856.json:
```json
{
    "body": "Changed branch from **[u/annahaensch/ticket/16379](https://github.com/sagemath/sagetrac-mirror/tree/u/annahaensch/ticket/16379)** to **[f8fec47](https://github.com/sagemath/sagetrac-mirror/commit/f8fec470e7514f2ad4d8400da4006f63a1d9a2ff)**",
    "created_at": "2014-05-25T10:09:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16379",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16379#issuecomment-213856",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/annahaensch/ticket/16379](https://github.com/sagemath/sagetrac-mirror/tree/u/annahaensch/ticket/16379)** to **[f8fec47](https://github.com/sagemath/sagetrac-mirror/commit/f8fec470e7514f2ad4d8400da4006f63a1d9a2ff)**
