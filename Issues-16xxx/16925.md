# Issue 16925: Revert SymmetricGroup.algebra change from #16678

archive/issues_016688.json:
```json
{
    "assignees": [],
    "body": "#16678 makes `SymmetricGroup(n).algebra(K)` return `SymmetricGroupAlgebra(K,n)`.\n\nThis is nice in principle since `SymmetricGroupAlgebra` makes use of the specific properties of the symmetric group to provide more features (better implementation of the center, Yucis-Murphy elements, ...). However `SymmetricGroupAlgebra` is not a drop-in replacement for the plain group algebra of the symmetric group. In particular it breaks several assumptions of `.algebra` like the fact that the basis of `G.algebra(K)` is indexed by elements of `G` (here the basis is indexed by plain `Permutation`'s); it is therefore likely to create bugs and confusion.\n\nThis ticket reverts `SymmetricGroup.algebra` to the default behavior. See #16926 for a proper plan to endow it with the additional structure of `SymmetricGroupAlgebra`.\n\n\n**CC:**  sage-combinat @tscrim @darijgr @avirmaux\n\n**Reviewer:** Nicolas M. Thi\u00e9ry\n\nIssue created by migration from https://trac.sagemath.org/ticket/16925\n\n",
    "closed_at": "2015-03-20T19:56:20Z",
    "created_at": "2014-09-03T11:31:40Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20combinatorics",
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/duplicate"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Revert SymmetricGroup.algebra change from #16678",
    "type": "issue",
    "updated_at": "2015-03-20T19:56:20Z",
    "url": "https://github.com/sagemath/sage/issues/16925",
    "user": "https://github.com/nthiery"
}
```
#16678 makes `SymmetricGroup(n).algebra(K)` return `SymmetricGroupAlgebra(K,n)`.

This is nice in principle since `SymmetricGroupAlgebra` makes use of the specific properties of the symmetric group to provide more features (better implementation of the center, Yucis-Murphy elements, ...). However `SymmetricGroupAlgebra` is not a drop-in replacement for the plain group algebra of the symmetric group. In particular it breaks several assumptions of `.algebra` like the fact that the basis of `G.algebra(K)` is indexed by elements of `G` (here the basis is indexed by plain `Permutation`'s); it is therefore likely to create bugs and confusion.

This ticket reverts `SymmetricGroup.algebra` to the default behavior. See #16926 for a proper plan to endow it with the additional structure of `SymmetricGroupAlgebra`.


**CC:**  sage-combinat @tscrim @darijgr @avirmaux

**Reviewer:** Nicolas M. Thi√©ry

Issue created by migration from https://trac.sagemath.org/ticket/16925





---

archive/issue_events_207169.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2014-09-03T11:31:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16925",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20combinatorics",
    "label_color": "08517b",
    "label_name": "component: combinatorics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16925#event-207169"
}
```



---

archive/issue_events_207170.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2014-09-03T11:31:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16925",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "008080",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16925#event-207170"
}
```



---

archive/issue_events_207171.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2014-09-03T11:31:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16925",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "008080",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16925#event-207171"
}
```



---

archive/issue_comments_225573.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,5 +2,5 @@\n \n This is nice in principle since `SymmetricGroupAlgebra` makes use of the specific properties of the symmetric group to provide more features (better implementation of the center, Yucis-Murphy elements, ...). However `SymmetricGroupAlgebra` is not a drop-in replacement for the plain group algebra of the symmetric group. In particular it breaks several assumptions of `.algebra` like the fact that the basis of `G.algebra(K)` is indexed by elements of `G` (here the basis is indexed by plain `Permutation`'s); it is therefore likely to create bugs and confusion.\n \n-This ticket reverts `SymmetricGroup.algebra` to the default behavior. See #... for a proper plan to endow it with the additional structure of `SymmetricGroupAlgebra`.\n+This ticket reverts `SymmetricGroup.algebra` to the default behavior. See #16926 for a proper plan to endow it with the additional structure of `SymmetricGroupAlgebra`.\n \n``````\n",
    "created_at": "2014-09-03T11:41:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16925#issuecomment-225573",
    "user": "https://github.com/nthiery"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,5 +2,5 @@
 
 This is nice in principle since `SymmetricGroupAlgebra` makes use of the specific properties of the symmetric group to provide more features (better implementation of the center, Yucis-Murphy elements, ...). However `SymmetricGroupAlgebra` is not a drop-in replacement for the plain group algebra of the symmetric group. In particular it breaks several assumptions of `.algebra` like the fact that the basis of `G.algebra(K)` is indexed by elements of `G` (here the basis is indexed by plain `Permutation`'s); it is therefore likely to create bugs and confusion.
 
-This ticket reverts `SymmetricGroup.algebra` to the default behavior. See #... for a proper plan to endow it with the additional structure of `SymmetricGroupAlgebra`.
+This ticket reverts `SymmetricGroup.algebra` to the default behavior. See #16926 for a proper plan to endow it with the additional structure of `SymmetricGroupAlgebra`.
 
``````




---

archive/issue_comments_225574.json:
```json
{
    "body": "**Branch:** [u/nthiery/revert_symmetricgroup_algebra_change_from__16678](https://github.com/sagemath/sagetrac-mirror/tree/u/nthiery/revert_symmetricgroup_algebra_change_from__16678)",
    "created_at": "2014-09-03T11:55:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16925#issuecomment-225574",
    "user": "https://github.com/nthiery"
}
```

**Branch:** [u/nthiery/revert_symmetricgroup_algebra_change_from__16678](https://github.com/sagemath/sagetrac-mirror/tree/u/nthiery/revert_symmetricgroup_algebra_change_from__16678)



---

archive/issue_comments_225575.json:
```json
{
    "body": "<a id='comment:3'></a>\nI have a request. Could you add the fact that `SymmetricGroup.algebra() != SymmetricGroupAlgebra` to the doc, along with an explanation of how to get the `SymmetricGroupAlgebra`? Thanks.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/479fddb4afe86e8dc5382f50e0d8d0d11913e23a\">479fddb</a></td><td><code>16925: revert SymmetricGroups(...).algebra(...) to just do the standard thing</code></td></tr></table>\n",
    "created_at": "2014-09-03T11:58:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16925#issuecomment-225575",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:3'></a>
I have a request. Could you add the fact that `SymmetricGroup.algebra() != SymmetricGroupAlgebra` to the doc, along with an explanation of how to get the `SymmetricGroupAlgebra`? Thanks.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/479fddb4afe86e8dc5382f50e0d8d0d11913e23a">479fddb</a></td><td><code>16925: revert SymmetricGroups(...).algebra(...) to just do the standard thing</code></td></tr></table>




---

archive/issue_comments_225576.json:
```json
{
    "body": "**Commit:** [479fddb4afe86e8dc5382f50e0d8d0d11913e23a](https://github.com/sagemath/sagetrac-mirror/commit/479fddb4afe86e8dc5382f50e0d8d0d11913e23a)",
    "created_at": "2014-09-03T11:58:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16925#issuecomment-225576",
    "user": "https://github.com/darijgr"
}
```

**Commit:** [479fddb4afe86e8dc5382f50e0d8d0d11913e23a](https://github.com/sagemath/sagetrac-mirror/commit/479fddb4afe86e8dc5382f50e0d8d0d11913e23a)



---

archive/issue_comments_225577.json:
```json
{
    "body": "<a id='comment:4'></a>\nReplying to [@darijgr](#comment%3A3):\n> I have a request. Could you add the fact that `SymmetricGroup.algebra() != SymmetricGroupAlgebra` to the doc, along with an explanation of how to get the `SymmetricGroupAlgebra`? Thanks.\n\nI considered this. It means leaving an algebra method in SymmetricGroup that does nothing but the standard thing, except for having an extra chunk of doc advertising SymmetricGroupAlgebra and the backward incompatibility issue. I can do that if you think that's helpful for the user.\n\nRight now, I am running all tests after just stripping away the method.",
    "created_at": "2014-09-03T12:21:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16925#issuecomment-225577",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:4'></a>
Replying to [@darijgr](#comment%3A3):
> I have a request. Could you add the fact that `SymmetricGroup.algebra() != SymmetricGroupAlgebra` to the doc, along with an explanation of how to get the `SymmetricGroupAlgebra`? Thanks.

I considered this. It means leaving an algebra method in SymmetricGroup that does nothing but the standard thing, except for having an extra chunk of doc advertising SymmetricGroupAlgebra and the backward incompatibility issue. I can do that if you think that's helpful for the user.

Right now, I am running all tests after just stripping away the method.



---

archive/issue_comments_225578.json:
```json
{
    "body": "<a id='comment:5'></a>\nOops, I meant adding a mention of this to the class-wide doc. Overshadowing the method solely for this sake is too much of a hassle, sorry.",
    "created_at": "2014-09-03T12:22:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16925#issuecomment-225578",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:5'></a>
Oops, I meant adding a mention of this to the class-wide doc. Overshadowing the method solely for this sake is too much of a hassle, sorry.



---

archive/issue_comments_225579.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [@darijgr](#comment%3A5):\n> Oops, I meant adding a mention of this to the class-wide doc. Overshadowing the method solely for this sake is too much of a hassle, sorry.\n\nI am still hesitant actually. It's still nice to the user to warn him about the backward incompatibility flip-flop.",
    "created_at": "2014-09-03T12:27:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16925#issuecomment-225579",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:6'></a>
Replying to [@darijgr](#comment%3A5):
> Oops, I meant adding a mention of this to the class-wide doc. Overshadowing the method solely for this sake is too much of a hassle, sorry.

I am still hesitant actually. It's still nice to the user to warn him about the backward incompatibility flip-flop.



---

archive/issue_comments_225580.json:
```json
{
    "body": "<a id='comment:7'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ce71c7444f957da20f6f9bd1cda95fde8feda9b1\">ce71c74</a></td><td><code>16925: updated a few doctests according to the previous commit</code></td></tr></table>\n",
    "created_at": "2014-09-03T12:38:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16925#issuecomment-225580",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:7'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ce71c7444f957da20f6f9bd1cda95fde8feda9b1">ce71c74</a></td><td><code>16925: updated a few doctests according to the previous commit</code></td></tr></table>




---

archive/issue_comments_225581.json:
```json
{
    "body": "**Changing commit** from \"[479fddb4afe86e8dc5382f50e0d8d0d11913e23a](https://github.com/sagemath/sagetrac-mirror/commit/479fddb4afe86e8dc5382f50e0d8d0d11913e23a)\" to \"[ce71c7444f957da20f6f9bd1cda95fde8feda9b1](https://github.com/sagemath/sagetrac-mirror/commit/ce71c7444f957da20f6f9bd1cda95fde8feda9b1)\".",
    "created_at": "2014-09-03T12:38:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16925#issuecomment-225581",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[479fddb4afe86e8dc5382f50e0d8d0d11913e23a](https://github.com/sagemath/sagetrac-mirror/commit/479fddb4afe86e8dc5382f50e0d8d0d11913e23a)" to "[ce71c7444f957da20f6f9bd1cda95fde8feda9b1](https://github.com/sagemath/sagetrac-mirror/commit/ce71c7444f957da20f6f9bd1cda95fde8feda9b1)".



---

archive/issue_events_207172.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2014-09-03T12:51:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16925",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16925#event-207172"
}
```



---

archive/issue_comments_225582.json:
```json
{
    "body": "<a id='comment:8'></a>\nWith the last commit, all tests passed. Haven't run long tests pass. Let's see what the bot says.",
    "created_at": "2014-09-03T12:51:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16925#issuecomment-225582",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:8'></a>
With the last commit, all tests passed. Haven't run long tests pass. Let's see what the bot says.



---

archive/issue_comments_225583.json:
```json
{
    "body": "<a id='comment:9'></a>\nLooks good to me...",
    "created_at": "2014-09-03T13:00:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16925#issuecomment-225583",
    "user": "https://github.com/avirmaux"
}
```

<a id='comment:9'></a>
Looks good to me...



---

archive/issue_comments_225584.json:
```json
{
    "body": "<a id='comment:10'></a>\nFor the record: it's actually a piece of luck that e.g. hecke_algebra_representations only needed a doctest update. The data structure of the element that was created behind the scene was actually corrupted since a term was internaly indexed by an element of `SymmetricGroup` whereas in the `SymmetricGroupAlgebra` elements are supposed to be indexed by `Permutation`s. Any  further operation on it would have lead to an explosion.\n\nGranted: the overall infrastructure should have trapped the creation of such corrupt element; but that's a different discussion ...",
    "created_at": "2014-09-03T13:11:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16925#issuecomment-225584",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:10'></a>
For the record: it's actually a piece of luck that e.g. hecke_algebra_representations only needed a doctest update. The data structure of the element that was created behind the scene was actually corrupted since a term was internaly indexed by an element of `SymmetricGroup` whereas in the `SymmetricGroupAlgebra` elements are supposed to be indexed by `Permutation`s. Any  further operation on it would have lead to an explosion.

Granted: the overall infrastructure should have trapped the creation of such corrupt element; but that's a different discussion ...



---

archive/issue_comments_225585.json:
```json
{
    "body": "<a id='comment:11'></a>\nI'm not quite sure about the (unwritten as far I can tell) assumption that `G.algebra` has a basis indexed by the elements of the group.\n\nHere are some timings of the two implementations:\n\n```\nsage: S = SymmetricGroup(3)\nsage: SGA = SymmetricGroupAlgebra(QQ, 3)\nsage: GA = GroupAlgebra(S, QQ)\nsage: %timeit L = list(GA.basis())\n10 loops, best of 3: 23.3 ms per loop\nsage: %timeit SL = list(SGA.basis())\n1000 loops, best of 3: 775 \u00b5s per loop\n\nsage: L = list(GA.basis())\nsage: SL = list(SGA.basis())\nsage: %timeit sum(L)\n1000 loops, best of 3: 357 \u00b5s per loop\nsage: %timeit sum(SL)\n1000 loops, best of 3: 336 \u00b5s per loop\nsage: %timeit prod(L)\n1000 loops, best of 3: 466 \u00b5s per loop\nsage: %timeit prod(SL)\n1000 loops, best of 3: 1.28 ms per loop\nsage: %timeit sum(L)^2\n100 loops, best of 3: 2.26 ms per loop\nsage: %timeit sum(SL)^2\n100 loops, best of 3: 7.68 ms per loop\n```\nSo getting the basis is significantly slower using the generic code, but multiplying elements is faster using the group.\n\nAlso going from the permutation group elements to a permutation is fast:\n\n```\nsage: lst = list(S)\nsage: %timeit Permutation(lst[4])\n10000 loops, best of 3: 69 \u00b5s per loop\n```\nalthough there is a slight bug:\n\n```\nsage: P3 = Permutations(3)\nsage: P3(lst[4])\nTypeError: object of type 'sage.groups.perm_gps.permgroup_element.PermutationGroupElement' has no len()\n```\nMultiplying permutation group elements is *really* fast compared to Sage's permutations:\n\n```\nsage: %timeit prod(lst)\n100000 loops, best of 3: 2.27 \u00b5s per loop\nsage: P3L = list(Permutations(3))\nsage: %timeit prod(P3L)\n1000 loops, best of 3: 446 \u00b5s per loop\n```\nSo my proposal would be to change the indexing set of `SymmetricGroupAlgebra` to be the `SymmetricGroup` and add conversions to Sage's permutations where necessary.",
    "created_at": "2014-09-03T17:29:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16925#issuecomment-225585",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:11'></a>
I'm not quite sure about the (unwritten as far I can tell) assumption that `G.algebra` has a basis indexed by the elements of the group.

Here are some timings of the two implementations:

```
sage: S = SymmetricGroup(3)
sage: SGA = SymmetricGroupAlgebra(QQ, 3)
sage: GA = GroupAlgebra(S, QQ)
sage: %timeit L = list(GA.basis())
10 loops, best of 3: 23.3 ms per loop
sage: %timeit SL = list(SGA.basis())
1000 loops, best of 3: 775 ¬µs per loop

sage: L = list(GA.basis())
sage: SL = list(SGA.basis())
sage: %timeit sum(L)
1000 loops, best of 3: 357 ¬µs per loop
sage: %timeit sum(SL)
1000 loops, best of 3: 336 ¬µs per loop
sage: %timeit prod(L)
1000 loops, best of 3: 466 ¬µs per loop
sage: %timeit prod(SL)
1000 loops, best of 3: 1.28 ms per loop
sage: %timeit sum(L)^2
100 loops, best of 3: 2.26 ms per loop
sage: %timeit sum(SL)^2
100 loops, best of 3: 7.68 ms per loop
```
So getting the basis is significantly slower using the generic code, but multiplying elements is faster using the group.

Also going from the permutation group elements to a permutation is fast:

```
sage: lst = list(S)
sage: %timeit Permutation(lst[4])
10000 loops, best of 3: 69 ¬µs per loop
```
although there is a slight bug:

```
sage: P3 = Permutations(3)
sage: P3(lst[4])
TypeError: object of type 'sage.groups.perm_gps.permgroup_element.PermutationGroupElement' has no len()
```
Multiplying permutation group elements is *really* fast compared to Sage's permutations:

```
sage: %timeit prod(lst)
100000 loops, best of 3: 2.27 ¬µs per loop
sage: P3L = list(Permutations(3))
sage: %timeit prod(P3L)
1000 loops, best of 3: 446 ¬µs per loop
```
So my proposal would be to change the indexing set of `SymmetricGroupAlgebra` to be the `SymmetricGroup` and add conversions to Sage's permutations where necessary.



---

archive/issue_comments_225586.json:
```json
{
    "body": "<a id='comment:12'></a>\nMinor technical challenge (or perhaps question), we will have to deal with handling backwards compatibility with giving the basis an instance of our `Permutation` class.",
    "created_at": "2014-09-03T19:27:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16925#issuecomment-225586",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:12'></a>
Minor technical challenge (or perhaps question), we will have to deal with handling backwards compatibility with giving the basis an instance of our `Permutation` class.



---

archive/issue_comments_225587.json:
```json
{
    "body": "<a id='comment:13'></a>\nHi Travis,\n\nThanks for the timings!\n\nReplying to [@tscrim](#comment%3A11):\n> I'm not quite sure about the (unwritten as far I can tell) assumption that `G.algebra` has a basis indexed by the elements of the group.\n\n```\n    sage: S = DihedralGroup(3)\n    sage: S.algebra?\n    ... provided by Sets.ParentMethods.algebra ...\n    This returns the K-free module with basis indexed by S, endowed\n    with whatever structure can be induced from that of S.\n    ...\n```\n\nSo any subclass overriding `algebra` should satisfy those premises.\n\n> Here are some timings of the two implementations:\n> ...\n> So getting the basis is significantly slower using the generic code,\n\nTo be precise: in both cases, the implementation of ``basis`` is the\nsame (provided by ModulesWithBasis). What we are seeing here is that\niterating through `SymmetricGroup(n)` is slower than iteration through\n`Permutations(n)`. Actually ridiculously slower:\n\n```\nsage: S = SymmetricGroup(6)\nsage: %time l = list(S)\nCPU times: user 1.05 s, sys: 29.2 ms, total: 1.08 s\nWall time: 1.19 s\nsage: S = Permutations(6)\nsage: %time l = list(S)\nCPU times: user 27.6 ms, sys: 13.4 ms, total: 41 ms\nWall time: 34.2 ms\n```\n\nIn principle the complexity should be fairly similar, even for a\ngeneric permutation group implementation; there really must be a\nglitch in the GAP/Sage communication given that GAP itself is about as\nfast as `Permutations`:\n\n```\nsage: S = gap(\"SymmetricGroup(6)\")\nsage: %time l = S.List()\nCPU times: user 21.7 ms, sys: 0 ns, total: 21.7 ms\nWall time: 33.9 ms\n```\n\nBut we are deviating here. That's for a separate ticket.\n\n> So my proposal would be to change the indexing set of `SymmetricGroupAlgebra` to be the `SymmetricGroup` and add conversions to Sage's permutations where necessary.\n\nThis would be even more backward incompatible: people have been using\n`SymmetricGroupAlgebra` for a long while, and some may have a specific\nneed for having it indexed by plain permutations. I prefer the\napproach outlined here and in #16926.\n\nCheers,\n                                  Nicolas",
    "created_at": "2014-09-03T19:51:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16925#issuecomment-225587",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:13'></a>
Hi Travis,

Thanks for the timings!

Replying to [@tscrim](#comment%3A11):
> I'm not quite sure about the (unwritten as far I can tell) assumption that `G.algebra` has a basis indexed by the elements of the group.

```
    sage: S = DihedralGroup(3)
    sage: S.algebra?
    ... provided by Sets.ParentMethods.algebra ...
    This returns the K-free module with basis indexed by S, endowed
    with whatever structure can be induced from that of S.
    ...
```

So any subclass overriding `algebra` should satisfy those premises.

> Here are some timings of the two implementations:
> ...
> So getting the basis is significantly slower using the generic code,

To be precise: in both cases, the implementation of ``basis`` is the
same (provided by ModulesWithBasis). What we are seeing here is that
iterating through `SymmetricGroup(n)` is slower than iteration through
`Permutations(n)`. Actually ridiculously slower:

```
sage: S = SymmetricGroup(6)
sage: %time l = list(S)
CPU times: user 1.05 s, sys: 29.2 ms, total: 1.08 s
Wall time: 1.19 s
sage: S = Permutations(6)
sage: %time l = list(S)
CPU times: user 27.6 ms, sys: 13.4 ms, total: 41 ms
Wall time: 34.2 ms
```

In principle the complexity should be fairly similar, even for a
generic permutation group implementation; there really must be a
glitch in the GAP/Sage communication given that GAP itself is about as
fast as `Permutations`:

```
sage: S = gap("SymmetricGroup(6)")
sage: %time l = S.List()
CPU times: user 21.7 ms, sys: 0 ns, total: 21.7 ms
Wall time: 33.9 ms
```

But we are deviating here. That's for a separate ticket.

> So my proposal would be to change the indexing set of `SymmetricGroupAlgebra` to be the `SymmetricGroup` and add conversions to Sage's permutations where necessary.

This would be even more backward incompatible: people have been using
`SymmetricGroupAlgebra` for a long while, and some may have a specific
need for having it indexed by plain permutations. I prefer the
approach outlined here and in #16926.

Cheers,
                                  Nicolas



---

archive/issue_comments_225588.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [@nthiery](#comment%3A13):\n> \n> ```\n>     sage: S = DihedralGroup(3)\n>     sage: S.algebra?\n>     ... provided by Sets.ParentMethods.algebra ...\n>     This returns the K-free module with basis indexed by S, endowed\n>     with whatever structure can be induced from that of S.\n>     ...\n> ```\n> \n> So any subclass overriding `algebra` should satisfy those premises.\n\nI didn't interpret that as a contract, but just instead a statement about what the generic method returns. I think some more terse language is needed, such as adding \"All classes overriding this method must return a K-module with basis indexed by S\".\n\n> In principle the complexity should be fairly similar, even for a\n> generic permutation group implementation; there really must be a\n> glitch in the GAP/Sage communication given that GAP itself is about as\n> fast as `Permutations`:\n> \n> ```\n> sage: S = gap(\"SymmetricGroup(6)\")\n> sage: %time l = S.List()\n> CPU times: user 21.7 ms, sys: 0 ns, total: 21.7 ms\n> Wall time: 33.9 ms\n> ```\n> \n> But we are deviating here. That's for a separate ticket.\n\nIt's possible that GAP is also slow, and I get similar behavior when using the Weyl group. However this is definitely something for a separate ticket.\n\n> This would be even more backward incompatible: people have been using\n> `SymmetricGroupAlgebra` for a long while, and some may have a specific\n> need for having it indexed by plain permutations. I prefer the\n> approach outlined here and in #16926.\n\nIt's (relatively) easy to get Sage's `Permutation`s to compare equal to permutation group elements, as perm gp elts have a method called `_gap_list`, which returns the oneline notation and compares correctly to a `Permutation`. We would also need to change the hash for a (standard) `Permutation` to return a hash of the tuple of self (and we could do this generically by doing this first and if we need a fallback, use the hash of the string representation). This should allow the basis to take a `Permutation` and return the correct element (plus IMO they really should compare properly anyways).\n\nAt the end of the day, the biggest thing I don't like is having a generic implementation when there is a specialized implementation (which we agree on I believe). Reverting the change and having more classes (even with a good ABC) seems like a much harder maintenance task in the long run.",
    "created_at": "2014-09-04T05:47:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16925#issuecomment-225588",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:14'></a>
Replying to [@nthiery](#comment%3A13):
> 
> ```
>     sage: S = DihedralGroup(3)
>     sage: S.algebra?
>     ... provided by Sets.ParentMethods.algebra ...
>     This returns the K-free module with basis indexed by S, endowed
>     with whatever structure can be induced from that of S.
>     ...
> ```
> 
> So any subclass overriding `algebra` should satisfy those premises.

I didn't interpret that as a contract, but just instead a statement about what the generic method returns. I think some more terse language is needed, such as adding "All classes overriding this method must return a K-module with basis indexed by S".

> In principle the complexity should be fairly similar, even for a
> generic permutation group implementation; there really must be a
> glitch in the GAP/Sage communication given that GAP itself is about as
> fast as `Permutations`:
> 
> ```
> sage: S = gap("SymmetricGroup(6)")
> sage: %time l = S.List()
> CPU times: user 21.7 ms, sys: 0 ns, total: 21.7 ms
> Wall time: 33.9 ms
> ```
> 
> But we are deviating here. That's for a separate ticket.

It's possible that GAP is also slow, and I get similar behavior when using the Weyl group. However this is definitely something for a separate ticket.

> This would be even more backward incompatible: people have been using
> `SymmetricGroupAlgebra` for a long while, and some may have a specific
> need for having it indexed by plain permutations. I prefer the
> approach outlined here and in #16926.

It's (relatively) easy to get Sage's `Permutation`s to compare equal to permutation group elements, as perm gp elts have a method called `_gap_list`, which returns the oneline notation and compares correctly to a `Permutation`. We would also need to change the hash for a (standard) `Permutation` to return a hash of the tuple of self (and we could do this generically by doing this first and if we need a fallback, use the hash of the string representation). This should allow the basis to take a `Permutation` and return the correct element (plus IMO they really should compare properly anyways).

At the end of the day, the biggest thing I don't like is having a generic implementation when there is a specialized implementation (which we agree on I believe). Reverting the change and having more classes (even with a good ABC) seems like a much harder maintenance task in the long run.



---

archive/issue_events_207173.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2015-03-20T05:45:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16925",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16925#event-207173"
}
```



---

archive/issue_events_207174.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2015-03-20T05:45:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16925",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16925#event-207174"
}
```



---

archive/issue_comments_225589.json:
```json
{
    "body": "<a id='comment:15'></a>\nThis can be set to duplicate of #16926 which is ready to go. We don't need anymore this intermediate step.",
    "created_at": "2015-03-20T05:45:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16925#issuecomment-225589",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:15'></a>
This can be set to duplicate of #16926 which is ready to go. We don't need anymore this intermediate step.



---

archive/issue_events_207175.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-03-20T06:36:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16925",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16925#event-207175"
}
```



---

archive/issue_events_207176.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-03-20T06:36:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16925",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16925#event-207176"
}
```



---

archive/issue_comments_225590.json:
```json
{
    "body": "<a id='comment:16'></a>\nreviewer name",
    "created_at": "2015-03-20T06:36:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16925#issuecomment-225590",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:16'></a>
reviewer name



---

archive/issue_comments_225591.json:
```json
{
    "body": "**Changing commit** from \"[ce71c7444f957da20f6f9bd1cda95fde8feda9b1](https://github.com/sagemath/sagetrac-mirror/commit/ce71c7444f957da20f6f9bd1cda95fde8feda9b1)\" to \"\".",
    "created_at": "2015-03-20T06:44:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16925#issuecomment-225591",
    "user": "https://github.com/darijgr"
}
```

**Changing commit** from "[ce71c7444f957da20f6f9bd1cda95fde8feda9b1](https://github.com/sagemath/sagetrac-mirror/commit/ce71c7444f957da20f6f9bd1cda95fde8feda9b1)" to "".



---

archive/issue_comments_225592.json:
```json
{
    "body": "**Changing branch** from \"[u/nthiery/revert_symmetricgroup_algebra_change_from__16678](https://github.com/sagemath/sagetrac-mirror/tree/u/nthiery/revert_symmetricgroup_algebra_change_from__16678)\" to \"\".",
    "created_at": "2015-03-20T06:44:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16925#issuecomment-225592",
    "user": "https://github.com/darijgr"
}
```

**Changing branch** from "[u/nthiery/revert_symmetricgroup_algebra_change_from__16678](https://github.com/sagemath/sagetrac-mirror/tree/u/nthiery/revert_symmetricgroup_algebra_change_from__16678)" to "".



---

archive/issue_events_207177.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2015-03-20T06:54:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16925",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16925#event-207177"
}
```



---

archive/issue_events_207178.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2015-03-20T06:54:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16925",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16925#event-207178"
}
```



---

archive/issue_comments_225593.json:
```json
{
    "body": "<a id='comment:18'></a>\nThanks Volker for the notice.",
    "created_at": "2015-03-20T06:54:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16925#issuecomment-225593",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:18'></a>
Thanks Volker for the notice.



---

archive/issue_comments_225594.json:
```json
{
    "body": "**Changing author** from \"Nicolas M. Thi\u00e9ry\" to \"\".",
    "created_at": "2015-03-20T06:54:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16925#issuecomment-225594",
    "user": "https://github.com/nthiery"
}
```

**Changing author** from "Nicolas M. Thi√©ry" to "".



---

archive/issue_comments_225595.json:
```json
{
    "body": "**Reviewer:** Nicolas M. Thi\u00e9ry",
    "created_at": "2015-03-20T06:54:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16925#issuecomment-225595",
    "user": "https://github.com/nthiery"
}
```

**Reviewer:** Nicolas M. Thi√©ry



---

archive/issue_comments_225596.json:
```json
{
    "body": "<a id='comment:19'></a>\nthere is no branch, did you delete it accidentally?",
    "created_at": "2015-03-20T18:39:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16925#issuecomment-225596",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:19'></a>
there is no branch, did you delete it accidentally?



---

archive/issue_events_207179.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-03-20T18:39:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16925",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16925#event-207179"
}
```



---

archive/issue_events_207180.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-03-20T18:39:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16925",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16925#event-207180"
}
```



---

archive/issue_comments_225597.json:
```json
{
    "body": "<a id='comment:20'></a>\nI deleted it because this branch is obsolete and a dead end. Or was this a wrong assumption?",
    "created_at": "2015-03-20T19:27:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16925#issuecomment-225597",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:20'></a>
I deleted it because this branch is obsolete and a dead end. Or was this a wrong assumption?



---

archive/issue_events_207181.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2015-03-20T19:41:50Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/16925",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16925#event-207181"
}
```



---

archive/issue_comments_225598.json:
```json
{
    "body": "<a id='comment:21'></a>\nThe milestone wasn't changed to duplicate.",
    "created_at": "2015-03-20T19:41:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16925",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16925#issuecomment-225598",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:21'></a>
The milestone wasn't changed to duplicate.



---

archive/issue_events_207182.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2015-03-20T19:41:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16925",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16925#event-207182"
}
```



---

archive/issue_events_207183.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2015-03-20T19:41:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16925",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16925#event-207183"
}
```



---

archive/issue_events_207184.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-03-20T19:56:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16925",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16925#event-207184"
}
```



---

archive/issue_events_207185.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-03-20T19:56:20Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/16925",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16925#event-207185"
}
```



---

archive/issue_events_207186.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-03-20T19:56:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16925",
    "label": "https://github.com/sagemath/sage/labels/duplicate",
    "label_color": "008080",
    "label_name": "duplicate",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16925#event-207186"
}
```
