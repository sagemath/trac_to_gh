# Issue 16680: Improve handling of "algorithm" parameter in EllipticCurve_finite_field.cardinality()

archive/issues_016443.json:
```json
{
    "body": "The following doctest in `ell_finite_field.py` can fail (by returning a cached result) because the same curve is used in an earlier doctest and may be cached by the `UniqueFactory` from #11474:\n\n```\nsage: EllipticCurve(GF(10007),[1,2,3,4,5]).cardinality(algorithm='foobar')\nTraceback (most recent call last):\n...\nValueError: Algorithm is not known\n```\nA trivial solution is to use a different curve for this test.\n\nThis ticket also makes the handling of the `algorithm` parameter more consistent and polishes the documentation a bit.\n\nCC:  @vbraun\n\nKeywords: elliptic curve cardinality\n\nBranch/Commit: 545410ead180904d6527f0ab54796b1d7e334e43\n\nReviewer: Travis Scrimshaw, Peter Bruin\n\nAuthor: Peter Bruin, Travis Scrimshaw\n\nDependencies: #11474\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/16680\n\n",
    "closed_at": "2014-07-20T03:18:45Z",
    "created_at": "2014-07-18T20:55:19Z",
    "labels": [
        "component: elliptic curves",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.3",
    "title": "Improve handling of \"algorithm\" parameter in EllipticCurve_finite_field.cardinality()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16680",
    "user": "https://github.com/pjbruin"
}
```
The following doctest in `ell_finite_field.py` can fail (by returning a cached result) because the same curve is used in an earlier doctest and may be cached by the `UniqueFactory` from #11474:

```
sage: EllipticCurve(GF(10007),[1,2,3,4,5]).cardinality(algorithm='foobar')
Traceback (most recent call last):
...
ValueError: Algorithm is not known
```
A trivial solution is to use a different curve for this test.

This ticket also makes the handling of the `algorithm` parameter more consistent and polishes the documentation a bit.

CC:  @vbraun

Keywords: elliptic curve cardinality

Branch/Commit: 545410ead180904d6527f0ab54796b1d7e334e43

Reviewer: Travis Scrimshaw, Peter Bruin

Author: Peter Bruin, Travis Scrimshaw

Dependencies: #11474

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/16680





---

archive/issue_comments_277262.json:
```json
{
    "body": "Changing commit from \"\" to \"5251798a7f60c9ef1b210f0154d2e11a6232bd90\"",
    "created_at": "2014-07-18T20:57:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16680",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16680#issuecomment-277262",
    "user": "https://github.com/pjbruin"
}
```

Changing commit from "" to "5251798a7f60c9ef1b210f0154d2e11a6232bd90"



---

archive/issue_comments_277263.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-07-18T20:57:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16680",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16680#issuecomment-277263",
    "user": "https://github.com/pjbruin"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_277264.json:
```json
{
    "body": "Changing branch from \"\" to \"u/pbruin/16880-elliptic_curve_cardinality_doctest\"",
    "created_at": "2014-07-18T20:57:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16680",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16680#issuecomment-277264",
    "user": "https://github.com/pjbruin"
}
```

Changing branch from "" to "u/pbruin/16880-elliptic_curve_cardinality_doctest"



---

archive/issue_comments_277265.json:
```json
{
    "body": "Changing commit from \"5251798a7f60c9ef1b210f0154d2e11a6232bd90\" to \"654c68080b7dad4c976dd1a035c808ab72947c5e\"",
    "created_at": "2014-07-18T20:59:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16680",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16680#issuecomment-277265",
    "user": "https://github.com/pjbruin"
}
```

Changing commit from "5251798a7f60c9ef1b210f0154d2e11a6232bd90" to "654c68080b7dad4c976dd1a035c808ab72947c5e"



---

archive/issue_comments_277266.json:
```json
{
    "body": "Changing branch from \"u/pbruin/16880-elliptic_curve_cardinality_doctest\" to \"u/pbruin/16680-elliptic_curve_cardinality_doctest\"",
    "created_at": "2014-07-18T20:59:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16680",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16680#issuecomment-277266",
    "user": "https://github.com/pjbruin"
}
```

Changing branch from "u/pbruin/16880-elliptic_curve_cardinality_doctest" to "u/pbruin/16680-elliptic_curve_cardinality_doctest"



---

archive/issue_comments_277267.json:
```json
{
    "body": "<a id='comment:3'></a>Continuing from #16158, the question is should the fact that the value has been computed (and cached) cause a recomputation? Currently how it is implemented is almost no, but it is always recomputed with `algorithm='all'`.\n\nI'm somewhat inclined to go with what you say, ignore the `algorithm` keyword *always* once we have computed the cardinality. (Side point, if we decide to go this route, we should probably switch it to use ``@`cached_method` with a key function that ignores the `algorithm`, but for another ticket.)\n\nHowever I feel like this could lead to difficult to find bugs, and instead we should recompute everytime a new algorithm is requested. (In this case, we could just convert it to a proper ``@`cached_method`.)",
    "created_at": "2014-07-19T00:05:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16680",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16680#issuecomment-277267",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:3'></a>Continuing from #16158, the question is should the fact that the value has been computed (and cached) cause a recomputation? Currently how it is implemented is almost no, but it is always recomputed with `algorithm='all'`.

I'm somewhat inclined to go with what you say, ignore the `algorithm` keyword *always* once we have computed the cardinality. (Side point, if we decide to go this route, we should probably switch it to use ``@`cached_method` with a key function that ignores the `algorithm`, but for another ticket.)

However I feel like this could lead to difficult to find bugs, and instead we should recompute everytime a new algorithm is requested. (In this case, we could just convert it to a proper ``@`cached_method`.)



---

archive/issue_comments_277268.json:
```json
{
    "body": "<a id='comment:4'></a>Replying to [comment:3 tscrim]:\n> Continuing from #16158, the question is should the fact that the value has been computed (and cached) cause a recomputation? Currently how it is implemented is almost no, but it is always recomputed with `algorithm='all'`.\n\nIf all the algorithms are correct, then I see no reason why we should ever recompute the order once it has been computed in any way; it is only useful for debugging purposes.\n> I'm somewhat inclined to go with what you say, ignore the `algorithm` keyword *always* once we have computed the cardinality. (Side point, if we decide to go this route, we should probably switch it to use ``@`cached_method` with a key function that ignores the `algorithm`, but for another ticket.)\n> \n> However I feel like this could lead to difficult to find bugs, and instead we should recompute everytime a new algorithm is requested. (In this case, we could just convert it to a proper ``@`cached_method`.)\n\nI don't have a strong opinion on this, although using ``@`cached_method` would have the advantage that we can get rid of manual caching.",
    "created_at": "2014-07-19T00:35:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16680",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16680#issuecomment-277268",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:4'></a>Replying to [comment:3 tscrim]:
> Continuing from #16158, the question is should the fact that the value has been computed (and cached) cause a recomputation? Currently how it is implemented is almost no, but it is always recomputed with `algorithm='all'`.

If all the algorithms are correct, then I see no reason why we should ever recompute the order once it has been computed in any way; it is only useful for debugging purposes.
> I'm somewhat inclined to go with what you say, ignore the `algorithm` keyword *always* once we have computed the cardinality. (Side point, if we decide to go this route, we should probably switch it to use ``@`cached_method` with a key function that ignores the `algorithm`, but for another ticket.)
> 
> However I feel like this could lead to difficult to find bugs, and instead we should recompute everytime a new algorithm is requested. (In this case, we could just convert it to a proper ``@`cached_method`.)

I don't have a strong opinion on this, although using ``@`cached_method` would have the advantage that we can get rid of manual caching.



---

archive/issue_comments_277269.json:
```json
{
    "body": "Changing commit from \"654c68080b7dad4c976dd1a035c808ab72947c5e\" to \"e058079e4c09923671b09edf681292d5d82c1903\"",
    "created_at": "2014-07-19T00:55:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16680",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16680#issuecomment-277269",
    "user": "https://github.com/tscrim"
}
```

Changing commit from "654c68080b7dad4c976dd1a035c808ab72947c5e" to "e058079e4c09923671b09edf681292d5d82c1903"



---

archive/issue_comments_277270.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2014-07-19T00:55:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16680",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16680#issuecomment-277270",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw"



---

archive/issue_comments_277271.json:
```json
{
    "body": "<a id='comment:5'></a>Well, we can't get rid of the manual cache because of the `cardinality_*` methods which set it when called (IMO, these should be private methods and have everything go through `cardinality()` but I don't have a stake in this).\n\nI've changed it so that `algorithm` is always ignored if the cardinality is known. If someone wants to check against another algorithm, they can explicitly call one of the `cardinality_*` methods (which always do the computation).\n\n---\nNew commits:",
    "created_at": "2014-07-19T00:55:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16680",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16680#issuecomment-277271",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:5'></a>Well, we can't get rid of the manual cache because of the `cardinality_*` methods which set it when called (IMO, these should be private methods and have everything go through `cardinality()` but I don't have a stake in this).

I've changed it so that `algorithm` is always ignored if the cardinality is known. If someone wants to check against another algorithm, they can explicitly call one of the `cardinality_*` methods (which always do the computation).

---
New commits:



---

archive/issue_comments_277272.json:
```json
{
    "body": "Changing branch from \"u/pbruin/16680-elliptic_curve_cardinality_doctest\" to \"u/tscrim/elliptic_curve_cardinality-16680\"",
    "created_at": "2014-07-19T00:55:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16680",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16680#issuecomment-277272",
    "user": "https://github.com/tscrim"
}
```

Changing branch from "u/pbruin/16680-elliptic_curve_cardinality_doctest" to "u/tscrim/elliptic_curve_cardinality-16680"



---

archive/issue_comments_277273.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:5 tscrim]:\n> Well, we can't get rid of the manual cache because of the `cardinality_*` methods which set it when called (IMO, these should be private methods and have everything go through `cardinality()` but I don't have a stake in this).\n\nI agree; this would be something for another ticket.\n> I've changed it so that `algorithm` is always ignored if the cardinality is known. If someone wants to check against another algorithm, they can explicitly call one of the `cardinality_*` methods (which always do the computation).\n\nYour doctest will probably fail if the elliptic curve is garbage-collected between the two invocations.",
    "created_at": "2014-07-19T10:05:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16680",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16680#issuecomment-277273",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:6'></a>Replying to [comment:5 tscrim]:
> Well, we can't get rid of the manual cache because of the `cardinality_*` methods which set it when called (IMO, these should be private methods and have everything go through `cardinality()` but I don't have a stake in this).

I agree; this would be something for another ticket.
> I've changed it so that `algorithm` is always ignored if the cardinality is known. If someone wants to check against another algorithm, they can explicitly call one of the `cardinality_*` methods (which always do the computation).

Your doctest will probably fail if the elliptic curve is garbage-collected between the two invocations.



---

archive/issue_comments_277274.json:
```json
{
    "body": "Changing reviewer from \"Travis Scrimshaw\" to \"Travis Scrimshaw, Peter Bruin\"",
    "created_at": "2014-07-19T11:21:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16680",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16680#issuecomment-277274",
    "user": "https://github.com/pjbruin"
}
```

Changing reviewer from "Travis Scrimshaw" to "Travis Scrimshaw, Peter Bruin"



---

archive/issue_comments_277275.json:
```json
{
    "body": "Changing type from task to enhancement.",
    "created_at": "2014-07-19T11:21:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16680",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16680#issuecomment-277275",
    "user": "https://github.com/pjbruin"
}
```

Changing type from task to enhancement.



---

archive/issue_comments_277276.json:
```json
{
    "body": "Changing commit from \"e058079e4c09923671b09edf681292d5d82c1903\" to \"545410ead180904d6527f0ab54796b1d7e334e43\"",
    "created_at": "2014-07-19T11:21:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16680",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16680#issuecomment-277276",
    "user": "https://github.com/pjbruin"
}
```

Changing commit from "e058079e4c09923671b09edf681292d5d82c1903" to "545410ead180904d6527f0ab54796b1d7e334e43"



---

archive/issue_comments_277277.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -7,3 +7,5 @@\n ValueError: Algorithm is not known\n ```\n A trivial solution is to use a different curve for this test.\n+\n+This ticket also makes the handling of the `algorithm` parameter more consistent and polishes the documentation a bit.\n``````\n",
    "created_at": "2014-07-19T11:21:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16680",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16680#issuecomment-277277",
    "user": "https://github.com/pjbruin"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -7,3 +7,5 @@
 ValueError: Algorithm is not known
 ```
 A trivial solution is to use a different curve for this test.
+
+This ticket also makes the handling of the `algorithm` parameter more consistent and polishes the documentation a bit.
``````




---

archive/issue_comments_277278.json:
```json
{
    "body": "Changing author from \"Peter Bruin\" to \"Peter Bruin, Travis Scrimshaw\"",
    "created_at": "2014-07-19T11:21:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16680",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16680#issuecomment-277278",
    "user": "https://github.com/pjbruin"
}
```

Changing author from "Peter Bruin" to "Peter Bruin, Travis Scrimshaw"



---

archive/issue_comments_277279.json:
```json
{
    "body": "Changing branch from \"u/tscrim/elliptic_curve_cardinality-16680\" to \"u/pbruin/16680-elliptic_curve_cardinality_doctest\"",
    "created_at": "2014-07-19T11:21:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16680",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16680#issuecomment-277279",
    "user": "https://github.com/pjbruin"
}
```

Changing branch from "u/tscrim/elliptic_curve_cardinality-16680" to "u/pbruin/16680-elliptic_curve_cardinality_doctest"



---

archive/issue_comments_277280.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:6 pbruin]:\n> Your doctest will probably fail if the elliptic curve is garbage-collected between the two invocations.\n\nFixed this, also polished the documentation a bit more and made `heuristic` an obsolete synonym for `pari`.  (`heuristic` just defaulted to `pari`, so there isn't any real heuristic going on, and \"heuristic\" may also be misinterpreted as saying that the result is not guaranteed to be correct.)",
    "created_at": "2014-07-19T11:21:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16680",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16680#issuecomment-277280",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:7'></a>Replying to [comment:6 pbruin]:
> Your doctest will probably fail if the elliptic curve is garbage-collected between the two invocations.

Fixed this, also polished the documentation a bit more and made `heuristic` an obsolete synonym for `pari`.  (`heuristic` just defaulted to `pari`, so there isn't any real heuristic going on, and "heuristic" may also be misinterpreted as saying that the result is not guaranteed to be correct.)



---

archive/issue_comments_277281.json:
```json
{
    "body": "Changing priority from trivial to minor.",
    "created_at": "2014-07-19T11:21:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16680",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16680#issuecomment-277281",
    "user": "https://github.com/pjbruin"
}
```

Changing priority from trivial to minor.



---

archive/issue_comments_277282.json:
```json
{
    "body": "Changing keywords from \"\" to \"elliptic curve cardinality\".",
    "created_at": "2014-07-19T11:21:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16680",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16680#issuecomment-277282",
    "user": "https://github.com/pjbruin"
}
```

Changing keywords from "" to "elliptic curve cardinality".



---

archive/issue_comments_277283.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:7 pbruin]:\n> Replying to [comment:6 pbruin]:\n> > Your doctest will probably fail if the elliptic curve is garbage-collected between the two invocations.\n\n> Fixed this,\n\nGood point.\n\n> also polished the documentation a bit more and made `heuristic` an obsolete synonym for `pari`.  (`heuristic` just defaulted to `pari`, so there isn't any real heuristic going on, and \"heuristic\" may also be misinterpreted as saying that the result is not guaranteed to be correct.)\n\n\nI agree since it always went to `pari`. This also leaves the door open for someone to re-implement this if someone comes up with a proper heuristic. So positive review. Thanks Peter.",
    "created_at": "2014-07-19T14:49:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16680",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16680#issuecomment-277283",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:8'></a>Replying to [comment:7 pbruin]:
> Replying to [comment:6 pbruin]:
> > Your doctest will probably fail if the elliptic curve is garbage-collected between the two invocations.

> Fixed this,

Good point.

> also polished the documentation a bit more and made `heuristic` an obsolete synonym for `pari`.  (`heuristic` just defaulted to `pari`, so there isn't any real heuristic going on, and "heuristic" may also be misinterpreted as saying that the result is not guaranteed to be correct.)


I agree since it always went to `pari`. This also leaves the door open for someone to re-implement this if someone comes up with a proper heuristic. So positive review. Thanks Peter.



---

archive/issue_comments_277284.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-07-19T14:49:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16680",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16680#issuecomment-277284",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_277285.json:
```json
{
    "body": "Changing branch from \"u/pbruin/16680-elliptic_curve_cardinality_doctest\" to \"545410ead180904d6527f0ab54796b1d7e334e43\"",
    "created_at": "2014-07-20T03:18:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16680",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16680#issuecomment-277285",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/pbruin/16680-elliptic_curve_cardinality_doctest" to "545410ead180904d6527f0ab54796b1d7e334e43"



---

archive/issue_events_048895.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-07-20T03:18:45Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16680",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16680#event-48895"
}
```



---

archive/issue_comments_277286.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-07-20T03:18:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16680",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16680#issuecomment-277286",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
