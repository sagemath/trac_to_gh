# Issue 16567: Use libsingular for polynomial rings over function fields

archive/issues_016330.json:
```json
{
    "assignees": [],
    "body": "Singular has polynomial rings over function fields. However, Sage makes no use of it:\n\n```\nsage: P.<a> = QQ[]\nsage: F = P.fraction_field()\nsage: type(F['x','y'])\n<class 'sage.rings.polynomial.multi_polynomial_ring.MPolynomialRing_polydict_domain_with_category'>\nsage: F = FunctionField(QQ,'a')\nsage: type(F['x','y'])\n<class 'sage.rings.polynomial.multi_polynomial_ring.MPolynomialRing_polydict_domain_with_category'>\n```\n\n\nUpdate:\n\nThis works now:\n\n```\nsage: F = PolynomialRing(QQ,'a').fraction_field()\nsage: R.<x,y> = F[]\nsage: F.inject_variables()\nDefining a\nsage: I = R.ideal([a*x+5*y^2, (1+a)/(1-a)*x^3-3*y*x])\nsage: I.groebner_basis()\n[x^3 + (3*a - 3)/(a + 1)*x*y, y^2 + (a)/5*x]\n```\n\n}}}\n\n\nCC:  @malb @miguelmarco @simon-king-jena @dimpase @sagetrac-sbulygin @bhutz @Torrencem @tscrim @jdemeyer @jpflori @embray @EnderWannabe\n\nKeywords: **function field, libsingular**\n\nBranch/Commit: **[6ce2bed](https://github.com/sagemath/sagetrac-mirror/commit/6ce2bedfabdf3f5fbf0f6b776baa222005e8de7a)**\n\nReviewer: **Travis Scrimshaw**\n\nAuthor: **Miguel Marco**\n\nComponent: **commutative algebra**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/16567_\n\n",
    "closed_at": "2021-11-15T23:16:31Z",
    "created_at": "2014-06-27T14:24:05Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20commutative%20algebra",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.5",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Use libsingular for polynomial rings over function fields",
    "type": "issue",
    "updated_at": "2021-11-15T23:16:31Z",
    "url": "https://github.com/sagemath/sage/issues/16567",
    "user": "https://github.com/simon-king-jena"
}
```
Singular has polynomial rings over function fields. However, Sage makes no use of it:

```
sage: P.<a> = QQ[]
sage: F = P.fraction_field()
sage: type(F['x','y'])
<class 'sage.rings.polynomial.multi_polynomial_ring.MPolynomialRing_polydict_domain_with_category'>
sage: F = FunctionField(QQ,'a')
sage: type(F['x','y'])
<class 'sage.rings.polynomial.multi_polynomial_ring.MPolynomialRing_polydict_domain_with_category'>
```


Update:

This works now:

```
sage: F = PolynomialRing(QQ,'a').fraction_field()
sage: R.<x,y> = F[]
sage: F.inject_variables()
Defining a
sage: I = R.ideal([a*x+5*y^2, (1+a)/(1-a)*x^3-3*y*x])
sage: I.groebner_basis()
[x^3 + (3*a - 3)/(a + 1)*x*y, y^2 + (a)/5*x]
```

}}}


CC:  @malb @miguelmarco @simon-king-jena @dimpase @sagetrac-sbulygin @bhutz @Torrencem @tscrim @jdemeyer @jpflori @embray @EnderWannabe

Keywords: **function field, libsingular**

Branch/Commit: **[6ce2bed](https://github.com/sagemath/sagetrac-mirror/commit/6ce2bedfabdf3f5fbf0f6b776baa222005e8de7a)**

Reviewer: **Travis Scrimshaw**

Author: **Miguel Marco**

Component: **commutative algebra**

_Issue created by migration from https://trac.sagemath.org/ticket/16567_





---

archive/issue_events_236732.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2014-06-27T14:24:05Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16567#event-236732"
}
```



---

archive/issue_events_236733.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2014-06-27T14:24:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16567#event-236733"
}
```



---

archive/issue_comments_215395.json:
```json
{
    "body": "Changed keywords from none to **function field, libsingular**",
    "created_at": "2014-06-27T14:27:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215395",
    "user": "https://github.com/simon-king-jena"
}
```

Changed keywords from none to **function field, libsingular**



---

archive/issue_events_236734.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2014-06-27T14:27:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20commutative%20algebra",
    "label_color": "0000ff",
    "label_name": "c: commutative algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16567#event-236734"
}
```



---

archive/issue_events_236735.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2014-06-27T14:27:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16567#event-236735"
}
```



---

archive/issue_comments_215396.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,12 @@\n+Singular has polynomial rings over function fields. However, Sage makes no use of it:\n \n+```\n+sage: P.<a> = QQ[]\n+sage: F = P.fraction_field()\n+sage: type(F['x','y'])\n+<class 'sage.rings.polynomial.multi_polynomial_ring.MPolynomialRing_polydict_domain_with_category'>\n+sage: F = FunctionField(QQ,'a')\n+sage: type(F['x','y'])\n+<class 'sage.rings.polynomial.multi_polynomial_ring.MPolynomialRing_polydict_domain_with_category'>\n+```\n+\n``````\n",
    "created_at": "2014-06-27T14:27:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215396",
    "user": "https://github.com/simon-king-jena"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,12 @@
+Singular has polynomial rings over function fields. However, Sage makes no use of it:
 
+```
+sage: P.<a> = QQ[]
+sage: F = P.fraction_field()
+sage: type(F['x','y'])
+<class 'sage.rings.polynomial.multi_polynomial_ring.MPolynomialRing_polydict_domain_with_category'>
+sage: F = FunctionField(QQ,'a')
+sage: type(F['x','y'])
+<class 'sage.rings.polynomial.multi_polynomial_ring.MPolynomialRing_polydict_domain_with_category'>
+```
+
``````




---

archive/issue_comments_215397.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nIt is not a big deal to create the `MPolynomialRing_libsingular` with parameters. However, I need to find out how to create a Singular `number` with parameters. Martin, can you give me a pointer to a relevant file of the Singular sources?",
    "created_at": "2014-06-28T07:59:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215397",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:2" align="right">comment:2</div>

It is not a big deal to create the `MPolynomialRing_libsingular` with parameters. However, I need to find out how to create a Singular `number` with parameters. Martin, can you give me a pointer to a relevant file of the Singular sources?



---

archive/issue_comments_215398.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nLooks like you want `kernel/longtrans.h`:\n\n```\n/*\n* ABSTRACT:   numbers in transcendental field extensions,\n              i.e., in rational function fields\n*/\n```",
    "created_at": "2014-06-28T15:16:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215398",
    "user": "https://github.com/malb"
}
```

<div id="comment:3" align="right">comment:3</div>

Looks like you want `kernel/longtrans.h`:

```
/*
* ABSTRACT:   numbers in transcendental field extensions,
              i.e., in rational function fields
*/
```



---

archive/issue_comments_215399.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nReplying to [@malb](#comment:3):\n> Looks like you want `kernel/longtrans.h`:\n> \n> ```\n> /*\n> * ABSTRACT:   numbers in transcendental field extensions,\n>               i.e., in rational function fields\n> */\n> ```\n\nThank you, Martin!\n\nSo far, I only found `number (*nPar)(int i)`. If I understand correctly, it returns the `i`-th parameter as a number. But this would probably be cumbersome to use for transforming an element of a Sage function field resp. of a Sage quotient field of polynomial ring.",
    "created_at": "2014-06-28T16:44:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215399",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:4" align="right">comment:4</div>

Replying to [@malb](#comment:3):
> Looks like you want `kernel/longtrans.h`:
> 
> ```
> /*
> * ABSTRACT:   numbers in transcendental field extensions,
>               i.e., in rational function fields
> */
> ```

Thank you, Martin!

So far, I only found `number (*nPar)(int i)`. If I understand correctly, it returns the `i`-th parameter as a number. But this would probably be cumbersome to use for transforming an element of a Sage function field resp. of a Sage quotient field of polynomial ring.



---

archive/issue_comments_215400.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nSeems like one actually needs to construct a `number` by starting with `nPar(i)` (which is a function pointer to `ntPar`, IIUC) and conversion of integers, and then add, multiply and divide. Or is there a way to directly convert a polynomial in variables `a,b,c` into a number in parameters `a,b,c`? After all, there is this globally accessible ring `nacRing` hosting numerator and denominator of a function field element.",
    "created_at": "2014-06-28T17:16:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215400",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:5" align="right">comment:5</div>

Seems like one actually needs to construct a `number` by starting with `nPar(i)` (which is a function pointer to `ntPar`, IIUC) and conversion of integers, and then add, multiply and divide. Or is there a way to directly convert a polynomial in variables `a,b,c` into a number in parameters `a,b,c`? After all, there is this globally accessible ring `nacRing` hosting numerator and denominator of a function field element.



---

archive/issue_comments_215401.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI'd assume there should be a way to convert a polynomial to a number as these numbers are polynomials internally as far as I know. Maybe ask on libsingular-devel?",
    "created_at": "2014-06-28T17:43:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215401",
    "user": "https://github.com/malb"
}
```

<div id="comment:6" align="right">comment:6</div>

I'd assume there should be a way to convert a polynomial to a number as these numbers are polynomials internally as far as I know. Maybe ask on libsingular-devel?



---

archive/issue_comments_215402.json:
```json
{
    "body": "Branch: **[u/SimonKing/use_libsingular_for_polynomial_rings_over_function_fields](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/use_libsingular_for_polynomial_rings_over_function_fields)**",
    "created_at": "2014-07-24T11:48:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215402",
    "user": "https://github.com/simon-king-jena"
}
```

Branch: **[u/SimonKing/use_libsingular_for_polynomial_rings_over_function_fields](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/use_libsingular_for_polynomial_rings_over_function_fields)**



---

archive/issue_comments_215403.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nMiguel asked me to push the basic steps that I did for this ticket.\n\nAll what works is to set up polynomial rings over \"fraction fields of polynomial rings\" as libsingular polynomial rings with parameters. What is missing is everything else. In particular: the element constructor must be modified so that elements of quotient fields of polynomial rings are converted into libsingular numbers.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d15c0ccfa463b18ae4742ea7ef2a50dbffe8b138\">d15c0cc</a></td><td><code>Use libsingular for polynomial ring with parameters.</code></td></tr></table>\n",
    "created_at": "2014-07-24T11:51:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215403",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:8" align="right">comment:8</div>

Miguel asked me to push the basic steps that I did for this ticket.

All what works is to set up polynomial rings over "fraction fields of polynomial rings" as libsingular polynomial rings with parameters. What is missing is everything else. In particular: the element constructor must be modified so that elements of quotient fields of polynomial rings are converted into libsingular numbers.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d15c0ccfa463b18ae4742ea7ef2a50dbffe8b138">d15c0cc</a></td><td><code>Use libsingular for polynomial ring with parameters.</code></td></tr></table>




---

archive/issue_comments_215404.json:
```json
{
    "body": "Commit: **[d15c0cc](https://github.com/sagemath/sagetrac-mirror/commit/d15c0ccfa463b18ae4742ea7ef2a50dbffe8b138)**",
    "created_at": "2014-07-24T11:51:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215404",
    "user": "https://github.com/simon-king-jena"
}
```

Commit: **[d15c0cc](https://github.com/sagemath/sagetrac-mirror/commit/d15c0ccfa463b18ae4742ea7ef2a50dbffe8b138)**



---

archive/issue_events_236736.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16567#event-236736"
}
```



---

archive/issue_events_236737.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16567#event-236737"
}
```



---

archive/issue_comments_215405.json:
```json
{
    "body": "Changed branch from **[u/SimonKing/use_libsingular_for_polynomial_rings_over_function_fields](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/use_libsingular_for_polynomial_rings_over_function_fields)** to **[u/mmarco/use_libsingular_for_polynomial_rings_over_function_fields](https://github.com/sagemath/sagetrac-mirror/tree/u/mmarco/use_libsingular_for_polynomial_rings_over_function_fields)**",
    "created_at": "2021-10-04T16:46:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215405",
    "user": "https://github.com/miguelmarco"
}
```

Changed branch from **[u/SimonKing/use_libsingular_for_polynomial_rings_over_function_fields](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/use_libsingular_for_polynomial_rings_over_function_fields)** to **[u/mmarco/use_libsingular_for_polynomial_rings_over_function_fields](https://github.com/sagemath/sagetrac-mirror/tree/u/mmarco/use_libsingular_for_polynomial_rings_over_function_fields)**



---

archive/issue_comments_215406.json:
```json
{
    "body": "Changed branch from **[u/mmarco/use_libsingular_for_polynomial_rings_over_function_fields](https://github.com/sagemath/sagetrac-mirror/tree/u/mmarco/use_libsingular_for_polynomial_rings_over_function_fields)** to **[u/SimonKing/use_libsingular_for_polynomial_rings_over_function_fields](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/use_libsingular_for_polynomial_rings_over_function_fields)**",
    "created_at": "2021-10-04T16:47:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215406",
    "user": "https://github.com/miguelmarco"
}
```

Changed branch from **[u/mmarco/use_libsingular_for_polynomial_rings_over_function_fields](https://github.com/sagemath/sagetrac-mirror/tree/u/mmarco/use_libsingular_for_polynomial_rings_over_function_fields)** to **[u/SimonKing/use_libsingular_for_polynomial_rings_over_function_fields](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/use_libsingular_for_polynomial_rings_over_function_fields)**



---

archive/issue_comments_215407.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nPing!\n\nI am trying (once again) to work on this. I also got to the point of creating the ring, and am stuck in the point of translating the coefficients.\n\nI have started with conversion from sage coefficients to singular ones (the `sa2si` function in `singular.pyx`; but for some reason i don't understand, the generated .c code does not import the definitions from `transext.h`.",
    "created_at": "2021-10-04T16:47:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215407",
    "user": "https://github.com/miguelmarco"
}
```

<div id="comment:11" align="right">comment:11</div>

Ping!

I am trying (once again) to work on this. I also got to the point of creating the ring, and am stuck in the point of translating the coefficients.

I have started with conversion from sage coefficients to singular ones (the `sa2si` function in `singular.pyx`; but for some reason i don't understand, the generated .c code does not import the definitions from `transext.h`.



---

archive/issue_comments_215408.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nAlso, i am not sure if i am dealing with the pointers correctly. It could use some review freom someone with more c/cython experience.",
    "created_at": "2021-10-04T16:57:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215408",
    "user": "https://github.com/miguelmarco"
}
```

<div id="comment:12" align="right">comment:12</div>

Also, i am not sure if i am dealing with the pointers correctly. It could use some review freom someone with more c/cython experience.



---

archive/issue_comments_215409.json:
```json
{
    "body": "Changed branch from **[u/SimonKing/use_libsingular_for_polynomial_rings_over_function_fields](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/use_libsingular_for_polynomial_rings_over_function_fields)** to **[/u/mmarco/use_libsingular_for_polynomial_rings_over_function_fields](https://github.com/sagemath/sagetrac-mirror/tree//u/mmarco/use_libsingular_for_polynomial_rings_over_function_fields)**",
    "created_at": "2021-10-04T19:57:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215409",
    "user": "https://github.com/nbruin"
}
```

Changed branch from **[u/SimonKing/use_libsingular_for_polynomial_rings_over_function_fields](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/use_libsingular_for_polynomial_rings_over_function_fields)** to **[/u/mmarco/use_libsingular_for_polynomial_rings_over_function_fields](https://github.com/sagemath/sagetrac-mirror/tree//u/mmarco/use_libsingular_for_polynomial_rings_over_function_fields)**



---

archive/issue_comments_215410.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nIt's a little easier if the branch you're talking about is actually attached.\n\nThe cython docs for \"cimport extern\" is here:\n\nhttps://cython.readthedocs.io/en/latest/src/userguide/external_C_code.html#referencing-c-header-files\n\nIt actually does say there that the extern declaration should let cython generate an `#include \"singular/polys/ext_fields/transext.h\"`. However, cython with take it on blind fate that the cython declarations given in the block itself somehow correspond to something that makes sense in C, because cython will not generate any declarations to define the types you specify: the \"extern\" promises that this is somehow resolved (by the given include or something else). So you should probably check that the generated C file indeed has an `#include` included. Otherwise, if you made a subtle typo compared with what's in C, the error would only arise in the C compiler, so you should probably carefully read the error that the C compiler generates and check that your spelling of everything matches up. Hope this helps?",
    "created_at": "2021-10-04T19:57:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215410",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:13" align="right">comment:13</div>

It's a little easier if the branch you're talking about is actually attached.

The cython docs for "cimport extern" is here:

https://cython.readthedocs.io/en/latest/src/userguide/external_C_code.html#referencing-c-header-files

It actually does say there that the extern declaration should let cython generate an `#include "singular/polys/ext_fields/transext.h"`. However, cython with take it on blind fate that the cython declarations given in the block itself somehow correspond to something that makes sense in C, because cython will not generate any declarations to define the types you specify: the "extern" promises that this is somehow resolved (by the given include or something else). So you should probably check that the generated C file indeed has an `#include` included. Otherwise, if you made a subtle typo compared with what's in C, the error would only arise in the C compiler, so you should probably carefully read the error that the C compiler generates and check that your spelling of everything matches up. Hope this helps?



---

archive/issue_comments_215411.json:
```json
{
    "body": "Changed commit from **[d15c0cc](https://github.com/sagemath/sagetrac-mirror/commit/d15c0ccfa463b18ae4742ea7ef2a50dbffe8b138)** to **[6978419](https://github.com/sagemath/sagetrac-mirror/commit/69784190e03a32daeaa675709840ca30ebbf539d)**",
    "created_at": "2021-10-04T19:57:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215411",
    "user": "https://github.com/nbruin"
}
```

Changed commit from **[d15c0cc](https://github.com/sagemath/sagetrac-mirror/commit/d15c0ccfa463b18ae4742ea7ef2a50dbffe8b138)** to **[6978419](https://github.com/sagemath/sagetrac-mirror/commit/69784190e03a32daeaa675709840ca30ebbf539d)**



---

archive/issue_comments_215412.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nThanks for the answer!\n\nI did check that: the generated .cpp file has this line\n\n```\n#include \"singular/polys/ext_fields/transext.h\"\n```\n\nand the file `SAGE_LOCAL/local/include/singular/polys/ext_fields/transext.h`  has the following declarations:\n\n```\nstruct fractionObject\n{\n  poly numerator;\n  poly denominator;\n  int complexity;\n};\n\ntypedef struct fractionObject * fraction;\n```\n\nSo I still have no idea about what could be going on.\n\n\nOne possible guess is that the generated file is a `.cpp`, that is, no pure C, but C++. Maybe some problem with scopes?",
    "created_at": "2021-10-04T20:09:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215412",
    "user": "https://github.com/miguelmarco"
}
```

<div id="comment:14" align="right">comment:14</div>

Thanks for the answer!

I did check that: the generated .cpp file has this line

```
#include "singular/polys/ext_fields/transext.h"
```

and the file `SAGE_LOCAL/local/include/singular/polys/ext_fields/transext.h`  has the following declarations:

```
struct fractionObject
{
  poly numerator;
  poly denominator;
  int complexity;
};

typedef struct fractionObject * fraction;
```

So I still have no idea about what could be going on.


One possible guess is that the generated file is a `.cpp`, that is, no pure C, but C++. Maybe some problem with scopes?



---

archive/issue_comments_215413.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nI think I finally got it. This branch seems to work.\n\nStill needs some polishing (documentation, cleanup, and check that we are handling memory correctly... which means lots of testing).\n\nSo please be welcome to take a look and stress-test it.",
    "created_at": "2021-10-06T15:34:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215413",
    "user": "https://github.com/miguelmarco"
}
```

<div id="comment:15" align="right">comment:15</div>

I think I finally got it. This branch seems to work.

Still needs some polishing (documentation, cleanup, and check that we are handling memory correctly... which means lots of testing).

So please be welcome to take a look and stress-test it.



---

archive/issue_events_236738.json:
```json
{
    "actor": "https://github.com/miguelmarco",
    "created_at": "2021-10-06T15:34:40Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16567#event-236738"
}
```



---

archive/issue_events_236739.json:
```json
{
    "actor": "https://github.com/miguelmarco",
    "created_at": "2021-10-06T15:34:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16567#event-236739"
}
```



---

archive/issue_events_236740.json:
```json
{
    "actor": "https://github.com/miguelmarco",
    "created_at": "2021-10-06T17:20:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16567#event-236740"
}
```



---

archive/issue_comments_215414.json:
```json
{
    "body": "Changed commit from **[6978419](https://github.com/sagemath/sagetrac-mirror/commit/69784190e03a32daeaa675709840ca30ebbf539d)** to **[136a89a](https://github.com/sagemath/sagetrac-mirror/commit/136a89a19aa1e476447ea5c88a66e6accb530f77)**",
    "created_at": "2021-10-06T17:20:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215414",
    "user": "https://github.com/miguelmarco"
}
```

Changed commit from **[6978419](https://github.com/sagemath/sagetrac-mirror/commit/69784190e03a32daeaa675709840ca30ebbf539d)** to **[136a89a](https://github.com/sagemath/sagetrac-mirror/commit/136a89a19aa1e476447ea5c88a66e6accb530f77)**



---

archive/issue_comments_215415.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -10,3 +10,20 @@\n <class 'sage.rings.polynomial.multi_polynomial_ring.MPolynomialRing_polydict_domain_with_category'>\n ```\n \n+\n+Update:\n+\n+This works now:\n+\n+```\n+sage: F = PolynomialRing(QQ,'a').fraction_field()\n+sage: R.<x,y> = F[]\n+sage: F.inject_variables()\n+Defining a\n+sage: I = R.ideal([a*x+5*y^2, (1+a)/(1-a)*x^3-3*y*x])\n+sage: I.groebner_basis()\n+[x^3 + (3*a - 3)/(a + 1)*x*y, y^2 + (a)/5*x]\n+```\n+\n+}}}\n+\n``````\n",
    "created_at": "2021-10-06T17:20:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215415",
    "user": "https://github.com/miguelmarco"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -10,3 +10,20 @@
 <class 'sage.rings.polynomial.multi_polynomial_ring.MPolynomialRing_polydict_domain_with_category'>
 ```
 
+
+Update:
+
+This works now:
+
+```
+sage: F = PolynomialRing(QQ,'a').fraction_field()
+sage: R.<x,y> = F[]
+sage: F.inject_variables()
+Defining a
+sage: I = R.ideal([a*x+5*y^2, (1+a)/(1-a)*x^3-3*y*x])
+sage: I.groebner_basis()
+[x^3 + (3*a - 3)/(a + 1)*x*y, y^2 + (a)/5*x]
+```
+
+}}}
+
``````




---

archive/issue_comments_215416.json:
```json
{
    "body": "<div id=\"comment:17\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3de10e6c271db7eefb41ce3447cae99c013c3a9d\">3de10e6</a></td><td><code>Hacky solution for sa2si (coefficients that fit in int size only)</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2d89757c619b17fe4d090fdd0bb1178fa996cab4\">2d89757</a></td><td><code>Use mpz to create coefficients</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/64f4f572985875fe5e4a5eeda4409a1f3fb8e6fd\">64f4f57</a></td><td><code>Working implementation. Still needs cleanup, documentation, and checking for memory leaks</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3d3419faf0f3115c7f89e4ce73a2231265ef26ff\">3d3419f</a></td><td><code>Fixed case with just one parameter</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/136a89a19aa1e476447ea5c88a66e6accb530f77\">136a89a</a></td><td><code>Fix problem with several parameters introduced by previous fix</code></td></tr></table>\n",
    "created_at": "2021-10-06T17:20:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215416",
    "user": "https://github.com/miguelmarco"
}
```

<div id="comment:17"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3de10e6c271db7eefb41ce3447cae99c013c3a9d">3de10e6</a></td><td><code>Hacky solution for sa2si (coefficients that fit in int size only)</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2d89757c619b17fe4d090fdd0bb1178fa996cab4">2d89757</a></td><td><code>Use mpz to create coefficients</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/64f4f572985875fe5e4a5eeda4409a1f3fb8e6fd">64f4f57</a></td><td><code>Working implementation. Still needs cleanup, documentation, and checking for memory leaks</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3d3419faf0f3115c7f89e4ce73a2231265ef26ff">3d3419f</a></td><td><code>Fixed case with just one parameter</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/136a89a19aa1e476447ea5c88a66e6accb530f77">136a89a</a></td><td><code>Fix problem with several parameters introduced by previous fix</code></td></tr></table>




---

archive/issue_comments_215417.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nI found a subtle bug:\n\n```\nsage: F = PolynomialRing(QQ,'t').fraction_field()\nsage: FA = FreeAlgebra(F, 6, 'x1,x2,x3,x4,x5,x6')\nsage: N = FA.g_algebra({FA.gen(j)*FA.gen(i):-FA.gen(i)*FA.gen(j) for i in range(5) for j in range(i+1,6)})\nsage: I = N.ideal([g^2 for g in N.gens()],side='twosided')\nsage: N.inject_variables()\nDefining x1, x2, x3, x4, x5, x6\nsage: I.reduce(x1*x2*x3 + x2^2*x4)\nx1*x2*x3 + x2^2*x4\n```\n\nNote that it doesn't cancel out the square of `x2`.  It is very subtle, since:\n\n```\nsage: I.reduce(x1*x2*x3)\nx1*x2*x3\nsage: I.reduce(x2^2*x4)\n0\n```\n\nthat is, the summands are correctly reduced. Moreover\n\n```\nsage: I.reduce(x3*x2*x6 + x2^2*x4)\n-x2*x3*x6\nsage: I.reduce(x1*x2*x4 + x2^2*x4)\nx1*x2*x4 + x2^2*x4\nsage: I.reduce(x1*x2*x5 + x2^2*x4)\nx1*x2*x5\nsage: I.reduce(x1*x2*x6 + x2^2*x4)\nx1*x2*x6\nsage: I.reduce(x3*x2*x6 + x2^2*x4)\n-x2*x3*x6\nsage: I.reduce(x3*x2*x5 + x2^2*x4)\n-x2*x3*x5\n```\n\nThe bug only appears with a very precise set of possibilities for the summands.\n\n\nIt feels that it would be very hard to investigate this bug, but it doesn't appear in the previously affected fields:\n\n```\nsage: FA = FreeAlgebra(QQ, 6, 'x1,x2,x3,x4,x5,x6')\nsage: N = FA.g_algebra({FA.gen(j)*FA.gen(i):-FA.gen(i)*FA.gen(j) for i in range(5) for j in range(i+1,6)})\nsage: I = N.ideal([g^2 for g in N.gens()],side='twosided')\nsage: N.inject_variables()\nDefining x1, x2, x3, x4, x5, x6\nsage: I.reduce(x1*x2*x3 + x2^2*x4)\nx1*x2*x3\n```\n\nSo this code doesn't really introduce a bug in previous functionalities.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6271a79f532ade95f46c70f0afe48cee1aeb4914\">6271a79</a></td><td><code>Hack in plural.pyx to construct elements from numbers (through the base field)</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2989430b29afb1e5499a6af3723967092ab4224b\">2989430</a></td><td><code>Make coercion to base ring in plural less agresive</code></td></tr></table>\n",
    "created_at": "2021-10-08T00:22:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215417",
    "user": "https://github.com/miguelmarco"
}
```

<div id="comment:18" align="right">comment:18</div>

I found a subtle bug:

```
sage: F = PolynomialRing(QQ,'t').fraction_field()
sage: FA = FreeAlgebra(F, 6, 'x1,x2,x3,x4,x5,x6')
sage: N = FA.g_algebra({FA.gen(j)*FA.gen(i):-FA.gen(i)*FA.gen(j) for i in range(5) for j in range(i+1,6)})
sage: I = N.ideal([g^2 for g in N.gens()],side='twosided')
sage: N.inject_variables()
Defining x1, x2, x3, x4, x5, x6
sage: I.reduce(x1*x2*x3 + x2^2*x4)
x1*x2*x3 + x2^2*x4
```

Note that it doesn't cancel out the square of `x2`.  It is very subtle, since:

```
sage: I.reduce(x1*x2*x3)
x1*x2*x3
sage: I.reduce(x2^2*x4)
0
```

that is, the summands are correctly reduced. Moreover

```
sage: I.reduce(x3*x2*x6 + x2^2*x4)
-x2*x3*x6
sage: I.reduce(x1*x2*x4 + x2^2*x4)
x1*x2*x4 + x2^2*x4
sage: I.reduce(x1*x2*x5 + x2^2*x4)
x1*x2*x5
sage: I.reduce(x1*x2*x6 + x2^2*x4)
x1*x2*x6
sage: I.reduce(x3*x2*x6 + x2^2*x4)
-x2*x3*x6
sage: I.reduce(x3*x2*x5 + x2^2*x4)
-x2*x3*x5
```

The bug only appears with a very precise set of possibilities for the summands.


It feels that it would be very hard to investigate this bug, but it doesn't appear in the previously affected fields:

```
sage: FA = FreeAlgebra(QQ, 6, 'x1,x2,x3,x4,x5,x6')
sage: N = FA.g_algebra({FA.gen(j)*FA.gen(i):-FA.gen(i)*FA.gen(j) for i in range(5) for j in range(i+1,6)})
sage: I = N.ideal([g^2 for g in N.gens()],side='twosided')
sage: N.inject_variables()
Defining x1, x2, x3, x4, x5, x6
sage: I.reduce(x1*x2*x3 + x2^2*x4)
x1*x2*x3
```

So this code doesn't really introduce a bug in previous functionalities.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6271a79f532ade95f46c70f0afe48cee1aeb4914">6271a79</a></td><td><code>Hack in plural.pyx to construct elements from numbers (through the base field)</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2989430b29afb1e5499a6af3723967092ab4224b">2989430</a></td><td><code>Make coercion to base ring in plural less agresive</code></td></tr></table>




---

archive/issue_comments_215418.json:
```json
{
    "body": "Changed commit from **[136a89a](https://github.com/sagemath/sagetrac-mirror/commit/136a89a19aa1e476447ea5c88a66e6accb530f77)** to **[2989430](https://github.com/sagemath/sagetrac-mirror/commit/2989430b29afb1e5499a6af3723967092ab4224b)**",
    "created_at": "2021-10-08T00:22:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215418",
    "user": "https://github.com/miguelmarco"
}
```

Changed commit from **[136a89a](https://github.com/sagemath/sagetrac-mirror/commit/136a89a19aa1e476447ea5c88a66e6accb530f77)** to **[2989430](https://github.com/sagemath/sagetrac-mirror/commit/2989430b29afb1e5499a6af3723967092ab4224b)**



---

archive/issue_comments_215419.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@miguelmarco](#comment:18):\n\nA hint might be that it doesn't happen whoth more that one parameter. So it might be related to how we treat that case (it is treated differently since by default univariate polynomial rings in sage are not wrapped around singular).",
    "created_at": "2021-10-08T01:00:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215419",
    "user": "https://github.com/miguelmarco"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@miguelmarco](#comment:18):

A hint might be that it doesn't happen whoth more that one parameter. So it might be related to how we treat that case (it is treated differently since by default univariate polynomial rings in sage are not wrapped around singular).



---

archive/issue_comments_215420.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@miguelmarco](#comment:19):\n> Replying to [@miguelmarco](#comment:18):\n> \n> A hint might be that it doesn't happen whoth more that one parameter. So it might be related to how we treat that case (it is treated differently since by default univariate polynomial rings in sage are not wrapped around singular).\n\nSorry, this is not correct. The bug appears with several parameters as well.",
    "created_at": "2021-10-08T01:24:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215420",
    "user": "https://github.com/miguelmarco"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@miguelmarco](#comment:19):
> Replying to [@miguelmarco](#comment:18):
> 
> A hint might be that it doesn't happen whoth more that one parameter. So it might be related to how we treat that case (it is treated differently since by default univariate polynomial rings in sage are not wrapped around singular).

Sorry, this is not correct. The bug appears with several parameters as well.



---

archive/issue_comments_215421.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nWe saw this \"not reducing x<sup>2</sup>\" thing in #27508 - a ticket that shows that we don't fully understand how linsingular works, and the only documentation on it is basically source code, or whatever you can extract from the upstream author...",
    "created_at": "2021-10-08T09:02:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215421",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:21" align="right">comment:21</div>

We saw this "not reducing x<sup>2</sup>" thing in #27508 - a ticket that shows that we don't fully understand how linsingular works, and the only documentation on it is basically source code, or whatever you can extract from the upstream author...



---

archive/issue_comments_215422.json:
```json
{
    "body": "Changed commit from **[2989430](https://github.com/sagemath/sagetrac-mirror/commit/2989430b29afb1e5499a6af3723967092ab4224b)** to **[50ac936](https://github.com/sagemath/sagetrac-mirror/commit/50ac936b1477128b2676f8ec7b058caf403a78ae)**",
    "created_at": "2021-10-08T09:49:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215422",
    "user": "https://github.com/miguelmarco"
}
```

Changed commit from **[2989430](https://github.com/sagemath/sagetrac-mirror/commit/2989430b29afb1e5499a6af3723967092ab4224b)** to **[50ac936](https://github.com/sagemath/sagetrac-mirror/commit/50ac936b1477128b2676f8ec7b058caf403a78ae)**



---

archive/issue_comments_215423.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nThanks that was actually very helpful!\n\nThe solution to #27508 (to force `noTailReduction = False`) was only applied to `GroebnerStrategy`. We just have to apply it to `NCGroebnerStrategy` as well\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/50ac936b1477128b2676f8ec7b058caf403a78ae\">50ac936</a></td><td><code>Force tail reduction in NCGroebnerStrategy</code></td></tr></table>\n",
    "created_at": "2021-10-08T09:49:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215423",
    "user": "https://github.com/miguelmarco"
}
```

<div id="comment:22" align="right">comment:22</div>

Thanks that was actually very helpful!

The solution to #27508 (to force `noTailReduction = False`) was only applied to `GroebnerStrategy`. We just have to apply it to `NCGroebnerStrategy` as well

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/50ac936b1477128b2676f8ec7b058caf403a78ae">50ac936</a></td><td><code>Force tail reduction in NCGroebnerStrategy</code></td></tr></table>




---

archive/issue_comments_215424.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nI am doing the final touches before it is ready, but running the whole test suite I got the following error:\n\n```\nsage -t --warn-long 67.8 --random-seed=0 src/sage/schemes/generic/morphism.py\n**********************************************************************\nFile \"src/sage/schemes/generic/morphism.py\", line 1605, in sage.schemes.generic.morphism.SchemeMorphism_polynomial.specialization\nFailed example:\n    f.specialization({alpha:5,beta:10})\nException raised:\n    Traceback (most recent call last):\n      File \"/home/mmarco/sage/local/lib/python3.9/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/mmarco/sage/local/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.schemes.generic.morphism.SchemeMorphism_polynomial.specialization[32]>\", line 1, in <module>\n        f.specialization({alpha:Integer(5),beta:Integer(10)})\n      File \"/home/mmarco/sage/local/lib/python3.9/site-packages/sage/dynamics/arithmetic_dynamics/generic_ds.py\", line 334, in specialization\n        F = self.as_scheme_morphism().specialization(D, phi, homset)\n      File \"/home/mmarco/sage/local/lib/python3.9/site-packages/sage/schemes/generic/morphism.py\", line 1618, in specialization\n        phi = FractionSpecializationMorphism(self[0].parent(), D)\n      File \"/home/mmarco/sage/local/lib/python3.9/site-packages/sage/rings/polynomial/flatten.py\", line 663, in __init__\n        self._specialization = SpecializationMorphism(domain.base(), D)\n      File \"/home/mmarco/sage/local/lib/python3.9/site-packages/sage/rings/polynomial/flatten.py\", line 540, in __init__\n        raise NameError(\"argument \" + str(var) + \" is not a generator anywhere in the polynomial tower\")\n    NameError: argument (alpha) is not a generator anywhere in the polynomial tower\n**********************************************************************\nFile \"src/sage/schemes/generic/morphism.py\", line 1609, in sage.schemes.generic.morphism.SchemeMorphism_polynomial.specialization\nFailed example:\n    f.specialization({alpha:5}).specialization({beta:10}) == f.specialization({alpha:5,beta:10})\nException raised:\n    Traceback (most recent call last):\n      File \"/home/mmarco/sage/local/lib/python3.9/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/mmarco/sage/local/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.schemes.generic.morphism.SchemeMorphism_polynomial.specialization[33]>\", line 1, in <module>\n        f.specialization({alpha:Integer(5)}).specialization({beta:Integer(10)}) == f.specialization({alpha:Integer(5),beta:Integer(10)})\n      File \"/home/mmarco/sage/local/lib/python3.9/site-packages/sage/dynamics/arithmetic_dynamics/generic_ds.py\", line 334, in specialization\n        F = self.as_scheme_morphism().specialization(D, phi, homset)\n      File \"/home/mmarco/sage/local/lib/python3.9/site-packages/sage/schemes/generic/morphism.py\", line 1618, in specialization\n        phi = FractionSpecializationMorphism(self[0].parent(), D)\n      File \"/home/mmarco/sage/local/lib/python3.9/site-packages/sage/rings/polynomial/flatten.py\", line 663, in __init__\n        self._specialization = SpecializationMorphism(domain.base(), D)\n      File \"/home/mmarco/sage/local/lib/python3.9/site-packages/sage/rings/polynomial/flatten.py\", line 540, in __init__\n        raise NameError(\"argument \" + str(var) + \" is not a generator anywhere in the polynomial tower\")\n    NameError: argument (alpha) is not a generator anywhere in the polynomial tower\n**********************************************************************\n1 item had failures:\n   2 of  35 in sage.schemes.generic.morphism.SchemeMorphism_polynomial.specialization\n    [476 tests, 2 failures, 1.00 s]\n```\n\n\nWhich actually comes from the behaviour of FlatteningMorphism in `src/sage/rings/polynomial/flatten.py`\n\nFor some reason, it did work with the previous (pexpect) singular interface, but breaks with this branch. I will try to sort it out, but I am not sure it does make any mathematical sense to have this kind of morphisms.\n\nI mean: If I understand correctly, the flattening morphism is suposed to be constructed from, say the ring QQ(a,b)[x,y] and  the dictionary {a:3}, and will return a \"morphism\" from QQ(a,b)[x,y] to QQ(b)[x,y], given by substituting a=3.\n\nBut that is not defined for all elements of QQ(a,b)[x,y]:\n\n```\nsage: from sage.rings.polynomial.flatten import SpecializationMorphism\nsage: F = PolynomialRing(QQ,'a,b').fraction_field()\nsage: F.inject_variables()\nDefining a, b\nR.<x,y> = F[]\nsage: phi = SpecializationMorphism(R, {a:3})\nsage: phi\nphi = SpecializationMorphism(R, {a:3})\n\nphi\n\nSpecialization morphism:\n  From: Multivariate Polynomial Ring in x, y over Fraction Field of Multivariate Polynomial Ring in a, b over Rational Field\n  To:   Multivariate Polynomial Ring in x, y over Fraction Field of Univariate Polynomial Ring in b over Rational Field\nsage: el = (1/(3-a))*x\nsage: el.parent()\nMultivariate Polynomial Ring in x, y over Fraction Field of Multivariate Polynomial Ring in a, b over Rational Field\nsage: phi(el)    #   booom!!\n---------------------------------------------------------------------------\nZeroDivisionError                         Traceback (most recent call last)\n...\nZeroDivisionError: fraction field element division by zero\n``` \n\n\nSo, do you think this is ok to have (even if it is not really a morphism), or should we just eliminate it?\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7ba8fc561b06207d2c2f377cd3cb1c7f1705583c\">7ba8fc5</a></td><td><code>Doctest the tail reduction fix</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/328dcc7b4333fa20ba30cddce8349bd21e6a8638\">328dcc7</a></td><td><code>Make sure we are in the correct libsingular ring when creating the object</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/57d9d7d60208d83ebb949e32c3c39e019d0a4f4d\">57d9d7d</a></td><td><code>Cleanup variables</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e57f349e21bd48b00caa7cd18d5cfd96545f833e\">e57f349</a></td><td><code>Make sure we free memory during coefficient creation</code></td></tr></table>\n",
    "created_at": "2021-10-09T21:38:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215424",
    "user": "https://github.com/miguelmarco"
}
```

<div id="comment:23" align="right">comment:23</div>

I am doing the final touches before it is ready, but running the whole test suite I got the following error:

```
sage -t --warn-long 67.8 --random-seed=0 src/sage/schemes/generic/morphism.py
**********************************************************************
File "src/sage/schemes/generic/morphism.py", line 1605, in sage.schemes.generic.morphism.SchemeMorphism_polynomial.specialization
Failed example:
    f.specialization({alpha:5,beta:10})
Exception raised:
    Traceback (most recent call last):
      File "/home/mmarco/sage/local/lib/python3.9/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/mmarco/sage/local/lib/python3.9/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.schemes.generic.morphism.SchemeMorphism_polynomial.specialization[32]>", line 1, in <module>
        f.specialization({alpha:Integer(5),beta:Integer(10)})
      File "/home/mmarco/sage/local/lib/python3.9/site-packages/sage/dynamics/arithmetic_dynamics/generic_ds.py", line 334, in specialization
        F = self.as_scheme_morphism().specialization(D, phi, homset)
      File "/home/mmarco/sage/local/lib/python3.9/site-packages/sage/schemes/generic/morphism.py", line 1618, in specialization
        phi = FractionSpecializationMorphism(self[0].parent(), D)
      File "/home/mmarco/sage/local/lib/python3.9/site-packages/sage/rings/polynomial/flatten.py", line 663, in __init__
        self._specialization = SpecializationMorphism(domain.base(), D)
      File "/home/mmarco/sage/local/lib/python3.9/site-packages/sage/rings/polynomial/flatten.py", line 540, in __init__
        raise NameError("argument " + str(var) + " is not a generator anywhere in the polynomial tower")
    NameError: argument (alpha) is not a generator anywhere in the polynomial tower
**********************************************************************
File "src/sage/schemes/generic/morphism.py", line 1609, in sage.schemes.generic.morphism.SchemeMorphism_polynomial.specialization
Failed example:
    f.specialization({alpha:5}).specialization({beta:10}) == f.specialization({alpha:5,beta:10})
Exception raised:
    Traceback (most recent call last):
      File "/home/mmarco/sage/local/lib/python3.9/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/mmarco/sage/local/lib/python3.9/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.schemes.generic.morphism.SchemeMorphism_polynomial.specialization[33]>", line 1, in <module>
        f.specialization({alpha:Integer(5)}).specialization({beta:Integer(10)}) == f.specialization({alpha:Integer(5),beta:Integer(10)})
      File "/home/mmarco/sage/local/lib/python3.9/site-packages/sage/dynamics/arithmetic_dynamics/generic_ds.py", line 334, in specialization
        F = self.as_scheme_morphism().specialization(D, phi, homset)
      File "/home/mmarco/sage/local/lib/python3.9/site-packages/sage/schemes/generic/morphism.py", line 1618, in specialization
        phi = FractionSpecializationMorphism(self[0].parent(), D)
      File "/home/mmarco/sage/local/lib/python3.9/site-packages/sage/rings/polynomial/flatten.py", line 663, in __init__
        self._specialization = SpecializationMorphism(domain.base(), D)
      File "/home/mmarco/sage/local/lib/python3.9/site-packages/sage/rings/polynomial/flatten.py", line 540, in __init__
        raise NameError("argument " + str(var) + " is not a generator anywhere in the polynomial tower")
    NameError: argument (alpha) is not a generator anywhere in the polynomial tower
**********************************************************************
1 item had failures:
   2 of  35 in sage.schemes.generic.morphism.SchemeMorphism_polynomial.specialization
    [476 tests, 2 failures, 1.00 s]
```


Which actually comes from the behaviour of FlatteningMorphism in `src/sage/rings/polynomial/flatten.py`

For some reason, it did work with the previous (pexpect) singular interface, but breaks with this branch. I will try to sort it out, but I am not sure it does make any mathematical sense to have this kind of morphisms.

I mean: If I understand correctly, the flattening morphism is suposed to be constructed from, say the ring QQ(a,b)[x,y] and  the dictionary {a:3}, and will return a "morphism" from QQ(a,b)[x,y] to QQ(b)[x,y], given by substituting a=3.

But that is not defined for all elements of QQ(a,b)[x,y]:

```
sage: from sage.rings.polynomial.flatten import SpecializationMorphism
sage: F = PolynomialRing(QQ,'a,b').fraction_field()
sage: F.inject_variables()
Defining a, b
R.<x,y> = F[]
sage: phi = SpecializationMorphism(R, {a:3})
sage: phi
phi = SpecializationMorphism(R, {a:3})

phi

Specialization morphism:
  From: Multivariate Polynomial Ring in x, y over Fraction Field of Multivariate Polynomial Ring in a, b over Rational Field
  To:   Multivariate Polynomial Ring in x, y over Fraction Field of Univariate Polynomial Ring in b over Rational Field
sage: el = (1/(3-a))*x
sage: el.parent()
Multivariate Polynomial Ring in x, y over Fraction Field of Multivariate Polynomial Ring in a, b over Rational Field
sage: phi(el)    #   booom!!
---------------------------------------------------------------------------
ZeroDivisionError                         Traceback (most recent call last)
...
ZeroDivisionError: fraction field element division by zero
``` 


So, do you think this is ok to have (even if it is not really a morphism), or should we just eliminate it?

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7ba8fc561b06207d2c2f377cd3cb1c7f1705583c">7ba8fc5</a></td><td><code>Doctest the tail reduction fix</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/328dcc7b4333fa20ba30cddce8349bd21e6a8638">328dcc7</a></td><td><code>Make sure we are in the correct libsingular ring when creating the object</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/57d9d7d60208d83ebb949e32c3c39e019d0a4f4d">57d9d7d</a></td><td><code>Cleanup variables</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e57f349e21bd48b00caa7cd18d5cfd96545f833e">e57f349</a></td><td><code>Make sure we free memory during coefficient creation</code></td></tr></table>




---

archive/issue_comments_215425.json:
```json
{
    "body": "Changed commit from **[50ac936](https://github.com/sagemath/sagetrac-mirror/commit/50ac936b1477128b2676f8ec7b058caf403a78ae)** to **[e57f349](https://github.com/sagemath/sagetrac-mirror/commit/e57f349e21bd48b00caa7cd18d5cfd96545f833e)**",
    "created_at": "2021-10-09T21:38:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215425",
    "user": "https://github.com/miguelmarco"
}
```

Changed commit from **[50ac936](https://github.com/sagemath/sagetrac-mirror/commit/50ac936b1477128b2676f8ec7b058caf403a78ae)** to **[e57f349](https://github.com/sagemath/sagetrac-mirror/commit/e57f349e21bd48b00caa7cd18d5cfd96545f833e)**



---

archive/issue_comments_215426.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nRegardles of what we do with the previous \"morphisms\", this last patch solves the underlying issues (related to the fact that the same variable was represented differently depending on weather it was considered in the  base field or in the polynomial ring).\n\nAll doctests pass in my machine, so I think it is ready for review.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d2e4ff7722ff5a33240ea51928156b4980d62149\">d2e4ff7</a></td><td><code>Make sure single variables are represented consistently, and fix doctests broken because of the change in representation</code></td></tr></table>\n",
    "created_at": "2021-10-10T09:33:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215426",
    "user": "https://github.com/miguelmarco"
}
```

<div id="comment:24" align="right">comment:24</div>

Regardles of what we do with the previous "morphisms", this last patch solves the underlying issues (related to the fact that the same variable was represented differently depending on weather it was considered in the  base field or in the polynomial ring).

All doctests pass in my machine, so I think it is ready for review.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d2e4ff7722ff5a33240ea51928156b4980d62149">d2e4ff7</a></td><td><code>Make sure single variables are represented consistently, and fix doctests broken because of the change in representation</code></td></tr></table>




---

archive/issue_comments_215427.json:
```json
{
    "body": "Changed commit from **[e57f349](https://github.com/sagemath/sagetrac-mirror/commit/e57f349e21bd48b00caa7cd18d5cfd96545f833e)** to **[d2e4ff7](https://github.com/sagemath/sagetrac-mirror/commit/d2e4ff7722ff5a33240ea51928156b4980d62149)**",
    "created_at": "2021-10-10T09:33:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215427",
    "user": "https://github.com/miguelmarco"
}
```

Changed commit from **[e57f349](https://github.com/sagemath/sagetrac-mirror/commit/e57f349e21bd48b00caa7cd18d5cfd96545f833e)** to **[d2e4ff7](https://github.com/sagemath/sagetrac-mirror/commit/d2e4ff7722ff5a33240ea51928156b4980d62149)**



---

archive/issue_comments_215428.json:
```json
{
    "body": "Changed commit from **[d2e4ff7](https://github.com/sagemath/sagetrac-mirror/commit/d2e4ff7722ff5a33240ea51928156b4980d62149)** to **[58f528c](https://github.com/sagemath/sagetrac-mirror/commit/58f528c55f996ccebf47dca3c8d7935476cb56d1)**",
    "created_at": "2021-10-11T00:46:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215428",
    "user": "https://github.com/bhutz"
}
```

Changed commit from **[d2e4ff7](https://github.com/sagemath/sagetrac-mirror/commit/d2e4ff7722ff5a33240ea51928156b4980d62149)** to **[58f528c](https://github.com/sagemath/sagetrac-mirror/commit/58f528c55f996ccebf47dca3c8d7935476cb56d1)**



---

archive/issue_comments_215429.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nWeighing on the goals of the Flattening-Specialization framework.\n\nThe idea is that given a family of objects under some parameterization. It is incredibly useful to have a way to specialize to a specific member of that family (by choosing a value of one of the parameters). This is obtained in the .specialization() functions available for various objects. It is not at all surprising the you can choose parameter values for which the specialized member is not defined. The error returned to the user should be understandable in this case.\n\nTo implement this well, a number of structures needed to be created. The Flatenning structures take a stacked polynomial ring tower such as K[a,b][c,d] and create the polynomial ring K[a,b,c,d]. A value can then be substituted in for one of the variables as a specialization and the tower rebuilt with Unflattening.\n\nSo Flattening doesn't go from QQ[a,b][x,y] to QQ(b)[x,y] as mentioned above. Rather it just goes from Q[a,b][x,y] to QQ[a,b,x,y]. (How function fields are dealt with in specialization is a little more complicated, but essentially flattening the poly ring and specializing the numerator/denominator, then rebuilding correctly).\n\nLooks like this issues mentioned were already resolved.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/58f528c55f996ccebf47dca3c8d7935476cb56d1\">58f528c</a></td><td><code>Clean unnecessary parenthesis in single variables.</code></td></tr></table>\n",
    "created_at": "2021-10-11T00:46:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215429",
    "user": "https://github.com/bhutz"
}
```

<div id="comment:25" align="right">comment:25</div>

Weighing on the goals of the Flattening-Specialization framework.

The idea is that given a family of objects under some parameterization. It is incredibly useful to have a way to specialize to a specific member of that family (by choosing a value of one of the parameters). This is obtained in the .specialization() functions available for various objects. It is not at all surprising the you can choose parameter values for which the specialized member is not defined. The error returned to the user should be understandable in this case.

To implement this well, a number of structures needed to be created. The Flatenning structures take a stacked polynomial ring tower such as K[a,b][c,d] and create the polynomial ring K[a,b,c,d]. A value can then be substituted in for one of the variables as a specialization and the tower rebuilt with Unflattening.

So Flattening doesn't go from QQ[a,b][x,y] to QQ(b)[x,y] as mentioned above. Rather it just goes from Q[a,b][x,y] to QQ[a,b,x,y]. (How function fields are dealt with in specialization is a little more complicated, but essentially flattening the poly ring and specializing the numerator/denominator, then rebuilding correctly).

Looks like this issues mentioned were already resolved.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/58f528c55f996ccebf47dca3c8d7935476cb56d1">58f528c</a></td><td><code>Clean unnecessary parenthesis in single variables.</code></td></tr></table>




---

archive/issue_comments_215430.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nYes, I found that the reason that the previous fail was that the flattening process depended on the string representation of variables, and libsingular represents parameters in polynomial rinms with parenthesis. Changing that representation fixed that problem.\n\nThere was another problem caused by the fact that univariate polynomials are usually a sifferent class than multivariate ones. To make use of libsingular over rings with one parameter, a \"multivariate\" polynomial ring with just one variable has to be created. Then some subtlety in the way morphisms work ended giving the fraction field element constructor a list as an input, instead of an element. Adding that option to the element constructor fixed that second problem.\n\nI see the usefulness of the specialization morphisms. My concerns is more a conceptual one, about them being no \"real\" morphisms in the mathematical sense when fraction fields are involved, since a morphism should be defined by all values of the domain. But it might be that the usefulness overwheights the mathematical inacuracy",
    "created_at": "2021-10-11T01:41:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215430",
    "user": "https://github.com/miguelmarco"
}
```

<div id="comment:26" align="right">comment:26</div>

Yes, I found that the reason that the previous fail was that the flattening process depended on the string representation of variables, and libsingular represents parameters in polynomial rinms with parenthesis. Changing that representation fixed that problem.

There was another problem caused by the fact that univariate polynomials are usually a sifferent class than multivariate ones. To make use of libsingular over rings with one parameter, a "multivariate" polynomial ring with just one variable has to be created. Then some subtlety in the way morphisms work ended giving the fraction field element constructor a list as an input, instead of an element. Adding that option to the element constructor fixed that second problem.

I see the usefulness of the specialization morphisms. My concerns is more a conceptual one, about them being no "real" morphisms in the mathematical sense when fraction fields are involved, since a morphism should be defined by all values of the domain. But it might be that the usefulness overwheights the mathematical inacuracy



---

archive/issue_comments_215431.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [@miguelmarco](#comment:26):\n> I see the usefulness of the specialization morphisms. My concerns is more a conceptual one, about them being no \"real\" morphisms in the mathematical sense when fraction fields are involved, since a morphism should be defined by all values of the domain. But it might be that the usefulness overwheights the mathematical inacuracy\n\nThe domain of definition for such specializations would be some relevant local ring. I think it will be easier to handle these using a partial homomorphism as is done now. Perhaps a doctest and a comment on that these maps may be partial.",
    "created_at": "2021-10-11T07:05:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215431",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [@miguelmarco](#comment:26):
> I see the usefulness of the specialization morphisms. My concerns is more a conceptual one, about them being no "real" morphisms in the mathematical sense when fraction fields are involved, since a morphism should be defined by all values of the domain. But it might be that the usefulness overwheights the mathematical inacuracy

The domain of definition for such specializations would be some relevant local ring. I think it will be easier to handle these using a partial homomorphism as is done now. Perhaps a doctest and a comment on that these maps may be partial.



---

archive/issue_comments_215432.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nOk then. Maybe that comment could be handled in a different ticket (maybe we could even try to implement localization rings)?. \n\nThis one already has plenty of code to review.",
    "created_at": "2021-10-11T12:17:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215432",
    "user": "https://github.com/miguelmarco"
}
```

<div id="comment:28" align="right">comment:28</div>

Ok then. Maybe that comment could be handled in a different ticket (maybe we could even try to implement localization rings)?. 

This one already has plenty of code to review.



---

archive/issue_comments_215433.json:
```json
{
    "body": "<div id=\"comment:29\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b45fc7e3f206cad0078ad259d5e951a1feb3fdfb\">b45fc7e</a></td><td><code>Clean intermediate coefficients too</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4a02d25877f187d78a0f748847daa580f27adda7\">4a02d25</a></td><td><code>Improve documentation</code></td></tr></table>\n",
    "created_at": "2021-10-14T11:52:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215433",
    "user": "https://github.com/miguelmarco"
}
```

<div id="comment:29"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b45fc7e3f206cad0078ad259d5e951a1feb3fdfb">b45fc7e</a></td><td><code>Clean intermediate coefficients too</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4a02d25877f187d78a0f748847daa580f27adda7">4a02d25</a></td><td><code>Improve documentation</code></td></tr></table>




---

archive/issue_comments_215434.json:
```json
{
    "body": "Changed commit from **[58f528c](https://github.com/sagemath/sagetrac-mirror/commit/58f528c55f996ccebf47dca3c8d7935476cb56d1)** to **[4a02d25](https://github.com/sagemath/sagetrac-mirror/commit/4a02d25877f187d78a0f748847daa580f27adda7)**",
    "created_at": "2021-10-14T11:52:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215434",
    "user": "https://github.com/miguelmarco"
}
```

Changed commit from **[58f528c](https://github.com/sagemath/sagetrac-mirror/commit/58f528c55f996ccebf47dca3c8d7935476cb56d1)** to **[4a02d25](https://github.com/sagemath/sagetrac-mirror/commit/4a02d25877f187d78a0f748847daa580f27adda7)**



---

archive/issue_comments_215435.json:
```json
{
    "body": "Changed commit from **[4a02d25](https://github.com/sagemath/sagetrac-mirror/commit/4a02d25877f187d78a0f748847daa580f27adda7)** to **[ecbcaf9](https://github.com/sagemath/sagetrac-mirror/commit/ecbcaf963d53e0e0e80822b98c20ec4e22007401)**",
    "created_at": "2021-10-19T09:48:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215435",
    "user": "https://github.com/miguelmarco"
}
```

Changed commit from **[4a02d25](https://github.com/sagemath/sagetrac-mirror/commit/4a02d25877f187d78a0f748847daa580f27adda7)** to **[ecbcaf9](https://github.com/sagemath/sagetrac-mirror/commit/ecbcaf963d53e0e0e80822b98c20ec4e22007401)**



---

archive/issue_comments_215436.json:
```json
{
    "body": "<div id=\"comment:30\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/13e30ad037326fd816669fc03519ac9ae2ab6a90\">13e30ad</a></td><td><code>Implemented transcendental extensions over prime fields</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cb3070fd966e4e3f5a6066876693574682625bac\">cb3070f</a></td><td><code>Add documentation for prime fields</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5555f49c32a1c39141e298bc438983140037681e\">5555f49</a></td><td><code>Fix doctests for prime fields</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ecbcaf963d53e0e0e80822b98c20ec4e22007401\">ecbcaf9</a></td><td><code>Use cfPower instead of repeated multiplications</code></td></tr></table>\n",
    "created_at": "2021-10-19T09:48:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215436",
    "user": "https://github.com/miguelmarco"
}
```

<div id="comment:30"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/13e30ad037326fd816669fc03519ac9ae2ab6a90">13e30ad</a></td><td><code>Implemented transcendental extensions over prime fields</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cb3070fd966e4e3f5a6066876693574682625bac">cb3070f</a></td><td><code>Add documentation for prime fields</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5555f49c32a1c39141e298bc438983140037681e">5555f49</a></td><td><code>Fix doctests for prime fields</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ecbcaf963d53e0e0e80822b98c20ec4e22007401">ecbcaf9</a></td><td><code>Use cfPower instead of repeated multiplications</code></td></tr></table>




---

archive/issue_comments_215437.json:
```json
{
    "body": "Changed branch from **[/u/mmarco/use_libsingular_for_polynomial_rings_over_function_fields](https://github.com/sagemath/sagetrac-mirror/tree//u/mmarco/use_libsingular_for_polynomial_rings_over_function_fields)** to **[u/mmarco/use_libsingular_for_polynomial_rings_over_function_fields](https://github.com/sagemath/sagetrac-mirror/tree/u/mmarco/use_libsingular_for_polynomial_rings_over_function_fields)**",
    "created_at": "2021-10-19T09:48:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215437",
    "user": "https://github.com/miguelmarco"
}
```

Changed branch from **[/u/mmarco/use_libsingular_for_polynomial_rings_over_function_fields](https://github.com/sagemath/sagetrac-mirror/tree//u/mmarco/use_libsingular_for_polynomial_rings_over_function_fields)** to **[u/mmarco/use_libsingular_for_polynomial_rings_over_function_fields](https://github.com/sagemath/sagetrac-mirror/tree/u/mmarco/use_libsingular_for_polynomial_rings_over_function_fields)**



---

archive/issue_comments_215438.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nI found that there was a branch problem with the branch name starting with a slash. I changed it and now git trac seems to work ok.\n\nSorry to those that had problems trying to check it out.",
    "created_at": "2021-10-19T09:52:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215438",
    "user": "https://github.com/miguelmarco"
}
```

<div id="comment:31" align="right">comment:31</div>

I found that there was a branch problem with the branch name starting with a slash. I changed it and now git trac seems to work ok.

Sorry to those that had problems trying to check it out.



---

archive/issue_comments_215439.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nSome minor things:\n\n- Not that it matters too much since they are `cdef` functions, but in `si2sa_QQ` and similar methods, the `INPUT:` and `OUTPUT:` blocks should not be indented, and it should be\n\n  ```\n    - ``_ ring`` -- a (pointer to) a singular ring, in whose coefficient field\n      lives ``n``\n  ```\n- It would be nice to get rid of some of the blanklines between blocks in the documentation. For example, in `sa2si_transext_FF`.\n- These parentheses are extraneous: `if (nMapFuncPtr is NULL):`.\n- Is it possible to combine these `if` statements?\n\n  ```diff\n  +    elif (isinstance(elem._parent, FractionField_generic)\n  +          and isinstance(elem._parent.base(), (MPolynomialRing_libsingular, PolynomialRing_field))\n  +        if isinstance(elem._parent.base().base_ring(), RationalField):\n               return sa2si_transext_QQ(elem, _ring)\n  +        elif isinstance(elem._parent.base().base_ring(), FiniteField_prime_modn):\n  +            return sa2si_transext_FF(elem, _ring)\n  -    elif isinstance(elem._parent, FractionField_generic) and isinstance(elem._parent.base(), (MPolynomialRing_libsingular, PolynomialRing_field)) and isinstance(elem._parent.base().base_ring(), RationalField):\n  -        return sa2si_transext_QQ(elem, _ring)\n  -\n  -    elif isinstance(elem._parent, FractionField_generic) and isinstance(elem._parent.base(), (MPolynomialRing_libsingular, PolynomialRing_field)) and isinstance(elem._parent.base().base_ring(), FiniteField_prime_modn):\n  -        return sa2si_transext_FF(elem, _ring)\n  ```\n  They are checking all but the last condition, and I don't think a failure of the last one. Then remove the `else:` (but keeping the `raise ValueError` of course). This makes it more clear about how the code should work.",
    "created_at": "2021-10-27T05:44:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215439",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:32" align="right">comment:32</div>

Some minor things:

- Not that it matters too much since they are `cdef` functions, but in `si2sa_QQ` and similar methods, the `INPUT:` and `OUTPUT:` blocks should not be indented, and it should be

  ```
    - ``_ ring`` -- a (pointer to) a singular ring, in whose coefficient field
      lives ``n``
  ```
- It would be nice to get rid of some of the blanklines between blocks in the documentation. For example, in `sa2si_transext_FF`.
- These parentheses are extraneous: `if (nMapFuncPtr is NULL):`.
- Is it possible to combine these `if` statements?

  ```diff
  +    elif (isinstance(elem._parent, FractionField_generic)
  +          and isinstance(elem._parent.base(), (MPolynomialRing_libsingular, PolynomialRing_field))
  +        if isinstance(elem._parent.base().base_ring(), RationalField):
               return sa2si_transext_QQ(elem, _ring)
  +        elif isinstance(elem._parent.base().base_ring(), FiniteField_prime_modn):
  +            return sa2si_transext_FF(elem, _ring)
  -    elif isinstance(elem._parent, FractionField_generic) and isinstance(elem._parent.base(), (MPolynomialRing_libsingular, PolynomialRing_field)) and isinstance(elem._parent.base().base_ring(), RationalField):
  -        return sa2si_transext_QQ(elem, _ring)
  -
  -    elif isinstance(elem._parent, FractionField_generic) and isinstance(elem._parent.base(), (MPolynomialRing_libsingular, PolynomialRing_field)) and isinstance(elem._parent.base().base_ring(), FiniteField_prime_modn):
  -        return sa2si_transext_FF(elem, _ring)
  ```
  They are checking all but the last condition, and I don't think a failure of the last one. Then remove the `else:` (but keeping the `raise ValueError` of course). This makes it more clear about how the code should work.



---

archive/issue_comments_215440.json:
```json
{
    "body": "Changed commit from **[ecbcaf9](https://github.com/sagemath/sagetrac-mirror/commit/ecbcaf963d53e0e0e80822b98c20ec4e22007401)** to **[9424a24](https://github.com/sagemath/sagetrac-mirror/commit/9424a24cb59f00c4fb0e19a2356dc208317a5b09)**",
    "created_at": "2021-10-27T17:53:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215440",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[ecbcaf9](https://github.com/sagemath/sagetrac-mirror/commit/ecbcaf963d53e0e0e80822b98c20ec4e22007401)** to **[9424a24](https://github.com/sagemath/sagetrac-mirror/commit/9424a24cb59f00c4fb0e19a2356dc208317a5b09)**



---

archive/issue_comments_215441.json:
```json
{
    "body": "<div id=\"comment:33\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9424a24cb59f00c4fb0e19a2356dc208317a5b09\">9424a24</a></td><td><code>Some minor reviewer's changes</code></td></tr></table>\n",
    "created_at": "2021-10-27T17:53:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215441",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:33"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9424a24cb59f00c4fb0e19a2356dc208317a5b09">9424a24</a></td><td><code>Some minor reviewer's changes</code></td></tr></table>




---

archive/issue_comments_215442.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nThanks for the review.",
    "created_at": "2021-10-27T17:54:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215442",
    "user": "https://github.com/miguelmarco"
}
```

<div id="comment:34" align="right">comment:34</div>

Thanks for the review.



---

archive/issue_comments_215443.json:
```json
{
    "body": "Author: **Miguel Marco**",
    "created_at": "2021-11-03T08:16:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215443",
    "user": "https://github.com/tscrim"
}
```

Author: **Miguel Marco**



---

archive/issue_comments_215444.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nSetting the author so the patchbot will run.",
    "created_at": "2021-11-03T08:16:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215444",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:35" align="right">comment:35</div>

Setting the author so the patchbot will run.



---

archive/issue_comments_215445.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2021-11-03T08:16:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215445",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_comments_215446.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nLinter complains about an unused variable in a method for matrix groups, which is rewriten to use this interface in #19391.\n\nAnyways, in the current implementation, that assignation is necesary to create the corresponding singular ring, even if the python variable is not used later. The linter is just not smart enough in this case.",
    "created_at": "2021-11-04T16:30:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215446",
    "user": "https://github.com/miguelmarco"
}
```

<div id="comment:36" align="right">comment:36</div>

Linter complains about an unused variable in a method for matrix groups, which is rewriten to use this interface in #19391.

Anyways, in the current implementation, that assignation is necesary to create the corresponding singular ring, even if the python variable is not used later. The linter is just not smart enough in this case.



---

archive/issue_comments_215447.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nThere are some failures reported by the patchbot:\n\n```\nsage -t --long --random-seed=65607106580737169923545380617831998347 src/sage/dynamics/arithmetic_dynamics/projective_ds.py  # 1 doctest failed\nsage -t --long --random-seed=65607106580737169923545380617831998347 src/sage/combinat/root_system/non_symmetric_macdonald_polynomials.py  # 1 doctest failed\nsage -t --long --random-seed=65607106580737169923545380617831998347 src/sage/interfaces/expect.py  # 2 doctests failed\n```",
    "created_at": "2021-11-06T01:45:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215447",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:37" align="right">comment:37</div>

There are some failures reported by the patchbot:

```
sage -t --long --random-seed=65607106580737169923545380617831998347 src/sage/dynamics/arithmetic_dynamics/projective_ds.py  # 1 doctest failed
sage -t --long --random-seed=65607106580737169923545380617831998347 src/sage/combinat/root_system/non_symmetric_macdonald_polynomials.py  # 1 doctest failed
sage -t --long --random-seed=65607106580737169923545380617831998347 src/sage/interfaces/expect.py  # 2 doctests failed
```



---

archive/issue_events_236741.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2021-11-06T01:45:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16567#event-236741"
}
```



---

archive/issue_events_236742.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2021-11-06T01:45:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16567#event-236742"
}
```



---

archive/issue_comments_215448.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nI can't reproduce the error in pexpect or projective_ds.py (I suspect somehow the file i am testing is different from the one in the patchbot).\n\nAbout the error in macdonald polynomials, I found that it is due to one function creating polynomials in x0, x1... and the other on x1, x2 ...    Will look into it.",
    "created_at": "2021-11-06T12:14:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215448",
    "user": "https://github.com/miguelmarco"
}
```

<div id="comment:38" align="right">comment:38</div>

I can't reproduce the error in pexpect or projective_ds.py (I suspect somehow the file i am testing is different from the one in the patchbot).

About the error in macdonald polynomials, I found that it is due to one function creating polynomials in x0, x1... and the other on x1, x2 ...    Will look into it.



---

archive/issue_comments_215449.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nBy rebasing to the newest develop version, I can reproduce the error in `src/sage/dynamics/arithmetic_dynamics/projective_ds.py`. It has to do with code added in #31994. \n\nI am trying to debug it, but it is quite complicated. Adding the people involved in that ticket to cc for help.",
    "created_at": "2021-11-06T21:52:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215449",
    "user": "https://github.com/miguelmarco"
}
```

<div id="comment:39" align="right">comment:39</div>

By rebasing to the newest develop version, I can reproduce the error in `src/sage/dynamics/arithmetic_dynamics/projective_ds.py`. It has to do with code added in #31994. 

I am trying to debug it, but it is quite complicated. Adding the people involved in that ticket to cc for help.



---

archive/issue_comments_215450.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nI've traced the error to the `affine_patch` function in src/sage/schemes/projective/projective_subscheme.py. The error is caused by code equivalent to the following\n\n```\nsage: T.<c,d> = QQ[]\nsage: F = FractionField(T)\nsage: R.<x,y,z> = F[]\nsage: Q = F['x', 'z']\nsage: f = R(d*z^2 + c*y*z^2)\nsage: f((Q.gens()[0], 1, Q.gens()[1]))\nTypeError\n```\nMy usual workaround here is to create a dictionary and attempt `f.subs()`, however,\n\n```\nf.subs({x: Q.gens()[0], y: 1, z:Q.gens()[1]})\n```\ncrashes Sage.",
    "created_at": "2021-11-07T03:04:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215450",
    "user": "https://github.com/EnderWannabe"
}
```

<div id="comment:40" align="right">comment:40</div>

I've traced the error to the `affine_patch` function in src/sage/schemes/projective/projective_subscheme.py. The error is caused by code equivalent to the following

```
sage: T.<c,d> = QQ[]
sage: F = FractionField(T)
sage: R.<x,y,z> = F[]
sage: Q = F['x', 'z']
sage: f = R(d*z^2 + c*y*z^2)
sage: f((Q.gens()[0], 1, Q.gens()[1]))
TypeError
```
My usual workaround here is to create a dictionary and attempt `f.subs()`, however,

```
f.subs({x: Q.gens()[0], y: 1, z:Q.gens()[1]})
```
crashes Sage.



---

archive/issue_comments_215451.json:
```json
{
    "body": "Changed commit from **[9424a24](https://github.com/sagemath/sagetrac-mirror/commit/9424a24cb59f00c4fb0e19a2356dc208317a5b09)** to **[d412c77](https://github.com/sagemath/sagetrac-mirror/commit/d412c7745d70cb9bb7b40e56eafd3ebb73d3692b)**",
    "created_at": "2021-11-07T17:43:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215451",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[9424a24](https://github.com/sagemath/sagetrac-mirror/commit/9424a24cb59f00c4fb0e19a2356dc208317a5b09)** to **[d412c77](https://github.com/sagemath/sagetrac-mirror/commit/d412c7745d70cb9bb7b40e56eafd3ebb73d3692b)**



---

archive/issue_comments_215452.json:
```json
{
    "body": "<div id=\"comment:41\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1a94d132ae74e3d8b3c56d9766b0dcebb79d7e24\">1a94d13</a></td><td><code>Merge branch 'develop' into plural</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2704119820efc54ae4069ebeefb0ab74f91b0e08\">2704119</a></td><td><code>Fix creating polynomial from strings in the case of field with several generators</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/84a04d125051e2c04e39ad7ed0d7db53cee9772d\">84a04d1</a></td><td><code>Fix variable indices in doctest</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d412c7745d70cb9bb7b40e56eafd3ebb73d3692b\">d412c77</a></td><td><code>Fix crash in .subs()</code></td></tr></table>\n",
    "created_at": "2021-11-07T17:43:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215452",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:41"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1a94d132ae74e3d8b3c56d9766b0dcebb79d7e24">1a94d13</a></td><td><code>Merge branch 'develop' into plural</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2704119820efc54ae4069ebeefb0ab74f91b0e08">2704119</a></td><td><code>Fix creating polynomial from strings in the case of field with several generators</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/84a04d125051e2c04e39ad7ed0d7db53cee9772d">84a04d1</a></td><td><code>Fix variable indices in doctest</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d412c7745d70cb9bb7b40e56eafd3ebb73d3692b">d412c77</a></td><td><code>Fix crash in .subs()</code></td></tr></table>




---

archive/issue_comments_215453.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nThanks for the hint. I could pinpoint the origin of both problems. This should solve it. \n\nI still can't reproduce the error in `expect.py`. Can somebody confirm it happens?",
    "created_at": "2021-11-07T17:45:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215453",
    "user": "https://github.com/miguelmarco"
}
```

<div id="comment:42" align="right">comment:42</div>

Thanks for the hint. I could pinpoint the origin of both problems. This should solve it. 

I still can't reproduce the error in `expect.py`. Can somebody confirm it happens?



---

archive/issue_events_236743.json:
```json
{
    "actor": "https://github.com/miguelmarco",
    "created_at": "2021-11-07T17:53:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16567#event-236743"
}
```



---

archive/issue_events_236744.json:
```json
{
    "actor": "https://github.com/miguelmarco",
    "created_at": "2021-11-07T17:53:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16567#event-236744"
}
```



---

archive/issue_comments_215454.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nOne of the patchbot passes all tests, and complains only abut the unused variable (that is actually needed to prevent gargage collection). The other patchbots have what seem to be unrelated problems.\n\nIs it ok to merge this in this state? or should I do some dummy operation with the variable to make pyflakes happy?",
    "created_at": "2021-11-12T12:21:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215454",
    "user": "https://github.com/miguelmarco"
}
```

<div id="comment:44" align="right">comment:44</div>

One of the patchbot passes all tests, and complains only abut the unused variable (that is actually needed to prevent gargage collection). The other patchbots have what seem to be unrelated problems.

Is it ok to merge this in this state? or should I do some dummy operation with the variable to make pyflakes happy?



---

archive/issue_comments_215455.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nThen it is a spurious error. I wouldn't worry about the pyflakes error. Thank you.",
    "created_at": "2021-11-12T13:11:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215455",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:45" align="right">comment:45</div>

Then it is a spurious error. I wouldn't worry about the pyflakes error. Thank you.



---

archive/issue_events_236745.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2021-11-12T13:11:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16567#event-236745"
}
```



---

archive/issue_events_236746.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2021-11-12T13:11:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16567#event-236746"
}
```



---

archive/issue_events_236747.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-11-13T17:56:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16567#event-236747"
}
```



---

archive/issue_events_236748.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-11-13T17:56:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16567#event-236748"
}
```



---

archive/issue_comments_215456.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nOn 32-bit:\n\n```\n**********************************************************************\nFile \"src/sage/rings/polynomial/polydict.pyx\", line 1628, in sage.rings.polynomial.polydict.ETuple.eadd\nFailed example:\n    y^(2^32)\nExpected:\n    Traceback (most recent call last):\n    ...\n    OverflowError: exponent overflow (...)\nGot:\n    <BLANKLINE>\n    Traceback (most recent call last):\n      File \"/var/lib/buildbot/slave/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/var/lib/buildbot/slave/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.rings.polynomial.polydict.ETuple.eadd[6]>\", line 1, in <module>\n        y**(Integer(2)**Integer(32))\n      File \"sage/rings/polynomial/multi_polynomial_libsingular.pyx\", line 2467, in sage.rings.polynomial.multi_polynomial_libsingular.MPolynomial_libsingular.__pow__ (build/cythonized/sage/rings/polynomial/multi_polynomial_libsingular.cpp:23166)\n        singular_polynomial_pow(&_p, self._poly, exp, _ring)\n    OverflowError: Python int too large to convert to C unsigned long\n**********************************************************************\n1 item had failures:\n   1 of   8 in sage.rings.polynomial.polydict.ETuple.eadd\n    [276 tests, 1 failure, 0.26 s]\n----------------------------------------------------------------------\nsage -t --long --random-seed=307417638528231788267817062701073757912 src/sage/rings/polynomial/polydict.pyx  # 1 doctest failed\n----------------------------------------------------------------------\n```",
    "created_at": "2021-11-13T17:56:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215456",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:46" align="right">comment:46</div>

On 32-bit:

```
**********************************************************************
File "src/sage/rings/polynomial/polydict.pyx", line 1628, in sage.rings.polynomial.polydict.ETuple.eadd
Failed example:
    y^(2^32)
Expected:
    Traceback (most recent call last):
    ...
    OverflowError: exponent overflow (...)
Got:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/var/lib/buildbot/slave/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/var/lib/buildbot/slave/sage_git/build/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.rings.polynomial.polydict.ETuple.eadd[6]>", line 1, in <module>
        y**(Integer(2)**Integer(32))
      File "sage/rings/polynomial/multi_polynomial_libsingular.pyx", line 2467, in sage.rings.polynomial.multi_polynomial_libsingular.MPolynomial_libsingular.__pow__ (build/cythonized/sage/rings/polynomial/multi_polynomial_libsingular.cpp:23166)
        singular_polynomial_pow(&_p, self._poly, exp, _ring)
    OverflowError: Python int too large to convert to C unsigned long
**********************************************************************
1 item had failures:
   1 of   8 in sage.rings.polynomial.polydict.ETuple.eadd
    [276 tests, 1 failure, 0.26 s]
----------------------------------------------------------------------
sage -t --long --random-seed=307417638528231788267817062701073757912 src/sage/rings/polynomial/polydict.pyx  # 1 doctest failed
----------------------------------------------------------------------
```



---

archive/issue_comments_215457.json:
```json
{
    "body": "<div id=\"comment:47\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6ce2bedfabdf3f5fbf0f6b776baa222005e8de7a\">6ce2bed</a></td><td><code>Adapt overflow doctest to 32 bits</code></td></tr></table>\n",
    "created_at": "2021-11-13T22:13:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215457",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:47"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6ce2bedfabdf3f5fbf0f6b776baa222005e8de7a">6ce2bed</a></td><td><code>Adapt overflow doctest to 32 bits</code></td></tr></table>




---

archive/issue_comments_215458.json:
```json
{
    "body": "Changed commit from **[d412c77](https://github.com/sagemath/sagetrac-mirror/commit/d412c7745d70cb9bb7b40e56eafd3ebb73d3692b)** to **[6ce2bed](https://github.com/sagemath/sagetrac-mirror/commit/6ce2bedfabdf3f5fbf0f6b776baa222005e8de7a)**",
    "created_at": "2021-11-13T22:13:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215458",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[d412c77](https://github.com/sagemath/sagetrac-mirror/commit/d412c7745d70cb9bb7b40e56eafd3ebb73d3692b)** to **[6ce2bed](https://github.com/sagemath/sagetrac-mirror/commit/6ce2bedfabdf3f5fbf0f6b776baa222005e8de7a)**



---

archive/issue_events_236749.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2021-11-14T00:47:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16567#event-236749"
}
```



---

archive/issue_events_236750.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2021-11-14T00:47:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16567#event-236750"
}
```



---

archive/issue_comments_215459.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nLGTM.",
    "created_at": "2021-11-14T00:47:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215459",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:48" align="right">comment:48</div>

LGTM.



---

archive/issue_events_236751.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-11-15T23:16:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16567#event-236751"
}
```



---

archive/issue_events_236752.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "aa66d526cf92a66b3d3c2a6808a2bb091c6f23d5",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-11-15T23:16:31Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/16567#event-236752"
}
```



---

archive/issue_comments_215460.json:
```json
{
    "body": "Changed branch from **[u/mmarco/use_libsingular_for_polynomial_rings_over_function_fields](https://github.com/sagemath/sagetrac-mirror/tree/u/mmarco/use_libsingular_for_polynomial_rings_over_function_fields)** to **[6ce2bed](https://github.com/sagemath/sagetrac-mirror/commit/6ce2bedfabdf3f5fbf0f6b776baa222005e8de7a)**",
    "created_at": "2021-11-15T23:16:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/16567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/16567#issuecomment-215460",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mmarco/use_libsingular_for_polynomial_rings_over_function_fields](https://github.com/sagemath/sagetrac-mirror/tree/u/mmarco/use_libsingular_for_polynomial_rings_over_function_fields)** to **[6ce2bed](https://github.com/sagemath/sagetrac-mirror/commit/6ce2bedfabdf3f5fbf0f6b776baa222005e8de7a)**
