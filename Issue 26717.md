# Issue 26717: The gcc package doesn't build with new gcc

archive/issues_026717.json:
```json
{
    "body": "CC:  @slel\n\nLooks like https://gcc.gnu.org/bugzilla/show_bug.cgi?id=85835\n\n```\n[gcc-7.2.0] libtool: compile:  /mnt/disk/home/buildslave-sage/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeq/local/var/tmp/sage/build/gcc-7.2.0/gcc-build/./gcc/xgcc -B/mnt/disk/home/buildslave-sage/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeq/local/var/tmp/sage/build/gcc-7.2.0/gcc-build/./gcc/ -B/mnt/disk/home/buildslave-sage/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeq/local/x86_64-pc-linux-gnu/bin/ -B/mnt/disk/home/buildslave-sage/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeq/local/x86_64-pc-linux-gnu/lib/ -isystem /mnt/disk/home/buildslave-sage/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeq/local/x86_64-pc-linux-gnu/include -isystem /mnt/disk/home/buildslave-sage/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeq/local/x86_64-pc-linux-gnu/sys-include -DHAVE_CONFIG_H -I../../../src/libatomic/config/x86 -I../../../src/libatomic/config/posix -I../../../src/libatomic -I. -Wall -Werror -pthread -g -O2 -MT cas_16_1_.lo -MD -MP -MF .deps/cas_16_1_.lo.Ppo -DN=16 -DIFUNC_ALT=1 -mcx16 -c ../../../src/libatomic/cas_n.c -o cas_16_1_.o >/dev/null 2>&1\n[gcc-7.2.0] ../../../../src/libsanitizer/sanitizer_common/sanitizer_platform_limits_posix.cc:157:10: fatal error: sys/ustat.h: No such file or directory\n[gcc-7.2.0]  #include <sys/ustat.h>\n[gcc-7.2.0]           ^~~~~~~~~~~~~\n[gcc-7.2.0] compilation terminated.\n[gcc-7.2.0] make[10]: *** [Makefile:523: sanitizer_platform_limits_posix.lo] Error 1\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/26954\n\n",
    "created_at": "2018-12-25T14:04:40Z",
    "labels": [
        "component: build",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.9",
    "title": "The gcc package doesn't build with new gcc",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26717",
    "user": "https://github.com/vbraun"
}
```
CC:  @slel

Looks like https://gcc.gnu.org/bugzilla/show_bug.cgi?id=85835

```
[gcc-7.2.0] libtool: compile:  /mnt/disk/home/buildslave-sage/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeq/local/var/tmp/sage/build/gcc-7.2.0/gcc-build/./gcc/xgcc -B/mnt/disk/home/buildslave-sage/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeq/local/var/tmp/sage/build/gcc-7.2.0/gcc-build/./gcc/ -B/mnt/disk/home/buildslave-sage/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeq/local/x86_64-pc-linux-gnu/bin/ -B/mnt/disk/home/buildslave-sage/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeq/local/x86_64-pc-linux-gnu/lib/ -isystem /mnt/disk/home/buildslave-sage/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeq/local/x86_64-pc-linux-gnu/include -isystem /mnt/disk/home/buildslave-sage/slave/binary_pkg/build/source/SageMath/jc4b6yulaujayb9sr94ia88eourzeq/local/x86_64-pc-linux-gnu/sys-include -DHAVE_CONFIG_H -I../../../src/libatomic/config/x86 -I../../../src/libatomic/config/posix -I../../../src/libatomic -I. -Wall -Werror -pthread -g -O2 -MT cas_16_1_.lo -MD -MP -MF .deps/cas_16_1_.lo.Ppo -DN=16 -DIFUNC_ALT=1 -mcx16 -c ../../../src/libatomic/cas_n.c -o cas_16_1_.o >/dev/null 2>&1
[gcc-7.2.0] ../../../../src/libsanitizer/sanitizer_common/sanitizer_platform_limits_posix.cc:157:10: fatal error: sys/ustat.h: No such file or directory
[gcc-7.2.0]  #include <sys/ustat.h>
[gcc-7.2.0]           ^~~~~~~~~~~~~
[gcc-7.2.0] compilation terminated.
[gcc-7.2.0] make[10]: *** [Makefile:523: sanitizer_platform_limits_posix.lo] Error 1
```


Issue created by migration from https://trac.sagemath.org/ticket/26954





---

archive/issue_comments_375357.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-12-30T22:39:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26717#issuecomment-375357",
    "user": "https://github.com/Konrad127123"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_375358.json:
```json
{
    "body": "The attached commits upgrade `gcc` to 7.4, which should fix this and make that the fix for #26735 redundant.\n\nI've also disabled building `gcc` with `isl`, since that is now an optional package in sage (see also discussion in #26735). If `isl` ever becomes a standard package, `gcc` should be made to depend on it, the `--disable-isl` line can be removed and the hacks for `gmp` and friends when building `gcc` should also be added for `isl`.\n\nI have not tested this set of changes yet.\n----\nNew commits:",
    "created_at": "2018-12-30T22:39:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26717#issuecomment-375358",
    "user": "https://github.com/Konrad127123"
}
```

The attached commits upgrade `gcc` to 7.4, which should fix this and make that the fix for #26735 redundant.

I've also disabled building `gcc` with `isl`, since that is now an optional package in sage (see also discussion in #26735). If `isl` ever becomes a standard package, `gcc` should be made to depend on it, the `--disable-isl` line can be removed and the hacks for `gmp` and friends when building `gcc` should also be added for `isl`.

I have not tested this set of changes yet.
----
New commits:



---

archive/issue_comments_375359.json:
```json
{
    "body": "Update: with the attached changes, `gcc` now builds again on my computer (and #26735 does not come back).\n\n\n(Later in the build process (but only if I build `gcc`), I get the following error when trying to build `givaro`:\n\n```\n-----------------------------------------------\nchecking gmp.h usability... yes\nchecking gmp.h presence... yes\nchecking for gmp.h... yes\nchecking for GMP library... yes\nchecking gmpxx.h usability... no\nchecking gmpxx.h presence... yes\nconfigure: WARNING: gmpxx.h: present but cannot be compiled\nconfigure: WARNING: gmpxx.h:     check for missing prerequisite headers?\nconfigure: WARNING: gmpxx.h: see the Autoconf documentation\nconfigure: WARNING: gmpxx.h:     section \"Present But Cannot Be Compiled\"\nconfigure: WARNING: gmpxx.h: proceeding with the compiler's result\nconfigure: WARNING:     ## --------------------------------------------------- ##\nconfigure: WARNING:     ## Report this to http://github.com/linbox-team/givaro ##\nconfigure: WARNING:     ## --------------------------------------------------- ##\nchecking for gmpxx.h... no\nyour GMP does not have c++ support. Compile GMP with --enable-cxx\n********************************************************************************\n```\n\nMy suspicion is that this failure is unrelated, and should be a separate issue.)",
    "created_at": "2019-01-01T23:21:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26717#issuecomment-375359",
    "user": "https://github.com/Konrad127123"
}
```

Update: with the attached changes, `gcc` now builds again on my computer (and #26735 does not come back).


(Later in the build process (but only if I build `gcc`), I get the following error when trying to build `givaro`:

```
-----------------------------------------------
checking gmp.h usability... yes
checking gmp.h presence... yes
checking for gmp.h... yes
checking for GMP library... yes
checking gmpxx.h usability... no
checking gmpxx.h presence... yes
configure: WARNING: gmpxx.h: present but cannot be compiled
configure: WARNING: gmpxx.h:     check for missing prerequisite headers?
configure: WARNING: gmpxx.h: see the Autoconf documentation
configure: WARNING: gmpxx.h:     section "Present But Cannot Be Compiled"
configure: WARNING: gmpxx.h: proceeding with the compiler's result
configure: WARNING:     ## --------------------------------------------------- ##
configure: WARNING:     ## Report this to http://github.com/linbox-team/givaro ##
configure: WARNING:     ## --------------------------------------------------- ##
checking for gmpxx.h... no
your GMP does not have c++ support. Compile GMP with --enable-cxx
********************************************************************************
```

My suspicion is that this failure is unrelated, and should be a separate issue.)



---

archive/issue_comments_375360.json:
```json
{
    "body": "Update: I tried bulding sage again with the attached patch. It worked, and all tests passed with `make testlong`. The `givaro` issue above was most likely a case of running out of diskspace.",
    "created_at": "2019-01-04T21:50:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26717#issuecomment-375360",
    "user": "https://github.com/Konrad127123"
}
```

Update: I tried bulding sage again with the attached patch. It worked, and all tests passed with `make testlong`. The `givaro` issue above was most likely a case of running out of diskspace.



---

archive/issue_events_066791.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-01-15T18:15:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26717",
    "milestone": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26717#event-66791"
}
```



---

archive/issue_comments_375361.json:
```json
{
    "body": "Retarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.",
    "created_at": "2019-01-15T18:15:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26717#issuecomment-375361",
    "user": "https://github.com/embray"
}
```

Retarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.



---

archive/issue_comments_375362.json:
```json
{
    "body": "> Retarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.\nThis patch is ready to go. It just needs someone to review it :).",
    "created_at": "2019-01-23T19:22:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26717#issuecomment-375362",
    "user": "https://github.com/Konrad127123"
}
```

> Retarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.
This patch is ready to go. It just needs someone to review it :).



---

archive/issue_comments_375363.json:
```json
{
    "body": "It looks like #27016 will likely conflict with this. Perhaps I could combine the two (especially if my ticket is reviewed)?",
    "created_at": "2019-01-23T22:30:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26717#issuecomment-375363",
    "user": "https://github.com/embray"
}
```

It looks like #27016 will likely conflict with this. Perhaps I could combine the two (especially if my ticket is reviewed)?



---

archive/issue_comments_375364.json:
```json
{
    "body": "Replying to [comment:7 embray]:\n> It looks like #27016 will likely conflict with this. Perhaps I could combine the two (especially if my ticket is reviewed)? \nI don't have enough knowledge of the build system to feel comfortable reviewing #27016. I have no objection to you combining the two: cherry-pick 6f07d2f and 62d8e3b, then add --without-isl to the configure options for both gcc and gfortran (I just noticed gfortran is built from the same source as gcc, so it should also get the --without-isl option for the same reason; my patch currently omits this.)",
    "created_at": "2019-01-23T23:51:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26717#issuecomment-375364",
    "user": "https://github.com/Konrad127123"
}
```

Replying to [comment:7 embray]:
> It looks like #27016 will likely conflict with this. Perhaps I could combine the two (especially if my ticket is reviewed)? 
I don't have enough knowledge of the build system to feel comfortable reviewing #27016. I have no objection to you combining the two: cherry-pick 6f07d2f and 62d8e3b, then add --without-isl to the configure options for both gcc and gfortran (I just noticed gfortran is built from the same source as gcc, so it should also get the --without-isl option for the same reason; my patch currently omits this.)



---

archive/issue_comments_375365.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-01-23T23:51:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26717#issuecomment-375365",
    "user": "https://github.com/Konrad127123"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_375366.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-01-28T13:59:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26717#issuecomment-375366",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_375367.json:
```json
{
    "body": "I've now also added --without-isl to the configure script for gfortran. I've not tested the gfortran part. I've not merged with #27016.",
    "created_at": "2019-01-28T14:02:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26717#issuecomment-375367",
    "user": "https://github.com/Konrad127123"
}
```

I've now also added --without-isl to the configure script for gfortran. I've not tested the gfortran part. I've not merged with #27016.



---

archive/issue_comments_375368.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-01-28T14:02:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26717#issuecomment-375368",
    "user": "https://github.com/Konrad127123"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_375369.json:
```json
{
    "body": "Changing keywords from \"\" to \"upgrade, gcc, gfortran, isl\".",
    "created_at": "2019-01-30T12:53:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26717#issuecomment-375369",
    "user": "https://github.com/slel"
}
```

Changing keywords from "" to "upgrade, gcc, gfortran, isl".



---

archive/issue_comments_375370.json:
```json
{
    "body": "Changing the ticket summary from \"The gcc package doesn't build with new gcc\"\nto \"Upgrade to gcc 7.4.0 and build gcc and gfortran without isl\".",
    "created_at": "2019-01-30T12:53:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26717#issuecomment-375370",
    "user": "https://github.com/slel"
}
```

Changing the ticket summary from "The gcc package doesn't build with new gcc"
to "Upgrade to gcc 7.4.0 and build gcc and gfortran without isl".



---

archive/issue_comments_375371.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-03-19T17:10:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26717#issuecomment-375371",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_375372.json:
```json
{
    "body": "Patch now rebased on top of #27016.",
    "created_at": "2019-03-19T17:19:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26717#issuecomment-375372",
    "user": "https://github.com/Konrad127123"
}
```

Patch now rebased on top of #27016.



---

archive/issue_comments_375373.json:
```json
{
    "body": "Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)",
    "created_at": "2019-03-25T10:56:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26717#issuecomment-375373",
    "user": "https://github.com/embray"
}
```

Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)



---

archive/issue_events_066792.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-25T10:56:15Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26717",
    "milestone": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26717#event-66792"
}
```



---

archive/issue_events_066793.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-25T10:56:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26717",
    "milestone": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26717#event-66793"
}
```



---

archive/issue_comments_375374.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-07-02T17:21:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26717#issuecomment-375374",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_066794.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-07-03T06:53:16Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26717",
    "milestone": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26717#event-66794"
}
```



---

archive/issue_events_066795.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-07-03T06:53:16Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26717",
    "milestone": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26717#event-66795"
}
```



---

archive/issue_events_066796.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-07-04T11:09:36Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26717",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26717#event-66796"
}
```



---

archive/issue_comments_375375.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-07-04T11:09:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26717",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26717#issuecomment-375375",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
