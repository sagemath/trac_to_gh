# Issue 15912: sage-env exports empty CXXFLAGS

Issue created by migration from https://trac.sagemath.org/ticket/16149

Original creator: leif

Original creation time: 2014-04-12 17:30:39

CC:  jpflori

Keywords: CFLAGS MPIR C++ ABI

That happens if `CFLAGS` are empty (or not exported at all, which presumably is the most frequent case) and `CXXFLAGS` aren't either:


```sh
if [ "$CXXFLAGS" = "" ]; then
    export CXXFLAGS="$CFLAGS"
fi
```


Unintentionally having exported but empty `CXXFLAGS` breaks *at least* MPIR, because it assumes the user had intentionally set them, so leaves them as they are (empty that is), not passing potentially import architecture and ABI flags to the C++ compiler (e.g. `-m...` flags to `g++`).

The solution is of course simple:  Don't (set and) export `CXXFLAGS` if `CFLAGS` aren't exported either.  Not sure if setting `CXXFLAGS` to `CFLAGS` in case the latter are non-empty (or empty but exported) is desirable at all.


---

Comment by leif created at 2014-04-12 17:45:20

I'd suggest to replace the above with at least

```sh
if [ "${CFLAGS+set}" = set ] && [ -z "$CXXFLAGS" ]; then
    export CXXFLAGS="$CFLAGS"
fi
```

which only sets (and exports) `CXXFLAGS` in case `CFLAGS` are set (but probably to `""`) and `CXXFLAGS` are empty.

Or only use `CFLAGS` if they're really non-empty by adding `&& [ -n "$CFLAGS" ]` or replacing `[ "${CFLAGS+set}" = set ]` by the former.


---

Comment by leif created at 2014-04-12 17:48:39

It would probably make sense to even `unset` both in case they're just empty.  (Same for `FCFLAGS` and `CPPFLAGS` etc.)


---

Comment by leif created at 2014-04-12 18:01:22

Changing status from new to needs_info.


---

Comment by leif created at 2014-04-12 18:01:22

Typo.


---

Comment by chapoton created at 2014-10-21 12:28:34

New commits:


---

Comment by chapoton created at 2014-10-21 12:28:34

Changing status from needs_info to needs_review.


---

Comment by git created at 2014-10-21 12:30:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2014-12-03 08:39:29

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-12-03 21:56:21

Resolution: fixed
