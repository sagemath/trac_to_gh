# Issue 19326: Upgrade arb and fix FLINT includes

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2015-11-10 00:44:41

CC:  fbissey




---

Comment by fbissey created at 2015-11-10 04:17:49

One doctest failure after straight upgrading `arb` (linux 64bit).

```
sage -t --long usr/lib/python2.7/site-packages/sage/rings/real_arb.pyx
**********************************************************************
File "usr/lib/python2.7/site-packages/sage/rings/real_arb.pyx", line 2620, in sage.rings.real_arb.RealBall.log_gamma
Failed example:
    RBF(1/2).log_gamma()
Expected:
    [0.572364942924700 +/- 4.87e-16]
Got:
    [0.572364942924700 +/- 2.67e-16]
**********************************************************************
1 item had failures:
   1 of   3 in sage.rings.real_arb.RealBall.log_gamma
    [494 tests, 1 failure, 0.30 s]
----------------------------------------------------------------------
sage -t --long usr/lib/python2.7/site-packages/sage/rings/real_arb.pyx  # 1 doctest failed
----------------------------------------------------------------------
Total time for all tests: 0.5 seconds
    cpu time: 0.3 seconds
    cumulative wall time: 0.3 seconds
```



---

Comment by fbissey created at 2015-11-11 00:48:12

Oh there is a tarball at `https://github.com/fredrik-johansson/arb/archive/2.7.0.tar.gz` but of course as a lot of those coming from github it has to be renamed.


---

Comment by jdemeyer created at 2015-11-11 00:54:57

Replying to [comment:4 fbissey]:
> Oh there is a tarball at `https://github.com/fredrik-johansson/arb/archive/2.7.0.tar.gz`
Right, this is what I meant with "packaged from git repo".


---

Comment by jdemeyer created at 2015-11-11 02:48:05

Last 10 new commits:


---

Comment by git created at 2015-11-11 06:04:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2015-11-11 06:11:35

Changing status from new to needs_review.


---

Comment by vbraun created at 2015-11-26 19:28:19

Changing status from needs_review to positive_review.


---

Comment by fbissey created at 2015-11-26 19:52:57

Changing status from positive_review to needs_work.


---

Comment by fbissey created at 2015-11-26 19:52:57

I am surprised making `arb` a standard package didn't cause any issue on OS X 10.11. The library lack an install_name which has been the sources of trouble just building there. A small fix just like in `cliquer`'s spkg-install would do the trick

```
if [ "$UNAME" = "Darwin" ]; then
    install_name_tool -id "${SAGE_LOCAL}"/lib/libarb.dylib "${SAGE_LOCAL}"/lib/libarb.dylib
fi
```



---

Comment by jdemeyer created at 2015-11-27 06:23:04

Replying to [comment:13 fbissey]:
> I am surprised making `arb` a standard package didn't cause any issue on OS X 10.11. The library lack an install_name which has been the sources of trouble just building there.

Is this problem related to the _upgrade_ of `arb`?


---

Comment by fbissey created at 2015-11-27 06:30:51

Replying to [comment:14 jdemeyer]:
> Replying to [comment:13 fbissey]:
> > I am surprised making `arb` a standard package didn't cause any issue on OS X 10.11. The library lack an install_name which has been the sources of trouble just building there.
> 
> Is this problem related to the _upgrade_ of `arb`?
Arguably it should have been dealt with in #18546 or earlier.


---

Comment by jdemeyer created at 2015-11-27 06:41:28

Changing status from needs_work to positive_review.


---

Comment by jdemeyer created at 2015-11-27 06:41:28

Replying to [comment:13 fbissey]:
> I am surprised making `arb` a standard package didn't cause any issue on OS X 10.11. The library lack an install_name which has been the sources of trouble just building there. A small fix just like in `cliquer`'s spkg-install would do the trick
> {{{
> if [ "$UNAME" = "Darwin" ]; then
>     install_name_tool -id "${SAGE_LOCAL}"/lib/libarb.dylib "${SAGE_LOCAL}"/lib/libarb.dylib
> fi
> }}}
This is now #19627.


---

Comment by vbraun created at 2015-11-27 22:55:07

The arb testsuite dies with 

```
$ SAGE_CHECK=yes ./sage -p arb
...
Successfully installed arb-2.7.0.p0
Running the test suite for arb-2.7.0.p0...
make[1]: warning: -jN forced in submake: disabling jobserver mode.
make[1]: Entering directory '/mnt/disk/home/release/Sage/local/var/tmp/sage/build/arb-2.7.0.p0/src'
make[1]: Nothing to be done for 'shared'.
make[1]: Leaving directory '/mnt/disk/home/release/Sage/local/var/tmp/sage/build/arb-2.7.0.p0/src'
make[1]: warning: -jN forced in submake: disabling jobserver mode.
make[1]: Entering directory '/mnt/disk/home/release/Sage/local/var/tmp/sage/build/arb-2.7.0.p0/src'
make[1]: Nothing to be done for 'static'.
make[1]: Leaving directory '/mnt/disk/home/release/Sage/local/var/tmp/sage/build/arb-2.7.0.p0/src'
make[1]: warning: -jN forced in submake: disabling jobserver mode.
make[1]: Entering directory '/mnt/disk/home/release/Sage/local/var/tmp/sage/build/arb-2.7.0.p0/src'
make[2]: Entering directory '/mnt/disk/home/release/Sage/local/var/tmp/sage/build/arb-2.7.0.p0/src'
make[2]: warning: -jN forced in submake: disabling jobserver mode.
make[2]: Nothing to be done for 'shared'.
make[2]: Leaving directory '/mnt/disk/home/release/Sage/local/var/tmp/sage/build/arb-2.7.0.p0/src'
make[2]: Entering directory '/mnt/disk/home/release/Sage/local/var/tmp/sage/build/arb-2.7.0.p0/src'
make[2]: warning: -jN forced in submake: disabling jobserver mode.
make[2]: Nothing to be done for 'static'.
make[2]: Leaving directory '/mnt/disk/home/release/Sage/local/var/tmp/sage/build/arb-2.7.0.p0/src'
make[1]: Leaving directory '/mnt/disk/home/release/Sage/local/var/tmp/sage/build/arb-2.7.0.p0/src'
make[1]: warning: -jN forced in submake: disabling jobserver mode.
make[1]: Entering directory '/mnt/disk/home/release/Sage/local/var/tmp/sage/build/arb-2.7.0.p0/src/fmpr'
    CC   ../build/fmpr/test/t-add
    CC   ../build/fmpr/test/t-set_fmpq
    CC   ../build/fmpr/test/t-root
    CC   ../build/fmpr/test/t-mul
    CC   ../build/fmpr/test/t-sub
    CC   ../build/fmpr/test/t-exp
    CC   ../build/fmpr/test/t-abs_bound_lt_2exp_si
    CC   ../build/fmpr/test/t-mul_si
    CC   ../build/fmpr/test/t-set_round_ui_2exp_fmpz
    CC   ../build/fmpr/test/t-get_d
test/t-mul_si.c:27:25: fatal error: long_extras.h: No such file or directory
compilation terminated.
../Makefile.subdirs:78: recipe for target '../build/fmpr/test/t-mul_si' failed
make[1]: *** [../build/fmpr/test/t-mul_si] Error 1
make[1]: *** Waiting for unfinished jobs....
make[1]: Leaving directory '/mnt/disk/home/release/Sage/local/var/tmp/sage/build/arb-2.7.0.p0/src/fmpr'
Makefile:169: recipe for target 'check' failed
make: *** [check] Error 2
```

Thoughts?


---

Comment by jdemeyer created at 2015-11-28 18:15:37

Changing status from positive_review to needs_work.


---

Comment by git created at 2015-11-28 19:42:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2015-11-28 19:44:01

Changing status from needs_work to positive_review.


---

Comment by jdemeyer created at 2015-11-28 19:44:01

I forgot to change some includes. With this patch, the testsuite passes. Since I'm just adding a few changes in the spirit of the old branch, I assume the positive review still stands.


---

Comment by vbraun created at 2015-11-29 12:12:05

Resolution: fixed
