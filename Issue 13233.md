# Issue 13233: Remove old docs when upgrading sagenb

Issue created by migration from https://trac.sagemath.org/ticket/13405

Original creator: jdemeyer

Original creation time: 2012-08-27 10:52:42

Assignee: GeorgSWeber

When upgrading the notebook from the pre-flask notebook, the reference manual gives WARNING because of old `.rst` files still present:

```
/release/buildbot/sage/sage-1/sage_upgrade_5.0.1/build/sage-5.4.beta0/devel/sage/doc/en/reference/sagenb/notebook/twist.rst:9: WARNING: autodoc can't import/find module 'sagenb.notebook.twist', it reported error: "No module named twist", please check your spelling and sys.path
/release/buildbot/sage/sage-1/sage_upgrade_5.0.1/build/sage-5.4.beta0/devel/sage/doc/en/reference/sagenb/simple/twist.rst:9: WARNING: autodoc can't import/find module 'sagenb.simple.twist', it reported error: "No module named web2", please check your spelling and sys.path
```


The solution is to delete the `doc/en/reference/sagenb` directory when installing the notebook.


---

Comment by kini created at 2012-08-29 09:34:35

Here's an SPKG: http://wstein.org/home/keshav/files/sagenb-0.9.2.spkg

These changes will be in the next SPKG for #13121 as well. Thanks!


---

Comment by kini created at 2012-08-29 09:44:37

Er, the SPKG is still uploading, sorry. Wait another five minutes or so I guess.


---

Comment by jdemeyer created at 2012-08-29 10:13:18

Changing status from new to needs_review.


---

Attachment


---

Comment by jdemeyer created at 2012-08-31 13:06:34

Are you sure this is based on the "correct" version of sagenb-0.9.1?  Because I see again a bug on OpenSolaris which was supposed to be fixed:

```
Processing Twisted-12.1.0.tar.bz2
Running Twisted-12.1.0/setup.py -q bdist_egg --dist-dir /tmp/easy_install-V73zhs/Twisted-12.1.0/egg-dist-tmp-SnBkIT
conftest.c:1:23: error: sys/epoll.h: No such file or directory
twisted/python/sendmsg.c: In function ‘sendmsg_sendmsg’:
twisted/python/sendmsg.c:198: error: ‘struct msghdr’ has no member named ‘msg_control’
twisted/python/sendmsg.c:199: error: ‘struct msghdr’ has no member named ‘msg_controllen’
twisted/python/sendmsg.c:201: error: ‘struct msghdr’ has no member named ‘msg_flags’
twisted/python/sendmsg.c:243: warning: implicit declaration of function ‘CMSG_SPACE’
twisted/python/sendmsg.c:268: error: ‘struct msghdr’ has no member named ‘msg_control’
twisted/python/sendmsg.c:269: error: ‘struct msghdr’ has no member named ‘msg_control’
twisted/python/sendmsg.c:274: error: ‘struct msghdr’ has no member named ‘msg_control’
twisted/python/sendmsg.c:276: error: ‘struct msghdr’ has no member named ‘msg_controllen’
twisted/python/sendmsg.c:285: warning: implicit declaration of function ‘CMSG_FIRSTHDR’
twisted/python/sendmsg.c:285: warning: initialization makes pointer from integer without a cast
twisted/python/sendmsg.c:306: warning: implicit declaration of function ‘CMSG_LEN’
twisted/python/sendmsg.c:316: warning: implicit declaration of function ‘CMSG_DATA’
twisted/python/sendmsg.c:316: warning: assignment makes pointer from integer without a cast
twisted/python/sendmsg.c:322: warning: implicit declaration of function ‘CMSG_NXTHDR’
twisted/python/sendmsg.c:322: warning: assignment makes pointer from integer without a cast
twisted/python/sendmsg.c:351: error: ‘struct msghdr’ has no member named ‘msg_control’
twisted/python/sendmsg.c:352: error: ‘struct msghdr’ has no member named ‘msg_control’
twisted/python/sendmsg.c:353: error: ‘struct msghdr’ has no member named ‘msg_control’
twisted/python/sendmsg.c: In function ‘sendmsg_recvmsg’:
twisted/python/sendmsg.c:414: error: ‘struct msghdr’ has no member named ‘msg_control’
twisted/python/sendmsg.c:416: error: ‘struct msghdr’ has no member named ‘msg_controllen’
twisted/python/sendmsg.c:429: warning: assignment makes pointer from integer without a cast
twisted/python/sendmsg.c:432: warning: assignment makes pointer from integer without a cast
twisted/python/sendmsg.c:477: error: ‘struct msghdr’ has no member named ‘msg_flags’
error: Setup script exited with error: command 'gcc' failed with exit status 1
Error installing Twisted-12.1.0.tar.bz2.
```



---

Comment by jdemeyer created at 2012-08-31 13:06:34

Changing status from needs_review to needs_work.


---

Comment by kini created at 2012-08-31 16:57:59

Sorry, you're right. That bug fix was not committed properly originally so it got overwritten. Actually I don't think it really should be committed - I'll fix it the same way it was fixed on #11080. Hang on a bit...


---

Comment by kini created at 2012-08-31 17:01:32

On second thought, if this same error pops up on #13121, I guess the fix is worth committing after all. We'll see. New SPKG should be up at the same URL as before in about 15 minutes (upload is really slow here in Singapore recently...).


---

Comment by jdemeyer created at 2012-08-31 19:09:07

Replying to [comment:6 kini]:
> On second thought, if this same error pops up on #13121
Is there any reason why it should _not_ appear again?  Why would it be magically fixed?


---

Comment by jdemeyer created at 2012-08-31 19:21:59

Changing status from needs_work to needs_review.


---

Comment by kini created at 2012-08-31 20:45:45

Sorry, I got a bit confused. There's no reason to commit it into the sagenb repo because with the new packaging the spkg-install file is no longer generated. It's tracked in the SPKG's repository, though, so I'll commit it there for #13121.


---

Comment by jdemeyer created at 2012-09-01 14:29:11

The packaging is good now, it installs on (Open)Solaris.  Thanks for the trouble.


---

Comment by jhpalmieri created at 2012-09-02 16:14:10

Changing status from needs_review to positive_review.


---

Comment by jhpalmieri created at 2012-09-02 16:14:10

The new version works for me, as long as I also update the Sage library (as recently as Sage 5.0, the file `sage/doc/en/reference/notebook.rst` still referred to `sagenb.notebook.twist`, etc.). Either failing to update the Sage library or using sagenb-0.9.1, I get the warnings about the missing imports.


---

Comment by jdemeyer created at 2012-09-02 21:29:14

Resolution: fixed
