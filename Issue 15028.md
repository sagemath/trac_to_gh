# Issue 15028: Additional functionality for Farey symbols

archive/issues_015028.json:
```json
{
    "body": "Assignee: @monien\n\nCC:  @vbraun @loefflerd\n\nKeywords: Farey symbol, arithmetic subgroups\n\nThe additional functionality included in this patch are:\n\n- various possibilities for the tessellation of the fundamental domain (Dedekind, coset, none)\n- membership test via the Lang, Lim, Tan algorithm\n- improved LaTeX output (via xymatrix)\n- reduction to cusp\n- identify cusp class\n\nThere are a number of special cases where the straightforward implementation of the LLT algorithm fails. \nMore testing is required.\n\nIssue created by migration from https://trac.sagemath.org/ticket/15265\n\n",
    "created_at": "2013-10-09T09:31:44Z",
    "labels": [
        "component: modular forms"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.1",
    "title": "Additional functionality for Farey symbols",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15028",
    "user": "https://github.com/monien"
}
```
Assignee: @monien

CC:  @vbraun @loefflerd

Keywords: Farey symbol, arithmetic subgroups

The additional functionality included in this patch are:

- various possibilities for the tessellation of the fundamental domain (Dedekind, coset, none)
- membership test via the Lang, Lim, Tan algorithm
- improved LaTeX output (via xymatrix)
- reduction to cusp
- identify cusp class

There are a number of special cases where the straightforward implementation of the LLT algorithm fails. 
More testing is required.

Issue created by migration from https://trac.sagemath.org/ticket/15265





---

archive/issue_comments_191846.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-10-17T21:04:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15028#issuecomment-191846",
    "user": "https://github.com/monien"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_191847.json:
```json
{
    "body": "Pedantic comments: you need a proper commit message on the patch, or the release manager will complain; and there is a failing doctest in the  ` _latex_ ` method in `congroup_gamma.py` (typo?). I'm running a more thorough doctest cycle now.",
    "created_at": "2013-10-19T17:01:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15028#issuecomment-191847",
    "user": "https://github.com/loefflerd"
}
```

Pedantic comments: you need a proper commit message on the patch, or the release manager will complain; and there is a failing doctest in the  ` _latex_ ` method in `congroup_gamma.py` (typo?). I'm running a more thorough doctest cycle now.



---

archive/issue_comments_191848.json:
```json
{
    "body": "OK, here's something a bit more important. The LaTeX display for Farey symbols doesn't work in the notebook: instead of rendering the Farey symbol it prints a little box with the raw LaTeX code in it. The problem is that the notebook uses MathJax for its latex rendering, and xypic is not supported by MathJax. I did warn you about this some while back.\n\nOther than that the new code looks fine.",
    "created_at": "2013-10-19T18:02:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15028#issuecomment-191848",
    "user": "https://github.com/loefflerd"
}
```

OK, here's something a bit more important. The LaTeX display for Farey symbols doesn't work in the notebook: instead of rendering the Farey symbol it prints a little box with the raw LaTeX code in it. The problem is that the notebook uses MathJax for its latex rendering, and xypic is not supported by MathJax. I did warn you about this some while back.

Other than that the new code looks fine.



---

archive/issue_comments_191849.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-10-19T18:02:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15028#issuecomment-191849",
    "user": "https://github.com/loefflerd"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_191850.json:
```json
{
    "body": "I do understand that the notebook (mathjax) currently does not support xymatrix. There are some attempts to make xymatrix also work for mathjax which would cure this problem. For the time being the situation is not very different from the one for using tikz with graphs. So the usual story: \n\n```\nlatex.add_to_preamble('\\usepackage[all]{xy}')\nlatex.mathjax_avoid_list('xymatrix'). \n```\n\nThen \n\n```\nview(FareySymbol(Gamma0(23)), engine='pdflatex', tightpage=True)\n```\n\ndoes produce a latex view of the Farey symbol. I would hope that xymatrix would be included in in mathjax sooner than later. Please have a look at http://sonoisa.github.io/xyjax/xyjax.html. One could of course check wether the latex is produced in a notebook or \nnot but that might lead to inconsistencies for the user.\n\nI'll fix the (minor) problems  tomorrow. Thanks for the prompt review.",
    "created_at": "2013-10-19T19:38:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15028#issuecomment-191850",
    "user": "https://github.com/monien"
}
```

I do understand that the notebook (mathjax) currently does not support xymatrix. There are some attempts to make xymatrix also work for mathjax which would cure this problem. For the time being the situation is not very different from the one for using tikz with graphs. So the usual story: 

```
latex.add_to_preamble('\usepackage[all]{xy}')
latex.mathjax_avoid_list('xymatrix'). 
```

Then 

```
view(FareySymbol(Gamma0(23)), engine='pdflatex', tightpage=True)
```

does produce a latex view of the Farey symbol. I would hope that xymatrix would be included in in mathjax sooner than later. Please have a look at http://sonoisa.github.io/xyjax/xyjax.html. One could of course check wether the latex is produced in a notebook or 
not but that might lead to inconsistencies for the user.

I'll fix the (minor) problems  tomorrow. Thanks for the prompt review.



---

archive/issue_comments_191851.json:
```json
{
    "body": "* Fixed typo in `_latex_` in `congroup.py`.\n* Added proper commit message",
    "created_at": "2013-10-19T22:49:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15028#issuecomment-191851",
    "user": "https://github.com/monien"
}
```

* Fixed typo in `_latex_` in `congroup.py`.
* Added proper commit message



---

archive/issue_comments_191852.json:
```json
{
    "body": "I'm not sure that the comparison with using tikz for graphs is a fair one. There's clearly no hope of getting standard LaTeX to render graphs, so it's reasonable to require an extra package. On the other hand, one can produce a viable approximation to a Farey symbol without using any extra packages, as in my recent ticket #14971; this may not look quite so nice as your version, but it avoids these compatibility issues.\n\nCan you add a doctest illustrating your changes to arithgroup_element.acton?",
    "created_at": "2013-10-20T13:15:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15028#issuecomment-191852",
    "user": "https://github.com/loefflerd"
}
```

I'm not sure that the comparison with using tikz for graphs is a fair one. There's clearly no hope of getting standard LaTeX to render graphs, so it's reasonable to require an extra package. On the other hand, one can produce a viable approximation to a Farey symbol without using any extra packages, as in my recent ticket #14971; this may not look quite so nice as your version, but it avoids these compatibility issues.

Can you add a doctest illustrating your changes to arithgroup_element.acton?



---

archive/issue_comments_191853.json:
```json
{
    "body": "I have added two doctests to arithgroup_element.acton. I do understand your concern about the latex. The question here is:\nIs the graph for the Farey symbol just some equation or a graph. I would opt for the latter. \n\nI have modified the `_latex_` of the Farey symbol  so that it does work with sagemath cloud. \nTo illustrate that it is fairly easy to use the current version of the latex output (one thing which \nhas been bugging me for a long time is the extra brackets in the latex output in a sage worksheet) I included two examples\nhow to use it.\n\nThe only other alternative I see is to add yet another property to the Farey symbol like graph() or the like to keep the nice\nlatex format.",
    "created_at": "2013-10-21T12:02:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15028#issuecomment-191853",
    "user": "https://github.com/monien"
}
```

I have added two doctests to arithgroup_element.acton. I do understand your concern about the latex. The question here is:
Is the graph for the Farey symbol just some equation or a graph. I would opt for the latter. 

I have modified the `_latex_` of the Farey symbol  so that it does work with sagemath cloud. 
To illustrate that it is fairly easy to use the current version of the latex output (one thing which 
has been bugging me for a long time is the extra brackets in the latex output in a sage worksheet) I included two examples
how to use it.

The only other alternative I see is to add yet another property to the Farey symbol like graph() or the like to keep the nice
latex format.



---

archive/issue_comments_191854.json:
```json
{
    "body": "latex as would produced by my new latex version",
    "created_at": "2013-10-21T12:04:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15028#issuecomment-191854",
    "user": "https://github.com/monien"
}
```

latex as would produced by my new latex version



---

archive/issue_comments_191855.json:
```json
{
    "body": "Attachment [test latex for Farey symbols.tiff](tarball://root/attachments/some-uuid/ticket15265/test latex for Farey symbols.tiff) by @monien created at 2013-10-21 12:04:29\n\nuse in sage worksheet",
    "created_at": "2013-10-21T12:04:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15028#issuecomment-191855",
    "user": "https://github.com/monien"
}
```

Attachment [test latex for Farey symbols.tiff](tarball://root/attachments/some-uuid/ticket15265/test latex for Farey symbols.tiff) by @monien created at 2013-10-21 12:04:29

use in sage worksheet



---

archive/issue_comments_191856.json:
```json
{
    "body": "Attachment [farey.patch](tarball://root/attachments/some-uuid/ticket15265/farey.patch) by @monien created at 2013-10-21 14:10:42\n\nFarey symbol enhancement",
    "created_at": "2013-10-21T14:10:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15028#issuecomment-191856",
    "user": "https://github.com/monien"
}
```

Attachment [farey.patch](tarball://root/attachments/some-uuid/ticket15265/farey.patch) by @monien created at 2013-10-21 14:10:42

Farey symbol enhancement



---

archive/issue_comments_191857.json:
```json
{
    "body": "Just so that I understand correctly, there are two potential LaTeX outputs, one with (here) and one without xy (at #14971)? How about you do\n\n```\n   if 'xymatrix' in latex.mathjax_avoid_list():\n       output_with_xy()\n   else:\n       output_without_xy()\n```\n\nSince xy is in the default latex preamble we should probably add it to the avoid list by default, but that would be for another ticket...",
    "created_at": "2013-11-22T15:50:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15028#issuecomment-191857",
    "user": "https://github.com/vbraun"
}
```

Just so that I understand correctly, there are two potential LaTeX outputs, one with (here) and one without xy (at #14971)? How about you do

```
   if 'xymatrix' in latex.mathjax_avoid_list():
       output_with_xy()
   else:
       output_without_xy()
```

Since xy is in the default latex preamble we should probably add it to the avoid list by default, but that would be for another ticket...



---

archive/issue_comments_191858.json:
```json
{
    "body": "Added modified version of David's latex for FareySymbol.",
    "created_at": "2014-01-10T11:46:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15028#issuecomment-191858",
    "user": "https://github.com/monien"
}
```

Added modified version of David's latex for FareySymbol.



---

archive/issue_comments_191859.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-10T11:49:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15028#issuecomment-191859",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_191860.json:
```json
{
    "body": "We did some parallel work. Hope it's ok for you to base the review on my branch (to which I already made some small changes).\n----\nNew commits:",
    "created_at": "2014-01-10T12:01:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15028#issuecomment-191860",
    "user": "https://trac.sagemath.org/admin/accounts/users/mraum"
}
```

We did some parallel work. Hope it's ok for you to base the review on my branch (to which I already made some small changes).
----
New commits:



---

archive/issue_comments_191861.json:
```json
{
    "body": "Another try to change the attached commit.\n----\nNew commits:",
    "created_at": "2014-01-10T12:05:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15028#issuecomment-191861",
    "user": "https://trac.sagemath.org/admin/accounts/users/mraum"
}
```

Another try to change the attached commit.
----
New commits:



---

archive/issue_comments_191862.json:
```json
{
    "body": "Sorry for that, I'm not yet used to the new Trac system. I'm now changing the branch.",
    "created_at": "2014-01-10T12:07:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15028#issuecomment-191862",
    "user": "https://trac.sagemath.org/admin/accounts/users/mraum"
}
```

Sorry for that, I'm not yet used to the new Trac system. I'm now changing the branch.



---

archive/issue_comments_191863.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-14T21:24:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15028#issuecomment-191863",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_191864.json:
```json
{
    "body": "Hartmut, could you review the few changes that I made to your code? I have the following questions/comments, which you could help me with:\n\nreference for rademacher_matrix in farey.cpp?\nfarey.cpp:FareySymbol(istream& is) why not \"is >> *this\" ?\nfarey.cpp:370 : it seems that x will always have length 1.\nfarey.cpp:129 I understand this is tempting, but PRETTY_FUNCTION is gcc only.\nfarey_symbol.pyx:plot rgbcolor option does not apply to Dedekind tesselation.  Add one example each\n\nI still need to test the code, but hopefully I'll have time for this tomorrow.",
    "created_at": "2014-01-14T21:28:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15028#issuecomment-191864",
    "user": "https://trac.sagemath.org/admin/accounts/users/mraum"
}
```

Hartmut, could you review the few changes that I made to your code? I have the following questions/comments, which you could help me with:

reference for rademacher_matrix in farey.cpp?
farey.cpp:FareySymbol(istream& is) why not "is >> *this" ?
farey.cpp:370 : it seems that x will always have length 1.
farey.cpp:129 I understand this is tempting, but PRETTY_FUNCTION is gcc only.
farey_symbol.pyx:plot rgbcolor option does not apply to Dedekind tesselation.  Add one example each

I still need to test the code, but hopefully I'll have time for this tomorrow.



---

archive/issue_comments_191865.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-14T21:31:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15028#issuecomment-191865",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_191866.json:
```json
{
    "body": "Martin,\n\n- the reference for the Rademacher matrix  is http://www.jstor.org/stable/2371313 .\n- what did you want to say about is >> *this?\n- fair enough and true: len(x)==1 here\n- PRETTY_FUNCTION is a leftover from testing \n- true, what is a consistent naming scheme?\n- I liked the format \"sting\" ;-)\n\nall the changes seem to be okay. I think there was one more test for odd and even groups which try to remember ... .",
    "created_at": "2014-01-14T22:36:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15028#issuecomment-191866",
    "user": "https://github.com/monien"
}
```

Martin,

- the reference for the Rademacher matrix  is http://www.jstor.org/stable/2371313 .
- what did you want to say about is >> *this?
- fair enough and true: len(x)==1 here
- PRETTY_FUNCTION is a leftover from testing 
- true, what is a consistent naming scheme?
- I liked the format "sting" ;-)

all the changes seem to be okay. I think there was one more test for odd and even groups which try to remember ... .



---

archive/issue_comments_191867.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-15T10:36:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15028#issuecomment-191867",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_191868.json:
```json
{
    "body": "Ok, I made all necessary changes. Can you have a look?\n\nJust one, last question: Why do you actually use extern \"C\"? farey_symbols.pyx is translated to a C++ file, so that shouldn't be necessary.",
    "created_at": "2014-01-15T10:37:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15028#issuecomment-191868",
    "user": "https://trac.sagemath.org/admin/accounts/users/mraum"
}
```

Ok, I made all necessary changes. Can you have a look?

Just one, last question: Why do you actually use extern "C"? farey_symbols.pyx is translated to a C++ file, so that shouldn't be necessary.



---

archive/issue_comments_191869.json:
```json
{
    "body": "This was added by somebody - not me - in some previous version of SAGE to have it working on some particular machine. Otherwise everything looks fine now.",
    "created_at": "2014-01-15T12:20:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15028#issuecomment-191869",
    "user": "https://github.com/monien"
}
```

This was added by somebody - not me - in some previous version of SAGE to have it working on some particular machine. Otherwise everything looks fine now.



---

archive/issue_comments_191870.json:
```json
{
    "body": "It's not wrong, and so let's keep it so that we don't break any architecture.",
    "created_at": "2014-01-15T16:16:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15028#issuecomment-191870",
    "user": "https://trac.sagemath.org/admin/accounts/users/mraum"
}
```

It's not wrong, and so let's keep it so that we don't break any architecture.



---

archive/issue_comments_191871.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2014-01-15T16:16:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15028#issuecomment-191871",
    "user": "https://trac.sagemath.org/admin/accounts/users/mraum"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_events_014719.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2014-01-16T05:10:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15028",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15028#event-14719"
}
```



---

archive/issue_comments_191872.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-01-16T05:10:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15028#issuecomment-191872",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_191873.json:
```json
{
    "body": "See #15719 for a documentation issue",
    "created_at": "2014-01-23T18:02:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15028",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15028#issuecomment-191873",
    "user": "https://github.com/vbraun"
}
```

See #15719 for a documentation issue
