# Issue 11849: doctest failure insage_object.pyx when test run as root

Issue created by migration from https://trac.sagemath.org/ticket/12021

Original creator: emil

Original creation time: 2011-11-13 19:43:49

Assignee: mvngu

Keywords: doctest, sage_object, root


```
sage -t -force_lib "devel/sage/sage/structure/sage_object.pyx"
*************************************************************

File "/mnt/sda6/COMPILE/sage-4.7.2/devel/sage/sage/structure/
sage_object.pyx", line 1042:
    sage: sage.structure.sage_object.picklejar(1, dir + '/noaccess')
Expected:
    Traceback (most recent call last):
    ...
    OSError: ...
Got nothing
*******************************************************************
```


the doctest creates a directory and sets permissions to 0000. if running as root no error is thrown when accessing this directory, hence the failure of the doctest.

Proposed fix: check if running the test as root or flag example as no test


[
http://groups.google.com/group/sage-devel/browse_thread/thread/e1886d5ba5ade945]


---

Attachment

patch (see Volker Braun) to avoid error in sage_object.pyx


---

Comment by emil created at 2011-11-21 12:09:43

Changing status from new to needs_review.


---

Comment by emil created at 2011-11-21 12:09:43

I attached a patch which fixes the error when run as root. However there is no warning about running tests as root which was suggested on sage-devel. 

Example:
WARNING: You are running doctests as root!
It is strongly advised to stop and run the tests as restricted user
Are you sure you want to continue as root (y/n)?

There was another ticket mentioned (#5155), maybe it should be implemented there?


---

Comment by jdemeyer created at 2012-07-27 20:41:52

Please fill in your real name as Author.


---

Comment by emil created at 2012-10-12 09:01:40

Still get the same error in 5.3, so this is still a minor issue.
I filled my real name in the comment of the patch. Where else should I fill it in?


---

Comment by vbraun created at 2012-12-03 10:10:02

looks good to me


---

Comment by vbraun created at 2012-12-03 10:10:02

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2012-12-03 10:10:58

Changing keywords from "doctest, sage_object, root" to "doctest root".


---

Comment by jdemeyer created at 2012-12-18 11:16:56

Resolution: fixed
