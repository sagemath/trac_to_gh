# Issue 6113: segfault in division_points and factoring torsion_polynomial

Issue created by migration from Trac.

Original creator: ncalexan

Original creation time: 2009-05-21 15:41:55

Assignee: was

CC:  jcremona

Keywords: segfault division points torsion polynomial

John Cremona reports:

In 4.0.alpha0, this causes a segmentation fault:


```
----------------------------------------------------------------------
----------------------------------------------------------------------
sage: K.<a>=NumberField(x^2-x+22)
sage: w=-13*a-14
sage: E=EllipticCurve([0,0,0,0,-1728*w])
sage: P1 = E.lift_x(-3*a-66)
sage: P2 = E.lift_x((-21*a-93)/4)
sage: P2.division_points(19)
```

| Sage Version 4.0.alpha0, Release Date: 2009-05-15                  |
| Type notebook() for the GUI, and license() for information.        |
It works fine to do

```
sage: g = P2.division_points(19, poly_only=True)
```

which defines a polynomial of degree 361 over Q(sqrt(-87)), but then
g.roots() goes Boom.

ncalexan verified this on Mac OS X; it looks like the crash is in an NTL function:


```
(gdb) bt
#0  0x01293247 in modii ()
#1  0x014278bc in FpX_red ()
```



---

Comment by cremona created at 2009-05-21 15:48:31

Nick, do you know what the roots function is actually doing in this case (univariate poly over a number field)?  I think it is calling factor(), but NTL has no support for polynomials over number fields so I thought it must be calling pari after that.


---

Comment by stankewicz created at 2009-06-23 01:24:30

Replying to [comment:1 cremona]:
> Nick, do you know what the roots function is actually doing in this case (univariate poly over a number field)?  I think it is calling factor(), but NTL has no support for polynomials over number fields so I thought it must be calling pari after that.

I recently ran into a similar problem trying to factor over the field generated by the hilbert class polynomial over QQ. For small degree (< 50 or so) it's okay but for larger degree polynomials it gives a segmentation fault with PARI. If there's a way I can help here and get a patch up for this I want to know about it!


---

Comment by cremona created at 2009-06-23 08:30:31

If we can come up with an example which fails in gp then it would be easy to send a bug report to the pari developers.  It is harder if we can only get the error using the pari library, since then they might want a C program in the report.  I think (quite reasonably) that the pari developers cannot be expected to debug things which can only be demonstrated in a Sage run -- even if the use of pari in Sage has increased the number of pari users worldwide by a lot!


---

Comment by stankewicz created at 2009-06-23 15:29:52

Replying to [comment:3 cremona]:
> If we can come up with an example which fails in gp then it would be easy to send a bug report to the pari developers.  It is harder if we can only get the error using the pari library, since then they might want a C program in the report.  I think (quite reasonably) that the pari developers cannot be expected to debug things which can only be demonstrated in a Sage run -- even if the use of pari in Sage has increased the number of pari users worldwide by a lot!

Well, I ran it on gp and it worked just fine. The results are included in the text file I've attached along with the same example failing in sage. When I -gdb it I get pointed to /usr/local/sage/local/LIB/libpari-gmp.so.2

That in addition to the fact that the code for factoring a univariate polynomial over a number field appears to essentially consist of "make PARI do it" is why it appeared that PARI was causing the SegFault.


---

Attachment

A run of identical jobs, one in gp which succeeds and one in sage which results in a SegFault


---

Attachment

Replying to [comment:4 stankewicz]:

Ah ha!. The problem is nonexistent with factornf, but that uses a different algorithm than nffactor, which is the pari command that sage uses for factoring. This is indeed a problem with Pari and will be reported.

Would it be possible to call factornf through gp and pull the factorization back to sage?


---

Comment by stankewicz created at 2009-06-29 16:50:58

http://pari.math.u-bordeaux.fr/cgi-bin/bugreport.cgi?bug=979

At the next upgrade of PARI this problem should be fixed(it's already fixed in the unstable version).


---

Comment by davidloeffler created at 2009-07-21 08:15:22

Changing assignee from was to davidloeffler.


---

Comment by davidloeffler created at 2009-07-21 08:15:22

Changing component from number theory to elliptic curves.


---

Comment by davidloeffler created at 2009-10-09 09:09:25

Remove assignee davidloeffler.


---

Comment by cremona created at 2009-12-30 18:25:02

This probably has the same cause as #7097:  see the comments there.  I am going to check if the patch I put up there works here too.


---

Comment by cremona created at 2009-12-30 18:32:05

Replying to [comment:9 cremona]:
> This probably has the same cause as #7097:  see the comments there.  I am going to check if the patch I put up there works here too.
It does not...


---

Comment by cremona created at 2010-10-03 16:27:00

In 4.6.alpha1:

```

sage: K.<a>=NumberField(x^2-x+22)
sage: sage: w=-13*a-14
sage: sage: E=EllipticCurve([0,0,0,0,-1728*w])
sage: sage: P1 = E.lift_x(-3*a-66)
sage: sage: P2 = E.lift_x((-21*a-93)/4)
sage: sage: P2.division_points(19)
[]
sage: g = P2.division_points(19, poly_only=True)
sage: g.roots()
[]
```

so this can be closed as fixed.


---

Comment by cremona created at 2010-10-03 16:27:00

Resolution: fixed


---

Comment by mpatel created at 2010-10-09 00:05:52

Resolution changed from fixed to duplicate
