# Issue 22874: Remove is_distributive_lattice() from hasse_diagram.py

Issue created by migration from https://trac.sagemath.org/ticket/23111

Original creator: jmantysalo

Original creation time: 2017-05-31 10:35:23

CC:  tscrim

This patch removes a useless function. (Testing for distributivity can be done much faster.)

Hopefully someday I (or someone other) will do #17173.


---

Comment by jmantysalo created at 2017-05-31 10:36:17

New commits:


---

Comment by jmantysalo created at 2017-05-31 10:36:17

Changing status from new to needs_review.


---

Comment by tscrim created at 2017-05-31 15:14:24

Until there is an alternative, I propose we leave this in. Better to have some implementation than none at all. If you do really want to remove this function, then please justify it a little more and deprecate it.


---

Comment by tscrim created at 2017-05-31 15:14:24

Changing status from needs_review to needs_info.


---

Comment by chapoton created at 2017-05-31 15:42:15

We still have `.is_distributive` for lattices. But one first need to check if the poset is a lattice. I have not compared the speeds.


---

Comment by jmantysalo created at 2017-05-31 17:12:53

Replying to [comment:4 chapoton]:
> We still have `.is_distributive` for lattices. But one first need to check if the poset is a lattice. I have not compared the speeds.

It is clear that the function I suggest to remove is slowest.

First, it checks if a poset is a lattice by computing meet- and join-matrices; only other is needed, if the poset is bounded.

Second, this is the most trivial implementation. It is much faster to just check `|Ji(L)|=Mi(L)=h(L)` and `L` is graded.


---

Comment by jmantysalo created at 2017-06-01 06:12:30

Btw, a dismantlable and bounded poset is actually a dismantlable lattice. Do we want functions `is_*_lattice()` to `posets.py` in general? I do not know if there is, say, faster `is_relatively_complemented_lattice()` than just trying `LatticePoset(P).is_relatively_complemented()`.


---

Comment by tscrim created at 2017-06-01 08:19:46

On one had, you have to check it is a lattice by converting to a lattice, which I believe is somewhat expensive. However, you may not always have lattices in some set of posets, so having such a method at the higher level is good. A split the difference approach would be to have methods with more general checks for posets at the poset level, but this would make things inconsistent in a way. However, this is not a good reason as the `HasseDiagram` is considered (IMO) an implementation detail, and essentially hidden from the user. So, it makes sense to have methods that do not need a general checks for lattice-ness.

I guess in this case I have just convinced myself that removing this method is the proper thing to do. However, because it is part of the public API of `HasseDiagram`, we still need to deprecate it.


---

Comment by tscrim created at 2017-06-01 08:19:46

Changing status from needs_info to needs_work.


---

Comment by git created at 2017-06-01 10:23:04

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jmantysalo created at 2017-06-01 10:24:45

Replying to [comment:7 tscrim]:

> I guess in this case I have just convinced myself that removing this method is the proper thing to do. However, because it is part of the public API of `HasseDiagram`, we still need to deprecate it.

Then it is easier just to make this faster.

Uncomplied code committed, not ready for review.


---

Comment by git created at 2017-09-19 11:19:36

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jmantysalo created at 2017-09-19 11:20:18

Getting back to this one... Is this the right way to start deprecating?


---

Comment by tscrim created at 2017-09-19 15:29:01

Almost. You should still have a doctest showing the deprecation.


---

Comment by jmantysalo created at 2017-09-21 08:56:17

Replying to [comment:12 tscrim]:
> Almost. You should still have a doctest showing the deprecation.

But the devel manual says "It will display the message of your choice (and interact properly with the doctest framework)", i.e. if I just left the `EXAMPLES` block as it is, it will pass the doctest. Hence I don't know what to do.


---

Comment by chapoton created at 2017-09-21 11:32:46

No, the unchanged doctest will not pass. Just keep one simple doctest, looking like that

```
             sage: p = MixedIntegerLinearProgram(solver='GLPK')
             sage: p.linear_function({1:3, 4:5})
             doctest:...: DeprecationWarning:...linear_function...deprecated...
             3*x_1 + 5*x_4
```



---

Comment by git created at 2017-09-21 11:53:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jmantysalo created at 2017-09-21 11:55:43

Strange... I must have tested this without compiling first...

Anyways, now there is a test.


---

Comment by tscrim created at 2017-09-24 07:33:05

Triple quote is over-indented. Once fixed, you can set a positive review on my behalf.


---

Comment by git created at 2017-09-25 05:01:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jmantysalo created at 2017-09-25 05:01:49

Replying to [comment:17 tscrim]:
> Triple quote is over-indented. Once fixed, you can set a positive review on my behalf.

Done this.


---

Comment by jmantysalo created at 2017-09-25 05:01:49

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2017-09-26 06:57:49

Resolution: fixed
