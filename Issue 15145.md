# Issue 15145: Implementing Macaulay Resultant (sage days 55)

archive/issues_015145.json:
```json
{
    "body": "Keywords: Macaulay Resultant\n\nTrying to Implemet Macaulay Resultant for universal polynomials as well as polynomials with coefficients  in a field k.\n\nIssue created by migration from https://trac.sagemath.org/ticket/15382\n\n",
    "created_at": "2013-11-08T19:46:30Z",
    "labels": [
        "algebraic geometry",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.3",
    "title": "Implementing Macaulay Resultant (sage days 55)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15145",
    "user": "haochen_uw"
}
```
Keywords: Macaulay Resultant

Trying to Implemet Macaulay Resultant for universal polynomials as well as polynomials with coefficients  in a field k.

Issue created by migration from https://trac.sagemath.org/ticket/15382





---

archive/issue_comments_194343.json:
```json
{
    "body": "Attachment [trac-15382-macaulay-resultant.patch](tarball://root/attachments/some-uuid/ticket15382/trac-15382-macaulay-resultant.patch) by haochen_uw created at 2013-11-10 00:22:37\n\npatch for macaulay resultant",
    "created_at": "2013-11-10T00:22:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15145#issuecomment-194343",
    "user": "haochen_uw"
}
```

Attachment [trac-15382-macaulay-resultant.patch](tarball://root/attachments/some-uuid/ticket15382/trac-15382-macaulay-resultant.patch) by haochen_uw created at 2013-11-10 00:22:37

patch for macaulay resultant



---

archive/issue_comments_194344.json:
```json
{
    "body": "Changing keywords from \"Macaulay Resultant\" to \"Macaulay Resultant sage-days55\".",
    "created_at": "2013-11-10T00:24:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15145#issuecomment-194344",
    "user": "haochen_uw"
}
```

Changing keywords from "Macaulay Resultant" to "Macaulay Resultant sage-days55".



---

archive/issue_comments_194345.json:
```json
{
    "body": "added tests",
    "created_at": "2013-11-10T15:54:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15145#issuecomment-194345",
    "user": "haochen_uw"
}
```

added tests



---

archive/issue_comments_194346.json:
```json
{
    "body": "Attachment [trac-15382-macaulay-resultant.2.patch](tarball://root/attachments/some-uuid/ticket15382/trac-15382-macaulay-resultant.2.patch) by haochen_uw created at 2013-11-10 16:01:24",
    "created_at": "2013-11-10T16:01:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15145#issuecomment-194346",
    "user": "haochen_uw"
}
```

Attachment [trac-15382-macaulay-resultant.2.patch](tarball://root/attachments/some-uuid/ticket15382/trac-15382-macaulay-resultant.2.patch) by haochen_uw created at 2013-11-10 16:01:24



---

archive/issue_comments_194347.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-11-10T16:02:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15145#issuecomment-194347",
    "user": "haochen_uw"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_194348.json:
```json
{
    "body": "Attachment [trac-15382-macaulay-resultant.3.patch](tarball://root/attachments/some-uuid/ticket15382/trac-15382-macaulay-resultant.3.patch) by haochen_uw created at 2013-11-10 16:32:09",
    "created_at": "2013-11-10T16:32:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15145#issuecomment-194348",
    "user": "haochen_uw"
}
```

Attachment [trac-15382-macaulay-resultant.3.patch](tarball://root/attachments/some-uuid/ticket15382/trac-15382-macaulay-resultant.3.patch) by haochen_uw created at 2013-11-10 16:32:09



---

archive/issue_comments_194349.json:
```json
{
    "body": "[http://trac.sagemath.org/attachment/ticket/15382/trac-15382-macaulay-resultant.3.patch](http://trac.sagemath.org/attachment/ticket/15382/trac-15382-macaulay-resultant.3.patch) changed function names to lower case and put names into global\nname space.",
    "created_at": "2013-11-10T16:34:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15145#issuecomment-194349",
    "user": "haochen_uw"
}
```

[http://trac.sagemath.org/attachment/ticket/15382/trac-15382-macaulay-resultant.3.patch](http://trac.sagemath.org/attachment/ticket/15382/trac-15382-macaulay-resultant.3.patch) changed function names to lower case and put names into global
name space.



---

archive/issue_comments_194350.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-11-15T15:30:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15145#issuecomment-194350",
    "user": "@bhutz"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_194351.json:
```json
{
    "body": "I haven't had a chance to look at the algorithm yet, but I browsed through the code in the patch and there a couple things.\n\n1) Instead of adding .n.patch for each new version, unless the new version is drastically different simply replace the previous patch with the new one.\n\n2) add a comment \"apply patch.name\" to specify which patch should be applied\n\nActually in the code:\n\n3)Replace the 'assert' which are raising AssertionError, with a 'raise' statement and something more meaning full like TypeError or ValueError\n\n4) The monomials() function takes as input the ring it is creating the monomials over. This seems like it should be a member function of the appropriate polynomial ring class instead of a stand-alone function (assuming it isn't already implemented).\n\n5) I'm still debating whether I think macalauy_resultant should also be a member function of some polynomial ring. I'm inclined to say it should be (since resultant() is) but I'm open to arguments against.\n\n6) It appears you can pass in a bunch of polynomials from all different polynomial rings and it won't detect the problem (you just get the parent of the first flist element).\n\nThat's all for now. I still need actually look at the algorithm...",
    "created_at": "2013-11-15T15:30:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15145#issuecomment-194351",
    "user": "@bhutz"
}
```

I haven't had a chance to look at the algorithm yet, but I browsed through the code in the patch and there a couple things.

1) Instead of adding .n.patch for each new version, unless the new version is drastically different simply replace the previous patch with the new one.

2) add a comment "apply patch.name" to specify which patch should be applied

Actually in the code:

3)Replace the 'assert' which are raising AssertionError, with a 'raise' statement and something more meaning full like TypeError or ValueError

4) The monomials() function takes as input the ring it is creating the monomials over. This seems like it should be a member function of the appropriate polynomial ring class instead of a stand-alone function (assuming it isn't already implemented).

5) I'm still debating whether I think macalauy_resultant should also be a member function of some polynomial ring. I'm inclined to say it should be (since resultant() is) but I'm open to arguments against.

6) It appears you can pass in a bunch of polynomials from all different polynomial rings and it won't detect the problem (you just get the parent of the first flist element).

That's all for now. I still need actually look at the algorithm...



---

archive/issue_comments_194352.json:
```json
{
    "body": "Added a branch including all the code in trac-15382-macaulay-resultant.3.patch\u200b.\nI am unable to delete extraneous patches, as we do not have permission to do so.\n----\nNew commits:",
    "created_at": "2013-11-29T15:22:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15145#issuecomment-194352",
    "user": "wishcow"
}
```

Added a branch including all the code in trac-15382-macaulay-resultant.3.patch​.
I am unable to delete extraneous patches, as we do not have permission to do so.
----
New commits:



---

archive/issue_comments_194353.json:
```json
{
    "body": "ok. I looked at the algorithm today and it looks fine. I also ran some tests comparing against the `primes_of_bad_reduction` function for projective morphisms and the results match (well, at least the primes match).\n\nIn additional to my previous comments, I have two suggestions to make this faster and one other comment\n\n1) It seems like you could combine these two loops:\n* for mon in mon_d:\n* for f in newflist:\n\n2) It also seems like you could always just work with the vector of exponents instead of converting back and forth to monomials with mon_d; i.e. don't use mon_d at all, just use degs.\n\n3) You have a monomials() function, yet you don't use it in the main macaulay_resultant function. Although with (2) you don't need it anyway. You may however want to use some kind of iterator instead of making lists of monomials since you don't need to keep them around after you've used it. I'm sure `WeightedIntegerVectors` has an iterator of some kind.\n\nIt would be nice if there were a few comments in the code for `macaulay_resultant` so that it is easier to follow.",
    "created_at": "2013-11-29T17:09:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15145#issuecomment-194353",
    "user": "@bhutz"
}
```

ok. I looked at the algorithm today and it looks fine. I also ran some tests comparing against the `primes_of_bad_reduction` function for projective morphisms and the results match (well, at least the primes match).

In additional to my previous comments, I have two suggestions to make this faster and one other comment

1) It seems like you could combine these two loops:
* for mon in mon_d:
* for f in newflist:

2) It also seems like you could always just work with the vector of exponents instead of converting back and forth to monomials with mon_d; i.e. don't use mon_d at all, just use degs.

3) You have a monomials() function, yet you don't use it in the main macaulay_resultant function. Although with (2) you don't need it anyway. You may however want to use some kind of iterator instead of making lists of monomials since you don't need to keep them around after you've used it. I'm sure `WeightedIntegerVectors` has an iterator of some kind.

It would be nice if there were a few comments in the code for `macaulay_resultant` so that it is easier to follow.



---

archive/issue_comments_194354.json:
```json
{
    "body": "Another issue is that macaulay_resultant() returns an element of the fraction field of the polynomial ring instead of a polynomial.",
    "created_at": "2013-11-30T21:13:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15145#issuecomment-194354",
    "user": "wishcow"
}
```

Another issue is that macaulay_resultant() returns an element of the fraction field of the polynomial ring instead of a polynomial.



---

archive/issue_comments_194355.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-12-03T14:29:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15145#issuecomment-194355",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_194356.json:
```json
{
    "body": "I merged the for loops as much as possible. This produced about a 25% improvement in performance, not much considering the work. The main problem is that for now we can't avoid working with actual monomials yet (I got rid of the bi-directional translation between vectors and monomials as much as I possibly could). The ring of polynomials is not equipped to work with vectors instead of monomials, for example in retrieving the coefficients.\n\nThe doctests fail on one test in a very strange way. Please let me know if you have any idea how to fix it.",
    "created_at": "2013-12-03T14:35:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15145#issuecomment-194356",
    "user": "wishcow"
}
```

I merged the for loops as much as possible. This produced about a 25% improvement in performance, not much considering the work. The main problem is that for now we can't avoid working with actual monomials yet (I got rid of the bi-directional translation between vectors and monomials as much as I possibly could). The ring of polynomials is not equipped to work with vectors instead of monomials, for example in retrieving the coefficients.

The doctests fail on one test in a very strange way. Please let me know if you have any idea how to fix it.



---

archive/issue_comments_194357.json:
```json
{
    "body": "The doctest failure is simply a typo. You have \"equal to number\" instead of \"equal number\".\n\nActually, polynomial rings *are* equipped to work with exponent vectors in place of monomials. You can get a coefficient with\n\n\n```\nR.<x,y,z>=PolynomialRing(QQ)\nf=2*x^3 + 3*x*y*z + 4*y^3 + 5*y^2+z\nf[[0,3,0]]\n```\n\n\nYou should also look back up at comment 6 again as issues (3)-(6) still need to be addressed.",
    "created_at": "2013-12-04T18:39:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15145#issuecomment-194357",
    "user": "@bhutz"
}
```

The doctest failure is simply a typo. You have "equal to number" instead of "equal number".

Actually, polynomial rings *are* equipped to work with exponent vectors in place of monomials. You can get a coefficient with


```
R.<x,y,z>=PolynomialRing(QQ)
f=2*x^3 + 3*x*y*z + 4*y^3 + 5*y^2+z
f[[0,3,0]]
```


You should also look back up at comment 6 again as issues (3)-(6) still need to be addressed.



---

archive/issue_comments_194358.json:
```json
{
    "body": "1. Thanks! You don't know how much time I spent trying to figure out why the test failed :P\n2. thanks for the pointer about the exponent vectors!\n3. I am working on the other comments, don't worry :)",
    "created_at": "2013-12-04T19:31:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15145#issuecomment-194358",
    "user": "wishcow"
}
```

1. Thanks! You don't know how much time I spent trying to figure out why the test failed :P
2. thanks for the pointer about the exponent vectors!
3. I am working on the other comments, don't worry :)



---

archive/issue_comments_194359.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-12-05T09:26:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15145#issuecomment-194359",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_194360.json:
```json
{
    "body": "OK, I made the change to exponent-vectors for extracting the coefficients of the polynomial. The code is much cleaner now, but sadly, it actually works a little slower now. I cannot really explain why this is happening, since doing\u00a0`f[This is the Trac macro *0,3,0* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#0,3,0-macro)`\u00a0is faster than doing\u00a0`f.monomial_coefficient(y^3)`. In any case, if you have more performance-improving suggestions, let me know.",
    "created_at": "2013-12-05T09:30:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15145#issuecomment-194360",
    "user": "wishcow"
}
```

OK, I made the change to exponent-vectors for extracting the coefficients of the polynomial. The code is much cleaner now, but sadly, it actually works a little slower now. I cannot really explain why this is happening, since doing `f[This is the Trac macro *0,3,0* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#0,3,0-macro)` is faster than doing `f.monomial_coefficient(y^3)`. In any case, if you have more performance-improving suggestions, let me know.



---

archive/issue_comments_194361.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-07-08T15:00:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15145#issuecomment-194361",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_194362.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-07-08T17:19:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15145#issuecomment-194362",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_194363.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-07-08T17:30:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15145#issuecomment-194363",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_194364.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-07-09T18:42:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15145#issuecomment-194364",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_194365.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-07-09T18:46:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15145#issuecomment-194365",
    "user": "wishcow"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_194366.json:
```json
{
    "body": "The docbuild issue was from making duplicate references. You only need to declare the references once. I fixed that and some minor formatting/doc issues.\n\nAs for testing: The functionality is working successfully, but there are two issues to address:\n\n1) the `assert` statements need to be switched to `raiseerror` so that is raises the appropriate error on failure (not just asserterror)\n\n2) I think the speed can be greatly improved on average by changing the way the matrix is built. Currently, all possible monomials are generated and then each entry in the matrix is filled in by checking the coefficient of that monomial in the polynomials. Since I would expect 'most' polynomials to be sparse, it should be more efficient to start with a matrix of all 0s and fill in only those entries corresponding to appropriate monomials in the polynomials.\n----\nNew commits:",
    "created_at": "2014-07-09T22:14:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15145#issuecomment-194366",
    "user": "@bhutz"
}
```

The docbuild issue was from making duplicate references. You only need to declare the references once. I fixed that and some minor formatting/doc issues.

As for testing: The functionality is working successfully, but there are two issues to address:

1) the `assert` statements need to be switched to `raiseerror` so that is raises the appropriate error on failure (not just asserterror)

2) I think the speed can be greatly improved on average by changing the way the matrix is built. Currently, all possible monomials are generated and then each entry in the matrix is filled in by checking the coefficient of that monomial in the polynomials. Since I would expect 'most' polynomials to be sparse, it should be more efficient to start with a matrix of all 0s and fill in only those entries corresponding to appropriate monomials in the polynomials.
----
New commits:



---

archive/issue_comments_194367.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-07-09T22:14:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15145#issuecomment-194367",
    "user": "@bhutz"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_194368.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-07-11T09:33:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15145#issuecomment-194368",
    "user": "wishcow"
}
```

New commits:



---

archive/issue_comments_194369.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-07-11T09:33:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15145#issuecomment-194369",
    "user": "wishcow"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_194370.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-07-11T16:22:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15145#issuecomment-194370",
    "user": "@bhutz"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_194371.json:
```json
{
    "body": "This looks good to me. I just removed some trailing whitespaces and reformatted the author note.\n----\nNew commits:",
    "created_at": "2014-07-11T16:22:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15145#issuecomment-194371",
    "user": "@bhutz"
}
```

This looks good to me. I just removed some trailing whitespaces and reformatted the author note.
----
New commits:



---

archive/issue_comments_194372.json:
```json
{
    "body": "Changing type from task to enhancement.",
    "created_at": "2014-07-12T01:46:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15145#issuecomment-194372",
    "user": "@vbraun"
}
```

Changing type from task to enhancement.



---

archive/issue_comments_194373.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-07-12T05:12:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15145#issuecomment-194373",
    "user": "@vbraun"
}
```

Resolution: fixed
