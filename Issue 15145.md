# Issue 15145: Implementing Macaulay Resultant (sage days 55)

Issue created by migration from Trac.

Original creator: haochen_uw

Original creation time: 2013-11-08 19:46:30

Keywords: Macaulay Resultant

Trying to Implemet Macaulay Resultant for universal polynomials as well as polynomials with coefficients  in a field k.


---

Attachment

patch for macaulay resultant


---

Comment by haochen_uw created at 2013-11-10 00:24:05

Changing keywords from "Macaulay Resultant" to "Macaulay Resultant sage-days55".


---

Comment by haochen_uw created at 2013-11-10 15:54:32

added tests


---

Attachment


---

Comment by haochen_uw created at 2013-11-10 16:02:44

Changing status from new to needs_review.


---

Attachment


---

Comment by haochen_uw created at 2013-11-10 16:34:12

[http://trac.sagemath.org/attachment/ticket/15382/trac-15382-macaulay-resultant.3.patch](http://trac.sagemath.org/attachment/ticket/15382/trac-15382-macaulay-resultant.3.patch) changed function names to lower case and put names into global
name space.


---

Comment by bhutz created at 2013-11-15 15:30:12

Changing status from needs_review to needs_work.


---

Comment by bhutz created at 2013-11-15 15:30:12

I haven't had a chance to look at the algorithm yet, but I browsed through the code in the patch and there a couple things.

1) Instead of adding .n.patch for each new version, unless the new version is drastically different simply replace the previous patch with the new one.

2) add a comment "apply patch.name" to specify which patch should be applied

Actually in the code:

3)Replace the 'assert' which are raising AssertionError, with a 'raise' statement and something more meaning full like TypeError or ValueError

4) The monomials() function takes as input the ring it is creating the monomials over. This seems like it should be a member function of the appropriate polynomial ring class instead of a stand-alone function (assuming it isn't already implemented).

5) I'm still debating whether I think macalauy_resultant should also be a member function of some polynomial ring. I'm inclined to say it should be (since resultant() is) but I'm open to arguments against.

6) It appears you can pass in a bunch of polynomials from all different polynomial rings and it won't detect the problem (you just get the parent of the first flist element).

That's all for now. I still need actually look at the algorithm...


---

Comment by wishcow created at 2013-11-29 15:22:26

Added a branch including all the code in trac-15382-macaulay-resultant.3.patch​.
I am unable to delete extraneous patches, as we do not have permission to do so.
----
New commits:


---

Comment by bhutz created at 2013-11-29 17:09:30

ok. I looked at the algorithm today and it looks fine. I also ran some tests comparing against the `primes_of_bad_reduction` function for projective morphisms and the results match (well, at least the primes match).

In additional to my previous comments, I have two suggestions to make this faster and one other comment

1) It seems like you could combine these two loops:
 * for mon in mon_d:
 * for f in newflist:

2) It also seems like you could always just work with the vector of exponents instead of converting back and forth to monomials with mon_d; i.e. don't use mon_d at all, just use degs.

3) You have a monomials() function, yet you don't use it in the main macaulay_resultant function. Although with (2) you don't need it anyway. You may however want to use some kind of iterator instead of making lists of monomials since you don't need to keep them around after you've used it. I'm sure `WeightedIntegerVectors` has an iterator of some kind.

It would be nice if there were a few comments in the code for `macaulay_resultant` so that it is easier to follow.


---

Comment by wishcow created at 2013-11-30 21:13:39

Another issue is that macaulay_resultant() returns an element of the fraction field of the polynomial ring instead of a polynomial.


---

Comment by git created at 2013-12-03 14:29:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by wishcow created at 2013-12-03 14:35:48

I merged the for loops as much as possible. This produced about a 25% improvement in performance, not much considering the work. The main problem is that for now we can't avoid working with actual monomials yet (I got rid of the bi-directional translation between vectors and monomials as much as I possibly could). The ring of polynomials is not equipped to work with vectors instead of monomials, for example in retrieving the coefficients.

The doctests fail on one test in a very strange way. Please let me know if you have any idea how to fix it.


---

Comment by bhutz created at 2013-12-04 18:39:10

The doctest failure is simply a typo. You have "equal to number" instead of "equal number".

Actually, polynomial rings *are* equipped to work with exponent vectors in place of monomials. You can get a coefficient with


```
R.<x,y,z>=PolynomialRing(QQ)
f=2*x^3 + 3*x*y*z + 4*y^3 + 5*y^2+z
f[This is the Trac macro *0,3,0* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#0,3,0-macro)
```


You should also look back up at comment 6 again as issues (3)-(6) still need to be addressed.


---

Comment by wishcow created at 2013-12-04 19:31:06

1. Thanks! You don't know how much time I spent trying to figure out why the test failed :P
2. thanks for the pointer about the exponent vectors!
3. I am working on the other comments, don't worry :)


---

Comment by git created at 2013-12-05 09:26:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by wishcow created at 2013-12-05 09:30:25

OK, I made the change to exponent-vectors for extracting the coefficients of the polynomial. The code is much cleaner now, but sadly, it actually works a little slower now. I cannot really explain why this is happening, since doing `f[This is the Trac macro *0,3,0* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#0,3,0-macro)` is faster than doing `f.monomial_coefficient(y^3)`. In any case, if you have more performance-improving suggestions, let me know.


---

Comment by git created at 2014-07-08 15:00:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-07-08 17:19:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-07-08 17:30:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-07-09 18:42:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by wishcow created at 2014-07-09 18:46:58

Changing status from needs_work to needs_review.


---

Comment by bhutz created at 2014-07-09 22:14:38

The docbuild issue was from making duplicate references. You only need to declare the references once. I fixed that and some minor formatting/doc issues.

As for testing: The functionality is working successfully, but there are two issues to address:

1) the `assert` statements need to be switched to `raiseerror` so that is raises the appropriate error on failure (not just asserterror)

2) I think the speed can be greatly improved on average by changing the way the matrix is built. Currently, all possible monomials are generated and then each entry in the matrix is filled in by checking the coefficient of that monomial in the polynomials. Since I would expect 'most' polynomials to be sparse, it should be more efficient to start with a matrix of all 0s and fill in only those entries corresponding to appropriate monomials in the polynomials.
----
New commits:


---

Comment by bhutz created at 2014-07-09 22:14:38

Changing status from needs_review to needs_work.


---

Comment by wishcow created at 2014-07-11 09:33:59

New commits:


---

Comment by wishcow created at 2014-07-11 09:33:59

Changing status from needs_work to needs_review.


---

Comment by bhutz created at 2014-07-11 16:22:20

Changing status from needs_review to positive_review.


---

Comment by bhutz created at 2014-07-11 16:22:20

This looks good to me. I just removed some trailing whitespaces and reformatted the author note.
----
New commits:


---

Comment by vbraun created at 2014-07-12 01:46:27

Changing type from task to enhancement.


---

Comment by vbraun created at 2014-07-12 05:12:05

Resolution: fixed
