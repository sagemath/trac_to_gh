# Issue 20250: Numpy build broken on Cygwin since #20450

archive/issues_020250.json:
```json
{
    "body": "Since the upgrade to Numpy 1.11, the patch cygwin-lapack_lite-setup.py.patch no longer applies.  This is hardly the first time (#17014, etc. :)\n\nIt's not entirely clear whether this patch is even needed anymore.  The first version of it was added 8 years ago: http://git.sagemath.org/sage.git/commit/?h=develop&id=f0ef7690e4f601e289608a09fe30df9d242eb3e8\n\nIt's not exactly clear what issue this is fixing, and I can't find any obvious reference to what it might have been--not in any of the more recent Cygwin-related documentation or anywhere.  Numpy *compiles* fine without it. \n\nIssue created by migration from https://trac.sagemath.org/ticket/20487\n\n",
    "created_at": "2016-04-22T14:19:03Z",
    "labels": [
        "component: porting: cygwin",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.3",
    "title": "Numpy build broken on Cygwin since #20450",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20250",
    "user": "https://github.com/embray"
}
```
Since the upgrade to Numpy 1.11, the patch cygwin-lapack_lite-setup.py.patch no longer applies.  This is hardly the first time (#17014, etc. :)

It's not entirely clear whether this patch is even needed anymore.  The first version of it was added 8 years ago: http://git.sagemath.org/sage.git/commit/?h=develop&id=f0ef7690e4f601e289608a09fe30df9d242eb3e8

It's not exactly clear what issue this is fixing, and I can't find any obvious reference to what it might have been--not in any of the more recent Cygwin-related documentation or anywhere.  Numpy *compiles* fine without it. 

Issue created by migration from https://trac.sagemath.org/ticket/20487





---

archive/issue_comments_278701.json:
```json
{
    "body": "I think there may also be an issue with Numpy and BLAS configuration.  After rebasing my Cython branch I'm running into some build issues with SciPy that I never encountered before, which seem to do with how Numpy is reporting what libraries it was built with. I need to spend more time investigating though.",
    "created_at": "2016-04-22T15:51:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20250#issuecomment-278701",
    "user": "https://github.com/embray"
}
```

I think there may also be an issue with Numpy and BLAS configuration.  After rebasing my Cython branch I'm running into some build issues with SciPy that I never encountered before, which seem to do with how Numpy is reporting what libraries it was built with. I need to spend more time investigating though.



---

archive/issue_comments_278702.json:
```json
{
    "body": "From my testing I've concluded that the patch in question can be dropped.  It seems that with some ancient version of Numpy the `-shared` flag was being excluded when linking this module on Cygwin for some reason or other.  That is no longer the case though.\n----\nNew commits:",
    "created_at": "2016-04-27T14:37:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20250#issuecomment-278702",
    "user": "https://github.com/embray"
}
```

From my testing I've concluded that the patch in question can be dropped.  It seems that with some ancient version of Numpy the `-shared` flag was being excluded when linking this module on Cygwin for some reason or other.  That is no longer the case though.
----
New commits:



---

archive/issue_comments_278703.json:
```json
{
    "body": "Changing keywords from \"\" to \"cygwin windows numpy\".",
    "created_at": "2016-04-27T14:37:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20250#issuecomment-278703",
    "user": "https://github.com/embray"
}
```

Changing keywords from "" to "cygwin windows numpy".



---

archive/issue_comments_278704.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-04-27T14:37:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20250#issuecomment-278704",
    "user": "https://github.com/embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_278705.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-04-28T11:08:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20250#issuecomment-278705",
    "user": "https://trac.sagemath.org/admin/accounts/users/gouezel"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_278706.json:
```json
{
    "body": "Works for me as well.",
    "created_at": "2016-04-28T11:08:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20250#issuecomment-278706",
    "user": "https://trac.sagemath.org/admin/accounts/users/gouezel"
}
```

Works for me as well.



---

archive/issue_comments_278707.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-04-29T07:13:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20250#issuecomment-278707",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_278708.json:
```json
{
    "body": "Ok this prevents all patches from being applied. Note the difference:\n\n```\n$ for patch in \"patches/*.patch\"; do echo $patch; done\npatches/numpy-1.10.1-asarray_conversion.patch patches/numpy-1.10.2-no-hardcode-blas.patch\n$ for patch in patches/*.patch; do echo $patch; done\npatches/numpy-1.10.1-asarray_conversion.patch\npatches/numpy-1.10.2-no-hardcode-blas.patch\n```\n",
    "created_at": "2016-04-30T16:41:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20250#issuecomment-278708",
    "user": "https://github.com/vbraun"
}
```

Ok this prevents all patches from being applied. Note the difference:

```
$ for patch in "patches/*.patch"; do echo $patch; done
patches/numpy-1.10.1-asarray_conversion.patch patches/numpy-1.10.2-no-hardcode-blas.patch
$ for patch in patches/*.patch; do echo $patch; done
patches/numpy-1.10.1-asarray_conversion.patch
patches/numpy-1.10.2-no-hardcode-blas.patch
```




---

archive/issue_comments_278709.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2016-04-30T16:41:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20250#issuecomment-278709",
    "user": "https://github.com/vbraun"
}
```

Changing status from closed to new.



---

archive/issue_comments_278710.json:
```json
{
    "body": "Resolution changed from fixed to ",
    "created_at": "2016-04-30T16:41:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20250#issuecomment-278710",
    "user": "https://github.com/vbraun"
}
```

Resolution changed from fixed to 



---

archive/issue_comments_278711.json:
```json
{
    "body": "Yup, that's a typo.",
    "created_at": "2016-05-02T09:16:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20250#issuecomment-278711",
    "user": "https://github.com/embray"
}
```

Yup, that's a typo.



---

archive/issue_comments_278712.json:
```json
{
    "body": "This raises a question:  If the patchbot passed for the original version of this change, what is being patched in Numpy that there isn't a regression test for?",
    "created_at": "2016-05-02T09:18:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20250#issuecomment-278712",
    "user": "https://github.com/embray"
}
```

This raises a question:  If the patchbot passed for the original version of this change, what is being patched in Numpy that there isn't a regression test for?



---

archive/issue_comments_278713.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2016-05-02T09:31:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20250#issuecomment-278713",
    "user": "https://github.com/embray"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_278714.json:
```json
{
    "body": "I'm marking this as \"needs_info\" out of concern that this was previously marked \"fixed\" and it's not clear how the issue was caught.\n----\nNew commits:",
    "created_at": "2016-05-02T09:31:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20250#issuecomment-278714",
    "user": "https://github.com/embray"
}
```

I'm marking this as "needs_info" out of concern that this was previously marked "fixed" and it's not clear how the issue was caught.
----
New commits:



---

archive/issue_comments_278715.json:
```json
{
    "body": "Numpy was not recompiled because you didn't change `package-version.txt`",
    "created_at": "2016-05-02T09:39:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20250#issuecomment-278715",
    "user": "https://github.com/vbraun"
}
```

Numpy was not recompiled because you didn't change `package-version.txt`



---

archive/issue_comments_278716.json:
```json
{
    "body": "Why would I change package-version.txt?",
    "created_at": "2016-05-02T10:08:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20250#issuecomment-278716",
    "user": "https://github.com/embray"
}
```

Why would I change package-version.txt?



---

archive/issue_comments_278717.json:
```json
{
    "body": "to trigger recompilation if necessary",
    "created_at": "2016-05-02T10:14:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20250#issuecomment-278717",
    "user": "https://github.com/vbraun"
}
```

to trigger recompilation if necessary



---

archive/issue_comments_278718.json:
```json
{
    "body": "Replying to [comment:11 embray]:\n> Why would I change package-version.txt?\n\nTo elaborate a bit on this: the build system of Sage tracks versions of installed packages. If you change the `spkg-install` script or change patches of a package, Sage will *not* automatically rebuild that package.\n\nIf you do want the package to be rebuilt, you need to increase the patchlevel in `package-version.txt`. This means either appending `.p0` or changing `.pN` to `.p(N+1)`.\n\nYou should always increase the patchlevel when changing the `spkg-install` script or patches of a package *unless there is a good reason not to*. Typical reasons \"not to\":\n\n- A completely trivial change, like a typo.\n\n- A change which affects only the **build system** of the package but does **not change the installed package** (not even in a minor way).\n\n- The change affects only a particular platform **and** the package did not **build** on that platform before.\n\nRegardless of the above reasons, a reviewer should always check that the changed package builds and works fine. This means doing a forced rebuild of the package using `sage -f PACKAGE`. Ideally, a build from scratch (`make distclean; make`) should also be tested.",
    "created_at": "2016-05-02T10:40:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20250#issuecomment-278718",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:11 embray]:
> Why would I change package-version.txt?

To elaborate a bit on this: the build system of Sage tracks versions of installed packages. If you change the `spkg-install` script or change patches of a package, Sage will *not* automatically rebuild that package.

If you do want the package to be rebuilt, you need to increase the patchlevel in `package-version.txt`. This means either appending `.p0` or changing `.pN` to `.p(N+1)`.

You should always increase the patchlevel when changing the `spkg-install` script or patches of a package *unless there is a good reason not to*. Typical reasons "not to":

- A completely trivial change, like a typo.

- A change which affects only the **build system** of the package but does **not change the installed package** (not even in a minor way).

- The change affects only a particular platform **and** the package did not **build** on that platform before.

Regardless of the above reasons, a reviewer should always check that the changed package builds and works fine. This means doing a forced rebuild of the package using `sage -f PACKAGE`. Ideally, a build from scratch (`make distclean; make`) should also be tested.



---

archive/issue_comments_278719.json:
```json
{
    "body": "Okay, that sounds reasonable-ish.  I'll touch the patch number then.  Should I also just go ahead and squash my commits or do we not care about that?",
    "created_at": "2016-05-02T12:47:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20250#issuecomment-278719",
    "user": "https://github.com/embray"
}
```

Okay, that sounds reasonable-ish.  I'll touch the patch number then.  Should I also just go ahead and squash my commits or do we not care about that?



---

archive/issue_comments_278720.json:
```json
{
    "body": "Replying to [comment:14 embray]:\n> Should I also just go ahead and squash my commits or do we not care about that?\n\nI would say that Sage has a policy to *not* squash commits, at least not while a branch is in review.",
    "created_at": "2016-05-02T13:06:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20250#issuecomment-278720",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:14 embray]:
> Should I also just go ahead and squash my commits or do we not care about that?

I would say that Sage has a policy to *not* squash commits, at least not while a branch is in review.



---

archive/issue_comments_278721.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-05-03T07:44:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20250#issuecomment-278721",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_278722.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2016-05-06T13:54:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20250#issuecomment-278722",
    "user": "https://github.com/embray"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_278723.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-05-13T12:44:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20250#issuecomment-278723",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_278724.json:
```json
{
    "body": "Builds fine on Linux too.",
    "created_at": "2016-05-13T12:44:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20250#issuecomment-278724",
    "user": "https://github.com/jdemeyer"
}
```

Builds fine on Linux too.



---

archive/issue_comments_278725.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-05-17T07:16:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20250",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20250#issuecomment-278725",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
