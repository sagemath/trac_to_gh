# Issue 28141: Test failure with gap packages

Issue created by migration from https://trac.sagemath.org/ticket/28378

Original creator: SimonKing

Original creation time: 2019-08-21 19:08:41

I get the following test failure with sage- and `gap_packages`:

```
$ ./sage -t --warn-long 51.5 src/sage/tests/gap_packages.py
Running doctests with ID 2019-08-21-21-04-02-aff006e1.
Git branch: t/19172/t19172_valuation
Using --optional=build,ccache,dochtml,frobby,gap_packages,gdb,gfortran,libsemigroups,meataxe,memlimit,mpir,p_group_cohomology,python2,sage
Doctesting 1 file.
sage -t --warn-long 51.5 src/sage/tests/gap_packages.py
**********************************************************************
File "src/sage/tests/gap_packages.py", line 8, in sage.tests.gap_packages
Failed example:
    test_packages(pkgs, only_failures=True)    # optional - gap_packages
Expected:
      Status   Package   GAP Output
    +--------+---------+------------+
Got:
    #I  method installed for Matrix matches more than one declaration
      Status   Package   GAP Output
    +--------+---------+------------+
**********************************************************************
1 item had failures:
   1 of   5 in sage.tests.gap_packages
    [11 tests, 1 failure, 6.51 s]
```


I am running with the branch from #19172, but I don't think it is related. Since the error mentions something about "matrix": Is it perhaps the case that the error only occurs if both `gap_packages` and `meataxe` (which provides a matrix implementation) is installed?


---

Comment by SimonKing created at 2019-08-21 20:59:54

In a private message, FranÃ§ois Bissey told me that he got a very similar error, namely:

```
Actually I had a similar but more expensive doctest failure
in sage-on-gentoo. I am not sure where to chase the problem
fbissey@moonloop ~ $ sage -t --long /usr/lib64/python2.7/site-packages/sage/tests/gap_packages.py --optional=4ti2,bliss,dochtml,ffmpeg,fricas,frobby,gap_packages,gdb,giacpy_sage,imagemagick,libjpeg,lie,lrslib,memlimit,optional,pari_elldata,pari_galpol,pari_seadata,python_igraph,sage,topcom
too many failed tests, not using stored timings
Running doctests with ID 2019-08-22-08-36-46-db7a4784.
Using --optional=4ti2,bliss,dochtml,ffmpeg,fricas,frobby,gap_packages,gdb,giacpy_sage,imagemagick,libjpeg,lie,lrslib,memlimit,optional,pari_elldata,pari_galpol,pari_seadata,python_igraph,sage,topcom
Doctesting 1 file.
sage -t --long /usr/lib64/python2.7/site-packages/sage/tests/gap_packages.py
**********************************************************************
File "/usr/lib64/python2.7/site-packages/sage/tests/gap_packages.py", line 8, in sage.tests.gap_packages
Failed example:
    test_packages(pkgs, only_failures=True)    # optional - gap_packages
Expected:
      Status   Package   GAP Output
    +--------+---------+------------+
Got:
    #I  MakeReadOnlyGlobal: TestHap no value bound
    #I  MakeReadOnlyGlobal: TestHapBook no value bound
    #I  method installed for Matrix matches more than one declaration
      Status   Package   GAP Output
    +--------+---------+------------+
**********************************************************************
```


Note that the actual output includes what I got, but is more. And he doesn't use meataxe, so, I removed the mentioning of meataxe in the original ticket description.


---

Comment by fbissey created at 2019-08-22 08:16:05

I hope you don't mind me fixing my name in your post. A starting point is the list of gap packages available. In my case


```
sage: from sage.tests.gap_packages import all_installed_packages
sage: all_installed_packages()
('AtlasRep',
 'AutoDoc',
 'FactInt',
 'GAPDoc',
 'Hap',
 'MapClass',
 'SmallGrp',
 'Toric',
 'aclib',
 'alnuth',
 'atlasrep',
 'autpgrp',
 'cohomolo',
 'corelg',
 'crime',
 'crisp',
 'crypting',
 'cryst',
 'crystcat',
 'ctbllib',
 'design',
 'digraphs',
 'fga',
 'gbnp',
 'genss',
 'grape',
 'guava',
 'hecke',
 'io',
 'irredsol',
 'laguna',
 'liealgdb',
 'liepring',
 'liering',
 'loops',
 'nq',
 'orb',
 'polenta',
 'polycyclic',
 'primgrp',
 'qpa',
 'quagroup',
 'radiroot',
 'resclasses',
 'semigroups',
 'sla',
 'sonata',
 'sophus',
 'tomlib',
 'transgrp',
 'utils')
```



---

Comment by SimonKing created at 2019-08-22 08:21:23

Replying to [comment:2 fbissey]:
> I hope you don't mind me fixing my name in your post. A starting point is the list of gap packages available.

Sorry, my eyes apparently are deteriorating.

I have the following packages available:

```
sage: from sage.tests.gap_packages import all_installed_packages
sage: all_installed_packages()
('AutoDoc',
 'AutoDoc',
 'AutoDoc',
 'FactInt',
 'GAPDoc',
 'HAPcryst',
 'Hap',
 'Hap',
 'MapClass',
 'PackageManager',
 'SmallGrp',
 'Toric',
 'aclib',
 'alnuth',
 'alnuth',
 'atlasrep',
 'autpgrp',
 'cohomolo',
 'corelg',
 'crime',
 'crisp',
 'crypting',
 'cryst',
 'crystcat',
 'ctbllib',
 'design',
 'digraphs',
 'fga',
 'gbnp',
 'genss',
 'grape',
 'guava',
 'hecke',
 'hecke',
 'io',
 'irredsol',
 'laguna',
 'laguna',
 'liealgdb',
 'liepring',
 'liering',
 'loops',
 'nq',
 'orb',
 'polenta',
 'polycyclic',
 'polymaking',
 'primgrp',
 'qpa-version',
 'quagroup',
 'radiroot',
 'repsn',
 'resclasses',
 'resclasses',
 'semigroups',
 'sla',
 'sonata',
 'sophus',
 'tomlib',
 'tomlib',
 'transgrp',
 'utils')
```



---

Comment by fbissey created at 2019-08-22 08:34:57

Lots of duplicates in your list. In my case the only duplicate is `AtlasRep`/`atlasrep` with the later coming from `~/.gap`. Having `qpa-version` instead of just `qpa` is strange but probably unrelated. All I can think about is trying to loop the test over the package list rather than testing the whole list at once. That way we may figure which package does emit the message. I cannot put that into action on the top of my head though.


---

Comment by embray created at 2019-12-30 14:48:17

Ticket retargeted after milestone closed


---

Comment by mkoeppe created at 2020-05-01 04:28:42

Moving tickets to milestone sage-9.2 based on a review of last modification date, branch status, and severity.


---

Comment by mkoeppe created at 2021-04-02 20:21:54

Moving this ticket to 9.4, as it seems unlikely that it will be merged in 9.3, which is in the release candidate stage
