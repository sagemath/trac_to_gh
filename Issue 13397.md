# Issue 13397: Module to load matrix from file

archive/issues_013397.json:
```json
{
    "body": "Assignee: jason, was\n\nCC:  bouillaguet\n\nNumpy and Scipy has functions to load matrix save in text files (Numpy: http://docs.scipy.org/doc/numpy/reference/routines.io.html and Scipy: http://docs.scipy.org/doc/scipy/reference/io.html).\n\nWill be nice to have a Sage function to call some of this function as backend and to handle with more file formats.\n\nIssue created by migration from https://trac.sagemath.org/ticket/13601\n\n",
    "created_at": "2012-10-15T13:37:50Z",
    "labels": [
        "linear algebra",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Module to load matrix from file",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13397",
    "user": "r.gaia.cs"
}
```
Assignee: jason, was

CC:  bouillaguet

Numpy and Scipy has functions to load matrix save in text files (Numpy: http://docs.scipy.org/doc/numpy/reference/routines.io.html and Scipy: http://docs.scipy.org/doc/scipy/reference/io.html).

Will be nice to have a Sage function to call some of this function as backend and to handle with more file formats.

Issue created by migration from https://trac.sagemath.org/ticket/13601





---

archive/issue_comments_164957.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-10-15T16:38:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13397#issuecomment-164957",
    "user": "r.gaia.cs"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_164958.json:
```json
{
    "body": "In the version 0.2 of the attachment:trac_13601-matrix_io.patch I make some improves in the definition of the functions and the documentation and write tests for all the functions.\n\nIMHO, will be better to freeze this ticket and open others when write the not implemented functions.",
    "created_at": "2012-10-30T23:10:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13397#issuecomment-164958",
    "user": "r.gaia.cs"
}
```

In the version 0.2 of the attachment:trac_13601-matrix_io.patch I make some improves in the definition of the functions and the documentation and write tests for all the functions.

IMHO, will be better to freeze this ticket and open others when write the not implemented functions.



---

archive/issue_comments_164959.json:
```json
{
    "body": "Instead of adding new global symbols `load_matrix` / `write_matrix`, how about making them accessible through the matrix constructor? That is, if the first argument to `matrix()` is a string then call `load_matrix(filename, **kwds)`. The `write_matrix` functionality should be wrapped into the `save()` method of matrices, this can then be discovered by the user with tab-completion.\n\nA minor English nitpick, its either load/save or read/write.",
    "created_at": "2012-10-31T11:15:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13397#issuecomment-164959",
    "user": "vbraun"
}
```

Instead of adding new global symbols `load_matrix` / `write_matrix`, how about making them accessible through the matrix constructor? That is, if the first argument to `matrix()` is a string then call `load_matrix(filename, **kwds)`. The `write_matrix` functionality should be wrapped into the `save()` method of matrices, this can then be discovered by the user with tab-completion.

A minor English nitpick, its either load/save or read/write.



---

archive/issue_comments_164960.json:
```json
{
    "body": "Replying to [comment:4 vbraun]:\n> Instead of adding new global symbols `load_matrix` / `write_matrix`, how about making them accessible through the matrix constructor? That is, if the first argument to `matrix()` is a string then call `load_matrix(filename, **kwds)`. The `write_matrix` functionality should be wrapped into the `save()` method of matrices, this can then be discovered by the user with tab-completion.\n\nI like the suggestion.",
    "created_at": "2012-10-31T11:27:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13397#issuecomment-164960",
    "user": "r.gaia.cs"
}
```

Replying to [comment:4 vbraun]:
> Instead of adding new global symbols `load_matrix` / `write_matrix`, how about making them accessible through the matrix constructor? That is, if the first argument to `matrix()` is a string then call `load_matrix(filename, **kwds)`. The `write_matrix` functionality should be wrapped into the `save()` method of matrices, this can then be discovered by the user with tab-completion.

I like the suggestion.



---

archive/issue_comments_164961.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-10-31T11:35:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13397#issuecomment-164961",
    "user": "r.gaia.cs"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_164962.json:
```json
{
    "body": "Attachment [trac_13601-matrix_io.patch](tarball://root/attachments/some-uuid/ticket13601/trac_13601-matrix_io.patch) by r.gaia.cs created at 2012-10-31 11:41:16\n\nVersion 0.2",
    "created_at": "2012-10-31T11:41:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13397#issuecomment-164962",
    "user": "r.gaia.cs"
}
```

Attachment [trac_13601-matrix_io.patch](tarball://root/attachments/some-uuid/ticket13601/trac_13601-matrix_io.patch) by r.gaia.cs created at 2012-10-31 11:41:16

Version 0.2



---

archive/issue_comments_164963.json:
```json
{
    "body": "I would rather see matrix(str, ...) try to parse the string, so one could do\n\n\n```\nmatrix(\"\"\"\n[1, 2]\n[3, 4]\n\"\"\")\n```\n\n\nAnd use matrix(open(\"/path/to/file\", ...) for loading from a file.",
    "created_at": "2012-10-31T17:25:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13397#issuecomment-164963",
    "user": "robertwb"
}
```

I would rather see matrix(str, ...) try to parse the string, so one could do


```
matrix("""
[1, 2]
[3, 4]
""")
```


And use matrix(open("/path/to/file", ...) for loading from a file.



---

archive/issue_comments_164964.json:
```json
{
    "body": "Another possibility would be to turn `matrix` into a class with `matrix.__call__` doing what we are doing now. Then one can add methods `matrix.load`, `matrix.identity`, ...",
    "created_at": "2012-10-31T17:47:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13397#issuecomment-164964",
    "user": "vbraun"
}
```

Another possibility would be to turn `matrix` into a class with `matrix.__call__` doing what we are doing now. Then one can add methods `matrix.load`, `matrix.identity`, ...



---

archive/issue_comments_164965.json:
```json
{
    "body": "Replying to [comment:7 robertwb]:\n\nI like the idea of see `matrix(str, ...)` try to parse the string. But I prefer to use `matrix(\"/path/to/file\", ...)` rather than `matrix(open(\"/path/to/file\", ...), ...)`.",
    "created_at": "2012-10-31T18:28:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13397#issuecomment-164965",
    "user": "r.gaia.cs"
}
```

Replying to [comment:7 robertwb]:

I like the idea of see `matrix(str, ...)` try to parse the string. But I prefer to use `matrix("/path/to/file", ...)` rather than `matrix(open("/path/to/file", ...), ...)`.



---

archive/issue_comments_164966.json:
```json
{
    "body": "Replying to [comment:9 r.gaia.cs]:\n> Replying to [comment:7 robertwb]:\n> \n> I like the idea of see `matrix(str, ...)` try to parse the string. But I prefer to use `matrix(\"/path/to/file\", ...)` rather than `matrix(open(\"/path/to/file\", ...), ...)`.\n\nBut how would you disambiguate the two?  It does seem odd to not be able to construct matrices from strings, as one can do `ZZ(\"123\")` and `SR(\"b^2 - 4a c\")` and `ZZ['x'](\"x^3 - 3x + 1\")`.\n\nA huge +1 to Volker's idea. #13678",
    "created_at": "2012-10-31T21:50:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13397#issuecomment-164966",
    "user": "robertwb"
}
```

Replying to [comment:9 r.gaia.cs]:
> Replying to [comment:7 robertwb]:
> 
> I like the idea of see `matrix(str, ...)` try to parse the string. But I prefer to use `matrix("/path/to/file", ...)` rather than `matrix(open("/path/to/file", ...), ...)`.

But how would you disambiguate the two?  It does seem odd to not be able to construct matrices from strings, as one can do `ZZ("123")` and `SR("b^2 - 4a c")` and `ZZ['x']("x^3 - 3x + 1")`.

A huge +1 to Volker's idea. #13678



---

archive/issue_comments_164967.json:
```json
{
    "body": "Replying to [comment:10 robertwb]:\n> Replying to [comment:9 r.gaia.cs]:\n> > Replying to [comment:7 robertwb]:\n> > \n> > I like the idea of see `matrix(str, ...)` try to parse the string. But I prefer to use `matrix(\"/path/to/file\", ...)` rather than `matrix(open(\"/path/to/file\", ...), ...)`.\n> \n> But how would you disambiguate the two?\n\nIMHO, for the string to be parse it must be equal to the nice string representation of:\n\n* a flat list of elements: `'[1, 2, 3, 4]'`;\n* a list of lists (i.e., a list of rows): `[[1, 2], [3, 4]]`;\n* a list of Sage vectors: `'[(1, 2), (3, 4)]'`\n* a dictionary having positions as keys and matrix entries as values: `'{(0, 1): 2, (1, 0): 3, (0, 0): 1, (1, 1): 4}'`\n\nOnce in all the four cases above the 0-position of the string is `[` or `{` it can be used to disambiguate between the two.\n\nWill be good too that one could do\n\n```\nmatrix(\"\"\"\n1, 2\n3, 4\n\"\"\")\n```\n\n\nFor this special case we can use the new line character to disambiguate.\n\n> A huge +1 to Volker's idea. #13678\nA huge +2 to Volker's idea. #13678",
    "created_at": "2012-10-31T23:40:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13397#issuecomment-164967",
    "user": "r.gaia.cs"
}
```

Replying to [comment:10 robertwb]:
> Replying to [comment:9 r.gaia.cs]:
> > Replying to [comment:7 robertwb]:
> > 
> > I like the idea of see `matrix(str, ...)` try to parse the string. But I prefer to use `matrix("/path/to/file", ...)` rather than `matrix(open("/path/to/file", ...), ...)`.
> 
> But how would you disambiguate the two?

IMHO, for the string to be parse it must be equal to the nice string representation of:

* a flat list of elements: `'[1, 2, 3, 4]'`;
* a list of lists (i.e., a list of rows): `[[1, 2], [3, 4]]`;
* a list of Sage vectors: `'[(1, 2), (3, 4)]'`
* a dictionary having positions as keys and matrix entries as values: `'{(0, 1): 2, (1, 0): 3, (0, 0): 1, (1, 1): 4}'`

Once in all the four cases above the 0-position of the string is `[` or `{` it can be used to disambiguate between the two.

Will be good too that one could do

```
matrix("""
1, 2
3, 4
""")
```


For this special case we can use the new line character to disambiguate.

> A huge +1 to Volker's idea. #13678
A huge +2 to Volker's idea. #13678



---

archive/issue_comments_164968.json:
```json
{
    "body": "I think it would be odd if `ZZ(s)` tried to open the file `s` if it didin't represent a valid integer (and/or refused to if it did). Same issue applies to matrices. IMHO, better to raise an error than have very different semantics here.\n\nYou could rebase this atop the #13678 (using matrix.load) to sidestep the whole issue.",
    "created_at": "2012-11-01T06:09:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13397#issuecomment-164968",
    "user": "robertwb"
}
```

I think it would be odd if `ZZ(s)` tried to open the file `s` if it didin't represent a valid integer (and/or refused to if it did). Same issue applies to matrices. IMHO, better to raise an error than have very different semantics here.

You could rebase this atop the #13678 (using matrix.load) to sidestep the whole issue.



---

archive/issue_comments_164969.json:
```json
{
    "body": "To parse a string-matrix I think we should just match numbers and strip everything else out, as in\n\n```\nsage: number = re.compile('[-+]?[0-9]*\\.?[0-9]+([eE][-+]?[0-9]+)?')\nsage: [ match.group() for match in number.finditer('[ 1e3, 0 | 3 6, 1.3 .123)') ]\n['1e3', '0', '3', '6', '1.3', '.123']\n```\n\nThen put the numbers from each line into the rows of a matrix. This should grok all ascii-art matrix representations.\n\nIf the input string is already valid Python, say, then the user can just eval it directly. So we shouldn't worry too much about that case.\n\n+1 to use `matrix.load()` to load the matrix.",
    "created_at": "2012-11-01T09:40:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13397#issuecomment-164969",
    "user": "vbraun"
}
```

To parse a string-matrix I think we should just match numbers and strip everything else out, as in

```
sage: number = re.compile('[-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?')
sage: [ match.group() for match in number.finditer('[ 1e3, 0 | 3 6, 1.3 .123)') ]
['1e3', '0', '3', '6', '1.3', '.123']
```

Then put the numbers from each line into the rows of a matrix. This should grok all ascii-art matrix representations.

If the input string is already valid Python, say, then the user can just eval it directly. So we shouldn't worry too much about that case.

+1 to use `matrix.load()` to load the matrix.



---

archive/issue_comments_164970.json:
```json
{
    "body": "+1 to use matrix.load() to load the matrix !\n\nThis ticket should really be rebased on top of #13678 !\n\nMinor problems I spotted : there are a lot of english mistakes in the patch, copyright notice should not say 2005 W.stein, but 2012 R.Silva.\n\nLastly, I find it weird to write a whole lot of boilerplate, especially in the (user-visible) documentation, about things that are not implemented. I think it could confuse users, and I personally think that it would be better if we took the pain of actually doing the work before merging the ticket. Or at least it could be rephrased \"TODO : other formats that we could possibly handle in the future include....\"\n\nAbout the MatrixMarket format : as Raniere mentions, SciPy has functions to read/write this format. These functions could probably be used as-is for floating-point matrices, but as far as I understand what they do, they do not support integer matrices. And even if they would, they would be limited to 32/64 bits integers because they rely on NumPy. Therefore I tend to believe that an integer version of the MatrixMarket code would have to be re-implemented. We cannot patch SciPy to work with arbitrarily large integers... So I think that we should take SciPy's MatrixMarket code and improve it. I am willing to do this, but I'd rather be sure that we agree before doing it.\n\nOh, a last detail : the MatrixMarket format comes in a dense and in a sparse version, real, complex, integer or binary, thus it would seem natural that the loader itself sets the sparsity flag and the ring. In the patch they are given to the loader.",
    "created_at": "2012-12-06T06:51:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13397",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13397#issuecomment-164970",
    "user": "Bouillaguet"
}
```

+1 to use matrix.load() to load the matrix !

This ticket should really be rebased on top of #13678 !

Minor problems I spotted : there are a lot of english mistakes in the patch, copyright notice should not say 2005 W.stein, but 2012 R.Silva.

Lastly, I find it weird to write a whole lot of boilerplate, especially in the (user-visible) documentation, about things that are not implemented. I think it could confuse users, and I personally think that it would be better if we took the pain of actually doing the work before merging the ticket. Or at least it could be rephrased "TODO : other formats that we could possibly handle in the future include...."

About the MatrixMarket format : as Raniere mentions, SciPy has functions to read/write this format. These functions could probably be used as-is for floating-point matrices, but as far as I understand what they do, they do not support integer matrices. And even if they would, they would be limited to 32/64 bits integers because they rely on NumPy. Therefore I tend to believe that an integer version of the MatrixMarket code would have to be re-implemented. We cannot patch SciPy to work with arbitrarily large integers... So I think that we should take SciPy's MatrixMarket code and improve it. I am willing to do this, but I'd rather be sure that we agree before doing it.

Oh, a last detail : the MatrixMarket format comes in a dense and in a sparse version, real, complex, integer or binary, thus it would seem natural that the loader itself sets the sparsity flag and the ring. In the patch they are given to the loader.
