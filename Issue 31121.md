# Issue 31121: python3 spkg-configure.m4: Do not reject python based on sysconfig LDFLAGS containing "-L."

archive/issues_031121.json:
```json
{
    "body": "CC:  strogdon\n\n(from #31132)\n\ngentoo appears to use this flag, which is redundant but harmless.\n\nIssue created by migration from https://trac.sagemath.org/ticket/31358\n\n",
    "created_at": "2021-02-08T05:10:18Z",
    "labels": [
        "build: configure",
        "major",
        "bug"
    ],
    "title": "python3 spkg-configure.m4: Do not reject python based on sysconfig LDFLAGS containing \"-L.\"",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31121",
    "user": "mkoeppe"
}
```
CC:  strogdon

(from #31132)

gentoo appears to use this flag, which is redundant but harmless.

Issue created by migration from https://trac.sagemath.org/ticket/31358





---

archive/issue_comments_444642.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-02-08T05:25:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31121#issuecomment-444642",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_444643.json:
```json
{
    "body": "According to `tox -e docker-gentoo-standard -- config.status`, this change fixes it.\n----\nNew commits:",
    "created_at": "2021-02-08T05:25:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31121#issuecomment-444643",
    "user": "mkoeppe"
}
```

According to `tox -e docker-gentoo-standard -- config.status`, this change fixes it.
----
New commits:



---

archive/issue_comments_444644.json:
```json
{
    "body": "I still see the issue here\n{{{#! git log\ncommit 18a7d183983b5f4a8153cb2066624fa74ad49814 (HEAD -> trac_31358, trac/u/mkoeppe/python3_spkg_configure_m4__do_not_reject_python_based_on_sysconfig_ldflags_containing___l__)\nAuthor: Matthias Koeppe <mkoeppe@math.ucdavis.edu>\nDate:   Sun Feb 7 21:23:46 2021 -0800\n\n    build/pkgs/python3/spkg-configure.m4: -L. and -I. are OK\n\ncommit 8453ffb849b047893b6c61dd09176a84c9133342 (tag: 9.3.beta7, origin/develop, origin/HEAD, develop)\nAuthor: Release Manager <release@sagemath.org>\nDate:   Sun Feb 7 20:42:26 2021 +0100\n\n    Updated SageMath version to 9.3.beta7\n\ncommit 6096110e060e441df3219fd8caef1c4525145983\nMerge: e67fc51749 c40efe9f4b\nAuthor: Release Manager <release@sagemath.org>\nDate:   Sun Feb 7 12:55:53 2021 +0100\n\n    Trac #30517: MemoryError in doctesting combinat/designs/gen_quadrangles_with_spread.pyx\n```\n\n\nand after either `./configure` or `./configure --with-system-python3=yes` I have\n\n```\nx86_64-pc-linux-gnu-g++ -pthread -shared -Wl,-O1 -Wl,--as-needed conftest.dir/temp.linux-x86_64-3.9/conftest.o -L/usr/lib64 -o conftest.dir/lib.linux-x86_64-3.9/config_check_distutils_cxx.cpython-39-x86_64-linux-gnu.so\n        LDFLAGS = \"-Wl,-O1 -Wl,--as-needed -L.\"\nconfigure:32030: result: no, this is a misconfigured Python whose sysconfig compiler/linker flags contain -I or -L options, which may cause wrong versions of libraries to leak into the build of Python packages - see https://trac.sagemath.org/ticket/31132; to use it anyway, use ./configure --with-python=/usr/bin/python3\n```\n",
    "created_at": "2021-02-08T05:57:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31121#issuecomment-444644",
    "user": "strogdon"
}
```

I still see the issue here
{{{#! git log
commit 18a7d183983b5f4a8153cb2066624fa74ad49814 (HEAD -> trac_31358, trac/u/mkoeppe/python3_spkg_configure_m4__do_not_reject_python_based_on_sysconfig_ldflags_containing___l__)
Author: Matthias Koeppe <mkoeppe@math.ucdavis.edu>
Date:   Sun Feb 7 21:23:46 2021 -0800

    build/pkgs/python3/spkg-configure.m4: -L. and -I. are OK

commit 8453ffb849b047893b6c61dd09176a84c9133342 (tag: 9.3.beta7, origin/develop, origin/HEAD, develop)
Author: Release Manager <release@sagemath.org>
Date:   Sun Feb 7 20:42:26 2021 +0100

    Updated SageMath version to 9.3.beta7

commit 6096110e060e441df3219fd8caef1c4525145983
Merge: e67fc51749 c40efe9f4b
Author: Release Manager <release@sagemath.org>
Date:   Sun Feb 7 12:55:53 2021 +0100

    Trac #30517: MemoryError in doctesting combinat/designs/gen_quadrangles_with_spread.pyx
```


and after either `./configure` or `./configure --with-system-python3=yes` I have

```
x86_64-pc-linux-gnu-g++ -pthread -shared -Wl,-O1 -Wl,--as-needed conftest.dir/temp.linux-x86_64-3.9/conftest.o -L/usr/lib64 -o conftest.dir/lib.linux-x86_64-3.9/config_check_distutils_cxx.cpython-39-x86_64-linux-gnu.so
        LDFLAGS = "-Wl,-O1 -Wl,--as-needed -L."
configure:32030: result: no, this is a misconfigured Python whose sysconfig compiler/linker flags contain -I or -L options, which may cause wrong versions of libraries to leak into the build of Python packages - see https://trac.sagemath.org/ticket/31132; to use it anyway, use ./configure --with-python=/usr/bin/python3
```




---

archive/issue_comments_444645.json:
```json
{
    "body": "Did you run `./bootstrap`?",
    "created_at": "2021-02-08T05:58:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31121#issuecomment-444645",
    "user": "mkoeppe"
}
```

Did you run `./bootstrap`?



---

archive/issue_comments_444646.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-02-08T06:11:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31121#issuecomment-444646",
    "user": "strogdon"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_444647.json:
```json
{
    "body": "Replying to [comment:5 mkoeppe]:\n> Did you run `./bootstrap`?\nThat was it.\n\n```\nconfigure:39140: result: python3-3.9.1:                               using system package; SPKG will not be installed\n```\n\nThanks",
    "created_at": "2021-02-08T06:11:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31121#issuecomment-444647",
    "user": "strogdon"
}
```

Replying to [comment:5 mkoeppe]:
> Did you run `./bootstrap`?
That was it.

```
configure:39140: result: python3-3.9.1:                               using system package; SPKG will not be installed
```

Thanks



---

archive/issue_comments_444648.json:
```json
{
    "body": "Thanks for testing!",
    "created_at": "2021-02-08T06:23:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31121#issuecomment-444648",
    "user": "mkoeppe"
}
```

Thanks for testing!



---

archive/issue_comments_444649.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-03-09T00:01:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31121#issuecomment-444649",
    "user": "vbraun"
}
```

Resolution: fixed
