# Issue 22446: backend_polymake for Polyhedron

Issue created by migration from https://trac.sagemath.org/ticket/22683

Original creator: mkoeppe

Original creation time: 2017-03-26 19:43:10

CC:  simonking jipilab vdelecroix tscrim yzh

Building upon #22658 (Support interface coercion `polymake(X)` for `Polyhedron`), we provide a backend in `backend_polymake.py` that does all `Polyhedron` computations using polymake (in particular, the initial computation of the double description).

For quadratic field extensions of the rationals, this backend should be faster than the generic implementation in Python (unless the pexpect overhead dominates). 



---

Comment by mkoeppe created at 2017-03-26 22:31:45

As preparation, I have implemented the `_sage_` method. 
----
Last 10 new commits:


---

Comment by git created at 2017-03-27 06:15:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-03-27 06:19:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2017-03-27 06:20:35

Changing status from new to needs_review.


---

Comment by tscrim created at 2017-03-27 14:43:01

Two things I see:

- `def _polymake_` is missing doctests.
- In `__iter__`, you should use ```self``` in the docstrings. You also don't need to have an `INPUT:` block since there essentially no input.

Otherwise LGTM modulo the dependency.


---

Comment by git created at 2017-03-27 23:34:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2017-03-28 02:36:55

Thank you.


---

Comment by tscrim created at 2017-03-28 02:36:55

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2017-03-28 02:38:01

Thanks for reviewing!


---

Comment by tscrim created at 2017-03-28 02:40:17

Not a problem; happy to help.


---

Comment by fbissey created at 2017-04-01 22:15:29

I suspect this will pass tests on the bots with stand-alone sage. It gives me trouble in sage-on-gentoo while building the documentation, I am not sure how other distros deal with the doc building. I have the following failure related to this ticket

```
[discrete_] /dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/doc/en/reference/discrete_geometry/sage/geometry/polyhedron/library.rst:11: WARNING: autodoc: failed to import module u'sage.geometry.polyhedron.library'; the following exception was raised:
[discrete_] Traceback (most recent call last):
[discrete_] File "/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/sage_setup/docbuild/ext/sage_autodoc.py", line 525, in import_object
[discrete_] __import__(self.modname)
[discrete_] File "/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/lib/sage/geometry/polyhedron/library.py", line 75, in <module>
[discrete_] from sage.combinat.root_system.associahedron import Associahedron
[discrete_] File "/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/lib/sage/combinat/root_system/associahedron.py", line 23, in <module>
[discrete_] from sage.geometry.polyhedron.parent import Polyhedra_QQ_ppl
[discrete_] File "/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/lib/sage/geometry/polyhedron/parent.py", line 825, in <module>
[discrete_] from sage.geometry.polyhedron.backend_polymake import Polyhedron_polymake
[discrete_] File "/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/lib/sage/geometry/polyhedron/backend_polymake.py", line 31, in <module>
[discrete_] from sage.rings.integer import LCM_list
[discrete_] ImportError: cannot import name LCM_list
[discrete_] /dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/doc/en/reference/discrete_geometry/sage/geometry/polyhedron/parent.rst:11: WARNING: autodoc: failed to import module u'sage.geometry.polyhedron.parent'; the following exception was raised:
[discrete_] Traceback (most recent call last):
[discrete_] File "/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/sage_setup/docbuild/ext/sage_autodoc.py", line 525, in import_object
[discrete_] __import__(self.modname)
[discrete_] File "/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/lib/sage/geometry/polyhedron/parent.py", line 825, in <module>
[discrete_] from sage.geometry.polyhedron.backend_polymake import Polyhedron_polymake
[discrete_] File "/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/lib/sage/geometry/polyhedron/backend_polymake.py", line 31, in <module>
[discrete_] from sage.rings.integer import LCM_list
[discrete_] ImportError: cannot import name LCM_list
```

which itself comes from #22630. Volker is currently testing the ticket so don't touch it now. If it is accepted as is, could we have a follow up to import `LCM_list` directly from `sage.arith.functions`? Although if I have problems with `lazy_import`, I will be fighting symptoms rather than the disease by doing that.


---

Comment by tscrim created at 2017-04-02 00:01:35

Changing status from positive_review to needs_work.


---

Comment by tscrim created at 2017-04-02 00:01:35

`LCM_list` is never called in the code AFAICS. So it should just be as simple as removing the import so this doesn't have to be based on #22630. Which ticket do you mean by "the ticket"?


---

Comment by fbissey created at 2017-04-02 03:39:00

Replying to [comment:14 tscrim]:
> `LCM_list` is never called in the code AFAICS. So it should just be as simple as removing the import so this doesn't have to be based on #22630. Which ticket do you mean by "the ticket"?

This, here, ticket. I am signaling because I need to keep track of these things but I don't want to stop normal progress. Any issue I have, could be dealt with in a follow up ticket. Volker's already merged this ticket in his testing branch and if all goes well we shouldn't prevent the closing of this ticket because of sage-on-gentoo [OK, I would stop it if I thought you did something terrible].


---

Comment by fbissey created at 2017-04-02 03:39:00

Changing status from needs_work to positive_review.


---

Comment by mkoeppe created at 2017-04-02 04:02:21

Follow-up ticket at #22740.


---

Comment by vbraun created at 2017-04-02 14:22:10

Documentation doesn't build


---

Comment by vbraun created at 2017-04-02 14:22:10

Changing status from positive_review to needs_work.


---

Comment by git created at 2017-04-02 19:01:03

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by mkoeppe created at 2017-04-02 19:03:35

I've merged in #22740, which was intended to be a follow-up ticket, hoping that this will fix the doc build problems. 
Also merged the updated branch prereq #22658 (which I'll mark as dup), which brings in 8.0.beta0. 
And added `backend_polymake` to the discrete geometry section of the manual. 
Documentation builds for me on this branch.


---

Comment by mkoeppe created at 2017-04-02 19:03:35

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2017-04-02 19:10:15

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2017-04-02 19:10:15

I would have been somewhat surprised if the doc did build on Volker's testing branch given comment:13. Changes LGTM.


---

Comment by fbissey created at 2017-04-02 19:49:06

Well, I would have thought you build your branch and the documentation. So, to me it was probably a problem on my side.


---

Comment by tscrim created at 2017-04-02 19:59:32

I didn't test it in conjunction with #22630 and didn't notice the conflict.


---

Comment by vbraun created at 2017-04-05 19:37:55

Resolution: fixed
