# Issue 11460: conf.py in thematics tutorial overwrites jsmath macros

archive/issues_011460.json:
```json
{
    "body": "Assignee: mvngu\n\nBecause of the line \n\n```\nhtml_theme_options['jsmath_macros'] = [\"mathfrak : ['\\\\\\\\mathbf{#1}', 1]\"]\n```\n\nin `thematics_tutorials/conf.py`, existing jsmath macros are overwritten, so Sage-specific macros like `\\QQ` don't work.  The attached patch fixes this.\n\nIssue created by migration from https://trac.sagemath.org/ticket/11632\n\n",
    "created_at": "2011-07-26T22:03:45Z",
    "labels": [
        "documentation",
        "minor",
        "bug"
    ],
    "title": "conf.py in thematics tutorial overwrites jsmath macros",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11460",
    "user": "jhpalmieri"
}
```
Assignee: mvngu

Because of the line 

```
html_theme_options['jsmath_macros'] = ["mathfrak : ['\\\\mathbf{#1}', 1]"]
```

in `thematics_tutorials/conf.py`, existing jsmath macros are overwritten, so Sage-specific macros like `\QQ` don't work.  The attached patch fixes this.

Issue created by migration from https://trac.sagemath.org/ticket/11632





---

archive/issue_comments_127914.json:
```json
{
    "body": "Attachment [trac_11632-thematic-conf.patch](tarball://root/attachments/some-uuid/ticket11632/trac_11632-thematic-conf.patch) by hivert created at 2011-07-28 09:04:03\n\nHi john,\n\nIs there any missing dependencies ? On \n\n```\npopcorn-*evel/sage-review $ sage -version\n```\n\nwith just the patch applied I get:\n\n```\nException occurred:\n  File \"/home/florent/src/Sage/sage/devel/sage/doc/en/thematic_tutorials/conf.py\", line 35, in <module>\n    html_theme_options['jsmath_macros'].append(\"mathfrak : ['\\\\\\\\mathbf{#1}', 1]\")\nKeyError: 'jsmath_macros'\nThe full traceback has been saved in /tmp/sphinx-err-IGtEC6.log, if you want to report the issue to the developers.\n```\n\n| Sage Version 4.7, Release Date: 2011-05-23                         |\nOr should it be applied on some dev version ?",
    "created_at": "2011-07-28T09:04:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11460#issuecomment-127914",
    "user": "hivert"
}
```

Attachment [trac_11632-thematic-conf.patch](tarball://root/attachments/some-uuid/ticket11632/trac_11632-thematic-conf.patch) by hivert created at 2011-07-28 09:04:03

Hi john,

Is there any missing dependencies ? On 

```
popcorn-*evel/sage-review $ sage -version
```

with just the patch applied I get:

```
Exception occurred:
  File "/home/florent/src/Sage/sage/devel/sage/doc/en/thematic_tutorials/conf.py", line 35, in <module>
    html_theme_options['jsmath_macros'].append("mathfrak : ['\\\\mathbf{#1}', 1]")
KeyError: 'jsmath_macros'
The full traceback has been saved in /tmp/sphinx-err-IGtEC6.log, if you want to report the issue to the developers.
```

| Sage Version 4.7, Release Date: 2011-05-23                         |
Or should it be applied on some dev version ?



---

archive/issue_comments_127915.json:
```json
{
    "body": "I can't reproduce this; I've tried on two different machines with vanilla versions of Sage 4.7.  (I wrote the patch based on 4.7.1.rc0, but I don't think anything relevant has changed since 4.7.)  I can change the patch to\n\n```diff\ndiff --git a/doc/en/thematic_tutorials/conf.py b/doc/en/thematic_tutorials/conf.py\n--- a/doc/en/thematic_tutorials/conf.py\n+++ b/doc/en/thematic_tutorials/conf.py\n@@ -32,7 +32,10 @@ htmlhelp_basename = \"thematic_tutorials\"\n # following line turns it into bold face only when using jsMath, thus\n # avoiding the errors, while keeping the nice mathfrak fonts when not\n # using jsMath.\n-html_theme_options['jsmath_macros'] = [\"mathfrak : ['\\\\\\\\mathbf{#1}', 1]\"]\n+try:\n+    html_theme_options['jsmath_macros'].append(\"mathfrak : ['\\\\\\\\mathbf{#1}', 1]\")\n+except KeyError:\n+    html_theme_options['jsmath_macros'] = [\"mathfrak : ['\\\\\\\\mathbf{#1}', 1]\"]\n \n # Grouping the document tree into LaTeX files. List of tuples\n # (source start file, target name, title, author,\n```\n\nif you think that would be a good idea.",
    "created_at": "2011-07-28T15:38:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11460#issuecomment-127915",
    "user": "jhpalmieri"
}
```

I can't reproduce this; I've tried on two different machines with vanilla versions of Sage 4.7.  (I wrote the patch based on 4.7.1.rc0, but I don't think anything relevant has changed since 4.7.)  I can change the patch to

```diff
diff --git a/doc/en/thematic_tutorials/conf.py b/doc/en/thematic_tutorials/conf.py
--- a/doc/en/thematic_tutorials/conf.py
+++ b/doc/en/thematic_tutorials/conf.py
@@ -32,7 +32,10 @@ htmlhelp_basename = "thematic_tutorials"
 # following line turns it into bold face only when using jsMath, thus
 # avoiding the errors, while keeping the nice mathfrak fonts when not
 # using jsMath.
-html_theme_options['jsmath_macros'] = ["mathfrak : ['\\\\mathbf{#1}', 1]"]
+try:
+    html_theme_options['jsmath_macros'].append("mathfrak : ['\\\\mathbf{#1}', 1]")
+except KeyError:
+    html_theme_options['jsmath_macros'] = ["mathfrak : ['\\\\mathbf{#1}', 1]"]
 
 # Grouping the document tree into LaTeX files. List of tuples
 # (source start file, target name, title, author,
```

if you think that would be a good idea.



---

archive/issue_comments_127916.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-07-28T15:38:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11460#issuecomment-127916",
    "user": "jhpalmieri"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_127917.json:
```json
{
    "body": "Replying to [comment:2 jhpalmieri]:\n> if you think that would be a good idea.\n\nYes, please do it.  The problem mentioned by hivert is reproducible with sage-4.7.2.alpha3 (note you need to delete the `devel/sage/doc/output` directory before testing).",
    "created_at": "2011-10-07T14:56:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11460#issuecomment-127917",
    "user": "jdemeyer"
}
```

Replying to [comment:2 jhpalmieri]:
> if you think that would be a good idea.

Yes, please do it.  The problem mentioned by hivert is reproducible with sage-4.7.2.alpha3 (note you need to delete the `devel/sage/doc/output` directory before testing).



---

archive/issue_comments_127918.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-10-07T14:56:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11460#issuecomment-127918",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_127919.json:
```json
{
    "body": "Okay, here's the new version.",
    "created_at": "2011-10-07T17:16:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11460#issuecomment-127919",
    "user": "jhpalmieri"
}
```

Okay, here's the new version.



---

archive/issue_comments_127920.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-10-07T17:16:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11460#issuecomment-127920",
    "user": "jhpalmieri"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_127921.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-10-08T09:38:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11460#issuecomment-127921",
    "user": "jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_127922.json:
```json
{
    "body": "Attachment [trac_11632-thematic-conf.v2.patch](tarball://root/attachments/some-uuid/ticket11632/trac_11632-thematic-conf.v2.patch) by jdemeyer created at 2011-10-08 09:38:48",
    "created_at": "2011-10-08T09:38:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11460",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11460#issuecomment-127922",
    "user": "jdemeyer"
}
```

Attachment [trac_11632-thematic-conf.v2.patch](tarball://root/attachments/some-uuid/ticket11632/trac_11632-thematic-conf.v2.patch) by jdemeyer created at 2011-10-08 09:38:48
