# Issue 13529: Incorrect integral in Maxima

Issue created by migration from https://trac.sagemath.org/ticket/13733

Original creator: kcrisman

Original creation time: 2012-11-20 22:05:40

Assignee: burcin

See [this ask.sagemath.org question](http://ask.sagemath.org/question/1995/mistake-in-a-indefinite-integral).


```
sage: integral(log(cot(x)-1),x,0,pi/4)

ValueError: Integral is divergent.
```

But according to the poster it is pi log(2) / 8.  And indeed in the most recent Maxima (5.28) we have

```
(%i5) display2d:false;

(%o5) false
(%i6) integrate(log(cot(x)-1),x,0,%pi/4);

Is %pi/8 an ?integer?

n;
Is %pi/4 an ?integer?

n;
Is 2*%pi an ?integer?

n;
(%o6) -(%i*(2*li[2](%i+1)-2*li[2](1-%i))+%pi*log(2))/4
 +%i*li[2]((%i+1)/2)/2-%i*li[2](-(%i-1)/2)/2
```

though with the interaction this is not an improvement we can immediately use.


---

Comment by kcrisman created at 2012-12-27 03:24:14

According to [the upstream report](http://sourceforge.net/p/maxima/bugs/2501/), that problem is also fixed [here](http://maxima.git.sourceforge.net/git/gitweb.cgi?p=maxima/maxima;a=blobdiff;f=src/compar.lisp;h=15761dc5a29a6234f50181200821b84e28df40a4;hp=e9b2ec39d06886744a13901a65925d61dae18191;hb=1780660150446a1efe4ad149f0d23da6fdddd21f;hpb=8ad7e4288e11a9b1bbac31c811f91bf69f76b42f) and there is also a commit of the integral in question as a test.

```
expand(integrate(log(cot(x)-1),x,0,%pi/4));
-%i*li[2](%i+1)/2+%i*li[2](%i/2+1/2)/2-%i*li[2](1/2-%i/2)/2+%i*li[2](1-%i)/2-%pi*log(2)/4$
```

So I guess when the next Maxima after 5.29.1 is ready and we put it in, we can try to close this report with a doctest.


---

Comment by kcrisman created at 2013-01-20 01:40:07

See #13973 for where we might fix this.


---

Comment by pbruin created at 2014-05-16 16:05:56

Maxima 5.33 returns the answer without asking any questions.


---

Comment by kcrisman created at 2014-05-16 17:18:00

Great, then all that's needed is a doctest once #13973 is ready.
> Maxima 5.33 returns the answer without asking any questions.


---

Comment by pbruin created at 2014-05-23 17:29:53

Unfortunately the fact that Sage loads the `abs_integrate` package causes this to fail when called from within Sage with the message `PSLOG: internal error.`  So we still have to look into that.


---

Comment by kcrisman created at 2014-12-08 15:00:22

See also #12731.


---

Comment by rws created at 2015-03-07 15:43:20

Replying to [comment:6 pbruin]:
> Maxima 5.33 returns the answer without asking any questions.
Maybe but 5.35 is back to original (`PSLOG: internal error`).


---

Comment by rws created at 2015-03-07 15:46:28

Replying to [comment:8 pbruin]:
> Unfortunately the fact that Sage loads the `abs_integrate` package causes this to fail when called from within Sage with the message `PSLOG: internal error.`  So we still have to look into that.
Maybe but Sage+Maxima-5.35 without `abs_integrate` gives `-1/4*pi*log(2) - 1/2*I*polylog(2, I + 1) + 1/2*I*polylog(2, -I + 1) + 1/2*I*polylog(2, 1/2*I + 1/2) - 1/2*I*polylog(2, -1/2*I + 1/2)` so this is not resolved either way.


---

Comment by pbruin created at 2017-02-03 12:18:07

In SageMath 7.6.beta2, the answer appears to be correct up to simplification (probably thanks to Maxima commit `ce7c53f1`):

```
sage: integral(log(cot(x)-1),x,0,pi/4)
-1/4*pi*log(2) - 1/2*I*dilog(I + 1) + 1/2*I*dilog(-I + 1) + 1/2*I*dilog(1/2*I + 1/2) - 1/2*I*dilog(-1/2*I + 1/2)
sage: N(_)
0.272198261287950
sage: N(pi*log(2)/8)
0.272198261287950
```

Should we add this as a doctest and declare the bug to be fixed?


---

Comment by kcrisman created at 2017-02-03 13:51:45

I vote yes.


---

Comment by pbruin created at 2017-02-03 14:15:26

Changing status from new to needs_review.


---

Comment by pbruin created at 2017-02-03 14:50:31

Changing type from defect to task.


---

Comment by pbruin created at 2017-02-03 14:50:31

Changing priority from major to trivial.


---

Comment by rws created at 2017-02-04 07:59:53

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-02-05 12:34:14

Resolution: fixed


---

Comment by vbraun created at 2017-02-06 17:55:28

On one of the 32-bit buildbots:

```
sage -t --long src/sage/symbolic/integration/integral.py
6771**********************************************************************
6772File "src/sage/symbolic/integration/integral.py", line 771, in sage.symbolic.integration.integral.integrate
6773Failed example:
6774    N(a)  # long time
6775Expected:
6776    0.272198261287950
6777Got:
6778    0.272198261287950 + 5.55111512312578e-17*I
6779**********************************************************************
67801 item had failures:
6781   1 of 125 in sage.symbolic.integration.integral.integrate
6782    [168 tests, 1 failure, 16.86 s]
```



---

Comment by vbraun created at 2017-02-06 17:55:28

Changing status from closed to new.


---

Comment by vbraun created at 2017-02-06 17:55:28

Resolution changed from fixed to 


---

Comment by pbruin created at 2017-02-07 12:18:25

The doctest should now be more robust.


---

Comment by pbruin created at 2017-02-07 12:18:25

Changing status from new to needs_review.


---

Comment by chapoton created at 2017-05-15 19:55:25

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-05-21 10:08:03

Resolution: fixed


---

Comment by tmonteil created at 2020-08-14 10:15:59

Follow-up: a bug with this integral reappared in recent Maxima release, see #30063
