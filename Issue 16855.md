# Issue 16855: Quivers incorrectly assume labels are checked for equality of graphs

Issue created by migration from Trac.

Original creator: emassop

Original creation time: 2014-10-02 18:31:50

CC:  simonking

Over at ticket #17086 the hash of `GenericGraph` was fixed to agree with equality of `GenericGraph`. This caused doctest failure in `src/sage/quivers/path_semigroup.py`.

Equality of un-'weighted' `GenericGraph` ignores edge labels, which seems nonsensical to me for `/path_semigroup`. So each digraph used for path semigroups should be 'weighted'. Running `git grep path_semigroup` shows that this is certainly not done.

I see these options:
* change lots of code to make the appropriate digraphs weighted;
* change equality of graphs to take edge labels into account, possibly breaking other code;
* change `PathSemigroup` to check for weightedness, and perhaps set 'weighted' in `.path_semigroup`.


---

Comment by SimonKing created at 2014-10-02 18:53:20

Is the stuff in `src/sage/quivers` not merged yet? So, why can #17086 be positively reviewed in spite of these doctest failures?

Indeed, edge labels are essential for `path_semigroup`. However, as much as I know, edge labels are not essential in many other parts of Sage. Hence, I agree that it is `PathSemigroup`'s duty to assert weightedness of its input.


---

Comment by SimonKing created at 2014-10-02 18:57:24

Let us assume that a non-weighted looped multi-digraph `G` is given, and we want to construct the associated `PathSemigroup`. It is a unique representation, but if I recall correctly there is a `__classcall__` method, replacing the input by an immutable copy, if needed. The immutable copy is used for caching.

The obvious change is: `__classcall__` should replace the input by an immutable _weighted_ copy, and use it for caching. I think this would break no existing code related with path semigroups.


---

Comment by emassop created at 2014-10-02 21:33:55

Like this?

Note that `G.path_semigroup().quiver() == G` is no longer always true. This breaks code that compares graphs from the path semigroups with the graphs that they were created with.


---

Comment by SimonKing created at 2014-10-02 22:06:02

Replying to [comment:4 emassop]:
> Like this?

Yes! That's what I thought should be done.

> Note that `G.path_semigroup().quiver() == G` is no longer always true. This breaks code that compares graphs from the path semigroups with the graphs that they were created with.

I wouldn't mind. What I find important: If `S` is a path semigroup, then `S` is identic with `PathSemigroup(S.quiver())`. And this does hold with your code.


---

Comment by ncohen created at 2014-10-03 09:11:56

> Is the stuff in `src/sage/quivers` not merged yet? So, why can #17086 be positively reviewed in spite of these doctest failures?

I set it back to `needs_work`.


---

Comment by git created at 2014-10-03 12:15:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-10-03 12:38:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by emassop created at 2014-10-03 13:00:42

Changing status from new to needs_review.


---

Comment by ncohen created at 2014-10-04 20:51:42

Welllllll, I see nothing wrong with any of that `:-)`

Nathann


---

Comment by ncohen created at 2014-10-04 20:51:42

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-10-05 22:39:06

Resolution: fixed
