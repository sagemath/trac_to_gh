# Issue 16855: Quivers incorrectly assume labels are checked for equality of graphs

archive/issues_016855.json:
```json
{
    "body": "CC:  simonking\n\nOver at ticket #17086 the hash of `GenericGraph` was fixed to agree with equality of `GenericGraph`. This caused doctest failure in `src/sage/quivers/path_semigroup.py`.\n\nEquality of un-'weighted' `GenericGraph` ignores edge labels, which seems nonsensical to me for `/path_semigroup`. So each digraph used for path semigroups should be 'weighted'. Running `git grep path_semigroup` shows that this is certainly not done.\n\nI see these options:\n* change lots of code to make the appropriate digraphs weighted;\n* change equality of graphs to take edge labels into account, possibly breaking other code;\n* change `PathSemigroup` to check for weightedness, and perhaps set 'weighted' in `.path_semigroup`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/17092\n\n",
    "created_at": "2014-10-02T18:31:50Z",
    "labels": [
        "graph theory",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Quivers incorrectly assume labels are checked for equality of graphs",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16855",
    "user": "emassop"
}
```
CC:  simonking

Over at ticket #17086 the hash of `GenericGraph` was fixed to agree with equality of `GenericGraph`. This caused doctest failure in `src/sage/quivers/path_semigroup.py`.

Equality of un-'weighted' `GenericGraph` ignores edge labels, which seems nonsensical to me for `/path_semigroup`. So each digraph used for path semigroups should be 'weighted'. Running `git grep path_semigroup` shows that this is certainly not done.

I see these options:
* change lots of code to make the appropriate digraphs weighted;
* change equality of graphs to take edge labels into account, possibly breaking other code;
* change `PathSemigroup` to check for weightedness, and perhaps set 'weighted' in `.path_semigroup`.

Issue created by migration from https://trac.sagemath.org/ticket/17092





---

archive/issue_comments_223133.json:
```json
{
    "body": "Is the stuff in `src/sage/quivers` not merged yet? So, why can #17086 be positively reviewed in spite of these doctest failures?\n\nIndeed, edge labels are essential for `path_semigroup`. However, as much as I know, edge labels are not essential in many other parts of Sage. Hence, I agree that it is `PathSemigroup`'s duty to assert weightedness of its input.",
    "created_at": "2014-10-02T18:53:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16855#issuecomment-223133",
    "user": "SimonKing"
}
```

Is the stuff in `src/sage/quivers` not merged yet? So, why can #17086 be positively reviewed in spite of these doctest failures?

Indeed, edge labels are essential for `path_semigroup`. However, as much as I know, edge labels are not essential in many other parts of Sage. Hence, I agree that it is `PathSemigroup`'s duty to assert weightedness of its input.



---

archive/issue_comments_223134.json:
```json
{
    "body": "Let us assume that a non-weighted looped multi-digraph `G` is given, and we want to construct the associated `PathSemigroup`. It is a unique representation, but if I recall correctly there is a `__classcall__` method, replacing the input by an immutable copy, if needed. The immutable copy is used for caching.\n\nThe obvious change is: `__classcall__` should replace the input by an immutable *weighted* copy, and use it for caching. I think this would break no existing code related with path semigroups.",
    "created_at": "2014-10-02T18:57:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16855#issuecomment-223134",
    "user": "SimonKing"
}
```

Let us assume that a non-weighted looped multi-digraph `G` is given, and we want to construct the associated `PathSemigroup`. It is a unique representation, but if I recall correctly there is a `__classcall__` method, replacing the input by an immutable copy, if needed. The immutable copy is used for caching.

The obvious change is: `__classcall__` should replace the input by an immutable *weighted* copy, and use it for caching. I think this would break no existing code related with path semigroups.



---

archive/issue_comments_223135.json:
```json
{
    "body": "Like this?\n\nNote that `G.path_semigroup().quiver() == G` is no longer always true. This breaks code that compares graphs from the path semigroups with the graphs that they were created with.",
    "created_at": "2014-10-02T21:33:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16855#issuecomment-223135",
    "user": "emassop"
}
```

Like this?

Note that `G.path_semigroup().quiver() == G` is no longer always true. This breaks code that compares graphs from the path semigroups with the graphs that they were created with.



---

archive/issue_comments_223136.json:
```json
{
    "body": "Replying to [comment:4 emassop]:\n> Like this?\n\nYes! That's what I thought should be done.\n\n> Note that `G.path_semigroup().quiver() == G` is no longer always true. This breaks code that compares graphs from the path semigroups with the graphs that they were created with.\n\nI wouldn't mind. What I find important: If `S` is a path semigroup, then `S` is identic with `PathSemigroup(S.quiver())`. And this does hold with your code.",
    "created_at": "2014-10-02T22:06:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16855#issuecomment-223136",
    "user": "SimonKing"
}
```

Replying to [comment:4 emassop]:
> Like this?

Yes! That's what I thought should be done.

> Note that `G.path_semigroup().quiver() == G` is no longer always true. This breaks code that compares graphs from the path semigroups with the graphs that they were created with.

I wouldn't mind. What I find important: If `S` is a path semigroup, then `S` is identic with `PathSemigroup(S.quiver())`. And this does hold with your code.



---

archive/issue_comments_223137.json:
```json
{
    "body": "> Is the stuff in `src/sage/quivers` not merged yet? So, why can #17086 be positively reviewed in spite of these doctest failures?\n\nI set it back to `needs_work`.",
    "created_at": "2014-10-03T09:11:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16855#issuecomment-223137",
    "user": "ncohen"
}
```

> Is the stuff in `src/sage/quivers` not merged yet? So, why can #17086 be positively reviewed in spite of these doctest failures?

I set it back to `needs_work`.



---

archive/issue_comments_223138.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-03T12:15:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16855#issuecomment-223138",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_223139.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-03T12:38:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16855#issuecomment-223139",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_223140.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-10-03T13:00:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16855#issuecomment-223140",
    "user": "emassop"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_223141.json:
```json
{
    "body": "Welllllll, I see nothing wrong with any of that `:-)`\n\nNathann",
    "created_at": "2014-10-04T20:51:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16855#issuecomment-223141",
    "user": "ncohen"
}
```

Welllllll, I see nothing wrong with any of that `:-)`

Nathann



---

archive/issue_comments_223142.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-10-04T20:51:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16855#issuecomment-223142",
    "user": "ncohen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_223143.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-10-05T22:39:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16855#issuecomment-223143",
    "user": "vbraun"
}
```

Resolution: fixed
