# Issue 18193: Bug in is_hyperbolic

Issue created by migration from https://trac.sagemath.org/ticket/18430

Original creator: pkoprowski

Original creation time: 2015-05-16 19:03:59

The method is_hyperbolic in the class of quadratic form returns incorrect results over the field QQ_2. Here is an explicit example:

```python
q = DiagonalQuadraticForm(QQ, [1,1,-1,-1])
print q.is_hyperbolic(2)
```

The form <1,1,-1,-1> is clearly hyperbolic - by definition. It is a sum of two hyperbolic planes. Nevertheless Sage returns `False` here.

The reason is as follows. In the file `quadratic_forms/quadratic_form__local_field_invariants.py` in function `is_hyperbolic` the actual code is

```python
    elif p == 2:
        return QQ(self.det() * (-1)**m).is_padic_square(p) and (self.hasse_invariant(p) == (-1)**m)    ## Actually, this -1 is the Hilbert symbol (-1,-1)_p
```

while it should be

```python
    elif p == 2:
        return QQ(self.det() * (-1)**m).is_padic_square(p) and (self.hasse_invariant(p) == (-1)**(m*(m-1)/2))    ## Actually, this -1 is the Hilbert symbol (-1,-1)_p
```

For mathematical explanation see e.g. T.Y. Lam "Introduction to Quadratic Forms over Field", Proposition V.3.25

I'm not sure how to formally patch the code, so I'm posting it this way.



---

Comment by MRupert created at 2015-05-25 21:44:37

Changing status from new to needs_review.


---

Comment by MRupert created at 2015-05-25 21:44:37

This commit should fix the problem. I also added functionality and improved the documentation on the infinite place.
----
New commits:


---

Comment by jdemeyer created at 2015-06-09 17:01:21

Can you replace

```
if p == "infinity":
    return self.is_definite()
else:
    ...
```

by

```
if p == Infinity:
    return self.is_definite()

...
```

This means you don't need to indent the whole block for `p` a prime number and I also prefer the actual value `Infinity` (which needs to be imported from `sage.rings.infinity`) instead of the string `"infinity"`.

I also don't understand why you use `-1` at one point and `"infinity"` somewhere else.

And instead of writing

```
(-1)**(m*(m-1)/2)) ## Actually, this -1 is the Hilbert symbol (-1,-1)
```

why don't you actually write

```
hilbert_symbol(-1, -1, p)**(m*(m-1)/2))
```



---

Comment by jdemeyer created at 2015-06-10 20:18:37

Changing status from needs_review to needs_work.


---

Comment by chapoton created at 2016-08-28 08:21:28

rebase and clean-up
----
New commits:


---

Comment by chapoton created at 2016-08-28 08:23:00

Changing status from needs_work to needs_review.


---

Comment by git created at 2017-04-03 20:41:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2017-04-03 21:39:25

Replying to [comment:3 jdemeyer]:
> I also don't understand why you use `-1` at one point and `"infinity"` somewhere else.
> 
> And instead of writing
> {{{
> (-1)**(m*(m-1)/2)) ## Actually, this -1 is the Hilbert symbol (-1,-1)
> }}}
> why don't you actually write
> {{{
> hilbert_symbol(-1, -1, p)**(m*(m-1)/2))
> }}}

I am pretty sure the former is (much) faster and the comment makes the simplification clear.


---

Comment by git created at 2017-04-04 19:03:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2017-04-04 19:03:55

done


---

Comment by chapoton created at 2017-06-02 06:12:03

ping ?


---

Comment by tscrim created at 2017-06-03 00:36:54

If you just fix up this `INPUT:` docstring (in a few places):

```diff
-`p` -- a prime number > 0 or `-1` for the infinite place.
+- `p` -- a prime number > 0 or `-1` for the infinite place
```

Once that is done, you can set a positive review on my behalf.


---

Comment by pmercuri created at 2017-06-05 21:43:57

Changing status from needs_review to needs_work.


---

Comment by git created at 2017-06-07 12:26:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2017-06-07 12:26:47

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2017-06-07 13:04:44

LGTM.


---

Comment by tscrim created at 2017-06-07 13:04:44

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-06-09 18:38:01

Resolution: fixed
