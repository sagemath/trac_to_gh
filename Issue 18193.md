# Issue 18193: Bug in is_hyperbolic

archive/issues_018193.json:
```json
{
    "body": "The method is_hyperbolic in the class of quadratic form returns incorrect results over the field QQ_2. Here is an explicit example:\n\n```python\nq = DiagonalQuadraticForm(QQ, [1,1,-1,-1])\nprint q.is_hyperbolic(2)\n```\n\nThe form <1,1,-1,-1> is clearly hyperbolic - by definition. It is a sum of two hyperbolic planes. Nevertheless Sage returns `False` here.\n\nThe reason is as follows. In the file `quadratic_forms/quadratic_form__local_field_invariants.py` in function `is_hyperbolic` the actual code is\n\n```python\n    elif p == 2:\n        return QQ(self.det() * (-1)**m).is_padic_square(p) and (self.hasse_invariant(p) == (-1)**m)    ## Actually, this -1 is the Hilbert symbol (-1,-1)_p\n```\n\nwhile it should be\n\n```python\n    elif p == 2:\n        return QQ(self.det() * (-1)**m).is_padic_square(p) and (self.hasse_invariant(p) == (-1)**(m*(m-1)/2))    ## Actually, this -1 is the Hilbert symbol (-1,-1)_p\n```\n\nFor mathematical explanation see e.g. T.Y. Lam \"Introduction to Quadratic Forms over Field\", Proposition V.3.25\n\nI'm not sure how to formally patch the code, so I'm posting it this way.\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/18430\n\n",
    "created_at": "2015-05-16T19:03:59Z",
    "labels": [
        "component: quadratic forms",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "Bug in is_hyperbolic",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18193",
    "user": "https://trac.sagemath.org/admin/accounts/users/pkoprowski"
}
```
The method is_hyperbolic in the class of quadratic form returns incorrect results over the field QQ_2. Here is an explicit example:

```python
q = DiagonalQuadraticForm(QQ, [1,1,-1,-1])
print q.is_hyperbolic(2)
```

The form <1,1,-1,-1> is clearly hyperbolic - by definition. It is a sum of two hyperbolic planes. Nevertheless Sage returns `False` here.

The reason is as follows. In the file `quadratic_forms/quadratic_form__local_field_invariants.py` in function `is_hyperbolic` the actual code is

```python
    elif p == 2:
        return QQ(self.det() * (-1)**m).is_padic_square(p) and (self.hasse_invariant(p) == (-1)**m)    ## Actually, this -1 is the Hilbert symbol (-1,-1)_p
```

while it should be

```python
    elif p == 2:
        return QQ(self.det() * (-1)**m).is_padic_square(p) and (self.hasse_invariant(p) == (-1)**(m*(m-1)/2))    ## Actually, this -1 is the Hilbert symbol (-1,-1)_p
```

For mathematical explanation see e.g. T.Y. Lam "Introduction to Quadratic Forms over Field", Proposition V.3.25

I'm not sure how to formally patch the code, so I'm posting it this way.


Issue created by migration from https://trac.sagemath.org/ticket/18430





---

archive/issue_comments_245210.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-05-25T21:44:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18193",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18193#issuecomment-245210",
    "user": "https://trac.sagemath.org/admin/accounts/users/MRupert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_245211.json:
```json
{
    "body": "This commit should fix the problem. I also added functionality and improved the documentation on the infinite place.\n----\nNew commits:",
    "created_at": "2015-05-25T21:44:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18193",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18193#issuecomment-245211",
    "user": "https://trac.sagemath.org/admin/accounts/users/MRupert"
}
```

This commit should fix the problem. I also added functionality and improved the documentation on the infinite place.
----
New commits:



---

archive/issue_comments_245212.json:
```json
{
    "body": "Can you replace\n\n```\nif p == \"infinity\":\n    return self.is_definite()\nelse:\n    ...\n```\n\nby\n\n```\nif p == Infinity:\n    return self.is_definite()\n\n...\n```\n\nThis means you don't need to indent the whole block for `p` a prime number and I also prefer the actual value `Infinity` (which needs to be imported from `sage.rings.infinity`) instead of the string `\"infinity\"`.\n\nI also don't understand why you use `-1` at one point and `\"infinity\"` somewhere else.\n\nAnd instead of writing\n\n```\n(-1)**(m*(m-1)/2)) ## Actually, this -1 is the Hilbert symbol (-1,-1)\n```\n\nwhy don't you actually write\n\n```\nhilbert_symbol(-1, -1, p)**(m*(m-1)/2))\n```\n",
    "created_at": "2015-06-09T17:01:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18193",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18193#issuecomment-245212",
    "user": "https://github.com/jdemeyer"
}
```

Can you replace

```
if p == "infinity":
    return self.is_definite()
else:
    ...
```

by

```
if p == Infinity:
    return self.is_definite()

...
```

This means you don't need to indent the whole block for `p` a prime number and I also prefer the actual value `Infinity` (which needs to be imported from `sage.rings.infinity`) instead of the string `"infinity"`.

I also don't understand why you use `-1` at one point and `"infinity"` somewhere else.

And instead of writing

```
(-1)**(m*(m-1)/2)) ## Actually, this -1 is the Hilbert symbol (-1,-1)
```

why don't you actually write

```
hilbert_symbol(-1, -1, p)**(m*(m-1)/2))
```




---

archive/issue_comments_245213.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-06-10T20:18:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18193",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18193#issuecomment-245213",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_245214.json:
```json
{
    "body": "rebase and clean-up\n----\nNew commits:",
    "created_at": "2016-08-28T08:21:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18193",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18193#issuecomment-245214",
    "user": "https://github.com/fchapoton"
}
```

rebase and clean-up
----
New commits:



---

archive/issue_comments_245215.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-08-28T08:23:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18193",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18193#issuecomment-245215",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_245216.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-04-03T20:41:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18193",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18193#issuecomment-245216",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_245217.json:
```json
{
    "body": "Replying to [comment:3 jdemeyer]:\n> I also don't understand why you use `-1` at one point and `\"infinity\"` somewhere else.\n> \n> And instead of writing\n> {{{\n> (-1)**(m*(m-1)/2)) ## Actually, this -1 is the Hilbert symbol (-1,-1)\n> }}}\n> why don't you actually write\n> {{{\n> hilbert_symbol(-1, -1, p)**(m*(m-1)/2))\n> }}}\n\nI am pretty sure the former is (much) faster and the comment makes the simplification clear.",
    "created_at": "2017-04-03T21:39:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18193",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18193#issuecomment-245217",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:3 jdemeyer]:
> I also don't understand why you use `-1` at one point and `"infinity"` somewhere else.
> 
> And instead of writing
> {{{
> (-1)**(m*(m-1)/2)) ## Actually, this -1 is the Hilbert symbol (-1,-1)
> }}}
> why don't you actually write
> {{{
> hilbert_symbol(-1, -1, p)**(m*(m-1)/2))
> }}}

I am pretty sure the former is (much) faster and the comment makes the simplification clear.



---

archive/issue_comments_245218.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-04-04T19:03:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18193",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18193#issuecomment-245218",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_245219.json:
```json
{
    "body": "done",
    "created_at": "2017-04-04T19:03:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18193",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18193#issuecomment-245219",
    "user": "https://github.com/fchapoton"
}
```

done



---

archive/issue_comments_245220.json:
```json
{
    "body": "ping ?",
    "created_at": "2017-06-02T06:12:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18193",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18193#issuecomment-245220",
    "user": "https://github.com/fchapoton"
}
```

ping ?



---

archive/issue_comments_245221.json:
```json
{
    "body": "If you just fix up this `INPUT:` docstring (in a few places):\n\n```diff\n-`p` -- a prime number > 0 or `-1` for the infinite place.\n+- `p` -- a prime number > 0 or `-1` for the infinite place\n```\n\nOnce that is done, you can set a positive review on my behalf.",
    "created_at": "2017-06-03T00:36:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18193",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18193#issuecomment-245221",
    "user": "https://github.com/tscrim"
}
```

If you just fix up this `INPUT:` docstring (in a few places):

```diff
-`p` -- a prime number > 0 or `-1` for the infinite place.
+- `p` -- a prime number > 0 or `-1` for the infinite place
```

Once that is done, you can set a positive review on my behalf.



---

archive/issue_comments_245222.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-06-05T21:43:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18193",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18193#issuecomment-245222",
    "user": "https://trac.sagemath.org/admin/accounts/users/pmercuri"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_245223.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-06-07T12:26:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18193",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18193#issuecomment-245223",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_245224.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-06-07T12:26:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18193",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18193#issuecomment-245224",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_245225.json:
```json
{
    "body": "LGTM.",
    "created_at": "2017-06-07T13:04:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18193",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18193#issuecomment-245225",
    "user": "https://github.com/tscrim"
}
```

LGTM.



---

archive/issue_comments_245226.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-06-07T13:04:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18193",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18193#issuecomment-245226",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_017434.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2017-06-09T18:38:01Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18193",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18193#event-17434"
}
```



---

archive/issue_comments_245227.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-06-09T18:38:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18193",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18193#issuecomment-245227",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
