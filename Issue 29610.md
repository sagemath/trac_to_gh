# Issue 29610: Install sage_setup with pip

Issue created by migration from https://trac.sagemath.org/ticket/29847

Original creator: mkoeppe

Original creation time: 2020-06-11 02:46:32

CC:  fbissey jhpalmieri dimpase

sage_setup will be used by the build system of various distutils packages (#29705).

So we make it a regular distutils package itself and install it with pip.


---

Comment by mkoeppe created at 2020-06-14 05:33:28

Last 10 new commits:


---

Comment by git created at 2020-06-14 05:34:06

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2020-06-21 02:29:01


```
[sagelib-9.1.rc5] running build
[sagelib-9.1.rc5] Generating auto-generated sources
[sagelib-9.1.rc5] Building interpreters for fast_callable
[sagelib-9.1.rc5] -> Rebuilding interpreters because /Users/mkoeppe/s/sage/sage-rebasing/src/sage_setup/autogen/interpreters/memory.py changed
[sagelib-9.1.rc5] running build_cython
[sagelib-9.1.rc5] Enabling Cython debugging support
[sagelib-9.1.rc5] Updating Cython code....
[sagelib-9.1.rc5] Compiling sage/algebras/finite_dimensional_algebras/finite_dimensional_algebra_element.pyx because it changed.
[sagelib-9.1.rc5] error: [Errno 21] Is a directory: '/Users/mkoeppe/s/sage/sage-rebasing/src/sage/cpython'
```


Hm....


---

Comment by git created at 2020-06-21 02:29:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-06-24 01:39:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-06-24 01:44:00

Replying to [comment:24 mkoeppe]:
> {{{
> [sagelib-9.1.rc5] error: [Errno 21] Is a directory: '/Users/mkoeppe/s/sage/sage-rebasing/src/sage/cpython'
> }}}
> 
> Hm....

That was coming from the mistake in #29855.


---

Comment by git created at 2020-06-24 02:31:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-06-24 04:32:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-06-24 04:34:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-06-25 19:15:33

Changing status from new to needs_review.


---

Comment by git created at 2020-06-27 19:21:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-06-28 01:47:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-06-28 02:03:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-06-28 04:27:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-06-28 04:34:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2020-07-08 10:57:17

should we wait for  #29855, #30011 merged?


---

Comment by git created at 2020-07-08 15:18:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-07-08 15:19:36

This ticket is not so urgent (I've set its milestone to 9.3)


---

Comment by mkoeppe created at 2020-07-13 21:33:01

Changing status from needs_review to needs_work.


---

Comment by git created at 2020-09-08 23:24:39

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by mkoeppe created at 2020-09-08 23:24:52

Changing status from needs_work to needs_review.


---

Comment by git created at 2020-09-08 23:27:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-09-09 00:39:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-12-06 18:17:38

Changing keywords from "" to "sd111".


---

Comment by mkoeppe created at 2020-12-06 18:17:38

Hoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111


---

Comment by @kliem created at 2020-12-09 18:58:03

Needs rebase.


---

Comment by @kliem created at 2020-12-09 18:58:03

Changing status from needs_review to needs_work.


---

Comment by git created at 2021-06-25 00:58:57

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by git created at 2021-06-25 01:02:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-06-25 01:14:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-06-25 02:26:51

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2021-06-25 02:28:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-06-25 04:09:58

Changing status from needs_work to needs_review.


---

Comment by git created at 2021-06-25 04:43:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2021-06-29 15:25:09

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2021-06-29 15:25:09

ok, fine


---

Comment by mkoeppe created at 2021-06-29 15:48:32

Thanks!


---

Comment by git created at 2021-07-01 22:07:57

Changing status from positive_review to needs_review.


---

Comment by git created at 2021-07-01 22:07:57

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by mkoeppe created at 2021-07-01 22:08:28

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2021-07-08 21:14:30


```
***********************************************
make[1]: Entering directory '/home/release/Sage/build/make'
make --no-print-directory sagelib-SAGE_VENV-no-deps
cd '/home/release/Sage/build/pkgs/sagelib' && . '/home/release/Sage/src/bin/sage-src-env-config' && . '/home/release/Sage/src/bin/sage-env-config' && . '/home/release/Sage/src/bin/sage-env' && . '/home/release/Sage/build/bin/sage-build-env-config' && . '/home/release/Sage/build/bin/sage-build-env' && SAGE_SPKG_WHEELS=/home/release/Sage/local/var/lib/sage/wheels SAGE_INST_LOCAL=/home/release/Sage/local sage-logger -p '/home/release/Sage/build/pkgs/sagelib/spkg-install' '/home/release/Sage/logs/pkgs/sagelib-9.4.beta4.log'
[sagelib-9.4.beta4] Traceback (most recent call last):
[sagelib-9.4.beta4]   File "/home/release/Sage/pkgs/sagemath-standard/setup.py", line 31, in <module>
[sagelib-9.4.beta4]     from sage_setup.excepthook import excepthook
[sagelib-9.4.beta4] ModuleNotFoundError: No module named 'sage_setup.excepthook'
[sagelib-9.4.beta4] 
[sagelib-9.4.beta4] real	0m0.140s
[sagelib-9.4.beta4] user	0m0.121s
[sagelib-9.4.beta4] sys	0m0.017s
make[2]: *** [Makefile:2693: sagelib-SAGE_VENV-no-deps] Error 1
make[1]: *** [Makefile:2693: /home/release/Sage/local/var/lib/sage/installed/sagelib-9.4.beta4] Error 2
make[1]: Leaving directory '/home/release/Sage/build/make'

real	0m0.257s
user	0m0.222s
sys	0m0.037s
***************************************************************
Error building Sage.

```



---

Comment by vbraun created at 2021-07-08 21:14:30

Changing status from positive_review to needs_work.


---

Comment by git created at 2021-07-19 01:25:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-07-19 02:10:38

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2021-07-19 02:10:38

I can't reproduce this error. Possibly from forgetting to run `bootstrap` and `configure`.


---

Comment by jhpalmieri created at 2021-07-21 00:09:29

I don't know if this is worth a ticket or if there is a relevant one already, but running `./bootstrap` produces various warnings:

```
m4/sage_spkg_configures.m4:513: warning: The macro `AC_PROG_CC_C99' is obsolete.
m4/sage_spkg_configures.m4:516: warning: The macro `AC_FOREACH' is obsolete.
m4/sage_spkg_configures.m4:516: warning: The macro `AC_FOREACH' is obsolete.
m4/sage_spkg_configures.m4:530: warning: The macro `AC_FOREACH' is obsolete.
m4/sage_spkg_configures.m4:594: warning: The macro `AC_TRY_RUN' is obsolete.
m4/sage_spkg_configures.m4:594: warning: The macro `AC_TRY_LINK' is obsolete.
configure.ac:447: warning: back quotes and double quotes must not be escaped in: multiple installation records for $SPKG_NAME: m4_newline($(ls -l "$SAGE_SPKG_INST/$SPKG_NAME"-*)) m4_newline([only one should exist, so please delete some or all of these files and re-run \"$srcdir/configure\"])
```



---

Comment by jhpalmieri created at 2021-07-21 00:09:53

Replying to [comment:76 mkoeppe]:
> I can't reproduce this error. Possibly from forgetting to run `bootstrap` and `configure`.

In the meantime, are you waiting for more information from Volker, or should this go back to "positive review"?


---

Comment by mkoeppe created at 2021-07-21 00:13:16

Replying to [comment:77 jhpalmieri]:
> I don't know if this is worth a ticket or if there is a relevant one already, but running `./bootstrap` produces various warnings
I think this is #30668


---

Comment by mkoeppe created at 2021-07-21 00:14:26

Replying to [comment:78 jhpalmieri]:
> Replying to [comment:76 mkoeppe]:
> > I can't reproduce this error. Possibly from forgetting to run `bootstrap` and `configure`.
> 
> In the meantime, are you waiting for more information from Volker, or should this go back to "positive review"?

Let's do "positive review". Easier to run it just as part of Volker's integration tests.


---

Comment by dimpase created at 2021-07-21 13:15:02

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2021-07-23 22:05:39

Merge conflict


---

Comment by vbraun created at 2021-07-23 22:05:39

Changing status from positive_review to needs_work.


---

Comment by git created at 2021-07-24 01:39:30

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by mkoeppe created at 2021-07-24 01:40:23

Changing status from needs_work to positive_review.


---

Comment by git created at 2021-07-24 19:22:36

Changing status from positive_review to needs_review.


---

Comment by git created at 2021-07-24 19:22:36

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by mkoeppe created at 2021-07-24 19:23:43

The branch already contained a part of #32046 but the dependency was not recorded. Fully merged the latest version of #32046. I think we can defer this ticket to 9.5


---

Comment by git created at 2021-08-12 21:14:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-08-12 22:19:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-08-13 00:31:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhpalmieri created at 2021-08-16 23:26:40

I'm getting a lot of doctest failures:

```
sage -t --long --warn-long 100.8 --random-seed=0 src/sage_setup/autogen/interpreters/utils.py  # 15 doctests failed
sage -t --long --warn-long 100.8 --random-seed=0 src/sage_setup/find.py  # 38 doctests failed
sage -t --long --warn-long 100.8 --random-seed=0 src/sage_setup/autogen/interpreters/specs/rdf.py  # 11 doctests failed
sage -t --long --warn-long 100.8 --random-seed=0 src/sage_setup/optional_extension.py  # 12 doctests failed
sage -t --long --warn-long 100.8 --random-seed=0 src/sage_setup/autogen/interpreters/__init__.py  # 5 doctests failed
sage -t --long --warn-long 100.8 --random-seed=0 src/sage_setup/autogen/interpreters/generator.py  # 70 doctests failed
sage -t --long --warn-long 100.8 --random-seed=0 src/sage_setup/clean.py  # 13 doctests failed
sage -t --long --warn-long 100.8 --random-seed=0 src/sage_setup/autogen/interpreters/storage.py  # 97 doctests failed
sage -t --long --warn-long 100.8 --random-seed=0 src/sage_setup/autogen/interpreters/memory.py  # 57 doctests failed
sage -t --long --warn-long 100.8 --random-seed=0 src/sage_setup/autogen/interpreters/specs/cdf.py  # 9 doctests failed
sage -t --long --warn-long 100.8 --random-seed=0 src/sage_setup/autogen/interpreters/specs/cc.py  # 20 doctests failed
sage -t --long --warn-long 100.8 --random-seed=0 src/sage_setup/autogen/interpreters/specs/python.py  # 25 doctests failed
sage -t --long --warn-long 100.8 --random-seed=0 src/sage_setup/autogen/interpreters/instructions.py  # 39 doctests failed
sage -t --long --warn-long 100.8 --random-seed=0 src/sage_setup/autogen/interpreters/specs/rr.py  # 21 doctests failed
sage -t --long --warn-long 100.8 --random-seed=0 src/sage_setup/autogen/interpreters/specs/base.py  # 22 doctests failed
sage -t --long --warn-long 100.8 --random-seed=0 src/sage_setup/autogen/interpreters/specs/element.py  # 11 doctests failed
sage -t --long --warn-long 100.8 --random-seed=0 src/sage_setup/util.py  # 6 doctests failed
```

The directory `local/lib/python3.9/site-packages/sage_setup` doesn't have much in it anymore, and I'm guessing that this causes the problems.


---

Comment by mkoeppe created at 2021-09-03 22:34:05

Changing status from needs_review to needs_work.


---

Comment by git created at 2021-09-03 23:26:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-09-03 23:27:44

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2021-09-03 23:27:44

Thanks for catching this. When `configure --enable-editable` is not used, the "cleaner" erased `sage_setup`'s files at the end of the sagelib installation. Fixed now, tamed the cleaner.


---

Comment by dimpase created at 2021-09-07 17:46:56

seems to work for me (without `--enable-editable`).


---

Comment by dimpase created at 2021-09-07 17:46:56

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2021-09-07 18:18:35

Thank you!


---

Comment by vbraun created at 2021-09-13 22:22:32

Resolution: fixed
