# Issue 28140: polymake interface broken with "non-standard" quadratic fields

Issue created by migration from https://trac.sagemath.org/ticket/28377

Original creator: vdelecroix

Original creation time: 2019-08-21 17:13:00

CC:  mkoeppe slabbe simonking jipilab

The polymake interface is confused with Sage number fields that are not of the form `QQ[sqrt(D)]`. Here is a simple example

```
sage: x = polygen(QQ, 'x')
sage: K = NumberField(x^2 - x -1, 'a', embedding=(1-AA(5).sqrt())/2)
sage: a = K.gen()
sage: L = NumberField(x^2 - 5, 'b', embedding=AA(5).sqrt())
sage: b = L.gen()
sage: f = Hom(K, L)([(1-b)/2])
sage: Kverts = [(0,0,a),(1,a,2-a),(2*a,3,1),(2-a,5+2*a,3*a-7),(-3,2*a-1,-1),(1,a,a)]
sage: Lverts = [list(map(f, v)) for v in Kverts]
sage: Polyhedron(Kverts, base_ring=K, backend='polymake').f_vector()
(1, 6, 12, 8, 1)
sage: Polyhedron(Lverts, base_ring=L, backend='polymake').f_vector()
(1, 5, 9, 6, 1)
```

One can check that it is the second one which is correct

```
sage: Polyhedron(Kverts, base_ring=K, backend='field').f_vector()
(1, 5, 9, 6, 1)
sage: Polyhedron(Lverts, base_ring=L, backend='field').f_vector()
(1, 5, 9, 6, 1)
```



---

Comment by vdelecroix created at 2019-08-21 17:45:50

Je n'ai pas ajouté le bon Labbé! Désolé Sébastien pour le spam.


---

Comment by vdelecroix created at 2019-08-21 19:18:38

no comment on the previous implementation!!
----
New commits:


---

Comment by vdelecroix created at 2019-08-21 19:18:38

Changing status from new to needs_review.


---

Comment by git created at 2019-08-21 19:19:27

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jipilab created at 2019-08-22 10:29:07

Looks good to me. 

I am hesitating to put a test on one of the observed wrong f-vector, but if you confirm that this fixes the observed symptom on the f-vector, then I would say it is fine.


---

Comment by vdelecroix created at 2019-08-22 12:53:45

Replying to [comment:8 jipilab]:
> Looks good to me. 
> 
> I am hesitating to put a test on one of the observed wrong f-vector, but if you confirm that this fixes the observed symptom on the f-vector, then I would say it is fine.

This ticket has nothing to do with polytopes :-) If you feel safer having examples involving polytope I let you add one.


---

Comment by jipilab created at 2019-08-26 09:49:32

Changing status from needs_review to positive_review.


---

Comment by jipilab created at 2019-08-26 09:49:32

Replying to [comment:9 vdelecroix]:
> Replying to [comment:8 jipilab]:
> > Looks good to me. 
> > 
> > I am hesitating to put a test on one of the observed wrong f-vector, but if you confirm that this fixes the observed symptom on the f-vector, then I would say it is fine.
> 
> This ticket has nothing to do with polytopes :-) If you feel safer having examples involving polytope I let you add one.

After looking carefully at the branch, I saw what you meant. I got confused by the description of the ticket...

It's all good.


---

Comment by vbraun created at 2019-08-28 19:55:04

Resolution: fixed
