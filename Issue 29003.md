# Issue 29003: Upgrade pexpect to 4.8

Issue created by migration from https://trac.sagemath.org/ticket/29240

Original creator: arojas

Original creation time: 2020-02-23 22:02:30

CC:  fbissey @timokau jdemeyer slelievre saraedum mkoeppe




---

Comment by arojas created at 2020-02-23 22:07:49

Changing component from PLEASE CHANGE to packages: standard.


---

Comment by arojas created at 2020-02-23 22:07:49

New commits:


---

Comment by arojas created at 2020-02-23 22:07:49

Changing type from PLEASE CHANGE to enhancement.


---

Comment by arojas created at 2020-02-23 22:11:54

pexpect 4.8 crash log


---

Attachment

I'm getting a segfault on interfaces/singular.py caused by [2]. It is not reproducible in my distro package, only on sage-the-distro. Any ideas?

[2] https://github.com/pexpect/pexpect/commit/f98485ae7ddd2786f2d0fc6234d15f9f1e55caea


---

Comment by fbissey created at 2020-07-19 23:38:04

I have no ideas about your crash. Does it still happen on sage-the-distro in the current beta? I would quite happily move on on that one otherwise.


---

Comment by arojas created at 2020-07-22 08:54:07

Actually, this has just started crashing on my Arch package too recently. No idea which update triggered it.


---

Comment by fbissey created at 2020-07-22 09:02:15

I am not experiencing crash so far.


---

Comment by arojas created at 2020-07-24 07:22:17

Changing status from new to needs_review.


---

Comment by arojas created at 2020-07-24 07:22:17

And now I can't reproduce the crash on sage-the-distro, only on my Arch package... well this is weird.
I'll set this to needs_review to see if any of the build bots can reproduce the crash.


---

Comment by arojas created at 2020-07-24 11:16:09

Strangely, the Arch segfault seems caused by sympy 1.6.1 (which doesn't seem to be used in interfaces/singular.py at all)


---

Comment by mkoeppe created at 2020-07-26 18:16:33

Replying to [comment:10 arojas]:
> And now I can't reproduce the crash on sage-the-distro, only on my Arch package... well this is weird.
> I'll set this to needs_review to see if any of the build bots can reproduce the crash.

For broader coverage of platforms you could push a tag to GitHub so that the GH actions CI infrastructure is run on this ticket...


---

Comment by fbissey created at 2020-07-27 01:01:13

Replying to [comment:12 arojas]:
> Strangely, the Arch segfault seems caused by sympy 1.6.1 (which doesn't seem to be used in interfaces/singular.py at all)

This is in the weird territory, especially if you can reproduce it individually. We should definitely have a go at doing the github testing.


---

Comment by mkoeppe created at 2020-07-28 02:42:36

I also see segfaults on `archlinux-latest-standard` at https://github.com/mkoeppe/sage/runs/912558565 while testing #29766 - unrelated to this ticket.

```
sage -t --random-seed=0 src/doc/en/reference/sat/index.rst  # Killed due to segmentation fault
sage -t --random-seed=0 src/sage/crypto/mq/sr.py  # Killed due to abort
sage -t --random-seed=0 src/sage/interfaces/quit.py  # 1 doctest failed
sage -t --random-seed=0 src/sage/rings/polynomial/multi_polynomial_sequence.py  # Killed due to segmentation fault
sage -t --random-seed=0 src/sage/rings/polynomial/pbori.pyx  # Killed due to abort
sage -t --random-seed=0 src/sage/rings/polynomial/polynomial_ring_constructor.py  # Killed due to abort
sage -t --random-seed=0 src/sage/sat/boolean_polynomials.py  # Killed due to segmentation fault
sage -t --random-seed=0 src/sage/sat/solvers/dimacs.py  # Killed due to segmentation fault
```



---

Comment by arojas created at 2020-07-28 07:05:09

Replying to [comment:15 mkoeppe]:
> I also see segfaults on `archlinux-latest-standard` at https://github.com/mkoeppe/sage/runs/912558565 while testing #29766 - unrelated to this ticket.

Those crashes are on brial - I'm pretty sure they are caused by using system brial compiled with GCC 10 and running against sage's stdlib from GCC 9. brial is very sensitive to the GCC version it is compiled with - if system GCC is not being used, system brial shouldn't be used either.


---

Comment by fbissey created at 2020-07-28 07:40:13

I accept pull request for brial if there is anything you can pinpoint to.


---

Comment by arojas created at 2020-07-28 08:35:21

Replying to [comment:17 fbissey]:
> I accept pull request for brial if there is anything you can pinpoint to.

No idea what the actual issue is - I just know I need to rebuild it every time libstdc++ is updated to prevent crashes.


---

Comment by mkoeppe created at 2020-08-15 21:50:28

Changing status from needs_review to needs_work.


---

Comment by mkoeppe created at 2020-08-15 21:50:28

needs upstream_url


---

Comment by slelievre created at 2020-08-20 16:48:31

Changing keywords from "" to "upgrade, pexpect".


---

Comment by slelievre created at 2020-08-20 16:48:31

New commits:


---

Comment by slelievre created at 2020-08-20 16:48:56

Added upstream url and rebased on Sage 9.2.beta9.


---

Comment by slelievre created at 2020-08-20 17:02:51

I pushed a tag to my copy of the Sage repo on GitHub.

https://github.com/slel/sage/tree/ci-pexpect-29240


---

Comment by mkoeppe created at 2020-08-22 03:15:55

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2020-08-22 03:19:25

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2020-08-22 03:19:25

Looks OK.


---

Comment by vbraun created at 2020-08-26 21:17:45

Resolution: fixed


---

Comment by slelievre created at 2020-11-26 14:32:33

Follow-up at #30945.
