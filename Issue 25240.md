# Issue 25240: possibly improve the iterator for PermutationGroups

archive/issues_025240.json:
```json
{
    "body": "CC:  stumpc5 @tscrim @videlec @dimpase @rbeezer\n\nKeywords: PermutationGroup, days93.51, gap\n\nCurrently, the iterator looks like this. \n\n```\ndef __iter__(self):\n\n    from sage.sets.recursively_enumerated_set import RecursivelyEnumeratedSet\n    return iter(RecursivelyEnumeratedSet(seeds=[self.one()],\n                successors=lambda g: (g._mul_(h) for h in self.gens())))\n```\n\n\nPerhaps it would be faster to use a strong_generating_system to iterate through the group.\n\nIssue created by migration from https://trac.sagemath.org/ticket/25477\n\n",
    "created_at": "2018-05-31T09:17:00Z",
    "labels": [
        "component: group theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.4",
    "title": "possibly improve the iterator for PermutationGroups",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25240",
    "user": "https://github.com/mo271"
}
```
CC:  stumpc5 @tscrim @videlec @dimpase @rbeezer

Keywords: PermutationGroup, days93.51, gap

Currently, the iterator looks like this. 

```
def __iter__(self):

    from sage.sets.recursively_enumerated_set import RecursivelyEnumeratedSet
    return iter(RecursivelyEnumeratedSet(seeds=[self.one()],
                successors=lambda g: (g._mul_(h) for h in self.gens())))
```


Perhaps it would be faster to use a strong_generating_system to iterate through the group.

Issue created by migration from https://trac.sagemath.org/ticket/25477





---

archive/issue_comments_355174.json:
```json
{
    "body": "I added an alternative suggestion `__iter_alt__` in the patch. However, sometimes calculation the  strong_generating_system takes much longer than actually iterating with the standard iterator above. Here are some timing experiments:\n\n```\nsage: p = [(i,i+1) for i in range(1,601,2)]\nsage: q = [tuple(range(1+i,601,3)) for i in range(3)]\nsage: A = PermutationGroup([p,q])\nsage: A.cardinality()\n60000\nsage: time len(list(A))\nCPU times: user 441 ms, sys: 58 ms, total: 499 ms\nWall time: 478 ms\n60000\nsage: time len(list(A.__iter_alt__()))\nCPU times: user 3.39 s, sys: 690 ms, total: 4.08 s\nWall time: 4.1 s\n60000\nsage: P = PermutationGroup(SymmetricGroup(10).gens())\nsage: time len(list(P))\nCPU times: user 9.06 s, sys: 182 ms, total: 9.24 s\nWall time: 9.24 s\n3628800\nsage: time len(list(P.__iter_alt__()))\nCPU times: user 3.64 s, sys: 144 ms, total: 3.79 s\nWall time: 3.79 s\n3628800\n```\n\n\nAny suggestions? What are good other groups to do benchmarking?\n----\nNew commits:",
    "created_at": "2018-05-31T09:18:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355174",
    "user": "https://github.com/mo271"
}
```

I added an alternative suggestion `__iter_alt__` in the patch. However, sometimes calculation the  strong_generating_system takes much longer than actually iterating with the standard iterator above. Here are some timing experiments:

```
sage: p = [(i,i+1) for i in range(1,601,2)]
sage: q = [tuple(range(1+i,601,3)) for i in range(3)]
sage: A = PermutationGroup([p,q])
sage: A.cardinality()
60000
sage: time len(list(A))
CPU times: user 441 ms, sys: 58 ms, total: 499 ms
Wall time: 478 ms
60000
sage: time len(list(A.__iter_alt__()))
CPU times: user 3.39 s, sys: 690 ms, total: 4.08 s
Wall time: 4.1 s
60000
sage: P = PermutationGroup(SymmetricGroup(10).gens())
sage: time len(list(P))
CPU times: user 9.06 s, sys: 182 ms, total: 9.24 s
Wall time: 9.24 s
3628800
sage: time len(list(P.__iter_alt__()))
CPU times: user 3.64 s, sys: 144 ms, total: 3.79 s
Wall time: 3.79 s
3628800
```


Any suggestions? What are good other groups to do benchmarking?
----
New commits:



---

archive/issue_comments_355175.json:
```json
{
    "body": "More timings:\n\n```\nsage: P = CoxeterGroup([\"E\",7], implementation=\"permutation\")\nsage: time len(list(P.iteration(algorithm=\"depth\", tracking_words=False)))\nCPU times: user 4.55 s, sys: 525 ms, total: 5.07 s\nWall time: 5.14 s\n2903040\nsage: time len(list(P.__iter__()))\nCPU times: user 21.2 s, sys: 693 ms, total: 21.8 s\nWall time: 21.8 s\n2903040\nsage: time len(list(P.__iter_alt__()))\nCPU times: user 4.33 s, sys: 231 ms, total: 4.56 s\nWall time: 4.58 s\n2903040\n```\n",
    "created_at": "2018-05-31T13:56:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355175",
    "user": "https://github.com/mo271"
}
```

More timings:

```
sage: P = CoxeterGroup(["E",7], implementation="permutation")
sage: time len(list(P.iteration(algorithm="depth", tracking_words=False)))
CPU times: user 4.55 s, sys: 525 ms, total: 5.07 s
Wall time: 5.14 s
2903040
sage: time len(list(P.__iter__()))
CPU times: user 21.2 s, sys: 693 ms, total: 21.8 s
Wall time: 21.8 s
2903040
sage: time len(list(P.__iter_alt__()))
CPU times: user 4.33 s, sys: 231 ms, total: 4.56 s
Wall time: 4.58 s
2903040
```




---

archive/issue_comments_355176.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2018-05-31T14:06:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355176",
    "user": "https://github.com/tscrim"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_355177.json:
```json
{
    "body": "You can probably get some more speed by doing the initial step in the `__iter__` function and then do the remaining steps with `SGS` being explicitly given. It is probably faster to also do\n\n```sage\n            S = SGS.pop()\n            if not SGS:\n                for g in S:\n                    yield g\n            else:\n                for s in elements(self, SGS):\n                    for g in S:\n                        yield s._mul_(g)\n```\n",
    "created_at": "2018-05-31T14:06:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355177",
    "user": "https://github.com/tscrim"
}
```

You can probably get some more speed by doing the initial step in the `__iter__` function and then do the remaining steps with `SGS` being explicitly given. It is probably faster to also do

```sage
            S = SGS.pop()
            if not SGS:
                for g in S:
                    yield g
            else:
                for s in elements(self, SGS):
                    for g in S:
                        yield s._mul_(g)
```




---

archive/issue_comments_355178.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-31T15:48:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355178",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355179.json:
```json
{
    "body": "Replying to [comment:4 tscrim]:\n> You can probably get some more speed by doing the initial step in the `__iter__` function and then do the remaining steps with `SGS` being explicitly given. \nI don't quite follow. We would still have to compute SGS in this case, won't we? This seems to be the slow part, at least in the first example above with 60000 elements. \n> It is probably faster to also do ...\nThat makes it a little faster, thanks!",
    "created_at": "2018-05-31T15:50:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355179",
    "user": "https://github.com/mo271"
}
```

Replying to [comment:4 tscrim]:
> You can probably get some more speed by doing the initial step in the `__iter__` function and then do the remaining steps with `SGS` being explicitly given. 
I don't quite follow. We would still have to compute SGS in this case, won't we? This seems to be the slow part, at least in the first example above with 60000 elements. 
> It is probably faster to also do ...
That makes it a little faster, thanks!



---

archive/issue_comments_355180.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-31T16:17:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355180",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355181.json:
```json
{
    "body": "\n```\n+        def elements(self, SGS=None):\n+            S = SGS.pop()\n```\n\nseems weird. I assume that you want to remove the `=None` ?",
    "created_at": "2018-06-01T10:44:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355181",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```


```
+        def elements(self, SGS=None):
+            S = SGS.pop()
```

seems weird. I assume that you want to remove the `=None` ?



---

archive/issue_comments_355182.json:
```json
{
    "body": "Replying to [comment:8 stumpc5]:\n> {{{\n> +        def elements(self, SGS=None):\n> +            S = SGS.pop()\n> }}}\n> seems weird. I assume that you want to remove the `=None` ?\nyes, and I just did. (Before seeing, that you did the same thing..)\n----\nNew commits:",
    "created_at": "2018-06-01T11:29:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355182",
    "user": "https://github.com/mo271"
}
```

Replying to [comment:8 stumpc5]:
> {{{
> +        def elements(self, SGS=None):
> +            S = SGS.pop()
> }}}
> seems weird. I assume that you want to remove the `=None` ?
yes, and I just did. (Before seeing, that you did the same thing..)
----
New commits:



---

archive/issue_comments_355183.json:
```json
{
    "body": "I did some more, could you also merge that change in to the branch?",
    "created_at": "2018-06-01T11:57:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355183",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

I did some more, could you also merge that change in to the branch?



---

archive/issue_comments_355184.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-01T20:02:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355184",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355185.json:
```json
{
    "body": "In `def elements(self, SGS):` the argument `self` is never used and you can remove it.",
    "created_at": "2018-06-03T22:00:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355185",
    "user": "https://github.com/videlec"
}
```

In `def elements(self, SGS):` the argument `self` is never used and you can remove it.



---

archive/issue_comments_355186.json:
```json
{
    "body": "\n```\nsage: time len(list(A.__iter_alt__()))\nCPU times: user 3.39 s, sys: 690 ms, total: 4.08 s\nWall time: 4.1 s\n60000\n```\n\nThis computation takes much less time in `gap` directly, I thus expect that doing\n\n```\nSGS = self.strong_generating_system(base)\n```\n\ndirectly in gap rather than in sage would improve the iteration in this case drastically. (I just tried for a bit but failed. The code in gap directly is\n\n```\n#############################################################################\n##\n#F  ElementsStabChain(<S>)\n##\nInstallGlobalFunction(ElementsStabChain,function ( S )\n    local   elms,               # element list, result\n            stb,                # elements of the stabilizer\n            pnt,                # point in the orbit of <S>\n            rep;                # inverse representative for that point\n\n    # if <S> is trivial then it is easy\n    if Length(S.generators) = 0  then\n        elms := [ S.identity ];\n\n    # otherwise\n    else\n\n        # start with the empty list\n        elms := [];\n\n        # compute the elements of the stabilizer\n        stb := ElementsStabChain( S.stabilizer );\n\n        # loop over all points in the orbit\n        for pnt  in S.orbit  do\n\n           # add the corresponding coset to the set of elements\n           rep := S.identity;\n           while S.orbit[1] ^ rep <> pnt  do\n                rep := LeftQuotient( S.transversal[pnt/rep], rep );\n           od;\n           UniteSet( elms, stb * rep );\n\n        od;\n\n   fi;\n\n   # return the result\n   return elms;\nend);\n```\n",
    "created_at": "2018-06-04T11:05:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355186",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```


```
sage: time len(list(A.__iter_alt__()))
CPU times: user 3.39 s, sys: 690 ms, total: 4.08 s
Wall time: 4.1 s
60000
```

This computation takes much less time in `gap` directly, I thus expect that doing

```
SGS = self.strong_generating_system(base)
```

directly in gap rather than in sage would improve the iteration in this case drastically. (I just tried for a bit but failed. The code in gap directly is

```
#############################################################################
##
#F  ElementsStabChain(<S>)
##
InstallGlobalFunction(ElementsStabChain,function ( S )
    local   elms,               # element list, result
            stb,                # elements of the stabilizer
            pnt,                # point in the orbit of <S>
            rep;                # inverse representative for that point

    # if <S> is trivial then it is easy
    if Length(S.generators) = 0  then
        elms := [ S.identity ];

    # otherwise
    else

        # start with the empty list
        elms := [];

        # compute the elements of the stabilizer
        stb := ElementsStabChain( S.stabilizer );

        # loop over all points in the orbit
        for pnt  in S.orbit  do

           # add the corresponding coset to the set of elements
           rep := S.identity;
           while S.orbit[1] ^ rep <> pnt  do
                rep := LeftQuotient( S.transversal[pnt/rep], rep );
           od;
           UniteSet( elms, stb * rep );

        od;

   fi;

   # return the result
   return elms;
end);
```




---

archive/issue_comments_355187.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2018-06-04T11:06:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355187",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_355188.json:
```json
{
    "body": "Replying to [comment:14 vdelecroix]:\n> In `def elements(self, SGS):` the argument `self` is never used and you can remove it.\n\ndone.\n\nI also made some tests and think that the permutation group method `strong_generating_system` is much slower than necessary (see the above example where this algo is slower than the brute force). In particular, there is a lot of talking back and forth between sage and gap. Anyway, for my purposes, this is a non-issue. `@`Dima, do you know how to **easily** make this method fast?\n----\nNew commits:",
    "created_at": "2018-06-04T15:39:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355188",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Replying to [comment:14 vdelecroix]:
> In `def elements(self, SGS):` the argument `self` is never used and you can remove it.

done.

I also made some tests and think that the permutation group method `strong_generating_system` is much slower than necessary (see the above example where this algo is slower than the brute force). In particular, there is a lot of talking back and forth between sage and gap. Anyway, for my purposes, this is a non-issue. `@`Dima, do you know how to **easily** make this method fast?
----
New commits:



---

archive/issue_comments_355189.json:
```json
{
    "body": "Dima, see comment:18.",
    "created_at": "2018-06-05T00:39:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355189",
    "user": "https://github.com/tscrim"
}
```

Dima, see comment:18.



---

archive/issue_comments_355190.json:
```json
{
    "body": "posted question and code at https://groups.google.com/d/topic/sage-devel/wivuFBq7n7k/discussion.",
    "created_at": "2018-06-05T07:47:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355190",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

posted question and code at https://groups.google.com/d/topic/sage-devel/wivuFBq7n7k/discussion.



---

archive/issue_comments_355191.json:
```json
{
    "body": "\n```\ndef SGS_old(G): # taken from strong_generating_system\n    sgs = []\n    stab = G\n    base = G.base()\n    for j in base:\n        sgs.append(stab.transversals(j))\n        stab = stab.stabilizer(j)\n    return sgs\n\ndef SGS_new(G, gap_output=True):\n    S = G._gap_().StabChain()\n    gap.execute(gap_cosets)\n    cosets = S.CosetsStabChain()\n    if gap_output:\n        return cosets                           #  <-------\n\n    elt_class = G._element_class()\n    gap2sage = lambda elt: elt_class(elt, G, check=False)\n    return [ [ gap2sage(elt) for elt in coset]  #  <-------\n             for coset in cosets ]              #  <-------\n\ngap_cosets = \"\"\"CosetsStabChain := function ( S )\n    local   cosets,             # element list, result\n            new_coset,          #\n            pnt,                # point in the orbit of <S>\n            rep;                # inverse representative for that point\n\n    # if <S> is trivial then it is easy\n    if Length(S.generators) = 0  then\n        cosets := [ [S.identity] ];\n\n    # otherwise\n    else\n\n        # compute the elements of the stabilizer\n        cosets := CosetsStabChain( S.stabilizer );\n\n        # loop over all points in the orbit\n        new_coset := [];\n        for pnt  in S.orbit  do\n\n            # add the corresponding coset to the set of elements\n            rep := S.identity;\n            while S.orbit[1] ^ rep <> pnt  do\n                 rep := LeftQuotient( S.transversal[pnt/rep], rep );\n            od;\n            Add( new_coset, rep );\n        od;\n        Add( cosets, new_coset );\n   fi;\n\n   # return the result\n   return cosets;\nend;\n\"\"\"\n```\n",
    "created_at": "2018-06-05T07:48:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355191",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```


```
def SGS_old(G): # taken from strong_generating_system
    sgs = []
    stab = G
    base = G.base()
    for j in base:
        sgs.append(stab.transversals(j))
        stab = stab.stabilizer(j)
    return sgs

def SGS_new(G, gap_output=True):
    S = G._gap_().StabChain()
    gap.execute(gap_cosets)
    cosets = S.CosetsStabChain()
    if gap_output:
        return cosets                           #  <-------

    elt_class = G._element_class()
    gap2sage = lambda elt: elt_class(elt, G, check=False)
    return [ [ gap2sage(elt) for elt in coset]  #  <-------
             for coset in cosets ]              #  <-------

gap_cosets = """CosetsStabChain := function ( S )
    local   cosets,             # element list, result
            new_coset,          #
            pnt,                # point in the orbit of <S>
            rep;                # inverse representative for that point

    # if <S> is trivial then it is easy
    if Length(S.generators) = 0  then
        cosets := [ [S.identity] ];

    # otherwise
    else

        # compute the elements of the stabilizer
        cosets := CosetsStabChain( S.stabilizer );

        # loop over all points in the orbit
        new_coset := [];
        for pnt  in S.orbit  do

            # add the corresponding coset to the set of elements
            rep := S.identity;
            while S.orbit[1] ^ rep <> pnt  do
                 rep := LeftQuotient( S.transversal[pnt/rep], rep );
            od;
            Add( new_coset, rep );
        od;
        Add( cosets, new_coset );
   fi;

   # return the result
   return cosets;
end;
"""
```




---

archive/issue_comments_355192.json:
```json
{
    "body": "The new method is much faster than the old, but then slowed down by casting the output to sage:\n\n```\nsage: sage: p = [(i,i+1) for i in range(1,601,2)]\n....: sage: q = [tuple(range(1+i,601,3)) for i in range(3)]\n....: sage: A = PermutationGroup([p,q])\n\nsage: %time XX = SGS_old(A)\nCPU times: user 3.67 s, sys: 664 ms, total: 4.34 s\nWall time: 4.45 s\n\nsage: %time XX = SGS_new(A, True)\nCPU times: user 4.94 ms, sys: 712 \u00b5s, total: 5.65 ms\nWall time: 14 ms\n\nsage: %time XX = SGS_new(A, False)\nCPU times: user 2.48 s, sys: 116 ms, total: 2.59 s\nWall time: 2.61 s\n```\n",
    "created_at": "2018-06-05T07:49:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355192",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

The new method is much faster than the old, but then slowed down by casting the output to sage:

```
sage: sage: p = [(i,i+1) for i in range(1,601,2)]
....: sage: q = [tuple(range(1+i,601,3)) for i in range(3)]
....: sage: A = PermutationGroup([p,q])

sage: %time XX = SGS_old(A)
CPU times: user 3.67 s, sys: 664 ms, total: 4.34 s
Wall time: 4.45 s

sage: %time XX = SGS_new(A, True)
CPU times: user 4.94 ms, sys: 712 Âµs, total: 5.65 ms
Wall time: 14 ms

sage: %time XX = SGS_new(A, False)
CPU times: user 2.48 s, sys: 116 ms, total: 2.59 s
Wall time: 2.61 s
```




---

archive/issue_comments_355193.json:
```json
{
    "body": "You should be using `libgap` and not `gap`. The communication would be much faster.",
    "created_at": "2018-06-05T08:12:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355193",
    "user": "https://github.com/videlec"
}
```

You should be using `libgap` and not `gap`. The communication would be much faster.



---

archive/issue_comments_355194.json:
```json
{
    "body": "And why not using `StrongGeneratorsStabChain` that is builtin in GAP?",
    "created_at": "2018-06-05T08:13:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355194",
    "user": "https://github.com/videlec"
}
```

And why not using `StrongGeneratorsStabChain` that is builtin in GAP?



---

archive/issue_comments_355195.json:
```json
{
    "body": ">  You should be using libgap and not gap\n\nCould you provide a code snippet in the above example of how to do that?\n\n> And why not using StrongGeneratorsStabChain that is builtin in GAP?\n\nBecause this provides a list of strong generators for the stabilizer chain, but not a list of coset reprs:\n\n\n```\ngap> P := Group([(1,2),(1,2,3,4)]);\nGroup([ (1,2), (1,2,3,4) ])\ngap> S := StabChain(P);\n<stabilizer chain record, Base [ 1, 2, 3 ], Orbit length 4, Size: 24>\ngap> CosetsStabChain(S);\n[ [ () ], [ (), (3,4) ], [ (), (2,4,3), (2,3,4) ], [ (), (1,4)(2,3), (1,2)(3,4), (1,3)(2,4) ] ]\ngap> StrongGeneratorsStabChain(S);\n[ (3,4), (2,3,4), (1,2)(3,4), (1,4)(2,3) ]\n```\n",
    "created_at": "2018-06-05T08:17:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355195",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

>  You should be using libgap and not gap

Could you provide a code snippet in the above example of how to do that?

> And why not using StrongGeneratorsStabChain that is builtin in GAP?

Because this provides a list of strong generators for the stabilizer chain, but not a list of coset reprs:


```
gap> P := Group([(1,2),(1,2,3,4)]);
Group([ (1,2), (1,2,3,4) ])
gap> S := StabChain(P);
<stabilizer chain record, Base [ 1, 2, 3 ], Orbit length 4, Size: 24>
gap> CosetsStabChain(S);
[ [ () ], [ (), (3,4) ], [ (), (2,4,3), (2,3,4) ], [ (), (1,4)(2,3), (1,2)(3,4), (1,3)(2,4) ] ]
gap> StrongGeneratorsStabChain(S);
[ (3,4), (2,3,4), (1,2)(3,4), (1,4)(2,3) ]
```




---

archive/issue_comments_355196.json:
```json
{
    "body": "> And why not using...\n\nLet me add that the gap code above is simply taken from the `ElementsStabChain` code from gap (see `PageSource(ElementsStabChain)`) and returning the cosets rather than the elements. If there was a builtin function that does this, I would be surprised if it is not used there (though it might be possible for speed reasons).",
    "created_at": "2018-06-05T08:28:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355196",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

> And why not using...

Let me add that the gap code above is simply taken from the `ElementsStabChain` code from gap (see `PageSource(ElementsStabChain)`) and returning the cosets rather than the elements. If there was a builtin function that does this, I would be surprised if it is not used there (though it might be possible for speed reasons).



---

archive/issue_comments_355197.json:
```json
{
    "body": "Historically, little attention was paid to the problem at hand, and indeed, iteration over all the elements of a group G, rather than doing something more intelligent, is almost surely an indication of something done without enough thought. \n\nE.g., \n\n* would knowing the coset representatives of a subgroup H<G and generators for H suffice?\n* would knowing the words in generators rather than permutations suffice?\n* can an adavntage be taken of a short [base](https://en.wikipedia.org/wiki/Base_(group_theory)) for G?",
    "created_at": "2018-06-05T08:49:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355197",
    "user": "https://github.com/dimpase"
}
```

Historically, little attention was paid to the problem at hand, and indeed, iteration over all the elements of a group G, rather than doing something more intelligent, is almost surely an indication of something done without enough thought. 

E.g., 

* would knowing the coset representatives of a subgroup H<G and generators for H suffice?
* would knowing the words in generators rather than permutations suffice?
* can an adavntage be taken of a short [base](https://en.wikipedia.org/wiki/Base_(group_theory)) for G?



---

archive/issue_comments_355198.json:
```json
{
    "body": "Replying to [comment:23 vdelecroix]:\n> You should be using `libgap` and not `gap`. The communication would be much faster.\n\nYeah, if the iterator at hand uses (pexpect) GAP, merely converting it to libGAP would be quite a speedup, I suppose.",
    "created_at": "2018-06-05T08:51:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355198",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:23 vdelecroix]:
> You should be using `libgap` and not `gap`. The communication would be much faster.

Yeah, if the iterator at hand uses (pexpect) GAP, merely converting it to libGAP would be quite a speedup, I suppose.



---

archive/issue_comments_355199.json:
```json
{
    "body": "Well, let me wrap up the discussion so for:\n\n* Moritz implemented an iteration using a short base and a stabilizer chain which are both implemented in gap (using the Schreier-Sims algorithm), see the attached branch. This already speeded the iteration in most situations drastically.\n\n* Permutation group elements are faster multiplied in sage than in gap, so we want to do it there.\n\n* The remaining bottleneck is the computation of the strong generating system for which I provided code in gap. This is now also really fast, **except** for the translation of the gap permutations to sage. I still need help to get this last issue disappear.",
    "created_at": "2018-06-05T08:57:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355199",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Well, let me wrap up the discussion so for:

* Moritz implemented an iteration using a short base and a stabilizer chain which are both implemented in gap (using the Schreier-Sims algorithm), see the attached branch. This already speeded the iteration in most situations drastically.

* Permutation group elements are faster multiplied in sage than in gap, so we want to do it there.

* The remaining bottleneck is the computation of the strong generating system for which I provided code in gap. This is now also really fast, **except** for the translation of the gap permutations to sage. I still need help to get this last issue disappear.



---

archive/issue_comments_355200.json:
```json
{
    "body": "GAP has a function `Elements()` which enumerates the elements of a group, did you try it directly? Probably you're reinventing the wheel...\n\nI cannot believe that permutation multiplication in (lib)GAP is slower than in Sage.\nYou are probably doing lots of slow conversions between Sage and pexpect GAP.",
    "created_at": "2018-06-05T09:03:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355200",
    "user": "https://github.com/dimpase"
}
```

GAP has a function `Elements()` which enumerates the elements of a group, did you try it directly? Probably you're reinventing the wheel...

I cannot believe that permutation multiplication in (lib)GAP is slower than in Sage.
You are probably doing lots of slow conversions between Sage and pexpect GAP.



---

archive/issue_comments_355201.json:
```json
{
    "body": "Before comparing any of these functions, we should have a way to fast translate gap permutations to sage permutations. Otherwise, this would even much more so spoil the use of the gap function `Elements` which then results in all permutations to be translated from gap to sage.\n\nHere are some preliminary timings for the Coxeter group of type `E7`:\n\nIn gap, the iteration needs 9.2 secs:\n\n```\ngap> P := Group([(1,64)(3,12)(8,19)(15,23)(16,20)(21,26)(25,30)(27,33)(29,35)(31,34)(32,40)(36,41)(37,44)(38,43)(45,47)(49,52)(62,63)(66,75)(71,82)(78,86)(79,83)(84,89)(88,93)(90,96)(92,98)(94,97)(95,103)(99,104)(100,107)(101,106)(108,110)(112,115)(125,126), (2,65)(4,9)(8,15)(13,18)(14,24)(16,21)(19,23)(20,26)(22,28)(25,31)(27,36)(30,34)(33,41)(50,55)(54,56)(57,59)(58,60)(67,72)(71,78)(76,81)(77,87)(79,84)(82,86)(83,89)(85,91)(88,94)(90,99)(93,97)(96,104)(113,118)(117,119)(120,122)(121,123), (1,12)(3,66)(4,8)(9,15)(13,16)(14,25)(18,21)(22,27)(24,31)(28,36)(35,39)(40,42)(43,46)(44,48)(47,51)(52,53)(61,62)(64,75)(67,71)(72,78)(76,79)(77,88)(81,84)(85,90)(87,94)(91,99)(98,102)(103,105)(106,109)(107,111)(110,114)(115,116)(124,125), (2,9)(3,8)(4,67)(5,13)(11,14)(12,19)(17,22)(21,29)(26,35)(31,32)(34,40)(36,38)(41,43)(48,50)(51,54)(53,57)(60,61)(65,72)(66,71)(68,76)(74,77)(75,82)(80,85)(84,92)(89,98)(94,95)(97,103)(99,101)(104,106)(111,113)(114,117)(116,120)(123,124), (4,13)(5,68)(6,11)(8,16)(9,18)(10,17)(15,21)(19,20)(23,26)(32,37)(38,45)(40,44)(42,48)(43,47)(46,51)(57,58)(59,60)(67,76)(69,74)(71,79)(72,81)(73,80)(78,84)(82,83)(86,89)(95,100)(101,108)(103,107)(105,111)(106,110)(109,114)(120,121)(122,123), (5,11)(6,69)(7,10)(13,14)(16,25)(18,24)(20,30)(21,31)(26,34)(29,32)(35,40)(39,42)(45,49)(47,52)(51,53)(54,57)(56,59)(68,74)(70,73)(76,77)(79,88)(81,87)(83,93)(84,94)(89,97)(92,95)(98,103)(102,105)(108,112)(110,115)(114,116)(117,120)(119,122), (6,10)(7,70)(11,17)(14,22)(24,28)(25,27)(30,33)(31,36)(32,38)(34,41)(37,45)(40,43)(42,46)(44,47)(48,51)(50,54)(55,56)(69,73)(74,80)(77,85)(87,91)(88,90)(93,96)(94,99)(95,101)(97,104)(100,108)(103,106)(105,109)(107,110)(111,114)(113,117)(118,119)]);\n<permutation group with 7 generators>\ngap> Length(Elements(P)); time;\n2903040\n9255\n```\n\nwhile in sage, it only takes 4.3 secs of which 0.7 secs are spend constructing the strong generating system:\n\n```\nsage: P = CoxeterGroup([\"E\",7], implementation=\"permutation\")\nsage: %time X = P.strong_generating_system(P.base())\nCPU times: user 632 ms, sys: 71.6 ms, total: 703 ms\nWall time: 718 ms\n\nsage: P = CoxeterGroup([\"E\",7], implementation=\"permutation\")\nsage: %time len(list(P.__iter_alt__()))\nCPU times: user 4.11 s, sys: 208 ms, total: 4.32 s\nWall time: 4.34 s\n2903040\n```\n\nSo I expect this to go down below 4 sec if we speed the strong generating system.",
    "created_at": "2018-06-05T09:16:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355201",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Before comparing any of these functions, we should have a way to fast translate gap permutations to sage permutations. Otherwise, this would even much more so spoil the use of the gap function `Elements` which then results in all permutations to be translated from gap to sage.

Here are some preliminary timings for the Coxeter group of type `E7`:

In gap, the iteration needs 9.2 secs:

```
gap> P := Group([(1,64)(3,12)(8,19)(15,23)(16,20)(21,26)(25,30)(27,33)(29,35)(31,34)(32,40)(36,41)(37,44)(38,43)(45,47)(49,52)(62,63)(66,75)(71,82)(78,86)(79,83)(84,89)(88,93)(90,96)(92,98)(94,97)(95,103)(99,104)(100,107)(101,106)(108,110)(112,115)(125,126), (2,65)(4,9)(8,15)(13,18)(14,24)(16,21)(19,23)(20,26)(22,28)(25,31)(27,36)(30,34)(33,41)(50,55)(54,56)(57,59)(58,60)(67,72)(71,78)(76,81)(77,87)(79,84)(82,86)(83,89)(85,91)(88,94)(90,99)(93,97)(96,104)(113,118)(117,119)(120,122)(121,123), (1,12)(3,66)(4,8)(9,15)(13,16)(14,25)(18,21)(22,27)(24,31)(28,36)(35,39)(40,42)(43,46)(44,48)(47,51)(52,53)(61,62)(64,75)(67,71)(72,78)(76,79)(77,88)(81,84)(85,90)(87,94)(91,99)(98,102)(103,105)(106,109)(107,111)(110,114)(115,116)(124,125), (2,9)(3,8)(4,67)(5,13)(11,14)(12,19)(17,22)(21,29)(26,35)(31,32)(34,40)(36,38)(41,43)(48,50)(51,54)(53,57)(60,61)(65,72)(66,71)(68,76)(74,77)(75,82)(80,85)(84,92)(89,98)(94,95)(97,103)(99,101)(104,106)(111,113)(114,117)(116,120)(123,124), (4,13)(5,68)(6,11)(8,16)(9,18)(10,17)(15,21)(19,20)(23,26)(32,37)(38,45)(40,44)(42,48)(43,47)(46,51)(57,58)(59,60)(67,76)(69,74)(71,79)(72,81)(73,80)(78,84)(82,83)(86,89)(95,100)(101,108)(103,107)(105,111)(106,110)(109,114)(120,121)(122,123), (5,11)(6,69)(7,10)(13,14)(16,25)(18,24)(20,30)(21,31)(26,34)(29,32)(35,40)(39,42)(45,49)(47,52)(51,53)(54,57)(56,59)(68,74)(70,73)(76,77)(79,88)(81,87)(83,93)(84,94)(89,97)(92,95)(98,103)(102,105)(108,112)(110,115)(114,116)(117,120)(119,122), (6,10)(7,70)(11,17)(14,22)(24,28)(25,27)(30,33)(31,36)(32,38)(34,41)(37,45)(40,43)(42,46)(44,47)(48,51)(50,54)(55,56)(69,73)(74,80)(77,85)(87,91)(88,90)(93,96)(94,99)(95,101)(97,104)(100,108)(103,106)(105,109)(107,110)(111,114)(113,117)(118,119)]);
<permutation group with 7 generators>
gap> Length(Elements(P)); time;
2903040
9255
```

while in sage, it only takes 4.3 secs of which 0.7 secs are spend constructing the strong generating system:

```
sage: P = CoxeterGroup(["E",7], implementation="permutation")
sage: %time X = P.strong_generating_system(P.base())
CPU times: user 632 ms, sys: 71.6 ms, total: 703 ms
Wall time: 718 ms

sage: P = CoxeterGroup(["E",7], implementation="permutation")
sage: %time len(list(P.__iter_alt__()))
CPU times: user 4.11 s, sys: 208 ms, total: 4.32 s
Wall time: 4.34 s
2903040
```

So I expect this to go down below 4 sec if we speed the strong generating system.



---

archive/issue_comments_355202.json:
```json
{
    "body": "Do you know that GAP actually has iterators?\nWith P as in comment 31:\n\n```\ngap> si:=IteratorStabChain(StabChain(P));\n<iterator>\ngap> l:=[];;\ngap> for i in si do Add(l,i); od;\ngap> Length(l);\n```\n\nis about 30% faster than `Elements(P)` - the latter actually will also sort the elements, perhaps that's why.\n\nMoreover, in `for i` loop about 60% of time is taken by `Add()`.\n(I measured this by replacing `Add()` by a counter increment).",
    "created_at": "2018-06-05T09:52:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355202",
    "user": "https://github.com/dimpase"
}
```

Do you know that GAP actually has iterators?
With P as in comment 31:

```
gap> si:=IteratorStabChain(StabChain(P));
<iterator>
gap> l:=[];;
gap> for i in si do Add(l,i); od;
gap> Length(l);
```

is about 30% faster than `Elements(P)` - the latter actually will also sort the elements, perhaps that's why.

Moreover, in `for i` loop about 60% of time is taken by `Add()`.
(I measured this by replacing `Add()` by a counter increment).



---

archive/issue_comments_355203.json:
```json
{
    "body": "Oh, I forgot that `Elements` sorts the output, thanks for the reminder and for improving the timing comparisons:\n\n```\ngap> si:=IteratorStabChain(StabChain(P));; time;\n4\ngap> i:=0;;\ngap> for j in si do i:=i+1; od; time;\n2608\ngap> i;\n2903040\n```\n\nvs.\n\n```\nsage: i = 0\nsage: %time for _ in P.__iter_alt__(): i+=1\nCPU times: user 1.97 s, sys: 80.2 ms, total: 2.05 s\nWall time: 2.08 s\nsage: i\n2903040\n```\n\n\n(Is this now the timing you think is optimal in gap?)\nIf this is the case, sage is still faster, and, again, 0.7secs are overhead that can be remomved from the sage timing, pushing it to roughly 1.5secs.",
    "created_at": "2018-06-05T10:05:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355203",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Oh, I forgot that `Elements` sorts the output, thanks for the reminder and for improving the timing comparisons:

```
gap> si:=IteratorStabChain(StabChain(P));; time;
4
gap> i:=0;;
gap> for j in si do i:=i+1; od; time;
2608
gap> i;
2903040
```

vs.

```
sage: i = 0
sage: %time for _ in P.__iter_alt__(): i+=1
CPU times: user 1.97 s, sys: 80.2 ms, total: 2.05 s
Wall time: 2.08 s
sage: i
2903040
```


(Is this now the timing you think is optimal in gap?)
If this is the case, sage is still faster, and, again, 0.7secs are overhead that can be remomved from the sage timing, pushing it to roughly 1.5secs.



---

archive/issue_comments_355204.json:
```json
{
    "body": "I wonder whether the SGSs in these tests use the same base.\n\nI must say that I also don't understand the recursive code in the branch on the ticket. I suspect it won't work correctly if SGS's elements are not involutions.\n(E.g. if the group is cyclic, then there should be a loop over the powers of the only generator in SGS, no?)",
    "created_at": "2018-06-05T10:41:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355204",
    "user": "https://github.com/dimpase"
}
```

I wonder whether the SGSs in these tests use the same base.

I must say that I also don't understand the recursive code in the branch on the ticket. I suspect it won't work correctly if SGS's elements are not involutions.
(E.g. if the group is cyclic, then there should be a loop over the powers of the only generator in SGS, no?)



---

archive/issue_comments_355205.json:
```json
{
    "body": "The algorithm in sage now is the very same as the one in gap, there is no structural difference. For a general description, see for example https://math.stackexchange.com/a/1706006/234820.\n\nIn particular, both use the same base and the same stabilizer chain.\n\n> I suspect it won't work correctly if SGS's elements are not involutions.\n\nThis is not correct if I understand it correctly. In particular, the elements in the SGS are usually not only involutions, for example\n\n```\nsage: S = PermutationGroup([(1,2),(1,2,3)])\nsage: S.strong_generating_system()\n[[(), (1,2,3), (1,3,2)], [(), (2,3)], [()]]\n```\n\nand the SGS is **not** a generating set for the group itself.\nAnother example of a cyclic group is\n\n```\nsage: P = PermutationGroup([(1,2,3,4)])\nsage: for elt in P.__iter_alt__(): print elt\n()\n(1,4,3,2)\n(1,3)(2,4)\n(1,2,3,4)\n```\n\nand the stabilizer chain is trivial (i.e., the chain of cosets is a single coset of the trivial subgroup).",
    "created_at": "2018-06-05T11:50:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355205",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

The algorithm in sage now is the very same as the one in gap, there is no structural difference. For a general description, see for example https://math.stackexchange.com/a/1706006/234820.

In particular, both use the same base and the same stabilizer chain.

> I suspect it won't work correctly if SGS's elements are not involutions.

This is not correct if I understand it correctly. In particular, the elements in the SGS are usually not only involutions, for example

```
sage: S = PermutationGroup([(1,2),(1,2,3)])
sage: S.strong_generating_system()
[[(), (1,2,3), (1,3,2)], [(), (2,3)], [()]]
```

and the SGS is **not** a generating set for the group itself.
Another example of a cyclic group is

```
sage: P = PermutationGroup([(1,2,3,4)])
sage: for elt in P.__iter_alt__(): print elt
()
(1,4,3,2)
(1,3)(2,4)
(1,2,3,4)
```

and the stabilizer chain is trivial (i.e., the chain of cosets is a single coset of the trivial subgroup).



---

archive/issue_comments_355206.json:
```json
{
    "body": "ok, so these are `for g in S` loops that iterate over subgroups S, right?\n\nWhat iterator is there? Do you want to use your iterator there, explicitly?",
    "created_at": "2018-06-05T13:16:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355206",
    "user": "https://github.com/dimpase"
}
```

ok, so these are `for g in S` loops that iterate over subgroups S, right?

What iterator is there? Do you want to use your iterator there, explicitly?



---

archive/issue_comments_355207.json:
```json
{
    "body": "Sorry, I am slightly lost now in what you are asking -- let me try to answer anyway.\n\nLet S be a permutation group in sage. The current iterator `for g in S` iterates by a brute force algorithm through the elements keeping the complete group in memory to check if an element was seen before.\n\nThe new algorithm reimplements the algorithm used in gap, and indeed takes the important ingredients from gap. gap computes a chain ` e = S1 in S2 in ... in Sk = S` of subgroups (obtained using the Schreier-Sims algorithm) for which the cosets of `Si` inside ` S{i+1} ` are particularly easy to compute.\nThis yields a sequence of cosets `[e]=C1, C2, ..., Ck` such that every element in `S` has a unique representation `g = g1*...*gk` for `gi in Ci`.\n\nIn sage, the new algorithm is to\n\n* directly compute in gap the list `C1, C2, ..., Ck`\n* translate the elements in all these lists to sage (this takes too long and should be improved)\n* produce an iterator for all elements in `S` by iterating over all products of elements in these lists.\n\nLet me know if you meant something else...",
    "created_at": "2018-06-05T13:28:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355207",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Sorry, I am slightly lost now in what you are asking -- let me try to answer anyway.

Let S be a permutation group in sage. The current iterator `for g in S` iterates by a brute force algorithm through the elements keeping the complete group in memory to check if an element was seen before.

The new algorithm reimplements the algorithm used in gap, and indeed takes the important ingredients from gap. gap computes a chain ` e = S1 in S2 in ... in Sk = S` of subgroups (obtained using the Schreier-Sims algorithm) for which the cosets of `Si` inside ` S{i+1} ` are particularly easy to compute.
This yields a sequence of cosets `[e]=C1, C2, ..., Ck` such that every element in `S` has a unique representation `g = g1*...*gk` for `gi in Ci`.

In sage, the new algorithm is to

* directly compute in gap the list `C1, C2, ..., Ck`
* translate the elements in all these lists to sage (this takes too long and should be improved)
* produce an iterator for all elements in `S` by iterating over all products of elements in these lists.

Let me know if you meant something else...



---

archive/issue_comments_355208.json:
```json
{
    "body": "Replying to [comment:37 stumpc5]:\n\n> Let me know if you meant something else...\n\nI meant \n\n[lines 844](https://github.com/sagemath/sagetrac-mirror/blob/285524e6bc6d5bfee42b8d1a594fadb58b0effd7/src/sage/groups/perm_gps/permgroup.py#L844) and \n[848](https://github.com/sagemath/sagetrac-mirror/blob/u/stumpc5/enumerate_PermutationGroup/src/sage/groups/perm_gps/permgroup.py#L848)\n\nin your patch, both say `for g in S:` -- how do these iterations work? (I imagine `S` is a subgroup in the SGS chain).",
    "created_at": "2018-06-05T15:23:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355208",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:37 stumpc5]:

> Let me know if you meant something else...

I meant 

[lines 844](https://github.com/sagemath/sagetrac-mirror/blob/285524e6bc6d5bfee42b8d1a594fadb58b0effd7/src/sage/groups/perm_gps/permgroup.py#L844) and 
[848](https://github.com/sagemath/sagetrac-mirror/blob/u/stumpc5/enumerate_PermutationGroup/src/sage/groups/perm_gps/permgroup.py#L848)

in your patch, both say `for g in S:` -- how do these iterations work? (I imagine `S` is a subgroup in the SGS chain).



---

archive/issue_comments_355209.json:
```json
{
    "body": ">  in your patch, both say for g in S: -- how do these iterations work? (I imagine S is a subgroup in the SGS chain)\n\nNo, `S = SGS.pop()` so `S = Ci` is the next layer of coset representatives. Let us go through the code with the notation as above:\n\n```\n        def elements(SGS):\n            S = SGS.pop()\n            if not SGS:\n                for g in S:\n                    yield g\n            else:\n                for s in elements(SGS):\n                    for g in S:\n                        yield s._mul_(g)\n```\n\nGiven such a sequence `SGS = C1,C2,...,Ci`, `elements(SGS)` iterates over all elements in `Si`. This is done by recursively doing the computation for `C1,C2,..,C{i-1} ` and then yielding all elements in `S{i-1} ` multiplied with all elements in `S=Ci`.\n\n`if not SGS` means that we have reached the trivial subgroup and `S = [()]`. So the first `for g in S: yield g` could be replaced with `yield S[0]`.",
    "created_at": "2018-06-05T15:50:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355209",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

>  in your patch, both say for g in S: -- how do these iterations work? (I imagine S is a subgroup in the SGS chain)

No, `S = SGS.pop()` so `S = Ci` is the next layer of coset representatives. Let us go through the code with the notation as above:

```
        def elements(SGS):
            S = SGS.pop()
            if not SGS:
                for g in S:
                    yield g
            else:
                for s in elements(SGS):
                    for g in S:
                        yield s._mul_(g)
```

Given such a sequence `SGS = C1,C2,...,Ci`, `elements(SGS)` iterates over all elements in `Si`. This is done by recursively doing the computation for `C1,C2,..,C{i-1} ` and then yielding all elements in `S{i-1} ` multiplied with all elements in `S=Ci`.

`if not SGS` means that we have reached the trivial subgroup and `S = [()]`. So the first `for g in S: yield g` could be replaced with `yield S[0]`.



---

archive/issue_comments_355210.json:
```json
{
    "body": "Well, by right, SGS is a generating set. So your naming scheme (no other documentation :-)) is misleading...",
    "created_at": "2018-06-05T16:10:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355210",
    "user": "https://github.com/dimpase"
}
```

Well, by right, SGS is a generating set. So your naming scheme (no other documentation :-)) is misleading...



---

archive/issue_comments_355211.json:
```json
{
    "body": "SGS is a strong generating system taken from the sage naming scheme. The later might be misleading, though, since it is not a generating set but a sequence of coset reprs...",
    "created_at": "2018-06-05T18:38:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355211",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

SGS is a strong generating system taken from the sage naming scheme. The later might be misleading, though, since it is not a generating set but a sequence of coset reprs...



---

archive/issue_comments_355212.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-05T19:01:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355212",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355213.json:
```json
{
    "body": "with the new commit, the timings from the beginning become\n\n```\nsage: p = [(i,i+1) for i in range(1,601,2)]\n....: q = [tuple(range(1+i,601,3)) for i in range(3)]\n....: A = PermutationGroup([p,q])\n....: A.cardinality()\n....: \n60000\nsage: time len(list(A))\nCPU times: user 458 ms, sys: 56.2 ms, total: 514 ms\nWall time: 512 ms\n60000\nsage: time len(list(A.__iter_alt__()))\nCPU times: user 2.97 s, sys: 167 ms, total: 3.13 s\nWall time: 3.23 s\n60000\nsage: time x = A.strong_generating_system(A.base())\nCPU times: user 4.51 s, sys: 396 ms, total: 4.9 s\nWall time: 5.08 s\nsage: time x = A.strong_generating_system(implementation=\"gap\")\nCPU times: user 2.67 s, sys: 80.3 ms, total: 2.75 s\nWall time: 2.77 s\n```\n\nso the iterations are equally fast, but the translation from gap permutations to sage permutations takes 2.5 secs.",
    "created_at": "2018-06-05T19:08:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355213",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

with the new commit, the timings from the beginning become

```
sage: p = [(i,i+1) for i in range(1,601,2)]
....: q = [tuple(range(1+i,601,3)) for i in range(3)]
....: A = PermutationGroup([p,q])
....: A.cardinality()
....: 
60000
sage: time len(list(A))
CPU times: user 458 ms, sys: 56.2 ms, total: 514 ms
Wall time: 512 ms
60000
sage: time len(list(A.__iter_alt__()))
CPU times: user 2.97 s, sys: 167 ms, total: 3.13 s
Wall time: 3.23 s
60000
sage: time x = A.strong_generating_system(A.base())
CPU times: user 4.51 s, sys: 396 ms, total: 4.9 s
Wall time: 5.08 s
sage: time x = A.strong_generating_system(implementation="gap")
CPU times: user 2.67 s, sys: 80.3 ms, total: 2.75 s
Wall time: 2.77 s
```

so the iterations are equally fast, but the translation from gap permutations to sage permutations takes 2.5 secs.



---

archive/issue_comments_355214.json:
```json
{
    "body": "Do you have a problem using libGAP rather than GAP?",
    "created_at": "2018-06-05T19:27:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355214",
    "user": "https://github.com/dimpase"
}
```

Do you have a problem using libGAP rather than GAP?



---

archive/issue_comments_355215.json:
```json
{
    "body": ">> You should be using libgap and not gap\n> Could you provide a code snippet in the above example of how to do that? \n\nNo, I just do now know how to do it, see my above comment from comment:25 .",
    "created_at": "2018-06-05T20:12:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355215",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

>> You should be using libgap and not gap
> Could you provide a code snippet in the above example of how to do that? 

No, I just do now know how to do it, see my above comment from comment:25 .



---

archive/issue_comments_355216.json:
```json
{
    "body": "Replying to [comment:45 stumpc5]:\n> >> You should be using libgap and not gap\n> > Could you provide a code snippet in the above example of how to do that? \n> \n> No, I just do now know how to do it, see my above comment from comment:25 .\n\nYou can have a look at [CossidentePenttilaGraph()](https://github.com/sagemath/sagetrac-mirror/blob/854f9764d14236110b8d7f7b35a7d52017e044f8/src/sage/graphs/generators/classical_geometries.py#L1222) for the use of `libgap.function_factory` (so that you can basically call your own GAP function via libgap).\n\nSo you can change your code as follows:\n\n```\ngap_cosets = libgap.function_factory(\"\"\"function ( S0 )\n    local   CosetsStabChain;\n    CosetsStabChain := function(S)  # for the recursive call\n    local   cosets,             # element list, result\n            new_coset,          #\n            pnt,                # point in the orbit of <S>\n            rep;                # inverse representative for that point\n\n    # if <S> is trivial then it is easy\n    if Length(S.generators) = 0  then\n        cosets := [ [S.identity] ];\n\n    # otherwise\n    else\n\n        # compute the elements of the stabilizer\n        cosets := CosetsStabChain( S.stabilizer );\n\n        # loop over all points in the orbit\n        new_coset := [];\n        for pnt  in S.orbit  do\n\n            # add the corresponding coset to the set of elements\n            rep := S.identity;\n            while S.orbit[1] ^ rep <> pnt  do\n                 rep := LeftQuotient( S.transversal[pnt/rep], rep );\n            od;\n            Add( new_coset, rep );\n        od;\n        Add( cosets, new_coset );\n   fi;\n\n   # return the result\n   return cosets;\n   end;\n   return CosetsStabChain(S0);\nend;\"\"\")\n```\n\nNow one can do\n\n```\nsage: G=libgap.AlternatingGroup(4)\nsage: S=G.StabChain()\nsage: gap_cosets(S)\n[ [ () ], [ (), (2,4,3), (2,3,4) ], [ (), (1,4,3), (1,3,4), (1,2,4) ] ]\n```\n\n\nanother useful thing is syntax like `G=libgap(PermutationGroup([(1,2)]))` to convert\nfrom Sage's group (implemented with pexpect GAP, I gather) to libgap.",
    "created_at": "2018-06-05T22:05:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355216",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:45 stumpc5]:
> >> You should be using libgap and not gap
> > Could you provide a code snippet in the above example of how to do that? 
> 
> No, I just do now know how to do it, see my above comment from comment:25 .

You can have a look at [CossidentePenttilaGraph()](https://github.com/sagemath/sagetrac-mirror/blob/854f9764d14236110b8d7f7b35a7d52017e044f8/src/sage/graphs/generators/classical_geometries.py#L1222) for the use of `libgap.function_factory` (so that you can basically call your own GAP function via libgap).

So you can change your code as follows:

```
gap_cosets = libgap.function_factory("""function ( S0 )
    local   CosetsStabChain;
    CosetsStabChain := function(S)  # for the recursive call
    local   cosets,             # element list, result
            new_coset,          #
            pnt,                # point in the orbit of <S>
            rep;                # inverse representative for that point

    # if <S> is trivial then it is easy
    if Length(S.generators) = 0  then
        cosets := [ [S.identity] ];

    # otherwise
    else

        # compute the elements of the stabilizer
        cosets := CosetsStabChain( S.stabilizer );

        # loop over all points in the orbit
        new_coset := [];
        for pnt  in S.orbit  do

            # add the corresponding coset to the set of elements
            rep := S.identity;
            while S.orbit[1] ^ rep <> pnt  do
                 rep := LeftQuotient( S.transversal[pnt/rep], rep );
            od;
            Add( new_coset, rep );
        od;
        Add( cosets, new_coset );
   fi;

   # return the result
   return cosets;
   end;
   return CosetsStabChain(S0);
end;""")
```

Now one can do

```
sage: G=libgap.AlternatingGroup(4)
sage: S=G.StabChain()
sage: gap_cosets(S)
[ [ () ], [ (), (2,4,3), (2,3,4) ], [ (), (1,4,3), (1,3,4), (1,2,4) ] ]
```


another useful thing is syntax like `G=libgap(PermutationGroup([(1,2)]))` to convert
from Sage's group (implemented with pexpect GAP, I gather) to libgap.



---

archive/issue_comments_355217.json:
```json
{
    "body": "Thank you, Dima! I did these changes together with tons of small changes that had a huge impact on the running time.\n\nBeside this, I arrived at the following, and wonder if this is okay doing: Given I have\n\n* a `PermutationGroupElement` \"sample\" and\n* a `list` \"new_perm\" representing a permutation in one-line notation in the *same permutation group* as \"sample\"\n\nIt seems that, oddly, we do not have a fast way of generating new permutations from these lists, despite the fact that we can multiply permutations very fast. I thus provide a new `PermutationGroupElement` method `_generate_new` that basically takes a copy from the given `PermutationGroupElement` and only overwrites its underlying c list. The code is basically copied from `_mul_`.\n\nAn example would be\n\n```\nsage: S = PermutationGroup(SymmetricGroup(4).gens())\nsage: sample = S([2,3,4,1])\nsage: lst1 = []\nsage: lst2 = [2,1]\nsage: lst3 = [4,3,2,1]\nsage: pi1 = sample._generate_new(lst1); pi1\n()\nsage: pi2 = sample._generate_new(lst2); pi2\n(1,2)\nsage: pi3 = sample._generate_new(lst3); pi3\n(1,4)(2,3)\n```\n",
    "created_at": "2018-06-06T08:30:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355217",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Thank you, Dima! I did these changes together with tons of small changes that had a huge impact on the running time.

Beside this, I arrived at the following, and wonder if this is okay doing: Given I have

* a `PermutationGroupElement` "sample" and
* a `list` "new_perm" representing a permutation in one-line notation in the *same permutation group* as "sample"

It seems that, oddly, we do not have a fast way of generating new permutations from these lists, despite the fact that we can multiply permutations very fast. I thus provide a new `PermutationGroupElement` method `_generate_new` that basically takes a copy from the given `PermutationGroupElement` and only overwrites its underlying c list. The code is basically copied from `_mul_`.

An example would be

```
sage: S = PermutationGroup(SymmetricGroup(4).gens())
sage: sample = S([2,3,4,1])
sage: lst1 = []
sage: lst2 = [2,1]
sage: lst3 = [4,3,2,1]
sage: pi1 = sample._generate_new(lst1); pi1
()
sage: pi2 = sample._generate_new(lst2); pi2
(1,2)
sage: pi3 = sample._generate_new(lst3); pi3
(1,4)(2,3)
```




---

archive/issue_comments_355218.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-06T08:37:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355218",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355219.json:
```json
{
    "body": "And here is the new timings:\n\n```\nsage: sage: p = [(i,i+1) for i in range(1,601,2)]\n....: ....: q = [tuple(range(1+i,601,3)) for i in range(3)]\n....: ....: A = PermutationGroup([p,q])\n....: ....: A.cardinality()\n....: \n60000\nsage: sage: time len(list(A))\nCPU times: user 514 ms, sys: 52.2 ms, total: 566 ms\nWall time: 535 ms\n60000\nsage: sage: time len(list(A.__iter_alt__()))\nCPU times: user 588 ms, sys: 91 ms, total: 679 ms\nWall time: 669 ms\n60000\nsage: sage: time len(list(A))\nCPU times: user 469 ms, sys: 72.5 ms, total: 542 ms\nWall time: 529 ms\n60000\nsage: sage: time len(list(A.__iter_alt__()))\nCPU times: user 375 ms, sys: 52.3 ms, total: 427 ms\nWall time: 419 ms\n60000\nsage: sage: time x = A.strong_generating_system(A.base())\nCPU times: user 3.82 s, sys: 784 ms, total: 4.6 s\nWall time: 4.69 s\nsage: sage: time x = A.strong_generating_system(implementation=\"gap\")\nCPU times: user 281 ms, sys: 127 \u00b5s, total: 281 ms\nWall time: 280 ms\n```\n",
    "created_at": "2018-06-06T08:40:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355219",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

And here is the new timings:

```
sage: sage: p = [(i,i+1) for i in range(1,601,2)]
....: ....: q = [tuple(range(1+i,601,3)) for i in range(3)]
....: ....: A = PermutationGroup([p,q])
....: ....: A.cardinality()
....: 
60000
sage: sage: time len(list(A))
CPU times: user 514 ms, sys: 52.2 ms, total: 566 ms
Wall time: 535 ms
60000
sage: sage: time len(list(A.__iter_alt__()))
CPU times: user 588 ms, sys: 91 ms, total: 679 ms
Wall time: 669 ms
60000
sage: sage: time len(list(A))
CPU times: user 469 ms, sys: 72.5 ms, total: 542 ms
Wall time: 529 ms
60000
sage: sage: time len(list(A.__iter_alt__()))
CPU times: user 375 ms, sys: 52.3 ms, total: 427 ms
Wall time: 419 ms
60000
sage: sage: time x = A.strong_generating_system(A.base())
CPU times: user 3.82 s, sys: 784 ms, total: 4.6 s
Wall time: 4.69 s
sage: sage: time x = A.strong_generating_system(implementation="gap")
CPU times: user 281 ms, sys: 127 Âµs, total: 281 ms
Wall time: 280 ms
```




---

archive/issue_comments_355220.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-06T08:43:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355220",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355221.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2018-06-06T08:45:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355221",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_355222.json:
```json
{
    "body": "I set this to \"needs review\" for a technical review of the code where I still hope for input for improvements (which will not only be relevant for my particular purpose!).\n\nOnce this is settled, I propose to use the now `PermutationGroup` iterator per default (and I would also be interested in examples where the old iterator is still faster).",
    "created_at": "2018-06-06T08:45:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355222",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

I set this to "needs review" for a technical review of the code where I still hope for input for improvements (which will not only be relevant for my particular purpose!).

Once this is settled, I propose to use the now `PermutationGroup` iterator per default (and I would also be interested in examples where the old iterator is still faster).



---

archive/issue_comments_355223.json:
```json
{
    "body": "Comparing the gap and the sage iterators from comment:33, we now have:\n\n```\ngap> si:=IteratorStabChain(StabChain(P));\n<iterator>\ngap> i:=0;;\ngap> for j in si do i:=i+1; od; time;\n2523\ngap> i;\n2903040\n```\n\nvs.\n\n```\nsage: sage: i = 0\n....: sage: %time for _ in P.__iter_alt__(): i+=1\n....: \nCPU times: user 1.49 s, sys: 28.2 ms, total: 1.52 s\nWall time: 1.59 s\nsage: i\n2903040\n```\n",
    "created_at": "2018-06-06T09:14:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355223",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Comparing the gap and the sage iterators from comment:33, we now have:

```
gap> si:=IteratorStabChain(StabChain(P));
<iterator>
gap> i:=0;;
gap> for j in si do i:=i+1; od; time;
2523
gap> i;
2903040
```

vs.

```
sage: sage: i = 0
....: sage: %time for _ in P.__iter_alt__(): i+=1
....: 
CPU times: user 1.49 s, sys: 28.2 ms, total: 1.52 s
Wall time: 1.59 s
sage: i
2903040
```




---

archive/issue_comments_355224.json:
```json
{
    "body": "The right thing to do (not on this ticket, I guess it's a nontrivial amount of work) is to convert the whole `sage/groups/perm_gps` to libGAP.\n\nThis ticket shows that the performance improvements are big.",
    "created_at": "2018-06-06T09:28:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355224",
    "user": "https://github.com/dimpase"
}
```

The right thing to do (not on this ticket, I guess it's a nontrivial amount of work) is to convert the whole `sage/groups/perm_gps` to libGAP.

This ticket shows that the performance improvements are big.



---

archive/issue_comments_355225.json:
```json
{
    "body": "> This ticket shows that the performance improvements are big\n\nLet me remark that the biggest performance boost came from generating new permutation group elements from old using the new `_generate_new` method. The use of libGAP also played a role, though.",
    "created_at": "2018-06-06T09:39:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355225",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

> This ticket shows that the performance improvements are big

Let me remark that the biggest performance boost came from generating new permutation group elements from old using the new `_generate_new` method. The use of libGAP also played a role, though.



---

archive/issue_comments_355226.json:
```json
{
    "body": "1) Regarding the timing (GAP iterator vs your iterator). Am I right that they both operate with (lib)GAP data? (i.e. that __mul__ call on permutations in `__iter_alt__`, is it actually in (lib)GAP?)\n\n2) I don't understand the hack one._generate_new(libgap.ListPerm(elt).sage()).\nI thought that libgap has a fast method to convert GAP permutations to Sage. E.g.\n\n```\nsage: G=libgap.AlternatingGroup(4)\nsage: gg=G.GeneratorsOfGroup()\nsage: gg.sage()\n[(1,2,3), (2,3,4)]\nsage: type(g.sage()[0])\n<type 'sage.groups.perm_gps.permgroup_element.PermutationGroupElement'>\nsage: type(g[0])\n<type 'sage.libs.gap.element.GapElement_Permutation'>\n```\n",
    "created_at": "2018-06-06T09:57:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355226",
    "user": "https://github.com/dimpase"
}
```

1) Regarding the timing (GAP iterator vs your iterator). Am I right that they both operate with (lib)GAP data? (i.e. that __mul__ call on permutations in `__iter_alt__`, is it actually in (lib)GAP?)

2) I don't understand the hack one._generate_new(libgap.ListPerm(elt).sage()).
I thought that libgap has a fast method to convert GAP permutations to Sage. E.g.

```
sage: G=libgap.AlternatingGroup(4)
sage: gg=G.GeneratorsOfGroup()
sage: gg.sage()
[(1,2,3), (2,3,4)]
sage: type(g.sage()[0])
<type 'sage.groups.perm_gps.permgroup_element.PermutationGroupElement'>
sage: type(g[0])
<type 'sage.libs.gap.element.GapElement_Permutation'>
```




---

archive/issue_comments_355227.json:
```json
{
    "body": "> i.e. that mul call on permutations in __iter_alt__, is it actually in (lib)GAP?\n\nNo, this is pure cython and uses `PermutationGroupElement._mul_(left, _right)`, no (lib)GAP involved here.\n\nSince both algorithms are the same, and the strong generating set in the Sage version is taken through libGAP, I suspect that the time advantage of Sage really comes from this superfast cython multiplication of permutation group elements.\n\n> I thought that libgap has a fast method to convert GAP permutations to Sage\n\nThis is not the case: libgap uses `GapElement_Permutation.sage` which returns `PermutationGroupElement(libgap.ListPerm(self).sage())`, so it goes through the ordinary permutation group element constructor that is **very** slow because of tons of checks. This is why I wrote `_generate_new` that just uses the data from a given element and overwrites its c array containing the permutation:\n\n```\nsage: P = PermutationGroup([(1,2),(1,2,3,4)])\nsage: one = P.one()\nsage: l = [4,3,2,1]\nsage: %timeit P(l)\n1000 loops, best of 3: 579 \u00b5s per loop\nsage: %timeit one._generate_new(l)\nThe slowest run took 39.93 times longer than the fastest. This could mean that an intermediate result is being cached.\n1000000 loops, best of 3: 203 ns per loop\n```\n",
    "created_at": "2018-06-06T10:10:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355227",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

> i.e. that mul call on permutations in __iter_alt__, is it actually in (lib)GAP?

No, this is pure cython and uses `PermutationGroupElement._mul_(left, _right)`, no (lib)GAP involved here.

Since both algorithms are the same, and the strong generating set in the Sage version is taken through libGAP, I suspect that the time advantage of Sage really comes from this superfast cython multiplication of permutation group elements.

> I thought that libgap has a fast method to convert GAP permutations to Sage

This is not the case: libgap uses `GapElement_Permutation.sage` which returns `PermutationGroupElement(libgap.ListPerm(self).sage())`, so it goes through the ordinary permutation group element constructor that is **very** slow because of tons of checks. This is why I wrote `_generate_new` that just uses the data from a given element and overwrites its c array containing the permutation:

```
sage: P = PermutationGroup([(1,2),(1,2,3,4)])
sage: one = P.one()
sage: l = [4,3,2,1]
sage: %timeit P(l)
1000 loops, best of 3: 579 Âµs per loop
sage: %timeit one._generate_new(l)
The slowest run took 39.93 times longer than the fastest. This could mean that an intermediate result is being cached.
1000000 loops, best of 3: 203 ns per loop
```




---

archive/issue_comments_355228.json:
```json
{
    "body": "Replying to [comment:56 stumpc5]:\n> \n> > I thought that libgap has a fast method to convert GAP permutations to Sage\n> \n> This is not the case: libgap uses `GapElement_Permutation.sage` which returns `PermutationGroupElement(libgap.ListPerm(self).sage())`, so it goes through the ordinary permutation group element constructor that is **very** slow because of tons of checks. This is why I wrote `_generate_new` that just uses the data from a given element and overwrites its c array containing the permutation:\n\nShouldn't then this be used to improve the code in src/sage/libs/gap/?\nCause that's what it does, you provide a better implementation for `<libgap perm>.sage()`, right?",
    "created_at": "2018-06-06T10:25:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355228",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:56 stumpc5]:
> 
> > I thought that libgap has a fast method to convert GAP permutations to Sage
> 
> This is not the case: libgap uses `GapElement_Permutation.sage` which returns `PermutationGroupElement(libgap.ListPerm(self).sage())`, so it goes through the ordinary permutation group element constructor that is **very** slow because of tons of checks. This is why I wrote `_generate_new` that just uses the data from a given element and overwrites its c array containing the permutation:

Shouldn't then this be used to improve the code in src/sage/libs/gap/?
Cause that's what it does, you provide a better implementation for `<libgap perm>.sage()`, right?



---

archive/issue_comments_355229.json:
```json
{
    "body": "Not really, because my method (A) makes use of the fact that one knows the permutation group the element lives in a priori, and (B) does not check the input whatsoever for correctness (and might result in segfaults if not used properly).\n\nThe first is an issue because `<libgap perm>` does not know which parent a gap permutation lives in (and neither does gap iirc), while the second might be neglected in case we expect that we always get something reasonable fromo gap.",
    "created_at": "2018-06-06T10:33:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355229",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Not really, because my method (A) makes use of the fact that one knows the permutation group the element lives in a priori, and (B) does not check the input whatsoever for correctness (and might result in segfaults if not used properly).

The first is an issue because `<libgap perm>` does not know which parent a gap permutation lives in (and neither does gap iirc), while the second might be neglected in case we expect that we always get something reasonable fromo gap.



---

archive/issue_comments_355230.json:
```json
{
    "body": "OK, I see. Still, libgap should be using the low-level C array with GAP permutation data, \nrather than converting GAP list -> Sage list -> PermutationGroupElement\n(creating, if needed, a parent permutation group along the way, no?)\n\nI don't understand whether this involves calling pexpect GAP or not.",
    "created_at": "2018-06-06T13:04:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355230",
    "user": "https://github.com/dimpase"
}
```

OK, I see. Still, libgap should be using the low-level C array with GAP permutation data, 
rather than converting GAP list -> Sage list -> PermutationGroupElement
(creating, if needed, a parent permutation group along the way, no?)

I don't understand whether this involves calling pexpect GAP or not.



---

archive/issue_comments_355231.json:
```json
{
    "body": ">  I don't understand whether this involves calling pexpect GAP or not. \n\nWhat involved pexpect GAP? This creation of a `PermutationGroupElement`? Then the answer is **no**, there is no gap object attached by default to a `PermutationGroupElement`.",
    "created_at": "2018-06-06T13:09:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355231",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

>  I don't understand whether this involves calling pexpect GAP or not. 

What involved pexpect GAP? This creation of a `PermutationGroupElement`? Then the answer is **no**, there is no gap object attached by default to a `PermutationGroupElement`.



---

archive/issue_comments_355232.json:
```json
{
    "body": "Replying to [comment:60 stumpc5]:\n> >  I don't understand whether this involves calling pexpect GAP or not. \n> \n> What involved pexpect GAP? This creation of a `PermutationGroupElement`? Then the answer is **no**, there is no gap object attached by default to a `PermutationGroupElement`.\n\nOK, thanks - it's not immediately clear with all that methods using `_gap_` in that class.\n\nAnyhow, I don't understand why libGAP creates `PermutationGroupElement` rather than \na `Permutation`.\nIt would be natural to me to have this as the default,\nmostly as it does not involve constructing a parent (GAP permutations don't really have parents in GAP, they are all in every `SymmetricGroup()` of degree at least `LargestMovedPoint()` of the permutation.\nThen your hack can be used for fast libgap->Sage conversion of permutations.",
    "created_at": "2018-06-07T11:23:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355232",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:60 stumpc5]:
> >  I don't understand whether this involves calling pexpect GAP or not. 
> 
> What involved pexpect GAP? This creation of a `PermutationGroupElement`? Then the answer is **no**, there is no gap object attached by default to a `PermutationGroupElement`.

OK, thanks - it's not immediately clear with all that methods using `_gap_` in that class.

Anyhow, I don't understand why libGAP creates `PermutationGroupElement` rather than 
a `Permutation`.
It would be natural to me to have this as the default,
mostly as it does not involve constructing a parent (GAP permutations don't really have parents in GAP, they are all in every `SymmetricGroup()` of degree at least `LargestMovedPoint()` of the permutation.
Then your hack can be used for fast libgap->Sage conversion of permutations.



---

archive/issue_comments_355233.json:
```json
{
    "body": "> It would be natural to me to have this as the default\n\nI agree, this would get down the speed quite a bit\n\n```\nsage: P = PermutationGroup([(1,2),(1,2,3,4,5,6,7,8)])\nsage: l = [8,7,6,5,4,3,2,1]\nsage: %timeit P(l, check=False)\nThe slowest run took 7.58 times longer than the fastest. This could mean that an intermediate result is being cached.\n10000 loops, best of 3: 44.3 \u00b5s per loop\nsage: %timeit Permutation(l, check_input=False)\nThe slowest run took 7.85 times longer than the fastest. This could mean that an intermediate result is being cached.\n100000 loops, best of 3: 6.74 \u00b5s per loop\n```\n\nbut my hack would not work in this case because it uses the c structure underlying `PermutationGroupElement` which doesn't exist (caution: haven't rechecked!) for `Permutation`, and this hack is possibly still an order of magnitude faster\n\n```\nsage: one = P.one()\nsage: %timeit one._generate_new(l)\nThe slowest run took 128.70 times longer than the fastest. This could mean that an intermediate result is being cached.\n1000000 loops, best of 3: 241 ns per loop\n```\n",
    "created_at": "2018-06-07T12:19:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355233",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

> It would be natural to me to have this as the default

I agree, this would get down the speed quite a bit

```
sage: P = PermutationGroup([(1,2),(1,2,3,4,5,6,7,8)])
sage: l = [8,7,6,5,4,3,2,1]
sage: %timeit P(l, check=False)
The slowest run took 7.58 times longer than the fastest. This could mean that an intermediate result is being cached.
10000 loops, best of 3: 44.3 Âµs per loop
sage: %timeit Permutation(l, check_input=False)
The slowest run took 7.85 times longer than the fastest. This could mean that an intermediate result is being cached.
100000 loops, best of 3: 6.74 Âµs per loop
```

but my hack would not work in this case because it uses the c structure underlying `PermutationGroupElement` which doesn't exist (caution: haven't rechecked!) for `Permutation`, and this hack is possibly still an order of magnitude faster

```
sage: one = P.one()
sage: %timeit one._generate_new(l)
The slowest run took 128.70 times longer than the fastest. This could mean that an intermediate result is being cached.
1000000 loops, best of 3: 241 ns per loop
```




---

archive/issue_comments_355234.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-10T08:18:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355234",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355235.json:
```json
{
    "body": "Okay, now everything is as fast as I was expecting it to be possible! I now do not create a sage list from the libgap list and then fill a `<int*>` with this data, but create the latter directly from the libgap list entries. This removes all the overhead!\n\nHere are the new timings:\n\n```\nsage: p = [(i,i+1) for i in range(1,601,2)]\n....: q = [tuple(range(1+i,601,3)) for i in range(3)]\n....: A = PermutationGroup([p,q])\n....: A.cardinality()\n....: \n60000\nsage: i=0\nsage: %time for _ in A.__iter__(): i+=1\nCPU times: user 512 ms, sys: 40.3 ms, total: 552 ms\nWall time: 543 ms\nsage: i\n60000\nsage: i=0\nsage: %time for _ in A.__iter_alt__(): i+=1\nCPU times: user 132 ms, sys: 23.7 ms, total: 156 ms\nWall time: 137 ms\nsage: i\n60000\nsage: %time X = A.strong_generating_system(A.base())\nCPU times: user 3.5 s, sys: 675 ms, total: 4.17 s\nWall time: 4.22 s\nsage: [ len(x) for x in X ]\n[600, 100]\nsage: %time Y = A.strong_generating_system(implementation=\"gap\")\nCPU times: user 38.3 ms, sys: 129 \u00b5s, total: 38.5 ms\nWall time: 38.2 ms\nsage: [ len(y) for y in Y ]\n[1, 100, 600]\n```\n",
    "created_at": "2018-06-10T08:27:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355235",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Okay, now everything is as fast as I was expecting it to be possible! I now do not create a sage list from the libgap list and then fill a `<int*>` with this data, but create the latter directly from the libgap list entries. This removes all the overhead!

Here are the new timings:

```
sage: p = [(i,i+1) for i in range(1,601,2)]
....: q = [tuple(range(1+i,601,3)) for i in range(3)]
....: A = PermutationGroup([p,q])
....: A.cardinality()
....: 
60000
sage: i=0
sage: %time for _ in A.__iter__(): i+=1
CPU times: user 512 ms, sys: 40.3 ms, total: 552 ms
Wall time: 543 ms
sage: i
60000
sage: i=0
sage: %time for _ in A.__iter_alt__(): i+=1
CPU times: user 132 ms, sys: 23.7 ms, total: 156 ms
Wall time: 137 ms
sage: i
60000
sage: %time X = A.strong_generating_system(A.base())
CPU times: user 3.5 s, sys: 675 ms, total: 4.17 s
Wall time: 4.22 s
sage: [ len(x) for x in X ]
[600, 100]
sage: %time Y = A.strong_generating_system(implementation="gap")
CPU times: user 38.3 ms, sys: 129 Âµs, total: 38.5 ms
Wall time: 38.2 ms
sage: [ len(y) for y in Y ]
[1, 100, 600]
```




---

archive/issue_comments_355236.json:
```json
{
    "body": "I consider it **wrong** to define (as I did) the method `_generate_perm(self, old)` for `libGAP_List` (handing over a `PermutationGroupElement old`. I think it should rather exist a method `_generate_new_libgap(self, gaplst` for `PermutationGroupElement` that takes as input a `libGAP_List gaplst`.\n\nI was not able to do that due to import errors and my ignorance how to properly cast the objects into the correct types, but this seems only a matter of proper coding in `cython`. `@`Travis or `@`Dima, could you help with this?\n\nI think once this is settled, the code is ready for review!\n\n`@`Moritz: rather incredible speedup compared to your original call of `strong_generating_system`, hm?",
    "created_at": "2018-06-10T08:32:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355236",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

I consider it **wrong** to define (as I did) the method `_generate_perm(self, old)` for `libGAP_List` (handing over a `PermutationGroupElement old`. I think it should rather exist a method `_generate_new_libgap(self, gaplst` for `PermutationGroupElement` that takes as input a `libGAP_List gaplst`.

I was not able to do that due to import errors and my ignorance how to properly cast the objects into the correct types, but this seems only a matter of proper coding in `cython`. `@`Travis or `@`Dima, could you help with this?

I think once this is settled, the code is ready for review!

`@`Moritz: rather incredible speedup compared to your original call of `strong_generating_system`, hm?



---

archive/issue_comments_355237.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2018-06-10T08:32:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355237",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_355238.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-10T08:36:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355238",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355239.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-10T08:38:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355239",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355240.json:
```json
{
    "body": "I can probably try it late tomorrow or the day after (I promised Darij I would review #25326 first). So Dima, let me know if you are going to work on this tomorrow.",
    "created_at": "2018-06-10T09:00:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355240",
    "user": "https://github.com/tscrim"
}
```

I can probably try it late tomorrow or the day after (I promised Darij I would review #25326 first). So Dima, let me know if you are going to work on this tomorrow.



---

archive/issue_comments_355241.json:
```json
{
    "body": "Replying to [comment:65 stumpc5]:\n> `@`Moritz: rather incredible speedup compared to your original call of `strong_generating_system`, hm?\nYes, absolutely great! As I see it, the new `__iter_alt_` method is now faster then `__iter__` in all cases, right? Therefore I propose to replace `__iter__` with the `__iter_alt__` before puuting this ticket on review.",
    "created_at": "2018-06-11T08:40:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355241",
    "user": "https://github.com/mo271"
}
```

Replying to [comment:65 stumpc5]:
> `@`Moritz: rather incredible speedup compared to your original call of `strong_generating_system`, hm?
Yes, absolutely great! As I see it, the new `__iter_alt_` method is now faster then `__iter__` in all cases, right? Therefore I propose to replace `__iter__` with the `__iter_alt__` before puuting this ticket on review.



---

archive/issue_comments_355242.json:
```json
{
    "body": "No, not quite. The new `__iter_alt__` is still slower for small groups (size ~ <500 elts). I still propose to use `___iter_alt__` per default, but leave the option to use the brute force iteration if desired (in case you want to loop through **many** small groups.\n\nThe issue is that if the group is really small, waiting even for a tiny information from `libgap` is slower than exploring the group directly.",
    "created_at": "2018-06-11T08:43:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355242",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

No, not quite. The new `__iter_alt__` is still slower for small groups (size ~ <500 elts). I still propose to use `___iter_alt__` per default, but leave the option to use the brute force iteration if desired (in case you want to loop through **many** small groups.

The issue is that if the group is really small, waiting even for a tiny information from `libgap` is slower than exploring the group directly.



---

archive/issue_comments_355243.json:
```json
{
    "body": "Replying to [comment:68 tscrim]:\n> I can probably try it late tomorrow or the day after (I promised Darij I would review #25326 first). So Dima, let me know if you are going to work on this tomorrow.\n\nI suggest that the documentation says that libGAP (rather than just GAP) is used.\nThat's all for me for the time being (swamped with other things).",
    "created_at": "2018-06-11T09:47:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355243",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:68 tscrim]:
> I can probably try it late tomorrow or the day after (I promised Darij I would review #25326 first). So Dima, let me know if you are going to work on this tomorrow.

I suggest that the documentation says that libGAP (rather than just GAP) is used.
That's all for me for the time being (swamped with other things).



---

archive/issue_comments_355244.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-11T10:02:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355244",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355245.json:
```json
{
    "body": "What is the current state here?",
    "created_at": "2018-06-18T14:25:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355245",
    "user": "https://github.com/dimpase"
}
```

What is the current state here?



---

archive/issue_comments_355246.json:
```json
{
    "body": "Replying to [comment:65 stumpc5]:\n> I consider it **wrong** to define (as I did) the method `_generate_perm(self, old)` for `libGAP_List` (handing over a `PermutationGroupElement old`. I think it should rather exist a method `_generate_new_libgap(self, gaplst` for `PermutationGroupElement` that takes as input a `libGAP_List gaplst`.\n> \n> I was not able to do that due to import errors and my ignorance how to properly cast the objects into the correct types, but this seems only a matter of proper coding in `cython`. `@`Travis or `@`Dima, could you help with this?\n\nI am still waiting for someone to have a look at this...\n\nIn principle, I think this implementation is a strong improvement to permutation groups in Sage, and since I am not very good in optimizing in cython, there might a few simple improvements left to be found. I don't think it is ready for a positive review, but it certainly is for a review of the technical details.",
    "created_at": "2018-06-18T14:30:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355246",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Replying to [comment:65 stumpc5]:
> I consider it **wrong** to define (as I did) the method `_generate_perm(self, old)` for `libGAP_List` (handing over a `PermutationGroupElement old`. I think it should rather exist a method `_generate_new_libgap(self, gaplst` for `PermutationGroupElement` that takes as input a `libGAP_List gaplst`.
> 
> I was not able to do that due to import errors and my ignorance how to properly cast the objects into the correct types, but this seems only a matter of proper coding in `cython`. `@`Travis or `@`Dima, could you help with this?

I am still waiting for someone to have a look at this...

In principle, I think this implementation is a strong improvement to permutation groups in Sage, and since I am not very good in optimizing in cython, there might a few simple improvements left to be found. I don't think it is ready for a positive review, but it certainly is for a review of the technical details.



---

archive/issue_comments_355247.json:
```json
{
    "body": "Replying to [comment:74 stumpc5]:\n> Replying to [comment:65 stumpc5]:\n> > I consider it **wrong** to define (as I did) the method `_generate_perm(self, old)` for `libGAP_List` (handing over a `PermutationGroupElement old`. I think it should rather exist a method `_generate_new_libgap(self, gaplst` for `PermutationGroupElement` that takes as input a `libGAP_List gaplst`.\n> > \n> > I was not able to do that due to import errors and my ignorance how to properly cast the objects into the correct types, but this seems only a matter of proper coding in `cython`. `@`Travis or `@`Dima, could you help with this?\n> \n> I am still waiting for someone to have a look at this...\n\nCould you post a branch with this import problem?\nIt'd be much quicker to see what's going on this way?\n(it need not become the new branch on this ticket, certainly)",
    "created_at": "2018-06-18T14:55:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355247",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:74 stumpc5]:
> Replying to [comment:65 stumpc5]:
> > I consider it **wrong** to define (as I did) the method `_generate_perm(self, old)` for `libGAP_List` (handing over a `PermutationGroupElement old`. I think it should rather exist a method `_generate_new_libgap(self, gaplst` for `PermutationGroupElement` that takes as input a `libGAP_List gaplst`.
> > 
> > I was not able to do that due to import errors and my ignorance how to properly cast the objects into the correct types, but this seems only a matter of proper coding in `cython`. `@`Travis or `@`Dima, could you help with this?
> 
> I am still waiting for someone to have a look at this...

Could you post a branch with this import problem?
It'd be much quicker to see what's going on this way?
(it need not become the new branch on this ticket, certainly)



---

archive/issue_comments_355248.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-18T15:09:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355248",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355249.json:
```json
{
    "body": "> Could you post a branch with this import problem? It'd be much quicker to see what's going on this way?\n\nI had deleted that attempt, but it was basically what I just pushed. My problem was that I didn't see how to handle `libGAP_INT_INTOBJ, libGAP_ELM_LIST` inside `permgroup_element.pyx`.\n----\nNew commits:",
    "created_at": "2018-06-18T15:10:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355249",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

> Could you post a branch with this import problem? It'd be much quicker to see what's going on this way?

I had deleted that attempt, but it was basically what I just pushed. My problem was that I didn't see how to handle `libGAP_INT_INTOBJ, libGAP_ELM_LIST` inside `permgroup_element.pyx`.
----
New commits:



---

archive/issue_comments_355250.json:
```json
{
    "body": "for starters, I think you need\n\n```\n+++ b/src/sage/groups/perm_gps/permgroup_element.pyx\n@@ -77,7 +77,7 @@ from sage.sets.finite_enumerated_set import FiniteEnumeratedSet\n import sage.structure.coerce as coerce\n from sage.structure.richcmp cimport richcmp_not_equal, rich_to_bool\n \n-from sage.libs.gap.element cimport libGAP_Obj, libGAP_INT_INTOBJ, libGAP_ELM_LIST\n+from sage.libs.gap.gap_includes cimport libGAP_Obj, libGAP_INT_INTOBJ, libGAP_ELM_LIST\n \n import operator\n \n```\n\n\nafter this one gets\n\n```\n[sagelib-8.3.beta5] Error compiling Cython file:\n[sagelib-8.3.beta5] ------------------------------------------------------------\n[sagelib-8.3.beta5] ...\n[sagelib-8.3.beta5]         for i from vn <= i < old.n:\n[sagelib-8.3.beta5]             new.perm[i] = i\n[sagelib-8.3.beta5]         return new\n[sagelib-8.3.beta5] \n[sagelib-8.3.beta5]     cpdef _generate_new_GAP(old, self):\n[sagelib-8.3.beta5]         cdef libGAP_Obj obj = self.value\n[sagelib-8.3.beta5]                                  ^\n[sagelib-8.3.beta5] ------------------------------------------------------------\n[sagelib-8.3.beta5] \n[sagelib-8.3.beta5] sage/groups/perm_gps/permgroup_element.pyx:894:34: Cannot convert Python object to 'libGAP_Obj'\n[sagelib-8.3.beta5] Traceback (most recent call last):\n[sagelib-8.3.beta5]   File \"/home/dima/sagetrac-mirror/local/lib/python2.7/site-packages/Cython/Build/Dependencies.py\", line 1164, in cythonize_one_helper\n[sagelib-8.3.beta5]     return cythonize_one(*m)\n[sagelib-8.3.beta5]   File \"/home/dima/sagetrac-mirror/local/lib/python2.7/site-packages/Cython/Build/Dependencies.py\", line 1146, in cythonize_one\n[sagelib-8.3.beta5]     raise CompileError(None, pyx_file)\n[sagelib-8.3.beta5] CompileError: sage/groups/perm_gps/permgroup_element.pyx\n```\n\n\nwhich hopefully makes sense to you.",
    "created_at": "2018-06-19T09:26:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355250",
    "user": "https://github.com/dimpase"
}
```

for starters, I think you need

```
+++ b/src/sage/groups/perm_gps/permgroup_element.pyx
@@ -77,7 +77,7 @@ from sage.sets.finite_enumerated_set import FiniteEnumeratedSet
 import sage.structure.coerce as coerce
 from sage.structure.richcmp cimport richcmp_not_equal, rich_to_bool
 
-from sage.libs.gap.element cimport libGAP_Obj, libGAP_INT_INTOBJ, libGAP_ELM_LIST
+from sage.libs.gap.gap_includes cimport libGAP_Obj, libGAP_INT_INTOBJ, libGAP_ELM_LIST
 
 import operator
 
```


after this one gets

```
[sagelib-8.3.beta5] Error compiling Cython file:
[sagelib-8.3.beta5] ------------------------------------------------------------
[sagelib-8.3.beta5] ...
[sagelib-8.3.beta5]         for i from vn <= i < old.n:
[sagelib-8.3.beta5]             new.perm[i] = i
[sagelib-8.3.beta5]         return new
[sagelib-8.3.beta5] 
[sagelib-8.3.beta5]     cpdef _generate_new_GAP(old, self):
[sagelib-8.3.beta5]         cdef libGAP_Obj obj = self.value
[sagelib-8.3.beta5]                                  ^
[sagelib-8.3.beta5] ------------------------------------------------------------
[sagelib-8.3.beta5] 
[sagelib-8.3.beta5] sage/groups/perm_gps/permgroup_element.pyx:894:34: Cannot convert Python object to 'libGAP_Obj'
[sagelib-8.3.beta5] Traceback (most recent call last):
[sagelib-8.3.beta5]   File "/home/dima/sagetrac-mirror/local/lib/python2.7/site-packages/Cython/Build/Dependencies.py", line 1164, in cythonize_one_helper
[sagelib-8.3.beta5]     return cythonize_one(*m)
[sagelib-8.3.beta5]   File "/home/dima/sagetrac-mirror/local/lib/python2.7/site-packages/Cython/Build/Dependencies.py", line 1146, in cythonize_one
[sagelib-8.3.beta5]     raise CompileError(None, pyx_file)
[sagelib-8.3.beta5] CompileError: sage/groups/perm_gps/permgroup_element.pyx
```


which hopefully makes sense to you.



---

archive/issue_comments_355251.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-19T09:37:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355251",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355252.json:
```json
{
    "body": "okay, here is the next one that doesn't. It now compiles but crashes on startup with the following import error:\n\n\n```\nImportError: /home/stumpc5/Programs/sage/local/lib/python2.7/site-packages/sage/groups/perm_gps/permgroup_element.so: undefined symbol: libGAP_ElmListFuncs\n```\n",
    "created_at": "2018-06-19T09:39:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355252",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

okay, here is the next one that doesn't. It now compiles but crashes on startup with the following import error:


```
ImportError: /home/stumpc5/Programs/sage/local/lib/python2.7/site-packages/sage/groups/perm_gps/permgroup_element.so: undefined symbol: libGAP_ElmListFuncs
```




---

archive/issue_comments_355253.json:
```json
{
    "body": "You have this line:\n\n```\ncdef GapElement_List self = <GapElement_List> self_tmp\n```\n\nwhich does not make sense to me. Is it mean to be a C cast?\nSomething else?",
    "created_at": "2018-06-19T10:13:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355253",
    "user": "https://github.com/dimpase"
}
```

You have this line:

```
cdef GapElement_List self = <GapElement_List> self_tmp
```

which does not make sense to me. Is it mean to be a C cast?
Something else?



---

archive/issue_comments_355254.json:
```json
{
    "body": "Yes, it is meant to be a C cast: `self_tmp` (sorry for the stupid names, I would make these nicer once it works) arrives as a python object because it is a `cpdef`, so to access its \"C part\", I needed to do this (actually without the `<GapElement_List>` cast, but only the `cdef GapElement_List self = self_tmp` iirc.",
    "created_at": "2018-06-19T10:21:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355254",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Yes, it is meant to be a C cast: `self_tmp` (sorry for the stupid names, I would make these nicer once it works) arrives as a python object because it is a `cpdef`, so to access its "C part", I needed to do this (actually without the `<GapElement_List>` cast, but only the `cdef GapElement_List self = self_tmp` iirc.



---

archive/issue_comments_355255.json:
```json
{
    "body": "Replying to [comment:82 stumpc5]:\n> Yes, it is meant to be a C cast: `self_tmp` (sorry for the stupid names, I would make these nicer once it works) arrives as a python object because it is a `cpdef`, \n\nI would be very surprised seeing a C cast magically converting a Python object into a GAP one. \n\n> so to access its \"C part\", I needed to do this (actually without the `<GapElement_List>` cast, but only the `cdef GapElement_List self = self_tmp` iirc.",
    "created_at": "2018-06-19T10:31:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355255",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:82 stumpc5]:
> Yes, it is meant to be a C cast: `self_tmp` (sorry for the stupid names, I would make these nicer once it works) arrives as a python object because it is a `cpdef`, 

I would be very surprised seeing a C cast magically converting a Python object into a GAP one. 

> so to access its "C part", I needed to do this (actually without the `<GapElement_List>` cast, but only the `cdef GapElement_List self = self_tmp` iirc.



---

archive/issue_comments_355256.json:
```json
{
    "body": ">  I would be very surprised seeing a C cast magically converting a Python object into a GAP one. \n\nWell, please see that the very same code in `sage.libs.gap.element.GapElement_List._generate_perm` works, and it doesn't without the cast `cdef PermutationGroupElement tmp = <PermutationGroupElement> old`. I thought this is because it arrives as a python object `PermutationGroupElement` (which doesn't have access to the cython data structures) and I cast it into a cython object.",
    "created_at": "2018-06-19T11:14:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355256",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

>  I would be very surprised seeing a C cast magically converting a Python object into a GAP one. 

Well, please see that the very same code in `sage.libs.gap.element.GapElement_List._generate_perm` works, and it doesn't without the cast `cdef PermutationGroupElement tmp = <PermutationGroupElement> old`. I thought this is because it arrives as a python object `PermutationGroupElement` (which doesn't have access to the cython data structures) and I cast it into a cython object.



---

archive/issue_comments_355257.json:
```json
{
    "body": "Does one really need to make it cpdef? Perhaps start with cdef, make a cpdef wrapper then?",
    "created_at": "2018-06-19T11:41:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355257",
    "user": "https://github.com/dimpase"
}
```

Does one really need to make it cpdef? Perhaps start with cdef, make a cpdef wrapper then?



---

archive/issue_comments_355258.json:
```json
{
    "body": "now I am confused. The current branch works for me.",
    "created_at": "2018-06-19T12:04:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355258",
    "user": "https://github.com/dimpase"
}
```

now I am confused. The current branch works for me.



---

archive/issue_comments_355259.json:
```json
{
    "body": "> now I am confused. The current branch works for me.\n\ncompiling, or also running sage? I got the import error as in comment:80 only when running sage.\n\n> Does one really need to make it cpdef? Perhaps start with cdef, make a cpdef wrapper then?\n\nI could try this, but it seems so simple: I have a cpdef function on class A that takes an element of class B as second argument, and I want to move this to a cpdef function on class B that takes an element of class A as second argument...",
    "created_at": "2018-06-19T12:13:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355259",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

> now I am confused. The current branch works for me.

compiling, or also running sage? I got the import error as in comment:80 only when running sage.

> Does one really need to make it cpdef? Perhaps start with cdef, make a cpdef wrapper then?

I could try this, but it seems so simple: I have a cpdef function on class A that takes an element of class B as second argument, and I want to move this to a cpdef function on class B that takes an element of class A as second argument...



---

archive/issue_comments_355260.json:
```json
{
    "body": "OK, more precisely, all is fine on OSX, but on Linux Sage crashes at startup, with the import error as you posted!\n\nfrom the crash report:\n\n```\n...\n/home/dima/sagetrac-mirror/local/lib/python2.7/site-packages/sage/groups/perm_gps/permgroup.py in <module>()\n    131 #  Distributed under the terms of the GNU General Public License (GPL)\n...\n    145 from sage.interfaces.gap import gap, GapElement\n--> 146 from sage.groups.perm_gps.permgroup_element import PermutationGroupElement, standardize_generator\n        global sage.groups.perm_gps.permgroup_element = undefined\n...\n\nImportError: /home/dima/sagetrac-mirror/local/lib/python2.7/site-packages/sage/groups/perm_gps/permgroup_element.so: undefined symbol: libGAP_ElmListFuncs\n```\n",
    "created_at": "2018-06-19T12:19:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355260",
    "user": "https://github.com/dimpase"
}
```

OK, more precisely, all is fine on OSX, but on Linux Sage crashes at startup, with the import error as you posted!

from the crash report:

```
...
/home/dima/sagetrac-mirror/local/lib/python2.7/site-packages/sage/groups/perm_gps/permgroup.py in <module>()
    131 #  Distributed under the terms of the GNU General Public License (GPL)
...
    145 from sage.interfaces.gap import gap, GapElement
--> 146 from sage.groups.perm_gps.permgroup_element import PermutationGroupElement, standardize_generator
        global sage.groups.perm_gps.permgroup_element = undefined
...

ImportError: /home/dima/sagetrac-mirror/local/lib/python2.7/site-packages/sage/groups/perm_gps/permgroup_element.so: undefined symbol: libGAP_ElmListFuncs
```




---

archive/issue_comments_355261.json:
```json
{
    "body": "And this is not a surprise:\n\n```\n$ ldd local/lib/python2.7/site-packages/sage/groups/perm_gps/permgroup_element.so\n        linux-vdso.so.1 =>  (0x00007fffe53f0000)\n        libpython2.7.so.1.0 => /home/dima/sagetrac-mirror/local/lib/libpython2.7.so.1.0 (0x00007c9a2c87c000)\n        libpthread.so.0 => /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007c9a2c65f000)\n        libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007c9a2c295000)\n        libdl.so.2 => /lib/x86_64-linux-gnu/libdl.so.2 (0x00007c9a2c091000)\n        libutil.so.1 => /lib/x86_64-linux-gnu/libutil.so.1 (0x00007c9a2be8e000)\n        libm.so.6 => /lib/x86_64-linux-gnu/libm.so.6 (0x00007c9a2bb85000)\n        /lib64/ld-linux-x86-64.so.2 (0x00007c9a2cedf000)\n```\n\nit is not linked with libgap, that's why.",
    "created_at": "2018-06-19T12:28:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355261",
    "user": "https://github.com/dimpase"
}
```

And this is not a surprise:

```
$ ldd local/lib/python2.7/site-packages/sage/groups/perm_gps/permgroup_element.so
        linux-vdso.so.1 =>  (0x00007fffe53f0000)
        libpython2.7.so.1.0 => /home/dima/sagetrac-mirror/local/lib/libpython2.7.so.1.0 (0x00007c9a2c87c000)
        libpthread.so.0 => /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007c9a2c65f000)
        libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007c9a2c295000)
        libdl.so.2 => /lib/x86_64-linux-gnu/libdl.so.2 (0x00007c9a2c091000)
        libutil.so.1 => /lib/x86_64-linux-gnu/libutil.so.1 (0x00007c9a2be8e000)
        libm.so.6 => /lib/x86_64-linux-gnu/libm.so.6 (0x00007c9a2bb85000)
        /lib64/ld-linux-x86-64.so.2 (0x00007c9a2cedf000)
```

it is not linked with libgap, that's why.



---

archive/issue_comments_355262.json:
```json
{
    "body": "I have no idea what that means! (Or rather how to fix this.)",
    "created_at": "2018-06-19T12:32:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355262",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

I have no idea what that means! (Or rather how to fix this.)



---

archive/issue_comments_355263.json:
```json
{
    "body": "Compare this with the libgap.so extension:\n\n```\n$ ldd local/lib/python2.7/site-packages/sage/libs/gap/libgap.so \n        linux-vdso.so.1 =>  (0x00007ffe0d3fd000)\n        libgap.so.4 => /home/dima/sagetrac-mirror/local/lib/libgap.so.4 (0x00007f4959fa5000)\n        libpython2.7.so.1.0 => /home/dima/sagetrac-mirror/local/lib/libpython2.7.so.1.0 (0x00007f4959b85000)\n        libpthread.so.0 => /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007f4959968000)\n        libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007f495959e000)\n        libm.so.6 => /lib/x86_64-linux-gnu/libm.so.6 (0x00007f4959295000)\n        libdl.so.2 => /lib/x86_64-linux-gnu/libdl.so.2 (0x00007f4959091000)\n        libutil.so.1 => /lib/x86_64-linux-gnu/libutil.so.1 (0x00007f4958e8e000)\n        /lib64/ld-linux-x86-64.so.2 (0x00007f495ac26000)\n```\n\n\nyou see there libgap.so.4, so it can find the symbols there...\n\nSurely it's some declaration missing somewhere, and that's all.\nOr, perhaps, the corresponding GAP function should somehow be blessed in libgap extension.",
    "created_at": "2018-06-19T12:36:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355263",
    "user": "https://github.com/dimpase"
}
```

Compare this with the libgap.so extension:

```
$ ldd local/lib/python2.7/site-packages/sage/libs/gap/libgap.so 
        linux-vdso.so.1 =>  (0x00007ffe0d3fd000)
        libgap.so.4 => /home/dima/sagetrac-mirror/local/lib/libgap.so.4 (0x00007f4959fa5000)
        libpython2.7.so.1.0 => /home/dima/sagetrac-mirror/local/lib/libpython2.7.so.1.0 (0x00007f4959b85000)
        libpthread.so.0 => /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007f4959968000)
        libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007f495959e000)
        libm.so.6 => /lib/x86_64-linux-gnu/libm.so.6 (0x00007f4959295000)
        libdl.so.2 => /lib/x86_64-linux-gnu/libdl.so.2 (0x00007f4959091000)
        libutil.so.1 => /lib/x86_64-linux-gnu/libutil.so.1 (0x00007f4958e8e000)
        /lib64/ld-linux-x86-64.so.2 (0x00007f495ac26000)
```


you see there libgap.so.4, so it can find the symbols there...

Surely it's some declaration missing somewhere, and that's all.
Or, perhaps, the corresponding GAP function should somehow be blessed in libgap extension.



---

archive/issue_comments_355264.json:
```json
{
    "body": "Does this mean I should rather not move the method and keep the current version?",
    "created_at": "2018-06-19T12:40:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355264",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Does this mean I should rather not move the method and keep the current version?



---

archive/issue_comments_355265.json:
```json
{
    "body": "No, this just means we have to ask people who know Cython better.\nIt must be totally trivial to fix.\n\nI have an idea how it is done via setup.py, but here it's done in some other way, and cannot see any trace anywhere of how and why libgap.so extension gets linked to the correct dynamic library.",
    "created_at": "2018-06-19T12:53:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355265",
    "user": "https://github.com/dimpase"
}
```

No, this just means we have to ask people who know Cython better.
It must be totally trivial to fix.

I have an idea how it is done via setup.py, but here it's done in some other way, and cannot see any trace anywhere of how and why libgap.so extension gets linked to the correct dynamic library.



---

archive/issue_comments_355266.json:
```json
{
    "body": "I've asked here: https://groups.google.com/d/msg/sage-devel/_d28OHHsnE4/WnYr1L6NCAAJ",
    "created_at": "2018-06-19T13:06:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355266",
    "user": "https://github.com/dimpase"
}
```

I've asked here: https://groups.google.com/d/msg/sage-devel/_d28OHHsnE4/WnYr1L6NCAAJ



---

archive/issue_comments_355267.json:
```json
{
    "body": "here is a fix that makes it work:\n\n```\n$ git diff\ndiff --git a/src/sage/groups/perm_gps/permgroup_element.pxd b/src/sage/groups/perm_gps/permgroup_element.pxd\nindex 08a928b..e261780 100644\n--- a/src/sage/groups/perm_gps/permgroup_element.pxd\n+++ b/src/sage/groups/perm_gps/permgroup_element.pxd\n@@ -1,3 +1,4 @@\n+# distutils: libraries = gap\n from sage.structure.element cimport MultiplicativeGroupElement, MonoidElement, Element\n from sage.structure.list_clone cimport ClonableIntArray\n```\n\n(at least with this I can start sage all right)\n\nPS. Tests pass, too.",
    "created_at": "2018-06-19T13:36:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355267",
    "user": "https://github.com/dimpase"
}
```

here is a fix that makes it work:

```
$ git diff
diff --git a/src/sage/groups/perm_gps/permgroup_element.pxd b/src/sage/groups/perm_gps/permgroup_element.pxd
index 08a928b..e261780 100644
--- a/src/sage/groups/perm_gps/permgroup_element.pxd
+++ b/src/sage/groups/perm_gps/permgroup_element.pxd
@@ -1,3 +1,4 @@
+# distutils: libraries = gap
 from sage.structure.element cimport MultiplicativeGroupElement, MonoidElement, Element
 from sage.structure.list_clone cimport ClonableIntArray
```

(at least with this I can start sage all right)

PS. Tests pass, too.



---

archive/issue_comments_355268.json:
```json
{
    "body": "Replying to [comment:95 dimpase]:\n> here is a fix that makes it work:\n> {{{\n> $ git diff\n> diff --git a/src/sage/groups/perm_gps/permgroup_element.pxd b/src/sage/groups/perm_gps/permgroup_element.pxd\n> index 08a928b..e261780 100644\n> --- a/src/sage/groups/perm_gps/permgroup_element.pxd\n> +++ b/src/sage/groups/perm_gps/permgroup_element.pxd\n> `@``@` -1,3 +1,4 `@``@`\n> +# distutils: libraries = gap\n>  from sage.structure.element cimport MultiplicativeGroupElement, MonoidElement, Element\n>  from sage.structure.list_clone cimport ClonableIntArray\n> }}}\n\nThat fix shouldn't be needed (I created #25608 for that).",
    "created_at": "2018-06-19T13:59:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355268",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:95 dimpase]:
> here is a fix that makes it work:
> {{{
> $ git diff
> diff --git a/src/sage/groups/perm_gps/permgroup_element.pxd b/src/sage/groups/perm_gps/permgroup_element.pxd
> index 08a928b..e261780 100644
> --- a/src/sage/groups/perm_gps/permgroup_element.pxd
> +++ b/src/sage/groups/perm_gps/permgroup_element.pxd
> `@``@` -1,3 +1,4 `@``@`
> +# distutils: libraries = gap
>  from sage.structure.element cimport MultiplicativeGroupElement, MonoidElement, Element
>  from sage.structure.list_clone cimport ClonableIntArray
> }}}

That fix shouldn't be needed (I created #25608 for that).



---

archive/issue_comments_355269.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-19T14:00:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355269",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355270.json:
```json
{
    "body": "Okay, the method move is now finished, setting it back to review. Still open to see (maybe `@`tscrim?) if there is a \"simple\" way to further speed `_generate_new` and `_generate_new_GAP` in `permgroup_element`.",
    "created_at": "2018-06-19T14:03:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355270",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Okay, the method move is now finished, setting it back to review. Still open to see (maybe `@`tscrim?) if there is a "simple" way to further speed `_generate_new` and `_generate_new_GAP` in `permgroup_element`.



---

archive/issue_comments_355271.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2018-06-19T14:03:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355271",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_355272.json:
```json
{
    "body": "Adding `# distutils: gap` to `src/sage/groups/perm_gps/permgroup_element.pxd` is not correct since `permgroup_element.pxd` has nothing to do with libGAP. Only the *implementation* requires libGAP, so the distutils declaration should be in the `.pyx` file.\n\nBut really, you should just use #25608 instead and not add `# distutils: gap`.",
    "created_at": "2018-06-19T14:43:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355272",
    "user": "https://github.com/jdemeyer"
}
```

Adding `# distutils: gap` to `src/sage/groups/perm_gps/permgroup_element.pxd` is not correct since `permgroup_element.pxd` has nothing to do with libGAP. Only the *implementation* requires libGAP, so the distutils declaration should be in the `.pyx` file.

But really, you should just use #25608 instead and not add `# distutils: gap`.



---

archive/issue_comments_355273.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-06-19T14:43:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355273",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_355274.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-19T14:56:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355274",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355275.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-19T15:00:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355275",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355276.json:
```json
{
    "body": "1. You should use `range()` instead of this out-dated syntax:\n\n```\nfor i from 0 <= i < vn:\n```\n\n\n2. Are you certain that `cdef int vn = lst.__len__()` won't overflow? As far as I know, both Python and libGAP support lists with over 2<sup>32</sup> elements. Better use `Py_ssize_t`, which is anyway the standard CPython type for lengths.\n\n3. Why did you write `lst.__len__()` instead of `len(lst)`?\n\n4. Why are the new methods `cpdef` instead of `def`? They are not called from Cython, so that's only a pessimization.\n\n5. Why `cdef PermutationGroupElement tmp = <PermutationGroupElement> self`?\n\n6. This is dangerous: `<GapElement_List> lst_in` since you don't know that `lst_in` is a `GapElement_List`. Either do an explicit `isinstance()` check or use `<GapElement_List?>lst_in`.",
    "created_at": "2018-06-19T15:01:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355276",
    "user": "https://github.com/jdemeyer"
}
```

1. You should use `range()` instead of this out-dated syntax:

```
for i from 0 <= i < vn:
```


2. Are you certain that `cdef int vn = lst.__len__()` won't overflow? As far as I know, both Python and libGAP support lists with over 2<sup>32</sup> elements. Better use `Py_ssize_t`, which is anyway the standard CPython type for lengths.

3. Why did you write `lst.__len__()` instead of `len(lst)`?

4. Why are the new methods `cpdef` instead of `def`? They are not called from Cython, so that's only a pessimization.

5. Why `cdef PermutationGroupElement tmp = <PermutationGroupElement> self`?

6. This is dangerous: `<GapElement_List> lst_in` since you don't know that `lst_in` is a `GapElement_List`. Either do an explicit `isinstance()` check or use `<GapElement_List?>lst_in`.



---

archive/issue_comments_355277.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-19T15:05:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355277",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355278.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-19T15:11:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355278",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355279.json:
```json
{
    "body": "Replying to [comment:103 jdemeyer]:\n> 1. You should use `range()` instead of this out-dated syntax:\n\ndone\n\n> 2. Are you certain that `cdef int vn = lst.__len__()` won't overflow? As far as I know, libGAP supports lists with over `2<sup>32</sup>` elements. Better use `Py_ssize_t`, which is anyway the standard CPython type for lengths.\n\ndone\n\n> 3. Why did you write `lst.__len__()` instead of `len(lst)`?\n\ndoesn't the second call the first? I thought that I'd rather use the first then.\n\n> 4. Why are the new methods `cpdef` instead of `def`? They are not called from Cython, so that's only a pessimization.\n\nmy impression is that these are now the fastest way to create new permutations in sage, so I want to propagate their use, especially in critical cythonized places.\n\n>\n> 5. Why `cdef PermutationGroupElement tmp = <PermutationGroupElement> self`?\n\nremoved\n\n> 6. This is dangerous: `<GapElement_List> lst_in` since you don't know that `lst_in` is a `GapElement_List`. Either do an explicit `isinstance()` check or use `<GapElement_List?>lst_in`.\n\nI would like to do `cpdef _generate_new_GAP(self, GapElement_List lst_in)` but do not know how\n----\nNew commits:",
    "created_at": "2018-06-19T15:12:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355279",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Replying to [comment:103 jdemeyer]:
> 1. You should use `range()` instead of this out-dated syntax:

done

> 2. Are you certain that `cdef int vn = lst.__len__()` won't overflow? As far as I know, libGAP supports lists with over `2<sup>32</sup>` elements. Better use `Py_ssize_t`, which is anyway the standard CPython type for lengths.

done

> 3. Why did you write `lst.__len__()` instead of `len(lst)`?

doesn't the second call the first? I thought that I'd rather use the first then.

> 4. Why are the new methods `cpdef` instead of `def`? They are not called from Cython, so that's only a pessimization.

my impression is that these are now the fastest way to create new permutations in sage, so I want to propagate their use, especially in critical cythonized places.

>
> 5. Why `cdef PermutationGroupElement tmp = <PermutationGroupElement> self`?

removed

> 6. This is dangerous: `<GapElement_List> lst_in` since you don't know that `lst_in` is a `GapElement_List`. Either do an explicit `isinstance()` check or use `<GapElement_List?>lst_in`.

I would like to do `cpdef _generate_new_GAP(self, GapElement_List lst_in)` but do not know how
----
New commits:



---

archive/issue_comments_355280.json:
```json
{
    "body": "I don't understand why you're moving things back and forth - don't you want to provide an optimised replacement for `GapElement_Permutation` in `sage.libs.gap.element` ?",
    "created_at": "2018-06-19T15:20:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355280",
    "user": "https://github.com/dimpase"
}
```

I don't understand why you're moving things back and forth - don't you want to provide an optimised replacement for `GapElement_Permutation` in `sage.libs.gap.element` ?



---

archive/issue_comments_355281.json:
```json
{
    "body": "No, I want to obtain an optimized way to create a `PermutationGroupElement` from a `GapElement_Permutation` given that I have given a permutation group element of the same parent. This thus became a method for `PermutationGroupElement` with argument `GapElement_List`. In particular, I have this method now for python lists and for gap list.\n\nAs a byproduct, one may call this from the `one` of the parent if only the parent is given but not the element.\n\nSee that this later is indeed slower:\n\n```\nsage: P = PermutationGroup([(1,2),(1,2,3,4,5,6,7,8)])\nsage: one = P.one()\nsage: perm = libgap.eval('[]')\nsage: %timeit one._generate_new_GAP(perm)\nThe slowest run took 138.45 times longer than the fastest. This could mean that an intermediate result is being cached.\n1000000 loops, best of 3: 174 ns per loop\nsage: %timeit P.one()._generate_new_GAP(perm)\nThe slowest run took 77.00 times longer than the fastest. This could mean that an intermediate result is being cached.\n1000000 loops, best of 3: 220 ns per loop\n```\n",
    "created_at": "2018-06-19T15:35:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355281",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

No, I want to obtain an optimized way to create a `PermutationGroupElement` from a `GapElement_Permutation` given that I have given a permutation group element of the same parent. This thus became a method for `PermutationGroupElement` with argument `GapElement_List`. In particular, I have this method now for python lists and for gap list.

As a byproduct, one may call this from the `one` of the parent if only the parent is given but not the element.

See that this later is indeed slower:

```
sage: P = PermutationGroup([(1,2),(1,2,3,4,5,6,7,8)])
sage: one = P.one()
sage: perm = libgap.eval('[]')
sage: %timeit one._generate_new_GAP(perm)
The slowest run took 138.45 times longer than the fastest. This could mean that an intermediate result is being cached.
1000000 loops, best of 3: 174 ns per loop
sage: %timeit P.one()._generate_new_GAP(perm)
The slowest run took 77.00 times longer than the fastest. This could mean that an intermediate result is being cached.
1000000 loops, best of 3: 220 ns per loop
```




---

archive/issue_comments_355282.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-03T13:37:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355282",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355283.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-03T14:30:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355283",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355284.json:
```json
{
    "body": "Again ready for review!\n\n> > 6. This is dangerous: `<GapElement_List> lst_in` since you don't know that `lst_in` is a `GapElement_List`. Either do an explicit `isinstance()` check or use `<GapElement_List?>lst_in`.\n> \n> I would like to do `cpdef _generate_new_GAP(self, GapElement_List lst_in)` but do not know how\n\nthis is still open.",
    "created_at": "2018-07-03T14:41:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355284",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Again ready for review!

> > 6. This is dangerous: `<GapElement_List> lst_in` since you don't know that `lst_in` is a `GapElement_List`. Either do an explicit `isinstance()` check or use `<GapElement_List?>lst_in`.
> 
> I would like to do `cpdef _generate_new_GAP(self, GapElement_List lst_in)` but do not know how

this is still open.



---

archive/issue_comments_355285.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-07-03T14:41:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355285",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_355286.json:
```json
{
    "body": "So I don't understand the comment about iterations. So I removed it. However, if SGS is not consistent across different computers, we have a problem with doctests. The RES is guaranteed to have a fixed iteration order, so I can only assume the SGS does not have such a guarantee. I changed the doctests to what I needed for them to pass, but I am guessing they will fail for you. If they pass for you and SGS is consistent, then the comment should have been removed anyways.\n\nI made a few other tweaks.\n----\nNew commits:",
    "created_at": "2018-07-03T14:58:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355286",
    "user": "https://github.com/tscrim"
}
```

So I don't understand the comment about iterations. So I removed it. However, if SGS is not consistent across different computers, we have a problem with doctests. The RES is guaranteed to have a fixed iteration order, so I can only assume the SGS does not have such a guarantee. I changed the doctests to what I needed for them to pass, but I am guessing they will fail for you. If they pass for you and SGS is consistent, then the comment should have been removed anyways.

I made a few other tweaks.
----
New commits:



---

archive/issue_comments_355287.json:
```json
{
    "body": "Changing keywords from \"PermutationGroup, days93.51, gap\" to \"PermutationGroup, days93.51, gap, days94\".",
    "created_at": "2018-07-03T14:59:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355287",
    "user": "https://github.com/tscrim"
}
```

Changing keywords from "PermutationGroup, days93.51, gap" to "PermutationGroup, days93.51, gap, days94".



---

archive/issue_comments_355288.json:
```json
{
    "body": "Thanks Travis!\n\n```\n-            G = libgap.Group(self.gens())\n+            G = libgap(self) #libgap.Group(self.gens())\n```\n\nI chose the first because it was slightly faster. Also I wanted to keep\n\n```\n-            # the following also works but is much slower:\n-            #gap2sage = lambda elt: one._generate_new(libgap.ListPerm(elt).sage())\n-            #gap2sage = lambda elt: libgap.ListPerm(elt)._generate_perm(one)\n```\n\nto see the other but slower ways to do this.\n\n```\n-            in the two algorithms, and is not even guaranteed to always\n-            be the same for one of the two.\n```\n\nThis now depends on gap behaviour, also I prefer not to guarantee that I will not change the output when changing the implementation. Anyways, if you prefer to remove it, that's fine too.",
    "created_at": "2018-07-03T15:31:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355288",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Thanks Travis!

```
-            G = libgap.Group(self.gens())
+            G = libgap(self) #libgap.Group(self.gens())
```

I chose the first because it was slightly faster. Also I wanted to keep

```
-            # the following also works but is much slower:
-            #gap2sage = lambda elt: one._generate_new(libgap.ListPerm(elt).sage())
-            #gap2sage = lambda elt: libgap.ListPerm(elt)._generate_perm(one)
```

to see the other but slower ways to do this.

```
-            in the two algorithms, and is not even guaranteed to always
-            be the same for one of the two.
```

This now depends on gap behaviour, also I prefer not to guarantee that I will not change the output when changing the implementation. Anyways, if you prefer to remove it, that's fine too.



---

archive/issue_comments_355289.json:
```json
{
    "body": "Replying to [comment:115 stumpc5]:\n> Thanks Travis!\n> {{{\n> -            G = libgap.Group(self.gens())\n> +            G = libgap(self) #libgap.Group(self.gens())\n> }}}\n> I chose the first because it was slightly faster.\n\nI get the latter is faster:\n\n```\nsage: A = PermutationGroup([(1,2),(1,2,3,4,5,6,7,8,9)])\nsage: %timeit libgap.Group(A.gens())\nThe slowest run took 13.32 times longer than the fastest. This could mean that an intermediate result is being cached.\n10000 loops, best of 3: 53.5 \u00b5s per loop\nsage: %timeit libgap(A)\nThe slowest run took 4.21 times longer than the fastest. This could mean that an intermediate result is being cached.\n10000 loops, best of 3: 35.6 \u00b5s per loop\n```\n\n\n> Also I wanted to keep\n> {{{\n> -            # the following also works but is much slower:\n> -            #gap2sage = lambda elt: one._generate_new(libgap.ListPerm(elt).sage())\n> -            #gap2sage = lambda elt: libgap.ListPerm(elt)._generate_perm(one)\n> }}}\n> to see the other but slower ways to do this.\n\nCommented out code gets removed quite quickly by other people and looks bad to put slower code. The data is in the history if someone wants to look it up.\n\n> {{{\n> -            in the two algorithms, and is not even guaranteed to always\n> -            be the same for one of the two.\n> }}}\n> This now depends on gap behaviour, also I prefer not to guarantee that I will not change the output when changing the implementation. Anyways, if you prefer to remove it, that's fine too.\n\nIf a particular version of GAP is consistent, than no comment is necessary (a number of doctests typically change when GAP upgrades). We have never guaranteed an output order for group iteration, so I don't see any point in mentioning it.",
    "created_at": "2018-07-03T15:44:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355289",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:115 stumpc5]:
> Thanks Travis!
> {{{
> -            G = libgap.Group(self.gens())
> +            G = libgap(self) #libgap.Group(self.gens())
> }}}
> I chose the first because it was slightly faster.

I get the latter is faster:

```
sage: A = PermutationGroup([(1,2),(1,2,3,4,5,6,7,8,9)])
sage: %timeit libgap.Group(A.gens())
The slowest run took 13.32 times longer than the fastest. This could mean that an intermediate result is being cached.
10000 loops, best of 3: 53.5 Âµs per loop
sage: %timeit libgap(A)
The slowest run took 4.21 times longer than the fastest. This could mean that an intermediate result is being cached.
10000 loops, best of 3: 35.6 Âµs per loop
```


> Also I wanted to keep
> {{{
> -            # the following also works but is much slower:
> -            #gap2sage = lambda elt: one._generate_new(libgap.ListPerm(elt).sage())
> -            #gap2sage = lambda elt: libgap.ListPerm(elt)._generate_perm(one)
> }}}
> to see the other but slower ways to do this.

Commented out code gets removed quite quickly by other people and looks bad to put slower code. The data is in the history if someone wants to look it up.

> {{{
> -            in the two algorithms, and is not even guaranteed to always
> -            be the same for one of the two.
> }}}
> This now depends on gap behaviour, also I prefer not to guarantee that I will not change the output when changing the implementation. Anyways, if you prefer to remove it, that's fine too.

If a particular version of GAP is consistent, than no comment is necessary (a number of doctests typically change when GAP upgrades). We have never guaranteed an output order for group iteration, so I don't see any point in mentioning it.



---

archive/issue_comments_355290.json:
```json
{
    "body": "Okay, let's see which doctests have to be undated (given the new ordering of the permgroup iteration).",
    "created_at": "2018-07-03T15:47:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355290",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Okay, let's see which doctests have to be undated (given the new ordering of the permgroup iteration).



---

archive/issue_comments_355291.json:
```json
{
    "body": "I updated the permutation group iteration order in `judson-abstract-algebra` and cc'ed Rob Beezer her as requested there.\n----\nNew commits:",
    "created_at": "2018-07-04T07:03:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355291",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

I updated the permutation group iteration order in `judson-abstract-algebra` and cc'ed Rob Beezer her as requested there.
----
New commits:



---

archive/issue_comments_355292.json:
```json
{
    "body": "Currently, the slow iteration using `RecursivelyEnumeratedSet` uses depth first search with generators being the group generators. Which of the following would you prefer:\n\n1. Depth or breadth first search ?\n2. Generators or generators plus their inverses?\n\nI would think that bfs would be a more natural ordering, especially for small groups that you actually look at and see how the Cayley graph is propagated. Using also inverses is another question and I don't actually have a preference. Sometimes generating sets for Cayley graphs are expected to also contain inverses, sometimes not.",
    "created_at": "2018-07-04T07:12:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355292",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Currently, the slow iteration using `RecursivelyEnumeratedSet` uses depth first search with generators being the group generators. Which of the following would you prefer:

1. Depth or breadth first search ?
2. Generators or generators plus their inverses?

I would think that bfs would be a more natural ordering, especially for small groups that you actually look at and see how the Cayley graph is propagated. Using also inverses is another question and I don't actually have a preference. Sometimes generating sets for Cayley graphs are expected to also contain inverses, sometimes not.



---

archive/issue_comments_355293.json:
```json
{
    "body": "while you are at it, could you fix the doc for PermutationGroupElement?\nIt appears that what you get from `sage: PermutationGroupElement?` has not made it into the corresponding rst file, e.g. it's not possible to see an example with an explicit parent in the reference manual (in section http://doc.sagemath.org/html/en/reference/groups/sage/groups/perm_gps/permgroup_element.html)\n\nAlso, an example with an explicit parent out to be given in Examples, not in Tests only.",
    "created_at": "2018-07-04T17:34:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355293",
    "user": "https://github.com/dimpase"
}
```

while you are at it, could you fix the doc for PermutationGroupElement?
It appears that what you get from `sage: PermutationGroupElement?` has not made it into the corresponding rst file, e.g. it's not possible to see an example with an explicit parent in the reference manual (in section http://doc.sagemath.org/html/en/reference/groups/sage/groups/perm_gps/permgroup_element.html)

Also, an example with an explicit parent out to be given in Examples, not in Tests only.



---

archive/issue_comments_355294.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-04T18:24:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355294",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355295.json:
```json
{
    "body": "I fixed a few more doctests, not done yet. Let me mention that I find it questionable (and risky) that so many doctests fail due to this change of iteration...",
    "created_at": "2018-07-04T18:25:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355295",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

I fixed a few more doctests, not done yet. Let me mention that I find it questionable (and risky) that so many doctests fail due to this change of iteration...



---

archive/issue_comments_355296.json:
```json
{
    "body": "to me, this rather shows that make doctests depend upon an order which need to be preserved is not a good idea in the first place...",
    "created_at": "2018-07-04T18:31:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355296",
    "user": "https://github.com/dimpase"
}
```

to me, this rather shows that make doctests depend upon an order which need to be preserved is not a good idea in the first place...



---

archive/issue_comments_355297.json:
```json
{
    "body": "yes, and even more is true: some doctest pick out some unspecified element\n\n```\n         sage: SGA.group()\n         Symmetric group of order 4! as a permutation group\n         sage: SGA.an_element()\n-        () + 2*(1,2) + 4*(1,2,3,4)\n+        () + (1,2,3,4) + 2*(1,3)(2,4) + 3*(1,4)(2,3)\n```\n\ndo stuff with it\n\n```\n \n             sage: G = SymmetricGroup(4).algebra(QQ)\n             sage: G.retract_plain(G.an_element(), 3)\n-            () + 2*(1,2)\n+            ()\n```\n\nwhich might be boring for other elements (such as here), or even pick special elements with intended properties from it\n\n```\n     sage: D = DihedralGroup(5)\n     sage: elements = D.list(); elements\n-    [(), (1,5)(2,4), (1,2,3,4,5), (1,4)(2,3), (1,3,5,2,4), (2,5)(3,4),\n-     (1,3)(4,5), (1,5,4,3,2), (1,4,2,5,3), (1,2)(3,5)]\n-\n-~~~~~~~~~~~~~~~~~~~~~~ ::\n-\n-    sage: rotate = elements[2]\n-    sage: flip = elements[3]\n```\n",
    "created_at": "2018-07-04T18:40:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355297",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

yes, and even more is true: some doctest pick out some unspecified element

```
         sage: SGA.group()
         Symmetric group of order 4! as a permutation group
         sage: SGA.an_element()
-        () + 2*(1,2) + 4*(1,2,3,4)
+        () + (1,2,3,4) + 2*(1,3)(2,4) + 3*(1,4)(2,3)
```

do stuff with it

```
 
             sage: G = SymmetricGroup(4).algebra(QQ)
             sage: G.retract_plain(G.an_element(), 3)
-            () + 2*(1,2)
+            ()
```

which might be boring for other elements (such as here), or even pick special elements with intended properties from it

```
     sage: D = DihedralGroup(5)
     sage: elements = D.list(); elements
-    [(), (1,5)(2,4), (1,2,3,4,5), (1,4)(2,3), (1,3,5,2,4), (2,5)(3,4),
-     (1,3)(4,5), (1,5,4,3,2), (1,4,2,5,3), (1,2)(3,5)]
-
-~~~~~~~~~~~~~~~~~~~~~~ ::
-
-    sage: rotate = elements[2]
-    sage: flip = elements[3]
```




---

archive/issue_comments_355298.json:
```json
{
    "body": "I would have rewritten the test\n\n```\nsage: SGA.an_element()\n...\n```\n\nas \n\n```\nsage: SGA.an_element() in SGA\nTrue\n```\n\netc...",
    "created_at": "2018-07-04T19:10:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355298",
    "user": "https://github.com/dimpase"
}
```

I would have rewritten the test

```
sage: SGA.an_element()
...
```

as 

```
sage: SGA.an_element() in SGA
True
```

etc...



---

archive/issue_comments_355299.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-05T07:55:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355299",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355300.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-05T08:14:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355300",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355301.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-05T08:33:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355301",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355302.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-05T10:34:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355302",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355303.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-05T12:55:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355303",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355304.json:
```json
{
    "body": "Replying to [comment:126 dimpase]:\n> I would have rewritten the test\n> {{{\n> sage: SGA.an_element()\n> ...\n> }}}\n> as \n> {{{\n> sage: SGA.an_element() in SGA\n> True\n> }}}\n> etc... \n\nWell, the generic element is usually generic enough to be useful. This test only works when testing `_an_element_`. It is used elsewhere to show how the element changes.",
    "created_at": "2018-07-05T15:25:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355304",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:126 dimpase]:
> I would have rewritten the test
> {{{
> sage: SGA.an_element()
> ...
> }}}
> as 
> {{{
> sage: SGA.an_element() in SGA
> True
> }}}
> etc... 

Well, the generic element is usually generic enough to be useful. This test only works when testing `_an_element_`. It is used elsewhere to show how the element changes.



---

archive/issue_comments_355305.json:
```json
{
    "body": "Replying to [comment:123 stumpc5]:\n> I fixed a few more doctests, not done yet. Let me mention that I find it questionable (and risky) that so many doctests fail due to this change of iteration...\n\nI agree there is some risk, but a good review should be checking that it is just an order difference. So generically, I would say your concern is misplaced. However, I am very worried there is an order dependency on the machine, which means we have write more annoying doctests (i.e., calling `sorted` a lot).",
    "created_at": "2018-07-05T15:27:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355305",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:123 stumpc5]:
> I fixed a few more doctests, not done yet. Let me mention that I find it questionable (and risky) that so many doctests fail due to this change of iteration...

I agree there is some risk, but a good review should be checking that it is just an order difference. So generically, I would say your concern is misplaced. However, I am very worried there is an order dependency on the machine, which means we have write more annoying doctests (i.e., calling `sorted` a lot).



---

archive/issue_comments_355306.json:
```json
{
    "body": "Replying to [comment:120 stumpc5]:\n> Currently, the slow iteration using `RecursivelyEnumeratedSet` uses depth first search with generators being the group generators. Which of the following would you prefer:\n> \n> 1. Depth or breadth first search ?\n> 2. Generators or generators plus their inverses?\n> \n> I would think that bfs would be a more natural ordering\n\nI would just let it run its default, but if I had to choose, I would say BFS as well.",
    "created_at": "2018-07-05T15:28:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355306",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:120 stumpc5]:
> Currently, the slow iteration using `RecursivelyEnumeratedSet` uses depth first search with generators being the group generators. Which of the following would you prefer:
> 
> 1. Depth or breadth first search ?
> 2. Generators or generators plus their inverses?
> 
> I would think that bfs would be a more natural ordering

I would just let it run its default, but if I had to choose, I would say BFS as well.



---

archive/issue_comments_355307.json:
```json
{
    "body": "Also one little thing, but could you break the long output line in `sage/categories/finite_dimensional_lie_algebras_with_basis.py` (like how it was before).",
    "created_at": "2018-07-05T15:28:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355307",
    "user": "https://github.com/tscrim"
}
```

Also one little thing, but could you break the long output line in `sage/categories/finite_dimensional_lie_algebras_with_basis.py` (like how it was before).



---

archive/issue_comments_355308.json:
```json
{
    "body": "Replying to [comment:134 tscrim]:\n> I would just let it run its default, but if I had to choose, I would say BFS as well.\n\nWell, we now have the three options SGS, BFS, DFS. I think that should be okay now...",
    "created_at": "2018-07-05T17:45:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355308",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Replying to [comment:134 tscrim]:
> I would just let it run its default, but if I had to choose, I would say BFS as well.

Well, we now have the three options SGS, BFS, DFS. I think that should be okay now...



---

archive/issue_comments_355309.json:
```json
{
    "body": "Replying to [comment:136 stumpc5]:\n> Replying to [comment:134 tscrim]:\n> > I would just let it run its default, but if I had to choose, I would say BFS as well.\n> \n> Well, we now have the three options SGS, BFS, DFS. I think that should be okay now...\n\nA better way would be to pass options to RES.",
    "created_at": "2018-07-05T17:48:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355309",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:136 stumpc5]:
> Replying to [comment:134 tscrim]:
> > I would just let it run its default, but if I had to choose, I would say BFS as well.
> 
> Well, we now have the three options SGS, BFS, DFS. I think that should be okay now...

A better way would be to pass options to RES.



---

archive/issue_comments_355310.json:
```json
{
    "body": "Dear Christian,\n\nThanks very much for the cc on the changes to Judson's AATA.  I'll be able to do a diff and even more quickly discern what has changed.  I'm waiting on 8.3 to do a new update for the book, so this may miss that cut-off, but that should not be a crisis by any means.  Thanks everyone for your work keeping this code working well.\n\nRob",
    "created_at": "2018-07-06T02:08:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355310",
    "user": "https://github.com/rbeezer"
}
```

Dear Christian,

Thanks very much for the cc on the changes to Judson's AATA.  I'll be able to do a diff and even more quickly discern what has changed.  I'm waiting on 8.3 to do a new update for the book, so this may miss that cut-off, but that should not be a crisis by any means.  Thanks everyone for your work keeping this code working well.

Rob



---

archive/issue_comments_355311.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-06T08:46:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355311",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355312.json:
```json
{
    "body": "Replying to [comment:121 dimpase]:\n> while you are at it, could you fix the doc for PermutationGroupElement?\n\ndone.",
    "created_at": "2018-07-06T08:47:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355312",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Replying to [comment:121 dimpase]:
> while you are at it, could you fix the doc for PermutationGroupElement?

done.



---

archive/issue_comments_355313.json:
```json
{
    "body": "I know, I need to finish a review of this (including doing a rebase). This might also conflict with #26045. This is now been able to become high on my todo list.",
    "created_at": "2018-08-11T21:47:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355313",
    "user": "https://github.com/tscrim"
}
```

I know, I need to finish a review of this (including doing a rebase). This might also conflict with #26045. This is now been able to become high on my todo list.



---

archive/issue_comments_355314.json:
```json
{
    "body": "I have rebased it to 8.4.beta1 and over #26045. However, let's let this run on some patchbots to see if there is any machine dependency (in addition, if some of the other people here can do so). If there are no doctest failures, then we are safe to assume the SGS iterator is not machine dependent. With that, I would be okay setting a positive review.\n----\nNew commits:",
    "created_at": "2018-08-24T22:53:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355314",
    "user": "https://github.com/tscrim"
}
```

I have rebased it to 8.4.beta1 and over #26045. However, let's let this run on some patchbots to see if there is any machine dependency (in addition, if some of the other people here can do so). If there are no doctest failures, then we are safe to assume the SGS iterator is not machine dependent. With that, I would be okay setting a positive review.
----
New commits:



---

archive/issue_comments_355315.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-18T08:52:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355315",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355316.json:
```json
{
    "body": "`@`tscrim: what to do with these doctest failures?",
    "created_at": "2018-09-18T11:38:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355316",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

`@`tscrim: what to do with these doctest failures?



---

archive/issue_comments_355317.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2018-09-18T22:47:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355317",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_355318.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-09-18T22:51:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355318",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_355319.json:
```json
{
    "body": "Since #26225 is now in Sage, those doctest should essentially be sorted (or given by a fixed ordering). So this should fix those. Also you were missing a blank line in one of the book tests.\n\n(Sorry about the noise, I was not based on develop. Fixed in the last forced push.)",
    "created_at": "2018-09-18T22:52:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355319",
    "user": "https://github.com/tscrim"
}
```

Since #26225 is now in Sage, those doctest should essentially be sorted (or given by a fixed ordering). So this should fix those. Also you were missing a blank line in one of the book tests.

(Sorry about the noise, I was not based on develop. Fixed in the last forced push.)



---

archive/issue_comments_355320.json:
```json
{
    "body": "Only\n\n```\nFile \"src/sage/tests/books/judson-abstract-algebra/permute-sage.py\", line 268, in sage.tests.books.judson-abstract-algebra.permute-sage\nFailed example:\n    H.list()\nExpected:\n    [(), (1,3), (4,5), (1,3)(4,5)]\nGot:\n    [(), (4,5), (1,3), (1,3)(4,5)]\n```\n\nseems to be left. What kind of sorting do you want there?",
    "created_at": "2018-09-19T06:19:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355320",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Only

```
File "src/sage/tests/books/judson-abstract-algebra/permute-sage.py", line 268, in sage.tests.books.judson-abstract-algebra.permute-sage
Failed example:
    H.list()
Expected:
    [(), (1,3), (4,5), (1,3)(4,5)]
Got:
    [(), (4,5), (1,3), (1,3)(4,5)]
```

seems to be left. What kind of sorting do you want there?



---

archive/issue_comments_355321.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-19T08:25:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355321",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355322.json:
```json
{
    "body": "Replying to [comment:148 stumpc5]:\n> What kind of sorting do you want there?\n\nI suspect that is just a leftover from the test not being run. I doubt it is machine-dependent, so the fix I just pushed should take care of it.",
    "created_at": "2018-09-19T08:26:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355322",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:148 stumpc5]:
> What kind of sorting do you want there?

I suspect that is just a leftover from the test not being run. I doubt it is machine-dependent, so the fix I just pushed should take care of it.



---

archive/issue_comments_355323.json:
```json
{
    "body": "okay, this seems to be ready to go!",
    "created_at": "2018-09-19T12:06:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355323",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

okay, this seems to be ready to go!



---

archive/issue_comments_355324.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-09-19T13:00:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355324",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_355325.json:
```json
{
    "body": "Can you have a look at the patchbot output: Python3 incompatible code inserted on 1 non-empty lines. Also, tests fail \n\n```\nsage -t --long src/sage/geometry/polyhedron/ppl_lattice_polytope.py  # 1 doctest failed\n```\n",
    "created_at": "2018-09-20T21:28:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355325",
    "user": "https://github.com/vbraun"
}
```

Can you have a look at the patchbot output: Python3 incompatible code inserted on 1 non-empty lines. Also, tests fail 

```
sage -t --long src/sage/geometry/polyhedron/ppl_lattice_polytope.py  # 1 doctest failed
```




---

archive/issue_comments_355326.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-09-20T21:28:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355326",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_355327.json:
```json
{
    "body": "Replying to [comment:153 vbraun]:\n> Can you have a look at the patchbot output: Python3 incompatible code inserted on 1 non-empty lines.\n\nThat is libGAP code on that line (comes from the `libgap.function_factory(\"\"\"`), so it is not Python3 incompatible.\n\n> Also, tests fail \n> {{{\n> sage -t --long src/sage/geometry/polyhedron/ppl_lattice_polytope.py  # 1 doctest failed\n> }}}\n\nI think I forgot to run the `--long` when I checked this locally (and so I concluded that it was a spurious patchbot fault). However, I did confirm this locally. It seems like the group is too large to pass to libgap:\n\n```\nsage: libgap(aut)  # the group from the test in question\npython2: libgap.c:184: libgap_get_input: Assertion `strlen(libGAP_stdin_buffer) < length' failed.\n```\n\nIt has 1152 generators! However `gap` handles this fine.\n\nSo I just reverted the first change on comment:115, and that seems to fix the problem. I can see how that is more safe as I am surprised `libgap` is passing things by strings. Which might account for the fact that `@`stumpc5 and me got different timing results.",
    "created_at": "2018-09-20T22:28:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355327",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:153 vbraun]:
> Can you have a look at the patchbot output: Python3 incompatible code inserted on 1 non-empty lines.

That is libGAP code on that line (comes from the `libgap.function_factory("""`), so it is not Python3 incompatible.

> Also, tests fail 
> {{{
> sage -t --long src/sage/geometry/polyhedron/ppl_lattice_polytope.py  # 1 doctest failed
> }}}

I think I forgot to run the `--long` when I checked this locally (and so I concluded that it was a spurious patchbot fault). However, I did confirm this locally. It seems like the group is too large to pass to libgap:

```
sage: libgap(aut)  # the group from the test in question
python2: libgap.c:184: libgap_get_input: Assertion `strlen(libGAP_stdin_buffer) < length' failed.
```

It has 1152 generators! However `gap` handles this fine.

So I just reverted the first change on comment:115, and that seems to fix the problem. I can see how that is more safe as I am surprised `libgap` is passing things by strings. Which might account for the fact that `@`stumpc5 and me got different timing results.



---

archive/issue_comments_355328.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-20T22:28:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355328",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355329.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-09-20T22:28:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355329",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_355330.json:
```json
{
    "body": "Its the Weyl group of F4...\n\nlibgap is passing by strings but there is an assumption that it fits into a certain buffer. This could be fixed...",
    "created_at": "2018-09-20T22:52:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355330",
    "user": "https://github.com/vbraun"
}
```

Its the Weyl group of F4...

libgap is passing by strings but there is an assumption that it fits into a certain buffer. This could be fixed...



---

archive/issue_comments_355331.json:
```json
{
    "body": "Why on Earth one generates all the 1152 elements of W(F_4)? This looks like something really weird in the implementation...",
    "created_at": "2018-09-20T23:06:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355331",
    "user": "https://github.com/dimpase"
}
```

Why on Earth one generates all the 1152 elements of W(F_4)? This looks like something really weird in the implementation...



---

archive/issue_comments_355332.json:
```json
{
    "body": "Replying to [comment:157 vbraun]:\n> Its the Weyl group of F4...\n\nRight, but the computation uses all of the elements as generators, which is what makes it blowout the buffer.\n\n> libgap is passing by strings but there is an assumption that it fits into a certain buffer. This could be fixed...\n\nI agree, but this is the less invasive (and easier) change. Ideally a `PermutationGroup` and its elements would directly construct the object in libgap using the C data structures.",
    "created_at": "2018-09-20T23:12:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355332",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:157 vbraun]:
> Its the Weyl group of F4...

Right, but the computation uses all of the elements as generators, which is what makes it blowout the buffer.

> libgap is passing by strings but there is an assumption that it fits into a certain buffer. This could be fixed...

I agree, but this is the less invasive (and easier) change. Ideally a `PermutationGroup` and its elements would directly construct the object in libgap using the C data structures.



---

archive/issue_comments_355333.json:
```json
{
    "body": "That change annoyingly causes the output order to change... So, should we fix the output order (again) or revert 1a85742 and do a more proper fix of the libgap interface?",
    "created_at": "2018-09-21T01:37:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355333",
    "user": "https://github.com/tscrim"
}
```

That change annoyingly causes the output order to change... So, should we fix the output order (again) or revert 1a85742 and do a more proper fix of the libgap interface?



---

archive/issue_comments_355334.json:
```json
{
    "body": "What exactly is happening in the latest commit? Do you mean to say that before it\n`libgap(bla)`, for `bla` a permutation group, caused all the elements of `bla` to be listed?! If so, this was certainly a bug.",
    "created_at": "2018-09-21T06:57:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355334",
    "user": "https://github.com/dimpase"
}
```

What exactly is happening in the latest commit? Do you mean to say that before it
`libgap(bla)`, for `bla` a permutation group, caused all the elements of `bla` to be listed?! If so, this was certainly a bug.



---

archive/issue_comments_355335.json:
```json
{
    "body": "No, I am saying that `libgap(bla)` and `libgap.Group(bla.gens())` results in a different iteration order (at least in Sage) of the group elements.",
    "created_at": "2018-09-21T06:59:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355335",
    "user": "https://github.com/tscrim"
}
```

No, I am saying that `libgap(bla)` and `libgap.Group(bla.gens())` results in a different iteration order (at least in Sage) of the group elements.



---

archive/issue_comments_355336.json:
```json
{
    "body": "Replying to [comment:113 tscrim]:\n> So I don't understand the comment about iterations. So I removed it. However, if SGS is not consistent across different computers, we have a problem with doctests. The RES is guaranteed to have a fixed iteration order, so I can only assume the SGS does not have such a guarantee. I changed the doctests to what I needed for them to pass, but I am guessing they will fail for you. If they pass for you and SGS is consistent, then the comment should have been removed anyways.\n\nSGS is often computed with a randomisation involved, and so one cannot guarantee the same chain of subgroups across different runs on the same machine.\nIf you fix the base to be used, you'd have less variance, but still there could be randomisation involved in choosing the ordering of the base elements.\n\nWe should not tweak algorithms in order to make testing easier, we should tweak tests, anyway.\n\nWhat is RES?",
    "created_at": "2018-09-21T07:25:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355336",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:113 tscrim]:
> So I don't understand the comment about iterations. So I removed it. However, if SGS is not consistent across different computers, we have a problem with doctests. The RES is guaranteed to have a fixed iteration order, so I can only assume the SGS does not have such a guarantee. I changed the doctests to what I needed for them to pass, but I am guessing they will fail for you. If they pass for you and SGS is consistent, then the comment should have been removed anyways.

SGS is often computed with a randomisation involved, and so one cannot guarantee the same chain of subgroups across different runs on the same machine.
If you fix the base to be used, you'd have less variance, but still there could be randomisation involved in choosing the ordering of the base elements.

We should not tweak algorithms in order to make testing easier, we should tweak tests, anyway.

What is RES?



---

archive/issue_comments_355337.json:
```json
{
    "body": "RES = `RecursivelyEnumeratedSet`.",
    "created_at": "2018-09-21T07:29:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355337",
    "user": "https://github.com/tscrim"
}
```

RES = `RecursivelyEnumeratedSet`.



---

archive/issue_comments_355338.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-28T00:25:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355338",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355339.json:
```json
{
    "body": "I've just updated the doctests to reflect the change in ordering (or remove the dependence on the ordering). So if the patchbots come back green, I think we can set this back to a positive review (that should be reasonable enough confirmation that the doctest outputs are not machine-dependent).",
    "created_at": "2018-09-28T00:27:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355339",
    "user": "https://github.com/tscrim"
}
```

I've just updated the doctests to reflect the change in ordering (or remove the dependence on the ordering). So if the patchbots come back green, I think we can set this back to a positive review (that should be reasonable enough confirmation that the doctest outputs are not machine-dependent).



---

archive/issue_comments_355340.json:
```json
{
    "body": "One green patchbot and one almost green. I don't see how the error in computing the volume of a polytope could be caused by this ticket, so I suspect it is an unrelated failure.",
    "created_at": "2018-09-28T04:55:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355340",
    "user": "https://github.com/tscrim"
}
```

One green patchbot and one almost green. I don't see how the error in computing the volume of a polytope could be caused by this ticket, so I suspect it is an unrelated failure.



---

archive/issue_comments_355341.json:
```json
{
    "body": "Let us get this in. The polyhedral computation stuff done, as in the doctest in question, over RDF, is dodgy anyway (more so as it is done on PPC64, of all platforms), and I don't see how it can have anything to do with this ticket.",
    "created_at": "2018-09-28T10:34:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355341",
    "user": "https://github.com/dimpase"
}
```

Let us get this in. The polyhedral computation stuff done, as in the doctest in question, over RDF, is dodgy anyway (more so as it is done on PPC64, of all platforms), and I don't see how it can have anything to do with this ticket.



---

archive/issue_comments_355342.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-09-28T10:34:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355342",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_355343.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-09-28T22:32:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355343",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_355344.json:
```json
{
    "body": "Merge conflict",
    "created_at": "2018-09-28T22:32:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355344",
    "user": "https://github.com/vbraun"
}
```

Merge conflict



---

archive/issue_comments_355345.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-01T08:00:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355345",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355346.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2018-10-01T08:01:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355346",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_355347.json:
```json
{
    "body": "Trivial merge conflict.",
    "created_at": "2018-10-01T08:01:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355347",
    "user": "https://github.com/tscrim"
}
```

Trivial merge conflict.



---

archive/issue_comments_355348.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-10-02T23:03:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355348",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_355349.json:
```json
{
    "body": "\n```\nFile \"src/sage/rings/number_field/galois_group.py\", line 137, in sage.rings.number_field.galois_group.GaloisGroup_v1.group\nFailed example:\n    list(P)                       # optional - database_gap\nExpected:\n    [(), (1,2), (1,2,3), (2,3), (1,3,2), (1,3)]\nGot:\n    [(), (1,2,3), (1,3,2), (2,3), (1,2), (1,3)]\n**********************************************************************\n1 item had failures:\n   1 of   5 in sage.rings.number_field.galois_group.GaloisGroup_v1.group\n    [142 tests, 1 failure, 3.05 s]\n----------------------------------------------------------------------\nsage -t --long src/sage/rings/number_field/galois_group.py  # 1 doctest failed\n```\n",
    "created_at": "2018-10-02T23:03:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355349",
    "user": "https://github.com/vbraun"
}
```


```
File "src/sage/rings/number_field/galois_group.py", line 137, in sage.rings.number_field.galois_group.GaloisGroup_v1.group
Failed example:
    list(P)                       # optional - database_gap
Expected:
    [(), (1,2), (1,2,3), (2,3), (1,3,2), (1,3)]
Got:
    [(), (1,2,3), (1,3,2), (2,3), (1,2), (1,3)]
**********************************************************************
1 item had failures:
   1 of   5 in sage.rings.number_field.galois_group.GaloisGroup_v1.group
    [142 tests, 1 failure, 3.05 s]
----------------------------------------------------------------------
sage -t --long src/sage/rings/number_field/galois_group.py  # 1 doctest failed
```




---

archive/issue_comments_355350.json:
```json
{
    "body": "Just sort these doctest results with something stable and platform-independent...",
    "created_at": "2018-10-02T23:13:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355350",
    "user": "https://github.com/dimpase"
}
```

Just sort these doctest results with something stable and platform-independent...



---

archive/issue_comments_355351.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-02T23:32:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355351",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355352.json:
```json
{
    "body": "It actually is not machine-dependent, it was just not tested by the patchbots because it is marked with an optional gap package to make sure there were no others (well, there was one also marked with magma, but I cannot test that one).",
    "created_at": "2018-10-02T23:36:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355352",
    "user": "https://github.com/tscrim"
}
```

It actually is not machine-dependent, it was just not tested by the patchbots because it is marked with an optional gap package to make sure there were no others (well, there was one also marked with magma, but I cannot test that one).



---

archive/issue_comments_355353.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-10-02T23:36:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355353",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_355354.json:
```json
{
    "body": "I don't think this is a right fix. Any new version of GAP might mess this up...\nHow about\n\n```\nsage: set(list(P))\n{(), (2,3), (1,2), (1,2,3), (1,3,2), (1,3)}\n```\n\nor\n\n```\nsage: sorted(list(P))\n[(), (2,3), (1,2), (1,2,3), (1,3,2), (1,3)]\n```\n",
    "created_at": "2018-10-02T23:49:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355354",
    "user": "https://github.com/dimpase"
}
```

I don't think this is a right fix. Any new version of GAP might mess this up...
How about

```
sage: set(list(P))
{(), (2,3), (1,2), (1,2,3), (1,3,2), (1,3)}
```

or

```
sage: sorted(list(P))
[(), (2,3), (1,2), (1,2,3), (1,3,2), (1,3)]
```




---

archive/issue_comments_355355.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-03T00:45:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355355",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355356.json:
```json
{
    "body": "I'm not a fan of decorating doctests that don't really need it, but I've added it.",
    "created_at": "2018-10-03T00:46:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355356",
    "user": "https://github.com/tscrim"
}
```

I'm not a fan of decorating doctests that don't really need it, but I've added it.



---

archive/issue_comments_355357.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-10-03T13:22:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355357",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_355358.json:
```json
{
    "body": "On 32-bit:\n\n```\n**********************************************************************\nFile \"src/sage/geometry/polyhedron/library.py\", line 360, in sage.geometry.polyhedron.library.Polytopes.icosahedron\nFailed example:\n    ico.volume()\nExpected:\n    2.1816949907715726\nGot:\n    2.181694990771572\n**********************************************************************\n1 item had failures:\n   1 of  11 in sage.geometry.polyhedron.library.Polytopes.icosahedron\n    [211 tests, 1 failure, 118.70 s]\n----------------------------------------------------------------------\nsage -t --long src/sage/geometry/polyhedron/library.py  # 1 doctest failed\n```\n",
    "created_at": "2018-10-04T20:47:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355358",
    "user": "https://github.com/vbraun"
}
```

On 32-bit:

```
**********************************************************************
File "src/sage/geometry/polyhedron/library.py", line 360, in sage.geometry.polyhedron.library.Polytopes.icosahedron
Failed example:
    ico.volume()
Expected:
    2.1816949907715726
Got:
    2.181694990771572
**********************************************************************
1 item had failures:
   1 of  11 in sage.geometry.polyhedron.library.Polytopes.icosahedron
    [211 tests, 1 failure, 118.70 s]
----------------------------------------------------------------------
sage -t --long src/sage/geometry/polyhedron/library.py  # 1 doctest failed
```




---

archive/issue_comments_355359.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-10-04T20:47:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355359",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_355360.json:
```json
{
    "body": "oh, and that's why: the icosahedron generator contains\n\n```\n       verts = [p(v) for p in AlternatingGroup(3) for v in pts]\n       return Polyhedron(vertices=verts, base_ring=base_ring, backend=backend)\n```\n\nhow about we just add `...` to that doctest, like `2.18169499...` ?",
    "created_at": "2018-10-04T21:24:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355360",
    "user": "https://github.com/dimpase"
}
```

oh, and that's why: the icosahedron generator contains

```
       verts = [p(v) for p in AlternatingGroup(3) for v in pts]
       return Polyhedron(vertices=verts, base_ring=base_ring, backend=backend)
```

how about we just add `...` to that doctest, like `2.18169499...` ?



---

archive/issue_comments_355361.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-04T22:34:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355361",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355362.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2018-10-04T22:36:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355362",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_355363.json:
```json
{
    "body": "I added a `rel tol` in case there ends up being other slight numerical differences in the future.",
    "created_at": "2018-10-04T22:36:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355363",
    "user": "https://github.com/tscrim"
}
```

I added a `rel tol` in case there ends up being other slight numerical differences in the future.



---

archive/issue_comments_355364.json:
```json
{
    "body": "Replying to [comment:183 tscrim]:\n> I added a `rel tol` in case there ends up being other slight numerical differences in the future.\n\nThe digits after `2.18169499` are not right, for the exact evaluation gives\n`2.18169499062...`.\n\n```\nsage: (5/12*sqrt(5) + 5/4).n()\n2.18169499062491\n```\n\nThat's why I'd prefer truncation as I suggested.",
    "created_at": "2018-10-04T22:47:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355364",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:183 tscrim]:
> I added a `rel tol` in case there ends up being other slight numerical differences in the future.

The digits after `2.18169499` are not right, for the exact evaluation gives
`2.18169499062...`.

```
sage: (5/12*sqrt(5) + 5/4).n()
2.18169499062491
```

That's why I'd prefer truncation as I suggested.



---

archive/issue_comments_355365.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2018-10-04T22:52:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355365",
    "user": "https://github.com/tscrim"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_355366.json:
```json
{
    "body": "I think that is part of the point of the doctest, that it is different. If you insist, I will change it to truncation, but I also believe that suggests a much larger numerical instability than is actually present.",
    "created_at": "2018-10-04T22:52:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355366",
    "user": "https://github.com/tscrim"
}
```

I think that is part of the point of the doctest, that it is different. If you insist, I will change it to truncation, but I also believe that suggests a much larger numerical instability than is actually present.



---

archive/issue_comments_355367.json:
```json
{
    "body": "IMHO it is not an instability, it is an artefact of naive computing with finite precision, i.e. accumulation of a rounding error.",
    "created_at": "2018-10-05T06:41:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355367",
    "user": "https://github.com/dimpase"
}
```

IMHO it is not an instability, it is an artefact of naive computing with finite precision, i.e. accumulation of a rounding error.



---

archive/issue_comments_355368.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-05T07:44:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355368",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355369.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-10-05T07:45:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355369",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_355370.json:
```json
{
    "body": "Okay, that is not quite the right terminology. It still suggests that there is significantly more variation in the doctest than what it really has. However, I changed it because I want this to get in and don't want it cut from the next stable release.",
    "created_at": "2018-10-05T07:45:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355370",
    "user": "https://github.com/tscrim"
}
```

Okay, that is not quite the right terminology. It still suggests that there is significantly more variation in the doctest than what it really has. However, I changed it because I want this to get in and don't want it cut from the next stable release.



---

archive/issue_comments_355371.json:
```json
{
    "body": "Replying to [comment:188 tscrim]:\n> Okay, that is not quite the right terminology. It still suggests that there is significantly more variation in the doctest than what it really has. However, I changed it because I want this to get in and don't want it cut from the next stable release.\n\nIt rather illustrates that RDF is not a field, and that it isn't even commutative...\nThere could be more variation coming from a yet another CPU used. E.g. if you have a better FPU then you might get closer to the correct value, which would again break the doctest if it had too much numerical noise left.",
    "created_at": "2018-10-05T11:12:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355371",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:188 tscrim]:
> Okay, that is not quite the right terminology. It still suggests that there is significantly more variation in the doctest than what it really has. However, I changed it because I want this to get in and don't want it cut from the next stable release.

It rather illustrates that RDF is not a field, and that it isn't even commutative...
There could be more variation coming from a yet another CPU used. E.g. if you have a better FPU then you might get closer to the correct value, which would again break the doctest if it had too much numerical noise left.



---

archive/issue_events_023517.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2018-10-06T17:13:13Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25240#event-23517"
}
```



---

archive/issue_comments_355372.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-10-06T17:13:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25240",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25240#issuecomment-355372",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
