# Issue 13018: make sage use setuptools instead of distutils

archive/issues_013018.json:
```json
{
    "body": "Assignee: GeorgSWeber\n\nCC:  kini jdemeyer robertwb kcrisman mhansen jhpalmieri embray dimpase fbissey\n\nCurrently the sage library uses distutils. Switching to setuptools will give us the `setup.py develop` command, which bypasses the need to rebuild the sage library when modifying python files.\n\nIssue created by migration from https://trac.sagemath.org/ticket/13190\n\n",
    "created_at": "2012-07-01T10:06:03Z",
    "labels": [
        "build",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "make sage use setuptools instead of distutils",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13018",
    "user": "ohanar"
}
```
Assignee: GeorgSWeber

CC:  kini jdemeyer robertwb kcrisman mhansen jhpalmieri embray dimpase fbissey

Currently the sage library uses distutils. Switching to setuptools will give us the `setup.py develop` command, which bypasses the need to rebuild the sage library when modifying python files.

Issue created by migration from https://trac.sagemath.org/ticket/13190





---

archive/issue_comments_157406.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-07-01T10:13:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13018#issuecomment-157406",
    "user": "ohanar"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_157407.json:
```json
{
    "body": "I would imagine that you get problems similar to #12659 .   Have you tried this out?",
    "created_at": "2012-07-01T10:44:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13018#issuecomment-157407",
    "user": "mhansen"
}
```

I would imagine that you get problems similar to #12659 .   Have you tried this out?



---

archive/issue_comments_157408.json:
```json
{
    "body": "Replying to [comment:3 mhansen]:\n> I would imagine that you get problems similar to #12659 .   Have you tried this out?\n\nDo you mean the sdist issues? No, I have not tried them yet, but I wouldn't doubt that there may be issues with them. Also, as noted in deps, there is an issue with parallel instances of setuptools, so either deps has to be hacked to force sage into the serial build, or we depend on #12994 (my vote is the later, since it is cleaner).",
    "created_at": "2012-07-01T19:29:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13018#issuecomment-157408",
    "user": "ohanar"
}
```

Replying to [comment:3 mhansen]:
> I would imagine that you get problems similar to #12659 .   Have you tried this out?

Do you mean the sdist issues? No, I have not tried them yet, but I wouldn't doubt that there may be issues with them. Also, as noted in deps, there is an issue with parallel instances of setuptools, so either deps has to be hacked to force sage into the serial build, or we depend on #12994 (my vote is the later, since it is cleaner).



---

archive/issue_comments_157409.json:
```json
{
    "body": "I've decided to make #12994 a dependency -- makes it much easier to add setuptool packages to the build system.",
    "created_at": "2012-07-03T21:56:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13018#issuecomment-157409",
    "user": "ohanar"
}
```

I've decided to make #12994 a dependency -- makes it much easier to add setuptool packages to the build system.



---

archive/issue_comments_157410.json:
```json
{
    "body": "There are some issues with using relative paths with setuptools (which we want for relocation purposes). #13197 fixes these issues.",
    "created_at": "2012-07-03T22:47:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13018#issuecomment-157410",
    "user": "ohanar"
}
```

There are some issues with using relative paths with setuptools (which we want for relocation purposes). #13197 fixes these issues.



---

archive/issue_comments_157411.json:
```json
{
    "body": "I am a bit lost on the inter-relations between the tickets #12994, #13190, #13201, #13197 (and perhaps #12659).  Could you please clarify the dependencies?\n\nAlso, I personally think it would be better to split this in two tickets:\nA. Use setuptools\nB. Use setup.py develop",
    "created_at": "2012-08-31T08:17:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13018#issuecomment-157411",
    "user": "jdemeyer"
}
```

I am a bit lost on the inter-relations between the tickets #12994, #13190, #13201, #13197 (and perhaps #12659).  Could you please clarify the dependencies?

Also, I personally think it would be better to split this in two tickets:
A. Use setuptools
B. Use setup.py develop



---

archive/issue_comments_157412.json:
```json
{
    "body": "Replying to [comment:9 jdemeyer]:\n> I am a bit lost on the inter-relations between the tickets #12994, #13190, #13201, #13197 (and perhaps #12659).  Could you please clarify the dependencies?\n> \n> Also, I personally think it would be better to split this in two tickets:\n>  A. Use setuptools\nThis should only require #13031.\n>  B. Use setup.py develop\nThis is more or less #12659 after switching to setuptools, and is where the other dependencies creep up (they aren't strictly necessary, but the alternative is to hack around setuptools, which is less preferable than patching it IMO).\n\nI'll rework the patch to only do A once we have a 5.4 beta (mainly because #13031 more or less needs to be rebased with every development release).",
    "created_at": "2012-09-04T20:43:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13018#issuecomment-157412",
    "user": "ohanar"
}
```

Replying to [comment:9 jdemeyer]:
> I am a bit lost on the inter-relations between the tickets #12994, #13190, #13201, #13197 (and perhaps #12659).  Could you please clarify the dependencies?
> 
> Also, I personally think it would be better to split this in two tickets:
>  A. Use setuptools
This should only require #13031.
>  B. Use setup.py develop
This is more or less #12659 after switching to setuptools, and is where the other dependencies creep up (they aren't strictly necessary, but the alternative is to hack around setuptools, which is less preferable than patching it IMO).

I'll rework the patch to only do A once we have a 5.4 beta (mainly because #13031 more or less needs to be rebased with every development release).



---

archive/issue_comments_157413.json:
```json
{
    "body": "apply to root repo",
    "created_at": "2012-09-05T22:34:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13018#issuecomment-157413",
    "user": "ohanar"
}
```

apply to root repo



---

archive/issue_comments_157414.json:
```json
{
    "body": "Attachment [trac13190_scripts.patch](tarball://root/attachments/some-uuid/ticket13190/trac13190_scripts.patch) by ohanar created at 2012-09-05 22:34:44\n\napply to scripts repo",
    "created_at": "2012-09-05T22:34:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13018#issuecomment-157414",
    "user": "ohanar"
}
```

Attachment [trac13190_scripts.patch](tarball://root/attachments/some-uuid/ticket13190/trac13190_scripts.patch) by ohanar created at 2012-09-05 22:34:44

apply to scripts repo



---

archive/issue_comments_157415.json:
```json
{
    "body": "ok, rebased and only does the switch to setuptools (doesn't switch to `setup.py develop` anymore). Dependencies are now accurate.",
    "created_at": "2012-09-05T22:36:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13018#issuecomment-157415",
    "user": "ohanar"
}
```

ok, rebased and only does the switch to setuptools (doesn't switch to `setup.py develop` anymore). Dependencies are now accurate.



---

archive/issue_comments_157416.json:
```json
{
    "body": "Attachment [trac13190_library.patch](tarball://root/attachments/some-uuid/ticket13190/trac13190_library.patch) by ohanar created at 2012-09-06 00:05:59\n\napply to sage library",
    "created_at": "2012-09-06T00:05:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13018#issuecomment-157416",
    "user": "ohanar"
}
```

Attachment [trac13190_library.patch](tarball://root/attachments/some-uuid/ticket13190/trac13190_library.patch) by ohanar created at 2012-09-06 00:05:59

apply to sage library



---

archive/issue_comments_157417.json:
```json
{
    "body": "Are we trying to make this happen before the git transition or afterward?",
    "created_at": "2013-09-06T16:09:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13018#issuecomment-157417",
    "user": "roed"
}
```

Are we trying to make this happen before the git transition or afterward?



---

archive/issue_comments_157418.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2013-09-06T16:09:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13018#issuecomment-157418",
    "user": "roed"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_157419.json:
```json
{
    "body": "Certainly after, although I'm not currently convinced that we should proceed in this direction.",
    "created_at": "2013-09-06T16:49:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13018#issuecomment-157419",
    "user": "ohanar"
}
```

Certainly after, although I'm not currently convinced that we should proceed in this direction.



---

archive/issue_comments_157420.json:
```json
{
    "body": "Any thoughts on this?  It hasn't been touched in quite some time despite there being (a likely outdated by now) patch. I can take this issue over and see it to completion if desired.",
    "created_at": "2016-02-24T10:29:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13018#issuecomment-157420",
    "user": "embray"
}
```

Any thoughts on this?  It hasn't been touched in quite some time despite there being (a likely outdated by now) patch. I can take this issue over and see it to completion if desired.



---

archive/issue_comments_157421.json:
```json
{
    "body": "There is at least one problem: `setuptools` does not support `setup(data_files=...)`, see [setuptools #130](https://bitbucket.org/pypa/setuptools/issues/130/install_data-doesnt-respect-prefix). It's a good reason to avoid setuptools.\n\nI'm not sure that we need `data_files` for the Sage library though. Maybe we could use `package_data` instead. But then that is something which should be investigated.",
    "created_at": "2016-02-24T10:38:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13018#issuecomment-157421",
    "user": "jdemeyer"
}
```

There is at least one problem: `setuptools` does not support `setup(data_files=...)`, see [setuptools #130](https://bitbucket.org/pypa/setuptools/issues/130/install_data-doesnt-respect-prefix). It's a good reason to avoid setuptools.

I'm not sure that we need `data_files` for the Sage library though. Maybe we could use `package_data` instead. But then that is something which should be investigated.



---

archive/issue_comments_157422.json:
```json
{
    "body": "I don't know what files need to be installed with the `sage` package.  For the majority of Python-based projects `package_data` is preferred, but of course Sage is 'special'.\n\nLet me look into what files are installed with the sage package, and I can worry about the details.",
    "created_at": "2016-02-24T10:46:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13018#issuecomment-157422",
    "user": "embray"
}
```

I don't know what files need to be installed with the `sage` package.  For the majority of Python-based projects `package_data` is preferred, but of course Sage is 'special'.

Let me look into what files are installed with the sage package, and I can worry about the details.



---

archive/issue_comments_157423.json:
```json
{
    "body": "Hang on, I'm looking at it.",
    "created_at": "2016-02-24T10:48:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13018#issuecomment-157423",
    "user": "jdemeyer"
}
```

Hang on, I'm looking at it.



---

archive/issue_comments_157424.json:
```json
{
    "body": "I created a new ticket for using `package_data`.",
    "created_at": "2016-02-24T10:49:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13018#issuecomment-157424",
    "user": "jdemeyer"
}
```

I created a new ticket for using `package_data`.



---

archive/issue_comments_157425.json:
```json
{
    "body": "Replying to [comment:19 jdemeyer]:\n> There is at least one problem: `setuptools` does not support `setup(data_files=...)`, see [setuptools #130](https://bitbucket.org/pypa/setuptools/issues/130/install_data-doesnt-respect-prefix). It's a good reason to avoid setuptools.\n\nI recently learned about the (almost undocumented) setuptools options `--old-and-unmanageable`. It forces a non-egg build which is exactly what we want. So that would make this ticket possible again.",
    "created_at": "2018-06-08T15:05:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13018#issuecomment-157425",
    "user": "jdemeyer"
}
```

Replying to [comment:19 jdemeyer]:
> There is at least one problem: `setuptools` does not support `setup(data_files=...)`, see [setuptools #130](https://bitbucket.org/pypa/setuptools/issues/130/install_data-doesnt-respect-prefix). It's a good reason to avoid setuptools.

I recently learned about the (almost undocumented) setuptools options `--old-and-unmanageable`. It forces a non-egg build which is exactly what we want. So that would make this ticket possible again.



---

archive/issue_comments_157426.json:
```json
{
    "body": "Also, it seems that Sage is no longer using either `data_files` or `package_data`. So that discussion has also disappeared.",
    "created_at": "2018-06-08T18:40:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13018#issuecomment-157426",
    "user": "jdemeyer"
}
```

Also, it seems that Sage is no longer using either `data_files` or `package_data`. So that discussion has also disappeared.



---

archive/issue_comments_157427.json:
```json
{
    "body": "I forget, what is the difference between `--old-and-unmanageable` and `--single-version-externally-managed`, where I thought the latter should be sufficient...\n\nAlso I do want to use `package_data` for Sage (see e.g. #21732) but I don't see what the problem is.",
    "created_at": "2018-06-27T14:38:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13018#issuecomment-157427",
    "user": "embray"
}
```

I forget, what is the difference between `--old-and-unmanageable` and `--single-version-externally-managed`, where I thought the latter should be sufficient...

Also I do want to use `package_data` for Sage (see e.g. #21732) but I don't see what the problem is.



---

archive/issue_comments_157428.json:
```json
{
    "body": "Replying to [comment:27 embray]:\n> Also I do want to use `package_data` for Sage (see e.g. #21732) but I don't see what the problem is.\n\nThere is no problem with `package_data` if you want to use it in the way that it was intended to be used (which may not align with actual use cases).\n\nThere **is** a problem with `data_files`: setuptools still doesn't really support that. One of the reasons that this ticket stalled was because Sage was using `data_files` at the time to install Cython-related files. You suggested that it would be easy to use `package_data` instead (#20108). That didn't actually work, but now we are using custom code (neither `data_files` not `package_data`, see #21600) to install those files.",
    "created_at": "2018-06-27T15:03:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13018#issuecomment-157428",
    "user": "jdemeyer"
}
```

Replying to [comment:27 embray]:
> Also I do want to use `package_data` for Sage (see e.g. #21732) but I don't see what the problem is.

There is no problem with `package_data` if you want to use it in the way that it was intended to be used (which may not align with actual use cases).

There **is** a problem with `data_files`: setuptools still doesn't really support that. One of the reasons that this ticket stalled was because Sage was using `data_files` at the time to install Cython-related files. You suggested that it would be easy to use `package_data` instead (#20108). That didn't actually work, but now we are using custom code (neither `data_files` not `package_data`, see #21600) to install those files.



---

archive/issue_comments_157429.json:
```json
{
    "body": "Replying to [comment:27 embray]:\n> I forget, what is the difference between `--old-and-unmanageable` and `--single-version-externally-managed`\n\nMainly that the latter requires a `--record` argument also.",
    "created_at": "2018-06-27T15:05:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13018#issuecomment-157429",
    "user": "jdemeyer"
}
```

Replying to [comment:27 embray]:
> I forget, what is the difference between `--old-and-unmanageable` and `--single-version-externally-managed`

Mainly that the latter requires a `--record` argument also.



---

archive/issue_comments_157430.json:
```json
{
    "body": "Time to revive this ancient ticket.",
    "created_at": "2020-06-04T17:59:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13018#issuecomment-157430",
    "user": "mkoeppe"
}
```

Time to revive this ancient ticket.



---

archive/issue_comments_157431.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2020-06-04T17:59:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13018#issuecomment-157431",
    "user": "mkoeppe"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_157432.json:
```json
{
    "body": "Last 10 new commits:",
    "created_at": "2020-06-05T04:39:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13018#issuecomment-157432",
    "user": "mkoeppe"
}
```

Last 10 new commits:



---

archive/issue_comments_157433.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-06-28T19:17:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13018#issuecomment-157433",
    "user": "mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_157434.json:
```json
{
    "body": "This ticket is superseded by #29950 and can be closed.",
    "created_at": "2020-06-28T19:17:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13018#issuecomment-157434",
    "user": "mkoeppe"
}
```

This ticket is superseded by #29950 and can be closed.



---

archive/issue_comments_157435.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-06-29T14:39:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13018#issuecomment-157435",
    "user": "dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_157436.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2020-08-15T10:23:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13018#issuecomment-157436",
    "user": "chapoton"
}
```

Resolution: invalid
