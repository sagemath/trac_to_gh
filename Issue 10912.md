# Issue 10912: no checking on getitem for Ambient space of a root system

Issue created by migration from https://trac.sagemath.org/ticket/10995

Original creator: VivianePons

Original creation time: 2011-03-23 10:33:28

Assignee: sage-combinat

CC:  sage-combinat

Keywords: ambient space, root system, getitem, combinatorialfreemodule

When you create an ambient space of a root system, there is a getitem method. But no verification is made on the given value which implies bugs on other uses of the object.


```
sage: R = RootSystem('A2')
sage: A2 = R.ambient_space()
sage: A2[0]
(0, 0, 0)
sage: list(A2[0])
[(-1, 1)]
sage: A2.zero()
(0, 0, 0)
sage: list(A2.zero())
[]
```


The getitem should only get values between 1 and 3 and raise exceptions when not. Otherwise, it allows for creating elements which don't make any sense and can bring trouble :


```
sage: C = CombinatorialFreeModule(QQ,A2)
sage: C.an_element()
B[(0, 0, 0)] + 2*B[(1, 0, 0)] + B[(2, 2, 3)] + 3*B[(0, 1, 0)]
sage: elt = C(A2([0,0,0])) + 2 * C(A2([1,0,0])) + C(A2([2,2,3])) + 3 * C(A2([0,1,0]))
sage: elt
B[(0, 0, 0)] + 2*B[(1, 0, 0)] + B[(2, 2, 3)] + 3*B[(0, 1, 0)]
sage: elt == C.an_element()
False
```


Indeed, the getitem is used by python to iterate on the parent and the iteration is used by CombinatorialFreeModule to create elements. 


 



---

Comment by VivianePons created at 2011-03-24 10:04:23

Changing status from new to needs_review.


---

Comment by nthiery created at 2011-03-26 07:20:42

Following the discussion on

   http://groups.google.com/group/sage-combinat-devel/browse_thread/thread/ab1722fb97c0fbbb

this is good to go (assuming the buildbot goes green which I expect)!

Thanks,
                        Nicolas


---

Comment by nthiery created at 2011-03-26 07:20:42

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2011-03-27 13:50:37

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2011-03-27 13:50:37

`@`VivianePons: create a `.hgrc` file as explained in
[http://sagemath.org/doc/developer/walk_through.html#submitting-a-change](http://sagemath.org/doc/developer/walk_through.html#submitting-a-change) and resubmit the patch.


---

Comment by nthiery created at 2011-03-28 07:05:08

Replying to [comment:4 jdemeyer]:
> `@`VivianePons: create a `.hgrc` file as explained in
> [http://sagemath.org/doc/developer/walk_through.html#submitting-a-change](http://sagemath.org/doc/developer/walk_through.html#submitting-a-change) and resubmit the patch.

Sorry, I should have caught this. The main point is that the patch should be exported before being posted on trac. See also:
[http://wiki.sagemath.org/combinat/MercurialStepByStep#ExportingPatchesforusewithtrac](http://wiki.sagemath.org/combinat/MercurialStepByStep#ExportingPatchesforusewithtrac).


---

Attachment

the patch


---

Comment by VivianePons created at 2011-03-28 14:59:22

Changing status from needs_work to needs_review.


---

Comment by nthiery created at 2011-03-28 15:06:10

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2011-03-29 12:02:22

Resolution: fixed
