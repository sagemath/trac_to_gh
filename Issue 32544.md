# Issue 32544: SAGE_CHECK='warn' is broken

Issue created by migration from https://trac.sagemath.org/ticket/32781

Original creator: tmonteil

Original creation time: 2021-10-27 00:55:19

CC:  jhpalmieri

Example of what appears at the end of some complilation:


```
[networkx-2.5.1] ----------------------------------------------------------------------
[networkx-2.5.1] Ran 4327 tests in 642.137s
[networkx-2.5.1] 
[networkx-2.5.1] FAILED (errors=1326)
[networkx-2.5.1] 
[networkx-2.5.1] real   10m53.763s
[networkx-2.5.1] user   8m59.794s
[networkx-2.5.1] sys    0m1.475s
[networkx-2.5.1] ************************************************************************
[networkx-2.5.1] Warning: Failures testing package networkx-2.5.1 (ignored)
[networkx-2.5.1] ************************************************************************
[networkx-2.5.1] Please email sage-devel (http://groups.google.com/group/sage-devel)
[networkx-2.5.1] explaining the problem and including the log files
[networkx-2.5.1]   /opt/sagemath/sage-9.4/logs/pkgs/networkx-2.5.1.log
[networkx-2.5.1] and
[networkx-2.5.1]   /opt/sagemath/sage-9.4/config.log
[networkx-2.5.1] Describe your computer, operating system, etc.
[networkx-2.5.1] If you want to try to fix the problem yourself, *don't* just cd to
[networkx-2.5.1] /opt/sagemath/sage-9.4/local/var/tmp/sage/build/networkx-2.5.1 and type 'make check' or whatever is appropriate.
[networkx-2.5.1] Instead, the following commands setup all environment variables
[networkx-2.5.1] correctly and load a subshell for you to debug the error:
[networkx-2.5.1]   (cd '/opt/sagemath/sage-9.4/local/var/tmp/sage/build/networkx-2.5.1' && '/opt/sagemath/sage-9.4/sage' --buildsh)
[networkx-2.5.1] When you are done debugging, you can type "exit" to leave the subshell.
[networkx-2.5.1] ************************************************************************
[networkx-2.5.1] Successfully installed networkx-2.5.1
[networkx-2.5.1] Deleting temporary build directory
[networkx-2.5.1] /opt/sagemath/sage-9.4/local/var/tmp/sage/build/networkx-2.5.1
[networkx-2.5.1] Finished installing networkx-2.5.1
make[2]: Leaving directory '/opt/sagemath/sage-9.4/build/make'

real    435m6.246s
user    1231m26.105s
sys     89m59.767s
SAGE_CHECK=warn, so scanning the log files. This may take a few seconds.
Sage build/upgrade complete!
make[1]: Leaving directory '/opt/sagemath/sage-9.4'
```


Nothing is reported.


---

Comment by tmonteil created at 2021-10-27 01:05:00

Changing status from new to needs_review.


---

Comment by tmonteil created at 2021-10-27 01:05:00

New commits:


---

Comment by git created at 2021-10-27 01:07:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhpalmieri created at 2021-10-28 00:13:40

I'm testing this out, and wow, the Cython test suite takes a long time to run. Do I kill it or let it continue? It's just been printing out messages like

```
#### 2021-10-27 15:10:45.991348

#### 2021-10-27 15:10:56.248141

#### 2021-10-27 15:11:06.519693
```

about every 10 seconds for the past two hours.


---

Comment by mkoeppe created at 2021-10-28 00:44:07

Cython is one of the packages whose testsuites I disable in the tox-based tests for this reason.


```
$ git grep SAGE_CHECK_PACKAGES
build/bin/write-dockerfile.sh:ENV SAGE_CHECK_PACKAGES="!cython,!r,!python3,!gap,!cysignals,!linbox,!git,!ppl,!cmake,!rpy2,!sage_sws2rst"
build/bin/write-dockerfile.sh:ENV SAGE_CHECK_PACKAGES="!gfan,!cython,!r,!python3,!gap,!cysignals,!linbox,!git,!ppl,!cmake,!rpy2,!sage_sws2rst"
build/bin/write-dockerfile.sh:ENV SAGE_CHECK_PACKAGES="!gfan,!cython,!r,!python3,!gap,!cysignals,!linbox,!git,!ppl,!cmake,!rpy2,!sage_sws2rst"
build/bin/write-dockerfile.sh:ENV SAGE_CHECK_PACKAGES="!gfan,!cython,!r,!python3,!gap,!cysignals,!linbox,!git,!ppl,!cmake,!rpy2,!sage_sws2rst"
tox.ini:    local:             make -k V=0 SAGE_CHECK=warn SAGE_CHECK_PACKAGES="!cython,!r,!python3,!gap,!cysignals,!linbox,!git,!ppl,!cmake,!rpy2,!sage_sws2rst" {env:TARGETS_PRE:} {posargs:build} && \
tox.ini:    local:             ( [ -z "{env:TARGETS_OPTIONAL:}" ] || make -k V=0 SAGE_CHECK=warn SAGE_CHECK_PACKAGES="!cython,!r,!python3,!gap,!cysignals,!linbox,!git,!ppl,!cmake,!rpy2,!sage_sws2rst" {env:TARGETS_OPTIONAL:} || echo "(error ignored)" ) '
```


The normal defaults are set in `build/make/Makefile.in`:

```
build/make/Makefile.in:SAGE_CHECK_PACKAGES_DEFAULT_yes := !python3
build/make/Makefile.in:SAGE_CHECK_PACKAGES_DEFAULT_warn :=
build/make/Makefile.in:SAGE_CHECK_PACKAGES_DEFAULT_no :=
```


We should probably unify this!


---

Comment by jhpalmieri created at 2021-10-28 03:55:01

Replying to [comment:7 mkoeppe]:
> We should probably unify this!

I opened #32785 for this.


---

Comment by tmonteil created at 2021-10-28 10:57:04

We should keep doing selftest, even if they are long. Perhaps could such tests be only run by a few bots.


---

Comment by jhpalmieri created at 2021-10-28 20:59:42

Changing status from needs_review to positive_review.


---

Comment by jhpalmieri created at 2021-10-28 20:59:42

This fixes the problem for me, the code obviously makes sense, and I think we should merge it.


---

Comment by tmonteil created at 2021-10-28 22:47:33

Thanks for the review.


---

Comment by vbraun created at 2021-10-31 22:20:30

Resolution: fixed
