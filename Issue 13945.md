# Issue 13945: Creation of temporary files with %attach

archive/issues_013945.json:
```json
{
    "body": "Assignee: tbd\n\nCC:  @ppurka tmonteil @hughrthomas okazymyrov\n\nUsing sage-5.7.beta4 and sage-5.7.rc0, when attaching a .sage file, sage creates spurious files in the current directory. For example\n\n```\nsage: %attach blah.sage\n```\n\ncreates blah.sageYPVh in the current directory.\n\nIssue created by migration from https://trac.sagemath.org/ticket/14149\n\n",
    "created_at": "2013-02-20T00:40:43Z",
    "labels": [
        "component: please change",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Creation of temporary files with %attach",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13945",
    "user": "https://github.com/anneschilling"
}
```
Assignee: tbd

CC:  @ppurka tmonteil @hughrthomas okazymyrov

Using sage-5.7.beta4 and sage-5.7.rc0, when attaching a .sage file, sage creates spurious files in the current directory. For example

```
sage: %attach blah.sage
```

creates blah.sageYPVh in the current directory.

Issue created by migration from https://trac.sagemath.org/ticket/14149





---

archive/issue_comments_173656.json:
```json
{
    "body": "See also #14169.",
    "created_at": "2013-02-24T02:10:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13945#issuecomment-173656",
    "user": "https://github.com/kcrisman"
}
```

See also #14169.



---

archive/issue_comments_173657.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to user interface.",
    "created_at": "2013-02-24T02:11:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13945#issuecomment-173657",
    "user": "https://github.com/kcrisman"
}
```

Changing component from PLEASE CHANGE to user interface.



---

archive/issue_comments_173658.json:
```json
{
    "body": "Changing assignee from tbd to @williamstein.",
    "created_at": "2013-02-24T02:11:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13945#issuecomment-173658",
    "user": "https://github.com/kcrisman"
}
```

Changing assignee from tbd to @williamstein.



---

archive/issue_comments_173659.json:
```json
{
    "body": "Changing priority from blocker to critical.",
    "created_at": "2013-02-24T02:11:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13945#issuecomment-173659",
    "user": "https://github.com/kcrisman"
}
```

Changing priority from blocker to critical.



---

archive/issue_comments_173660.json:
```json
{
    "body": "Bump.\n\nIt seems like it should be possible to create these temporary files in ~/.sage or something similar.  Where is the code for %attach kept?  I could possibly start poking around.",
    "created_at": "2013-03-22T09:41:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13945#issuecomment-173660",
    "user": "https://github.com/sdenton4"
}
```

Bump.

It seems like it should be possible to create these temporary files in ~/.sage or something similar.  Where is the code for %attach kept?  I could possibly start poking around.



---

archive/issue_comments_173661.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-05-12T18:18:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13945#issuecomment-173661",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_173662.json:
```json
{
    "body": "Fixed in #14523",
    "created_at": "2013-05-12T18:18:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13945#issuecomment-173662",
    "user": "https://github.com/vbraun"
}
```

Fixed in #14523



---

archive/issue_events_039925.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-05-12T18:18:16Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13945",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13945#event-39925"
}
```



---

archive/issue_comments_173663.json:
```json
{
    "body": "`@`Volker: Could you explain where the code was that was producing these funny file names?  I'm happy that it's fixed in #14523 (thank you!) but I don't see where it gets fixed.  Sorry if the question seems like a waste of time -- I spent a fair while trying to figure out where this was happening, and I couldn't find it.  Thanks!",
    "created_at": "2013-05-12T19:08:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13945#issuecomment-173663",
    "user": "https://github.com/hughrthomas"
}
```

`@`Volker: Could you explain where the code was that was producing these funny file names?  I'm happy that it's fixed in #14523 (thank you!) but I don't see where it gets fixed.  Sorry if the question seems like a waste of time -- I spent a fair while trying to figure out where this was happening, and I couldn't find it.  Thanks!



---

archive/issue_comments_173664.json:
```json
{
    "body": "The attach debug mode is off by default now (see `load_attach_mode?`).",
    "created_at": "2013-05-12T20:55:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13945#issuecomment-173664",
    "user": "https://github.com/vbraun"
}
```

The attach debug mode is off by default now (see `load_attach_mode?`).



---

archive/issue_comments_173665.json:
```json
{
    "body": "Replying to [comment:10 vbraun]:\n> The attach debug mode is off by default now (see `load_attach_mode?`).\n\nI completely disagree with this fix. See [this discussion](http://groups.google.com/group/sage-devel/browse_thread/thread/761f69944e21efd4) and #11812.",
    "created_at": "2013-05-13T05:17:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13945#issuecomment-173665",
    "user": "https://github.com/mstreng"
}
```

Replying to [comment:10 vbraun]:
> The attach debug mode is off by default now (see `load_attach_mode?`).

I completely disagree with this fix. See [this discussion](http://groups.google.com/group/sage-devel/browse_thread/thread/761f69944e21efd4) and #11812.



---

archive/issue_comments_173666.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2013-05-13T07:45:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13945#issuecomment-173666",
    "user": "https://github.com/mstreng"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_173667.json:
```json
{
    "body": "Replying to [comment:11 mstreng]:\n> I completely disagree with this fix.\n\nIn fact, I would just switch \"debug mode\" back on in my startup file, but I would still want to get rid of the temporary files, so I would not call this a fix at all.\n\nHow about doing all of the following?\n* put temporary files in one subfolder (to keep the main folder as clean as possible)\n* remove or overwrite old temporary files when reloading attached files (to keep the folder with temporary files as clean as possible)\n* remove temporary files when exiting sage (obviously)\n\nThat only leaves one temporary file for each .sage file. It is there only during the Sage session. It remains afterwards only when Sage exits incorrectly, and it is in a subdirectory, so can be removed easily.",
    "created_at": "2013-05-13T07:45:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13945#issuecomment-173667",
    "user": "https://github.com/mstreng"
}
```

Replying to [comment:11 mstreng]:
> I completely disagree with this fix.

In fact, I would just switch "debug mode" back on in my startup file, but I would still want to get rid of the temporary files, so I would not call this a fix at all.

How about doing all of the following?
* put temporary files in one subfolder (to keep the main folder as clean as possible)
* remove or overwrite old temporary files when reloading attached files (to keep the folder with temporary files as clean as possible)
* remove temporary files when exiting sage (obviously)

That only leaves one temporary file for each .sage file. It is there only during the Sage session. It remains afterwards only when Sage exits incorrectly, and it is in a subdirectory, so can be removed easily.



---

archive/issue_events_039926.json:
```json
{
    "actor": "https://github.com/mstreng",
    "created_at": "2013-05-13T07:45:57Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13945",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13945#event-39926"
}
```



---

archive/issue_events_039927.json:
```json
{
    "actor": "https://github.com/mstreng",
    "created_at": "2013-05-13T07:45:57Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13945",
    "milestone": "sage-5.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13945#event-39927"
}
```



---

archive/issue_comments_173668.json:
```json
{
    "body": "If that is the desired outcome then it would have been nice to doctest it.\n\nLittering subdirectories with files in them into the file system is just as bad as spewing random temp files into cwd. Temp files should go into the sage temp directory.\n\nStill, the correct fix is to make execution of in-memory code produce correct tracebacks.",
    "created_at": "2013-05-13T09:43:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13945#issuecomment-173668",
    "user": "https://github.com/vbraun"
}
```

If that is the desired outcome then it would have been nice to doctest it.

Littering subdirectories with files in them into the file system is just as bad as spewing random temp files into cwd. Temp files should go into the sage temp directory.

Still, the correct fix is to make execution of in-memory code produce correct tracebacks.



---

archive/issue_comments_173669.json:
```json
{
    "body": "Replying to [comment:13 vbraun]:\n> If that is the desired outcome then it would have been nice to doctest it.\n\n\nI tried to doctest tracebacks, but could not find a way (see #11812).\n\n\n> Littering subdirectories with files in them into the file system is just as bad as spewing random temp files into cwd. Temp files should go into the sage temp directory.\n\n\nOriginally (before #7514 and again at #11812), temp directories *were* used for the preparsed .py files. The location changed later. I don't know when or why; maybe at #13579 because of security problems?\n\n\n> Still, the correct fix is to make execution of in-memory code produce correct tracebacks. \n\n\nYes, that would be best. Much better than my solution above, and much better than what was done at #11812. But how? I would like to see the name of the .sage file, and multi-line code snippets including line numbers.",
    "created_at": "2013-05-13T10:09:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13945#issuecomment-173669",
    "user": "https://github.com/mstreng"
}
```

Replying to [comment:13 vbraun]:
> If that is the desired outcome then it would have been nice to doctest it.


I tried to doctest tracebacks, but could not find a way (see #11812).


> Littering subdirectories with files in them into the file system is just as bad as spewing random temp files into cwd. Temp files should go into the sage temp directory.


Originally (before #7514 and again at #11812), temp directories *were* used for the preparsed .py files. The location changed later. I don't know when or why; maybe at #13579 because of security problems?


> Still, the correct fix is to make execution of in-memory code produce correct tracebacks. 


Yes, that would be best. Much better than my solution above, and much better than what was done at #11812. But how? I would like to see the name of the .sage file, and multi-line code snippets including line numbers.



---

archive/issue_comments_173670.json:
```json
{
    "body": "I've added a doctest for the desired behavior in #14523 (traceback showing source)",
    "created_at": "2013-05-13T19:35:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13945#issuecomment-173670",
    "user": "https://github.com/vbraun"
}
```

I've added a doctest for the desired behavior in #14523 (traceback showing source)



---

archive/issue_comments_173671.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2013-05-13T19:35:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13945#issuecomment-173671",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_173672.json:
```json
{
    "body": "Anybody who doesn't like temporary files littering the fs feel like reviewing this ticket?",
    "created_at": "2013-06-08T18:46:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13945#issuecomment-173672",
    "user": "https://github.com/vbraun"
}
```

Anybody who doesn't like temporary files littering the fs feel like reviewing this ticket?



---

archive/issue_comments_173673.json:
```json
{
    "body": "There are no attachments. What exactly are we supposed to review?",
    "created_at": "2013-06-08T20:33:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13945#issuecomment-173673",
    "user": "https://github.com/jhpalmieri"
}
```

There are no attachments. What exactly are we supposed to review?



---

archive/issue_events_039928.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-06-08T21:07:08Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13945",
    "milestone": "sage-5.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13945#event-39928"
}
```



---

archive/issue_events_039929.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-06-08T21:07:08Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13945",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13945#event-39929"
}
```



---

archive/issue_comments_173674.json:
```json
{
    "body": "Oops, posted this in the wrong ticket. I meant #14523. This ticket should be closed as duplicate, I think.",
    "created_at": "2013-06-08T21:07:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13945#issuecomment-173674",
    "user": "https://github.com/vbraun"
}
```

Oops, posted this in the wrong ticket. I meant #14523. This ticket should be closed as duplicate, I think.



---

archive/issue_comments_173675.json:
```json
{
    "body": "#14523 does fix creating the temp files.",
    "created_at": "2013-06-12T15:45:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13945#issuecomment-173675",
    "user": "https://github.com/tscrim"
}
```

#14523 does fix creating the temp files.



---

archive/issue_comments_173676.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-06-12T15:45:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13945#issuecomment-173676",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_173677.json:
```json
{
    "body": "Resolution: duplicate",
    "created_at": "2013-08-13T08:31:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13945#issuecomment-173677",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: duplicate



---

archive/issue_events_039930.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T08:31:22Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/13945",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13945#event-39930"
}
```
