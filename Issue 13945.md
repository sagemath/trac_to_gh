# Issue 13945: Creation of temporary files with %attach

Issue created by migration from Trac.

Original creator: aschilling

Original creation time: 2013-02-20 00:40:43

Assignee: tbd

CC:  ppurka tmonteil hthomas okazymyrov

Using sage-5.7.beta4 and sage-5.7.rc0, when attaching a .sage file, sage creates spurious files in the current directory. For example

```
sage: %attach blah.sage
```

creates blah.sageYPVh in the current directory.


---

Comment by kcrisman created at 2013-02-24 02:10:44

See also #14169.


---

Comment by kcrisman created at 2013-02-24 02:11:05

Changing component from PLEASE CHANGE to user interface.


---

Comment by kcrisman created at 2013-02-24 02:11:05

Changing assignee from tbd to was.


---

Comment by kcrisman created at 2013-02-24 02:11:05

Changing priority from blocker to critical.


---

Comment by sdenton created at 2013-03-22 09:41:29

Bump.

It seems like it should be possible to create these temporary files in ~/.sage or something similar.  Where is the code for %attach kept?  I could possibly start poking around.


---

Comment by vbraun created at 2013-05-12 18:18:16

Changing status from new to needs_review.


---

Comment by vbraun created at 2013-05-12 18:18:16

Fixed in #14523


---

Comment by hthomas created at 2013-05-12 19:08:43

`@`Volker: Could you explain where the code was that was producing these funny file names?  I'm happy that it's fixed in #14523 (thank you!) but I don't see where it gets fixed.  Sorry if the question seems like a waste of time -- I spent a fair while trying to figure out where this was happening, and I couldn't find it.  Thanks!


---

Comment by vbraun created at 2013-05-12 20:55:16

The attach debug mode is off by default now (see `load_attach_mode?`).


---

Comment by mstreng created at 2013-05-13 05:17:27

Replying to [comment:10 vbraun]:
> The attach debug mode is off by default now (see `load_attach_mode?`).

I completely disagree with this fix. See [this discussion](http://groups.google.com/group/sage-devel/browse_thread/thread/761f69944e21efd4) and #11812.


---

Comment by mstreng created at 2013-05-13 07:45:57

Changing status from needs_review to needs_info.


---

Comment by mstreng created at 2013-05-13 07:45:57

Replying to [comment:11 mstreng]:
> I completely disagree with this fix.

In fact, I would just switch "debug mode" back on in my startup file, but I would still want to get rid of the temporary files, so I would not call this a fix at all.

How about doing all of the following?
* put temporary files in one subfolder (to keep the main folder as clean as possible)
* remove or overwrite old temporary files when reloading attached files (to keep the folder with temporary files as clean as possible)
* remove temporary files when exiting sage (obviously)

That only leaves one temporary file for each .sage file. It is there only during the Sage session. It remains afterwards only when Sage exits incorrectly, and it is in a subdirectory, so can be removed easily.


---

Comment by vbraun created at 2013-05-13 09:43:52

If that is the desired outcome then it would have been nice to doctest it.

Littering subdirectories with files in them into the file system is just as bad as spewing random temp files into cwd. Temp files should go into the sage temp directory.

Still, the correct fix is to make execution of in-memory code produce correct tracebacks.


---

Comment by mstreng created at 2013-05-13 10:09:13

Replying to [comment:13 vbraun]:
> If that is the desired outcome then it would have been nice to doctest it.


I tried to doctest tracebacks, but could not find a way (see #11812).


> Littering subdirectories with files in them into the file system is just as bad as spewing random temp files into cwd. Temp files should go into the sage temp directory.


Originally (before #7514 and again at #11812), temp directories *were* used for the preparsed .py files. The location changed later. I don't know when or why; maybe at #13579 because of security problems?


> Still, the correct fix is to make execution of in-memory code produce correct tracebacks. 


Yes, that would be best. Much better than my solution above, and much better than what was done at #11812. But how? I would like to see the name of the .sage file, and multi-line code snippets including line numbers.


---

Comment by vbraun created at 2013-05-13 19:35:20

I've added a doctest for the desired behavior in #14523 (traceback showing source)


---

Comment by vbraun created at 2013-05-13 19:35:20

Changing status from needs_info to needs_review.


---

Comment by vbraun created at 2013-06-08 18:46:05

Anybody who doesn't like temporary files littering the fs feel like reviewing this ticket?


---

Comment by jhpalmieri created at 2013-06-08 20:33:54

There are no attachments. What exactly are we supposed to review?


---

Comment by vbraun created at 2013-06-08 21:07:08

Oops, posted this in the wrong ticket. I meant #14523. This ticket should be closed as duplicate, I think.


---

Comment by tscrim created at 2013-06-12 15:45:14

#14523 does fix creating the temp files.


---

Comment by tscrim created at 2013-06-12 15:45:14

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2013-08-13 08:31:22

Resolution: duplicate
