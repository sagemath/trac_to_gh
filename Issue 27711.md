# Issue 27711: py3: fix doctests with optional package plantri

archive/issues_027711.json:
```json
{
    "body": "Keywords: py3, graph\n\nMultiple doctests are failing with plantri and py3.\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/27948\n\n",
    "created_at": "2019-06-08T10:32:59Z",
    "labels": [
        "graph theory",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.9",
    "title": "py3: fix doctests with optional package plantri",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27711",
    "user": "@dcoudert"
}
```
Keywords: py3, graph

Multiple doctests are failing with plantri and py3.


Issue created by migration from https://trac.sagemath.org/ticket/27948





---

archive/issue_comments_391238.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-06-08T10:34:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27711#issuecomment-391238",
    "user": "@dcoudert"
}
```

New commits:



---

archive/issue_comments_391239.json:
```json
{
    "body": "with this first commit, we fix doctests like\n\n```\nFile \"src/sage/graphs/graph_generators.py\", line 1425, in sage.graphs.graph_generators.GraphGenerators.?\nFailed example:\n    len(list(gen))  # optional plantri\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1105, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.graphs.graph_generators.GraphGenerators.?[1]>\", line 1, in <module>\n        len(list(gen))  # optional plantri\n      File \"/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sage/graphs/graph_generators.py\", line 1538, in planar_graphs\n        Plantri().require()\n      File \"/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sage/features/__init__.py\", line 156, in require\n        presence = self.is_present()\n      File \"sage/misc/cachefunc.pyx\", line 2312, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (build/cythonized/sage/misc/cachefunc.c:12705)\n        self.cache = f(self._instance)\n      File \"/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sage/features/__init__.py\", line 129, in is_present\n        res = self._is_present()\n      File \"/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sage/features/__init__.py\", line 353, in _is_present\n        return self.is_functional()\n      File \"/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sage/features/graph_generators.py\", line 53, in is_functional\n        if lines.find(expected) == -1:\n    TypeError: argument should be integer or bytes-like object, not 'str'\n```\n",
    "created_at": "2019-06-08T10:35:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27711#issuecomment-391239",
    "user": "@dcoudert"
}
```

with this first commit, we fix doctests like

```
File "src/sage/graphs/graph_generators.py", line 1425, in sage.graphs.graph_generators.GraphGenerators.?
Failed example:
    len(list(gen))  # optional plantri
Exception raised:
    Traceback (most recent call last):
      File "/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1105, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.graphs.graph_generators.GraphGenerators.?[1]>", line 1, in <module>
        len(list(gen))  # optional plantri
      File "/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sage/graphs/graph_generators.py", line 1538, in planar_graphs
        Plantri().require()
      File "/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sage/features/__init__.py", line 156, in require
        presence = self.is_present()
      File "sage/misc/cachefunc.pyx", line 2312, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (build/cythonized/sage/misc/cachefunc.c:12705)
        self.cache = f(self._instance)
      File "/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sage/features/__init__.py", line 129, in is_present
        res = self._is_present()
      File "/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sage/features/__init__.py", line 353, in _is_present
        return self.is_functional()
      File "/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sage/features/graph_generators.py", line 53, in is_functional
        if lines.find(expected) == -1:
    TypeError: argument should be integer or bytes-like object, not 'str'
```




---

archive/issue_comments_391240.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-06-08T10:35:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27711#issuecomment-391240",
    "user": "@dcoudert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_391241.json:
```json
{
    "body": "The 2 remaining failing doctests require more investigation...\n\n```\nsage -t --long src/sage/graphs/graph_generators.py\n**********************************************************************\nFile \"src/sage/graphs/graph_generators.py\", line 1641, in sage.graphs.graph_generators.GraphGenerators.?\nFailed example:\n    for i in range(12, 23):                                             # optional plantri\n        L = len(list(graphs.triangulations(i, minimum_connectivity=5))) # optional plantri\n        print(\"{}   {:3d}\".format(i,L))                                 # optional plantri\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1105, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.graphs.graph_generators.GraphGenerators.?[7]>\", line 2, in <module>\n        L = len(list(graphs.triangulations(i, minimum_connectivity=Integer(5)))) # optional plantri\n      File \"/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sage/graphs/graph_generators.py\", line 1746, in triangulations\n        for G in graphs._read_planar_code(sp.stdout):\n      File \"/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sage/graphs/graph_generators.py\", line 1150, in _read_planar_code\n        G.set_embedding(embed_g)\n      File \"/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sage/graphs/generic_graph.py\", line 2444, in set_embedding\n        self._check_embedding_validity(embedding, boolean=False)\n      File \"/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sage/graphs/generic_graph.py\", line 2551, in _check_embedding_validity\n        raise ValueError(\"{} and {} are not neighbors but {} is in the list associated with {}\".format(u, v, u, v))\n    ValueError: 10 and 6 are not neighbors but 10 is in the list associated with 6\n**********************************************************************\nFile \"src/sage/graphs/graph_generators.py\", line 1673, in sage.graphs.graph_generators.GraphGenerators.?\nFailed example:\n    [len(g) for g in graphs.triangulations(9, minimum_degree=4, minimum_connectivity=3, dual=True)]  # optional plantri\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1105, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.graphs.graph_generators.GraphGenerators.?[11]>\", line 1, in <module>\n        [len(g) for g in graphs.triangulations(Integer(9), minimum_degree=Integer(4), minimum_connectivity=Integer(3), dual=True)]  # optional plantri\n      File \"<doctest sage.graphs.graph_generators.GraphGenerators.?[11]>\", line 1, in <listcomp>\n        [len(g) for g in graphs.triangulations(Integer(9), minimum_degree=Integer(4), minimum_connectivity=Integer(3), dual=True)]  # optional plantri\n      File \"/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sage/graphs/graph_generators.py\", line 1746, in triangulations\n        for G in graphs._read_planar_code(sp.stdout):\n      File \"/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sage/graphs/graph_generators.py\", line 1150, in _read_planar_code\n        G.set_embedding(embed_g)\n      File \"/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sage/graphs/generic_graph.py\", line 2444, in set_embedding\n        self._check_embedding_validity(embedding, boolean=False)\n      File \"/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sage/graphs/generic_graph.py\", line 2551, in _check_embedding_validity\n        raise ValueError(\"{} and {} are not neighbors but {} is in the list associated with {}\".format(u, v, u, v))\n    ValueError: 10 and 9 are not neighbors but 10 is in the list associated with 9\n```\n",
    "created_at": "2019-06-08T10:37:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27711#issuecomment-391241",
    "user": "@dcoudert"
}
```

The 2 remaining failing doctests require more investigation...

```
sage -t --long src/sage/graphs/graph_generators.py
**********************************************************************
File "src/sage/graphs/graph_generators.py", line 1641, in sage.graphs.graph_generators.GraphGenerators.?
Failed example:
    for i in range(12, 23):                                             # optional plantri
        L = len(list(graphs.triangulations(i, minimum_connectivity=5))) # optional plantri
        print("{}   {:3d}".format(i,L))                                 # optional plantri
Exception raised:
    Traceback (most recent call last):
      File "/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1105, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.graphs.graph_generators.GraphGenerators.?[7]>", line 2, in <module>
        L = len(list(graphs.triangulations(i, minimum_connectivity=Integer(5)))) # optional plantri
      File "/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sage/graphs/graph_generators.py", line 1746, in triangulations
        for G in graphs._read_planar_code(sp.stdout):
      File "/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sage/graphs/graph_generators.py", line 1150, in _read_planar_code
        G.set_embedding(embed_g)
      File "/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sage/graphs/generic_graph.py", line 2444, in set_embedding
        self._check_embedding_validity(embedding, boolean=False)
      File "/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sage/graphs/generic_graph.py", line 2551, in _check_embedding_validity
        raise ValueError("{} and {} are not neighbors but {} is in the list associated with {}".format(u, v, u, v))
    ValueError: 10 and 6 are not neighbors but 10 is in the list associated with 6
**********************************************************************
File "src/sage/graphs/graph_generators.py", line 1673, in sage.graphs.graph_generators.GraphGenerators.?
Failed example:
    [len(g) for g in graphs.triangulations(9, minimum_degree=4, minimum_connectivity=3, dual=True)]  # optional plantri
Exception raised:
    Traceback (most recent call last):
      File "/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1105, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.graphs.graph_generators.GraphGenerators.?[11]>", line 1, in <module>
        [len(g) for g in graphs.triangulations(Integer(9), minimum_degree=Integer(4), minimum_connectivity=Integer(3), dual=True)]  # optional plantri
      File "<doctest sage.graphs.graph_generators.GraphGenerators.?[11]>", line 1, in <listcomp>
        [len(g) for g in graphs.triangulations(Integer(9), minimum_degree=Integer(4), minimum_connectivity=Integer(3), dual=True)]  # optional plantri
      File "/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sage/graphs/graph_generators.py", line 1746, in triangulations
        for G in graphs._read_planar_code(sp.stdout):
      File "/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sage/graphs/graph_generators.py", line 1150, in _read_planar_code
        G.set_embedding(embed_g)
      File "/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sage/graphs/generic_graph.py", line 2444, in set_embedding
        self._check_embedding_validity(embedding, boolean=False)
      File "/Users/dcoudert/sage3/sage/local/lib/python3.7/site-packages/sage/graphs/generic_graph.py", line 2551, in _check_embedding_validity
        raise ValueError("{} and {} are not neighbors but {} is in the list associated with {}".format(u, v, u, v))
    ValueError: 10 and 9 are not neighbors but 10 is in the list associated with 9
```




---

archive/issue_comments_391242.json:
```json
{
    "body": "Moving tickets from the Sage 8.8 milestone that have been actively worked on in the last six months to the next release milestone (optimistically).",
    "created_at": "2019-07-03T11:37:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27711#issuecomment-391242",
    "user": "@embray"
}
```

Moving tickets from the Sage 8.8 milestone that have been actively worked on in the last six months to the next release milestone (optimistically).



---

archive/issue_comments_391243.json:
```json
{
    "body": "Looks good to me.\nI have opened #28108 for the two remaining doctests failures.",
    "created_at": "2019-07-03T14:36:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27711#issuecomment-391243",
    "user": "@vinklein"
}
```

Looks good to me.
I have opened #28108 for the two remaining doctests failures.



---

archive/issue_comments_391244.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-07-03T14:36:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27711#issuecomment-391244",
    "user": "@vinklein"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_391245.json:
```json
{
    "body": "Thank you.",
    "created_at": "2019-07-03T15:26:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27711#issuecomment-391245",
    "user": "@dcoudert"
}
```

Thank you.



---

archive/issue_comments_391246.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-07-05T12:02:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27711",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27711#issuecomment-391246",
    "user": "@vbraun"
}
```

Resolution: fixed
