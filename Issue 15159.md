# Issue 15159: fix  .an_element for affine and projective spaces

archive/issues_015159.json:
```json
{
    "body": "Assignee: bhutz\n\nKeywords: sage-days55, TestSuite\n\nThere are two failures when the TestSuite is run on affine or projective space. They are ``_test_an_element``, ``_test_some_elements``.  The first just needs an implementation of ``_an_element_`` which is done in this ticket. The second seems to be an underlying issue with ``test_category`` and will not be addressed here.\n\nIssue created by migration from https://trac.sagemath.org/ticket/15396\n\n",
    "created_at": "2013-11-10T16:19:51Z",
    "labels": [
        "algebraic geometry",
        "minor",
        "bug"
    ],
    "title": "fix  .an_element for affine and projective spaces",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15159",
    "user": "bhutz"
}
```
Assignee: bhutz

Keywords: sage-days55, TestSuite

There are two failures when the TestSuite is run on affine or projective space. They are ``_test_an_element``, ``_test_some_elements``.  The first just needs an implementation of ``_an_element_`` which is done in this ticket. The second seems to be an underlying issue with ``test_category`` and will not be addressed here.

Issue created by migration from https://trac.sagemath.org/ticket/15396





---

archive/issue_comments_194645.json:
```json
{
    "body": "Attachment",
    "created_at": "2013-11-10T16:23:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15159#issuecomment-194645",
    "user": "bhutz"
}
```

Attachment



---

archive/issue_comments_194646.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-11-18T16:43:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15159#issuecomment-194646",
    "user": "bhutz"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_194647.json:
```json
{
    "body": "I have made a git branch, and then a review commit on top of it\n----\nNew commits:",
    "created_at": "2014-01-07T20:45:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15159#issuecomment-194647",
    "user": "chapoton"
}
```

I have made a git branch, and then a review commit on top of it
----
New commits:



---

archive/issue_comments_194648.json:
```json
{
    "body": "So, what now? Do I review the review changes and mark as positive if I think they are fine?\n\nbtw, the reviewer field is still blank.",
    "created_at": "2014-01-13T15:03:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15159#issuecomment-194648",
    "user": "bhutz"
}
```

So, what now? Do I review the review changes and mark as positive if I think they are fine?

btw, the reviewer field is still blank.



---

archive/issue_comments_194649.json:
```json
{
    "body": "Well, I am not quite totally happy with the given elements. Maybe one can manage to make them more generic in some way ? Something like\n\n```\nself([(5 - i)*R.an_element() for i in range(n)])\n```\n\nmaybe ?",
    "created_at": "2014-01-13T15:09:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15159#issuecomment-194649",
    "user": "chapoton"
}
```

Well, I am not quite totally happy with the given elements. Maybe one can manage to make them more generic in some way ? Something like

```
self([(5 - i)*R.an_element() for i in range(n)])
```

maybe ?



---

archive/issue_comments_194650.json:
```json
{
    "body": "I understand what you are saying, but it is unclear to me what that would take. Since affine and projective space can be defined over essentially any ring `R`, multiplying `R.an_element()` by an integer may or may not be appropriate. Using `R.random_element()` also didn't seem appropriate for the `an.element()` function, but is likely a better choice than multiplying by integers without knowing what the base ring is.",
    "created_at": "2014-01-14T12:13:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15159#issuecomment-194650",
    "user": "bhutz"
}
```

I understand what you are saying, but it is unclear to me what that would take. Since affine and projective space can be defined over essentially any ring `R`, multiplying `R.an_element()` by an integer may or may not be appropriate. Using `R.random_element()` also didn't seem appropriate for the `an.element()` function, but is likely a better choice than multiplying by integers without knowing what the base ring is.



---

archive/issue_comments_194651.json:
```json
{
    "body": "Well, if you multiply by always the same integer, this can of course give always zero.\n\nMy proposal ensures that at least one half of the coordinates is not zero, because the difference between consecutive terms is just R.an_element().",
    "created_at": "2014-01-14T13:41:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15159#issuecomment-194651",
    "user": "chapoton"
}
```

Well, if you multiply by always the same integer, this can of course give always zero.

My proposal ensures that at least one half of the coordinates is not zero, because the difference between consecutive terms is just R.an_element().



---

archive/issue_comments_194652.json:
```json
{
    "body": "Yes, in just about any instance I can think of it will be fine. But, what if the base ring is something like `GL_n(F_2)` so that multiplying by 2 gives you the zero matrix which is not in the ring, i.e. `2*R.an_element()` does not exist.\n\nI see now you are also removing the last coordinate`R.one()` from my code, in this case all you are really defining in the point `(n,n-1,n-2,...,1,0)` since in projective space you can just factor out the `R.an_element()` from each coordinate. So you certainly cannot just have some multiple of `R.an_element()` for every coordinate.",
    "created_at": "2014-01-14T14:53:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15159#issuecomment-194652",
    "user": "bhutz"
}
```

Yes, in just about any instance I can think of it will be fine. But, what if the base ring is something like `GL_n(F_2)` so that multiplying by 2 gives you the zero matrix which is not in the ring, i.e. `2*R.an_element()` does not exist.

I see now you are also removing the last coordinate`R.one()` from my code, in this case all you are really defining in the point `(n,n-1,n-2,...,1,0)` since in projective space you can just factor out the `R.an_element()` from each coordinate. So you certainly cannot just have some multiple of `R.an_element()` for every coordinate.



---

archive/issue_comments_194653.json:
```json
{
    "body": "mmm. As far as I know, GL_N(F_2) is not a ring..",
    "created_at": "2014-01-14T15:12:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15159#issuecomment-194653",
    "user": "chapoton"
}
```

mmm. As far as I know, GL_N(F_2) is not a ring..



---

archive/issue_comments_194654.json:
```json
{
    "body": "yes, so that's a bad example. I was trying to think of something easy where multiplying by an integer was bad.",
    "created_at": "2014-01-14T15:51:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15159#issuecomment-194654",
    "user": "bhutz"
}
```

yes, so that's a bad example. I was trying to think of something easy where multiplying by an integer was bad.



---

archive/issue_comments_194655.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-14T20:06:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15159#issuecomment-194655",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_194656.json:
```json
{
    "body": "ok, here is my proposal. If you are happy with that, you can set a positive review (please check the TestSuite first).",
    "created_at": "2014-01-14T20:08:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15159#issuecomment-194656",
    "user": "chapoton"
}
```

ok, here is my proposal. If you are happy with that, you can set a positive review (please check the TestSuite first).



---

archive/issue_comments_194657.json:
```json
{
    "body": "and do not forget to fill you real name as author.",
    "created_at": "2014-01-14T20:10:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15159#issuecomment-194657",
    "user": "chapoton"
}
```

and do not forget to fill you real name as author.



---

archive/issue_comments_194658.json:
```json
{
    "body": "This does not seem to solve the TestSuite problem (neither for your original methods nor for my modified methods).",
    "created_at": "2014-01-14T20:19:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15159#issuecomment-194658",
    "user": "chapoton"
}
```

This does not seem to solve the TestSuite problem (neither for your original methods nor for my modified methods).



---

archive/issue_comments_194659.json:
```json
{
    "body": "I will run the the tests soon, but my original fix had fixed the problem for me. Just to double check, there are two issues with the testsuite (see original description above), this is only fixing the issue with `test_an_element()` and not `test_some_elements()`.",
    "created_at": "2014-01-15T00:57:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15159#issuecomment-194659",
    "user": "bhutz"
}
```

I will run the the tests soon, but my original fix had fixed the problem for me. Just to double check, there are two issues with the testsuite (see original description above), this is only fixing the issue with `test_an_element()` and not `test_some_elements()`.



---

archive/issue_comments_194660.json:
```json
{
    "body": "I was able to run this tonight. I'm getting the `test_an_element()` is fixed and the `test_category()` is still causing the other failure. The other failure is not addressed here.\n\nIs this what you got?",
    "created_at": "2014-01-15T02:07:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15159#issuecomment-194660",
    "user": "bhutz"
}
```

I was able to run this tonight. I'm getting the `test_an_element()` is fixed and the `test_category()` is still causing the other failure. The other failure is not addressed here.

Is this what you got?



---

archive/issue_comments_194661.json:
```json
{
    "body": "Yes, I got the same. So this ticket should be good to go. The remaining issue will be considered in another ticket.",
    "created_at": "2014-01-15T08:31:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15159#issuecomment-194661",
    "user": "chapoton"
}
```

Yes, I got the same. So this ticket should be good to go. The remaining issue will be considered in another ticket.



---

archive/issue_comments_194662.json:
```json
{
    "body": "I can't think of a ring where this fails to work, so we'll go with your proposal.\n\nSorry for one last question, but I'm still getting used to the git reviews. Is the commit message associated with this the one on the final code change, i.e. \"trac 15396 proposal for more typical elements\"? If so, I'll update it before marking positive.",
    "created_at": "2014-01-15T14:43:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15159#issuecomment-194662",
    "user": "bhutz"
}
```

I can't think of a ring where this fails to work, so we'll go with your proposal.

Sorry for one last question, but I'm still getting used to the git reviews. Is the commit message associated with this the one on the final code change, i.e. "trac 15396 proposal for more typical elements"? If so, I'll update it before marking positive.



---

archive/issue_comments_194663.json:
```json
{
    "body": "I do not know. Maybe this is not so important anyway. All commits will appear in the history. If you want something very clean, it is possible (but not recommended, I think) to smash all 3 commits into one using\n\n```\ngit rebase -i develop\n```\n\nand replacing two \"apply\" with \"s\" (standing for \"stash\") in the file that will open.\n\nOnce again, I think this is not necessary, and things are good as they stand now.",
    "created_at": "2014-01-15T15:34:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15159#issuecomment-194663",
    "user": "chapoton"
}
```

I do not know. Maybe this is not so important anyway. All commits will appear in the history. If you want something very clean, it is possible (but not recommended, I think) to smash all 3 commits into one using

```
git rebase -i develop
```

and replacing two "apply" with "s" (standing for "stash") in the file that will open.

Once again, I think this is not necessary, and things are good as they stand now.



---

archive/issue_comments_194664.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-01-15T20:28:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15159#issuecomment-194664",
    "user": "bhutz"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_194665.json:
```json
{
    "body": "If they all appear, then that is fine.",
    "created_at": "2014-01-15T20:28:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15159#issuecomment-194665",
    "user": "bhutz"
}
```

If they all appear, then that is fine.



---

archive/issue_comments_194666.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-01-16T19:23:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15159",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15159#issuecomment-194666",
    "user": "vbraun"
}
```

Resolution: fixed
