# Issue 15159: fix  .an_element for affine and projective spaces

Issue created by migration from https://trac.sagemath.org/ticket/15396

Original creator: bhutz

Original creation time: 2013-11-10 16:19:51

Assignee: bhutz

Keywords: sage-days55, TestSuite

There are two failures when the TestSuite is run on affine or projective space. They are ``_test_an_element``, ``_test_some_elements``.  The first just needs an implementation of ``_an_element_`` which is done in this ticket. The second seems to be an underlying issue with ``test_category`` and will not be addressed here.


---

Attachment


---

Comment by bhutz created at 2013-11-18 16:43:24

Changing status from new to needs_review.


---

Comment by chapoton created at 2014-01-07 20:45:49

I have made a git branch, and then a review commit on top of it
----
New commits:


---

Comment by bhutz created at 2014-01-13 15:03:02

So, what now? Do I review the review changes and mark as positive if I think they are fine?

btw, the reviewer field is still blank.


---

Comment by chapoton created at 2014-01-13 15:09:03

Well, I am not quite totally happy with the given elements. Maybe one can manage to make them more generic in some way ? Something like

```
self([(5 - i)*R.an_element() for i in range(n)])
```

maybe ?


---

Comment by bhutz created at 2014-01-14 12:13:59

I understand what you are saying, but it is unclear to me what that would take. Since affine and projective space can be defined over essentially any ring `R`, multiplying `R.an_element()` by an integer may or may not be appropriate. Using `R.random_element()` also didn't seem appropriate for the `an.element()` function, but is likely a better choice than multiplying by integers without knowing what the base ring is.


---

Comment by chapoton created at 2014-01-14 13:41:46

Well, if you multiply by always the same integer, this can of course give always zero.

My proposal ensures that at least one half of the coordinates is not zero, because the difference between consecutive terms is just R.an_element().


---

Comment by bhutz created at 2014-01-14 14:53:54

Yes, in just about any instance I can think of it will be fine. But, what if the base ring is something like `GL_n(F_2)` so that multiplying by 2 gives you the zero matrix which is not in the ring, i.e. `2*R.an_element()` does not exist.

I see now you are also removing the last coordinate`R.one()` from my code, in this case all you are really defining in the point `(n,n-1,n-2,...,1,0)` since in projective space you can just factor out the `R.an_element()` from each coordinate. So you certainly cannot just have some multiple of `R.an_element()` for every coordinate.


---

Comment by chapoton created at 2014-01-14 15:12:10

mmm. As far as I know, GL_N(F_2) is not a ring..


---

Comment by bhutz created at 2014-01-14 15:51:04

yes, so that's a bad example. I was trying to think of something easy where multiplying by an integer was bad.


---

Comment by git created at 2014-01-14 20:06:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2014-01-14 20:08:41

ok, here is my proposal. If you are happy with that, you can set a positive review (please check the TestSuite first).


---

Comment by chapoton created at 2014-01-14 20:10:54

and do not forget to fill you real name as author.


---

Comment by chapoton created at 2014-01-14 20:19:11

This does not seem to solve the TestSuite problem (neither for your original methods nor for my modified methods).


---

Comment by bhutz created at 2014-01-15 00:57:09

I will run the the tests soon, but my original fix had fixed the problem for me. Just to double check, there are two issues with the testsuite (see original description above), this is only fixing the issue with `test_an_element()` and not `test_some_elements()`.


---

Comment by bhutz created at 2014-01-15 02:07:34

I was able to run this tonight. I'm getting the `test_an_element()` is fixed and the `test_category()` is still causing the other failure. The other failure is not addressed here.

Is this what you got?


---

Comment by chapoton created at 2014-01-15 08:31:21

Yes, I got the same. So this ticket should be good to go. The remaining issue will be considered in another ticket.


---

Comment by bhutz created at 2014-01-15 14:43:00

I can't think of a ring where this fails to work, so we'll go with your proposal.

Sorry for one last question, but I'm still getting used to the git reviews. Is the commit message associated with this the one on the final code change, i.e. "trac 15396 proposal for more typical elements"? If so, I'll update it before marking positive.


---

Comment by chapoton created at 2014-01-15 15:34:35

I do not know. Maybe this is not so important anyway. All commits will appear in the history. If you want something very clean, it is possible (but not recommended, I think) to smash all 3 commits into one using

```
git rebase -i develop
```

and replacing two "apply" with "s" (standing for "stash") in the file that will open.

Once again, I think this is not necessary, and things are good as they stand now.


---

Comment by bhutz created at 2014-01-15 20:28:07

Changing status from needs_review to positive_review.


---

Comment by bhutz created at 2014-01-15 20:28:07

If they all appear, then that is fine.


---

Comment by vbraun created at 2014-01-16 19:23:27

Resolution: fixed
