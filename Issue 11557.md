# Issue 11557: Cache module import locations

archive/issues_011557.json:
```json
{
    "body": "Assignee: jason\n\nCC:  was robertwb ohanar simonking\n\nThis ticket implements a cached module importer for Python. It hooks into the Python import framework and caches whether a module was found and if so, its location. The cache is persistent over sessions.\n\nExcept for the location of the persistent storage (in `DOT_SAGE/import_cache.txt`) there is no dependency on Sage.\n\nBy default, the cached importer is not active. To activate it on your system, you have to import the module at one point in the Python startup, preferably as early as possible. The easiest way to do so is to create a file `$SAGE_LOCAL/lib/python/site-packages/sitecustomize.py` containing the single line\n\n```\nimport sage.misc.importer\n```\n\n\nSome benchmarks:\n\n```sh\n\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/11729\n\n",
    "created_at": "2011-08-24T03:26:41Z",
    "labels": [
        "misc",
        "major",
        "enhancement"
    ],
    "title": "Cache module import locations",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11557",
    "user": "vbraun"
}
```
Assignee: jason

CC:  was robertwb ohanar simonking

This ticket implements a cached module importer for Python. It hooks into the Python import framework and caches whether a module was found and if so, its location. The cache is persistent over sessions.

Except for the location of the persistent storage (in `DOT_SAGE/import_cache.txt`) there is no dependency on Sage.

By default, the cached importer is not active. To activate it on your system, you have to import the module at one point in the Python startup, preferably as early as possible. The easiest way to do so is to create a file `$SAGE_LOCAL/lib/python/site-packages/sitecustomize.py` containing the single line

```
import sage.misc.importer
```


Some benchmarks:

```sh

```


Issue created by migration from https://trac.sagemath.org/ticket/11729





---

archive/issue_comments_129971.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd32\".",
    "created_at": "2011-08-24T23:31:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11557#issuecomment-129971",
    "user": "was"
}
```

Changing keywords from "" to "sd32".



---

archive/issue_comments_129972.json:
```json
{
    "body": "NOTE: If you try to test this, watch out because of these lines:\n\n```\n\t113\tcat <<EOF > \"$SAGE_LOCAL/lib/python/site-packages/sitecustomize.py\" \n \t114\tfrom sage.misc.importer import sage_importer \n \t115\tsage_importer.register() \n \t116\tEOF \n```\n\nThey can make it so your Sage install is totally broken.  To fix, just remove the contents of sitecustomize.py.   I spent 15 minutes confused by this.",
    "created_at": "2011-08-26T01:29:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11557#issuecomment-129972",
    "user": "was"
}
```

NOTE: If you try to test this, watch out because of these lines:

```
	113	cat <<EOF > "$SAGE_LOCAL/lib/python/site-packages/sitecustomize.py" 
 	114	from sage.misc.importer import sage_importer 
 	115	sage_importer.register() 
 	116	EOF 
```

They can make it so your Sage install is totally broken.  To fix, just remove the contents of sitecustomize.py.   I spent 15 minutes confused by this.



---

archive/issue_comments_129973.json:
```json
{
    "body": "You have to delete both `$SAGE_LOCAL/lib/python/site-packages/sitecustomize.py` and `$SAGE_LOCAL/lib/python/site-packages/sitecustomize.pyc`, though the latter might not exist. The final version of the patch will test that sage starts up successfully and otherwise delete the `sitecustomize.py` automatically.\n\nAlso, if you run into problems (presumably some `ImportError`), please post what is causing it.",
    "created_at": "2011-08-26T02:57:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11557#issuecomment-129973",
    "user": "vbraun"
}
```

You have to delete both `$SAGE_LOCAL/lib/python/site-packages/sitecustomize.py` and `$SAGE_LOCAL/lib/python/site-packages/sitecustomize.pyc`, though the latter might not exist. The final version of the patch will test that sage starts up successfully and otherwise delete the `sitecustomize.py` automatically.

Also, if you run into problems (presumably some `ImportError`), please post what is causing it.



---

archive/issue_comments_129974.json:
```json
{
    "body": "Updated patch",
    "created_at": "2011-08-27T03:00:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11557#issuecomment-129974",
    "user": "vbraun"
}
```

Updated patch



---

archive/issue_comments_129975.json:
```json
{
    "body": "Attachment\n\nUpdated patch",
    "created_at": "2011-09-12T17:45:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11557#issuecomment-129975",
    "user": "vbraun"
}
```

Attachment

Updated patch



---

archive/issue_comments_129976.json:
```json
{
    "body": "I've added another workaround for `PIL.Image`, now `make ptest` passes! I would say that the patch is now feature-complete, though it lacks documentation and doctests. Though writing doctests is tricky without breaking the module importing. Somebody should test it on OSX :-)",
    "created_at": "2011-09-12T18:06:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11557#issuecomment-129976",
    "user": "vbraun"
}
```

I've added another workaround for `PIL.Image`, now `make ptest` passes! I would say that the patch is now feature-complete, though it lacks documentation and doctests. Though writing doctests is tricky without breaking the module importing. Somebody should test it on OSX :-)



---

archive/issue_comments_129977.json:
```json
{
    "body": "outdated, should close",
    "created_at": "2021-12-02T00:55:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11557#issuecomment-129977",
    "user": "mkoeppe"
}
```

outdated, should close



---

archive/issue_comments_129978.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-12-02T00:55:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11557#issuecomment-129978",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_129979.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-12-03T09:33:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11557#issuecomment-129979",
    "user": "dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_129980.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2021-12-03T18:41:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11557",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11557#issuecomment-129980",
    "user": "mkoeppe"
}
```

Resolution: invalid
