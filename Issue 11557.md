# Issue 11557: Cache module import locations

Issue created by migration from https://trac.sagemath.org/ticket/11729

Original creator: vbraun

Original creation time: 2011-08-24 03:26:41

Assignee: jason

CC:  was robertwb ohanar simonking

This ticket implements a cached module importer for Python. It hooks into the Python import framework and caches whether a module was found and if so, its location. The cache is persistent over sessions.

Except for the location of the persistent storage (in `DOT_SAGE/import_cache.txt`) there is no dependency on Sage.

By default, the cached importer is not active. To activate it on your system, you have to import the module at one point in the Python startup, preferably as early as possible. The easiest way to do so is to create a file `$SAGE_LOCAL/lib/python/site-packages/sitecustomize.py` containing the single line

```
import sage.misc.importer
```


Some benchmarks:

```sh

```



---

Comment by was created at 2011-08-24 23:31:10

Changing keywords from "" to "sd32".


---

Comment by was created at 2011-08-26 01:29:23

NOTE: If you try to test this, watch out because of these lines:

```
	113	cat <<EOF > "$SAGE_LOCAL/lib/python/site-packages/sitecustomize.py" 
 	114	from sage.misc.importer import sage_importer 
 	115	sage_importer.register() 
 	116	EOF 
```

They can make it so your Sage install is totally broken.  To fix, just remove the contents of sitecustomize.py.   I spent 15 minutes confused by this.


---

Comment by vbraun created at 2011-08-26 02:57:47

You have to delete both `$SAGE_LOCAL/lib/python/site-packages/sitecustomize.py` and `$SAGE_LOCAL/lib/python/site-packages/sitecustomize.pyc`, though the latter might not exist. The final version of the patch will test that sage starts up successfully and otherwise delete the `sitecustomize.py` automatically.

Also, if you run into problems (presumably some `ImportError`), please post what is causing it.


---

Comment by vbraun created at 2011-08-27 03:00:35

Updated patch


---

Attachment

Updated patch


---

Comment by vbraun created at 2011-09-12 18:06:19

I've added another workaround for `PIL.Image`, now `make ptest` passes! I would say that the patch is now feature-complete, though it lacks documentation and doctests. Though writing doctests is tricky without breaking the module importing. Somebody should test it on OSX :-)


---

Comment by mkoeppe created at 2021-12-02 00:55:52

outdated, should close


---

Comment by mkoeppe created at 2021-12-02 00:55:52

Changing status from new to needs_review.


---

Comment by dimpase created at 2021-12-03 09:33:41

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2021-12-03 18:41:01

Resolution: invalid
