# Issue 18393: Expression.is_positive/negative incomplete

Issue created by migration from https://trac.sagemath.org/ticket/18630

Original creator: rws

Original creation time: 2015-06-07 15:37:43

CC:  kcrisman pelegm

The two functions that query Pynac expressions' `info::flags` only work with `numeric`s and `symbol`s with domain. The rest simply returns `False`:

```
sage: (1-pi).is_negative()
False
sage: (log(1/2)).is_negative()
False
sage: e.is_positive()
False
sage: (e+1).is_positive()
False
sage: (2*e).is_positive()
False
sage: (e^3).is_positive()
False
```



---

Comment by rws created at 2015-06-09 16:03:23

Parts of this are fixed in https://github.com/pynac/pynac/issues/66 (will be pynac-0.3.9.1/0.4.1)


---

Comment by rws created at 2015-06-10 08:38:30

While products are okay already, sums with negative terms are not and will not be for some time. Correct handling depends on https://github.com/pynac/pynac/issues/67 and https://github.com/pynac/pynac/issues/68 and affects #12588 too, for example.


---

Comment by rws created at 2017-06-07 07:17:11

Since everything apart from sums works now, let's look at what is possible with sums containing exact `numeric`s (in the Pynac sense) and constants only. The border case is if the expression is nonzero---but only at certain precision. This is impossible to handle. It is also not possible to convert to float and only check sign if the absolute result is greater some epsilon, because that could be due to precision loss in a denominator.

I'm therefore just adding the doctests here to resolve the ticket.


---

Comment by rws created at 2017-06-07 07:18:41

New commits:


---

Comment by rws created at 2017-06-07 07:18:41

Changing status from new to needs_review.


---

Comment by git created at 2017-11-09 07:07:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2017-11-28 07:15:08

Docbuild error: `ValueError: line 48 of the docstring for sage.symbolic.expression.Expression.is_positive has inconsistent leading whitespace: u'::'`


---

Comment by rws created at 2017-11-28 07:15:08

Changing status from needs_review to needs_work.


---

Comment by rws created at 2017-12-04 15:33:56

New commits:


---

Comment by rws created at 2017-12-04 15:33:56

Changing status from needs_work to needs_review.


---

Comment by vdelecroix created at 2017-12-06 20:51:48

Would be nice to also have some less trivial examples

```
sage: (log(1/3) * log(1/2)).is_positive()
True
sage: log((2**500+1)/2**500).is_positive()
True
sage: log(2*500/(2**500-1)).is_negative()
True
```

And the following are other failing examples

```
sage: sin(pi/37).is_positive()   # algebraic number!
False
sage: (sqrt(2)-1).is_positive()  # algebric number!
False
sage: log(pi).is_positive()
False 
sage: sin(3).is_positive()
False
sage: sin(5).is_negative()
False
```



---

Comment by vdelecroix created at 2017-12-06 20:56:49

And I don't understand why the following is ok

```
sage: ((-pi^(1/5))^2).is_positive()
True
```

while not these ones

```
sage: (pi^2).is_positive()
False
sage: ((-pi)^2).is_positive()
False
```



---

Comment by rws created at 2017-12-07 14:33:05

Replying to [comment:11 vdelecroix]:
> And the following are other failing examples
> {{{
> sage: sin(pi/37).is_positive()   # algebraic number!
> False
> sage: (sqrt(2)-1).is_positive()  # algebric number!
> False
> sage: log(pi).is_positive()
> False 
> sage: sin(3).is_positive()
> False
> sage: sin(5).is_negative()
> False
> }}}

They are not failing. The result False simply means "I don't know.".


---

Comment by rws created at 2017-12-07 15:08:06

Replying to [comment:12 vdelecroix]:
> {{{
> sage: (pi^2).is_positive()
> False
> sage: ((-pi)^2).is_positive()
> False
> }}}

One logic for `b^e.is_positive()` is `if (e.is_even()) return b.is_real() and b.is_nonzero()` but `is_nonzero` was not implemented for constants until now. This is fixed in https://github.com/pynac/pynac/commit/e92febc468800e4a1457f944bb7a45e9baf0e2f6 and will be in pynac-0.7.15. We can as well put all of these doctests in this ticket too. Thanks for the report!


---

Comment by rws created at 2017-12-07 15:08:06

Changing status from needs_review to needs_work.


---

Comment by rws created at 2017-12-07 15:30:59

Replying to [comment:13 rws]:
> They are not failing. The result False simply means "I don't know.".

See also #22162.


---

Comment by rws created at 2017-12-09 13:46:12

See also https://github.com/pynac/pynac/issues/293 for progress on what is completely implemented as internal Pynac flag.


---

Comment by rws created at 2018-01-29 13:56:30

Changing status from needs_work to needs_review.


---

Comment by rws created at 2018-01-29 13:56:30

New commits:


---

Comment by pelegm created at 2018-06-30 15:32:56

Seems like the first test still fails:

```sage
sage: (1-pi).is_negative()
False
```


Do we want to merge it as is?


---

Comment by rws created at 2018-06-30 15:59:50

Yes, see comment:15.


---

Comment by vdelecroix created at 2020-02-16 20:15:33

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2020-02-19 23:27:02

Resolution: fixed
