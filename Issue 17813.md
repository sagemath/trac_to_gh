# Issue 17813: Implement dual equivalence graphs

Issue created by migration from https://trac.sagemath.org/ticket/18050

Original creator: tscrim

Original creation time: 2015-03-25 03:18:44

Assignee: sage-combinat

CC:  sage-combinat aschilling darij troby

Keywords: dual equivalence graphs

Implement methods for dual equivalence graphs coming from standard tableaux of a fixed shape and as weight 0 crystal spaces.


---

Comment by tscrim created at 2015-03-25 03:19:15

Changing status from new to needs_review.


---

Comment by tscrim created at 2015-03-25 03:19:15

New commits:


---

Comment by git created at 2015-03-25 16:51:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2015-04-01 18:45:25

some failing doctests, see patchbot report


---

Comment by chapoton created at 2015-04-01 18:45:25

Changing status from needs_review to needs_work.


---

Comment by darij created at 2015-04-01 18:50:23

In other news, here's something I've been long since curious about:

```
+ - :meth:`~sage.categories.regular_crystals.RegularCrystals.ParentMethods.dual_equivalence_graph`
+ - :meth:`sage.combinat.partition.Partition.dual_equivalence_graph`
```

What is the difference between the syntax with the tilde and that without?


---

Comment by tscrim created at 2015-04-01 18:52:19

The tilde only displays the last thing after a dot, without displays the entire path.


---

Comment by darij created at 2015-04-01 18:53:47

Ah, thank you!


---

Comment by git created at 2015-04-01 19:09:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2015-04-01 19:09:35

Changing status from needs_work to needs_review.


---

Comment by darij created at 2015-04-01 20:08:57

Stupid question:

Assuming that your dual equivalence graph is the graph `\mathcal{G}(\mathcal{X})` defined in Section 4 of the Assaf preprint you are citing, is your condition `\varepsilon_j(b) = \varphi_j(b)` really equivalent to her (4.1) ? If so, what are the connections between your `\varepsilon` and `\varphi` and her `\varepsilon` and `\delta`?


---

Comment by tscrim created at 2015-04-01 20:23:52

The `\varepsilon_j(b) = \varphi_j(b)` comes from the crystal axiom `\varphi_j(b) = \varepsilon_j(b) + wt(b)` (`wt` is the weight) and we are looking at the `wt(b) = 0` elements. Her `\varepsilon` is the same as mine and the `\delta` is something related but slightly different (see towards the beginning of section 2).


---

Comment by mantepse created at 2015-04-01 21:14:52

I think the docstring of `Partition.dual_equivalence_graph` could be clearer.  I suggest


```
Two permutations `p` and `q` differ by an elementary dual Knuth
relation (of color `i`), when, in one line notation, the letter
`i` does not occur between `i-1` and `i+1`, and `q` is obtained 
from `p` by switching the places of `i-1` and `i+1`.

Two standard Young tableaux of shape `\lambda` differ by an
elementary dual Knuth relation (of color `i`), if their content
reading words differ by an elementary dual Knuth relation (of
color `i`).

The *dual equivalence graph* is the edge-colored graph formed by
the set of standard Young tableaux of shape `\lambda` where edges
colored by `i` are given by dual equivalences of color `i`.
```



---

Comment by darij created at 2015-04-01 21:31:17

Replying to [comment:11 tscrim]:
> The `\varepsilon_j(b) = \varphi_j(b)` comes from the crystal axiom `\varphi_j(b) = \varepsilon_j(b) + wt(b)` (`wt` is the weight) and we are looking at the `wt(b) = 0` elements. Her `\varepsilon` is the same as mine and the `\delta` is something related but slightly different (see towards the beginning of section 2).

Oh. Is `\delta_j(b)` the same as your `-\varphi_j(b)`? And what does the `= 0 or 1` part of Assaf's (4.1) correspond to in your definition?


---

Comment by tscrim created at 2015-04-01 22:04:17

Replying to [comment:13 darij]:
> Oh. Is `\delta_j(b)` the same as your `-\varphi_j(b)`?

Yes.

> And what does the `= 0 or 1` part of Assaf's (4.1) correspond to in your definition?

It means that we can do the `e_i` operation exactly 0 or 1 times before it falls off the crystal graph. In other words, these conditions state that if there is an `i`-arrow in the crystal graph going through `b`, then the entire chain of `i`-arrows containing `b` has length 2 with `b` in the middle.

`@`mantepse I will make those changes in a minute.


---

Comment by git created at 2015-04-01 22:12:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-04-02 00:50:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by darij created at 2015-04-02 00:52:14

I've been through (the easy) part of the code. Nice to see this going into Sage!

My question is still standing: Where are the `= 0 or 1` conditions in Assaf's (4.1) reflected in your code and doc? Or are they redundant, or wrong, or your notion of dual equivalence graphs different?

Also, I had to change the meaning of "head" (of a directed edge) in the partitions.py method; please check whether it is correctly used in the other file.

In regular_crystals.py, what is required of X ? Should it be closed under e_i and f_i?


---

Comment by tscrim created at 2015-04-02 05:04:44

Replying to [comment:17 darij]:
> I've been through (the easy) part of the code. Nice to see this going into Sage!

Thanks for doing the review.

> My question is still standing: Where are the `= 0 or 1` conditions in Assaf's (4.1) reflected in your code and doc? Or are they redundant, or wrong, or your notion of dual equivalence graphs different?

It's in the code, see this line:

```
if x.epsilon(i) == 1 and x.epsilon(im) == 0:
```

Note that because I considered the directed, I make it slightly more specific than Assaf's definition by saying `\varepsilon_j(b) = 1`. A similar statement appears in the doc.

> Also, I had to change the meaning of "head" (of a directed edge) in the partitions.py method; please check whether it is correctly used in the other file.

It looks okay. I think instead of writing `a - b` we should do `a \to b` in both files for directed edges (especially since it's in latex).

I also feel this statement is too verbose:

```
- In the one-line notation of the permutation `p`, the letter
  `i` appears either to the left of both `i-1` and `i+1`, or
  to the right of both `i-1` and `i+1` (but not between the
  two).
```

and we should just say `i` does not appear between `i-1` and `i+1`. Does this sound okay?

> In regular_crystals.py, what is required of X ? Should it be closed under e_i and f_i?

No, I wanted it to be as general as possible (at least this is what I needed for my research; I didn't necessarily know if my set of elements was the full dual equivalence class).


---

Comment by darij created at 2015-04-02 05:10:46

Replying to [comment:18 tscrim]:
> > My question is still standing: Where are the `= 0 or 1` conditions in Assaf's (4.1) reflected in your code and doc? Or are they redundant, or wrong, or your notion of dual equivalence graphs different?
> 
> It's in the code, see this line:
> {{{
> if x.epsilon(i) == 1 and x.epsilon(im) == 0:
> }}}

But what about the doc? Without this condition it sounds like your graph has a lot more (isolated) vertices than it should have.

> Note that because I considered the directed, I make it slightly more specific than Assaf's definition by saying `\varepsilon_j(b) = 1`. A similar statement appears in the doc.
> 
> > Also, I had to change the meaning of "head" (of a directed edge) in the partitions.py method; please check whether it is correctly used in the other file.
> 
> It looks okay. I think instead of writing `a - b` we should do `a \to b` in both files for directed edges (especially since it's in latex).

I think it's fine the way it is. The edge is undirected a priori; we direct it by assigning it a head. You'd have to reword my definition if you want to put an arrow there.

> I also feel this statement is too verbose:
> {{{
> - In the one-line notation of the permutation `p`, the letter
>   `i` appears either to the left of both `i-1` and `i+1`, or
>   to the right of both `i-1` and `i+1` (but not between the
>   two).
> }}}
> and we should just say `i` does not appear between `i-1` and `i+1`. Does this sound okay?

That's fine; feel free to change it (I won't return to this until tomorrow).

> > In regular_crystals.py, what is required of X ? Should it be closed under e_i and f_i?
> 
> No, I wanted it to be as general as possible (at least this is what I needed for my research; I didn't necessarily know if my set of elements was the full dual equivalence class).

OK, but it seems (from a brief glance) that if you don't have a union of equivalence classes, then your code can leak some non-X vertices into the graph by constructing edges one of whose endpoints is not in X. Is that OK to you?


---

Comment by git created at 2015-04-13 13:54:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2015-04-13 13:56:28

Replying to [comment:19 darij]:
> Replying to [comment:18 tscrim]:
> > > My question is still standing: Where are the `= 0 or 1` conditions in Assaf's (4.1) reflected in your code and doc? Or are they redundant, or wrong, or your notion of dual equivalence graphs different?
> > 
> > It's in the code, see this line:
> > {{{
> > if x.epsilon(i) == 1 and x.epsilon(im) == 0:
> > }}}
> 
> But what about the doc? Without this condition it sounds like your graph has a lot more (isolated) vertices than it should have.

I forgot to say that this is in the doc as well.

> > It looks okay. I think instead of writing `a - b` we should do `a \to b` in both files for directed edges (especially since it's in latex).
> 
> I think it's fine the way it is. The edge is undirected a priori; we direct it by assigning it a head. You'd have to reword my definition if you want to put an arrow there.

I made a change which I think is more clear. Comments welcomed.

> > I also feel this statement is too verbose:
> > {{{
> > - In the one-line notation of the permutation `p`, the letter
> >   `i` appears either to the left of both `i-1` and `i+1`, or
> >   to the right of both `i-1` and `i+1` (but not between the
> >   two).
> > }}}
> > and we should just say `i` does not appear between `i-1` and `i+1`. Does this sound okay?
> 
> That's fine; feel free to change it (I won't return to this until tomorrow).

I've made this change.

> > > In regular_crystals.py, what is required of X ? Should it be closed under e_i and f_i?
> > 
> > No, I wanted it to be as general as possible (at least this is what I needed for my research; I didn't necessarily know if my set of elements was the full dual equivalence class).
> 
> OK, but it seems (from a brief glance) that if you don't have a union of equivalence classes, then your code can leak some non-X vertices into the graph by constructing edges one of whose endpoints is not in X. Is that OK to you?

Eeek, you're right. I made changes so that non-X vertices are not added to the DEG.


---

Comment by git created at 2015-04-13 16:13:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by darij created at 2015-04-13 16:14:09

Changing keywords from "dual equivalence graphs" to "dual equivalence graphs, days67".


---

Comment by git created at 2015-04-13 16:15:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-04-13 16:25:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by nthiery created at 2015-04-13 16:34:30

Changing keywords from "dual equivalence graphs, days67" to "dual equivalence graphs, sd67".


---

Comment by git created at 2015-04-13 17:58:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-04-13 20:02:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-04-13 20:28:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-04-13 20:43:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-04-13 20:45:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by darij created at 2015-04-13 20:46:15

Changing status from needs_review to positive_review.


---

Comment by darij created at 2015-04-13 20:46:54

Positive review by Travis who was standing over my shoulders and explaining what I should not do. :P


---

Comment by git created at 2015-04-14 06:12:19

Changing status from positive_review to needs_review.


---

Comment by git created at 2015-04-14 06:12:19

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by darij created at 2015-04-14 06:14:46

Couldn't resist fixing a few docstrings which made an iterator sound like it was a list and lists pretend to be iterators. Can you review this last bit, Travis? Thanks!


---

Comment by tscrim created at 2015-04-14 13:32:24

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2015-04-14 13:32:24

NP.


---

Comment by aschilling created at 2015-04-14 14:11:35

For your coloring scheme, why don't you do it with a dictionary rather than the long list of if statements?

Anne


---

Comment by git created at 2015-04-14 15:22:34

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by git created at 2015-04-14 15:22:34

Changing status from positive_review to needs_review.


---

Comment by git created at 2015-04-14 15:45:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2015-04-14 15:47:08

That's a much better method to get the colors. I also pulled in #18032 because we needed to get immutable copies of the graph so I could write a custom cache which does not regenerate the graph when we only want a different coloring.

I also marked a test as long since it took nearly 20s on my computer.

Someone check my changes please.


---

Comment by git created at 2015-04-14 15:57:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by darij created at 2015-04-14 16:33:47

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-04-14 23:01:32

Resolution: fixed
