# Issue 17490: Remove redundant parent_c() functions

archive/issues_017490.json:
```json
{
    "body": "\n\nIssue created by migration from https://trac.sagemath.org/ticket/17727\n\n",
    "created_at": "2015-02-04T09:36:33Z",
    "labels": [
        "component: coercion"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.5",
    "title": "Remove redundant parent_c() functions",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17490",
    "user": "https://github.com/jdemeyer"
}
```


Issue created by migration from https://trac.sagemath.org/ticket/17727





---

archive/issue_comments_233351.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-02-04T11:27:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17490#issuecomment-233351",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_233352.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-02-04T11:27:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17490#issuecomment-233352",
    "user": "https://github.com/jdemeyer"
}
```

New commits:



---

archive/issue_comments_233353.json:
```json
{
    "body": "Replying to [ticket:17727 jdemeyer]:\n> We copy a short-cut from `sage/symbolic/function.pxd` for [numbers](https://docs.python.org/2/c-api/number.html) not inheriting from `Element` (in particular Python `int` and `float`): we assume that these do not have a parent.\n\nIMHO it would be nice to add a note to that effect in the docstring of `s.s.element.parent`. (Not that I really think anyone assigns parents to objects derived from built-in number types... but the concept is important enough that subtle points in its definition should be documented.)",
    "created_at": "2015-02-04T16:44:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17490#issuecomment-233353",
    "user": "https://github.com/mezzarobba"
}
```

Replying to [ticket:17727 jdemeyer]:
> We copy a short-cut from `sage/symbolic/function.pxd` for [numbers](https://docs.python.org/2/c-api/number.html) not inheriting from `Element` (in particular Python `int` and `float`): we assume that these do not have a parent.

IMHO it would be nice to add a note to that effect in the docstring of `s.s.element.parent`. (Not that I really think anyone assigns parents to objects derived from built-in number types... but the concept is important enough that subtle points in its definition should be documented.)



---

archive/issue_comments_233354.json:
```json
{
    "body": "According to Python documentation\n\n```\nint PyNumber_Check(PyObject *o)\n    Returns 1 if the object o provides numeric protocols,\n    and false otherwise. This function always succeeds.\n```\n\nSo even sage integers, floating points numbers and many others will answer true to that (I checked). And from the specification I do not see how such test can be fast. I do not have anything against using `PyNumber_Check` but the associated comment is definitely not appropriate.\n\nRelated question: why should we check for a method `.parent()`? Would the following be invalid?\n\n```\ncdef parent_c(x):\n    if isintance(x, Element):\n        return (<Element> x)._parent\n    else:\n        return type(x)\n```\n\n\nVincent",
    "created_at": "2015-02-04T21:02:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17490#issuecomment-233354",
    "user": "https://github.com/videlec"
}
```

According to Python documentation

```
int PyNumber_Check(PyObject *o)
    Returns 1 if the object o provides numeric protocols,
    and false otherwise. This function always succeeds.
```

So even sage integers, floating points numbers and many others will answer true to that (I checked). And from the specification I do not see how such test can be fast. I do not have anything against using `PyNumber_Check` but the associated comment is definitely not appropriate.

Related question: why should we check for a method `.parent()`? Would the following be invalid?

```
cdef parent_c(x):
    if isintance(x, Element):
        return (<Element> x)._parent
    else:
        return type(x)
```


Vincent



---

archive/issue_comments_233355.json:
```json
{
    "body": "Replying to [comment:6 vdelecroix]:\n> According to Python documentation\n> {{{\n> int PyNumber_Check(PyObject *o)\n>     Returns 1 if the object o provides numeric protocols,\n>     and false otherwise. This function always succeeds.\n> }}}\n> So even sage integers, floating points numbers and many others will answer true to that (I checked). And from the specification I do not see how such test can be fast.\n\nI don't understand your comment. As far as I understand `PyNumber_Check` should amount to check if the corresponding `PyTypeObject`'s `tp_as_number` is non-`NULL`, and that should indeed be pretty fast.",
    "created_at": "2015-02-04T21:37:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17490#issuecomment-233355",
    "user": "https://github.com/mezzarobba"
}
```

Replying to [comment:6 vdelecroix]:
> According to Python documentation
> {{{
> int PyNumber_Check(PyObject *o)
>     Returns 1 if the object o provides numeric protocols,
>     and false otherwise. This function always succeeds.
> }}}
> So even sage integers, floating points numbers and many others will answer true to that (I checked). And from the specification I do not see how such test can be fast.

I don't understand your comment. As far as I understand `PyNumber_Check` should amount to check if the corresponding `PyTypeObject`'s `tp_as_number` is non-`NULL`, and that should indeed be pretty fast.



---

archive/issue_comments_233356.json:
```json
{
    "body": "Replying to [comment:7 mmezzarobba]:\n> Replying to [comment:6 vdelecroix]:\n> > According to Python documentation\n> > {{{\n> > int PyNumber_Check(PyObject *o)\n> >     Returns 1 if the object o provides numeric protocols,\n> >     and false otherwise. This function always succeeds.\n> > }}}\n> > So even sage integers, floating points numbers and many others will answer true to that (I checked). And from the specification I do not see how such test can be fast.\n> \n> I don't understand your comment. As far as I understand `PyNumber_Check` should amount to check if the corresponding `PyTypeObject`'s `tp_as_number` is non-`NULL`, and that should indeed be pretty fast.\n\nYou are definitely right\n\n```\nint\nPyNumber_Check(PyObject *o)\n{\n    return o && o->ob_type->tp_as_number &&\n           (o->ob_type->tp_as_number->nb_int ||\n        o->ob_type->tp_as_number->nb_float);\n}\n```\n\n... (but it answers `True` on much more instances than only int/float) ...\n\nMost important is the other question: why should we return `x.parent()` if it is not an element?\n\nVincent",
    "created_at": "2015-02-04T21:50:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17490#issuecomment-233356",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:7 mmezzarobba]:
> Replying to [comment:6 vdelecroix]:
> > According to Python documentation
> > {{{
> > int PyNumber_Check(PyObject *o)
> >     Returns 1 if the object o provides numeric protocols,
> >     and false otherwise. This function always succeeds.
> > }}}
> > So even sage integers, floating points numbers and many others will answer true to that (I checked). And from the specification I do not see how such test can be fast.
> 
> I don't understand your comment. As far as I understand `PyNumber_Check` should amount to check if the corresponding `PyTypeObject`'s `tp_as_number` is non-`NULL`, and that should indeed be pretty fast.

You are definitely right

```
int
PyNumber_Check(PyObject *o)
{
    return o && o->ob_type->tp_as_number &&
           (o->ob_type->tp_as_number->nb_int ||
        o->ob_type->tp_as_number->nb_float);
}
```

... (but it answers `True` on much more instances than only int/float) ...

Most important is the other question: why should we return `x.parent()` if it is not an element?

Vincent



---

archive/issue_comments_233357.json:
```json
{
    "body": "Replying to [comment:8 vdelecroix]:\n> Most important is the other question: why should we return `x.parent()` if it is not an element?\nBecause some classes which really should be an `Element` aren't actually an `Element`. See #17578 for example. If all such bugs are fixed, we could remove that additional test.",
    "created_at": "2015-02-05T07:55:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17490#issuecomment-233357",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:8 vdelecroix]:
> Most important is the other question: why should we return `x.parent()` if it is not an element?
Because some classes which really should be an `Element` aren't actually an `Element`. See #17578 for example. If all such bugs are fixed, we could remove that additional test.



---

archive/issue_comments_233358.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-05T14:32:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17490#issuecomment-233358",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_233359.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-02-05T16:00:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17490#issuecomment-233359",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_016859.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-02-18T01:26:59Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17490",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17490#event-16859"
}
```



---

archive/issue_comments_233360.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-02-18T01:26:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17490#issuecomment-233360",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
