# Issue 16160: Symbolic cmp

archive/issues_016160.json:
```json
{
    "body": "CC:  vdelecroix mmezzarobba jpflori\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/16397\n\n",
    "created_at": "2014-05-25T17:25:28Z",
    "labels": [
        "PLEASE CHANGE",
        "major"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.1",
    "title": "Symbolic cmp",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16160",
    "user": "vbraun"
}
```
CC:  vdelecroix mmezzarobba jpflori



Issue created by migration from https://trac.sagemath.org/ticket/16397





---

archive/issue_comments_211033.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to symbolics.",
    "created_at": "2014-05-25T17:28:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16160#issuecomment-211033",
    "user": "vbraun"
}
```

Changing component from PLEASE CHANGE to symbolics.



---

archive/issue_comments_211034.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2014-05-25T17:28:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16160#issuecomment-211034",
    "user": "vbraun"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_211035.json:
```json
{
    "body": "I can see how that might be surprising. :)\n\nIIRC, that was a conscious decision to expose the print order from Pynac to !Python/Sage to be used for sorting lists, etc. where symbolic expressions occur. I guess many places in the code call `cmp()` instead of using the comparison operators.\n\nWe would need to get rid of this design for Python 3 compatibility anyway. Shall we remove support for `cmp()` and change all places where lists are returned from symbolics to explicitly call the print order?",
    "created_at": "2014-05-25T18:08:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16160#issuecomment-211035",
    "user": "burcin"
}
```

I can see how that might be surprising. :)

IIRC, that was a conscious decision to expose the print order from Pynac to !Python/Sage to be used for sorting lists, etc. where symbolic expressions occur. I guess many places in the code call `cmp()` instead of using the comparison operators.

We would need to get rid of this design for Python 3 compatibility anyway. Shall we remove support for `cmp()` and change all places where lists are returned from symbolics to explicitly call the print order?



---

archive/issue_comments_211036.json:
```json
{
    "body": "Yes, thats what I'm thinking as well. I'll write a `print_order` function and see if I can get rid of all cmp calls...",
    "created_at": "2014-05-25T18:12:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16160#issuecomment-211036",
    "user": "vbraun"
}
```

Yes, thats what I'm thinking as well. I'll write a `print_order` function and see if I can get rid of all cmp calls...



---

archive/issue_comments_211037.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-05-27T14:35:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16160#issuecomment-211037",
    "user": "vdelecroix"
}
```

New commits:



---

archive/issue_comments_211038.json:
```json
{
    "body": "Trying to push this ticket a bit. I also found this `cmp` call:\n\n```\n File \"matrix_integer_dense.pyx\", line 604, in sage.matrix.matrix_integer_dense.Matrix_integer_dense.__richcmp__ (build/cythonized/sage/matrix/matrix_integer_dense.c:9503)\n  File \"element.pyx\", line 873, in sage.structure.element.Element._richcmp (build/cythonized/sage/structure/element.c:8891)\n  File \"element.pyx\", line 855, in sage.structure.element.Element._richcmp_ (build/cythonized/sage/structure/element.c:8615)\n  File \"element.pyx\", line 902, in sage.structure.element.Element._richcmp (build/cythonized/sage/structure/element.c:9316)\n  File \"element.pyx\", line 949, in sage.structure.element.Element._richcmp_c_impl (build/cythonized/sage/structure/element.c:9645)\n  File \"matrix_dense.pyx\", line 126, in sage.matrix.matrix_dense.Matrix_dense._cmp_c_impl (build/cythonized/sage/matrix/matrix_dense.c:3092)\n  File \"expression.pyx\", line 3066, in sage.symbolic.expression.Expression.__cmp__ (build/cythonized/sage/symbolic/expression.cpp:16865)\n```\n\nDo I understand it right that this should call `math_sorted` instead of `cmp`?\n----\nNew commits:",
    "created_at": "2014-09-05T16:40:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16160#issuecomment-211038",
    "user": "rws"
}
```

Trying to push this ticket a bit. I also found this `cmp` call:

```
 File "matrix_integer_dense.pyx", line 604, in sage.matrix.matrix_integer_dense.Matrix_integer_dense.__richcmp__ (build/cythonized/sage/matrix/matrix_integer_dense.c:9503)
  File "element.pyx", line 873, in sage.structure.element.Element._richcmp (build/cythonized/sage/structure/element.c:8891)
  File "element.pyx", line 855, in sage.structure.element.Element._richcmp_ (build/cythonized/sage/structure/element.c:8615)
  File "element.pyx", line 902, in sage.structure.element.Element._richcmp (build/cythonized/sage/structure/element.c:9316)
  File "element.pyx", line 949, in sage.structure.element.Element._richcmp_c_impl (build/cythonized/sage/structure/element.c:9645)
  File "matrix_dense.pyx", line 126, in sage.matrix.matrix_dense.Matrix_dense._cmp_c_impl (build/cythonized/sage/matrix/matrix_dense.c:3092)
  File "expression.pyx", line 3066, in sage.symbolic.expression.Expression.__cmp__ (build/cythonized/sage/symbolic/expression.cpp:16865)
```

Do I understand it right that this should call `math_sorted` instead of `cmp`?
----
New commits:



---

archive/issue_comments_211039.json:
```json
{
    "body": "The problem is IMHO what to do with Python 3. Sure we can play the two different comparisons (cmp vs. rich) in Python 2 against each other, but in Py3 there will be only one comparison. So either\n* Comparison is always symbolic, and sorting will have to call `__bool__` on the symbolic inequalities. We then need to make that a total order instead of returning `False` all the time. Slow.\n* Comparison is never symbolic, and you need to call `x.symbolic_less(y)`. Could be beautified by the preparser. The actual comparison returns the internal term order. Fast.\nThought? Maybe that topic is more fodder for sage-devel...",
    "created_at": "2014-09-05T20:02:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16160#issuecomment-211039",
    "user": "vbraun"
}
```

The problem is IMHO what to do with Python 3. Sure we can play the two different comparisons (cmp vs. rich) in Python 2 against each other, but in Py3 there will be only one comparison. So either
* Comparison is always symbolic, and sorting will have to call `__bool__` on the symbolic inequalities. We then need to make that a total order instead of returning `False` all the time. Slow.
* Comparison is never symbolic, and you need to call `x.symbolic_less(y)`. Could be beautified by the preparser. The actual comparison returns the internal term order. Fast.
Thought? Maybe that topic is more fodder for sage-devel...



---

archive/issue_comments_211040.json:
```json
{
    "body": "Yes, it's a bit over my head.",
    "created_at": "2014-09-05T20:18:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16160#issuecomment-211040",
    "user": "rws"
}
```

Yes, it's a bit over my head.



---

archive/issue_comments_211041.json:
```json
{
    "body": "Was there ever any consensus on sage-devel on this?  I'm leaning toward the first option, but not strongly.",
    "created_at": "2015-02-03T04:10:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16160#issuecomment-211041",
    "user": "kcrisman"
}
```

Was there ever any consensus on sage-devel on this?  I'm leaning toward the first option, but not strongly.



---

archive/issue_comments_211042.json:
```json
{
    "body": "Replying to [comment:12 kcrisman]:\n> Was there ever any consensus on sage-devel on this?  I'm leaning toward the first option, but not strongly.\nYou probably mean https://groups.google.com/forum/?hl=en#!searchin/sage-devel/cmp/sage-devel/092yBmHfXQo/4qfS_JHLJdwJ and #16537, #17175. The newsgroup thread is mainly about equality/hashing and a bit of richcmp, not the two choices above. I am just starting to read about this.",
    "created_at": "2015-02-17T16:45:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16160#issuecomment-211042",
    "user": "rws"
}
```

Replying to [comment:12 kcrisman]:
> Was there ever any consensus on sage-devel on this?  I'm leaning toward the first option, but not strongly.
You probably mean https://groups.google.com/forum/?hl=en#!searchin/sage-devel/cmp/sage-devel/092yBmHfXQo/4qfS_JHLJdwJ and #16537, #17175. The newsgroup thread is mainly about equality/hashing and a bit of richcmp, not the two choices above. I am just starting to read about this.



---

archive/issue_comments_211043.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2015-02-17T17:24:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16160#issuecomment-211043",
    "user": "rws"
}
```

Changing priority from major to critical.



---

archive/issue_comments_211044.json:
```json
{
    "body": "When #19040 is done `__cmp__` could simply delegate to `__nonzero__`.",
    "created_at": "2015-10-23T06:18:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16160#issuecomment-211044",
    "user": "rws"
}
```

When #19040 is done `__cmp__` could simply delegate to `__nonzero__`.



---

archive/issue_comments_211045.json:
```json
{
    "body": "The newest verson of #19040 is in the `u/rws/19312-1` branch of #19312\n\nSo, the way to resolve this IMO would be to\n1. merge #19312\n2. merge #19040 using the `u/rws/19312-1` branch of #19312\n3. using `__nonzero__` to implement `__cmp__`",
    "created_at": "2015-10-24T09:26:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16160#issuecomment-211045",
    "user": "rws"
}
```

The newest verson of #19040 is in the `u/rws/19312-1` branch of #19312

So, the way to resolve this IMO would be to
1. merge #19312
2. merge #19040 using the `u/rws/19312-1` branch of #19312
3. using `__nonzero__` to implement `__cmp__`



---

archive/issue_comments_211046.json:
```json
{
    "body": "There is also a more minimal solution (part of #19040): scan the expression, if it contains variables use print order, if not use math order.",
    "created_at": "2016-03-02T07:34:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16160#issuecomment-211046",
    "user": "rws"
}
```

There is also a more minimal solution (part of #19040): scan the expression, if it contains variables use print order, if not use math order.



---

archive/issue_comments_211047.json:
```json
{
    "body": "With this we introduce a mixed sort key for symbolics which is numerically correct and symbolically fast. This is part of the work on #19040 and adds to/benefits from Volker's abstraction of orders of comparison.\n----\nNew commits:",
    "created_at": "2016-03-06T16:32:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16160#issuecomment-211047",
    "user": "rws"
}
```

With this we introduce a mixed sort key for symbolics which is numerically correct and symbolically fast. This is part of the work on #19040 and adds to/benefits from Volker's abstraction of orders of comparison.
----
New commits:



---

archive/issue_comments_211048.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-03-06T16:32:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16160#issuecomment-211048",
    "user": "rws"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_211049.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-07T08:17:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16160#issuecomment-211049",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_211050.json:
```json
{
    "body": "The results for the `RealSet` examples would be at the moment:\n\n```\nsage: RealSet((0, pi),[pi, pi],(pi,4))\n[pi, 0) + (pi, 4)\nsage: RealSet((0, pi),[0, pi],(pi,4))\n[pi, 0] + (pi, 0) + (pi, 4)\nsage: RealSet((0, pi),[0, 3.5],(pi,4))\n(pi, 4)\n```\n",
    "created_at": "2016-03-10T09:30:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16160#issuecomment-211050",
    "user": "rws"
}
```

The results for the `RealSet` examples would be at the moment:

```
sage: RealSet((0, pi),[pi, pi],(pi,4))
[pi, 0) + (pi, 4)
sage: RealSet((0, pi),[0, pi],(pi,4))
[pi, 0] + (pi, 0) + (pi, 4)
sage: RealSet((0, pi),[0, 3.5],(pi,4))
(pi, 4)
```




---

archive/issue_comments_211051.json:
```json
{
    "body": "So there is still\n\n```\nsage: cmp(pi,0)\n1\nsage: cmp(pi,SR(0))\n-1\nsage: cmp(0,pi)\n-1\nsage: cmp(SR(0),pi)\n-1\n```\n",
    "created_at": "2016-03-10T09:37:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16160#issuecomment-211051",
    "user": "rws"
}
```

So there is still

```
sage: cmp(pi,0)
1
sage: cmp(pi,SR(0))
-1
sage: cmp(0,pi)
-1
sage: cmp(SR(0),pi)
-1
```




---

archive/issue_comments_211052.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-03-10T09:37:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16160#issuecomment-211052",
    "user": "rws"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_211053.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-10T13:56:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16160#issuecomment-211053",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_211054.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-10T14:05:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16160#issuecomment-211054",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_211055.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-03-10T14:06:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16160#issuecomment-211055",
    "user": "rws"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_211056.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-11T07:55:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16160#issuecomment-211056",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_211057.json:
```json
{
    "body": "Consider the commit by Volker Braun (the first) reviewed by me. Please review everything else.",
    "created_at": "2016-03-11T07:58:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16160#issuecomment-211057",
    "user": "rws"
}
```

Consider the commit by Volker Braun (the first) reviewed by me. Please review everything else.



---

archive/issue_comments_211058.json:
```json
{
    "body": "hmm, patchbots are still not happy...",
    "created_at": "2016-03-11T10:41:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16160#issuecomment-211058",
    "user": "dimpase"
}
```

hmm, patchbots are still not happy...



---

archive/issue_comments_211059.json:
```json
{
    "body": "That was a blind merge of develop, sigh.",
    "created_at": "2016-03-11T13:53:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16160#issuecomment-211059",
    "user": "rws"
}
```

That was a blind merge of develop, sigh.



---

archive/issue_comments_211060.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-11T15:35:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16160#issuecomment-211060",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_211061.json:
```json
{
    "body": "It is interesting to see from the remaining fail in `random_test` that print order itself is a buggy concept: it either makes incorrect comparisons (`e>SR(0)` False) or fail transitivity if this is fixed in mixed order (`(x>e,e>SR(0),x>SR(0)) -> (True,True,False)`). So, mixed order in the present form would be no longer transitive.",
    "created_at": "2016-03-14T09:09:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16160#issuecomment-211061",
    "user": "rws"
}
```

It is interesting to see from the remaining fail in `random_test` that print order itself is a buggy concept: it either makes incorrect comparisons (`e>SR(0)` False) or fail transitivity if this is fixed in mixed order (`(x>e,e>SR(0),x>SR(0)) -> (True,True,False)`). So, mixed order in the present form would be no longer transitive.



---

archive/issue_comments_211062.json:
```json
{
    "body": "Effectively the only way to refine comparison then is by introducing a `None` result which would exclude the above case from being flagged. Opinions would be very welcome.",
    "created_at": "2016-03-14T09:21:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16160#issuecomment-211062",
    "user": "rws"
}
```

Effectively the only way to refine comparison then is by introducing a `None` result which would exclude the above case from being flagged. Opinions would be very welcome.



---

archive/issue_comments_211063.json:
```json
{
    "body": "perhaps someone should have a look at interfaces/mathematica.py where one has `__cmp__` for Mathematica objects, returning -1 if it falls through. Another bug? (cf. #18888)",
    "created_at": "2016-03-14T09:59:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16160#issuecomment-211063",
    "user": "dimpase"
}
```

perhaps someone should have a look at interfaces/mathematica.py where one has `__cmp__` for Mathematica objects, returning -1 if it falls through. Another bug? (cf. #18888)



---

archive/issue_comments_211064.json:
```json
{
    "body": "Replying to [comment:39 dimpase]:\n> perhaps someone should have a look at interfaces/mathematica.py where one has `__cmp__` for Mathematica objects, returning -1 if it falls through. Another bug? (cf. #18888)\nHas nothing to do with this ticket.",
    "created_at": "2016-03-14T13:37:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16160#issuecomment-211064",
    "user": "rws"
}
```

Replying to [comment:39 dimpase]:
> perhaps someone should have a look at interfaces/mathematica.py where one has `__cmp__` for Mathematica objects, returning -1 if it falls through. Another bug? (cf. #18888)
Has nothing to do with this ticket.



---

archive/issue_comments_211065.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-18T08:05:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16160#issuecomment-211065",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_211066.json:
```json
{
    "body": "This restores transitivity by moving all expressions with variables to the right of all the numbers in a sorted list: `[1, sqrt(2), e, pi, sin(1/x), sqrt(x), x]`",
    "created_at": "2016-03-18T08:09:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16160#issuecomment-211066",
    "user": "rws"
}
```

This restores transitivity by moving all expressions with variables to the right of all the numbers in a sorted list: `[1, sqrt(2), e, pi, sin(1/x), sqrt(x), x]`



---

archive/issue_comments_211067.json:
```json
{
    "body": "Isn't it dangerous to compare constants by float, this will go wrong because of rounding  when you have equal or near equal numbers.",
    "created_at": "2016-03-23T19:13:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16160#issuecomment-211067",
    "user": "vbraun"
}
```

Isn't it dangerous to compare constants by float, this will go wrong because of rounding  when you have equal or near equal numbers.



---

archive/issue_comments_211068.json:
```json
{
    "body": "How about extending constants with an `evalf` member so that in comparisons the precision can be successively increased. Reaching the prec limit before a decision will return 0, ie equal.\n\nIsn't this quite hypothetical, compared to the concretely buggy behaviour now?",
    "created_at": "2016-03-23T22:00:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16160#issuecomment-211068",
    "user": "rws"
}
```

How about extending constants with an `evalf` member so that in comparisons the precision can be successively increased. Reaching the prec limit before a decision will return 0, ie equal.

Isn't this quite hypothetical, compared to the concretely buggy behaviour now?



---

archive/issue_comments_211069.json:
```json
{
    "body": "Its perhaps not that hypothetical, the old joke (aka Heegner number)\n\n```\n$ python\n>>> from math import exp, pi, sqrt\n>>> exp(pi*sqrt(163)) == 262537412640768256\nTrue\n```\n\ncomes to mind. But I agree that this could be tackled on a future ticket.",
    "created_at": "2016-03-24T08:40:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16160#issuecomment-211069",
    "user": "vbraun"
}
```

Its perhaps not that hypothetical, the old joke (aka Heegner number)

```
$ python
>>> from math import exp, pi, sqrt
>>> exp(pi*sqrt(163)) == 262537412640768256
True
```

comes to mind. But I agree that this could be tackled on a future ticket.



---

archive/issue_comments_211070.json:
```json
{
    "body": "I don't understand what you are trying to do here, can someone please explain?\n\n(In my understanding, calling `cmp` means you are asking for a *total* order on the elements of the parent where the comparison ends up taking place. As most parents don't admit such an order that is compatible with their structure, it is a bug to call `cmp` and expect a mathematically meaningful answer. In contrast, it is perfectly okay for `cmp` to implement any arbitrary total order, provided that rich comparisons are implemented too. And it is acceptable, though not ideal due to the issues with Python3, to call `cmp` when you need to sort elements in an arbitrary way.)",
    "created_at": "2016-03-24T15:24:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16160#issuecomment-211070",
    "user": "mmezzarobba"
}
```

I don't understand what you are trying to do here, can someone please explain?

(In my understanding, calling `cmp` means you are asking for a *total* order on the elements of the parent where the comparison ends up taking place. As most parents don't admit such an order that is compatible with their structure, it is a bug to call `cmp` and expect a mathematically meaningful answer. In contrast, it is perfectly okay for `cmp` to implement any arbitrary total order, provided that rich comparisons are implemented too. And it is acceptable, though not ideal due to the issues with Python3, to call `cmp` when you need to sort elements in an arbitrary way.)



---

archive/issue_comments_211071.json:
```json
{
    "body": "At the moment there is one total order (print, mathematically wrong both in expressions with and without variables). Total math order OTOH is slow because of proving and undecidable. It is possible to have two total orders side-by-side where one half (within the set of expressions without variables) is fast, correct, and meaningful; and print order (within and with the set of expressions with variables) is fast as usual.\n\nIt is needed because `cmp` is used in Sage to sort expressions in a meaningful way, contrary to what you state.",
    "created_at": "2016-03-24T15:51:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16160#issuecomment-211071",
    "user": "rws"
}
```

At the moment there is one total order (print, mathematically wrong both in expressions with and without variables). Total math order OTOH is slow because of proving and undecidable. It is possible to have two total orders side-by-side where one half (within the set of expressions without variables) is fast, correct, and meaningful; and print order (within and with the set of expressions with variables) is fast as usual.

It is needed because `cmp` is used in Sage to sort expressions in a meaningful way, contrary to what you state.



---

archive/issue_comments_211072.json:
```json
{
    "body": "Replying to [comment:47 rws]:\n> It is needed because `cmp` is used in Sage to sort expressions in a meaningful way, contrary to what you state.\n\nI'm not saying that it is not used that way, I am saying that, as far as I understand, when it is used that way, the bug is there.",
    "created_at": "2016-03-24T15:59:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16160#issuecomment-211072",
    "user": "mmezzarobba"
}
```

Replying to [comment:47 rws]:
> It is needed because `cmp` is used in Sage to sort expressions in a meaningful way, contrary to what you state.

I'm not saying that it is not used that way, I am saying that, as far as I understand, when it is used that way, the bug is there.



---

archive/issue_comments_211073.json:
```json
{
    "body": "Replying to [comment:47 rws]:\n> It is possible to have two total orders side-by-side where one half (within the set of expressions without variables) is fast, correct, and meaningful\n\nIt will never be *correct* in the sense that you can rely on it in mathematical algorithms, since the zero test for constant symbolic expressions is undecidable. At best it will be a nice and natural print order. Which is not a bad thing, but I don't understand if that's the goal of this ticket (and, if not, what the goal is).",
    "created_at": "2016-03-24T16:03:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16160#issuecomment-211073",
    "user": "mmezzarobba"
}
```

Replying to [comment:47 rws]:
> It is possible to have two total orders side-by-side where one half (within the set of expressions without variables) is fast, correct, and meaningful

It will never be *correct* in the sense that you can rely on it in mathematical algorithms, since the zero test for constant symbolic expressions is undecidable. At best it will be a nice and natural print order. Which is not a bad thing, but I don't understand if that's the goal of this ticket (and, if not, what the goal is).



---

archive/issue_comments_211074.json:
```json
{
    "body": "Look at the ticket description. The goal is to fix those errors. If that means to remove the usage of `cmp` in those parts of Sage, then please say so. I'm not a Python guy and am not in the know what `cmp` is supposed to do. I want to fix those pesky errors that block the new piecewise functions for years now.",
    "created_at": "2016-03-24T16:18:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16160#issuecomment-211074",
    "user": "rws"
}
```

Look at the ticket description. The goal is to fix those errors. If that means to remove the usage of `cmp` in those parts of Sage, then please say so. I'm not a Python guy and am not in the know what `cmp` is supposed to do. I want to fix those pesky errors that block the new piecewise functions for years now.



---

archive/issue_comments_211075.json:
```json
{
    "body": "Replying to [comment:50 rws]:\n> Look at the ticket description. The goal is to fix those errors. If that means to remove the usage of `cmp` in those parts of Sage, then please say so.\n\nI don't know. I tried to explain what I *believe* is the convention used in sage (or perhaps the most reasonable of several incompatible conventions currently in use), but I'm genuinely interested in knowing if other people agree.",
    "created_at": "2016-03-24T16:22:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16160#issuecomment-211075",
    "user": "mmezzarobba"
}
```

Replying to [comment:50 rws]:
> Look at the ticket description. The goal is to fix those errors. If that means to remove the usage of `cmp` in those parts of Sage, then please say so.

I don't know. I tried to explain what I *believe* is the convention used in sage (or perhaps the most reasonable of several incompatible conventions currently in use), but I'm genuinely interested in knowing if other people agree.



---

archive/issue_comments_211076.json:
```json
{
    "body": "Better than what we currently have...",
    "created_at": "2016-04-15T22:31:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16160#issuecomment-211076",
    "user": "vbraun"
}
```

Better than what we currently have...



---

archive/issue_comments_211077.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-04-15T22:31:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16160#issuecomment-211077",
    "user": "vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_211078.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-04-16T15:35:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16160",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16160#issuecomment-211078",
    "user": "vbraun"
}
```

Resolution: fixed
