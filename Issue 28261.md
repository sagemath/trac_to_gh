# Issue 28261: Memory leak in BasisExchangeMatroid.components

archive/issues_028261.json:
```json
{
    "body": "CC:  rudi @jdemeyer\n\nAs reported in [this ask question](https://ask.sagemath.org/question/47839), there is a memory leak in `BasisExchangeMatroid.components`, see:\n\n\n```\nsage: G = [g for g in graphs.nauty_geng(\"12 16:16 -Ct\")]\nsage: for _ in range(20):\n....:     for g in G:\n....:         A = g.incidence_matrix()\n....:         M = Matroid(A, ring = GF(2))\n....:         if M.is_connected():\n....:             pass\n....:     print(get_memory_usage())\n....:     \n8539.23046875\n8543.7421875\n8547.73828125\n8551.734375\n8555.73046875\n8559.59765625\n8563.59375\n8566.9453125\n8570.94140625\n8574.9375\n8578.2890625\n8582.28515625\n8586.15234375\n8589.6328125\n8593.62890625\n8597.49609375\n8600.9765625\n8604.84375\n8608.83984375\n8612.3203125\n```\n\n\nSiegfried is missing.\n\nIssue created by migration from https://trac.sagemath.org/ticket/28498\n\n",
    "created_at": "2019-09-15T10:43:14Z",
    "labels": [
        "component: memleak",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.0",
    "title": "Memory leak in BasisExchangeMatroid.components",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28261",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```
CC:  rudi @jdemeyer

As reported in [this ask question](https://ask.sagemath.org/question/47839), there is a memory leak in `BasisExchangeMatroid.components`, see:


```
sage: G = [g for g in graphs.nauty_geng("12 16:16 -Ct")]
sage: for _ in range(20):
....:     for g in G:
....:         A = g.incidence_matrix()
....:         M = Matroid(A, ring = GF(2))
....:         if M.is_connected():
....:             pass
....:     print(get_memory_usage())
....:     
8539.23046875
8543.7421875
8547.73828125
8551.734375
8555.73046875
8559.59765625
8563.59375
8566.9453125
8570.94140625
8574.9375
8578.2890625
8582.28515625
8586.15234375
8589.6328125
8593.62890625
8597.49609375
8600.9765625
8604.84375
8608.83984375
8612.3203125
```


Siegfried is missing.

Issue created by migration from https://trac.sagemath.org/ticket/28498





---

archive/issue_comments_398708.json:
```json
{
    "body": "After the fix:\n\n\n```\nsage: G = [g for g in graphs.nauty_geng(\"12 16:16 -Ct\")]\nsage: for _ in range(20):\n....:     for g in G:\n....:         A = g.incidence_matrix()\n....:         M = Matroid(A, ring = GF(2))\n....:         if M.is_connected():\n....:             pass\n....:     print(get_memory_usage())\n....:     \n8462.484375\n8462.484375\n8462.484375\n8462.484375\n8462.484375\n8462.484375\n8462.484375\n8462.484375\n8462.484375\n8462.484375\n8462.484375\n8462.484375\n8462.484375\n8462.484375\n8462.484375\n8462.484375\n8462.484375\n8462.484375\n8462.484375\n8462.484375\n```\n\n\nI am not sure whether this should be doctested.\n----\nNew commits:",
    "created_at": "2019-09-15T11:06:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28261#issuecomment-398708",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

After the fix:


```
sage: G = [g for g in graphs.nauty_geng("12 16:16 -Ct")]
sage: for _ in range(20):
....:     for g in G:
....:         A = g.incidence_matrix()
....:         M = Matroid(A, ring = GF(2))
....:         if M.is_connected():
....:             pass
....:     print(get_memory_usage())
....:     
8462.484375
8462.484375
8462.484375
8462.484375
8462.484375
8462.484375
8462.484375
8462.484375
8462.484375
8462.484375
8462.484375
8462.484375
8462.484375
8462.484375
8462.484375
8462.484375
8462.484375
8462.484375
8462.484375
8462.484375
```


I am not sure whether this should be doctested.
----
New commits:



---

archive/issue_comments_398709.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-09-15T12:34:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28261#issuecomment-398709",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_398710.json:
```json
{
    "body": "Nice catch! Such memory leaks should be doctested for each code snippet (ie running the same code 100 times should not increase memory usage). I am not sure it makes sense at the level of this single function.",
    "created_at": "2019-09-15T14:17:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28261#issuecomment-398710",
    "user": "https://github.com/videlec"
}
```

Nice catch! Such memory leaks should be doctested for each code snippet (ie running the same code 100 times should not increase memory usage). I am not sure it makes sense at the level of this single function.



---

archive/issue_comments_398711.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-09-15T14:19:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28261#issuecomment-398711",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_398712.json:
```json
{
    "body": "Sorry for making this mistake in the first place, and thanks for fixing!",
    "created_at": "2019-09-15T20:49:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28261#issuecomment-398712",
    "user": "https://trac.sagemath.org/admin/accounts/users/Rudi"
}
```

Sorry for making this mistake in the first place, and thanks for fixing!



---

archive/issue_comments_398713.json:
```json
{
    "body": "Changing keywords from \"\" to \"memleak\".",
    "created_at": "2019-09-16T03:15:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28261#issuecomment-398713",
    "user": "https://github.com/slel"
}
```

Changing keywords from "" to "memleak".



---

archive/issue_comments_398714.json:
```json
{
    "body": "moving milestone to 9.0 (after release of 8.9)",
    "created_at": "2019-09-30T08:12:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28261#issuecomment-398714",
    "user": "https://github.com/fchapoton"
}
```

moving milestone to 9.0 (after release of 8.9)



---

archive/issue_comments_398715.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-10-05T07:57:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28261#issuecomment-398715",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_026175.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-10-05T07:57:54Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28261",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28261#event-26175"
}
```
