# Issue 28261: Memory leak in BasisExchangeMatroid.components

Issue created by migration from https://trac.sagemath.org/ticket/28498

Original creator: tmonteil

Original creation time: 2019-09-15 10:43:14

CC:  rudi jdemeyer

As reported in [this ask question](https://ask.sagemath.org/question/47839), there is a memory leak in `BasisExchangeMatroid.components`, see:


```
sage: G = [g for g in graphs.nauty_geng("12 16:16 -Ct")]
sage: for _ in range(20):
....:     for g in G:
....:         A = g.incidence_matrix()
....:         M = Matroid(A, ring = GF(2))
....:         if M.is_connected():
....:             pass
....:     print(get_memory_usage())
....:     
8539.23046875
8543.7421875
8547.73828125
8551.734375
8555.73046875
8559.59765625
8563.59375
8566.9453125
8570.94140625
8574.9375
8578.2890625
8582.28515625
8586.15234375
8589.6328125
8593.62890625
8597.49609375
8600.9765625
8604.84375
8608.83984375
8612.3203125
```


Siegfried is missing.


---

Comment by tmonteil created at 2019-09-15 11:06:08

After the fix:


```
sage: G = [g for g in graphs.nauty_geng("12 16:16 -Ct")]
sage: for _ in range(20):
....:     for g in G:
....:         A = g.incidence_matrix()
....:         M = Matroid(A, ring = GF(2))
....:         if M.is_connected():
....:             pass
....:     print(get_memory_usage())
....:     
8462.484375
8462.484375
8462.484375
8462.484375
8462.484375
8462.484375
8462.484375
8462.484375
8462.484375
8462.484375
8462.484375
8462.484375
8462.484375
8462.484375
8462.484375
8462.484375
8462.484375
8462.484375
8462.484375
8462.484375
```


I am not sure whether this should be doctested.
----
New commits:


---

Comment by tmonteil created at 2019-09-15 12:34:16

Changing status from new to needs_review.


---

Comment by vdelecroix created at 2019-09-15 14:17:46

Nice catch! Such memory leaks should be doctested for each code snippet (ie running the same code 100 times should not increase memory usage). I am not sure it makes sense at the level of this single function.


---

Comment by vdelecroix created at 2019-09-15 14:19:59

Changing status from needs_review to positive_review.


---

Comment by Rudi created at 2019-09-15 20:49:20

Sorry for making this mistake in the first place, and thanks for fixing!


---

Comment by slelievre created at 2019-09-16 03:15:33

Changing keywords from "" to "memleak".


---

Comment by chapoton created at 2019-09-30 08:12:27

moving milestone to 9.0 (after release of 8.9)


---

Comment by vbraun created at 2019-10-05 07:57:54

Resolution: fixed
