# Issue 13261: Fix bad handling of base ring in lazy power series

Issue created by migration from https://trac.sagemath.org/ticket/13433

Original creator: hivert

Original creation time: 2012-09-06 09:33:22

Assignee: hivert

CC:  sage-combinat simonking chapoton darij

Keywords: LazyPowerSeries

Currently

```
sage: R = LazyPowerSeriesRing(QQ)
sage: type(R.gen().coefficient(0))
<type 'sage.rings.rational.Rational'>
sage: type(R.gen().coefficient(1))
<type 'int'>
sage: type(R.gen().coefficient(2))
<type 'int'>
```

it should be always `Rational`


---

Comment by hivert created at 2012-09-06 10:50:05

Changing keywords from "LazyPowerSeries" to "LazyPowerSeries, categories".


---

Comment by hivert created at 2012-09-06 10:50:05

The patch is not yet ready for review !


---

Comment by hivert created at 2013-04-24 15:37:42

Changing status from new to needs_review.


---

Comment by hivert created at 2013-04-25 09:40:23

Changing keywords from "LazyPowerSeries, categories" to "LazyPowerSeries, categories, Species".


---

Comment by nthiery created at 2013-05-08 15:56:04

Salut Florent,

There are some failing tests:

```
sage -t sage/combinat/tutorial.py  # 5 doctests failed
sage -t sage/tests/french_book/polynomes.py  # 7 doctests failed
```


Could you fix those or move the patch down the queue?

Thanks,
                            Nicolas


---

Comment by hivert created at 2013-06-17 08:27:14

Fixed !

Florent


---

Comment by hivert created at 2013-06-17 15:36:04

Fixed a multiline doctest to silence the patchbot. Ready for review.

Florent


---

Comment by hivert created at 2013-06-17 15:36:04

Changing keywords from "LazyPowerSeries, categories, Species" to "LazyPowerSeries, categories, Species, days49".


---

Comment by darij created at 2013-06-17 22:28:56

Any chance to get docstrings on _sum_generator_gen and/or sum_generator? Andrew and me are wondering what precisely these functions do in http://trac.sagemath.org/sage_trac/ticket/14542 . Thank you!


---

Comment by nthiery created at 2013-06-18 08:43:23

I have just been through the path, and it looks good to go.

Just one thing: using the new syntax for example continuations. And since the whole file is touched anyway, we might as well do this change everywhere.


---

Comment by darij created at 2013-07-16 19:11:45

There is a doctest failing, see http://patchbot.sagemath.org/log/13433/Fedora/18/x86_64/3.9.5-201.fc18.x86_64/desktop/2013-07-13%2021:47:59%20+0100?short . One way to fix it is to replace the `_div_` method of the `CycleIndexSeries` class by a `__div__` method, since I don't think that class belongs to any category which has a division method. On the other hand, this might not be what you want.

Ceterum censeo, `_sum_generator_gen` and `sum_generator` still need to be documented...


---

Attachment


---

Comment by mhansen created at 2013-07-21 21:49:59

I've attached a review patch which takes care of these issues if someone would take a look at it.


---

Attachment

I've attached a new patch which will apply on top of #14685.  I've pushed these to the queue.


---

Comment by mhansen created at 2013-07-21 21:54:46

Apply trac_13433-lazy_power_serie_gen_fix-fh.patch trac_13433-review-mh.patch


---

Attachment

Alternative version of the BASE patch, which applies on my system. The review patch needs no changes, hence is not included.


---

Comment by darij created at 2013-07-29 16:21:07

For patchbot:

apply 

Apply trac_13433-base_patch-darijs_mod.patch​ trac_13433-review-mh.patch


---

Attachment


---

Comment by darij created at 2013-07-29 17:04:08

Mike, thank you for the docstring! I've understood it now. I've just attached my version of your review patch, which adds another example hopefully clarifying how to use sum_generator *in practice*. The example is a bit artificial because right now lazy power series can neither be divided nor subtracted(!!). I've also fixed another typo.

I must say I'm a bit surprised to see division (`__div__`) defined in `generating_series.py` but not in `series.py`. I am also surprised by the lack of `_neg_` (or `__neg__`?) in both files, although one can use (-1) * u of course. Finally, subtraction of lazy power series does not seem to work (it ends in `RuntimeError: maximum recursion depth exceeded in __instancecheck__`).

For patchbot:

apply

Apply trac_13433-base_patch-darijs_mod.patch​ trac_13433-review-mh-darijs_mod.patch


---

Comment by darij created at 2013-07-29 20:10:26

This patch breaks subtraction of lazy power series. I'm going to investigaate.


---

Comment by darij created at 2013-07-29 20:32:07

OK, I have no idea what is broken and how to fix it, but it's clear that something is going wrong. All I know is that the bug is in the base file (trac_13433-base_patch-darijs_mod.patch​, or previously  trac_13433-lazy_power_serie_gen_fix-fh.patch​).


---

Comment by darij created at 2013-07-29 20:32:37

Changing status from needs_review to needs_work.


---

Comment by mhansen created at 2014-01-14 17:16:45

A fix is in #15673


---

Comment by mantepse created at 2022-09-21 13:47:46

Changing status from needs_work to needs_review.


---

Comment by mantepse created at 2022-09-21 13:47:46

This is no longer relevant, since #32367.


---

Comment by tscrim created at 2022-10-22 07:26:15

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2022-11-14 19:36:43

Resolution: invalid
