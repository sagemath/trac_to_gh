# Issue 17829: Cleanup of ModulesWithBasis and friends

archive/issues_017829.json:
```json
{
    "body": "Assignee: @tscrim\n\nCC:  @nthiery @darijgr @anneschilling @zabrocki @jhpalmieri\n\nCurrently `ModulesWithBasis` requires its implementations to behave like `CombinatorialFreeModule`, along with having an indexing set for the basis which is comparable. The aim of this ticket is to move various methods from `CombintorialFreeModule` and it's element class to `ModulesWithBasis`. This ticket will also give better generic functionality, such as a default implementation of `support`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/18066\n\n",
    "created_at": "2015-03-27T06:32:19Z",
    "labels": [
        "component: categories"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.10",
    "title": "Cleanup of ModulesWithBasis and friends",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17829",
    "user": "https://github.com/tscrim"
}
```
Assignee: @tscrim

CC:  @nthiery @darijgr @anneschilling @zabrocki @jhpalmieri

Currently `ModulesWithBasis` requires its implementations to behave like `CombinatorialFreeModule`, along with having an indexing set for the basis which is comparable. The aim of this ticket is to move various methods from `CombintorialFreeModule` and it's element class to `ModulesWithBasis`. This ticket will also give better generic functionality, such as a default implementation of `support`.

Issue created by migration from https://trac.sagemath.org/ticket/18066





---

archive/issue_comments_238743.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-10-11T19:24:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17829#issuecomment-238743",
    "user": "https://github.com/tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_238744.json:
```json
{
    "body": "Okay, I figured this was the best starting point for trying to see if the quack of a free module echoes. For this ticket, I moved many methods up and was able to generalize them. There were only minimal changes needed to remove the ordering on `support` (only the Macdonald basis of `Sym`) and make `monomial_coefficients()` an abstract method. I added the `copy` parameter to monomial coefficients for both speed and `dict` in the usual free modules has this API. Most of the other changes are trivial changes to doctest output.\n\nThe next thing to do would be to check to see if #10672 becomes invalid because of this ticket (execpt perhaps the iteration issue). After that, then move onto either merging CFM and (sparse?) free modules #10671 or rebasing and finalizing #18310.\n----\nNew commits:",
    "created_at": "2015-10-11T19:24:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17829#issuecomment-238744",
    "user": "https://github.com/tscrim"
}
```

Okay, I figured this was the best starting point for trying to see if the quack of a free module echoes. For this ticket, I moved many methods up and was able to generalize them. There were only minimal changes needed to remove the ordering on `support` (only the Macdonald basis of `Sym`) and make `monomial_coefficients()` an abstract method. I added the `copy` parameter to monomial coefficients for both speed and `dict` in the usual free modules has this API. Most of the other changes are trivial changes to doctest output.

The next thing to do would be to check to see if #10672 becomes invalid because of this ticket (execpt perhaps the iteration issue). After that, then move onto either merging CFM and (sparse?) free modules #10671 or rebasing and finalizing #18310.
----
New commits:



---

archive/issue_comments_238745.json:
```json
{
    "body": "Also a question mostly for Nicolas, do we still need `_apply_module_morphism`? Is it just a method so that we don't have to create a full morphism object?",
    "created_at": "2015-10-11T19:30:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17829#issuecomment-238745",
    "user": "https://github.com/tscrim"
}
```

Also a question mostly for Nicolas, do we still need `_apply_module_morphism`? Is it just a method so that we don't have to create a full morphism object?



---

archive/issue_comments_238746.json:
```json
{
    "body": "+1! This is the way to go, and thanks for doing it.\n\nHowever, one thing I'm still missing is an explicit explanation of what methods one needs to implement in order to inherit from `ModulesWithBasis`. I suspect this is no longer up-to-date:\n\n```\n        # To implement a module_with_basis you need to implement either\n        #   basis() or an _indices attribute and monomial().\n```\n\n(as in, we probably need more now), right? \n\nCoercion of coefficients into the base ring needs to be carefully thought over. As of now, I am not sure if it works correctly. For instance, `term` does no coercion, but `__invert__` does `self.parent().term(one, ~mcs[one])`, although the inversion operator `~` might produce an element of a bigger ring (for example, `~(ZZ(2))` returns `1/2`).\n\nOne more thing, which is probably not your fault but just caught my eyes. The docstring of `module_morphism` says:\n\n```\n            - ``matrix``   -- a matrix of size `\\dim X \\times \\dim Y`\n              or `\\dim Y \\times \\dim X`\n```\n\nI don't see why the \"or\" is here. The doctests show that `\\dim Y \\times \\dim X` works, but does `\\dim X \\times \\dim Y` work too? And if so, *should* it? I think checking whether the matrix has the \"wrong\" dimensions, and then trying to fix them by transposing it, would be a brittle paradigm. \n\nAlso, could we have doctests proving that the `monomial_coefficients` method works correctly (including not mutating the dictionary unless explicitly required) on various instances of `ModulesWithBasis` (e.g., vector spaces)? Thank you!",
    "created_at": "2015-10-12T19:49:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17829#issuecomment-238746",
    "user": "https://github.com/darijgr"
}
```

+1! This is the way to go, and thanks for doing it.

However, one thing I'm still missing is an explicit explanation of what methods one needs to implement in order to inherit from `ModulesWithBasis`. I suspect this is no longer up-to-date:

```
        # To implement a module_with_basis you need to implement either
        #   basis() or an _indices attribute and monomial().
```

(as in, we probably need more now), right? 

Coercion of coefficients into the base ring needs to be carefully thought over. As of now, I am not sure if it works correctly. For instance, `term` does no coercion, but `__invert__` does `self.parent().term(one, ~mcs[one])`, although the inversion operator `~` might produce an element of a bigger ring (for example, `~(ZZ(2))` returns `1/2`).

One more thing, which is probably not your fault but just caught my eyes. The docstring of `module_morphism` says:

```
            - ``matrix``   -- a matrix of size `\dim X \times \dim Y`
              or `\dim Y \times \dim X`
```

I don't see why the "or" is here. The doctests show that `\dim Y \times \dim X` works, but does `\dim X \times \dim Y` work too? And if so, *should* it? I think checking whether the matrix has the "wrong" dimensions, and then trying to fix them by transposing it, would be a brittle paradigm. 

Also, could we have doctests proving that the `monomial_coefficients` method works correctly (including not mutating the dictionary unless explicitly required) on various instances of `ModulesWithBasis` (e.g., vector spaces)? Thank you!



---

archive/issue_comments_238747.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-12T22:19:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17829#issuecomment-238747",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_238748.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-12T22:34:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17829#issuecomment-238748",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_238749.json:
```json
{
    "body": "So in my latest commit I fixed doctests. Some were trivial due to `support` no longer being ordered (and hence changes to the k-schur book tests and the cc of Anne and Mike), some were more substantial:\n\n- `ChainComplexes` when passed a field said `VectorSpaces`, and so it did not consider itself as having a distinguished basis. However, if you give it a ring (like `ZZ`), then it became in `ModulesWithBasis` (=`FreeModules`), which it currently does not live from what I saw. Since there wasn't anything using this extra functionality (any attempt to use it was likely broken), I opted to downgrade the category to just `Modules`. (John, I cc'ed you to let you know.)\n\n- I added a `dense_coefficient_list` for finite dimensional modules with basis so that you could get an ordered list of coefficients including 0's. This was needed for hyperplane arrangements. I'm open to different names.\n\n- I made the linear expression code be in finite dimensional modules with basis.\n\nReplying to [comment:3 darij]:\n> However, one thing I'm still missing is an explicit explanation of what methods one needs to implement in order to inherit from `ModulesWithBasis`. I suspect this is no longer up-to-date:\n> {{{\n>         # To implement a module_with_basis you need to implement either\n>         #   basis() or an _indices attribute and monomial().\n> }}}\n> (as in, we probably need more now), right? \n\nI put that in there because that is all that should be required. However, how the code breaks and the traceback tells you everything you need to know as far as what to implement.\n\n> Coercion of coefficients into the base ring needs to be carefully thought over. As of now, I am not sure if it works correctly. For instance, `term` does no coercion, but `__invert__` does `self.parent().term(one, ~mcs[one])`, although the inversion operator `~` might produce an element of a bigger ring (for example, `~(ZZ(2))` returns `1/2`).\n\nActually my generic implementation should handle this with grace as it is `coeff * self.monomial(index)`. However, CFM currently does not do any coercion as indicated in the docstring, but that is a discussion for another ticket.\n\n> One more thing, which is probably not your fault but just caught my eyes. The docstring of `module_morphism` says:\n> {{{\n>             - ``matrix``   -- a matrix of size `\\dim X \\times \\dim Y`\n>               or `\\dim Y \\times \\dim X`\n> }}}\n> I don't see why the \"or\" is here. The doctests show that `\\dim Y \\times \\dim X` works, but does `\\dim X \\times \\dim Y` work too? And if so, *should* it? I think checking whether the matrix has the \"wrong\" dimensions, and then trying to fix them by transposing it, would be a brittle paradigm. \n\nI don't know and I don't really care as that is outside of the scope of this ticket.\n\n> Also, could we have doctests proving that the `monomial_coefficients` method works correctly (including not mutating the dictionary unless explicitly required) on various instances of `ModulesWithBasis` (e.g., vector spaces)?\n\nAdded.",
    "created_at": "2015-10-12T22:38:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17829#issuecomment-238749",
    "user": "https://github.com/tscrim"
}
```

So in my latest commit I fixed doctests. Some were trivial due to `support` no longer being ordered (and hence changes to the k-schur book tests and the cc of Anne and Mike), some were more substantial:

- `ChainComplexes` when passed a field said `VectorSpaces`, and so it did not consider itself as having a distinguished basis. However, if you give it a ring (like `ZZ`), then it became in `ModulesWithBasis` (=`FreeModules`), which it currently does not live from what I saw. Since there wasn't anything using this extra functionality (any attempt to use it was likely broken), I opted to downgrade the category to just `Modules`. (John, I cc'ed you to let you know.)

- I added a `dense_coefficient_list` for finite dimensional modules with basis so that you could get an ordered list of coefficients including 0's. This was needed for hyperplane arrangements. I'm open to different names.

- I made the linear expression code be in finite dimensional modules with basis.

Replying to [comment:3 darij]:
> However, one thing I'm still missing is an explicit explanation of what methods one needs to implement in order to inherit from `ModulesWithBasis`. I suspect this is no longer up-to-date:
> {{{
>         # To implement a module_with_basis you need to implement either
>         #   basis() or an _indices attribute and monomial().
> }}}
> (as in, we probably need more now), right? 

I put that in there because that is all that should be required. However, how the code breaks and the traceback tells you everything you need to know as far as what to implement.

> Coercion of coefficients into the base ring needs to be carefully thought over. As of now, I am not sure if it works correctly. For instance, `term` does no coercion, but `__invert__` does `self.parent().term(one, ~mcs[one])`, although the inversion operator `~` might produce an element of a bigger ring (for example, `~(ZZ(2))` returns `1/2`).

Actually my generic implementation should handle this with grace as it is `coeff * self.monomial(index)`. However, CFM currently does not do any coercion as indicated in the docstring, but that is a discussion for another ticket.

> One more thing, which is probably not your fault but just caught my eyes. The docstring of `module_morphism` says:
> {{{
>             - ``matrix``   -- a matrix of size `\dim X \times \dim Y`
>               or `\dim Y \times \dim X`
> }}}
> I don't see why the "or" is here. The doctests show that `\dim Y \times \dim X` works, but does `\dim X \times \dim Y` work too? And if so, *should* it? I think checking whether the matrix has the "wrong" dimensions, and then trying to fix them by transposing it, would be a brittle paradigm. 

I don't know and I don't really care as that is outside of the scope of this ticket.

> Also, could we have doctests proving that the `monomial_coefficients` method works correctly (including not mutating the dictionary unless explicitly required) on various instances of `ModulesWithBasis` (e.g., vector spaces)?

Added.



---

archive/issue_comments_238750.json:
```json
{
    "body": "Replying to [comment:3 darij]:\n> One more thing, which is probably not your fault but just caught my eyes. The docstring of `module_morphism` says:\n> {{{\n>             - ``matrix``   -- a matrix of size `\\dim X \\times \\dim Y`\n>               or `\\dim Y \\times \\dim X`\n> }}}\n> I don't see why the \"or\" is here. The doctests show that `\\dim Y \\times \\dim X` works, but does `\\dim X \\times \\dim Y` work too? And if so, *should* it? I think checking whether the matrix has the \"wrong\" dimensions, and then trying to fix them by transposing it, would be a brittle paradigm. \n\nWhich of the two it is depends on the value of the optional ``side`` argument. No worry, there is no attempt at \"fixing\" things by transposition.",
    "created_at": "2015-10-13T21:36:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17829#issuecomment-238750",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:3 darij]:
> One more thing, which is probably not your fault but just caught my eyes. The docstring of `module_morphism` says:
> {{{
>             - ``matrix``   -- a matrix of size `\dim X \times \dim Y`
>               or `\dim Y \times \dim X`
> }}}
> I don't see why the "or" is here. The doctests show that `\dim Y \times \dim X` works, but does `\dim X \times \dim Y` work too? And if so, *should* it? I think checking whether the matrix has the "wrong" dimensions, and then trying to fix them by transposing it, would be a brittle paradigm. 

Which of the two it is depends on the value of the optional ``side`` argument. No worry, there is no attempt at "fixing" things by transposition.



---

archive/issue_comments_238751.json:
```json
{
    "body": "Replying to [comment:2 tscrim]:\n> Also a question mostly for Nicolas, do we still need `_apply_module_morphism`? Is it just a method so that we don't have to create a full morphism object?\n\nAs far as I know, that was indeed the motivation when Mike H implemented it. I imagine it can make sense in certain cases where many different morphisms are applied. But I don't have a strong opinion either.",
    "created_at": "2015-10-13T21:38:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17829#issuecomment-238751",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:2 tscrim]:
> Also a question mostly for Nicolas, do we still need `_apply_module_morphism`? Is it just a method so that we don't have to create a full morphism object?

As far as I know, that was indeed the motivation when Mike H implemented it. I imagine it can make sense in certain cases where many different morphisms are applied. But I don't have a strong opinion either.



---

archive/issue_comments_238752.json:
```json
{
    "body": "Thanks for the progress on that btw!",
    "created_at": "2015-10-13T21:40:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17829#issuecomment-238752",
    "user": "https://github.com/nthiery"
}
```

Thanks for the progress on that btw!



---

archive/issue_comments_238753.json:
```json
{
    "body": "Replying to [comment:8 nthiery]:\n> Replying to [comment:2 tscrim]:\n> > Also a question mostly for Nicolas, do we still need `_apply_module_morphism`? Is it just a method so that we don't have to create a full morphism object?\n> \n> As far as I know, that was indeed the motivation when Mike H implemented it. I imagine it can make sense in certain cases where many different morphisms are applied. But I don't have a strong opinion either.\n\nI ended up doing something for diagram algebras where I found this to be useful (although I could have used a full morphism to work around it), so I'm happy enough to keep it around for now.",
    "created_at": "2015-10-13T21:50:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17829#issuecomment-238753",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:8 nthiery]:
> Replying to [comment:2 tscrim]:
> > Also a question mostly for Nicolas, do we still need `_apply_module_morphism`? Is it just a method so that we don't have to create a full morphism object?
> 
> As far as I know, that was indeed the motivation when Mike H implemented it. I imagine it can make sense in certain cases where many different morphisms are applied. But I don't have a strong opinion either.

I ended up doing something for diagram algebras where I found this to be useful (although I could have used a full morphism to work around it), so I'm happy enough to keep it around for now.



---

archive/issue_comments_238754.json:
```json
{
    "body": "Replying to [comment:7 nthiery]:\n> Replying to [comment:3 darij]:\n> > One more thing, which is probably not your fault but just caught my eyes. The docstring of `module_morphism` says:\n> > {{{\n> >             - ``matrix``   -- a matrix of size `\\dim X \\times \\dim Y`\n> >               or `\\dim Y \\times \\dim X`\n> > }}}\n> > I don't see why the \"or\" is here. The doctests show that `\\dim Y \\times \\dim X` works, but does `\\dim X \\times \\dim Y` work too? And if so, *should* it? I think checking whether the matrix has the \"wrong\" dimensions, and then trying to fix them by transposing it, would be a brittle paradigm. \n> \n> Which of the two it is depends on the value of the optional ``side`` argument. No worry, there is no attempt at \"fixing\" things by transposition.\n\nAh, thank you! I didn't see this, as the argument is hidden inside the `**keywords`.",
    "created_at": "2015-10-14T04:09:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17829#issuecomment-238754",
    "user": "https://github.com/darijgr"
}
```

Replying to [comment:7 nthiery]:
> Replying to [comment:3 darij]:
> > One more thing, which is probably not your fault but just caught my eyes. The docstring of `module_morphism` says:
> > {{{
> >             - ``matrix``   -- a matrix of size `\dim X \times \dim Y`
> >               or `\dim Y \times \dim X`
> > }}}
> > I don't see why the "or" is here. The doctests show that `\dim Y \times \dim X` works, but does `\dim X \times \dim Y` work too? And if so, *should* it? I think checking whether the matrix has the "wrong" dimensions, and then trying to fix them by transposing it, would be a brittle paradigm. 
> 
> Which of the two it is depends on the value of the optional ``side`` argument. No worry, there is no attempt at "fixing" things by transposition.

Ah, thank you! I didn't see this, as the argument is hidden inside the `**keywords`.



---

archive/issue_comments_238755.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-14T18:21:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17829#issuecomment-238755",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_238756.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2015-10-15T02:34:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17829#issuecomment-238756",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_238757.json:
```json
{
    "body": "It wasn't letting me post this comment:\n\nTo fix the failing doctests, I made the free modules be in the category of finite dimensional modules with basis, which I believe they should have been awhile ago. I also merged in the filtered algebras patch.",
    "created_at": "2015-10-15T14:31:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17829#issuecomment-238757",
    "user": "https://github.com/tscrim"
}
```

It wasn't letting me post this comment:

To fix the failing doctests, I made the free modules be in the category of finite dimensional modules with basis, which I believe they should have been awhile ago. I also merged in the filtered algebras patch.



---

archive/issue_comments_238758.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-22T02:29:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17829#issuecomment-238758",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_238759.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-24T17:29:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17829#issuecomment-238759",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_238760.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2015-10-24T21:38:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17829#issuecomment-238760",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_238761.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-24T23:46:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17829#issuecomment-238761",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_238762.json:
```json
{
    "body": "Great job, Travis. If you are fine with my edits and the doctests agree, this is a positive_review.\n\nI am somewhat unhappy about the fact that submodules of free modules don't play nicely with `monomial_coefficients` (if `M` is a submodule of `R^n` given as the span of some vectors, then `m.monomial_coefficients` for `m \\in M` gives me the monomial coefficients of `m` with respect to the standard basis of `R^n`, not with respect to any basis of `M`), but this is hardly a flaw of this particular ticket.",
    "created_at": "2015-10-24T23:50:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17829#issuecomment-238762",
    "user": "https://github.com/darijgr"
}
```

Great job, Travis. If you are fine with my edits and the doctests agree, this is a positive_review.

I am somewhat unhappy about the fact that submodules of free modules don't play nicely with `monomial_coefficients` (if `M` is a submodule of `R^n` given as the span of some vectors, then `m.monomial_coefficients` for `m \in M` gives me the monomial coefficients of `m` with respect to the standard basis of `R^n`, not with respect to any basis of `M`), but this is hardly a flaw of this particular ticket.



---

archive/issue_comments_238763.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-10-25T00:01:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17829#issuecomment-238763",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_238764.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-10-25T08:36:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17829#issuecomment-238764",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_238765.json:
```json
{
    "body": "How about running the tests before setting something to positive review?\n\n```\nsage -t --long src/sage/geometry/linear_expression.py\n**********************************************************************\nFile \"src/sage/geometry/linear_expression.py\", line 183, in sage.geometry.linear_expression.LinearExpression.monomial_coefficients\nFailed example:\n    sorted(linear.monomial_coefficients().items()\nException raised:\n    Traceback (most recent call last):\n      File \"/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 496, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 856, in compile_and_execute\n        compiled = compiler(example)\n      File \"/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 494, in <lambda>\n        example.source, filename, \"single\", compileflags, 1)\n      File \"<doctest sage.geometry.linear_expression.LinearExpression.monomial_coefficients[3]>\", line 1\n        sorted(linear.monomial_coefficients().items()\n                                                    ^\n    SyntaxError: unexpected EOF while parsing\n**********************************************************************\n1 item had failures:\n   1 of   5 in sage.geometry.linear_expression.LinearExpression.monomial_coefficients\n    [165 tests, 1 failure, 1.47 s]\n```\n",
    "created_at": "2015-10-25T08:36:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17829#issuecomment-238765",
    "user": "https://github.com/vbraun"
}
```

How about running the tests before setting something to positive review?

```
sage -t --long src/sage/geometry/linear_expression.py
**********************************************************************
File "src/sage/geometry/linear_expression.py", line 183, in sage.geometry.linear_expression.LinearExpression.monomial_coefficients
Failed example:
    sorted(linear.monomial_coefficients().items()
Exception raised:
    Traceback (most recent call last):
      File "/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 496, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 856, in compile_and_execute
        compiled = compiler(example)
      File "/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 494, in <lambda>
        example.source, filename, "single", compileflags, 1)
      File "<doctest sage.geometry.linear_expression.LinearExpression.monomial_coefficients[3]>", line 1
        sorted(linear.monomial_coefficients().items()
                                                    ^
    SyntaxError: unexpected EOF while parsing
**********************************************************************
1 item had failures:
   1 of   5 in sage.geometry.linear_expression.LinearExpression.monomial_coefficients
    [165 tests, 1 failure, 1.47 s]
```




---

archive/issue_comments_238766.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-25T14:27:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17829#issuecomment-238766",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_238767.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2015-10-25T14:28:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17829#issuecomment-238767",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_238768.json:
```json
{
    "body": "Thanks Travis! (I've just fired up my virtual machine a few minutes ago to deal with this...)\n\nNote to self: do test sage/geometry...",
    "created_at": "2015-10-25T14:29:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17829#issuecomment-238768",
    "user": "https://github.com/darijgr"
}
```

Thanks Travis! (I've just fired up my virtual machine a few minutes ago to deal with this...)

Note to self: do test sage/geometry...



---

archive/issue_comments_238769.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-10-26T00:18:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17829#issuecomment-238769",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_017138.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-10-26T00:18:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17829",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17829#event-17138"
}
```



---

archive/issue_comments_238770.json:
```json
{
    "body": "in `src/sage/categories/modules_with_basis.py` one still sees \n\n```\n   Once :trac:`18066` is merged\n```\n\nnamely here:\n\n```\n9bc28fd5fdb (Travis Scrimshaw  2015-03-26 23:33:19 -0700  129)         This category currently requires an implementation of an\n6cc8b8460df (Travis Scrimshaw  2015-10-04 16:20:51 -0500  130)         element method ``support``. Once :trac:`18066` is merged, an\n6cc8b8460df (Travis Scrimshaw  2015-10-04 16:20:51 -0500  131)         implementation of an ``items`` method will be required.\n```\n",
    "created_at": "2019-07-30T13:53:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17829#issuecomment-238770",
    "user": "https://github.com/dimpase"
}
```

in `src/sage/categories/modules_with_basis.py` one still sees 

```
   Once :trac:`18066` is merged
```

namely here:

```
9bc28fd5fdb (Travis Scrimshaw  2015-03-26 23:33:19 -0700  129)         This category currently requires an implementation of an
6cc8b8460df (Travis Scrimshaw  2015-10-04 16:20:51 -0500  130)         element method ``support``. Once :trac:`18066` is merged, an
6cc8b8460df (Travis Scrimshaw  2015-10-04 16:20:51 -0500  131)         implementation of an ``items`` method will be required.
```

