# Issue 31648: Allow cross compiling

archive/issues_031648.json:
```json
{
    "body": "CC:  @kiwifb @mkoeppe @dimpase\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/31885\n\n",
    "created_at": "2021-05-31T06:56:15Z",
    "labels": [
        "component: build: configure"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "Allow cross compiling",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31648",
    "user": "https://github.com/isuruf"
}
```
CC:  @kiwifb @mkoeppe @dimpase



Issue created by migration from https://trac.sagemath.org/ticket/31885





---

archive/issue_comments_451432.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-05-31T07:00:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31648",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31648#issuecomment-451432",
    "user": "https://github.com/isuruf"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_451433.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-05-31T07:11:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31648",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31648#issuecomment-451433",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_451434.json:
```json
{
    "body": "Why is trac automerging failing? Are you basing it on 9.3 or 9.4.beta0?\n\nIt otherwise looks OK but I would not know if it is complete or need more changes.",
    "created_at": "2021-05-31T07:22:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31648",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31648#issuecomment-451434",
    "user": "https://github.com/kiwifb"
}
```

Why is trac automerging failing? Are you basing it on 9.3 or 9.4.beta0?

It otherwise looks OK but I would not know if it is complete or need more changes.



---

archive/issue_comments_451435.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-05-31T07:31:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31648",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31648#issuecomment-451435",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_451436.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-05-31T07:36:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31648",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31648#issuecomment-451436",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_451437.json:
```json
{
    "body": "Replying to [comment:3 fbissey]:\n> Why is trac automerging failing? Are you basing it on 9.3 or 9.4.beta0?\n\nYes, that was it. I was basing it off of 9.3. Fixed now\n\n> It otherwise looks OK but I would not know if it is complete or need more changes.\n\nThanks. I'm cross compiling for Apple silicon. With this patch I can compile sage-the-library. Got a couple more dependencies to build before I can start sage",
    "created_at": "2021-05-31T16:14:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31648",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31648#issuecomment-451437",
    "user": "https://github.com/isuruf"
}
```

Replying to [comment:3 fbissey]:
> Why is trac automerging failing? Are you basing it on 9.3 or 9.4.beta0?

Yes, that was it. I was basing it off of 9.3. Fixed now

> It otherwise looks OK but I would not know if it is complete or need more changes.

Thanks. I'm cross compiling for Apple silicon. With this patch I can compile sage-the-library. Got a couple more dependencies to build before I can start sage



---

archive/issue_comments_451438.json:
```json
{
    "body": "What's the procedure to test this? My guess is that you're not building any of the Python dependencies of sagelib - the installation procedure wouldn't allow to install the built wheels of the wrong architecture",
    "created_at": "2021-05-31T17:13:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31648",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31648#issuecomment-451438",
    "user": "https://github.com/mkoeppe"
}
```

What's the procedure to test this? My guess is that you're not building any of the Python dependencies of sagelib - the installation procedure wouldn't allow to install the built wheels of the wrong architecture



---

archive/issue_comments_451439.json:
```json
{
    "body": "It's complicated to test this. I'm using https://github.com/benfogle/crossenv/ in conda-forge to setup an osx-x86_64 -> osx-arm64 cross compiling setup.",
    "created_at": "2021-05-31T18:09:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31648",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31648#issuecomment-451439",
    "user": "https://github.com/isuruf"
}
```

It's complicated to test this. I'm using https://github.com/benfogle/crossenv/ in conda-forge to setup an osx-x86_64 -> osx-arm64 cross compiling setup.



---

archive/issue_comments_451440.json:
```json
{
    "body": "I was able to cross compile most of sagelib dependencies including python extensions. Only holdouts were NTL, pari and maxima.",
    "created_at": "2021-05-31T18:14:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31648",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31648#issuecomment-451440",
    "user": "https://github.com/isuruf"
}
```

I was able to cross compile most of sagelib dependencies including python extensions. Only holdouts were NTL, pari and maxima.



---

archive/issue_comments_451441.json:
```json
{
    "body": "Replying to [comment:7 mkoeppe]:\n> What's the procedure to test this? My guess is that you're not building any of the Python dependencies of sagelib - the installation procedure wouldn't allow to install the built wheels of the wrong architecture\n\nI am tempted to agree to include it if\n 1) it doesn't have side effects on normal setup\n\n 2) it is not a bloat bomb\n\nThis is experimental level of support. If and when it becomes more mainstream we will need to devise formal ways of testing it.",
    "created_at": "2021-05-31T21:43:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31648",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31648#issuecomment-451441",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:7 mkoeppe]:
> What's the procedure to test this? My guess is that you're not building any of the Python dependencies of sagelib - the installation procedure wouldn't allow to install the built wheels of the wrong architecture

I am tempted to agree to include it if
 1) it doesn't have side effects on normal setup

 2) it is not a bloat bomb

This is experimental level of support. If and when it becomes more mainstream we will need to devise formal ways of testing it.



---

archive/issue_comments_451442.json:
```json
{
    "body": "> 1) it doesn't have side effects on normal setup\n\nIt doesn't. This only modifies cross compile actions of `AC_TRY_RUN`, `AC_RUN_IFELSE`, etc.",
    "created_at": "2021-05-31T22:06:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31648",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31648#issuecomment-451442",
    "user": "https://github.com/isuruf"
}
```

> 1) it doesn't have side effects on normal setup

It doesn't. This only modifies cross compile actions of `AC_TRY_RUN`, `AC_RUN_IFELSE`, etc.



---

archive/issue_comments_451443.json:
```json
{
    "body": "isn't this fixed in #30668",
    "created_at": "2021-06-01T16:26:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31648",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31648#issuecomment-451443",
    "user": "https://github.com/dimpase"
}
```

isn't this fixed in #30668



---

archive/issue_comments_451444.json:
```json
{
    "body": "these are deprecated autoconf macros we replaced in #30668",
    "created_at": "2021-06-01T16:27:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31648",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31648#issuecomment-451444",
    "user": "https://github.com/dimpase"
}
```

these are deprecated autoconf macros we replaced in #30668



---

archive/issue_comments_451445.json:
```json
{
    "body": "It's not. That ticket only touches ppl, but there are more packages that need support.",
    "created_at": "2021-06-01T16:47:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31648",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31648#issuecomment-451445",
    "user": "https://github.com/isuruf"
}
```

It's not. That ticket only touches ppl, but there are more packages that need support.



---

archive/issue_comments_451446.json:
```json
{
    "body": "anyhow, could you rebase on #30668 ?",
    "created_at": "2021-06-01T20:41:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31648",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31648#issuecomment-451446",
    "user": "https://github.com/dimpase"
}
```

anyhow, could you rebase on #30668 ?



---

archive/issue_comments_451447.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-06-03T09:59:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31648",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31648#issuecomment-451447",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_451448.json:
```json
{
    "body": "it looks OK to me, but I didn't check the actual cross-compiling.",
    "created_at": "2021-06-03T09:59:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31648",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31648#issuecomment-451448",
    "user": "https://github.com/dimpase"
}
```

it looks OK to me, but I didn't check the actual cross-compiling.



---

archive/issue_comments_451449.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-06-29T17:40:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31648",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31648#issuecomment-451449",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_028852.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-06-29T17:40:45Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31648",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31648#event-28852"
}
```
