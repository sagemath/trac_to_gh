# Issue 31648: Allow cross compiling

Issue created by migration from https://trac.sagemath.org/ticket/31885

Original creator: isuruf

Original creation time: 2021-05-31 06:56:15

CC:  fbissey mkoeppe dimpase




---

Comment by isuruf created at 2021-05-31 07:00:59

Changing status from new to needs_review.


---

Comment by git created at 2021-05-31 07:11:48

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by fbissey created at 2021-05-31 07:22:30

Why is trac automerging failing? Are you basing it on 9.3 or 9.4.beta0?

It otherwise looks OK but I would not know if it is complete or need more changes.


---

Comment by git created at 2021-05-31 07:31:52

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2021-05-31 07:36:06

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by isuruf created at 2021-05-31 16:14:15

Replying to [comment:3 fbissey]:
> Why is trac automerging failing? Are you basing it on 9.3 or 9.4.beta0?

Yes, that was it. I was basing it off of 9.3. Fixed now

> It otherwise looks OK but I would not know if it is complete or need more changes.

Thanks. I'm cross compiling for Apple silicon. With this patch I can compile sage-the-library. Got a couple more dependencies to build before I can start sage


---

Comment by mkoeppe created at 2021-05-31 17:13:20

What's the procedure to test this? My guess is that you're not building any of the Python dependencies of sagelib - the installation procedure wouldn't allow to install the built wheels of the wrong architecture


---

Comment by isuruf created at 2021-05-31 18:09:35

It's complicated to test this. I'm using https://github.com/benfogle/crossenv/ in conda-forge to setup an osx-x86_64 -> osx-arm64 cross compiling setup.


---

Comment by isuruf created at 2021-05-31 18:14:25

I was able to cross compile most of sagelib dependencies including python extensions. Only holdouts were NTL, pari and maxima.


---

Comment by fbissey created at 2021-05-31 21:43:26

Replying to [comment:7 mkoeppe]:
> What's the procedure to test this? My guess is that you're not building any of the Python dependencies of sagelib - the installation procedure wouldn't allow to install the built wheels of the wrong architecture

I am tempted to agree to include it if
 1) it doesn't have side effects on normal setup

 2) it is not a bloat bomb

This is experimental level of support. If and when it becomes more mainstream we will need to devise formal ways of testing it.


---

Comment by isuruf created at 2021-05-31 22:06:11

> 1) it doesn't have side effects on normal setup

It doesn't. This only modifies cross compile actions of `AC_TRY_RUN`, `AC_RUN_IFELSE`, etc.


---

Comment by dimpase created at 2021-06-01 16:26:29

isn't this fixed in #30668


---

Comment by dimpase created at 2021-06-01 16:27:43

these are deprecated autoconf macros we replaced in #30668


---

Comment by isuruf created at 2021-06-01 16:47:43

It's not. That ticket only touches ppl, but there are more packages that need support.


---

Comment by dimpase created at 2021-06-01 20:41:26

anyhow, could you rebase on #30668 ?


---

Comment by dimpase created at 2021-06-03 09:59:55

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2021-06-03 09:59:55

it looks OK to me, but I didn't check the actual cross-compiling.


---

Comment by vbraun created at 2021-06-29 17:40:45

Resolution: fixed
