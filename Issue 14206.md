# Issue 14206: Let ATLAS build shared libraries on Cygwin and install static libraries

archive/issues_014206.json:
```json
{
    "body": "Assignee: tbd\n\nCC:  @kcrisman @dimpase @vbraun\n\nKeywords: atlas spkg cygwin\n\nCurrently ATLAS build static libraries without problems on Cygwin, but the autotools build system crafted by Volker which uses libtool fail to repackage them into shared one.\nIndeed:\n* on usual platforms libtool already rants that it should not pack non-libtool objects (extracted from the static libs) together.\n* on Cygwin it just refuses to do so, and I could not find a flag to get the usual behavior (i.e. \"rant but do it\").\nThe solution is to replace the libtool invokations by direct invocations to gcc and gfortran (or even ld if you feel adventurous).\nSee http://trac.sagemath.org/sage_trac/ticket/10508#comment:392\n\nIssue created by migration from https://trac.sagemath.org/ticket/14410\n\n",
    "created_at": "2013-04-04T07:52:07Z",
    "labels": [
        "component: porting: cygwin",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.13",
    "title": "Let ATLAS build shared libraries on Cygwin and install static libraries",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14206",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```
Assignee: tbd

CC:  @kcrisman @dimpase @vbraun

Keywords: atlas spkg cygwin

Currently ATLAS build static libraries without problems on Cygwin, but the autotools build system crafted by Volker which uses libtool fail to repackage them into shared one.
Indeed:
* on usual platforms libtool already rants that it should not pack non-libtool objects (extracted from the static libs) together.
* on Cygwin it just refuses to do so, and I could not find a flag to get the usual behavior (i.e. "rant but do it").
The solution is to replace the libtool invokations by direct invocations to gcc and gfortran (or even ld if you feel adventurous).
See http://trac.sagemath.org/sage_trac/ticket/10508#comment:392

Issue created by migration from https://trac.sagemath.org/ticket/14410





---

archive/issue_events_040916.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14206",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14206#event-40916"
}
```



---

archive/issue_comments_178415.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-11-07T16:24:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14206#issuecomment-178415",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_178416.json:
```json
{
    "body": "More or less tested on debian/ubuntu and cygwin(32).",
    "created_at": "2013-11-07T16:25:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14206#issuecomment-178416",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

More or less tested on debian/ubuntu and cygwin(32).



---

archive/issue_comments_178417.json:
```json
{
    "body": "Spkg diff, for review only.",
    "created_at": "2013-11-07T16:35:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14206#issuecomment-178417",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Spkg diff, for review only.



---

archive/issue_comments_178418.json:
```json
{
    "body": "Attachment [atlas-3.10.1.p6.diff](tarball://root/attachments/some-uuid/ticket14410/atlas-3.10.1.p6.diff) by jpflori created at 2013-11-07 16:37:11\n\nSAGE_ATLAS_LIB should be ok on Cygwin as well now...",
    "created_at": "2013-11-07T16:37:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14206#issuecomment-178418",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Attachment [atlas-3.10.1.p6.diff](tarball://root/attachments/some-uuid/ticket14410/atlas-3.10.1.p6.diff) by jpflori created at 2013-11-07 16:37:11

SAGE_ATLAS_LIB should be ok on Cygwin as well now...



---

archive/issue_comments_178419.json:
```json
{
    "body": "Why are you moving the build dir into src? The whole point of a separate build dir is to keep it separate from the sources.\n\nIf you really want to build ATLAS by default on Cygwin then get rid of the \"if False\". Don't leave crap lying around after you are finished ;-)",
    "created_at": "2013-11-18T16:06:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14206#issuecomment-178419",
    "user": "https://github.com/vbraun"
}
```

Why are you moving the build dir into src? The whole point of a separate build dir is to keep it separate from the sources.

If you really want to build ATLAS by default on Cygwin then get rid of the "if False". Don't leave crap lying around after you are finished ;-)



---

archive/issue_comments_178420.json:
```json
{
    "body": "Replying to [comment:9 vbraun]:\n> Why are you moving the build dir into src? The whole point of a separate build dir is to keep it separate from the sources.\nHum, don't really know.\nI wanted to get something consistent with how the ATLAS-lib dir is treated so I made a choice between:\n* moving ATLAS-build to the (first level of) src,\n* making a copy of ATLAS-lib below src before building the autotools project,\n* making something more sensible and more complicated.\n> \n> If you really want to build ATLAS by default on Cygwin then get rid of the \"if False\". Don't leave crap lying around after you are finished ;-)\nI also hesitated, but I think keeping it in the spkg-install script, either as dead code or as a comment, cannot hurt.\nYou can argue that it is saved into the hg history anyway.",
    "created_at": "2013-11-18T16:15:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14206#issuecomment-178420",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Replying to [comment:9 vbraun]:
> Why are you moving the build dir into src? The whole point of a separate build dir is to keep it separate from the sources.
Hum, don't really know.
I wanted to get something consistent with how the ATLAS-lib dir is treated so I made a choice between:
* moving ATLAS-build to the (first level of) src,
* making a copy of ATLAS-lib below src before building the autotools project,
* making something more sensible and more complicated.
> 
> If you really want to build ATLAS by default on Cygwin then get rid of the "if False". Don't leave crap lying around after you are finished ;-)
I also hesitated, but I think keeping it in the spkg-install script, either as dead code or as a comment, cannot hurt.
You can argue that it is saved into the hg history anyway.



---

archive/issue_comments_178421.json:
```json
{
    "body": "Replying to [comment:10 jpflori]:\n> I also hesitated, but I think keeping it in the spkg-install script, either as dead code or as a comment, cannot hurt.\n\nIt can, e.g. the next person might think that you really wanted to enable that but could not at that time for some unknown reason...",
    "created_at": "2013-11-20T01:58:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14206#issuecomment-178421",
    "user": "https://github.com/vbraun"
}
```

Replying to [comment:10 jpflori]:
> I also hesitated, but I think keeping it in the spkg-install script, either as dead code or as a comment, cannot hurt.

It can, e.g. the next person might think that you really wanted to enable that but could not at that time for some unknown reason...



---

archive/issue_comments_178422.json:
```json
{
    "body": "Spkg updated at the same address.",
    "created_at": "2013-11-20T13:56:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14206#issuecomment-178422",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Spkg updated at the same address.



---

archive/issue_comments_178423.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-11-21T03:26:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14206#issuecomment-178423",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_178424.json:
```json
{
    "body": "Thanks. But \"therefore\" means \"for that reason; consequently\" and not \"before that\".\n\nOn a practical level, I don't think Jeroen is going to merge this before the git switch. Spkg changes might need to be manually converted to git branches...",
    "created_at": "2013-11-21T03:26:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14206#issuecomment-178424",
    "user": "https://github.com/vbraun"
}
```

Thanks. But "therefore" means "for that reason; consequently" and not "before that".

On a practical level, I don't think Jeroen is going to merge this before the git switch. Spkg changes might need to be manually converted to git branches...



---

archive/issue_comments_178425.json:
```json
{
    "body": "`spkg-check` doesn't work:\n\n```\n...\nSuccessfully installed atlas-3.10.1.p6\nRunning the test suite for atlas-3.10.1.p6...\n./spkg-check: line 38: cd: ATLAS-build: No such file or directory\n```\n",
    "created_at": "2013-11-22T14:47:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14206#issuecomment-178425",
    "user": "https://github.com/jdemeyer"
}
```

`spkg-check` doesn't work:

```
...
Successfully installed atlas-3.10.1.p6
Running the test suite for atlas-3.10.1.p6...
./spkg-check: line 38: cd: ATLAS-build: No such file or directory
```




---

archive/issue_comments_178426.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-11-22T14:47:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14206#issuecomment-178426",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_178427.json:
```json
{
    "body": "Also, the spkg needs to be rebased to #15270.",
    "created_at": "2013-11-22T20:26:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14206#issuecomment-178427",
    "user": "https://github.com/jdemeyer"
}
```

Also, the spkg needs to be rebased to #15270.



---

archive/issue_comments_178428.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-11-25T14:05:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14206#issuecomment-178428",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_178429.json:
```json
{
    "body": "Rebased on top of #15270 and revamped spkg-check.",
    "created_at": "2013-11-25T14:05:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14206#issuecomment-178429",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Rebased on top of #15270 and revamped spkg-check.



---

archive/issue_comments_178430.json:
```json
{
    "body": "For the record this should only:\n* fix a bug in spkg-install which thought that the serial shared libraries were built even when not and so left the sage install without any ATLAS libraries,\n* let ATLAS build on Cygwin without any impact on other systems,\n* clean spkg-check.\nSo this is not so intrusive for usual systems and I wouldn't mind that Jeroen includes it in 5.13 if it's not too late (as the two other easy and (hopefully) Cygwin-only spkg fixes at #15365 and #15366).",
    "created_at": "2013-11-25T15:02:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14206#issuecomment-178430",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

For the record this should only:
* fix a bug in spkg-install which thought that the serial shared libraries were built even when not and so left the sage install without any ATLAS libraries,
* let ATLAS build on Cygwin without any impact on other systems,
* clean spkg-check.
So this is not so intrusive for usual systems and I wouldn't mind that Jeroen includes it in 5.13 if it's not too late (as the two other easy and (hopefully) Cygwin-only spkg fixes at #15365 and #15366).



---

archive/issue_comments_178431.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-11-25T15:27:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14206#issuecomment-178431",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_178432.json:
```json
{
    "body": "I think the general policy is not to merge new spkgs late in the beta cycle, but I'll let Jeroen decide on that ;-)",
    "created_at": "2013-11-25T15:27:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14206#issuecomment-178432",
    "user": "https://github.com/vbraun"
}
```

I think the general policy is not to merge new spkgs late in the beta cycle, but I'll let Jeroen decide on that ;-)



---

archive/issue_comments_178433.json:
```json
{
    "body": "The Changelog inside `SPKG.txt` is wrong:\n\n```\n### atlas-3.10.1.p6, lapack-3.4.2 (Volker Braun, 11 October 2013)\n * Trac #15270: Do not give up if the upstream shared library build\n   fails\n * Solaris / ZFS fixes\n\n### atlas-3.10.1.p6, lapack-3.4.2 (Jean-Pierre Flori, 7 November 2013)\n * Trac #14410: Let ATLAS build and install shared libraries on Cygwin.\n * Bunch of modifications to the autotools project generating shared libraries\n   so that it does not invoke libtool on Cygwin.\n * Fix a bug in spkg-install.\n```\n\n\nThese two entries should be switched and the version number (atlas-3.10.1.**p7**) corrected.",
    "created_at": "2013-11-26T11:02:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14206#issuecomment-178433",
    "user": "https://github.com/jdemeyer"
}
```

The Changelog inside `SPKG.txt` is wrong:

```
### atlas-3.10.1.p6, lapack-3.4.2 (Volker Braun, 11 October 2013)
 * Trac #15270: Do not give up if the upstream shared library build
   fails
 * Solaris / ZFS fixes

### atlas-3.10.1.p6, lapack-3.4.2 (Jean-Pierre Flori, 7 November 2013)
 * Trac #14410: Let ATLAS build and install shared libraries on Cygwin.
 * Bunch of modifications to the autotools project generating shared libraries
   so that it does not invoke libtool on Cygwin.
 * Fix a bug in spkg-install.
```


These two entries should be switched and the version number (atlas-3.10.1.**p7**) corrected.



---

archive/issue_comments_178434.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-11-26T11:02:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14206#issuecomment-178434",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_178435.json:
```json
{
    "body": "Yup, I'm quite sure I did it, but as I screwed up later on and had to reapply other changes i guess I forgot to correct that again.",
    "created_at": "2013-11-26T13:33:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14206#issuecomment-178435",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Yup, I'm quite sure I did it, but as I screwed up later on and had to reapply other changes i guess I forgot to correct that again.



---

archive/issue_comments_178436.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-11-26T13:38:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14206#issuecomment-178436",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_178437.json:
```json
{
    "body": "Should be ok now...",
    "created_at": "2013-11-26T13:38:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14206#issuecomment-178437",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Should be ok now...



---

archive/issue_comments_178438.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-11-26T16:46:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14206#issuecomment-178438",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_178439.json:
```json
{
    "body": "make check does not work.",
    "created_at": "2013-11-26T16:46:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14206#issuecomment-178439",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

make check does not work.



---

archive/issue_comments_178440.json:
```json
{
    "body": "Ok, fixed and tested this time.",
    "created_at": "2013-11-26T17:26:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14206#issuecomment-178440",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Ok, fixed and tested this time.



---

archive/issue_comments_178441.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-11-26T17:26:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14206#issuecomment-178441",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_178442.json:
```json
{
    "body": "Tested (SPKG_CHECK=yes) with success on Solaris as well.",
    "created_at": "2013-11-28T09:32:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14206#issuecomment-178442",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Tested (SPKG_CHECK=yes) with success on Solaris as well.



---

archive/issue_events_040917.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-12-05T08:05:49Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/14206",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14206#event-40917"
}
```



---

archive/issue_comments_178443.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-12-05T08:05:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14206#issuecomment-178443",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
