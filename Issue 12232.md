# Issue 12232: is_squarefree() incorrect over imperfect fields

archive/issues_012232.json:
```json
{
    "body": "Assignee: malb\n\nCC:  sydahmad\n\nThe method `is_squarefree()` is incorrect for polynomials over function fields over finite fields:\n\n\n```\nsage: K.<x> = FunctionField(GF(3))\nsage: R.<T> = K[]\nsage: f=T^3-x\nsage: f.factor(proof=False)\nT^3 + 2*x\nsage: f.is_squarefree()\nFalse\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/12404\n\n",
    "created_at": "2012-01-31T17:58:03Z",
    "labels": [
        "commutative algebra",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.1",
    "title": "is_squarefree() incorrect over imperfect fields",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12232",
    "user": "saraedum"
}
```
Assignee: malb

CC:  sydahmad

The method `is_squarefree()` is incorrect for polynomials over function fields over finite fields:


```
sage: K.<x> = FunctionField(GF(3))
sage: R.<T> = K[]
sage: f=T^3-x
sage: f.factor(proof=False)
T^3 + 2*x
sage: f.is_squarefree()
False
```


Issue created by migration from https://trac.sagemath.org/ticket/12404





---

archive/issue_comments_142905.json:
```json
{
    "body": "The method `is_squarefree()` returns `self.derivative().gcd(self).degree() <= 0`. In the example the derivative vanishes which leads to the incorrect behaviour.\n\nAs a quick workaround one can do:\n\n```\nTrue in [d>=2 for (f,d) in f.factor(proof=False)]\n```\n",
    "created_at": "2012-01-31T18:02:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12232#issuecomment-142905",
    "user": "saraedum"
}
```

The method `is_squarefree()` returns `self.derivative().gcd(self).degree() <= 0`. In the example the derivative vanishes which leads to the incorrect behaviour.

As a quick workaround one can do:

```
True in [d>=2 for (f,d) in f.factor(proof=False)]
```




---

archive/issue_comments_142906.json:
```json
{
    "body": "Replying to [comment:1 saraedum]:\n> {{{\n> True in [d>=2 for (f,d) in f.factor(proof=False)]\n> }}}\nThis would be \"is_not_squarefree()\" of course.",
    "created_at": "2012-01-31T18:06:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12232#issuecomment-142906",
    "user": "saraedum"
}
```

Replying to [comment:1 saraedum]:
> {{{
> True in [d>=2 for (f,d) in f.factor(proof=False)]
> }}}
This would be "is_not_squarefree()" of course.



---

archive/issue_comments_142907.json:
```json
{
    "body": "see also #12198.\n\nPaul",
    "created_at": "2012-05-11T07:18:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12232#issuecomment-142907",
    "user": "zimmerma"
}
```

see also #12198.

Paul



---

archive/issue_comments_142908.json:
```json
{
    "body": "see also #12129.\n\nPaul",
    "created_at": "2012-05-11T07:21:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12232#issuecomment-142908",
    "user": "zimmerma"
}
```

see also #12129.

Paul



---

archive/issue_comments_142909.json:
```json
{
    "body": "Thanks for pointing these out. Since both are in the multivariate case, I don't think they're related.",
    "created_at": "2012-05-23T13:31:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12232#issuecomment-142909",
    "user": "saraedum"
}
```

Thanks for pointing these out. Since both are in the multivariate case, I don't think they're related.



---

archive/issue_comments_142910.json:
```json
{
    "body": "The attached patch should fix the problem.",
    "created_at": "2012-05-24T22:30:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12232#issuecomment-142910",
    "user": "saraedum"
}
```

The attached patch should fix the problem.



---

archive/issue_comments_142911.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-05-24T22:30:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12232#issuecomment-142911",
    "user": "saraedum"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_142912.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd40.5\".",
    "created_at": "2012-05-24T23:11:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12232#issuecomment-142912",
    "user": "saraedum"
}
```

Changing keywords from "" to "sd40.5".



---

archive/issue_comments_142913.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-05-25T08:27:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12232#issuecomment-142913",
    "user": "zimmerma"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_142914.json:
```json
{
    "body": "the documentation of `is_squarefree` says that `f` is not square-free if `g^2`\ndivides `f` where `g` is a non-unit. In particular `4*x` is not considered\nsquare free by `is_squarefree`, but it is by `squarefree_decomposition`:\n\n```\nsage: R.<x> = ZZ[]\nsage: f = 4*x\nsage: f.is_squarefree()\nFalse\nsage: f.squarefree_decomposition()\n(4) * x\n```\n\n\nSage should be coherent in that matter. Personally I prefer not to decompose the coefficient content.\n\nMoreover the following produces an error:\n\n```\nsage: R.<x> = ZZ[]\nsage: f = 2*x^2\nsage: f.is_squarefree()\n...\nAttributeError: 'int' object has no attribute 'is_zero'\n```\n\n\nPaul",
    "created_at": "2012-05-25T08:27:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12232#issuecomment-142914",
    "user": "zimmerma"
}
```

the documentation of `is_squarefree` says that `f` is not square-free if `g^2`
divides `f` where `g` is a non-unit. In particular `4*x` is not considered
square free by `is_squarefree`, but it is by `squarefree_decomposition`:

```
sage: R.<x> = ZZ[]
sage: f = 4*x
sage: f.is_squarefree()
False
sage: f.squarefree_decomposition()
(4) * x
```


Sage should be coherent in that matter. Personally I prefer not to decompose the coefficient content.

Moreover the following produces an error:

```
sage: R.<x> = ZZ[]
sage: f = 2*x^2
sage: f.is_squarefree()
...
AttributeError: 'int' object has no attribute 'is_zero'
```


Paul



---

archive/issue_comments_142915.json:
```json
{
    "body": "Replying to [comment:9 zimmerma]:\n> the documentation of `is_squarefree` says that `f` is not square-free if `g^2`\n> divides `f` where `g` is a non-unit. In particular `4*x` is not considered\n> square free by `is_squarefree`, but it is by `squarefree_decomposition`:\n> {{{\n> sage: R.<x> = ZZ[]\n> sage: f = 4*x\n> sage: f.is_squarefree()\n> False\n> sage: f.squarefree_decomposition()\n> (4) * x\n> }}}\n> \n> Sage should be coherent in that matter. Personally I prefer not to decompose the coefficient content.\n\nThat is true. I also noted this inconsistency. To not break existing code, I'd rather add a warning section in the docstring. Generally I agree that having `squarefree_decomposition()` factor the content is not what one wants for most purposes.\n\nWould you be ok with just adding a warning and an example showing this problem?\n\n> Moreover the following produces an error:\n> {{{\n> sage: R.<x> = ZZ[]\n> sage: f = 2*x^2\n> sage: f.is_squarefree()\n> ...\n> AttributeError: 'int' object has no attribute 'is_zero'\n> }}}\n\nThis should not happen when applying the dependency #12988.",
    "created_at": "2012-05-25T09:53:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12232#issuecomment-142915",
    "user": "saraedum"
}
```

Replying to [comment:9 zimmerma]:
> the documentation of `is_squarefree` says that `f` is not square-free if `g^2`
> divides `f` where `g` is a non-unit. In particular `4*x` is not considered
> square free by `is_squarefree`, but it is by `squarefree_decomposition`:
> {{{
> sage: R.<x> = ZZ[]
> sage: f = 4*x
> sage: f.is_squarefree()
> False
> sage: f.squarefree_decomposition()
> (4) * x
> }}}
> 
> Sage should be coherent in that matter. Personally I prefer not to decompose the coefficient content.

That is true. I also noted this inconsistency. To not break existing code, I'd rather add a warning section in the docstring. Generally I agree that having `squarefree_decomposition()` factor the content is not what one wants for most purposes.

Would you be ok with just adding a warning and an example showing this problem?

> Moreover the following produces an error:
> {{{
> sage: R.<x> = ZZ[]
> sage: f = 2*x^2
> sage: f.is_squarefree()
> ...
> AttributeError: 'int' object has no attribute 'is_zero'
> }}}

This should not happen when applying the dependency #12988.



---

archive/issue_comments_142916.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2012-05-25T09:53:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12232#issuecomment-142916",
    "user": "saraedum"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_comments_142917.json:
```json
{
    "body": "I added a patch with such a warning. I still have to check how it renders in the docs.",
    "created_at": "2012-05-25T10:20:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12232#issuecomment-142917",
    "user": "saraedum"
}
```

I added a patch with such a warning. I still have to check how it renders in the docs.



---

archive/issue_comments_142918.json:
```json
{
    "body": "I made a few docstring changes in the latest patch.",
    "created_at": "2012-05-25T11:01:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12232#issuecomment-142918",
    "user": "saraedum"
}
```

I made a few docstring changes in the latest patch.



---

archive/issue_comments_142919.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2012-05-25T11:01:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12232#issuecomment-142919",
    "user": "saraedum"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_142920.json:
```json
{
    "body": "Attachment [trac_12404.patch](tarball://root/attachments/some-uuid/ticket12404/trac_12404.patch) by saraedum created at 2012-05-25 11:05:58\n\ndistinguish characteristic zero and nonzero",
    "created_at": "2012-05-25T11:05:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12232#issuecomment-142920",
    "user": "saraedum"
}
```

Attachment [trac_12404.patch](tarball://root/attachments/some-uuid/ticket12404/trac_12404.patch) by saraedum created at 2012-05-25 11:05:58

distinguish characteristic zero and nonzero



---

archive/issue_comments_142921.json:
```json
{
    "body": "Btw. I will add the respective warning for `squarefree_decomposition()` in #13008.",
    "created_at": "2012-05-25T12:10:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12232#issuecomment-142921",
    "user": "saraedum"
}
```

Btw. I will add the respective warning for `squarefree_decomposition()` in #13008.



---

archive/issue_comments_142922.json:
```json
{
    "body": "Julian, there is a typo in ` trac_12404_warning.patch`: `not to consider to content`\nshould read `not to consider the content`.\n\nWould it break a lot of code if `is_squarefree` returns False for `4*x`?\nDid you try?\n\nPaul",
    "created_at": "2012-05-25T12:25:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12232#issuecomment-142922",
    "user": "zimmerma"
}
```

Julian, there is a typo in ` trac_12404_warning.patch`: `not to consider to content`
should read `not to consider the content`.

Would it break a lot of code if `is_squarefree` returns False for `4*x`?
Did you try?

Paul



---

archive/issue_comments_142923.json:
```json
{
    "body": "Attachment [trac_12404_warning.patch](tarball://root/attachments/some-uuid/ticket12404/trac_12404_warning.patch) by saraedum created at 2012-05-25 12:48:50\n\nwarning about inconsistency with squarefree_decomposition",
    "created_at": "2012-05-25T12:48:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12232#issuecomment-142923",
    "user": "saraedum"
}
```

Attachment [trac_12404_warning.patch](tarball://root/attachments/some-uuid/ticket12404/trac_12404_warning.patch) by saraedum created at 2012-05-25 12:48:50

warning about inconsistency with squarefree_decomposition



---

archive/issue_comments_142924.json:
```json
{
    "body": "Thanks, the typo should be fixed now.\n\nNo I haven't tried. I was actually thinking about external code using that method. If you insist we can change it. I don't have a very strong opinion about this. I just believe that inconsistency isn't bad as long as it's documented. IMHO breaking the interface is worse than documented inconsistency.",
    "created_at": "2012-05-25T12:51:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12232#issuecomment-142924",
    "user": "saraedum"
}
```

Thanks, the typo should be fixed now.

No I haven't tried. I was actually thinking about external code using that method. If you insist we can change it. I don't have a very strong opinion about this. I just believe that inconsistency isn't bad as long as it's documented. IMHO breaking the interface is worse than documented inconsistency.



---

archive/issue_comments_142925.json:
```json
{
    "body": "Replying to [comment:15 zimmerma]:\n> Would it break a lot of code if `is_squarefree` returns False for `4*x`?\nDid you mean \"if `is_squarefree` returns True for `4*x`\"?",
    "created_at": "2012-05-26T05:41:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12232#issuecomment-142925",
    "user": "jdemeyer"
}
```

Replying to [comment:15 zimmerma]:
> Would it break a lot of code if `is_squarefree` returns False for `4*x`?
Did you mean "if `is_squarefree` returns True for `4*x`"?



---

archive/issue_comments_142926.json:
```json
{
    "body": "Attachment [12404_examples.patch](tarball://root/attachments/some-uuid/ticket12404/12404_examples.patch) by jdemeyer created at 2012-05-26 06:13:05",
    "created_at": "2012-05-26T06:13:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12232#issuecomment-142926",
    "user": "jdemeyer"
}
```

Attachment [12404_examples.patch](tarball://root/attachments/some-uuid/ticket12404/12404_examples.patch) by jdemeyer created at 2012-05-26 06:13:05



---

archive/issue_comments_142927.json:
```json
{
    "body": "Positive review to the first two patches.  Anybody else can review my patch?",
    "created_at": "2012-05-26T06:45:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12232#issuecomment-142927",
    "user": "jdemeyer"
}
```

Positive review to the first two patches.  Anybody else can review my patch?



---

archive/issue_comments_142928.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-05-27T18:11:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12232#issuecomment-142928",
    "user": "was"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_142929.json:
```json
{
    "body": "jdmeyer -- I positively review your patch.",
    "created_at": "2012-05-27T18:11:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12232#issuecomment-142929",
    "user": "was"
}
```

jdmeyer -- I positively review your patch.



---

archive/issue_comments_142930.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-06-06T19:11:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12232",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12232#issuecomment-142930",
    "user": "jdemeyer"
}
```

Resolution: fixed
