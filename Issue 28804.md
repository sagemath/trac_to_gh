# Issue 28804: at ./bootstrap time, generate src/requirements.txt, src/constraints.txt, src/setup.cfg [install_requires] from build/pkgs

archive/issues_028804.json:
```json
{
    "body": "CC:  @seblabbe @dimpase @embray @vbraun @kiwifb @tobihan @tobiasdiez\n\nhttps://pip.pypa.io/en/stable/user_guide/#requirements-files\n\nThis is another step toward #21507 - Task ticket: Make sagelib a pip-installable Python source package, listed on PyPI\n\nIssue created by migration from https://trac.sagemath.org/ticket/29041\n\n",
    "created_at": "2020-01-18T21:43:50Z",
    "labels": [
        "build",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "at ./bootstrap time, generate src/requirements.txt, src/constraints.txt, src/setup.cfg [install_requires] from build/pkgs",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28804",
    "user": "@mkoeppe"
}
```
CC:  @seblabbe @dimpase @embray @vbraun @kiwifb @tobihan @tobiasdiez

https://pip.pypa.io/en/stable/user_guide/#requirements-files

This is another step toward #21507 - Task ticket: Make sagelib a pip-installable Python source package, listed on PyPI

Issue created by migration from https://trac.sagemath.org/ticket/29041





---

archive/issue_comments_407173.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-01-19T01:07:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28804#issuecomment-407173",
    "user": "@mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_407174.json:
```json
{
    "body": "This is what it could look like - just for a small handful of packages for now\n----\nNew commits:",
    "created_at": "2020-01-19T01:07:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28804#issuecomment-407174",
    "user": "@mkoeppe"
}
```

This is what it could look like - just for a small handful of packages for now
----
New commits:



---

archive/issue_comments_407175.json:
```json
{
    "body": "The `apt-get` line in the install manual could be generated in the same way.",
    "created_at": "2020-01-19T01:22:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28804#issuecomment-407175",
    "user": "@mkoeppe"
}
```

The `apt-get` line in the install manual could be generated in the same way.



---

archive/issue_comments_407176.json:
```json
{
    "body": "Replying to [comment:3 mkoeppe]:\n> The `apt-get` line in the install manual could be generated in the same way.\nThis is #29053.",
    "created_at": "2020-01-20T15:02:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28804#issuecomment-407176",
    "user": "@mkoeppe"
}
```

Replying to [comment:3 mkoeppe]:
> The `apt-get` line in the install manual could be generated in the same way.
This is #29053.



---

archive/issue_comments_407177.json:
```json
{
    "body": "I see that only few packages, e.g. pillow, are mentioned in the branch. Are they there as an example?",
    "created_at": "2020-01-21T23:39:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28804#issuecomment-407177",
    "user": "@dimpase"
}
```

I see that only few packages, e.g. pillow, are mentioned in the branch. Are they there as an example?



---

archive/issue_comments_407178.json:
```json
{
    "body": "Yes, it's an initial example. More can be added on this ticket and/or on follow up tickets.\n\nIt may be the most efficient to first put this infrastructure (and the one for Debian) in place and then do invidual packages one by one to determine useful version bounds.",
    "created_at": "2020-01-21T23:45:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28804#issuecomment-407178",
    "user": "@mkoeppe"
}
```

Yes, it's an initial example. More can be added on this ticket and/or on follow up tickets.

It may be the most efficient to first put this infrastructure (and the one for Debian) in place and then do invidual packages one by one to determine useful version bounds.



---

archive/issue_comments_407179.json:
```json
{
    "body": "how is it going to play out with version constraints in spkg-configure.m4 files?",
    "created_at": "2020-01-21T23:51:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28804#issuecomment-407179",
    "user": "@dimpase"
}
```

how is it going to play out with version constraints in spkg-configure.m4 files?



---

archive/issue_comments_407180.json:
```json
{
    "body": "So far there are no `spkg-configure.m4` files for any Python packages, and I would hope there will be no need for them.",
    "created_at": "2020-01-21T23:56:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28804#issuecomment-407180",
    "user": "@mkoeppe"
}
```

So far there are no `spkg-configure.m4` files for any Python packages, and I would hope there will be no need for them.



---

archive/issue_comments_407181.json:
```json
{
    "body": "Basically `sagelib-install-requires.txt` will play the same role for Python packages as `spkg-configure.m4` does for non-Python packages, \nand likewise `sagelib-requirements.txt` : `package-version.txt`.",
    "created_at": "2020-01-21T23:59:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28804#issuecomment-407181",
    "user": "@mkoeppe"
}
```

Basically `sagelib-install-requires.txt` will play the same role for Python packages as `spkg-configure.m4` does for non-Python packages, 
and likewise `sagelib-requirements.txt` : `package-version.txt`.



---

archive/issue_comments_407182.json:
```json
{
    "body": "`@`embray If you have time - this ticket is waiting for review.",
    "created_at": "2020-01-31T14:04:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28804#issuecomment-407182",
    "user": "@mkoeppe"
}
```

`@`embray If you have time - this ticket is waiting for review.



---

archive/issue_comments_407183.json:
```json
{
    "body": "Similar to what I wrote on #26964, I don't think this should be done in the `bootstrap` script.  I don't want this script growing too far beyond its core purpose, which is simply to bootstrap the `configure` script.\n\nThis could be done by `configure` instead, using say a `requirements.txt.in`.",
    "created_at": "2020-02-05T11:50:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28804#issuecomment-407183",
    "user": "@embray"
}
```

Similar to what I wrote on #26964, I don't think this should be done in the `bootstrap` script.  I don't want this script growing too far beyond its core purpose, which is simply to bootstrap the `configure` script.

This could be done by `configure` instead, using say a `requirements.txt.in`.



---

archive/issue_comments_407184.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-02-05T11:50:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28804#issuecomment-407184",
    "user": "@embray"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_407185.json:
```json
{
    "body": "See my comments on #26964.",
    "created_at": "2020-02-05T13:50:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28804#issuecomment-407185",
    "user": "@mkoeppe"
}
```

See my comments on #26964.



---

archive/issue_comments_407186.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-02-05T18:45:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28804#issuecomment-407186",
    "user": "@mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_407187.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-02-22T23:21:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28804#issuecomment-407187",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_407188.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-02-22T23:22:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28804#issuecomment-407188",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_407189.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-02T01:41:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28804#issuecomment-407189",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_407190.json:
```json
{
    "body": "Needs review",
    "created_at": "2020-03-06T16:54:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28804#issuecomment-407190",
    "user": "@mkoeppe"
}
```

Needs review



---

archive/issue_comments_407191.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-03-15T17:10:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28804#issuecomment-407191",
    "user": "@mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_407192.json:
```json
{
    "body": "Another approach would be to maintain an independent pipfile/requirements.txt in src/ and have automatic checks to make sure that the sage packages provide the required packages with a suitable version.\n\nReason: I feel like sage-lib should be independent of sage-distribution as much as possible.\n\nMore practical reason: pipenv works very nicely on Windows, and my hope is to use it without having to use `sage make` beforehand. So one simply clones the code, starts the virtual env with pipenv and gets an editiable install of sage for easy development. But for this the pipfile needs to be there without running the bootstrap command. (The alternative would be to rewrite the bootstrap cmd in a OS-independent way, say using powershell.)",
    "created_at": "2020-09-16T08:50:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28804#issuecomment-407192",
    "user": "@tobiasdiez"
}
```

Another approach would be to maintain an independent pipfile/requirements.txt in src/ and have automatic checks to make sure that the sage packages provide the required packages with a suitable version.

Reason: I feel like sage-lib should be independent of sage-distribution as much as possible.

More practical reason: pipenv works very nicely on Windows, and my hope is to use it without having to use `sage make` beforehand. So one simply clones the code, starts the virtual env with pipenv and gets an editiable install of sage for easy development. But for this the pipfile needs to be there without running the bootstrap command. (The alternative would be to rewrite the bootstrap cmd in a OS-independent way, say using powershell.)



---

archive/issue_comments_407193.json:
```json
{
    "body": "Replying to [comment:30 gh-tobiasdiez]:\n> Another approach would be to maintain an independent pipfile/requirements.txt in src/ and have automatic checks to make sure that the sage packages provide the required packages with a suitable version.\n> \n> Reason: I feel like sage-lib should be independent of sage-distribution as much as possible.\n\nI think the versions given by sage-the-distribution (`build/pkgs/*/package-version.txt`) should be considered as pinned versions, and information such as `requirements.txt` or `Pipfile`/`Pipfile.lock` should come from there in some way.\n\nThe allowed version ranges are currently not encoded anywhere. For non-Python packages have `spkg-configure.m4` (#27330), but this is obviously the wrong mechanism for Python packages.  setuptools has them in `setup.cfg [install_requires]`. \n\nI think I agree with you that this information does not necessarily have to be generated from (new) files in `build/pkgs/` but could be put directly into `src/`, such as `src/setup.cfg`. \n\n\n> More practical reason: pipenv works very nicely on Windows, and my hope is to use it without having to use `sage make` beforehand. So one simply clones the code, starts the virtual env with pipenv and gets an editiable install of sage for easy development.\n\nI think some steps are missing here - we don't have a native Windows build of many packages that Sage depends on. But I agree, after modularization (#29705) we should aim for getting a native Windows build of a Sage core at least.\n\n> But for this the pipfile needs to be there without running the bootstrap command. (The alternative would be to rewrite the bootstrap cmd in a OS-independent way, say using powershell.) \n\nNote that we have the `bootstrap -d` mechanism, which downloads a tarball of the files created by `bootstrap`.  This is how most users and developers get these files. We could look into creating a powershell version of `bootstrap -d`.",
    "created_at": "2020-09-16T17:07:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28804#issuecomment-407193",
    "user": "@mkoeppe"
}
```

Replying to [comment:30 gh-tobiasdiez]:
> Another approach would be to maintain an independent pipfile/requirements.txt in src/ and have automatic checks to make sure that the sage packages provide the required packages with a suitable version.
> 
> Reason: I feel like sage-lib should be independent of sage-distribution as much as possible.

I think the versions given by sage-the-distribution (`build/pkgs/*/package-version.txt`) should be considered as pinned versions, and information such as `requirements.txt` or `Pipfile`/`Pipfile.lock` should come from there in some way.

The allowed version ranges are currently not encoded anywhere. For non-Python packages have `spkg-configure.m4` (#27330), but this is obviously the wrong mechanism for Python packages.  setuptools has them in `setup.cfg [install_requires]`. 

I think I agree with you that this information does not necessarily have to be generated from (new) files in `build/pkgs/` but could be put directly into `src/`, such as `src/setup.cfg`. 


> More practical reason: pipenv works very nicely on Windows, and my hope is to use it without having to use `sage make` beforehand. So one simply clones the code, starts the virtual env with pipenv and gets an editiable install of sage for easy development.

I think some steps are missing here - we don't have a native Windows build of many packages that Sage depends on. But I agree, after modularization (#29705) we should aim for getting a native Windows build of a Sage core at least.

> But for this the pipfile needs to be there without running the bootstrap command. (The alternative would be to rewrite the bootstrap cmd in a OS-independent way, say using powershell.) 

Note that we have the `bootstrap -d` mechanism, which downloads a tarball of the files created by `bootstrap`.  This is how most users and developers get these files. We could look into creating a powershell version of `bootstrap -d`.



---

archive/issue_comments_407194.json:
```json
{
    "body": "There is also https://pypi.org/project/pipenv-to-requirements/ to generate the requirements file from a pipfile.",
    "created_at": "2020-09-28T10:38:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28804#issuecomment-407194",
    "user": "@tobiasdiez"
}
```

There is also https://pypi.org/project/pipenv-to-requirements/ to generate the requirements file from a pipfile.



---

archive/issue_comments_407195.json:
```json
{
    "body": "Hoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111",
    "created_at": "2020-12-06T18:17:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28804#issuecomment-407195",
    "user": "@mkoeppe"
}
```

Hoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111



---

archive/issue_comments_407196.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd111\".",
    "created_at": "2020-12-06T18:17:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28804#issuecomment-407196",
    "user": "@mkoeppe"
}
```

Changing keywords from "" to "sd111".



---

archive/issue_comments_407197.json:
```json
{
    "body": "Rewriting tools used in the bootstrap phase in Python would also be useful for developing on Windows",
    "created_at": "2020-12-12T21:05:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28804#issuecomment-407197",
    "user": "@mkoeppe"
}
```

Rewriting tools used in the bootstrap phase in Python would also be useful for developing on Windows



---

archive/issue_comments_407198.json:
```json
{
    "body": "hmm, what is so problematic about Windows here? Even if one talks about native, non-cygwin, it is still perfectly possible to run bash etc.",
    "created_at": "2020-12-12T22:51:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28804#issuecomment-407198",
    "user": "@dimpase"
}
```

hmm, what is so problematic about Windows here? Even if one talks about native, non-cygwin, it is still perfectly possible to run bash etc.



---

archive/issue_comments_407199.json:
```json
{
    "body": "Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28804#issuecomment-407199",
    "user": "@mkoeppe"
}
```

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_407200.json:
```json
{
    "body": "Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28804",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28804#issuecomment-407200",
    "user": "@mkoeppe"
}
```

Setting a new milestone for this ticket based on a cursory review.
