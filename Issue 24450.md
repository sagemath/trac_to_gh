# Issue 24450: Fix wrong peirce_summand

archive/issues_024450.json:
```json
{
    "body": "CC:  nthiery saliola\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/24687\n\n",
    "created_at": "2018-02-07T20:07:53Z",
    "labels": [
        "PLEASE CHANGE",
        "major",
        "PLEASE CHANGE"
    ],
    "title": "Fix wrong peirce_summand",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24450",
    "user": "hivert"
}
```
CC:  nthiery saliola



Issue created by migration from https://trac.sagemath.org/ticket/24687





---

archive/issue_comments_342951.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2018-02-07T20:29:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24450#issuecomment-342951",
    "user": "hivert"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_342952.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-02-07T20:29:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24450#issuecomment-342952",
    "user": "hivert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_342953.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to algebra.",
    "created_at": "2018-02-07T20:29:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24450#issuecomment-342953",
    "user": "hivert"
}
```

Changing component from PLEASE CHANGE to algebra.



---

archive/issue_comments_342954.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-02-07T20:29:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24450#issuecomment-342954",
    "user": "hivert"
}
```

New commits:



---

archive/issue_comments_342955.json:
```json
{
    "body": "Changing keywords from \"\" to \"Finite dimensional algebra, Peirce summand\".",
    "created_at": "2018-02-07T20:29:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24450#issuecomment-342955",
    "user": "hivert"
}
```

Changing keywords from "" to "Finite dimensional algebra, Peirce summand".



---

archive/issue_comments_342956.json:
```json
{
    "body": "This test seems a little fragile to me:\n\n```\nsage: f = S.basis()[0].lift()\nsage: e == f\nTrue\n```\n\nI think a better test is to scale `f` by `e.leading_coefficient() / f.leading_coefficient()`. Otherwise LGTM.",
    "created_at": "2018-02-07T23:00:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24450#issuecomment-342956",
    "user": "tscrim"
}
```

This test seems a little fragile to me:

```
sage: f = S.basis()[0].lift()
sage: e == f
True
```

I think a better test is to scale `f` by `e.leading_coefficient() / f.leading_coefficient()`. Otherwise LGTM.



---

archive/issue_comments_342957.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-07T23:35:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24450#issuecomment-342957",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_342958.json:
```json
{
    "body": "Replying to [comment:3 tscrim]:\n> I think a better test is to scale `f` by `e.leading_coefficient() / f.leading_coefficient()`. Otherwise LGTM.\n\nFixed ! But If you go that way there is another fragile assumption: the fact that the 0-th idempotent is one whose bi-sided Peirce summand is of dimension 1. I'm checking this fact, but There is no waranty that the algorithm wil allway return the idempotent in the same order. For H4 among the 8 idempotents two of them have summand of dimension 2. Do you think I should write a loop to find such an idempotent ?",
    "created_at": "2018-02-07T23:43:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24450#issuecomment-342958",
    "user": "hivert"
}
```

Replying to [comment:3 tscrim]:
> I think a better test is to scale `f` by `e.leading_coefficient() / f.leading_coefficient()`. Otherwise LGTM.

Fixed ! But If you go that way there is another fragile assumption: the fact that the 0-th idempotent is one whose bi-sided Peirce summand is of dimension 1. I'm checking this fact, but There is no waranty that the algorithm wil allway return the idempotent in the same order. For H4 among the 8 idempotents two of them have summand of dimension 2. Do you think I should write a loop to find such an idempotent ?



---

archive/issue_comments_342959.json:
```json
{
    "body": "Replying to [comment:5 hivert]:\n> Replying to [comment:3 tscrim]:\n> > I think a better test is to scale `f` by `e.leading_coefficient() / f.leading_coefficient()`. Otherwise LGTM.\n> \n> Fixed ! But If you go that way there is another fragile assumption: the fact that the 0-th idempotent is one whose bi-sided Peirce summand is of dimension 1. I'm checking this fact, but There is no waranty that the algorithm wil allway return the idempotent in the same order. For H4 among the 8 idempotents two of them have summand of dimension 2. Do you think I should write a loop to find such an idempotent ?\n\nThat's a good point. Well, how about doing something more simple and just printing the dimension of `S` to emphasize that we are using (and sort of testing) that property?",
    "created_at": "2018-02-07T23:54:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24450#issuecomment-342959",
    "user": "tscrim"
}
```

Replying to [comment:5 hivert]:
> Replying to [comment:3 tscrim]:
> > I think a better test is to scale `f` by `e.leading_coefficient() / f.leading_coefficient()`. Otherwise LGTM.
> 
> Fixed ! But If you go that way there is another fragile assumption: the fact that the 0-th idempotent is one whose bi-sided Peirce summand is of dimension 1. I'm checking this fact, but There is no waranty that the algorithm wil allway return the idempotent in the same order. For H4 among the 8 idempotents two of them have summand of dimension 2. Do you think I should write a loop to find such an idempotent ?

That's a good point. Well, how about doing something more simple and just printing the dimension of `S` to emphasize that we are using (and sort of testing) that property?



---

archive/issue_comments_342960.json:
```json
{
    "body": "Replying to [comment:6 tscrim]:\n\n> That's a good point. Well, how about doing something more simple and just printing the dimension of `S` to emphasize that we are using (and sort of testing) that property?\n\nThat's exactly what the line\n\n```\nsage: S = A.peirce_summand(e, e); S\nFree module generated by {0} over Rational Field\n```\n\nis doing.",
    "created_at": "2018-02-08T00:04:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24450#issuecomment-342960",
    "user": "hivert"
}
```

Replying to [comment:6 tscrim]:

> That's a good point. Well, how about doing something more simple and just printing the dimension of `S` to emphasize that we are using (and sort of testing) that property?

That's exactly what the line

```
sage: S = A.peirce_summand(e, e); S
Free module generated by {0} over Rational Field
```

is doing.



---

archive/issue_comments_342961.json:
```json
{
    "body": "Replying to [comment:7 hivert]:\n> Replying to [comment:6 tscrim]:\n> \n> > That's a good point. Well, how about doing something more simple and just printing the dimension of `S` to emphasize that we are using (and sort of testing) that property?\n> \n> That's exactly what the line\n> {{{\n> sage: S = A.peirce_summand(e, e); S\n> Free module generated by {0} over Rational Field\n> }}}\n> is doing.\n\nAh, right. Actually, we are overthinking this:\n\n```\nsage: S.retract(e) in S\nTrue\n```\n\nIdeally we should not need the retract, but that is a separate deficiency IMO of `SubmoduleWithBasis` (instead using `CombinatorialFreeModule.__contains__`, which just checks the `parent(x) == self`).",
    "created_at": "2018-02-08T00:17:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24450#issuecomment-342961",
    "user": "tscrim"
}
```

Replying to [comment:7 hivert]:
> Replying to [comment:6 tscrim]:
> 
> > That's a good point. Well, how about doing something more simple and just printing the dimension of `S` to emphasize that we are using (and sort of testing) that property?
> 
> That's exactly what the line
> {{{
> sage: S = A.peirce_summand(e, e); S
> Free module generated by {0} over Rational Field
> }}}
> is doing.

Ah, right. Actually, we are overthinking this:

```
sage: S.retract(e) in S
True
```

Ideally we should not need the retract, but that is a separate deficiency IMO of `SubmoduleWithBasis` (instead using `CombinatorialFreeModule.__contains__`, which just checks the `parent(x) == self`).



---

archive/issue_comments_342962.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-08T12:45:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24450#issuecomment-342962",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_342963.json:
```json
{
    "body": "Replying to [comment:8 tscrim]:\n> Ah, right. Actually, we are overthinking this:\n> {{{\n> sage: S.retract(e) in S\n> True\n> }}}\nThis is a much better tests. Actually the `in S` is not needed. Retract breaks:\n\n```\nValueError: B[map: ...] is not in the image\n```\n\nI left it anyway. And fixed a typo elsewhere by the way.",
    "created_at": "2018-02-08T12:48:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24450#issuecomment-342963",
    "user": "hivert"
}
```

Replying to [comment:8 tscrim]:
> Ah, right. Actually, we are overthinking this:
> {{{
> sage: S.retract(e) in S
> True
> }}}
This is a much better tests. Actually the `in S` is not needed. Retract breaks:

```
ValueError: B[map: ...] is not in the image
```

I left it anyway. And fixed a typo elsewhere by the way.



---

archive/issue_comments_342964.json:
```json
{
    "body": "Replying to [comment:10 hivert]:\n> Replying to [comment:8 tscrim]:\n> > Ah, right. Actually, we are overthinking this:\n> > {{{\n> > sage: S.retract(e) in S\n> > True\n> > }}}\n> This is a much better tests. Actually the `in S` is not needed. Retract breaks:\n> {{{\n> ValueError: B[map: ...] is not in the image\n> }}}\n> I left it anyway.\n\nThank you. Like I said, ideally the test would just be `e in S`, but that is a separate issue.\n\n> And fixed a typo elsewhere by the way.\n\nLGTM modulo `TESTS::` -> `TESTS:` since you have plain-text after it. Addendum: also capitalize Pierce in the `TESTS:` block. Once fixed, you can set a positive review on my behalf.",
    "created_at": "2018-02-08T12:59:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24450#issuecomment-342964",
    "user": "tscrim"
}
```

Replying to [comment:10 hivert]:
> Replying to [comment:8 tscrim]:
> > Ah, right. Actually, we are overthinking this:
> > {{{
> > sage: S.retract(e) in S
> > True
> > }}}
> This is a much better tests. Actually the `in S` is not needed. Retract breaks:
> {{{
> ValueError: B[map: ...] is not in the image
> }}}
> I left it anyway.

Thank you. Like I said, ideally the test would just be `e in S`, but that is a separate issue.

> And fixed a typo elsewhere by the way.

LGTM modulo `TESTS::` -> `TESTS:` since you have plain-text after it. Addendum: also capitalize Pierce in the `TESTS:` block. Once fixed, you can set a positive review on my behalf.



---

archive/issue_comments_342965.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-08T13:59:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24450#issuecomment-342965",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_342966.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-02-08T19:03:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24450#issuecomment-342966",
    "user": "hivert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_342967.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2018-02-08T19:07:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24450#issuecomment-342967",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_342968.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2018-02-08T19:07:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24450#issuecomment-342968",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_342969.json:
```json
{
    "body": "Thank you.",
    "created_at": "2018-02-08T20:03:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24450#issuecomment-342969",
    "user": "tscrim"
}
```

Thank you.



---

archive/issue_comments_342970.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-02-08T20:03:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24450#issuecomment-342970",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_342971.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-02-11T13:04:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24450",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24450#issuecomment-342971",
    "user": "vbraun"
}
```

Resolution: fixed
