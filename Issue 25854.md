# Issue 25854: py3: hash for projective space

Issue created by migration from https://trac.sagemath.org/ticket/26091

Original creator: chapoton

Original creation time: 2018-08-19 07:07:55

CC:  tmonteil tscrim

part of #24551


---

Comment by chapoton created at 2018-08-19 07:08:24

Changing status from new to needs_review.


---

Comment by chapoton created at 2018-08-19 07:08:24

New commits:


---

Comment by git created at 2018-08-19 09:42:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2018-08-19 09:44:53

`@`tmonteil, could you please help me fix the 32 bits hash, by running the following doctest with this branch on your 32 bit machine and reporting the result ?

```
            sage: P.<x,y> = ProjectiveSpace(Zmod(10), 1)
            sage: hash(P([2, 5]))
            -479010389                     # 32-bit
```



---

Comment by tmonteil created at 2018-08-19 11:17:03

I stopped my patchbot and restarted it on this ticket, see https://patchbot.sagemath.org/log/Pending/26091/debian/9.4/i686/4.9.0-6-686/tmonteil-debian-stretch-32/2018-08-19%2011:15:44


---

Comment by tmonteil created at 2018-08-19 15:00:38

And the result is:


```
sage -t --long src/sage/schemes/projective/projective_point.py
**********************************************************************
File "src/sage/schemes/projective/projective_point.py", line 402, in sage.schemes.projective.projective_point.SchemeMorphism_point_projective_ring.__hash__
Failed example:
    hash(P([2, 5]))
Expected:
    -479010389                     
Got:
    -2047536788
**********************************************************************
```



---

Comment by git created at 2018-08-19 15:24:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2018-08-19 15:24:44

Merci beaucoup !


---

Comment by tscrim created at 2018-08-20 00:49:06

Note that #23807 plans to solve this in a different way by making projective space use `UniqueRepresentation`.


---

Comment by saraedum created at 2018-08-22 02:21:02

Would you mind replacing the `sage: hash(P([2, 5]))` with `sage: hash(P([2, 5])) == hash(P([2, 5]))`? I find these 32/64 bit tests really annoying because you cannot update these easily.


---

Comment by saraedum created at 2018-08-22 02:22:55

If you changed that, it would be a positive review from me. But I haven't looked at #23807, so I leave it to you to figure out whether that one should go in instead.


---

Comment by tscrim created at 2018-08-22 03:35:29

I expect this to be done and merged before #23807.


---

Comment by git created at 2018-08-22 06:05:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2018-08-22 06:06:46

done (note that this is a case where the hash does not depend on the point..)


---

Comment by chapoton created at 2018-08-26 15:15:39

Everything seems to be ok. Positive review, somebody ?


---

Comment by chapoton created at 2018-08-29 18:33:21

review, please


---

Comment by chapoton created at 2018-09-07 12:20:08

should we wait for #23807 ?


---

Comment by tscrim created at 2018-09-07 23:09:06

No, let's just get this in and rebase #23807 on this.


---

Comment by tscrim created at 2018-09-07 23:09:06

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-09-09 07:38:40

Resolution: fixed


---

Comment by embray created at 2018-09-12 14:17:07

Ah, I just noticed this one.  Thanks.  I was just starting to fix this myself but then I remembered to check first (actually I had already added a hash for this class a while ago, but only as a quick hack--never got around to documenting it or anything, so this is better).
