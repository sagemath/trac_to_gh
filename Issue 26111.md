# Issue 26111: 3 other internet doctests failing in findstat.py

Issue created by migration from https://trac.sagemath.org/ticket/26348

Original creator: slabbe

Original creation time: 2018-09-26 05:16:06


```
sage -tp --long --optional=sage,optional,external src/sage/databases/findstat.py
```




```
sage -t --long src/sage/databases/findstat.py
**********************************************************************
File "src/sage/databases/findstat.py", line 106, in sage.databases.findstat
Failed example:
    r = findstat(Permutations, lambda pi: pi.saliances()[0]); r           # optional -- internet, random

    (St000051: The size of the left subtree. , [Mp00069: complement, Mp00061: to increasing tree], 24)
Exception raised:
    Traceback (most recent call last):
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 659, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1068, in compile_and_execute
        compiled = compiler(example)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 635, in compiler
        compileflags, 1)
      File "<doctest sage.databases.findstat[7]>", line 3
        (St000051: The size of the left subtree. , [Mp00069: complement, Mp00061: to increasing tree], Integer(24))
                 ^
    SyntaxError: invalid syntax
**********************************************************************
File "src/sage/databases/findstat.py", line 110, in sage.databases.findstat
Failed example:
    (s, list_f, quality) = next((a,b,c) for a,b,c in r if a.id() == 51)   # optional -- internet
Exception raised:
    Traceback (most recent call last):
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 659, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1070, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.databases.findstat[8]>", line 1, in <module>
        (s, list_f, quality) = next((a,b,c) for a,b,c in r if a.id() == Integer(51))   # optional -- internet
    StopIteration
**********************************************************************
File "src/sage/databases/findstat.py", line 130, in sage.databases.findstat
Failed example:
    print(list_f[0].code() + "\r\n" + list_f[1].code())                   # optional -- internet, random
Exception raised:
    Traceback (most recent call last):
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 659, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1070, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.databases.findstat[12]>", line 1, in <module>
        print(list_f[Integer(0)].code() + "\r\n" + list_f[Integer(1)].code())                   # optional -- internet, random
    IndexError: list index out of range
**********************************************************************
1 item had failures:
   3 of  16 in sage.databases.findstat
    7 webbrowser tests not run
    [247 tests, 3 failures, 72.88 s]
```



---

Comment by mantepse created at 2018-09-26 07:28:26

The first one seems to indicate that the meaning of "..." has changed: it fails because the next line is interpreted as part of the doctest instead of part of the output.

The other failures are a consequence of the first.


---

Comment by mantepse created at 2018-09-27 08:22:10

Changing status from new to needs_review.


---

Comment by mantepse created at 2018-09-27 08:22:10

New commits:


---

Comment by chapoton created at 2018-09-30 12:59:04

We should rather keep the #random, so that we do not have to change the doctests every week or so.


---

Comment by slabbe created at 2018-10-08 18:49:46

Changing status from needs_review to positive_review.


---

Comment by slabbe created at 2018-10-08 18:49:46

I suggest we update doctests and/or readd `# random` tag later in another ticket if needed. Positive review.


---

Comment by slabbe created at 2018-10-08 18:53:34

Changing status from positive_review to needs_work.


---

Comment by slabbe created at 2018-10-08 18:53:34

oups, the plugins "doctest continuation" seems unhappy. And sometimes `pyflakes` too.


---

Comment by chapoton created at 2018-10-08 19:04:54

pyflakes (when run using python3) warns about an exception class called StandardError that has been removed in Python 3


---

Comment by mantepse created at 2018-10-08 20:03:43

Replying to [comment:7 slabbe]:
> oups, the plugins "doctest continuation" seems unhappy. And sometimes `pyflakes` too.

I do not understand this.  It is complaining about the doctest which I just changed:

```
    sage: r = findstat(Permutations, lambda pi: pi.saliances()[0]); r           # optional -- internet
    0: ...
    ... (St000051: The size of the left subtree of a binary tree., [Mp00069: complement, Mp00061: to increasing tree], 1000)
    ...
    sage: (s, list_f, quality) = next((a,b,c) for a,b,c in r if a.id() == 51)   # optional -- internet
```

I can't see what's wrong with it - any ideas?

Concerning `StandardError`, it seems that this should be replaced with `Exception`.


---

Comment by chapoton created at 2018-10-09 06:22:49

The plugin is not smart. If you think it's ok, just go on.


---

Comment by mantepse created at 2018-10-09 06:40:25

Can I use or look at the plugin without setting up a patchbot?


---

Comment by chapoton created at 2018-10-09 07:01:53

The code is here: https://github.com/sagemath/sage-patchbot

Patchbot is not so easy to use. Some instructions for usage inside an ipython session are here at the bottom: https://wiki.sagemath.org/patchbot


---

Comment by git created at 2018-10-09 07:49:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mantepse created at 2018-10-09 07:56:08

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2018-10-12 13:24:32

ok, even if I would have prefered to keep "# random"


---

Comment by chapoton created at 2018-10-12 13:24:32

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-10-20 11:58:48

Resolution: fixed


---

Comment by embray created at 2018-10-28 14:52:23

This should be re-targeted for 8.5.
