# Issue 24792: local_square in a number field

Issue created by migration from Trac.

Original creator: annahaensch

Original creation time: 2018-03-23 13:41:22

function returns `true` if _a_ is a local square in the completion of a number field at a prime.  This function uses quadratic_defect and therefore this ticket is dependent on ticket #25023.


---

Comment by sbrandhorst created at 2018-05-10 20:53:53

I would suggest to make it a method of an element of the number field
Suggestions:
- `is_square_in_completion`
- `is_local_square`


---

Comment by sbrandhorst created at 2018-06-01 11:34:33

I settled for `is_padic_square` as that exists already for QQ. 
one might think about giving it the alias `is_square_in_completion` to make it more visible?
----
New commits:


---

Comment by git created at 2018-06-01 11:45:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by sbrandhorst created at 2018-06-01 11:45:48

Changing status from new to needs_review.


---

Comment by dimpase created at 2018-06-20 21:11:18

I saw the author's cry on twitter, of all things...


---

Comment by dimpase created at 2018-06-20 21:13:43

What's going on in the branch, I wonder. It does remove sage/rings/rational_field.py, doesn't it?


---

Comment by annahaensch created at 2018-06-20 21:25:34

Replying to [comment:7 dimpase]:
> I saw the author's cry on twitter, of all things...


Shouting into the void! Sometimes it works!


---

Comment by dimpase created at 2018-06-20 21:33:07

Is there any reason you cannot do the review between the two authors, it's completely kosher in most cases (unless it's something really major etc), you know?

I'd gladly review the technical part, but the maths behind it is far from my immediate areas.


---

Comment by annahaensch created at 2018-06-20 21:36:01

Replying to [comment:10 dimpase]:
> Is there any reason you cannot do the review between the two authors, it's completely kosher in most cases (unless it's something really major etc), you know?
> 
> I'd gladly review the technical part, but the maths behind it is far from my immediate areas.

Is that so?  If that's the case, I can easily do the review myself.  I'm in the process of fixing that glaring problem you point out above.  But if you think it's ok to review between the two of us, then you can step down.


---

Comment by dimpase created at 2018-06-20 21:43:56

The "glaring problem" is actually a bug of trac (in the way it interacts
with the git server), see
https://github.com/sagemath/sagetrac-mirror/blob/u/sbrandhorst/local_square_in_a_number_field/src/sage/rings/rational_field.py

-the file is not deleted, it's alive and well.


---

Comment by annahaensch created at 2018-06-20 21:53:22

Replying to [comment:12 dimpase]:
> The "glaring problem" is actually a bug of trac (in the way it interacts
> with the git server), see
> https://github.com/sagemath/sagetrac-mirror/blob/u/sbrandhorst/local_square_in_a_number_field/src/sage/rings/rational_field.py
> 
> -the file is not deleted, it's alive and well.

I had wondered how that slipped through.  Strange.


---

Comment by dimpase created at 2018-06-20 22:03:47

Replying to [comment:13 annahaensch]:
> Replying to [comment:12 dimpase]:
> > The "glaring problem" is actually a bug of trac (in the way it interacts
> > with the git server), see
> > https://github.com/sagemath/sagetrac-mirror/blob/u/sbrandhorst/local_square_in_a_number_field/src/sage/rings/rational_field.py
> > 
> > -the file is not deleted, it's alive and well.
> 
> I had wondered how that slipped through.  Strange. 

it's not the first time I see such things. Probably a long-standing trac bug.


---

Comment by dimpase created at 2018-06-20 22:09:16

anyhow, it's not something to worry about here. It only affects the branch display on this ticket, nothing else.


---

Comment by annahaensch created at 2018-06-20 22:11:34

Replying to [comment:15 dimpase]:
> anyhow, it's not something to worry about here. It only affects the branch display on this ticket, nothing else.

Thanks for the heads up on that.


---

Comment by annahaensch created at 2018-06-20 23:36:29

`@`sbrandhorst at the suggestion of dimpase I'm going to review this ticket. Some comments:

- Sorry, but I'm not sure I understand the utility of the check=true variable in the function, what is that doing?
- In the modifications you added to quadratic defect there is a `P` that should be a `p`. 
- I ran the doctests, all tests passed.


---

Comment by dimpase created at 2018-06-21 07:04:34

Replying to [comment:17 annahaensch]:
> `@`sbrandhorst at the suggestion of dimpase I'm going to review this ticket. Some comments:
> 
> - Sorry, but I'm not sure I understand the utility of the check=true variable in the function, what is that doing?

Assuming you talk about

```
if check and not p.is_prime():
```

this is to check that the input makes sense. Potentially, primality check is expensive,
and so for performance reasons one might want to avoid it.


---

Comment by sbrandhorst created at 2018-06-21 07:24:54

Replying to [comment:18 dimpase]:
> Replying to [comment:17 annahaensch]:
> > `@`sbrandhorst at the suggestion of dimpase I'm going to review this ticket. Some comments:
> > 
> > - Sorry, but I'm not sure I understand the utility of the check=true variable in the function, what is that doing?
> 
> Assuming you talk about
> {{{
> if check and not p.is_prime():
> }}}
> this is to check that the input makes sense. Potentially, primality check is expensive,
> and so for performance reasons one might want to avoid it.
> 
> 
Yep. I am mostly working with small primes. But who know's what other people might do with this?


---

Comment by git created at 2018-06-21 07:41:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by annahaensch created at 2018-06-21 10:56:19

Great, that makes sense. 

Another small thing, depending on the types of fields I construct I'm getting errors of the type 

```
AttributeError: 'sage.rings.number_field.number_field_element_quadratic.NumberFieldElement_quadratic' 
object has no attribute 'is_padic_square'
```


or 


```
AttributeError: 'sage.rings.number_field.number_field_element.NumberFieldElement_absolute' 
object has no attribute 'is_padic_square'
```


does this mean the function just needs to be added onto some call list?


---

Comment by sbrandhorst created at 2018-06-21 13:13:55

I cannot reproduce this 


```
sage: k.<a> = NumberField(x^3+2)
sage: a.is_padic_square(k.primes_above(2)[0])
False
sage: type(a)
<type 'sage.rings.number_field.number_field_element.NumberFieldElement_absolute'>
sage: k.<a> = NumberField(x^2+2)
sage: a.is_padic_square(k.primes_above(2)[0])
False
sage: type(a)
<type 'sage.rings.number_field.number_field_element_quadratic.NumberFieldElement_quadratic'>
```

Are you on the right branch? :-)


---

Comment by annahaensch created at 2018-06-21 14:29:50

Replying to [comment:22 sbrandhorst]:
> I cannot reproduce this 
> 
> {{{
> sage: k.<a> = NumberField(x^3+2)
> sage: a.is_padic_square(k.primes_above(2)[0])
> False
> sage: type(a)
> <type 'sage.rings.number_field.number_field_element.NumberFieldElement_absolute'>
> sage: k.<a> = NumberField(x^2+2)
> sage: a.is_padic_square(k.primes_above(2)[0])
> False
> sage: type(a)
> <type 'sage.rings.number_field.number_field_element_quadratic.NumberFieldElement_quadratic'>
> }}}
> Are you on the right branch? :-)

Oh geez, I am, but I forgot to build Sage.  It's the jet-lag talking :/

I think this code looks good and I'm ready to give it a positive review.


---

Comment by annahaensch created at 2018-06-21 14:30:04

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-06-21 17:35:00

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2018-06-21 17:35:00

Please fill in the reviewer name


---

Comment by annahaensch created at 2018-06-22 13:45:39

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2018-06-23 19:58:53

Resolution: fixed
