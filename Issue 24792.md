# Issue 24792: local_square in a number field

archive/issues_024792.json:
```json
{
    "body": "function returns `true` if *a* is a local square in the completion of a number field at a prime.  This function uses quadratic_defect and therefore this ticket is dependent on ticket #25023.\n\nIssue created by migration from https://trac.sagemath.org/ticket/25029\n\n",
    "created_at": "2018-03-23T13:41:22Z",
    "labels": [
        "number fields",
        "major",
        "enhancement"
    ],
    "title": "local_square in a number field",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24792",
    "user": "annahaensch"
}
```
function returns `true` if *a* is a local square in the completion of a number field at a prime.  This function uses quadratic_defect and therefore this ticket is dependent on ticket #25023.

Issue created by migration from https://trac.sagemath.org/ticket/25029





---

archive/issue_comments_348113.json:
```json
{
    "body": "I would suggest to make it a method of an element of the number field\nSuggestions:\n- `is_square_in_completion`\n- `is_local_square`",
    "created_at": "2018-05-10T20:53:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24792#issuecomment-348113",
    "user": "sbrandhorst"
}
```

I would suggest to make it a method of an element of the number field
Suggestions:
- `is_square_in_completion`
- `is_local_square`



---

archive/issue_comments_348114.json:
```json
{
    "body": "I settled for `is_padic_square` as that exists already for QQ. \none might think about giving it the alias `is_square_in_completion` to make it more visible?\n----\nNew commits:",
    "created_at": "2018-06-01T11:34:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24792#issuecomment-348114",
    "user": "sbrandhorst"
}
```

I settled for `is_padic_square` as that exists already for QQ. 
one might think about giving it the alias `is_square_in_completion` to make it more visible?
----
New commits:



---

archive/issue_comments_348115.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-01T11:45:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24792#issuecomment-348115",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_348116.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-06-01T11:45:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24792#issuecomment-348116",
    "user": "sbrandhorst"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_348117.json:
```json
{
    "body": "I saw the author's cry on twitter, of all things...",
    "created_at": "2018-06-20T21:11:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24792#issuecomment-348117",
    "user": "dimpase"
}
```

I saw the author's cry on twitter, of all things...



---

archive/issue_comments_348118.json:
```json
{
    "body": "What's going on in the branch, I wonder. It does remove sage/rings/rational_field.py, doesn't it?",
    "created_at": "2018-06-20T21:13:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24792#issuecomment-348118",
    "user": "dimpase"
}
```

What's going on in the branch, I wonder. It does remove sage/rings/rational_field.py, doesn't it?



---

archive/issue_comments_348119.json:
```json
{
    "body": "Replying to [comment:7 dimpase]:\n> I saw the author's cry on twitter, of all things...\n\n\nShouting into the void! Sometimes it works!",
    "created_at": "2018-06-20T21:25:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24792#issuecomment-348119",
    "user": "annahaensch"
}
```

Replying to [comment:7 dimpase]:
> I saw the author's cry on twitter, of all things...


Shouting into the void! Sometimes it works!



---

archive/issue_comments_348120.json:
```json
{
    "body": "Is there any reason you cannot do the review between the two authors, it's completely kosher in most cases (unless it's something really major etc), you know?\n\nI'd gladly review the technical part, but the maths behind it is far from my immediate areas.",
    "created_at": "2018-06-20T21:33:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24792#issuecomment-348120",
    "user": "dimpase"
}
```

Is there any reason you cannot do the review between the two authors, it's completely kosher in most cases (unless it's something really major etc), you know?

I'd gladly review the technical part, but the maths behind it is far from my immediate areas.



---

archive/issue_comments_348121.json:
```json
{
    "body": "Replying to [comment:10 dimpase]:\n> Is there any reason you cannot do the review between the two authors, it's completely kosher in most cases (unless it's something really major etc), you know?\n> \n> I'd gladly review the technical part, but the maths behind it is far from my immediate areas.\n\nIs that so?  If that's the case, I can easily do the review myself.  I'm in the process of fixing that glaring problem you point out above.  But if you think it's ok to review between the two of us, then you can step down.",
    "created_at": "2018-06-20T21:36:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24792#issuecomment-348121",
    "user": "annahaensch"
}
```

Replying to [comment:10 dimpase]:
> Is there any reason you cannot do the review between the two authors, it's completely kosher in most cases (unless it's something really major etc), you know?
> 
> I'd gladly review the technical part, but the maths behind it is far from my immediate areas.

Is that so?  If that's the case, I can easily do the review myself.  I'm in the process of fixing that glaring problem you point out above.  But if you think it's ok to review between the two of us, then you can step down.



---

archive/issue_comments_348122.json:
```json
{
    "body": "The \"glaring problem\" is actually a bug of trac (in the way it interacts\nwith the git server), see\nhttps://github.com/sagemath/sagetrac-mirror/blob/u/sbrandhorst/local_square_in_a_number_field/src/sage/rings/rational_field.py\n\n-the file is not deleted, it's alive and well.",
    "created_at": "2018-06-20T21:43:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24792#issuecomment-348122",
    "user": "dimpase"
}
```

The "glaring problem" is actually a bug of trac (in the way it interacts
with the git server), see
https://github.com/sagemath/sagetrac-mirror/blob/u/sbrandhorst/local_square_in_a_number_field/src/sage/rings/rational_field.py

-the file is not deleted, it's alive and well.



---

archive/issue_comments_348123.json:
```json
{
    "body": "Replying to [comment:12 dimpase]:\n> The \"glaring problem\" is actually a bug of trac (in the way it interacts\n> with the git server), see\n> https://github.com/sagemath/sagetrac-mirror/blob/u/sbrandhorst/local_square_in_a_number_field/src/sage/rings/rational_field.py\n> \n> -the file is not deleted, it's alive and well.\n\nI had wondered how that slipped through.  Strange.",
    "created_at": "2018-06-20T21:53:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24792#issuecomment-348123",
    "user": "annahaensch"
}
```

Replying to [comment:12 dimpase]:
> The "glaring problem" is actually a bug of trac (in the way it interacts
> with the git server), see
> https://github.com/sagemath/sagetrac-mirror/blob/u/sbrandhorst/local_square_in_a_number_field/src/sage/rings/rational_field.py
> 
> -the file is not deleted, it's alive and well.

I had wondered how that slipped through.  Strange.



---

archive/issue_comments_348124.json:
```json
{
    "body": "Replying to [comment:13 annahaensch]:\n> Replying to [comment:12 dimpase]:\n> > The \"glaring problem\" is actually a bug of trac (in the way it interacts\n> > with the git server), see\n> > https://github.com/sagemath/sagetrac-mirror/blob/u/sbrandhorst/local_square_in_a_number_field/src/sage/rings/rational_field.py\n> > \n> > -the file is not deleted, it's alive and well.\n> \n> I had wondered how that slipped through.  Strange. \n\nit's not the first time I see such things. Probably a long-standing trac bug.",
    "created_at": "2018-06-20T22:03:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24792#issuecomment-348124",
    "user": "dimpase"
}
```

Replying to [comment:13 annahaensch]:
> Replying to [comment:12 dimpase]:
> > The "glaring problem" is actually a bug of trac (in the way it interacts
> > with the git server), see
> > https://github.com/sagemath/sagetrac-mirror/blob/u/sbrandhorst/local_square_in_a_number_field/src/sage/rings/rational_field.py
> > 
> > -the file is not deleted, it's alive and well.
> 
> I had wondered how that slipped through.  Strange. 

it's not the first time I see such things. Probably a long-standing trac bug.



---

archive/issue_comments_348125.json:
```json
{
    "body": "anyhow, it's not something to worry about here. It only affects the branch display on this ticket, nothing else.",
    "created_at": "2018-06-20T22:09:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24792#issuecomment-348125",
    "user": "dimpase"
}
```

anyhow, it's not something to worry about here. It only affects the branch display on this ticket, nothing else.



---

archive/issue_comments_348126.json:
```json
{
    "body": "Replying to [comment:15 dimpase]:\n> anyhow, it's not something to worry about here. It only affects the branch display on this ticket, nothing else.\n\nThanks for the heads up on that.",
    "created_at": "2018-06-20T22:11:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24792#issuecomment-348126",
    "user": "annahaensch"
}
```

Replying to [comment:15 dimpase]:
> anyhow, it's not something to worry about here. It only affects the branch display on this ticket, nothing else.

Thanks for the heads up on that.



---

archive/issue_comments_348127.json:
```json
{
    "body": "`@`sbrandhorst at the suggestion of dimpase I'm going to review this ticket. Some comments:\n\n- Sorry, but I'm not sure I understand the utility of the check=true variable in the function, what is that doing?\n- In the modifications you added to quadratic defect there is a `P` that should be a `p`. \n- I ran the doctests, all tests passed.",
    "created_at": "2018-06-20T23:36:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24792#issuecomment-348127",
    "user": "annahaensch"
}
```

`@`sbrandhorst at the suggestion of dimpase I'm going to review this ticket. Some comments:

- Sorry, but I'm not sure I understand the utility of the check=true variable in the function, what is that doing?
- In the modifications you added to quadratic defect there is a `P` that should be a `p`. 
- I ran the doctests, all tests passed.



---

archive/issue_comments_348128.json:
```json
{
    "body": "Replying to [comment:17 annahaensch]:\n> `@`sbrandhorst at the suggestion of dimpase I'm going to review this ticket. Some comments:\n> \n> - Sorry, but I'm not sure I understand the utility of the check=true variable in the function, what is that doing?\n\nAssuming you talk about\n\n```\nif check and not p.is_prime():\n```\n\nthis is to check that the input makes sense. Potentially, primality check is expensive,\nand so for performance reasons one might want to avoid it.",
    "created_at": "2018-06-21T07:04:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24792#issuecomment-348128",
    "user": "dimpase"
}
```

Replying to [comment:17 annahaensch]:
> `@`sbrandhorst at the suggestion of dimpase I'm going to review this ticket. Some comments:
> 
> - Sorry, but I'm not sure I understand the utility of the check=true variable in the function, what is that doing?

Assuming you talk about

```
if check and not p.is_prime():
```

this is to check that the input makes sense. Potentially, primality check is expensive,
and so for performance reasons one might want to avoid it.



---

archive/issue_comments_348129.json:
```json
{
    "body": "Replying to [comment:18 dimpase]:\n> Replying to [comment:17 annahaensch]:\n> > `@`sbrandhorst at the suggestion of dimpase I'm going to review this ticket. Some comments:\n> > \n> > - Sorry, but I'm not sure I understand the utility of the check=true variable in the function, what is that doing?\n> \n> Assuming you talk about\n> {{{\n> if check and not p.is_prime():\n> }}}\n> this is to check that the input makes sense. Potentially, primality check is expensive,\n> and so for performance reasons one might want to avoid it.\n> \n> \nYep. I am mostly working with small primes. But who know's what other people might do with this?",
    "created_at": "2018-06-21T07:24:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24792#issuecomment-348129",
    "user": "sbrandhorst"
}
```

Replying to [comment:18 dimpase]:
> Replying to [comment:17 annahaensch]:
> > `@`sbrandhorst at the suggestion of dimpase I'm going to review this ticket. Some comments:
> > 
> > - Sorry, but I'm not sure I understand the utility of the check=true variable in the function, what is that doing?
> 
> Assuming you talk about
> {{{
> if check and not p.is_prime():
> }}}
> this is to check that the input makes sense. Potentially, primality check is expensive,
> and so for performance reasons one might want to avoid it.
> 
> 
Yep. I am mostly working with small primes. But who know's what other people might do with this?



---

archive/issue_comments_348130.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-21T07:41:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24792#issuecomment-348130",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_348131.json:
```json
{
    "body": "Great, that makes sense. \n\nAnother small thing, depending on the types of fields I construct I'm getting errors of the type \n\n```\nAttributeError: 'sage.rings.number_field.number_field_element_quadratic.NumberFieldElement_quadratic' \nobject has no attribute 'is_padic_square'\n```\n\n\nor \n\n\n```\nAttributeError: 'sage.rings.number_field.number_field_element.NumberFieldElement_absolute' \nobject has no attribute 'is_padic_square'\n```\n\n\ndoes this mean the function just needs to be added onto some call list?",
    "created_at": "2018-06-21T10:56:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24792#issuecomment-348131",
    "user": "annahaensch"
}
```

Great, that makes sense. 

Another small thing, depending on the types of fields I construct I'm getting errors of the type 

```
AttributeError: 'sage.rings.number_field.number_field_element_quadratic.NumberFieldElement_quadratic' 
object has no attribute 'is_padic_square'
```


or 


```
AttributeError: 'sage.rings.number_field.number_field_element.NumberFieldElement_absolute' 
object has no attribute 'is_padic_square'
```


does this mean the function just needs to be added onto some call list?



---

archive/issue_comments_348132.json:
```json
{
    "body": "I cannot reproduce this \n\n\n```\nsage: k.<a> = NumberField(x^3+2)\nsage: a.is_padic_square(k.primes_above(2)[0])\nFalse\nsage: type(a)\n<type 'sage.rings.number_field.number_field_element.NumberFieldElement_absolute'>\nsage: k.<a> = NumberField(x^2+2)\nsage: a.is_padic_square(k.primes_above(2)[0])\nFalse\nsage: type(a)\n<type 'sage.rings.number_field.number_field_element_quadratic.NumberFieldElement_quadratic'>\n```\n\nAre you on the right branch? :-)",
    "created_at": "2018-06-21T13:13:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24792#issuecomment-348132",
    "user": "sbrandhorst"
}
```

I cannot reproduce this 


```
sage: k.<a> = NumberField(x^3+2)
sage: a.is_padic_square(k.primes_above(2)[0])
False
sage: type(a)
<type 'sage.rings.number_field.number_field_element.NumberFieldElement_absolute'>
sage: k.<a> = NumberField(x^2+2)
sage: a.is_padic_square(k.primes_above(2)[0])
False
sage: type(a)
<type 'sage.rings.number_field.number_field_element_quadratic.NumberFieldElement_quadratic'>
```

Are you on the right branch? :-)



---

archive/issue_comments_348133.json:
```json
{
    "body": "Replying to [comment:22 sbrandhorst]:\n> I cannot reproduce this \n> \n> {{{\n> sage: k.<a> = NumberField(x^3+2)\n> sage: a.is_padic_square(k.primes_above(2)[0])\n> False\n> sage: type(a)\n> <type 'sage.rings.number_field.number_field_element.NumberFieldElement_absolute'>\n> sage: k.<a> = NumberField(x^2+2)\n> sage: a.is_padic_square(k.primes_above(2)[0])\n> False\n> sage: type(a)\n> <type 'sage.rings.number_field.number_field_element_quadratic.NumberFieldElement_quadratic'>\n> }}}\n> Are you on the right branch? :-)\n\nOh geez, I am, but I forgot to build Sage.  It's the jet-lag talking :/\n\nI think this code looks good and I'm ready to give it a positive review.",
    "created_at": "2018-06-21T14:29:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24792#issuecomment-348133",
    "user": "annahaensch"
}
```

Replying to [comment:22 sbrandhorst]:
> I cannot reproduce this 
> 
> {{{
> sage: k.<a> = NumberField(x^3+2)
> sage: a.is_padic_square(k.primes_above(2)[0])
> False
> sage: type(a)
> <type 'sage.rings.number_field.number_field_element.NumberFieldElement_absolute'>
> sage: k.<a> = NumberField(x^2+2)
> sage: a.is_padic_square(k.primes_above(2)[0])
> False
> sage: type(a)
> <type 'sage.rings.number_field.number_field_element_quadratic.NumberFieldElement_quadratic'>
> }}}
> Are you on the right branch? :-)

Oh geez, I am, but I forgot to build Sage.  It's the jet-lag talking :/

I think this code looks good and I'm ready to give it a positive review.



---

archive/issue_comments_348134.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-06-21T14:30:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24792#issuecomment-348134",
    "user": "annahaensch"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_348135.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-06-21T17:35:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24792#issuecomment-348135",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_348136.json:
```json
{
    "body": "Please fill in the reviewer name",
    "created_at": "2018-06-21T17:35:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24792#issuecomment-348136",
    "user": "vbraun"
}
```

Please fill in the reviewer name



---

archive/issue_comments_348137.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2018-06-22T13:45:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24792#issuecomment-348137",
    "user": "annahaensch"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_348138.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-06-23T19:58:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24792#issuecomment-348138",
    "user": "vbraun"
}
```

Resolution: fixed
