# Issue 33642: Run pytest on github workflow for pytest related tickets

archive/issues_033642.json:
```json
{
    "body": "CC:  dimpase mkoeppe\n\nWe run pytest for doctests in the build & test github workflow for branches that contain \"pytest\" to make testing of these tickets easier.\n\nIssue created by migration from https://trac.sagemath.org/ticket/33879\n\n",
    "created_at": "2022-05-21T13:42:50Z",
    "labels": [
        "build",
        "major",
        "enhancement"
    ],
    "title": "Run pytest on github workflow for pytest related tickets",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33642",
    "user": "@tobiasdiez"
}
```
CC:  dimpase mkoeppe

We run pytest for doctests in the build & test github workflow for branches that contain "pytest" to make testing of these tickets easier.

Issue created by migration from https://trac.sagemath.org/ticket/33879





---

archive/issue_comments_478962.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-05-21T13:43:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33642#issuecomment-478962",
    "user": "@tobiasdiez"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_478963.json:
```json
{
    "body": "At the end of the output of this step, the lines of the summary are unhelpfully truncated. \n\n```\n=========================== short test summary info ============================\nERROR setup.py - SystemExit: usage: __main__.py [global_opts] cmd1 [cmd1_opts...\nERROR sage/all.py - AssertionError: finish_startup() must be called exactly once\nERROR sage/all.py - RuntimeError: the user-space globals dictionary has not b...\nERROR sage/all_cmdline.py - RuntimeError: the user-space globals dictionary h...\nERROR sage/all_cmdline.py - RuntimeError: the user-space globals dictionary h...\n```\n\nCan this be fixed by setting the terminal line length?",
    "created_at": "2022-05-21T18:22:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33642#issuecomment-478963",
    "user": "mkoeppe"
}
```

At the end of the output of this step, the lines of the summary are unhelpfully truncated. 

```
=========================== short test summary info ============================
ERROR setup.py - SystemExit: usage: __main__.py [global_opts] cmd1 [cmd1_opts...
ERROR sage/all.py - AssertionError: finish_startup() must be called exactly once
ERROR sage/all.py - RuntimeError: the user-space globals dictionary has not b...
ERROR sage/all_cmdline.py - RuntimeError: the user-space globals dictionary h...
ERROR sage/all_cmdline.py - RuntimeError: the user-space globals dictionary h...
```

Can this be fixed by setting the terminal line length?



---

archive/issue_comments_478964.json:
```json
{
    "body": "The \"short summary\" is only meant to quickly see what files have failing tests, the full error messages are collected under the \"Errors\" section that is printed before. \n\nNote that in contrast to sages reporter, pytest doesn't print the errors directly when the tests are executed but collects them and only prints them at the end. See https://docs.pytest.org/en/latest/getting-started.html#create-your-first-test for an example.",
    "created_at": "2022-05-22T13:19:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33642#issuecomment-478964",
    "user": "@tobiasdiez"
}
```

The "short summary" is only meant to quickly see what files have failing tests, the full error messages are collected under the "Errors" section that is printed before. 

Note that in contrast to sages reporter, pytest doesn't print the errors directly when the tests are executed but collects them and only prints them at the end. See https://docs.pytest.org/en/latest/getting-started.html#create-your-first-test for an example.



---

archive/issue_comments_478965.json:
```json
{
    "body": "Replying to [comment:3 gh-tobiasdiez]:\n> The \"short summary\" is only meant to quickly see what files have failing tests, the full error messages are collected under the \"Errors\" section that is printed before. \n\nI understand that, but it does try to show the error, not just the file name. In a terminal, it would be truncated to fit in the terminal -- which often is larger than 80 characters and then gives more useful information. In the GH Actions log, it truncates at exactly 80 characters. Which is why I am asking for that to be improved. For example by setting the environment variable `COLUMNS`",
    "created_at": "2022-05-24T18:49:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33642#issuecomment-478965",
    "user": "mkoeppe"
}
```

Replying to [comment:3 gh-tobiasdiez]:
> The "short summary" is only meant to quickly see what files have failing tests, the full error messages are collected under the "Errors" section that is printed before. 

I understand that, but it does try to show the error, not just the file name. In a terminal, it would be truncated to fit in the terminal -- which often is larger than 80 characters and then gives more useful information. In the GH Actions log, it truncates at exactly 80 characters. Which is why I am asking for that to be improved. For example by setting the environment variable `COLUMNS`



---

archive/issue_comments_478966.json:
```json
{
    "body": "I can do this, but 80 seems to do a fine job at showing the file name with a bit of error context. If you increase it (too much?) then on small screens/split windows the line wraps destroying the nice overview.",
    "created_at": "2022-05-25T19:56:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33642#issuecomment-478966",
    "user": "@tobiasdiez"
}
```

I can do this, but 80 seems to do a fine job at showing the file name with a bit of error context. If you increase it (too much?) then on small screens/split windows the line wraps destroying the nice overview.



---

archive/issue_comments_478967.json:
```json
{
    "body": "If the window is too small, it is easy to address by making the window larger or the font smaller. And no other tool that prints logs during the test, or the build, or anything in the GH Actions workflow does this kind of truncation. So developers must already be flexible enough to make these adjustments to the window to get a good view on the results.",
    "created_at": "2022-05-25T20:04:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33642#issuecomment-478967",
    "user": "mkoeppe"
}
```

If the window is too small, it is easy to address by making the window larger or the font smaller. And no other tool that prints logs during the test, or the build, or anything in the GH Actions workflow does this kind of truncation. So developers must already be flexible enough to make these adjustments to the window to get a good view on the results.



---

archive/issue_comments_478968.json:
```json
{
    "body": "So which size are you then proposing?",
    "created_at": "2022-05-25T21:22:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33642#issuecomment-478968",
    "user": "@tobiasdiez"
}
```

So which size are you then proposing?



---

archive/issue_comments_478969.json:
```json
{
    "body": "How much does it actually print without truncation (COLUMNS=10000)?",
    "created_at": "2022-05-25T21:43:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33642#issuecomment-478969",
    "user": "mkoeppe"
}
```

How much does it actually print without truncation (COLUMNS=10000)?



---

archive/issue_comments_478970.json:
```json
{
    "body": "Maybe try COLUMNS=200",
    "created_at": "2022-05-25T21:43:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33642#issuecomment-478970",
    "user": "mkoeppe"
}
```

Maybe try COLUMNS=200



---

archive/issue_comments_478971.json:
```json
{
    "body": "Replying to [comment:9 mkoeppe]:\n> Maybe try COLUMNS=200\n\nI'm not sure what screen you use, but on my wide-screen laptop I get about 150 chars in the github log per line, so I would say something like 120 should be the max.",
    "created_at": "2022-05-25T21:58:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33642#issuecomment-478971",
    "user": "@tobiasdiez"
}
```

Replying to [comment:9 mkoeppe]:
> Maybe try COLUMNS=200

I'm not sure what screen you use, but on my wide-screen laptop I get about 150 chars in the github log per line, so I would say something like 120 should be the max.



---

archive/issue_comments_478972.json:
```json
{
    "body": "120 sounds OK",
    "created_at": "2022-05-25T22:18:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33642#issuecomment-478972",
    "user": "mkoeppe"
}
```

120 sounds OK



---

archive/issue_comments_478973.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-29T19:06:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33642#issuecomment-478973",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_478974.json:
```json
{
    "body": "Done.",
    "created_at": "2022-05-29T19:06:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33642#issuecomment-478974",
    "user": "@tobiasdiez"
}
```

Done.



---

archive/issue_comments_478975.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-05-29T22:09:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33642#issuecomment-478975",
    "user": "mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_478976.json:
```json
{
    "body": "Thanks, that's better.",
    "created_at": "2022-05-29T22:09:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33642#issuecomment-478976",
    "user": "mkoeppe"
}
```

Thanks, that's better.



---

archive/issue_comments_478977.json:
```json
{
    "body": "Thanks",
    "created_at": "2022-05-30T18:07:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33642#issuecomment-478977",
    "user": "@tobiasdiez"
}
```

Thanks



---

archive/issue_comments_478978.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-06-12T12:17:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33642",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33642#issuecomment-478978",
    "user": "vbraun"
}
```

Resolution: fixed
