# Issue 33642: Run pytest on github workflow for pytest related tickets

Issue created by migration from https://trac.sagemath.org/ticket/33879

Original creator: @tobiasdiez

Original creation time: 2022-05-21 13:42:50

CC:  dimpase mkoeppe

We run pytest for doctests in the build & test github workflow for branches that contain "pytest" to make testing of these tickets easier.


---

Comment by @tobiasdiez created at 2022-05-21 13:43:59

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2022-05-21 18:22:07

At the end of the output of this step, the lines of the summary are unhelpfully truncated. 

```
=========================== short test summary info ============================
ERROR setup.py - SystemExit: usage: __main__.py [global_opts] cmd1 [cmd1_opts...
ERROR sage/all.py - AssertionError: finish_startup() must be called exactly once
ERROR sage/all.py - RuntimeError: the user-space globals dictionary has not b...
ERROR sage/all_cmdline.py - RuntimeError: the user-space globals dictionary h...
ERROR sage/all_cmdline.py - RuntimeError: the user-space globals dictionary h...
```

Can this be fixed by setting the terminal line length?


---

Comment by @tobiasdiez created at 2022-05-22 13:19:57

The "short summary" is only meant to quickly see what files have failing tests, the full error messages are collected under the "Errors" section that is printed before. 

Note that in contrast to sages reporter, pytest doesn't print the errors directly when the tests are executed but collects them and only prints them at the end. See https://docs.pytest.org/en/latest/getting-started.html#create-your-first-test for an example.


---

Comment by mkoeppe created at 2022-05-24 18:49:29

Replying to [comment:3 gh-tobiasdiez]:
> The "short summary" is only meant to quickly see what files have failing tests, the full error messages are collected under the "Errors" section that is printed before. 

I understand that, but it does try to show the error, not just the file name. In a terminal, it would be truncated to fit in the terminal -- which often is larger than 80 characters and then gives more useful information. In the GH Actions log, it truncates at exactly 80 characters. Which is why I am asking for that to be improved. For example by setting the environment variable `COLUMNS`


---

Comment by @tobiasdiez created at 2022-05-25 19:56:10

I can do this, but 80 seems to do a fine job at showing the file name with a bit of error context. If you increase it (too much?) then on small screens/split windows the line wraps destroying the nice overview.


---

Comment by mkoeppe created at 2022-05-25 20:04:45

If the window is too small, it is easy to address by making the window larger or the font smaller. And no other tool that prints logs during the test, or the build, or anything in the GH Actions workflow does this kind of truncation. So developers must already be flexible enough to make these adjustments to the window to get a good view on the results.


---

Comment by @tobiasdiez created at 2022-05-25 21:22:17

So which size are you then proposing?


---

Comment by mkoeppe created at 2022-05-25 21:43:19

How much does it actually print without truncation (COLUMNS=10000)?


---

Comment by mkoeppe created at 2022-05-25 21:43:50

Maybe try COLUMNS=200


---

Comment by @tobiasdiez created at 2022-05-25 21:58:07

Replying to [comment:9 mkoeppe]:
> Maybe try COLUMNS=200

I'm not sure what screen you use, but on my wide-screen laptop I get about 150 chars in the github log per line, so I would say something like 120 should be the max.


---

Comment by mkoeppe created at 2022-05-25 22:18:48

120 sounds OK


---

Comment by git created at 2022-05-29 19:06:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @tobiasdiez created at 2022-05-29 19:06:20

Done.


---

Comment by mkoeppe created at 2022-05-29 22:09:27

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2022-05-29 22:09:27

Thanks, that's better.


---

Comment by @tobiasdiez created at 2022-05-30 18:07:29

Thanks


---

Comment by vbraun created at 2022-06-12 12:17:07

Resolution: fixed
