# Issue 32705: Introduce `display_latex` option that allows latex displays aligned left

archive/issues_032705.json:
```json
{
    "body": "CC:  egourgoulhon\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/32942\n\n",
    "created_at": "2021-11-27T13:05:46Z",
    "labels": [
        "notebook",
        "major",
        "enhancement"
    ],
    "title": "Introduce `display_latex` option that allows latex displays aligned left",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32705",
    "user": "klee"
}
```
CC:  egourgoulhon



Issue created by migration from https://trac.sagemath.org/ticket/32942





---

archive/issue_comments_466539.json:
```json
{
    "body": "New commits:",
    "created_at": "2021-11-27T13:24:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32705#issuecomment-466539",
    "user": "klee"
}
```

New commits:



---

archive/issue_comments_466540.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-11-27T13:28:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32705#issuecomment-466540",
    "user": "klee"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_466541.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-27T22:57:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32705#issuecomment-466541",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_466542.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-12-14T04:02:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32705#issuecomment-466542",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_466543.json:
```json
{
    "body": "Sorry for the delay in reviewing!\n\nA few comments:\n- the option name `display_latex` sounds a little too vague and also may - introduce some confusion with the magic `%display latex`. Wouldn't `align_latex` be a better name?\n- I've tested the new feature with Jupyterlab 3.3 (cf. #32069), it works well!\n- Regarding Jupyter (classic), LaTeX outputs are always left-aligned for me (on two distinct Ubuntu 20.04 computers), as discussed at ticket:32859#comment:16 and setting `dm.preferences.display_latex = 'center'` does not change this...\n- Shouldn't `'left'` be the default, instead of `'center'`? Left-align is the default for SymPy MathJax display in a pure Python 3 notebook and I see no reason to deviate from SymPy policy here.  It also better (more readable) for short outputs, like `0`.",
    "created_at": "2022-03-10T09:53:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32705#issuecomment-466543",
    "user": "egourgoulhon"
}
```

Sorry for the delay in reviewing!

A few comments:
- the option name `display_latex` sounds a little too vague and also may - introduce some confusion with the magic `%display latex`. Wouldn't `align_latex` be a better name?
- I've tested the new feature with Jupyterlab 3.3 (cf. #32069), it works well!
- Regarding Jupyter (classic), LaTeX outputs are always left-aligned for me (on two distinct Ubuntu 20.04 computers), as discussed at ticket:32859#comment:16 and setting `dm.preferences.display_latex = 'center'` does not change this...
- Shouldn't `'left'` be the default, instead of `'center'`? Left-align is the default for SymPy MathJax display in a pure Python 3 notebook and I see no reason to deviate from SymPy policy here.  It also better (more readable) for short outputs, like `0`.



---

archive/issue_comments_466544.json:
```json
{
    "body": "Replying to [comment:12 egourgoulhon]:\n> A few comments:\n> - the option name `display_latex` sounds a little too vague and also may - introduce some confusion with the magic `%display latex`. Wouldn't `align_latex` be a better name?\n\nI agree. \n\n> - Regarding Jupyter (classic), LaTeX outputs are always left-aligned for me (on two distinct Ubuntu 20.04 computers), as discussed at ticket:32859#comment:16 and setting `dm.preferences.display_latex = 'center'` does not change this...\n\n\"left\" alignment is forced in the classic notebook. It seems developers decided so. Hence `align_latex` is only for jupyterlab.\n\n> - Shouldn't `'left'` be the default, instead of `'center'`? Left-align is the default for SymPy MathJax display in a pure Python 3 notebook and I see no reason to deviate from SymPy policy here.  It also better (more readable) for short outputs, like `0`. \n\nI personally agree. But since \"center\" alignment has been de facto default in jupyterlab, and \"left\" alignment is expensive in that the additional code `\\displaystyle\" is inserted in every output cell, I am not sure if changing the default is a right thing... If you strongly insist, then I would follow. Do you?",
    "created_at": "2022-03-10T11:58:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32705#issuecomment-466544",
    "user": "klee"
}
```

Replying to [comment:12 egourgoulhon]:
> A few comments:
> - the option name `display_latex` sounds a little too vague and also may - introduce some confusion with the magic `%display latex`. Wouldn't `align_latex` be a better name?

I agree. 

> - Regarding Jupyter (classic), LaTeX outputs are always left-aligned for me (on two distinct Ubuntu 20.04 computers), as discussed at ticket:32859#comment:16 and setting `dm.preferences.display_latex = 'center'` does not change this...

"left" alignment is forced in the classic notebook. It seems developers decided so. Hence `align_latex` is only for jupyterlab.

> - Shouldn't `'left'` be the default, instead of `'center'`? Left-align is the default for SymPy MathJax display in a pure Python 3 notebook and I see no reason to deviate from SymPy policy here.  It also better (more readable) for short outputs, like `0`. 

I personally agree. But since "center" alignment has been de facto default in jupyterlab, and "left" alignment is expensive in that the additional code `\displaystyle" is inserted in every output cell, I am not sure if changing the default is a right thing... If you strongly insist, then I would follow. Do you?



---

archive/issue_comments_466545.json:
```json
{
    "body": "Replying to [comment:13 klee]:\n> > - Shouldn't `'left'` be the default, instead of `'center'`? Left-align is the default for SymPy MathJax display in a pure Python 3 notebook and I see no reason to deviate from SymPy policy here.  It also better (more readable) for short outputs, like `0`. \n> \n> I personally agree. But since \"center\" alignment has been de facto default in jupyterlab,\n\nWhat do you mean by \"de facto default\"? I have the impression that, on the contrary,  Jupyterlab's default is left-aligned, see e.g. the discussion [LaTeX display math in output cells should be left-aligned](https://github.com/jupyterlab/jupyterlab/issues/3938) on Jupyterlab github. For instance, in Jupyterlab with Python 3 kernel, the following cells all result in a left-aligned output:\n\n```\nimport sympy\nsympy.sqrt(2)\n```\n\n\n```\nfrom IPython.display import Latex\nLatex(r\"$\\sqrt{2+x}$\")\n```\n\n\n```\nLatex(r\"$$\\sqrt{2+x}$$\")\n```\n\n\n```\nLatex(r\"\\[\\sqrt{2+x}\\]\")\n```\n\n\n```\nLatex(r\"\\begin{equation}\\sqrt{2+x}\\end{equation}\")\n```\n\n\n\n\n> and \"left\" alignment is expensive in that the additional code `\\displaystyle\" is inserted in every output cell\nYes this is (one more!) drawback of our \"%display latex\" magic; instead of relying on Jupyter's native latex display...\n>\n>I am not sure if changing the default is a right thing... If you strongly insist, then I would follow. Do you?\n> \nDespite the \\displaystyle burden, I would vote in favor on the left-aligned default, for compatibility both with the display in Sage classic Jupyter and with the default for SymPy and Latex in Jupyterlab. It seems also that users prefer left-aligned, cf. https://ask.sagemath.org/question/59775/. Shall we organize a vote on sage-devel?",
    "created_at": "2022-03-10T13:18:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32705#issuecomment-466545",
    "user": "egourgoulhon"
}
```

Replying to [comment:13 klee]:
> > - Shouldn't `'left'` be the default, instead of `'center'`? Left-align is the default for SymPy MathJax display in a pure Python 3 notebook and I see no reason to deviate from SymPy policy here.  It also better (more readable) for short outputs, like `0`. 
> 
> I personally agree. But since "center" alignment has been de facto default in jupyterlab,

What do you mean by "de facto default"? I have the impression that, on the contrary,  Jupyterlab's default is left-aligned, see e.g. the discussion [LaTeX display math in output cells should be left-aligned](https://github.com/jupyterlab/jupyterlab/issues/3938) on Jupyterlab github. For instance, in Jupyterlab with Python 3 kernel, the following cells all result in a left-aligned output:

```
import sympy
sympy.sqrt(2)
```


```
from IPython.display import Latex
Latex(r"$\sqrt{2+x}$")
```


```
Latex(r"$$\sqrt{2+x}$$")
```


```
Latex(r"\[\sqrt{2+x}\]")
```


```
Latex(r"\begin{equation}\sqrt{2+x}\end{equation}")
```




> and "left" alignment is expensive in that the additional code `\displaystyle" is inserted in every output cell
Yes this is (one more!) drawback of our "%display latex" magic; instead of relying on Jupyter's native latex display...
>
>I am not sure if changing the default is a right thing... If you strongly insist, then I would follow. Do you?
> 
Despite the \displaystyle burden, I would vote in favor on the left-aligned default, for compatibility both with the display in Sage classic Jupyter and with the default for SymPy and Latex in Jupyterlab. It seems also that users prefer left-aligned, cf. https://ask.sagemath.org/question/59775/. Shall we organize a vote on sage-devel?



---

archive/issue_comments_466546.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-10T14:10:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32705#issuecomment-466546",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_466547.json:
```json
{
    "body": "Replying to [comment:14 egourgoulhon]:\n> Replying to [comment:13 klee]:\n> > > - Shouldn't `'left'` be the default, instead of `'center'`? Left-align is the default for SymPy MathJax display in a pure Python 3 notebook and I see no reason to deviate from SymPy policy here.  It also better (more readable) for short outputs, like `0`. \n> > \n> > I personally agree. But since \"center\" alignment has been de facto default in jupyterlab,\n> \n> What do you mean by \"de facto default\"? \n\nI meant center alignment is status quo, and is what users got used to in jupyterlab (including myself).\n\n> I have the impression that, on the contrary,  Jupyterlab's default is left-aligned, see e.g. the discussion [LaTeX display math in output cells should be left-aligned](https://github.com/jupyterlab/jupyterlab/issues/3938) on Jupyterlab github. For instance, in Jupyterlab with Python 3 kernel, the following cells all result in a left-aligned output:\n> {{{\n> import sympy\n> sympy.sqrt(2)\n> }}}\n> {{{\n> from IPython.display import Latex\n> Latex(r\"$\\sqrt{2+x}$\")\n> }}}\n> {{{\n> Latex(r\"$$\\sqrt{2+x}$$\")\n> }}}\n> {{{\n> Latex(r\"\\[\\sqrt{2+x}\\]\")\n> }}}\n> {{{\n> Latex(r\"\\begin{equation}\\sqrt{2+x}\\end{equation}\")\n> }}}\n> \n> \n> \n> > and \"left\" alignment is expensive in that the additional code `\\displaystyle\" is inserted in every output cell\n> Yes this is (one more!) drawback of our \"%display latex\" magic; instead of relying on Jupyter's native latex display...\n> >\n> >I am not sure if changing the default is a right thing... If you strongly insist, then I would follow. Do you?\n> > \n> Despite the \\displaystyle burden, I would vote in favor on the left-aligned default, for compatibility both with the display in Sage classic Jupyter and with the default for SymPy and Latex in Jupyterlab. It seems also that users prefer left-aligned, cf. https://ask.sagemath.org/question/59775/. Shall we organize a vote on sage-devel?\n\nI agree. The current default center alignment may be regarded as a defect. No vote in fixing a defect. But perhaps we need to advertise (in release tour?) how to change the behavior for those users that do not like the new default.",
    "created_at": "2022-03-10T14:21:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32705#issuecomment-466547",
    "user": "klee"
}
```

Replying to [comment:14 egourgoulhon]:
> Replying to [comment:13 klee]:
> > > - Shouldn't `'left'` be the default, instead of `'center'`? Left-align is the default for SymPy MathJax display in a pure Python 3 notebook and I see no reason to deviate from SymPy policy here.  It also better (more readable) for short outputs, like `0`. 
> > 
> > I personally agree. But since "center" alignment has been de facto default in jupyterlab,
> 
> What do you mean by "de facto default"? 

I meant center alignment is status quo, and is what users got used to in jupyterlab (including myself).

> I have the impression that, on the contrary,  Jupyterlab's default is left-aligned, see e.g. the discussion [LaTeX display math in output cells should be left-aligned](https://github.com/jupyterlab/jupyterlab/issues/3938) on Jupyterlab github. For instance, in Jupyterlab with Python 3 kernel, the following cells all result in a left-aligned output:
> {{{
> import sympy
> sympy.sqrt(2)
> }}}
> {{{
> from IPython.display import Latex
> Latex(r"$\sqrt{2+x}$")
> }}}
> {{{
> Latex(r"$$\sqrt{2+x}$$")
> }}}
> {{{
> Latex(r"\[\sqrt{2+x}\]")
> }}}
> {{{
> Latex(r"\begin{equation}\sqrt{2+x}\end{equation}")
> }}}
> 
> 
> 
> > and "left" alignment is expensive in that the additional code `\displaystyle" is inserted in every output cell
> Yes this is (one more!) drawback of our "%display latex" magic; instead of relying on Jupyter's native latex display...
> >
> >I am not sure if changing the default is a right thing... If you strongly insist, then I would follow. Do you?
> > 
> Despite the \displaystyle burden, I would vote in favor on the left-aligned default, for compatibility both with the display in Sage classic Jupyter and with the default for SymPy and Latex in Jupyterlab. It seems also that users prefer left-aligned, cf. https://ask.sagemath.org/question/59775/. Shall we organize a vote on sage-devel?

I agree. The current default center alignment may be regarded as a defect. No vote in fixing a defect. But perhaps we need to advertise (in release tour?) how to change the behavior for those users that do not like the new default.



---

archive/issue_comments_466548.json:
```json
{
    "body": "Replying to [comment:17 klee]:\n> I agree. The current default center alignment may be regarded as a defect. No vote in fixing a defect. But perhaps we need to advertise (in release tour?) how to change the behavior for those users that do not like the new default.\n\nOK. Thanks for the changes. \n\nThere are 2 doctests failures in `src/sage/misc/html.py`.",
    "created_at": "2022-03-10T18:26:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32705#issuecomment-466548",
    "user": "egourgoulhon"
}
```

Replying to [comment:17 klee]:
> I agree. The current default center alignment may be regarded as a defect. No vote in fixing a defect. But perhaps we need to advertise (in release tour?) how to change the behavior for those users that do not like the new default.

OK. Thanks for the changes. 

There are 2 doctests failures in `src/sage/misc/html.py`.



---

archive/issue_comments_466549.json:
```json
{
    "body": "Replying to [comment:19 egourgoulhon]:\n> There are 2 doctests failures in `src/sage/misc/html.py`. \n\nFixed. Thanks\n\nI preemptively solved merge conflicts with already positively reviewed #33475, by adding it as dependency.",
    "created_at": "2022-03-10T23:08:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32705#issuecomment-466549",
    "user": "klee"
}
```

Replying to [comment:19 egourgoulhon]:
> There are 2 doctests failures in `src/sage/misc/html.py`. 

Fixed. Thanks

I preemptively solved merge conflicts with already positively reviewed #33475, by adding it as dependency.



---

archive/issue_comments_466550.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-10T23:09:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32705#issuecomment-466550",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_466551.json:
```json
{
    "body": "The following notebook cell\n\n```\n%display latex\nx\n```\n\nyields\n\n```\n\\displaystylex\n```\n\nIn `src/sage/misc/html.py`, the argument of `\\displaystyle` should be wrapped into curly brackets.",
    "created_at": "2022-03-11T10:43:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32705#issuecomment-466551",
    "user": "egourgoulhon"
}
```

The following notebook cell

```
%display latex
x
```

yields

```
\displaystylex
```

In `src/sage/misc/html.py`, the argument of `\displaystyle` should be wrapped into curly brackets.



---

archive/issue_comments_466552.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-03-11T10:43:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32705#issuecomment-466552",
    "user": "egourgoulhon"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_466553.json:
```json
{
    "body": "Replying to [comment:25 egourgoulhon]:\n> The following notebook cell\n> {{{\n> %display latex\n> x\n> }}}\n> yields\n> {{{\n> \\displaystylex\n> }}}\n> In `src/sage/misc/html.py`, the argument of `\\displaystyle` should be wrapped into curly brackets.\n\n`\\displaystyle` does not take an argument. I put a space after `\\displaystyle` to prevent it from being combined with the following string. I am running doctesting.",
    "created_at": "2022-03-11T11:21:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32705#issuecomment-466553",
    "user": "klee"
}
```

Replying to [comment:25 egourgoulhon]:
> The following notebook cell
> {{{
> %display latex
> x
> }}}
> yields
> {{{
> \displaystylex
> }}}
> In `src/sage/misc/html.py`, the argument of `\displaystyle` should be wrapped into curly brackets.

`\displaystyle` does not take an argument. I put a space after `\displaystyle` to prevent it from being combined with the following string. I am running doctesting.



---

archive/issue_comments_466554.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-11T11:48:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32705#issuecomment-466554",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_466555.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-03-11T11:50:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32705#issuecomment-466555",
    "user": "klee"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_466556.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-03-12T17:53:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32705#issuecomment-466556",
    "user": "egourgoulhon"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_466557.json:
```json
{
    "body": "Looks good. I've tested the latest version on various notebooks, both with Jupyter and Jupyterlab.\nThanks!",
    "created_at": "2022-03-12T17:53:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32705#issuecomment-466557",
    "user": "egourgoulhon"
}
```

Looks good. I've tested the latest version on various notebooks, both with Jupyter and Jupyterlab.
Thanks!



---

archive/issue_comments_466558.json:
```json
{
    "body": "Thank you! \n\nI will announce this change on sage-devel.",
    "created_at": "2022-03-12T23:47:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32705#issuecomment-466558",
    "user": "klee"
}
```

Thank you! 

I will announce this change on sage-devel.



---

archive/issue_comments_466559.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-03-21T23:34:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32705#issuecomment-466559",
    "user": "vbraun"
}
```

Resolution: fixed
