# Issue 32705: Introduce `display_latex` option that allows latex displays aligned left

Issue created by migration from https://trac.sagemath.org/ticket/32942

Original creator: klee

Original creation time: 2021-11-27 13:05:46

CC:  egourgoulhon




---

Comment by klee created at 2021-11-27 13:24:10

New commits:


---

Comment by klee created at 2021-11-27 13:28:08

Changing status from new to needs_review.


---

Comment by git created at 2021-11-27 22:57:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-12-14 04:02:03

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by egourgoulhon created at 2022-03-10 09:53:53

Sorry for the delay in reviewing!

A few comments:
- the option name `display_latex` sounds a little too vague and also may - introduce some confusion with the magic `%display latex`. Wouldn't `align_latex` be a better name?
- I've tested the new feature with Jupyterlab 3.3 (cf. #32069), it works well!
- Regarding Jupyter (classic), LaTeX outputs are always left-aligned for me (on two distinct Ubuntu 20.04 computers), as discussed at ticket:32859#comment:16 and setting `dm.preferences.display_latex = 'center'` does not change this...
- Shouldn't `'left'` be the default, instead of `'center'`? Left-align is the default for SymPy MathJax display in a pure Python 3 notebook and I see no reason to deviate from SymPy policy here.  It also better (more readable) for short outputs, like `0`.


---

Comment by klee created at 2022-03-10 11:58:09

Replying to [comment:12 egourgoulhon]:
> A few comments:
> - the option name `display_latex` sounds a little too vague and also may - introduce some confusion with the magic `%display latex`. Wouldn't `align_latex` be a better name?

I agree. 

> - Regarding Jupyter (classic), LaTeX outputs are always left-aligned for me (on two distinct Ubuntu 20.04 computers), as discussed at ticket:32859#comment:16 and setting `dm.preferences.display_latex = 'center'` does not change this...

"left" alignment is forced in the classic notebook. It seems developers decided so. Hence `align_latex` is only for jupyterlab.

> - Shouldn't `'left'` be the default, instead of `'center'`? Left-align is the default for SymPy MathJax display in a pure Python 3 notebook and I see no reason to deviate from SymPy policy here.  It also better (more readable) for short outputs, like `0`. 

I personally agree. But since "center" alignment has been de facto default in jupyterlab, and "left" alignment is expensive in that the additional code `\displaystyle" is inserted in every output cell, I am not sure if changing the default is a right thing... If you strongly insist, then I would follow. Do you?


---

Comment by egourgoulhon created at 2022-03-10 13:18:33

Replying to [comment:13 klee]:
> > - Shouldn't `'left'` be the default, instead of `'center'`? Left-align is the default for SymPy MathJax display in a pure Python 3 notebook and I see no reason to deviate from SymPy policy here.  It also better (more readable) for short outputs, like `0`. 
> 
> I personally agree. But since "center" alignment has been de facto default in jupyterlab,

What do you mean by "de facto default"? I have the impression that, on the contrary,  Jupyterlab's default is left-aligned, see e.g. the discussion [LaTeX display math in output cells should be left-aligned](https://github.com/jupyterlab/jupyterlab/issues/3938) on Jupyterlab github. For instance, in Jupyterlab with Python 3 kernel, the following cells all result in a left-aligned output:

```
import sympy
sympy.sqrt(2)
```


```
from IPython.display import Latex
Latex(r"$\sqrt{2+x}$")
```


```
Latex(r"$$\sqrt{2+x}$$")
```


```
Latex(r"\[\sqrt{2+x}\]")
```


```
Latex(r"\begin{equation}\sqrt{2+x}\end{equation}")
```




> and "left" alignment is expensive in that the additional code `\displaystyle" is inserted in every output cell
Yes this is (one more!) drawback of our "%display latex" magic; instead of relying on Jupyter's native latex display...
>
>I am not sure if changing the default is a right thing... If you strongly insist, then I would follow. Do you?
> 
Despite the \displaystyle burden, I would vote in favor on the left-aligned default, for compatibility both with the display in Sage classic Jupyter and with the default for SymPy and Latex in Jupyterlab. It seems also that users prefer left-aligned, cf. https://ask.sagemath.org/question/59775/. Shall we organize a vote on sage-devel?


---

Comment by git created at 2022-03-10 14:10:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by klee created at 2022-03-10 14:21:06

Replying to [comment:14 egourgoulhon]:
> Replying to [comment:13 klee]:
> > > - Shouldn't `'left'` be the default, instead of `'center'`? Left-align is the default for SymPy MathJax display in a pure Python 3 notebook and I see no reason to deviate from SymPy policy here.  It also better (more readable) for short outputs, like `0`. 
> > 
> > I personally agree. But since "center" alignment has been de facto default in jupyterlab,
> 
> What do you mean by "de facto default"? 

I meant center alignment is status quo, and is what users got used to in jupyterlab (including myself).

> I have the impression that, on the contrary,  Jupyterlab's default is left-aligned, see e.g. the discussion [LaTeX display math in output cells should be left-aligned](https://github.com/jupyterlab/jupyterlab/issues/3938) on Jupyterlab github. For instance, in Jupyterlab with Python 3 kernel, the following cells all result in a left-aligned output:
> {{{
> import sympy
> sympy.sqrt(2)
> }}}
> {{{
> from IPython.display import Latex
> Latex(r"$\sqrt{2+x}$")
> }}}
> {{{
> Latex(r"$$\sqrt{2+x}$$")
> }}}
> {{{
> Latex(r"\[\sqrt{2+x}\]")
> }}}
> {{{
> Latex(r"\begin{equation}\sqrt{2+x}\end{equation}")
> }}}
> 
> 
> 
> > and "left" alignment is expensive in that the additional code `\displaystyle" is inserted in every output cell
> Yes this is (one more!) drawback of our "%display latex" magic; instead of relying on Jupyter's native latex display...
> >
> >I am not sure if changing the default is a right thing... If you strongly insist, then I would follow. Do you?
> > 
> Despite the \displaystyle burden, I would vote in favor on the left-aligned default, for compatibility both with the display in Sage classic Jupyter and with the default for SymPy and Latex in Jupyterlab. It seems also that users prefer left-aligned, cf. https://ask.sagemath.org/question/59775/. Shall we organize a vote on sage-devel?

I agree. The current default center alignment may be regarded as a defect. No vote in fixing a defect. But perhaps we need to advertise (in release tour?) how to change the behavior for those users that do not like the new default.


---

Comment by egourgoulhon created at 2022-03-10 18:26:49

Replying to [comment:17 klee]:
> I agree. The current default center alignment may be regarded as a defect. No vote in fixing a defect. But perhaps we need to advertise (in release tour?) how to change the behavior for those users that do not like the new default.

OK. Thanks for the changes. 

There are 2 doctests failures in `src/sage/misc/html.py`.


---

Comment by klee created at 2022-03-10 23:08:46

Replying to [comment:19 egourgoulhon]:
> There are 2 doctests failures in `src/sage/misc/html.py`. 

Fixed. Thanks

I preemptively solved merge conflicts with already positively reviewed #33475, by adding it as dependency.


---

Comment by git created at 2022-03-10 23:09:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by egourgoulhon created at 2022-03-11 10:43:11

The following notebook cell

```
%display latex
x
```

yields

```
\displaystylex
```

In `src/sage/misc/html.py`, the argument of `\displaystyle` should be wrapped into curly brackets.


---

Comment by egourgoulhon created at 2022-03-11 10:43:11

Changing status from needs_review to needs_work.


---

Comment by klee created at 2022-03-11 11:21:32

Replying to [comment:25 egourgoulhon]:
> The following notebook cell
> {{{
> %display latex
> x
> }}}
> yields
> {{{
> \displaystylex
> }}}
> In `src/sage/misc/html.py`, the argument of `\displaystyle` should be wrapped into curly brackets.

`\displaystyle` does not take an argument. I put a space after `\displaystyle` to prevent it from being combined with the following string. I am running doctesting.


---

Comment by git created at 2022-03-11 11:48:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by klee created at 2022-03-11 11:50:01

Changing status from needs_work to needs_review.


---

Comment by egourgoulhon created at 2022-03-12 17:53:21

Changing status from needs_review to positive_review.


---

Comment by egourgoulhon created at 2022-03-12 17:53:21

Looks good. I've tested the latest version on various notebooks, both with Jupyter and Jupyterlab.
Thanks!


---

Comment by klee created at 2022-03-12 23:47:08

Thank you! 

I will announce this change on sage-devel.


---

Comment by vbraun created at 2022-03-21 23:34:43

Resolution: fixed
