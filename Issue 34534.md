# Issue 34534: switch to libgap in sage/coding

Issue created by migration from https://trac.sagemath.org/ticket/34771

Original creator: dimpase

Original creation time: 2022-11-22 10:22:10

CC:  klee chapoton wdj

after #34737 there are still uses of pexpect GAP left there.


Part of #26902


---

Comment by dimpase created at 2022-11-22 10:27:44

Trying to use #34770 to avoid explict calls to `gfq_gap_to_sage` from `sage.interfaces.gap`.


---

Comment by dimpase created at 2022-11-22 22:01:50

New commits:


---

Comment by git created at 2022-11-22 22:25:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-11-22 22:56:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2022-11-22 23:00:16

2 doctest errors in coding/ with these changes:


```
File "src/sage/coding/code_constructions.py", line 732, in sage.coding.code_constructions.ToricCode
Failed example:
    C.minimum_distance()
Expected:
    24
Got:
    30
**********************************************************************
File "src/sage/coding/code_constructions.py", line 740, in sage.coding.code_constructions.ToricCode
Failed example:
    C.minimum_distance()
Expected:
    6
Got:
    10
```

note that doctests using Guava for these codes added in `ec1c72e` output correct minimal distances.


---

Comment by git created at 2022-11-23 01:23:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-11-23 08:46:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2022-11-23 08:47:12

Changing status from new to needs_review.


---

Comment by dimpase created at 2022-11-25 09:11:14

With #34391, few doctests related to Guava will need to be adjusted, as Guava is less chatty in GAP 4.12.1.


---

Comment by git created at 2022-11-25 16:16:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2022-11-26 11:26:58

This is doing way too much conversions

```
H = libgap(aut_m).Intersection2(aut_B_aug)
rt_transversal = aut_B_aug.RightTransversal(H).List().sage()
rt_transversal = [PermutationGroupElement(g) for g in rt_transversal if str(g) != '()']
rt_transversal = [[a-1 for a in g.domain()] for g in rt_transversal]
rt_transversal = [g + list(xrange(len(g), n))
```

It would be nicer as

```
H = libgap(aut_m).Intersection2(aut_B_aug)
rt_transversal = aut_B_aug.RightTransversal(H)
rt_transversal = [[int(a) - 1 for a in g.ListPerm(n)] for g in rt_transversal if not g.IsOne()]
```



---

Comment by vdelecroix created at 2022-11-26 11:29:41

At the time guava is loaded, one should check for its availability. The standard way is

```
sage: from sage.features.gap import GapPackage
sage: pkg = GapPackage("guava")
sage: pkg.require()
Traceback (most recent call last):
...
FeatureNotPresentError: gap_package_guava is not available.
`TestPackageAvailability("guava")` evaluated to `fail` in GAP.
```



---

Comment by vdelecroix created at 2022-11-26 11:31:02

Changing status from needs_review to needs_work.


---

Comment by dimpase created at 2022-11-28 22:08:05

Replying to [comment:13 Vincent Delecroix]:
> This is doing way too much conversions
> {{{
> H = libgap(aut_m).Intersection2(aut_B_aug)
> rt_transversal = aut_B_aug.RightTransversal(H).List().sage()
> rt_transversal = [PermutationGroupElement(g) for g in rt_transversal if str(g) != '()']
> rt_transversal = [[a-1 for a in g.domain()] for g in rt_transversal]
> rt_transversal = [g + list(xrange(len(g), n))
> }}}
> It would be nicer as
> {{{
> H = libgap(aut_m).Intersection2(aut_B_aug)
> rt_transversal = aut_B_aug.RightTransversal(H)
> rt_transversal = [[int(a) - 1 for a in g.ListPerm(n)] for g in rt_transversal if not g.IsOne()]
> }}}

Sure, thanks, I agree. My goal was to get it to work with libgap rather than pexpect gap, I mostly went with tweaking pre-existing code line by line.


---

Comment by git created at 2022-12-04 15:38:14

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by dimpase created at 2022-12-04 15:39:14

fixed, rebased over the latest version of #34770. Ready for review.


---

Comment by dimpase created at 2022-12-04 15:39:14

Changing status from needs_work to needs_review.
