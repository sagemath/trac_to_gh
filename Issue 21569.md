# Issue 21569: Allow multiple instances of the PariInstance object

archive/issues_021569.json:
```json
{
    "body": "CC:  defeo\n\nSince the `PariInstance` object is really just a callable namespace without state, it should be possible to create multiple instances of it.\n\nWhen `PariInstance.__init__()` is called a second time with a `size` argument which is larger than the current size, we should increase (but never decrease) the PARI stack size but otherwise do nothing.\n\nIssue created by migration from https://trac.sagemath.org/ticket/21806\n\n",
    "created_at": "2016-11-03T14:13:28Z",
    "labels": [
        "interfaces",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.6",
    "title": "Allow multiple instances of the PariInstance object",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21569",
    "user": "jdemeyer"
}
```
CC:  defeo

Since the `PariInstance` object is really just a callable namespace without state, it should be possible to create multiple instances of it.

When `PariInstance.__init__()` is called a second time with a `size` argument which is larger than the current size, we should increase (but never decrease) the PARI stack size but otherwise do nothing.

Issue created by migration from https://trac.sagemath.org/ticket/21806





---

archive/issue_comments_299414.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-01-10T10:25:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21569",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21569#issuecomment-299414",
    "user": "defeo"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_299415.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-01-10T10:25:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21569",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21569#issuecomment-299415",
    "user": "defeo"
}
```

New commits:



---

archive/issue_comments_299416.json:
```json
{
    "body": "Changing keywords from \"\" to \"atelierpari2017\".",
    "created_at": "2017-01-10T10:29:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21569",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21569#issuecomment-299416",
    "user": "defeo"
}
```

Changing keywords from "" to "atelierpari2017".



---

archive/issue_comments_299417.json:
```json
{
    "body": "I don't understand clearly why we should allow multiple pari instances. Could it be precised in the ticket description? (we discussed it yesterday but I don't quite remember)",
    "created_at": "2017-01-10T13:52:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21569",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21569#issuecomment-299417",
    "user": "vdelecroix"
}
```

I don't understand clearly why we should allow multiple pari instances. Could it be precised in the ticket description? (we discussed it yesterday but I don't quite remember)



---

archive/issue_comments_299418.json:
```json
{
    "body": "minor remark: there are trailing whitespaces!",
    "created_at": "2017-01-10T13:53:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21569",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21569#issuecomment-299418",
    "user": "vdelecroix"
}
```

minor remark: there are trailing whitespaces!



---

archive/issue_comments_299419.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-01-10T13:53:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21569",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21569#issuecomment-299419",
    "user": "vdelecroix"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_299420.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-10T14:05:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21569",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21569#issuecomment-299420",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_299421.json:
```json
{
    "body": "Note that an alternate, reasonable, design would initialize the PARI library at module load, rather than in `__init__`. However this ticket is not concerned with this.\n\nWith the current design, we have the (dubious) advantage of being able to call `pari_close()` (via `PariInstance._close()`, and then reinitialize PARI by creating a new `PariInstance` object at leisure.",
    "created_at": "2017-01-10T14:14:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21569",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21569#issuecomment-299421",
    "user": "defeo"
}
```

Note that an alternate, reasonable, design would initialize the PARI library at module load, rather than in `__init__`. However this ticket is not concerned with this.

With the current design, we have the (dubious) advantage of being able to call `pari_close()` (via `PariInstance._close()`, and then reinitialize PARI by creating a new `PariInstance` object at leisure.



---

archive/issue_comments_299422.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-01-10T14:14:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21569",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21569#issuecomment-299422",
    "user": "defeo"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_299423.json:
```json
{
    "body": "pari **is** initialized at module load since a global `pari_instance` is created! Calling `_close` is dangerous since this global instance is still accessible... we might want to document this bug-feature",
    "created_at": "2017-01-10T14:23:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21569",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21569#issuecomment-299423",
    "user": "vdelecroix"
}
```

pari **is** initialized at module load since a global `pari_instance` is created! Calling `_close` is dangerous since this global instance is still accessible... we might want to document this bug-feature



---

archive/issue_comments_299424.json:
```json
{
    "body": "Replying to [comment:11 vdelecroix]:\n> pari **is** initialized at module load since a global `pari_instance` is created!\n\nBut that will change. `cypari2` should not do that.\n----\nNew commits:",
    "created_at": "2017-01-10T15:09:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21569",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21569#issuecomment-299424",
    "user": "jdemeyer"
}
```

Replying to [comment:11 vdelecroix]:
> pari **is** initialized at module load since a global `pari_instance` is created!

But that will change. `cypari2` should not do that.
----
New commits:



---

archive/issue_comments_299425.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-10T15:13:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21569",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21569#issuecomment-299425",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_299426.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-10T15:14:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21569",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21569#issuecomment-299426",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_299427.json:
```json
{
    "body": "New version, needs review...",
    "created_at": "2017-01-10T15:16:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21569",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21569#issuecomment-299427",
    "user": "jdemeyer"
}
```

New version, needs review...



---

archive/issue_comments_299428.json:
```json
{
    "body": "All doctests pass, and I like Jeroens modifications.\n----\nNew commits:",
    "created_at": "2017-01-10T17:28:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21569",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21569#issuecomment-299428",
    "user": "defeo"
}
```

All doctests pass, and I like Jeroens modifications.
----
New commits:



---

archive/issue_comments_299429.json:
```json
{
    "body": "What should I expect from\n\n```\nsage: from sage.libs.cypari2.pari_instance import PariInstance\nsage: p = PariInstance()\nsage: p._close()\nsage: p('12')\n```\n",
    "created_at": "2017-01-11T08:36:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21569",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21569#issuecomment-299429",
    "user": "vdelecroix"
}
```

What should I expect from

```
sage: from sage.libs.cypari2.pari_instance import PariInstance
sage: p = PariInstance()
sage: p._close()
sage: p('12')
```




---

archive/issue_comments_299430.json:
```json
{
    "body": "Replying to [comment:19 vdelecroix]:\n> What should I expect from\n> {{{\n> sage: from sage.libs.cypari2.pari_instance import PariInstance\n> sage: p = PariInstance()\n> sage: p._close()\n> sage: p('12')\n> }}}\n\nA segmentation fault I guess.",
    "created_at": "2017-01-11T08:45:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21569",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21569#issuecomment-299430",
    "user": "jdemeyer"
}
```

Replying to [comment:19 vdelecroix]:
> What should I expect from
> {{{
> sage: from sage.libs.cypari2.pari_instance import PariInstance
> sage: p = PariInstance()
> sage: p._close()
> sage: p('12')
> }}}

A segmentation fault I guess.



---

archive/issue_comments_299431.json:
```json
{
    "body": "Replying to [comment:20 jdemeyer]:\n> Replying to [comment:19 vdelecroix]:\n> > What should I expect from\n> > {{{\n> > sage: from sage.libs.cypari2.pari_instance import PariInstance\n> > sage: p = PariInstance()\n> > sage: p._close()\n> > sage: p('12')\n> > }}}\n> \n> A segmentation fault I guess.\n\nShouldn't it be documented as I mentioned in [comment:11]?",
    "created_at": "2017-01-11T08:50:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21569",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21569#issuecomment-299431",
    "user": "vdelecroix"
}
```

Replying to [comment:20 jdemeyer]:
> Replying to [comment:19 vdelecroix]:
> > What should I expect from
> > {{{
> > sage: from sage.libs.cypari2.pari_instance import PariInstance
> > sage: p = PariInstance()
> > sage: p._close()
> > sage: p('12')
> > }}}
> 
> A segmentation fault I guess.

Shouldn't it be documented as I mentioned in [comment:11]?



---

archive/issue_comments_299432.json:
```json
{
    "body": "There is already the comment\n\n```\n            Call this method at you own risk if you really need to free\n            the memory used by PARI.\n```\n",
    "created_at": "2017-01-11T08:54:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21569",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21569#issuecomment-299432",
    "user": "jdemeyer"
}
```

There is already the comment

```
            Call this method at you own risk if you really need to free
            the memory used by PARI.
```




---

archive/issue_comments_299433.json:
```json
{
    "body": "Replying to [comment:22 jdemeyer]:\n> There is already the comment\n> {{{\n>             Call this method at you own risk if you really need to free\n>             the memory used by PARI.\n> }}}\n\nThis comment is not clear enough. The sentence says that the memory is freed. Not that you will obtain a `SEGFAULT` if you try to use pari again. Moreover, creating a new pari instance would make pari available again (right?).",
    "created_at": "2017-01-11T09:50:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21569",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21569#issuecomment-299433",
    "user": "vdelecroix"
}
```

Replying to [comment:22 jdemeyer]:
> There is already the comment
> {{{
>             Call this method at you own risk if you really need to free
>             the memory used by PARI.
> }}}

This comment is not clear enough. The sentence says that the memory is freed. Not that you will obtain a `SEGFAULT` if you try to use pari again. Moreover, creating a new pari instance would make pari available again (right?).



---

archive/issue_comments_299434.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-01-11T15:52:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21569",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21569#issuecomment-299434",
    "user": "vdelecroix"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_299435.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-01-11T15:52:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21569",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21569#issuecomment-299435",
    "user": "vdelecroix"
}
```

New commits:



---

archive/issue_comments_299436.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-01-18T20:39:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21569",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21569#issuecomment-299436",
    "user": "vbraun"
}
```

Resolution: fixed
