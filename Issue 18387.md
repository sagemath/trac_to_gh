# Issue 18387: Implement the lift theorem for linear matroids

Issue created by migration from https://trac.sagemath.org/ticket/18624

Original creator: Rudi

Original creation time: 2015-06-06 18:51:58

Assignee: Rudi

CC:  stefan yomcat

The `lift theorem' gives conditions under which a matroid representation over a partial field can be transformed to a representation over another partial field, using a lift function to map the cross ratios. 

Regardless whether these conditions are met, there is a polynomial-time procedure to construct a  candidate representation over the target partial field, given a lift function. If the conditions of the theorem are met, then this candidate representation is the right one.

Write a method for LinearMatroid, which given a lift function, generates such a candidate representation.


---

Comment by git created at 2015-06-08 12:05:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-06-08 17:13:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-06-09 09:46:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by Rudi created at 2015-06-09 09:55:49

Just some more testing to do, perhaps some more examples in the docstring, and probably the new helper function should really be moved to `utilities.py`.


---

Comment by Stefan created at 2015-06-09 15:09:10

Hi Rudi,

I think you really need to fix #15296 before building code that makes it more likely for people to use cross-ratio functionality. In particular if you create the near-regular partial field as a field of fractions of a polynomial ring, things go quite horribly wrong.


---

Comment by Rudi created at 2015-06-09 17:11:40

Hi Stefan,

To my mind, this patch makes it *less* likely that people will need to compute over fields of fractions. They can now use some finite field to compute with for most of the time, and lift the representation afterwards. The lifting merely gives you different perspectives on the same algebraic object (the way I set up this method it can also be used to e.g. directly get different representations over GF(5) out of one finite-field matrix which encodes a hydra-k representation.)

But if you want to see #15296 fixed urgently, I promise you a fast review when you are done :). But seriously, I have a method in mind that will not compromise the efficiency for fields that do not need equivalence testing, but that needs certain trickery to work. I know how to do it in c++, not sure about python/cython. Perhaps you could assist me with that.  I'm taking that discussion to #15296.

I will finish this patch first. Hope you can do the review!

Rudi


---

Comment by git created at 2015-06-09 17:30:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-06-10 11:18:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-06-14 15:55:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by Rudi created at 2015-06-14 16:01:29

Changing status from new to needs_review.


---

Comment by Rudi created at 2015-06-14 16:01:29

Good to go, I think.


---

Comment by git created at 2015-06-14 16:02:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by Rudi created at 2015-06-14 16:45:23

The patchbot perhaps needs a nudge.


---

Comment by Rudi created at 2015-06-14 16:45:23

Changing status from needs_review to needs_work.


---

Comment by Rudi created at 2015-06-14 16:45:43

Changing status from needs_work to needs_review.


---

Comment by git created at 2015-06-18 18:57:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by Rudi created at 2015-06-18 18:59:26

The patchbot was not pleased, hope this will solve the problem.


---

Comment by tscrim created at 2015-06-19 06:34:46

One major thing: `lift_map` needs doctests.

A couple of minor things (all but the first two you can ignore):

- Please remove all trailing whitespace.
- Citations should be make by `[refname]_`.
- I know it's not part of this ticket, but instead of `http://arxiv.org/abs/1203.0910`, you can (should) use `arxiv:`1203.0910``. You can also make ``(-i, i)`` for math formatting.
- You should try to make all lines under 80 characters; in particular, the moved citation.
- In the `INPUT:` of `lift_map` should be `--` instead of the comma `,`.
- I'd remove the period `.` in the `OUTPUT:` section of `lift_map` since it is not a sentence.
- Don't be afraid of using (inline) math formatting/latex (mainly I'm thinking of `lift_cross_matrix`).

Stefan, are you going to be doing the rest of the review?


---

Comment by git created at 2015-06-19 07:37:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by Rudi created at 2015-06-19 07:43:14

Replying to [comment:17 tscrim]:
> One major thing: `lift_map` needs doctests.
> 
> A couple of minor things (all but the first two you can ignore):
> 
> - Please remove all trailing whitespace.
> - Citations should be make by `[refname]_`.
> - I know it's not part of this ticket, but instead of `http://arxiv.org/abs/1203.0910`, you can (should) use `arxiv:`1203.0910``. You can also make ``(-i, i)`` for math formatting.
> - You should try to make all lines under 80 characters; in particular, the moved citation.
> - In the `INPUT:` of `lift_map` should be `--` instead of the comma `,`.
> - I'd remove the period `.` in the `OUTPUT:` section of `lift_map` since it is not a sentence.
> - Don't be afraid of using (inline) math formatting/latex (mainly I'm thinking of `lift_cross_matrix`).
> 

Thanks. I think my last commit covers each of these issues except for the last one.


---

Comment by Rudi created at 2015-06-19 07:49:22

> Stefan, are you going to be doing the rest of the review?

Michael Welsh also knows this theorem well, so perhaps he is interested in reviewing this.


---

Comment by yomcat created at 2015-06-19 08:38:46

The code looks good (no running capability at the moment though). If Stefan doesn't beat me to it, I'll give it a proper go tomorrow.

One thing: Why are the imports interspersed throughout the code, instead of collected altogether at the top. I don't know what the convention is though.


---

Comment by Rudi created at 2015-06-19 09:03:59

Replying to [comment:21 yomcat]:
> The code looks good (no running capability at the moment though). If Stefan doesn't beat me to it, I'll give it a proper go tomorrow.
> 
Thanks!
> One thing: Why are the imports interspersed throughout the code, instead of collected altogether at the top. I don't know what the convention is though.
Neither do I. Actually, I also don't know whether it makes any difference for the compiled code either.


---

Comment by tscrim created at 2015-06-19 15:49:29

Replying to [comment:22 Rudi]:
> Replying to [comment:21 yomcat]:
> > The code looks good (no running capability at the moment though). If Stefan doesn't beat me to it, I'll give it a proper go tomorrow.
> > 
> Thanks!

Two things I missed on my quick lookthrough; both are in `lift_map`. Your missing a blankline after `EXAMPLES::` and bullet point lists need to be aligned as:

```
- this is a long item
  which is aligned like this
- here is the second item
```

One thing I messed up on is `:arxiv:`1203.0910`` (I missed the leading colon). Also don't include the triple { } braces (they are just here so that it displays properly).

> > One thing: Why are the imports interspersed throughout the code, instead of collected altogether at the top. I don't know what the convention is though.
> Neither do I. Actually, I also don't know whether it makes any difference for the compiled code either.

It takes more time to have an import inside of a method because python has to resolve that import (or seeing it already has been imported) each time the method is called. However one sometimes needs to do this to take care of circular imports: file A imports something from file B, but file B also needs to import something from file A (or potentially larger cycles).


---

Comment by Rudi created at 2015-06-19 17:37:59

Replying to [comment:23 tscrim]:
> Two things I missed on my quick lookthrough; both are in `lift_map`. Your missing a blankline after `EXAMPLES::` and bullet point lists need to be aligned as:
> {{{
> - this is a long item
>   which is aligned like this
> - here is the second item
> }}}
I was just touching up the docstring a bit to ue more latex, so this is solved now.
>One thing I messed up on is `:arxiv:`1203.0910`` (I missed the leading colon). 
>Also don't include the triple { } braces (they are just here so that it displays properly).
Done.
> > > One thing: Why are the imports interspersed throughout the code, instead of collected altogether at the top. I don't know what the convention is though.
> > Neither do I. Actually, I also don't know whether it makes any difference for the compiled code either.
> 
> It takes more time to have an import inside of a method because python has to resolve that import (or seeing it already has been imported) each time the method is called. However one sometimes needs to do this to take care of circular imports: file A imports something from file B, but file B also needs to import something from file A (or potentially larger cycles).

Thanks for clarifying that. Moved the imports to the top.


---

Comment by git created at 2015-06-19 17:38:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2015-06-19 17:45:27

You still need to fix the bullet points in `lift_map` (before and now it is correct in `lift_cross_ratios`. You can use `\GF{19}` instead of `GF(19)` for better latex formatting. You also need to remove the { } braces from the :arxiv: command.


---

Comment by git created at 2015-06-19 18:03:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-06-19 18:11:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by Rudi created at 2015-06-19 18:21:09

Thanks for your patience :)


---

Comment by yomcat created at 2015-06-20 03:35:27

Looks good to me.

Upon running a `git trac review`, there's lots of grumpy red whitespace showing up. I think that needs to be cleaned up.


---

Comment by git created at 2015-06-20 13:29:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by Rudi created at 2015-06-20 13:33:46

Replying to [comment:30 yomcat]:
> Looks good to me.
> 
> Upon running a `git trac review`, there's lots of grumpy red whitespace showing up. I think that needs to be cleaned up.

The trailing whitespace is now gone, and I gave the statement of the lift theorem a bit more thought.


---

Comment by git created at 2015-06-20 13:36:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by yomcat created at 2015-06-21 04:11:49

A few more typos/formatting changes. I think this is the correct way to format them (ignore the spaces at the beginning of lines, they're too annoying to make right):


```diff
--- Version 1
+++ Version 2
@@ -1,15 +1,15 @@
     For a lift map `f` and a matrix `A` these conditions are as follows. First of all
     `f: S \rightarrow T`, where `S` is a set of invertible elements of the source ring and
     `T` is a set of invertible elements of the target ring. The matrix `A` has entries
-   from the source ring, and each crossratio of `A` is contained in `S`. Moreover:
+  from the source ring, and each cross ratio of `A` is contained in `S`. Moreover:

-    - `1 \in S`, `1\in T`;
+    - `1 \in S`, `1 \in T`;
     - for all `x \in S`: `f(x) = 1` if and only if `x = 1`;
-    - for all `x, y\in S`: if `x+y = 0` then `f(x)+f(y)=0`;
-    - for all `x, y\in S`: if `x+y = 1` then `f(x)+f(y)=1`;
-    - for all `x, y, z\in S`: if  `xy = z` then `f(x)f(y)=f(z)`.
+   - for all `x, y \in S`: if `x + y = 0` then `f(x) + f(y) = 0`;
+   - for all `x, y \in S`: if `x + y = 1` then `f(x) + f(y) = 1`;
+   - for all `x, y, z \in S`: if  `xy = z` then `f(x)f(y) = f(z)`.
 
-    Any ring homorphism `h: P \rightarrow R` induces a lift map from the set of units `S` of
+   Any ring homomorphism `h: P \rightarrow R` induces a lift map from the set of units `S` of
     `P` to the set of units `T` of `R`. There exist lift maps which do not arise in
     this manner. Several such maps can be created by the function
     :meth:`lift_map() <sage.matroids.utilities.lift_map>`.
```



---

Comment by yomcat created at 2015-06-21 08:27:17

Changing status from needs_review to needs_work.


---

Comment by git created at 2015-06-21 10:12:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by Rudi created at 2015-06-21 10:13:39

Changing status from needs_work to needs_review.


---

Comment by Rudi created at 2015-06-21 10:13:39

Replying to [comment:34 yomcat]:
> A few more typos/formatting changes.

Done.


---

Comment by yomcat created at 2015-06-21 18:57:52

All good.


---

Comment by yomcat created at 2015-06-21 18:57:52

Changing status from needs_review to positive_review.


---

Comment by Rudi created at 2015-06-21 19:20:44

Sorry Michael, but I just stumbled across the fact that there will be instances that this code cannot handle, due to the fact that min_spanning_tree() does not work on disconnected graphs. I had assumed it would just return a spanning forest.

So I need to repair that. It will not take long. I will ask for another review in a minute.


---

Comment by Rudi created at 2015-06-21 19:20:44

Changing status from positive_review to needs_work.


---

Comment by git created at 2015-06-21 19:55:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by Rudi created at 2015-06-21 19:57:57

Changing status from needs_work to needs_review.


---

Comment by Rudi created at 2015-06-21 19:57:57

That's the minimal modification that will solve this issue. I will perhaps think about a more efficient one later.

Again, sorry for the turbulence. I was just working on a method for testing if a matroid is ternary and ran into exactly this issue.

Needs review!


---

Comment by git created at 2015-06-22 07:24:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by Rudi created at 2015-06-22 07:25:56

The patchbot was unhappy about a non-ascii character. Think I got it.


---

Comment by yomcat created at 2015-06-22 07:33:22

Something isn't quite right:


```
sage: start_matrix = matrix(GF(19), [[18, 18, 18, 18, 18, 18, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 18, 0, 5], [1, 0, 0, 0, 0, 0, 18, 18, 18, 18, 18, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 15, 14], [0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 18, 18, 18, 18, 0, 0, 0, 0, 0, 0, 5, 4, 18], [0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 18, 18, 18, 0, 0, 0, 0, 0, 0], [0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 18, 18, 0, 14, 18, 0], [0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 1, 0, 18, 0, 0, 0], [0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 1, 1, 1, 1, 1]])
sage: start_matrix
[18 18 18 18 18 18  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0 18  0  5]
[ 1  0  0  0  0  0 18 18 18 18 18  0  0  0  0  0  0  0  0  0  0  0 15 14]
[ 0  1  0  0  0  0  1  0  0  0  0 18 18 18 18  0  0  0  0  0  0  5  4 18]
[ 0  0  1  0  0  0  0  1  0  0  0  1  0  0  0 18 18 18  0  0  0  0  0  0]
[ 0  0  0  1  0  0  0  0  1  0  0  0  1  0  0  1  0  0 18 18  0 14 18  0]
[ 0  0  0  0  1  0  0  0  0  1  0  0  0  1  0  0  1  0  1  0 18  0  0  0]
[ 0  0  0  0  0  1  0  0  0  0  1  0  0  0  1  0  0  1  0  1  1  1  1  1]
sage: GM = lift_map('gm')
sage: Z = lift_cross_ratios(start_matrix, GM)
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<ipython-input-11-d7b7e5f1514f> in <module>()
----> 1 Z = lift_cross_ratios(start_matrix, GM)

/Applications/sage-devel/local/lib/python2.7/site-packages/sage/matroids/utilities.pyc in lift_cross_ratios(A, lift_map)
    494 
    495         if cr != plus_one1 and not cr in lift_map:
--> 496             raise ValueError("Input matrix has a cross ratio "+str(cr)+", which is not in the lift_map")
    497         # - write the entry as a product of cross ratios of A
    498         div = True

ValueError: Input matrix has a cross ratio 15, which is not in the lift_map
sage: M = LinearMatroid(start_matrix)
sage: M.cross
M.cross_ratio   M.cross_ratios  
sage: M.cross_ratios()
{4, 5, 6, 14, 15, 16}
```


To clarify, that's a random GM matrix that I had lying around, represented over GF(19) as per everything I did in my thesis.


---

Comment by yomcat created at 2015-06-22 07:33:22

Changing status from needs_review to needs_work.


---

Comment by Rudi created at 2015-06-22 07:54:35

Replying to [comment:45 yomcat]:
> Something isn't quite right:
> 
> --> 496             raise ValueError("Input matrix has a cross ratio "+str(cr)+", which is not in the lift_map")
>  {{{
> sage: M.cross_ratios()
> {4, 5, 6, 14, 15, 16}
> }}}
>
Yes, it has 15 as a cross ratio. But 15 _is_ in the lift map! I'll figure it out.


---

Comment by git created at 2015-06-22 08:06:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-06-22 08:09:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by Rudi created at 2015-06-22 08:13:08

Changing status from needs_work to needs_review.


---

Comment by Rudi created at 2015-06-22 08:13:08

OK, thanks a lot for finding that bug.

Turns out there was something wrong with the gm definition in `lift_map`. It should have mapped GF(19)(15), but didn't!

Now repaired. Have a look.


---

Comment by yomcat created at 2015-06-22 09:30:13

Now it's working as far as I can tell.

Is there anything else planned on partial fields and stuff? I should be turning my thesis into paper(s) soonish, and I'd hate to have to rewrite all my code because you made a new function.


---

Comment by yomcat created at 2015-06-22 09:30:13

Changing status from needs_review to positive_review.


---

Comment by Rudi created at 2015-06-22 09:44:51

Replying to [comment:50 yomcat]:
> Now it's working as far as I can tell.
> 
> Is there anything else planned on partial fields and stuff? I should be turning my thesis into paper(s) soonish, and I'd hate to have to rewrite all my code because you made a new function.

Well, here's a few things I might do:
- add a few maps to lift_map;
- make lift_cross_ratios design it's own lift map / target ring based on the cross ratios of the given matrix;
- speed up lift_cross_ratios, _local_binary_matroid, _local_ternary_matroid;
- kill #15296
But they are not on the top of my list, so can't say when. The first one is quite easy, so I might work on that between harder tasks. 

I doubt if that will make any of your code outdated. Making real gm-matrices from your gf19-matrices (and latex-ing them) just became easier, so that can never hurt.

What kind of functionality were you thinking of?


---

Comment by yomcat created at 2015-06-22 09:57:12

Replying to [comment:51 Rudi]:
> 
> I doubt if that will make any of your code outdated. Making real gm-matrices from your gf19-matrices (and latex-ing them) just became easier, so that can never hurt.
I had some pretty gnarly grep routines to do that for me, so losing them is a plus.
> 
> What kind of functionality were you thinking of?

A way to test if a given GF(4)/5 matrix is GM or not. But that's a pipe dream, and working in GF(19) wasn't too bad when I stopped doing complete enumeration of matrices.

I'm about to start working on it, and if anything seems like it could be useful in general I'll make some tickets.


---

Comment by Rudi created at 2015-06-22 10:08:51

Replying to [comment:52 yomcat]:

> > What kind of functionality were you thinking of?
> 
> A way to test if a given GF(4)/5 matrix is GM or not. 

After is_ternary, I intend to work on is_quarternary. That function will tell you if a GF(5)-matrix is GM. For GF(5) / other fields I have no plans right now. They are much harder, GF(4) is the last nice one.


---

Comment by vbraun created at 2015-06-22 22:25:13

Resolution: fixed
