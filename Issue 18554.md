# Issue 18554: Matroid k-connectivity

archive/issues_018554.json:
```json
{
    "body": "CC:  stefan yomcat rudi\n\nDecide if a matroid is k-connected using matroid intersection.\n\nIssue created by migration from https://trac.sagemath.org/ticket/18791\n\n",
    "created_at": "2015-06-26T11:30:25Z",
    "labels": [
        "matroid theory",
        "minor",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.8",
    "title": "Matroid k-connectivity",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18554",
    "user": "chaoxu"
}
```
CC:  stefan yomcat rudi

Decide if a matroid is k-connected using matroid intersection.

Issue created by migration from https://trac.sagemath.org/ticket/18791





---

archive/issue_comments_252386.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-18T05:22:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18554#issuecomment-252386",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_252387.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-07-18T05:22:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18554#issuecomment-252387",
    "user": "chaoxu"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_252388.json:
```json
{
    "body": "Hi Chao,\n\njust saw that you had finished this one. I have some comments on the code below:\n\n```\n        m = k-1\n        E = set(self.groundset())\n        w = {e:1 for e in E}\n        Q = set(list(E)[:m])\n        E = E-Q\n        for r in range(len(Q)/2):\n            for Q1 in map(set,combinations(Q, r)):\n                Q2 = Q-Q1\n                # Given Q1, Q2 partition of Q, find all extensions\n                for A in map(set,combinations(E, m - len(Q1))):\n                    T = Q1|A\n                    for B in map(set,combinations(E-A, m - len(Q2))):\n                        S = Q2|B\n                        I, _ = self._link(S, T)\n                        if(len(I) - self.full_rank() + self.rank(S) + self.rank(T) < m):\n                            if certificate:\n                                return False, I\n                            return False\n```\n\n- w is defined but not used\n- `I` is not the min separation, but the max connector. If you have `I, X = self._link(S, T)`, then `return False, X`. You could even do without `I` if you tested the connectivity by `if self._connectivity(X)<m:`\n- if `r == len(Q)/2`, then the unordered pair {Q1, Q2} is generated and tested twice. \n\nThe set of pairs {S,T} tested by your code is what Bixby & Cunningham describe in their paper to argue that O(n<sup>k</sup>) connectivity tests are enough. It will not be possible to attain o(n<sup>k</sup>) pairs, but the constant hidden by the O() can be significantly better. \n\nE.g. in the r-th iteration, set aside r elements R from E-Q, also split R in all possible ways R1, R2, and then put S= Q1|R1|A, T=Q2|R2|B. The A and B you need are now smaller (|A|+|B| went down by r), hence fewer possibilities. Another optimization is this: once you are done testing all A containing a given e, you have established that e must be on the other side of the separation and so you may as well fix it in B, again reducing the number of possibilities for B. And this can be iterated of course.\n\nFor a positive review, it would be enough that you fix the above three points, and that the code passes some tests I will run of course. Optimizing the number of connectivity tests is not necessary, but would be appreciated. It is actually an interesting question what is the minimum number of tests as a function of n,k here.",
    "created_at": "2015-07-19T22:22:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18554#issuecomment-252388",
    "user": "Rudi"
}
```

Hi Chao,

just saw that you had finished this one. I have some comments on the code below:

```
        m = k-1
        E = set(self.groundset())
        w = {e:1 for e in E}
        Q = set(list(E)[:m])
        E = E-Q
        for r in range(len(Q)/2):
            for Q1 in map(set,combinations(Q, r)):
                Q2 = Q-Q1
                # Given Q1, Q2 partition of Q, find all extensions
                for A in map(set,combinations(E, m - len(Q1))):
                    T = Q1|A
                    for B in map(set,combinations(E-A, m - len(Q2))):
                        S = Q2|B
                        I, _ = self._link(S, T)
                        if(len(I) - self.full_rank() + self.rank(S) + self.rank(T) < m):
                            if certificate:
                                return False, I
                            return False
```

- w is defined but not used
- `I` is not the min separation, but the max connector. If you have `I, X = self._link(S, T)`, then `return False, X`. You could even do without `I` if you tested the connectivity by `if self._connectivity(X)<m:`
- if `r == len(Q)/2`, then the unordered pair {Q1, Q2} is generated and tested twice. 

The set of pairs {S,T} tested by your code is what Bixby & Cunningham describe in their paper to argue that O(n<sup>k</sup>) connectivity tests are enough. It will not be possible to attain o(n<sup>k</sup>) pairs, but the constant hidden by the O() can be significantly better. 

E.g. in the r-th iteration, set aside r elements R from E-Q, also split R in all possible ways R1, R2, and then put S= Q1|R1|A, T=Q2|R2|B. The A and B you need are now smaller (|A|+|B| went down by r), hence fewer possibilities. Another optimization is this: once you are done testing all A containing a given e, you have established that e must be on the other side of the separation and so you may as well fix it in B, again reducing the number of possibilities for B. And this can be iterated of course.

For a positive review, it would be enough that you fix the above three points, and that the code passes some tests I will run of course. Optimizing the number of connectivity tests is not necessary, but would be appreciated. It is actually an interesting question what is the minimum number of tests as a function of n,k here.



---

archive/issue_comments_252389.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-22T02:10:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18554#issuecomment-252389",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_252390.json:
```json
{
    "body": "Made updates incorporating your suggestions. \n\nAlso fixed a bug. `r == len(Q)/2` case never happens because I was using `range(len(Q)/2)`. I should use `range(len(Q)/2+1)` instead.",
    "created_at": "2015-07-22T05:36:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18554#issuecomment-252390",
    "user": "chaoxu"
}
```

Made updates incorporating your suggestions. 

Also fixed a bug. `r == len(Q)/2` case never happens because I was using `range(len(Q)/2)`. I should use `range(len(Q)/2+1)` instead.



---

archive/issue_comments_252391.json:
```json
{
    "body": "Thanks Chao. \n\nI'm getting a bug now:\n\n```\nsage: M= matroids.named_matroids.ExtendedBinaryGolayCode()\nsage: M.is_kconnected(5)\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\n  File \"_sage_input_6.py\", line 10, in <module>\n    exec compile(u'open(\"___code___.py\",\"w\").write(\"# -*- coding: utf-8 -*-\\\\n\" + _support_.preparse_worksheet_cell(base64.b64decode(\"TS5pc19rY29ubmVjdGVkKDUp\"),globals())+\"\\\\n\"); execfile(os.path.abspath(\"___code___.py\"))\n  File \"\", line 1, in <module>\n    \n  File \"/private/var/folders/s7/fnz1zdzd12d3v1q0fns6sdww0000gn/T/tmpyBf3z_/___code___.py\", line 3, in <module>\n    exec compile(u'M.is_kconnected(_sage_const_5 )\n  File \"\", line 1, in <module>\n    \n  File \"sage/matroids/matroid.pyx\", line 4782, in sage.matroids.matroid.Matroid.is_kconnected (/Users/rudi/Documents/Development/sage-6.7/src/build/cythonized/sage/matroids/matroid.c:38299)\n  File \"sage/matroids/matroid.pyx\", line 4879, in sage.matroids.matroid.Matroid.is_kconnected (/Users/rudi/Documents/Development/sage-6.7/src/build/cythonized/sage/matroids/matroid.c:37668)\nValueError: r must be non-negative\n```\n",
    "created_at": "2015-07-22T07:03:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18554#issuecomment-252391",
    "user": "Rudi"
}
```

Thanks Chao. 

I'm getting a bug now:

```
sage: M= matroids.named_matroids.ExtendedBinaryGolayCode()
sage: M.is_kconnected(5)
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "_sage_input_6.py", line 10, in <module>
    exec compile(u'open("___code___.py","w").write("# -*- coding: utf-8 -*-\\n" + _support_.preparse_worksheet_cell(base64.b64decode("TS5pc19rY29ubmVjdGVkKDUp"),globals())+"\\n"); execfile(os.path.abspath("___code___.py"))
  File "", line 1, in <module>
    
  File "/private/var/folders/s7/fnz1zdzd12d3v1q0fns6sdww0000gn/T/tmpyBf3z_/___code___.py", line 3, in <module>
    exec compile(u'M.is_kconnected(_sage_const_5 )
  File "", line 1, in <module>
    
  File "sage/matroids/matroid.pyx", line 4782, in sage.matroids.matroid.Matroid.is_kconnected (/Users/rudi/Documents/Development/sage-6.7/src/build/cythonized/sage/matroids/matroid.c:38299)
  File "sage/matroids/matroid.pyx", line 4879, in sage.matroids.matroid.Matroid.is_kconnected (/Users/rudi/Documents/Development/sage-6.7/src/build/cythonized/sage/matroids/matroid.c:37668)
ValueError: r must be non-negative
```




---

archive/issue_comments_252392.json:
```json
{
    "body": "You use `self._connectivity(X, E-X)` now, but what I meant was `self.connectivity(X)`. That one simply computes rank(X)+rank(E-X)-rank(E), the other one does the whole matroid matching thing again.",
    "created_at": "2015-07-22T07:41:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18554#issuecomment-252392",
    "user": "Rudi"
}
```

You use `self._connectivity(X, E-X)` now, but what I meant was `self.connectivity(X)`. That one simply computes rank(X)+rank(E-X)-rank(E), the other one does the whole matroid matching thing again.



---

archive/issue_comments_252393.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-22T14:52:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18554#issuecomment-252393",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_252394.json:
```json
{
    "body": "Fixed.\nHmm, it's easy to introduce bugs with so many variables...",
    "created_at": "2015-07-23T03:07:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18554#issuecomment-252394",
    "user": "chaoxu"
}
```

Fixed.
Hmm, it's easy to introduce bugs with so many variables...



---

archive/issue_comments_252395.json:
```json
{
    "body": "Code looks good to me. It's a lot faster than before too..\n\nI tested with\n\n```\ndef matroid_with_k_separation(r,n,k):\n    if r<=k or n<=2*k:\n        return\n    A=MatrixSpace(GF(293),r,n).random_element()\n    m = ZZ.random_element(k,n/2)\n    X = set(Subsets(range(n), m).random_element())\n    Y = set(range(n))-X\n    s = ZZ.random_element(max(m-n+r,0), min(m-k, r-k)+1)\n    for i in range(s+k, r):\n        for j in X:\n            A[i,j] =0\n    for i in range(s+1):\n        for j in Y:\n            A[i,j] =0        \n    return Matroid(A),X\n```\n\nto get a matroid with a k-separation and \n\n```\nk=5\nfor i in range(100):\n    M, X = matroid_with_k_separation(12,24,k-1)\n    print M\n    c, X = M.is_kconnected(k,True)\n    if c or M.connectivity(X)>k-1 or min(len(X), len(M.groundset()-X))<=M.connectivity(X):\n        print '!!'\n        break\n```\n\nto test-drive the code on some random examples. \n\nPositive review.",
    "created_at": "2015-07-24T15:06:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18554#issuecomment-252395",
    "user": "Rudi"
}
```

Code looks good to me. It's a lot faster than before too..

I tested with

```
def matroid_with_k_separation(r,n,k):
    if r<=k or n<=2*k:
        return
    A=MatrixSpace(GF(293),r,n).random_element()
    m = ZZ.random_element(k,n/2)
    X = set(Subsets(range(n), m).random_element())
    Y = set(range(n))-X
    s = ZZ.random_element(max(m-n+r,0), min(m-k, r-k)+1)
    for i in range(s+k, r):
        for j in X:
            A[i,j] =0
    for i in range(s+1):
        for j in Y:
            A[i,j] =0        
    return Matroid(A),X
```

to get a matroid with a k-separation and 

```
k=5
for i in range(100):
    M, X = matroid_with_k_separation(12,24,k-1)
    print M
    c, X = M.is_kconnected(k,True)
    if c or M.connectivity(X)>k-1 or min(len(X), len(M.groundset()-X))<=M.connectivity(X):
        print '!!'
        break
```

to test-drive the code on some random examples. 

Positive review.



---

archive/issue_comments_252396.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-07-24T15:06:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18554#issuecomment-252396",
    "user": "Rudi"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_252397.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-07-27T15:15:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18554",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18554#issuecomment-252397",
    "user": "vbraun"
}
```

Resolution: fixed
