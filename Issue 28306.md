# Issue 28306: Improve computation of connection coefficients

Issue created by migration from https://trac.sagemath.org/ticket/28543

Original creator: egourgoulhon

Original creation time: 2019-09-27 14:06:34

CC:  tscrim

Keywords: affine_connection, manifold

The coefficients of an affine connection D in a frame (e<sub>i</sub>) are computed according to the formula

Gamma<sup>k</sup><sub>ij</sub> = (De<sub>i</sub>)(f<sub>k</sub> , e<sub>j</sub>)

where (f<sub>k</sub>) stands for the coframe dual to (e<sub>i</sub>). In the current implementation, this is performed by a triple loop on k, i and j with a recomputation of De<sub>i</sub> at each stage of the inner loop (!). This makes the whole computation terribly slow for manifold dimensions > 2. This ticket reorders the loops, factoring De<sub>i</sub>. As a result, in Sage 8.9.rc1, we pass from 

```
sage -t --long src/sage/manifolds/differentiable/affine_connection.py
    [441 tests, 132.77 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 132.9 seconds
    cpu time: 152.0 seconds
    cumulative wall time: 132.8 seconds
```

to


---

Comment by egourgoulhon created at 2019-09-27 15:02:24

New commits:


---

Comment by egourgoulhon created at 2019-09-27 15:04:04

Changing status from new to needs_review.


---

Comment by tscrim created at 2019-09-27 22:11:32

Yes, definitely a good idea to pull these out and not redo these computations. LGTM.


---

Comment by tscrim created at 2019-09-27 22:11:32

Changing status from needs_review to positive_review.


---

Comment by egourgoulhon created at 2019-09-29 08:23:33

Thanks for the review!


---

Comment by vbraun created at 2019-10-06 23:07:12

Resolution: fixed
