# Issue 25763: sage with 64 bit openblas

Issue created by migration from https://trac.sagemath.org/ticket/26000

Original creator: @timokau

Original creation time: 2018-08-04 15:15:03

Keywords: openblas

By default, openblas compiles with a 32 bit interface (even when the binary is 64 bit). To build with the 64 bit interface, you have to set the [INTERFACE64](https://github.com/xianyi/OpenBLAS/blob/b03ae3f4dc90a3bde83b98f3fd67e8c618c0390b/Makefile.rule#L115) environment variable. [Here](https://github.com/Homebrew/homebrew-science/issues/48#issuecomment-11636954) is some discussion about the differences.


---

Attachment


---

Attachment


---

Comment by @timokau created at 2018-08-05 11:32:55

New commits:


---

Comment by jdemeyer created at 2018-08-07 14:17:10

Replying to [ticket:26000 gh-timokau]:
> By default, openblas compiles with a 32 bit interface (even when the binary is 64 bit). To build with the 64 bit interface, you have to set the [INTERFACE64](https://github.com/xianyi/OpenBLAS/blob/b03ae3f4dc90a3bde83b98f3fd67e8c618c0390b/Makefile.rule#L115) environment variable. [Here](https://github.com/Homebrew/homebrew-science/issues/48#issuecomment-11636954) is some discussion about the differences.

After reading that page, I don't think that we should enable INTERFACE64. An environment variable to change the API? That makes no sense to me...

So why should we do this?


---

Comment by @timokau created at 2018-08-07 18:16:29

Did you maybe misunderstand that? Its a configure-time variable, nothing unusual. Not runtime.

The advantages would be higher precision data types and higher compatibility with system openblas.


---

Comment by jdemeyer created at 2018-08-07 19:16:02

Replying to [comment:4 gh-timokau]:
> higher compatibility with system openblas.

Do distros set INTERFACE64?


---

Comment by @timokau created at 2018-08-07 19:56:56

In nix we have two versions, `openblas` and `openblasCompat`. `openblas` uses `INTERFACE64` on 64 bit machines while `openblasCompat` always uses 32.

Its harder for other distros to have multiple variants of the same library though, so maybe they just use the `Compat` version all the time. I don't know for sure. Either way, if we figure out where the `INTERFACE64` failures are coming from we would keep compatibility for 32 bit anyways. So it would be a win-win.


---

Comment by jdemeyer created at 2018-08-10 19:36:33

Replying to [comment:6 gh-timokau]:
> In nix we have two versions, `openblas` and `openblasCompat`. `openblas` uses `INTERFACE64` on 64 bit machines while `openblasCompat` always uses 32.

So then use `openblasCompat`.

It's still not clear which bug this ticket is supposed to fix...


---

Comment by @timokau created at 2018-08-10 20:57:57

Replying to [comment:7 jdemeyer]:
> It's still not clear which bug this ticket is supposed to fix...

Its an enhancement. Nix specific, using openblasCompat means we also have to build two versions of flint and two versions of all the sage dependencies that depend on flint. Thats a bit annoying.

In general, 64 bit is not only the future, I would argue it is the present. I don't know how long other distros will keep INTERFACET64=0 (if they currently do that). And ignoring distros for the moment, the main reason for 64 bit are 64 bit datatypes of course.
