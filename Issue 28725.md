# Issue 28725: Have the Sage version number present on every page of the documentation

Issue created by migration from https://trac.sagemath.org/ticket/28962

Original creator: @Tinkidinki

Original creation time: 2020-01-06 19:03:07

Keywords: version website

Generally, documentation pages are reached by googling, and it would be convenient to have the Sage version number on every page of the documentation. 

While this is present on the first page of the references, on the top left corner here: https://doc.sagemath.org/html/en/reference/index.html#discrete-mathematics , it is not present on every other page. For example, a random page that appeared after googling 'sage matrices': 
http://doc.sagemath.org/html/en/reference/matrices/sage/matrix/constructor.html

This would especially be convenient when previous version documentation is archived somewhere, to know what version number it corresponds to. 

For example, version 9.0 of sage has the following page for "named permutation groups": http://doc.sagemath.org/html/en/reference/groups/sage/groups/perm_gps/permgroup_named.html 
while an archived docpage on some other website has this, which has  a few differences from the original: https://www.math.sciences.univ-nantes.fr/~sorger/chow/html/en/reference/groups/sage/groups/perm_gps/permgroup_named.html

Now, the archived version seems to be v6.4.1, found after clicking "index" on the top right: https://www.math.sciences.univ-nantes.fr/~sorger/chow/html/en/reference/genindex.html

However, this is not apparent at all while looking at the docs. 

So, basically: would like to have the Sage version number on every page of the documentation somewhere. 



---

Comment by @mwageringel created at 2020-01-06 21:20:08

The version number is actually in the title of the HTML page (possibly hover the tab in your browser to fully see it), but I agree it would be nice if this was more visible.


---

Comment by jhpalmieri created at 2020-01-06 23:04:23

A patch like this helps, but it could probably be tinkered with:

```diff
diff --git a/src/doc/en/reference/conf_sub.py b/src/doc/en/reference/conf_sub.py
index 058fc01101..fdc8556550 100644
--- a/src/doc/en/reference/conf_sub.py
+++ b/src/doc/en/reference/conf_sub.py
@@ -39,14 +39,14 @@ if not title:
 title = title.replace(u'`', u'$')
 
 # General information about the project.
-project = u'Sage Reference Manual: ' + title
+project = u'Sage {} Reference Manual: '.format(release) + title
 
 # The name for this set of Sphinx documents.  If None, it defaults to
 # "<project> v<release> documentation".
-html_title = u'Sage Reference Manual v' + release + ': ' + title
+html_title = project
 
 # A shorter title for the navigation bar.  Default is the same as html_title.
-html_short_title = title
+html_short_title = project
 
 # HTML theme (e.g., 'default', 'sphinxdoc').  The pages for the
 # reference manual use a custom theme, a slight variant on the 'sage'
```



---

Comment by @Tinkidinki created at 2020-01-08 18:51:59

Replying to [comment:2 jhpalmieri]:
> A patch like this helps, but it could probably be tinkered with:
> {{{
> #!diff
> diff --git a/src/doc/en/reference/conf_sub.py b/src/doc/en/reference/conf_sub.py
> index 058fc01101..fdc8556550 100644
> --- a/src/doc/en/reference/conf_sub.py
> +++ b/src/doc/en/reference/conf_sub.py
> `@``@` -39,14 +39,14 `@``@` if not title:
>  title = title.replace(u'`', u'$')
>  
>  # General information about the project.
> -project = u'Sage Reference Manual: ' + title
> +project = u'Sage {} Reference Manual: '.format(release) + title
>  
>  # The name for this set of Sphinx documents.  If None, it defaults to
>  # "<project> v<release> documentation".
> -html_title = u'Sage Reference Manual v' + release + ': ' + title
> +html_title = project
>  
>  # A shorter title for the navigation bar.  Default is the same as html_title.
> -html_short_title = title
> +html_short_title = project
>  
>  # HTML theme (e.g., 'default', 'sphinxdoc').  The pages for the
>  # reference manual use a custom theme, a slight variant on the 'sage'
> }}}

Thank you! This looks good. I'm a little new to this - so can you confirm if this is how it works?

I did a checkout ticket number, and a local branch got created. The code changes that you mention in this comment were not present in it though. 

Assuming whatever you wrote in this comment is the way to fix the issue, how does one go about fixing it?

1) Do I just make the changes on my local branch and then push?
2) How can I see how the HTML page will look locally first?
3) What are the steps for it to finally reflect in the actual documentation?

If any of those questions can be answered by just reading a resource, please just point me there. 

Thank you very much!


---

Comment by jhpalmieri created at 2020-01-08 19:08:23

Right, I didn't post a branch, so checking out this ticket doesn't do anything, as you observed. You can make the changes on your local branch (for example, click the "Unified" button on my proposed patch, select the patch, paste to a file, and do `git apply FILE`). Once you've done that, build the documentation with `make`. The main documentation will be in `local/share/doc/sage/html/en`, so you could for example open `local/share/doc/sage/html/en/index.html` in a browser. You should also check non-English documentation by opening files in `local/share/doc/sage/html/[LANGUAGE]/` for appropriate values of `[LANGUAGE]`.


---

Comment by @Tinkidinki created at 2020-01-09 13:52:58

I get the following error when I try to apply the patch:


```
error: patch with only garbage at line 3
```


As an aside, for small changes, is there an advantage to applying a patch over normally editing the file?


---

Comment by git created at 2020-01-14 10:57:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @Tinkidinki created at 2020-01-14 15:38:29

Changing status from new to needs_review.


---

Comment by @Tinkidinki created at 2020-01-14 15:38:29

Tested that the code works on random English references pages. Other languages did not seem to have refererences pages - only single page tutorials. 

Can anyone review if this is okay?


---

Comment by @mwageringel created at 2020-02-03 19:25:16

Thank you. This looks good to me. The documentation files of the other languages already include the version number, so nothing needs to be changed there.

I have squashed your commits. Please add your full name to the Authors field of this ticket.
----
New commits:


---

Comment by @mwageringel created at 2020-02-10 21:23:34

Changing status from needs_review to positive_review.


---

Comment by @mwageringel created at 2020-02-10 21:25:48

Changing status from positive_review to needs_work.


---

Comment by @mwageringel created at 2020-02-10 21:25:48

Actually, there is a failing doctest.


---

Comment by git created at 2020-02-10 21:32:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @mwageringel created at 2020-02-10 21:33:59

Changing status from needs_work to needs_review.


---

Comment by @mwageringel created at 2020-02-10 21:33:59

Should be fixed now. If the patchbot is green, this can be set back to positive.


---

Comment by @mwageringel created at 2020-02-11 22:02:36

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2020-02-17 23:15:59

Resolution: fixed
