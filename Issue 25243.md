# Issue 25243: upgrade cryptominisat (and put back as optional)

Issue created by migration from Trac.

Original creator: vdelecroix

Original creation time: 2018-05-31 10:32:30

CC:  tmonteil embray saraedum slelievre

Upstream cryptominisat fixed compilation issues. There is a prerelease available at

    https://github.com/msoos/cryptominisat/releases/tag/5.6.0


---

Comment by vdelecroix created at 2018-05-31 10:35:32

Experimental branch (for the prerelease). I will update the branch as soon as the definitive release is out. Please test in the meantime (works for me with Python2 but did not check with Python3).
----
New commits:


---

Comment by slelievre created at 2018-05-31 10:58:16

Changing keywords from "" to "cryptominisat, upgrade".


---

Comment by slelievre created at 2018-06-11 12:09:39

Cryptominisat 5.6.3 was released, do you mind using that instead of 5.6.1?


---

Comment by vdelecroix created at 2018-06-17 10:00:08

Still not able to build crypotiminisat (archlinux and gcc 8.1.1)

```
[ 84%] Building CXX object cmsat5-src/CMakeFiles/libcryptominisat5.dir/cryptominisat.cpp.o
cd /opt/sage/local/var/tmp/sage/build/cryptominisat-5.6.3/src/cmsat5-src && /usr/lib/ccache/bin/g++  -DBOOST_TEST_DYN_LINK -DUSE_GAUSS -DUSE_M4RI -DUSE_ZLIB -Dlibcryptominisat5_EXPORTS -I/opt
/sage/local/include -I/opt/sage/local/var/tmp/sage/build/cryptominisat-5.6.3/src -I/opt/sage/local/var/tmp/sage/build/cryptominisat-5.6.3/src/cmsat5-src  -mtune=native -Wall -Wextra -Wunused 
-Wsign-compare -fno-omit-frame-pointer -Wtype-limits -Wuninitialized -Wno-deprecated -Wstrict-aliasing -Wpointer-arith -Wpointer-arith -Wformat-nonliteral -Winit-self -Wparentheses -Wunreacha
ble-code -ggdb3 -Wlogical-op -Wrestrict -Wnull-dereference -Wdouble-promotion -Wshadow -Wformat=2 -Wextra-semi -pedantic -Wno-class-memaccess -fPIC   -g -pthread -O2 -mtune=native -fPIC -std=
gnu++11 -o CMakeFiles/libcryptominisat5.dir/cryptominisat.cpp.o -c /opt/sage/local/var/tmp/sage/build/cryptominisat-5.6.3/src/src/cryptominisat.cpp
../src/cryptominisat.cpp:1059:17: error: no declaration matches 'void CMSat::SATSolver::start_getting_small_clauses(uint32_t, uint32_t)'
 void DLL_PUBLIC SATSolver::start_getting_small_clauses(uint32_t max_len, uint32_t max_glue)
                 ^~~~~~~~~
../src/cryptominisat.cpp:1059:17: note: no functions named 'void CMSat::SATSolver::start_getting_small_clauses(uint32_t, uint32_t)'
In file included from ../src/cryptominisat.cpp:24:
../../../../../../../include/cryptominisat5/cryptominisat.h:41:11: note: 'class CMSat::SATSolver' defined here
     class SATSolver
           ^~~~~~~~~
../src/cryptominisat.cpp:1065:17: error: no declaration matches 'bool CMSat::SATSolver::get_next_small_clause(std::vector<CMSat::Lit>&)'
 bool DLL_PUBLIC SATSolver::get_next_small_clause(std::vector<Lit>& out)
                 ^~~~~~~~~
../src/cryptominisat.cpp:1065:17: note: no functions named 'bool CMSat::SATSolver::get_next_small_clause(std::vector<CMSat::Lit>&)'
In file included from ../src/cryptominisat.cpp:24:
../../../../../../../include/cryptominisat5/cryptominisat.h:41:11: note: 'class CMSat::SATSolver' defined here
     class SATSolver
           ^~~~~~~~~
../src/cryptominisat.cpp:1071:17: error: no declaration matches 'void CMSat::SATSolver::end_getting_small_clauses()'
 void DLL_PUBLIC SATSolver::end_getting_small_clauses()
                 ^~~~~~~~~
../src/cryptominisat.cpp:1071:17: note: no functions named 'void CMSat::SATSolver::end_getting_small_clauses()'
In file included from ../src/cryptominisat.cpp:24:
../../../../../../../include/cryptominisat5/cryptominisat.h:41:11: note: 'class CMSat::SATSolver' defined here
     class SATSolver
           ^~~~~~~~~
make[4]: *** [cmsat5-src/CMakeFiles/libcryptominisat5.dir/build.make:596: cmsat5-src/CMakeFiles/libcryptominisat5.dir/cryptominisat.cpp.o] Error 1
make[4]: Leaving directory '/opt/sage/local/var/tmp/sage/build/cryptominisat-5.6.3/src'
make[3]: *** [CMakeFiles/Makefile2:198: cmsat5-src/CMakeFiles/libcryptominisat5.dir/all] Error 2
make[3]: Leaving directory '/opt/sage/local/var/tmp/sage/build/cryptominisat-5.6.3/src'
make[2]: *** [Makefile:130: all] Error 2
make[2]: Leaving directory '/opt/sage/local/var/tmp/sage/build/cryptominisat-5.6.3/src'
********************************************************************************
Error building cryptominisat-5.6.3
********************************************************************************
```



---

Comment by git created at 2018-06-17 10:05:16

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2018-07-05 06:36:51

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2018-07-05 06:37:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2018-07-05 06:38:14

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2018-07-05 09:01:43

cryptominisat links to libm4ri, so that should be a normal dependency:

```
        linux-vdso64.so.1 =>  (0x00003fff925a0000)
        libm4ri-0.0.20140914.so => /home/jdemeyer/sage-test/local/lib/libm4ri-0.0.20140914.so (0x00003fff923f0000)
        libstdc++.so.6 => /usr/lib/powerpc64le-linux-gnu/libstdc++.so.6 (0x00003fff921d0000)
        libm.so.6 => /lib/powerpc64le-linux-gnu/libm.so.6 (0x00003fff920e0000)
        libgcc_s.so.1 => /lib/powerpc64le-linux-gnu/libgcc_s.so.1 (0x00003fff920b0000)
        libpthread.so.0 => /lib/powerpc64le-linux-gnu/libpthread.so.0 (0x00003fff92070000)
        libc.so.6 => /lib/powerpc64le-linux-gnu/libc.so.6 (0x00003fff91ea0000)
        libpng16.so.16 => /home/jdemeyer/sage-test/local/lib/libpng16.so.16 (0x00003fff91e20000)
        /lib64/ld64.so.2 (0x00003fff925c0000)
        libz.so.1 => /home/jdemeyer/sage-test/local/lib/libz.so.1 (0x00003fff91de0000)
```



---

Comment by jdemeyer created at 2018-07-05 09:01:43

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2018-07-05 09:03:29

Same for libz and libpng.


---

Comment by jdemeyer created at 2018-07-05 14:41:41

This seems to build only Python 3 bindings. From the logfile:

```
-- Found PythonInterp: /home/jdemeyer/sage-git/local/bin/python3 (found suitable version "3.6.1", minimum required is "3")
-- Found PythonLibs: /home/jdemeyer/sage-git/local/lib/libpython3.6m.so (found suitable version "3.6.1", minimum required is "3")
-- Python 3 -- PYTHON_EXECUTABLE=/home/jdemeyer/sage-git/local/bin/python3
-- Python 3 -- PYTHON_LIBRARIES=/home/jdemeyer/sage-git/local/lib/libpython3.6m.so
-- Python 3 -- PYTHON_INCLUDE_DIRS=/home/jdemeyer/sage-git/local/include/python3.6m
-- Python 3 -- PYTHONLIBS_VERSION_STRING=3.6.1
```



---

Comment by git created at 2018-07-05 15:59:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2018-07-05 16:00:25

Changing status from needs_work to needs_review.


---

Comment by vdelecroix created at 2018-07-05 16:00:25

It is apparently not possible to compile for both Python2 and Python3 (see [issue 498](https://github.com/msoos/cryptominisat/issues/498)). For now Python2 is forced.


---

Comment by vdelecroix created at 2018-07-05 16:04:22

Changing status from needs_review to needs_work.


---

Comment by vdelecroix created at 2018-07-05 16:04:22

This is annoying

```
-- Found m4ri: /usr/lib/libm4ri.so  
-- OK, Found M4RI lib at /usr/lib/libm4ri.so and includes at /usr/include
```

should be using the one from Sage...


---

Comment by vdelecroix created at 2018-07-05 16:08:11

Though linking looks fine

```
$ ldd /opt/sage/local/lib/libcryptominisat5.so
...
        libm4ri-0.0.20140914.so => /opt/sage/local/lib/libm4ri-0.0.20140914.so (0x00007f10dc270000)
...
```



---

Comment by git created at 2018-07-09 14:40:39

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by vdelecroix created at 2018-07-09 14:42:19

rebased on rc0. Installation should work with both python2 and python3.

I was not able to properly fix the configuration to detect m4ri nicely.


---

Comment by vdelecroix created at 2018-07-09 14:42:19

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2018-07-09 18:38:28

[comment:13]


---

Comment by jdemeyer created at 2018-07-09 18:38:28

Changing status from needs_review to needs_work.


---

Comment by vdelecroix created at 2018-07-10 07:28:51

Not happy with?

```diff
diff --git a/build/pkgs/cryptominisat/dependencies b/build/pkgs/cryptominisat/dependencies
index df51e31274..a199426946 100644
--- a/build/pkgs/cryptominisat/dependencies
+++ b/build/pkgs/cryptominisat/dependencies
`@``@` -1,4 +1,4 `@``@`
-$(PYTHON) | cmake sqlite m4ri boost_cropped
+$(PYTHON) | cmake sqlite m4ri boost_cropped zlib libpng
```



---

Comment by vdelecroix created at 2018-07-10 07:28:51

Changing status from needs_work to needs_info.


---

Comment by jdemeyer created at 2018-07-10 07:32:08

I meant *normal dependencies* meaning before the `|` symbol.


---

Comment by git created at 2018-07-10 19:57:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2018-07-10 19:59:53

Changing status from needs_info to needs_review.


---

Comment by embray created at 2018-07-11 11:37:05

Changing status from needs_review to needs_work.


---

Comment by embray created at 2018-07-11 11:37:05

*sigh* It seems shortly after [my fix to DESTDIR support](https://github.com/msoos/cryptominisat/commit/697e4c446c58219b0075f2956a4a71df87447e69) they broke it again with https://github.com/msoos/cryptominisat/commit/63a629f5e363a467abff1fa29becf42fe55b79f9 and https://github.com/msoos/cryptominisat/commit/b3cd73f369d4ea14f12824f0f3c4a06a9aa0e1b1 by not understanding the difference between "root", "prefix", and "DESTDIR".  I will raise this issue once again upstream, but in the meantime, unless we want to wait for another upstream release, this will have to be patched again...


---

Comment by embray created at 2018-07-11 11:50:24

Upstream PR if you want to make a patch from it: https://github.com/msoos/cryptominisat/pull/499


---

Comment by embray created at 2018-07-11 11:51:19

Other than that issue, LGTM.


---

Comment by slelievre created at 2018-08-05 16:09:50

Cryptominisat 5.6.4 was released. Would be nice to get this in Sage 8.4.


---

Comment by tmonteil created at 2018-09-11 08:15:56

CryptoMiniSat 5.6.5 is out and contains Erik's fix, let's see how it works.


---

Attachment


---

Comment by tmonteil created at 2018-09-11 08:21:51

Not happy (see log).
----
New commits:


---

Comment by git created at 2018-12-21 17:03:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tmonteil created at 2018-12-21 17:06:40

Changing status from needs_work to needs_review.


---

Comment by tmonteil created at 2018-12-21 17:06:40

Seems to work well with 5.6.6 ! The only problem i found is when the `help2man` command from the `autotools` experimental package is available.


---

Comment by git created at 2019-01-04 20:15:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tmonteil created at 2019-01-04 20:17:18

I updated a doctest coming from #26676 (which has been merged). Still needs review.


---

Comment by vdelecroix created at 2019-01-05 08:30:45

builds fine and tests pass for me.


---

Comment by vdelecroix created at 2019-01-05 08:30:45

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-01-23 14:18:17

Resolution: fixed
