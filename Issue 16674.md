# Issue 16674: Update sagenb

Issue created by migration from Trac.

Original creator: ppurka

Original creation time: 2014-08-30 17:34:31

CC:  kcrisman snark fbissey

This ticket is for

1. updating sagenb
2. updating documentation inside sage to reflect the new development model for sagenb


---

Comment by kcrisman created at 2014-08-31 00:45:10

New commits:


---

Comment by git created at 2014-09-07 13:43:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ppurka created at 2014-09-07 13:52:08

Updated to new version with the upstream sagenb changes made to sphinx. The method to check it out is in description.

*Note*: this is not the final version of the sagenb package, since I haven't changed the Changelog, and it doesn't contain the changes from upstream ticket https://github.com/sagemath/sagenb/pull/218

Still, I am setting it to needs review so that the package itself can be tested against #16396


---

Comment by ppurka created at 2014-09-07 13:54:47

Changing status from new to needs_review.


---

Comment by Snark created at 2014-09-07 18:19:28

Changing status from needs_review to needs_work.


---

Comment by Snark created at 2014-09-07 18:19:28

Hmmmm... of course it fails to build since it's looking for upstream sources which we don't have... how shall I test this ticket and #16396 without it?


---

Comment by ppurka created at 2014-09-07 23:31:17

Installation instructions are in the ticket description. If you don't have wget then you can download the file manually from Google drive.


---

Comment by Snark created at 2014-09-08 10:51:25

Changing status from needs_work to positive_review.


---

Comment by Snark created at 2014-09-08 10:51:25

Sigh... and I had actually checked if it wasn't in the description!

It compiles and passes all doctests. I haven't yet looked at what it gives with #16396, but for this ticket, it's a positive review.


---

Comment by ppurka created at 2014-09-08 11:05:24

Thanks. It is not complete yet. I wanted to put it up here so that you can test your ticket.

Todo:

1. merge upstream ticket about documentation, and
2. update change log.


---

Comment by ppurka created at 2014-09-08 11:05:24

Changing status from positive_review to needs_work.


---

Comment by Snark created at 2014-09-08 14:51:59

I have checked that the ticket as-is passes all doctests, and makes #16396 also pass everything.


---

Comment by kcrisman created at 2014-09-08 15:46:39

Thanks for checking!  Have you played with the notebook itself to make sure there aren't any weird regressions (like the notebook not working...) that we missed?


---

Comment by Snark created at 2014-09-15 13:50:15

Hmmmm... I hadn't used the notebook since long, but I just failed to get a plot! Is there something wrong with:

```
from pylab import *
xs=linspace(0,6)
ys=sin(xs)
plot(xs,ys)
show()
```

?


---

Comment by kcrisman created at 2014-09-15 14:00:36

I'm not sure that ever worked.   A figure has to be saved for it to show up, and I don't know that matplotlib does that.

```
savefig('hi.png')
```

should work, however - try that.


---

Comment by kcrisman created at 2014-09-15 14:01:08

> I'm not sure that ever worked.   A figure has to be saved for it to show up, and I don't know that matplotlib does that.
> {{{
> savefig('hi.png')
> }}}
> should work, however - try that.
To be fair, in the Ipython notebook I assume that your code _does_ work :)


---

Comment by Snark created at 2014-09-15 14:19:47

Ah, yes, that's better... so it's a positive review?


---

Comment by Snark created at 2014-09-15 14:20:30

Though notice that I have the following in the logs:

```
/home/jpuydt/sage.git/local/lib/python2.7/site-packages/Crypto/Util/number.py:57: PowmInsecureWarning: Not using mpz_powm_sec.  You should rebuild using libgmp >= 5 to avoid timing attack vulnerability.
  _warn("Not using mpz_powm_sec.  You should rebuild using libgmp >= 5 to avoid timing attack vulnerability.", PowmInsecureWarning)
```



---

Comment by kcrisman created at 2014-09-15 14:24:05

That is known and unrelated.  You can try it in a Sage without this and probably you'll see the same thing.  I do in all my installs.

But as ppurka says [comment:11 here], there remains a little cosmetic work.


---

Comment by ppurka created at 2014-09-15 14:35:56

Thanks all. I will update the package by this weekend.


---

Comment by fbissey created at 2014-09-15 19:55:05

Replying to [comment:18 Snark]:
> Though notice that I have the following in the logs:
> {{{
> /home/jpuydt/sage.git/local/lib/python2.7/site-packages/Crypto/Util/number.py:57: PowmInsecureWarning: Not using mpz_powm_sec.  You should rebuild using libgmp >= 5 to avoid timing attack vulnerability.
>   _warn("Not using mpz_powm_sec.  You should rebuild using libgmp >= 5 to avoid timing attack vulnerability.", PowmInsecureWarning)
> }}}
Independent from this ticket. We have already seen that if I remember correctly and it won't go away for some time while we are using mpir to provide gmp.


---

Comment by kcrisman created at 2014-09-16 20:42:20

I'm happy with the instructions on the Sage side as well, or at least happier :)


---

Comment by kcrisman created at 2014-09-16 20:45:32

By the way, ppurka, there are a few other ready or almost-ready things that are actually fairly important upstream by migurehito, so if they come quick we should probably merge them too (things about admin errors).


---

Comment by kcrisman created at 2014-09-17 13:42:13

This should fix #11469.


---

Comment by git created at 2014-09-21 04:17:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ppurka created at 2014-09-21 04:32:39

Ok. I have updated sagenb upstream, the sagenb.tar, and added the new checksum. This is good to go. Setting it to positive review.


---

Comment by ppurka created at 2014-09-21 04:32:39

Changing status from needs_work to positive_review.


---

Comment by Snark created at 2014-09-24 18:23:13

Uh... Volker, why did you put #16396 as a dep of this ticket? That's the reverse as far as I know: sagenb's upgrade (#16911, here) blocks sphinx' upgrade (#16396), which blocks docutils' upgrade (#16733)... Or is there something I miss?


---

Comment by vbraun created at 2014-09-24 19:06:20

This ticket can be merged as soon as #16396 is done, so from an operational point of view we depend on #16396 and not the other way round.


---

Comment by Snark created at 2014-09-24 19:18:42

Uh... actually that's the reverse: the sphinx upgrade over at #16396 gives failing doctests until sagenb (#16911, here) has been upgraded.

Of course, if you merge both at the same time, that won't have any importance :-P


---

Comment by vbraun created at 2014-09-24 19:42:23

#16396 needs work, at least it says so on the ticket. So again, for ticket merging purposes, this ticket has to wait for #16396.


---

Comment by kcrisman created at 2014-10-21 17:16:14

Just FYI, FranÃ§ois has updated #16396 and Julien seems to have confirmed it works, just need for that one to have the one last check and then we're good to go here.


---

Comment by vbraun created at 2014-10-23 11:19:34

Resolution: fixed


---

Comment by gutow created at 2014-10-23 13:38:45

How can this ticket be fixed without the following?

To `@`vbraun: When merging this ticket, merge both this and #16396 since sagenb upstream has changes to fix doctests in that ticket, and that ticket in turn depends on an updated sagenb so that it can pass all doctests. Also close #11469 as that is incorporated here.


---

Comment by vbraun created at 2014-10-24 12:46:47

I merged #16396. Isn't that sufficient? Please please put dependencies in the dependency field, I can't read through every ticket description / discussion when merging.


---

Comment by kcrisman created at 2014-10-24 13:06:46

> I merged #16396. Isn't that sufficient? 
I think at the time it hadn't been merged, though I'm sure it was in your queue at that point.
> Please please put dependencies in the dependency field, I can't read through every ticket description / discussion when merging.
Yes, and the sagenb tickets aren't the only ones where this happens.  Perhaps a gentle reminder on sage-devel would be helpful, I'll do that.


---

Comment by jhpalmieri created at 2014-11-05 18:57:35

Was sagenb 0.11.0 merged as part of this ticket? For what it's worth, the tarball was not prepared correctly: it has two copies of most of the component pieces (like `Babel-1.3.tar.gz`). When you unpack it, it has at the top level another tarball called `sagenb-0.11.0.tar.gz` which contains a second copy of everything. This is why the "upstream" tarball is twice the size of the one for sagenb-0.10.8.2.


---

Comment by kcrisman created at 2014-11-05 19:04:59

> Was sagenb 0.11.0 merged as part of this ticket? 
It wasn't supposed to be.  That would have been #16004.
> For what it's worth, the tarball was not prepared correctly: it has two copies of most of the component pieces (like `Babel-1.3.tar.gz`). When you unpack it, it has at the top level another tarball called `sagenb-0.11.0.tar.gz` which contains a second copy of everything. This is why the "upstream" tarball is twice the size of the one for sagenb-0.10.8.2.
I just followed the instructions at https://gist.github.com/ppurka/d10f668db113c2d1ddd4 as recommended.  I wouldn't be surprised if I did something wrong, though.

I'd be happy to try to fix that but would need _very_ explicit instructions; I don't want to mess around trying to guess the right thing to do.


---

Comment by jhpalmieri created at 2014-11-05 19:21:04

I think that it can probably wait until the next sagenb update. By the way, I just noticed that since sagenb-0.10.8.2, I see the following message in the installation log file:

```
Note: Bypassing http://github.com/mitsuhiko/flask-oldsessions/tarball/master#egg=flask-oldsessions-0.10 (disallowed host; see http://bit.ly/1dg9ijs for details).
```

What does this mean?


---

Comment by kcrisman created at 2014-11-05 20:23:56

I also noticed that.  I believe it means we are supposed to download (see e.g. https://github.com/sagemath/sagenb/blob/master/util/fetch_deps.py)  that but didn't because somewhere we don't allow this host.  I don't know exactly where we use `easy_install`, though, so I couldn't easily debug that.


---

Comment by kcrisman created at 2014-11-06 01:51:48

> I think that it can probably wait until the next sagenb update. 
That may come sooner than you think; see #17292.


---

Comment by kcrisman created at 2014-11-06 16:38:41

> Was sagenb 0.11.0 merged as part of this ticket? For what it's worth, the tarball was not prepared correctly: it has two copies of most of the component pieces (like `Babel-1.3.tar.gz`). When you unpack it, it has at the top level another tarball called `sagenb-0.11.0.tar.gz` which contains a second copy of everything. This is why the "upstream" tarball is twice the size of the one for sagenb-0.10.8.2.

Looks like we will indeed be releasing a new one, so if you have an easy fix for this, I would appreciate that - you can communicate at https://github.com/sagemath/sagenb/issues or here or at #17292 or in private communication.


---

Comment by jhpalmieri created at 2014-11-06 18:46:44

I don't have an easy fix. It turns out that the big tarball contained a smaller tarball `sagenb-0.11.0.tar.gz` which actually was just the right thing: you could just keep the smaller one and use it in the upstream directory. I guess I would say, keep an eye on the file sizes. If it's much bigger than the previous one (for 0.10.8.2 or whatever it was), then something might be wrong.


---

Comment by kcrisman created at 2014-11-06 18:54:48

Hmm, then I guess the problem is that the instructions have an extra line.  Because [python setup.py sdist](https://docs.python.org/2/distutils/sourcedist.html) already makes a `.tar.gz`, and then we in addition do

```
tar cf sagenb-<version>.tar sagenb-<version>
```

which presumably leads to the tar file you found.  So that step is probably extra.


---

Comment by kcrisman created at 2014-11-06 21:42:49

> I don't have an easy fix. It turns out that the big tarball contained a smaller tarball `sagenb-0.11.0.tar.gz` which actually was just the right thing: you could just keep the smaller one and use it in the upstream directory. I guess I would say, keep an eye on the file sizes. If it's much bigger than the previous one (for 0.10.8.2 or whatever it was), then something might be wrong.

I dunno, I'm not convinced now.  I just repackaged a new one (it's not 100% ready, but just to test) and got

```
$ du sagenb-0.11.1.tar 
35824	sagenb-0.11.1.tar
$ du upstream/sagenb-0.10.8.2.tar 
33224	upstream/sagenb-0.10.8.2.tar
```

Given that there is a new jQuery and other goodies, this seems like a small difference.  I can confirm that the previous one was wrong, but I don't know how this happened.  I'll check in the future, though.


---

Comment by jhpalmieri created at 2014-11-06 23:39:33

I think that's probably okay. It's not twice the size, which is what happened before.
