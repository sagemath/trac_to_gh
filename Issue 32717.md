# Issue 32717: sage.libs.singular: On cygwin, do not try to reload the singular library

Issue created by migration from https://trac.sagemath.org/ticket/32954

Original creator: mkoeppe

Original creation time: 2021-12-01 17:47:28

CC:  mjo slelievre dimpase

(split out from #32789)

On the cygwin platform, there is no need to make library symbols global.

This sidesteps the issue of determining the correct DLL file name in #32789.

The branch is on top of other Cygwin fixes for convenience of testing.


---

Comment by mkoeppe created at 2021-12-01 17:47:36

Changing status from new to needs_review.


---

Comment by mjo created at 2021-12-01 18:02:16

Can you also remove the two cygwin-specific cases in spkg-configure.m4?


---

Comment by git created at 2021-12-01 18:48:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mjo created at 2021-12-01 23:05:27

Changing status from needs_review to positive_review.


---

Comment by mjo created at 2021-12-01 23:05:27

I wonder what, if anything, goes wrong on Linux/OSX if we skip the `dlopen()`. There isn't much of an explanation in the code. Maybe the whole thing is some crazy corner case.


---

Comment by mkoeppe created at 2021-12-01 23:09:11

Thanks.


---

Comment by slelievre created at 2021-12-02 19:00:45

With this branch, the sagemath_doc_html-none
build failure no longer seems to involve Singular.

```
$ make -s V=0 ptestlong
...
[sagemath_doc_html-none] installing. Log file: /home/s/sage9m/logs/pkgs/sagemath_doc_html-none.log
  [sagemath_doc_html-none] error installing, exit status 2. End of log file:
  [sagemath_doc_html-none]   [reference]     sat: 0 todos, 8 index, 4 citations, 7 modules
  [sagemath_doc_html-none]   [reference]     schemes: 5 todos, 53 index, 0 citations, 52 modules
  [sagemath_doc_html-none]   [reference]     semirings: 0 todos, 3 index, 0 citations, 2 modules
  [sagemath_doc_html-none]   [reference]     sets: 4 todos, 19 index, 0 citations, 18 modules
  [sagemath_doc_html-none]   [reference]     spkg: 0 todos, 341 index, 0 citations, 0 modules
  [sagemath_doc_html-none]   [reference]     stats: 0 todos, 11 index, 0 citations, 10 modules
  [sagemath_doc_html-none]   [reference]     structure: 7 todos, 32 index, 0 citations, 31 modules
  [sagemath_doc_html-none]   [reference]     tensor_free_modules: 2 todos, 19 index, 0 citations, 15 modules
  [sagemath_doc_html-none]   [reference]     topology: 0 todos, 14 index, 0 citations, 13 modules
  [sagemath_doc_html-none]   [reference]     valuations: 1 todos, 14 index, 0 citations, 13 modules
  [sagemath_doc_html-none]   [reference] ... done (358 todos, 2093 index, 1442 citations, 1730 modules)
  [sagemath_doc_html-none]   [reference] WARNING: Unable to fetch /home/s/sage9m/local/share/doc/sage/doctrees/en/reference/combinat/environment.pickle
  [sagemath_doc_html-none]   [reference] WARNING: Unable to fetch /home/s/sage9m/local/share/doc/sage/doctrees/en/reference/manifolds/environment.pickle
  [sagemath_doc_html-none]   [reference] preparing documents... skipping loading of indexes... done
  [sagemath_doc_html-none]   [reference] /home/s/sage9m/src/doc/en/reference/index.rst:85: WARNING: unknown document: combinat/index
  [sagemath_doc_html-none]   [reference] /home/s/sage9m/src/doc/en/reference/index.rst:102: WARNING: unknown document: manifolds/index
  [sagemath_doc_html-none]   [reference] The inventory files are in local/share/doc/sage/inventory/en/reference.
  [sagemath_doc_html-none]   Error building the documentation.
  [sagemath_doc_html-none]   Traceback (most recent call last):
  [sagemath_doc_html-none]     File "/usr/lib/python3.8/runpy.py", line 194, in _run_module_as_main
  [sagemath_doc_html-none]       return _run_code(code, main_globals, None,
  [sagemath_doc_html-none]     File "/usr/lib/python3.8/runpy.py", line 87, in _run_code
  [sagemath_doc_html-none]       exec(code, run_globals)
  [sagemath_doc_html-none]     File "/home/s/sage9m/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage_docbuild/__main__.py", line 2, in <module>
  [sagemath_doc_html-none]       main()
  [sagemath_doc_html-none]     File "/home/s/sage9m/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage_docbuild/__init__.py", line 1815, in main
  [sagemath_doc_html-none]       builder()
  [sagemath_doc_html-none]     File "/home/s/sage9m/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage_docbuild/__init__.py", line 133, in f
  [sagemath_doc_html-none]       runsphinx()
  [sagemath_doc_html-none]     File "/home/s/sage9m/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage_docbuild/sphinxbuild.py", line 323, in runsphinx
  [sagemath_doc_html-none]       sys.stderr.raise_errors()
  [sagemath_doc_html-none]     File "/home/s/sage9m/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/sage_docbuild/sphinxbuild.py", line 258, in raise_errors
  [sagemath_doc_html-none]       raise OSError(self._error)
  [sagemath_doc_html-none]   OSError: WARNING: Unable to fetch /home/s/sage9m/local/share/doc/sage/doctrees/en/reference/combinat/environment.pickle
  [sagemath_doc_html-none]
  [sagemath_doc_html-none]       Note: incremental documentation builds sometimes cause spurious
  [sagemath_doc_html-none]       error messages. To be certain that these are real errors, run
  [sagemath_doc_html-none]       "make doc-clean" first and try again.
  [sagemath_doc_html-none]   make[6]: *** [Makefile:20: doc-inventory--reference_top] Error 1
  [sagemath_doc_html-none]   make[5]: *** [Makefile:38: doc-inventory-reference] Error 2
  [sagemath_doc_html-none] Full log file: /home/s/sage9m/logs/pkgs/sagemath_doc_html-none.log
make[4]: *** [Makefile:2789: sagemath_doc_html-SAGE_DOCS-no-deps] Error 2
make[3]: *** [Makefile:2789: /home/s/sage9m/local/var/lib/sage/installed/sagemath_doc_html-none] Error 2
make[2]: *** [Makefile:2332: all-start] Error 2

real    670m5.381s
user    1085m16.267s
sys     293m31.592s
***************************************************************
Error building Sage.

The following package(s) may have failed to build (not necessarily
during this run of 'make all-start'):

It is safe to delete any log files and build directories, but they
contain information that is helpful for debugging build problems.
WARNING: If you now run 'make' again, the build directory of the
same version of the package will, by default, be deleted. Set the
environment variable SAGE_KEEP_BUILT_SPKGS=yes to prevent this.

make[1]: *** [Makefile:39: all-start] Error 1
make: *** [Makefile:13: all] Error 2
```



---

Comment by mkoeppe created at 2021-12-02 19:10:04

Yes, there are some other issues on Cygwin that now become visible. The actual error is further up in the log file `sagemath_doc_html-none.log`


---

Comment by vbraun created at 2021-12-12 15:09:21

Resolution: fixed
