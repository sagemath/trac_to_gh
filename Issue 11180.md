# Issue 11180: is_polynomial returns wrong results

archive/issues_011180.json:
```json
{
    "body": "Assignee: @burcin\n\nCC:  @kcrisman @burcin @hivert @RBKreckel\n\nKeywords: is_polynomial\n\n```\nsage: sage: el = -1/2*(2*x^2 - sqrt(2*x - 1)*sqrt(2*x + 1) - 1)\nsage: sage: el.is_polynomial(x)\nTrue\n```\nI definitely prefer to get `False`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/11352\n\n",
    "created_at": "2011-05-19T14:52:45Z",
    "labels": [
        "component: symbolics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7.1",
    "title": "is_polynomial returns wrong results",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11180",
    "user": "https://github.com/hivert"
}
```
Assignee: @burcin

CC:  @kcrisman @burcin @hivert @RBKreckel

Keywords: is_polynomial

```
sage: sage: el = -1/2*(2*x^2 - sqrt(2*x - 1)*sqrt(2*x + 1) - 1)
sage: sage: el.is_polynomial(x)
True
```
I definitely prefer to get `False`.

Issue created by migration from https://trac.sagemath.org/ticket/11352





---

archive/issue_comments_122668.json:
```json
{
    "body": "We just return GiNaC's response:\n\n```\n  cdef Expression symbol0 = self.coerce_in(var)\n  return self._gobj.is_polynomial(symbol0._gobj)\n```",
    "created_at": "2011-05-19T15:45:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11180#issuecomment-122668",
    "user": "https://github.com/vbraun"
}
```

We just return GiNaC's response:

```
  cdef Expression symbol0 = self.coerce_in(var)
  return self._gobj.is_polynomial(symbol0._gobj)
```



---

archive/issue_comments_122669.json:
```json
{
    "body": "Replying to [comment:1 vbraun]:\n> We just return GiNaC's response:\n> \n> ```\n>   cdef Expression symbol0 = self.coerce_in(var)\n>   return self._gobj.is_polynomial(symbol0._gobj)\n> ```\n\n\nSo this probably must be reported to GiNaC, isn't it ?",
    "created_at": "2011-05-19T15:53:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11180#issuecomment-122669",
    "user": "https://github.com/hivert"
}
```

Replying to [comment:1 vbraun]:
> We just return GiNaC's response:
> 
> ```
>   cdef Expression symbol0 = self.coerce_in(var)
>   return self._gobj.is_polynomial(symbol0._gobj)
> ```


So this probably must be reported to GiNaC, isn't it ?



---

archive/issue_comments_122670.json:
```json
{
    "body": "Changing assignee from @burcin to @hivert.",
    "created_at": "2011-05-19T15:55:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11180#issuecomment-122670",
    "user": "https://github.com/hivert"
}
```

Changing assignee from @burcin to @hivert.



---

archive/issue_comments_122671.json:
```json
{
    "body": "I just installed a fresh GiNaC on my computer and I've been able to reproduce the bug:\n\n```\n#include <iostream>\n#include <ginac/ginac.h>\n\nusing namespace std;\nusing namespace GiNaC;\n\nint main()\n{\n  symbol x(\"x\");\n  ex poly;\n\n  poly = sqrt(x*x+1)*sqrt(x+1);\n\n  cout << poly << endl;\n  cout << poly.is_polynomial(x) << endl;\n  return 0;\n}\n```\ngives\n\n```\nsqrt(1+x^2)*sqrt(1+x)\n1\n```\n\nSo I subscribed to ginac mailing list and reported the bug here. I'm waiting for an answer.\n\nFlorent",
    "created_at": "2011-05-19T21:39:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11180#issuecomment-122671",
    "user": "https://github.com/hivert"
}
```

I just installed a fresh GiNaC on my computer and I've been able to reproduce the bug:

```
#include <iostream>
#include <ginac/ginac.h>

using namespace std;
using namespace GiNaC;

int main()
{
  symbol x("x");
  ex poly;

  poly = sqrt(x*x+1)*sqrt(x+1);

  cout << poly << endl;
  cout << poly.is_polynomial(x) << endl;
  return 0;
}
```
gives

```
sqrt(1+x^2)*sqrt(1+x)
1
```

So I subscribed to ginac mailing list and reported the bug here. I'm waiting for an answer.

Florent



---

archive/issue_comments_122672.json:
```json
{
    "body": "> \n> So I subscribed to ginac mailing list and reported the bug here. I'm waiting for an answer.\n\n\nThanks for doing that, Florent.  By the way, can you put a link to the thread on the Ginac list here?",
    "created_at": "2011-05-20T00:40:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11180#issuecomment-122672",
    "user": "https://github.com/kcrisman"
}
```

> 
> So I subscribed to ginac mailing list and reported the bug here. I'm waiting for an answer.


Thanks for doing that, Florent.  By the way, can you put a link to the thread on the Ginac list here?



---

archive/issue_comments_122673.json:
```json
{
    "body": "> Thanks for doing that, Florent.  By the way, can you put a link to the thread on the Ginac list here?\n\n\nSure ! Here it is:\n\nhttp://www.ginac.de/pipermail/ginac-list/2011-May/001822.html",
    "created_at": "2011-05-20T06:28:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11180#issuecomment-122673",
    "user": "https://github.com/hivert"
}
```

> Thanks for doing that, Florent.  By the way, can you put a link to the thread on the Ginac list here?


Sure ! Here it is:

http://www.ginac.de/pipermail/ginac-list/2011-May/001822.html



---

archive/issue_comments_122674.json:
```json
{
    "body": "I just got the following answer:\n\n> thanks for reporting the bug. I am about to fix it.\n\n\nI'm not sure what will happen next: Should we backport the fix or update the whole ginac ?",
    "created_at": "2011-05-20T18:21:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11180#issuecomment-122674",
    "user": "https://github.com/hivert"
}
```

I just got the following answer:

> thanks for reporting the bug. I am about to fix it.


I'm not sure what will happen next: Should we backport the fix or update the whole ginac ?



---

archive/issue_comments_122675.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2011-05-20T18:21:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11180#issuecomment-122675",
    "user": "https://github.com/hivert"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_122676.json:
```json
{
    "body": "The bug seems to be fixed upstream, thanks to Richard B. Kreckel:\n\n> Anyway, in this case you'll have to port these two patches to Pynac:\n\n  \n   http://www.ginac.de/ginac.git?p=ginac.git;a=commitdiff;h=0c2f0f4c6d\n\n   http://www.ginac.de/ginac.git?p=ginac.git;a=commitdiff;h=293ff6f6fe\n\nAs I previously said, I'm not sure what to do next. Moreover, I'd rather let who knows about PyNaC and Sage symbolic internal handle the rests of this ticket. Please feel free to take ownership of it.",
    "created_at": "2011-05-20T21:39:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11180#issuecomment-122676",
    "user": "https://github.com/hivert"
}
```

The bug seems to be fixed upstream, thanks to Richard B. Kreckel:

> Anyway, in this case you'll have to port these two patches to Pynac:

  
   http://www.ginac.de/ginac.git?p=ginac.git;a=commitdiff;h=0c2f0f4c6d

   http://www.ginac.de/ginac.git?p=ginac.git;a=commitdiff;h=293ff6f6fe

As I previously said, I'm not sure what to do next. Moreover, I'd rather let who knows about PyNaC and Sage symbolic internal handle the rests of this ticket. Please feel free to take ownership of it.



---

archive/issue_comments_122677.json:
```json
{
    "body": "Thanks for following this through so far Florent. The next step is for me to make a new Pynac release with these patches. I will do this in the next few days, but it might be a while before this lands in a Sage release, since the next version of pynac will include fixes for #9880 and an upstream patch for #10964.",
    "created_at": "2011-05-21T00:13:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11180#issuecomment-122677",
    "user": "https://github.com/burcin"
}
```

Thanks for following this through so far Florent. The next step is for me to make a new Pynac release with these patches. I will do this in the next few days, but it might be a while before this lands in a Sage release, since the next version of pynac will include fixes for #9880 and an upstream patch for #10964.



---

archive/issue_comments_122678.json:
```json
{
    "body": "Changing assignee from @hivert to @burcin.",
    "created_at": "2011-05-21T00:13:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11180#issuecomment-122678",
    "user": "https://github.com/burcin"
}
```

Changing assignee from @hivert to @burcin.



---

archive/issue_comments_122679.json:
```json
{
    "body": "Hi Burcin,\n\nReplying to [comment:10 burcin]:\n> Thanks for following this through so far Florent. The next step is for me to make a new Pynac release with these patches. I will do this in the next few days, but it might be a while before this lands in a Sage release, since the next version of pynac will include fixes for #9880 and an upstream patch for #10964.\n\n\nI'm keeping an eye here. Count me as a volunteer if some help is needed for the review.",
    "created_at": "2011-05-21T06:40:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11180#issuecomment-122679",
    "user": "https://github.com/hivert"
}
```

Hi Burcin,

Replying to [comment:10 burcin]:
> Thanks for following this through so far Florent. The next step is for me to make a new Pynac release with these patches. I will do this in the next few days, but it might be a while before this lands in a Sage release, since the next version of pynac will include fixes for #9880 and an upstream patch for #10964.


I'm keeping an eye here. Count me as a volunteer if some help is needed for the review.



---

archive/issue_comments_122680.json:
```json
{
    "body": "Attachment [trac_11352-is_polynomial.patch](tarball://root/attachments/some-uuid/ticket11352/trac_11352-is_polynomial.patch) by @hivert created at 2011-05-26 09:23:44\n\nFrom the Ginac mailing list:\n\n```\nHi everybody,\n\nGiNaC 1.6.0 is out and available. You can find the changes at the end\nof this email.\n\nNote:\nThis release is not binary compatible to the previous one.\nAlso, we changed the name of the library filename from libginac-1.5 to\nlibginac. The ABI versioning is now done in recommended libtool\nmanner. The dynamic library will be created as libginac.so.2.0.0 this\ntime.\nWe also stopped to create extra branches in the repository for ABI\ncompatible versions. The latest releases will from now on always be in\nmaster.\n\nChanges:\n[...]\n* Fixed a bug in is_polynomial().\n[...]\n```\nSo we now \"only\" need to upgrade ginac.\n\nThere is no \"fixed upstream and released\" tag... I'm not sure if the current tag is correct.\nFlorent",
    "created_at": "2011-05-26T09:23:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11180#issuecomment-122680",
    "user": "https://github.com/hivert"
}
```

Attachment [trac_11352-is_polynomial.patch](tarball://root/attachments/some-uuid/ticket11352/trac_11352-is_polynomial.patch) by @hivert created at 2011-05-26 09:23:44

From the Ginac mailing list:

```
Hi everybody,

GiNaC 1.6.0 is out and available. You can find the changes at the end
of this email.

Note:
This release is not binary compatible to the previous one.
Also, we changed the name of the library filename from libginac-1.5 to
libginac. The ABI versioning is now done in recommended libtool
manner. The dynamic library will be created as libginac.so.2.0.0 this
time.
We also stopped to create extra branches in the repository for ABI
compatible versions. The latest releases will from now on always be in
master.

Changes:
[...]
* Fixed a bug in is_polynomial().
[...]
```
So we now "only" need to upgrade ginac.

There is no "fixed upstream and released" tag... I'm not sure if the current tag is correct.
Florent



---

archive/issue_comments_122681.json:
```json
{
    "body": "I won't rant about the tags. :) Note that this is still `needs_info`.\n\nUpstream is pynac in this case. I ported the patches in the GiNaC release to Pynac (this is easier than it sounds, you just ignore changes to files that don't exist), but didn't make a release yet. Here is the queue of patches which will be merged:\n\nhttps://bitbucket.org/burcin/pynac-patches/src",
    "created_at": "2011-05-26T09:29:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11180#issuecomment-122681",
    "user": "https://github.com/burcin"
}
```

I won't rant about the tags. :) Note that this is still `needs_info`.

Upstream is pynac in this case. I ported the patches in the GiNaC release to Pynac (this is easier than it sounds, you just ignore changes to files that don't exist), but didn't make a release yet. Here is the queue of patches which will be merged:

https://bitbucket.org/burcin/pynac-patches/src



---

archive/issue_comments_122682.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2011-05-31T15:14:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11180#issuecomment-122682",
    "user": "https://github.com/burcin"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_122683.json:
```json
{
    "body": "New pynac package which includes the patch for this is at #11415.\n\nattachment:trac_11352-is_polynomial.patch adds doctests.",
    "created_at": "2011-05-31T15:14:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11180#issuecomment-122683",
    "user": "https://github.com/burcin"
}
```

New pynac package which includes the patch for this is at #11415.

attachment:trac_11352-is_polynomial.patch adds doctests.



---

archive/issue_events_029450.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2011-05-31T15:14:41Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11180",
    "milestone": "sage-5.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11180#event-29450"
}
```



---

archive/issue_comments_122684.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-06-08T21:48:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11180#issuecomment-122684",
    "user": "https://github.com/kcrisman"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_122685.json:
```json
{
    "body": "Positive review.",
    "created_at": "2011-06-08T21:48:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11180#issuecomment-122685",
    "user": "https://github.com/kcrisman"
}
```

Positive review.



---

archive/issue_comments_122686.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2011-06-08T21:48:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11180#issuecomment-122686",
    "user": "https://github.com/kcrisman"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_122687.json:
```json
{
    "body": "Oops, browser windows closed too fast - I was on #10964 still :)",
    "created_at": "2011-06-08T21:49:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11180#issuecomment-122687",
    "user": "https://github.com/kcrisman"
}
```

Oops, browser windows closed too fast - I was on #10964 still :)



---

archive/issue_comments_122688.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-06-08T21:49:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11180#issuecomment-122688",
    "user": "https://github.com/kcrisman"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_122689.json:
```json
{
    "body": "Wiki markup here is different than on Sage wiki :(",
    "created_at": "2011-06-08T21:50:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11180#issuecomment-122689",
    "user": "https://github.com/kcrisman"
}
```

Wiki markup here is different than on Sage wiki :(



---

archive/issue_comments_122690.json:
```json
{
    "body": "Okay, now positive review!  Good catch by rbk, incidentally, with the `sqrt(2)*x` issue.",
    "created_at": "2011-06-08T21:54:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11180#issuecomment-122690",
    "user": "https://github.com/kcrisman"
}
```

Okay, now positive review!  Good catch by rbk, incidentally, with the `sqrt(2)*x` issue.



---

archive/issue_comments_122691.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-06-08T21:54:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11180#issuecomment-122691",
    "user": "https://github.com/kcrisman"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_029451.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-06-10T08:45:06Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11180",
    "milestone": "sage-5.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11180#event-29451"
}
```



---

archive/issue_events_029452.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-06-10T08:45:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11180",
    "milestone": "sage-4.7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11180#event-29452"
}
```



---

archive/issue_comments_122692.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-06-14T19:23:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11180",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11180#issuecomment-122692",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_029453.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-06-14T19:23:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11180",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11180#event-29453"
}
```
