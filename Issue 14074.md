# Issue 14074: Clear the cache of a cached representation

Issue created by migration from https://trac.sagemath.org/ticket/14278

Original creator: SimonKing

Original creation time: 2013-03-15 08:03:49

Assignee: jason

I have seen doctests that try to demonstrate how to clear a cache of class instances. See sage/modular/abvar/abvar_ambient_jacobian.py, for example.

This made me think: It would be nice to be able to define a class method for `CachedRepresentation` that clears the cache from all instances of this class.

With my patch, the following works:

```
            sage: class A(UniqueRepresentation):
            ...    def __init__(self, x):
            ...        pass
            sage: class B(A):
            ...    @staticmethod
            ...    def __classcall__(cls, *args, **kwds):
            ...        return super(B,cls).__classcall__(cls,*args,**kwds)
            sage: class C(B): pass
            sage: a = A(1)
            sage: b = B(2)
            sage: c = C(3)
            sage: a is A(1)
            True
            sage: b is B(2)
            True
            sage: c is C(3)
            True
            sage: B._clear_cache_()
            sage: a is A(1)
            True
            sage: b is B(2)
            False
            sage: c is C(3)
            False
```

Note that B overloads `__classcall__`, but nevertheless the _clear_cache_ methods finds the cache and removes all instances of B and its subclass C.

Sorry, I have no idea what component to choose. Let it be misc, then...


---

Comment by SimonKing created at 2013-03-15 08:06:14

Changing status from new to needs_review.


---

Attachment


---

Comment by SimonKing created at 2013-03-15 08:50:58

I updated the patch: The additional (class) method made one test in my coercion tutorial fail, that tests for the number of methods.


---

Comment by SimonKing created at 2013-03-15 09:31:06

The failure reported be one of the patchbots was a maxima crash. I suppose that's unrelated. In any case, I kicked the bot, so, we will see of the maxima crash is reproducible.


---

Comment by SimonKing created at 2013-03-15 16:44:04

Hooray, we now have a green blob!


---

Comment by tscrim created at 2013-03-20 21:38:43

Hey Simon,

Could you also add tests with a `__classcall_private__()`? Thanks.


---

Attachment

Is the test that I added in my second patch appropriate?

Apply trac_14278-clear_cached_presentation.patch trac_14278-doctest.patch


---

Comment by tscrim created at 2013-03-20 23:01:36

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2013-03-20 23:01:36

Yep. Looks good to me. Thank you.


---

Comment by jdemeyer created at 2013-03-26 22:31:03

Resolution: fixed
