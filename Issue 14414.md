# Issue 14414: Add generators for fullerenes

Issue created by migration from https://trac.sagemath.org/ticket/14618

Original creator: nvcleemp

Original creation time: 2013-05-20 12:09:05

Assignee: jason, ncohen, rlm

CC:  azi slani stefan ncohen

In the discussion of ticket #9136, it was mentioned that a generator for fullerenes would be a great addition. The fullerene generator fullgen by Gunnar Brinkmann can't be added due to licensing problems. Brinkmann's student Jan Goedgebeur implemented a new version using a different algorithm which is faster for the `small' cases: http://caagt.ugent.be/buckygen/ This program is available under the GPL 3, so I assume it can be integrated in Sage.


---

Comment by nvcleemp created at 2013-05-20 12:09:29

I'm willing to work on this. I belong to the same research group and have some familiarity with the program and the used file formats, since I integrated it into CaGe (http://caagt.ugent.be/CaGe). I'm quite new to Sage, so I might however need some tips as to how to go about integrating it into Sage.


---

Comment by ncohen created at 2013-05-20 12:11:30

This would be a great addition to Sage ! this being said, a bad license does not necessarily mean that the software will never be used through Sage : it just means that it cannot be distributed with Sage. But we can use Nauty, which is not GPL-compatible, through the Nauty spkg `:-)`

Nathann


---

Comment by azi created at 2013-05-20 12:14:36

Indeed that would be nice!

Let us know if you have any questions about integrating this into Sage.


---

Comment by nvcleemp created at 2013-05-20 12:16:32

Replying to [comment:2 ncohen]:
> This would be a great addition to Sage ! this being said, a bad license does not necessarily mean that the software will never be used through Sage : it just means that it cannot be distributed with Sage. But we can use Nauty, which is not GPL-compatible, through the Nauty spkg `:-)`
> 
> Nathann

Yes, but for most cases buckygen outperforms fullgen, so it is the better choice. This is also the reason why it is now used in CaGe, except when the fullerenes need to be filtered based on the symmetry group or when they are needed in a specific order. These are all arguments which are mostly important for chemists, and even for them only in specific situations.


---

Comment by ncohen created at 2013-05-20 12:20:48

Yooooooo !

> Yes, but for most cases buckygen outperforms fullgen, so it is the better choice.

Oh. Well, that's even better `:-P`

Nathann


---

Comment by nvcleemp created at 2013-05-20 12:22:15

Replying to [comment:3 azi]:
> Indeed that would be nice!
> 
> Let us know if you have any questions about integrating this into Sage.


Well, buckygen supports export in graph6, sparse6 and planar_code format. Using the first two is no problem, since they are already supported by Sage. However, this looses some information: buckygen generates plane graphs. This doesn't seem to be supported in Sage. Is that correct? Is it something that might be added in the near future?

Secondly, I had a look at the geng generator to get an idea how to integrate this kind of functionality. The Sage-part seems rather straight-forward. What I do have a question about, is how to add the buckygen program and make sure that it gets compiled, is available, ...


---

Comment by ncohen created at 2013-05-20 12:25:35

> Well, buckygen supports export in graph6, sparse6 and planar_code format. Using the first two is no problem, since they are already supported by Sage. However, this looses some information: buckygen generates plane graphs. This doesn't seem to be supported in Sage. Is that correct? Is it something that might be added in the near future?

"Planar graphs are not supported" ? What do you mean ? Do you mean that the embedding, or the positions are lost ? May it be what you need ?

http://www.sagemath.org/doc/reference/graphs/sage/graphs/generic_graph.html#sage.graphs.generic_graph.GenericGraph.get_embedding

I never used it myself, though it looks "useful" if you really, really work on planar graphs `:-)`

> Secondly, I had a look at the geng generator to get an idea how to integrate this kind of functionality. The Sage-part seems rather straight-forward. What I do have a question about, is how to add the buckygen program and make sure that it gets compiled, is available, ...

You have to build a spkg. 

http://www.sagemath.org/doc/developer/producing_spkgs.html

Nathann


---

Comment by nvcleemp created at 2013-05-20 12:32:54

OK, thanks. That seems to answer my questions for now. I know what to do for the next couple of days. ;-)


---

Comment by nvcleemp created at 2013-05-25 09:32:32

Replying to [comment:8 nvcleemp]:
> OK, thanks. That seems to answer my questions for now. I know what to do for the next couple of days. ;-)

So, I think I have a first version ready. You will need the following spkg:

http://users.ugent.be/~nvcleemp/buckygen-1.0.spkg

I guess this can become a standard package, since it is GPL v3.

I looked at different spkg and copied what they did, so I hope that everything is in order. The same goes for the patch. Let me know what needs to be changed.


---

Comment by nvcleemp created at 2013-05-25 09:34:08

Changing status from new to needs_review.


---

Comment by nvcleemp created at 2013-05-25 09:37:03

Ow, just saw that I completely forgot the error handling: I still need to replace those passes. I'm sorry.


---

Comment by nvcleemp created at 2013-05-25 09:37:19

Changing status from needs_review to needs_work.


---

Comment by nvcleemp created at 2013-05-25 09:50:03

Changing status from needs_work to needs_review.


---

Comment by nvcleemp created at 2013-05-25 09:50:03

OK, errors are now handled.


---

Comment by ncohen created at 2013-05-26 08:26:36

Helloooooooooooooooooooooooooooooooooooo !!!

NIiiiiiiice to have this in Sage ! I already know a couple of persons who will be interested in this feature `:-)`

Some comments:
* I think that the method should be renamed "fullerenes". Or "fullerenes_buckygen" if you must, but really I think that it has to indicate what it does. And "fullerenes" is pretty nice in this attempt. Of course do cite buckygen wherever you can, it's not made to steal credit or anything, it's just that if I wanted to generate fullerenes I wouldn't know that this is what "buckygen" does.
* In sage we usually use long names ... But it's true that `isolated_pentagon_rule = True` is really long `:-/`
* Here is what happens when the spkg is not installed 
  {{{
sage: list(graphs.buckygen(60))
---------------------------------------------------------------------------
AssertionError                            Traceback (most recent call last)
<ipython-input-2-b82c592bf78f> in <module>()
----> 1 list(graphs.buckygen(Integer(60)))

/home/ncohen/.Sage/local/lib/python2.7/site-packages/sage/graphs/graph_generators.pyc in buckygen(self, order, ipr)
   1006         header = out.read(13)
   1007 
-> 1008         assert header == '>>planar_code', 'Not a valid planar code header'
   1009 
   1010         c = out.read(1)

AssertionError: Not a valid planar code header
}}}
   Could you add a message saying something like "To use this method you must install the buckygen spkg" ?
* Your doctests do not pass when buckygen is not installed, so you should flag them with `# optional - buckygen`. You can see how it is done in 
  {{{
sage: graphs.nauty_geng?
}}}
* For LaTeX expression in Sphinx (Sage's documentation builder) you can't use `$`, and you should use ` instead. See `Graph.dominating_set?` for an example.
  You can rebuild the documentation (and check that it works) by running this 
  {{{
  sage -b && sage -docbuild reference/graphs html
}}}
* There is a special syntax for references in Sphinx. Take a look at `sage.graphs.comparability??`

* When `n < 20`, why don't we just yield an empty iterator ? Is there any reason to raise an exception in this case ?

* Whenever a new generator is added, it muuuuuuuusst appear in the module's doc, i.e. there : http://www.sagemath.org/doc/reference/graphs/sage/graphs/graph_generators.html. Can you add yours to the "Families of graphs" section ? All this appears at the top of graph_generators.py.

That's all I can think of right now `:-)`

And thank you very much again for adding this. That's good stuff !

Nathann


---

Comment by ncohen created at 2013-05-26 08:26:36

Changing status from needs_review to needs_work.


---

Comment by nvcleemp created at 2013-05-26 08:54:11

OK, I'll change all of that. I used ipr, because also in the literature this is almost always referred to as IPR and hardly ever as Isolated Pentagon Rule.

The naming buckygen was only based on nauty_geng: it's certainly no problem to rename it to fullerenes. Btw, that's the way we do it in CaGe.


---

Comment by ncohen created at 2013-05-26 09:03:33

Well, if it is that standard then it is probably better to stick with "ipr". The alternative is really very long.

And I don't think that nauty_geng is such a good name either, but it has been like that since before I first used Sage, and I don't have a great idea of what it could be replaced with either `^^;`

Nathann


---

Comment by nvcleemp created at 2013-05-26 09:46:37

Btw, since buckygen is GPL, is there a reason why the spkg can't be included as a standard spkg?


---

Comment by ncohen created at 2013-05-26 09:50:01

I believe that it has to be optional for a while... But then again it's pretty small. Could you ask on sage-devel ?

By the way, I forgot to add a couple of things to my earlier review : could you remove the `patches/` directory from your spkg ? It's not needed unless it is nonempty `:-)`

Oh, and SPKG.txt file has the `+x` flag for no reason.

Nathann


---

Comment by nvcleemp created at 2013-05-26 10:46:17

Hi, thanks for the feedback. I've modified the spkg, it is still at 

 http://users.ugent.be/~nvcleemp/buckygen-1.0.spkg 

I've indeed found the explanation that a spkg should first be optional for a while on the wiki. I had missed that at first.

I'll also add a new version of the patch.


---

Comment by nvcleemp created at 2013-05-26 10:46:17

Changing status from needs_work to needs_review.


---

Comment by ncohen created at 2013-05-26 11:25:16

(I just rebased your patch on Sage 5.10.beta4, as it did not apply cleanly. #14532 was to blame)


---

Comment by nvcleemp created at 2013-05-26 11:31:48

Hmm, ok, what does that mean for me? Anything I need to do? Apply those patches and then remake my patch?


---

Comment by nvcleemp created at 2013-05-26 11:32:33

ok, I'm blind: I didn't see that you've already done that. :-)


---

Comment by ncohen created at 2013-05-26 11:34:11

Nonono. I did that for  you. But it means that right now you own patch will not apply cleanly on your own version of Sage anymore. And because I will probably write a small reviewer's patch, you will not be able to apply this on your version of Sage either, unless you add the dependencies yourself.

If you don't need your cpu for a couple of hours, then it's probably the right time to download and compile sage 5.10.beta4.

Have fuuuuuuuuuuuuuuuuuuuuuuuuunnn !!

Nathann


---

Comment by nvcleemp created at 2013-05-27 08:11:17

Since I wrote most of the original patch, I assume I can't review this? ;-)


---

Comment by ncohen created at 2013-05-27 08:13:12

Ahahah. No you can't and you should not. I intended to write a reviewer's patch for this ticket but I had some problems with my copy of Sage, and it was delayed. You will have it by today !

Sorry for that !

Nathann


---

Comment by nvcleemp created at 2013-05-27 08:19:10

hehe, no problem. I was just wondering if there was anything more I needed to do. But I guess I can just lay back and relax. Or maybe start marking the projects of my students. :-(

No hurry!


---

Attachment


---

Comment by ncohen created at 2013-05-27 11:21:43

(new version of the original patch without trailing whitespaces)


---

Comment by nvcleemp created at 2013-05-27 11:31:51

hmm, I just noted a small typo on line 990: 20 should be removed there. Currently not at my own computer, so I can't fix it at the moment.


---

Comment by ncohen created at 2013-05-27 12:15:15

Heeeeeeeeeeere it is !

This patch touches small things, but mostly simplifies code that could be simplified, and adds some doc. If you agree with it you can set this ticket to `positive_review`, otherwise let's talk about it `:-)`

Thank you again for this patch !

Nathann


---

Comment by ncohen created at 2013-05-27 12:18:40

Oh, by the way... I replaced a "ValueError" (when the number of vertices is not even) by a StopIteration. Is that a problem ? Now, here is what you get :


```
sage: list(graphs.fullerenes(30))                                 
[Graph on 30 vertices, Graph on 30 vertices, Graph on 30 vertices]
sage: list(graphs.fullerenes(20))
[Graph on 20 vertices]
sage: list(graphs.fullerenes(10))
[]
sage: list(graphs.fullerenes(15))
[]
```


There's no problem to me if the method returns an empty list when no graph exists.... Tell me what you think !

Nathann


---

Comment by nvcleemp created at 2013-05-27 12:32:10

Yes, I can agree with that. I think it can be argued whether asking for a fullerene with an odd number of vertices should give an error or just no graphs. I guess that this is the most friendly solution.

Maybe just a short note on the reason why I handled the header like I did. I was writing a bit more general code which could be used to handle all variants of planar code: `>>planar_code<<`, `>>planar_code le<<` or `>>planarcode be<<`.

I wanted to test whether `buckygen` would generate any of the other headers if the graphs became quite large. This way I noticed that `buckygen` will only generate planar code up to 254 vertices. Beyond that it just gives an error message. I will ask Jan (the author of buckygen) about this, but he's currently out of the office.


---

Comment by ncohen created at 2013-05-27 12:44:12

> Maybe just a short note on the reason why I handled the header like I did. I was writing a bit more general code which could be used to handle all variants of planar code: `>>planar_code<<`, `>>planar_code le<<` or `>>planarcode be<<`.
> 
> I wanted to test whether `buckygen` would generate any of the other headers if the graphs became quite large. This way I noticed that `buckygen` will only generate planar code up to 254 vertices. Beyond that it just gives an error message. I will ask Jan (the author of buckygen) about this, but he's currently out of the office.

ARGGGGGGGGGG ! I totally forgot ! Of course I wanted to try graphs with 300 vertices, as obviously you can't store that on one byte... So, do we change that to 256 in the code ? Unless there is a trick to be found `:-)`

Nathann


---

Attachment

Well, planar code fixes this by using two bytes. That's why the header is needed to specify whether little endian or big endian is used. However, it appears that this is not implemented in buckygen. I'll ask the buckygen author what he thinks. I know he output larger graphs, but I don't know if he used a special patched version or so. I see the author tomorrow.

Nico


---

Comment by nvcleemp created at 2013-05-29 08:49:16

As I expected, the output of graphs with more than 254 vertices is not supported. Instead one can output the dual, which has roughly half the number of vertices.

On the other hand, there are 1 985 250 572 fullerenes with 254 vertices and buckygen takes 2.5 days to generate those. Translating the graphs to Sage graphs will take even more time. Do we really want to support graphs with that many vertices or should we just hold the limit at 254 vertices? 254 vertices is already a bit too high for practical use in Sage.


---

Comment by ncohen created at 2013-05-29 08:50:38

Ahahahah. No, I think that it would make sense indeed to change Sage's bound to 254 `:-)`

Nathann


---

Attachment


---

Comment by nvcleemp created at 2013-05-29 11:07:16

OK, this new patch sets the maximum number of vertices to 254. I think that was the last issue.

Nico


---

Comment by ncohen created at 2013-05-29 11:25:59

Changing status from needs_review to positive_review.


---

Comment by ncohen created at 2013-05-29 11:25:59

Okayyyyyyy... Then I guess that it is good to go `:-)`

Nathann


---

Comment by jdemeyer created at 2013-06-03 15:54:08

Changing component from graph theory to packages: optional.


---

Comment by schilly created at 2013-06-05 16:20:03

buckygen successfully landed on the server


---

Comment by ncohen created at 2013-06-05 16:35:00

Coool ! Thanks `:-)`

Nathann


---

Comment by jdemeyer created at 2013-06-06 12:33:36

Resolution: fixed
