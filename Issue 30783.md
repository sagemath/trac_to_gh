# Issue 30783: build/make/Makefile.in: Fix SAGE_CHECK logic, conditionalize sagetex dependencies on SAGE_CHECK

Issue created by migration from https://trac.sagemath.org/ticket/31020

Original creator: mkoeppe

Original creation time: 2020-12-07 03:58:58

CC:  jhpalmieri dimpase @kliem mjo

(from #30315)

As previously observed in #30324, the `SAGE_CHECK` logic implemented in #30118 and improved in #29766 still does not work correctly with dependencies conditionalized on `SAGE_CHECK`.

We fix it (again...?!) by moving the computation of the `SAGE_CHECK_...` variables earlier, before the dependencies are evaluated.

To test it, we conditionalize `sagetex` dependencies on `SAGE_CHECK`:

```
$ make sagetex-clean jmol-clean
$ make sagetex                    # should NOT build jmol
$ make sagetex-clean
$ SAGE_CHECK=yes make sagetex     # now it builds jmol
```




---

Comment by mkoeppe created at 2020-12-07 04:06:55

New commits:


---

Comment by mkoeppe created at 2020-12-07 04:06:55

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2020-12-10 01:06:53

Changing keywords from "" to "sd111".


---

Comment by dimpase created at 2020-12-10 13:40:21

lgtm


---

Comment by dimpase created at 2020-12-10 13:40:21

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2020-12-10 16:25:22

Thanks!


---

Comment by vbraun created at 2020-12-13 20:31:17

Resolution: fixed
