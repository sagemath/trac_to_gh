# Issue 22760: Parse unevaluated integral from giac

Issue created by migration from Trac.

Original creator: mforets

Original creation time: 2017-05-14 08:26:34

Keywords: integrate, interfaces, giac

If `integrate(..., algorithm='giac')` does not find a solution, Sage should return an unevaluated expression. 

For example, consider `integrate(exp(-x^2)*log(x), x, algorithm='giac')`.

It returns either


```
Traceback (most recent call last):
...
NotImplementedError: Unable to parse Giac output: integrate(ln(x)*exp(-x^2),x)
```


or


```
integration(e^(-x^2)*ln(x), x)
```


depending on the user's locale settings (EN and FR respectively). 

OTOH, both Maxima and SymPy return `integrate(e<sup>(-x</sup>2)*log(x), x)`.


---

Comment by mforets created at 2017-05-14 09:31:47

does it correspond at the level or `giac_integrator` (see `symbolic/integration/external.py`)? or at the level of the giac interface? (see `def _sage_(self, locals={})`).

in the former case, is this correct?


```
...
if 'integrate' in format(result) or 'integration' in format(result):
    return integrate(expr, v, a, b, hold=True) # ???
else:
    return result._sage_()
```

----
New commits:


---

Comment by git created at 2017-05-14 09:47:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mforets created at 2017-05-14 09:48:03

Changing status from new to needs_review.


---

Comment by strogdon created at 2017-05-18 04:50:38

Perhaps this exposes a bug in `sympy_integrator`. These work

```
sage: integrate(e^(-x^2)*log(x), x, algorithm='giac')
integrate(e^(-x^2)*log(x), x)
sage: integrate(e^(-x^2)*log(x), x, algorithm='maxima')
integrate(e^(-x^2)*log(x), x)
```

although `algorithm='maxima'` was not doctested, but

```
integrate(e^(-x^2)*log(x), x, algorithm='sympy')
```

just hangs.


---

Comment by strogdon created at 2017-05-18 04:50:38

Changing status from needs_review to needs_work.


---

Comment by mforets created at 2017-05-18 05:13:46

here it works only after a looong time:


```
sage: integrate(e^(-x^2)*log(x), x, algorithm='sympy') # 15-20 minutes, processor intensive
integrate(e^(-x^2)*log(x), x)
```



---

Comment by strogdon created at 2017-05-18 14:03:48

Changing status from needs_work to positive_review.


---

Comment by strogdon created at 2017-05-18 14:03:48

OK, I was impatient. It took 30+ minutes here.


---

Comment by mforets created at 2017-05-18 14:41:00

Replying to [comment:6 strogdon]:
> OK, I was impatient. It took 30+ minutes here.

Thanks for the review!


---

Comment by vbraun created at 2017-05-18 19:52:18

Merge conflict


---

Comment by vbraun created at 2017-05-18 19:52:18

Changing status from positive_review to needs_work.


---

Comment by strogdon created at 2017-05-19 00:52:03

This really should have depended on #22833 since `src/sage/symbolic/integration/external.py` was touched there. I though I had that ticket merged when I tested things here, but apparently not, or else I would have noticed the conflict. #22833 is now in `8.0.beta7` and so this will have to be rebased. Just change it back to `positive_review` when that is done.


---

Comment by mforets created at 2017-05-19 07:56:35

Replying to [comment:9 strogdon]:
> This really should have depended on #22833 since `src/sage/symbolic/integration/external.py` was touched there. 

my fault, thanks for pointing it out. 

> I though I had that ticket merged when I tested things here, but apparently not, or else I would have noticed the conflict. #22833 is now in `8.0.beta7` and so this will have to be rebased. 

there's something that i don't understand. i do:


```
(in t/mforets/22997) $ git rebase develop
(... solve the merge conflict manually ...)
(in t/mforets/22997) $ git add src/sage/symbolic/integration/external.py
(in t/mforets/22997) $ git status
rebase in progress; onto 7a36941
You are currently rebasing branch 't/22997/22997' on '7a36941'.
  (all conflicts fixed: run "git rebase --continue")

Changes to be committed:
  (use "git reset HEAD <file>..." to unstage)

	modified:   src/sage/symbolic/integration/external.py
(in t/mforets/22997) $ git rebase --continue
Applying: parse result in giac_integrator
```


up to now everything seems to work fine, locally. however i try to push to the remote branch and it breaks:


```
(in t/mforets/22997) $ git push trac HEAD:u/mforets/22997
To trac.sagemath.org:sage.git
 ! [rejected]        HEAD -> u/mforets/22997 (non-fast-forward)
error: failed to push some refs to 'git`@`trac.sagemath.org:sage.git'
hint: Updates were rejected because a pushed branch tip is behind its remote
hint: counterpart. Check out this branch and integrate the remote changes
hint: (e.g. 'git pull ...') before pushing again.
hint: See the 'Note about fast-forwards' in 'git push --help' for details.
```


it also breaks if i use the automatic command:


```
(in t/mforets/22997) $ git trac push
Pushing to Trac #22997...
Guessed remote branch: u/mforets/22997
Traceback (most recent call last):
  File "/usr/local/bin/git-trac", line 18, in <module>
    cmdline.launch()
  File "/Users/forets/sage-src/sage/git-trac-command/git_trac/cmdline.py", line 223, in launch
    app.push(ticket_number, remote=args.remote, force=args.force)
  File "/Users/forets/sage-src/sage/git-trac-command/git_trac/app.py", line 216, in push
    self.repo.push(remote, force)
  File "/Users/forets/sage-src/sage/git-trac-command/git_trac/git_repository.py", line 197, in push
    self.git.echo.push('trac', refspec)
  File "/Users/forets/sage-src/sage/git-trac-command/git_trac/git_interface.py", line 341, in meth
    return self.execute(git_cmd, *args, **kwds)
  File "/Users/forets/sage-src/sage/git-trac-command/git_trac/git_interface.py", line 98, in execute
    popen_stderr=subprocess.PIPE)
  File "/Users/forets/sage-src/sage/git-trac-command/git_trac/git_interface.py", line 263, in _run
    raise GitError(result)
git_trac.git_error.GitError: git returned with non-zero exit code (1) when executing "git push trac HEAD:refs/heads/u/mforets/22997"
    STDERR: To trac.sagemath.org:sage.git
    STDERR:  ! [rejected]        HEAD -> u/mforets/22997 (non-fast-forward)
    STDERR: error: failed to push some refs to 'git`@`trac.sagemath.org:sage.git'
    STDERR: hint: Updates were rejected because a pushed branch tip is behind its remote
    STDERR: hint: counterpart. Check out this branch and integrate the remote changes
    STDERR: hint: (e.g. 'git pull ...') before pushing again.
    STDERR: hint: See the 'Note about fast-forwards' in 'git push --help' for details.
```



---

Comment by git created at 2017-05-19 13:36:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mforets created at 2017-05-19 13:37:20

(merged into v.8.0.beta7)


---

Comment by mforets created at 2017-05-19 13:37:20

Changing status from needs_work to positive_review.


---

Comment by chapoton created at 2017-05-19 14:47:12

Changing status from positive_review to needs_work.


---

Comment by chapoton created at 2017-05-19 14:47:12

The doctest is going to fail with the French locale:

```
sage: from sage.symbolic.integration.external import *
sage:  giac_integrator(e^(-x^2)*log(x), x)
integration(e^(-x^2)*ln(x), x)
```



---

Comment by chapoton created at 2017-05-19 14:47:52

oops, sorry.


---

Comment by chapoton created at 2017-05-19 14:47:52

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2017-05-20 20:07:45

Resolution: fixed
