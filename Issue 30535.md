# Issue 30535: induced volume for polytopes defined over algebraic fields

Issue created by migration from https://trac.sagemath.org/ticket/30772

Original creator: @LaisRast

Original creation time: 2020-10-15 10:30:04

CC:  jipilab @kliem vdelecroix tscrim mkoeppe

Keywords: polytope, volume, square root, sqrt

I have a 3-polytoe in R<sup>4</sup> where R is some special algebraic field (see below). When trying to compute the `volume(measure='induced')`, the following error appears:

```
sage: F2.volume(measure='induced')
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
...
AttributeError: 'sage.rings.number_field.number_field_morphisms.NumberFieldEmbedding' object has no attribute 'im_gens'
```

To reproduce the error:

```
sage: x = var('x')
....: R2.<sqrt2> = NumberField(x^2 - 2, embedding=AA(2).sqrt())
....: R3.<sqrt3> = NumberField(x^2 - 3, embedding=AA(3).sqrt())
....: R5.<sqrt5> = NumberField(x^2 - 5, embedding=AA(5).sqrt())
....: R = R2.composite_fields(R3)[0].composite_fields(R5)[0]
....: R.rename('special algebraic field')
....: R.random_element().sqrt()
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
...
AttributeError: 'sage.rings.number_field.number_field_morphisms.NumberFieldEmbedding' object has no attribute 'im_gens'
```


So it is not a bug in Polyhedron. However, to avoid this error in Polyhedron, I suggest the following changes in `Polyhedron.volume(measure='induced')`

```diff
            Adet = (A.matrix().transpose() * A.matrix()).det()
-           return self.affine_hull_projection(orthogonal=True).volume(measure='ambient', engine=engine, **kwds) / sqrt(Adet)
+           try:
+               return self.affine_hull_projection(orthogonal=True).volume(measure='ambient', engine=engine, **kwds) / sqrt(Adet)
+           except:
+               return self.affine_hull_projection(orthogonal=True).volume(measure='ambient', engine=engine, **kwds) / sqrt(AA(Adet))
        elif measure == 'induced_rational':

```




---

Comment by @kliem created at 2020-10-16 04:40:43

I think the underlying problem should be fixed, if not impossible.


---

Comment by vdelecroix created at 2020-10-16 08:49:37

The implementation of `sqrt` is bad anyway. Returning an element of the symbolic ring is the worse thing you can do.

```
sage: R2.gen().sqrt()                                                                                                                                                                                               
2^(1/4)
sage: parent(_)                                                                                                                                                                                                     
Symbolic Ring
```

And in the code there is the following attempt of justification `# This is what integers, rationals do...`.


---

Comment by vdelecroix created at 2020-10-23 07:00:36

The sqrt issue is solved in #3889


---

Comment by mkoeppe created at 2021-03-24 02:04:25

Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.
