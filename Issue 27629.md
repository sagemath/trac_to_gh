# Issue 27629: Introduce graphics insets

archive/issues_027629.json:
```json
{
    "body": "CC:  @kcrisman @fchapoton @dkrenn @jdemeyer @embray\n\nKeywords: graphics inset\n\nThis ticket introduces graphics insets, i.e. it allows to have various `Graphics` objects at arbitrary locations and sizes on a single figure. Previously, only graphics arrays, i.e. `Graphics` objects arranged in a regular array, were possible. \n\nThis is made possible thanks to the generic class `MultiGraphics` introduced in #27865.\nThe user interface is constituted of two new functions:\n- the method `Graphics.inset()`, which attaches an inset to a given graphics; see this [preview example](https://sagemanifolds.obspm.fr/preview/graphics_inset/reference/plotting/sage/plot/graphics.html#sage.plot.graphics.Graphics.inset)\n- the function `multi_graphics()` , which allows to create a figure from a list of `Graphics` objects at user-specified locations; see this [preview example](https://sagemanifolds.obspm.fr/preview/graphics_inset/reference/plotting/sage/plot/plot.html#sage.plot.plot.multi_graphics)\n\nIssue created by migration from https://trac.sagemath.org/ticket/27866\n\n",
    "created_at": "2019-05-24T12:13:21Z",
    "labels": [
        "component: graphics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.0",
    "title": "Introduce graphics insets",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27629",
    "user": "https://github.com/egourgoulhon"
}
```
CC:  @kcrisman @fchapoton @dkrenn @jdemeyer @embray

Keywords: graphics inset

This ticket introduces graphics insets, i.e. it allows to have various `Graphics` objects at arbitrary locations and sizes on a single figure. Previously, only graphics arrays, i.e. `Graphics` objects arranged in a regular array, were possible. 

This is made possible thanks to the generic class `MultiGraphics` introduced in #27865.
The user interface is constituted of two new functions:
- the method `Graphics.inset()`, which attaches an inset to a given graphics; see this [preview example](https://sagemanifolds.obspm.fr/preview/graphics_inset/reference/plotting/sage/plot/graphics.html#sage.plot.graphics.Graphics.inset)
- the function `multi_graphics()` , which allows to create a figure from a list of `Graphics` objects at user-specified locations; see this [preview example](https://sagemanifolds.obspm.fr/preview/graphics_inset/reference/plotting/sage/plot/plot.html#sage.plot.plot.multi_graphics)

Issue created by migration from https://trac.sagemath.org/ticket/27866





---

archive/issue_comments_389535.json:
```json
{
    "body": "Last 10 new commits:",
    "created_at": "2019-05-24T12:15:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27629#issuecomment-389535",
    "user": "https://github.com/egourgoulhon"
}
```

Last 10 new commits:



---

archive/issue_comments_389536.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-05-24T12:39:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27629#issuecomment-389536",
    "user": "https://github.com/egourgoulhon"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_389537.json:
```json
{
    "body": "Moving tickets from the Sage 8.8 milestone that have been actively worked on in the last six months to the next release milestone (optimistically).",
    "created_at": "2019-07-03T11:37:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27629#issuecomment-389537",
    "user": "https://github.com/embray"
}
```

Moving tickets from the Sage 8.8 milestone that have been actively worked on in the last six months to the next release milestone (optimistically).



---

archive/issue_comments_389538.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-08-06T13:34:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27629#issuecomment-389538",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_389539.json:
```json
{
    "body": "The two pyflakes errors reported by the patchbot are spurious ones: these imports are really necessary.",
    "created_at": "2019-08-08T10:29:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27629#issuecomment-389539",
    "user": "https://github.com/egourgoulhon"
}
```

The two pyflakes errors reported by the patchbot are spurious ones: these imports are really necessary.



---

archive/issue_comments_389540.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-08-25T10:57:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27629#issuecomment-389540",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_389541.json:
```json
{
    "body": "I was wondering what happens if the graphics inset requires a particular aspect ratio, and apparently the aspect ratio is preserved, which is good. However, in the cases I tested I obtained an inset that is much larger than expected. Could you explain the output for `g2` and `g3`?\n\n\n```\nsage: g1 = plot(x^3, x, -1, 1, aspect_ratio=1)\nsage: g2 = g1.inset(circle((0,1000), 1, frame=True, aspect_ratio=1), (.5,.5,.5,.5))\nsage: g3 = g1.inset(circle((0,1000), 1, frame=True, aspect_ratio='automatic'), (.5,.5,.5,.5))\n```\n\n\n**Edit:** To be more precise, the inset has the correct size relative to the final image, but not in relation to the main graphics.",
    "created_at": "2019-08-25T11:00:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27629#issuecomment-389541",
    "user": "https://github.com/mwageringel"
}
```

I was wondering what happens if the graphics inset requires a particular aspect ratio, and apparently the aspect ratio is preserved, which is good. However, in the cases I tested I obtained an inset that is much larger than expected. Could you explain the output for `g2` and `g3`?


```
sage: g1 = plot(x^3, x, -1, 1, aspect_ratio=1)
sage: g2 = g1.inset(circle((0,1000), 1, frame=True, aspect_ratio=1), (.5,.5,.5,.5))
sage: g3 = g1.inset(circle((0,1000), 1, frame=True, aspect_ratio='automatic'), (.5,.5,.5,.5))
```


**Edit:** To be more precise, the inset has the correct size relative to the final image, but not in relation to the main graphics.



---

archive/issue_comments_389542.json:
```json
{
    "body": "Attachment [g2.png](tarball://root/attachments/some-uuid/ticket27866/g2.png) by @egourgoulhon created at 2019-08-25 20:30:53\n\nReplying to [comment:9 gh-mwageringel]:\n> \n> **Edit:** To be more precise, the inset has the correct size relative to the final image, but not in relation to the main graphics.\n\nActually, this is a feature, not a bug. From the documentation returned by `g1.inset?`:\n\n```\nSignature:      g1.inset(graphics, pos=None, fontsize=None)\nDocstring:     \n   Add a graphics object as an inset.\n\n   INPUT:\n\n   * \"graphics\" -- the graphics object (instance of \"Graphics\") to\n     be added as an inset to the current graphics\n\n   * \"pos\" -- (default: \"None\") 4-tuple \"(left, bottom, width,\n     height)\" specifying the location and size of the inset on the\n     figure, all quantities being in fractions of the figure width and\n     height; if \"None\", the value \"(0.70, 0.68, 0.2, 0.2)\" is used\n\n   * \"fontsize\" -- (default: \"None\")  integer, font size (in points)\n     for the inset; if \"None\", the value of 6 points is used, unless\n     \"fontsize\" has been explicitely set in the construction of\n     \"graphics\" (in this case, it is not overwritten here)\n\n   OUTPUT:\n\n   * instance of \"MultiGraphics\"\n\n```\n\nAs you can see, the argument `pos` specifies the position and size of the inset relative to the figure size. So, with `pos=(0.5, 0.5, 0.5, 0.5)`, as in your example `g2`, one obtains an inset that has half the figure width and half the figure height. Do you think that the documentation should be improved about this?",
    "created_at": "2019-08-25T20:30:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27629#issuecomment-389542",
    "user": "https://github.com/egourgoulhon"
}
```

Attachment [g2.png](tarball://root/attachments/some-uuid/ticket27866/g2.png) by @egourgoulhon created at 2019-08-25 20:30:53

Replying to [comment:9 gh-mwageringel]:
> 
> **Edit:** To be more precise, the inset has the correct size relative to the final image, but not in relation to the main graphics.

Actually, this is a feature, not a bug. From the documentation returned by `g1.inset?`:

```
Signature:      g1.inset(graphics, pos=None, fontsize=None)
Docstring:     
   Add a graphics object as an inset.

   INPUT:

   * "graphics" -- the graphics object (instance of "Graphics") to
     be added as an inset to the current graphics

   * "pos" -- (default: "None") 4-tuple "(left, bottom, width,
     height)" specifying the location and size of the inset on the
     figure, all quantities being in fractions of the figure width and
     height; if "None", the value "(0.70, 0.68, 0.2, 0.2)" is used

   * "fontsize" -- (default: "None")  integer, font size (in points)
     for the inset; if "None", the value of 6 points is used, unless
     "fontsize" has been explicitely set in the construction of
     "graphics" (in this case, it is not overwritten here)

   OUTPUT:

   * instance of "MultiGraphics"

```

As you can see, the argument `pos` specifies the position and size of the inset relative to the figure size. So, with `pos=(0.5, 0.5, 0.5, 0.5)`, as in your example `g2`, one obtains an inset that has half the figure width and half the figure height. Do you think that the documentation should be improved about this?



---

archive/issue_comments_389543.json:
```json
{
    "body": "Should it be half the width and height of the figure `g1` or the figure `g2`? It seems to be half the size of `g2`, but I would have expected it to be half the size of `g1` as well. In other words, `g1` appears too small in `g2` \u2013 I would have expected `g1` to fill out the figure `g2`.\n\nAs far as I understand, the position is computed in terms of the figure size, not the plotting area, so I should not expect the inset to cover the top right quadrant of the plot precisely, but in `g2` the positioning of the inset seems a bit too far off. In particular, I would like to understand whether the tick labels count towards the width and height given in `pos` or whether these parameters just determine the size of the frame of the inset. From the looks of it, horizontal labels do not count towards the height, while vertical ones seem to add to the width?",
    "created_at": "2019-08-25T21:24:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27629#issuecomment-389543",
    "user": "https://github.com/mwageringel"
}
```

Should it be half the width and height of the figure `g1` or the figure `g2`? It seems to be half the size of `g2`, but I would have expected it to be half the size of `g1` as well. In other words, `g1` appears too small in `g2` – I would have expected `g1` to fill out the figure `g2`.

As far as I understand, the position is computed in terms of the figure size, not the plotting area, so I should not expect the inset to cover the top right quadrant of the plot precisely, but in `g2` the positioning of the inset seems a bit too far off. In particular, I would like to understand whether the tick labels count towards the width and height given in `pos` or whether these parameters just determine the size of the frame of the inset. From the looks of it, horizontal labels do not count towards the height, while vertical ones seem to add to the width?



---

archive/issue_comments_389544.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-08-28T16:00:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27629#issuecomment-389544",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_389545.json:
```json
{
    "body": "Attachment [g2_new.png](tarball://root/attachments/some-uuid/ticket27866/g2_new.png) by @egourgoulhon created at 2019-08-28 16:07:38",
    "created_at": "2019-08-28T16:07:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27629#issuecomment-389545",
    "user": "https://github.com/egourgoulhon"
}
```

Attachment [g2_new.png](tarball://root/attachments/some-uuid/ticket27866/g2_new.png) by @egourgoulhon created at 2019-08-28 16:07:38



---

archive/issue_comments_389546.json:
```json
{
    "body": "Replying to [comment:11 gh-mwageringel]:\n> Should it be half the width and height of the figure `g1` or the figure `g2`? It seems to be half the size of `g2`, but I would have expected it to be half the size of `g1` as well. In other words, `g1` appears too small in `g2` \u2013 I would have expected `g1` to fill out the figure `g2`.\n> \n\nI've changed the rescaling of the base plot when generating the `MultiGraphics` object, the previous values were indeed shrinking `g1` too much. The new output is in the attached figure `g2_new.png`. \n\n> As far as I understand, the position is computed in terms of the figure size, not the plotting area, so I should not expect the inset to cover the top right quadrant of the plot precisely, but in `g2` the positioning of the inset seems a bit too far off. In particular, I would like to understand whether the tick labels count towards the width and height given in `pos` or whether these parameters just determine the size of the frame of the inset. From the looks of it, horizontal labels do not count towards the height, while vertical ones seem to add to the width?\n\nThe position/size given in the argument `pos` regard the position/size of the frame box of the inset with respect to the final plotting area (canvas), not with respect to `g1`. This is a feature we should keep IMHO, since it matches with Matplotlib conventions, cf. the argument `rect` in the method `Figure.add_axes` at https://matplotlib.org/api/_as_gen/matplotlib.figure.Figure.html.",
    "created_at": "2019-08-28T16:21:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27629#issuecomment-389546",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:11 gh-mwageringel]:
> Should it be half the width and height of the figure `g1` or the figure `g2`? It seems to be half the size of `g2`, but I would have expected it to be half the size of `g1` as well. In other words, `g1` appears too small in `g2` – I would have expected `g1` to fill out the figure `g2`.
> 

I've changed the rescaling of the base plot when generating the `MultiGraphics` object, the previous values were indeed shrinking `g1` too much. The new output is in the attached figure `g2_new.png`. 

> As far as I understand, the position is computed in terms of the figure size, not the plotting area, so I should not expect the inset to cover the top right quadrant of the plot precisely, but in `g2` the positioning of the inset seems a bit too far off. In particular, I would like to understand whether the tick labels count towards the width and height given in `pos` or whether these parameters just determine the size of the frame of the inset. From the looks of it, horizontal labels do not count towards the height, while vertical ones seem to add to the width?

The position/size given in the argument `pos` regard the position/size of the frame box of the inset with respect to the final plotting area (canvas), not with respect to `g1`. This is a feature we should keep IMHO, since it matches with Matplotlib conventions, cf. the argument `rect` in the method `Figure.add_axes` at https://matplotlib.org/api/_as_gen/matplotlib.figure.Figure.html.



---

archive/issue_comments_389547.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-08-29T12:44:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27629#issuecomment-389547",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_389548.json:
```json
{
    "body": "For some reason, yesterday's commit (comment:12) contained a spurious change of permissions on the file `build/pkgs/flint/spkg-check`. The above commit (comment:14) corrects this.",
    "created_at": "2019-08-29T12:49:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27629#issuecomment-389548",
    "user": "https://github.com/egourgoulhon"
}
```

For some reason, yesterday's commit (comment:12) contained a spurious change of permissions on the file `build/pkgs/flint/spkg-check`. The above commit (comment:14) corrects this.



---

archive/issue_comments_389549.json:
```json
{
    "body": "Attachment [g4.png](tarball://root/attachments/some-uuid/ticket27866/g4.png) by @mwageringel created at 2019-09-28 11:50:29\n\nThere still seems to be an inconsistency between vertical and horizontal positioning. For example, in `g4` the blue squares touch each other in one direction, but not the other. I am not sure what the preferred behaviour is in this case, but it should be the same in both directions.\n\n\n```\ng1 = plot(x^3, x, -1, 1, aspect_ratio=1, color='red', frame=True)\ng1.axes_color('red')\nc = circle((0,1000), 1, frame=True, aspect_ratio=1, transparent=True)\nc.axes_color('blue')\ng4 = g1.inset(c, (0,0,.5,.5)).inset(c, (0,.5,.5,.5)).inset(c, (.5,0,.5,.5)).inset(c, (.5,.5,.5,.5))\n```\n\n\n![](g4.png)\n\n----\n\nMoreover, some of the type checks testing for lists and tuples seem a bit restrictive. Especially this one is not necessary, as the implementation will work for any iterable and iterator, so the type check should just be removed:\n\n```\n        if not isinstance(graphics_list, (list, tuple)):\n            raise TypeError(\"graphics_list must be a list or a tuple, \"\n                            \"not {}\".format(graphics_list))\n```\n\n\n----\n\nI am not sure why the following change is needed. Would it be better to test for the converse, i.e. `if not isinstance...` of the types you want to exclude? Or are `Graphics` and `GraphicsArray` the only types that support `tight_layout`? Also, there is a similar change in multigraphics.py that only tests for `isinstance(self, GraphicsArray)`. If you think it is preferable to keep this as is, that would also be fine be me.\n\n\n```diff\n-            # tight_layout adjusts the *subplot* parameters so ticks aren't\n-            # cut off, etc.\n-            figure.tight_layout()\n+            if isinstance(graphics, (sage.plot.graphics.Graphics,\n+                                     sage.plot.multigraphics.GraphicsArray)):\n+                # for Graphics and GraphicsArray, tight_layout adjusts the\n+                # *subplot* parameters so ticks aren't cut off, etc.\n+                figure.tight_layout()\n```\n\n\nOther than that, everything looks good to me.",
    "created_at": "2019-09-28T11:50:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27629#issuecomment-389549",
    "user": "https://github.com/mwageringel"
}
```

Attachment [g4.png](tarball://root/attachments/some-uuid/ticket27866/g4.png) by @mwageringel created at 2019-09-28 11:50:29

There still seems to be an inconsistency between vertical and horizontal positioning. For example, in `g4` the blue squares touch each other in one direction, but not the other. I am not sure what the preferred behaviour is in this case, but it should be the same in both directions.


```
g1 = plot(x^3, x, -1, 1, aspect_ratio=1, color='red', frame=True)
g1.axes_color('red')
c = circle((0,1000), 1, frame=True, aspect_ratio=1, transparent=True)
c.axes_color('blue')
g4 = g1.inset(c, (0,0,.5,.5)).inset(c, (0,.5,.5,.5)).inset(c, (.5,0,.5,.5)).inset(c, (.5,.5,.5,.5))
```


![](g4.png)

----

Moreover, some of the type checks testing for lists and tuples seem a bit restrictive. Especially this one is not necessary, as the implementation will work for any iterable and iterator, so the type check should just be removed:

```
        if not isinstance(graphics_list, (list, tuple)):
            raise TypeError("graphics_list must be a list or a tuple, "
                            "not {}".format(graphics_list))
```


----

I am not sure why the following change is needed. Would it be better to test for the converse, i.e. `if not isinstance...` of the types you want to exclude? Or are `Graphics` and `GraphicsArray` the only types that support `tight_layout`? Also, there is a similar change in multigraphics.py that only tests for `isinstance(self, GraphicsArray)`. If you think it is preferable to keep this as is, that would also be fine be me.


```diff
-            # tight_layout adjusts the *subplot* parameters so ticks aren't
-            # cut off, etc.
-            figure.tight_layout()
+            if isinstance(graphics, (sage.plot.graphics.Graphics,
+                                     sage.plot.multigraphics.GraphicsArray)):
+                # for Graphics and GraphicsArray, tight_layout adjusts the
+                # *subplot* parameters so ticks aren't cut off, etc.
+                figure.tight_layout()
```


Other than that, everything looks good to me.



---

archive/issue_comments_389550.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-09-28T11:50:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27629#issuecomment-389550",
    "user": "https://github.com/mwageringel"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_389551.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-24T12:25:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27629#issuecomment-389551",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_389552.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-25T08:44:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27629#issuecomment-389552",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_389553.json:
```json
{
    "body": "Attachment [g4_aspect_ratio1.png](tarball://root/attachments/some-uuid/ticket27866/g4_aspect_ratio1.png) by @egourgoulhon created at 2019-10-25 08:46:27",
    "created_at": "2019-10-25T08:46:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27629#issuecomment-389553",
    "user": "https://github.com/egourgoulhon"
}
```

Attachment [g4_aspect_ratio1.png](tarball://root/attachments/some-uuid/ticket27866/g4_aspect_ratio1.png) by @egourgoulhon created at 2019-10-25 08:46:27



---

archive/issue_comments_389554.json:
```json
{
    "body": "Sorry for the delay in replying...\n\nReplying to [comment:16 gh-mwageringel]:\n> There still seems to be an inconsistency between vertical and horizontal positioning. For example, in `g4` the blue squares touch each other in one direction, but not the other. I am not sure what the preferred behaviour is in this case, but it should be the same in both directions.\n\nActually this is not a bug but results from a clash between the default aspect ratio of the whole figure, which is 4/3, and the aspect ratio 1 of the subplots. If you ask for an aspect ratio of 1 for the whole figure, then everything is OK: \n\n```\nshow(g4, figsize=(5, 5))\n```\n\nleads to\n\n![](g4_aspect_ratio1.png)\n\n> \n> Moreover, some of the type checks testing for lists and tuples seem a bit restrictive. Especially this one is not necessary, as the implementation will work for any iterable and iterator, so the type check should just be removed:\n\nIndeed! Thanks for pointing this. The type check has been removed in the above commit. \n\n> \n> I am not sure why the following change is needed. Would it be better to test for the converse, i.e. `if not isinstance...` of the types you want to exclude? Or are `Graphics` and `GraphicsArray` the only types that support `tight_layout`? \n\nYes, I think so. \n\n>Also, there is a similar change in multigraphics.py that only tests for `isinstance(self, GraphicsArray)`. If you think it is preferable to keep this as is, that would also be fine be me.\n\nYes I think it is preferable to keep the tests as they are, since only `GraphicsArray` requires the tight layout.",
    "created_at": "2019-10-25T08:57:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27629#issuecomment-389554",
    "user": "https://github.com/egourgoulhon"
}
```

Sorry for the delay in replying...

Replying to [comment:16 gh-mwageringel]:
> There still seems to be an inconsistency between vertical and horizontal positioning. For example, in `g4` the blue squares touch each other in one direction, but not the other. I am not sure what the preferred behaviour is in this case, but it should be the same in both directions.

Actually this is not a bug but results from a clash between the default aspect ratio of the whole figure, which is 4/3, and the aspect ratio 1 of the subplots. If you ask for an aspect ratio of 1 for the whole figure, then everything is OK: 

```
show(g4, figsize=(5, 5))
```

leads to

![](g4_aspect_ratio1.png)

> 
> Moreover, some of the type checks testing for lists and tuples seem a bit restrictive. Especially this one is not necessary, as the implementation will work for any iterable and iterator, so the type check should just be removed:

Indeed! Thanks for pointing this. The type check has been removed in the above commit. 

> 
> I am not sure why the following change is needed. Would it be better to test for the converse, i.e. `if not isinstance...` of the types you want to exclude? Or are `Graphics` and `GraphicsArray` the only types that support `tight_layout`? 

Yes, I think so. 

>Also, there is a similar change in multigraphics.py that only tests for `isinstance(self, GraphicsArray)`. If you think it is preferable to keep this as is, that would also be fine be me.

Yes I think it is preferable to keep the tests as they are, since only `GraphicsArray` requires the tight layout.



---

archive/issue_comments_389555.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-10-25T08:57:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27629#issuecomment-389555",
    "user": "https://github.com/egourgoulhon"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_389556.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-10-25T10:22:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27629#issuecomment-389556",
    "user": "https://github.com/mwageringel"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_389557.json:
```json
{
    "body": "Ok, thanks for the explanations. I am setting this to positive then.",
    "created_at": "2019-10-25T10:22:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27629#issuecomment-389557",
    "user": "https://github.com/mwageringel"
}
```

Ok, thanks for the explanations. I am setting this to positive then.



---

archive/issue_comments_389558.json:
```json
{
    "body": "Replying to [comment:21 gh-mwageringel]:\n> Ok, thanks for the explanations. I am setting this to positive then.\n\nThanks for the review!",
    "created_at": "2019-10-25T18:32:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27629#issuecomment-389558",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:21 gh-mwageringel]:
> Ok, thanks for the explanations. I am setting this to positive then.

Thanks for the review!



---

archive/issue_events_025633.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2019-10-27T10:28:29Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27629",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27629#event-25633"
}
```



---

archive/issue_comments_389559.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-10-27T10:28:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27629#issuecomment-389559",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_389560.json:
```json
{
    "body": "This is causing two test failures on Arch when compiling against system libraries (haven't tried on sage-the-distro)\n\n\n```\n**********************************************************************\nFile \"/usr/lib/python3.7/site-packages/sage/plot/multigraphics.py\", line 1297, in sage.plot.multigraphics.GraphicsArray.position\nFailed example:\n    G.position(0)  # tol 1.0e-13\nExpected:\n    (0.028906249999999998,\n     0.038541666666666696,\n     0.45390624999999996,\n     0.9229166666666667)\nGot:\n    (0.023437500000000003,\n     0.03415488992713045,\n     0.4627803348994754,\n     0.9345951100728696)\nTolerance exceeded in 4 of 4:\n    0.028906249999999998 vs 0.023437500000000003, tolerance 2e-1 > 1e-13\n    0.038541666666666696 vs 0.03415488992713045, tolerance 2e-1 > 1e-13\n    0.45390624999999996 vs 0.4627803348994754, tolerance 2e-2 > 1e-13\n    0.9229166666666667 vs 0.9345951100728696, tolerance 2e-2 > 1e-13\n**********************************************************************\nFile \"/usr/lib/python3.7/site-packages/sage/plot/multigraphics.py\", line 1302, in sage.plot.multigraphics.GraphicsArray.position\nFailed example:\n    G.position(1)  # tol 1.0e-13\nExpected:\n    (0.5171874999999999,\n     0.038541666666666696,\n     0.45390624999999996,\n     0.9229166666666667)\nGot:\n    (0.5136230468749999,\n     0.19293222169724827,\n     0.46278033489947534,\n     0.617040446532634)\nTolerance exceeded in 4 of 4:\n    0.5171874999999999 vs 0.5136230468749999, tolerance 7e-3 > 1e-13\n    0.038541666666666696 vs 0.19293222169724827, tolerance 5e0 > 1e-13\n    0.45390624999999996 vs 0.46278033489947534, tolerance 2e-2 > 1e-13\n    0.9229166666666667 vs 0.617040446532634, tolerance 4e-1 > 1e-13\n**********************************************************************\n1 item had failures:\n   2 of   6 in sage.plot.multigraphics.GraphicsArray.position\n    [192 tests, 2 failures, 15.63 s]\n```\n",
    "created_at": "2019-11-03T12:34:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27629#issuecomment-389560",
    "user": "https://github.com/antonio-rojas"
}
```

This is causing two test failures on Arch when compiling against system libraries (haven't tried on sage-the-distro)


```
**********************************************************************
File "/usr/lib/python3.7/site-packages/sage/plot/multigraphics.py", line 1297, in sage.plot.multigraphics.GraphicsArray.position
Failed example:
    G.position(0)  # tol 1.0e-13
Expected:
    (0.028906249999999998,
     0.038541666666666696,
     0.45390624999999996,
     0.9229166666666667)
Got:
    (0.023437500000000003,
     0.03415488992713045,
     0.4627803348994754,
     0.9345951100728696)
Tolerance exceeded in 4 of 4:
    0.028906249999999998 vs 0.023437500000000003, tolerance 2e-1 > 1e-13
    0.038541666666666696 vs 0.03415488992713045, tolerance 2e-1 > 1e-13
    0.45390624999999996 vs 0.4627803348994754, tolerance 2e-2 > 1e-13
    0.9229166666666667 vs 0.9345951100728696, tolerance 2e-2 > 1e-13
**********************************************************************
File "/usr/lib/python3.7/site-packages/sage/plot/multigraphics.py", line 1302, in sage.plot.multigraphics.GraphicsArray.position
Failed example:
    G.position(1)  # tol 1.0e-13
Expected:
    (0.5171874999999999,
     0.038541666666666696,
     0.45390624999999996,
     0.9229166666666667)
Got:
    (0.5136230468749999,
     0.19293222169724827,
     0.46278033489947534,
     0.617040446532634)
Tolerance exceeded in 4 of 4:
    0.5171874999999999 vs 0.5136230468749999, tolerance 7e-3 > 1e-13
    0.038541666666666696 vs 0.19293222169724827, tolerance 5e0 > 1e-13
    0.45390624999999996 vs 0.46278033489947534, tolerance 2e-2 > 1e-13
    0.9229166666666667 vs 0.617040446532634, tolerance 4e-1 > 1e-13
**********************************************************************
1 item had failures:
   2 of   6 in sage.plot.multigraphics.GraphicsArray.position
    [192 tests, 2 failures, 15.63 s]
```




---

archive/issue_comments_389561.json:
```json
{
    "body": "New ticket please!",
    "created_at": "2019-11-03T12:49:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27629#issuecomment-389561",
    "user": "https://github.com/vbraun"
}
```

New ticket please!



---

archive/issue_comments_389562.json:
```json
{
    "body": "See #29547.",
    "created_at": "2020-04-22T02:07:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27629#issuecomment-389562",
    "user": "https://github.com/jhpalmieri"
}
```

See #29547.
