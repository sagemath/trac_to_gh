# Issue 28386: Upgrade Arb to 2.17.0

Issue created by migration from https://trac.sagemath.org/ticket/28623

Original creator: fredrik.johansson

Original creation time: 2019-10-17 18:09:54

CC:  mmezzarobba vdelecroix fbissey arojas

https://github.com/fredrik-johansson/arb/releases/tag/2.17.0


---

Comment by embray created at 2020-01-06 14:10:03

Ticket retargeted after milestone closed


---

Comment by mkoeppe created at 2020-06-14 22:22:27

New commits:


---

Comment by mkoeppe created at 2020-06-14 22:40:46

Changing status from new to needs_review.


---

Comment by @timokau created at 2020-06-15 19:58:13

Have you run the testsuite? I just tried to do the update for sage in nixpkgs. We're still on sage 8.9, but I expect the failures would be the same with the current develop branch as the tests are still the same. Most of the test failures are due to precision improvements, but two (the `nan`s) look like regressions:


```
sage -t --long /nix/store/6dnh3dcsfmj8akrifqy95wd57sfnprp6-sage-src-8.9/src/sage/rings/complex_arb.pyx
**********************************************************************
File "/nix/store/6dnh3dcsfmj8akrifqy95wd57sfnprp6-sage-src-8.9/src/sage/rings/complex_arb.pyx", line 4510, in sage.rings.complex_arb.ComplexBall.elliptic_pi
Failed example:
    CBF(2,3).elliptic_pi(CBF(1,1))
Expected:
    [0.27029997361983 +/- ...e-15] + [0.715676058329095 +/- ...e-16]*I
Got:
    [0.2702999736198 +/- 4.51e-14] + [0.7156760583291 +/- 1.78e-14]*I
**********************************************************************
File "/nix/store/6dnh3dcsfmj8akrifqy95wd57sfnprp6-sage-src-8.9/src/sage/rings/complex_arb.pyx", line 4618, in sage.rings.complex_arb.ComplexBall.elliptic_pi_inc
Failed example:
    n.elliptic_pi_inc(CBF.pi()/2, m)
Expected:
    [0.8934793755173 +/- ...e-14] + [0.95707868710750 +/- ...e-15]*I
Got:
    nan + nan*I
**********************************************************************
File "/nix/store/6dnh3dcsfmj8akrifqy95wd57sfnprp6-sage-src-8.9/src/sage/rings/complex_arb.pyx", line 4620, in sage.rings.complex_arb.ComplexBall.elliptic_pi_inc
Failed example:
    n.elliptic_pi(m)
Expected:
    [0.89347937551733 +/- ...e-15] + [0.95707868710750 +/- ...e-15]*I
Got:
    [0.8934793755173 +/- 4.27e-14] + [0.9570786871075 +/- 9.91e-15]*I
**********************************************************************
File "/nix/store/6dnh3dcsfmj8akrifqy95wd57sfnprp6-sage-src-8.9/src/sage/rings/complex_arb.pyx", line 4625, in sage.rings.complex_arb.ComplexBall.elliptic_pi_inc
Failed example:
    n.elliptic_pi_inc(CBF.pi()/2, m)
Expected:
    [0.2969588746419 +/- ...e-14] + [1.3188795332738 +/- ...e-14]*I
Got:
    nan + nan*I
**********************************************************************
File "/nix/store/6dnh3dcsfmj8akrifqy95wd57sfnprp6-sage-src-8.9/src/sage/rings/complex_arb.pyx", line 4627, in sage.rings.complex_arb.ComplexBall.elliptic_pi_inc
Failed example:
    n.elliptic_pi(m)
Expected:
    [0.29695887464189 +/- ...e-15] + [1.31887953327376 +/- ...e-15]*I
Got:
    [0.2969588746419 +/- 3.79e-14] + [1.3188795332738 +/- 7.19e-14]*I
**********************************************************************
File "/nix/store/6dnh3dcsfmj8akrifqy95wd57sfnprp6-sage-src-8.9/src/sage/rings/complex_arb.pyx", line 4703, in sage.rings.complex_arb.ComplexBall.elliptic_rj
Failed example:
    CBF(0,1).elliptic_rj(CBF(-1/2,1), CBF(-1,-1), CBF(2))
Expected:
    [1.004386756285733 +/- ...e-16] + [-0.2451626834391645 +/- ...e-17]*I
Got:
    [1.00438675628573 +/- 6.85e-15] + [-0.24516268343916 +/- 8.11e-15]*I
**********************************************************************
3 items had failures:
   1 of   2 in sage.rings.complex_arb.ComplexBall.elliptic_pi
   4 of  10 in sage.rings.complex_arb.ComplexBall.elliptic_pi_inc
   1 of   2 in sage.rings.complex_arb.ComplexBall.elliptic_rj
    [637 tests, 6 failures, 7.92 s]
```



```
File "/nix/store/6dnh3dcsfmj8akrifqy95wd57sfnprp6-sage-src-8.9/src/sage/rings/real_arb.pyx", line 295, in sage.rings.real_arb.arb_to_mpfi
Failed example:
    RIF(RBF(2)**(2**100)) # indirect doctest
Expected:
    Traceback (most recent call last):
    ...
    ArithmeticError: Error converting arb to mpfi. Overflow?
Got:
    [5.8756537891115869e1388255822130839282 .. +infinity]
**********************************************************************
File "/nix/store/6dnh3dcsfmj8akrifqy95wd57sfnprp6-sage-src-8.9/src/sage/rings/real_arb.pyx", line 1657, in sage.rings.real_arb.RealBall.mid
Failed example:
    b.mid()
Expected:
    Traceback (most recent call last):
    ...
    RuntimeError: unable to convert to MPFR (exponent out of range?)
Got:
    +infinity
**********************************************************************
2 items had failures:
   1 of   7 in sage.rings.real_arb.RealBall.mid
   1 of   2 in sage.rings.real_arb.arb_to_mpfi
    [539 tests, 2 failures, 0.71 s]
```



---

Comment by mkoeppe created at 2020-06-15 20:52:31

Changing status from needs_review to needs_work.


---

Comment by dimpase created at 2020-06-16 07:38:31

I don't see these arb errors if I update flint to 2.6 in lockstep with arb.


---

Comment by dimpase created at 2020-06-16 07:38:31

Changing status from needs_work to positive_review.


---

Comment by @timokau created at 2020-06-16 14:00:32

I get the same errors if I update flint as well, but if you're not seeing them that could also be caused by some other dependency / version difference of sage on nix.


---

Comment by dimpase created at 2020-06-16 14:05:27

our flint 2.6.0 update ticket has patches, did you use them?


---

Comment by mkoeppe created at 2020-06-16 14:16:59

Replying to [comment:11 dimpase]:
> I don't see these arb errors if I update flint to 2.6 in lockstep with arb.
Perhaps then this ticket should depend on the FLINT ticket, not the other way around; or we should close this one and use #29719 for both updates.


---

Comment by @timokau created at 2020-06-16 14:17:57

Replying to [comment:13 dimpase]:
> our flint 2.6.0 update ticket has patches, did you use them?

No, but I don't see any relevant patches either. Only `0001-Makefile.in-macos-Do-not-make-DESTDIR-part-of-instal.patch` was added, which is both MacOS and buildsystem specific.


---

Comment by dimpase created at 2020-06-22 09:03:19

some needed for doctests patches for arb are on #29719. Sorry for mess.


---

Comment by vbraun created at 2020-06-22 20:26:51

Changing status from positive_review to needs_work.


---

Comment by dimpase created at 2020-06-23 09:16:58

Changing status from needs_work to needs_review.


---

Comment by dimpase created at 2020-06-23 09:17:41

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2020-06-23 09:17:41

further work on this to happen on #29719.


---

Comment by chapoton created at 2020-06-25 08:24:45

Resolution: duplicate


---

Comment by mkoeppe created at 2020-06-26 22:02:22

#29719 no longer updates arb


---

Comment by mkoeppe created at 2020-06-26 22:02:22

Resolution changed from duplicate to 


---

Comment by mkoeppe created at 2020-06-26 22:02:22

Changing status from closed to new.


---

Comment by mkoeppe created at 2020-06-26 22:05:50

The failures reported in comment 9 have been reproduced in the Sage distribution, see #29719.


---

Comment by mkoeppe created at 2020-06-26 22:08:58

This ticket needs some help from someone who is familiar with these tests


---

Comment by mmezzarobba created at 2020-06-27 07:01:03

Hello everyone,

Little time for Sage development these days, sorry!

Replying to [comment:9 gh-timokau]:
> {{{
> **********************************************************************
> File "/nix/store/6dnh3dcsfmj8akrifqy95wd57sfnprp6-sage-src-8.9/src/sage/rings/complex_arb.pyx", line 4510, in sage.rings.complex_arb.ComplexBall.elliptic_pi
> Failed example:
>     CBF(2,3).elliptic_pi(CBF(1,1))
> Expected:
>     [0.27029997361983 +/- ...e-15] + [0.715676058329095 +/- ...e-16]*I
> Got:
>     [0.2702999736198 +/- 4.51e-14] + [0.7156760583291 +/- 1.78e-14]*I
> }}}

This output change and all similar ones (slight increases in radius) are benign. The expected output could be replaced by something like

```
    [0.2702999736198...] + [0.715676058329...]*I
```

to stay compatible with both versions of arb.

The following two changes are in fact welcome improvements:

> {{{
> File "/nix/store/6dnh3dcsfmj8akrifqy95wd57sfnprp6-sage-src-8.9/src/sage/rings/real_arb.pyx", line 295, in sage.rings.real_arb.arb_to_mpfi
> Failed example:
>     RIF(RBF(2)**(2**100)) # indirect doctest
> Expected:
>     Traceback (most recent call last):
>     ...
>     ArithmeticError: Error converting arb to mpfi. Overflow?
> Got:
>     [5.8756537891115869e1388255822130839282 .. +infinity]
> **********************************************************************
> File "/nix/store/6dnh3dcsfmj8akrifqy95wd57sfnprp6-sage-src-8.9/src/sage/rings/real_arb.pyx", line 1657, in sage.rings.real_arb.RealBall.mid
> Failed example:
>     b.mid()
> Expected:
>     Traceback (most recent call last):
>     ...
>     RuntimeError: unable to convert to MPFR (exponent out of range?)
> Got:
>     +infinity
> **********************************************************************
> 2 items had failures:
>    1 of   7 in sage.rings.real_arb.RealBall.mid
>    1 of   2 in sage.rings.real_arb.arb_to_mpfi
>     [539 tests, 2 failures, 0.71 s]
> }}}

I'm not sure about the remaining two failures. Maybe Fredrik can comment.

> {{{
> **********************************************************************
> File "/nix/store/6dnh3dcsfmj8akrifqy95wd57sfnprp6-sage-src-8.9/src/sage/rings/complex_arb.pyx", line 4618, in sage.rings.complex_arb.ComplexBall.elliptic_pi_inc
> Failed example:
>     n.elliptic_pi_inc(CBF.pi()/2, m)
> Expected:
>     [0.8934793755173 +/- ...e-14] + [0.95707868710750 +/- ...e-15]*I
> Got:
>     nan + nan*I
> **********************************************************************
> }}}

> {{{
> **********************************************************************
> File "/nix/store/6dnh3dcsfmj8akrifqy95wd57sfnprp6-sage-src-8.9/src/sage/rings/complex_arb.pyx", line 4625, in sage.rings.complex_arb.ComplexBall.elliptic_pi_inc
> Failed example:
>     n.elliptic_pi_inc(CBF.pi()/2, m)
> Expected:
>     [0.2969588746419 +/- ...e-14] + [1.3188795332738 +/- ...e-14]*I
> Got:
>     nan + nan*I
> **********************************************************************
> }}}


---

Comment by fredrik.johansson created at 2020-06-27 09:42:04

As I already commented in #29719:



The slight regressions in accuracy for elliptic_pi, elliptic_pi_inc and elliptic_rj are due to using a different algorithm to compute the R_J function for certain complex parameters. The new algorithm is a bit slower and less accurate, but unlike the old algorithm always gives the right branch. These doctest results just need to be updated.

Unfortunately, the new algorithm doesn't work when phi is an inexact multiple of pi/2, leading to the NaN values. There is a workaround: acb_elliptic_pi_inc takes a pi flag to multiply the argument by pi exactly, so if you add a pi flag to the Sage wrapper and pass in phi=0.5 with pi=True in the doctest, it should give the expected result.

It's theoretically possible to fix these regressions, and I will open an Arb issue for it, but I'm not keen to spend time on it any time soon.

The other two examples look correct: converting an Arb number to an MPFR now rounds according to MPFR semantics (including rounding to infinity) instead of abort()ing when the exponents are out of range for MPFR.


---

Comment by dimpase created at 2020-09-18 16:26:29

rebased over updated #29719
----
New commits:


---

Comment by git created at 2020-09-18 16:31:11

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by dimpase created at 2020-09-18 16:46:02

it appears to work in Homebrew with XCode 12 on top of Homebrew's Flint 2.6.3.


---

Comment by dimpase created at 2020-09-23 20:54:06

2.18.1 is available


---

Comment by git created at 2020-09-24 13:38:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2020-09-24 15:14:33

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2020-10-14 22:09:04

Perhaps we need to merge it in 9.2, after all, see #30757


---

Comment by dimpase created at 2020-10-15 10:37:33

does it work with Flint version < 2.6, or we need this update too?


---

Comment by mkoeppe created at 2020-10-15 16:16:29

I think arb 2.18.x is prepared to work with both old and new flint. But I have not tested it recently. 

We should separate this ticket from the flint upgrade


---

Comment by fbissey created at 2020-10-15 19:48:45

I am currently using flint-2.5.2 and arb-2.18.1 in Gentoo and it works and doctest fine.


---

Comment by mkoeppe created at 2020-10-16 01:06:05

Changing status from needs_review to needs_work.


---

Comment by dimpase created at 2020-10-16 11:45:29

I guess the correct base for this should be #30757 - as it adds a patch to arb.


---

Comment by dimpase created at 2020-10-20 08:51:06

to be tested abit
----
New commits:


---

Comment by dimpase created at 2020-10-20 11:24:03

Changing status from needs_work to needs_review.


---

Comment by dimpase created at 2020-10-20 11:24:03

the new branch works well with Flint 2.5.3 (only tested on Fedora 30 so far)


---

Comment by dimpase created at 2020-10-20 13:58:46

Should we also put here the doctest patches from the Flint 2.6.3 update ticket? - this would allow using system Flint 2.6.3


---

Comment by mkoeppe created at 2020-10-20 14:21:50

Yes, good idea


---

Comment by dimpase created at 2020-10-20 17:32:24

I am testing this, and having a problem: Maxima ghost processes are taking over the machine:

```
12028 dimpase   20   0  367444 302324  14884 R  42.5   1.8  11:14.59 maxima                                                                                                                                
 7306 dimpase   20   0  491620 426668  15028 R  42.2   2.6  17:44.48 maxima                                                                                                                                
11596 dimpase   20   0  385528 311008  15000 R  41.9   1.9  11:54.40 maxima                                                                                                                                
13577 dimpase   20   0  312752 233244  14956 R  41.9   1.4   7:22.41 maxima                                                                                                                                
14138 dimpase   20   0  296276 231528  14980 R  41.9   1.4   6:21.78 maxima                                                                                                                                
14806 dimpase   20   0  255672 190624  14884 R  41.5   1.2   2:50.26 maxima                                                                                                                                
 8230 dimpase   20   0  490176 425464  14964 R  41.2   2.6  17:20.55 maxima                                                                                                                                
13635 dimpase   20   0  314196 237876  14988 R  40.9   1.5   7:40.07 maxima                                                                                                                                
 6978 dimpase   20   0  490944 426156  15152 R  40.2   2.6  18:02.45 maxima                                                                                                                                
 8635 dimpase   20   0  490852 425820  14960 R  38.9   2.6  16:51.44 maxima                                                                                                                                
15220 dimpase   20   0  255628 190808  14916 R  38.9   1.2   1:58.04 maxima                                                                                                                                
 8050 dimpase   20   0  490176 425796  15296 R  38.5   2.6  17:17.71 maxima                                                                                                                                
15286 dimpase   20   0  238476 173380  14912 R  38.5   1.1   1:21.26 maxima                                                                                                                                
 8678 dimpase   20   0  489920 425044  15036 R  38.2   2.6  16:54.90 maxima                                                                                                                                
14490 dimpase   20   0  295088 230148  14972 R  38.2   1.4   5:27.37 maxima                                                                                                                                
13789 dimpase   20   0  312752 232936  14864 R  37.9   1.4   7:22.27 maxima                                                                                                                                
14116 dimpase   20   0  295600 230720  15040 R  37.2   1.4   6:22.48 maxima                                                                                                                                
14453 dimpase   20   0  296020 231248  14956 R  37.2   1.4   5:27.63 maxima                                                                                                                                
15412 dimpase   20   0  220812 156160  15112 R  36.9   1.0   0:54.24 maxima                                                                                                                                
15971 dimpase   20   0 1418768 244428  43224 R   4.3   1.5   0:00.78 python3                                                                                                                               
15891 dimpase   20   0 1332768 204008  14336 R   3.3   1.2   0:04.51 python3                                                                                                                               
15908 dimpase   20   0 1477908 293144  57444 R   3.3   1.8   0:05.13 python3                                                                                                                               
15937 dimpase   20   0 1672080 289956  26744 R   3.3   1.8   0:03.49 python3                                                                                                                               
15938 dimpase   20   0 1389976 241124  28616 R   3.3   1.5   0:03.50 python3                                                                                                                               
15951 dimpase   20   0 1726520 315200  37664 R   3.3   1.9   0:02.40 python3                                                                                                                               
15953 dimpase   20   0 1333964 220592  30044 R   3.3   1.3   0:02.36 python3                                                                                                                               
15959 dimpase   20   0 1380784 226536  22884 R   3.3   1.4   0:01.63 python3                                                                                                                               
15963 dimpase   20   0 1380456 231188  27976 R   3.3   1.4   0:01.31 python3                                                                                                                               
15976 dimpase   20   0 1338012 213532  18876 R   3.3   1.3   0:00.59 python3                                                                                                                               
15969 dimpase   20   0 1342848 219184  28928 R   3.0   1.3   0:00.86 python3                                                                                                                               
15973 dimpase   20   0 1341560 221264  23480 R   3.0   1.4   0:00.69 python3                 
```



---

Comment by dimpase created at 2020-10-20 17:40:39

This is also a bit weird:

```
$ find . -name sage-cleaner 
./src/bin/sage-cleaner
./local/bin/sage-cleaner
./build/pkgs/sagelib/src/build/scripts-3.7/sage-cleaner
```


OK, I'll try a build from scratch.


---

Comment by mkoeppe created at 2020-10-20 17:42:06

Replying to [comment:46 dimpase]:
> This is also a bit weird:
> {{{
> $ find . -name sage-cleaner 
> ./src/bin/sage-cleaner
> ./local/bin/sage-cleaner
> ./build/pkgs/sagelib/src/build/scripts-3.7/sage-cleaner
> }}}

This is normal


---

Comment by dimpase created at 2020-10-20 19:13:19

the same picture after `make distclean && make -j11 ptest`. Half a dozen  Maxima processes running for 30 minutes or more. There is a `sage-cleaner` running (strangely, the one in `src/bin`, not in `local/bin`, apparently missing these Maxima zombies.


---

Comment by dimpase created at 2020-10-20 19:17:21


```
$ ps -def | grep sage-clean
dimpase  15068 15000  0 11:33 pts/2    00:00:00 /bin/sh /home/scratch2/dimpase/sage/sage-clang/src/bin/sage-python /home/scratch2/dimpase/sage/sage-clang/src/bin/sage-cleaner
dimpase  15070 15068  0 11:33 pts/2    00:00:00 /home/scratch2/dimpase/sage/sage-clang/local/bin/python3 /home/scratch2/dimpase/sage/sage-clang/src/bin/sage-cleaner
dimpase  27819 22676  0 20:14 pts/14   00:00:00 grep --color=auto sage-clean
```


why is anything running from `src/bin/` at all?


---

Comment by dimpase created at 2020-10-20 19:22:10

That's what I have in the patch of ./sage -sh: (or buildsh, no difference)

```
$ echo $PATH
/home/scratch2/dimpase/sage/sage-clang/build/bin:/home/scratch2/dimpase/sage/sage-clang/src/bin:/home/scratch2/dimpase/sage/sage-clang/local/bin:/home/scratch2/dimpase/miniconda3/condabin:/users/dimpase/perl5/bin:/users/dimpase/bin:/usr/libexec/python3-sphinx:/usr/lib64/qt-3.3/bin:/usr/share/Modules/bin:/usr/lib64/ccache:/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/users/dimpase/.cabal/bin:/auto/users/dimpase/bin
```



---

Comment by mkoeppe created at 2020-10-20 19:47:40

Replying to [comment:49 dimpase]:
> {{{
> $ ps -def | grep sage-clean
> dimpase  15068 15000  0 11:33 pts/2    00:00:00 /bin/sh /home/scratch2/dimpase/sage/sage-clang/src/bin/sage-python /home/scratch2/dimpase/sage/sage-clang/src/bin/sage-cleaner
> dimpase  15070 15068  0 11:33 pts/2    00:00:00 /home/scratch2/dimpase/sage/sage-clang/local/bin/python3 /home/scratch2/dimpase/sage/sage-clang/src/bin/sage-cleaner
> dimpase  27819 22676  0 20:14 pts/14   00:00:00 grep --color=auto sage-clean
> }}}
> 
> why is anything running from `src/bin/` at all?

The scripts in $SAGE_SRC/bin are preferred over the installed scripts in $SAGE_LOCAL/bin - see `sage-env`:

```
export PATH="$SAGE_ROOT/build/bin:$SAGE_SRC/bin:$SAGE_LOCAL/bin:$PATH"
```



---

Comment by dimpase created at 2020-10-20 20:15:32

that's how it looks some time into make ptest

```
2901 dimpase   20   0  296788 231908  14816 R  32.6   1.4   6:51.62 maxima                                                          
 3620 dimpase   20   0  271848 206812  14892 R  32.6   1.3   4:43.95 maxima                                                          
14383 dimpase   20   0 1010928 935392  14828 R  32.6   5.7  60:34.33 maxima                                                          
28253 dimpase   20   0  579776 502700  15112 R  32.6   3.1  27:05.16 maxima                                                          
 3993 dimpase   20   0  237584 172452  14872 S  32.2   1.1   2:05.58 maxima                                                          
 9113 dimpase   20   0 1172372   1.0g  14936 R  32.2   6.7  78:25.36 maxima                                                          
  920 dimpase   20   0  366420 301280  14892 R  31.9   1.8  10:21.38 maxima                                                          
 2791 dimpase   20   0  297044 232316  14972 R  31.9   1.4   7:07.70 maxima                                                          
 7627 dimpase   20   0 1207188   1.1g  15220 R  31.9   6.9  81:05.87 maxima                                                          
13239 dimpase   20   0 1082952 984.0m  15912 R  31.9   6.2  69:10.38 maxima                                                          
27668 dimpase   20   0  694396 629220  14808 R  31.9   3.8  31:36.46 maxima                                                          
29342 dimpase   20   0  544960 475212  15076 R  31.9   2.9  24:28.83 maxima                                                          
  764 dimpase   20   0  367444 302668  14964 R  31.6   1.8  11:30.94 maxima                                                          
 2675 dimpase   20   0  296788 232196  15120 R  31.6   1.4   6:50.34 maxima                                                          
 4535 dimpase   20   0  202472 137496  15056 R  31.6   0.8   0:28.07 maxima                                                          
 8979 dimpase   20   0 1153008   1.0g  14772 R  31.6   6.6  76:06.60 maxima                                                          
15549 dimpase   20   0  994964 926360  15244 R  31.6   5.7  59:28.08 maxima                                                          
 3229 dimpase   20   0  296020 231336  15036 R  31.2   1.4   5:44.30 maxima                                                          
 3569 dimpase   20   0  296020 231256  14960 R  31.2   1.4   4:49.63 maxima                                                          
29192 dimpase   20   0  545636 474636  15208 R  31.2   2.9  24:24.71 maxima                                                          
32520 dimpase   20   0  385784 316468  14908 R  31.2   1.9  12:32.67 maxima                                                          
27629 dimpase   20   0  694396 629536  15144 R  30.9   3.8  31:25.58 maxima                                                          
 4458 dimpase   20   0  237288 172552  14992 R  30.6   1.1   1:02.70 maxima                                                          
 4414 dimpase   20   0  237288 172572  14996 R  30.2   1.1   1:02.69 maxima                                                          
 4638 dimpase   20   0 1517256 299848  58604 R   2.7   1.8   0:03.71 python3                                                         
 4654 dimpase   20   0 1511288 293552  50604 R   2.3   1.8   0:03.54 python3                                                         
 4882 dimpase   20   0 1335900 202072  12196 R   2.3   1.2   0:00.63 python3                                                         
 5156 dimpase   20   0   14652   9852   5216 R   2.3   0.1   0:00.08 python3                                                         
 4679 dimpase   20   0 1473088 303752  70860 R   2.0   1.9   0:03.21 python3                                                         
 4714 dimpase   20   0 1362904 251744  39536 R   2.0   1.5   0:02.18 python3                                                         
```


Any idea as to what causes sage-cleaner to leave these maxima processes running?
E.g. here is one long-running one:

```
01:21:52 /home/scratch2/dimpase/sage/sage-clang/local/lib/maxima/5.44.0/binary-ecl/maxima --frame-stack 4096 --lisp-stack 65536 -- -p /home/scratch2/dimpase/sage/sage-clang/local/lib64/python3.7/site-packages/sage/interfaces/sage-maxima.lisp
```


This is Fedora 30, and so ECL is built with system (threaded) libgc version 7.6.4 and libatomic_ops, if it matters, don't know.


---

Comment by dimpase created at 2020-11-25 19:13:39

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2020-11-25 19:13:39

it all works just fine.
----
New commits:


---

Comment by vbraun created at 2020-12-04 23:57:23

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2020-12-04 23:57:23

On 32-bit:

```
**********************************************************************
File "src/sage/rings/real_arb.pyx", line 300, in sage.rings.real_arb.arb_to_mpfi
Failed example:
    RIF(RBF(2)**(2**100)) # arb218 # indirect doctest
Expected:
    [5.8756537891115869e1388255822130839282 .. +infinity]
Got:
    [2.0985787164673874e323228496 .. +infinity]
**********************************************************************
1 item had failures:
   1 of   2 in sage.rings.real_arb.arb_to_mpfi
    [546 tests, 1 failure, 0.37 s]
----------------------------------------------------------------------
sage -t --long --random-seed=0 src/sage/rings/real_arb.pyx  # 1 doctest failed
----------------------------------------------------------------------
```



---

Comment by dimpase created at 2020-12-07 15:38:12

New commits:


---

Comment by dimpase created at 2020-12-07 15:38:12

Changing status from needs_work to needs_review.


---

Comment by dimpase created at 2020-12-07 15:38:51

rebased over the latest beta and added tags. Please test on 32 bits in particular


---

Comment by git created at 2020-12-07 21:14:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2020-12-07 21:15:23

passes all the tests on 32-bit now


---

Comment by git created at 2020-12-07 23:08:50

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by dimpase created at 2020-12-07 23:15:04

duh, now it's finally right, passes both on 32 and 64 bits.


---

Comment by mkoeppe created at 2020-12-08 01:29:27

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2020-12-08 01:29:27

LGTM


---

Comment by vbraun created at 2020-12-13 20:31:13

Resolution: fixed
