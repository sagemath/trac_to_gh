# Issue 28386: Upgrade Arb to 2.17.0

archive/issues_028386.json:
```json
{
    "body": "CC:  @mezzarobba @videlec @kiwifb @antonio-rojas\n\nhttps://github.com/fredrik-johansson/arb/releases/tag/2.17.0\n\nIssue created by migration from https://trac.sagemath.org/ticket/28623\n\n",
    "created_at": "2019-10-17T18:09:54Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "Upgrade Arb to 2.17.0",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28386",
    "user": "https://github.com/fredrik-johansson"
}
```
CC:  @mezzarobba @videlec @kiwifb @antonio-rojas

https://github.com/fredrik-johansson/arb/releases/tag/2.17.0

Issue created by migration from https://trac.sagemath.org/ticket/28623





---

archive/issue_comments_400424.json:
```json
{
    "body": "Ticket retargeted after milestone closed",
    "created_at": "2020-01-06T14:10:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400424",
    "user": "https://github.com/embray"
}
```

Ticket retargeted after milestone closed



---

archive/issue_comments_400425.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-06-14T22:22:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400425",
    "user": "https://github.com/mkoeppe"
}
```

New commits:



---

archive/issue_comments_400426.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-06-14T22:40:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400426",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_400427.json:
```json
{
    "body": "Have you run the testsuite? I just tried to do the update for sage in nixpkgs. We're still on sage 8.9, but I expect the failures would be the same with the current develop branch as the tests are still the same. Most of the test failures are due to precision improvements, but two (the `nan`s) look like regressions:\n\n\n```\nsage -t --long /nix/store/6dnh3dcsfmj8akrifqy95wd57sfnprp6-sage-src-8.9/src/sage/rings/complex_arb.pyx\n**********************************************************************\nFile \"/nix/store/6dnh3dcsfmj8akrifqy95wd57sfnprp6-sage-src-8.9/src/sage/rings/complex_arb.pyx\", line 4510, in sage.rings.complex_arb.ComplexBall.elliptic_pi\nFailed example:\n    CBF(2,3).elliptic_pi(CBF(1,1))\nExpected:\n    [0.27029997361983 +/- ...e-15] + [0.715676058329095 +/- ...e-16]*I\nGot:\n    [0.2702999736198 +/- 4.51e-14] + [0.7156760583291 +/- 1.78e-14]*I\n**********************************************************************\nFile \"/nix/store/6dnh3dcsfmj8akrifqy95wd57sfnprp6-sage-src-8.9/src/sage/rings/complex_arb.pyx\", line 4618, in sage.rings.complex_arb.ComplexBall.elliptic_pi_inc\nFailed example:\n    n.elliptic_pi_inc(CBF.pi()/2, m)\nExpected:\n    [0.8934793755173 +/- ...e-14] + [0.95707868710750 +/- ...e-15]*I\nGot:\n    nan + nan*I\n**********************************************************************\nFile \"/nix/store/6dnh3dcsfmj8akrifqy95wd57sfnprp6-sage-src-8.9/src/sage/rings/complex_arb.pyx\", line 4620, in sage.rings.complex_arb.ComplexBall.elliptic_pi_inc\nFailed example:\n    n.elliptic_pi(m)\nExpected:\n    [0.89347937551733 +/- ...e-15] + [0.95707868710750 +/- ...e-15]*I\nGot:\n    [0.8934793755173 +/- 4.27e-14] + [0.9570786871075 +/- 9.91e-15]*I\n**********************************************************************\nFile \"/nix/store/6dnh3dcsfmj8akrifqy95wd57sfnprp6-sage-src-8.9/src/sage/rings/complex_arb.pyx\", line 4625, in sage.rings.complex_arb.ComplexBall.elliptic_pi_inc\nFailed example:\n    n.elliptic_pi_inc(CBF.pi()/2, m)\nExpected:\n    [0.2969588746419 +/- ...e-14] + [1.3188795332738 +/- ...e-14]*I\nGot:\n    nan + nan*I\n**********************************************************************\nFile \"/nix/store/6dnh3dcsfmj8akrifqy95wd57sfnprp6-sage-src-8.9/src/sage/rings/complex_arb.pyx\", line 4627, in sage.rings.complex_arb.ComplexBall.elliptic_pi_inc\nFailed example:\n    n.elliptic_pi(m)\nExpected:\n    [0.29695887464189 +/- ...e-15] + [1.31887953327376 +/- ...e-15]*I\nGot:\n    [0.2969588746419 +/- 3.79e-14] + [1.3188795332738 +/- 7.19e-14]*I\n**********************************************************************\nFile \"/nix/store/6dnh3dcsfmj8akrifqy95wd57sfnprp6-sage-src-8.9/src/sage/rings/complex_arb.pyx\", line 4703, in sage.rings.complex_arb.ComplexBall.elliptic_rj\nFailed example:\n    CBF(0,1).elliptic_rj(CBF(-1/2,1), CBF(-1,-1), CBF(2))\nExpected:\n    [1.004386756285733 +/- ...e-16] + [-0.2451626834391645 +/- ...e-17]*I\nGot:\n    [1.00438675628573 +/- 6.85e-15] + [-0.24516268343916 +/- 8.11e-15]*I\n**********************************************************************\n3 items had failures:\n   1 of   2 in sage.rings.complex_arb.ComplexBall.elliptic_pi\n   4 of  10 in sage.rings.complex_arb.ComplexBall.elliptic_pi_inc\n   1 of   2 in sage.rings.complex_arb.ComplexBall.elliptic_rj\n    [637 tests, 6 failures, 7.92 s]\n```\n\n\n\n```\nFile \"/nix/store/6dnh3dcsfmj8akrifqy95wd57sfnprp6-sage-src-8.9/src/sage/rings/real_arb.pyx\", line 295, in sage.rings.real_arb.arb_to_mpfi\nFailed example:\n    RIF(RBF(2)**(2**100)) # indirect doctest\nExpected:\n    Traceback (most recent call last):\n    ...\n    ArithmeticError: Error converting arb to mpfi. Overflow?\nGot:\n    [5.8756537891115869e1388255822130839282 .. +infinity]\n**********************************************************************\nFile \"/nix/store/6dnh3dcsfmj8akrifqy95wd57sfnprp6-sage-src-8.9/src/sage/rings/real_arb.pyx\", line 1657, in sage.rings.real_arb.RealBall.mid\nFailed example:\n    b.mid()\nExpected:\n    Traceback (most recent call last):\n    ...\n    RuntimeError: unable to convert to MPFR (exponent out of range?)\nGot:\n    +infinity\n**********************************************************************\n2 items had failures:\n   1 of   7 in sage.rings.real_arb.RealBall.mid\n   1 of   2 in sage.rings.real_arb.arb_to_mpfi\n    [539 tests, 2 failures, 0.71 s]\n```\n",
    "created_at": "2020-06-15T19:58:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400427",
    "user": "https://github.com/timokau"
}
```

Have you run the testsuite? I just tried to do the update for sage in nixpkgs. We're still on sage 8.9, but I expect the failures would be the same with the current develop branch as the tests are still the same. Most of the test failures are due to precision improvements, but two (the `nan`s) look like regressions:


```
sage -t --long /nix/store/6dnh3dcsfmj8akrifqy95wd57sfnprp6-sage-src-8.9/src/sage/rings/complex_arb.pyx
**********************************************************************
File "/nix/store/6dnh3dcsfmj8akrifqy95wd57sfnprp6-sage-src-8.9/src/sage/rings/complex_arb.pyx", line 4510, in sage.rings.complex_arb.ComplexBall.elliptic_pi
Failed example:
    CBF(2,3).elliptic_pi(CBF(1,1))
Expected:
    [0.27029997361983 +/- ...e-15] + [0.715676058329095 +/- ...e-16]*I
Got:
    [0.2702999736198 +/- 4.51e-14] + [0.7156760583291 +/- 1.78e-14]*I
**********************************************************************
File "/nix/store/6dnh3dcsfmj8akrifqy95wd57sfnprp6-sage-src-8.9/src/sage/rings/complex_arb.pyx", line 4618, in sage.rings.complex_arb.ComplexBall.elliptic_pi_inc
Failed example:
    n.elliptic_pi_inc(CBF.pi()/2, m)
Expected:
    [0.8934793755173 +/- ...e-14] + [0.95707868710750 +/- ...e-15]*I
Got:
    nan + nan*I
**********************************************************************
File "/nix/store/6dnh3dcsfmj8akrifqy95wd57sfnprp6-sage-src-8.9/src/sage/rings/complex_arb.pyx", line 4620, in sage.rings.complex_arb.ComplexBall.elliptic_pi_inc
Failed example:
    n.elliptic_pi(m)
Expected:
    [0.89347937551733 +/- ...e-15] + [0.95707868710750 +/- ...e-15]*I
Got:
    [0.8934793755173 +/- 4.27e-14] + [0.9570786871075 +/- 9.91e-15]*I
**********************************************************************
File "/nix/store/6dnh3dcsfmj8akrifqy95wd57sfnprp6-sage-src-8.9/src/sage/rings/complex_arb.pyx", line 4625, in sage.rings.complex_arb.ComplexBall.elliptic_pi_inc
Failed example:
    n.elliptic_pi_inc(CBF.pi()/2, m)
Expected:
    [0.2969588746419 +/- ...e-14] + [1.3188795332738 +/- ...e-14]*I
Got:
    nan + nan*I
**********************************************************************
File "/nix/store/6dnh3dcsfmj8akrifqy95wd57sfnprp6-sage-src-8.9/src/sage/rings/complex_arb.pyx", line 4627, in sage.rings.complex_arb.ComplexBall.elliptic_pi_inc
Failed example:
    n.elliptic_pi(m)
Expected:
    [0.29695887464189 +/- ...e-15] + [1.31887953327376 +/- ...e-15]*I
Got:
    [0.2969588746419 +/- 3.79e-14] + [1.3188795332738 +/- 7.19e-14]*I
**********************************************************************
File "/nix/store/6dnh3dcsfmj8akrifqy95wd57sfnprp6-sage-src-8.9/src/sage/rings/complex_arb.pyx", line 4703, in sage.rings.complex_arb.ComplexBall.elliptic_rj
Failed example:
    CBF(0,1).elliptic_rj(CBF(-1/2,1), CBF(-1,-1), CBF(2))
Expected:
    [1.004386756285733 +/- ...e-16] + [-0.2451626834391645 +/- ...e-17]*I
Got:
    [1.00438675628573 +/- 6.85e-15] + [-0.24516268343916 +/- 8.11e-15]*I
**********************************************************************
3 items had failures:
   1 of   2 in sage.rings.complex_arb.ComplexBall.elliptic_pi
   4 of  10 in sage.rings.complex_arb.ComplexBall.elliptic_pi_inc
   1 of   2 in sage.rings.complex_arb.ComplexBall.elliptic_rj
    [637 tests, 6 failures, 7.92 s]
```



```
File "/nix/store/6dnh3dcsfmj8akrifqy95wd57sfnprp6-sage-src-8.9/src/sage/rings/real_arb.pyx", line 295, in sage.rings.real_arb.arb_to_mpfi
Failed example:
    RIF(RBF(2)**(2**100)) # indirect doctest
Expected:
    Traceback (most recent call last):
    ...
    ArithmeticError: Error converting arb to mpfi. Overflow?
Got:
    [5.8756537891115869e1388255822130839282 .. +infinity]
**********************************************************************
File "/nix/store/6dnh3dcsfmj8akrifqy95wd57sfnprp6-sage-src-8.9/src/sage/rings/real_arb.pyx", line 1657, in sage.rings.real_arb.RealBall.mid
Failed example:
    b.mid()
Expected:
    Traceback (most recent call last):
    ...
    RuntimeError: unable to convert to MPFR (exponent out of range?)
Got:
    +infinity
**********************************************************************
2 items had failures:
   1 of   7 in sage.rings.real_arb.RealBall.mid
   1 of   2 in sage.rings.real_arb.arb_to_mpfi
    [539 tests, 2 failures, 0.71 s]
```




---

archive/issue_comments_400428.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-06-15T20:52:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400428",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_400429.json:
```json
{
    "body": "I don't see these arb errors if I update flint to 2.6 in lockstep with arb.",
    "created_at": "2020-06-16T07:38:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400429",
    "user": "https://github.com/dimpase"
}
```

I don't see these arb errors if I update flint to 2.6 in lockstep with arb.



---

archive/issue_comments_400430.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2020-06-16T07:38:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400430",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_400431.json:
```json
{
    "body": "I get the same errors if I update flint as well, but if you're not seeing them that could also be caused by some other dependency / version difference of sage on nix.",
    "created_at": "2020-06-16T14:00:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400431",
    "user": "https://github.com/timokau"
}
```

I get the same errors if I update flint as well, but if you're not seeing them that could also be caused by some other dependency / version difference of sage on nix.



---

archive/issue_comments_400432.json:
```json
{
    "body": "our flint 2.6.0 update ticket has patches, did you use them?",
    "created_at": "2020-06-16T14:05:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400432",
    "user": "https://github.com/dimpase"
}
```

our flint 2.6.0 update ticket has patches, did you use them?



---

archive/issue_comments_400433.json:
```json
{
    "body": "Replying to [comment:11 dimpase]:\n> I don't see these arb errors if I update flint to 2.6 in lockstep with arb.\nPerhaps then this ticket should depend on the FLINT ticket, not the other way around; or we should close this one and use #29719 for both updates.",
    "created_at": "2020-06-16T14:16:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400433",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:11 dimpase]:
> I don't see these arb errors if I update flint to 2.6 in lockstep with arb.
Perhaps then this ticket should depend on the FLINT ticket, not the other way around; or we should close this one and use #29719 for both updates.



---

archive/issue_comments_400434.json:
```json
{
    "body": "Replying to [comment:13 dimpase]:\n> our flint 2.6.0 update ticket has patches, did you use them?\n\nNo, but I don't see any relevant patches either. Only `0001-Makefile.in-macos-Do-not-make-DESTDIR-part-of-instal.patch` was added, which is both MacOS and buildsystem specific.",
    "created_at": "2020-06-16T14:17:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400434",
    "user": "https://github.com/timokau"
}
```

Replying to [comment:13 dimpase]:
> our flint 2.6.0 update ticket has patches, did you use them?

No, but I don't see any relevant patches either. Only `0001-Makefile.in-macos-Do-not-make-DESTDIR-part-of-instal.patch` was added, which is both MacOS and buildsystem specific.



---

archive/issue_comments_400435.json:
```json
{
    "body": "some needed for doctests patches for arb are on #29719. Sorry for mess.",
    "created_at": "2020-06-22T09:03:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400435",
    "user": "https://github.com/dimpase"
}
```

some needed for doctests patches for arb are on #29719. Sorry for mess.



---

archive/issue_comments_400436.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2020-06-22T20:26:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400436",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_400437.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-06-23T09:16:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400437",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_400438.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-06-23T09:17:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400438",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_400439.json:
```json
{
    "body": "further work on this to happen on #29719.",
    "created_at": "2020-06-23T09:17:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400439",
    "user": "https://github.com/dimpase"
}
```

further work on this to happen on #29719.



---

archive/issue_comments_400440.json:
```json
{
    "body": "Resolution: duplicate",
    "created_at": "2020-06-25T08:24:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400440",
    "user": "https://github.com/fchapoton"
}
```

Resolution: duplicate



---

archive/issue_events_026276.json:
```json
{
    "actor": "@fchapoton",
    "created_at": "2020-06-25T08:24:45Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28386#event-26276"
}
```



---

archive/issue_comments_400441.json:
```json
{
    "body": "#29719 no longer updates arb",
    "created_at": "2020-06-26T22:02:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400441",
    "user": "https://github.com/mkoeppe"
}
```

#29719 no longer updates arb



---

archive/issue_comments_400442.json:
```json
{
    "body": "Resolution changed from duplicate to ",
    "created_at": "2020-06-26T22:02:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400442",
    "user": "https://github.com/mkoeppe"
}
```

Resolution changed from duplicate to 



---

archive/issue_comments_400443.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2020-06-26T22:02:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400443",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from closed to new.



---

archive/issue_events_026277.json:
```json
{
    "actor": "@mkoeppe",
    "created_at": "2020-06-26T22:02:22Z",
    "event": "reopened",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28386#event-26277"
}
```



---

archive/issue_comments_400444.json:
```json
{
    "body": "The failures reported in comment 9 have been reproduced in the Sage distribution, see #29719.",
    "created_at": "2020-06-26T22:05:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400444",
    "user": "https://github.com/mkoeppe"
}
```

The failures reported in comment 9 have been reproduced in the Sage distribution, see #29719.



---

archive/issue_comments_400445.json:
```json
{
    "body": "This ticket needs some help from someone who is familiar with these tests",
    "created_at": "2020-06-26T22:08:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400445",
    "user": "https://github.com/mkoeppe"
}
```

This ticket needs some help from someone who is familiar with these tests



---

archive/issue_comments_400446.json:
```json
{
    "body": "Hello everyone,\n\nLittle time for Sage development these days, sorry!\n\nReplying to [comment:9 gh-timokau]:\n> {{{\n> **********************************************************************\n> File \"/nix/store/6dnh3dcsfmj8akrifqy95wd57sfnprp6-sage-src-8.9/src/sage/rings/complex_arb.pyx\", line 4510, in sage.rings.complex_arb.ComplexBall.elliptic_pi\n> Failed example:\n>     CBF(2,3).elliptic_pi(CBF(1,1))\n> Expected:\n>     [0.27029997361983 +/- ...e-15] + [0.715676058329095 +/- ...e-16]*I\n> Got:\n>     [0.2702999736198 +/- 4.51e-14] + [0.7156760583291 +/- 1.78e-14]*I\n> }}}\n\nThis output change and all similar ones (slight increases in radius) are benign. The expected output could be replaced by something like\n\n```\n    [0.2702999736198...] + [0.715676058329...]*I\n```\n\nto stay compatible with both versions of arb.\n\nThe following two changes are in fact welcome improvements:\n\n> {{{\n> File \"/nix/store/6dnh3dcsfmj8akrifqy95wd57sfnprp6-sage-src-8.9/src/sage/rings/real_arb.pyx\", line 295, in sage.rings.real_arb.arb_to_mpfi\n> Failed example:\n>     RIF(RBF(2)**(2**100)) # indirect doctest\n> Expected:\n>     Traceback (most recent call last):\n>     ...\n>     ArithmeticError: Error converting arb to mpfi. Overflow?\n> Got:\n>     [5.8756537891115869e1388255822130839282 .. +infinity]\n> **********************************************************************\n> File \"/nix/store/6dnh3dcsfmj8akrifqy95wd57sfnprp6-sage-src-8.9/src/sage/rings/real_arb.pyx\", line 1657, in sage.rings.real_arb.RealBall.mid\n> Failed example:\n>     b.mid()\n> Expected:\n>     Traceback (most recent call last):\n>     ...\n>     RuntimeError: unable to convert to MPFR (exponent out of range?)\n> Got:\n>     +infinity\n> **********************************************************************\n> 2 items had failures:\n>    1 of   7 in sage.rings.real_arb.RealBall.mid\n>    1 of   2 in sage.rings.real_arb.arb_to_mpfi\n>     [539 tests, 2 failures, 0.71 s]\n> }}}\n\nI'm not sure about the remaining two failures. Maybe Fredrik can comment.\n\n> {{{\n> **********************************************************************\n> File \"/nix/store/6dnh3dcsfmj8akrifqy95wd57sfnprp6-sage-src-8.9/src/sage/rings/complex_arb.pyx\", line 4618, in sage.rings.complex_arb.ComplexBall.elliptic_pi_inc\n> Failed example:\n>     n.elliptic_pi_inc(CBF.pi()/2, m)\n> Expected:\n>     [0.8934793755173 +/- ...e-14] + [0.95707868710750 +/- ...e-15]*I\n> Got:\n>     nan + nan*I\n> **********************************************************************\n> }}}\n\n> {{{\n> **********************************************************************\n> File \"/nix/store/6dnh3dcsfmj8akrifqy95wd57sfnprp6-sage-src-8.9/src/sage/rings/complex_arb.pyx\", line 4625, in sage.rings.complex_arb.ComplexBall.elliptic_pi_inc\n> Failed example:\n>     n.elliptic_pi_inc(CBF.pi()/2, m)\n> Expected:\n>     [0.2969588746419 +/- ...e-14] + [1.3188795332738 +/- ...e-14]*I\n> Got:\n>     nan + nan*I\n> **********************************************************************\n> }}}",
    "created_at": "2020-06-27T07:01:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400446",
    "user": "https://github.com/mezzarobba"
}
```

Hello everyone,

Little time for Sage development these days, sorry!

Replying to [comment:9 gh-timokau]:
> {{{
> **********************************************************************
> File "/nix/store/6dnh3dcsfmj8akrifqy95wd57sfnprp6-sage-src-8.9/src/sage/rings/complex_arb.pyx", line 4510, in sage.rings.complex_arb.ComplexBall.elliptic_pi
> Failed example:
>     CBF(2,3).elliptic_pi(CBF(1,1))
> Expected:
>     [0.27029997361983 +/- ...e-15] + [0.715676058329095 +/- ...e-16]*I
> Got:
>     [0.2702999736198 +/- 4.51e-14] + [0.7156760583291 +/- 1.78e-14]*I
> }}}

This output change and all similar ones (slight increases in radius) are benign. The expected output could be replaced by something like

```
    [0.2702999736198...] + [0.715676058329...]*I
```

to stay compatible with both versions of arb.

The following two changes are in fact welcome improvements:

> {{{
> File "/nix/store/6dnh3dcsfmj8akrifqy95wd57sfnprp6-sage-src-8.9/src/sage/rings/real_arb.pyx", line 295, in sage.rings.real_arb.arb_to_mpfi
> Failed example:
>     RIF(RBF(2)**(2**100)) # indirect doctest
> Expected:
>     Traceback (most recent call last):
>     ...
>     ArithmeticError: Error converting arb to mpfi. Overflow?
> Got:
>     [5.8756537891115869e1388255822130839282 .. +infinity]
> **********************************************************************
> File "/nix/store/6dnh3dcsfmj8akrifqy95wd57sfnprp6-sage-src-8.9/src/sage/rings/real_arb.pyx", line 1657, in sage.rings.real_arb.RealBall.mid
> Failed example:
>     b.mid()
> Expected:
>     Traceback (most recent call last):
>     ...
>     RuntimeError: unable to convert to MPFR (exponent out of range?)
> Got:
>     +infinity
> **********************************************************************
> 2 items had failures:
>    1 of   7 in sage.rings.real_arb.RealBall.mid
>    1 of   2 in sage.rings.real_arb.arb_to_mpfi
>     [539 tests, 2 failures, 0.71 s]
> }}}

I'm not sure about the remaining two failures. Maybe Fredrik can comment.

> {{{
> **********************************************************************
> File "/nix/store/6dnh3dcsfmj8akrifqy95wd57sfnprp6-sage-src-8.9/src/sage/rings/complex_arb.pyx", line 4618, in sage.rings.complex_arb.ComplexBall.elliptic_pi_inc
> Failed example:
>     n.elliptic_pi_inc(CBF.pi()/2, m)
> Expected:
>     [0.8934793755173 +/- ...e-14] + [0.95707868710750 +/- ...e-15]*I
> Got:
>     nan + nan*I
> **********************************************************************
> }}}

> {{{
> **********************************************************************
> File "/nix/store/6dnh3dcsfmj8akrifqy95wd57sfnprp6-sage-src-8.9/src/sage/rings/complex_arb.pyx", line 4625, in sage.rings.complex_arb.ComplexBall.elliptic_pi_inc
> Failed example:
>     n.elliptic_pi_inc(CBF.pi()/2, m)
> Expected:
>     [0.2969588746419 +/- ...e-14] + [1.3188795332738 +/- ...e-14]*I
> Got:
>     nan + nan*I
> **********************************************************************
> }}}



---

archive/issue_comments_400447.json:
```json
{
    "body": "As I already commented in #29719:\n\n\n\nThe slight regressions in accuracy for elliptic_pi, elliptic_pi_inc and elliptic_rj are due to using a different algorithm to compute the R_J function for certain complex parameters. The new algorithm is a bit slower and less accurate, but unlike the old algorithm always gives the right branch. These doctest results just need to be updated.\n\nUnfortunately, the new algorithm doesn't work when phi is an inexact multiple of pi/2, leading to the NaN values. There is a workaround: acb_elliptic_pi_inc takes a pi flag to multiply the argument by pi exactly, so if you add a pi flag to the Sage wrapper and pass in phi=0.5 with pi=True in the doctest, it should give the expected result.\n\nIt's theoretically possible to fix these regressions, and I will open an Arb issue for it, but I'm not keen to spend time on it any time soon.\n\nThe other two examples look correct: converting an Arb number to an MPFR now rounds according to MPFR semantics (including rounding to infinity) instead of abort()ing when the exponents are out of range for MPFR.",
    "created_at": "2020-06-27T09:42:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400447",
    "user": "https://github.com/fredrik-johansson"
}
```

As I already commented in #29719:



The slight regressions in accuracy for elliptic_pi, elliptic_pi_inc and elliptic_rj are due to using a different algorithm to compute the R_J function for certain complex parameters. The new algorithm is a bit slower and less accurate, but unlike the old algorithm always gives the right branch. These doctest results just need to be updated.

Unfortunately, the new algorithm doesn't work when phi is an inexact multiple of pi/2, leading to the NaN values. There is a workaround: acb_elliptic_pi_inc takes a pi flag to multiply the argument by pi exactly, so if you add a pi flag to the Sage wrapper and pass in phi=0.5 with pi=True in the doctest, it should give the expected result.

It's theoretically possible to fix these regressions, and I will open an Arb issue for it, but I'm not keen to spend time on it any time soon.

The other two examples look correct: converting an Arb number to an MPFR now rounds according to MPFR semantics (including rounding to infinity) instead of abort()ing when the exponents are out of range for MPFR.



---

archive/issue_comments_400448.json:
```json
{
    "body": "rebased over updated #29719\n----\nNew commits:",
    "created_at": "2020-09-18T16:26:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400448",
    "user": "https://github.com/dimpase"
}
```

rebased over updated #29719
----
New commits:



---

archive/issue_comments_400449.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-09-18T16:31:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400449",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_400450.json:
```json
{
    "body": "it appears to work in Homebrew with XCode 12 on top of Homebrew's Flint 2.6.3.",
    "created_at": "2020-09-18T16:46:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400450",
    "user": "https://github.com/dimpase"
}
```

it appears to work in Homebrew with XCode 12 on top of Homebrew's Flint 2.6.3.



---

archive/issue_comments_400451.json:
```json
{
    "body": "2.18.1 is available",
    "created_at": "2020-09-23T20:54:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400451",
    "user": "https://github.com/dimpase"
}
```

2.18.1 is available



---

archive/issue_comments_400452.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-24T13:38:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400452",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_400453.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-09-24T15:14:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400453",
    "user": "https://github.com/dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_400454.json:
```json
{
    "body": "Perhaps we need to merge it in 9.2, after all, see #30757",
    "created_at": "2020-10-14T22:09:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400454",
    "user": "https://github.com/mkoeppe"
}
```

Perhaps we need to merge it in 9.2, after all, see #30757



---

archive/issue_comments_400455.json:
```json
{
    "body": "does it work with Flint version < 2.6, or we need this update too?",
    "created_at": "2020-10-15T10:37:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400455",
    "user": "https://github.com/dimpase"
}
```

does it work with Flint version < 2.6, or we need this update too?



---

archive/issue_comments_400456.json:
```json
{
    "body": "I think arb 2.18.x is prepared to work with both old and new flint. But I have not tested it recently. \n\nWe should separate this ticket from the flint upgrade",
    "created_at": "2020-10-15T16:16:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400456",
    "user": "https://github.com/mkoeppe"
}
```

I think arb 2.18.x is prepared to work with both old and new flint. But I have not tested it recently. 

We should separate this ticket from the flint upgrade



---

archive/issue_comments_400457.json:
```json
{
    "body": "I am currently using flint-2.5.2 and arb-2.18.1 in Gentoo and it works and doctest fine.",
    "created_at": "2020-10-15T19:48:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400457",
    "user": "https://github.com/kiwifb"
}
```

I am currently using flint-2.5.2 and arb-2.18.1 in Gentoo and it works and doctest fine.



---

archive/issue_comments_400458.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-10-16T01:06:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400458",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_400459.json:
```json
{
    "body": "I guess the correct base for this should be #30757 - as it adds a patch to arb.",
    "created_at": "2020-10-16T11:45:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400459",
    "user": "https://github.com/dimpase"
}
```

I guess the correct base for this should be #30757 - as it adds a patch to arb.



---

archive/issue_comments_400460.json:
```json
{
    "body": "to be tested abit\n----\nNew commits:",
    "created_at": "2020-10-20T08:51:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400460",
    "user": "https://github.com/dimpase"
}
```

to be tested abit
----
New commits:



---

archive/issue_comments_400461.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-10-20T11:24:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400461",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_400462.json:
```json
{
    "body": "the new branch works well with Flint 2.5.3 (only tested on Fedora 30 so far)",
    "created_at": "2020-10-20T11:24:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400462",
    "user": "https://github.com/dimpase"
}
```

the new branch works well with Flint 2.5.3 (only tested on Fedora 30 so far)



---

archive/issue_comments_400463.json:
```json
{
    "body": "Should we also put here the doctest patches from the Flint 2.6.3 update ticket? - this would allow using system Flint 2.6.3",
    "created_at": "2020-10-20T13:58:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400463",
    "user": "https://github.com/dimpase"
}
```

Should we also put here the doctest patches from the Flint 2.6.3 update ticket? - this would allow using system Flint 2.6.3



---

archive/issue_comments_400464.json:
```json
{
    "body": "Yes, good idea",
    "created_at": "2020-10-20T14:21:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400464",
    "user": "https://github.com/mkoeppe"
}
```

Yes, good idea



---

archive/issue_comments_400465.json:
```json
{
    "body": "I am testing this, and having a problem: Maxima ghost processes are taking over the machine:\n\n```\n12028 dimpase   20   0  367444 302324  14884 R  42.5   1.8  11:14.59 maxima                                                                                                                                \n 7306 dimpase   20   0  491620 426668  15028 R  42.2   2.6  17:44.48 maxima                                                                                                                                \n11596 dimpase   20   0  385528 311008  15000 R  41.9   1.9  11:54.40 maxima                                                                                                                                \n13577 dimpase   20   0  312752 233244  14956 R  41.9   1.4   7:22.41 maxima                                                                                                                                \n14138 dimpase   20   0  296276 231528  14980 R  41.9   1.4   6:21.78 maxima                                                                                                                                \n14806 dimpase   20   0  255672 190624  14884 R  41.5   1.2   2:50.26 maxima                                                                                                                                \n 8230 dimpase   20   0  490176 425464  14964 R  41.2   2.6  17:20.55 maxima                                                                                                                                \n13635 dimpase   20   0  314196 237876  14988 R  40.9   1.5   7:40.07 maxima                                                                                                                                \n 6978 dimpase   20   0  490944 426156  15152 R  40.2   2.6  18:02.45 maxima                                                                                                                                \n 8635 dimpase   20   0  490852 425820  14960 R  38.9   2.6  16:51.44 maxima                                                                                                                                \n15220 dimpase   20   0  255628 190808  14916 R  38.9   1.2   1:58.04 maxima                                                                                                                                \n 8050 dimpase   20   0  490176 425796  15296 R  38.5   2.6  17:17.71 maxima                                                                                                                                \n15286 dimpase   20   0  238476 173380  14912 R  38.5   1.1   1:21.26 maxima                                                                                                                                \n 8678 dimpase   20   0  489920 425044  15036 R  38.2   2.6  16:54.90 maxima                                                                                                                                \n14490 dimpase   20   0  295088 230148  14972 R  38.2   1.4   5:27.37 maxima                                                                                                                                \n13789 dimpase   20   0  312752 232936  14864 R  37.9   1.4   7:22.27 maxima                                                                                                                                \n14116 dimpase   20   0  295600 230720  15040 R  37.2   1.4   6:22.48 maxima                                                                                                                                \n14453 dimpase   20   0  296020 231248  14956 R  37.2   1.4   5:27.63 maxima                                                                                                                                \n15412 dimpase   20   0  220812 156160  15112 R  36.9   1.0   0:54.24 maxima                                                                                                                                \n15971 dimpase   20   0 1418768 244428  43224 R   4.3   1.5   0:00.78 python3                                                                                                                               \n15891 dimpase   20   0 1332768 204008  14336 R   3.3   1.2   0:04.51 python3                                                                                                                               \n15908 dimpase   20   0 1477908 293144  57444 R   3.3   1.8   0:05.13 python3                                                                                                                               \n15937 dimpase   20   0 1672080 289956  26744 R   3.3   1.8   0:03.49 python3                                                                                                                               \n15938 dimpase   20   0 1389976 241124  28616 R   3.3   1.5   0:03.50 python3                                                                                                                               \n15951 dimpase   20   0 1726520 315200  37664 R   3.3   1.9   0:02.40 python3                                                                                                                               \n15953 dimpase   20   0 1333964 220592  30044 R   3.3   1.3   0:02.36 python3                                                                                                                               \n15959 dimpase   20   0 1380784 226536  22884 R   3.3   1.4   0:01.63 python3                                                                                                                               \n15963 dimpase   20   0 1380456 231188  27976 R   3.3   1.4   0:01.31 python3                                                                                                                               \n15976 dimpase   20   0 1338012 213532  18876 R   3.3   1.3   0:00.59 python3                                                                                                                               \n15969 dimpase   20   0 1342848 219184  28928 R   3.0   1.3   0:00.86 python3                                                                                                                               \n15973 dimpase   20   0 1341560 221264  23480 R   3.0   1.4   0:00.69 python3                 \n```\n",
    "created_at": "2020-10-20T17:32:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400465",
    "user": "https://github.com/dimpase"
}
```

I am testing this, and having a problem: Maxima ghost processes are taking over the machine:

```
12028 dimpase   20   0  367444 302324  14884 R  42.5   1.8  11:14.59 maxima                                                                                                                                
 7306 dimpase   20   0  491620 426668  15028 R  42.2   2.6  17:44.48 maxima                                                                                                                                
11596 dimpase   20   0  385528 311008  15000 R  41.9   1.9  11:54.40 maxima                                                                                                                                
13577 dimpase   20   0  312752 233244  14956 R  41.9   1.4   7:22.41 maxima                                                                                                                                
14138 dimpase   20   0  296276 231528  14980 R  41.9   1.4   6:21.78 maxima                                                                                                                                
14806 dimpase   20   0  255672 190624  14884 R  41.5   1.2   2:50.26 maxima                                                                                                                                
 8230 dimpase   20   0  490176 425464  14964 R  41.2   2.6  17:20.55 maxima                                                                                                                                
13635 dimpase   20   0  314196 237876  14988 R  40.9   1.5   7:40.07 maxima                                                                                                                                
 6978 dimpase   20   0  490944 426156  15152 R  40.2   2.6  18:02.45 maxima                                                                                                                                
 8635 dimpase   20   0  490852 425820  14960 R  38.9   2.6  16:51.44 maxima                                                                                                                                
15220 dimpase   20   0  255628 190808  14916 R  38.9   1.2   1:58.04 maxima                                                                                                                                
 8050 dimpase   20   0  490176 425796  15296 R  38.5   2.6  17:17.71 maxima                                                                                                                                
15286 dimpase   20   0  238476 173380  14912 R  38.5   1.1   1:21.26 maxima                                                                                                                                
 8678 dimpase   20   0  489920 425044  15036 R  38.2   2.6  16:54.90 maxima                                                                                                                                
14490 dimpase   20   0  295088 230148  14972 R  38.2   1.4   5:27.37 maxima                                                                                                                                
13789 dimpase   20   0  312752 232936  14864 R  37.9   1.4   7:22.27 maxima                                                                                                                                
14116 dimpase   20   0  295600 230720  15040 R  37.2   1.4   6:22.48 maxima                                                                                                                                
14453 dimpase   20   0  296020 231248  14956 R  37.2   1.4   5:27.63 maxima                                                                                                                                
15412 dimpase   20   0  220812 156160  15112 R  36.9   1.0   0:54.24 maxima                                                                                                                                
15971 dimpase   20   0 1418768 244428  43224 R   4.3   1.5   0:00.78 python3                                                                                                                               
15891 dimpase   20   0 1332768 204008  14336 R   3.3   1.2   0:04.51 python3                                                                                                                               
15908 dimpase   20   0 1477908 293144  57444 R   3.3   1.8   0:05.13 python3                                                                                                                               
15937 dimpase   20   0 1672080 289956  26744 R   3.3   1.8   0:03.49 python3                                                                                                                               
15938 dimpase   20   0 1389976 241124  28616 R   3.3   1.5   0:03.50 python3                                                                                                                               
15951 dimpase   20   0 1726520 315200  37664 R   3.3   1.9   0:02.40 python3                                                                                                                               
15953 dimpase   20   0 1333964 220592  30044 R   3.3   1.3   0:02.36 python3                                                                                                                               
15959 dimpase   20   0 1380784 226536  22884 R   3.3   1.4   0:01.63 python3                                                                                                                               
15963 dimpase   20   0 1380456 231188  27976 R   3.3   1.4   0:01.31 python3                                                                                                                               
15976 dimpase   20   0 1338012 213532  18876 R   3.3   1.3   0:00.59 python3                                                                                                                               
15969 dimpase   20   0 1342848 219184  28928 R   3.0   1.3   0:00.86 python3                                                                                                                               
15973 dimpase   20   0 1341560 221264  23480 R   3.0   1.4   0:00.69 python3                 
```




---

archive/issue_comments_400466.json:
```json
{
    "body": "This is also a bit weird:\n\n```\n$ find . -name sage-cleaner \n./src/bin/sage-cleaner\n./local/bin/sage-cleaner\n./build/pkgs/sagelib/src/build/scripts-3.7/sage-cleaner\n```\n\n\nOK, I'll try a build from scratch.",
    "created_at": "2020-10-20T17:40:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400466",
    "user": "https://github.com/dimpase"
}
```

This is also a bit weird:

```
$ find . -name sage-cleaner 
./src/bin/sage-cleaner
./local/bin/sage-cleaner
./build/pkgs/sagelib/src/build/scripts-3.7/sage-cleaner
```


OK, I'll try a build from scratch.



---

archive/issue_comments_400467.json:
```json
{
    "body": "Replying to [comment:46 dimpase]:\n> This is also a bit weird:\n> {{{\n> $ find . -name sage-cleaner \n> ./src/bin/sage-cleaner\n> ./local/bin/sage-cleaner\n> ./build/pkgs/sagelib/src/build/scripts-3.7/sage-cleaner\n> }}}\n\nThis is normal",
    "created_at": "2020-10-20T17:42:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400467",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:46 dimpase]:
> This is also a bit weird:
> {{{
> $ find . -name sage-cleaner 
> ./src/bin/sage-cleaner
> ./local/bin/sage-cleaner
> ./build/pkgs/sagelib/src/build/scripts-3.7/sage-cleaner
> }}}

This is normal



---

archive/issue_comments_400468.json:
```json
{
    "body": "the same picture after `make distclean && make -j11 ptest`. Half a dozen  Maxima processes running for 30 minutes or more. There is a `sage-cleaner` running (strangely, the one in `src/bin`, not in `local/bin`, apparently missing these Maxima zombies.",
    "created_at": "2020-10-20T19:13:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400468",
    "user": "https://github.com/dimpase"
}
```

the same picture after `make distclean && make -j11 ptest`. Half a dozen  Maxima processes running for 30 minutes or more. There is a `sage-cleaner` running (strangely, the one in `src/bin`, not in `local/bin`, apparently missing these Maxima zombies.



---

archive/issue_comments_400469.json:
```json
{
    "body": "\n```\n$ ps -def | grep sage-clean\ndimpase  15068 15000  0 11:33 pts/2    00:00:00 /bin/sh /home/scratch2/dimpase/sage/sage-clang/src/bin/sage-python /home/scratch2/dimpase/sage/sage-clang/src/bin/sage-cleaner\ndimpase  15070 15068  0 11:33 pts/2    00:00:00 /home/scratch2/dimpase/sage/sage-clang/local/bin/python3 /home/scratch2/dimpase/sage/sage-clang/src/bin/sage-cleaner\ndimpase  27819 22676  0 20:14 pts/14   00:00:00 grep --color=auto sage-clean\n```\n\n\nwhy is anything running from `src/bin/` at all?",
    "created_at": "2020-10-20T19:17:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400469",
    "user": "https://github.com/dimpase"
}
```


```
$ ps -def | grep sage-clean
dimpase  15068 15000  0 11:33 pts/2    00:00:00 /bin/sh /home/scratch2/dimpase/sage/sage-clang/src/bin/sage-python /home/scratch2/dimpase/sage/sage-clang/src/bin/sage-cleaner
dimpase  15070 15068  0 11:33 pts/2    00:00:00 /home/scratch2/dimpase/sage/sage-clang/local/bin/python3 /home/scratch2/dimpase/sage/sage-clang/src/bin/sage-cleaner
dimpase  27819 22676  0 20:14 pts/14   00:00:00 grep --color=auto sage-clean
```


why is anything running from `src/bin/` at all?



---

archive/issue_comments_400470.json:
```json
{
    "body": "That's what I have in the patch of ./sage -sh: (or buildsh, no difference)\n\n```\n$ echo $PATH\n/home/scratch2/dimpase/sage/sage-clang/build/bin:/home/scratch2/dimpase/sage/sage-clang/src/bin:/home/scratch2/dimpase/sage/sage-clang/local/bin:/home/scratch2/dimpase/miniconda3/condabin:/users/dimpase/perl5/bin:/users/dimpase/bin:/usr/libexec/python3-sphinx:/usr/lib64/qt-3.3/bin:/usr/share/Modules/bin:/usr/lib64/ccache:/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/users/dimpase/.cabal/bin:/auto/users/dimpase/bin\n```\n",
    "created_at": "2020-10-20T19:22:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400470",
    "user": "https://github.com/dimpase"
}
```

That's what I have in the patch of ./sage -sh: (or buildsh, no difference)

```
$ echo $PATH
/home/scratch2/dimpase/sage/sage-clang/build/bin:/home/scratch2/dimpase/sage/sage-clang/src/bin:/home/scratch2/dimpase/sage/sage-clang/local/bin:/home/scratch2/dimpase/miniconda3/condabin:/users/dimpase/perl5/bin:/users/dimpase/bin:/usr/libexec/python3-sphinx:/usr/lib64/qt-3.3/bin:/usr/share/Modules/bin:/usr/lib64/ccache:/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/users/dimpase/.cabal/bin:/auto/users/dimpase/bin
```




---

archive/issue_comments_400471.json:
```json
{
    "body": "Replying to [comment:49 dimpase]:\n> {{{\n> $ ps -def | grep sage-clean\n> dimpase  15068 15000  0 11:33 pts/2    00:00:00 /bin/sh /home/scratch2/dimpase/sage/sage-clang/src/bin/sage-python /home/scratch2/dimpase/sage/sage-clang/src/bin/sage-cleaner\n> dimpase  15070 15068  0 11:33 pts/2    00:00:00 /home/scratch2/dimpase/sage/sage-clang/local/bin/python3 /home/scratch2/dimpase/sage/sage-clang/src/bin/sage-cleaner\n> dimpase  27819 22676  0 20:14 pts/14   00:00:00 grep --color=auto sage-clean\n> }}}\n> \n> why is anything running from `src/bin/` at all?\n\nThe scripts in $SAGE_SRC/bin are preferred over the installed scripts in $SAGE_LOCAL/bin - see `sage-env`:\n\n```\nexport PATH=\"$SAGE_ROOT/build/bin:$SAGE_SRC/bin:$SAGE_LOCAL/bin:$PATH\"\n```\n",
    "created_at": "2020-10-20T19:47:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400471",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:49 dimpase]:
> {{{
> $ ps -def | grep sage-clean
> dimpase  15068 15000  0 11:33 pts/2    00:00:00 /bin/sh /home/scratch2/dimpase/sage/sage-clang/src/bin/sage-python /home/scratch2/dimpase/sage/sage-clang/src/bin/sage-cleaner
> dimpase  15070 15068  0 11:33 pts/2    00:00:00 /home/scratch2/dimpase/sage/sage-clang/local/bin/python3 /home/scratch2/dimpase/sage/sage-clang/src/bin/sage-cleaner
> dimpase  27819 22676  0 20:14 pts/14   00:00:00 grep --color=auto sage-clean
> }}}
> 
> why is anything running from `src/bin/` at all?

The scripts in $SAGE_SRC/bin are preferred over the installed scripts in $SAGE_LOCAL/bin - see `sage-env`:

```
export PATH="$SAGE_ROOT/build/bin:$SAGE_SRC/bin:$SAGE_LOCAL/bin:$PATH"
```




---

archive/issue_comments_400472.json:
```json
{
    "body": "that's how it looks some time into make ptest\n\n```\n2901 dimpase   20   0  296788 231908  14816 R  32.6   1.4   6:51.62 maxima                                                          \n 3620 dimpase   20   0  271848 206812  14892 R  32.6   1.3   4:43.95 maxima                                                          \n14383 dimpase   20   0 1010928 935392  14828 R  32.6   5.7  60:34.33 maxima                                                          \n28253 dimpase   20   0  579776 502700  15112 R  32.6   3.1  27:05.16 maxima                                                          \n 3993 dimpase   20   0  237584 172452  14872 S  32.2   1.1   2:05.58 maxima                                                          \n 9113 dimpase   20   0 1172372   1.0g  14936 R  32.2   6.7  78:25.36 maxima                                                          \n  920 dimpase   20   0  366420 301280  14892 R  31.9   1.8  10:21.38 maxima                                                          \n 2791 dimpase   20   0  297044 232316  14972 R  31.9   1.4   7:07.70 maxima                                                          \n 7627 dimpase   20   0 1207188   1.1g  15220 R  31.9   6.9  81:05.87 maxima                                                          \n13239 dimpase   20   0 1082952 984.0m  15912 R  31.9   6.2  69:10.38 maxima                                                          \n27668 dimpase   20   0  694396 629220  14808 R  31.9   3.8  31:36.46 maxima                                                          \n29342 dimpase   20   0  544960 475212  15076 R  31.9   2.9  24:28.83 maxima                                                          \n  764 dimpase   20   0  367444 302668  14964 R  31.6   1.8  11:30.94 maxima                                                          \n 2675 dimpase   20   0  296788 232196  15120 R  31.6   1.4   6:50.34 maxima                                                          \n 4535 dimpase   20   0  202472 137496  15056 R  31.6   0.8   0:28.07 maxima                                                          \n 8979 dimpase   20   0 1153008   1.0g  14772 R  31.6   6.6  76:06.60 maxima                                                          \n15549 dimpase   20   0  994964 926360  15244 R  31.6   5.7  59:28.08 maxima                                                          \n 3229 dimpase   20   0  296020 231336  15036 R  31.2   1.4   5:44.30 maxima                                                          \n 3569 dimpase   20   0  296020 231256  14960 R  31.2   1.4   4:49.63 maxima                                                          \n29192 dimpase   20   0  545636 474636  15208 R  31.2   2.9  24:24.71 maxima                                                          \n32520 dimpase   20   0  385784 316468  14908 R  31.2   1.9  12:32.67 maxima                                                          \n27629 dimpase   20   0  694396 629536  15144 R  30.9   3.8  31:25.58 maxima                                                          \n 4458 dimpase   20   0  237288 172552  14992 R  30.6   1.1   1:02.70 maxima                                                          \n 4414 dimpase   20   0  237288 172572  14996 R  30.2   1.1   1:02.69 maxima                                                          \n 4638 dimpase   20   0 1517256 299848  58604 R   2.7   1.8   0:03.71 python3                                                         \n 4654 dimpase   20   0 1511288 293552  50604 R   2.3   1.8   0:03.54 python3                                                         \n 4882 dimpase   20   0 1335900 202072  12196 R   2.3   1.2   0:00.63 python3                                                         \n 5156 dimpase   20   0   14652   9852   5216 R   2.3   0.1   0:00.08 python3                                                         \n 4679 dimpase   20   0 1473088 303752  70860 R   2.0   1.9   0:03.21 python3                                                         \n 4714 dimpase   20   0 1362904 251744  39536 R   2.0   1.5   0:02.18 python3                                                         \n```\n\n\nAny idea as to what causes sage-cleaner to leave these maxima processes running?\nE.g. here is one long-running one:\n\n```\n01:21:52 /home/scratch2/dimpase/sage/sage-clang/local/lib/maxima/5.44.0/binary-ecl/maxima --frame-stack 4096 --lisp-stack 65536 -- -p /home/scratch2/dimpase/sage/sage-clang/local/lib64/python3.7/site-packages/sage/interfaces/sage-maxima.lisp\n```\n\n\nThis is Fedora 30, and so ECL is built with system (threaded) libgc version 7.6.4 and libatomic_ops, if it matters, don't know.",
    "created_at": "2020-10-20T20:15:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400472",
    "user": "https://github.com/dimpase"
}
```

that's how it looks some time into make ptest

```
2901 dimpase   20   0  296788 231908  14816 R  32.6   1.4   6:51.62 maxima                                                          
 3620 dimpase   20   0  271848 206812  14892 R  32.6   1.3   4:43.95 maxima                                                          
14383 dimpase   20   0 1010928 935392  14828 R  32.6   5.7  60:34.33 maxima                                                          
28253 dimpase   20   0  579776 502700  15112 R  32.6   3.1  27:05.16 maxima                                                          
 3993 dimpase   20   0  237584 172452  14872 S  32.2   1.1   2:05.58 maxima                                                          
 9113 dimpase   20   0 1172372   1.0g  14936 R  32.2   6.7  78:25.36 maxima                                                          
  920 dimpase   20   0  366420 301280  14892 R  31.9   1.8  10:21.38 maxima                                                          
 2791 dimpase   20   0  297044 232316  14972 R  31.9   1.4   7:07.70 maxima                                                          
 7627 dimpase   20   0 1207188   1.1g  15220 R  31.9   6.9  81:05.87 maxima                                                          
13239 dimpase   20   0 1082952 984.0m  15912 R  31.9   6.2  69:10.38 maxima                                                          
27668 dimpase   20   0  694396 629220  14808 R  31.9   3.8  31:36.46 maxima                                                          
29342 dimpase   20   0  544960 475212  15076 R  31.9   2.9  24:28.83 maxima                                                          
  764 dimpase   20   0  367444 302668  14964 R  31.6   1.8  11:30.94 maxima                                                          
 2675 dimpase   20   0  296788 232196  15120 R  31.6   1.4   6:50.34 maxima                                                          
 4535 dimpase   20   0  202472 137496  15056 R  31.6   0.8   0:28.07 maxima                                                          
 8979 dimpase   20   0 1153008   1.0g  14772 R  31.6   6.6  76:06.60 maxima                                                          
15549 dimpase   20   0  994964 926360  15244 R  31.6   5.7  59:28.08 maxima                                                          
 3229 dimpase   20   0  296020 231336  15036 R  31.2   1.4   5:44.30 maxima                                                          
 3569 dimpase   20   0  296020 231256  14960 R  31.2   1.4   4:49.63 maxima                                                          
29192 dimpase   20   0  545636 474636  15208 R  31.2   2.9  24:24.71 maxima                                                          
32520 dimpase   20   0  385784 316468  14908 R  31.2   1.9  12:32.67 maxima                                                          
27629 dimpase   20   0  694396 629536  15144 R  30.9   3.8  31:25.58 maxima                                                          
 4458 dimpase   20   0  237288 172552  14992 R  30.6   1.1   1:02.70 maxima                                                          
 4414 dimpase   20   0  237288 172572  14996 R  30.2   1.1   1:02.69 maxima                                                          
 4638 dimpase   20   0 1517256 299848  58604 R   2.7   1.8   0:03.71 python3                                                         
 4654 dimpase   20   0 1511288 293552  50604 R   2.3   1.8   0:03.54 python3                                                         
 4882 dimpase   20   0 1335900 202072  12196 R   2.3   1.2   0:00.63 python3                                                         
 5156 dimpase   20   0   14652   9852   5216 R   2.3   0.1   0:00.08 python3                                                         
 4679 dimpase   20   0 1473088 303752  70860 R   2.0   1.9   0:03.21 python3                                                         
 4714 dimpase   20   0 1362904 251744  39536 R   2.0   1.5   0:02.18 python3                                                         
```


Any idea as to what causes sage-cleaner to leave these maxima processes running?
E.g. here is one long-running one:

```
01:21:52 /home/scratch2/dimpase/sage/sage-clang/local/lib/maxima/5.44.0/binary-ecl/maxima --frame-stack 4096 --lisp-stack 65536 -- -p /home/scratch2/dimpase/sage/sage-clang/local/lib64/python3.7/site-packages/sage/interfaces/sage-maxima.lisp
```


This is Fedora 30, and so ECL is built with system (threaded) libgc version 7.6.4 and libatomic_ops, if it matters, don't know.



---

archive/issue_comments_400473.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-11-25T19:13:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400473",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_400474.json:
```json
{
    "body": "it all works just fine.\n----\nNew commits:",
    "created_at": "2020-11-25T19:13:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400474",
    "user": "https://github.com/dimpase"
}
```

it all works just fine.
----
New commits:



---

archive/issue_comments_400475.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2020-12-04T23:57:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400475",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_400476.json:
```json
{
    "body": "On 32-bit:\n\n```\n**********************************************************************\nFile \"src/sage/rings/real_arb.pyx\", line 300, in sage.rings.real_arb.arb_to_mpfi\nFailed example:\n    RIF(RBF(2)**(2**100)) # arb218 # indirect doctest\nExpected:\n    [5.8756537891115869e1388255822130839282 .. +infinity]\nGot:\n    [2.0985787164673874e323228496 .. +infinity]\n**********************************************************************\n1 item had failures:\n   1 of   2 in sage.rings.real_arb.arb_to_mpfi\n    [546 tests, 1 failure, 0.37 s]\n----------------------------------------------------------------------\nsage -t --long --random-seed=0 src/sage/rings/real_arb.pyx  # 1 doctest failed\n----------------------------------------------------------------------\n```\n",
    "created_at": "2020-12-04T23:57:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400476",
    "user": "https://github.com/vbraun"
}
```

On 32-bit:

```
**********************************************************************
File "src/sage/rings/real_arb.pyx", line 300, in sage.rings.real_arb.arb_to_mpfi
Failed example:
    RIF(RBF(2)**(2**100)) # arb218 # indirect doctest
Expected:
    [5.8756537891115869e1388255822130839282 .. +infinity]
Got:
    [2.0985787164673874e323228496 .. +infinity]
**********************************************************************
1 item had failures:
   1 of   2 in sage.rings.real_arb.arb_to_mpfi
    [546 tests, 1 failure, 0.37 s]
----------------------------------------------------------------------
sage -t --long --random-seed=0 src/sage/rings/real_arb.pyx  # 1 doctest failed
----------------------------------------------------------------------
```




---

archive/issue_comments_400477.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-12-07T15:38:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400477",
    "user": "https://github.com/dimpase"
}
```

New commits:



---

archive/issue_comments_400478.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-12-07T15:38:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400478",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_400479.json:
```json
{
    "body": "rebased over the latest beta and added tags. Please test on 32 bits in particular",
    "created_at": "2020-12-07T15:38:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400479",
    "user": "https://github.com/dimpase"
}
```

rebased over the latest beta and added tags. Please test on 32 bits in particular



---

archive/issue_comments_400480.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-07T21:14:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400480",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_400481.json:
```json
{
    "body": "passes all the tests on 32-bit now",
    "created_at": "2020-12-07T21:15:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400481",
    "user": "https://github.com/dimpase"
}
```

passes all the tests on 32-bit now



---

archive/issue_comments_400482.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-12-07T23:08:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400482",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_400483.json:
```json
{
    "body": "duh, now it's finally right, passes both on 32 and 64 bits.",
    "created_at": "2020-12-07T23:15:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400483",
    "user": "https://github.com/dimpase"
}
```

duh, now it's finally right, passes both on 32 and 64 bits.



---

archive/issue_comments_400484.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-12-08T01:29:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400484",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_400485.json:
```json
{
    "body": "LGTM",
    "created_at": "2020-12-08T01:29:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400485",
    "user": "https://github.com/mkoeppe"
}
```

LGTM



---

archive/issue_events_026278.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2020-12-13T20:31:13Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28386#event-26278"
}
```



---

archive/issue_comments_400486.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-12-13T20:31:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28386",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28386#issuecomment-400486",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
