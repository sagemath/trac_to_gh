# Issue 32538: Mostly fix slow down by #30022

archive/issues_032538.json:
```json
{
    "body": "CC:  @tscrim\n\nWe avoid multiple imports caused by #30022:\n\nBefore (and with #30022):\n\n```\nsage: a = 1/1000\nsage: %timeit a.__pari__()\n810 ns \u00b1 2.33 ns per loop (mean \u00b1 std. dev. of 7 runs, 1000000 loops each)\nsage: p = a.__pari__()\nsage: %timeit QQ(p)\n1.52 \u00b5s \u00b1 1.37 ns per loop (mean \u00b1 std. dev. of 7 runs, 1000000 loops each)\nsage: a = 12314\nsage: %timeit a.__pari__()\n723 ns \u00b1 0.804 ns per loop (mean \u00b1 std. dev. of 7 runs, 1000000 loops each)\nsage: p = a.__pari__()\nsage: %timeit ZZ(p)\n715 ns \u00b1 1.32 ns per loop (mean \u00b1 std. dev. of 7 runs, 1000000 loops each)\nsage: %timeit a.divisors(method='pari')\n1.23 \u00b5s \u00b1 1.51 ns per loop (mean \u00b1 std. dev. of 7 runs, 1000000 loops each)\nsage: %timeit a.is_prime_power()\n647 ns \u00b1 0.164 ns per loop (mean \u00b1 std. dev. of 7 runs, 1000000 loops each)\nsage: %timeit a.is_prime()\n604 ns \u00b1 0.486 ns per loop (mean \u00b1 std. dev. of 7 runs, 1000000 loops each)\nsage: %timeit a.factor()\n3.6 \u00b5s \u00b1 13.4 ns per loop (mean \u00b1 std. dev. of 7 runs, 100000 loops each)\n```\n\nReverting #30022:\n\n```\nsage: a = 1/1000\nsage: %timeit a.__pari__()\n221 ns \u00b1 0.289 ns per loop (mean \u00b1 std. dev. of 7 runs, 1000000 loops each)\nsage: p = a.__pari__()\nsage: %timeit QQ(p)\n810 ns \u00b1 0.852 ns per loop (mean \u00b1 std. dev. of 7 runs, 1000000 loops each)\nsage: a = 12314\nsage: %timeit a.__pari__()\n176 ns \u00b1 0.217 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000000 loops each)\nsage: p = a.__pari__()\nsage: %timeit ZZ(p)\n150 ns \u00b1 0.104 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000000 loops each)\nsage: %timeit a.divisors(method='pari')\n643 ns \u00b1 1.38 ns per loop (mean \u00b1 std. dev. of 7 runs, 1000000 loops each)\nsage: %timeit a.is_prime_power()\n53.9 ns \u00b1 0.336 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000000 loops each)\nsage: %timeit a.is_prime()\n58 ns \u00b1 0.174 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000000 loops each)\nsage: %timeit a.factor()\n2.99 \u00b5s \u00b1 4.62 ns per loop (mean \u00b1 std. dev. of 7 runs, 100000 loops each)\n```\n\nWith this ticket:\n\n```\nsage: a = 1/1000\nsage: %timeit a.__pari__()\n274 ns \u00b1 0.344 ns per loop (mean \u00b1 std. dev. of 7 runs, 1000000 loops each)\nsage: p = a.__pari__()\nsage: %timeit QQ(p)\n867 ns \u00b1 0.999 ns per loop (mean \u00b1 std. dev. of 7 runs, 1000000 loops each)\nsage: a = 12314\nsage: %timeit a.__pari__()\n200 ns \u00b1 0.0656 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000000 loops each)\nsage: p = a.__pari__()\nsage: %timeit ZZ(p)\n716 ns \u00b1 0.912 ns per loop (mean \u00b1 std. dev. of 7 runs, 1000000 loops each)\nsage: %timeit a.divisors(method='pari')\n673 ns \u00b1 0.928 ns per loop (mean \u00b1 std. dev. of 7 runs, 1000000 loops each)\nsage: %timeit a.is_prime_power()\n88.4 ns \u00b1 0.075 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000000 loops each)\nsage: %timeit a.is_prime()\n68.9 ns \u00b1 0.0878 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000000 loops each)\nsage: %timeit a.factor()\n3.19 \u00b5s \u00b1 10.2 ns per loop (mean \u00b1 std. dev. of 7 runs, 100000 loops each)\n```\n\nIssue created by migration from https://trac.sagemath.org/ticket/32775\n\n",
    "created_at": "2021-10-26T13:02:45Z",
    "labels": [
        "component: refactoring"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "Mostly fix slow down by #30022",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32538",
    "user": "https://github.com/kliem"
}
```
CC:  @tscrim

We avoid multiple imports caused by #30022:

Before (and with #30022):

```
sage: a = 1/1000
sage: %timeit a.__pari__()
810 ns ± 2.33 ns per loop (mean ± std. dev. of 7 runs, 1000000 loops each)
sage: p = a.__pari__()
sage: %timeit QQ(p)
1.52 µs ± 1.37 ns per loop (mean ± std. dev. of 7 runs, 1000000 loops each)
sage: a = 12314
sage: %timeit a.__pari__()
723 ns ± 0.804 ns per loop (mean ± std. dev. of 7 runs, 1000000 loops each)
sage: p = a.__pari__()
sage: %timeit ZZ(p)
715 ns ± 1.32 ns per loop (mean ± std. dev. of 7 runs, 1000000 loops each)
sage: %timeit a.divisors(method='pari')
1.23 µs ± 1.51 ns per loop (mean ± std. dev. of 7 runs, 1000000 loops each)
sage: %timeit a.is_prime_power()
647 ns ± 0.164 ns per loop (mean ± std. dev. of 7 runs, 1000000 loops each)
sage: %timeit a.is_prime()
604 ns ± 0.486 ns per loop (mean ± std. dev. of 7 runs, 1000000 loops each)
sage: %timeit a.factor()
3.6 µs ± 13.4 ns per loop (mean ± std. dev. of 7 runs, 100000 loops each)
```

Reverting #30022:

```
sage: a = 1/1000
sage: %timeit a.__pari__()
221 ns ± 0.289 ns per loop (mean ± std. dev. of 7 runs, 1000000 loops each)
sage: p = a.__pari__()
sage: %timeit QQ(p)
810 ns ± 0.852 ns per loop (mean ± std. dev. of 7 runs, 1000000 loops each)
sage: a = 12314
sage: %timeit a.__pari__()
176 ns ± 0.217 ns per loop (mean ± std. dev. of 7 runs, 10000000 loops each)
sage: p = a.__pari__()
sage: %timeit ZZ(p)
150 ns ± 0.104 ns per loop (mean ± std. dev. of 7 runs, 10000000 loops each)
sage: %timeit a.divisors(method='pari')
643 ns ± 1.38 ns per loop (mean ± std. dev. of 7 runs, 1000000 loops each)
sage: %timeit a.is_prime_power()
53.9 ns ± 0.336 ns per loop (mean ± std. dev. of 7 runs, 10000000 loops each)
sage: %timeit a.is_prime()
58 ns ± 0.174 ns per loop (mean ± std. dev. of 7 runs, 10000000 loops each)
sage: %timeit a.factor()
2.99 µs ± 4.62 ns per loop (mean ± std. dev. of 7 runs, 100000 loops each)
```

With this ticket:

```
sage: a = 1/1000
sage: %timeit a.__pari__()
274 ns ± 0.344 ns per loop (mean ± std. dev. of 7 runs, 1000000 loops each)
sage: p = a.__pari__()
sage: %timeit QQ(p)
867 ns ± 0.999 ns per loop (mean ± std. dev. of 7 runs, 1000000 loops each)
sage: a = 12314
sage: %timeit a.__pari__()
200 ns ± 0.0656 ns per loop (mean ± std. dev. of 7 runs, 10000000 loops each)
sage: p = a.__pari__()
sage: %timeit ZZ(p)
716 ns ± 0.912 ns per loop (mean ± std. dev. of 7 runs, 1000000 loops each)
sage: %timeit a.divisors(method='pari')
673 ns ± 0.928 ns per loop (mean ± std. dev. of 7 runs, 1000000 loops each)
sage: %timeit a.is_prime_power()
88.4 ns ± 0.075 ns per loop (mean ± std. dev. of 7 runs, 10000000 loops each)
sage: %timeit a.is_prime()
68.9 ns ± 0.0878 ns per loop (mean ± std. dev. of 7 runs, 10000000 loops each)
sage: %timeit a.factor()
3.19 µs ± 10.2 ns per loop (mean ± std. dev. of 7 runs, 100000 loops each)
```

Issue created by migration from https://trac.sagemath.org/ticket/32775





---

archive/issue_comments_463612.json:
```json
{
    "body": "New commits:",
    "created_at": "2021-10-26T13:03:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32538#issuecomment-463612",
    "user": "https://github.com/kliem"
}
```

New commits:



---

archive/issue_comments_463613.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-10-26T13:03:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32538#issuecomment-463613",
    "user": "https://github.com/kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_463614.json:
```json
{
    "body": "The test failures are not from this ticket:\n\n```\nsage -t --long --random-seed=29194783039255016302038928490654063942 src/sage/rings/integer.pyx  # 1 doctest failed\nsage -t --long --random-seed=29194783039255016302038928490654063942 src/sage/modular/modform/numerical.py  # 3 doctests failed\n```",
    "created_at": "2021-10-26T17:52:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32538#issuecomment-463614",
    "user": "https://github.com/mkoeppe"
}
```

The test failures are not from this ticket:

```
sage -t --long --random-seed=29194783039255016302038928490654063942 src/sage/rings/integer.pyx  # 1 doctest failed
sage -t --long --random-seed=29194783039255016302038928490654063942 src/sage/modular/modform/numerical.py  # 3 doctests failed
```



---

archive/issue_comments_463615.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-10-26T17:53:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32538#issuecomment-463615",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_463616.json:
```json
{
    "body": "Thanks for working on this! LGTM.",
    "created_at": "2021-10-26T17:53:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32538#issuecomment-463616",
    "user": "https://github.com/mkoeppe"
}
```

Thanks for working on this! LGTM.



---

archive/issue_comments_463617.json:
```json
{
    "body": "Thank you.",
    "created_at": "2021-10-26T19:17:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32538#issuecomment-463617",
    "user": "https://github.com/kliem"
}
```

Thank you.



---

archive/issue_comments_463618.json:
```json
{
    "body": "Not sure about `set_integer_from_pari_gen` vs `set_integer_from_gen`.",
    "created_at": "2021-10-27T12:46:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32538#issuecomment-463618",
    "user": "https://github.com/slel"
}
```

Not sure about `set_integer_from_pari_gen` vs `set_integer_from_gen`.



---

archive/issue_comments_463619.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2021-10-27T13:41:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32538#issuecomment-463619",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_463620.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2021-10-27T13:41:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32538#issuecomment-463620",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_463621.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-10-27T18:07:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32538#issuecomment-463621",
    "user": "https://github.com/slel"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_463622.json:
```json
{
    "body": "That seems better. Another option would have been to use\n\n```diff\nfrom sage.libs.pari.convert_sage import (\n    set_integer_from_gen as set_integer_from_pari_gen)\n```\nif that name mattered.",
    "created_at": "2021-10-27T18:07:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32538#issuecomment-463622",
    "user": "https://github.com/slel"
}
```

That seems better. Another option would have been to use

```diff
from sage.libs.pari.convert_sage import (
    set_integer_from_gen as set_integer_from_pari_gen)
```
if that name mattered.



---

archive/issue_comments_463623.json:
```json
{
    "body": "It was just a typo and made this whole construction pointless there. This is the reason, I modified the benchmarks as well.",
    "created_at": "2021-10-27T18:22:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32538#issuecomment-463623",
    "user": "https://github.com/kliem"
}
```

It was just a typo and made this whole construction pointless there. This is the reason, I modified the benchmarks as well.



---

archive/issue_events_086722.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-10-31T22:20:34Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32538",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32538#event-86722"
}
```



---

archive/issue_comments_463624.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-10-31T22:20:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32538",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32538#issuecomment-463624",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
