# Issue 22724: wrong answers from codesize_upper_bound()

Issue created by migration from https://trac.sagemath.org/ticket/22961

Original creator: dimpase

Original creation time: 2017-05-08 23:31:05

CC:  jsrn dlucas

with the default method, `codesize_upper_bound()` erroneously uses the bound only valid for linear codes.

```
sage: codes.bounds.codesize_upper_bound(19,10,2,algorithm="LP") # OK
20
sage: codes.bounds.codesize_upper_bound(19,10,2,algorithm="gap") # OK
20
sage: codes.bounds.codesize_upper_bound(19,10,2) # Not OK
8
```

see [sage-support](https://groups.google.com/d/msg/sage-support/ZXtAaLSoL38/HfSQ_59zDAAJ)


---

Comment by dimpase created at 2017-05-09 09:10:30

New commits:


---

Comment by git created at 2017-05-09 11:59:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2017-05-09 12:02:07

now the doctests pick up an error in `codes.bounds.griesmer_upper_bound`.
(related to the new meaning of / and %, I guess)


---

Comment by git created at 2017-05-09 21:49:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-05-10 09:10:09

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by dimpase created at 2017-05-10 09:14:33

Only the changes on `src/sage/coding/code_bounds.py` have to be reviewed.

Apart from the bugfix, I've streamlined the code of Griesmer bound, and added some more sanity checks, docs and doctests. (previously the loop in Griesmer bound did not terminate on weird inputs, etc).


---

Comment by dimpase created at 2017-05-10 09:14:33

Changing status from new to needs_review.


---

Comment by jsrn created at 2017-05-11 12:58:56

Hi Dima,

I agree with your fixes. I took the liberty to slightly extend the scope of this ticket even more:

* Inspired by your parameter checks in `codesize_upper_bound` and `griesmer_upper_bound`, I added such a check on all the relevant functions, which throws a `ValueError` on failure.

* I fixed grammar, markup and some semantics in a number of doc-strings (I went
  through them all, but I might of course have missed some errors).

* I removed the 6 year old argument deprecation warning on some functions.

Could you review my changes?

Further, I'm actually motivated to take this opportunity to fix the other annoying thing that was brought up on sage-support: the `n, q, d` vs. `n, d, q` argument order. Let's say we agreed on `n, d, q` order - then we could in this ticket modify the relevant functions thusly:


```
def gilbert_lower_bound(n,d,q, old_params=True):
   r""" ... """
   if old_params:
      deprecation("The old parameter order `n, q, d` is deprecated and will be changed to `n, d, q`. To use the new parameter order and remove this warning, use `sage.codes.bounds.gilbert_lower_bound(n, d, q, old_params=False)`.")
      d,q = q,d
   (...)
```


After the deprecation period is over, we can remove the `if`-statement.

I can do the change if you agree. Also, do we agree that `n, d, q` is better than `n, q, d`? It seems the former is also used in the Delsarte bounds.

Best,
Johan
----
New commits:


---

Comment by dimpase created at 2017-05-11 16:32:49

Thanks for looking into this. I think that the check on the parameters of `codesize_upper_bound()` introduced in [1ee9d38](https://git.sagemath.org/sage.git/commit?id=1ee9d38a5fc003d6cad6c9faf54cbf936f6954a8) is too hard. Indeed, some of these bounds do not need `q` being a prime power. (This must also be reflected in the top-level documentation in the file; I suppose I overlooked this at some point in the past).

E.g. Delsarte's bound does not need it; `q` is merely the size of the alphabet in this context. It remains to be seen which other bounds do not need this; Singleton bound for sure does not. I can't tell immediately about everything else.

I will add an extra parameter to `_check_n_q_d(n, q, d)` so that the check on `q` being a prime power can be disabled, and will use it sparingly.


---

Comment by jsrn created at 2017-05-12 09:02:17

Good point. For the other bounds, what I know is:

* Hamming bound holds for any alphabet size.
* I think Elias holds for any size, but it is presented in e.g. Roth's Introduction to Coding Theory as an asymptotic bound. I don't know if there are caveats when using it for finite values of n and d.
* MRRW bound is like Elias, I think.
* Gilbert-Varshamov holds only for fields.
* Griesmer holds only for fields, I believe.

Best,
Johan


---

Comment by dimpase created at 2017-05-12 10:47:40

Replying to [comment:10 jsrn]:
> Good point. For the other bounds, what I know is:
> 
> * Hamming bound holds for any alphabet size.
> * I think Elias holds for any size, but it is presented in e.g. Roth's Introduction to Coding Theory as an asymptotic bound. I don't know if there are caveats when using it for finite values of n and d.

yes, this looks correct to me, although indeed it's mostly used to bound the 
information ratio asymptotically.

> * MRRW bound is like Elias, I think.
> * Gilbert-Varshamov holds only for fields.

from the proof given in 
https://en.wikipedia.org/wiki/Gilbert%E2%80%93Varshamov_bound
I don't see why it needs to be over a field.
There is also a section named `An improvement in the prime power case`.
(I agree it's not well-written, in the beginning they start talking about 
code over a field, only to have that section later on :-))


> * Griesmer holds only for fields, I believe.
yes.


---

Comment by dimpase created at 2017-05-12 10:49:26

here are the changes in line with the latest comments.
----
New commits:


---

Comment by git created at 2017-05-12 23:31:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-05-13 20:02:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2017-05-13 20:03:12

rebased over latest beta(6).


---

Comment by git created at 2017-05-14 17:47:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jsrn created at 2017-05-17 08:18:03

Sorry, I've been away for a few days. I'll get back to this soon once I've popped my email stack...


---

Comment by jsrn created at 2017-05-19 12:41:41

It looks good and all tests pass. You removed a number of the "meaningless parameters are rejected" test blocks that I added. Not that I really mind, but why did you do that?


---

Comment by jsrn created at 2017-05-19 12:41:41

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2017-05-19 14:22:27

Thanks. I removed these tests, as they tested the same parameter-checking function all over again, something that looked excessive to me.


---

Comment by jsrn created at 2017-05-19 14:38:20

Replying to [comment:19 dimpase]:
> Thanks. I removed these tests, as they tested the same parameter-checking function all over again, something that looked excessive to me.

OK, that's a fair argument. My motivation for having them was thinking of the doc-tests as black-box testing, i.e. if you didn't know that the functions were actually each implemented with exactly the same check, you would put a test for each of them. Now, if someone comes along and completely reimplements one of the functions, he might inadvertently remove the `_check`-call, and now - oops - no test.

I won't insist on putting them back however.


---

Comment by vbraun created at 2017-05-20 20:07:47

Resolution: fixed
