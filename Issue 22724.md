# Issue 22724: wrong answers from codesize_upper_bound()

archive/issues_022724.json:
```json
{
    "body": "CC:  jsrn dlucas\n\nwith the default method, `codesize_upper_bound()` erroneously uses the bound only valid for linear codes.\n\n```\nsage: codes.bounds.codesize_upper_bound(19,10,2,algorithm=\"LP\") # OK\n20\nsage: codes.bounds.codesize_upper_bound(19,10,2,algorithm=\"gap\") # OK\n20\nsage: codes.bounds.codesize_upper_bound(19,10,2) # Not OK\n8\n```\n\nsee [sage-support](https://groups.google.com/d/msg/sage-support/ZXtAaLSoL38/HfSQ_59zDAAJ)\n\nIssue created by migration from https://trac.sagemath.org/ticket/22961\n\n",
    "created_at": "2017-05-08T23:31:05Z",
    "labels": [
        "coding theory",
        "major",
        "bug"
    ],
    "title": "wrong answers from codesize_upper_bound()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22724",
    "user": "dimpase"
}
```
CC:  jsrn dlucas

with the default method, `codesize_upper_bound()` erroneously uses the bound only valid for linear codes.

```
sage: codes.bounds.codesize_upper_bound(19,10,2,algorithm="LP") # OK
20
sage: codes.bounds.codesize_upper_bound(19,10,2,algorithm="gap") # OK
20
sage: codes.bounds.codesize_upper_bound(19,10,2) # Not OK
8
```

see [sage-support](https://groups.google.com/d/msg/sage-support/ZXtAaLSoL38/HfSQ_59zDAAJ)

Issue created by migration from https://trac.sagemath.org/ticket/22961





---

archive/issue_comments_317258.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-05-09T09:10:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22724#issuecomment-317258",
    "user": "dimpase"
}
```

New commits:



---

archive/issue_comments_317259.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-05-09T11:59:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22724#issuecomment-317259",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_317260.json:
```json
{
    "body": "now the doctests pick up an error in `codes.bounds.griesmer_upper_bound`.\n(related to the new meaning of / and %, I guess)",
    "created_at": "2017-05-09T12:02:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22724#issuecomment-317260",
    "user": "dimpase"
}
```

now the doctests pick up an error in `codes.bounds.griesmer_upper_bound`.
(related to the new meaning of / and %, I guess)



---

archive/issue_comments_317261.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-05-09T21:49:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22724#issuecomment-317261",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_317262.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-05-10T09:10:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22724#issuecomment-317262",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_317263.json:
```json
{
    "body": "Only the changes on `src/sage/coding/code_bounds.py` have to be reviewed.\n\nApart from the bugfix, I've streamlined the code of Griesmer bound, and added some more sanity checks, docs and doctests. (previously the loop in Griesmer bound did not terminate on weird inputs, etc).",
    "created_at": "2017-05-10T09:14:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22724#issuecomment-317263",
    "user": "dimpase"
}
```

Only the changes on `src/sage/coding/code_bounds.py` have to be reviewed.

Apart from the bugfix, I've streamlined the code of Griesmer bound, and added some more sanity checks, docs and doctests. (previously the loop in Griesmer bound did not terminate on weird inputs, etc).



---

archive/issue_comments_317264.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-05-10T09:14:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22724#issuecomment-317264",
    "user": "dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_317265.json:
```json
{
    "body": "Hi Dima,\n\nI agree with your fixes. I took the liberty to slightly extend the scope of this ticket even more:\n\n* Inspired by your parameter checks in `codesize_upper_bound` and `griesmer_upper_bound`, I added such a check on all the relevant functions, which throws a `ValueError` on failure.\n\n* I fixed grammar, markup and some semantics in a number of doc-strings (I went\n  through them all, but I might of course have missed some errors).\n\n* I removed the 6 year old argument deprecation warning on some functions.\n\nCould you review my changes?\n\nFurther, I'm actually motivated to take this opportunity to fix the other annoying thing that was brought up on sage-support: the `n, q, d` vs. `n, d, q` argument order. Let's say we agreed on `n, d, q` order - then we could in this ticket modify the relevant functions thusly:\n\n\n```\ndef gilbert_lower_bound(n,d,q, old_params=True):\n   r\"\"\" ... \"\"\"\n   if old_params:\n      deprecation(\"The old parameter order `n, q, d` is deprecated and will be changed to `n, d, q`. To use the new parameter order and remove this warning, use `sage.codes.bounds.gilbert_lower_bound(n, d, q, old_params=False)`.\")\n      d,q = q,d\n   (...)\n```\n\n\nAfter the deprecation period is over, we can remove the `if`-statement.\n\nI can do the change if you agree. Also, do we agree that `n, d, q` is better than `n, q, d`? It seems the former is also used in the Delsarte bounds.\n\nBest,\nJohan\n----\nNew commits:",
    "created_at": "2017-05-11T12:58:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22724#issuecomment-317265",
    "user": "jsrn"
}
```

Hi Dima,

I agree with your fixes. I took the liberty to slightly extend the scope of this ticket even more:

* Inspired by your parameter checks in `codesize_upper_bound` and `griesmer_upper_bound`, I added such a check on all the relevant functions, which throws a `ValueError` on failure.

* I fixed grammar, markup and some semantics in a number of doc-strings (I went
  through them all, but I might of course have missed some errors).

* I removed the 6 year old argument deprecation warning on some functions.

Could you review my changes?

Further, I'm actually motivated to take this opportunity to fix the other annoying thing that was brought up on sage-support: the `n, q, d` vs. `n, d, q` argument order. Let's say we agreed on `n, d, q` order - then we could in this ticket modify the relevant functions thusly:


```
def gilbert_lower_bound(n,d,q, old_params=True):
   r""" ... """
   if old_params:
      deprecation("The old parameter order `n, q, d` is deprecated and will be changed to `n, d, q`. To use the new parameter order and remove this warning, use `sage.codes.bounds.gilbert_lower_bound(n, d, q, old_params=False)`.")
      d,q = q,d
   (...)
```


After the deprecation period is over, we can remove the `if`-statement.

I can do the change if you agree. Also, do we agree that `n, d, q` is better than `n, q, d`? It seems the former is also used in the Delsarte bounds.

Best,
Johan
----
New commits:



---

archive/issue_comments_317266.json:
```json
{
    "body": "Thanks for looking into this. I think that the check on the parameters of `codesize_upper_bound()` introduced in [1ee9d38](https://git.sagemath.org/sage.git/commit?id=1ee9d38a5fc003d6cad6c9faf54cbf936f6954a8) is too hard. Indeed, some of these bounds do not need `q` being a prime power. (This must also be reflected in the top-level documentation in the file; I suppose I overlooked this at some point in the past).\n\nE.g. Delsarte's bound does not need it; `q` is merely the size of the alphabet in this context. It remains to be seen which other bounds do not need this; Singleton bound for sure does not. I can't tell immediately about everything else.\n\nI will add an extra parameter to `_check_n_q_d(n, q, d)` so that the check on `q` being a prime power can be disabled, and will use it sparingly.",
    "created_at": "2017-05-11T16:32:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22724#issuecomment-317266",
    "user": "dimpase"
}
```

Thanks for looking into this. I think that the check on the parameters of `codesize_upper_bound()` introduced in [1ee9d38](https://git.sagemath.org/sage.git/commit?id=1ee9d38a5fc003d6cad6c9faf54cbf936f6954a8) is too hard. Indeed, some of these bounds do not need `q` being a prime power. (This must also be reflected in the top-level documentation in the file; I suppose I overlooked this at some point in the past).

E.g. Delsarte's bound does not need it; `q` is merely the size of the alphabet in this context. It remains to be seen which other bounds do not need this; Singleton bound for sure does not. I can't tell immediately about everything else.

I will add an extra parameter to `_check_n_q_d(n, q, d)` so that the check on `q` being a prime power can be disabled, and will use it sparingly.



---

archive/issue_comments_317267.json:
```json
{
    "body": "Good point. For the other bounds, what I know is:\n\n* Hamming bound holds for any alphabet size.\n* I think Elias holds for any size, but it is presented in e.g. Roth's Introduction to Coding Theory as an asymptotic bound. I don't know if there are caveats when using it for finite values of n and d.\n* MRRW bound is like Elias, I think.\n* Gilbert-Varshamov holds only for fields.\n* Griesmer holds only for fields, I believe.\n\nBest,\nJohan",
    "created_at": "2017-05-12T09:02:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22724#issuecomment-317267",
    "user": "jsrn"
}
```

Good point. For the other bounds, what I know is:

* Hamming bound holds for any alphabet size.
* I think Elias holds for any size, but it is presented in e.g. Roth's Introduction to Coding Theory as an asymptotic bound. I don't know if there are caveats when using it for finite values of n and d.
* MRRW bound is like Elias, I think.
* Gilbert-Varshamov holds only for fields.
* Griesmer holds only for fields, I believe.

Best,
Johan



---

archive/issue_comments_317268.json:
```json
{
    "body": "Replying to [comment:10 jsrn]:\n> Good point. For the other bounds, what I know is:\n> \n> * Hamming bound holds for any alphabet size.\n> * I think Elias holds for any size, but it is presented in e.g. Roth's Introduction to Coding Theory as an asymptotic bound. I don't know if there are caveats when using it for finite values of n and d.\n\nyes, this looks correct to me, although indeed it's mostly used to bound the \ninformation ratio asymptotically.\n\n> * MRRW bound is like Elias, I think.\n> * Gilbert-Varshamov holds only for fields.\n\nfrom the proof given in \nhttps://en.wikipedia.org/wiki/Gilbert%E2%80%93Varshamov_bound\nI don't see why it needs to be over a field.\nThere is also a section named `An improvement in the prime power case`.\n(I agree it's not well-written, in the beginning they start talking about \ncode over a field, only to have that section later on :-))\n\n\n> * Griesmer holds only for fields, I believe.\nyes.",
    "created_at": "2017-05-12T10:47:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22724#issuecomment-317268",
    "user": "dimpase"
}
```

Replying to [comment:10 jsrn]:
> Good point. For the other bounds, what I know is:
> 
> * Hamming bound holds for any alphabet size.
> * I think Elias holds for any size, but it is presented in e.g. Roth's Introduction to Coding Theory as an asymptotic bound. I don't know if there are caveats when using it for finite values of n and d.

yes, this looks correct to me, although indeed it's mostly used to bound the 
information ratio asymptotically.

> * MRRW bound is like Elias, I think.
> * Gilbert-Varshamov holds only for fields.

from the proof given in 
https://en.wikipedia.org/wiki/Gilbert%E2%80%93Varshamov_bound
I don't see why it needs to be over a field.
There is also a section named `An improvement in the prime power case`.
(I agree it's not well-written, in the beginning they start talking about 
code over a field, only to have that section later on :-))


> * Griesmer holds only for fields, I believe.
yes.



---

archive/issue_comments_317269.json:
```json
{
    "body": "here are the changes in line with the latest comments.\n----\nNew commits:",
    "created_at": "2017-05-12T10:49:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22724#issuecomment-317269",
    "user": "dimpase"
}
```

here are the changes in line with the latest comments.
----
New commits:



---

archive/issue_comments_317270.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-05-12T23:31:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22724#issuecomment-317270",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_317271.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-05-13T20:02:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22724#issuecomment-317271",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_317272.json:
```json
{
    "body": "rebased over latest beta(6).",
    "created_at": "2017-05-13T20:03:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22724#issuecomment-317272",
    "user": "dimpase"
}
```

rebased over latest beta(6).



---

archive/issue_comments_317273.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-05-14T17:47:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22724#issuecomment-317273",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_317274.json:
```json
{
    "body": "Sorry, I've been away for a few days. I'll get back to this soon once I've popped my email stack...",
    "created_at": "2017-05-17T08:18:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22724#issuecomment-317274",
    "user": "jsrn"
}
```

Sorry, I've been away for a few days. I'll get back to this soon once I've popped my email stack...



---

archive/issue_comments_317275.json:
```json
{
    "body": "It looks good and all tests pass. You removed a number of the \"meaningless parameters are rejected\" test blocks that I added. Not that I really mind, but why did you do that?",
    "created_at": "2017-05-19T12:41:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22724#issuecomment-317275",
    "user": "jsrn"
}
```

It looks good and all tests pass. You removed a number of the "meaningless parameters are rejected" test blocks that I added. Not that I really mind, but why did you do that?



---

archive/issue_comments_317276.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-05-19T12:41:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22724#issuecomment-317276",
    "user": "jsrn"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_317277.json:
```json
{
    "body": "Thanks. I removed these tests, as they tested the same parameter-checking function all over again, something that looked excessive to me.",
    "created_at": "2017-05-19T14:22:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22724#issuecomment-317277",
    "user": "dimpase"
}
```

Thanks. I removed these tests, as they tested the same parameter-checking function all over again, something that looked excessive to me.



---

archive/issue_comments_317278.json:
```json
{
    "body": "Replying to [comment:19 dimpase]:\n> Thanks. I removed these tests, as they tested the same parameter-checking function all over again, something that looked excessive to me.\n\nOK, that's a fair argument. My motivation for having them was thinking of the doc-tests as black-box testing, i.e. if you didn't know that the functions were actually each implemented with exactly the same check, you would put a test for each of them. Now, if someone comes along and completely reimplements one of the functions, he might inadvertently remove the `_check`-call, and now - oops - no test.\n\nI won't insist on putting them back however.",
    "created_at": "2017-05-19T14:38:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22724#issuecomment-317278",
    "user": "jsrn"
}
```

Replying to [comment:19 dimpase]:
> Thanks. I removed these tests, as they tested the same parameter-checking function all over again, something that looked excessive to me.

OK, that's a fair argument. My motivation for having them was thinking of the doc-tests as black-box testing, i.e. if you didn't know that the functions were actually each implemented with exactly the same check, you would put a test for each of them. Now, if someone comes along and completely reimplements one of the functions, he might inadvertently remove the `_check`-call, and now - oops - no test.

I won't insist on putting them back however.



---

archive/issue_comments_317279.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-05-20T20:07:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22724",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22724#issuecomment-317279",
    "user": "vbraun"
}
```

Resolution: fixed
