# Issue 15736: Allow GAP to compile on OS X 10.4

Issue created by migration from https://trac.sagemath.org/ticket/15973

Original creator: kcrisman

Original creation time: 2014-03-18 18:10:24

I don't know whether this affects any other platform...


```
gcc -I. -I../.. -DCONFIG_H  -I/Users/student/Desktop/sage-6.2.beta4/local/include -Wall -g -O2  -O2 -g   -o sysfiles.o -c ../../src/sysfiles.c
../../src/sysfiles.c:3075:15: error: conflicting types for 'sys_errlist'
In file included from ../../src/sysfiles.h:20:0,
                 from ../../src/sysfiles.c:21:
/usr/include/stdio.h:274:30: note: previous declaration of 'sys_errlist' was here
make[4]: *** [sysfiles.o] Error 1
make[3]: *** [compile] Error 2
Error building GAP.

real    11m47.329s
user    7m23.375s
sys     2m4.167s
************************************************************************
Error installing package gap-4.7.4
************************************************************************
```

Dima on [this sage-release thread](https://groups.google.com/forum/#!msg/sage-release/6Vh55hF7UXk/cITCg5T83EkJ) gives the correct solution - to add -DHAVE_SYS_ERRLIST to the CFLAGS.

There is another problem with an unknown `-no_pie` flag as well.


---

Comment by dimpase created at 2014-03-18 22:50:06

I didn't give a proper solution, I gave a hack. A proper solution would be to change `configure.in` appropriately, and/or  to run autoconf etc on OSX 10.4 to generate configure.

Same applies to `-no_pie`, I guess.


---

Comment by dimpase created at 2014-03-18 22:59:05

This can be reported upstream - GAP devs usually honour requests for fixes for old and not too exotic platforms.


---

Comment by kcrisman created at 2014-03-19 00:26:10

> I didn't give a proper solution, I gave a hack. A proper solution would be to change `configure.in` appropriately, and/or  to run autoconf etc on OSX 10.4 to generate configure.
Oh, I see.  I guess we could apply a patch to that.  Though I'm having trouble seeing where it's done - configure.in, configure, sysinfo.in, none of them have `sys_err` in them.  Hard to navigate.
> Same applies to `-no_pie`, I guess.
Presumably, though I have the same trouble there.   And probably running autoconf on a bunch of different machines isn't a real solution, though maybe I'm misunderstanding this.
> This can be reported upstream - GAP devs usually honour requests for fixes for old and not too exotic platforms.
Awesome.  

So... why is there no GAP source code browser, and no public bug report list?  RWTH can't be that protective of it...


---

Comment by dimpase created at 2014-03-19 00:43:14

The issue is reported on GAP's brand new public issue tracker on Bitbucket
https://bitbucket.org/gap-system/gap/issue/1/gap-474-does-not-build-on-osx-104

Issue number 1, in fact...


---

Comment by vbraun created at 2014-03-19 03:07:23

Just to repeat my comment on the gap bitbucket tracker:

The bug is probably https://bitbucket.org/gap-system/gap/commits/86fd78bc51f7, which enabled the -no_pie linker option on OSX 10.4. But the 10.4 linker does not understand the option, so linking fails. This, in turn, causes the AC_TRY_LINK for sys_errlist to fail, and autoconf unsets HAVE_SYS_ERRLIST.


---

Comment by kcrisman created at 2014-03-20 02:30:32

In particular, see [this commit](https://bitbucket.org/gap-system/gap/commits/070b4a9).


---

Comment by kcrisman created at 2014-03-20 17:15:03

Okay, just slapping [that patch](https://bitbucket.org/gap-system/gap/commits/070b4a964402c4396625dbf81e8f1a4e830259da/raw/) in the patches directory for Gap cleared the issue (yes, I had removed the previous hack).  Git isn't built on that machine yet so I couldn't export this as a branch, but if someone can just check it doesn't mess things up on a newer OS X machine then I think we're good to go.


---

Comment by vbraun created at 2014-03-20 18:10:32

Changing status from new to needs_review.


---

Comment by vbraun created at 2014-03-20 18:10:32

New commits:


---

Comment by vbraun created at 2014-03-20 18:11:54

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-03-21 17:47:42

Resolution: fixed
