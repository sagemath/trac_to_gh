# Issue 16401: Random failure in integer_vector

Issue created by migration from Trac.

Original creator: vbraun

Original creation time: 2014-07-09 15:32:20

CC:  f.poloni ncohen wdj

I got this on my laptop once (with Sage 6.3.beta5)

```
sage -t --long src/sage/combinat/integer_vector.py
**********************************************************************
File "src/sage/combinat/integer_vector.py", line 347, in sage.combinat.integer_vector._slider01.range.gale_ryser_theorem
Failed example:
    for algorithm in ["gale", "ryser"]:                            # long time
         for i in range(50):                                         # long time
            test_algorithm(algorithm, 3, 10)                         # long time
Expected nothing
Got:
    Algorithm ryser failed with this input:
    [3, 3, 3, 1, 1, 0] [4, 4, 1, 1, 1]
**********************************************************************
```



---

Comment by vbraun created at 2014-07-09 15:33:04

This ticket is a follow-up on #15639


---

Comment by vbraun created at 2014-07-25 04:55:41

Changing keywords from "" to "random_fail".


---

Comment by vbraun created at 2014-10-20 20:30:31

Another one

```
sage -t --long src/sage/combinat/integer_vector.py
**********************************************************************
File "src/sage/combinat/integer_vector.py", line 347, in sage.combinat.integer_vector._slider01.range.gale_ryser_theorem
Failed example:
    for algorithm in ["gale", "ryser"]:                            # long time
         for i in range(50):                                         # long time
            test_algorithm(algorithm, 3, 10)                         # long time
Expected nothing
Got:
    Algorithm ryser failed with this input:
    [3, 3, 3, 3, 2, 1, 1, 1, 0] [7, 6, 2, 1, 1, 0]
**********************************************************************
```



---

Comment by chapoton created at 2014-10-27 13:33:24

There must be a bug in the ryser algo:

```
sage: d = ([3, 3, 3, 1, 1],[4, 4, 1, 1, 1])
sage: from sage.combinat.integer_vector import *
sage: gale_ryser_theorem(*d, algorithm='ryser')
[0 0 1 1 1]
[1 1 1 0 0]
[1 1 1 0 0]
[1 0 0 0 0]
[1 0 0 0 0]
sage: gale_ryser_theorem(*d, algorithm='gale')
[1 1 0 1 0]
[1 1 0 0 1]
[1 1 1 0 0]
[1 0 0 0 0]
[0 1 0 0 0]
```



---

Comment by ncohen created at 2014-10-27 13:37:55

Honestly, considering all bugs we had with this algorithm in the past, I believe that we should remove it if nobody is willing to check it entirely.

Nathann


---

Comment by chapoton created at 2014-10-27 13:45:39

This is not even a solution !


---

Comment by ncohen created at 2014-10-27 13:46:27

(sorry sorry, I had noticed that I made a mistake and removed my answer right after posting it `^^;`)


---

Comment by chapoton created at 2014-10-27 20:45:29

Maybe one should at least put a stopgap ?


---

Comment by ncohen created at 2014-10-28 10:39:09

Add a stopgap if you like, but if the code is buggy and if nobody knows how to fix it, we would be better without it.

Really, it is far from being the first time that this code returns wrong answers. Plus it is not even the default algorithm !

Nathann


---

Comment by vbraun created at 2015-02-21 12:18:44

Another one 

```
sage -t --long src/sage/combinat/integer_vector.py
**********************************************************************
File "src/sage/combinat/integer_vector.py", line 347, in sage.combinat.integer_vector._slider01.range.gale_ryser_theorem
Failed example:
    for algorithm in ["gale", "ryser"]:                            # long time
         for i in range(50):                                         # long time
            test_algorithm(algorithm, 3, 10)                         # long time
Expected nothing
Got:
    Algorithm ryser failed with this input:
    [4, 4, 3, 2, 1, 1] [5, 5, 1, 1, 1, 1, 1, 0, 0]
**********************************************************************
```



---

Comment by chapoton created at 2015-06-28 07:06:45

Yet another failure

```
Algorithm ryser failed with this input:
    [4, 4, 3, 3, 1, 1, 0] [5, 5, 2, 2, 1, 1]
```



---

Comment by chapoton created at 2015-10-27 11:25:31

another one

```
  Algorithm ryser failed with this input:
    [4, 3, 3, 2, 1, 1, 1, 1, 0] [6, 5, 1, 1, 1, 1, 1]
```



---

Comment by ncohen created at 2015-10-27 11:32:07

Just so you know, I don't mind removing this algorithm whenever you want. We have been getting errors with it for as long as I remember.

Nathann


---

Comment by ncohen created at 2015-10-27 11:32:50

(precision: there are *two* implementations, and the other --which is the default-- would remain available, so the feature would stay)


---

Comment by chapoton created at 2015-10-27 12:41:16

Changing status from new to needs_review.


---

Comment by chapoton created at 2015-10-27 12:41:16

here is a branch for removal of ryser algo.
----
New commits:


---

Comment by jdemeyer created at 2015-10-27 13:19:20

For backwards-compatibility reasons, you should still accept the `algorithm` keyword.


---

Comment by git created at 2015-10-27 13:34:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2015-10-27 14:47:37

Hello Frédéric,

Instead of returning a `ValueError` could you show a deprecation warning instead? Something saying that the keyword is not used anymore, has been implicitly replaced by the only value available. This way one year from now we will be able to remove this keyword. Otherwise we'll keep it along forever.

Nathann


---

Comment by git created at 2015-10-27 15:02:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2015-10-27 15:07:39

YOoooooo,

I'm sorry but you can't just remove the 'ryser' flags on the doctests. 'ryser' was not architecture-dependent, but 'gale' is as it relies on a LP solver.

Given that you kindly replaced this exception I'll try to fix this myself in a commit. Sorry I'm a bit slow today, I'm sick and everything is slower than usual.

Nathann


---

Comment by ncohen created at 2015-10-27 15:11:41

Yoo again.

I thought that it would require some work, but as there is already a 'clean' doctest that tries random input and checks the behaviour in an architecture-independent way, I just flagged all the other doctests with '# random'. They are not checked anymore but still serve as documentation, and the checks still appear in the loop.

The commit is at public/16638

Nathann


---

Comment by chapoton created at 2015-10-27 15:23:37

Yes, good idea. I was indeed worried by the existing `not tested` flags.


---

Comment by ncohen created at 2015-10-27 16:23:55

Changing status from needs_review to positive_review.


---

Comment by ncohen created at 2015-10-27 16:23:55

Well, if you agree with this last commit then we can switch this ticket to `positive_review`?

Nathann


---

Comment by chapoton created at 2015-10-27 17:14:13

yes, thanks Nathann, et bon rétablissement !


---

Comment by tscrim created at 2015-10-27 21:02:57

Changing status from positive_review to needs_work.


---

Comment by tscrim created at 2015-10-27 21:02:57

I disagree with removing this. We should fix the problem. Would you cut off your nose because you sneeze once in awhile?

With that being said, I am not opposed to removing it from being tested and us putting in a stopgap that gets called for `algorithm="ryser"` saying we encounter failures.


---

Comment by tscrim created at 2015-10-27 22:27:21

Oh look, I fixed it by now following the algorithm outlined in the docstring and in the process I learned some math. This implementation follows the algorithm on the level of the partitions, which makes it clear the necessity of the dominance condition.
----
New commits:


---

Comment by tscrim created at 2015-10-27 22:27:21

Changing status from needs_work to needs_review.


---

Comment by ncohen created at 2015-10-28 08:20:19

Whaaaaaaat? You mean that you 'fix' the algorithm while removing the doctests that concerns it and adding a stopgap saying that it is wrong? `O_o`


---

Comment by chapoton created at 2015-10-28 09:55:50

Hmm, Nathann, is your mind very clear ? Travis just rewrote the code in a much cleaner way, it works, and there is no stopgap, and the doctests are there.


---

Comment by ncohen created at 2015-10-28 09:58:10

> Hmm, Nathann, is your mind very clear ? Travis just rewrote the code in a much cleaner way, it works, and there is no stopgap, and the doctests are there.

My mind is not very clear that's a given, I'm sick and stuck home. I was answering this comment:

> With that being said, I am not opposed to removing it from being tested and us putting in a stopgap that gets called for algorithm="ryser" saying we encounter failures.

Nathann


---

Comment by ncohen created at 2015-10-28 10:03:37

Oh. As I saw your commit and this message at the same time, I thought that you had done everything at once and it made no sense, hence my comment.

I should be sleeping. Sorry for the noise, and thank you for fixing this.

Nathann


---

Comment by chapoton created at 2015-10-28 10:06:09

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2015-10-28 10:06:09

looks good to me


---

Comment by tscrim created at 2015-10-28 13:32:25

Replying to [comment:35 ncohen]:
> I should be sleeping. Sorry for the noise, and thank you for fixing this.

I hope you feel better Nathann (pumpkin soup sounds really good to me right now).


---

Comment by vbraun created at 2015-10-28 23:17:13

Resolution: fixed
