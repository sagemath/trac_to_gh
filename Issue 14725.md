# Issue 14725: make sure all optional packages work in the git repository

archive/issues_014725.json:
```json
{
    "body": "CC:  @haraldschilly\n\nwe support them, so we need to make sure they will continue to work\n\nScript to systematically try out all optional spkgs: http://boxen.math.washington.edu/home/vbraun/Sage/Testing/test_optional_packages.sh\n\nThe optional databases will be dealt with here, other packages should make separate tickets. Use the following new \"upstream\" tarballs:\n* http://boxen.math.washington.edu/home/vbraun/upstream/database_cremona_ellcurve-20121022.tar.bz2\n\nLeave for later, don't work and no SPKG.txt:\n* cunningham_tables\n* database_jones_numfield\n* database_kohel\n* database_odlyzko_zeta\n* database_sloane_oeis\n* database_stein_watkins_mini.p0\n\nMove to experimental (broken with or without git, probably for a long time):\n* fricas (doesn't build with our ecl)\n* fricas-aldor (dito)\n* libcocoa (doesn't build with our gmp/mpir)\n\nDelete for other reasons:\n* jsmath_image_fonts (we switched to mathjax)\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/14962\n\n",
    "closed_at": "2013-12-16T13:53:16Z",
    "created_at": "2013-07-24T09:06:59Z",
    "labels": [
        "component: packages: optional"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.0",
    "title": "make sure all optional packages work in the git repository",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14725",
    "user": "https://github.com/ohanar"
}
```
CC:  @haraldschilly

we support them, so we need to make sure they will continue to work

Script to systematically try out all optional spkgs: http://boxen.math.washington.edu/home/vbraun/Sage/Testing/test_optional_packages.sh

The optional databases will be dealt with here, other packages should make separate tickets. Use the following new "upstream" tarballs:
* http://boxen.math.washington.edu/home/vbraun/upstream/database_cremona_ellcurve-20121022.tar.bz2

Leave for later, don't work and no SPKG.txt:
* cunningham_tables
* database_jones_numfield
* database_kohel
* database_odlyzko_zeta
* database_sloane_oeis
* database_stein_watkins_mini.p0

Move to experimental (broken with or without git, probably for a long time):
* fricas (doesn't build with our ecl)
* fricas-aldor (dito)
* libcocoa (doesn't build with our gmp/mpir)

Delete for other reasons:
* jsmath_image_fonts (we switched to mathjax)


Issue created by migration from https://trac.sagemath.org/ticket/14962





---

archive/issue_comments_187413.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Recent commits:",
    "created_at": "2013-09-01T01:57:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14725#issuecomment-187413",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Recent commits:



---

archive/issue_comments_187414.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-09-01T04:53:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14725#issuecomment-187414",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_187415.json:
```json
{
    "body": "4ti2 is currently broken (not related to the git transition) but works with the update at #15172.",
    "created_at": "2013-10-06T19:21:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14725#issuecomment-187415",
    "user": "https://github.com/vbraun"
}
```

4ti2 is currently broken (not related to the git transition) but works with the update at #15172.



---

archive/issue_comments_187416.json:
```json
{
    "body": "#15258 fails, because it implements a dependency check in the `spkg-install` using `newest-version`. How should optional spkgs handle dependencies when they transition to the new layout, by adding to `deps`? Or put the dependency rule in a `<packagename>/deps` file that is included from `deps`? Or no dependency management?",
    "created_at": "2013-10-06T21:20:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14725#issuecomment-187416",
    "user": "https://github.com/vbraun"
}
```

#15258 fails, because it implements a dependency check in the `spkg-install` using `newest-version`. How should optional spkgs handle dependencies when they transition to the new layout, by adding to `deps`? Or put the dependency rule in a `<packagename>/deps` file that is included from `deps`? Or no dependency management?



---

archive/issue_comments_187417.json:
```json
{
    "body": "For right now I would say no dependency management -- any other solution at this point in time would require messing with the build system, which I don't want to do at the moment (so that we can get through this git transition).\n\nOn top of our current faux package manager I would say the best solution would be to replace (at least most of) `deps` with `<packagename>/deps`, but I'm not particularly interested in continuing the development of the current build system.",
    "created_at": "2013-10-06T22:27:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14725#issuecomment-187417",
    "user": "https://github.com/ohanar"
}
```

For right now I would say no dependency management -- any other solution at this point in time would require messing with the build system, which I don't want to do at the moment (so that we can get through this git transition).

On top of our current faux package manager I would say the best solution would be to replace (at least most of) `deps` with `<packagename>/deps`, but I'm not particularly interested in continuing the development of the current build system.



---

archive/issue_comments_187418.json:
```json
{
    "body": "The following spkgs failed to install:\n\n```\nbrian\ncunningham_tables\ndatabase_cremona_ellcurve\ndatabase_jones_numfield\ndatabase_kohel\ndatabase_odlyzko_zeta\ndatabase_sloane_oeis\ndatabase_stein_watkins_mini.p0\ndatabase_symbolic_data\nfricas\nfricasaldor\njsmath_image_fonts\nlibcocoa\nlibtheora\nmpi4py\nopenssl\np_group_cohomology\nPyQt_x11\nTOPCOM\nvalgrind\n```\nLogfiles are here: http://boxen.math.washington.edu/home/vbraun/Sage/Testing/optional/",
    "created_at": "2013-10-07T10:38:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14725#issuecomment-187418",
    "user": "https://github.com/vbraun"
}
```

The following spkgs failed to install:

```
brian
cunningham_tables
database_cremona_ellcurve
database_jones_numfield
database_kohel
database_odlyzko_zeta
database_sloane_oeis
database_stein_watkins_mini.p0
database_symbolic_data
fricas
fricasaldor
jsmath_image_fonts
libcocoa
libtheora
mpi4py
openssl
p_group_cohomology
PyQt_x11
TOPCOM
valgrind
```
Logfiles are here: http://boxen.math.washington.edu/home/vbraun/Sage/Testing/optional/



---

archive/issue_comments_187419.json:
```json
{
    "body": "New commits:",
    "created_at": "2013-10-07T12:59:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14725#issuecomment-187419",
    "user": "https://github.com/vbraun"
}
```

New commits:



---

archive/issue_comments_187420.json:
```json
{
    "body": "`SAGE_DATA` is now `SAGE_LOCAL/share`, for the record.",
    "created_at": "2013-10-07T12:59:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14725#issuecomment-187420",
    "user": "https://github.com/vbraun"
}
```

`SAGE_DATA` is now `SAGE_LOCAL/share`, for the record.



---

archive/issue_comments_187421.json:
```json
{
    "body": "Also, `extra_docs` barfs the extra docs into `SAGE_ROOT`.",
    "created_at": "2013-10-07T14:33:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14725#issuecomment-187421",
    "user": "https://github.com/vbraun"
}
```

Also, `extra_docs` barfs the extra docs into `SAGE_ROOT`.



---

archive/issue_comments_187422.json:
```json
{
    "body": "I am not online with the git layout yet (need to attend a tutorial, at the least, though Volker's video was a helpful start) so I can't help with this writing or reviewing yet BUT I have diagnosed the brian problem.\n\n```\n./spkg-install: line 10: cd: /mnt/storage2TB/vbraun-data/Sage/spkg/standard/: No such file or directory\n./spkg-install: line 10: ./newest_version: No such file or directory\nFailed to find numpy.  Please install the numpy spkg.\n```\nThere are four tests of the following kind:\n\n```\nNUMPY=`cd $SAGE_ROOT/spkg/standard/; ./newest_version numpy`\n```\nSo where would we check the \"newest version\" now?   That's all one would need to do, or even check \"presence\" if the spkg placeholder txt files are no longer there.  (That said, I'm not sure if those checks are even really necessary, which would also fix it, I'm sure.  But if the fix is easy, then we should try that first.)",
    "created_at": "2013-10-07T14:47:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14725#issuecomment-187422",
    "user": "https://github.com/kcrisman"
}
```

I am not online with the git layout yet (need to attend a tutorial, at the least, though Volker's video was a helpful start) so I can't help with this writing or reviewing yet BUT I have diagnosed the brian problem.

```
./spkg-install: line 10: cd: /mnt/storage2TB/vbraun-data/Sage/spkg/standard/: No such file or directory
./spkg-install: line 10: ./newest_version: No such file or directory
Failed to find numpy.  Please install the numpy spkg.
```
There are four tests of the following kind:

```
NUMPY=`cd $SAGE_ROOT/spkg/standard/; ./newest_version numpy`
```
So where would we check the "newest version" now?   That's all one would need to do, or even check "presence" if the spkg placeholder txt files are no longer there.  (That said, I'm not sure if those checks are even really necessary, which would also fix it, I'm sure.  But if the fix is easy, then we should try that first.)



---

archive/issue_comments_187423.json:
```json
{
    "body": "The brian spkg just needs to strip out all the dependency checking, then it should work. You can still make spkgs as in the old workflow. Git installation instructions are, by now, easy:\n\n```\ngit clone git://github.com/sagemath/sage.git\ncd sage\nmake\n```",
    "created_at": "2013-10-07T14:51:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14725#issuecomment-187423",
    "user": "https://github.com/vbraun"
}
```

The brian spkg just needs to strip out all the dependency checking, then it should work. You can still make spkgs as in the old workflow. Git installation instructions are, by now, easy:

```
git clone git://github.com/sagemath/sage.git
cd sage
make
```



---

archive/issue_comments_187424.json:
```json
{
    "body": "> The brian spkg just needs to strip out all the dependency checking, then it should work. \n\nAs I said:\n> > That said, I'm not sure if those checks are even really necessary, which would also fix it, I'm sure.\n\nI just don't remember why that was introduced.  #9675 doesn't make it clear, so when I open this ticket, I'll cc: the original author.  Otherwise I agree we should get rid of this.  I'll update the patch situation as well and perhaps upgrade Brian if I find time for all this- should be able to in the next couple days.\n> You can still make spkgs as in the old workflow. Git installation instructions are, by now, easy:\n\nGood to know!  And that includes all the spkg stuff.",
    "created_at": "2013-10-07T16:27:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14725#issuecomment-187424",
    "user": "https://github.com/kcrisman"
}
```

> The brian spkg just needs to strip out all the dependency checking, then it should work. 

As I said:
> > That said, I'm not sure if those checks are even really necessary, which would also fix it, I'm sure.

I just don't remember why that was introduced.  #9675 doesn't make it clear, so when I open this ticket, I'll cc: the original author.  Otherwise I agree we should get rid of this.  I'll update the patch situation as well and perhaps upgrade Brian if I find time for all this- should be able to in the next couple days.
> You can still make spkgs as in the old workflow. Git installation instructions are, by now, easy:

Good to know!  And that includes all the spkg stuff.



---

archive/issue_comments_187425.json:
```json
{
    "body": "> I just don't remember why that was introduced.  #9675 doesn't make it clear, so when I open this ticket, I'll cc: the original author.  Otherwise I agree we should get rid of this.  I'll update the patch situation as well and perhaps upgrade Brian if I find time for all this- should be able to in the next couple days.\n\n\nThis is now #15261.",
    "created_at": "2013-10-07T16:41:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14725#issuecomment-187425",
    "user": "https://github.com/kcrisman"
}
```

> I just don't remember why that was introduced.  #9675 doesn't make it clear, so when I open this ticket, I'll cc: the original author.  Otherwise I agree we should get rid of this.  I'll update the patch situation as well and perhaps upgrade Brian if I find time for all this- should be able to in the next couple days.


This is now #15261.



---

archive/issue_comments_187426.json:
```json
{
    "body": "* mpi4py actually works, just needs openmpi libraries/compiler wrapper installed",
    "created_at": "2013-10-17T20:33:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14725#issuecomment-187426",
    "user": "https://github.com/vbraun"
}
```

* mpi4py actually works, just needs openmpi libraries/compiler wrapper installed



---

archive/issue_comments_187427.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-11-29T19:22:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14725#issuecomment-187427",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_187428.json:
```json
{
    "body": "I'm setting this to positive review since clearly nobody else has the guts to review this ticket.\n\nThe `database_cremona_ellcurve-20121022.tar.bz2` tarball is already in the upstream dir, apparently.\n\nHarald, can you delete/move to trash: `fricas`, `fricas-aldor`, `libcocoa`, and `jsmath_image_fonts`? They are (and have been for a while) useless with or without git.",
    "created_at": "2013-12-16T13:43:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14725#issuecomment-187428",
    "user": "https://github.com/vbraun"
}
```

I'm setting this to positive review since clearly nobody else has the guts to review this ticket.

The `database_cremona_ellcurve-20121022.tar.bz2` tarball is already in the upstream dir, apparently.

Harald, can you delete/move to trash: `fricas`, `fricas-aldor`, `libcocoa`, and `jsmath_image_fonts`? They are (and have been for a while) useless with or without git.



---

archive/issue_comments_187429.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-12-16T13:43:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14725#issuecomment-187429",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_042941.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-12-16T13:53:16Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/14725",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14725#event-42941"
}
```



---

archive/issue_comments_187430.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-12-16T14:03:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14725#issuecomment-187430",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_187431.json:
```json
{
    "body": "Replying to [comment:26 vbraun]:\n> Harald, can you delete/move to trash: `fricas`, `fricas-aldor`, `libcocoa`, and `jsmath_image_fonts`?\n\n\nok.",
    "created_at": "2013-12-16T17:52:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14725#issuecomment-187431",
    "user": "https://github.com/haraldschilly"
}
```

Replying to [comment:26 vbraun]:
> Harald, can you delete/move to trash: `fricas`, `fricas-aldor`, `libcocoa`, and `jsmath_image_fonts`?


ok.



---

archive/issue_comments_187432.json:
```json
{
    "body": "My copy of database_stein_watkins_mini.p0.spkg does contain SPKG.txt:\n\n```\njec@atkin:~/spkg/database_stein_watkins_mini.p0$ ls -l\ntotal 12\n-rwx------ 1 jec jec   49 Mar 12  2010 spkg-install\n-rw------- 1 jec jec  389 Mar 13  2010 SPKG.txt\ndrwx------ 2 jec jec 4096 Nov  7  2005 stein-watkins-ecdb\n```\nso I think this one should be easy -- no compilaton, it just copies recurseively the directory to SAGE_DATA:\n\n```\njec@atkin:~/spkg/database_stein_watkins_mini.p0$ cat spkg-install \n#!/bin/sh\n\ncp -rf stein-watkins-ecdb $SAGE_DATA/\n```",
    "created_at": "2013-12-19T15:40:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14725#issuecomment-187432",
    "user": "https://github.com/JohnCremona"
}
```

My copy of database_stein_watkins_mini.p0.spkg does contain SPKG.txt:

```
jec@atkin:~/spkg/database_stein_watkins_mini.p0$ ls -l
total 12
-rwx------ 1 jec jec   49 Mar 12  2010 spkg-install
-rw------- 1 jec jec  389 Mar 13  2010 SPKG.txt
drwx------ 2 jec jec 4096 Nov  7  2005 stein-watkins-ecdb
```
so I think this one should be easy -- no compilaton, it just copies recurseively the directory to SAGE_DATA:

```
jec@atkin:~/spkg/database_stein_watkins_mini.p0$ cat spkg-install 
#!/bin/sh

cp -rf stein-watkins-ecdb $SAGE_DATA/
```



---

archive/issue_comments_187433.json:
```json
{
    "body": "If I was going to work on converting stein_watkins_mini, should I open a new ticket to hold the branch?",
    "created_at": "2013-12-20T11:29:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14725#issuecomment-187433",
    "user": "https://github.com/JohnCremona"
}
```

If I was going to work on converting stein_watkins_mini, should I open a new ticket to hold the branch?



---

archive/issue_comments_187434.json:
```json
{
    "body": "Please open a new ticket, this one is closed.\n\nstein_watkins_mini contains a skeleton SPKG.txt, but no description (what is it anyways?) and no license (=potentially not legal to distribute). William indicated in the ensuing thread on sage-devel that it is public domain afair.",
    "created_at": "2013-12-20T11:40:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14725#issuecomment-187434",
    "user": "https://github.com/vbraun"
}
```

Please open a new ticket, this one is closed.

stein_watkins_mini contains a skeleton SPKG.txt, but no description (what is it anyways?) and no license (=potentially not legal to distribute). William indicated in the ensuing thread on sage-devel that it is public domain afair.



---

archive/issue_comments_187435.json:
```json
{
    "body": "Replying to [comment:32 vbraun]:\n> Please open a new ticket, this one is closed.\n\n\nSee #15556.\n\n> \n> stein_watkins_mini contains a skeleton SPKG.txt, but no description (what is it anyways?) and no license (=potentially not legal to distribute). William indicated in the ensuing thread on sage-devel that it is public domain afair.\n\n\nIt's a large collection of elliptic curves compiled by William Stein and Mark Watkins about 10 years ago, stored in simple compressed text files.  I'll put a reference to their paper in the SPKG.txt (it is already cited properly in the docstrings).",
    "created_at": "2013-12-20T12:18:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14725#issuecomment-187435",
    "user": "https://github.com/JohnCremona"
}
```

Replying to [comment:32 vbraun]:
> Please open a new ticket, this one is closed.


See #15556.

> 
> stein_watkins_mini contains a skeleton SPKG.txt, but no description (what is it anyways?) and no license (=potentially not legal to distribute). William indicated in the ensuing thread on sage-devel that it is public domain afair.


It's a large collection of elliptic curves compiled by William Stein and Mark Watkins about 10 years ago, stored in simple compressed text files.  I'll put a reference to their paper in the SPKG.txt (it is already cited properly in the docstrings).



---

archive/issue_comments_187436.json:
```json
{
    "body": "See also #15814",
    "created_at": "2014-02-13T09:49:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14725#issuecomment-187436",
    "user": "https://github.com/rwst"
}
```

See also #15814
