# Issue 14725: make sure all optional packages work in the git repository

Issue created by migration from https://trac.sagemath.org/ticket/14962

Original creator: ohanar

Original creation time: 2013-07-24 09:06:59

CC:  schilly

we support them, so we need to make sure they will continue to work


---

Comment by git created at 2013-09-01 01:57:20

Branch pushed to git repo; I updated commit sha1. This was a forced push. Recent commits:


---

Comment by git created at 2013-09-01 04:53:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2013-10-06 19:21:11

4ti2 is currently broken (not related to the git transition) but works with the update at #15172.


---

Comment by vbraun created at 2013-10-06 21:20:48

#15258 fails, because it implements a dependency check in the `spkg-install` using `newest-version`. How should optional spkgs handle dependencies when they transition to the new layout, by adding to `deps`? Or put the dependency rule in a `<packagename>/deps` file that is included from `deps`? Or no dependency management?


---

Comment by ohanar created at 2013-10-06 22:27:45

For right now I would say no dependency management -- any other solution at this point in time would require messing with the build system, which I don't want to do at the moment (so that we can get through this git transition).

On top of our current faux package manager I would say the best solution would be to replace (at least most of) `deps` with `<packagename>/deps`, but I'm not particularly interested in continuing the development of the current build system.


---

Comment by vbraun created at 2013-10-07 10:38:43

The following spkgs failed to install:

```
brian
cunningham_tables
database_cremona_ellcurve
database_jones_numfield
database_kohel
database_odlyzko_zeta
database_sloane_oeis
database_stein_watkins_mini.p0
database_symbolic_data
fricas
fricasaldor
jsmath_image_fonts
libcocoa
libtheora
mpi4py
openssl
p_group_cohomology
PyQt_x11
TOPCOM
valgrind
```

Logfiles are here: http://boxen.math.washington.edu/home/vbraun/Sage/Testing/optional/


---

Comment by vbraun created at 2013-10-07 12:59:57

New commits:


---

Comment by vbraun created at 2013-10-07 12:59:57

`SAGE_DATA` is now `SAGE_LOCAL/share`, for the record.


---

Comment by vbraun created at 2013-10-07 14:33:30

Also, `extra_docs` barfs the extra docs into `SAGE_ROOT`.


---

Comment by kcrisman created at 2013-10-07 14:47:19

I am not online with the git layout yet (need to attend a tutorial, at the least, though Volker's video was a helpful start) so I can't help with this writing or reviewing yet BUT I have diagnosed the brian problem.

```
./spkg-install: line 10: cd: /mnt/storage2TB/vbraun-data/Sage/spkg/standard/: No such file or directory
./spkg-install: line 10: ./newest_version: No such file or directory
Failed to find numpy.  Please install the numpy spkg.
```

There are four tests of the following kind:

```
NUMPY=`cd $SAGE_ROOT/spkg/standard/; ./newest_version numpy`
```

So where would we check the "newest version" now?   That's all one would need to do, or even check "presence" if the spkg placeholder txt files are no longer there.  (That said, I'm not sure if those checks are even really necessary, which would also fix it, I'm sure.  But if the fix is easy, then we should try that first.)


---

Comment by vbraun created at 2013-10-07 14:51:36

The brian spkg just needs to strip out all the dependency checking, then it should work. You can still make spkgs as in the old workflow. Git installation instructions are, by now, easy:

```
git clone git://github.com/sagemath/sage.git
cd sage
make
```



---

Comment by kcrisman created at 2013-10-07 16:27:43

> The brian spkg just needs to strip out all the dependency checking, then it should work. 
As I said:
> > That said, I'm not sure if those checks are even really necessary, which would also fix it, I'm sure.
I just don't remember why that was introduced.  #9675 doesn't make it clear, so when I open this ticket, I'll cc: the original author.  Otherwise I agree we should get rid of this.  I'll update the patch situation as well and perhaps upgrade Brian if I find time for all this- should be able to in the next couple days.
> You can still make spkgs as in the old workflow. Git installation instructions are, by now, easy:
Good to know!  And that includes all the spkg stuff.


---

Comment by kcrisman created at 2013-10-07 16:41:48

> I just don't remember why that was introduced.  #9675 doesn't make it clear, so when I open this ticket, I'll cc: the original author.  Otherwise I agree we should get rid of this.  I'll update the patch situation as well and perhaps upgrade Brian if I find time for all this- should be able to in the next couple days.

This is now #15261.


---

Comment by vbraun created at 2013-10-17 20:33:53

* mpi4py actually works, just needs openmpi libraries/compiler wrapper installed


---

Comment by vbraun created at 2013-11-29 19:22:44

Changing status from new to needs_review.


---

Comment by vbraun created at 2013-12-16 13:43:09

I'm setting this to positive review since clearly nobody else has the guts to review this ticket.

The `database_cremona_ellcurve-20121022.tar.bz2` tarball is already in the upstream dir, apparently.

Harald, can you delete/move to trash: `fricas`, `fricas-aldor`, `libcocoa`, and `jsmath_image_fonts`? They are (and have been for a while) useless with or without git.


---

Comment by vbraun created at 2013-12-16 13:43:09

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2013-12-16 14:03:19

Resolution: fixed


---

Comment by schilly created at 2013-12-16 17:52:46

Replying to [comment:26 vbraun]:
> Harald, can you delete/move to trash: `fricas`, `fricas-aldor`, `libcocoa`, and `jsmath_image_fonts`?

ok.


---

Comment by cremona created at 2013-12-19 15:40:18

My copy of database_stein_watkins_mini.p0.spkg does contain SPKG.txt:

```
jec@atkin:~/spkg/database_stein_watkins_mini.p0$ ls -l
total 12
-rwx------ 1 jec jec   49 Mar 12  2010 spkg-install
-rw------- 1 jec jec  389 Mar 13  2010 SPKG.txt
drwx------ 2 jec jec 4096 Nov  7  2005 stein-watkins-ecdb
```

so I think this one should be easy -- no compilaton, it just copies recurseively the directory to SAGE_DATA:

```
jec@atkin:~/spkg/database_stein_watkins_mini.p0$ cat spkg-install 
#!/bin/sh

cp -rf stein-watkins-ecdb $SAGE_DATA/
```



---

Comment by cremona created at 2013-12-20 11:29:04

If I was going to work on converting stein_watkins_mini, should I open a new ticket to hold the branch?


---

Comment by vbraun created at 2013-12-20 11:40:55

Please open a new ticket, this one is closed.

stein_watkins_mini contains a skeleton SPKG.txt, but no description (what is it anyways?) and no license (=potentially not legal to distribute). William indicated in the ensuing thread on sage-devel that it is public domain afair.


---

Comment by cremona created at 2013-12-20 12:18:15

Replying to [comment:32 vbraun]:
> Please open a new ticket, this one is closed.

See #15556.

> 
> stein_watkins_mini contains a skeleton SPKG.txt, but no description (what is it anyways?) and no license (=potentially not legal to distribute). William indicated in the ensuing thread on sage-devel that it is public domain afair.

It's a large collection of elliptic curves compiled by William Stein and Mark Watkins about 10 years ago, stored in simple compressed text files.  I'll put a reference to their paper in the SPKG.txt (it is already cited properly in the docstrings).


---

Comment by rws created at 2014-02-13 09:49:56

See also #15814
