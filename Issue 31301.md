# Issue 31301: i386: openssl attempts 64-bit build and fails

archive/issues_031301.json:
```json
{
    "body": "CC:  tmonteil dimpase vbraun\n\nFor example on `ubuntu-bionic-i386-minimal` https://github.com/mkoeppe/sage/runs/2161532075\n\n```\nmake depend && make _build_sw\ngcc  -I. -Iinclude -Iapps/include  -fPIC -pthread -m64 -Wa,--noexecstack -O2 -g -march=native -DOPENSSL_USE_NODELETE -DL_ENDIAN -DOPENSSL_PIC -DOPENSSLDIR=\"\\\"/sage/local/openssl\\\"\" -DENGINESDIR=\"\\\"/sage/local/lib64/engines-3\\\"\" -DMODULESDIR=\"\\\"/sage/local/lib64/ossl-modules\\\"\" -DOPENSSL_BUILDING_OPENSSL -DNDEBUG  -MMD -MF apps/lib/libapps-lib-app_params.d.tmp -MT apps/lib/libapps-lib-app_params.o -c -o apps/lib/libapps-lib-app_params.o apps/lib/app_params.c\nIn file included from /usr/lib/gcc/i686-linux-gnu/7/include-fixed/limits.h:194:0,\n                 from /usr/lib/gcc/i686-linux-gnu/7/include-fixed/syslimits.h:7,\n                 from /usr/lib/gcc/i686-linux-gnu/7/include-fixed/limits.h:34,\n                 from ./e_os.h:13,\n                 from apps/include/apps.h:13,\n                 from apps/lib/app_params.c:10:\n/usr/include/limits.h:26:10: fatal error: bits/libc-header-start.h: No such file or directory\n #include <bits/libc-header-start.h>\n          ^~~~~~~~~~~~~~~~~~~~~~~~~~\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/31538\n\n",
    "created_at": "2021-03-22T21:55:46Z",
    "labels": [
        "packages: standard",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "i386: openssl attempts 64-bit build and fails",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31301",
    "user": "mkoeppe"
}
```
CC:  tmonteil dimpase vbraun

For example on `ubuntu-bionic-i386-minimal` https://github.com/mkoeppe/sage/runs/2161532075

```
make depend && make _build_sw
gcc  -I. -Iinclude -Iapps/include  -fPIC -pthread -m64 -Wa,--noexecstack -O2 -g -march=native -DOPENSSL_USE_NODELETE -DL_ENDIAN -DOPENSSL_PIC -DOPENSSLDIR="\"/sage/local/openssl\"" -DENGINESDIR="\"/sage/local/lib64/engines-3\"" -DMODULESDIR="\"/sage/local/lib64/ossl-modules\"" -DOPENSSL_BUILDING_OPENSSL -DNDEBUG  -MMD -MF apps/lib/libapps-lib-app_params.d.tmp -MT apps/lib/libapps-lib-app_params.o -c -o apps/lib/libapps-lib-app_params.o apps/lib/app_params.c
In file included from /usr/lib/gcc/i686-linux-gnu/7/include-fixed/limits.h:194:0,
                 from /usr/lib/gcc/i686-linux-gnu/7/include-fixed/syslimits.h:7,
                 from /usr/lib/gcc/i686-linux-gnu/7/include-fixed/limits.h:34,
                 from ./e_os.h:13,
                 from apps/include/apps.h:13,
                 from apps/lib/app_params.c:10:
/usr/include/limits.h:26:10: fatal error: bits/libc-header-start.h: No such file or directory
 #include <bits/libc-header-start.h>
          ^~~~~~~~~~~~~~~~~~~~~~~~~~
```


Issue created by migration from https://trac.sagemath.org/ticket/31538





---

archive/issue_comments_447520.json:
```json
{
    "body": "This is from a virtualized build using Docker, not a real 386. \nopenssl chooses a 64-bit build based on `uname`, which is wrong. Instead we need to check the target ABI of the configured `CC`, similar to what we do in `build/pkgs/gmp/spkg-install.in` (or just use `$CC -dumpmachine` and pattern match...)",
    "created_at": "2021-03-22T22:23:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31301",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31301#issuecomment-447520",
    "user": "mkoeppe"
}
```

This is from a virtualized build using Docker, not a real 386. 
openssl chooses a 64-bit build based on `uname`, which is wrong. Instead we need to check the target ABI of the configured `CC`, similar to what we do in `build/pkgs/gmp/spkg-install.in` (or just use `$CC -dumpmachine` and pattern match...)



---

archive/issue_comments_447521.json:
```json
{
    "body": "New commits:",
    "created_at": "2021-03-22T23:43:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31301",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31301#issuecomment-447521",
    "user": "mkoeppe"
}
```

New commits:



---

archive/issue_comments_447522.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-03-22T23:43:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31301",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31301#issuecomment-447522",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_447523.json:
```json
{
    "body": "We should also update the tested 32-bit platforms. `ubuntu-focal-i386-standard` consistently fails - lots of missing packages (https://github.com/mkoeppe/sage/runs/2170889217).\n\"Upgrades on i386: Users of the i386 architecture will not be presented with an upgrade to Ubuntu 20.04 LTS. Support for i386 as a host architecture was dropped in 19.10.\" (https://wiki.ubuntu.com/FocalFossa/ReleaseNotes)",
    "created_at": "2021-03-22T23:52:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31301",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31301#issuecomment-447523",
    "user": "mkoeppe"
}
```

We should also update the tested 32-bit platforms. `ubuntu-focal-i386-standard` consistently fails - lots of missing packages (https://github.com/mkoeppe/sage/runs/2170889217).
"Upgrades on i386: Users of the i386 architecture will not be presented with an upgrade to Ubuntu 20.04 LTS. Support for i386 as a host architecture was dropped in 19.10." (https://wiki.ubuntu.com/FocalFossa/ReleaseNotes)



---

archive/issue_comments_447524.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-03-23T03:58:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31301",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31301#issuecomment-447524",
    "user": "mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_447525.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-03-23T04:36:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31301",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31301#issuecomment-447525",
    "user": "mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_447526.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-03-23T17:56:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31301",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31301#issuecomment-447526",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_447527.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-23T23:55:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31301",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31301#issuecomment-447527",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_447528.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-03-24T00:44:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31301",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31301#issuecomment-447528",
    "user": "mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_447529.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-24T01:09:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31301",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31301#issuecomment-447529",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_447530.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-03-24T02:07:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31301",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31301#issuecomment-447530",
    "user": "mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_447531.json:
```json
{
    "body": "Ready for review. As https://github.com/mkoeppe/sage/actions/runs/681629845 shows, the build errors are fixed and the build runs successfully for all 32-bit platforms (updated in #31541) until the 6-hour time limit is reached.",
    "created_at": "2021-03-24T15:53:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31301",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31301#issuecomment-447531",
    "user": "mkoeppe"
}
```

Ready for review. As https://github.com/mkoeppe/sage/actions/runs/681629845 shows, the build errors are fixed and the build runs successfully for all 32-bit platforms (updated in #31541) until the 6-hour time limit is reached.



---

archive/issue_comments_447532.json:
```json
{
    "body": "I tested on 32-bit, it all works.",
    "created_at": "2021-03-24T19:06:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31301",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31301#issuecomment-447532",
    "user": "dimpase"
}
```

I tested on 32-bit, it all works.



---

archive/issue_comments_447533.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-03-24T19:06:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31301",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31301#issuecomment-447533",
    "user": "dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_447534.json:
```json
{
    "body": "Thanks!",
    "created_at": "2021-03-24T19:11:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31301",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31301#issuecomment-447534",
    "user": "mkoeppe"
}
```

Thanks!



---

archive/issue_comments_447535.json:
```json
{
    "body": "Setting priority to blocker to bring this ticket to the attention of the release bot.",
    "created_at": "2021-03-29T23:54:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31301",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31301#issuecomment-447535",
    "user": "mkoeppe"
}
```

Setting priority to blocker to bring this ticket to the attention of the release bot.



---

archive/issue_comments_447536.json:
```json
{
    "body": "Changing priority from critical to blocker.",
    "created_at": "2021-03-29T23:54:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31301",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31301#issuecomment-447536",
    "user": "mkoeppe"
}
```

Changing priority from critical to blocker.



---

archive/issue_comments_447537.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-04-01T19:45:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31301",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31301#issuecomment-447537",
    "user": "vbraun"
}
```

Resolution: fixed
