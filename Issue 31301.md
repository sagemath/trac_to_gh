# Issue 31301: i386: openssl and tachyon attempt 64-bit build and fail

archive/issues_031301.json:
```json
{
    "body": "CC:  tmonteil @dimpase @vbraun\n\nFor example on `ubuntu-bionic-i386-minimal` https://github.com/mkoeppe/sage/runs/2161532075: `openssl` fails with:\n\n```\nmake depend && make _build_sw\ngcc  -I. -Iinclude -Iapps/include  -fPIC -pthread -m64 -Wa,--noexecstack -O2 -g -march=native -DOPENSSL_USE_NODELETE -DL_ENDIAN -DOPENSSL_PIC -DOPENSSLDIR=\"\\\"/sage/local/openssl\\\"\" -DENGINESDIR=\"\\\"/sage/local/lib64/engines-3\\\"\" -DMODULESDIR=\"\\\"/sage/local/lib64/ossl-modules\\\"\" -DOPENSSL_BUILDING_OPENSSL -DNDEBUG  -MMD -MF apps/lib/libapps-lib-app_params.d.tmp -MT apps/lib/libapps-lib-app_params.o -c -o apps/lib/libapps-lib-app_params.o apps/lib/app_params.c\nIn file included from /usr/lib/gcc/i686-linux-gnu/7/include-fixed/limits.h:194:0,\n                 from /usr/lib/gcc/i686-linux-gnu/7/include-fixed/syslimits.h:7,\n                 from /usr/lib/gcc/i686-linux-gnu/7/include-fixed/limits.h:34,\n                 from ./e_os.h:13,\n                 from apps/include/apps.h:13,\n                 from apps/lib/app_params.c:10:\n/usr/include/limits.h:26:10: fatal error: bits/libc-header-start.h: No such file or directory\n #include <bits/libc-header-start.h>\n          ^~~~~~~~~~~~~~~~~~~~~~~~~~\n```\n\nSame failure mode also for `tachyon` (https://github.com/mkoeppe/sage/runs/2177818373 for `ubuntu-bionic-i386-minimal`).\n\n\n\nCritical for Sage 9.3 because it stops us from seeing other build failures on `i386-minimal` platforms\n\nIssue created by migration from https://trac.sagemath.org/ticket/31538\n\n",
    "closed_at": "2021-04-01T19:45:07Z",
    "created_at": "2021-03-22T21:55:46Z",
    "labels": [
        "component: packages: standard",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "i386: openssl and tachyon attempt 64-bit build and fail",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31301",
    "user": "https://github.com/mkoeppe"
}
```
CC:  tmonteil @dimpase @vbraun

For example on `ubuntu-bionic-i386-minimal` https://github.com/mkoeppe/sage/runs/2161532075: `openssl` fails with:

```
make depend && make _build_sw
gcc  -I. -Iinclude -Iapps/include  -fPIC -pthread -m64 -Wa,--noexecstack -O2 -g -march=native -DOPENSSL_USE_NODELETE -DL_ENDIAN -DOPENSSL_PIC -DOPENSSLDIR="\"/sage/local/openssl\"" -DENGINESDIR="\"/sage/local/lib64/engines-3\"" -DMODULESDIR="\"/sage/local/lib64/ossl-modules\"" -DOPENSSL_BUILDING_OPENSSL -DNDEBUG  -MMD -MF apps/lib/libapps-lib-app_params.d.tmp -MT apps/lib/libapps-lib-app_params.o -c -o apps/lib/libapps-lib-app_params.o apps/lib/app_params.c
In file included from /usr/lib/gcc/i686-linux-gnu/7/include-fixed/limits.h:194:0,
                 from /usr/lib/gcc/i686-linux-gnu/7/include-fixed/syslimits.h:7,
                 from /usr/lib/gcc/i686-linux-gnu/7/include-fixed/limits.h:34,
                 from ./e_os.h:13,
                 from apps/include/apps.h:13,
                 from apps/lib/app_params.c:10:
/usr/include/limits.h:26:10: fatal error: bits/libc-header-start.h: No such file or directory
 #include <bits/libc-header-start.h>
          ^~~~~~~~~~~~~~~~~~~~~~~~~~
```

Same failure mode also for `tachyon` (https://github.com/mkoeppe/sage/runs/2177818373 for `ubuntu-bionic-i386-minimal`).



Critical for Sage 9.3 because it stops us from seeing other build failures on `i386-minimal` platforms

Issue created by migration from https://trac.sagemath.org/ticket/31538





---

archive/issue_comments_446991.json:
```json
{
    "body": "This is from a virtualized build using Docker, not a real 386. \nopenssl chooses a 64-bit build based on `uname`, which is wrong. Instead we need to check the target ABI of the configured `CC`, similar to what we do in `build/pkgs/gmp/spkg-install.in` (or just use `$CC -dumpmachine` and pattern match...)",
    "created_at": "2021-03-22T22:23:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31301",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31301#issuecomment-446991",
    "user": "https://github.com/mkoeppe"
}
```

This is from a virtualized build using Docker, not a real 386. 
openssl chooses a 64-bit build based on `uname`, which is wrong. Instead we need to check the target ABI of the configured `CC`, similar to what we do in `build/pkgs/gmp/spkg-install.in` (or just use `$CC -dumpmachine` and pattern match...)



---

archive/issue_comments_446992.json:
```json
{
    "body": "New commits:",
    "created_at": "2021-03-22T23:43:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31301",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31301#issuecomment-446992",
    "user": "https://github.com/mkoeppe"
}
```

New commits:



---

archive/issue_comments_446993.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-03-22T23:43:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31301",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31301#issuecomment-446993",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_446994.json:
```json
{
    "body": "We should also update the tested 32-bit platforms. `ubuntu-focal-i386-standard` consistently fails - lots of missing packages (https://github.com/mkoeppe/sage/runs/2170889217).\n\"Upgrades on i386: Users of the i386 architecture will not be presented with an upgrade to Ubuntu 20.04 LTS. Support for i386 as a host architecture was dropped in 19.10.\" (https://wiki.ubuntu.com/FocalFossa/ReleaseNotes)",
    "created_at": "2021-03-22T23:52:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31301",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31301#issuecomment-446994",
    "user": "https://github.com/mkoeppe"
}
```

We should also update the tested 32-bit platforms. `ubuntu-focal-i386-standard` consistently fails - lots of missing packages (https://github.com/mkoeppe/sage/runs/2170889217).
"Upgrades on i386: Users of the i386 architecture will not be presented with an upgrade to Ubuntu 20.04 LTS. Support for i386 as a host architecture was dropped in 19.10." (https://wiki.ubuntu.com/FocalFossa/ReleaseNotes)



---

archive/issue_comments_446995.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-03-23T03:58:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31301",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31301#issuecomment-446995",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_446996.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-03-23T04:36:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31301",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31301#issuecomment-446996",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_446997.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-03-23T17:56:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31301",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31301#issuecomment-446997",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_446998.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-23T23:55:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31301",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31301#issuecomment-446998",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_446999.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-03-24T00:44:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31301",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31301#issuecomment-446999",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_447000.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-24T01:09:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31301",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31301#issuecomment-447000",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_447001.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-03-24T02:07:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31301",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31301#issuecomment-447001",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_447002.json:
```json
{
    "body": "Ready for review. As https://github.com/mkoeppe/sage/actions/runs/681629845 shows, the build errors are fixed and the build runs successfully for all 32-bit platforms (updated in #31541) until the 6-hour time limit is reached.",
    "created_at": "2021-03-24T15:53:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31301",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31301#issuecomment-447002",
    "user": "https://github.com/mkoeppe"
}
```

Ready for review. As https://github.com/mkoeppe/sage/actions/runs/681629845 shows, the build errors are fixed and the build runs successfully for all 32-bit platforms (updated in #31541) until the 6-hour time limit is reached.



---

archive/issue_comments_447003.json:
```json
{
    "body": "I tested on 32-bit, it all works.",
    "created_at": "2021-03-24T19:06:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31301",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31301#issuecomment-447003",
    "user": "https://github.com/dimpase"
}
```

I tested on 32-bit, it all works.



---

archive/issue_comments_447004.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-03-24T19:06:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31301",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31301#issuecomment-447004",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_447005.json:
```json
{
    "body": "Thanks!",
    "created_at": "2021-03-24T19:11:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31301",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31301#issuecomment-447005",
    "user": "https://github.com/mkoeppe"
}
```

Thanks!



---

archive/issue_comments_447006.json:
```json
{
    "body": "Setting priority to blocker to bring this ticket to the attention of the release bot.",
    "created_at": "2021-03-29T23:54:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31301",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31301#issuecomment-447006",
    "user": "https://github.com/mkoeppe"
}
```

Setting priority to blocker to bring this ticket to the attention of the release bot.



---

archive/issue_comments_447007.json:
```json
{
    "body": "Changing priority from critical to blocker.",
    "created_at": "2021-03-29T23:54:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31301",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31301#issuecomment-447007",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from critical to blocker.



---

archive/issue_comments_447008.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-04-01T19:45:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31301",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31301#issuecomment-447008",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_082873.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-04-01T19:45:07Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31301",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31301#event-82873"
}
```
