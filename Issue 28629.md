# Issue 28629: doctest killed due to abord in geometry/polyhedron/base.py

archive/issues_028629.json:
```json
{
    "body": "CC:  @mkoeppe @jplab @orlitzky\n\n\n```\nsage -t --long src/sage/geometry/polyhedron/base.py\n```\n\n\ngives\n\n\n```\nUsing --optional=4ti2,build,cbc,ccache,cryptominisat,dochtml,dot2tex,e_antic,glucose,latte_int,lidia,lrslib,memlimit,normaliz,notedown,openssl,pandoc_attributes,pycosat,pynormaliz,rst2ipynb,sage,sagenb\nDoctesting 1 file.\n\n    Killed due to abort\n**********************************************************************\nTests run before process (pid=19555) failed:\nsage: p = polytopes.hypercube(2) ## line 71 ##\nsage: from sage.geometry.polyhedron.base import is_Polyhedron ## line 72 ##\nsage: is_Polyhedron(p) ## line 73 ##\nTrue\n\n...\n\nsage: v = [(1,0,7,-1), (-2,-2,4,-3), (-1,-1,-1,4), (2,9,0,-5), (-2,-1,5,1)] ## line 7164 ##\nsage: simplex = Polyhedron(v); simplex ## line 7165 ##\nA 4-dimensional polyhedron in ZZ^4 defined as the convex hull of 5 vertices\nsage: len(simplex.integral_points()) ## line 7167 ##\n49\nsage: P = 1/10*polytopes.hypercube(14) ## line 7172 ##\nsig_error() without sig_on()\n\n----------------------------------------------------------------------\nsage -t --long src/sage/geometry/polyhedron/base.py  # Killed due to abort\n----------------------------------------------------------------------\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/28866\n\n",
    "created_at": "2019-12-10T08:35:20Z",
    "labels": [
        "component: geometry",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "doctest killed due to abord in geometry/polyhedron/base.py",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28629",
    "user": "https://github.com/seblabbe"
}
```
CC:  @mkoeppe @jplab @orlitzky


```
sage -t --long src/sage/geometry/polyhedron/base.py
```


gives


```
Using --optional=4ti2,build,cbc,ccache,cryptominisat,dochtml,dot2tex,e_antic,glucose,latte_int,lidia,lrslib,memlimit,normaliz,notedown,openssl,pandoc_attributes,pycosat,pynormaliz,rst2ipynb,sage,sagenb
Doctesting 1 file.

    Killed due to abort
**********************************************************************
Tests run before process (pid=19555) failed:
sage: p = polytopes.hypercube(2) ## line 71 ##
sage: from sage.geometry.polyhedron.base import is_Polyhedron ## line 72 ##
sage: is_Polyhedron(p) ## line 73 ##
True

...

sage: v = [(1,0,7,-1), (-2,-2,4,-3), (-1,-1,-1,4), (2,9,0,-5), (-2,-1,5,1)] ## line 7164 ##
sage: simplex = Polyhedron(v); simplex ## line 7165 ##
A 4-dimensional polyhedron in ZZ^4 defined as the convex hull of 5 vertices
sage: len(simplex.integral_points()) ## line 7167 ##
49
sage: P = 1/10*polytopes.hypercube(14) ## line 7172 ##
sig_error() without sig_on()

----------------------------------------------------------------------
sage -t --long src/sage/geometry/polyhedron/base.py  # Killed due to abort
----------------------------------------------------------------------
```


Issue created by migration from https://trac.sagemath.org/ticket/28866





---

archive/issue_comments_403740.json:
```json
{
    "body": "On the same machine, the following works, but takes long time\n\n\n```\nsage: %time P = 1/10*polytopes.hypercube(14)\nCPU times: user 8.08 s, sys: 76 ms, total: 8.16 s\nWall time: 8.15 s\n```\n\n\nis it normal that it takes soo long?",
    "created_at": "2019-12-10T08:57:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403740",
    "user": "https://github.com/seblabbe"
}
```

On the same machine, the following works, but takes long time


```
sage: %time P = 1/10*polytopes.hypercube(14)
CPU times: user 8.08 s, sys: 76 ms, total: 8.16 s
Wall time: 8.15 s
```


is it normal that it takes soo long?



---

archive/issue_comments_403741.json:
```json
{
    "body": "Is there a particular reason for testing this? Otherwise I would just mark it as not tested.\n\nThis points out that the hypercube is set up the wrong way. It takes much much longer to set it up from vertices than from inequalities:\n\n\n```\nsage: %time P = polytopes.hypercube(14)\nCPU times: user 2.73 s, sys: 11 ms, total: 2.74 s\nWall time: 2.74 s\nsage: %time Q = Polyhedron(ieqs=P.inequalities())\nCPU times: user 401 ms, sys: 3.95 ms, total: 405 ms\nWall time: 404 ms\n```\n\n\nWith #28880 we could just provide both Vrepresentation and Hrepresentation whenever possible\n(for example when dilating). If the backend does not allow setting up from both, then at least the shorter representation will be chosen.",
    "created_at": "2019-12-14T14:40:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403741",
    "user": "https://github.com/kliem"
}
```

Is there a particular reason for testing this? Otherwise I would just mark it as not tested.

This points out that the hypercube is set up the wrong way. It takes much much longer to set it up from vertices than from inequalities:


```
sage: %time P = polytopes.hypercube(14)
CPU times: user 2.73 s, sys: 11 ms, total: 2.74 s
Wall time: 2.74 s
sage: %time Q = Polyhedron(ieqs=P.inequalities())
CPU times: user 401 ms, sys: 3.95 ms, total: 405 ms
Wall time: 404 ms
```


With #28880 we could just provide both Vrepresentation and Hrepresentation whenever possible
(for example when dilating). If the backend does not allow setting up from both, then at least the shorter representation will be chosen.



---

archive/issue_comments_403742.json:
```json
{
    "body": "Replying to [comment:5 gh-kliem]:\n> Is there a particular reason for testing this? Otherwise I would just mark it as not tested.\n\nThis is a doctest for the `integral_points` method. The point of the doctest is the following line, which took very long before I implemented a simple rounding improvement. It's fine with me to mark the test \"long time\" or \"not tested\".\n\n> [...] the hypercube is set up the wrong way. It takes much much longer to set it up from vertices than from inequalities: [...]\n> With #28880 we could just provide both Vrepresentation and Hrepresentation whenever possible\n> (for example when dilating). If the backend does not allow setting up from both, then at least the shorter representation will be chosen.\n\nYes, that would be the best fix for the hypercube.",
    "created_at": "2019-12-15T15:57:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403742",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:5 gh-kliem]:
> Is there a particular reason for testing this? Otherwise I would just mark it as not tested.

This is a doctest for the `integral_points` method. The point of the doctest is the following line, which took very long before I implemented a simple rounding improvement. It's fine with me to mark the test "long time" or "not tested".

> [...] the hypercube is set up the wrong way. It takes much much longer to set it up from vertices than from inequalities: [...]
> With #28880 we could just provide both Vrepresentation and Hrepresentation whenever possible
> (for example when dilating). If the backend does not allow setting up from both, then at least the shorter representation will be chosen.

Yes, that would be the best fix for the hypercube.



---

archive/issue_comments_403743.json:
```json
{
    "body": "Setting up the hypercube with Hrep will involve shuffling of vertices.\n\nI would like to wait with this until #28646 is through.",
    "created_at": "2019-12-18T08:49:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403743",
    "user": "https://github.com/kliem"
}
```

Setting up the hypercube with Hrep will involve shuffling of vertices.

I would like to wait with this until #28646 is through.



---

archive/issue_comments_403744.json:
```json
{
    "body": "Ticket retargeted after milestone closed",
    "created_at": "2020-01-06T14:10:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403744",
    "user": "https://github.com/embray"
}
```

Ticket retargeted after milestone closed



---

archive/issue_events_073003.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2020-01-06T14:10:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28629#event-73003"
}
```



---

archive/issue_comments_403745.json:
```json
{
    "body": "Once both #29198 and #29200 are done, this should be fine.",
    "created_at": "2020-02-14T16:11:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403745",
    "user": "https://github.com/kliem"
}
```

Once both #29198 and #29200 are done, this should be fine.



---

archive/issue_comments_403746.json:
```json
{
    "body": "Replying to [comment:10 gh-kliem]:\n> Once both #29198 and #29200 are done, this should be fine.\n\nI tested with both #29198 and #29200. I now get a different error message (Memory error):\n\n\n```\nDoctesting 1 file.\nsage -t --long src/sage/geometry/polyhedron/base.py\n**********************************************************************\nFile \"src/sage/geometry/polyhedron/base.py\", line 7948, in sage.geometry.polyhedron.base.Polyhedron_base.integral_points\nFailed example:\n    P = 1/10*polytopes.hypercube(14)  # long time\nException raised:\n    Traceback (most recent call last):\n      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.geometry.polyhedron.base.Polyhedron_base.integral_points[12]>\", line 1, in <module>\n        P = Integer(1)/Integer(10)*polytopes.hypercube(Integer(14))  # long time\n      File \"sage/rings/rational.pyx\", line 2414, in sage.rings.rational.Rational.__mul__ (build/cythonized/sage/rings/rational.c:20776)\n        return coercion_model.bin_op(left, right, operator.mul)\n      File \"sage/structure/coerce.pyx\", line 1201, in sage.structure.coerce.CoercionModel.bin_op (build/cythonized/sage/structure/coerce.c:10056)\n        return (<Action>action)._act_(x, y)\n      File \"sage/categories/action.pyx\", line 438, in sage.categories.action.PrecomposedAction._act_ (build/cythonized/sage/categories/action.c:6958)\n        return self._action._act_(g, x)\n      File \"sage/structure/coerce_actions.pyx\", line 153, in sage.structure.coerce_actions.ActedUponAction._act_ (build/cythonized/sage/structure/coerce_actions.c:4479)\n        return (<Element>x)._acted_upon_(g, not self._is_left)\n      File \"sage/structure/element.pyx\", line 927, in sage.structure.element.Element._acted_upon_ (build/cythonized/sage/structure/element.c:8608)\n        cpdef _acted_upon_(self, x, bint self_on_left):\n      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/geometry/polyhedron/base.py\", line 4616, in _acted_upon_\n        return self.dilation(actor)\n      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/geometry/polyhedron/base.py\", line 4442, in dilation\n        new_vertices = [ list(scalar*v.vector()) for v in self.vertex_generator() ]\n      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/geometry/polyhedron/base.py\", line 4442, in <listcomp>\n        new_vertices = [ list(scalar*v.vector()) for v in self.vertex_generator() ]\n    MemoryError\n**********************************************************************\n```\n\n\nand the traceback that follows continues further than earlier:\n\n\n```\n...\nsage: P = Polyhedron(V) ## line 9066 ##\nsage: P.affine_hull() ## line 9067 ##\nA 4-dimensional polyhedron in ZZ^4 defined as the convex hull of 6 vertices\nsage: P.affine_hull(orthonormal=True) ## line 9069 ##\nsage: P.affine_hull(orthonormal=True, extend=True) ## line 9073 ##\nA 4-dimensional polyhedron in AA^4 defined as the convex hull of 6 vertices\nsage: sig_on_count() # check sig_on/off pairings (virtual doctest) ## line 9075 ##\n0\nsage: P = polytopes.cube() ## line 9139 ##\nsage: P = Polyhedron(vertices=[[1, 0], [0, 1]]) ## line 9146 ##\nsage: P = Polyhedron(ambient_dim=2, vertices=[]) ## line 9155 ##\nsage: P = Polyhedron(vertices=[[1, 0], [0, 1]], rays=[[1, 0]]) ## line 9162 ##\nsage: P = Polyhedron(vertices=[[1, 0], [0, 1]], lines=[[1, 0]]) ## line 9175 ##\nsage: P = polytopes.dodecahedron(); P ## line 9188 ##\nA 3-dimensional polyhedron in (Number Field in sqrt5 with defining polynomial x^2 - 5 with sqrt5 = 2.236067977499790?)^3 defined as the convex hull of 20 vertices\nsage: P = polytopes.dodecahedron(exact=False); P ## line 9198 ##\nA 3-dimensional polyhedron in RDF^3 defined as the convex hull of 20 vertices\nsage: sig_on_count() # check sig_on/off pairings (virtual doctest) ## line 9206 ##\n0\n\n**********************************************************************\n----------------------------------------------------------------------\nsage -t --long src/sage/geometry/polyhedron/base.py  # Bad exit: 1\n----------------------------------------------------------------------\n```\n",
    "created_at": "2020-03-05T21:22:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403746",
    "user": "https://github.com/seblabbe"
}
```

Replying to [comment:10 gh-kliem]:
> Once both #29198 and #29200 are done, this should be fine.

I tested with both #29198 and #29200. I now get a different error message (Memory error):


```
Doctesting 1 file.
sage -t --long src/sage/geometry/polyhedron/base.py
**********************************************************************
File "src/sage/geometry/polyhedron/base.py", line 7948, in sage.geometry.polyhedron.base.Polyhedron_base.integral_points
Failed example:
    P = 1/10*polytopes.hypercube(14)  # long time
Exception raised:
    Traceback (most recent call last):
      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.geometry.polyhedron.base.Polyhedron_base.integral_points[12]>", line 1, in <module>
        P = Integer(1)/Integer(10)*polytopes.hypercube(Integer(14))  # long time
      File "sage/rings/rational.pyx", line 2414, in sage.rings.rational.Rational.__mul__ (build/cythonized/sage/rings/rational.c:20776)
        return coercion_model.bin_op(left, right, operator.mul)
      File "sage/structure/coerce.pyx", line 1201, in sage.structure.coerce.CoercionModel.bin_op (build/cythonized/sage/structure/coerce.c:10056)
        return (<Action>action)._act_(x, y)
      File "sage/categories/action.pyx", line 438, in sage.categories.action.PrecomposedAction._act_ (build/cythonized/sage/categories/action.c:6958)
        return self._action._act_(g, x)
      File "sage/structure/coerce_actions.pyx", line 153, in sage.structure.coerce_actions.ActedUponAction._act_ (build/cythonized/sage/structure/coerce_actions.c:4479)
        return (<Element>x)._acted_upon_(g, not self._is_left)
      File "sage/structure/element.pyx", line 927, in sage.structure.element.Element._acted_upon_ (build/cythonized/sage/structure/element.c:8608)
        cpdef _acted_upon_(self, x, bint self_on_left):
      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/geometry/polyhedron/base.py", line 4616, in _acted_upon_
        return self.dilation(actor)
      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/geometry/polyhedron/base.py", line 4442, in dilation
        new_vertices = [ list(scalar*v.vector()) for v in self.vertex_generator() ]
      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/geometry/polyhedron/base.py", line 4442, in <listcomp>
        new_vertices = [ list(scalar*v.vector()) for v in self.vertex_generator() ]
    MemoryError
**********************************************************************
```


and the traceback that follows continues further than earlier:


```
...
sage: P = Polyhedron(V) ## line 9066 ##
sage: P.affine_hull() ## line 9067 ##
A 4-dimensional polyhedron in ZZ^4 defined as the convex hull of 6 vertices
sage: P.affine_hull(orthonormal=True) ## line 9069 ##
sage: P.affine_hull(orthonormal=True, extend=True) ## line 9073 ##
A 4-dimensional polyhedron in AA^4 defined as the convex hull of 6 vertices
sage: sig_on_count() # check sig_on/off pairings (virtual doctest) ## line 9075 ##
0
sage: P = polytopes.cube() ## line 9139 ##
sage: P = Polyhedron(vertices=[[1, 0], [0, 1]]) ## line 9146 ##
sage: P = Polyhedron(ambient_dim=2, vertices=[]) ## line 9155 ##
sage: P = Polyhedron(vertices=[[1, 0], [0, 1]], rays=[[1, 0]]) ## line 9162 ##
sage: P = Polyhedron(vertices=[[1, 0], [0, 1]], lines=[[1, 0]]) ## line 9175 ##
sage: P = polytopes.dodecahedron(); P ## line 9188 ##
A 3-dimensional polyhedron in (Number Field in sqrt5 with defining polynomial x^2 - 5 with sqrt5 = 2.236067977499790?)^3 defined as the convex hull of 20 vertices
sage: P = polytopes.dodecahedron(exact=False); P ## line 9198 ##
A 3-dimensional polyhedron in RDF^3 defined as the convex hull of 20 vertices
sage: sig_on_count() # check sig_on/off pairings (virtual doctest) ## line 9206 ##
0

**********************************************************************
----------------------------------------------------------------------
sage -t --long src/sage/geometry/polyhedron/base.py  # Bad exit: 1
----------------------------------------------------------------------
```




---

archive/issue_comments_403747.json:
```json
{
    "body": "Is it possible that your run has very little memory available?\n\nI can get the tests to pass even with a memorylimit of 1400 MB. However, there are many obvious ways to reduce the memory usage, especially in this specific test:\n\n- Set up the hypercube with a tuple instead of a list of vertices. (Iterator doesn't work, we need to compare the length of Vrep and Hrep).\n- Set up dilation with a tuple of vertices instead of a list of vertices.\n- Use backend `field` instead of `ppl` in this specific test (it seems that polyhedra with backend `ppl` are pretty large objects compared to `field`).",
    "created_at": "2020-03-06T07:28:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403747",
    "user": "https://github.com/kliem"
}
```

Is it possible that your run has very little memory available?

I can get the tests to pass even with a memorylimit of 1400 MB. However, there are many obvious ways to reduce the memory usage, especially in this specific test:

- Set up the hypercube with a tuple instead of a list of vertices. (Iterator doesn't work, we need to compare the length of Vrep and Hrep).
- Set up dilation with a tuple of vertices instead of a list of vertices.
- Use backend `field` instead of `ppl` in this specific test (it seems that polyhedra with backend `ppl` are pretty large objects compared to `field`).



---

archive/issue_comments_403748.json:
```json
{
    "body": "Does this solve the problem?\n----\nNew commits:",
    "created_at": "2020-03-22T10:14:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403748",
    "user": "https://github.com/kliem"
}
```

Does this solve the problem?
----
New commits:



---

archive/issue_comments_403749.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-03-22T10:14:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403749",
    "user": "https://github.com/kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_403750.json:
```json
{
    "body": "With the current branch, `sage -t --long --memlimit=3400 src/sage/geometry/polyhedron/base.py` return a Bad exit and setting `--memlimit=3500` returns `[1485 tests, 24.67 s] All tests passed!`\n    \nSo it seems testing the file uses somewhere between 3400 and 3500 MB. On my machine, the default --memlimit is 3300 MB which explains the issue.\n\n\n```\nsage -t --help\n```\n\ngives:\n\n```\nUsage: sage -t [options] filenames\n\nOptions:\n\n...\n\n  -m MEMLIMIT, --memlimit=MEMLIMIT\n                        maximum virtual memory to allow each test process, in\n                        megabytes; no limit if zero or less, but tests tagged\n                        \"optional - memlimit\" are skipped if no limit is set\n                        (default: 3300 MB)\n```\n\n\nWhat is the default memlimit on your machine?",
    "created_at": "2020-04-01T18:54:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403750",
    "user": "https://github.com/seblabbe"
}
```

With the current branch, `sage -t --long --memlimit=3400 src/sage/geometry/polyhedron/base.py` return a Bad exit and setting `--memlimit=3500` returns `[1485 tests, 24.67 s] All tests passed!`
    
So it seems testing the file uses somewhere between 3400 and 3500 MB. On my machine, the default --memlimit is 3300 MB which explains the issue.


```
sage -t --help
```

gives:

```
Usage: sage -t [options] filenames

Options:

...

  -m MEMLIMIT, --memlimit=MEMLIMIT
                        maximum virtual memory to allow each test process, in
                        megabytes; no limit if zero or less, but tests tagged
                        "optional - memlimit" are skipped if no limit is set
                        (default: 3300 MB)
```


What is the default memlimit on your machine?



---

archive/issue_comments_403751.json:
```json
{
    "body": "For comparison, I updated the description of the ticket with info about memlimit (3600 is ok, but 3500 fails on my machine on the latest develop version 9.1.beta9).",
    "created_at": "2020-04-01T19:20:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403751",
    "user": "https://github.com/seblabbe"
}
```

For comparison, I updated the description of the ticket with info about memlimit (3600 is ok, but 3500 fails on my machine on the latest develop version 9.1.beta9).



---

archive/issue_comments_403752.json:
```json
{
    "body": "Can this be related to the optional packages I have installed?\n\n\n```\nUsing --optional=4ti2,build,cbc,ccache,cryptominisat,dochtml,dot2tex,e_antic,\nglucose,latte_int,lidia,lrslib,memlimit,normaliz,notedown,openssl,\npandoc_attributes,pycosat,pynormaliz,rst2ipynb,sage,\nsage_numerical_backends_coin,sage_numerical_backends_cplex,\nsage_numerical_backends_gurobi\n```\n\n\nOn a another machine, I am able to run the test with `--memlimit=2900` but not with `--memlimit=2800`. That other machine have the following optional packages installed:\n\n```\nUsing --optional=4ti2,build,cbc,ccache,cryptominisat,dochtml,dot2tex,e_antic,\nflask,flask_autoindex,flask_babel,flask_oldsessions,flask_openid,flask_silk,\nfricas,glucose,latte_int,lidia,lrslib,memlimit,normaliz,notedown,openssl,\npandoc_attributes,pycosat,pynormaliz,python2,python_openid,rst2ipynb,sage,\nsagenb,speaklater,twisted\n```\n",
    "created_at": "2020-04-01T19:30:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403752",
    "user": "https://github.com/seblabbe"
}
```

Can this be related to the optional packages I have installed?


```
Using --optional=4ti2,build,cbc,ccache,cryptominisat,dochtml,dot2tex,e_antic,
glucose,latte_int,lidia,lrslib,memlimit,normaliz,notedown,openssl,
pandoc_attributes,pycosat,pynormaliz,rst2ipynb,sage,
sage_numerical_backends_coin,sage_numerical_backends_cplex,
sage_numerical_backends_gurobi
```


On a another machine, I am able to run the test with `--memlimit=2900` but not with `--memlimit=2800`. That other machine have the following optional packages installed:

```
Using --optional=4ti2,build,cbc,ccache,cryptominisat,dochtml,dot2tex,e_antic,
flask,flask_autoindex,flask_babel,flask_oldsessions,flask_openid,flask_silk,
fricas,glucose,latte_int,lidia,lrslib,memlimit,normaliz,notedown,openssl,
pandoc_attributes,pycosat,pynormaliz,python2,python_openid,rst2ipynb,sage,
sagenb,speaklater,twisted
```




---

archive/issue_comments_403753.json:
```json
{
    "body": "As far as I know the default is the same everywhere. 3300MB. As already mentioned the following passes (also on 9.1.beta9):\n\n\n```\nsage -t --long --memlimit=1400 src/sage/geometry/polyhedron/base.py\n```\n\n\nSo maybe that is not an issue of `polyhedron/base.py`, but that your sage eats up memory at startup.",
    "created_at": "2020-04-01T19:40:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403753",
    "user": "https://github.com/kliem"
}
```

As far as I know the default is the same everywhere. 3300MB. As already mentioned the following passes (also on 9.1.beta9):


```
sage -t --long --memlimit=1400 src/sage/geometry/polyhedron/base.py
```


So maybe that is not an issue of `polyhedron/base.py`, but that your sage eats up memory at startup.



---

archive/issue_comments_403754.json:
```json
{
    "body": "> So maybe that is not an issue of `polyhedron/base.py`, but that your sage eats up memory at startup.\n\nYes, but I get that issue only for that file.",
    "created_at": "2020-04-01T19:45:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403754",
    "user": "https://github.com/seblabbe"
}
```

> So maybe that is not an issue of `polyhedron/base.py`, but that your sage eats up memory at startup.

Yes, but I get that issue only for that file.



---

archive/issue_comments_403755.json:
```json
{
    "body": "The other thing you could try is doing a garbage collection somewhere along the way in the doctests. I don't know, if that would make a difference. One could hide this somewhere in some `TESTS` section.",
    "created_at": "2020-04-01T19:46:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403755",
    "user": "https://github.com/kliem"
}
```

The other thing you could try is doing a garbage collection somewhere along the way in the doctests. I don't know, if that would make a difference. One could hide this somewhere in some `TESTS` section.



---

archive/issue_comments_403756.json:
```json
{
    "body": "Removing the doctest on a clean develop branch as follows allows me to make `--memlimit=3500` to pass but `--memlimit=3400` is not enough. So, this doctest is not the bigest issue in that file.\n\n```diff\ndiff --git a/src/sage/geometry/polyhedron/base.py b/src/sage/geometry/polyhedron/base.py\nindex c2e114a..7f3f4e7 100644\n--- a/src/sage/geometry/polyhedron/base.py\n+++ b/src/sage/geometry/polyhedron/base.py\n@@ -7945,8 +7945,8 @@ class Polyhedron_base(Element):\n \n         A case where rounding in the right direction goes a long way::\n \n-            sage: P = 1/10*polytopes.hypercube(14)  # long time\n-            sage: P.integral_points()  # long time\n+            sage: P = 1/10*polytopes.hypercube(14)  # long time   # not tested\n+            sage: P.integral_points()  # long time                # not tested\n             ((0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),)\n \n         Finally, the 3-d reflexive polytope number 4078::\n```\n",
    "created_at": "2020-04-01T19:47:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403756",
    "user": "https://github.com/seblabbe"
}
```

Removing the doctest on a clean develop branch as follows allows me to make `--memlimit=3500` to pass but `--memlimit=3400` is not enough. So, this doctest is not the bigest issue in that file.

```diff
diff --git a/src/sage/geometry/polyhedron/base.py b/src/sage/geometry/polyhedron/base.py
index c2e114a..7f3f4e7 100644
--- a/src/sage/geometry/polyhedron/base.py
+++ b/src/sage/geometry/polyhedron/base.py
@@ -7945,8 +7945,8 @@ class Polyhedron_base(Element):
 
         A case where rounding in the right direction goes a long way::
 
-            sage: P = 1/10*polytopes.hypercube(14)  # long time
-            sage: P.integral_points()  # long time
+            sage: P = 1/10*polytopes.hypercube(14)  # long time   # not tested
+            sage: P.integral_points()  # long time                # not tested
             ((0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),)
 
         Finally, the 3-d reflexive polytope number 4078::
```




---

archive/issue_comments_403757.json:
```json
{
    "body": "Replying to [comment:20 gh-kliem]:\n> The other thing you could try is doing a garbage collection somewhere along the way in the doctests. I don't know, if that would make a difference. One could hide this somewhere in some `TESTS` section.\n\nThis seems to work! I added one at one place and I do not get the bad exit anymore. I will report something in a few minutes.",
    "created_at": "2020-04-01T19:54:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403757",
    "user": "https://github.com/seblabbe"
}
```

Replying to [comment:20 gh-kliem]:
> The other thing you could try is doing a garbage collection somewhere along the way in the doctests. I don't know, if that would make a difference. One could hide this somewhere in some `TESTS` section.

This seems to work! I added one at one place and I do not get the bad exit anymore. I will report something in a few minutes.



---

archive/issue_comments_403758.json:
```json
{
    "body": "> This seems to work! \n\nIt worked the first time (no Bad exit, only a bunch of memory errors), but I never was able to reproduce it. Adding a bunch of `import gc;gc.collect()` does not make a difference.",
    "created_at": "2020-04-01T20:12:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403758",
    "user": "https://github.com/seblabbe"
}
```

> This seems to work! 

It worked the first time (no Bad exit, only a bunch of memory errors), but I never was able to reproduce it. Adding a bunch of `import gc;gc.collect()` does not make a difference.



---

archive/issue_comments_403759.json:
```json
{
    "body": "Then I guess the only thing one could do is work through the file and reduce memory usage in doctests (or in general) wherever this seems to be a problem.",
    "created_at": "2020-04-01T20:15:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403759",
    "user": "https://github.com/kliem"
}
```

Then I guess the only thing one could do is work through the file and reduce memory usage in doctests (or in general) wherever this seems to be a problem.



---

archive/issue_comments_403760.json:
```json
{
    "body": "It would be nice if there would exist something like\n\n```\n  --warn-long           warn if tests take more time than SECONDS\n```\n\nfor memory.",
    "created_at": "2020-04-02T07:25:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403760",
    "user": "https://github.com/seblabbe"
}
```

It would be nice if there would exist something like

```
  --warn-long           warn if tests take more time than SECONDS
```

for memory.



---

archive/issue_comments_403761.json:
```json
{
    "body": "Well, but as we already found out, this is difficult to estimate.\n\nAnyway, it's a good project either way to reduce memory usage. So we could do that.",
    "created_at": "2020-04-02T07:28:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403761",
    "user": "https://github.com/kliem"
}
```

Well, but as we already found out, this is difficult to estimate.

Anyway, it's a good project either way to reduce memory usage. So we could do that.



---

archive/issue_comments_403762.json:
```json
{
    "body": "I just saw in the doc of `sage -t --help` that `--gc=ALWAYS` calls `gc.collect()` before every test. But even with this option, `sage -t --long --gc=ALWAYS src/sage/geometry/polyhedron/base.py` finishes with a bad exit. It seems to fail at two different places (the one we know + another).\n\nIf I do the following changes:\n\n\n```diff\ndiff --git a/src/sage/geometry/polyhedron/base.py b/src/sage/geometry/polyhedron/base.py\nindex c2e114a..9911d7f 100644\n--- a/src/sage/geometry/polyhedron/base.py\n+++ b/src/sage/geometry/polyhedron/base.py\n@@ -7945,8 +7945,8 @@ class Polyhedron_base(Element):\n \n         A case where rounding in the right direction goes a long way::\n \n-            sage: P = 1/10*polytopes.hypercube(14)  # long time\n-            sage: P.integral_points()  # long time\n+            sage: P = 1/10*polytopes.hypercube(14)  # long time    # not tested\n+            sage: P.integral_points()  # long time                 # not tested\n             ((0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),)\n \n         Finally, the 3-d reflexive polytope number 4078::\n@@ -8229,7 +8229,7 @@ class Polyhedron_base(Element):\n         EXAMPLES::\n \n             sage: quadrangle = Polyhedron(vertices=[(0,0),(1,0),(0,1),(2,3)])\n-            sage: quadrangle.combinatorial_automorphism_group().is_isomorphic(groups.permutation.Dihedral(4))\n+            sage: quadrangle.combinatorial_automorphism_group().is_isomorphic(groups.permutation.Dihedral(4)) # not tested\n             True\n             sage: quadrangle.restricted_automorphism_group()\n             Permutation Group with generators [()]\n```\n\n\nThen, I get `All tests passed!` for `sage -t --long --gc=ALWAYS src/sage/geometry/polyhedron/base.py`.\n\nSo can we reduce the memory used in those two tests? Maybe reducing 14 to 8 in the first. In the second, I don't know?\n\n(but that will not be enough since `sage -t --long src/sage/geometry/polyhedron/base.py` return a Bad exit even the the two not tested)",
    "created_at": "2020-04-02T08:39:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403762",
    "user": "https://github.com/seblabbe"
}
```

I just saw in the doc of `sage -t --help` that `--gc=ALWAYS` calls `gc.collect()` before every test. But even with this option, `sage -t --long --gc=ALWAYS src/sage/geometry/polyhedron/base.py` finishes with a bad exit. It seems to fail at two different places (the one we know + another).

If I do the following changes:


```diff
diff --git a/src/sage/geometry/polyhedron/base.py b/src/sage/geometry/polyhedron/base.py
index c2e114a..9911d7f 100644
--- a/src/sage/geometry/polyhedron/base.py
+++ b/src/sage/geometry/polyhedron/base.py
@@ -7945,8 +7945,8 @@ class Polyhedron_base(Element):
 
         A case where rounding in the right direction goes a long way::
 
-            sage: P = 1/10*polytopes.hypercube(14)  # long time
-            sage: P.integral_points()  # long time
+            sage: P = 1/10*polytopes.hypercube(14)  # long time    # not tested
+            sage: P.integral_points()  # long time                 # not tested
             ((0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),)
 
         Finally, the 3-d reflexive polytope number 4078::
@@ -8229,7 +8229,7 @@ class Polyhedron_base(Element):
         EXAMPLES::
 
             sage: quadrangle = Polyhedron(vertices=[(0,0),(1,0),(0,1),(2,3)])
-            sage: quadrangle.combinatorial_automorphism_group().is_isomorphic(groups.permutation.Dihedral(4))
+            sage: quadrangle.combinatorial_automorphism_group().is_isomorphic(groups.permutation.Dihedral(4)) # not tested
             True
             sage: quadrangle.restricted_automorphism_group()
             Permutation Group with generators [()]
```


Then, I get `All tests passed!` for `sage -t --long --gc=ALWAYS src/sage/geometry/polyhedron/base.py`.

So can we reduce the memory used in those two tests? Maybe reducing 14 to 8 in the first. In the second, I don't know?

(but that will not be enough since `sage -t --long src/sage/geometry/polyhedron/base.py` return a Bad exit even the the two not tested)



---

archive/issue_comments_403763.json:
```json
{
    "body": "Have you tried backend `field` instead, as in the branch of this ticket.\n\n\n```diff\n+    sage: P = 1/10*polytopes.hypercube(14, backend='field')\n-    sage: P = 1/10*polytopes.hypercube(14)\n```\n\nshould reduce memory usage significantly.\n\nIt seems wrong that \n\n```\nsage: quadrangle.combinatorial_automorphism_group().is_isomorphic(groups.permutation.Dihedral(4))\n```\n\nshould take a lot of memory.",
    "created_at": "2020-04-02T08:45:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403763",
    "user": "https://github.com/kliem"
}
```

Have you tried backend `field` instead, as in the branch of this ticket.


```diff
+    sage: P = 1/10*polytopes.hypercube(14, backend='field')
-    sage: P = 1/10*polytopes.hypercube(14)
```

should reduce memory usage significantly.

It seems wrong that 

```
sage: quadrangle.combinatorial_automorphism_group().is_isomorphic(groups.permutation.Dihedral(4))
```

should take a lot of memory.



---

archive/issue_comments_403764.json:
```json
{
    "body": "Replying to [comment:28 gh-kliem]:\n> Have you tried backend `field` instead, as in the branch of this ticket.\n> \n> {{{#!diff\n> +    sage: P = 1/10*polytopes.hypercube(14, backend='field')\n> -    sage: P = 1/10*polytopes.hypercube(14)\n> }}}\n> should reduce memory usage significantly.\n\nIt does not seem sufficient since `sage -t --long --gc=ALWAYS src/sage/geometry/polyhedron/base.py` works when this test is marked as `not tested` and return `Bad Exit` if `backend='field'` is used. \n\nBut `sage -t --long --gc=ALWAYS src/sage/geometry/polyhedron/base.py` works if I replace the test by\n`sage: P = 1/10*polytopes.hypercube(8, backend='field')` or\n`sage: P = 1/10*polytopes.hypercube(8)`. So reducing from 14 to 8 seems to help more than using `'field'` backend.",
    "created_at": "2020-04-02T10:34:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403764",
    "user": "https://github.com/seblabbe"
}
```

Replying to [comment:28 gh-kliem]:
> Have you tried backend `field` instead, as in the branch of this ticket.
> 
> {{{#!diff
> +    sage: P = 1/10*polytopes.hypercube(14, backend='field')
> -    sage: P = 1/10*polytopes.hypercube(14)
> }}}
> should reduce memory usage significantly.

It does not seem sufficient since `sage -t --long --gc=ALWAYS src/sage/geometry/polyhedron/base.py` works when this test is marked as `not tested` and return `Bad Exit` if `backend='field'` is used. 

But `sage -t --long --gc=ALWAYS src/sage/geometry/polyhedron/base.py` works if I replace the test by
`sage: P = 1/10*polytopes.hypercube(8, backend='field')` or
`sage: P = 1/10*polytopes.hypercube(8)`. So reducing from 14 to 8 seems to help more than using `'field'` backend.



---

archive/issue_comments_403765.json:
```json
{
    "body": "Replying to [comment:28 gh-kliem]:\n> It seems wrong that \n> {{{\n> sage: quadrangle.combinatorial_automorphism_group().is_isomorphic(groups.permutation.Dihedral(4))\n> }}}\n> should take a lot of memory.\n\nI agree but this what I obtain: \n\n* Using `1/10*polytopes.hypercube(8)` + using `--gc=ALWAYS` + marking the `quadrangle ... is_isomorphic` test as not tested works fine\n* Using `1/10*polytopes.hypercube(8)` + using `--gc=ALWAYS` return a Bad exit with the following message:\n\n\n```\nsage -t --long src/sage/geometry/polyhedron/base.py\n**********************************************************************\nFile \"src/sage/geometry/polyhedron/base.py\", line 7949, in sage.geometry.polyhedron.base.Polyhedron_base.integral_points\nFailed example:\n    P.integral_points()  # long time\nExpected:\n    ((0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),)\nGot:\n    ((0, 0, 0, 0, 0, 0, 0, 0),)\n**********************************************************************\nFile \"src/sage/geometry/polyhedron/base.py\", line 8232, in sage.geometry.polyhedron.base.Polyhedron_base.combinatorial_automorphism_group\nFailed example:\n    quadrangle.combinatorial_automorphism_group().is_isomorphic(groups.permutation.Dihedral(4))\nException raised:\n    Traceback (most recent call last):\n      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.geometry.polyhedron.base.Polyhedron_base.combinatorial_automorphism_group[1]>\", line 1, in <module>\n        quadrangle.combinatorial_automorphism_group().is_isomorphic(groups.permutation.Dihedral(Integer(4)))\n      File \"sage/misc/lazy_import.pyx\", line 321, in sage.misc.lazy_import.LazyImport.__getattr__ (build/cythonized/sage/misc/lazy_import.c:3536)\n        return getattr(self.get_object(), attr)\n      File \"sage/misc/lazy_import.pyx\", line 188, in sage.misc.lazy_import.LazyImport.get_object (build/cythonized/sage/misc/lazy_import.c:2347)\n        return self._get_object()\n      File \"sage/misc/lazy_import.pyx\", line 220, in sage.misc.lazy_import.LazyImport._get_object (build/cythonized/sage/misc/lazy_import.c:2586)\n        self._object = getattr(__import__(self._module, {}, {}, [self._name]), self._name)\n      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/groups/groups_catalog.py\", line 105, in <module>\n        from sage.groups.lie_gps import catalog as lie\n      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/groups/lie_gps/catalog.py\", line 5, in <module>\n        from sage.groups.lie_gps.nilpotent_lie_group import NilpotentLieGroup as Nilpotent\n      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/groups/lie_gps/nilpotent_lie_group.py\", line 23, in <module>\n        from sage.manifolds.differentiable.manifold import DifferentiableManifold\n      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/manifolds/differentiable/manifold.py\", line 448, in <module>\n        from sage.manifolds.manifold import TopologicalManifold\n      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/manifolds/manifold.py\", line 341, in <module>\n        from sage.manifolds.structure import(\n      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/manifolds/structure.py\", line 34, in <module>\n        from sage.manifolds.differentiable.manifold_homset import \\\n      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/manifolds/differentiable/manifold_homset.py\", line 49, in <module>\n        from sage.manifolds.differentiable.integrated_curve import IntegratedCurve\n      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/manifolds/differentiable/integrated_curve.py\", line 123, in <module>\n        from scipy.integrate import ode\n      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/scipy/integrate/__init__.py\", line 92, in <module>\n        from ._ode import *\n      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/scipy/integrate/_ode.py\", line 92, in <module>\n        from . import vode as _vode\n    ImportError: /home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/scipy/integrate/vode.cpython-37m-x86_64-linux-gnu.so: failed to map segment from shared object\n**********************************************************************\n2 items had failures:\n   1 of  15 in sage.geometry.polyhedron.base.Polyhedron_base.combinatorial_automorphism_group\n   1 of  34 in sage.geometry.polyhedron.base.Polyhedron_base.integral_points\nProcess DocTestWorker-1:\nTraceback (most recent call last):\n  File \"/home/slabbe/GitBox/sage/local/lib/python3.7/multiprocessing/process.py\", line 297, in _bootstrap\n    self.run()\n  File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 2172, in run\n    task(self.options, self.outtmpfile, msgpipe, self.result_queue)\n  File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 2525, in __call__\n    result_queue.put(result, False)\n  File \"/home/slabbe/GitBox/sage/local/lib/python3.7/multiprocessing/queues.py\", line 87, in put\n    self._start_thread()\n  File \"/home/slabbe/GitBox/sage/local/lib/python3.7/multiprocessing/queues.py\", line 170, in _start_thread\n    self._thread.start()\n  File \"/home/slabbe/GitBox/sage/local/lib/python3.7/threading.py\", line 847, in start\n    _start_new_thread(self._bootstrap, ())\nRuntimeError: can't start new thread\n    Bad exit: 1\n**********************************************************************\nTests run before process (pid=32760) failed:\n[...]\n```\n\n\nMaybe what happens at line `8232` with the quadrangle is just the moment where the memory gets busted. But, then, why when I mark the quadrangle line `8232`  as not tested does it suddenly work?",
    "created_at": "2020-04-02T10:46:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403765",
    "user": "https://github.com/seblabbe"
}
```

Replying to [comment:28 gh-kliem]:
> It seems wrong that 
> {{{
> sage: quadrangle.combinatorial_automorphism_group().is_isomorphic(groups.permutation.Dihedral(4))
> }}}
> should take a lot of memory.

I agree but this what I obtain: 

* Using `1/10*polytopes.hypercube(8)` + using `--gc=ALWAYS` + marking the `quadrangle ... is_isomorphic` test as not tested works fine
* Using `1/10*polytopes.hypercube(8)` + using `--gc=ALWAYS` return a Bad exit with the following message:


```
sage -t --long src/sage/geometry/polyhedron/base.py
**********************************************************************
File "src/sage/geometry/polyhedron/base.py", line 7949, in sage.geometry.polyhedron.base.Polyhedron_base.integral_points
Failed example:
    P.integral_points()  # long time
Expected:
    ((0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),)
Got:
    ((0, 0, 0, 0, 0, 0, 0, 0),)
**********************************************************************
File "src/sage/geometry/polyhedron/base.py", line 8232, in sage.geometry.polyhedron.base.Polyhedron_base.combinatorial_automorphism_group
Failed example:
    quadrangle.combinatorial_automorphism_group().is_isomorphic(groups.permutation.Dihedral(4))
Exception raised:
    Traceback (most recent call last):
      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.geometry.polyhedron.base.Polyhedron_base.combinatorial_automorphism_group[1]>", line 1, in <module>
        quadrangle.combinatorial_automorphism_group().is_isomorphic(groups.permutation.Dihedral(Integer(4)))
      File "sage/misc/lazy_import.pyx", line 321, in sage.misc.lazy_import.LazyImport.__getattr__ (build/cythonized/sage/misc/lazy_import.c:3536)
        return getattr(self.get_object(), attr)
      File "sage/misc/lazy_import.pyx", line 188, in sage.misc.lazy_import.LazyImport.get_object (build/cythonized/sage/misc/lazy_import.c:2347)
        return self._get_object()
      File "sage/misc/lazy_import.pyx", line 220, in sage.misc.lazy_import.LazyImport._get_object (build/cythonized/sage/misc/lazy_import.c:2586)
        self._object = getattr(__import__(self._module, {}, {}, [self._name]), self._name)
      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/groups/groups_catalog.py", line 105, in <module>
        from sage.groups.lie_gps import catalog as lie
      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/groups/lie_gps/catalog.py", line 5, in <module>
        from sage.groups.lie_gps.nilpotent_lie_group import NilpotentLieGroup as Nilpotent
      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/groups/lie_gps/nilpotent_lie_group.py", line 23, in <module>
        from sage.manifolds.differentiable.manifold import DifferentiableManifold
      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/manifolds/differentiable/manifold.py", line 448, in <module>
        from sage.manifolds.manifold import TopologicalManifold
      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/manifolds/manifold.py", line 341, in <module>
        from sage.manifolds.structure import(
      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/manifolds/structure.py", line 34, in <module>
        from sage.manifolds.differentiable.manifold_homset import \
      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/manifolds/differentiable/manifold_homset.py", line 49, in <module>
        from sage.manifolds.differentiable.integrated_curve import IntegratedCurve
      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/manifolds/differentiable/integrated_curve.py", line 123, in <module>
        from scipy.integrate import ode
      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/scipy/integrate/__init__.py", line 92, in <module>
        from ._ode import *
      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/scipy/integrate/_ode.py", line 92, in <module>
        from . import vode as _vode
    ImportError: /home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/scipy/integrate/vode.cpython-37m-x86_64-linux-gnu.so: failed to map segment from shared object
**********************************************************************
2 items had failures:
   1 of  15 in sage.geometry.polyhedron.base.Polyhedron_base.combinatorial_automorphism_group
   1 of  34 in sage.geometry.polyhedron.base.Polyhedron_base.integral_points
Process DocTestWorker-1:
Traceback (most recent call last):
  File "/home/slabbe/GitBox/sage/local/lib/python3.7/multiprocessing/process.py", line 297, in _bootstrap
    self.run()
  File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 2172, in run
    task(self.options, self.outtmpfile, msgpipe, self.result_queue)
  File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 2525, in __call__
    result_queue.put(result, False)
  File "/home/slabbe/GitBox/sage/local/lib/python3.7/multiprocessing/queues.py", line 87, in put
    self._start_thread()
  File "/home/slabbe/GitBox/sage/local/lib/python3.7/multiprocessing/queues.py", line 170, in _start_thread
    self._thread.start()
  File "/home/slabbe/GitBox/sage/local/lib/python3.7/threading.py", line 847, in start
    _start_new_thread(self._bootstrap, ())
RuntimeError: can't start new thread
    Bad exit: 1
**********************************************************************
Tests run before process (pid=32760) failed:
[...]
```


Maybe what happens at line `8232` with the quadrangle is just the moment where the memory gets busted. But, then, why when I mark the quadrangle line `8232`  as not tested does it suddenly work?



---

archive/issue_comments_403766.json:
```json
{
    "body": "> Maybe what happens at line `8232` with the quadrangle is just the moment where the memory gets busted. But, then, why when I mark the quadrangle line `8232`  as not tested does it suddenly work?\n\nTo challenge this hypothesis, I moved the method `combinatorial_automorphism_group` containing the quadrangle test at the very bottom of the file, and this is what I now get:\n\n\n```\n**********************************************************************\nFile \"src/sage/geometry/polyhedron/base.py\", line 9180, in sage.geometry.polyhedron.base.Polyhedron_base.combinatorial_automorphism_group\nFailed example:\n    quadrangle.combinatorial_automorphism_group().is_isomorphic(groups.permutation.Dihedral(4))\nException raised:\n...\n... same ImportError + Bad exit stuff ...\n...\n```\n\n\nso there is something happening with that particular quadrangle line...",
    "created_at": "2020-04-02T10:54:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403766",
    "user": "https://github.com/seblabbe"
}
```

> Maybe what happens at line `8232` with the quadrangle is just the moment where the memory gets busted. But, then, why when I mark the quadrangle line `8232`  as not tested does it suddenly work?

To challenge this hypothesis, I moved the method `combinatorial_automorphism_group` containing the quadrangle test at the very bottom of the file, and this is what I now get:


```
**********************************************************************
File "src/sage/geometry/polyhedron/base.py", line 9180, in sage.geometry.polyhedron.base.Polyhedron_base.combinatorial_automorphism_group
Failed example:
    quadrangle.combinatorial_automorphism_group().is_isomorphic(groups.permutation.Dihedral(4))
Exception raised:
...
... same ImportError + Bad exit stuff ...
...
```


so there is something happening with that particular quadrangle line...



---

archive/issue_comments_403767.json:
```json
{
    "body": "Also\n\n```diff\n+    sage: P = polytopes.hypercube(14, backend='field', intervals=[[-1/10,1/10]]*14)\n-    sage: P = 1/10*polytopes.hypercube(14)\n```\n\nshould be even better. This avoids creating an the vertices twice.",
    "created_at": "2020-04-02T11:00:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403767",
    "user": "https://github.com/kliem"
}
```

Also

```diff
+    sage: P = polytopes.hypercube(14, backend='field', intervals=[[-1/10,1/10]]*14)
-    sage: P = 1/10*polytopes.hypercube(14)
```

should be even better. This avoids creating an the vertices twice.



---

archive/issue_comments_403768.json:
```json
{
    "body": "With `P = 1/10*polytopes.hypercube(8)` and separating the quadrangle line into parts, I get that `sage -t --long --gc=ALWAYS src/sage/geometry/polyhedron/base.py` works when:\n\n\n```\n            sage: G = quadrangle.combinatorial_automorphism_group()\n            sage: D4 = groups.permutation.Dihedral(4) # not tested\n            sage: G.is_isomorphic(D4)                 # not tested\n```\n\n\nand fails with bad exit when\n\n\n```\n            sage: G = quadrangle.combinatorial_automorphism_group()\n            sage: D4 = groups.permutation.Dihedral(4)\n            sage: G.is_isomorphic(D4)                 # not tested\n```\n\n\nWhat happens with the part `groups.permutation.Dihedral(4)` is a mystery for me. Traceback is below:\n\n\n```\n    D4 = groups.permutation.Dihedral(4)\nException raised:\n    Traceback (most recent call last):\n      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.geometry.polyhedron.base.Polyhedron_base.combinatorial_automorphism_group[3]>\", line 1, in <module>\n        D4 = groups.permutation.Dihedral(Integer(4))\n      File \"sage/misc/lazy_import.pyx\", line 321, in sage.misc.lazy_import.LazyImport.__getattr__ (build/cythonized/sage/misc/lazy_import.c:3536)\n        return getattr(self.get_object(), attr)\n      File \"sage/misc/lazy_import.pyx\", line 188, in sage.misc.lazy_import.LazyImport.get_object (build/cythonized/sage/misc/lazy_import.c:2347)\n        return self._get_object()\n      File \"sage/misc/lazy_import.pyx\", line 220, in sage.misc.lazy_import.LazyImport._get_object (build/cythonized/sage/misc/lazy_import.c:2586)\n        self._object = getattr(__import__(self._module, {}, {}, [self._name]), self._name)\n      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/groups/groups_catalog.py\", line 105, in <module>\n        from sage.groups.lie_gps import catalog as lie\n      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/groups/lie_gps/catalog.py\", line 5, in <module>\n        from sage.groups.lie_gps.nilpotent_lie_group import NilpotentLieGroup as Nilpotent\n      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/groups/lie_gps/nilpotent_lie_group.py\", line 23, in <module>\n        from sage.manifolds.differentiable.manifold import DifferentiableManifold\n      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/manifolds/differentiable/manifold.py\", line 448, in <module>\n        from sage.manifolds.manifold import TopologicalManifold\n      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/manifolds/manifold.py\", line 341, in <module>\n        from sage.manifolds.structure import(\n      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/manifolds/structure.py\", line 34, in <module>\n        from sage.manifolds.differentiable.manifold_homset import \\\n      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/manifolds/differentiable/manifold_homset.py\", line 49, in <module>\n        from sage.manifolds.differentiable.integrated_curve import IntegratedCurve\n      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/manifolds/differentiable/integrated_curve.py\", line 123, in <module>\n        from scipy.integrate import ode\n      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/scipy/integrate/__init__.py\", line 92, in <module>\n        from ._ode import *\n      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/scipy/integrate/_ode.py\", line 92, in <module>\n        from . import vode as _vode\n    ImportError: /home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/scipy/integrate/vode.cpython-37m-x86_64-linux-gnu.so: failed to map segment from shared object\n```\n",
    "created_at": "2020-04-02T11:23:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403768",
    "user": "https://github.com/seblabbe"
}
```

With `P = 1/10*polytopes.hypercube(8)` and separating the quadrangle line into parts, I get that `sage -t --long --gc=ALWAYS src/sage/geometry/polyhedron/base.py` works when:


```
            sage: G = quadrangle.combinatorial_automorphism_group()
            sage: D4 = groups.permutation.Dihedral(4) # not tested
            sage: G.is_isomorphic(D4)                 # not tested
```


and fails with bad exit when


```
            sage: G = quadrangle.combinatorial_automorphism_group()
            sage: D4 = groups.permutation.Dihedral(4)
            sage: G.is_isomorphic(D4)                 # not tested
```


What happens with the part `groups.permutation.Dihedral(4)` is a mystery for me. Traceback is below:


```
    D4 = groups.permutation.Dihedral(4)
Exception raised:
    Traceback (most recent call last):
      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.geometry.polyhedron.base.Polyhedron_base.combinatorial_automorphism_group[3]>", line 1, in <module>
        D4 = groups.permutation.Dihedral(Integer(4))
      File "sage/misc/lazy_import.pyx", line 321, in sage.misc.lazy_import.LazyImport.__getattr__ (build/cythonized/sage/misc/lazy_import.c:3536)
        return getattr(self.get_object(), attr)
      File "sage/misc/lazy_import.pyx", line 188, in sage.misc.lazy_import.LazyImport.get_object (build/cythonized/sage/misc/lazy_import.c:2347)
        return self._get_object()
      File "sage/misc/lazy_import.pyx", line 220, in sage.misc.lazy_import.LazyImport._get_object (build/cythonized/sage/misc/lazy_import.c:2586)
        self._object = getattr(__import__(self._module, {}, {}, [self._name]), self._name)
      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/groups/groups_catalog.py", line 105, in <module>
        from sage.groups.lie_gps import catalog as lie
      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/groups/lie_gps/catalog.py", line 5, in <module>
        from sage.groups.lie_gps.nilpotent_lie_group import NilpotentLieGroup as Nilpotent
      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/groups/lie_gps/nilpotent_lie_group.py", line 23, in <module>
        from sage.manifolds.differentiable.manifold import DifferentiableManifold
      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/manifolds/differentiable/manifold.py", line 448, in <module>
        from sage.manifolds.manifold import TopologicalManifold
      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/manifolds/manifold.py", line 341, in <module>
        from sage.manifolds.structure import(
      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/manifolds/structure.py", line 34, in <module>
        from sage.manifolds.differentiable.manifold_homset import \
      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/manifolds/differentiable/manifold_homset.py", line 49, in <module>
        from sage.manifolds.differentiable.integrated_curve import IntegratedCurve
      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/manifolds/differentiable/integrated_curve.py", line 123, in <module>
        from scipy.integrate import ode
      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/scipy/integrate/__init__.py", line 92, in <module>
        from ._ode import *
      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/scipy/integrate/_ode.py", line 92, in <module>
        from . import vode as _vode
    ImportError: /home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/scipy/integrate/vode.cpython-37m-x86_64-linux-gnu.so: failed to map segment from shared object
```




---

archive/issue_comments_403769.json:
```json
{
    "body": "Replying to [comment:32 gh-kliem]:\n> Also\n> {{{#!diff\n> +    sage: P = polytopes.hypercube(14, backend='field', intervals=[This is the Trac macro *-1/10,1/10* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#-1/10,1/10-macro)*14)\n> -    sage: P = 1/10*polytopes.hypercube(14)\n> }}}\n> should be even better. This avoids creating an the vertices twice.\n\nIt does not help on my machine when running `sage -bt --long --gc=ALWAYS src/sage/geometry/polyhedron/base.py`:\n\n\n```\nsage -t --long src/sage/geometry/polyhedron/base.py\n**********************************************************************\nFile \"src/sage/geometry/polyhedron/base.py\", line 7948, in sage.geometry.polyhedron.base.Polyhedron_base.integral_points\nFailed example:\n    P = 1/10*polytopes.hypercube(14, backend='field', intervals=[[-1/10,1/10]]*14)  # long time\nException raised:\n    Traceback (most recent call last):\n      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.geometry.polyhedron.base.Polyhedron_base.integral_points[12]>\", line 1, in <module>\n        P = Integer(1)/Integer(10)*polytopes.hypercube(Integer(14), backend='field', intervals=[[-Integer(1)/Integer(10),Integer(1)/Integer(10)]]*Integer(14))  # long time\n      File \"sage/rings/rational.pyx\", line 2414, in sage.rings.rational.Rational.__mul__ (build/cythonized/sage/rings/rational.c:20776)\n        return coercion_model.bin_op(left, right, operator.mul)\n      File \"sage/structure/coerce.pyx\", line 1201, in sage.structure.coerce.CoercionModel.bin_op (build/cythonized/sage/structure/coerce.c:10056)\n        return (<Action>action)._act_(x, y)\n    MemoryError\n**********************************************************************\n[...]\n...  and eventually bad exit ...\n```\n",
    "created_at": "2020-04-02T19:15:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403769",
    "user": "https://github.com/seblabbe"
}
```

Replying to [comment:32 gh-kliem]:
> Also
> {{{#!diff
> +    sage: P = polytopes.hypercube(14, backend='field', intervals=[This is the Trac macro *-1/10,1/10* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#-1/10,1/10-macro)*14)
> -    sage: P = 1/10*polytopes.hypercube(14)
> }}}
> should be even better. This avoids creating an the vertices twice.

It does not help on my machine when running `sage -bt --long --gc=ALWAYS src/sage/geometry/polyhedron/base.py`:


```
sage -t --long src/sage/geometry/polyhedron/base.py
**********************************************************************
File "src/sage/geometry/polyhedron/base.py", line 7948, in sage.geometry.polyhedron.base.Polyhedron_base.integral_points
Failed example:
    P = 1/10*polytopes.hypercube(14, backend='field', intervals=[[-1/10,1/10]]*14)  # long time
Exception raised:
    Traceback (most recent call last):
      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.geometry.polyhedron.base.Polyhedron_base.integral_points[12]>", line 1, in <module>
        P = Integer(1)/Integer(10)*polytopes.hypercube(Integer(14), backend='field', intervals=[[-Integer(1)/Integer(10),Integer(1)/Integer(10)]]*Integer(14))  # long time
      File "sage/rings/rational.pyx", line 2414, in sage.rings.rational.Rational.__mul__ (build/cythonized/sage/rings/rational.c:20776)
        return coercion_model.bin_op(left, right, operator.mul)
      File "sage/structure/coerce.pyx", line 1201, in sage.structure.coerce.CoercionModel.bin_op (build/cythonized/sage/structure/coerce.c:10056)
        return (<Action>action)._act_(x, y)
    MemoryError
**********************************************************************
[...]
...  and eventually bad exit ...
```




---

archive/issue_comments_403770.json:
```json
{
    "body": "So long as we're making micro-optimizations, can the inner lists be turned into tuples, too? E.g.\n\n\n```\n- ieqs = tuple([0]*(dim+1) for _ in range(2*dim))\n+ ieqs = tuple(itertools.repeat(tuple(itertools.repeat(0,dim+1)),2*dim))\n```\n\n\n\n```\n- cp = tuple(itertools.product([-1,1], repeat=dim))\n+ cp = tuple(itertools.product((-1,1), repeat=dim))\n```\n\n\n\n```\n- cp = tuple(itertools.product([0,1], repeat=dim))\n+ cp = tuple(itertools.product((0,1), repeat=dim))\n```\n\n\nIt looks like we're looping through a lot of structures twice, too. This pattern repeats itself:\n\n\n```\nnew_inequalities = tuple(f.vector()*one for f in self.inequality_generator())\nfor f in new_inequalities:\n    f[0] *= scalar\n```\n\n\nThe comprehension could be modified to spit out the right thing the first time through, or at the very least we could use `map()` with a lambda to apply the \"multiply the first coordinate by <scalar>\" function as the tuple is built.",
    "created_at": "2020-04-04T17:38:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403770",
    "user": "https://github.com/orlitzky"
}
```

So long as we're making micro-optimizations, can the inner lists be turned into tuples, too? E.g.


```
- ieqs = tuple([0]*(dim+1) for _ in range(2*dim))
+ ieqs = tuple(itertools.repeat(tuple(itertools.repeat(0,dim+1)),2*dim))
```



```
- cp = tuple(itertools.product([-1,1], repeat=dim))
+ cp = tuple(itertools.product((-1,1), repeat=dim))
```



```
- cp = tuple(itertools.product([0,1], repeat=dim))
+ cp = tuple(itertools.product((0,1), repeat=dim))
```


It looks like we're looping through a lot of structures twice, too. This pattern repeats itself:


```
new_inequalities = tuple(f.vector()*one for f in self.inequality_generator())
for f in new_inequalities:
    f[0] *= scalar
```


The comprehension could be modified to spit out the right thing the first time through, or at the very least we could use `map()` with a lambda to apply the "multiply the first coordinate by <scalar>" function as the tuple is built.



---

archive/issue_comments_403771.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-04-07T14:25:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403771",
    "user": "https://github.com/kliem"
}
```

New commits:



---

archive/issue_comments_403772.json:
```json
{
    "body": "Thanks. I went to generators now.\n\nThis has the advantage that `ppl` doesn't waste time creating a tuple, which it won't need later.\nAlso all we need the input vertices/rays/lines/inequalities/equations to be good for is to be iterable exactly one time. So I would consider it to be a waste creating a tuple for that. Now I'm passing the prefered representation to `__init__`, which will discard the other one if the backend doesn't support precomputed data.\n\nAnyway, I don't know how much this is really worth it.\n\nReplying to [comment:35 mjo]:\n> So long as we're making micro-optimizations, can the inner lists be turned into tuples, too? E.g.\n> \n> {{{\n> - ieqs = tuple([0]*(dim+1) for _ in range(2*dim))\n> + ieqs = tuple(itertools.repeat(tuple(itertools.repeat(0,dim+1)),2*dim))\n> }}}\n> \n> {{{\n> - cp = tuple(itertools.product([-1,1], repeat=dim))\n> + cp = tuple(itertools.product((-1,1), repeat=dim))\n> }}}\n> \n> {{{\n> - cp = tuple(itertools.product([0,1], repeat=dim))\n> + cp = tuple(itertools.product((0,1), repeat=dim))\n> }}}\n> \n> It looks like we're looping through a lot of structures twice, too. This pattern repeats itself:\n> \n> {{{\n> new_inequalities = tuple(f.vector()*one for f in self.inequality_generator())\n> for f in new_inequalities:\n>     f[0] *= scalar\n> }}}\n> \n> The comprehension could be modified to spit out the right thing the first time through, or at the very least we could use `map()` with a lambda to apply the \"multiply the first coordinate by <scalar>\" function as the tuple is built.",
    "created_at": "2020-04-07T14:49:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403772",
    "user": "https://github.com/kliem"
}
```

Thanks. I went to generators now.

This has the advantage that `ppl` doesn't waste time creating a tuple, which it won't need later.
Also all we need the input vertices/rays/lines/inequalities/equations to be good for is to be iterable exactly one time. So I would consider it to be a waste creating a tuple for that. Now I'm passing the prefered representation to `__init__`, which will discard the other one if the backend doesn't support precomputed data.

Anyway, I don't know how much this is really worth it.

Replying to [comment:35 mjo]:
> So long as we're making micro-optimizations, can the inner lists be turned into tuples, too? E.g.
> 
> {{{
> - ieqs = tuple([0]*(dim+1) for _ in range(2*dim))
> + ieqs = tuple(itertools.repeat(tuple(itertools.repeat(0,dim+1)),2*dim))
> }}}
> 
> {{{
> - cp = tuple(itertools.product([-1,1], repeat=dim))
> + cp = tuple(itertools.product((-1,1), repeat=dim))
> }}}
> 
> {{{
> - cp = tuple(itertools.product([0,1], repeat=dim))
> + cp = tuple(itertools.product((0,1), repeat=dim))
> }}}
> 
> It looks like we're looping through a lot of structures twice, too. This pattern repeats itself:
> 
> {{{
> new_inequalities = tuple(f.vector()*one for f in self.inequality_generator())
> for f in new_inequalities:
>     f[0] *= scalar
> }}}
> 
> The comprehension could be modified to spit out the right thing the first time through, or at the very least we could use `map()` with a lambda to apply the "multiply the first coordinate by <scalar>" function as the tuple is built.



---

archive/issue_comments_403773.json:
```json
{
    "body": "It's probably only a small improvement, but anything helps. The new approach LGTM. There's one more `[-1,1]` list that can be made into a tuple,\n\n\n```\ndiff --git a/src/sage/geometry/polyhedron/library.py b/src/sage/geometry/polyhe$\nindex 82f96b2d76..03410c1ed8 100644\n--- a/src/sage/geometry/polyhedron/library.py\n+++ b/src/sage/geometry/polyhedron/library.py\n@@ -2980,7 +2980,7 @@ class Polytopes():\n         \"\"\"\n         verts = tuple((ZZ**dim).basis())\n         verts += tuple(-v for v in verts)\n-        ieqs = ((1,) + x for x in itertools.product([-1,1], repeat=dim))\n+        ieqs = ((1,) + x for x in itertools.product((-1,1), repeat=dim))\n         parent = Polyhedra(ZZ, dim, backend=backend)\n         return parent([verts, [], []], [ieqs, []], Vrep_minimal=True, Hrep_min$\n```\n\n\nbut, aside from that, this is probably a good point to commit the improvements and start anew if the doctests cause further problems.",
    "created_at": "2020-04-07T14:55:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403773",
    "user": "https://github.com/orlitzky"
}
```

It's probably only a small improvement, but anything helps. The new approach LGTM. There's one more `[-1,1]` list that can be made into a tuple,


```
diff --git a/src/sage/geometry/polyhedron/library.py b/src/sage/geometry/polyhe$
index 82f96b2d76..03410c1ed8 100644
--- a/src/sage/geometry/polyhedron/library.py
+++ b/src/sage/geometry/polyhedron/library.py
@@ -2980,7 +2980,7 @@ class Polytopes():
         """
         verts = tuple((ZZ**dim).basis())
         verts += tuple(-v for v in verts)
-        ieqs = ((1,) + x for x in itertools.product([-1,1], repeat=dim))
+        ieqs = ((1,) + x for x in itertools.product((-1,1), repeat=dim))
         parent = Polyhedra(ZZ, dim, backend=backend)
         return parent([verts, [], []], [ieqs, []], Vrep_minimal=True, Hrep_min$
```


but, aside from that, this is probably a good point to commit the improvements and start anew if the doctests cause further problems.



---

archive/issue_comments_403774.json:
```json
{
    "body": "Oh, and I guess you should add doctests for the two other possible arguments for `pref_rep`.",
    "created_at": "2020-04-07T16:01:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403774",
    "user": "https://github.com/orlitzky"
}
```

Oh, and I guess you should add doctests for the two other possible arguments for `pref_rep`.



---

archive/issue_comments_403775.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-04-07T19:14:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403775",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_403776.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-04-07T21:52:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403776",
    "user": "https://github.com/orlitzky"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_403777.json:
```json
{
    "body": "Pending a ptestlong, I'm able to run the polyhedron tests without problem. Thanks!",
    "created_at": "2020-04-07T21:52:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403777",
    "user": "https://github.com/orlitzky"
}
```

Pending a ptestlong, I'm able to run the polyhedron tests without problem. Thanks!



---

archive/issue_comments_403778.json:
```json
{
    "body": "I just checked the most recent branch and\n\n```\nsage -t --long --memlimit=3500 src/sage/geometry/polyhedron/base.py \n```\n\nnow works ok on my machine. But unfortunately, `--memlimit=3400` does not (error is raised at the `quadrangle` line again). But, I guess my computer is an exception?\n\nI would have suggested the following change which is more in the [spirit of Python3](https://www.artima.com/weblogs/viewpost.jsp?thread=98196):\n\n```diff\n-    new_vertices = map(lambda v : tuple(scalar*x for x in v._vector), self.vertex_generator())\n-    new_rays     = map(lambda r : tuple(sign*x   for x in r._vector), self.ray_generator())\n+    new_vertices = (tuple(scalar*x for x in v._vector) for v in self.vertex_generator())\n+    new_rays     = (tuple(sign*x   for x in r._vector) for r in self.ray_generator())\n```\n",
    "created_at": "2020-04-08T10:05:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403778",
    "user": "https://github.com/seblabbe"
}
```

I just checked the most recent branch and

```
sage -t --long --memlimit=3500 src/sage/geometry/polyhedron/base.py 
```

now works ok on my machine. But unfortunately, `--memlimit=3400` does not (error is raised at the `quadrangle` line again). But, I guess my computer is an exception?

I would have suggested the following change which is more in the [spirit of Python3](https://www.artima.com/weblogs/viewpost.jsp?thread=98196):

```diff
-    new_vertices = map(lambda v : tuple(scalar*x for x in v._vector), self.vertex_generator())
-    new_rays     = map(lambda r : tuple(sign*x   for x in r._vector), self.ray_generator())
+    new_vertices = (tuple(scalar*x for x in v._vector) for v in self.vertex_generator())
+    new_rays     = (tuple(sign*x   for x in r._vector) for r in self.ray_generator())
```




---

archive/issue_comments_403779.json:
```json
{
    "body": "ok :(\n\nReplying to [comment:42 slabbe]:\n> I just checked the most recent branch and\n> {{{\n> sage -t --long --memlimit=3500 src/sage/geometry/polyhedron/base.py \n> }}}\n> now works ok on my machine. But unfortunately, `--memlimit=3400` does not (error is raised at the `quadrangle` line again). But, I guess my computer is an exception?\n\nYeah, but this still shouldn't be this hard to figure out. How much RAM does your system have and is swap enabled? I'm able to go as low as 1300 on my ancient Phenom II with 6GB of RAM:\n\n\n```\n$ sage -t --long --memlimit=1300 src/sage/geometry/polyhedron/base.py \ntoo many failed tests, not using stored timings\nRunning doctests with ID 2020-04-08-10-52-30-009fba13.\nGit branch: public/28866-reb\nUsing --optional=build,dochtml,memlimit,sage\nDoctesting 1 file.\nsage -t --long src/sage/geometry/polyhedron/base.py\n    [1439 tests, 117.73 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 118.5 seconds\n    cpu time: 95.5 seconds\n    cumulative wall time: 117.7 seconds\n```\n\n\nOne difference that I suspect between you and (Jonathan and I) is the optimization flags passed to the compiler while building sage. I think we both use `-march=native` for everything, and you could be getting some SPKG built non-optimally to the point where one of these methods wastes a ton of memory. If you're up for it, you could try\n\n\n```\n$ export CFLAGS=\"-O2 -march=native\" CXXFLAGS=\"-O2 -march=native\" FCFLAGS=\"-O2 -march=native\"\n$ git clean -x -f -d\n$ ./bootstrap\n$ make build\n```\n\n\nto wipe your sage installation and rebuild everything from scratch with those optimization flags. That may improve your memory usage (and would be another reason to hope for Jonathan's `-march=native` branch to get merged), but it's admittedly a stab in the dark.\n\n\n> I would have suggested the following change...\n\nThat looks sensible if you want to add it.",
    "created_at": "2020-04-08T14:58:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403779",
    "user": "https://github.com/orlitzky"
}
```

ok :(

Replying to [comment:42 slabbe]:
> I just checked the most recent branch and
> {{{
> sage -t --long --memlimit=3500 src/sage/geometry/polyhedron/base.py 
> }}}
> now works ok on my machine. But unfortunately, `--memlimit=3400` does not (error is raised at the `quadrangle` line again). But, I guess my computer is an exception?

Yeah, but this still shouldn't be this hard to figure out. How much RAM does your system have and is swap enabled? I'm able to go as low as 1300 on my ancient Phenom II with 6GB of RAM:


```
$ sage -t --long --memlimit=1300 src/sage/geometry/polyhedron/base.py 
too many failed tests, not using stored timings
Running doctests with ID 2020-04-08-10-52-30-009fba13.
Git branch: public/28866-reb
Using --optional=build,dochtml,memlimit,sage
Doctesting 1 file.
sage -t --long src/sage/geometry/polyhedron/base.py
    [1439 tests, 117.73 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 118.5 seconds
    cpu time: 95.5 seconds
    cumulative wall time: 117.7 seconds
```


One difference that I suspect between you and (Jonathan and I) is the optimization flags passed to the compiler while building sage. I think we both use `-march=native` for everything, and you could be getting some SPKG built non-optimally to the point where one of these methods wastes a ton of memory. If you're up for it, you could try


```
$ export CFLAGS="-O2 -march=native" CXXFLAGS="-O2 -march=native" FCFLAGS="-O2 -march=native"
$ git clean -x -f -d
$ ./bootstrap
$ make build
```


to wipe your sage installation and rebuild everything from scratch with those optimization flags. That may improve your memory usage (and would be another reason to hope for Jonathan's `-march=native` branch to get merged), but it's admittedly a stab in the dark.


> I would have suggested the following change...

That looks sensible if you want to add it.



---

archive/issue_comments_403780.json:
```json
{
    "body": "There are also a lot of doctest examples in src/sage/geometry/polyhedron/base.py that could be split into separate chunks with `::` rather than grouped together, sharing a context. That may help encourage garbage collection of the objects defined in earlier examples.",
    "created_at": "2020-04-08T15:25:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403780",
    "user": "https://github.com/orlitzky"
}
```

There are also a lot of doctest examples in src/sage/geometry/polyhedron/base.py that could be split into separate chunks with `::` rather than grouped together, sharing a context. That may help encourage garbage collection of the objects defined in earlier examples.



---

archive/issue_comments_403781.json:
```json
{
    "body": "Replying to [comment:42 slabbe]:\n> I just checked the most recent branch and\n> {{{\n> sage -t --long --memlimit=3500 src/sage/geometry/polyhedron/base.py \n> }}}\n> now works ok on my machine. But unfortunately, `--memlimit=3400` does not (error is raised at the `quadrangle` line again). But, I guess my computer is an exception?\n> \n> I would have suggested the following change which is more in the [spirit of Python3](https://www.artima.com/weblogs/viewpost.jsp?thread=98196):\n> {{{\n> #!diff\n> -    new_vertices = map(lambda v : tuple(scalar*x for x in v._vector), self.vertex_generator())\n> -    new_rays     = map(lambda r : tuple(sign*x   for x in r._vector), self.ray_generator())\n> +    new_vertices = (tuple(scalar*x for x in v._vector) for v in self.vertex_generator())\n> +    new_rays     = (tuple(sign*x   for x in r._vector) for r in self.ray_generator())\n> }}}\n\nI agree, you can go ahead and push that change.",
    "created_at": "2020-04-08T15:29:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403781",
    "user": "https://github.com/kliem"
}
```

Replying to [comment:42 slabbe]:
> I just checked the most recent branch and
> {{{
> sage -t --long --memlimit=3500 src/sage/geometry/polyhedron/base.py 
> }}}
> now works ok on my machine. But unfortunately, `--memlimit=3400` does not (error is raised at the `quadrangle` line again). But, I guess my computer is an exception?
> 
> I would have suggested the following change which is more in the [spirit of Python3](https://www.artima.com/weblogs/viewpost.jsp?thread=98196):
> {{{
> #!diff
> -    new_vertices = map(lambda v : tuple(scalar*x for x in v._vector), self.vertex_generator())
> -    new_rays     = map(lambda r : tuple(sign*x   for x in r._vector), self.ray_generator())
> +    new_vertices = (tuple(scalar*x for x in v._vector) for v in self.vertex_generator())
> +    new_rays     = (tuple(sign*x   for x in r._vector) for r in self.ray_generator())
> }}}

I agree, you can go ahead and push that change.



---

archive/issue_comments_403782.json:
```json
{
    "body": "More wild speculation: this is also the only module I've seen that has doctests within a WARNING block. There is a tiny chance that a series of unfortunate events leads to those doctests not being GC'ed. But that still wouldn't explain why you're seeing different results than we are.",
    "created_at": "2020-04-08T15:29:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403782",
    "user": "https://github.com/orlitzky"
}
```

More wild speculation: this is also the only module I've seen that has doctests within a WARNING block. There is a tiny chance that a series of unfortunate events leads to those doctests not being GC'ed. But that still wouldn't explain why you're seeing different results than we are.



---

archive/issue_comments_403783.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2020-04-08T18:49:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403783",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_403784.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2020-04-08T18:49:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403784",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_403785.json:
```json
{
    "body": "> Yeah, but this still shouldn't be this hard to figure out. How much RAM does your system have and is swap enabled? \n\nI'm sorry, can you teach me how I can figure this out?\n\n> One difference that I suspect between you and (Jonathan and I) is the optimization flags passed to the compiler while building sage. I think we both use `-march=native` for everything, and you could be getting some SPKG built non-optimally to the point where one of these methods wastes a ton of memory. If you're up for it, you could try\n\nOk, I will test that.",
    "created_at": "2020-04-08T18:53:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403785",
    "user": "https://github.com/seblabbe"
}
```

> Yeah, but this still shouldn't be this hard to figure out. How much RAM does your system have and is swap enabled? 

I'm sorry, can you teach me how I can figure this out?

> One difference that I suspect between you and (Jonathan and I) is the optimization flags passed to the compiler while building sage. I think we both use `-march=native` for everything, and you could be getting some SPKG built non-optimally to the point where one of these methods wastes a ton of memory. If you're up for it, you could try

Ok, I will test that.



---

archive/issue_comments_403786.json:
```json
{
    "body": "Replying to [comment:48 slabbe]:\n> \n> I'm sorry, can you teach me how I can figure this out?\n> \n\nThere's probably nothing unusual here, but:\n\n\n```\n$ cat /proc/meminfo\n```\n\n\nshould show the relevant stuff on linux. On mac or windows I would have to resort to google.",
    "created_at": "2020-04-08T20:00:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403786",
    "user": "https://github.com/orlitzky"
}
```

Replying to [comment:48 slabbe]:
> 
> I'm sorry, can you teach me how I can figure this out?
> 

There's probably nothing unusual here, but:


```
$ cat /proc/meminfo
```


should show the relevant stuff on linux. On mac or windows I would have to resort to google.



---

archive/issue_comments_403787.json:
```json
{
    "body": "> {{{\n> $ cat /proc/meminfo\n> }}}\n> \n> should show the relevant stuff on linux. On mac or windows I would have to resort to google.\n\nThis is the output on the machine having trouble:\n\n\n```\n$ cat /proc/meminfo\nMemTotal:       16356316 kB\nMemFree:         3011884 kB\nMemAvailable:   14369868 kB\nBuffers:         1356356 kB\nCached:          7550684 kB\nSwapCached:         1856 kB\nActive:          4893152 kB\nInactive:        5302360 kB\nActive(anon):     398700 kB\nInactive(anon):   971972 kB\nActive(file):    4494452 kB\nInactive(file):  4330388 kB\nUnevictable:          48 kB\nMlocked:              48 kB\nSwapTotal:       2928636 kB\nSwapFree:        2868372 kB\n[...]\n```\n",
    "created_at": "2020-04-10T07:43:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403787",
    "user": "https://github.com/seblabbe"
}
```

> {{{
> $ cat /proc/meminfo
> }}}
> 
> should show the relevant stuff on linux. On mac or windows I would have to resort to google.

This is the output on the machine having trouble:


```
$ cat /proc/meminfo
MemTotal:       16356316 kB
MemFree:         3011884 kB
MemAvailable:   14369868 kB
Buffers:         1356356 kB
Cached:          7550684 kB
SwapCached:         1856 kB
Active:          4893152 kB
Inactive:        5302360 kB
Active(anon):     398700 kB
Inactive(anon):   971972 kB
Active(file):    4494452 kB
Inactive(file):  4330388 kB
Unevictable:          48 kB
Mlocked:              48 kB
SwapTotal:       2928636 kB
SwapFree:        2868372 kB
[...]
```




---

archive/issue_comments_403788.json:
```json
{
    "body": "(Note that when I pushed the branch on the ticket, it automatically set the ticket to needs_review again (it seems to be a new feature), so I let you review my commit)",
    "created_at": "2020-04-10T07:44:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403788",
    "user": "https://github.com/seblabbe"
}
```

(Note that when I pushed the branch on the ticket, it automatically set the ticket to needs_review again (it seems to be a new feature), so I let you review my commit)



---

archive/issue_comments_403789.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-04-10T07:49:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403789",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_403790.json:
```json
{
    "body": "Replying to [comment:50 slabbe]:\n> \n> This is the output on the machine having trouble:\n> \n\nNothing unusual.\n\nAnother thing I thought of: if recompiling everything with `-march=native -O2` doesn't help... maybe there's some system package being used that was built without optimizations...\n\n\n```\n$ grep 'will use system' config.log\n```\n\n\nshould show which which system packages are being used.",
    "created_at": "2020-04-10T12:26:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403790",
    "user": "https://github.com/orlitzky"
}
```

Replying to [comment:50 slabbe]:
> 
> This is the output on the machine having trouble:
> 

Nothing unusual.

Another thing I thought of: if recompiling everything with `-march=native -O2` doesn't help... maybe there's some system package being used that was built without optimizations...


```
$ grep 'will use system' config.log
```


should show which which system packages are being used.



---

archive/issue_comments_403791.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2020-04-16T18:34:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403791",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_403792.json:
```json
{
    "body": "On Python 2:\n\n```\nFile \"src/sage/geometry/polyhedron/base.py\", line 160, in sage.geometry.polyhedron.base.Polyhedron_base.__init__\nFailed example:\n    p = Polyhedron_field(parent, Vrep, 'nonsense',\n                         Vrep_minimal=True, Hrep_minimal=True, pref_rep='Vrep')\nExpected:\n    Traceback (most recent call last):\n    ...\n    TypeError: _init_Hrepresentation() takes 3 positional arguments but 9 were given\nGot:\n    <BLANKLINE>\n    Traceback (most recent call last):\n      File \"/var/lib/buildbot/slave/sage2_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/var/lib/buildbot/slave/sage2_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.geometry.polyhedron.base.Polyhedron_base.__init__[13]>\", line 2, in <module>\n        Vrep_minimal=True, Hrep_minimal=True, pref_rep='Vrep')\n      File \"/var/lib/buildbot/slave/sage2_git/build/local/lib/python2.7/site-packages/sage/geometry/polyhedron/base.py\", line 172, in __init__\n        self._init_from_Vrepresentation_and_Hrepresentation(Vrep, Hrep)\n      File \"/var/lib/buildbot/slave/sage2_git/build/local/lib/python2.7/site-packages/sage/geometry/polyhedron/backend_field.py\", line 163, in _init_from_Vrepresentation_and_Hrepresentation\n        self._init_Hrepresentation(*Hrep)\n    TypeError: _init_Hrepresentation() takes exactly 3 arguments (9 given)\n**********************************************************************\n1 item had failures:\n   1 of  15 in sage.geometry.polyhedron.base.Polyhedron_base.__init__\n    [1443 tests, 1 failure, 37.42 s]\n----------------------------------------------------------------------\nsage -t --long src/sage/geometry/polyhedron/base.py  # 1 doctest failed\n----------------------------------------------------------------------\n```\n",
    "created_at": "2020-04-16T18:34:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403792",
    "user": "https://github.com/vbraun"
}
```

On Python 2:

```
File "src/sage/geometry/polyhedron/base.py", line 160, in sage.geometry.polyhedron.base.Polyhedron_base.__init__
Failed example:
    p = Polyhedron_field(parent, Vrep, 'nonsense',
                         Vrep_minimal=True, Hrep_minimal=True, pref_rep='Vrep')
Expected:
    Traceback (most recent call last):
    ...
    TypeError: _init_Hrepresentation() takes 3 positional arguments but 9 were given
Got:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/var/lib/buildbot/slave/sage2_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/var/lib/buildbot/slave/sage2_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.geometry.polyhedron.base.Polyhedron_base.__init__[13]>", line 2, in <module>
        Vrep_minimal=True, Hrep_minimal=True, pref_rep='Vrep')
      File "/var/lib/buildbot/slave/sage2_git/build/local/lib/python2.7/site-packages/sage/geometry/polyhedron/base.py", line 172, in __init__
        self._init_from_Vrepresentation_and_Hrepresentation(Vrep, Hrep)
      File "/var/lib/buildbot/slave/sage2_git/build/local/lib/python2.7/site-packages/sage/geometry/polyhedron/backend_field.py", line 163, in _init_from_Vrepresentation_and_Hrepresentation
        self._init_Hrepresentation(*Hrep)
    TypeError: _init_Hrepresentation() takes exactly 3 arguments (9 given)
**********************************************************************
1 item had failures:
   1 of  15 in sage.geometry.polyhedron.base.Polyhedron_base.__init__
    [1443 tests, 1 failure, 37.42 s]
----------------------------------------------------------------------
sage -t --long src/sage/geometry/polyhedron/base.py  # 1 doctest failed
----------------------------------------------------------------------
```




---

archive/issue_comments_403793.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-04-16T20:11:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403793",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_403794.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-04-16T20:11:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403794",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_403795.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-04-18T16:45:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403795",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_403796.json:
```json
{
    "body": "Looks good to me",
    "created_at": "2020-04-18T16:45:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403796",
    "user": "https://github.com/mkoeppe"
}
```

Looks good to me



---

archive/issue_comments_403797.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-04-22T20:52:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403797",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_073004.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-04-22T20:52:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28629#event-73004"
}
```



---

archive/issue_comments_403798.json:
```json
{
    "body": "I introduced a bug in this ticket: The double description for intervals is completely wrong.\n\nPlease review #29904.",
    "created_at": "2020-06-19T20:38:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28629",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28629#issuecomment-403798",
    "user": "https://github.com/kliem"
}
```

I introduced a bug in this ticket: The double description for intervals is completely wrong.

Please review #29904.
