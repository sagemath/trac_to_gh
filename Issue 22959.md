# Issue 22959: Some doctests in interpreters/storage.py are not run

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2017-06-09 10:12:39

CC:  embray

There seems to be something wrong with the doctest parser: the doctest of `alloc_chunk_data()` in `src/sage_setup/autogen/interpreters/storage.py` is not run:

```
$ ./sage -t --verbose src/sage_setup/autogen/interpreters/storage.py
Trying (line 287):    from sage_setup.autogen.interpreters import *
Expecting nothing
ok [0.00 s]
Trying (line 288):    ty_mpfr.declare_chunk_class_members('args')
Expecting:
    u'    cdef int _n_args\n    cdef mpfr_t* _args\n'
ok [0.00 s]
Trying (line 290):    sig_on_count() # check sig_on/off pairings (virtual doctest)
Expecting:
    0
ok [0.00 s]
Trying (line 369):    from sage_setup.autogen.interpreters import *
Expecting nothing
ok [0.00 s]
Trying (line 370):    ty_double.class_member_declarations
Expecting:
    ''
ok [0.00 s]
```



---

Comment by embray created at 2017-06-09 11:53:05

It seems the one after it, `dealloc_chunk_data`, is also not run.  Weird.  I have no idea.


---

Comment by embray created at 2017-06-09 12:05:24

Just found that myself.
----
New commits:


---

Comment by jdemeyer created at 2017-06-09 12:09:25

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2017-06-09 12:09:25

I'm currently running all doctests with and without this patch to see if any other doctests are affected and check for regressions. This will take a while...


---

Comment by embray created at 2017-06-09 12:15:40

I'm doing the same.  How did you even notice that?


---

Comment by jdemeyer created at 2017-06-10 07:36:15

Regression in `src/sage/combinat/partition_algebra.py`:

Before:

```
sage -t src/sage/combinat/partition_algebra.py
    [302 tests, 10.18 s]
```


After:

```
sage -t src/sage/combinat/partition_algebra.py
    [241 tests, 9.45 s]
```



---

Comment by jdemeyer created at 2017-06-10 07:36:15

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2017-06-10 08:05:03

See #23206.


---

Comment by vbraun created at 2017-06-11 09:18:34

Doesn't cause any wrong answers from Sage, so I wouldn't call this a blocker.


---

Comment by vbraun created at 2017-06-11 09:18:34

Changing priority from blocker to major.


---

Comment by jdemeyer created at 2017-06-12 10:19:30

For the record: I made it a blocker because it's a recent regression. There could also be undetected issues if some doctests are not being run.


---

Comment by jdemeyer created at 2017-06-12 15:19:57

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2017-06-12 15:19:57

I just finished the tests that I mentioned in [comment:4]. The changes are:

1. `src/sage/combinat/partition_algebra.py`: 302 tests -> 241 tests. Fixed in #23206.

2. Various files in `src/sage_setup/autogen/interpreters`: in all cases, the number of tests increased.


---

Comment by embray created at 2017-06-14 09:05:30

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-06-15 23:10:01

Resolution: fixed
