# Issue 32403: series method gives wrong result on (1-x)^-x

Issue created by migration from https://trac.sagemath.org/ticket/32640

Original creator: @akc

Original creation time: 2021-10-05 22:09:44

CC:  @davewittemorris slelievre

We have

```
f = (1-x)^-x
print(f.taylor(x,0,5))
print(f.series(x,5))

3/4*x^5 + 5/6*x^4 + 1/2*x^3 + x^2 + 1
1*x^(-1) + 1 + 1*x + 1*x^2 + 1*x^3 + 1*x^4 + Order(x^5)
```

where the taylor method gives the expected result, but series does not.


---

Comment by @DaveWitteMorris created at 2021-10-06 06:08:25

Thanks for the bug report.

The bug is in pynac's `power::useries` method. A power series is stored as a polynomial, together with an offset that represents multiplying by a certain power of `x`. Essentially, the method ignores the exponent's offset during most of the calculation, and then applies an offset to the final result. That is mathematically incorrect, so the method can return wrong answers when the exponent's offset is nonzero.

In particular, the exponent `-x` is stored as `-1`, with an offset of `1`, which explains why sage gives the wrong answer for the example in the ticket description. Specifically, sage's answer is `x^-1 * (1-x)^-1`.

I should be able to upload a patch to fix this soon.


---

Comment by @DaveWitteMorris created at 2021-10-07 03:01:03

To fix the problem, we `normalize` the power series before exponentiating. This multiplies by the appropriate power of `x` and sets the `offset` to `0`.
----
New commits:


---

Comment by @DaveWitteMorris created at 2021-10-07 03:01:03

Changing status from new to needs_review.


---

Comment by mmezzarobba created at 2021-12-15 10:22:01

Changing status from needs_review to positive_review.


---

Comment by @DaveWitteMorris created at 2021-12-15 17:44:27

Thanks!


---

Comment by vbraun created at 2021-12-23 20:26:07

Resolution: fixed
