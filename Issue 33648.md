# Issue 33648: Reference undefined - pdf documentation

Issue created by migration from https://trac.sagemath.org/ticket/33885

Original creator: strogdon

Original creation time: 2022-05-23 01:05:17

CC:  klee

For `9.7.beta0` when building the pdf documentation I have

```
Latexmk: List of undefined refs and citations:
  Reference `index:module-sage.combinat` on page 3675 undefined on input line 351794
```

And in `local/share/doc/sage/pdf/en/reference/combinat/combinat.pdf` on page 3675 (the **PYTHON MODULE INDEX** there is


```
c
sage.combinat, ??
```



---

Comment by strogdon created at 2022-05-23 01:14:58

Some additional info:

In `local/share/doc/sage/html/en/reference/py-modindex.html`, `sage.combinat` is a link that points back to the main `Combinatorics` webpage. 

In `local/share/doc/sage/latex/en/reference/combinat/combinat.idx` the first two lines are

```
\indexentry{module@\spxentry{module}!sage.combinat@\spxentry{sage.combinat}|hyperpage}{1}
\indexentry{sage.combinat@\spxentry{sage.combinat}!module@\spxentry{module}|hyperpage}{1}
```

which seems to be a correct location but that location did not make it into `local/share/doc/sage/pdf/en/reference/combinat/combinat.pdf`.


---

Comment by strogdon created at 2022-05-25 18:21:42

To resolve this I believe that perhaps something needs to be changed in `src/sage/combinat/all.py`. But I don't know enough about `sphinx` to correct things.


---

Comment by strogdon created at 2022-05-28 19:53:49

Making these changes removes the `undefined ref`


```diff
diff --git a/src/doc/en/reference/combinat/index.rst b/src/doc/en/reference/combinat/index.rst
index 4470e97836..7530898ccf 100644
--- a/src/doc/en/reference/combinat/index.rst
+++ b/src/doc/en/reference/combinat/index.rst
@@ -1,7 +1,10 @@
 Combinatorics
 =============
 
-.. automodule:: sage.combinat
+.. toctree::
+   :maxdepth: 1
+
+   sage/combinat
 
 Comprehensive Module List
 -------------------------
```


From `local/share/doc/sage/pdf/en/reference/combinat/combinat.pdf` in the **PYTHON MODULE INDEX**, which starts on page 3669 there is now


```
c
sage.combinat, 1
```


What is the downside of not using `automodule::`? Both `automodule::` and `toctree::` don't seem to be able to coexist.


---

Comment by klee created at 2022-05-29 08:21:59

This seems do the work without altering contents:

```diff
diff --git a/src/doc/en/reference/combinat/index.rst b/src/doc/en/reference/combinat/index.rst
index 4470e97836..de3e0bebfc 100644
--- a/src/doc/en/reference/combinat/index.rst
+++ b/src/doc/en/reference/combinat/index.rst
@@ -1,7 +1,8 @@
 Combinatorics
 =============

-.. automodule:: sage.combinat
+.. automodule:: sage.combinat.all
+   :noindex:
 
 Comprehensive Module List
 -------------------------
```

I do not fully understand how things are done in Sphinx either, but it seems `.. automodule:: sage.combinat` causes the original issue since `sage.combinat` is not a module but a package.


---

Comment by strogdon created at 2022-05-29 16:37:52

So this makes `sage.combinat` appear in `py-modindex.html` as; for example, `sage.coding` for which there is no link. I tried to make `sage.combinat` behave as either `sage.categories` or `sage.features`. I'm good with any approach that resolves the undefined ref. Your suggestion does do this. Push a branch and I'll review it.


---

Comment by git created at 2022-05-30 07:13:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by klee created at 2022-05-30 07:13:58

Changing status from new to needs_review.


---

Comment by strogdon created at 2022-05-30 16:11:54

Changing status from needs_review to positive_review.


---

Comment by strogdon created at 2022-05-30 16:11:54

Looks good.


---

Comment by vbraun created at 2022-06-12 12:17:05

Resolution: fixed
