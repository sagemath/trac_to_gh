# Issue 24177: py3: sage.libs.singular fixes

Issue created by migration from https://trac.sagemath.org/ticket/24414

Original creator: embray

Original creation time: 2017-12-21 11:22:25

With these fixes, plus a few unrelated fixes in other modules (to be submitted separately) I was able to get all of the tests in `sage.libs.singular` to pass on Python 3.


---

Comment by embray created at 2017-12-21 11:22:36

Changing keywords from "" to "singular".


---

Comment by embray created at 2017-12-21 11:22:36

Changing status from new to needs_review.


---

Comment by chapoton created at 2018-02-09 15:48:19

Changing status from needs_review to needs_work.


---

Comment by chapoton created at 2018-02-09 15:48:19

does not apply


---

Comment by git created at 2018-02-12 10:37:35

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2018-02-12 10:38:49

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by embray created at 2018-02-12 10:39:28

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2018-02-12 11:30:50

In `src/sage/libs/singular/ring.pyx`, I'm not convinced by the changes to `__cmp__`. Can we please factor that out to a separate ticket?


---

Comment by jdemeyer created at 2018-02-12 11:31:30

Changing status from needs_review to needs_work.


---

Comment by embray created at 2018-02-12 11:50:49

Replying to [comment:6 jdemeyer]:
> In `src/sage/libs/singular/ring.pyx`, I'm not convinced by the changes to `__cmp__`.

I'm not either, now that you call it out.  I think this might have just been a placeholder for the correct implementation, but it definitely doesn't look correct as is.

> Can we please factor that out to a separate ticket?

I'd rather not. It's still only going to be a small change.  It does need more tests though.


---

Comment by embray created at 2018-02-12 11:54:31

I think instead of `__richcmp__` (or `__cmp__` for that matter) all this needs is an `__eq__`.


---

Comment by jdemeyer created at 2018-02-12 12:00:11

Replying to [comment:9 embray]:
> It's still only going to be a small change.

"small" in which metric? Number of lines of code? Changing `__cmp__` to `__richcmp__` is a non-trivial change.


---

Comment by embray created at 2018-02-12 12:02:50

Not in this case it isn't.


---

Comment by git created at 2018-02-12 13:44:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by embray created at 2018-02-12 14:28:55

Changing status from needs_work to needs_review.


---

Comment by embray created at 2018-02-12 14:28:55

For some more complicated class I might agree that it should have a ticket focused on getting its `__cmp__` -> `__richcmp__` conversion right.  But in this case it's just a little internal class used to wrap a pointer to a Singular `ring` structure so that it can be used as a dict key.

It really only needs `__eq__` defined for this purpose and it's pretty trivial IMO.


---

Comment by chapoton created at 2018-02-14 08:47:49

green bot


---

Comment by jdemeyer created at 2018-02-14 09:26:09

OK, you convinced me about `__richcmp__`. I'm preparing a small reviewer commit...


---

Comment by git created at 2018-02-14 09:57:08

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2018-02-14 09:57:34

Please review.


---

Comment by embray created at 2018-02-14 15:42:18

Ah,

```
return (self._ring == r._ring) == (op == Py_EQ)
```

I originally had _almost_ this but with an `and` instead of an `==` but when I realized that was wrong I somehow overlooked this solution.

Some of the other changes are weird because I already had them in my local Python 3 branch.  Maybe I made them after I first opened this ticket.


---

Comment by embray created at 2018-02-14 15:42:18

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-02-16 23:38:53

Resolution: fixed
