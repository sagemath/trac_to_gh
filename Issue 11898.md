# Issue 11898: Unavoidable DeprecationWarnings when calling piecewise functions

archive/issues_011898.json:
```json
{
    "body": "Assignee: @burcin\n\nCC:  @kcrisman\n\nWhen using piecewise functions across modules, you can find yourself unable to avoid the DeprecationWarning resulting from positional arguments, e.g. f(0).\n\nA small example:\n\nsome_library.py\n\n```\nfrom sage.all import *\n\ndef make_f():\n    x = SR.symbol('x', domain='real')\n    f = piecewise([[(-1,1), x**2]])\n    return f\n```\n\n\nsome_script.py\n\n```\nfrom some_library import *\n\nmy_f = make_f()\nmy_f(0)\n```\n\n\nThere is no obvious (or un-obvious, as far as I know) way to avoid the warning here.\n\nThe output, for reference:\n\n\n```\n$ sage some_script.py \nsome_script.py:4: DeprecationWarning: Substitution using function-call syntax and unnamed arguments is deprecated and will be removed from a future release of Sage; you can use named arguments instead, like EXPR(x=..., y=...)\n  my_f(0)\n```\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/12070\n\n",
    "created_at": "2011-11-22T03:19:23Z",
    "labels": [
        "component: symbolics",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Unavoidable DeprecationWarnings when calling piecewise functions",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11898",
    "user": "https://github.com/orlitzky"
}
```
Assignee: @burcin

CC:  @kcrisman

When using piecewise functions across modules, you can find yourself unable to avoid the DeprecationWarning resulting from positional arguments, e.g. f(0).

A small example:

some_library.py

```
from sage.all import *

def make_f():
    x = SR.symbol('x', domain='real')
    f = piecewise([[(-1,1), x**2]])
    return f
```


some_script.py

```
from some_library import *

my_f = make_f()
my_f(0)
```


There is no obvious (or un-obvious, as far as I know) way to avoid the warning here.

The output, for reference:


```
$ sage some_script.py 
some_script.py:4: DeprecationWarning: Substitution using function-call syntax and unnamed arguments is deprecated and will be removed from a future release of Sage; you can use named arguments instead, like EXPR(x=..., y=...)
  my_f(0)
```



Issue created by migration from https://trac.sagemath.org/ticket/12070





---

archive/issue_comments_136124.json:
```json
{
    "body": "This produces the same output in the Sage console (directly after starting it) so I doubt it has anything to do with modules or `.py` / `.sage` files in particular.\n\nIndeed something is screwed up here, though.",
    "created_at": "2011-11-22T04:08:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11898#issuecomment-136124",
    "user": "https://github.com/kini"
}
```

This produces the same output in the Sage console (directly after starting it) so I doubt it has anything to do with modules or `.py` / `.sage` files in particular.

Indeed something is screwed up here, though.



---

archive/issue_comments_136125.json:
```json
{
    "body": "Well, in a sage prompt there's an easy workaround: write f(x) = piecewise(...) instead of just f = ...\n\nThat doesn't work outside of a prompt, though, and the preprocessor breaks some imports if you try to rename the *.py files to *.sage.",
    "created_at": "2011-11-22T04:57:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11898#issuecomment-136125",
    "user": "https://github.com/orlitzky"
}
```

Well, in a sage prompt there's an easy workaround: write f(x) = piecewise(...) instead of just f = ...

That doesn't work outside of a prompt, though, and the preprocessor breaks some imports if you try to rename the *.py files to *.sage.



---

archive/issue_comments_136126.json:
```json
{
    "body": "Actually that doesn't work - I get a `TypeError` with no message, which is pretty strange. I also saw this same `TypeError` when trying to coerce a `PiecewisePolynomial` into `SR` (the Symbolic Ring) so that I could write `.function(x)` inside your definition of `make_f`, which I originally thought should be the correct way to do this.",
    "created_at": "2011-11-22T05:19:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11898#issuecomment-136126",
    "user": "https://github.com/kini"
}
```

Actually that doesn't work - I get a `TypeError` with no message, which is pretty strange. I also saw this same `TypeError` when trying to coerce a `PiecewisePolynomial` into `SR` (the Symbolic Ring) so that I could write `.function(x)` inside your definition of `make_f`, which I originally thought should be the correct way to do this.



---

archive/issue_comments_136127.json:
```json
{
    "body": "Oh, sorry. This is how to make it work in the prompt:\n\n\n```\nsage: f1(x) = 2*x\nsage: f = piecewise([[(-1,1), f1]])\n```\n\n\nI was planning an \"easy\" patch for this too, but it turns out to be harder than it looks. You can supply a variable to piecewise() to fix my simple example, but that causes other problems by turning everything into a callable expression.",
    "created_at": "2011-11-22T05:32:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11898#issuecomment-136127",
    "user": "https://github.com/orlitzky"
}
```

Oh, sorry. This is how to make it work in the prompt:


```
sage: f1(x) = 2*x
sage: f = piecewise([[(-1,1), f1]])
```


I was planning an "easy" patch for this too, but it turns out to be harder than it looks. You can supply a variable to piecewise() to fix my simple example, but that causes other problems by turning everything into a callable expression.



---

archive/issue_comments_136128.json:
```json
{
    "body": "The example in this ticket is just misuse. `piecewise` takes functions, not expressions. Oneliner solution is\n\n```\nf = piecewise([[(-1,1), (x**2).function(x)]])\n```\n\nIt's essential to be explicit about the variable name. See:\n\n```\nvar('foo,bar')\nf = piecewise([[(-1,1), (foo+bar).function(foo)]])\n```\n\nClose as invalid or resolve by updating documentation?",
    "created_at": "2016-03-01T16:41:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11898#issuecomment-136128",
    "user": "https://github.com/nbruin"
}
```

The example in this ticket is just misuse. `piecewise` takes functions, not expressions. Oneliner solution is

```
f = piecewise([[(-1,1), (x**2).function(x)]])
```

It's essential to be explicit about the variable name. See:

```
var('foo,bar')
f = piecewise([[(-1,1), (foo+bar).function(foo)]])
```

Close as invalid or resolve by updating documentation?



---

archive/issue_comments_136129.json:
```json
{
    "body": "I vote to update the documentation. Maybe we also need a thematic tutorial\nabout piecewise-defined functions. Questions about them are quite frequent\nin the various help channels.",
    "created_at": "2016-03-01T17:18:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11898#issuecomment-136129",
    "user": "https://github.com/slel"
}
```

I vote to update the documentation. Maybe we also need a thematic tutorial
about piecewise-defined functions. Questions about them are quite frequent
in the various help channels.



---

archive/issue_comments_136130.json:
```json
{
    "body": "Or to use Volker's new piecewise functions, #14801.  But there are some things that no longer work with those, I guess (the oooold stuff about fourier or whatever) and there are some other roadblocks.  But probably in the long run that might be better unless we can somehow integrate piecewise.mac in Maxima, but I'm not even sure those are well-debugged.",
    "created_at": "2016-03-01T17:21:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11898#issuecomment-136130",
    "user": "https://github.com/kcrisman"
}
```

Or to use Volker's new piecewise functions, #14801.  But there are some things that no longer work with those, I guess (the oooold stuff about fourier or whatever) and there are some other roadblocks.  But probably in the long run that might be better unless we can somehow integrate piecewise.mac in Maxima, but I'm not even sure those are well-debugged.



---

archive/issue_comments_136131.json:
```json
{
    "body": "Replying to [comment:10 nbruin]:\n> The example in this ticket is just misuse. `piecewise` takes functions, not expressions.\n\nOk, but the existing doctests and examples (mis)use that same format (I never knew I could/should change an expression into a function). The ones that don't, rely on the preparsing of `f(x) = ...` that isn't helpful to people using `piecewise()` in python code. What do we do with `f(x) = 1`, change it to `f = SR(1).function(x)`?\n\nI think `f = SR(1).function(x)` is stupid, but having examples that only work when preparsed isn't great either. How about we just fix this for symbolic expressions of one variable?\n\n\n```\nif is_Expression(f):\n    if len(f.variables()) == 1:\n        f = f.function(f.variables()[0]) # We know what you meant bro.\n    else:\n        raise Whatever()\n```\n\n\nIf there's a good reason not to do that, then the examples illustrating e.g. `(x**2).function(x)` should at least be prominent.",
    "created_at": "2016-03-01T20:26:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11898#issuecomment-136131",
    "user": "https://github.com/orlitzky"
}
```

Replying to [comment:10 nbruin]:
> The example in this ticket is just misuse. `piecewise` takes functions, not expressions.

Ok, but the existing doctests and examples (mis)use that same format (I never knew I could/should change an expression into a function). The ones that don't, rely on the preparsing of `f(x) = ...` that isn't helpful to people using `piecewise()` in python code. What do we do with `f(x) = 1`, change it to `f = SR(1).function(x)`?

I think `f = SR(1).function(x)` is stupid, but having examples that only work when preparsed isn't great either. How about we just fix this for symbolic expressions of one variable?


```
if is_Expression(f):
    if len(f.variables()) == 1:
        f = f.function(f.variables()[0]) # We know what you meant bro.
    else:
        raise Whatever()
```


If there's a good reason not to do that, then the examples illustrating e.g. `(x**2).function(x)` should at least be prominent.



---

archive/issue_comments_136132.json:
```json
{
    "body": "About `f(x) = 1` vs `f = SR(1).function(x)`, maybe we could\nintroduce `constant_function` and use `f = constant_function(1)`.",
    "created_at": "2016-03-02T07:23:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11898#issuecomment-136132",
    "user": "https://github.com/slel"
}
```

About `f(x) = 1` vs `f = SR(1).function(x)`, maybe we could
introduce `constant_function` and use `f = constant_function(1)`.



---

archive/issue_comments_136133.json:
```json
{
    "body": "This got fixed somewhere along the way:\n\n\n```\nsage: f = piecewise([[(-1,1), SR(1)]])\nsage: f(0)\n1\n```\n",
    "created_at": "2022-01-08T15:02:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11898#issuecomment-136133",
    "user": "https://github.com/orlitzky"
}
```

This got fixed somewhere along the way:


```
sage: f = piecewise([[(-1,1), SR(1)]])
sage: f(0)
1
```




---

archive/issue_comments_136134.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-01-08T15:03:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11898#issuecomment-136134",
    "user": "https://github.com/orlitzky"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_136135.json:
```json
{
    "body": "Tried it in Sage 9.5.beta9, seems indeed fixed.",
    "created_at": "2022-01-08T20:32:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11898#issuecomment-136135",
    "user": "https://github.com/slel"
}
```

Tried it in Sage 9.5.beta9, seems indeed fixed.



---

archive/issue_comments_136136.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-01-08T20:32:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11898#issuecomment-136136",
    "user": "https://github.com/slel"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_136137.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2022-01-08T21:27:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11898#issuecomment-136137",
    "user": "https://github.com/mkoeppe"
}
```

Resolution: invalid
