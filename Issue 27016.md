# Issue 27016: networkx fails to build with SAGE_CHECK="yes"

Issue created by migration from https://trac.sagemath.org/ticket/27253

Original creator: Konrad127123

Original creation time: 2019-02-10 21:41:40

Keywords: networkx, nose, build

After #26326, `networkx` fails to build with `SAGE_CHECK="yes"` unless the optional package `nose` is installed.


```
[networkx-2.2] Running the test suite for networkx-2.2...
[networkx-2.2] Testing networkx requires the package nose to be installed
[networkx-2.2]
[networkx-2.2] real     0m0.004s
[networkx-2.2] user     0m0.004s
[networkx-2.2] sys      0m0.001s
[networkx-2.2] ************************************************************************
[networkx-2.2] Error testing package networkx-2.2
[networkx-2.2] ************************************************************************
```



---

Comment by Konrad127123 created at 2019-02-10 22:02:08

Changing status from new to needs_review.


---

Comment by Konrad127123 created at 2019-02-10 22:02:08

Suggested fix: add `nose` as a runtime dependency of `networkx`. This means `nose` needs to be a standard package.
----
New commits:


---

Comment by dimpase created at 2019-02-10 23:38:37

Can you dig up the info on `nose`'s license. Cause it needs to be GPL-compatible to be standard.


---

Comment by dimpase created at 2019-02-11 00:32:39

OK, it's fine. See https://github.com/nose-devs/nose/blob/master/lgpl.txt
Could you please update the nose's SPKG.txt file with this info?


---

Comment by Konrad127123 created at 2019-02-11 10:29:53

nose's SPKG.txt already contains

```
## License

GNU LGPL
```



---

Comment by dimpase created at 2019-02-11 10:31:54

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2019-02-11 10:31:54

OK, sorry, I was obviously blind :-)


---

Comment by vbraun created at 2019-02-14 19:45:29

Resolution: fixed


---

Comment by vbraun created at 2019-02-18 18:50:11

Guys, test harnesses are not automatically standard packages. Instead the spkg-check script should just abort if nose is not found.


---

Comment by jhpalmieri created at 2019-02-19 06:02:51

So is `nose` going to be standard (bypassing the required discussion and vote) or is this change going to be reverted?


---

Comment by dimpase created at 2019-02-19 06:09:27

I think this falls under a situation of a new requirement by a standard package.
We have been adding various Python deps like this quite easily...


---

Comment by jhpalmieri created at 2019-02-19 16:25:09

I view Volker's comment as disagreeing with you. Could you respond to that, please?


---

Comment by dimpase created at 2019-02-19 16:49:44

Building a standard package with SAGE_CHECK=yes must work. If anyone can offer a different solution to this, without making `nose` standard, fine...

But please do not offer removing checks just cause you do not want to promote `nose`...


---

Comment by jhpalmieri created at 2019-02-19 18:14:08

Replying to [comment:12 dimpase]:
> Building a standard package with SAGE_CHECK=yes must work. If anyone can offer a different solution to this, without making `nose` standard, fine...

Volker did that.
 
> But please do not offer removing checks just cause you do not want to promote `nose`...

But you don't like his solution, so you're discarding it. 

The use of `nose` was added at #26326, and that ticket description says quite clearly, "Note that self tests require `nose` which is optional only." So it's not like this situation is a surprise or was unintended when the self-tests were implemented. I would deduce that the intention was: if `nose` is present, use it, otherwise skip the self tests. Or maybe the intention was: most people don't run the self tests, and those that do can install `nose`. In any case, I don't agree that #26326 forces everyone to install `nose`.


---

Comment by dimpase created at 2019-02-19 18:24:17

A Dieselgate-style "solution" is not a solution. This is already merged, and let us not start track ticket wars caused by a 300K addition to Sage tarballs.


---

Comment by embray created at 2019-03-20 11:26:11

ISTM running the tests for networkx also requires scipy, so perhaps scipy should be a prerequisite dependency.


---

Comment by dimpase created at 2019-03-20 11:50:06

Replying to [comment:15 embray]:
> ISTM running the tests for networkx also requires scipy, so perhaps scipy should be a prerequisite dependency.

yes, this is a good catch. Should we do a quick gitlab fix?


---

Comment by embray created at 2019-03-20 11:53:56

Followup in #27515
