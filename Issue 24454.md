# Issue 24454: libgap group homomorphism abstract base class

Issue created by migration from https://trac.sagemath.org/ticket/24691

Original creator: sbrandhorst

Original creation time: 2018-02-08 20:08:11

CC:  tscrim vbraun mathzeta2

GAP provides functionality for group homomorphisms.
If we have two libgap groups, then we can use GAP to define and work with homomorphisms.



---

Comment by git created at 2018-02-19 06:08:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-02-19 19:00:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-03-05 18:37:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-03-06 10:30:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by sbrandhorst created at 2018-03-06 10:38:20

todo:

- documentation
- tests with different kinds of groups
- a followup ticket to clean up the `matrix_gps.morphism` and use this class instead.


---

Comment by git created at 2018-05-24 07:17:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-05-24 11:32:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by sbrandhorst created at 2018-05-24 11:34:01

Changing status from new to needs_review.


---

Comment by git created at 2018-05-25 06:45:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-05-25 06:57:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2018-05-25 07:48:57

I changed/fixed a few things:

- Made the homset a subclass of `UniqueRepresentation` (this is the more standard practice).
- Made the homset use `element_class` to construct elements; this fixes the `TestSuite` (I was previously thinking it was the morphism itself that was failing, not how the morphism was constructed).
- Doc fixes.
- Fixed the `_latex_` of the abelian GAP group so now `view(G)` works.

If my changes look good, then positive review.
----
New commits:


---

Comment by sbrandhorst created at 2018-05-25 08:24:31

Looks good except for one point:
`GroupHomomorphismByImages` allways checks whether the generators define a group homomorphism.
We have to use `GroupHomomorphismByImagesNC` if we do not want to check this (as it can be expensive).


---

Comment by tscrim created at 2018-05-25 08:26:41

I was getting errors that it was unable to find such a function:

```
Traceback (most recent call last):
...
AttributeError: No such attribute: GroupHomomorphismByImagesNC.
```



---

Comment by sbrandhorst created at 2018-05-25 08:27:43

We can use `libgap.function_factory("GroupHomomorphismByImagesNC")`


---

Comment by tscrim created at 2018-05-25 08:28:40

Were you able to get it to work on your machine without doing comment:17?


---

Comment by sbrandhorst created at 2018-05-25 08:30:06

No. You found a bug in my code there. Would you do the change? Then I can finish the review.


---

Comment by sbrandhorst created at 2018-05-25 08:34:03

Alternatively to comment:17 we can also add GroupHomomorphismByImagesNC to
`sage.libs.gap_functions`


---

Comment by git created at 2018-05-25 08:34:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2018-05-25 08:34:44

Done.


---

Comment by git created at 2018-05-25 08:55:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by sbrandhorst created at 2018-05-25 08:56:33

using `IsGroupHomomorphism` feels like we are doing the work twice 
(though I do not know the implementation details of that function). 
Positive review if you are happy with my changes.


---

Comment by tscrim created at 2018-05-25 09:02:19

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2018-05-25 09:02:19

Thanks. LGTM.


---

Comment by sbrandhorst created at 2018-05-25 09:05:45

Thank you. The follow up is #25444.


---

Comment by git created at 2018-05-25 21:49:58

Changing status from positive_review to needs_review.


---

Comment by git created at 2018-05-25 21:49:58

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by tscrim created at 2018-05-26 04:53:40

Changing status from needs_review to positive_review.


---

Comment by sbrandhorst created at 2018-05-28 09:07:13

----
New commits:


---

Comment by sbrandhorst created at 2018-05-28 09:07:13

Changing status from positive_review to needs_review.


---

Comment by git created at 2018-05-28 09:07:13

Changing status from positive_review to needs_review.


---

Comment by git created at 2018-05-28 09:07:13

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by sbrandhorst created at 2018-05-28 09:18:32

There is another bug:

```
try:
    if G.is_finite() and H.is_finite():
        category = category.Finite()
    except NotImplementedError:
```

This is dangerous as determining whether a group is finite or not may be impossible.
Hence I remove this.


---

Comment by git created at 2018-05-28 09:21:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2018-05-28 09:22:14

I do not agree with the join category. It should not *add* the category of groups, but enforce it. If you do not want that, then it should not make the join category.

I also do not agree with your assessment about the danger. Good code should not try to iterate over a potentially infinite obejct (without explicit user doing the iteration). So the `is_finite` should be safe (and error out when not known).

Also, unless it is something that breaks a doctest, it should be a follow up ticket.


---

Comment by sbrandhorst created at 2018-05-28 09:57:08

Unfortunately it breaks a lot of doctests for finitely presented groups.


---

Comment by sbrandhorst created at 2018-05-28 10:03:37

Replying to [comment:33 tscrim]:
> I do not agree with the join category. It should not *add* the category of groups, but enforce it. If you do not want that, then it should not make the join category.

Mhh, guess you are right, but then I do not know how to fix the doctests.
Something up in the coercion model breaks.

> I also do not agree with your assessment about the danger. Good code should not try to iterate over a potentially infinite obejct (without explicit user doing the iteration). So the `is_finite` should be safe (and error out when not known).

Even if it does not error out, the computation may be very expensive. We do not want to trigger that when just creating a homset.
Especially, since being a homomorphism in the category of finite groups does not change anything.


---

Comment by sbrandhorst created at 2018-05-28 10:03:54

Changing status from needs_review to needs_work.


---

Comment by tscrim created at 2018-05-28 15:37:44

Replying to [comment:35 sbrandhorst]:
> Replying to [comment:33 tscrim]:
> > I do not agree with the join category. It should not *add* the category of groups, but enforce it. If you do not want that, then it should not make the join category.
> 
> Mhh, guess you are right, but then I do not know how to fix the doctests.
> Something up in the coercion model breaks.

Then something is not being handled properly. I will investigate.

> > I also do not agree with your assessment about the danger. Good code should not try to iterate over a potentially infinite obejct (without explicit user doing the iteration). So the `is_finite` should be safe (and error out when not known).
> 
> Even if it does not error out, the computation may be very expensive. We do not want to trigger that when just creating a homset.
> Especially, since being a homomorphism in the category of finite groups does not change anything.

Really `is_finite` should be a fast check (and error out if it doesn't know if it is finite or not). The other test you could do is `X in Groups().Finite()`, which is a property that has to be explicitly given upon construction. Even so, we should make it future-proof for when such code is added.


---

Comment by git created at 2018-05-28 16:03:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2018-05-28 16:06:18

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2018-05-28 16:06:18

After digging through the code and a little bit more thought, we should just let `Homset` handle the `category` parameter, which defaults to `X.category()`. I think that is a reasonable default because it should respect the structure of `X` (unless you explicitly say you want less structure).


---

Comment by sbrandhorst created at 2018-05-28 20:42:24

This seems reasonable. Thank you for guiding me through this.


---

Comment by sbrandhorst created at 2018-05-28 20:42:24

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2018-05-28 21:23:42

No problem. Thank you.


---

Comment by vbraun created at 2018-05-30 06:48:24

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2018-05-30 06:48:24

Try to run `make ptestlong` before setting this back to positive review

```
sage -t --long src/sage/categories/homset.py
**********************************************************************
File "src/sage/categories/homset.py", line 905, in sage.categories.homset.Homset._element_constructor_
Failed example:
    H(H.identity(), foo="bar")
Expected:
    Traceback (most recent call last):
    ...
    NotImplementedError: no keywords are implemented for constructing elements of Set of Morphisms from Free Group on generators {x, y, z} to Free Group on generators {x, y, z} in Category of groups
Got:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/mnt/disk/home/release/Sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 572, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/mnt/disk/home/release/Sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 982, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.categories.homset.Homset._element_constructor_[29]>", line 1, in <module>
        H(H.identity(), foo="bar")
      File "sage/structure/parent.pyx", line 922, in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9761)
        return mor._call_with_args(x, args, kwds)
      File "sage/categories/morphism.pyx", line 445, in sage.categories.morphism.IdentityMorphism._call_with_args (build/cythonized/sage/categories/morphism.c:7634)
        return C._element_constructor(x, *args, **kwds)
    TypeError: _element_constructor_() got an unexpected keyword argument 'foo'
**********************************************************************
1 item had failures:
   1 of  31 in sage.categories.homset.Homset._element_constructor_
    [270 tests, 1 failure, 2.01 s]
----------------------------------------------------------------------
sage -t --long src/sage/categories/homset.py  # 1 doctest failed
----------------------------------------------------------------------
Total time for all tests: 2.1 seconds
    cpu time: 1.8 seconds
    cumulative wall time: 2.0 seconds
```



---

Comment by git created at 2018-05-30 07:01:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2018-05-30 07:02:16

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2018-05-30 07:02:16

Fixed.


---

Comment by sbrandhorst created at 2018-05-30 07:27:40

running the tests as Volker suggested. might take a while.


---

Comment by sbrandhorst created at 2018-05-30 08:31:02

Changing status from needs_review to positive_review.


---

Comment by sbrandhorst created at 2018-05-30 08:31:02


```
----------------------------------------------------------------------
sage -t --long --warn-long 97.7 src/sage/rings/padics/padic_lattice_element.py  # Timed out
sage -t --long --warn-long 97.7 src/sage/doctest/external.py  # Timed out
----------------------------------------------------------------------
Total time for all tests: 2781.8 seconds
    cpu time: 18033.7 seconds
    cumulative wall time: 39686.5 seconds
```

Guess these timeouts are unrelated. so
LGTM


---

Comment by vbraun created at 2018-05-31 17:25:45

Resolution: fixed
