# Issue 10354: containment for multivariate polynomial rings

Issue created by migration from https://trac.sagemath.org/ticket/10355

Original creator: niles

Original creation time: 2010-11-29 18:05:06

Assignee: malb

CC:  novoselt

Keywords: multivariate polynomial containment

A bug in containment for multivariate polynomial rings:


```
sage: A1.<a> = PolynomialRing(QQ)
sage: 3 in A1
True

sage: A2.<a,b> = PolynomialRing(QQ)
sage: 3 in A2
False 

sage: A1(a) in A2
False
```


This occurs because `__contains__(self,x)` for multivariate polynomial rings simply tests whether the parent of `x` is `self`.  Instead, it should inherit `__contains__` from the class `Parent`.  Further discussion can be found on this [sage-devel thread](http://groups.google.com/group/sage-devel/browse_thread/thread/dab74506d9ff94bf).


---

Attachment


---

Comment by niles created at 2010-11-29 19:40:14

I've added a first version of a patch; it simply deletes the definition of `__contains__` for multivariate polynomial rings, allowing it to be inherited from `Parent`.  Unfortunately, this fails some doctests:


```
sage -t -long devel/sage-main/sage/schemes/generic/toric_variety.py # 5 doctests failed
sage -t -long devel/sage-main/sage/misc/trace.py # 2 doctests failed
```



---

Comment by niles created at 2010-11-29 19:40:14

Changing status from new to needs_work.


---

Comment by niles created at 2010-11-30 01:08:35

Hi Andrey,

I'm working on a very simple bug in containment for multivariate polynomials, but the obvious fix is causing doctest failures in your `toric_variety.py` code, which I'm afraid I don't understand.  Could you help me figure out what the basic problem is, so that I can try to fix it? (Note that almost all of the sage library seems to work fine; `toric_variety.py` is the only file with significant failures.)

Details can be found on this ticket page, or I can write to you separately. (you can find my email at [http://nilesjohnson.net](http://nilesjohnson.net))

thanks,
Niles


---

Comment by jhpalmieri created at 2010-11-30 02:45:17

Changing status from needs_work to needs_review.


---

Comment by jhpalmieri created at 2010-11-30 02:45:17

Here's a patch which I think fixes the problem in toric_variety.py.  Is it a reasonable fix?


---

Comment by jhpalmieri created at 2010-11-30 02:45:45

apply together with other patch


---

Attachment

Since the main patch deletes code instead of adding anything, where is the right place to put a doctest to verify that it works the way it is now supposed to?


---

Attachment


---

Comment by novoselt created at 2010-11-30 03:10:45

Replying to [comment:3 jhpalmieri]:
> Here's a patch which I think fixes the problem in toric_variety.py.  Is it a reasonable fix?

It was fixing the issue due to the changes of this ticket, but it was actually more of a bug, so I attached an alternative version and added a little doctest checking that plain numbers are also interpreted correctly as polynomials.


---

Comment by robertwb created at 2010-11-30 04:15:37

Replying to [comment:4 jhpalmieri]:
> Since the main patch deletes code instead of adding anything, where is the right place to put a doctest to verify that it works the way it is now supposed to?

I'd put it in the parent's class-level docstring.


---

Comment by niles created at 2010-11-30 14:43:20

second version, with doctest


---

Attachment

I decided to add the doctest to the `__init__` method for 3 reasons:

 * keeps the doctest in the file which defines multivariate polynomial rings
 * `__init__` is one of the "closest" methods (in `multi_polynomial_ring_generic.py`) to the `Parent` class
 * Having the test in the docstring for an underscore method means that it won't appear in any of the Sage documentation -- for this test, I think that's appropriate.


---

Comment by niles created at 2010-11-30 15:19:23

p.s. With the two patches applied, all doctests pass, and all documentation builds cleanly.


---

Comment by robertwb created at 2010-12-03 19:54:07

Apply trac_10355_multi_polynomial_containment_2.patch and trac_10355_polynomial_containment_in_toric_varieties.patch


---

Comment by vbraun created at 2010-12-20 12:18:28

Looks good! Tested on 4.6.1alpha3.


---

Comment by vbraun created at 2010-12-20 12:18:28

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2011-01-25 08:16:07

Resolution: fixed
