# Issue 30239: Doc: Add instructions on how to run the SageMath jupyter kernel in a system jupyter notebook or jupyterlab

Issue created by migration from https://trac.sagemath.org/ticket/30476

Original creator: mkoeppe

Original creation time: 2020-08-31 01:53:48

CC:  nbruin slelievre @jcamp0x2a dimpase paulmasson embray

For 9.3, we hope to automate it in #30306; but for 9.2, perhaps we can at least explain to the user what needs to be done.



Further escalation in #30313: Doc: Add instructions how to run a remote [SageMath](SageMath) jupyter kernel


---

Comment by charpent created at 2020-11-12 11:30:41

Works for me under Linux (locally) :

* `$SAGE_ROOT/sage` is symlinked to `/usr/local/bin`, which is in my default `PATH`.
* FWIW, the "small scripts" (Maxima, GAP, Pari) also live there.
* Some Jupyter kernels (gap and pari) are installed via Sage's `pip`.
* `$SAGE_LOCAL/share/jupyter/kernels/sagemath/` has been symlinked (by `root`) to the system's Jupyter kernel directory (ditto for gap and pari).

ISTR that, on another machine, I managed to install Sage's kernel via

```
sudo jupyter kernelspec install [path to the Sage kernel directory]
```

But I can't check that ATM.

Notes:
* I wasn't able to get Singular's jupyter kernel to work (neither in Sages's jupyter nor the systemwide jupyter)..
* This also works with jupyterlab
* A valuable addition would be Maxima's jupyter kernel ; unfortunately, it does not (currently) works with an ECL-based Maxima...

HTH,


---

Comment by malb created at 2020-11-12 11:42:34

For me 


```
jupyter kernelspec install --user $SAGE_ROOT/local/share/jupyter/kernels/sagemath
```


seems to work well https://martinralbrecht.wordpress.com/2020/08/23/conda-jupyter-and-emacs/


```
> jupyter console --kernel=sagemath
Jupyter console 5.2.0

┌────────────────────────────────────────────────────────────────────┐
│ SageMath version 9.1, Release Date: 2020-05-20                     │
│ Using Python 3.7.3. Type "help()" for help.                        │
└────────────────────────────────────────────────────────────────────┘


In [1]: singular("1")
Out[1]: 1
```



---

Comment by mkoeppe created at 2020-11-12 17:15:27

Thanks to both of you. 

If you have chance, could you check / comment whether the following work in this configuration:
 - interacts (most recently, #30246 added support for them in JupyterLab)
 - 3D graphics with `threejs` (in particular with `online=False`) or `jsmol` in the notebook / JupyterLab
 - mathjax in the notebook / JupyterLab


---

Comment by charpent created at 2020-11-12 17:25:58

Replying to [comment:5 mkoeppe]:

[ Snip... ]

>  - mathjax in the notebook / JupyterLab

What do you mean ? The "standard" use of mathjax in Makdown cells ? That works as smoothly in the systemwide Jupyter as in  Sage's Jupyter.

Or do you mean interpolation in a text cell of a Sage-generated value ?


---

Comment by mkoeppe created at 2020-11-12 17:39:56

Replying to [comment:7 charpent]:
> Replying to [comment:5 mkoeppe]:
> 
> [ Snip... ]
> 
> >  - mathjax in the notebook / JupyterLab
> 
> What do you mean ? The "standard" use of mathjax in Makdown cells ? That works as smoothly in the systemwide Jupyter as in  Sage's Jupyter.
> 
> Or do you mean interpolation in a text cell of a Sage-generated value ?

Great question, I am not actually sure. But `src/sage/repl/ipython_kernel/install.py` (`use_local_mathjax`) installs a copy of mathjax in Sage's jupyter - and the `jupyter kernelspec install` command does not copy that over to the system jupyter if I'm not mistaken.


---

Comment by mkoeppe created at 2020-11-12 18:00:40

Replying to [comment:4 malb]:
> {{{
> jupyter kernelspec install --user $SAGE_ROOT/local/share/jupyter/kernels/sagemath
> }}}
> seems to work well

This seems currently broken: #30903 (Fix broken symlink to documentation in the Sage jupyter kernelspec)


---

Comment by mkoeppe created at 2020-11-12 18:03:15

Replying to [comment:3 charpent]:
> * A valuable addition would be Maxima's jupyter kernel ; unfortunately, it does not (currently) works with an ECL-based Maxima...

Is this already discussed somewhere?


---

Comment by charpent created at 2020-11-12 18:17:08

Replying to [comment:11 mkoeppe]:
> Replying to [comment:3 charpent]:
> > * A valuable addition would be Maxima's jupyter kernel ; unfortunately, it does not (currently) works with an ECL-based Maxima...
> 
> Is this already discussed somewhere?

In the Maxima Jupyter kernel Githib page, IIRC. Don't have any more precise reference ATM...


---

Comment by charpent created at 2020-11-12 18:53:01

Replying to [comment:5 mkoeppe]:
> Thanks to both of you. 
> 
> If you have chance, could you check / comment whether the following work in this configuration:
>  - interacts (most recently, #30246 added support for them in JupyterLab)
>  - 3D graphics with `threejs` (in particular with `online=False`) or `jsmol` in the notebook / JupyterLab
>  - mathjax in the notebook / JupyterLab
> 

In the **Jupyter** notebook, updating a worksheet created in Sage's notebook :

* Mathjax in markdown cells : OK
* Interacts : the graph is diplayed with the interact's default value, the slider is not displayed (I get a 404 in the console where I launched !Jupyter)
* 3D plot with default viewer : works (threjs)
* 3D plot with lmol : blank space (and a 404 in the console)
* 3D plot with jsmol : warning, and plot displayed with threejs.

I uploaded the sheet and a capture of console output/error (`Essai interact.tar.gz`).


---

Attachment

Thanks very much!

Could you repeat the 3D plotting experiment with `online=False`, for example using `sphere(online=False)`?


---

Comment by charpent created at 2020-11-12 19:28:22

Replying to [comment:14 mkoeppe]:
> Thanks very much!
> 
> Could you repeat the 3D plotting experiment with `online=False`, for example using `sphere(online=False)`? 

Works.


---

Comment by charpent created at 2020-11-12 19:31:52

Do you have an idea about how to add Sage-specific Jupyter extensions (Sage's interacts, jmol) to the systemwide notebook ? If possible, as root (in order to be usable by all users) ?


---

Comment by mkoeppe created at 2020-11-12 19:49:44

Replying to [comment:15 charpent]:
> Replying to [comment:14 mkoeppe]:
> > Could you repeat the 3D plotting experiment with `online=False`, for example using `sphere(online=False)`? 
> 
> Works.

With all 3 options, or only threejs?


---

Comment by mkoeppe created at 2020-11-12 19:55:54

Replying to [comment:16 charpent]:
> Do you have an idea about how to add Sage-specific Jupyter extensions (Sage's interacts, jmol) to the systemwide notebook ? If possible, as root (in order to be usable by all users) ?

For the Sage interacts, one needs the pip-installable package `widgetsnbextension`.
It would be best to recommend to users to install it as a system package (see https://repology.org/projects/?search=widgetsnbextension); if not available, it can be installed by pip.


---

Comment by mkoeppe created at 2020-11-12 19:59:26

Let's add system package information for `widgetsnbextension` on this ticket.
(#30124 is a more ambitious ticket in the same direction.)


---

Comment by charpent created at 2020-11-12 20:25:10

Replying to [comment:17 mkoeppe]:
> Replying to [comment:15 charpent]:
> > Replying to [comment:14 mkoeppe]:
> > > Could you repeat the 3D plotting experiment with `online=False`, for example using `sphere(online=False)`? 
> > 
> > Works.
> 
> With all 3 options, or only threejs?

* default ==> threejs
* jmol ==> blank space
* jsmol ==> warning + threejs
----
New commits:


---

Comment by git created at 2020-11-13 06:06:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-11-13 06:06:38

(The information for conda is added in #28745.)


---

Comment by mkoeppe created at 2020-11-13 06:09:12

Replying to [comment:18 mkoeppe]:
> Replying to [comment:16 charpent]:
> > Do you have an idea about how to add Sage-specific Jupyter extensions (Sage's interacts, jmol) to the systemwide notebook ? If possible, as root (in order to be usable by all users) ?
> 
> For the Sage interacts, one needs the pip-installable package `widgetsnbextension`.
> It would be best to recommend to users to install it as a system package (see https://repology.org/projects/?search=widgetsnbextension); if not available, it can be installed by pip.

I have added the system package information. Could you check whether installing the system package on your system gets the interacts to work?


---

Comment by charpent created at 2020-11-13 08:29:43

Replying to [comment:24 mkoeppe]:
> Replying to [comment:18 mkoeppe]:
> > Replying to [comment:16 charpent]:
> > > Do you have an idea about how to add Sage-specific Jupyter extensions (Sage's interacts, jmol) to the systemwide notebook ? If possible, as root (in order to be usable by all users) ?
> > 
> > For the Sage interacts, one needs the pip-installable package `widgetsnbextension`.
> > It would be best to recommend to users to install it as a system package (see https://repology.org/projects/?search=widgetsnbextension); if not available, it can be installed by pip.
> 
> I have added the system package information. Could you check whether installing the system package on your system gets the interacts to work?

It doesn't : both `jupyter-nbextension-jupyter-js-widgets` and `python3-widgetsnbextension` were already installed :


```
charpent@zen-book-flip:~$ dpkg -l "*jupyter*widgets*" | cat
Souhait=inconnU/Installé/suppRimé/Purgé/H=à garder
+++-======================================-============-============-================================================
ii  jupyter-nbextension-jupyter-js-widgets 6.0.0-6      all          Interactive widgets - Jupyter notebook extension
charpent@zen-book-flip:~$ dpkg -l "*widgets*extension*" | cat
Souhait=inconnU/Installé/suppRimé/Purgé/H=à garder
+++-==========================-============-============-===========================================================
ii  python3-widgetsnbextension 6.0.0-6      all          Interactive widgets - Jupyter notebook extension (Python 3)
```

| État=Non/Installé/fichier-Config/dépaqUeté/échec-conFig/H=semi-installé/W=attend-traitement-déclenchements
|/ Err?=(aucune)/besoin Réinstallation (État,Err: majuscule=mauvais)
||/ Nom                                    Version      Architecture Description
| État=Non/Installé/fichier-Config/dépaqUeté/échec-conFig/H=semi-installé/W=attend-traitement-déclenchements
|/ Err?=(aucune)/besoin Réinstallation (État,Err: majuscule=mauvais)
||/ Nom                        Version      Architecture Description
From `apt-cache show python3-widgetsnbextension` :

    This package should *not be necessary* for Debian software to use; instead you
    should directly use the jupyter-nbextension-jupyter-js-widgets package. It is
    provided only for compatibility with non-Debian software.

HTH,


---

Comment by charpent created at 2020-11-13 16:44:11

**IMPORTANT** : when I replied, I didn't see the new commits. So this answer is invalid.

I'll switch to this new branch and retry.

Sorry for the noise...

[ Snip... ]


---

Comment by mkoeppe created at 2020-11-13 16:46:53

Not at all - the commits don't do anything - at the moment these are just information files that will influence the system package messages at the end of "configure"


---

Comment by mkoeppe created at 2020-11-13 16:48:43

On your system, how do you start the system Jupyter notebook?
With the same Jupyter installation, could you run `jupyter nbextension list`?


---

Attachment

Console putpur attempting an interact with #30476 up to commit e4fe231f7260c51f51d8079d92b3ad68b2111098


---

Comment by charpent created at 2020-11-13 17:03:49

Replying to [comment:26 charpent]:
> **IMPORTANT** : when I replied, I didn't see the new commits. So this answer is invalid.
> 
> I'll switch to this new branch and retry.
> 
> Sorry for the noise...

No joy. Still no slider... See console output/error in the uploaded `Essai interact-2.log`.


---

Comment by charpent created at 2020-11-13 17:18:45

Replying to [comment:28 mkoeppe]:
> On your system, how do you start the system Jupyter notebook?

Command line : `jupyter notebook` or `jupyter notebook --browser=google-chrome` according to what I have in my default) `chromium`.

> With the same Jupyter installation, could you run `jupyter nbextension list`?


```
charpent@zen-book-flip:~$ jupyter nbextension list
Known nbextensions:
  config dir: /home/charpent/.jupyter/nbconfig
    notebook section
      nbextensions_configurator/config_menu/main  enabled 
      - Validating: problems found:
        - require?  X nbextensions_configurator/config_menu/main
      python-markdown/main  enabled 
      - Validating: OK
    tree section
      nbextensions_configurator/tree_tab/main  enabled 
      - Validating: problems found:
        - require?  X nbextensions_configurator/tree_tab/main
  config dir: /usr/local/etc/jupyter/nbconfig
    notebook section
      nbextensions_configurator/config_menu/main  enabled 
      - Validating: problems found:
        - require?  X nbextensions_configurator/config_menu/main
      contrib_nbextensions_help_item/main  enabled 
      - Validating: OK
    tree section
      nbextensions_configurator/tree_tab/main  enabled 
      - Validating: problems found:
        - require?  X nbextensions_configurator/tree_tab/main
  config dir: /etc/jupyter/nbconfig
    notebook section
      jupyter-js-widgets/extension  enabled 
      - Validating: OK
```


Ooops..


---

Comment by charpent created at 2020-11-13 17:24:27

In the `Nbextensions` tab, the following are enabled :

* jupyter-js-widgets/nbextension
* Nbextension edit menu item
* Python Markdown
* contrib_nbextensions_help_item
* Nbextensions dashboard tab

HTH,

Replying to [comment:30 charpent]:
> Replying to [comment:28 mkoeppe]:
> > On your system, how do you start the system Jupyter notebook?
> 
> Command line : `jupyter notebook` or `jupyter notebook --browser=google-chrome` according to what I have in my default) `chromium`.
> 
> > With the same Jupyter installation, could you run `jupyter nbextension list`?
> 
> {{{
> charpent`@`zen-book-flip:~$ jupyter nbextension list
> Known nbextensions:
>   config dir: /home/charpent/.jupyter/nbconfig
>     notebook section
>       nbextensions_configurator/config_menu/main  enabled 
>       - Validating: problems found:
>         - require?  X nbextensions_configurator/config_menu/main
>       python-markdown/main  enabled 
>       - Validating: OK
>     tree section
>       nbextensions_configurator/tree_tab/main  enabled 
>       - Validating: problems found:
>         - require?  X nbextensions_configurator/tree_tab/main
>   config dir: /usr/local/etc/jupyter/nbconfig
>     notebook section
>       nbextensions_configurator/config_menu/main  enabled 
>       - Validating: problems found:
>         - require?  X nbextensions_configurator/config_menu/main
>       contrib_nbextensions_help_item/main  enabled 
>       - Validating: OK
>     tree section
>       nbextensions_configurator/tree_tab/main  enabled 
>       - Validating: problems found:
>         - require?  X nbextensions_configurator/tree_tab/main
>   config dir: /etc/jupyter/nbconfig
>     notebook section
>       jupyter-js-widgets/extension  enabled 
>       - Validating: OK
> }}}
> 
> Ooops..


---

Comment by enriqueartal created at 2020-11-20 19:53:01

I have two installations. In my laptop, I installed notebook jupyter via `pip` as root and also `jupyterlab` (right now 3.0.0rc10). I linked the jupyter kernel folder of my sage installation in `.local/share/jupyter/kernels/sagemath` and I launch it with jupyter lab in the command line or via a desktop file. I linked also the nbextensions mathjax, threejs and jsmol of the sage installation in the jupyter folder. It works, including threejs with `online=False`.

I also have a similar installation in the desktop computer of my office, using also jupyterhub (standard configuration, I may share my conf file), with basically the same installation, with some exceptions. I use the stable version of jupyterlab. I cannot use jmol as viewer, but otherwise everything works.


---

Comment by enriqueartal created at 2020-11-21 14:11:14

One more comment for jupyterhub. If the user has not set the variable SAGE_ROOT, then the kernel.json file must include the variable "env" with the value { "SAGE_ROOT": "place_where_Sage_is_installed" }, see
https://benjamin-hackl.at/blog/2016/03/jupyterhub-sagemath.html.


---

Comment by mkoeppe created at 2020-12-04 19:25:05

Changing priority from major to critical.


---

Comment by git created at 2020-12-04 23:05:53

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2020-12-04 23:45:07

I've started a new section in the documentation.

Could someone in the know please add instructions on how to verify that all the features are working?


---

Comment by git created at 2020-12-10 06:13:33

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by fbissey created at 2020-12-27 20:39:31

#30972 doesn't seem technically needed for this to work. I guess it is a nice to have but not a show stopper. Also, the author field should be filled. I will give it a second more attentive reading once it is done.


---

Comment by git created at 2020-12-28 18:58:28

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2020-12-29 06:16:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-12-29 06:17:02

Changing status from new to needs_review.


---

Comment by fbissey created at 2020-12-29 06:46:46

I am finding that wording a bit convoluted - and not a usual English formulation (yes I know that criticism comes from a French person)

```
For the full functionality of the SageMath kernel in your global
Jupyter installation, additionally some Notebook Extension packages
need to be installed (or linked) into the environment from which the
Jupyter installation runs.
```


I would suggest to replace it by something along the lines of

```
To get the full functionality of the SageMath kernel in your global 
Jupyter installation, the following Notebook Extension packages also 
need to be installed (or linked) in the environment from which the
Jupyter installation runs.
```


A native English speaker may want to polish it a bit.

It is otherwise quite good and would give it a positive review.


---

Comment by git created at 2020-12-29 18:24:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by slelievre created at 2021-01-02 13:09:12

Would this work only on Linux and macOS?

Someone requested similar instructions for Windows at

- [Ask sage question 54022: Install SageMath into Jupyter in Windows 10 rather than the reverse](https://ask.sagemath.org/question/54022)


---

Comment by mkoeppe created at 2021-01-02 18:22:28

For a simpler version of this I have opened #31156.


---

Comment by mkoeppe created at 2021-01-02 18:37:21

Replying to [comment:48 slelievre]:
> Someone requested similar instructions for Windows at
> 
> - [Ask sage question 54022: Install SageMath into Jupyter in Windows 10 rather than the reverse](https://ask.sagemath.org/question/54022)

For this I have opened #31157.


---

Comment by mkoeppe created at 2021-01-02 18:37:32

The present ticket still needs review!


---

Comment by fbissey created at 2021-01-03 02:26:30

There. 44 emails to go (down from 378) after being without any internet since Wednesday.


---

Comment by fbissey created at 2021-01-03 02:26:30

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2021-01-03 02:44:22

Thanks!


---

Comment by vbraun created at 2021-01-03 15:48:37

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2021-01-03 15:48:37


```
[dochtml] [installat] The HTML pages are in local/share/doc/sage/html/en/installation.
[dochtml] Error building the documentation.
[dochtml] Traceback (most recent call last):
[dochtml]   File "/usr/lib64/python3.9/runpy.py", line 197, in _run_module_as_main
[dochtml]     return _run_code(code, main_globals, None,
[dochtml]   File "/usr/lib64/python3.9/runpy.py", line 87, in _run_code
[dochtml]     exec(code, run_globals)
[dochtml]   File "/home/release/Sage/local/lib64/python3.9/site-packages/sage_setup/docbuild/__main__.py", line 2, in <module>
[dochtml]     main()
[dochtml]   File "/home/release/Sage/local/lib64/python3.9/site-packages/sage_setup/docbuild/__init__.py", line 1730, in main
[dochtml]     builder()
[dochtml]   File "/home/release/Sage/local/lib64/python3.9/site-packages/sage_setup/docbuild/__init__.py", line 352, in _wrapper
[dochtml]     build_many(build_other_doc, L)
[dochtml]   File "/home/release/Sage/local/lib64/python3.9/site-packages/sage_setup/docbuild/__init__.py", line 295, in build_many
[dochtml]     _build_many(target, args, processes=NUM_THREADS)
[dochtml]   File "/home/release/Sage/local/lib64/python3.9/site-packages/sage_setup/docbuild/utils.py", line 289, in build_many
[dochtml]     raise worker_exc.original_exception
[dochtml] OSError: /home/release/Sage/src/doc/en/installation/launching.rst:90: WARNING: Could not lex literal_block as "bash". Highlighting skipped.
[dochtml] 
[dochtml]     Note: incremental documentation builds sometimes cause spurious
[dochtml]     error messages. To be certain that these are real errors, run
[dochtml]     "make doc-clean" first and try again.
make[3]: *** [Makefile:1877: doc-html] Error 1
```



---

Comment by git created at 2021-01-03 22:24:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-01-03 22:37:42

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2021-01-17 13:46:20

Resolution: fixed
