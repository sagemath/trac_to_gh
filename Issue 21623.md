# Issue 21623: giac does not start

Issue created by migration from https://trac.sagemath.org/ticket/21860

Original creator: charpent

Original creation time: 2016-11-11 10:34:00

CC:  frederichan parisse

Keywords: giac

Starting with 7.5beta2, sage seems to be unable to start giac. See giac-error.txt


---

Attachment

Session log demonstrating that giac desn't start


---

Attachment

Log file of sage -i -c giac starting from sage 7.5.beta2 + database_gap 4.8.3 + dot2tex 2.9.0p1 + fricas 1.2.7 (serial build)


---

Comment by charpent created at 2016-11-15 21:19:00

Log of a new, fresh attempt to install giac on a Corei7 + 16 GB RAM running Debian testing. giac installs fine but fails its test suite.

This is a special case : the very same package installed fine this afternoon on a smaller machine (i686 + 7 GB RAM + Debian (64 bits) testing). It might be hardware-related or a corner case.


---

Comment by frederichan created at 2016-11-15 23:15:06

From your log, it looks related to this:
../src/icas: symbol lookup error: /usr/lib/libblas.so.3: undefined symbol: gotoblas

What gcc did you used to build giac?


---

Comment by frederichan created at 2016-11-16 10:54:04

About your initial question with

```
sum(1/((x+1)*(2*x-1)),x,0,+infinity)
```

I can notice a change between giac 1.2.2.95 and 1.2.2.101.

about the link PB, I think that the safest solution is to build giac with lapack disabled because with my config of sage 7.5beta2 giac turned out to be linked to not only to the system  libblas but also to the system liblapack.
I guess that we won't lose interesting things for sage.


---

Comment by frederichan created at 2016-11-16 12:33:49

Last 10 new commits:


---

Comment by frederichan created at 2016-11-16 12:44:22

Changing status from new to needs_review.


---

Comment by charpent created at 2016-11-17 08:35:36

* Builds OK
* Passes its own testsuite
* Ptestlong has three failures :

```
----------------------------------------------------------------------
sage -t --long --warn-long 100.3 src/sage/rings/polynomial/multi_polynomial_ideal.py  # 1 doctest failed
sage -t --long --warn-long 100.3 src/sage/matrix/matrix_space.py  # Bad exit: 2
sage -t --long --warn-long 100.3 src/sage/homology/simplicial_complex.py  # 1 doctest failed
----------------------------------------------------------------------
```


The latter two are transient (pass when ran standalone), the first one is permanent :


```
charpent@asus16-ec:/usr/local/sage-7$ sage -t --long --warn-long 100.3 src/sage/rings/polynomial/multi_polynomial_ideal.py
Running doctests with ID 2016-11-17-09-17-43-cce569e2.
Git branch: t/21860/giacblas
Using --optional=database_gap,giac,giacpy_sage,mpir,python2,sage
Doctesting 1 file.
sage -t --long --warn-long 100.3 src/sage/rings/polynomial/multi_polynomial_ideal.py
**********************************************************************
File "src/sage/rings/polynomial/multi_polynomial_ideal.py", line 3533, in sage.rings.polynomial.multi_polynomial_ideal.NCPolynomialIdeal.groebner_basis
Failed example:
    ideal(J.transformed_basis()).change_ring(P).interreduced_basis()  # optional - giacpy_sage
Expected:
    [a - 60*c^3 + 158/7*c^2 + 8/7*c - 1, b + 30*c^3 - 79/7*c^2 + 3/7*c, c^4 - 10/21*c^3 + 1/84*c^2 + 1/84*c]
Got:
    [7*a - 420*c^3 + 158*c^2 + 8*c - 7, 7*b + 210*c^3 - 79*c^2 + 3*c, 84*c^4 - 40*c^3 + c^2 + c]
**********************************************************************
1 item had failures:
   1 of  67 in sage.rings.polynomial.multi_polynomial_ideal.NCPolynomialIdeal.groebner_basis
    [723 tests, 1 failure, 9.10 s]
----------------------------------------------------------------------
sage -t --long --warn-long 100.3 src/sage/rings/polynomial/multi_polynomial_ideal.py  # 1 doctest failed
----------------------------------------------------------------------
Total time for all tests: 9.2 seconds
    cpu time: 15.5 seconds
    cumulative wall time: 9.1 seconds
```


The review is positve for giac, negative for giacpy_sage. Therefore :

* created #21994, which depends on this ;
* `positive_review`


---

Comment by charpent created at 2016-11-17 08:35:36

Changing status from needs_review to positive_review.


---

Comment by rws created at 2016-11-17 09:13:19

Confirm there are no errors with `make ptestlong` and `--optional=ccache,gdb,giac,mpir,python2,sage`. I didn't install/test giacpy.


---

Comment by charpent created at 2016-11-17 11:17:38

Replying to [comment:8 rws]:
> Confirm there are no errors with `make ptestlong` and `--optional=ccache,gdb,giac,mpir,python2,sage`. I didn't install/test giacpy.

I have installed neither `ccache` nor `gdb`. But I have `database_gap`.


```
./sage -tp 8 --optional=database_gap,giac,mpir,python2,sage -a | tee logs/ptestlong-21860V2.log
```


gives one failure :


```
----------------------------------------------------------------------
sage -t --warn-long 91.6 src/sage/homology/simplicial_complex.py  # 1 doctest failed
----------------------------------------------------------------------
```


which is transient :


```
charpent@asus16-ec:/usr/local/sage-7$ ./sage -t --warn-long 91.6 src/sage/homology/simplicial_complex.py  
Running doctests with ID 2016-11-17-12-14-36-35f0d332.
Git branch: t/21860/giacblas
Using --optional=database_gap,giac,giacpy_sage,mpir,python2,sage
Doctesting 1 file.
sage -t --warn-long 91.6 src/sage/homology/simplicial_complex.py
    [582 tests, 2.77 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 2.9 seconds
    cpu time: 2.6 seconds
    cumulative wall time: 2.8 seconds
```


Does this answer your question ?


---

Comment by charpent created at 2016-11-17 11:24:00

One more (irrelevant ?) data point :

On another, smaller machine, rebuilding Sage while forcing the use of system's `atlas/blas/lapack` via a suitable `SAGE_ATLAS_LIB` choice allows to install and test successfully the previous version of giac and giacpy_sage.


---

Comment by vbraun created at 2016-11-19 22:31:32

Reviewer name should be a real name, not trac account name


---

Comment by charpent created at 2016-11-19 22:42:54

Wups ! Corrected.

Not the first time that happens to me... Maybe that should be hinted at in the ticket form legend ?


---

Comment by vbraun created at 2016-11-21 21:56:20

Resolution: fixed


---

Comment by tmonteil created at 2016-11-23 01:06:07

Out of curiosity, will disabling lapack slow down giac ? If yes, would there be a possibility to enable it when possible ?


---

Comment by parisse created at 2016-11-23 06:24:50

Disabling lapack will not slow down giac, unless you are doing approx numeric computations with large matrices (n>1000).


---

Comment by tmonteil created at 2016-11-23 11:25:18

Thanks fot the info. I plan to make `Xcas` available from Sage in the next Sage Debian Live release, this is why i was asking.
