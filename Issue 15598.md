# Issue 15598: Smith Normal Form Integers Mod 2 TypeError: submatrix() takes exactly 4 positional arguments(2 given)

Issue created by migration from Trac.

Original creator: andrewsilver

Original creation time: 2014-02-19 04:51:27

Try (Mac OS X Current Version, Current Sage Version):

A = Matrix(IntegerModRing(2),[[1,0,2],[1,0,1]]) 
A.smith_form() 

You get the error:
> TypeError                                 Traceback (most recent call 
> last) <ipython-input-6-23e95c6be019> in <module>() ----> 1 
> A.smith_form() 
> /Users/.../builds/sage-6.1.1/local/lib/python2.7/site-packages/sage/matrix/matrix2.so 
>  in sage.matrix.matrix2.Matrix.smith_form 
> (sage/matrix/matrix2.c:60007)() 
> /Users/.../builds/sage-6.1.1/local/lib/python2.7/site-packages/sage/matrix/matrix_mod2_dense.so 
>  in sage.matrix.matrix_mod2_dense.Matrix_mod2_dense.submatrix 
> (sage/matrix/matrix_mod2_dense.c:10429)() 
> TypeError: submatrix() takes exactly 4 positional arguments (2 
> given) 

This error does not appear for calculations over the integers mod 3

With the advice from https://groups.google.com/forum/#!topic/sage-devel/7F5xUQFcfXE, I went ahead and created what looks like a patch (to me, anyway):

Inside the smith_form() function in matrix2.pyx:

We have: mm = t.submatrix(1,1) on line 12413.

The sub matrix function takes five parameters (self, starting row, starting col, # sub matrix rows, # sub matrix columns). From observation, the 1,1 is the starting row/col respectively. Somehow the function is unable to determine ncols and nrows when using the integers mod 2, but after some trial and error I discovered a potential patch:

submatrix_rows = t.rows -1
submatrix_cols = t.cols - 1
mm = t.submatrix(1,1, submatrix_rows, submatrix,cols)

The above modification gives the same answers as all the examples in the source code. I tested a couple of other things:

Mod 3 Example:
A = Matrix(Integers(3),[[1,0,2],[1,0,1],[1,1,1]])
[1 0 0]  [1 0 0]  [1 0 1]
[0 1 0]  [2 0 1]  [0 1 1]
[0 0 1], [1 2 0], [0 0 1]
(same for mod 3 in current master and modified version)

Example mod 2 (not computable in current version of Sage - checked with hand computation - good luck checking it!) -

sage: C = Matrix(IntegerModRing(2),[[1,0,1,0],[1,1,0,0],[0,1,1,0],[1,0,0,1],[0,0,1,1],[0,1,0,1]])
sage: C.smith_form()
(
[1 0 0 0]  [1 0 0 0 0 0]           
[0 1 0 0]  [1 1 0 0 0 0]           
[0 0 1 0]  [1 0 0 1 0 0]  [1 0 1 1]
[0 0 0 0]  [1 1 1 0 0 0]  [0 1 1 1]
[0 0 0 0]  [1 0 0 1 1 0]  [0 0 1 1]
[0 0 0 0], [0 1 0 1 0 1], [0 0 0 1]
)
sage: t,u,v=C.smith_form()
sage: u.inverse()
[1 0 0 0 0 0]
[1 1 0 0 0 0]
[0 1 0 1 0 0]
[1 0 1 0 0 0]
[0 0 1 0 1 0]
[0 1 1 0 0 1]


---

Comment by git created at 2014-02-19 05:06:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by andrewsilver created at 2014-02-19 05:09:14

Changing status from new to needs_review.


---

Comment by fwclarke created at 2014-02-19 10:15:08

A rather simpler alternative is to delete the `submatrix` methods for the `Matrix_mod2_dense` and `Matrix_mod2e_dense` classes (in the files `sage/matrix/matrix_mod2_dense.pyx` and `sage/matrix/matrix_mod2e_dense.pyx`, respectively).  This would mean that all matrices would use the same `submatrix` method.  It's completely unclear to me what the extra methods add, and their different syntax has caused the present problem.

I tried commenting them out.  It solved the problem addressed in this ticket, and all doctests still passed.  A quick check suggested that there was no discernible change in timings.


---

Comment by andrewsilver created at 2014-02-19 20:23:50

Just verified that this really is problem with the matrix mod 2 itself (try creating a matrix mod 2 and submatrixing it in the interpreter, it needs all 4 args to work) - while for a standard non-mod 2 matrix, submatrix by default goes to the end of the matrix starting from the lrows,lcols.

fwclarke's suggestion sounds good to me


---

Comment by git created at 2014-02-19 20:30:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-02-19 20:33:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by fwclarke created at 2014-02-20 12:04:39

An indentation error was created in 9db7f90 when a space was deleted before `def __reduce__(self):`

I tried to put the space back, but only discovered that there is still a lot I don't understand about using git.

Once this is done, all that remains is to provide a doctest showing that the problem is solved.
----
New commits:


---

Comment by andrewsilver created at 2014-02-20 14:13:30

I gotchya fwclarke.

For the dockets, is taking the sub-matrix of an identity matrix (integers mod 2) sufficient?
----
New commits:


---

Comment by fwclarke created at 2014-02-20 14:33:33

Replying to [comment:13 andrewsilver]:
> For the dockets, is taking the sub-matrix of an identity matrix (integers mod 2) sufficient?

You must have the same spellchecker as me!

Yes something like

```
sage: A = identity_matrix(GF(2), 6)
sage: A.submatrix(3, 2)
[0 1 0 0]
[0 0 1 0]
[0 0 0 1]
```

would do.  And, as there also needs to be a doctest for the case of higher degree finite fields of characteristic 2, perhaps

```
sage: F8.<a> = GF(8)
sage: A = matrix(4, 4, [a^i for i in range(16)])
sage: A.submatrix(2, 1)
[    a^2   a + 1 a^2 + a]
[a^2 + 1       1       a]
```

Of course there should be a doctest for `smith_form` too.


---

Comment by fwclarke created at 2014-02-20 14:33:33

Changing status from needs_review to needs_work.


---

Comment by @DaveWitteMorris created at 2020-05-16 18:30:01

Duplicate of #18761 (merged in 6.8).


---

Comment by @DaveWitteMorris created at 2020-05-16 18:30:01

Changing status from needs_work to positive_review.


---

Comment by chapoton created at 2020-05-17 06:14:48

Resolution: duplicate
