# Issue 30624: Add more homebrew system package information, including packages without spkg-configure.m4

Issue created by migration from https://trac.sagemath.org/ticket/30861

Original creator: mkoeppe

Original creation time: 2020-11-03 23:25:18

CC:  @tobiasdiez slelievre dimpase jhpalmieri

Along the same lines as #30859 for debian, 
this is for several purposes:

- Test proper isolation of our build (i.e., the presence of unused system packages do not break our build) using `tox -e ...-maximal` - to reveal errors such as #30745 (homebrew: Errors when homebrew's ntl, flint, or ecl are installed in /usr/local)
- Testing sagelib without Sage-the-distribution (similar to #28745/#30845 for conda)
- Preparation for tickets that will add `spkg-configure.m4`

(from #30371)


---

Comment by slelievre created at 2020-11-04 01:46:21

Changing keywords from "" to "homebrew, spkg-configure.m4".


---

Comment by slelievre created at 2020-11-04 01:48:48

Changing keywords from "homebrew, spkg-configure.m4" to "homebrew, spkg-configure.m4, macos".


---

Comment by mkoeppe created at 2020-11-24 18:38:11

The preparations are done in #29124. Now the system packages can be added


---

Comment by slelievre created at 2021-03-20 15:35:39

Ready for review.
----
New commits:


---

Comment by slelievre created at 2021-03-20 15:35:39

Changing status from new to needs_review.


---

Comment by slelievre created at 2021-03-20 15:46:35

Also available from Macaulay2 taps: fflas-ffpack, frobby, gfan, givaro.

However they break building Sage, see

- https://github.com/Macaulay2/homebrew-tap/issues/68

Also available from GAP tap: gap

- https://github.com/gap-system/homebrew-gap


---

Comment by mkoeppe created at 2021-03-20 16:07:02

We don't really have a mechanism yet to ask users to use a tap - I would need that for polymake too - #31527


---

Comment by slelievre created at 2021-03-20 19:17:39

The `homebrew-maximal` test environment could install extra packages from taps anyway.


---

Comment by mkoeppe created at 2021-03-20 19:36:43

Replying to [comment:15 slelievre]:
> The `homebrew-maximal` test environment could install extra packages from taps anyway.

Well, it's easy to implement in `build/bin/sage-print-system-package-command` - in order to give both advice for users and set up the -maximal environment. I think I'll implement this in the polymake ticket.


---

Comment by mkoeppe created at 2021-03-20 19:55:21

The `mactex` bottle is giving me an error when I do `tox -e local-homebrew-macos-maximal -- config.status`.

```
==> Downloading http://mirror.ctan.org/systems/mac/mactex/mactex-20200407.pkg
==> Downloading from https://ctan.math.illinois.edu/systems/mac/mactex/mactex-20200407.pkg
######################################################################## 100.0%
==> Installing dependencies: jpeg, libtiff, ghostscript
==> Downloading https://homebrew.bintray.com/bottles/jpeg-9d.catalina.bottle.tar.gz
Already downloaded: /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-macos-maximal/Library/Caches/Homebrew/downloads/9ed6b08679bb12bb63055c727e5cdcb7f0813e6a89a66ee35a2b2b83d1c30ac9--jpeg-9d.catalina.bottle.tar.gz
==> Installing jpeg
Error: No such file or directory @ dir_chdir - /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.tox/local-homebrew-macos-maximal/homebrew/Cellar
```


Let's remove `build/pkgs/texlive/distros/homebrew.txt` and revisit this in #31529.


---

Comment by git created at 2021-03-20 21:25:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-03-21 01:05:41

With these changes, it goes through and reports:

```

    notice: the following SPKGs did not find equivalent system packages:

        _recommended brial cddlib cliquer coxeter3 eclib ecm fflas_ffpack flintqs gf2x gfan giac givaro gp2c iml lcalc libbraiding libhomfly libsemigroups lrcalc m4ri m4rie palp pari pari_elldata pari_galdata pari_galpol pari_nftables pari_seadata pari_seadata_small perl_cpan_polymake_prereq perl_term_readline_gnu planarity rw symmetrica sympow tachyon zn_poly
        
checking for the package system in use... homebrew
configure:

    hint: installing the following system packages, if not
    already present, is recommended and may avoid having to
    build them (though some may have to be built anyway):

      $ brew install ffmpeg imagemagick texinfo cddlib
    
```



---

Comment by git created at 2021-03-21 01:07:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-03-21 01:08:04

Changing status from needs_review to positive_review.


---

Comment by slelievre created at 2021-03-21 01:25:37

Thanks!


---

Comment by vbraun created at 2021-05-27 20:30:07

Resolution: fixed
