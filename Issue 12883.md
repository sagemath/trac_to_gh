# Issue 12883: loss of precision via SR

archive/issues_012883.json:
```json
{
    "body": "Assignee: burcin\n\nCC:  benjaminjones\n\nKeywords: numerical_approx\n\nBy going via SR we can lose precision when using numerical_approx:\n\n\n```\n\nsage: p\n3.1415926535897932384626433832795028841971693993751058209749\nsage: parent(p)\nReal Field with 200 bits of precision\nsage: SR(p)\n3.1415926535897932384626433832795028841971693993751058209749\nsage: SR(p).n()\n3.14159265358979\nsage: parent(SR(p).n())\nReal Field with 53 bits of precision\n```\n\n\nThe information is still there, though (as is obvious from the fact the string produced has all those extra digits):\n\n\n```\nsage: SR(p).pyobject()\n3.1415926535897932384626433832795028841971693993751058209749\nsage: parent(SR(p).pyobject())\nReal Field with 200 bits of precision\n```\n\n\nThis might not seem that significant -- we could interpret \"n\" as always defaulting to 53 bits unless specified otherwise -- but it can cause some headaches when trying to get hold=True to behave nicely. I'd prefer that f(1.2345678901234567890) give the same answer as f(1.2345678901234567890, hold=True).n(), especially now that we typically get the precision from the parent.\n\nIssue created by migration from https://trac.sagemath.org/ticket/13055\n\n",
    "created_at": "2012-05-29T03:27:40Z",
    "labels": [
        "symbolics",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.3",
    "title": "loss of precision via SR",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12883",
    "user": "dsm"
}
```
Assignee: burcin

CC:  benjaminjones

Keywords: numerical_approx

By going via SR we can lose precision when using numerical_approx:


```

sage: p
3.1415926535897932384626433832795028841971693993751058209749
sage: parent(p)
Real Field with 200 bits of precision
sage: SR(p)
3.1415926535897932384626433832795028841971693993751058209749
sage: SR(p).n()
3.14159265358979
sage: parent(SR(p).n())
Real Field with 53 bits of precision
```


The information is still there, though (as is obvious from the fact the string produced has all those extra digits):


```
sage: SR(p).pyobject()
3.1415926535897932384626433832795028841971693993751058209749
sage: parent(SR(p).pyobject())
Real Field with 200 bits of precision
```


This might not seem that significant -- we could interpret "n" as always defaulting to 53 bits unless specified otherwise -- but it can cause some headaches when trying to get hold=True to behave nicely. I'd prefer that f(1.2345678901234567890) give the same answer as f(1.2345678901234567890, hold=True).n(), especially now that we typically get the precision from the parent.

Issue created by migration from https://trac.sagemath.org/ticket/13055





---

archive/issue_comments_154991.json:
```json
{
    "body": "Changing keywords from \"numerical_approx\" to \"numerical_approx, sd40.5\".",
    "created_at": "2012-05-29T03:43:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12883",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12883#issuecomment-154991",
    "user": "dsm"
}
```

Changing keywords from "numerical_approx" to "numerical_approx, sd40.5".



---

archive/issue_comments_154992.json:
```json
{
    "body": "I doubt that this is a bug. How would you guess the default precision for the `.n()` method?",
    "created_at": "2014-11-27T19:03:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12883",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12883#issuecomment-154992",
    "user": "jdemeyer"
}
```

I doubt that this is a bug. How would you guess the default precision for the `.n()` method?



---

archive/issue_comments_154993.json:
```json
{
    "body": "Changing type from defect to enhancement.",
    "created_at": "2014-11-27T21:15:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12883",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12883#issuecomment-154993",
    "user": "jdemeyer"
}
```

Changing type from defect to enhancement.



---

archive/issue_comments_154994.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-11-27T21:15:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12883",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12883#issuecomment-154994",
    "user": "jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_154995.json:
```json
{
    "body": "Hmm, I'm not sure this is wontfix, though.  I'm sympathetic to your argument, but Doug's point that\n\n```\nsage: sin(1.2345678901234567890)\n0.9440057250452665781\nsage: sin(1.2345678901234567890).n()\n0.944005725045267\n```\n\nseems good; you shouldn't *lose* precision, should you?  (Forget about hold!)",
    "created_at": "2014-12-04T03:30:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12883",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12883#issuecomment-154995",
    "user": "kcrisman"
}
```

Hmm, I'm not sure this is wontfix, though.  I'm sympathetic to your argument, but Doug's point that

```
sage: sin(1.2345678901234567890)
0.9440057250452665781
sage: sin(1.2345678901234567890).n()
0.944005725045267
```

seems good; you shouldn't *lose* precision, should you?  (Forget about hold!)



---

archive/issue_comments_154996.json:
```json
{
    "body": "Losing precision is a *feature* of the `.n()` method, that's what it does. The `x.n()` method asks for a *numerical approximation* of `x` to a precision of 53 bits. This is easily explained. I also like the fact that neither the implementation nor the user should need to worry about what `x` is, the output is a real/complex number with 53 bits of precision.\n\nIf you think that `.n()` is wrong, what should `(2/3).n()` return then? The only possible answer which doesn't lose precision is the rational 2/3.",
    "created_at": "2014-12-04T07:42:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12883",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12883#issuecomment-154996",
    "user": "jdemeyer"
}
```

Losing precision is a *feature* of the `.n()` method, that's what it does. The `x.n()` method asks for a *numerical approximation* of `x` to a precision of 53 bits. This is easily explained. I also like the fact that neither the implementation nor the user should need to worry about what `x` is, the output is a real/complex number with 53 bits of precision.

If you think that `.n()` is wrong, what should `(2/3).n()` return then? The only possible answer which doesn't lose precision is the rational 2/3.



---

archive/issue_comments_154997.json:
```json
{
    "body": "About `hold=True`, that even doesn't seem to work with real numbers:\n\n```\nsage: gamma(1.2345678901234567890, hold=True)\n0.9097200568693150729\n```\n",
    "created_at": "2014-12-04T07:51:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12883",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12883#issuecomment-154997",
    "user": "jdemeyer"
}
```

About `hold=True`, that even doesn't seem to work with real numbers:

```
sage: gamma(1.2345678901234567890, hold=True)
0.9097200568693150729
```




---

archive/issue_comments_154998.json:
```json
{
    "body": "> About `hold=True`, that even doesn't seem to work with real numbers:\nExactly, which is why I didn't use that example.\n\nOkay, I don't have that much invested in this.   But then \n\n```\nsage: x = 1.2340000000000000000000001\nsage: x.n?\nDocstring:\n   Return a numerical approximation of x with at least prec bits of\n   precision.\n\n   EXAMPLES:\n\n      sage: (2/3).n()\n      0.666666666666667\n      sage: pi.n(digits=10)\n      3.141592654\n      sage: pi.n(prec=20)   # 20 bits\n      3.1416\n\n   TESTS:\n\n   Check that http://trac.sagemath.org/14778 is fixed:\n\n      sage: (0).n(algorithm='foo')\n      0.000000000000000\n```\n\nshould really be improved, and possibly the documentation for other versions of `.numerical_approx` as well.  Those are practically stubs!",
    "created_at": "2014-12-04T14:23:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12883",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12883#issuecomment-154998",
    "user": "kcrisman"
}
```

> About `hold=True`, that even doesn't seem to work with real numbers:
Exactly, which is why I didn't use that example.

Okay, I don't have that much invested in this.   But then 

```
sage: x = 1.2340000000000000000000001
sage: x.n?
Docstring:
   Return a numerical approximation of x with at least prec bits of
   precision.

   EXAMPLES:

      sage: (2/3).n()
      0.666666666666667
      sage: pi.n(digits=10)
      3.141592654
      sage: pi.n(prec=20)   # 20 bits
      3.1416

   TESTS:

   Check that http://trac.sagemath.org/14778 is fixed:

      sage: (0).n(algorithm='foo')
      0.000000000000000
```

should really be improved, and possibly the documentation for other versions of `.numerical_approx` as well.  Those are practically stubs!



---

archive/issue_comments_154999.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-12-04T14:23:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12883",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12883#issuecomment-154999",
    "user": "kcrisman"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_155000.json:
```json
{
    "body": "Changing priority from major to minor.",
    "created_at": "2014-12-04T14:23:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12883",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12883#issuecomment-155000",
    "user": "kcrisman"
}
```

Changing priority from major to minor.



---

archive/issue_comments_155001.json:
```json
{
    "body": "Changing component from symbolics to documentation.",
    "created_at": "2014-12-25T09:11:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12883",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12883#issuecomment-155001",
    "user": "rws"
}
```

Changing component from symbolics to documentation.



---

archive/issue_comments_155002.json:
```json
{
    "body": "Replying to [comment:14 kcrisman]:\n> Okay, I don't have that much invested in this.   But then `x.n?`\n> should really be improved, and possibly the documentation for other versions of `.numerical_approx` as well.  Those are practically stubs!\n\nThis is actually a general problem we have with Sage documentation: often one has similar functions/methods which all do the same thing (on different kinds of objects). In this case, the `numerical_approx` function in `src/sage/misc/functional.py` is much better documented. What's the optimal solution which doesn't simply replicate the documentation from `numerical_approx()`?",
    "created_at": "2015-03-09T10:43:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12883",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12883#issuecomment-155002",
    "user": "jdemeyer"
}
```

Replying to [comment:14 kcrisman]:
> Okay, I don't have that much invested in this.   But then `x.n?`
> should really be improved, and possibly the documentation for other versions of `.numerical_approx` as well.  Those are practically stubs!

This is actually a general problem we have with Sage documentation: often one has similar functions/methods which all do the same thing (on different kinds of objects). In this case, the `numerical_approx` function in `src/sage/misc/functional.py` is much better documented. What's the optimal solution which doesn't simply replicate the documentation from `numerical_approx()`?



---

archive/issue_comments_155003.json:
```json
{
    "body": "One other detail which is wrong in the \"at least\" in \"at least prec bits of precision\". Certainly for the global `numerical_approx()` function, it's **exactly** `prec` bits.",
    "created_at": "2015-03-09T10:45:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12883",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12883#issuecomment-155003",
    "user": "jdemeyer"
}
```

One other detail which is wrong in the "at least" in "at least prec bits of precision". Certainly for the global `numerical_approx()` function, it's **exactly** `prec` bits.



---

archive/issue_comments_155004.json:
```json
{
    "body": "Changing keywords from \"numerical_approx, sd40.5\" to \"numerical_approx, sd40.5, days74\".",
    "created_at": "2016-06-01T10:00:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12883",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12883#issuecomment-155004",
    "user": "jdemeyer"
}
```

Changing keywords from "numerical_approx, sd40.5" to "numerical_approx, sd40.5, days74".



---

archive/issue_comments_155005.json:
```json
{
    "body": "Changing component from documentation to basic arithmetic.",
    "created_at": "2016-06-01T12:42:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12883",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12883#issuecomment-155005",
    "user": "jdemeyer"
}
```

Changing component from documentation to basic arithmetic.



---

archive/issue_comments_155006.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-06-01T14:54:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12883",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12883#issuecomment-155006",
    "user": "jdemeyer"
}
```

New commits:



---

archive/issue_comments_155007.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-06-01T14:54:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12883",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12883#issuecomment-155007",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_155008.json:
```json
{
    "body": "Most of the changes look good to me, but I don't like the new description of `RealLiteral.numerical_approx()`: as far as I understand \u201creal literals\u201d are exact decimal numbers, so converting one to a `RealField` element with d\u00b7log\u2081\u2080\u00a02 bits of precision doesn't really \u201cchange its precision\u201d to d decimal digits.\n\nAnd\u2014just wondering, I have nothing against that choice\u2014is there a reason why you didn't put the generic implementation directly in `Element` (and put code to convert non-Elements to Elements before calling it when necessary)?",
    "created_at": "2016-06-02T10:18:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12883",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12883#issuecomment-155008",
    "user": "mmezzarobba"
}
```

Most of the changes look good to me, but I don't like the new description of `RealLiteral.numerical_approx()`: as far as I understand “real literals” are exact decimal numbers, so converting one to a `RealField` element with d·log₁₀ 2 bits of precision doesn't really “change its precision” to d decimal digits.

And—just wondering, I have nothing against that choice—is there a reason why you didn't put the generic implementation directly in `Element` (and put code to convert non-Elements to Elements before calling it when necessary)?



---

archive/issue_comments_155009.json:
```json
{
    "body": "Replying to [comment:24 mmezzarobba]:\n> is there a reason why you didn't put the generic implementation directly in `Element` (and put code to convert non-Elements to Elements before calling it when necessary)?\n\nBecause of the \"put code to convert non-Elements to Elements before calling it\" part. I don't know how to do that in general.",
    "created_at": "2016-06-02T11:40:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12883",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12883#issuecomment-155009",
    "user": "jdemeyer"
}
```

Replying to [comment:24 mmezzarobba]:
> is there a reason why you didn't put the generic implementation directly in `Element` (and put code to convert non-Elements to Elements before calling it when necessary)?

Because of the "put code to convert non-Elements to Elements before calling it" part. I don't know how to do that in general.



---

archive/issue_comments_155010.json:
```json
{
    "body": "**ping**",
    "created_at": "2016-08-01T11:42:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12883",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12883#issuecomment-155010",
    "user": "jdemeyer"
}
```

**ping**



---

archive/issue_comments_155011.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-08-02T06:13:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12883",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12883#issuecomment-155011",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_155012.json:
```json
{
    "body": "I still disagree about the docstring of `RealLiteral.numerical_approx()`, but let's not again delay the ticket by two months...",
    "created_at": "2016-08-04T09:27:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12883",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12883#issuecomment-155012",
    "user": "mmezzarobba"
}
```

I still disagree about the docstring of `RealLiteral.numerical_approx()`, but let's not again delay the ticket by two months...



---

archive/issue_comments_155013.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-08-04T09:27:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12883",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12883#issuecomment-155013",
    "user": "mmezzarobba"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_155014.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-08-07T20:00:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12883",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12883#issuecomment-155014",
    "user": "vbraun"
}
```

Resolution: fixed
