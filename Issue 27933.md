# Issue 27933: enhance is_postcritically_finite, critical_point_portrait, and multiplier_spectra to work over number fields and finite fields

Issue created by migration from https://trac.sagemath.org/ticket/28170

Original creator: @juliacai05

Original creation time: 2019-07-11 14:23:15

Keywords: SI2019

The following code does not work as mentioned functions currently go to the algebraic closure:


```
sage: F.<a> = QuadraticField(2)
sage: P.<x,y> = ProjectiveSpace(F, 1)
sage: f = DynamicalSystem_projective([-y^3, a*x^3 - 3*x^2*y + 3*x*y^2 - y^3])
sage: f.is_postcritically_finite()
```


```
sage: F.<a> = GF(7)
sage: P.<x,y> = ProjectiveSpace(F, 1)
sage: f = DynamicalSystem_projective([x^2 + y^2, y^2])
sage: f.multiplier_spectra(1)
```


We call field_of_definition_critical/field_of_definition_periodic on f to change ring to a finite extension instead of QQbar, so that functionality is preserved for number fields. 

Additionally, we add _is_preperiodic and is_postcritically_finite to the DynamicalSystem_projective_finite_field class: every point is preperiodic over a finite field, so both functions should return True. If return_period=True in _is_preperiodic, we call orbit_structure. 
In order to normalize output, we modify orbit_structure to return (m,n) as a tuple instead of a list. 

These changes allow is_postcritically_finite and multiplier_spectra to work over finite fields as well.


---

Comment by @juliacai05 created at 2019-07-18 13:14:08

Changing status from new to needs_review.


---

Comment by @juliacai05 created at 2019-07-18 13:14:08

New commits:


---

Comment by @meggrip created at 2019-07-18 13:46:24

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-07-20 22:08:50

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2019-07-20 22:08:50


```
sage -t --long --warn-long 49.7 src/sage/dynamics/arithmetic_dynamics/projective_ds.py
**********************************************************************
File "src/sage/dynamics/arithmetic_dynamics/projective_ds.py", line 264, in sage.dynamics.arithmetic_dynamics.projective_ds.?
Failed example:
    fbar.is_postcritically_finite()
Exception raised:
    Traceback (most recent call last):
      File "/home/release/Sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/release/Sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1105, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.dynamics.arithmetic_dynamics.projective_ds.?[32]>", line 1, in <module>
        fbar.is_postcritically_finite()
      File "/home/release/Sage/local/lib/python2.7/site-packages/sage/dynamics/arithmetic_dynamics/projective_ds.py", line 3105, in is_postcritically_finite
        embedding = self.field_of_definition_critical(return_embedding=True)[1]
      File "/home/release/Sage/local/lib/python2.7/site-packages/sage/dynamics/arithmetic_dynamics/generic_ds.py", line 412, in field_of_definition_critical
        K = poly.splitting_field(names, map=return_embedding, simplify_all=simplify_all)
      File "sage/rings/polynomial/polynomial_element.pyx", line 4548, in sage.rings.polynomial.polynomial_element.Polynomial.splitting_field (build/cythonized/sage/rings/polynomial/polynomial_element.c:38804)
        raise NotImplementedError("splitting_field() is only implemented over number fields and finite fields")
    NotImplementedError: splitting_field() is only implemented over number fields and finite fields
```



---

Comment by @juliacai05 created at 2019-07-25 14:51:57

Modified is_postcritically_finite to check if base ring of f is algebraically closed before attempting to change ring.


---

Comment by @juliacai05 created at 2019-07-25 14:51:57

Changing status from needs_work to needs_review.


---

Comment by @juliacai05 created at 2019-07-25 15:15:07

New commits:


---

Comment by git created at 2019-07-30 15:49:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bhutz created at 2019-07-30 18:52:27

Changing status from needs_review to needs_work.


---

Comment by bhutz created at 2019-07-30 18:52:27

err...looks like you got the affine degree function mixed in with your code for this ticket. That needs to be removed.


---

Comment by git created at 2019-07-31 15:20:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @juliacai05 created at 2019-07-31 15:25:14

affine degree function code from 28163 removed


---

Comment by @juliacai05 created at 2019-07-31 15:25:14

Changing status from needs_work to needs_review.


---

Comment by jdoyle created at 2019-07-31 15:49:29

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-08-03 14:21:48

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2019-08-03 14:21:48

Merge conflict, please merge in the next beta...


---

Comment by git created at 2019-11-19 17:56:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bhutz created at 2019-11-19 18:01:38

Since it was often very slow over the splitting fielded made the default to be the algebraic closure with the option of using the splitting field. Added a number of examples.

Adjusted the field_of_definition functions to return the base if it is already the algebraic closure.

This is ready for another set of eyes.


---

Comment by bhutz created at 2019-11-19 18:01:38

Changing status from needs_work to needs_review.


---

Comment by bhutz created at 2019-11-19 18:04:51

Changing keywords from "SI2019" to "SI2019, sd104".


---

Comment by @JohnClarkSage created at 2019-11-19 23:17:02

Changing status from needs_review to needs_work.


---

Comment by @JohnClarkSage created at 2019-11-19 23:17:02

The following code gives an error:
 

```
sage: P.<x,y> = ProjectiveSpace(GF(13),1)
sage: f = DynamicalSystem_projective([x^4 - x^2*y^2 + y^4, y^4])
sage: f.is_postcritically_finite(use_algebraic_closure=False)
TypeError: is_postcritically_finite() got an unexpected keyword argument 'use_algebraic_closure'
```



This should not give an error when giving the keyword 'use_algebraic_closure', and should instead return True regardless. Every point is postcritically finite in a finite field.


---

Comment by git created at 2019-11-20 13:38:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bhutz created at 2019-11-20 13:38:44

Changing status from needs_work to needs_review.


---

Comment by @JohnClarkSage created at 2019-11-20 16:28:21

All tests pass.


---

Comment by @JohnClarkSage created at 2019-11-20 16:28:21

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-11-30 13:35:57

Resolution: fixed
