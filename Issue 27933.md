# Issue 27933: enhance is_postcritically_finite, critical_point_portrait, and multiplier_spectra to work over number fields and finite fields

archive/issues_027933.json:
```json
{
    "body": "Keywords: SI2019\n\nThe following code does not work as mentioned functions currently go to the algebraic closure:\n\n\n```\nsage: F.<a> = QuadraticField(2)\nsage: P.<x,y> = ProjectiveSpace(F, 1)\nsage: f = DynamicalSystem_projective([-y^3, a*x^3 - 3*x^2*y + 3*x*y^2 - y^3])\nsage: f.is_postcritically_finite()\n```\n\n\n```\nsage: F.<a> = GF(7)\nsage: P.<x,y> = ProjectiveSpace(F, 1)\nsage: f = DynamicalSystem_projective([x^2 + y^2, y^2])\nsage: f.multiplier_spectra(1)\n```\n\n\nWe call field_of_definition_critical/field_of_definition_periodic on f to change ring to a finite extension instead of QQbar, so that functionality is preserved for number fields. \n\nAdditionally, we add _is_preperiodic and is_postcritically_finite to the DynamicalSystem_projective_finite_field class: every point is preperiodic over a finite field, so both functions should return True. If return_period=True in _is_preperiodic, we call orbit_structure. \nIn order to normalize output, we modify orbit_structure to return (m,n) as a tuple instead of a list. \n\nThese changes allow is_postcritically_finite and multiplier_spectra to work over finite fields as well.\n\nIssue created by migration from https://trac.sagemath.org/ticket/28170\n\n",
    "created_at": "2019-07-11T14:23:15Z",
    "labels": [
        "dynamics",
        "minor",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.0",
    "title": "enhance is_postcritically_finite, critical_point_portrait, and multiplier_spectra to work over number fields and finite fields",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27933",
    "user": "@juliacai05"
}
```
Keywords: SI2019

The following code does not work as mentioned functions currently go to the algebraic closure:


```
sage: F.<a> = QuadraticField(2)
sage: P.<x,y> = ProjectiveSpace(F, 1)
sage: f = DynamicalSystem_projective([-y^3, a*x^3 - 3*x^2*y + 3*x*y^2 - y^3])
sage: f.is_postcritically_finite()
```


```
sage: F.<a> = GF(7)
sage: P.<x,y> = ProjectiveSpace(F, 1)
sage: f = DynamicalSystem_projective([x^2 + y^2, y^2])
sage: f.multiplier_spectra(1)
```


We call field_of_definition_critical/field_of_definition_periodic on f to change ring to a finite extension instead of QQbar, so that functionality is preserved for number fields. 

Additionally, we add _is_preperiodic and is_postcritically_finite to the DynamicalSystem_projective_finite_field class: every point is preperiodic over a finite field, so both functions should return True. If return_period=True in _is_preperiodic, we call orbit_structure. 
In order to normalize output, we modify orbit_structure to return (m,n) as a tuple instead of a list. 

These changes allow is_postcritically_finite and multiplier_spectra to work over finite fields as well.

Issue created by migration from https://trac.sagemath.org/ticket/28170





---

archive/issue_comments_394464.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-07-18T13:14:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27933#issuecomment-394464",
    "user": "@juliacai05"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_394465.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-07-18T13:14:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27933#issuecomment-394465",
    "user": "@juliacai05"
}
```

New commits:



---

archive/issue_comments_394466.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-07-18T13:46:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27933#issuecomment-394466",
    "user": "@meggrip"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_394467.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-07-20T22:08:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27933#issuecomment-394467",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_394468.json:
```json
{
    "body": "\n```\nsage -t --long --warn-long 49.7 src/sage/dynamics/arithmetic_dynamics/projective_ds.py\n**********************************************************************\nFile \"src/sage/dynamics/arithmetic_dynamics/projective_ds.py\", line 264, in sage.dynamics.arithmetic_dynamics.projective_ds.?\nFailed example:\n    fbar.is_postcritically_finite()\nException raised:\n    Traceback (most recent call last):\n      File \"/home/release/Sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/release/Sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1105, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.dynamics.arithmetic_dynamics.projective_ds.?[32]>\", line 1, in <module>\n        fbar.is_postcritically_finite()\n      File \"/home/release/Sage/local/lib/python2.7/site-packages/sage/dynamics/arithmetic_dynamics/projective_ds.py\", line 3105, in is_postcritically_finite\n        embedding = self.field_of_definition_critical(return_embedding=True)[1]\n      File \"/home/release/Sage/local/lib/python2.7/site-packages/sage/dynamics/arithmetic_dynamics/generic_ds.py\", line 412, in field_of_definition_critical\n        K = poly.splitting_field(names, map=return_embedding, simplify_all=simplify_all)\n      File \"sage/rings/polynomial/polynomial_element.pyx\", line 4548, in sage.rings.polynomial.polynomial_element.Polynomial.splitting_field (build/cythonized/sage/rings/polynomial/polynomial_element.c:38804)\n        raise NotImplementedError(\"splitting_field() is only implemented over number fields and finite fields\")\n    NotImplementedError: splitting_field() is only implemented over number fields and finite fields\n```\n",
    "created_at": "2019-07-20T22:08:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27933#issuecomment-394468",
    "user": "vbraun"
}
```


```
sage -t --long --warn-long 49.7 src/sage/dynamics/arithmetic_dynamics/projective_ds.py
**********************************************************************
File "src/sage/dynamics/arithmetic_dynamics/projective_ds.py", line 264, in sage.dynamics.arithmetic_dynamics.projective_ds.?
Failed example:
    fbar.is_postcritically_finite()
Exception raised:
    Traceback (most recent call last):
      File "/home/release/Sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/release/Sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1105, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.dynamics.arithmetic_dynamics.projective_ds.?[32]>", line 1, in <module>
        fbar.is_postcritically_finite()
      File "/home/release/Sage/local/lib/python2.7/site-packages/sage/dynamics/arithmetic_dynamics/projective_ds.py", line 3105, in is_postcritically_finite
        embedding = self.field_of_definition_critical(return_embedding=True)[1]
      File "/home/release/Sage/local/lib/python2.7/site-packages/sage/dynamics/arithmetic_dynamics/generic_ds.py", line 412, in field_of_definition_critical
        K = poly.splitting_field(names, map=return_embedding, simplify_all=simplify_all)
      File "sage/rings/polynomial/polynomial_element.pyx", line 4548, in sage.rings.polynomial.polynomial_element.Polynomial.splitting_field (build/cythonized/sage/rings/polynomial/polynomial_element.c:38804)
        raise NotImplementedError("splitting_field() is only implemented over number fields and finite fields")
    NotImplementedError: splitting_field() is only implemented over number fields and finite fields
```




---

archive/issue_comments_394469.json:
```json
{
    "body": "Modified is_postcritically_finite to check if base ring of f is algebraically closed before attempting to change ring.",
    "created_at": "2019-07-25T14:51:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27933#issuecomment-394469",
    "user": "@juliacai05"
}
```

Modified is_postcritically_finite to check if base ring of f is algebraically closed before attempting to change ring.



---

archive/issue_comments_394470.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-07-25T14:51:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27933#issuecomment-394470",
    "user": "@juliacai05"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_394471.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-07-25T15:15:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27933#issuecomment-394471",
    "user": "@juliacai05"
}
```

New commits:



---

archive/issue_comments_394472.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-07-30T15:49:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27933#issuecomment-394472",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_394473.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-07-30T18:52:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27933#issuecomment-394473",
    "user": "bhutz"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_394474.json:
```json
{
    "body": "err...looks like you got the affine degree function mixed in with your code for this ticket. That needs to be removed.",
    "created_at": "2019-07-30T18:52:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27933#issuecomment-394474",
    "user": "bhutz"
}
```

err...looks like you got the affine degree function mixed in with your code for this ticket. That needs to be removed.



---

archive/issue_comments_394475.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-07-31T15:20:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27933#issuecomment-394475",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_394476.json:
```json
{
    "body": "affine degree function code from 28163 removed",
    "created_at": "2019-07-31T15:25:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27933#issuecomment-394476",
    "user": "@juliacai05"
}
```

affine degree function code from 28163 removed



---

archive/issue_comments_394477.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-07-31T15:25:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27933#issuecomment-394477",
    "user": "@juliacai05"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_394478.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-07-31T15:49:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27933#issuecomment-394478",
    "user": "jdoyle"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_394479.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-08-03T14:21:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27933#issuecomment-394479",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_394480.json:
```json
{
    "body": "Merge conflict, please merge in the next beta...",
    "created_at": "2019-08-03T14:21:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27933#issuecomment-394480",
    "user": "vbraun"
}
```

Merge conflict, please merge in the next beta...



---

archive/issue_comments_394481.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-11-19T17:56:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27933#issuecomment-394481",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_394482.json:
```json
{
    "body": "Since it was often very slow over the splitting fielded made the default to be the algebraic closure with the option of using the splitting field. Added a number of examples.\n\nAdjusted the field_of_definition functions to return the base if it is already the algebraic closure.\n\nThis is ready for another set of eyes.",
    "created_at": "2019-11-19T18:01:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27933#issuecomment-394482",
    "user": "bhutz"
}
```

Since it was often very slow over the splitting fielded made the default to be the algebraic closure with the option of using the splitting field. Added a number of examples.

Adjusted the field_of_definition functions to return the base if it is already the algebraic closure.

This is ready for another set of eyes.



---

archive/issue_comments_394483.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-11-19T18:01:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27933#issuecomment-394483",
    "user": "bhutz"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_394484.json:
```json
{
    "body": "Changing keywords from \"SI2019\" to \"SI2019, sd104\".",
    "created_at": "2019-11-19T18:04:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27933#issuecomment-394484",
    "user": "bhutz"
}
```

Changing keywords from "SI2019" to "SI2019, sd104".



---

archive/issue_comments_394485.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-11-19T23:17:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27933#issuecomment-394485",
    "user": "@JohnClarkSage"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_394486.json:
```json
{
    "body": "The following code gives an error:\n \n\n```\nsage: P.<x,y> = ProjectiveSpace(GF(13),1)\nsage: f = DynamicalSystem_projective([x^4 - x^2*y^2 + y^4, y^4])\nsage: f.is_postcritically_finite(use_algebraic_closure=False)\nTypeError: is_postcritically_finite() got an unexpected keyword argument 'use_algebraic_closure'\n```\n\n\n\nThis should not give an error when giving the keyword 'use_algebraic_closure', and should instead return True regardless. Every point is postcritically finite in a finite field.",
    "created_at": "2019-11-19T23:17:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27933#issuecomment-394486",
    "user": "@JohnClarkSage"
}
```

The following code gives an error:
 

```
sage: P.<x,y> = ProjectiveSpace(GF(13),1)
sage: f = DynamicalSystem_projective([x^4 - x^2*y^2 + y^4, y^4])
sage: f.is_postcritically_finite(use_algebraic_closure=False)
TypeError: is_postcritically_finite() got an unexpected keyword argument 'use_algebraic_closure'
```



This should not give an error when giving the keyword 'use_algebraic_closure', and should instead return True regardless. Every point is postcritically finite in a finite field.



---

archive/issue_comments_394487.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-11-20T13:38:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27933#issuecomment-394487",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_394488.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-11-20T13:38:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27933#issuecomment-394488",
    "user": "bhutz"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_394489.json:
```json
{
    "body": "All tests pass.",
    "created_at": "2019-11-20T16:28:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27933#issuecomment-394489",
    "user": "@JohnClarkSage"
}
```

All tests pass.



---

archive/issue_comments_394490.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-11-20T16:28:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27933#issuecomment-394490",
    "user": "@JohnClarkSage"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_394491.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-11-30T13:35:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27933#issuecomment-394491",
    "user": "vbraun"
}
```

Resolution: fixed
