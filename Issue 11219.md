# Issue 11219: error building sage 4.7: undefined symbol: _ZN23Parma_Polyhedra_Library13have_sse_unitE

archive/issues_011219.json:
```json
{
    "body": "Assignee: GeorgSWeber\n\nCC:  aginiewicz\n\nI am using the sage 4.7 release.\nI'm trying to package sage for archlinux, and the x86_64 version compiled fine. But the i686 version of the package failed with the error described here:\nhttp://groups.google.com/group/sage-devel/browse_thread/thread/84b2f4d94d50e735\n\nThe complete install.log can be found here:\nhttp://pkgbuild.com/~td123/install.log.gz\n\nThe relevant install.log portion (the error message) is:\nhttp://pastie.org/pastes/1980914/text\n\nIssue created by migration from https://trac.sagemath.org/ticket/11391\n\n",
    "created_at": "2011-05-27T15:08:58Z",
    "labels": [
        "build",
        "major",
        "bug"
    ],
    "title": "error building sage 4.7: undefined symbol: _ZN23Parma_Polyhedra_Library13have_sse_unitE",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11219",
    "user": "gostrc"
}
```
Assignee: GeorgSWeber

CC:  aginiewicz

I am using the sage 4.7 release.
I'm trying to package sage for archlinux, and the x86_64 version compiled fine. But the i686 version of the package failed with the error described here:
http://groups.google.com/group/sage-devel/browse_thread/thread/84b2f4d94d50e735

The complete install.log can be found here:
http://pkgbuild.com/~td123/install.log.gz

The relevant install.log portion (the error message) is:
http://pastie.org/pastes/1980914/text

Issue created by migration from https://trac.sagemath.org/ticket/11391





---

archive/issue_comments_123508.json:
```json
{
    "body": "A temporary fix for me before running `make' was to do the following:\n  mkdir -p spkg/installed\n  touch spkg/installed/ppl-0.11.2",
    "created_at": "2011-05-27T19:32:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11219#issuecomment-123508",
    "user": "gostrc"
}
```

A temporary fix for me before running `make' was to do the following:
  mkdir -p spkg/installed
  touch spkg/installed/ppl-0.11.2



---

archive/issue_comments_123509.json:
```json
{
    "body": "It seems that with sage 4.8, this workaround doesn't work anymore.\nI attached the output I get when building on i686 without the above workaround.\n(sage.output.i686)",
    "created_at": "2012-01-20T20:36:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11219#issuecomment-123509",
    "user": "gostrc"
}
```

It seems that with sage 4.8, this workaround doesn't work anymore.
I attached the output I get when building on i686 without the above workaround.
(sage.output.i686)



---

archive/issue_comments_123510.json:
```json
{
    "body": "Attachment\n\nThis is what I get when trying to compile with the workaround:\n\n\n```\nmkdir -p spkg/installed\ntouch spkg/installed/ppl-0.11.2.p0\n```\n\n\nOutput:\n\n\n```\nInstalling c_lib\nscons: `install' is up to date.\nUpdating Cython code....\nExecuting 0 commands (using 0 threads)\nTime to execute 0 commands: 0.0769848823547 seconds\nFinished compiling Cython code (time = 0.446054935455 seconds)\nrunning install\nrunning build\nrunning build_py\nrunning build_ext\nbuilding 'sage.libs.ppl' extension\nExecuting 1 command (using 1 thread)\nerror: /build/src/sage-4.8/local/include/ppl.hh: No such file or directory\nsage: There was an error installing modified sage library code.\n\nmake: *** [build] Error 1\n```\n\n\nattached the full build output as sage.output.i686.workaround.gz",
    "created_at": "2012-01-24T19:32:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11219#issuecomment-123510",
    "user": "gostrc"
}
```

Attachment

This is what I get when trying to compile with the workaround:


```
mkdir -p spkg/installed
touch spkg/installed/ppl-0.11.2.p0
```


Output:


```
Installing c_lib
scons: `install' is up to date.
Updating Cython code....
Executing 0 commands (using 0 threads)
Time to execute 0 commands: 0.0769848823547 seconds
Finished compiling Cython code (time = 0.446054935455 seconds)
running install
running build
running build_py
running build_ext
building 'sage.libs.ppl' extension
Executing 1 command (using 1 thread)
error: /build/src/sage-4.8/local/include/ppl.hh: No such file or directory
sage: There was an error installing modified sage library code.

make: *** [build] Error 1
```


attached the full build output as sage.output.i686.workaround.gz



---

archive/issue_comments_123511.json:
```json
{
    "body": "Attachment\n\njust rebuilt 4.7.2 and it works, so this was introduced in 4.8 for sure.",
    "created_at": "2012-01-25T14:22:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11219#issuecomment-123511",
    "user": "gostrc"
}
```

Attachment

just rebuilt 4.7.2 and it works, so this was introduced in 4.8 for sure.



---

archive/issue_comments_123512.json:
```json
{
    "body": "I think that the following post (for OpenSuse 12.1) mentions exactly the same underlying problem:\n\n http://groups.google.com/group/sage-devel/browse_thread/thread/a7017c8f3b0a16c0\n\nIt seems that from Sage 4.8 on, the ppl (Parma Polyhedra Library) got interfaced by the Sage core. So the \"workaround\" to not build the ppl spkg at all (\"touch spkg/installed/ppl-0.11.2.p0\") simply won't work for Sage 4.8 and later (since the respective headers are needed)!\n\nAs long as the ppl library included in Sage and the ppl library of the host OS do not differ too much (they seem to be \"close enough\" right now in the known cases Arch Linx, OpenSuse 11.4 - 12.1), one probably could use a different workaround:\n\na) *do* build the ppl spkg (in order to get the header files in place)\n\nb) after that (just waiting for the \"breakage\" might be sufficient), replace the library binary (\"libppl.so.9.0.0\" or so) under $SAGE_LOCAL/lib/ with a symlink to the host OS'es libppl.\n\nFor some \"correct\" solution, one would either have to update the ppl spkg to install a newer version of ppl, to match the one of the host OS(es) --- somewhat a \"moving target\" (we might end up with having to provide several different versions of ppl in the spkg).\n\nOr provide the technical foundation so that the libraries brought with Sage do not (i.e. no longer) interfere with libraries on the host OS (the ticket #10572 describes one of several ways to do so).\n\n\nCheers,\n\nGeorg",
    "created_at": "2012-02-05T21:28:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11219#issuecomment-123512",
    "user": "GeorgSWeber"
}
```

I think that the following post (for OpenSuse 12.1) mentions exactly the same underlying problem:

 http://groups.google.com/group/sage-devel/browse_thread/thread/a7017c8f3b0a16c0

It seems that from Sage 4.8 on, the ppl (Parma Polyhedra Library) got interfaced by the Sage core. So the "workaround" to not build the ppl spkg at all ("touch spkg/installed/ppl-0.11.2.p0") simply won't work for Sage 4.8 and later (since the respective headers are needed)!

As long as the ppl library included in Sage and the ppl library of the host OS do not differ too much (they seem to be "close enough" right now in the known cases Arch Linx, OpenSuse 11.4 - 12.1), one probably could use a different workaround:

a) *do* build the ppl spkg (in order to get the header files in place)

b) after that (just waiting for the "breakage" might be sufficient), replace the library binary ("libppl.so.9.0.0" or so) under $SAGE_LOCAL/lib/ with a symlink to the host OS'es libppl.

For some "correct" solution, one would either have to update the ppl spkg to install a newer version of ppl, to match the one of the host OS(es) --- somewhat a "moving target" (we might end up with having to provide several different versions of ppl in the spkg).

Or provide the technical foundation so that the libraries brought with Sage do not (i.e. no longer) interfere with libraries on the host OS (the ticket #10572 describes one of several ways to do so).


Cheers,

Georg



---

archive/issue_comments_123513.json:
```json
{
    "body": "I don't know if this is a known thing, but one of Arch Linux users (going by name Snowball on AUR, the Arch Linux User Repository) posted a working solution for ppl problem on i686, and it is quite a simple change to ppl spkg:\n\n\n```\nsed -i 's/--enable-interfaces=c++/--enable-interfaces=\"c++ c\"/' ppl-0.11.2.p0/spkg-install\n```\n\n\nI tested this in i686 VM of Arch Linux and can confirm that with this change to ppl spkg it works (right now Sage 4.8 still builds, but it got past pycrypto where it failed before). Unfortunately right now I don't have time to post an updated spkg, but I decided to let others know about it anyway.",
    "created_at": "2012-03-16T14:12:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11219#issuecomment-123513",
    "user": "aginiewicz"
}
```

I don't know if this is a known thing, but one of Arch Linux users (going by name Snowball on AUR, the Arch Linux User Repository) posted a working solution for ppl problem on i686, and it is quite a simple change to ppl spkg:


```
sed -i 's/--enable-interfaces=c++/--enable-interfaces="c++ c"/' ppl-0.11.2.p0/spkg-install
```


I tested this in i686 VM of Arch Linux and can confirm that with this change to ppl spkg it works (right now Sage 4.8 still builds, but it got past pycrypto where it failed before). Unfortunately right now I don't have time to post an updated spkg, but I decided to let others know about it anyway.



---

archive/issue_comments_123514.json:
```json
{
    "body": "I finished building 4.8 without any issue on current Arch Linux i686, also found some time so I decided to refresh my knowledge and package new ppl. The spkg with mentioned fix is here: https://github.com/downloads/aginiewicz/spkgs/ppl-0.11.2.p2.spkg - I hope I still remember how to package for Sage.",
    "created_at": "2012-03-16T16:31:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11219#issuecomment-123514",
    "user": "aginiewicz"
}
```

I finished building 4.8 without any issue on current Arch Linux i686, also found some time so I decided to refresh my knowledge and package new ppl. The spkg with mentioned fix is here: https://github.com/downloads/aginiewicz/spkgs/ppl-0.11.2.p2.spkg - I hope I still remember how to package for Sage.



---

archive/issue_comments_123515.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-03-16T16:31:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11219#issuecomment-123515",
    "user": "aginiewicz"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_123516.json:
```json
{
    "body": "Changing component from build to packages.",
    "created_at": "2012-05-16T14:11:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11219#issuecomment-123516",
    "user": "kini"
}
```

Changing component from build to packages.



---

archive/issue_comments_123517.json:
```json
{
    "body": "This is a duplicate of #12672 (which has the same solution for a different problem).",
    "created_at": "2012-06-19T12:17:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11219#issuecomment-123517",
    "user": "jdemeyer"
}
```

This is a duplicate of #12672 (which has the same solution for a different problem).



---

archive/issue_comments_123518.json:
```json
{
    "body": "Replying to [comment:9 jdemeyer]:\n> This is a duplicate of #12672 (which has the same solution for a different problem).\n\nI think it is not a duplicate. #12672 is about building the C interface of PPL, which is currently not done. Solving build problems on some platforms is an orthogonal problem, IMHO.",
    "created_at": "2012-07-26T16:20:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11219#issuecomment-123518",
    "user": "SimonKing"
}
```

Replying to [comment:9 jdemeyer]:
> This is a duplicate of #12672 (which has the same solution for a different problem).

I think it is not a duplicate. #12672 is about building the C interface of PPL, which is currently not done. Solving build problems on some platforms is an orthogonal problem, IMHO.



---

archive/issue_comments_123519.json:
```json
{
    "body": "Replying to [comment:10 SimonKing]:\n> Replying to [comment:9 jdemeyer]:\n> > This is a duplicate of #12672 (which has the same solution for a different problem).\n> \n> I think it is not a duplicate. #12672 is about building the C interface of PPL, which is currently not done. Solving build problems on some platforms is an orthogonal problem, IMHO.\nAs I said, ticket #12672 has **the same solution** for a **different** problem.",
    "created_at": "2012-07-26T19:41:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11219#issuecomment-123519",
    "user": "jdemeyer"
}
```

Replying to [comment:10 SimonKing]:
> Replying to [comment:9 jdemeyer]:
> > This is a duplicate of #12672 (which has the same solution for a different problem).
> 
> I think it is not a duplicate. #12672 is about building the C interface of PPL, which is currently not done. Solving build problems on some platforms is an orthogonal problem, IMHO.
As I said, ticket #12672 has **the same solution** for a **different** problem.



---

archive/issue_comments_123520.json:
```json
{
    "body": "Aha, now I see the comment of aginiewicz: \"a working solution for ppl problem on i686, and it is quite a simple change to ppl spkg:\n\n```\nsed -i 's/--enable-interfaces=c++/--enable-interfaces=\"c++ c\"/' ppl-0.11.2.p0/spkg-install\n```\n\nSo, you are right, it is about building interfaces, in order to achieve something else.\n\nSince #12672 has an spkg (even though it fails on OS X because of missing m4): What shall we do? Close this ticket as a duplicate? Leave both open? Do we need an m4 spkg?",
    "created_at": "2012-07-26T20:07:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11219#issuecomment-123520",
    "user": "SimonKing"
}
```

Aha, now I see the comment of aginiewicz: "a working solution for ppl problem on i686, and it is quite a simple change to ppl spkg:

```
sed -i 's/--enable-interfaces=c++/--enable-interfaces="c++ c"/' ppl-0.11.2.p0/spkg-install
```

So, you are right, it is about building interfaces, in order to achieve something else.

Since #12672 has an spkg (even though it fails on OS X because of missing m4): What shall we do? Close this ticket as a duplicate? Leave both open? Do we need an m4 spkg?



---

archive/issue_comments_123521.json:
```json
{
    "body": "Replying to [comment:12 SimonKing]:\n> Do we need an m4 spkg?\nI think we should have an m4 spkg, but most people disagree (there was a mailing list post on this).",
    "created_at": "2012-07-27T06:35:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11219#issuecomment-123521",
    "user": "jdemeyer"
}
```

Replying to [comment:12 SimonKing]:
> Do we need an m4 spkg?
I think we should have an m4 spkg, but most people disagree (there was a mailing list post on this).



---

archive/issue_comments_123522.json:
```json
{
    "body": "Please fill in your real name as Author.",
    "created_at": "2012-07-27T20:42:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11219#issuecomment-123522",
    "user": "jdemeyer"
}
```

Please fill in your real name as Author.



---

archive/issue_comments_123523.json:
```json
{
    "body": "Just got another report of this error on the mailing list.  We really should fix this.",
    "created_at": "2012-10-06T21:51:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11219#issuecomment-123523",
    "user": "jdemeyer"
}
```

Just got another report of this error on the mailing list.  We really should fix this.



---

archive/issue_comments_123524.json:
```json
{
    "body": "Would #12672 work, modulo providing an m4 spkg on OS X?",
    "created_at": "2012-10-07T11:01:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11219#issuecomment-123524",
    "user": "SimonKing"
}
```

Would #12672 work, modulo providing an m4 spkg on OS X?



---

archive/issue_comments_123525.json:
```json
{
    "body": "The difference between spkg in #12672 and spkg I posted in comment:7 (that contains fix used by Arch Linux package, i.e. is tested in production environment) is only \"make install\" vs \"make install-strip\", so I'd say yes - both spkgs fixes this and #12672 - but both would have issues with m4 on OS X.",
    "created_at": "2012-10-07T14:37:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11219#issuecomment-123525",
    "user": "aginiewicz"
}
```

The difference between spkg in #12672 and spkg I posted in comment:7 (that contains fix used by Arch Linux package, i.e. is tested in production environment) is only "make install" vs "make install-strip", so I'd say yes - both spkgs fixes this and #12672 - but both would have issues with m4 on OS X.



---

archive/issue_comments_123526.json:
```json
{
    "body": "Replying to [comment:17 SimonKing]:\n> Would #12672 work, modulo providing an m4 spkg on OS X?\nAbsolutely.\n\nJust got another report of this error on the mailing list. We really should fix this.",
    "created_at": "2013-01-27T21:04:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11219#issuecomment-123526",
    "user": "jdemeyer"
}
```

Replying to [comment:17 SimonKing]:
> Would #12672 work, modulo providing an m4 spkg on OS X?
Absolutely.

Just got another report of this error on the mailing list. We really should fix this.



---

archive/issue_comments_123527.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-02-05T19:24:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11219#issuecomment-123527",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_123528.json:
```json
{
    "body": "Fixed by #14232.",
    "created_at": "2013-06-04T15:07:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11219#issuecomment-123528",
    "user": "jdemeyer"
}
```

Fixed by #14232.



---

archive/issue_comments_123529.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2013-06-04T15:07:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11219#issuecomment-123529",
    "user": "jdemeyer"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_123530.json:
```json
{
    "body": "Resolution: duplicate",
    "created_at": "2013-06-06T12:40:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11219#issuecomment-123530",
    "user": "jdemeyer"
}
```

Resolution: duplicate
