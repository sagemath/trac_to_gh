# Issue 11219: error building sage 4.7: undefined symbol: _ZN23Parma_Polyhedra_Library13have_sse_unitE

Issue created by migration from Trac.

Original creator: gostrc

Original creation time: 2011-05-27 15:08:58

Assignee: GeorgSWeber

CC:  aginiewicz

I am using the sage 4.7 release.
I'm trying to package sage for archlinux, and the x86_64 version compiled fine. But the i686 version of the package failed with the error described here:
http://groups.google.com/group/sage-devel/browse_thread/thread/84b2f4d94d50e735

The complete install.log can be found here:
http://pkgbuild.com/~td123/install.log.gz

The relevant install.log portion (the error message) is:
http://pastie.org/pastes/1980914/text


---

Comment by gostrc created at 2011-05-27 19:32:22

A temporary fix for me before running `make' was to do the following:
  mkdir -p spkg/installed
  touch spkg/installed/ppl-0.11.2


---

Comment by gostrc created at 2012-01-20 20:36:27

It seems that with sage 4.8, this workaround doesn't work anymore.
I attached the output I get when building on i686 without the above workaround.
(sage.output.i686)


---

Attachment

This is what I get when trying to compile with the workaround:


```
mkdir -p spkg/installed
touch spkg/installed/ppl-0.11.2.p0
```


Output:


```
Installing c_lib
scons: `install' is up to date.
Updating Cython code....
Executing 0 commands (using 0 threads)
Time to execute 0 commands: 0.0769848823547 seconds
Finished compiling Cython code (time = 0.446054935455 seconds)
running install
running build
running build_py
running build_ext
building 'sage.libs.ppl' extension
Executing 1 command (using 1 thread)
error: /build/src/sage-4.8/local/include/ppl.hh: No such file or directory
sage: There was an error installing modified sage library code.

make: *** [build] Error 1
```


attached the full build output as sage.output.i686.workaround.gz


---

Attachment

just rebuilt 4.7.2 and it works, so this was introduced in 4.8 for sure.


---

Comment by GeorgSWeber created at 2012-02-05 21:28:20

I think that the following post (for OpenSuse 12.1) mentions exactly the same underlying problem:

 http://groups.google.com/group/sage-devel/browse_thread/thread/a7017c8f3b0a16c0

It seems that from Sage 4.8 on, the ppl (Parma Polyhedra Library) got interfaced by the Sage core. So the "workaround" to not build the ppl spkg at all ("touch spkg/installed/ppl-0.11.2.p0") simply won't work for Sage 4.8 and later (since the respective headers are needed)!

As long as the ppl library included in Sage and the ppl library of the host OS do not differ too much (they seem to be "close enough" right now in the known cases Arch Linx, OpenSuse 11.4 - 12.1), one probably could use a different workaround:

a) *do* build the ppl spkg (in order to get the header files in place)

b) after that (just waiting for the "breakage" might be sufficient), replace the library binary ("libppl.so.9.0.0" or so) under $SAGE_LOCAL/lib/ with a symlink to the host OS'es libppl.

For some "correct" solution, one would either have to update the ppl spkg to install a newer version of ppl, to match the one of the host OS(es) --- somewhat a "moving target" (we might end up with having to provide several different versions of ppl in the spkg).

Or provide the technical foundation so that the libraries brought with Sage do not (i.e. no longer) interfere with libraries on the host OS (the ticket #10572 describes one of several ways to do so).


Cheers,

Georg


---

Comment by aginiewicz created at 2012-03-16 14:12:45

I don't know if this is a known thing, but one of Arch Linux users (going by name Snowball on AUR, the Arch Linux User Repository) posted a working solution for ppl problem on i686, and it is quite a simple change to ppl spkg:


```
sed -i 's/--enable-interfaces=c++/--enable-interfaces="c++ c"/' ppl-0.11.2.p0/spkg-install
```


I tested this in i686 VM of Arch Linux and can confirm that with this change to ppl spkg it works (right now Sage 4.8 still builds, but it got past pycrypto where it failed before). Unfortunately right now I don't have time to post an updated spkg, but I decided to let others know about it anyway.


---

Comment by aginiewicz created at 2012-03-16 16:31:08

I finished building 4.8 without any issue on current Arch Linux i686, also found some time so I decided to refresh my knowledge and package new ppl. The spkg with mentioned fix is here: https://github.com/downloads/aginiewicz/spkgs/ppl-0.11.2.p2.spkg - I hope I still remember how to package for Sage.


---

Comment by aginiewicz created at 2012-03-16 16:31:08

Changing status from new to needs_review.


---

Comment by kini created at 2012-05-16 14:11:39

Changing component from build to packages.


---

Comment by jdemeyer created at 2012-06-19 12:17:57

This is a duplicate of #12672 (which has the same solution for a different problem).


---

Comment by SimonKing created at 2012-07-26 16:20:17

Replying to [comment:9 jdemeyer]:
> This is a duplicate of #12672 (which has the same solution for a different problem).

I think it is not a duplicate. #12672 is about building the C interface of PPL, which is currently not done. Solving build problems on some platforms is an orthogonal problem, IMHO.


---

Comment by jdemeyer created at 2012-07-26 19:41:01

Replying to [comment:10 SimonKing]:
> Replying to [comment:9 jdemeyer]:
> > This is a duplicate of #12672 (which has the same solution for a different problem).
> 
> I think it is not a duplicate. #12672 is about building the C interface of PPL, which is currently not done. Solving build problems on some platforms is an orthogonal problem, IMHO.
As I said, ticket #12672 has *the same solution* for a *different* problem.


---

Comment by SimonKing created at 2012-07-26 20:07:27

Aha, now I see the comment of aginiewicz: "a working solution for ppl problem on i686, and it is quite a simple change to ppl spkg:

```
sed -i 's/--enable-interfaces=c++/--enable-interfaces="c++ c"/' ppl-0.11.2.p0/spkg-install
```

So, you are right, it is about building interfaces, in order to achieve something else.

Since #12672 has an spkg (even though it fails on OS X because of missing m4): What shall we do? Close this ticket as a duplicate? Leave both open? Do we need an m4 spkg?


---

Comment by jdemeyer created at 2012-07-27 06:35:47

Replying to [comment:12 SimonKing]:
> Do we need an m4 spkg?
I think we should have an m4 spkg, but most people disagree (there was a mailing list post on this).


---

Comment by jdemeyer created at 2012-07-27 20:42:02

Please fill in your real name as Author.


---

Comment by jdemeyer created at 2012-10-06 21:51:02

Just got another report of this error on the mailing list.  We really should fix this.


---

Comment by SimonKing created at 2012-10-07 11:01:26

Would #12672 work, modulo providing an m4 spkg on OS X?


---

Comment by aginiewicz created at 2012-10-07 14:37:01

The difference between spkg in #12672 and spkg I posted in comment:7 (that contains fix used by Arch Linux package, i.e. is tested in production environment) is only "make install" vs "make install-strip", so I'd say yes - both spkgs fixes this and #12672 - but both would have issues with m4 on OS X.


---

Comment by jdemeyer created at 2013-01-27 21:04:40

Replying to [comment:17 SimonKing]:
> Would #12672 work, modulo providing an m4 spkg on OS X?
Absolutely.

Just got another report of this error on the mailing list. We really should fix this.


---

Comment by jdemeyer created at 2013-02-05 19:24:38

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2013-06-04 15:07:45

Fixed by #14232.


---

Comment by jdemeyer created at 2013-06-04 15:07:45

Changing status from needs_work to positive_review.


---

Comment by jdemeyer created at 2013-06-06 12:40:44

Resolution: duplicate
