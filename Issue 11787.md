# Issue 11787: build spkgs in parallel by default

Issue created by migration from Trac.

Original creator: jhpalmieri

Original creation time: 2011-10-27 22:29:00

Assignee: GeorgSWeber

CC:  leif kcrisman

The patches on this ticket remove the environment variable `SAGE_PARALLEL_SPKG_BUILD` and turn parallel spkg building on always.  Of course this only has an effect if `MAKE` is set to, for example, "make -j16".

This change was discussed in [sage-devel](https://groups.google.com/d/topic/sage-devel/FW5sP5NPeLs/discussion).


---

Comment by jhpalmieri created at 2011-10-27 22:31:48

Changing status from new to needs_review.


---

Comment by leif created at 2011-10-27 22:38:34

Changing keywords from "" to "SAGE_PARALLEL_SPKG_BUILD MAKE -j --jobs".


---

Comment by leif created at 2011-10-27 22:38:34

Objections to renaming the ticket to _"Remove the necessity to set SAGE_PARALLEL_SPKG_BUILD"_? (It's yours, so I didn't change its title. ;-) )


---

Comment by leif created at 2011-10-27 22:41:34

John, you confused the names of the patches. :)


---

Comment by leif created at 2011-10-27 23:40:28

My alternate patch to `$SAGE_ROOT/spkg/install` has become a bit longer:


```diff

diff --git a/spkg/install b/spkg/install
--- a/spkg/install
+++ b/spkg/install
`@``@` -430,12 +430,10 `@``@`
 
 
 # Skip the rest if nothing to do (i.e., to [re]build):
-# Note that we should use $MAKE here, but we currently don't use
-# it further below either unless SAGE_PARALLEL_SPKG_BUILD=yes, which
-# I consider a "bug". -- Leif Leonhardy
-# If "make" doesn't understand the -q option, it should exit with a
-# non-zero status which is not a problem.
-if make -q -f standard/deps $1; then
+# If "make" doesn't understand the -q option (although we require
+# GNU make, which supports it), it should exit with a non-zero status
+# which is not a problem.
+if ${MAKE:-make} -q -f standard/deps $1; then
     echo "Nothing to (re)build / all up-to-date."
     exit 0
 fi
`@``@` -443,48 +441,57 `@``@`
 
 # Dump environment for debugging purposes:
 echo "*** ALL ENVIRONMENT VARIABLES BEFORE BUILD: ***"
-env
+env | sort
 echo "***********************************************"
 
 
 ###############################################################################
 # NOW do the actual build:
 ###############################################################################
-if [ "$SAGE_PARALLEL_SPKG_BUILD" = "yes" ] && [ -n "$MAKE" ]; then
-    time $MAKE -f standard/deps $1
-else
-    time make -f standard/deps $1
-fi
+time ${MAKE:-make} -f standard/deps $1
 
-# added by Burcin Erocal, see trac #6295.
+# Added by Burcin Erocal, see trac #6295:
 if [ $? -ne 0 ]; then
-    echo "Error building Sage."
+    echo >&2 "Error building Sage."
     exit 1
 fi
 
+# Rename makefile to Makefile (see #10156):
 cd "$SAGE_ROOT"
-
-# Rename makefile to Makefile (see #10156)
 if [ -f makefile ]; then
-    mv makefile Makefile
-    if [ $? -ne 0 ]; then
-        echo "Error renaming 'makefile' to 'Makefile'."
-        exit 1
+    if [ ! -f Makefile ]; then
+        if ! mv makefile Makefile; then
+            echo >&2 "Error renaming 'makefile' to 'Makefile'."
+            exit 1
+        fi
+    else
+        # Both 'makefile' and 'Makefile' exist.
+        echo >&2 "Warning: Deleting old 'makefile'; 'Makefile' remains."
+        if ! rm -f makefile; then
+            echo >&2 "Error deleting old 'makefile'."
+            exit 1
+        fi
     fi
 fi
 
-# build succeeded
-if [ "$1" = "all" ]; then
-    echo "To install gap, gp, singular, etc., scripts"
-    echo "in a standard bin directory, start sage and"
-    echo "type something like"
-    echo "   sage: install_scripts('/usr/local/bin')"
-    echo "at the Sage command prompt."
-    echo ""
-    echo "To build the documentation, run"
-    echo "   make doc"
-    echo ""
-fi
-
+# Build succeeded.
 echo "Sage build/upgrade complete!"
 
+if [ "$1" = "all" ]; then
+    echo
+    echo "To install small scripts to directly run Sage's versions of GAP,"
+    echo "the PARI/GP interpreter, Maxima, or Singular etc. (by typing e.g."
+    echo "just 'gap' or 'gp') into a standard 'bin' directory, start Sage"
+    echo "by typing 'sage' (or './sage') and enter something like"
+    echo
+    echo "    install_scripts('/usr/local/bin')"
+    echo
+    echo "at the Sage command prompt ('sage:')."
+    echo
+    echo "To (re)build the HTML documentation, run 'make doc' (if you haven't"
+    echo "issued 'make' but just 'make build' or e.g. 'sage --upgrade'; other-"
+    echo "wise it will be built automatically right now)."
+    echo
+    echo "To build the PDF version of the documentation, run 'make doc-pdf'."
+    echo
+fi
```



---

Comment by leif created at 2011-10-28 00:21:49

W.r.t. `README.txt`:

I'd quote `make` (`'make'`), and directly refer to the GNU make (online) manual, i.e., its _Options summary_ section (which IMHO explains `-j` and `-l` etc. quite good):

 [http://www.gnu.org/software/make/manual/make.html#Options-Summary](http://www.gnu.org/software/make/manual/make.html#Options-Summary)

`s/`_so for example if you set_`/`_so for example if you do_`/` (or _... type_)

Perhaps also add that it's usually ok (or advantageous) to use more jobs than the machine has CPU cores (minus already running processes, or the current system load), especially if disk access isn't very fast [provided the machine isn't low of available memory or actually RAM].


---

Comment by leif created at 2011-10-28 01:15:36

W.r.t. the Sage Installation Guide:

`export MAKE='make -jNUM'` is not _"a common setting of `MAKE`"_, but a shell command to set `MAKE`; `'make -jNUM'` is the setting.  (This has been in before.)

`s/`_won't need to use_`/`_won't need to set_`/` (dito)

`s/`_can speed up the process_`/`_can significantly speed up the process_`/`

I'd omit _"(Not all packages support this, but the ones for which this could be problematic should automatically disable it.)"_ since this is pretty irrelevant (or confusing); or rephrase it to say that a few packages do not support building them with multiple jobs and hence are built sequentially, although in parallel _with other packages_.

In the warning, substitute _one-processor_ by _single-core CPU_ or _single-core machine_.  I'd also mention the platform (or operating system) to which this apparently applies; in my experience it is a non-issue on Linux.  Attempting to build Sage with probably too many jobs should in general not hurt; one can simply reduce the number of jobs upon build errors and restart, or more precisely continue, the build afterwards by again typing `make`.


Similar what I've said w.r.t. `README.txt` applies to the Installation Guide.

Also we should somehow mention potential problems with ATLAS there, and perhaps what I said about self-tuning packages in general (on sage-devel).  (Again, if ATLAS failed to build -- often just due to too high system load -- one can simply type `make` again, perhaps multiple times, since there are usually less packages left to build when `make` finally exits.  If we haven't already, we should also mention that CPU throttling aka power-saving mode should be turned off; "on-demand" in contrast should be ok, i.e., provided it works properly. [I don't know whether that's in the `README.txt`; I think it is important enough that it should be there, too.])


---

Comment by leif created at 2011-10-28 03:06:29

P.S.:

I think (e.g.) `MAKE="make -j3 -l10.0"` *or* `MAKE="make -j 3 -l 10.0"` (or `MAKE="make --jobs=3 --load-average=10.0"`) is more natural.

(Although AFAIK older versions of GNU make interpreted `make -j 3` as _"build *target*(!) '3' with infinitely many(!) jobs"_, so the first and last version may be safer.)


---

Comment by was created at 2011-10-28 05:11:53

I'm against this as is, but I think something very close is OK.

I think SAGE_PARALLEL_SPKG_BUILD="no" should be supported, but otherwise everything should be like in this proposal.    The reason is that it can be confusing trying to deal with build issues when the build log mixes up output from multiple packages being built at once.  Also there can be weird build issues resulting from building multiple packages at once.  However, using "make -j16" (say) is very useful in all cases on a machine with lots of processors so you don't have to wait so long for individual packages to build.


---

Comment by leif created at 2011-10-28 09:10:25

Replying to [comment:8 was]:
> I'm against this as is, but I think something very close is OK. 

> 

> I think SAGE_PARALLEL_SPKG_BUILD="no" should be supported, but otherwise everything should be like in this proposal.    The reason is that it can be confusing trying to deal with build issues when the build log mixes up output from multiple packages being built at once.

Therefore we have (in addition) individual logs for each spkg in `$SAGE_ROOT/spkg/logs`.




> Also there can be weird build issues resulting from building multiple packages at once.  However, using "make -j16" (say) is very useful in all cases on a machine with lots of processors so you don't have to wait so long for individual packages to build.

Well, building multiple spkgs in parallel is IMHO quite mature.

If you only need an equivalent of `SAGE_PARALLEL_SPKG_BUILD=no` (still building each spkg in parallel if it supports that, and of course `MAKE` is set to `make -jN`) for debugging,

```sh
$ echo ".NOTPARALLEL" >> $SAGE_ROOT/spkg/standard/deps
```

does the job.

We could of course document that, perhaps better in the _Developer's_ Guide.

(Or provide some [other] way to enable and disable that feature -- by an environment variable or an easier command; the only odd thing is that `deps` is under revision control and hence you get uncommitted changes in the _Sage root repository_ :-) whenever that file is modified.  As an alternative, we could include some other "temporary" or volatile [make]file which is in `.hgignore`, and is either empty or contains just `.NOTPARALLEL`.)


---

Comment by leif created at 2011-10-28 09:48:57

Replying to [comment:9 leif]:
> (Or provide some [other] way to enable and disable that feature -- by an environment variable or an easier command; the only odd thing is that `deps` is under revision control and hence you get uncommitted changes in the _Sage root repository_ :-) whenever that file is modified.  As an alternative, we could include some other "temporary" or volatile [make]file which is in `.hgignore`, and is either empty or contains just `.NOTPARALLEL`.)

We could easily achieve that by changing `spkg/install` to

```sh
...

if [This is the Trac macro *${SAGE_PARALLEL_SPKG_BUILD:-yes} = no * that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#${SAGE_PARALLEL_SPKG_BUILD:-yes} = no -macro); then
    # Disable just building multiple packages at the same time; individual
    # spkgs still get built in parallel if they support it and '--jobs'
    # in $MAKE is greater than one (and at all specified):
    echo ".NOTPARALLEL:" > "$SAGE_ROOT"/spkg/standard/parallel_make.cfg
else
    # Create an (almost) empty file, s.t. including it from spkg/standard/deps
    # doesn't raise an error, thereby also invalidating any previous setting:
    echo > "$SAGE_ROOT"/spkg/standard/parallel_make.cfg
fi

time ${MAKE:-make} -f standard/deps $1

...
```

adding `spkg/standard/parallel_make.cfg` to `$SAGE_ROOT/.hgignore`, and adding the line

```make
include parallel_make.cfg
```

to `spkg/standard/deps`.


---

Comment by jhpalmieri created at 2011-10-28 15:07:12

How about a "make serial" target instead of the environment variable?


---

Comment by leif created at 2011-10-28 15:32:03

Replying to [comment:11 jhpalmieri]:
> How about a "make serial" target instead of the environment variable?

I'd say `make build-serial`, which just sets `SAGE_PARALLEL_SPKG_BUILD=no` and then does the usual thing, namely `build`.

Just like `make rebuild` sets `SAGE_UPGRADING=yes` and then "calls" `build`. ;-)

You can of course define some aliases for convenience, e.g. `serial-build` or `build-macosx`... XD


---

Comment by jhpalmieri created at 2011-10-28 18:03:01

Building in parallel on Mac OS X works just fine in _my_ experience.  :p

Anyway, here are new versions of the patches.


---

Comment by jhpalmieri created at 2011-10-28 18:17:39

Some comments about the new versions:

 - I've added a "build-serial" target in the Makefile.
 - spkg/install writes "parallel-make.cfg" in the directory "spkg", since that seems to be the current directory when the makefile "standard/deps" is executed.
 - Leif's proposed change to spkg/install regarding moving "makefile" to "Makefile" didn't seem to work on OS X, probably because of the stupid way OS X deals with upper and lower case in their standard file system.  Or maybe I did something else wrong.  Anyway, I didn't change that part of the script.
 - I haven't put everything possible into the top-level README file: the installation guide is supposed to have all of the details. I did add a comment about the spkg/logs/ files.  See also #11926, which adds a message about spkg/logs/PKG.log to the error message printed by sage-spkg.  
 - in the installation guide, I added a few comments about problems building ATLAS.

By the way, is there anything wrong with this kind of change:

```diff
diff --git a/spkg/install b/spkg/install
--- a/spkg/install
+++ b/spkg/install
`@``@` -483,19 +483,19 `@``@` fi
 echo "Sage build/upgrade complete!"
 
 if [ "$1" = "all" ]; then
-    echo
-    echo "To install small scripts to directly run Sage's versions of GAP,"
-    echo "the PARI/GP interpreter, Maxima, or Singular etc. (by typing e.g."
-    echo "just 'gap' or 'gp') into a standard 'bin' directory, start Sage"
-    echo "by typing 'sage' (or './sage') and enter something like"
-    echo
-    echo "    install_scripts('/usr/local/bin')"
-    echo
-    echo "at the Sage command prompt ('sage:')."
-    echo
-    echo "If you issued 'make', 'make all', or a similar command, then the"
-    echo "HTML version of the documentation will be built right now."
-    echo "Otherwise, if you want to (re)build the HTML documentation,"
-    echo "run 'make doc'.  To build the PDF version, run 'make doc-pdf'."
-    echo
+    echo "
+To install small scripts to directly run Sage's versions of GAP,
+the PARI/GP interpreter, Maxima, or Singular etc. (by typing e.g.
+just 'gap' or 'gp') into a standard 'bin' directory, start Sage
+by typing 'sage' (or './sage') and enter something like
+
+    install_scripts('/usr/local/bin')
+
+at the Sage command prompt ('sage:').
+
+If you issued 'make', 'make all', or a similar command, then the
+HTML version of the documentation will be built right now.
+Otherwise, if you want to (re)build the HTML documentation,
+run 'make doc'.  To build the PDF version, run 'make doc-pdf'.
+"
 fi
```

Are multiline strings not a good idea for "echo"?  If this sort of thing is okay, it makes it much easier to edit the message.


---

Attachment

root repo


---

Comment by jhpalmieri created at 2011-10-28 18:31:05

Sage library


---

Attachment

Replying to [comment:13 jhpalmieri]:
> Building in parallel on Mac OS X works just fine in _my_ experience.  :p

Incidentally I ran into "random" (non-reproducible) parallel build errors on `bsd.math` just yesterday, when it was btw. otherwise idling; with `MAKE="make -j8"`.


---

Comment by leif created at 2011-10-29 09:42:42

Replying to [comment:15 jhpalmieri]:
> Are multiline strings not a good idea for "echo"?  If this sort of thing is okay, it makes it much easier to edit the message.

`echo` has no problem with that, nor any _reasonable_ shell.  For larger texts, you might get problems with the size of the environment on some systems though.  Note that

```sh
$ echo "
one line
"
```

outputs _three_ lines, the first and last being empty.

I'd prefer `cat` and "here" documents though (if at all).  If you want to focus on the code rather than the text, it's better to use a chain of (properly indented) `echo` commands.

`bash` also supports indentation of "here" documents (that doesn't appear in the output);

```sh
$ cat <<-EOF
...
EOF
```

strips leading tabs from the text.


---

Comment by leif created at 2011-10-29 10:45:18

Changing status from needs_review to needs_work.


---

Comment by leif created at 2011-10-29 10:45:18

`make` doesn't export "its" variables by default.  So unless `SAGE_PARALLEL_SPKG_BUILD` was already defined (and exported) when `make` was invoked, setting it in the `Makefile` has no effect on programs (including shells) invoked by `make`.  Without using further GNU make specifics, you'd have to do e.g.

```make
build: $(PIPE) 
        cd spkg && \
        "../$(PIPE)" \
                 "env SAGE_PARALLEL_SPKG_BUILD='$(SAGE_PARALLEL_SPKG_BUILD)' ./install all 2>&1" \
                 "tee -a ../install.log" 
```


I <3 lengthy env var names...




It would be better (i.e., safer) to use an absolute filename in the `include` directive, e.g. `$(SAGE_ROOT)/spkg/parallel_make.cfg`.

I'd perhaps add to the comment there that `.NOTPARALLEL` has no effect on sub-makes.




While you're at it, the commit messages are no longer current.


---

Comment by leif created at 2011-10-29 11:47:17

P.S.: Using a maximal (avg) sysload of 2.5 to me seems a bit funny [even] as an example; I'd use _at least_ the number of cores, which today is usually 4 or more.




In `README.txt`, grepping for "An error" is sufficient and best used with `-l` (which only prints the filenames of matches), or perhaps `-c`, which prints the number of matches in each file (unfortunately also including zero, i.e., one should postprocess that output further), since we always append to the logs and hence previous errors never vanish unless one deletes (or edits) the log.

Since the error message ("An error ...") already contains the package's name, using

```sh
$ grep -h "An error" spkg/logs/*
```

would also give a more readable output, as an alternative to `-l`, with the advantage that one immediately sees whether a package failed to install multiple times.

To get the actual error messages, (e)grepping for "Error" and "Failed" at the beginning of the line (`egrep "^(Error|Failed)" spkg/logs/...`<sup>1</sup>), optionally with a (non-POSIX) before-context (`-B`), is usually more informative.  When case-insensitively ( `-i`) grepping for any  "`error`", to suppress frequent errors ignored by `make`, one can pipe the whole through `grep -iv ignored`.  `-n` also prepends the line numbers to the output, which is useful if you're going to open the log in an editor.




Do we mention `LC_ALL=C` (or e.g. `LC_MESSAGES=en_US.utf8`) for submitting error logs?

----
<sup>1</sup> `"^Failed"` usually also gives non-fatal errors for the Python spkg (_"Failed to find the necessary bits..."_).  In the long run, all of _Sage's_ error messages should really start with "Error" rather than "Failed".  (The new ATLAS spkg with the Python install script in contrast raises arbitrary exceptions.)

We should really in addition create a fresh temporary file at the start of each build to keep track of which packages failed to build, to be dumped at the end (in case of errors).


---

Comment by leif created at 2011-10-29 12:18:52

Slightly off the ticket's topic:

Wouldn't it be better to put a lot of stuff into `SAGE_ROOT/TROUBLESHOOTING.txt`?

People tend to not read READMEs... (presumably because they're so ubiquitous and many of them are hardly informative)


---

Comment by jhpalmieri created at 2011-10-29 16:34:34

The `2.5` number for `-l` came straight from the GNU make man page.

Regarding variables in the Makefile, I saw this sentence in the man page: "When make runs a recipe, variables defined in the makefile are placed into the environment of each shell." This is a bit misleading, because it only exports variables that already came from the environment, so I saw that my setting of SAGE_PARALLEL_SPKG_BUILD=yes was being overridden when I ran "make build-serial".  I see now that if this variable is unset, then "make build-serial" doesn't do what it should.  Why can't I just do

```
build-serial: export SAGE_PARALLEL_SPKG_BUILD = no
build-serial: build
```

Or is this too specific to GNU make?  (Will our makefiles work without GNU make anyway?)

For grep, I like the output from `grep -l ...`, so I'll use that.

> Do we mention LC_ALL=C (or e.g. LC_MESSAGES=en_US.utf8) for submitting error logs?

I don't think so, and I'm not planning to add anything about it.

Re `TROUBLESHOOTING.txt`: we could instead have a structure more like many GNU projects: a boilerplate README and then a file INSTALL with specific instructions.

While we're off-topic: Is the top-level `install.log` any use as it is right now?  It would be better if it had just summary information:

```
All environment variables ...
```

and then lines like the following (probably intermixed for the different spkgs):

```
[time] Started building python-...spkg; keeping a log in spkg/logs/python-...log
[time] Successfully installed python-....
```

or

```
[time] Started building python-...spkg; keeping a log in spkg/logs/python-...log
[time] Error building python-...; see spkg/logs/python-... for a full log
```

or

```
[time] Started building python-...spkg; keeping a log in spkg/logs/python-...log
[time] Error testing python...; see spkg/logs/python-... for a full log
```

And then at the end

```
real	106m26.143s
user	147m9.046s
sys	21m31.998s

Sage build/upgrade complete!
...
```

How hard would that be?


---

Comment by jhpalmieri created at 2011-10-29 21:07:22

Changing status from needs_work to needs_review.


---

Comment by jhpalmieri created at 2011-10-29 21:07:22

Here are new patches.

For changing the format of install.log etc., we could write to the individual log files as part of sage-spkg, instead of when sage-spkg is called by sage-sage or spkg/install.  Then spkg/install could have minimal output (or we could have a flag for setting its verbosity), which it would write directly to install.log.

sage-spkg could take an optional argument, the name of the log file, or at least whether or not to produce a log file; the default would be to append to one.


---

Comment by leif created at 2011-10-29 22:47:30

Replying to [comment:22 jhpalmieri]:
> Why can't I just do

```
build-serial: export SAGE_PARALLEL_SPKG_BUILD = no
build-serial: build
```


Well, you could.  You could also add

```make
export SAGE_PARALLEL_SPKG_BUILD
```

somewhere in the Makefile (preferably near the top), or use

```make
EXPORTS = SAGE_PARALLEL_SPKG_BUILD="$(SAGE_PARALLEL_SPKG_BUILD)" \
          SAGE_FOO="$(SAGE_FOO)"

...

bar:
        env $(EXPORTS) ./baz
```


> Or is this too specific to GNU make?

I don't care much, although I prefer not using GNUisms if there's a _simple_ alternative.  AFAIK older _GNU_ makes don't support `export` either, but I haven't checked since when they do.




> > Do we mention LC_ALL=C (or e.g. LC_MESSAGES=en_US.utf8) for submitting error logs?
> 
> I don't think so, and I'm not planning to add anything about it.

Hmmmm. :(




> Re `TROUBLESHOOTING.txt`: we could instead have a structure more like many GNU projects: a boilerplate README and then a file INSTALL with specific instructions.

TROUBLESHOOTING is much more explicit.  Most INSTALL files shipped are just templates, so it's quite likely that people wouldn't read them either.  We also have the (longer) Sage Installation Guide; I was aiming at a short plain text file purely on topic, i.e. common issues (which might get updated more frequently and easily), and how and where to report build failures / ask for build-related support.




> While we're off-topic: Is the top-level `install.log` any use as it is right now?

I'd keep at least the file; whether it makes sense to dump it to the screen -- especially in parallel builds --  is another question.

> For changing the format of install.log etc., we could write to the individual log files as part of sage-spkg, instead of when sage-spkg is called by sage-sage or spkg/install.

That's what I suggested more than a year ago. :-)  Also, a large amount of the output are distutils' "copying ..." messages, and ECL (also when building Maxima) is far too verbose, too.

We don't lose much if we move the logging from `deps` to `sage-spkg`.  The latter should take a couple of logging-related parameters like `--logfile=`, `--logfd=`, `--loglevel=`, with the possibility to specify more than one logfile or file descriptor, with the same or different log levels.

Unfortunately `sage-spkg` is a hot spot; it needs work in all places.


---

Comment by leif created at 2011-10-29 23:10:14

Replying to [comment:22 jhpalmieri]:
> For grep, I like the output from `grep -l ...`, so I'll use that.

`grep -li ...` would be better, since `sage-build` also has

```
	  echo "ERROR: There was an error building c_lib."
         echo "sage: There was an error installing modified $1 library code."
```


(Or just change that file, too... :P  Although "Error: ..." would be better anyway.)


---

Comment by jhpalmieri created at 2011-10-29 23:19:45

for review only


---

Attachment

for review only


---

Comment by jhpalmieri created at 2011-10-29 23:20:07

Sage library


---

Attachment

(New versions of the v2 patches, just changing "grep -l" to "grep -li".)


---

Comment by leif created at 2011-10-29 23:37:09

I'm happy with the v2 patches as they are, so in principle positive review.  Just have to take a closer look at the whole and make sure the patches apply... ;-)

Feel free to add or change further things if you like.


[IRC distracted me; that was a while ago, but I hadn't yet grabbed the patches... :-) ]


---

Comment by leif created at 2011-10-29 23:59:44

_"If you have a machine with 4 processors..."_

Ask Intel what the differences between a uni-processor, a dual-processor and a multi-processor machine are... ;-) (These are separate Xeon series; AMD has Athlon/Phenom vs. Opteron.  The Sage cluster machines boxen, geom, mod, redhawk and sage are all 4-processor machines, each processor a hexacore.)

(The cheap desktop and notebook ones are all single-processor multi-core machines, and I think the notion of cores is meanwhile quite common to everyone.)




If you happen to edit `README.txt` again, perhaps also mention sage-release, which is IMHO better suited for build errors.  The lengthy standard error message of `sage-spkg` already mentions sage-devel (and currently only that).


---

Comment by leif created at 2011-10-30 00:12:15

Small typo in `deps`:

_"# only determines whether more than *one* spkg may be built at a time."_

Or I should just try what it builds when it builds more than spkgs... :-)


---

Comment by leif created at 2011-10-30 00:30:27

Replying to [comment:29 leif]:
> If you happen to edit `README.txt` again [...]

You could also increase the number of developers in _"Over 200 people have contributed code to Sage."_ to 300+.


---

Comment by kcrisman created at 2011-10-30 00:48:57

Just in case this isn't written in stone, it would be nice to still have the full thing in install.log.  One could _add_ something about referring to the other logs, though, if it doesn't already do so, maybe especially in the case of an error in the build.


---

Comment by jhpalmieri created at 2011-10-30 01:16:56

I'm curious as to how the full install.log is useful.  Having it essentially doubles the amount of log space, since almost everything is in both the install.log and the individual log files.  The individual log files aren't jumbled together the way they are in install.log (for parallel builds).  If the whole log file just said:

 - building X
 - building Y
 - ...
 - done building Y  (or "error building Y")
 - done building X
 - ...

with instructions about how to find the individual log files, doesn't that convey all of the necessary information?


---

Comment by leif created at 2011-10-30 01:49:22

Changing status from needs_review to positive_review.


---

Comment by leif created at 2011-10-30 01:49:22

It's amazing how many typos are in the Installation Guide.  But the documentation has really improved compared to how it was e.g. last year.

One could also add a link to the Environment Variables section (i.e., `MAKE`) when it comes to "`make`", since the steps for building from source there currently do not mention building in parallel (or `make -j`) at all.

----

As said, I'm happy with the patches as they are, and everything works as expected, so *positive review*.


---

Comment by jhpalmieri created at 2011-10-30 03:13:06

FYI: I'm updating the root patch to fix the typo in deps.


---

Attachment

root repo


---

Comment by kcrisman created at 2011-10-30 03:30:19

Replying to [comment:33 jhpalmieri]:
> I'm curious as to how the full install.log is useful.  Having it essentially doubles the amount of log space, since almost 
Because I'm lazy and don't want to have to dive into spkg/ to open them.  Won't revert the positive review on this, though, since it will be in 4.7.3, certainly makes sense in many ways, and if anyone else wants it they'll have plenty of alphas to complain :)


---

Comment by jhpalmieri created at 2011-10-30 03:54:08

Replying to [comment:36 kcrisman]:
> Replying to [comment:33 jhpalmieri]:
> > I'm curious as to how the full install.log is useful.  Having it essentially doubles the amount of log space, since almost 
> Because I'm lazy and don't want to have to dive into spkg/ to open them.  Won't revert the positive review on this

This ticket doesn't actually affect the contents of install.log, it was just a side discussion.  The patches here do put a little more emphasis on spkg/logs/*, because I think they still aren't well known enough, but no log files were harmed by the patches for this ticket.


---

Comment by jdemeyer created at 2011-11-01 09:46:37

Rebased on top of #11926


---

Attachment


---

Comment by jdemeyer created at 2011-11-02 08:32:17

Resolution: fixed


---

Comment by jdemeyer created at 2011-11-02 19:59:48

Rebased on top of #11926


---

Attachment

Milestone sage-4.7.3 deleted
