# Issue 32290: urllib needs a SSL context to work with openssl 3.x

archive/issues_032290.json:
```json
{
    "body": "Whith OpenSSL 3.x installed from Sage, we get the following error:\n\n\n```\nsage: oeis(42)\n<repr(<sage.databases.oeis.OEISSequence at 0x7f1fd4483e50>) failed: OSError: <urlopen error [SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1129)>\nError fetching https://oeis.org/search?q=A000042&n=1&fmt=text.>\n```\n\n\nThis is due to the fact that we do not pass any SSL context to urllib.\n\nIssue created by migration from https://trac.sagemath.org/ticket/32527\n\n",
    "created_at": "2021-09-16T22:06:24Z",
    "labels": [
        "packages: standard",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "urllib needs a SSL context to work with openssl 3.x",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32290",
    "user": "tmonteil"
}
```
Whith OpenSSL 3.x installed from Sage, we get the following error:


```
sage: oeis(42)
<repr(<sage.databases.oeis.OEISSequence at 0x7f1fd4483e50>) failed: OSError: <urlopen error [SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1129)>
Error fetching https://oeis.org/search?q=A000042&n=1&fmt=text.>
```


This is due to the fact that we do not pass any SSL context to urllib.

Issue created by migration from https://trac.sagemath.org/ticket/32527





---

archive/issue_comments_461040.json:
```json
{
    "body": "I think this is the same problem that we faced in #29418/#30950 (for `sage-system-python`)",
    "created_at": "2021-09-16T22:24:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32290#issuecomment-461040",
    "user": "@mkoeppe"
}
```

I think this is the same problem that we faced in #29418/#30950 (for `sage-system-python`)



---

archive/issue_comments_461041.json:
```json
{
    "body": "OK, will look at those tickets too.",
    "created_at": "2021-09-16T22:40:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32290#issuecomment-461041",
    "user": "tmonteil"
}
```

OK, will look at those tickets too.



---

archive/issue_comments_461042.json:
```json
{
    "body": "New commits:",
    "created_at": "2021-09-17T15:32:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32290#issuecomment-461042",
    "user": "tmonteil"
}
```

New commits:



---

archive/issue_comments_461043.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-09-17T15:32:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32290#issuecomment-461043",
    "user": "tmonteil"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_461044.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-09-17T15:36:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32290#issuecomment-461044",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_461045.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-09-17T16:59:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32290#issuecomment-461045",
    "user": "@mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_461046.json:
```json
{
    "body": "This seems to work well, tested locally with `./sage -tp --optional=sage,internet src/sage/arith/misc.py src/sage/combinat/designs/covering_design.py src/sage/databases/ src/sage/doctest/external.py src/sage/graphs/isgci.py src/sage/interfaces/mathematica.py src/sage/misc/ src/sage/repl`\n\nThere are a bunch of failures\n\n```\nsage -t --random-seed=0 src/sage/databases/oeis.py  # 4 doctests failed\nsage -t --random-seed=0 src/sage/databases/findstat.py  # 4 doctests failed\n```\n\nthat come from absurdly rigid doctests. Fixing them is outside of the scope of this ticket.",
    "created_at": "2021-09-17T16:59:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32290#issuecomment-461046",
    "user": "@mkoeppe"
}
```

This seems to work well, tested locally with `./sage -tp --optional=sage,internet src/sage/arith/misc.py src/sage/combinat/designs/covering_design.py src/sage/databases/ src/sage/doctest/external.py src/sage/graphs/isgci.py src/sage/interfaces/mathematica.py src/sage/misc/ src/sage/repl`

There are a bunch of failures

```
sage -t --random-seed=0 src/sage/databases/oeis.py  # 4 doctests failed
sage -t --random-seed=0 src/sage/databases/findstat.py  # 4 doctests failed
```

that come from absurdly rigid doctests. Fixing them is outside of the scope of this ticket.



---

archive/issue_comments_461047.json:
```json
{
    "body": "Thanks for the review. Also tested on a bare VM with only Sage-shipped packages (including Python 3 and Openssl 3.0.0).",
    "created_at": "2021-09-17T17:26:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32290#issuecomment-461047",
    "user": "tmonteil"
}
```

Thanks for the review. Also tested on a bare VM with only Sage-shipped packages (including Python 3 and Openssl 3.0.0).



---

archive/issue_comments_461048.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-09-25T23:17:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32290",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32290#issuecomment-461048",
    "user": "@vbraun"
}
```

Resolution: fixed
