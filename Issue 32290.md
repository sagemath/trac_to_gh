# Issue 32290: urllib needs a SSL context to work with openssl 3.x

Issue created by migration from https://trac.sagemath.org/ticket/32527

Original creator: tmonteil

Original creation time: 2021-09-16 22:06:24

Whith OpenSSL 3.x installed from Sage, we get the following error:


```
sage: oeis(42)
<repr(<sage.databases.oeis.OEISSequence at 0x7f1fd4483e50>) failed: OSError: <urlopen error [SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1129)>
Error fetching https://oeis.org/search?q=A000042&n=1&fmt=text.>
```


This is due to the fact that we do not pass any SSL context to urllib.


---

Comment by mkoeppe created at 2021-09-16 22:24:11

I think this is the same problem that we faced in #29418/#30950 (for `sage-system-python`)


---

Comment by tmonteil created at 2021-09-16 22:40:52

OK, will look at those tickets too.


---

Comment by tmonteil created at 2021-09-17 15:32:25

New commits:


---

Comment by tmonteil created at 2021-09-17 15:32:25

Changing status from new to needs_review.


---

Comment by git created at 2021-09-17 15:36:13

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2021-09-17 16:59:58

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2021-09-17 16:59:58

This seems to work well, tested locally with `./sage -tp --optional=sage,internet src/sage/arith/misc.py src/sage/combinat/designs/covering_design.py src/sage/databases/ src/sage/doctest/external.py src/sage/graphs/isgci.py src/sage/interfaces/mathematica.py src/sage/misc/ src/sage/repl`

There are a bunch of failures

```
sage -t --random-seed=0 src/sage/databases/oeis.py  # 4 doctests failed
sage -t --random-seed=0 src/sage/databases/findstat.py  # 4 doctests failed
```

that come from absurdly rigid doctests. Fixing them is outside of the scope of this ticket.


---

Comment by tmonteil created at 2021-09-17 17:26:21

Thanks for the review. Also tested on a bare VM with only Sage-shipped packages (including Python 3 and Openssl 3.0.0).


---

Comment by vbraun created at 2021-09-25 23:17:41

Resolution: fixed
