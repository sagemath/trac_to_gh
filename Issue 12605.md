# Issue 12605: Add signal handling to libecm.pyx

archive/issues_012605.json:
```json
{
    "body": "Assignee: tbd\n\nCC:  @zimmermann6\n\nAdd `sig_on()`/`sig_off()` in `libecm.pyx`.\n\nAlso add documentation and examples.\n\nIssue created by migration from https://trac.sagemath.org/ticket/12777\n\n",
    "closed_at": "2012-05-06T12:18:41Z",
    "created_at": "2012-03-29T09:28:33Z",
    "labels": [
        "component: factorization"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.1",
    "title": "Add signal handling to libecm.pyx",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12605",
    "user": "https://github.com/jdemeyer"
}
```
Assignee: tbd

CC:  @zimmermann6

Add `sig_on()`/`sig_off()` in `libecm.pyx`.

Also add documentation and examples.

Issue created by migration from https://trac.sagemath.org/ticket/12777





---

archive/issue_comments_149697.json:
```json
{
    "body": "Changing component from c_lib to factorization.",
    "created_at": "2012-03-29T10:04:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12605#issuecomment-149697",
    "user": "https://github.com/jdemeyer"
}
```

Changing component from c_lib to factorization.



---

archive/issue_comments_149698.json:
```json
{
    "body": "Changing assignee from @jdemeyer to tbd.",
    "created_at": "2012-03-29T10:04:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12605#issuecomment-149698",
    "user": "https://github.com/jdemeyer"
}
```

Changing assignee from @jdemeyer to tbd.



---

archive/issue_comments_149699.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-03-29T10:07:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12605#issuecomment-149699",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_149700.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-04-02T12:01:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12605#issuecomment-149700",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_149701.json:
```json
{
    "body": "Jeroen, you changed to \"needs work\" but did not mention what are the work issues.\n\nPaul",
    "created_at": "2012-04-02T12:50:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12605#issuecomment-149701",
    "user": "https://github.com/zimmermann6"
}
```

Jeroen, you changed to "needs work" but did not mention what are the work issues.

Paul



---

archive/issue_comments_149702.json:
```json
{
    "body": "I rebased it on top of #12757 (which has positive review).",
    "created_at": "2012-04-02T12:51:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12605#issuecomment-149702",
    "user": "https://github.com/jdemeyer"
}
```

I rebased it on top of #12757 (which has positive review).



---

archive/issue_comments_149703.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-04-02T12:51:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12605#issuecomment-149703",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_149704.json:
```json
{
    "body": "when recompiling Sage with this patch, I got a warning that variables f and n were referenced before assignment. Maybe it happened before this patch.\n\nSome comments on the patch itself:\n\n\"The Elliptic Curve Method for Integer Factorization (GMP-ECM)\": please replace GMP-ECM by ECM, since GMP-ECM is only **one implementation** of the ECM algorithm.\n\n\"Try to find a factor of a number\": it would be better to say \"integer\", or even \"positive integer\".\n\n\"number to be factored\": replace by \"integer to be factored\"\n\nAbout the example with the factor from 2<sup>167</sup>-1: the B1 bound 1e5 is not enough to ensure\nthe factor 2349023 will always be found. By Hasse theorem, the group order can be as large\nas 2352089, and since GMP-ECM only guarantees a torsion of 12, B1=196003 is needed to ensure\nthe factor 2349023 is always found, whatever the curve (unfortunately, the current interface\ndoes not allow to specify the chosen curve).\n\n\"The following number is a Mersenne prime, so we will not find any factors\": this is not\nentirely true, it might be that we find the input number itself if we are lucky.\n\nFor the example with the two prime factors of 2<sup>179</sup>-1, in fact B1=1e4 ensures we will find always both of them, as any value B1 >= 113. I suggest using B1=10 instead.\n\n`ecmfactor(N/11, 100, verbose=True)`: please replace `N/11` by `N//11`.\n\nPaul",
    "created_at": "2012-04-02T13:19:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12605#issuecomment-149704",
    "user": "https://github.com/zimmermann6"
}
```

when recompiling Sage with this patch, I got a warning that variables f and n were referenced before assignment. Maybe it happened before this patch.

Some comments on the patch itself:

"The Elliptic Curve Method for Integer Factorization (GMP-ECM)": please replace GMP-ECM by ECM, since GMP-ECM is only **one implementation** of the ECM algorithm.

"Try to find a factor of a number": it would be better to say "integer", or even "positive integer".

"number to be factored": replace by "integer to be factored"

About the example with the factor from 2<sup>167</sup>-1: the B1 bound 1e5 is not enough to ensure
the factor 2349023 will always be found. By Hasse theorem, the group order can be as large
as 2352089, and since GMP-ECM only guarantees a torsion of 12, B1=196003 is needed to ensure
the factor 2349023 is always found, whatever the curve (unfortunately, the current interface
does not allow to specify the chosen curve).

"The following number is a Mersenne prime, so we will not find any factors": this is not
entirely true, it might be that we find the input number itself if we are lucky.

For the example with the two prime factors of 2<sup>179</sup>-1, in fact B1=1e4 ensures we will find always both of them, as any value B1 >= 113. I suggest using B1=10 instead.

`ecmfactor(N/11, 100, verbose=True)`: please replace `N/11` by `N//11`.

Paul



---

archive/issue_comments_149705.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-04-02T13:20:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12605#issuecomment-149705",
    "user": "https://github.com/zimmermann6"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_149706.json:
```json
{
    "body": "Replying to [comment:7 zimmerma]:\n> when recompiling Sage with this patch, I got a warning that variables f and n were referenced before assignment. Maybe it happened before this patch.\n\nIt's a spurious warning, the code is obviously fine.",
    "created_at": "2012-04-02T13:47:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12605#issuecomment-149706",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:7 zimmerma]:
> when recompiling Sage with this patch, I got a warning that variables f and n were referenced before assignment. Maybe it happened before this patch.

It's a spurious warning, the code is obviously fine.



---

archive/issue_comments_149707.json:
```json
{
    "body": "Replying to [comment:7 zimmerma]:\n> `ecmfactor(N/11, 100, verbose=True)`: please replace `N/11` by `N//11`.\n\nActually, I did this on purpose as a mild test that the function works with things that aren't Integers but can be converted to Integers.",
    "created_at": "2012-04-02T13:55:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12605#issuecomment-149707",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:7 zimmerma]:
> `ecmfactor(N/11, 100, verbose=True)`: please replace `N/11` by `N//11`.

Actually, I did this on purpose as a mild test that the function works with things that aren't Integers but can be converted to Integers.



---

archive/issue_comments_149708.json:
```json
{
    "body": "Replying to [comment:7 zimmerma]:\n> For the example with the two prime factors of 2<sup>179</sup>-1, in fact B1=1e4 ensures we will find always both of them, as any value B1 >= 113.\n\nDepends what you mean.  If the `ecm_factor()` algorithm would be run to the end, then yes.  But it's possible the algorithm stops after step 1 when only one factor is found.  So you don't always get 359 * 1433 as factor.",
    "created_at": "2012-04-02T13:58:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12605#issuecomment-149708",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:7 zimmerma]:
> For the example with the two prime factors of 2<sup>179</sup>-1, in fact B1=1e4 ensures we will find always both of them, as any value B1 >= 113.

Depends what you mean.  If the `ecm_factor()` algorithm would be run to the end, then yes.  But it's possible the algorithm stops after step 1 when only one factor is found.  So you don't always get 359 * 1433 as factor.



---

archive/issue_comments_149709.json:
```json
{
    "body": "Replying to [comment:7 zimmerma]:\n> About the example with the factor from 2<sup>167</sup>-1: the B1 bound 1e5 is not enough to ensure\n> the factor 2349023 will always be found. By Hasse theorem, the group order can be as large\n> as 2352089\n\nIsn't it sufficient that 2352089 is below the B2 bound (which is the case)?",
    "created_at": "2012-04-02T14:13:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12605#issuecomment-149709",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:7 zimmerma]:
> About the example with the factor from 2<sup>167</sup>-1: the B1 bound 1e5 is not enough to ensure
> the factor 2349023 will always be found. By Hasse theorem, the group order can be as large
> as 2352089

Isn't it sufficient that 2352089 is below the B2 bound (which is the case)?



---

archive/issue_comments_149710.json:
```json
{
    "body": "about comment [comment:11]: I only considered Step 1 in my analysis,\nsince B1 controls Step 1 only. Thus B1=113 is enough to find **both** 359\nand 1433 in Step 1.\n\nBut in some rare cases it can happen that some factor is found during the\ninitial computation **before** Step 1 is started. In such a case indeed only\n359 or 1433 can be returned. Experimentally this seems to happen in only 1%\nof the cases.\n\nPaul",
    "created_at": "2012-04-02T14:22:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12605#issuecomment-149710",
    "user": "https://github.com/zimmermann6"
}
```

about comment [comment:11]: I only considered Step 1 in my analysis,
since B1 controls Step 1 only. Thus B1=113 is enough to find **both** 359
and 1433 in Step 1.

But in some rare cases it can happen that some factor is found during the
initial computation **before** Step 1 is started. In such a case indeed only
359 or 1433 can be returned. Experimentally this seems to happen in only 1%
of the cases.

Paul



---

archive/issue_comments_149711.json:
```json
{
    "body": "Replying to [comment:12 jdemeyer]:\n> Isn't it sufficient that 2352089 is below the B2 bound (which is the case)?\n\n\nyou are right, but it might be that a future version of GMP-ECM changes the default B2\nvalue for B1=1e5.\n\nPaul",
    "created_at": "2012-04-02T14:24:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12605#issuecomment-149711",
    "user": "https://github.com/zimmermann6"
}
```

Replying to [comment:12 jdemeyer]:
> Isn't it sufficient that 2352089 is below the B2 bound (which is the case)?


you are right, but it might be that a future version of GMP-ECM changes the default B2
value for B1=1e5.

Paul



---

archive/issue_comments_149712.json:
```json
{
    "body": "Okay, I made the changes you suggested.\n\nI also added a check that the given number is positive.",
    "created_at": "2012-04-02T14:49:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12605#issuecomment-149712",
    "user": "https://github.com/jdemeyer"
}
```

Okay, I made the changes you suggested.

I also added a check that the given number is positive.



---

archive/issue_comments_149713.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-04-02T14:49:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12605#issuecomment-149713",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_149714.json:
```json
{
    "body": "Attachment [12777_libecm_sig.patch](tarball://root/attachments/some-uuid/ticket12777/12777_libecm_sig.patch) by @zimmermann6 created at 2012-04-02 15:09:13\n\nthe new patch seems ok to me. I will run the doctests with #12757 and this patch, and I will give a \"positive review\" if all doctests pass. If the patchbot is faster, feel free to tick\n\"positive review\" for me.\n\nPaul",
    "created_at": "2012-04-02T15:09:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12605#issuecomment-149714",
    "user": "https://github.com/zimmermann6"
}
```

Attachment [12777_libecm_sig.patch](tarball://root/attachments/some-uuid/ticket12777/12777_libecm_sig.patch) by @zimmermann6 created at 2012-04-02 15:09:13

the new patch seems ok to me. I will run the doctests with #12757 and this patch, and I will give a "positive review" if all doctests pass. If the patchbot is faster, feel free to tick
"positive review" for me.

Paul



---

archive/issue_comments_149715.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-04-03T06:19:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12605#issuecomment-149715",
    "user": "https://github.com/zimmermann6"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_149716.json:
```json
{
    "body": "one doctest fails:\n\n```\n\ntarte% ./sage -t  devel/sage-12777/sage/misc/sagedoc.py\nsage -t  \"devel/sage-12777/sage/misc/sagedoc.py\"            \n**********************************************************************\nFile \"/localdisk/tmp/sage-5.0.beta11/devel/sage-12777/sage/misc/sagedoc.py\", line 566:\n    sage: 'abvar/homology' in _search_src_or_doc('doc', 'homology', 'variety', interact=False)\nExpected:\n    True\nGot:\n    Warning, the following Sage documentation hasn't been built,\n    so documentation search results may be incomplete:\n    <BLANKLINE>\n    /localdisk/tmp/sage-5.0.beta11/devel/sage/doc/output/html/de/tutorial\n    /localdisk/tmp/sage-5.0.beta11/devel/sage/doc/output/html/en/faq\n    /localdisk/tmp/sage-5.0.beta11/devel/sage/doc/output/html/en/constructions\n    /localdisk/tmp/sage-5.0.beta11/devel/sage/doc/output/html/en/bordeaux_2008\n    /localdisk/tmp/sage-5.0.beta11/devel/sage/doc/output/html/en/a_tour_of_sage\n    /localdisk/tmp/sage-5.0.beta11/devel/sage/doc/output/html/en/reference\n    /localdisk/tmp/sage-5.0.beta11/devel/sage/doc/output/html/en/developer\n    /localdisk/tmp/sage-5.0.beta11/devel/sage/doc/output/html/en/installation\n    /localdisk/tmp/sage-5.0.beta11/devel/sage/doc/output/html/en/tutorial\n    /localdisk/tmp/sage-5.0.beta11/devel/sage/doc/output/html/en/numerical_sage\n    /localdisk/tmp/sage-5.0.beta11/devel/sage/doc/output/html/en/website\n    /localdisk/tmp/sage-5.0.beta11/devel/sage/doc/output/html/en/thematic_tutorials\n    /localdisk/tmp/sage-5.0.beta11/devel/sage/doc/output/html/fr/a_tour_of_sage\n    /localdisk/tmp/sage-5.0.beta11/devel/sage/doc/output/html/fr/tutorial\n    /localdisk/tmp/sage-5.0.beta11/devel/sage/doc/output/html/ru/tutorial\n    /localdisk/tmp/sage-5.0.beta11/devel/sage/doc/output/html/tr/a_tour_of_sage\n    <BLANKLINE>\n    You can build these with 'sage -docbuild DOCUMENT html',\n    where DOCUMENT is one of 'de/tutorial', 'faq', 'constructions', 'bordeaux_2008', 'a_tour_of_sage', 'reference', 'developer', 'installation', 'tutorial', 'numerical_sage', 'website', 'thematic_tutorials', 'fr/a_tour_of_sage', 'fr/tutorial', 'ru/tutorial', 'tr/a_tour_of_sage', \n    or you can use 'sage -docbuild all html' to build all of the missing documentation.\n    False\n**********************************************************************\n1 items had failures:\n   1 of   7 in __main__.example_8\n***Test Failed*** 1 failures.\nFor whitespace errors, see the file /users/caramel/zimmerma/.sage//tmp/sagedoc_29685.py\n         [20.6 s]\n```\nbut it fails without the two patches, thus I give a positive review.\n\nPaul",
    "created_at": "2012-04-03T06:19:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12605#issuecomment-149716",
    "user": "https://github.com/zimmermann6"
}
```

one doctest fails:

```

tarte% ./sage -t  devel/sage-12777/sage/misc/sagedoc.py
sage -t  "devel/sage-12777/sage/misc/sagedoc.py"            
**********************************************************************
File "/localdisk/tmp/sage-5.0.beta11/devel/sage-12777/sage/misc/sagedoc.py", line 566:
    sage: 'abvar/homology' in _search_src_or_doc('doc', 'homology', 'variety', interact=False)
Expected:
    True
Got:
    Warning, the following Sage documentation hasn't been built,
    so documentation search results may be incomplete:
    <BLANKLINE>
    /localdisk/tmp/sage-5.0.beta11/devel/sage/doc/output/html/de/tutorial
    /localdisk/tmp/sage-5.0.beta11/devel/sage/doc/output/html/en/faq
    /localdisk/tmp/sage-5.0.beta11/devel/sage/doc/output/html/en/constructions
    /localdisk/tmp/sage-5.0.beta11/devel/sage/doc/output/html/en/bordeaux_2008
    /localdisk/tmp/sage-5.0.beta11/devel/sage/doc/output/html/en/a_tour_of_sage
    /localdisk/tmp/sage-5.0.beta11/devel/sage/doc/output/html/en/reference
    /localdisk/tmp/sage-5.0.beta11/devel/sage/doc/output/html/en/developer
    /localdisk/tmp/sage-5.0.beta11/devel/sage/doc/output/html/en/installation
    /localdisk/tmp/sage-5.0.beta11/devel/sage/doc/output/html/en/tutorial
    /localdisk/tmp/sage-5.0.beta11/devel/sage/doc/output/html/en/numerical_sage
    /localdisk/tmp/sage-5.0.beta11/devel/sage/doc/output/html/en/website
    /localdisk/tmp/sage-5.0.beta11/devel/sage/doc/output/html/en/thematic_tutorials
    /localdisk/tmp/sage-5.0.beta11/devel/sage/doc/output/html/fr/a_tour_of_sage
    /localdisk/tmp/sage-5.0.beta11/devel/sage/doc/output/html/fr/tutorial
    /localdisk/tmp/sage-5.0.beta11/devel/sage/doc/output/html/ru/tutorial
    /localdisk/tmp/sage-5.0.beta11/devel/sage/doc/output/html/tr/a_tour_of_sage
    <BLANKLINE>
    You can build these with 'sage -docbuild DOCUMENT html',
    where DOCUMENT is one of 'de/tutorial', 'faq', 'constructions', 'bordeaux_2008', 'a_tour_of_sage', 'reference', 'developer', 'installation', 'tutorial', 'numerical_sage', 'website', 'thematic_tutorials', 'fr/a_tour_of_sage', 'fr/tutorial', 'ru/tutorial', 'tr/a_tour_of_sage', 
    or you can use 'sage -docbuild all html' to build all of the missing documentation.
    False
**********************************************************************
1 items had failures:
   1 of   7 in __main__.example_8
***Test Failed*** 1 failures.
For whitespace errors, see the file /users/caramel/zimmerma/.sage//tmp/sagedoc_29685.py
         [20.6 s]
```
but it fails without the two patches, thus I give a positive review.

Paul



---

archive/issue_comments_149717.json:
```json
{
    "body": "Replying to [comment:17 zimmerma]:\n> one doctest fails:\n\nThis is the failure you get when the documentation hasn't been built (or built partially).",
    "created_at": "2012-04-03T06:34:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12605#issuecomment-149717",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:17 zimmerma]:
> one doctest fails:

This is the failure you get when the documentation hasn't been built (or built partially).



---

archive/issue_comments_149718.json:
```json
{
    "body": "is there any reason the documentation is not built (or only partially) with sage-5.0.beta11?\n\nPaul",
    "created_at": "2012-04-03T07:17:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12605#issuecomment-149718",
    "user": "https://github.com/zimmermann6"
}
```

is there any reason the documentation is not built (or only partially) with sage-5.0.beta11?

Paul



---

archive/issue_comments_149719.json:
```json
{
    "body": "Replying to [comment:19 zimmerma]:\n> is there any reason the documentation is not built (or only partially) with sage-5.0.beta11?\n\nNo, I'm guessing something went wrong with your setup.  Did you apply any other patches which might have broken the documentation?  And what happens when you do `make doc` from `$SAGE_ROOT`?",
    "created_at": "2012-04-03T08:03:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12605#issuecomment-149719",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:19 zimmerma]:
> is there any reason the documentation is not built (or only partially) with sage-5.0.beta11?

No, I'm guessing something went wrong with your setup.  Did you apply any other patches which might have broken the documentation?  And what happens when you do `make doc` from `$SAGE_ROOT`?



---

archive/issue_comments_149720.json:
```json
{
    "body": "after `make doc` the doctest `sagedoc.py` passes. I have no idea why it was not done\nby `make`.\n\nPaul",
    "created_at": "2012-04-03T16:14:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12605#issuecomment-149720",
    "user": "https://github.com/zimmermann6"
}
```

after `make doc` the doctest `sagedoc.py` passes. I have no idea why it was not done
by `make`.

Paul



---

archive/issue_events_034725.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-19T06:41:13Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12605",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12605#event-34725"
}
```



---

archive/issue_comments_149721.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-04-19T06:41:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12605#issuecomment-149721",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_149722.json:
```json
{
    "body": "On `hawk (OpenSolaris 06.2009-32)`, I regularly get:\n\n```\nsage -t  --long -force_lib devel/sage/sage/libs/libecm.pyx\n**********************************************************************\nFile \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.0.beta14/devel/sage-main/sage/libs/libecm.pyx\", line 132:\n    sage: ecmfactor(1, 100)\nException raised:\n    Traceback (most recent call last):\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.0.beta14/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.0.beta14/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.0.beta14/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_1[19]>\", line 1, in <module>\n        ecmfactor(Integer(1), Integer(100))###line 132:\n    sage: ecmfactor(1, 100)\n      File \"libecm.pyx\", line 152, in sage.libs.libecm.ecmfactor (sage/libs/libecm.c:1899)\n        sig_on()\n    RuntimeError: Floating point exception\n**********************************************************************\n```\n\nI have not yet investigated what causes this.",
    "created_at": "2012-04-23T06:55:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12605#issuecomment-149722",
    "user": "https://github.com/jdemeyer"
}
```

On `hawk (OpenSolaris 06.2009-32)`, I regularly get:

```
sage -t  --long -force_lib devel/sage/sage/libs/libecm.pyx
**********************************************************************
File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.0.beta14/devel/sage-main/sage/libs/libecm.pyx", line 132:
    sage: ecmfactor(1, 100)
Exception raised:
    Traceback (most recent call last):
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.0.beta14/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.0.beta14/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.0.beta14/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_1[19]>", line 1, in <module>
        ecmfactor(Integer(1), Integer(100))###line 132:
    sage: ecmfactor(1, 100)
      File "libecm.pyx", line 152, in sage.libs.libecm.ecmfactor (sage/libs/libecm.c:1899)
        sig_on()
    RuntimeError: Floating point exception
**********************************************************************
```

I have not yet investigated what causes this.



---

archive/issue_comments_149723.json:
```json
{
    "body": "Resolution changed from fixed to ",
    "created_at": "2012-04-23T06:55:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12605#issuecomment-149723",
    "user": "https://github.com/jdemeyer"
}
```

Resolution changed from fixed to 



---

archive/issue_comments_149724.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2012-04-23T06:55:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12605#issuecomment-149724",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from closed to new.



---

archive/issue_events_034726.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-23T06:55:11Z",
    "event": "reopened",
    "issue": "https://github.com/sagemath/sagetest/issues/12605",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12605#event-34726"
}
```



---

archive/issue_comments_149725.json:
```json
{
    "body": "Jeroen, did you get this error before the patch too?\n\nPaul",
    "created_at": "2012-04-23T08:50:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12605#issuecomment-149725",
    "user": "https://github.com/zimmermann6"
}
```

Jeroen, did you get this error before the patch too?

Paul



---

archive/issue_comments_149726.json:
```json
{
    "body": "The problem is really with the interrupt test.  Disabling that test makes everything pass.",
    "created_at": "2012-04-23T13:06:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12605#issuecomment-149726",
    "user": "https://github.com/jdemeyer"
}
```

The problem is really with the interrupt test.  Disabling that test makes everything pass.



---

archive/issue_comments_149727.json:
```json
{
    "body": "do you mean the problem might be related to `sage.tests.interrupt.interrupt_after_delay`?\nIf you disable the test, and try to interrupt ecmfactor by hand, does it work ok?\n\nPaul",
    "created_at": "2012-04-23T13:14:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12605#issuecomment-149727",
    "user": "https://github.com/zimmermann6"
}
```

do you mean the problem might be related to `sage.tests.interrupt.interrupt_after_delay`?
If you disable the test, and try to interrupt ecmfactor by hand, does it work ok?

Paul



---

archive/issue_comments_149728.json:
```json
{
    "body": "It looks like a bug in Cython.  `ecmfactor()` gets called with `B1 = -NaN`.  This is certainly not the fault of ECM.",
    "created_at": "2012-04-23T13:46:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12605#issuecomment-149728",
    "user": "https://github.com/jdemeyer"
}
```

It looks like a bug in Cython.  `ecmfactor()` gets called with `B1 = -NaN`.  This is certainly not the fault of ECM.



---

archive/issue_comments_149729.json:
```json
{
    "body": "After the interrupt test, the following doctest:\n\n```\n        sage: n = 100\n        sage: float(n)\n        100.0\n```\nfails with:\n\n```\n**********************************************************************\nFile \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.0.beta14/devel/sage/sage/libs/libecm.pyx\", line 73:\n    sage: float(n)\nExpected:\n    100.0\nGot:\n    nan\n**********************************************************************\n```",
    "created_at": "2012-04-23T14:03:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12605#issuecomment-149729",
    "user": "https://github.com/jdemeyer"
}
```

After the interrupt test, the following doctest:

```
        sage: n = 100
        sage: float(n)
        100.0
```
fails with:

```
**********************************************************************
File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.0.beta14/devel/sage/sage/libs/libecm.pyx", line 73:
    sage: float(n)
Expected:
    100.0
Got:
    nan
**********************************************************************
```



---

archive/issue_comments_149730.json:
```json
{
    "body": "My current guess is that OpenSolaris's `longjmp()` doesn't completely restore the x87 FPU state.",
    "created_at": "2012-04-24T14:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12605#issuecomment-149730",
    "user": "https://github.com/jdemeyer"
}
```

My current guess is that OpenSolaris's `longjmp()` doesn't completely restore the x87 FPU state.



---

archive/issue_comments_149731.json:
```json
{
    "body": "Confirmed, it's a bug in `longjmp()`.  The FPU tag word isn't restored properly.",
    "created_at": "2012-04-24T15:05:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12605#issuecomment-149731",
    "user": "https://github.com/jdemeyer"
}
```

Confirmed, it's a bug in `longjmp()`.  The FPU tag word isn't restored properly.



---

archive/issue_comments_149732.json:
```json
{
    "body": "I opened #12873 for the Solaris issue.  Restoring positive_review here, since the bug is unrelated to this ticket.",
    "created_at": "2012-04-24T15:26:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12605#issuecomment-149732",
    "user": "https://github.com/jdemeyer"
}
```

I opened #12873 for the Solaris issue.  Restoring positive_review here, since the bug is unrelated to this ticket.



---

archive/issue_comments_149733.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-04-24T15:26:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12605#issuecomment-149733",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_149734.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-04-24T15:26:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12605#issuecomment-149734",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_034727.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-26T21:58:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12605",
    "milestone": "sage-pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12605#event-34727"
}
```



---

archive/issue_comments_149735.json:
```json
{
    "body": "Jeroen, why reschedule to sage-pending and not sage-5.1?\n\nPaul",
    "created_at": "2012-04-27T06:46:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12605#issuecomment-149735",
    "user": "https://github.com/zimmermann6"
}
```

Jeroen, why reschedule to sage-pending and not sage-5.1?

Paul



---

archive/issue_events_034728.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-05-02T21:51:31Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12605",
    "milestone": "sage-pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12605#event-34728"
}
```



---

archive/issue_events_034729.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-05-02T21:51:31Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12605",
    "milestone": "sage-5.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12605#event-34729"
}
```



---

archive/issue_events_034730.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-05-06T12:18:41Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12605",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12605#event-34730"
}
```



---

archive/issue_comments_149736.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-05-06T12:18:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12605",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12605#issuecomment-149736",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
