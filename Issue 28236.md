# Issue 28236: decomposition by clique minimal separators

archive/issues_028236.json:
```json
{
    "body": "We implement the following methods:\n- `maximum_cardinality_search` (MCS) graph traversal -- `O(n + m)`\n- `maximum_cardinality_search_M` (MCS-M) graph traversal, an extension of MCS that also returns a minimal triangulation -- `O(n.m)`\n- `atoms`, a method that decompose the graph according its minimal clique separators and returns its atoms and clique separators -- `O(n.m)`\n\nIssue created by migration from https://trac.sagemath.org/ticket/28473\n\n",
    "created_at": "2019-09-11T09:36:02Z",
    "labels": [
        "component: graph theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "decomposition by clique minimal separators",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28236",
    "user": "https://github.com/dcoudert"
}
```
We implement the following methods:
- `maximum_cardinality_search` (MCS) graph traversal -- `O(n + m)`
- `maximum_cardinality_search_M` (MCS-M) graph traversal, an extension of MCS that also returns a minimal triangulation -- `O(n.m)`
- `atoms`, a method that decompose the graph according its minimal clique separators and returns its atoms and clique separators -- `O(n.m)`

Issue created by migration from https://trac.sagemath.org/ticket/28473





---

archive/issue_comments_398357.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-09-11T15:07:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28236#issuecomment-398357",
    "user": "https://github.com/dcoudert"
}
```

New commits:



---

archive/issue_comments_398358.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-09-11T15:07:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28236#issuecomment-398358",
    "user": "https://github.com/dcoudert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_398359.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-09-12T09:26:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28236#issuecomment-398359",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_398360.json:
```json
{
    "body": "Fix a doctest in `lex_M` that is now a method of `Graph` and no longer of `GenericGraph` (it works for undirected graphs only), simplifies some tests (no need to waste time), and fix compilation warnings.",
    "created_at": "2019-09-12T09:30:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28236#issuecomment-398360",
    "user": "https://github.com/dcoudert"
}
```

Fix a doctest in `lex_M` that is now a method of `Graph` and no longer of `GenericGraph` (it works for undirected graphs only), simplifies some tests (no need to waste time), and fix compilation warnings.



---

archive/issue_comments_398361.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-07T10:15:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28236#issuecomment-398361",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_398362.json:
```json
{
    "body": "Successfully tested over 9.0",
    "created_at": "2020-01-04T11:43:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28236#issuecomment-398362",
    "user": "https://github.com/dcoudert"
}
```

Successfully tested over 9.0



---

archive/issue_comments_398363.json:
```json
{
    "body": "Can you rebase? I will do the review after that.",
    "created_at": "2020-01-16T08:18:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28236#issuecomment-398363",
    "user": "https://github.com/tscrim"
}
```

Can you rebase? I will do the review after that.



---

archive/issue_comments_398364.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-01-16T09:27:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28236#issuecomment-398364",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_398365.json:
```json
{
    "body": "I fixed the merge conflicts.",
    "created_at": "2020-01-16T09:28:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28236#issuecomment-398365",
    "user": "https://github.com/dcoudert"
}
```

I fixed the merge conflicts.



---

archive/issue_comments_398366.json:
```json
{
    "body": "Here are my comments:\n\nI think it is better to have the import grouped:\n\n```diff\n-    from sage.graphs.traversals import lex_M\n-    from sage.graphs.traversals import maximum_cardinality_search\n-    from sage.graphs.traversals import maximum_cardinality_search_M\n+    from sage.graphs.traversals import (lex_M, maximum_cardinality_search,\n+                                        maximum_cardinality_search_M)\n```\n\nYou can do the same thing for `cimport` as well IIRC.\n\nI don't know if Cython is smart enough to break this up (which means you'll have to look at the C code), but I am a little dubious about this line:\n\n```\nSc.extend(res[2 if separators else 1])\n```\n\nand I think you will get better C code if you do\n\n```\nif separators:\n    Sc.extend(res[2])\nelse:\n    Sc.extend(res[1])\n```\n\n\nIn `atoms_and_clique_separators`, since you use `H[x]` a lot, it probably would be good to define a variable for it. Same for `H[x].size()`. I think it also would be good to pull out\n\n```python\n            # Check if the subgraph of G[H[x]] is a clique\n            stop = False\n            for ui in range(H[x].size() -1):\n                u = H[x][ui]\n                for vi in range(ui + 1, H[x].size()):\n                    if not has_edge(sd, u, H[x][vi]):\n                        stop = True\n                        break\n                if stop:\n                    break\n            else:\n```\n\ninto a separate `cdef inline` helper function (which does not need doctests).\n\n\n```diff\n-    OUPUT: by default, return the ordering `\\alpha` as a list. When ``tree`` is\n+    OUTPUT:\n+\n+    By default, return the ordering `\\alpha` as a list. When ``tree`` is\n     ``True``, the method returns a tuple `(\\alpha, T)`, where `T` is a directed\n     tree with the same set of vertices as `G`and a directed edge from `u` to `v`\n     if `u` was the first vertex to saw `v`.\n```\n\n\n\n```diff\n-    for i in range(G.order()):\n+    for i in range(N):\n```\n",
    "created_at": "2020-01-16T15:31:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28236#issuecomment-398366",
    "user": "https://github.com/tscrim"
}
```

Here are my comments:

I think it is better to have the import grouped:

```diff
-    from sage.graphs.traversals import lex_M
-    from sage.graphs.traversals import maximum_cardinality_search
-    from sage.graphs.traversals import maximum_cardinality_search_M
+    from sage.graphs.traversals import (lex_M, maximum_cardinality_search,
+                                        maximum_cardinality_search_M)
```

You can do the same thing for `cimport` as well IIRC.

I don't know if Cython is smart enough to break this up (which means you'll have to look at the C code), but I am a little dubious about this line:

```
Sc.extend(res[2 if separators else 1])
```

and I think you will get better C code if you do

```
if separators:
    Sc.extend(res[2])
else:
    Sc.extend(res[1])
```


In `atoms_and_clique_separators`, since you use `H[x]` a lot, it probably would be good to define a variable for it. Same for `H[x].size()`. I think it also would be good to pull out

```python
            # Check if the subgraph of G[H[x]] is a clique
            stop = False
            for ui in range(H[x].size() -1):
                u = H[x][ui]
                for vi in range(ui + 1, H[x].size()):
                    if not has_edge(sd, u, H[x][vi]):
                        stop = True
                        break
                if stop:
                    break
            else:
```

into a separate `cdef inline` helper function (which does not need doctests).


```diff
-    OUPUT: by default, return the ordering `\alpha` as a list. When ``tree`` is
+    OUTPUT:
+
+    By default, return the ordering `\alpha` as a list. When ``tree`` is
     ``True``, the method returns a tuple `(\alpha, T)`, where `T` is a directed
     tree with the same set of vertices as `G`and a directed edge from `u` to `v`
     if `u` was the first vertex to saw `v`.
```



```diff
-    for i in range(G.order()):
+    for i in range(N):
```




---

archive/issue_comments_398367.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-01-16T16:21:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28236#issuecomment-398367",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_398368.json:
```json
{
    "body": "Thanks for the comments.",
    "created_at": "2020-01-16T16:23:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28236#issuecomment-398368",
    "user": "https://github.com/dcoudert"
}
```

Thanks for the comments.



---

archive/issue_comments_398369.json:
```json
{
    "body": "Thanks. LGTM.",
    "created_at": "2020-01-16T16:26:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28236#issuecomment-398369",
    "user": "https://github.com/tscrim"
}
```

Thanks. LGTM.



---

archive/issue_comments_398370.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-01-16T16:26:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28236#issuecomment-398370",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_398371.json:
```json
{
    "body": "Thank you for the review.",
    "created_at": "2020-01-16T16:33:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28236#issuecomment-398371",
    "user": "https://github.com/dcoudert"
}
```

Thank you for the review.



---

archive/issue_comments_398372.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-01-20T21:18:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28236#issuecomment-398372",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_026153.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2020-01-20T21:18:34Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28236",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28236#event-26153"
}
```
