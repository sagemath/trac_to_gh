# Issue 34336: Remove binary_function from ginac's code in sage

Issue created by migration from https://trac.sagemath.org/ticket/34573

Original creator: fbissey

Original creation time: 2022-09-23 00:59:55

CC:  arojas

The use of `std::binary_function` and `std::unary_function` have been deprecated for almost 10 years and gcc-12 is now signalling it. They may be completely removed soon. We get the following warnings when building sage

```
INFO: compile options: '-I./sage/cpython -I/home/portage/sci-mathematics/sage-9999/work/sage-9999/src -I/usr/lib/python3.10/site-packages/numpy/core/include -I/usr/include/python3.10 -Ibuild/cythonized -I/usr/include/python3.10 -c'
extra options: '-fno-strict-aliasing -DCYTHON_CLINE_IN_TRACEBACK=1'
INFO: x86_64-pc-linux-gnu-gcc: build/cythonized/sage/symbolic/ring.c
INFO: x86_64-pc-linux-gnu-gcc: sage/symbolic/ginac/ex.cpp
In file included from sage/symbolic/ginac/basic.h:35,
                 from sage/symbolic/ginac/ex.h:26,
                 from sage/symbolic/ginac/assume.cpp:8:
sage/symbolic/ginac/ptr.h:162:11: warning: ‘template<class _Arg1, class _Arg2, class _Result> struct std::binary_function’ is deprecated [-Wdeprecated-declarations]
  162 |  : public binary_function<GiNaC::ptr<T>, GiNaC::ptr<T>, bool> {
      |           ^~~~~~~~~~~~~~~
In file included from /usr/lib/gcc/x86_64-pc-linux-gnu/12.2.0/include/g++-v12/bits/refwrap.h:39,
                 from /usr/lib/gcc/x86_64-pc-linux-gnu/12.2.0/include/g++-v12/vector:66,
                 from sage/symbolic/ginac/basic.h:26:
/usr/lib/gcc/x86_64-pc-linux-gnu/12.2.0/include/g++-v12/bits/stl_function.h:131:12: note: declared here
```

The following files contain offending code

```
src/sage/symbolic/ginac/order.h:class print_order : public std::binary_function<ex, ex, bool> {
src/sage/symbolic/ginac/order.h:        public std::binary_function<expair, expair, bool>
src/sage/symbolic/ginac/expair.h:struct expair_is_less : public std::binary_function<expair, expair, bool> {
src/sage/symbolic/ginac/expair.h:struct expair_rest_is_less : public std::binary_function<expair, expair, bool> {
src/sage/symbolic/ginac/expair.h:struct expair_swap : public std::binary_function<expair, expair, void> {
src/sage/symbolic/ginac/ptr.h: : public binary_function<GiNaC::ptr<T>, GiNaC::ptr<T>, bool> {
src/sage/symbolic/ginac/ex.h:struct ex_is_less : public std::binary_function<ex, ex, bool> {
src/sage/symbolic/ginac/ex.h:struct ex_is_equal : public std::binary_function<ex, ex, bool> {
src/sage/symbolic/ginac/ex.h:struct op0_is_equal : public std::binary_function<ex, ex, bool> {
src/sage/symbolic/ginac/ex.h:struct ex_swap : public std::binary_function<ex, ex, void> {
```


There are no instances of `unary_function` in sage.

I did a similar clean up in brial quite recently https://github.com/BRiAl/BRiAl/pull/52/files


---

Comment by mkoeppe created at 2022-09-23 01:21:29

We should take a look at what upstream did with the affected code (see #33401). They had many C++ cleanups over the years.


---

Comment by fbissey created at 2022-09-23 01:24:58

That is true, but right now I will just focus on that bit. Most of the time just removing the offending characters works. In real time, it appears to have compiled cleanly locally. Moving on doctesting.


---

Comment by mkoeppe created at 2022-09-23 01:28:36

Upstream did this change in 319c9533e12eba2449001c47545e3c3cf48c482f


---

Comment by fbissey created at 2022-09-23 01:30:04

Right, I supposed I should discard what I have just done and use that instead. It should have gone through more testing.


---

Comment by fbissey created at 2022-09-23 01:32:37

I never thought about that before, how do I track a hash down on github? Do You have to check out and search with git manually?


---

Comment by mkoeppe created at 2022-09-23 01:34:57

Only tried this out now, but a global search for that sha finds repo & commit!
https://github.com/search?q=319c9533e12eba2449001c47545e3c3cf48c482f&type=commits


---

Comment by fbissey created at 2022-09-23 01:42:17

OK, that's interesting. So, my patch includes touching one file not in that commit because it is not in that repository. And the commit touches files we do not have in sage. Where they overlap, my job is identical to one white space difference.

So, I think I'll just send my branch and we'll think about synchronisation later because that won't be fun.


---

Comment by mkoeppe created at 2022-09-23 01:43:43

Yes, I agree.


---

Comment by fbissey created at 2022-09-23 02:01:26

New commits:


---

Comment by fbissey created at 2022-09-23 02:01:26

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2022-09-23 17:14:56

Changing status from needs_review to positive_review.


---

Comment by @sheerluck created at 2022-09-25 09:59:19

positive review from gentoo user


---

Comment by vbraun created at 2022-09-27 22:27:49

Resolution: fixed
