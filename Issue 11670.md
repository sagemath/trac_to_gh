# Issue 11670: substitute_function doesn't work as expected in many cases

archive/issues_011670.json:
```json
{
    "body": "Assignee: @burcin\n\nI'm working on polynomial interpolation at the moment, and these are starting to hurt. Most of them have workarounds, but there don't seem to be any for the expressions involving derivatives.\n\nI've also tried with subs() and the like, but one step at a time.\n\n\n```\nfrom sage.all import *\n\n\n# 1. Fails.\nx = var('x')\nf = function('f', x)\ng = function('g', x)\np = f\nprint p.substitute_function(f, g) # Outputs \"f(x)\"\n\n\n\n# 2. Fails.\nx = var('x')\nf = function('f')\ng = function('g')\np = f(x)\nprint p.substitute_function(f(x), g(x)) # Outputs \"f(x)\"\n\n\n\n# 3. Fails.\nx = var('x')\nf = function('f')\ng = function('g')\np = f(x)\nprint p.substitute_function(f, g) # Outputs \"g(x)\"\n\n\n\n# 4. Fails.\nx = var('x')\nf = function('f')\ng = function('g')\np = f(1)\nprint p.substitute_function(f(1), g(1)) # Outputs \"f(1)\"\n\n\n\n# 5. Works.\nx = var('x')\nf = function('f')\ng = function('g')\np = f(1)\nprint p.substitute_function(f, g) # Outputs \"g(1)\"\n\n\n\n# 6. Fails.\nx = var('x')\nf = function('f', x)\ng = function('g', x)\np = f.diff()\nprint p.substitute_function(f, g) # Outputs \"D[0](f)(x)\"\n\n\n\n# 7. Fails.\nx = var('x')\nf = function('f', x)\ng = function('g', x)\np = f.diff()\nprint p.substitute_function(f(x), g(x)) # Outputs \"D[0](f)(x)\"\n\n\n\n# 8. Works.\nx = var('x')\nf = function('f')\ng = function('g')\np = f(x).diff()\nprint p.substitute_function(f, g) # Outputs \"D[0](g)(x)\"\n\n\n\n# 9. Fails.\nx = var('x')\nf = function('f')\ng = function('g')\np = f(x).diff()(1)\nprint p.substitute_function(f(x).diff(), g(x).diff()) # Outputs \"D[0](f)(1)\"\n\n\n\n# 10. Fails.\nx = var('x')\nf = function('f')\ng = function('g')\np = f(x).diff()(1)\nprint p.substitute_function(f, g) # Crashes.\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/11842\n\n",
    "created_at": "2011-09-24T01:59:58Z",
    "labels": [
        "component: symbolics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "substitute_function doesn't work as expected in many cases",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11670",
    "user": "https://github.com/orlitzky"
}
```
Assignee: @burcin

I'm working on polynomial interpolation at the moment, and these are starting to hurt. Most of them have workarounds, but there don't seem to be any for the expressions involving derivatives.

I've also tried with subs() and the like, but one step at a time.


```
from sage.all import *


# 1. Fails.
x = var('x')
f = function('f', x)
g = function('g', x)
p = f
print p.substitute_function(f, g) # Outputs "f(x)"



# 2. Fails.
x = var('x')
f = function('f')
g = function('g')
p = f(x)
print p.substitute_function(f(x), g(x)) # Outputs "f(x)"



# 3. Fails.
x = var('x')
f = function('f')
g = function('g')
p = f(x)
print p.substitute_function(f, g) # Outputs "g(x)"



# 4. Fails.
x = var('x')
f = function('f')
g = function('g')
p = f(1)
print p.substitute_function(f(1), g(1)) # Outputs "f(1)"



# 5. Works.
x = var('x')
f = function('f')
g = function('g')
p = f(1)
print p.substitute_function(f, g) # Outputs "g(1)"



# 6. Fails.
x = var('x')
f = function('f', x)
g = function('g', x)
p = f.diff()
print p.substitute_function(f, g) # Outputs "D[0](f)(x)"



# 7. Fails.
x = var('x')
f = function('f', x)
g = function('g', x)
p = f.diff()
print p.substitute_function(f(x), g(x)) # Outputs "D[0](f)(x)"



# 8. Works.
x = var('x')
f = function('f')
g = function('g')
p = f(x).diff()
print p.substitute_function(f, g) # Outputs "D[0](g)(x)"



# 9. Fails.
x = var('x')
f = function('f')
g = function('g')
p = f(x).diff()(1)
print p.substitute_function(f(x).diff(), g(x).diff()) # Outputs "D[0](f)(1)"



# 10. Fails.
x = var('x')
f = function('f')
g = function('g')
p = f(x).diff()(1)
print p.substitute_function(f, g) # Crashes.
```


Issue created by migration from https://trac.sagemath.org/ticket/11842





---

archive/issue_comments_131762.json:
```json
{
    "body": "It looks like I accidentally duped #6480 here.",
    "created_at": "2012-01-03T22:47:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11670#issuecomment-131762",
    "user": "https://github.com/orlitzky"
}
```

It looks like I accidentally duped #6480 here.



---

archive/issue_events_031233.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2012-01-03T22:47:57Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11670",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11670#event-31233"
}
```



---

archive/issue_comments_131763.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-02-08T11:36:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11670#issuecomment-131763",
    "user": "https://github.com/burcin"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_131764.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-02-08T11:36:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11670#issuecomment-131764",
    "user": "https://github.com/burcin"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_031234.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-02-16T21:30:26Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11670",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11670#event-31234"
}
```



---

archive/issue_comments_131765.json:
```json
{
    "body": "Resolution: duplicate",
    "created_at": "2012-02-16T21:30:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11670#issuecomment-131765",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: duplicate
