# Issue 15091: Filtered vector spaces and Klyachko bundles on toric varieties

Issue created by migration from https://trac.sagemath.org/ticket/15328

Original creator: vbraun

Original creation time: 2013-10-26 13:20:55

This ticket implements filtered vector spaces and multi-filtered vector spaces (multiple filtrations of a single vector space). This is then used to implement Klyachko bundles.


---

Comment by vbraun created at 2013-10-26 13:21:22

Last 10 new commits:


---

Comment by vbraun created at 2013-10-26 13:21:22

Changing status from new to needs_review.


---

Comment by git created at 2013-10-27 21:50:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2014-05-11 06:51:07

Changing status from needs_review to needs_work.


---

Comment by git created at 2014-05-12 09:41:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2014-05-12 09:42:57

Changing status from needs_work to needs_review.


---

Comment by rws created at 2014-05-18 16:27:38


```
Error building the documentation.
Traceback (most recent call last):
...
OSError: [modules  ] /home/ralf/sage/local/lib/python2.7/site-packages/sage/modules/tensor_operations.py:docstring of sage.modules.tensor_operations:31: ERROR: Unexpected indentation.
```



---

Comment by rws created at 2014-05-18 16:27:38

Changing status from needs_review to needs_work.


---

Comment by chapoton created at 2015-08-09 09:10:08

rebased
----
New commits:


---

Comment by git created at 2015-08-09 09:54:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2015-08-09 09:55:10

doc now builds. Back to needs review.


---

Comment by chapoton created at 2015-08-09 09:55:10

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2015-08-09 11:37:00

Missing doctests  modules/tensor_operations.py 12 / 14 = 85%

```
SCORE src/sage/modules/tensor_operations.py: 85.7% (12 of 14)

Missing documentation:
     * line 170: def __init__(self, vector_collection, base_ring, dim)
     * line 254: def __init__(self, vector_collections, operation='product')

Possibly wrong (function name doesn't occur in doctests):
     * line 341: def _init_product(self)
     * line 361: def _init_symmetric(self)
     * line 383: def _init_antisymmetric(self)

```

so needs_work again


---

Comment by chapoton created at 2015-08-09 11:37:00

Changing status from needs_review to needs_work.


---

Comment by chapoton created at 2015-08-09 18:57:59

Changing keywords from "" to "filtered".


---

Comment by chapoton created at 2015-08-09 18:58:28

See also #17096


---

Comment by git created at 2015-09-10 19:48:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-12-22 17:18:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-12-27 20:32:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2015-12-27 20:39:30

There is no dot product in `tensor_operations.py`, only tensor products. Your fix was incorrect because of this (somewhat questionable) behavior of cartesian product:

```
sage: cartesian_product([[1,2], [3,4]])
The cartesian product of ({1, 2}, {3, 4})
sage: list(_)
[(1, 3), (1, 4), (2, 3), (2, 4)]
```

vs.

```
sage: cartesian_product([vector([1,2]), vector([3,4])])
((1, 2), (3, 4))
```



---

Comment by vbraun created at 2015-12-27 20:39:30

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2016-01-10 14:03:27

Main question: what about the relation to filtered modules introduced in #17096 ?

a typo : function accepcts various


---

Comment by vbraun created at 2016-01-10 15:36:03

Replying to [comment:22 chapoton]:
> Main question: what about the relation to filtered modules introduced in #17096 ?

None, this ticket predates #17096 by a year


---

Comment by git created at 2016-01-10 15:40:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2016-01-10 17:31:35

Yes, and so what ? Do you claim priority of ticket _creation_ has any importance ?

Now #17096 is in sage and this ticket is not. I think that there should be at least a try not to duplicate filtered modules.


---

Comment by vbraun created at 2016-01-10 18:32:36

#17096 doesn't have tensor operations as far as I can tell, its totally useless for this ticket.


---

Comment by dimpase created at 2016-01-15 11:09:11

this has just one reference, to a paper by Alex Klyachko published 25 years ago. Certainly there should be more modern references, otherwise it's unclear why one wants to have this in Sage...
(this paper has a large following, perhaps you can mention more popular sources? A reference to a chapter in the Cox's et al. "Toric Varieties" book?)


---

Comment by vbraun created at 2016-01-15 11:18:37

Its implemented in M2 http://www.math.uiuc.edu/Macaulay2/doc/Macaulay2-1.8.2/share/doc/Macaulay2/ToricVectorBundles/html/

This implementation is a good deal faster, in fact I wrote it because M2 was too slow.

I don't know of a better reference than Klyachko. Really its obvious, an equivariant bundle is determined by how the (finitely many, in the case of a toric variety) orbits fit together. The rest is just technical bookkeeping, and Klyachko writes down the details if you care for them.


---

Comment by dimpase created at 2016-01-15 12:15:28

well, add this ref to M2, at least; otherwise it's really hard to put into context for anyone who is not deeply involved in the toric varieties business.

And, by the way, the name is wrong:

```
+ Klyachko, Anton Alexander:
```

it's a different guy: Klyachko, Aleksandr Anatolʹevich (MR Author ID: 	189605)

      Published as: Kljačko, A. A. ...
         Klyachko, A.
         Klyachko, A. A.
         Klyachko, Alexander
         Klyachko, Alexander A.


---

Comment by dimpase created at 2016-01-15 12:18:13

there is indeed a mathematician named Anton Aleksandrovich Klyachko; the name says that the name of his father is Alexander.


---

Comment by vbraun created at 2016-01-15 12:54:09

The Journal website says "Alexander A Klyachko" fwiw:

http://iopscience.iop.org/article/10.1070/IM1990v035n02ABEH000707/meta;jsessionid=02E4331E01230A500B4CD6E8046730FF.c2.iopscience.cld.iop.org


---

Comment by git created at 2016-01-15 13:00:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2016-01-15 22:23:44

tried building docs and got errors, cause this ref is already there:

```
git blame src/sage/geometry/fan.py | grep "\[Klya"
...
bfd3bb4c (Volker Braun       2011-12-15 22:41:11 +0000 3435)         ..  [Klyachko]
```



---

Comment by git created at 2016-01-16 00:44:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2016-01-16 00:44:37

Hmm strange the patchbot didn't notice; Anyways fixed now.


---

Comment by dimpase created at 2016-01-16 07:50:27

try other fields, not just QQ. E.g. the following looks weird:

```
sage: FilteredVectorSpace({1:[(1,0), (-1,1)], 3:[(1,0)]},base_ring=GF(3))
Finite Field of size 3^2 >= Finite Field of size 3^1 >= Finite Field of size 3^1 >= 0
```



---

Comment by git created at 2016-01-16 09:38:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2016-01-16 13:19:00


```
sage: f1.random_deformation()
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-2-904b4efece1b> in <module>()
----> 1 f1.random_deformation()

/home/dima/software/sage/local/lib/python2.7/site-packages/sage/modules/filtered_vector_space.pyc in random_deformation(self, epsilon)
   1230                           for v in filt.echelonized_basis()]
   1231             filtration[deg] = generators
-> 1232         return FilteredVectorSpace(filtration, check=True)

...
TypeError: Unable to coerce 1 (<type 'sage.rings.finite_rings.element_givaro.FiniteField_givaroElement'>) to Rational
sage: 
```

Somewhere here char=0 seems to be assumed...


---

Comment by dimpase created at 2016-01-16 13:32:28

there

```
sage: f1=FilteredVectorSpace({1:[(1,0), (0,1)], 3:[(1,0)]},base_ring=GF(9,'a'),check=True)
```



---

Comment by git created at 2016-01-16 14:38:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2016-01-16 14:38:28

Thanks, fixed.


---

Comment by dimpase created at 2016-01-17 21:21:08

Could you add a couple of examples in positive characteristic, just to illustrate that this all works? Otherwise I am happy to give it a positive review.


---

Comment by git created at 2016-01-23 16:57:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2016-01-23 16:58:20

Done


---

Comment by vbraun created at 2016-01-23 16:58:20

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-01-24 12:52:54

Resolution: fixed
