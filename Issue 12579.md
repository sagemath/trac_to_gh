# Issue 12579: make sage build with gcc-4.7

archive/issues_012579.json:
```json
{
    "body": "Assignee: GeorgSWeber\n\nCC:  jdemeyer leif\n\nsage-5.0.beta10 fails to build using gcc-4.7.0\non Skynet/eno.\n\nFirst failure is at linbox-1.1.6.p7:\n\n\n```\n../../linbox/matrix/matrix-domain.h:821:36: error: \u2018mulColDense\u2019 was not declared in this scope, and no declarations were found by argument-dependent lookup at the point of instantiation [-fpermissive]\n../../linbox/matrix/matrix-domain.h:821:36: note: declarations in dependent base \u2018LinBox::MVProductDomain<LinBox::GivaroExtension<LinBox::Modular<unsigned int> > >\u2019 are not found by unqualified lookup\n../../linbox/matrix/matrix-domain.h:821:36: note: use \u2018this->mulColDense\u2019 instead\nmake[4]: *** [linbox-sage.lo] Error 1\nmake[4]: Leaving directory `/home/mariah/sage/sage-5.0.beta10-x86_64-Linux-core2-fc-gcc-4.7.0/spkg/build/linbox-1.1.6.p7/src/interfaces/sage'\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/12751\n\n",
    "created_at": "2012-03-26T19:48:57Z",
    "labels": [
        "build",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.2",
    "title": "make sage build with gcc-4.7",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12579",
    "user": "mariah"
}
```
Assignee: GeorgSWeber

CC:  jdemeyer leif

sage-5.0.beta10 fails to build using gcc-4.7.0
on Skynet/eno.

First failure is at linbox-1.1.6.p7:


```
../../linbox/matrix/matrix-domain.h:821:36: error: ‘mulColDense’ was not declared in this scope, and no declarations were found by argument-dependent lookup at the point of instantiation [-fpermissive]
../../linbox/matrix/matrix-domain.h:821:36: note: declarations in dependent base ‘LinBox::MVProductDomain<LinBox::GivaroExtension<LinBox::Modular<unsigned int> > >’ are not found by unqualified lookup
../../linbox/matrix/matrix-domain.h:821:36: note: use ‘this->mulColDense’ instead
make[4]: *** [linbox-sage.lo] Error 1
make[4]: Leaving directory `/home/mariah/sage/sage-5.0.beta10-x86_64-Linux-core2-fc-gcc-4.7.0/spkg/build/linbox-1.1.6.p7/src/interfaces/sage'
```


Issue created by migration from https://trac.sagemath.org/ticket/12751





---

archive/issue_comments_149570.json:
```json
{
    "body": "Changing keywords from \"\" to \"GCC 4.7.0 C++11\".",
    "created_at": "2012-03-28T12:37:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12579#issuecomment-149570",
    "user": "leif"
}
```

Changing keywords from "" to "GCC 4.7.0 C++11".



---

archive/issue_comments_149571.json:
```json
{
    "body": "Also PARI 2.5.1's test suite fails due to segfaults in two test files, `compat` and `linear` (statically linked `gp` as well as the dynamically linked one).\n\nSciPy's test suite fails to build due to an internal compiler error.\n\nR now fails to build for me (when byte-compiling), interestingly only with *less* fancy GCC optimizations enabled.  (It did build with LTO and Graphite loop optimization enabled).\n\nThis is all on Ubuntu 10.04.4 LTS x86_64.",
    "created_at": "2012-03-28T12:37:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12579#issuecomment-149571",
    "user": "leif"
}
```

Also PARI 2.5.1's test suite fails due to segfaults in two test files, `compat` and `linear` (statically linked `gp` as well as the dynamically linked one).

SciPy's test suite fails to build due to an internal compiler error.

R now fails to build for me (when byte-compiling), interestingly only with *less* fancy GCC optimizations enabled.  (It did build with LTO and Graphite loop optimization enabled).

This is all on Ubuntu 10.04.4 LTS x86_64.



---

archive/issue_comments_149572.json:
```json
{
    "body": "Replying to [comment:5 leif]:\n> SciPy's test suite fails to build due to an internal compiler error.\n\nTurns out that this isn't reproducible.  Actually, in the first attempt (although with `SAGE_CHECK=yes`) *the build* failed, before the test suite got built or run.\n\nI've then successfully rebuilt SciPy without `SAGE_CHECK=yes`, and now also again with it.\n\nNevertheless, SciPy's `spkg-check` (for whatever reason a Python script) is suboptimal, and `spkg-install` **overwrites** `LDFLAGS`.  (It also unsets `CFLAGS` etc., but distutils take these from Python, so that's not as bad as it sounds, provided one doesn't want to rebuild [Python and] SciPy with different flags.)",
    "created_at": "2012-03-28T13:15:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12579#issuecomment-149572",
    "user": "leif"
}
```

Replying to [comment:5 leif]:
> SciPy's test suite fails to build due to an internal compiler error.

Turns out that this isn't reproducible.  Actually, in the first attempt (although with `SAGE_CHECK=yes`) *the build* failed, before the test suite got built or run.

I've then successfully rebuilt SciPy without `SAGE_CHECK=yes`, and now also again with it.

Nevertheless, SciPy's `spkg-check` (for whatever reason a Python script) is suboptimal, and `spkg-install` **overwrites** `LDFLAGS`.  (It also unsets `CFLAGS` etc., but distutils take these from Python, so that's not as bad as it sounds, provided one doesn't want to rebuild [Python and] SciPy with different flags.)



---

archive/issue_comments_149573.json:
```json
{
    "body": "Replying to [comment:5 leif]:\n> Also PARI 2.5.1's test suite fails due to segfaults in two test files, `compat` and `linear` (statically linked `gp` as well as the dynamically linked one).\n\nFWIW, I get the same test errors in the build with GCC 4.7.0 with LTO and Graphite loop optimization enabled.  Note that `ptestlong` passed for that build (with a couple of spkgs replaced, cf. sage-release thread for Sage 5.0.beta10).",
    "created_at": "2012-03-28T14:23:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12579#issuecomment-149573",
    "user": "leif"
}
```

Replying to [comment:5 leif]:
> Also PARI 2.5.1's test suite fails due to segfaults in two test files, `compat` and `linear` (statically linked `gp` as well as the dynamically linked one).

FWIW, I get the same test errors in the build with GCC 4.7.0 with LTO and Graphite loop optimization enabled.  Note that `ptestlong` passed for that build (with a couple of spkgs replaced, cf. sage-release thread for Sage 5.0.beta10).



---

archive/issue_comments_149574.json:
```json
{
    "body": "Replying to [comment:5 leif]:\n> R now fails to build for me (when byte-compiling), interestingly only with *less* fancy GCC optimizations enabled.  (It did build with LTO and Graphite loop optimization enabled).\n\nThis is *really* weird: R *does* build if I just in addition enable LTO... 8)\n\n(My second Sage 5.0.beta10 build with GCC 4.7.0, without LTO and Graphite loop optimization, just used `-march=native -O3 -g -fno-strict-aliasing`.)",
    "created_at": "2012-03-28T17:32:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12579#issuecomment-149574",
    "user": "leif"
}
```

Replying to [comment:5 leif]:
> R now fails to build for me (when byte-compiling), interestingly only with *less* fancy GCC optimizations enabled.  (It did build with LTO and Graphite loop optimization enabled).

This is *really* weird: R *does* build if I just in addition enable LTO... 8)

(My second Sage 5.0.beta10 build with GCC 4.7.0, without LTO and Graphite loop optimization, just used `-march=native -O3 -g -fno-strict-aliasing`.)



---

archive/issue_comments_149575.json:
```json
{
    "body": "Replying to [comment:9 leif]:\n> Replying to [comment:5 leif]:\n> > R now fails to build for me (when byte-compiling), interestingly only with *less* fancy GCC optimizations enabled.  (It did build with LTO and Graphite loop optimization enabled).\n> \n> This is *really* weird: R *does* build if I just in addition enable LTO... 8)\n\n... and also passes its test suite with that.",
    "created_at": "2012-03-28T18:30:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12579#issuecomment-149575",
    "user": "leif"
}
```

Replying to [comment:9 leif]:
> Replying to [comment:5 leif]:
> > R now fails to build for me (when byte-compiling), interestingly only with *less* fancy GCC optimizations enabled.  (It did build with LTO and Graphite loop optimization enabled).
> 
> This is *really* weird: R *does* build if I just in addition enable LTO... 8)

... and also passes its test suite with that.



---

archive/issue_comments_149576.json:
```json
{
    "body": "Changing priority from critical to blocker.",
    "created_at": "2012-03-31T20:49:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12579#issuecomment-149576",
    "user": "jdemeyer"
}
```

Changing priority from critical to blocker.



---

archive/issue_comments_149577.json:
```json
{
    "body": "Replying to [comment:11 jdemeyer]:\n\nBtw., any timeline aimed at for the 5.0 release?",
    "created_at": "2012-03-31T20:53:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12579#issuecomment-149577",
    "user": "leif"
}
```

Replying to [comment:11 jdemeyer]:

Btw., any timeline aimed at for the 5.0 release?



---

archive/issue_comments_149578.json:
```json
{
    "body": "Replying to [comment:12 leif]:\n> Btw., any timeline aimed at for the 5.0 release?\nNo, but you should ask William Stein.",
    "created_at": "2012-04-01T15:13:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12579#issuecomment-149578",
    "user": "jdemeyer"
}
```

Replying to [comment:12 leif]:
> Btw., any timeline aimed at for the 5.0 release?
No, but you should ask William Stein.



---

archive/issue_comments_149579.json:
```json
{
    "body": "For the record: I've updated the LinBox spkg at #12762, now also adding an `spkg-check` script; the test suite wouldn't have built with GCC 4.7.0 (even with `-fpermissive`) [nor with 4.6.3], so I patched some upstream files in addition, and changed the \"disable commentator\" patch.",
    "created_at": "2012-04-08T01:11:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12579#issuecomment-149579",
    "user": "leif"
}
```

For the record: I've updated the LinBox spkg at #12762, now also adding an `spkg-check` script; the test suite wouldn't have built with GCC 4.7.0 (even with `-fpermissive`) [nor with 4.6.3], so I patched some upstream files in addition, and changed the "disable commentator" patch.



---

archive/issue_comments_149580.json:
```json
{
    "body": "Changing keywords from \"GCC 4.7.0 C++11\" to \"GCC 4.7.0 C++11 -fpermissive compiler bugs\".",
    "created_at": "2012-04-12T13:29:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12579#issuecomment-149580",
    "user": "leif"
}
```

Changing keywords from "GCC 4.7.0 C++11" to "GCC 4.7.0 C++11 -fpermissive compiler bugs".



---

archive/issue_comments_149581.json:
```json
{
    "body": "I get a build error for the (old) eclib spkg on **Solaris** [SPARC, 32-bit]:\n\n```\n...\ng++ -c -fPIC -g -O2 -DNEW_OP_ORDER -DUSE_PARI_FACTORING -DNTL_ALL -I/home/leif/Sage/release/build/mark2/sage-5.0.beta13-gcc-4.7.0/local/include -I/home/leif/Sage/release/build/mark2/sage-5.0.beta13-gcc-4.7.0/local/include arith.cc -o arith_n.o\nIn file included from arith.cc:24:0:\narith.h: In function 'int div(long int, long int)':\narith.h:182:39: error: 'int div(long int, long int)' conflicts with previous using declaration 'std::ldiv_t std::div(long int, long int)'\nmake[3]: *** [arith_n.o] Error 1\nmake[3]: Leaving directory `/home/leif/Sage/release/build/mark2/sage-5.0.beta13-gcc-4.7.0/spkg/build/eclib-20100711.p0/src/procs'\nmake[2]: *** [all] Error 2\nmake[2]: Leaving directory `/home/leif/Sage/release/build/mark2/sage-5.0.beta13-gcc-4.7.0/spkg/build/eclib-20100711.p0/src'\nError building eclib\n\nreal    0m9.843s\nuser    0m5.982s\nsys     0m0.474s\n************************************************************************\nError installing package eclib-20100711.p0\n************************************************************************\n```\n\n\nHaven't yet tried the new autotools-enabled upstream package; a new *spkg* should be posted soon on #10993, hopefully...",
    "created_at": "2012-04-15T11:05:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12579#issuecomment-149581",
    "user": "leif"
}
```

I get a build error for the (old) eclib spkg on **Solaris** [SPARC, 32-bit]:

```
...
g++ -c -fPIC -g -O2 -DNEW_OP_ORDER -DUSE_PARI_FACTORING -DNTL_ALL -I/home/leif/Sage/release/build/mark2/sage-5.0.beta13-gcc-4.7.0/local/include -I/home/leif/Sage/release/build/mark2/sage-5.0.beta13-gcc-4.7.0/local/include arith.cc -o arith_n.o
In file included from arith.cc:24:0:
arith.h: In function 'int div(long int, long int)':
arith.h:182:39: error: 'int div(long int, long int)' conflicts with previous using declaration 'std::ldiv_t std::div(long int, long int)'
make[3]: *** [arith_n.o] Error 1
make[3]: Leaving directory `/home/leif/Sage/release/build/mark2/sage-5.0.beta13-gcc-4.7.0/spkg/build/eclib-20100711.p0/src/procs'
make[2]: *** [all] Error 2
make[2]: Leaving directory `/home/leif/Sage/release/build/mark2/sage-5.0.beta13-gcc-4.7.0/spkg/build/eclib-20100711.p0/src'
Error building eclib

real    0m9.843s
user    0m5.982s
sys     0m0.474s
************************************************************************
Error installing package eclib-20100711.p0
************************************************************************
```


Haven't yet tried the new autotools-enabled upstream package; a new *spkg* should be posted soon on #10993, hopefully...



---

archive/issue_comments_149582.json:
```json
{
    "body": "Replying to [comment:21 leif]:\n> I get a build error for the (old) eclib spkg on **Solaris** [SPARC, 32-bit]:\n> {{{\n> ...\n> arith.h:182:39: error: 'int div(long int, long int)' conflicts with previous using declaration 'std::ldiv_t std::div(long int, long int)'\n> ...\n> }}}\n> \n> Haven't yet tried the new autotools-enabled upstream package; a new *spkg* should be posted soon on #10993, hopefully...\n\nIt fails in the same way; yet I have no idea why this only fails on Solaris, as AFAIK\n\n\n```C++\nstd::ldiv_t std::div(long int, long int)\n```\n\n\nis pretty C++98.  Maybe on Solaris just some `using namespace std;` gets pulled in, which isn't present on other systems.",
    "created_at": "2012-04-15T12:37:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12579#issuecomment-149582",
    "user": "leif"
}
```

Replying to [comment:21 leif]:
> I get a build error for the (old) eclib spkg on **Solaris** [SPARC, 32-bit]:
> {{{
> ...
> arith.h:182:39: error: 'int div(long int, long int)' conflicts with previous using declaration 'std::ldiv_t std::div(long int, long int)'
> ...
> }}}
> 
> Haven't yet tried the new autotools-enabled upstream package; a new *spkg* should be posted soon on #10993, hopefully...

It fails in the same way; yet I have no idea why this only fails on Solaris, as AFAIK


```C++
std::ldiv_t std::div(long int, long int)
```


is pretty C++98.  Maybe on Solaris just some `using namespace std;` gets pulled in, which isn't present on other systems.



---

archive/issue_comments_149583.json:
```json
{
    "body": "Replying to [comment:22 leif]:\n> Replying to [comment:21 leif]:\n> > I get a build error for the (old) eclib spkg on **Solaris** [SPARC, 32-bit]:\n> > {{{\n> > ...\n> > arith.h:182:39: error: 'int div(long int, long int)' conflicts with previous using declaration 'std::ldiv_t std::div(long int, long int)'\n> > ...\n> > }}}\n> [...] I have no idea why this only fails on Solaris, as AFAIK\n> \n> {{{\n> #!C++\n> std::ldiv_t std::div(long int, long int)\n> }}}\n> \n> is pretty C++98.  Maybe on Solaris just some `using namespace std;` gets pulled in, which isn't present on other systems.\n\nApparently Solaris' `/usr/include/stdlib.h` is the culprit:\n\n```c++\n/*\n * Copyright 2004 Sun Microsystems, Inc.  All rights reserved.\n * Use is subject to license terms.\n */\n\n/*      Copyright (c) 1988 AT&T */\n/*        All Rights Reserved   */\n\n/*      THIS IS UNPUBLISHED PROPRIETARY SOURCE CODE OF AT&T     */\n/*      The copyright notice above does not evidence any        */\n/*      actual or intended publication of such source code.     */\n\n#ifndef _STDLIB_H\n#define _STDLIB_H\n\n#pragma ident   \"@(#)stdlib.h   1.51    04/06/30 SMI\"   /* SVr4.0 1.22  */\n\n#include <iso/stdlib_iso.h>\n#include <iso/stdlib_c99.h>\n\n#if defined(__EXTENSIONS__) || defined(_XPG4)\n#include <sys/wait.h>\n#endif\n\n/*\n * Allow global visibility for symbols defined in\n * C++ \"std\" namespace in <iso/stdlib_iso.h>.\n */\n#if __cplusplus >= 199711L\n...\nusing std::div;\n...\n```\n",
    "created_at": "2012-04-15T12:54:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12579#issuecomment-149583",
    "user": "leif"
}
```

Replying to [comment:22 leif]:
> Replying to [comment:21 leif]:
> > I get a build error for the (old) eclib spkg on **Solaris** [SPARC, 32-bit]:
> > {{{
> > ...
> > arith.h:182:39: error: 'int div(long int, long int)' conflicts with previous using declaration 'std::ldiv_t std::div(long int, long int)'
> > ...
> > }}}
> [...] I have no idea why this only fails on Solaris, as AFAIK
> 
> {{{
> #!C++
> std::ldiv_t std::div(long int, long int)
> }}}
> 
> is pretty C++98.  Maybe on Solaris just some `using namespace std;` gets pulled in, which isn't present on other systems.

Apparently Solaris' `/usr/include/stdlib.h` is the culprit:

```c++
/*
 * Copyright 2004 Sun Microsystems, Inc.  All rights reserved.
 * Use is subject to license terms.
 */

/*      Copyright (c) 1988 AT&T */
/*        All Rights Reserved   */

/*      THIS IS UNPUBLISHED PROPRIETARY SOURCE CODE OF AT&T     */
/*      The copyright notice above does not evidence any        */
/*      actual or intended publication of such source code.     */

#ifndef _STDLIB_H
#define _STDLIB_H

#pragma ident   "@(#)stdlib.h   1.51    04/06/30 SMI"   /* SVr4.0 1.22  */

#include <iso/stdlib_iso.h>
#include <iso/stdlib_c99.h>

#if defined(__EXTENSIONS__) || defined(_XPG4)
#include <sys/wait.h>
#endif

/*
 * Allow global visibility for symbols defined in
 * C++ "std" namespace in <iso/stdlib_iso.h>.
 */
#if __cplusplus >= 199711L
...
using std::div;
...
```




---

archive/issue_comments_149584.json:
```json
{
    "body": "Minimal example:\n\n```c++\n// div.cc\n\n#include <cstdlib>\n\nint div(long a, long b)\n{\n  return 0;\n}\n```\n\nThis fails with GCC 4.7.0 on Solaris, while it doesn't on (e.g.) Linux.",
    "created_at": "2012-04-15T13:20:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12579#issuecomment-149584",
    "user": "leif"
}
```

Minimal example:

```c++
// div.cc

#include <cstdlib>

int div(long a, long b)
{
  return 0;
}
```

This fails with GCC 4.7.0 on Solaris, while it doesn't on (e.g.) Linux.



---

archive/issue_comments_149585.json:
```json
{
    "body": "Replying to [comment:22 leif]:\n> Replying to [comment:21 leif]:\n> > I get a build error for the (old) eclib spkg on **Solaris** [SPARC, 32-bit]:\n> > {{{\n> > ...\n> > arith.h:182:39: error: 'int div(long int, long int)' conflicts with previous using declaration 'std::ldiv_t std::div(long int, long int)'\n> > ...\n> > }}}\n> > \n> > Haven't yet tried the new autotools-enabled upstream package; a new *spkg* should be posted soon on #10993, hopefully...\n> \n> It fails in the same way; yet I have no idea why this only fails on Solaris, as AFAIK\n> \n> {{{\n> #!C++\n> std::ldiv_t std::div(long int, long int)\n> }}}\n> \n> is pretty C++98.  Maybe on Solaris just some `using namespace std;` gets pulled in, which isn't present on other systems.\n\nNow fixed in the new upstream tarball (eclib-2012-04-15.tar.gz), by renaming the function.  (See #10993.)",
    "created_at": "2012-04-15T16:57:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12579#issuecomment-149585",
    "user": "leif"
}
```

Replying to [comment:22 leif]:
> Replying to [comment:21 leif]:
> > I get a build error for the (old) eclib spkg on **Solaris** [SPARC, 32-bit]:
> > {{{
> > ...
> > arith.h:182:39: error: 'int div(long int, long int)' conflicts with previous using declaration 'std::ldiv_t std::div(long int, long int)'
> > ...
> > }}}
> > 
> > Haven't yet tried the new autotools-enabled upstream package; a new *spkg* should be posted soon on #10993, hopefully...
> 
> It fails in the same way; yet I have no idea why this only fails on Solaris, as AFAIK
> 
> {{{
> #!C++
> std::ldiv_t std::div(long int, long int)
> }}}
> 
> is pretty C++98.  Maybe on Solaris just some `using namespace std;` gets pulled in, which isn't present on other systems.

Now fixed in the new upstream tarball (eclib-2012-04-15.tar.gz), by renaming the function.  (See #10993.)



---

archive/issue_comments_149586.json:
```json
{
    "body": "Added a reference to the GMP-ECM spkg ticket working around the bug on ia64.",
    "created_at": "2012-04-16T23:05:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12579#issuecomment-149586",
    "user": "leif"
}
```

Added a reference to the GMP-ECM spkg ticket working around the bug on ia64.



---

archive/issue_comments_149587.json:
```json
{
    "body": "Replying to [comment:23 leif]:\n> Replying to [comment:22 leif]:\n> > Replying to [comment:21 leif]:\n> > > I get a build error for the (old) eclib spkg on **Solaris** [SPARC, 32-bit]:\n> > > {{{\n> > > ...\n> > > arith.h:182:39: error: 'int div(long int, long int)' conflicts with previous using declaration 'std::ldiv_t std::div(long int, long int)'\n> > > ...\n> > > }}}\n> > [...] I have no idea why this only fails on Solaris, as AFAIK\n> > \n> > {{{\n> > #!C++\n> > std::ldiv_t std::div(long int, long int)\n> > }}}\n> > \n> > is pretty C++98.  Maybe on Solaris just some `using namespace std;` gets pulled in, which isn't present on other systems.\n> \n> Apparently Solaris' `/usr/include/stdlib.h` is the culprit [...]\n\nSee #12855 for a similar issue with the FLINTQS spkg, showing up as an ambiguous call of `log()` due to definitions from `math.h` (which puts all overloaded functions also into the *global* namespace).",
    "created_at": "2012-04-18T01:50:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12579#issuecomment-149587",
    "user": "leif"
}
```

Replying to [comment:23 leif]:
> Replying to [comment:22 leif]:
> > Replying to [comment:21 leif]:
> > > I get a build error for the (old) eclib spkg on **Solaris** [SPARC, 32-bit]:
> > > {{{
> > > ...
> > > arith.h:182:39: error: 'int div(long int, long int)' conflicts with previous using declaration 'std::ldiv_t std::div(long int, long int)'
> > > ...
> > > }}}
> > [...] I have no idea why this only fails on Solaris, as AFAIK
> > 
> > {{{
> > #!C++
> > std::ldiv_t std::div(long int, long int)
> > }}}
> > 
> > is pretty C++98.  Maybe on Solaris just some `using namespace std;` gets pulled in, which isn't present on other systems.
> 
> Apparently Solaris' `/usr/include/stdlib.h` is the culprit [...]

See #12855 for a similar issue with the FLINTQS spkg, showing up as an ambiguous call of `log()` due to definitions from `math.h` (which puts all overloaded functions also into the *global* namespace).



---

archive/issue_comments_149588.json:
```json
{
    "body": "Perhaps doesn't really belong to this ticket, but now also PPL fails to build -- more precisely *install* -- (with GCC 4.7.0) on Solaris (SPARC; mark2):\n\n```\nlibtool: install: strip --strip-debug /home/leif/Sage/release/build/mark2/sage-5.0.beta13-gcc-4.7.0/local/lib/libpwl.a\nBFD: /home/leif/Sage/release/build/mark2/sage-5.0.beta13-gcc-4.7.0/local/lib/libpwl.a(Watchdog.o): no group info for section .group%_ZN22Parma_Watchdog_Library7HandlerD5Ev\nBFD: /home/leif/Sage/release/build/mark2/sage-5.0.beta13-gcc-4.7.0/local/lib/libpwl.a(Watchdog.o): no group info for section .group%_ZNK22Parma_Watchdog_Library16Handler_Function3actEv\nBFD: /home/leif/Sage/release/build/mark2/sage-5.0.beta13-gcc-4.7.0/local/lib/libpwl.a(Watchdog.o): no group info for section .group%_ZN22Parma_Watchdog_Library16Handler_FunctionD1Ev\nBFD: /home/leif/Sage/release/build/mark2/sage-5.0.beta13-gcc-4.7.0/local/lib/libpwl.a(Watchdog.o): no group info for section .group%_ZN22Parma_Watchdog_Library16Handler_FunctionD0Ev\nBFD: /home/leif/Sage/release/build/mark2/sage-5.0.beta13-gcc-4.7.0/local/lib/libpwl.a(Watchdog.o): no group info for section .group%_ZN22Parma_Watchdog_Library7HandlerD0Ev\nBFD: /home/leif/Sage/release/build/mark2/sage-5.0.beta13-gcc-4.7.0/local/lib/libpwl.a(Watchdog.o): no group info for section .group%_ZStplIcSt11char_traitsIcESaIcEESbIT_T0_T1_ERKS6_PKS3_\nBFD: /home/leif/Sage/release/build/mark2/sage-5.0.beta13-gcc-4.7.0/local/lib/libpwl.a(Watchdog.o): no group info for section .group%_ZN22Parma_Watchdog_Library4InitC5Ev\nBFD: /home/leif/Sage/release/build/mark2/sage-5.0.beta13-gcc-4.7.0/local/lib/libpwl.a(Watchdog.o): no group info for section .group%_ZN22Parma_Watchdog_Library5EListINS_15Pending_ElementINS_4TimeEEEED5Ev\nBFD: /home/leif/Sage/release/build/mark2/sage-5.0.beta13-gcc-4.7.0/local/lib/libpwl.a(Watchdog.o): no group info for section .group%_ZTSN22Parma_Watchdog_Library7HandlerE\nBFD: /home/leif/Sage/release/build/mark2/sage-5.0.beta13-gcc-4.7.0/local/lib/libpwl.a(Watchdog.o): no group info for section .group%_ZTIN22Parma_Watchdog_Library7HandlerE\nBFD: /home/leif/Sage/release/build/mark2/sage-5.0.beta13-gcc-4.7.0/local/lib/libpwl.a(Watchdog.o): no group info for section .group%_ZTSN22Parma_Watchdog_Library16Handler_FunctionE\nBFD: /home/leif/Sage/release/build/mark2/sage-5.0.beta13-gcc-4.7.0/local/lib/libpwl.a(Watchdog.o): no group info for section .group%_ZTIN22Parma_Watchdog_Library16Handler_FunctionE\nBFD: /home/leif/Sage/release/build/mark2/sage-5.0.beta13-gcc-4.7.0/local/lib/libpwl.a(Watchdog.o): no group info for section .group%_ZTVN22Parma_Watchdog_Library7HandlerE\nBFD: /home/leif/Sage/release/build/mark2/sage-5.0.beta13-gcc-4.7.0/local/lib/libpwl.a(Watchdog.o): no group info for section .group%_ZTVN22Parma_Watchdog_Library16Handler_FunctionE\nBFD: BFD (GNU Binutils) 2.22 internal error, aborting at ../../binutils-2.22/bfd/elf.c line 2905 in bfd_elf_set_group_contents\n\nBFD: Please report this bug.\n```\n",
    "created_at": "2012-04-18T02:25:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12579#issuecomment-149588",
    "user": "leif"
}
```

Perhaps doesn't really belong to this ticket, but now also PPL fails to build -- more precisely *install* -- (with GCC 4.7.0) on Solaris (SPARC; mark2):

```
libtool: install: strip --strip-debug /home/leif/Sage/release/build/mark2/sage-5.0.beta13-gcc-4.7.0/local/lib/libpwl.a
BFD: /home/leif/Sage/release/build/mark2/sage-5.0.beta13-gcc-4.7.0/local/lib/libpwl.a(Watchdog.o): no group info for section .group%_ZN22Parma_Watchdog_Library7HandlerD5Ev
BFD: /home/leif/Sage/release/build/mark2/sage-5.0.beta13-gcc-4.7.0/local/lib/libpwl.a(Watchdog.o): no group info for section .group%_ZNK22Parma_Watchdog_Library16Handler_Function3actEv
BFD: /home/leif/Sage/release/build/mark2/sage-5.0.beta13-gcc-4.7.0/local/lib/libpwl.a(Watchdog.o): no group info for section .group%_ZN22Parma_Watchdog_Library16Handler_FunctionD1Ev
BFD: /home/leif/Sage/release/build/mark2/sage-5.0.beta13-gcc-4.7.0/local/lib/libpwl.a(Watchdog.o): no group info for section .group%_ZN22Parma_Watchdog_Library16Handler_FunctionD0Ev
BFD: /home/leif/Sage/release/build/mark2/sage-5.0.beta13-gcc-4.7.0/local/lib/libpwl.a(Watchdog.o): no group info for section .group%_ZN22Parma_Watchdog_Library7HandlerD0Ev
BFD: /home/leif/Sage/release/build/mark2/sage-5.0.beta13-gcc-4.7.0/local/lib/libpwl.a(Watchdog.o): no group info for section .group%_ZStplIcSt11char_traitsIcESaIcEESbIT_T0_T1_ERKS6_PKS3_
BFD: /home/leif/Sage/release/build/mark2/sage-5.0.beta13-gcc-4.7.0/local/lib/libpwl.a(Watchdog.o): no group info for section .group%_ZN22Parma_Watchdog_Library4InitC5Ev
BFD: /home/leif/Sage/release/build/mark2/sage-5.0.beta13-gcc-4.7.0/local/lib/libpwl.a(Watchdog.o): no group info for section .group%_ZN22Parma_Watchdog_Library5EListINS_15Pending_ElementINS_4TimeEEEED5Ev
BFD: /home/leif/Sage/release/build/mark2/sage-5.0.beta13-gcc-4.7.0/local/lib/libpwl.a(Watchdog.o): no group info for section .group%_ZTSN22Parma_Watchdog_Library7HandlerE
BFD: /home/leif/Sage/release/build/mark2/sage-5.0.beta13-gcc-4.7.0/local/lib/libpwl.a(Watchdog.o): no group info for section .group%_ZTIN22Parma_Watchdog_Library7HandlerE
BFD: /home/leif/Sage/release/build/mark2/sage-5.0.beta13-gcc-4.7.0/local/lib/libpwl.a(Watchdog.o): no group info for section .group%_ZTSN22Parma_Watchdog_Library16Handler_FunctionE
BFD: /home/leif/Sage/release/build/mark2/sage-5.0.beta13-gcc-4.7.0/local/lib/libpwl.a(Watchdog.o): no group info for section .group%_ZTIN22Parma_Watchdog_Library16Handler_FunctionE
BFD: /home/leif/Sage/release/build/mark2/sage-5.0.beta13-gcc-4.7.0/local/lib/libpwl.a(Watchdog.o): no group info for section .group%_ZTVN22Parma_Watchdog_Library7HandlerE
BFD: /home/leif/Sage/release/build/mark2/sage-5.0.beta13-gcc-4.7.0/local/lib/libpwl.a(Watchdog.o): no group info for section .group%_ZTVN22Parma_Watchdog_Library16Handler_FunctionE
BFD: BFD (GNU Binutils) 2.22 internal error, aborting at ../../binutils-2.22/bfd/elf.c line 2905 in bfd_elf_set_group_contents

BFD: Please report this bug.
```




---

archive/issue_comments_149589.json:
```json
{
    "body": "Replying to [comment:10 leif]:\n> Replying to [comment:9 leif]:\n> > Replying to [comment:5 leif]:\n> > > R now fails to build for me (when byte-compiling), interestingly only with *less* fancy GCC optimizations enabled.  (It did build with LTO and Graphite loop optimization enabled).\n> > \n> > This is *really* weird: R *does* build if I just in addition enable LTO... 8)\n> \n> ... and also passes its test suite with that.\n\nOn 32-bit Solaris SPARC (skynet machine mark2), R segfaults during byte-compiling package \"base\" when compiled with `-O3`; using `-O2` instead apparently works.\n\n(The setup -- when just sourcing `/usr/local/skynet_bash_profile` -- on the Solaris machines is currently quite broken anyway.  In addition, R 2.14.0 messes up `LD_LIBRARY_PATH` such that the dynamic linker picks up an incompatible [and totally outdated] version of `libgcc_s.so.1`, so `R` cannot be run, which of course breaks the build as well.  A work-around is to create a symbolic link to the proper version in e.g. `$SAGE_LOCAL/lib/`.)",
    "created_at": "2012-04-18T21:22:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12579#issuecomment-149589",
    "user": "leif"
}
```

Replying to [comment:10 leif]:
> Replying to [comment:9 leif]:
> > Replying to [comment:5 leif]:
> > > R now fails to build for me (when byte-compiling), interestingly only with *less* fancy GCC optimizations enabled.  (It did build with LTO and Graphite loop optimization enabled).
> > 
> > This is *really* weird: R *does* build if I just in addition enable LTO... 8)
> 
> ... and also passes its test suite with that.

On 32-bit Solaris SPARC (skynet machine mark2), R segfaults during byte-compiling package "base" when compiled with `-O3`; using `-O2` instead apparently works.

(The setup -- when just sourcing `/usr/local/skynet_bash_profile` -- on the Solaris machines is currently quite broken anyway.  In addition, R 2.14.0 messes up `LD_LIBRARY_PATH` such that the dynamic linker picks up an incompatible [and totally outdated] version of `libgcc_s.so.1`, so `R` cannot be run, which of course breaks the build as well.  A work-around is to create a symbolic link to the proper version in e.g. `$SAGE_LOCAL/lib/`.)



---

archive/issue_comments_149590.json:
```json
{
    "body": "Since the GCC spkg \"fixes\" all of these except for MPIR and MPFR, this won't be a blocker.",
    "created_at": "2012-04-19T08:46:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12579#issuecomment-149590",
    "user": "jdemeyer"
}
```

Since the GCC spkg "fixes" all of these except for MPIR and MPFR, this won't be a blocker.



---

archive/issue_comments_149591.json:
```json
{
    "body": "Changing priority from blocker to critical.",
    "created_at": "2012-04-19T08:46:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12579#issuecomment-149591",
    "user": "jdemeyer"
}
```

Changing priority from blocker to critical.



---

archive/issue_comments_149592.json:
```json
{
    "body": "The zn_poly spkg from #12433 now also works around the GCC 4.7.0 bug on Itanium.",
    "created_at": "2012-04-20T04:01:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12579#issuecomment-149592",
    "user": "leif"
}
```

The zn_poly spkg from #12433 now also works around the GCC 4.7.0 bug on Itanium.



---

archive/issue_comments_149593.json:
```json
{
    "body": "Changing keywords from \"GCC 4.7.0 C++11 -fpermissive compiler bugs\" to \"GCC 4.7.0 C++11 -fpermissive compiler bugs sd40.5\".",
    "created_at": "2012-05-26T16:55:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12579#issuecomment-149593",
    "user": "jdemeyer"
}
```

Changing keywords from "GCC 4.7.0 C++11 -fpermissive compiler bugs" to "GCC 4.7.0 C++11 -fpermissive compiler bugs sd40.5".



---

archive/issue_comments_149594.json:
```json
{
    "body": "The ia64 bug is fixed in SVN now, tested on Skynet `cleo` (build + ptestlong passed).",
    "created_at": "2012-05-27T21:04:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12579#issuecomment-149594",
    "user": "jdemeyer"
}
```

The ia64 bug is fixed in SVN now, tested on Skynet `cleo` (build + ptestlong passed).



---

archive/issue_comments_149595.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-05-29T02:13:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12579#issuecomment-149595",
    "user": "jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_149596.json:
```json
{
    "body": "Attachment [ecm-6.3.p8.diff](tarball://root/attachments/some-uuid/ticket12751/ecm-6.3.p8.diff) by jdemeyer created at 2012-05-29 02:21:29\n\nDiff for the ecm spkg. For reference / review only.",
    "created_at": "2012-05-29T02:21:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12579#issuecomment-149596",
    "user": "jdemeyer"
}
```

Attachment [ecm-6.3.p8.diff](tarball://root/attachments/some-uuid/ticket12751/ecm-6.3.p8.diff) by jdemeyer created at 2012-05-29 02:21:29

Diff for the ecm spkg. For reference / review only.



---

archive/issue_comments_149597.json:
```json
{
    "body": "Diff for the mpfr spkg. For reference / review only.",
    "created_at": "2012-05-29T02:21:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12579#issuecomment-149597",
    "user": "jdemeyer"
}
```

Diff for the mpfr spkg. For reference / review only.



---

archive/issue_comments_149598.json:
```json
{
    "body": "Attachment [mpfr-3.1.0.p2.diff](tarball://root/attachments/some-uuid/ticket12751/mpfr-3.1.0.p2.diff) by jdemeyer created at 2012-05-29 02:22:04\n\nDiff for the mpir spkg. For reference / review only.",
    "created_at": "2012-05-29T02:22:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12579#issuecomment-149598",
    "user": "jdemeyer"
}
```

Attachment [mpfr-3.1.0.p2.diff](tarball://root/attachments/some-uuid/ticket12751/mpfr-3.1.0.p2.diff) by jdemeyer created at 2012-05-29 02:22:04

Diff for the mpir spkg. For reference / review only.



---

archive/issue_comments_149599.json:
```json
{
    "body": "Attachment [mpir-2.4.0.p6.diff](tarball://root/attachments/some-uuid/ticket12751/mpir-2.4.0.p6.diff) by jdemeyer created at 2012-05-29 02:22:21\n\nDiff for the zn_poly spkg. For reference / review only.",
    "created_at": "2012-05-29T02:22:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12579#issuecomment-149599",
    "user": "jdemeyer"
}
```

Attachment [mpir-2.4.0.p6.diff](tarball://root/attachments/some-uuid/ticket12751/mpir-2.4.0.p6.diff) by jdemeyer created at 2012-05-29 02:22:21

Diff for the zn_poly spkg. For reference / review only.



---

archive/issue_comments_149600.json:
```json
{
    "body": "Attachment [zn_poly-0.9.p9.diff](tarball://root/attachments/some-uuid/ticket12751/zn_poly-0.9.p9.diff) by jdemeyer created at 2012-05-29 03:02:24\n\nApply to SAGE_ROOT",
    "created_at": "2012-05-29T03:02:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12579#issuecomment-149600",
    "user": "jdemeyer"
}
```

Attachment [zn_poly-0.9.p9.diff](tarball://root/attachments/some-uuid/ticket12751/zn_poly-0.9.p9.diff) by jdemeyer created at 2012-05-29 03:02:24

Apply to SAGE_ROOT



---

archive/issue_comments_149601.json:
```json
{
    "body": "Attachment [12751_allow_gcc_4_7.patch](tarball://root/attachments/some-uuid/ticket12751/12751_allow_gcc_4_7.patch) by jdemeyer created at 2012-05-29 03:13:12",
    "created_at": "2012-05-29T03:13:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12579#issuecomment-149601",
    "user": "jdemeyer"
}
```

Attachment [12751_allow_gcc_4_7.patch](tarball://root/attachments/some-uuid/ticket12751/12751_allow_gcc_4_7.patch) by jdemeyer created at 2012-05-29 03:13:12



---

archive/issue_comments_149602.json:
```json
{
    "body": "Well testing on skynet might be a bit difficult, but it works for me on Fedora 17 (which ships gcc 4.7.0). There are still vestiges of ia64/gcc checking in the spkgs, I still believe that this should just once and for all be dealt with by the compiler wrapper instead of littering checks for `$DYING_ARCH` everywhere. But thats for another day ;)",
    "created_at": "2012-07-03T09:28:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12579#issuecomment-149602",
    "user": "vbraun"
}
```

Well testing on skynet might be a bit difficult, but it works for me on Fedora 17 (which ships gcc 4.7.0). There are still vestiges of ia64/gcc checking in the spkgs, I still believe that this should just once and for all be dealt with by the compiler wrapper instead of littering checks for `$DYING_ARCH` everywhere. But thats for another day ;)



---

archive/issue_comments_149603.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-07-03T09:28:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12579#issuecomment-149603",
    "user": "vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_149604.json:
```json
{
    "body": "Replying to [comment:53 vbraun]:\n> There are still vestiges of ia64/gcc checking in the spkgs.\nThere should be in the MPIR and MPFR packages, because those are prerequisites for the Sage GCC spkg.",
    "created_at": "2012-07-03T09:48:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12579#issuecomment-149604",
    "user": "jdemeyer"
}
```

Replying to [comment:53 vbraun]:
> There are still vestiges of ia64/gcc checking in the spkgs.
There should be in the MPIR and MPFR packages, because those are prerequisites for the Sage GCC spkg.



---

archive/issue_comments_149605.json:
```json
{
    "body": "To clarify: we still want people with GCC-4.7.0 on ia64 to be able to build Sage, but only with the Sage-built GCC.",
    "created_at": "2012-07-03T09:51:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12579#issuecomment-149605",
    "user": "jdemeyer"
}
```

To clarify: we still want people with GCC-4.7.0 on ia64 to be able to build Sage, but only with the Sage-built GCC.



---

archive/issue_comments_149606.json:
```json
{
    "body": "GCC 4.7.1 has been released on June 14th.",
    "created_at": "2012-07-03T10:17:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12579#issuecomment-149606",
    "user": "leif"
}
```

GCC 4.7.1 has been released on June 14th.



---

archive/issue_comments_149607.json:
```json
{
    "body": "Replying to [comment:53 vbraun]:\n> There are still vestiges of ia64/gcc checking in the spkgs, I still believe that this should just once and for all be dealt with by the compiler wrapper instead of littering checks for `$DYING_ARCH` everywhere. But thats for another day ;)\n\nDepends...  The compiler wrapper (afaik) doesn't know what code or spkg it currently builds, and usually only few parts are affected (probably with different work-arounds).  E.g. disabling optimization for the whole build is poor and may not even work.\n\nIt's probably more tedious to put [specific] work-arounds into a couple of spkgs, but IMHO also preserves some kind of modularity.\n\nAs a brute alternative, we could just blacklist (almost) all somehow non-functional compiler/OS combinations (most probably ignoring compiler options) *in Sage's prerequisite check*, but that's not very user- (nor developer-) friendly, and isn't \"modular\" either.\n\n\n\n\n`$DYING_ARCH` does certainly have different values on different machines, or even depends on `$USER`... ;-)",
    "created_at": "2012-07-03T10:51:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12579#issuecomment-149607",
    "user": "leif"
}
```

Replying to [comment:53 vbraun]:
> There are still vestiges of ia64/gcc checking in the spkgs, I still believe that this should just once and for all be dealt with by the compiler wrapper instead of littering checks for `$DYING_ARCH` everywhere. But thats for another day ;)

Depends...  The compiler wrapper (afaik) doesn't know what code or spkg it currently builds, and usually only few parts are affected (probably with different work-arounds).  E.g. disabling optimization for the whole build is poor and may not even work.

It's probably more tedious to put [specific] work-arounds into a couple of spkgs, but IMHO also preserves some kind of modularity.

As a brute alternative, we could just blacklist (almost) all somehow non-functional compiler/OS combinations (most probably ignoring compiler options) *in Sage's prerequisite check*, but that's not very user- (nor developer-) friendly, and isn't "modular" either.




`$DYING_ARCH` does certainly have different values on different machines, or even depends on `$USER`... ;-)



---

archive/issue_comments_149608.json:
```json
{
    "body": "Replying to [comment:58 leif]:\n> Depends...  The compiler wrapper (afaik) doesn't know what code or spkg it currently builds, and usually only few parts are affected (probably with different work-arounds).  E.g. disabling optimization for the whole build is poor and may not even work.\n\nI disagree. Just because our testsuite didn't catch it doesn't mean that the code was compiled correctly. If the optimizer has a known bug then we must not use that particular optimization anywhere it if we want to trust the result.",
    "created_at": "2012-07-03T11:02:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12579#issuecomment-149608",
    "user": "vbraun"
}
```

Replying to [comment:58 leif]:
> Depends...  The compiler wrapper (afaik) doesn't know what code or spkg it currently builds, and usually only few parts are affected (probably with different work-arounds).  E.g. disabling optimization for the whole build is poor and may not even work.

I disagree. Just because our testsuite didn't catch it doesn't mean that the code was compiled correctly. If the optimizer has a known bug then we must not use that particular optimization anywhere it if we want to trust the result.



---

archive/issue_comments_149609.json:
```json
{
    "body": "Replying to [comment:59 vbraun]:\n> Replying to [comment:58 leif]:\n> > Depends...  The compiler wrapper (afaik) doesn't know what code or spkg it currently builds, and usually only few parts are affected (probably with different work-arounds).  E.g. disabling optimization for the whole build is poor and may not even work.\n> \n> I disagree. Just because our testsuite didn't catch it doesn't mean that the code was compiled correctly. If the optimizer has a known bug then we must not use that particular optimization anywhere it if we want to trust the result.\n\n:-) Well, in the case I think you're referring to (ia64, \"impossible reload\"), the compiler bailed out, and it wasn't some \"particular optimization\", but the whole code generation (more precisely register allocation, in the presence of inline assemby) was broken, although only in some \"corner cases\".\n\nYou can almost never be sure all code will be compiled correctly [or otherwise raise an error] (under all circumstances), but testsuites are *supposed* to get at least some confidence.  In this case certainly **GCC's** testsuite was insufficient, and/or the release hadn't been thoroughly tested [on ia64].  If instead we'd discovered `-ffoo` produced wrong code, we'd most probably used `-fno-foo`, globally.  (But if the bug affected lots of code or situations, it certainly would have shown up earlier, upstream.)\n\nIn general, if you experience some function (or code, tool, whatever) gives wrong results on *some* inputs, you usually first try to narrow its domain, unless or until you can really fix it (and probably make sure it *does* work in all cases it was specified for).  Dropping it completely until some \"rare\" issue is solved is not always an option (while *documenting* the issue is), or simply too inconvenient.  Otherwise we'd never release any Sage version, since there are and always will be known \"bugs\" or limitations.",
    "created_at": "2012-07-03T12:53:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12579#issuecomment-149609",
    "user": "leif"
}
```

Replying to [comment:59 vbraun]:
> Replying to [comment:58 leif]:
> > Depends...  The compiler wrapper (afaik) doesn't know what code or spkg it currently builds, and usually only few parts are affected (probably with different work-arounds).  E.g. disabling optimization for the whole build is poor and may not even work.
> 
> I disagree. Just because our testsuite didn't catch it doesn't mean that the code was compiled correctly. If the optimizer has a known bug then we must not use that particular optimization anywhere it if we want to trust the result.

:-) Well, in the case I think you're referring to (ia64, "impossible reload"), the compiler bailed out, and it wasn't some "particular optimization", but the whole code generation (more precisely register allocation, in the presence of inline assemby) was broken, although only in some "corner cases".

You can almost never be sure all code will be compiled correctly [or otherwise raise an error] (under all circumstances), but testsuites are *supposed* to get at least some confidence.  In this case certainly **GCC's** testsuite was insufficient, and/or the release hadn't been thoroughly tested [on ia64].  If instead we'd discovered `-ffoo` produced wrong code, we'd most probably used `-fno-foo`, globally.  (But if the bug affected lots of code or situations, it certainly would have shown up earlier, upstream.)

In general, if you experience some function (or code, tool, whatever) gives wrong results on *some* inputs, you usually first try to narrow its domain, unless or until you can really fix it (and probably make sure it *does* work in all cases it was specified for).  Dropping it completely until some "rare" issue is solved is not always an option (while *documenting* the issue is), or simply too inconvenient.  Otherwise we'd never release any Sage version, since there are and always will be known "bugs" or limitations.



---

archive/issue_comments_149610.json:
```json
{
    "body": "Its nice for the 2 remaining users (down from 3 now that skynet is down) of `$DYING_ARCH`, but I don't think its maintainable for Sage in the long run. Either we deprecate ancient compiler workarounds or the spkg-installs will fill up with crud that nobody remembers why it is there or what Itanium was. \n\nI don't see a problem with disabling optimization on rare architectures where this can simply be fixed by updating the compiler from the point-oh release that you probably shouldn't have used anyways. And if your distribution backported a fix then you can still reenable optimizations.",
    "created_at": "2012-07-03T13:24:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12579#issuecomment-149610",
    "user": "vbraun"
}
```

Its nice for the 2 remaining users (down from 3 now that skynet is down) of `$DYING_ARCH`, but I don't think its maintainable for Sage in the long run. Either we deprecate ancient compiler workarounds or the spkg-installs will fill up with crud that nobody remembers why it is there or what Itanium was. 

I don't see a problem with disabling optimization on rare architectures where this can simply be fixed by updating the compiler from the point-oh release that you probably shouldn't have used anyways. And if your distribution backported a fix then you can still reenable optimizations.



---

archive/issue_comments_149611.json:
```json
{
    "body": "Replying to [comment:61 vbraun]:\n> Its nice for the 2 remaining users (down from 3 now that skynet is down) of `$DYING_ARCH`, but I don't think its maintainable for Sage in the long run. Either we deprecate ancient compiler workarounds or the spkg-installs will fill up with crud that nobody remembers why it is there or what Itanium was.\nThe GCC spkg solves most of these issues.",
    "created_at": "2012-07-03T14:09:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12579#issuecomment-149611",
    "user": "jdemeyer"
}
```

Replying to [comment:61 vbraun]:
> Its nice for the 2 remaining users (down from 3 now that skynet is down) of `$DYING_ARCH`, but I don't think its maintainable for Sage in the long run. Either we deprecate ancient compiler workarounds or the spkg-installs will fill up with crud that nobody remembers why it is there or what Itanium was.
The GCC spkg solves most of these issues.



---

archive/issue_comments_149612.json:
```json
{
    "body": "Replying to [comment:61 vbraun]:\n> Its nice for the 2 remaining users (down from 3 now that skynet is down) of `$DYING_ARCH`, but I don't think its maintainable for Sage in the long run.\n\nWe can hardly officially support platforms we have no access to.\n\nIs skynet intentionally down?  Incidentally just tried to login...\n\n\n\n\n  \n> Either we deprecate ancient compiler workarounds or the spkg-installs will fill up with crud that nobody remembers why it is there or what Itanium was.\n\nWell, that's a matter of documentation (and wikipedia ;-) ).\n\nWe used to clean up \"obsolete\" work-arounds regularly, have our weird prerequisites check (besides checks in some spkgs' `configure` scripts), and we meanwhile have a GCC spkg anyway (although we still have to make sure bootstrapping works, as Jeroen mentioned).\n\nIMHO the bigger problem is some distros (or OSs) shipping immature compilers by default (some not even providing fixes later).  Always supporting the most recent GCC version on all skynet platforms may now be a requirement of the past; don't know.",
    "created_at": "2012-07-03T14:16:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12579#issuecomment-149612",
    "user": "leif"
}
```

Replying to [comment:61 vbraun]:
> Its nice for the 2 remaining users (down from 3 now that skynet is down) of `$DYING_ARCH`, but I don't think its maintainable for Sage in the long run.

We can hardly officially support platforms we have no access to.

Is skynet intentionally down?  Incidentally just tried to login...




  
> Either we deprecate ancient compiler workarounds or the spkg-installs will fill up with crud that nobody remembers why it is there or what Itanium was.

Well, that's a matter of documentation (and wikipedia ;-) ).

We used to clean up "obsolete" work-arounds regularly, have our weird prerequisites check (besides checks in some spkgs' `configure` scripts), and we meanwhile have a GCC spkg anyway (although we still have to make sure bootstrapping works, as Jeroen mentioned).

IMHO the bigger problem is some distros (or OSs) shipping immature compilers by default (some not even providing fixes later).  Always supporting the most recent GCC version on all skynet platforms may now be a requirement of the past; don't know.



---

archive/issue_comments_149613.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-07-07T22:29:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12579#issuecomment-149613",
    "user": "jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_149614.json:
```json
{
    "body": "There are still issues with GCC 4.7.0 (presumably any GCC 4.7.x) on Solaris, e.g. with Singular, similar to those with FLINTQS (#12855).  (These are *not* related to compiler bugs!)",
    "created_at": "2013-03-14T12:15:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12579#issuecomment-149614",
    "user": "leif"
}
```

There are still issues with GCC 4.7.0 (presumably any GCC 4.7.x) on Solaris, e.g. with Singular, similar to those with FLINTQS (#12855).  (These are *not* related to compiler bugs!)



---

archive/issue_comments_149615.json:
```json
{
    "body": "Replying to [comment:65 leif]:\n> There are still issues with GCC 4.7.0 (presumably any GCC 4.7.x) on Solaris, e.g. with Singular, similar to those with FLINTQS (#12855).  (These are *not* related to compiler bugs!)\n\nIt seems only Singular (3-1-5) meanwhile needs to get fixed; this is #14295.",
    "created_at": "2013-03-18T18:08:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12579",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12579#issuecomment-149615",
    "user": "leif"
}
```

Replying to [comment:65 leif]:
> There are still issues with GCC 4.7.0 (presumably any GCC 4.7.x) on Solaris, e.g. with Singular, similar to those with FLINTQS (#12855).  (These are *not* related to compiler bugs!)

It seems only Singular (3-1-5) meanwhile needs to get fixed; this is #14295.
