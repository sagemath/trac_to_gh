# Issue 32081: Performace improvements in generating non-redundant indices of tensors with indices

archive/issues_032081.json:
```json
{
    "body": "CC:  slelievre @mjungmath egourgoulhon tscrim\n\nIn `sage.tensor.modules.comp.CompWithSym`, the method generating non-redundant indices is implemented very inefficiently by going through all indices and throwing away the redundant ones. In the worst case scenario of a rank n tensor in n dimensions, we have to iterate through n<sup>n</sup> indices only to find the single non-redundant one.\n\nThis ticket fixes this by changing the implementation to directly generate only non-redundant indices. This gives for example the following improvement for 7 dimensions:\n\n\n```\nsage: import timeit\nsage: from sage.tensor.modules.comp import Components, CompWithSym, CompFullySym, CompFullyAntiSym\nsage: V = VectorSpace(QQ, 7)\nsage: c = CompFullyAntiSym(QQ, V.basis(), 7)\nsage: timeit.timeit(lambda:list(c.non_redundant_index_generator()),number=1)\n\nnew implementation:\n4.3510999603313394e-05\n\nold implementation:\n2.4149506480007403\n```\n\n\nI also simplified the method generating redundant indices a bit.\n\nIssue created by migration from https://trac.sagemath.org/ticket/32318\n\n",
    "created_at": "2021-07-31T14:38:24Z",
    "labels": [
        "performance",
        "major",
        "enhancement"
    ],
    "title": "Performace improvements in generating non-redundant indices of tensors with indices",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32081",
    "user": "@spaghettisalat"
}
```
CC:  slelievre @mjungmath egourgoulhon tscrim

In `sage.tensor.modules.comp.CompWithSym`, the method generating non-redundant indices is implemented very inefficiently by going through all indices and throwing away the redundant ones. In the worst case scenario of a rank n tensor in n dimensions, we have to iterate through n<sup>n</sup> indices only to find the single non-redundant one.

This ticket fixes this by changing the implementation to directly generate only non-redundant indices. This gives for example the following improvement for 7 dimensions:


```
sage: import timeit
sage: from sage.tensor.modules.comp import Components, CompWithSym, CompFullySym, CompFullyAntiSym
sage: V = VectorSpace(QQ, 7)
sage: c = CompFullyAntiSym(QQ, V.basis(), 7)
sage: timeit.timeit(lambda:list(c.non_redundant_index_generator()),number=1)

new implementation:
4.3510999603313394e-05

old implementation:
2.4149506480007403
```


I also simplified the method generating redundant indices a bit.

Issue created by migration from https://trac.sagemath.org/ticket/32318





---

archive/issue_comments_458063.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-07-31T14:38:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32081#issuecomment-458063",
    "user": "@spaghettisalat"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_458064.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-08-01T12:39:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32081#issuecomment-458064",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_458065.json:
```json
{
    "body": "Haven't checked the algorithm yet, but here are already some minor comments:\n\n- Why is `self._sym` copied but `self._antisym` not? From the first glimpse, a copy doesn't seem to be necessary anyway.\n- Very minor (PEP norm):\n\n```diff\n- for k in range(1,len(isym)):\n+ for k in range(1, len(isym)):\n```\n",
    "created_at": "2021-08-05T12:28:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32081#issuecomment-458065",
    "user": "@mjungmath"
}
```

Haven't checked the algorithm yet, but here are already some minor comments:

- Why is `self._sym` copied but `self._antisym` not? From the first glimpse, a copy doesn't seem to be necessary anyway.
- Very minor (PEP norm):

```diff
- for k in range(1,len(isym)):
+ for k in range(1, len(isym)):
```




---

archive/issue_comments_458066.json:
```json
{
    "body": "Very nice by the way. This could make a significant difference in sophisticated computations (especially since this generator is not cached). I am very curious about the timings of the SageManifolds example notebooks!",
    "created_at": "2021-08-05T12:32:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32081#issuecomment-458066",
    "user": "@mjungmath"
}
```

Very nice by the way. This could make a significant difference in sophisticated computations (especially since this generator is not cached). I am very curious about the timings of the SageManifolds example notebooks!



---

archive/issue_comments_458067.json:
```json
{
    "body": "Thanks for improving significantly the generator of non-redundant indices! \nThere is an issue with the ordering of the output though, which affects the display of Christoffel symbols: the output shall respect the ordering of the coordinates, i.e. the doctests should not be modified.",
    "created_at": "2021-08-05T12:42:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32081#issuecomment-458067",
    "user": "egourgoulhon"
}
```

Thanks for improving significantly the generator of non-redundant indices! 
There is an issue with the ordering of the output though, which affects the display of Christoffel symbols: the output shall respect the ordering of the coordinates, i.e. the doctests should not be modified.



---

archive/issue_comments_458068.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-08-05T12:42:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32081#issuecomment-458068",
    "user": "egourgoulhon"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_458069.json:
```json
{
    "body": "Replying to [comment:8 egourgoulhon]:\n> Thanks for improving significantly the generator of non-redundant indices! \n> There is an issue with the ordering of the output though, which affects the display of Christoffel symbols: the output shall respect the ordering of the coordinates, i.e. the doctests should not be modified.\n\nIs that really important? The order in which the components of tensors are displayed is a matter of personal taste, the mathematical results are the same anyway. Generating the indices in exactly the same order as we did previously would make the algorithm significantly more complicated.",
    "created_at": "2021-08-05T13:05:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32081#issuecomment-458069",
    "user": "@spaghettisalat"
}
```

Replying to [comment:8 egourgoulhon]:
> Thanks for improving significantly the generator of non-redundant indices! 
> There is an issue with the ordering of the output though, which affects the display of Christoffel symbols: the output shall respect the ordering of the coordinates, i.e. the doctests should not be modified.

Is that really important? The order in which the components of tensors are displayed is a matter of personal taste, the mathematical results are the same anyway. Generating the indices in exactly the same order as we did previously would make the algorithm significantly more complicated.



---

archive/issue_comments_458070.json:
```json
{
    "body": "Replying to [comment:9 gh-spaghettisalat]:\n> Replying to [comment:8 egourgoulhon]:\n> > Thanks for improving significantly the generator of non-redundant indices! \n> > There is an issue with the ordering of the output though, which affects the display of Christoffel symbols: the output shall respect the ordering of the coordinates, i.e. the doctests should not be modified.\n> \n> Is that really important? \n\nYes I think so. Christoffel symbols are usually lengthy objects and displaying them in random order is not very useful. Ordered display is required for publishing or comparing with previously known results (e.g. textbook, wikipedia). \n\n>The order in which the components of tensors are displayed is a matter of personal taste, the mathematical results are the same anyway. Generating the indices in exactly the same order as we did previously would make the algorithm significantly more complicated.\n\nCan one devise another method, just for display purposes, which would reorder the output of `non_redundant_index_generator`?",
    "created_at": "2021-08-05T14:05:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32081#issuecomment-458070",
    "user": "egourgoulhon"
}
```

Replying to [comment:9 gh-spaghettisalat]:
> Replying to [comment:8 egourgoulhon]:
> > Thanks for improving significantly the generator of non-redundant indices! 
> > There is an issue with the ordering of the output though, which affects the display of Christoffel symbols: the output shall respect the ordering of the coordinates, i.e. the doctests should not be modified.
> 
> Is that really important? 

Yes I think so. Christoffel symbols are usually lengthy objects and displaying them in random order is not very useful. Ordered display is required for publishing or comparing with previously known results (e.g. textbook, wikipedia). 

>The order in which the components of tensors are displayed is a matter of personal taste, the mathematical results are the same anyway. Generating the indices in exactly the same order as we did previously would make the algorithm significantly more complicated.

Can one devise another method, just for display purposes, which would reorder the output of `non_redundant_index_generator`?



---

archive/issue_comments_458071.json:
```json
{
    "body": "Replying to [comment:10 egourgoulhon]:\n> Replying to [comment:9 gh-spaghettisalat]:\n> > Replying to [comment:8 egourgoulhon]:\n> > > Thanks for improving significantly the generator of non-redundant indices! \n> > > There is an issue with the ordering of the output though, which affects the display of Christoffel symbols: the output shall respect the ordering of the coordinates, i.e. the doctests should not be modified.\n> > \n> > Is that really important? \n> \n> Yes I think so. Christoffel symbols are usually lengthy objects and displaying them in random order is not very useful. Ordered display is required for publishing or comparing with previously known results (e.g. textbook, wikipedia). \n> \n\nThe order is not random, it is just slightly different than before. For the christoffel symbols, previously the indices would increase from right to left, now the first index increases before the last two ones. In general, the new algorithm first increases unsymmetrized indices, then symmetrized and finally antisymmetrized ones. One could also do this in a different order (for instance first increase the antisymmetrized indices), which would restore the old order at least for christoffel symbols. But I don't really see the point of that, since there is no universally agreed standard for in which order one should display the indices.\n\n> >The order in which the components of tensors are displayed is a matter of personal taste, the mathematical results are the same anyway. Generating the indices in exactly the same order as we did previously would make the algorithm significantly more complicated.\n> \n> Can one devise another method, just for display purposes, which would reorder the output of `non_redundant_index_generator`?\n\nYou could of course just convert all of the indices into a list and sort that one via `list(tensor.non_redundant_index_generator()).sort()`. This is a bit inefficient but for display purposes, this should be fine.",
    "created_at": "2021-08-05T15:06:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32081#issuecomment-458071",
    "user": "@spaghettisalat"
}
```

Replying to [comment:10 egourgoulhon]:
> Replying to [comment:9 gh-spaghettisalat]:
> > Replying to [comment:8 egourgoulhon]:
> > > Thanks for improving significantly the generator of non-redundant indices! 
> > > There is an issue with the ordering of the output though, which affects the display of Christoffel symbols: the output shall respect the ordering of the coordinates, i.e. the doctests should not be modified.
> > 
> > Is that really important? 
> 
> Yes I think so. Christoffel symbols are usually lengthy objects and displaying them in random order is not very useful. Ordered display is required for publishing or comparing with previously known results (e.g. textbook, wikipedia). 
> 

The order is not random, it is just slightly different than before. For the christoffel symbols, previously the indices would increase from right to left, now the first index increases before the last two ones. In general, the new algorithm first increases unsymmetrized indices, then symmetrized and finally antisymmetrized ones. One could also do this in a different order (for instance first increase the antisymmetrized indices), which would restore the old order at least for christoffel symbols. But I don't really see the point of that, since there is no universally agreed standard for in which order one should display the indices.

> >The order in which the components of tensors are displayed is a matter of personal taste, the mathematical results are the same anyway. Generating the indices in exactly the same order as we did previously would make the algorithm significantly more complicated.
> 
> Can one devise another method, just for display purposes, which would reorder the output of `non_redundant_index_generator`?

You could of course just convert all of the indices into a list and sort that one via `list(tensor.non_redundant_index_generator()).sort()`. This is a bit inefficient but for display purposes, this should be fine.



---

archive/issue_comments_458072.json:
```json
{
    "body": "I agree with Eric. Ordering the indices by coordinates is extremely convenient, at least for the output.\n\nSince this seems only affect the Christoffel symbols, I can live with sorting them afterwards, even for the price of a small slow down in that case (which, I suspect, is still faster than the current implementation).\n\nOn the other hand, please keep in mind that there is a refactoring of the components's module going on in #30307. To that end, we will cache results related to symmetry such as this iterator.",
    "created_at": "2021-08-05T15:26:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32081#issuecomment-458072",
    "user": "@mjungmath"
}
```

I agree with Eric. Ordering the indices by coordinates is extremely convenient, at least for the output.

Since this seems only affect the Christoffel symbols, I can live with sorting them afterwards, even for the price of a small slow down in that case (which, I suspect, is still faster than the current implementation).

On the other hand, please keep in mind that there is a refactoring of the components's module going on in #30307. To that end, we will cache results related to symmetry such as this iterator.



---

archive/issue_comments_458073.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-08-05T18:36:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32081#issuecomment-458073",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_458074.json:
```json
{
    "body": "I have implemented sorting of the indices for display. All outputs should now appear the same way as before.\n\n> Changed 6 hours ago by gh-mjungmath:\n\n> Haven't checked the algorithm yet, but here are already some minor comments:\n\n>  * Why is self._sym copied but self._antisym not? From the first glimpse, a copy doesn't seem to be necessary anyway.\n\nBecause this is modified later on. The new algorithm treats non-symmetrized indices as a symmetrization of a single index and adds those to the `sym` list.\n\n> * Very minor (PEP norm):\n>{{{\n>    - for k in range(1,len(isym)):\n>    + for k in range(1, len(isym)):\n> }}}\n\nThis has been fixed.\n\n> Very nice by the way. This could make a significant difference in sophisticated computations (especially since this generator is not cached). I am very curious about the timings of the SageManifolds example notebooks! \n\nAs long as these examples are in dimensions below 6, I doubt that this will make a significant impact.",
    "created_at": "2021-08-05T18:44:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32081#issuecomment-458074",
    "user": "@spaghettisalat"
}
```

I have implemented sorting of the indices for display. All outputs should now appear the same way as before.

> Changed 6 hours ago by gh-mjungmath:

> Haven't checked the algorithm yet, but here are already some minor comments:

>  * Why is self._sym copied but self._antisym not? From the first glimpse, a copy doesn't seem to be necessary anyway.

Because this is modified later on. The new algorithm treats non-symmetrized indices as a symmetrization of a single index and adds those to the `sym` list.

> * Very minor (PEP norm):
>{{{
>    - for k in range(1,len(isym)):
>    + for k in range(1, len(isym)):
> }}}

This has been fixed.

> Very nice by the way. This could make a significant difference in sophisticated computations (especially since this generator is not cached). I am very curious about the timings of the SageManifolds example notebooks! 

As long as these examples are in dimensions below 6, I doubt that this will make a significant impact.



---

archive/issue_comments_458075.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-08-05T18:44:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32081#issuecomment-458075",
    "user": "@spaghettisalat"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_458076.json:
```json
{
    "body": "Thanks for the changes! \nMichael, do you agree with the positive review?",
    "created_at": "2021-08-07T09:30:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32081#issuecomment-458076",
    "user": "egourgoulhon"
}
```

Thanks for the changes! 
Michael, do you agree with the positive review?



---

archive/issue_comments_458077.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-08-07T09:30:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32081#issuecomment-458077",
    "user": "egourgoulhon"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_458078.json:
```json
{
    "body": "I really dislike the usage of flags within loops, in this case `step_finished`. My intuition tells me, it should be possible to simplify the code much further. But I immediately don't see how.\n\nBut this is personal taste, and for now this should be fine.",
    "created_at": "2021-08-07T15:51:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32081#issuecomment-458078",
    "user": "@mjungmath"
}
```

I really dislike the usage of flags within loops, in this case `step_finished`. My intuition tells me, it should be possible to simplify the code much further. But I immediately don't see how.

But this is personal taste, and for now this should be fine.



---

archive/issue_comments_458079.json:
```json
{
    "body": "This is a huge improvement though. Thank you Marius!",
    "created_at": "2021-08-07T16:01:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32081#issuecomment-458079",
    "user": "@mjungmath"
}
```

This is a huge improvement though. Thank you Marius!



---

archive/issue_comments_458080.json:
```json
{
    "body": "Replying to [comment:17 gh-mjungmath]:\n> I really dislike the usage of flags within loops, in this case `step_finished`. My intuition tells me, it should be possible to simplify the code much further. But I immediately don't see how.\n\nIf only python had a goto statement...",
    "created_at": "2021-08-07T17:10:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32081#issuecomment-458080",
    "user": "@spaghettisalat"
}
```

Replying to [comment:17 gh-mjungmath]:
> I really dislike the usage of flags within loops, in this case `step_finished`. My intuition tells me, it should be possible to simplify the code much further. But I immediately don't see how.

If only python had a goto statement...



---

archive/issue_comments_458081.json:
```json
{
    "body": "Minor comments, feel free to ignore any or all of them.\n\nPossible simplification for getting a sorted list:\n\n```diff\n-            generator = list(self.non_redundant_index_generator())\n-            generator.sort()\n+            generator = sorted(self.non_redundant_index_generator())\n```\n\n\nPEP8 recommends 2 spaces before inline comments\n(and some suggested rephrasings):\n\n\n```diff\n-                    return # end point reached\n+                    return  # end point reached\n```\n\n\n\n```diff\n-        sym = self._sym.copy() # we may modify this in the following\n+        sym = self._sym.copy()  # make a copy we can modify\n```\n\n\n\n```diff\n-            step_finished = False # each step generates a new index\n+            step_finished = False  # each step generates a new index\n```\n\n\n\n```diff\n+                    return # end point reach\n+                    return  # end point reached\n```\n\n\nLonger comments can go on their own line(s)\n(and sometimes be made a bit shorter):\n\n\n```diff\n-                sym.append([pos]) # treat non-symmetrized indices as being symmetrized with themselves\n+                # treat non-symmetrized indices as symmetrized with themselves\n+                sym.append([pos])\n```\n\n\n\n```diff\n-                    return # we went through all indices and didn't\n-                           # find one which we can increase, thus we\n-                           # have generated all indices\n+                    # we went through all indices and none could be\n+                    # increased, so we have generated all indices\n+                    return\n```\n\n\nThe following give the same boolean:\n\n- `not any([a in b for b in c]) and not any([a in b for b in d])`\n- `all(a not in b for e in (c, d) for b in e)`\n\nso one could rewrite:\n\n\n```diff\n-            if not any([pos in isym for isym in sym]) and not any([pos in isym for isym in antisym]):\n+            if all(pos not in isym for xsym in (sym, antisym) for isym in xsym):\n```\n\n\nCalling the flag `done` rather than `step_finished`,\none would read: `if not done: ...`.\n\nPossible rewriting given how Python\nturns numbers and lists to booleans:\n\n\n```diff\n-                if not step_finished and i == 0 and len(antisym) == 0:\n+                if not step_finished and not i and not antisym:\n```\n\n\nMaybe shorten this comment:\n\n```diff\n-                            # this index is at the maximum and we have\n-                            # to reset it\n+                            # this index is at the maximum; reset it\n```\n\n\nMaybe add spaces around + and -, and after commas,\nin several instances of:\n\n```diff\n- range(len(sym)-1,-1,-1)\n+ range(len(sym) - 1, -1, -1)\n```\n",
    "created_at": "2021-08-07T18:10:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32081#issuecomment-458081",
    "user": "slelievre"
}
```

Minor comments, feel free to ignore any or all of them.

Possible simplification for getting a sorted list:

```diff
-            generator = list(self.non_redundant_index_generator())
-            generator.sort()
+            generator = sorted(self.non_redundant_index_generator())
```


PEP8 recommends 2 spaces before inline comments
(and some suggested rephrasings):


```diff
-                    return # end point reached
+                    return  # end point reached
```



```diff
-        sym = self._sym.copy() # we may modify this in the following
+        sym = self._sym.copy()  # make a copy we can modify
```



```diff
-            step_finished = False # each step generates a new index
+            step_finished = False  # each step generates a new index
```



```diff
+                    return # end point reach
+                    return  # end point reached
```


Longer comments can go on their own line(s)
(and sometimes be made a bit shorter):


```diff
-                sym.append([pos]) # treat non-symmetrized indices as being symmetrized with themselves
+                # treat non-symmetrized indices as symmetrized with themselves
+                sym.append([pos])
```



```diff
-                    return # we went through all indices and didn't
-                           # find one which we can increase, thus we
-                           # have generated all indices
+                    # we went through all indices and none could be
+                    # increased, so we have generated all indices
+                    return
```


The following give the same boolean:

- `not any([a in b for b in c]) and not any([a in b for b in d])`
- `all(a not in b for e in (c, d) for b in e)`

so one could rewrite:


```diff
-            if not any([pos in isym for isym in sym]) and not any([pos in isym for isym in antisym]):
+            if all(pos not in isym for xsym in (sym, antisym) for isym in xsym):
```


Calling the flag `done` rather than `step_finished`,
one would read: `if not done: ...`.

Possible rewriting given how Python
turns numbers and lists to booleans:


```diff
-                if not step_finished and i == 0 and len(antisym) == 0:
+                if not step_finished and not i and not antisym:
```


Maybe shorten this comment:

```diff
-                            # this index is at the maximum and we have
-                            # to reset it
+                            # this index is at the maximum; reset it
```


Maybe add spaces around + and -, and after commas,
in several instances of:

```diff
- range(len(sym)-1,-1,-1)
+ range(len(sym) - 1, -1, -1)
```




---

archive/issue_comments_458082.json:
```json
{
    "body": "I ponder, is the outer while-loop even necessary? Couldn't you just split this whole thing into two separated loops and `yield` within those? Then the code gets much simpler and the flag becomes obsolete.",
    "created_at": "2021-08-07T18:36:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32081#issuecomment-458082",
    "user": "@mjungmath"
}
```

I ponder, is the outer while-loop even necessary? Couldn't you just split this whole thing into two separated loops and `yield` within those? Then the code gets much simpler and the flag becomes obsolete.



---

archive/issue_comments_458083.json:
```json
{
    "body": "Replying to [comment:19 gh-spaghettisalat]:\n> Replying to [comment:17 gh-mjungmath]:\n> > I really dislike the usage of flags within loops, in this case `step_finished`. My intuition tells me, it should be possible to simplify the code much further. But I immediately don't see how.\n> \n> If only python had a goto statement...\n\nhttp://entrian.com/goto/ :P",
    "created_at": "2021-08-07T19:46:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32081#issuecomment-458083",
    "user": "@mjungmath"
}
```

Replying to [comment:19 gh-spaghettisalat]:
> Replying to [comment:17 gh-mjungmath]:
> > I really dislike the usage of flags within loops, in this case `step_finished`. My intuition tells me, it should be possible to simplify the code much further. But I immediately don't see how.
> 
> If only python had a goto statement...

http://entrian.com/goto/ :P



---

archive/issue_comments_458084.json:
```json
{
    "body": "Replying to [comment:20 slelievre]:\n> \n> Possible rewriting given how Python\n> turns numbers and lists to booleans:\n> \n> {{{#!diff\n> -                if not step_finished and i == 0 and len(antisym) == 0:\n> +                if not step_finished and not i and not antisym:\n> }}}\n> \nPersonally, I don't agree with that one. Of course, `not i` is more pythonic, but I find it less readable than `i == 0`, especially in the current context, where `i` is an integer.",
    "created_at": "2021-08-09T07:50:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32081#issuecomment-458084",
    "user": "egourgoulhon"
}
```

Replying to [comment:20 slelievre]:
> 
> Possible rewriting given how Python
> turns numbers and lists to booleans:
> 
> {{{#!diff
> -                if not step_finished and i == 0 and len(antisym) == 0:
> +                if not step_finished and not i and not antisym:
> }}}
> 
Personally, I don't agree with that one. Of course, `not i` is more pythonic, but I find it less readable than `i == 0`, especially in the current context, where `i` is an integer.



---

archive/issue_comments_458085.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-09-05T21:38:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32081",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32081#issuecomment-458085",
    "user": "vbraun"
}
```

Resolution: fixed
