# Issue 25798: py3: some details in polyhedron

Issue created by migration from Trac.

Original creator: chapoton

Original creation time: 2018-08-09 15:10:30

CC:  jhpalmieri




---

Comment by chapoton created at 2018-08-09 15:11:10

New commits:


---

Comment by chapoton created at 2018-08-09 15:11:10

Changing status from new to needs_review.


---

Comment by git created at 2018-08-09 15:18:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhpalmieri created at 2018-08-09 16:34:54

I don't know if this is the ideal fix, but it works for me.


---

Comment by jhpalmieri created at 2018-08-09 16:34:54

Changing status from needs_review to positive_review.


---

Comment by jhpalmieri created at 2018-08-09 16:37:24

Actually, I'm going to try another fix first:

```diff
diff --git a/src/sage/geometry/polyhedron/backend_cdd.py b/src/sage/geometry/polyhedron/backend_cdd.py
index 63fd020d06..5ecab3aa76 100644
--- a/src/sage/geometry/polyhedron/backend_cdd.py
+++ b/src/sage/geometry/polyhedron/backend_cdd.py
`@``@` -218,7 +218,7 `@``@` class Polyhedron_cdd(Polyhedron_base):
         cddout = cddout.splitlines()
 
         def parse_indices(count, cdd_indices, cdd_indices_to_sage_indices=None):
-            cdd_indices = list(map(int, cdd_indices))
+            cdd_indices = [int(_) for _ in cdd_indices]
             if cdd_indices_to_sage_indices is None:
                 cdd_indices_to_sage_indices = {i:i-1 for i in cdd_indices}
             if count < 0:
`@``@` -247,7 +247,7 `@``@` class Polyhedron_cdd(Polyhedron_base):
             assert self.ambient_dim() == dimension - 1, "Unexpected ambient dimension"
             assert len(data) == count, "Unexpected number of lines"
             for i, line in enumerate(data):
-                coefficients = list(map(self.base_ring(), line))
+                coefficients = [self.base_ring()(x) for x in line]
                 if coefficients[0] != 0 and all(e == 0 for e in coefficients[1:]):
                     # cddlib sometimes includes an implicit plane at infinity: 1 0 0 ... 0
                     # We do not care about this entry.
```



---

Comment by jhpalmieri created at 2018-08-09 16:37:24

Changing status from positive_review to needs_info.


---

Comment by jhpalmieri created at 2018-08-09 17:37:35

This new version works for me and I prefer it: there is no reason to use `map` if we want a list and can use list comprehension instead. So I propose we use this instead.


---

Comment by jhpalmieri created at 2018-08-09 17:39:24

Of course I proposed the first change, too, so sorry about that. I was just trying to get the PDF docs to build, not thinking too clearly about the right way to do things.
----
New commits:


---

Comment by jhpalmieri created at 2018-08-09 17:39:24

Changing status from needs_info to needs_review.


---

Comment by chapoton created at 2018-08-09 18:05:54

ok for list comprehension.

but please do not use underscore `_`, but a normal variable name.


---

Comment by git created at 2018-08-09 18:15:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhpalmieri created at 2018-08-09 18:19:40

Okay, no `_`. Also, in moving the patch from #25840 to here, the change `data = list(data)` got moved to the wrong place. That's fixed, so the plot which was problematic before in Python 3 now works. If you want to test, it's this one:

```
sage: M = matrix([[0., -0.556793440452, 0.19694925177, -0.19694925177, 0.0805477263944, -0.385290876171, 0., 0.3852
....: 90876171], [0.180913155536, 0., 0.160212955043, 0.160212955043, 0., 0.0990170516545, 0.766360424875, 0.099017
....: 0516545],[0.338261212718, 0, 0, -0.338261212718, 0.672816364803, 0.171502564281, 0, -0.171502564281]])
sage: L = RootSystem(["E",8]).ambient_space()
sage: L.plot(roots="all", reflection_hyperplanes=False, projection=lambda v: M*vector(v), labels=False)
```



---

Comment by chapoton created at 2018-08-09 19:08:19

good for me if the bot is morally green


---

Comment by jhpalmieri created at 2018-08-09 22:32:47

Changing status from needs_review to positive_review.


---

Comment by jhpalmieri created at 2018-08-09 22:32:47

Great, thanks (bot was green).


---

Comment by tscrim created at 2018-08-09 22:36:21

Quick little micro-optimization: Instead of

```
coefficients = [self.base_ring()(x) for x in line]
```

which repeatedly called the `base_ring()`, I would move that outside of the bigger `for` loop. However, you can do that on a later ticket. :)


---

Comment by git created at 2018-08-10 01:05:58

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by git created at 2018-08-10 01:05:58

Changing status from positive_review to needs_review.


---

Comment by jhpalmieri created at 2018-08-10 01:06:28

We can deal with that now.


---

Comment by tscrim created at 2018-08-10 02:11:33

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2018-08-10 02:11:33

Thank you.


---

Comment by vbraun created at 2018-08-20 23:38:42

Resolution: fixed
