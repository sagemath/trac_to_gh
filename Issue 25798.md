# Issue 25798: py3: some details in polyhedron

archive/issues_025798.json:
```json
{
    "body": "CC:  @jhpalmieri\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/26035\n\n",
    "created_at": "2018-08-09T15:10:30Z",
    "labels": [
        "component: python3"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.4",
    "title": "py3: some details in polyhedron",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25798",
    "user": "https://github.com/fchapoton"
}
```
CC:  @jhpalmieri



Issue created by migration from https://trac.sagemath.org/ticket/26035





---

archive/issue_comments_363767.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-08-09T15:11:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25798#issuecomment-363767",
    "user": "https://github.com/fchapoton"
}
```

New commits:



---

archive/issue_comments_363768.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-08-09T15:11:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25798#issuecomment-363768",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_363769.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-09T15:18:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25798#issuecomment-363769",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_363770.json:
```json
{
    "body": "I don't know if this is the ideal fix, but it works for me.",
    "created_at": "2018-08-09T16:34:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25798#issuecomment-363770",
    "user": "https://github.com/jhpalmieri"
}
```

I don't know if this is the ideal fix, but it works for me.



---

archive/issue_comments_363771.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-08-09T16:34:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25798#issuecomment-363771",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_363772.json:
```json
{
    "body": "Actually, I'm going to try another fix first:\n\n```diff\ndiff --git a/src/sage/geometry/polyhedron/backend_cdd.py b/src/sage/geometry/polyhedron/backend_cdd.py\nindex 63fd020d06..5ecab3aa76 100644\n--- a/src/sage/geometry/polyhedron/backend_cdd.py\n+++ b/src/sage/geometry/polyhedron/backend_cdd.py\n@@ -218,7 +218,7 @@ class Polyhedron_cdd(Polyhedron_base):\n         cddout = cddout.splitlines()\n \n         def parse_indices(count, cdd_indices, cdd_indices_to_sage_indices=None):\n-            cdd_indices = list(map(int, cdd_indices))\n+            cdd_indices = [int(_) for _ in cdd_indices]\n             if cdd_indices_to_sage_indices is None:\n                 cdd_indices_to_sage_indices = {i:i-1 for i in cdd_indices}\n             if count < 0:\n@@ -247,7 +247,7 @@ class Polyhedron_cdd(Polyhedron_base):\n             assert self.ambient_dim() == dimension - 1, \"Unexpected ambient dimension\"\n             assert len(data) == count, \"Unexpected number of lines\"\n             for i, line in enumerate(data):\n-                coefficients = list(map(self.base_ring(), line))\n+                coefficients = [self.base_ring()(x) for x in line]\n                 if coefficients[0] != 0 and all(e == 0 for e in coefficients[1:]):\n                     # cddlib sometimes includes an implicit plane at infinity: 1 0 0 ... 0\n                     # We do not care about this entry.\n```\n",
    "created_at": "2018-08-09T16:37:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25798#issuecomment-363772",
    "user": "https://github.com/jhpalmieri"
}
```

Actually, I'm going to try another fix first:

```diff
diff --git a/src/sage/geometry/polyhedron/backend_cdd.py b/src/sage/geometry/polyhedron/backend_cdd.py
index 63fd020d06..5ecab3aa76 100644
--- a/src/sage/geometry/polyhedron/backend_cdd.py
+++ b/src/sage/geometry/polyhedron/backend_cdd.py
@@ -218,7 +218,7 @@ class Polyhedron_cdd(Polyhedron_base):
         cddout = cddout.splitlines()
 
         def parse_indices(count, cdd_indices, cdd_indices_to_sage_indices=None):
-            cdd_indices = list(map(int, cdd_indices))
+            cdd_indices = [int(_) for _ in cdd_indices]
             if cdd_indices_to_sage_indices is None:
                 cdd_indices_to_sage_indices = {i:i-1 for i in cdd_indices}
             if count < 0:
@@ -247,7 +247,7 @@ class Polyhedron_cdd(Polyhedron_base):
             assert self.ambient_dim() == dimension - 1, "Unexpected ambient dimension"
             assert len(data) == count, "Unexpected number of lines"
             for i, line in enumerate(data):
-                coefficients = list(map(self.base_ring(), line))
+                coefficients = [self.base_ring()(x) for x in line]
                 if coefficients[0] != 0 and all(e == 0 for e in coefficients[1:]):
                     # cddlib sometimes includes an implicit plane at infinity: 1 0 0 ... 0
                     # We do not care about this entry.
```




---

archive/issue_comments_363773.json:
```json
{
    "body": "Changing status from positive_review to needs_info.",
    "created_at": "2018-08-09T16:37:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25798#issuecomment-363773",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from positive_review to needs_info.



---

archive/issue_comments_363774.json:
```json
{
    "body": "This new version works for me and I prefer it: there is no reason to use `map` if we want a list and can use list comprehension instead. So I propose we use this instead.",
    "created_at": "2018-08-09T17:37:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25798#issuecomment-363774",
    "user": "https://github.com/jhpalmieri"
}
```

This new version works for me and I prefer it: there is no reason to use `map` if we want a list and can use list comprehension instead. So I propose we use this instead.



---

archive/issue_comments_363775.json:
```json
{
    "body": "Of course I proposed the first change, too, so sorry about that. I was just trying to get the PDF docs to build, not thinking too clearly about the right way to do things.\n----\nNew commits:",
    "created_at": "2018-08-09T17:39:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25798#issuecomment-363775",
    "user": "https://github.com/jhpalmieri"
}
```

Of course I proposed the first change, too, so sorry about that. I was just trying to get the PDF docs to build, not thinking too clearly about the right way to do things.
----
New commits:



---

archive/issue_comments_363776.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2018-08-09T17:39:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25798#issuecomment-363776",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_363777.json:
```json
{
    "body": "ok for list comprehension.\n\nbut please do not use underscore `_`, but a normal variable name.",
    "created_at": "2018-08-09T18:05:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25798#issuecomment-363777",
    "user": "https://github.com/fchapoton"
}
```

ok for list comprehension.

but please do not use underscore `_`, but a normal variable name.



---

archive/issue_comments_363778.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-09T18:15:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25798#issuecomment-363778",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_363779.json:
```json
{
    "body": "Okay, no `_`. Also, in moving the patch from #25840 to here, the change `data = list(data)` got moved to the wrong place. That's fixed, so the plot which was problematic before in Python 3 now works. If you want to test, it's this one:\n\n```\nsage: M = matrix([[0., -0.556793440452, 0.19694925177, -0.19694925177, 0.0805477263944, -0.385290876171, 0., 0.3852\n....: 90876171], [0.180913155536, 0., 0.160212955043, 0.160212955043, 0., 0.0990170516545, 0.766360424875, 0.099017\n....: 0516545],[0.338261212718, 0, 0, -0.338261212718, 0.672816364803, 0.171502564281, 0, -0.171502564281]])\nsage: L = RootSystem([\"E\",8]).ambient_space()\nsage: L.plot(roots=\"all\", reflection_hyperplanes=False, projection=lambda v: M*vector(v), labels=False)\n```\n",
    "created_at": "2018-08-09T18:19:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25798#issuecomment-363779",
    "user": "https://github.com/jhpalmieri"
}
```

Okay, no `_`. Also, in moving the patch from #25840 to here, the change `data = list(data)` got moved to the wrong place. That's fixed, so the plot which was problematic before in Python 3 now works. If you want to test, it's this one:

```
sage: M = matrix([[0., -0.556793440452, 0.19694925177, -0.19694925177, 0.0805477263944, -0.385290876171, 0., 0.3852
....: 90876171], [0.180913155536, 0., 0.160212955043, 0.160212955043, 0., 0.0990170516545, 0.766360424875, 0.099017
....: 0516545],[0.338261212718, 0, 0, -0.338261212718, 0.672816364803, 0.171502564281, 0, -0.171502564281]])
sage: L = RootSystem(["E",8]).ambient_space()
sage: L.plot(roots="all", reflection_hyperplanes=False, projection=lambda v: M*vector(v), labels=False)
```




---

archive/issue_comments_363780.json:
```json
{
    "body": "good for me if the bot is morally green",
    "created_at": "2018-08-09T19:08:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25798#issuecomment-363780",
    "user": "https://github.com/fchapoton"
}
```

good for me if the bot is morally green



---

archive/issue_comments_363781.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-08-09T22:32:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25798#issuecomment-363781",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_363782.json:
```json
{
    "body": "Great, thanks (bot was green).",
    "created_at": "2018-08-09T22:32:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25798#issuecomment-363782",
    "user": "https://github.com/jhpalmieri"
}
```

Great, thanks (bot was green).



---

archive/issue_comments_363783.json:
```json
{
    "body": "Quick little micro-optimization: Instead of\n\n```\ncoefficients = [self.base_ring()(x) for x in line]\n```\n\nwhich repeatedly called the `base_ring()`, I would move that outside of the bigger `for` loop. However, you can do that on a later ticket. :)",
    "created_at": "2018-08-09T22:36:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25798#issuecomment-363783",
    "user": "https://github.com/tscrim"
}
```

Quick little micro-optimization: Instead of

```
coefficients = [self.base_ring()(x) for x in line]
```

which repeatedly called the `base_ring()`, I would move that outside of the bigger `for` loop. However, you can do that on a later ticket. :)



---

archive/issue_comments_363784.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2018-08-10T01:05:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25798#issuecomment-363784",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_363785.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2018-08-10T01:05:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25798#issuecomment-363785",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_363786.json:
```json
{
    "body": "We can deal with that now.",
    "created_at": "2018-08-10T01:06:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25798#issuecomment-363786",
    "user": "https://github.com/jhpalmieri"
}
```

We can deal with that now.



---

archive/issue_comments_363787.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-08-10T02:11:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25798#issuecomment-363787",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_363788.json:
```json
{
    "body": "Thank you.",
    "created_at": "2018-08-10T02:11:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25798#issuecomment-363788",
    "user": "https://github.com/tscrim"
}
```

Thank you.



---

archive/issue_events_023991.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2018-08-20T23:38:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25798",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25798#event-23991"
}
```



---

archive/issue_comments_363789.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-08-20T23:38:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25798",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25798#issuecomment-363789",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
