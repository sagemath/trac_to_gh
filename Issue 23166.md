# Issue 23166: Crash with SchubertPolynomialRing

archive/issues_023166.json:
```json
{
    "body": "CC:  sage-combinat @nthiery vivanepons @fchapoton @darijgr\n\n\n```\nsage: X = SchubertPolynomialRing(ZZ)\nsage: a = X([3,2,4,1])\nsage: a.divided_difference(2)\npython: \ufffd: Unknown error -315708632\n```\n\nThe error number is random every time.\n\nIssue created by migration from https://trac.sagemath.org/ticket/23403\n\n",
    "created_at": "2017-07-12T01:23:20Z",
    "labels": [
        "component: combinatorics",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "Crash with SchubertPolynomialRing",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23166",
    "user": "https://github.com/tscrim"
}
```
CC:  sage-combinat @nthiery vivanepons @fchapoton @darijgr


```
sage: X = SchubertPolynomialRing(ZZ)
sage: a = X([3,2,4,1])
sage: a.divided_difference(2)
python: �: Unknown error -315708632
```

The error number is random every time.

Issue created by migration from https://trac.sagemath.org/ticket/23403





---

archive/issue_comments_323628.json:
```json
{
    "body": "Okay, I've traced the problem down to the fact that there might be no monomials in the Schubert polynomial. Yet it is still a pointer to a non-`NULL` Schubert polynomial, so the code does not translate it to `0`.",
    "created_at": "2017-07-12T02:22:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23166#issuecomment-323628",
    "user": "https://github.com/tscrim"
}
```

Okay, I've traced the problem down to the fact that there might be no monomials in the Schubert polynomial. Yet it is still a pointer to a non-`NULL` Schubert polynomial, so the code does not translate it to `0`.



---

archive/issue_comments_323629.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-07-12T04:21:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23166#issuecomment-323629",
    "user": "https://github.com/tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_323630.json:
```json
{
    "body": "Changing keywords from \"\" to \"Schubert, symmetrica\".",
    "created_at": "2017-07-12T04:21:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23166#issuecomment-323630",
    "user": "https://github.com/tscrim"
}
```

Changing keywords from "" to "Schubert, symmetrica".



---

archive/issue_comments_323631.json:
```json
{
    "body": "So the 0 Schubert polynomial is initialized to an empty list, which behaves differently from, e.g., Schur functions. Because of this, the code tries to get the next pointer starting from a null pointer, resulting in a crash within Symmetrica in a way that is not done within a `sig_on`/`sig_off` block. I also fix up some other corner cases.\n----\nNew commits:",
    "created_at": "2017-07-12T04:21:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23166#issuecomment-323631",
    "user": "https://github.com/tscrim"
}
```

So the 0 Schubert polynomial is initialized to an empty list, which behaves differently from, e.g., Schur functions. Because of this, the code tries to get the next pointer starting from a null pointer, resulting in a crash within Symmetrica in a way that is not done within a `sig_on`/`sig_off` block. I also fix up some other corner cases.
----
New commits:



---

archive/issue_comments_323632.json:
```json
{
    "body": "typos:\n\n```\nFor convienence\n```\n\n\n```\nThis is compatibile\n```\n",
    "created_at": "2017-07-12T06:21:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23166#issuecomment-323632",
    "user": "https://github.com/fchapoton"
}
```

typos:

```
For convienence
```


```
This is compatibile
```




---

archive/issue_comments_323633.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-12T06:27:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23166#issuecomment-323633",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_323634.json:
```json
{
    "body": "I still don't understand which divided difference operator is meant, and what i is. Is it the delta^i in DIFF.2.4 of http://www.math.ku.dk/~thorup/notes/sympol.pdf ?",
    "created_at": "2017-07-12T10:01:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23166#issuecomment-323634",
    "user": "https://github.com/darijgr"
}
```

I still don't understand which divided difference operator is meant, and what i is. Is it the delta^i in DIFF.2.4 of http://www.math.ku.dk/~thorup/notes/sympol.pdf ?



---

archive/issue_comments_323635.json:
```json
{
    "body": "Here is what the code gives:\n\n```\nsage: a = X([3,2,1])\nsage: a.expand()\nx0^2*x1\nsage: for w in Permutations(3):\n....:     if not w.reduced_word():\n....:         continue\n....:     print w.reduced_word(),\n....:     print a.divided_difference(w).expand()\n[2] x0^2\n[1] x0*x1\n[1, 2] x0\n[2, 1] x0 + x1\n[2, 1, 2] 1\n```\n\nYou can tell that `i` acts on the `i`-th variable (although there is a 1-based to 0-based shift needed), and there does not seem to be any signs involved.",
    "created_at": "2017-07-12T14:39:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23166#issuecomment-323635",
    "user": "https://github.com/tscrim"
}
```

Here is what the code gives:

```
sage: a = X([3,2,1])
sage: a.expand()
x0^2*x1
sage: for w in Permutations(3):
....:     if not w.reduced_word():
....:         continue
....:     print w.reduced_word(),
....:     print a.divided_difference(w).expand()
[2] x0^2
[1] x0*x1
[1, 2] x0
[2, 1] x0 + x1
[2, 1, 2] 1
```

You can tell that `i` acts on the `i`-th variable (although there is a 1-based to 0-based shift needed), and there does not seem to be any signs involved.



---

archive/issue_comments_323636.json:
```json
{
    "body": "For the definition of the difference operator, see section 2 of http://www.math.cornell.edu/~allenk/schubnotes.pdf",
    "created_at": "2017-07-13T07:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23166#issuecomment-323636",
    "user": "https://github.com/fchapoton"
}
```

For the definition of the difference operator, see section 2 of http://www.math.cornell.edu/~allenk/schubnotes.pdf



---

archive/issue_comments_323637.json:
```json
{
    "body": "Thanks Fr\u00e9d\u00e9ric. I'm pushing an improved doc.\n\nHowever, I think the new behavior, raising errors when there are not enough variables, is wrong. The Schubert polynomial ring is in infinitely many variables by definition; a polynomial isn't \"missing\" a variable; it just happens to be degree-0 with respect to it.\n\n```\nsage: a = X([1,2,3,4,5])\nsage: a.divided_difference(4)\n```\n\nThis should yield 0, not an exception!",
    "created_at": "2017-07-13T10:30:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23166#issuecomment-323637",
    "user": "https://github.com/darijgr"
}
```

Thanks Frédéric. I'm pushing an improved doc.

However, I think the new behavior, raising errors when there are not enough variables, is wrong. The Schubert polynomial ring is in infinitely many variables by definition; a polynomial isn't "missing" a variable; it just happens to be degree-0 with respect to it.

```
sage: a = X([1,2,3,4,5])
sage: a.divided_difference(4)
```

This should yield 0, not an exception!



---

archive/issue_comments_323638.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-13T10:32:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23166#issuecomment-323638",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_323639.json:
```json
{
    "body": "Replying to [comment:8 darij]:\n> However, I think the new behavior, raising errors when there are not enough variables, is wrong. The Schubert polynomial ring is in infinitely many variables by definition; a polynomial isn't \"missing\" a variable; it just happens to be degree-0 with respect to it.\n> {{{\n> sage: a = X([1,2,3,4,5])\n> sage: a.divided_difference(4)\n> }}}\n> This should yield 0, not an exception!\n\nThat's not new behavior. The only change in behavior is for 0, which is a special case IMO. There is some reason to consider this an error by considering this as the restriction to a finite number of variables. So there is some room for debate, and as such, it should go on another ticket (there's enough \"ticket creep\" already).\n\nI do not disagree with you that it is more natural for it to be 0, but you also need the same behavior to happen for permutation input. If you're not careful with that input and let symmetrica try to handle it, it can result in crashes or other strange behavior (I can find the ticket that talks about it if you want). So I don't see this as being a simple change either and is another reason to put it on a separate ticket.",
    "created_at": "2017-07-13T13:40:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23166#issuecomment-323639",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:8 darij]:
> However, I think the new behavior, raising errors when there are not enough variables, is wrong. The Schubert polynomial ring is in infinitely many variables by definition; a polynomial isn't "missing" a variable; it just happens to be degree-0 with respect to it.
> {{{
> sage: a = X([1,2,3,4,5])
> sage: a.divided_difference(4)
> }}}
> This should yield 0, not an exception!

That's not new behavior. The only change in behavior is for 0, which is a special case IMO. There is some reason to consider this an error by considering this as the restriction to a finite number of variables. So there is some room for debate, and as such, it should go on another ticket (there's enough "ticket creep" already).

I do not disagree with you that it is more natural for it to be 0, but you also need the same behavior to happen for permutation input. If you're not careful with that input and let symmetrica try to handle it, it can result in crashes or other strange behavior (I can find the ticket that talks about it if you want). So I don't see this as being a simple change either and is another reason to put it on a separate ticket.



---

archive/issue_comments_323640.json:
```json
{
    "body": "Oh, I just realized that you didn't add the \"if i > max_a\" check. I'll open a new ticket for this.",
    "created_at": "2017-07-13T13:43:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23166#issuecomment-323640",
    "user": "https://github.com/darijgr"
}
```

Oh, I just realized that you didn't add the "if i > max_a" check. I'll open a new ticket for this.



---

archive/issue_comments_323641.json:
```json
{
    "body": "Why are you using `X.element_class(X, z_elt)` instead of using something like `sum_of_terms`? Isn't `X` a CombinatorialFreeModule?",
    "created_at": "2017-07-13T13:48:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23166#issuecomment-323641",
    "user": "https://github.com/darijgr"
}
```

Why are you using `X.element_class(X, z_elt)` instead of using something like `sum_of_terms`? Isn't `X` a CombinatorialFreeModule?



---

archive/issue_comments_323642.json:
```json
{
    "body": "Created #23423 for the ValueError issue.",
    "created_at": "2017-07-13T13:51:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23166#issuecomment-323642",
    "user": "https://github.com/darijgr"
}
```

Created #23423 for the ValueError issue.



---

archive/issue_comments_323643.json:
```json
{
    "body": "Replying to [comment:12 darij]:\n> Why are you using `X.element_class(X, z_elt)` instead of using something like `sum_of_terms`? Isn't `X` a CombinatorialFreeModule?\n\nYes, and I am taking advantage of that because `z_elt` is a dict with coefficients in the proper ring. The other way would be `X._from_dict(z_elt, coerce=False, remove_zeros=False)`, but that just does exactly as above.",
    "created_at": "2017-07-13T13:54:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23166#issuecomment-323643",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:12 darij]:
> Why are you using `X.element_class(X, z_elt)` instead of using something like `sum_of_terms`? Isn't `X` a CombinatorialFreeModule?

Yes, and I am taking advantage of that because `z_elt` is a dict with coefficients in the proper ring. The other way would be `X._from_dict(z_elt, coerce=False, remove_zeros=False)`, but that just does exactly as above.



---

archive/issue_comments_323644.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-13T13:57:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23166#issuecomment-323644",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_323645.json:
```json
{
    "body": "Ah.\n\nActually, are you sure that `remove_zeros=False` is correct here? I don't understand the code, but I don't see where it properly coerces to the base ring and throws away resulting zeroes.",
    "created_at": "2017-07-13T14:00:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23166#issuecomment-323645",
    "user": "https://github.com/darijgr"
}
```

Ah.

Actually, are you sure that `remove_zeros=False` is correct here? I don't understand the code, but I don't see where it properly coerces to the base ring and throws away resulting zeroes.



---

archive/issue_comments_323646.json:
```json
{
    "body": "It definitely makes things no worse than before. There is not really any coercion but instead is just trying to make a corresponding element in Sage; it is referencing an external library (symmetrica) that does not implement a notion of parents. So I think the result could be a little loose with the parent it returns. Again, another ticket.",
    "created_at": "2017-07-13T14:10:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23166#issuecomment-323646",
    "user": "https://github.com/tscrim"
}
```

It definitely makes things no worse than before. There is not really any coercion but instead is just trying to make a corresponding element in Sage; it is referencing an external library (symmetrica) that does not implement a notion of parents. So I think the result could be a little loose with the parent it returns. Again, another ticket.



---

archive/issue_comments_323647.json:
```json
{
    "body": "Oh, but zeros should be removed by symmetrica IIRC.",
    "created_at": "2017-07-13T14:11:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23166#issuecomment-323647",
    "user": "https://github.com/tscrim"
}
```

Oh, but zeros should be removed by symmetrica IIRC.



---

archive/issue_comments_323648.json:
```json
{
    "body": "OK, I'm just seeing that the method plainly doesn't work over non-ZZ/QQ base rings. At least it's being honest about it:\n\n```\nValueError: a must be a Schubert polynomial over ZZ or QQ\n```\n\nThis is probably a BS restriction, and we should be using Symmetrica on monomials rather than on the whole polynomial.\n\nI'm getting more and more confused the longer I stare at the Schubert code. What exactly does the following method (in libs/symmetrica/sb.pxi) do?\n\n```\ndef divdiff_perm_schubert_symmetrica(perm, a):\n    r\"\"\"\n    Returns the result of applying the divided difference operator\n    $\\delta_i$ to $a$ where $a$ is either a permutation or a\n    Schubert polynomial over QQ.\n```\n\nI'm pretty sure there is at least one typo in the docstring.",
    "created_at": "2017-07-13T20:07:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23166#issuecomment-323648",
    "user": "https://github.com/darijgr"
}
```

OK, I'm just seeing that the method plainly doesn't work over non-ZZ/QQ base rings. At least it's being honest about it:

```
ValueError: a must be a Schubert polynomial over ZZ or QQ
```

This is probably a BS restriction, and we should be using Symmetrica on monomials rather than on the whole polynomial.

I'm getting more and more confused the longer I stare at the Schubert code. What exactly does the following method (in libs/symmetrica/sb.pxi) do?

```
def divdiff_perm_schubert_symmetrica(perm, a):
    r"""
    Returns the result of applying the divided difference operator
    $\delta_i$ to $a$ where $a$ is either a permutation or a
    Schubert polynomial over QQ.
```

I'm pretty sure there is at least one typo in the docstring.



---

archive/issue_comments_323649.json:
```json
{
    "body": "`i` to `perm`, but if `a` is a permutation, then it considered it to be the corresponding monomial in the `X` basis.\n\nI do not know if lrcalc can do these computations or not (I simply haven't looked), but there is a goal of replacing symmetrica by lrcalc IIRC. However, that is again for later. At least for now, can not have Sage crash when trying to do a computation rather than trying to completely clean this code? I am willing to split this ticket just to focus on the big problem at hand: the crash.",
    "created_at": "2017-07-13T23:54:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23166#issuecomment-323649",
    "user": "https://github.com/tscrim"
}
```

`i` to `perm`, but if `a` is a permutation, then it considered it to be the corresponding monomial in the `X` basis.

I do not know if lrcalc can do these computations or not (I simply haven't looked), but there is a goal of replacing symmetrica by lrcalc IIRC. However, that is again for later. At least for now, can not have Sage crash when trying to do a computation rather than trying to completely clean this code? I am willing to split this ticket just to focus on the big problem at hand: the crash.



---

archive/issue_comments_323650.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-16T12:54:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23166#issuecomment-323650",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_323651.json:
```json
{
    "body": "I have rewritten `divided_difference` natively in Sage. The resulting function is significantly faster (around factor 2 on the examples I have tried, which involve Schubert polynomials X(pi) with pi \\in S_3, S_4, S_5) and free of the #23423 issue. There is more potential for optimization: the whole thing could be rewritten in Cython (not by me), and the `remove_extra_fixed_points` helper method on the `Permutation` class could be made into a standalone function that deals with lists (rather than permutations).\n\nIn the current commit, for the sake of reviewing, both the new and the old method can be used (the default is the new one; get the old one by setting the optional `newm` variable to `False`). I guess we'll want to get rid of the old one before merging.",
    "created_at": "2017-07-16T12:55:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23166#issuecomment-323651",
    "user": "https://github.com/darijgr"
}
```

I have rewritten `divided_difference` natively in Sage. The resulting function is significantly faster (around factor 2 on the examples I have tried, which involve Schubert polynomials X(pi) with pi \in S_3, S_4, S_5) and free of the #23423 issue. There is more potential for optimization: the whole thing could be rewritten in Cython (not by me), and the `remove_extra_fixed_points` helper method on the `Permutation` class could be made into a standalone function that deals with lists (rather than permutations).

In the current commit, for the sake of reviewing, both the new and the old method can be used (the default is the new one; get the old one by setting the optional `newm` variable to `False`). I guess we'll want to get rid of the old one before merging.



---

archive/issue_comments_323652.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-07-16T13:28:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23166#issuecomment-323652",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_323653.json:
```json
{
    "body": "This is a great improvement and is faster on all of the examples I tested (including some relatively large permutations). However, it must go on another ticket as this ticket is about fixing the crash in symmetrica, which is independent of the divided difference functionality. I guess it is somewhat my fault for starting this. Yet, I will revert all of the other little changes if that is what it takes for us to focus on the problem of this ticket. I will review the followup tickets in exchange.\n\nI reverted this branch to `1aaca0f` as that is still in the general realm of the ticket, but I am considering a full rewrite. I put your current rewrite on the branch\n\n```\npublic/combinat/improve_schubert_divided_difference\n```\n",
    "created_at": "2017-07-16T13:33:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23166#issuecomment-323653",
    "user": "https://github.com/tscrim"
}
```

This is a great improvement and is faster on all of the examples I tested (including some relatively large permutations). However, it must go on another ticket as this ticket is about fixing the crash in symmetrica, which is independent of the divided difference functionality. I guess it is somewhat my fault for starting this. Yet, I will revert all of the other little changes if that is what it takes for us to focus on the problem of this ticket. I will review the followup tickets in exchange.

I reverted this branch to `1aaca0f` as that is still in the general realm of the ticket, but I am considering a full rewrite. I put your current rewrite on the branch

```
public/combinat/improve_schubert_divided_difference
```




---

archive/issue_comments_323654.json:
```json
{
    "body": "Is the crash actually independent from the divided difference functionality? I thought only the `divided_difference` method would crash. If not, this definitely should be a standalone ticket (but one I cannot reasonably review, sadly).",
    "created_at": "2017-07-16T13:50:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23166#issuecomment-323654",
    "user": "https://github.com/darijgr"
}
```

Is the crash actually independent from the divided difference functionality? I thought only the `divided_difference` method would crash. If not, this definitely should be a standalone ticket (but one I cannot reasonably review, sadly).



---

archive/issue_comments_323655.json:
```json
{
    "body": "Yes, the crash occurs because symmetrica returns an empty-list object to represent `0` from the data type but the interpreter is expecting a null pointer for `0` (as is the case for, e.g., Schur functions). The main change is in `symmetrica.pxi`. I also made the extra change in `sb.pxi` to further protect against bad-input that leads to either grossly wrong results or a crash. All other changes are tangential.",
    "created_at": "2017-07-16T13:54:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23166#issuecomment-323655",
    "user": "https://github.com/tscrim"
}
```

Yes, the crash occurs because symmetrica returns an empty-list object to represent `0` from the data type but the interpreter is expecting a null pointer for `0` (as is the case for, e.g., Schur functions). The main change is in `symmetrica.pxi`. I also made the extra change in `sb.pxi` to further protect against bad-input that leads to either grossly wrong results or a crash. All other changes are tangential.



---

archive/issue_comments_323656.json:
```json
{
    "body": "Replying to [ticket:23403 tscrim]:\n> {{{\n> sage: X = SchubertPolynomialRing(ZZ)\n> sage: a = X([3,2,4,1])\n> sage: a.divided_difference(2)\n> python: : Unknown error -315708632\n> }}}\n\nIs that the exact (verbatim) output that you get? On which system is that?\n\nI get\n\n```\nsage: SchubertPolynomialRing(ZZ)([3,2,4,1]).divided_difference(2)\npython: ------------------------------------------------------------------------\n/usr/local/src/sage-git/local/lib/python2.7/site-packages/cysignals/signals.so(+0x5f38)[0x7fcb98405f38]\n/usr/local/src/sage-git/local/lib/python2.7/site-packages/cysignals/signals.so(+0x5fa5)[0x7fcb98405fa5]\n/usr/local/src/sage-git/local/lib/python2.7/site-packages/cysignals/signals.so(+0x8db7)[0x7fcb98408db7]\n/lib64/libpthread.so.0(+0x10860)[0x7fcba0a9e860]\n/lib64/libc.so.6(strchrnul+0x23)[0x7fcba0085de3]\n[...truncated a lot...]\n------------------------------------------------------------------------\nUnhandled SIGSEGV: A segmentation fault occurred.\nThis probably occurred because a *compiled* module has a bug\nin it and is not properly wrapped with sig_on(), sig_off().\nPython will now terminate.\n------------------------------------------------------------------------\nSegmentation fault\n```\n",
    "created_at": "2017-08-09T12:23:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23166#issuecomment-323656",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:23403 tscrim]:
> {{{
> sage: X = SchubertPolynomialRing(ZZ)
> sage: a = X([3,2,4,1])
> sage: a.divided_difference(2)
> python: : Unknown error -315708632
> }}}

Is that the exact (verbatim) output that you get? On which system is that?

I get

```
sage: SchubertPolynomialRing(ZZ)([3,2,4,1]).divided_difference(2)
python: ------------------------------------------------------------------------
/usr/local/src/sage-git/local/lib/python2.7/site-packages/cysignals/signals.so(+0x5f38)[0x7fcb98405f38]
/usr/local/src/sage-git/local/lib/python2.7/site-packages/cysignals/signals.so(+0x5fa5)[0x7fcb98405fa5]
/usr/local/src/sage-git/local/lib/python2.7/site-packages/cysignals/signals.so(+0x8db7)[0x7fcb98408db7]
/lib64/libpthread.so.0(+0x10860)[0x7fcba0a9e860]
/lib64/libc.so.6(strchrnul+0x23)[0x7fcba0085de3]
[...truncated a lot...]
------------------------------------------------------------------------
Unhandled SIGSEGV: A segmentation fault occurred.
This probably occurred because a *compiled* module has a bug
in it and is not properly wrapped with sig_on(), sig_off().
Python will now terminate.
------------------------------------------------------------------------
Segmentation fault
```




---

archive/issue_comments_323657.json:
```json
{
    "body": "Symmetrica code:\n\n```C\nOP s_mo_k(a) OP a;\n/* AK 100789 V1.0 */ /* AK 191289 V1.1 */ /* AK 200891 V1.3 */\n{\n    OBJECTSELF c;\n    if (a == NULL)\n        return error(\"s_mo_k:a == NULL\"),(OP)NULL;\n    if (S_O_K(a) != MONOM)\n        return error(\"s_mo_k:a  != MONOM\"),(OP)NULL;\n    c = s_o_s(a);\n    return(c.ob_monom->mo_koeff);\n}\n```\n\n\nYup, totally clear what it does :-)",
    "created_at": "2017-08-09T12:36:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23166#issuecomment-323657",
    "user": "https://github.com/jdemeyer"
}
```

Symmetrica code:

```C
OP s_mo_k(a) OP a;
/* AK 100789 V1.0 */ /* AK 191289 V1.1 */ /* AK 200891 V1.3 */
{
    OBJECTSELF c;
    if (a == NULL)
        return error("s_mo_k:a == NULL"),(OP)NULL;
    if (S_O_K(a) != MONOM)
        return error("s_mo_k:a  != MONOM"),(OP)NULL;
    c = s_o_s(a);
    return(c.ob_monom->mo_koeff);
}
```


Yup, totally clear what it does :-)



---

archive/issue_comments_323658.json:
```json
{
    "body": "Let me guess, 100789 means 10th July 1989?\n\nThat said, the English-German hodgepodge has probably not been up to standards even by the 80s standards...",
    "created_at": "2017-08-09T12:53:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23166#issuecomment-323658",
    "user": "https://github.com/darijgr"
}
```

Let me guess, 100789 means 10th July 1989?

That said, the English-German hodgepodge has probably not been up to standards even by the 80s standards...



---

archive/issue_comments_323659.json:
```json
{
    "body": "Replying to [comment:27 jdemeyer]:\n> Replying to [ticket:23403 tscrim]:\n> > {{{\n> > sage: X = SchubertPolynomialRing(ZZ)\n> > sage: a = X([3,2,4,1])\n> > sage: a.divided_difference(2)\n> > python: : Unknown error -315708632\n> > }}}\n> \n> Is that the exact (verbatim) output that you get?\n\nYes (other than the number that changes every time).\n\n> On which system is that?\n\nUbuntu 16.04 LTS (with 8.1.beta0)\n\nThe segfault is definitely the \"correct\" failure, but for some reason it seems Python is attempting to handle the error. *shrugs*",
    "created_at": "2017-08-09T14:02:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23166#issuecomment-323659",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:27 jdemeyer]:
> Replying to [ticket:23403 tscrim]:
> > {{{
> > sage: X = SchubertPolynomialRing(ZZ)
> > sage: a = X([3,2,4,1])
> > sage: a.divided_difference(2)
> > python: : Unknown error -315708632
> > }}}
> 
> Is that the exact (verbatim) output that you get?

Yes (other than the number that changes every time).

> On which system is that?

Ubuntu 16.04 LTS (with 8.1.beta0)

The segfault is definitely the "correct" failure, but for some reason it seems Python is attempting to handle the error. *shrugs*



---

archive/issue_comments_323660.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-01T19:32:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23166#issuecomment-323660",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_323661.json:
```json
{
    "body": "Darij looked at this patch with me and gave a positive review.",
    "created_at": "2017-09-01T19:36:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23166#issuecomment-323661",
    "user": "https://github.com/tscrim"
}
```

Darij looked at this patch with me and gave a positive review.



---

archive/issue_comments_323662.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-09-01T19:36:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23166#issuecomment-323662",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_323663.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-09-04T06:11:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23166#issuecomment-323663",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
