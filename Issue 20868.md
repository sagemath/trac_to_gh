# Issue 20868: abs for number field element

archive/issues_020868.json:
```json
{
    "body": "CC:  @mkoeppe\n\nFor a number field element `a`, `abs(a)` currently returns a floating point real number\n\n```\nsage: K.<cbrt2> = NumberField(x^3 - 2, 'a', embedding=1.26)\nsage: abs(cbrt2)\n1.25992104989487\nsage: parent(_)\nReal Field with 53 bits of precision\n```\n\nIf a coercion embedding is defined with value in `RR`, the absolute value can be defined internally as it is the case for `AA`\n\n```\nsage: abs(AA(2).sqrt() - AA(2))\n0.5857864376269049?\n```\n\nWe propose to change the behavior for embedded number fields. Namely make `abs` an internal operation.\n\nAs a (minor) consequence of the current behavior, the inequalities from `sage.geometry.polyhedron.representation.Inequality` gets badly displayed\n\n```\nsage: K.<cbrt2> = NumberField(x^3 - 2, 'a', embedding=1.26)\nsage: P = Polyhedron(vertices=[(1,1,cbrt2),(cbrt2,1,1)])\nsage: P.inequalities()\n(An inequality (-cbrt2^2 - cbrt2 - 1, 0, 0) x + 4.84732210186307 >= 0,\n An inequality (cbrt2^2 + cbrt2 + 1, 0, 0) x - 3.84732210186307 >= 0)\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/21105\n\n",
    "created_at": "2016-07-27T14:11:10Z",
    "labels": [
        "component: number fields"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.4",
    "title": "abs for number field element",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20868",
    "user": "https://github.com/videlec"
}
```
CC:  @mkoeppe

For a number field element `a`, `abs(a)` currently returns a floating point real number

```
sage: K.<cbrt2> = NumberField(x^3 - 2, 'a', embedding=1.26)
sage: abs(cbrt2)
1.25992104989487
sage: parent(_)
Real Field with 53 bits of precision
```

If a coercion embedding is defined with value in `RR`, the absolute value can be defined internally as it is the case for `AA`

```
sage: abs(AA(2).sqrt() - AA(2))
0.5857864376269049?
```

We propose to change the behavior for embedded number fields. Namely make `abs` an internal operation.

As a (minor) consequence of the current behavior, the inequalities from `sage.geometry.polyhedron.representation.Inequality` gets badly displayed

```
sage: K.<cbrt2> = NumberField(x^3 - 2, 'a', embedding=1.26)
sage: P = Polyhedron(vertices=[(1,1,cbrt2),(cbrt2,1,1)])
sage: P.inequalities()
(An inequality (-cbrt2^2 - cbrt2 - 1, 0, 0) x + 4.84732210186307 >= 0,
 An inequality (cbrt2^2 + cbrt2 + 1, 0, 0) x - 3.84732210186307 >= 0)
```


Issue created by migration from https://trac.sagemath.org/ticket/21105





---

archive/issue_comments_288172.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-03T22:08:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20868#issuecomment-288172",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_288173.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-08-03T22:10:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20868#issuecomment-288173",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_288174.json:
```json
{
    "body": "It is weird to have `abs(a)` and `a.abs()` behaving differently, don't you think?",
    "created_at": "2016-08-03T22:13:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20868#issuecomment-288174",
    "user": "https://github.com/videlec"
}
```

It is weird to have `abs(a)` and `a.abs()` behaving differently, don't you think?



---

archive/issue_comments_288175.json:
```json
{
    "body": "OK, I'll change `a.abs()` too.",
    "created_at": "2016-08-03T22:21:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20868#issuecomment-288175",
    "user": "https://github.com/mkoeppe"
}
```

OK, I'll change `a.abs()` too.



---

archive/issue_comments_288176.json:
```json
{
    "body": "By the way, should perhaps the print representation of a number field indicate whether it's embedded or not?",
    "created_at": "2016-08-03T22:27:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20868#issuecomment-288176",
    "user": "https://github.com/mkoeppe"
}
```

By the way, should perhaps the print representation of a number field indicate whether it's embedded or not?



---

archive/issue_comments_288177.json:
```json
{
    "body": "That's indeed an issue. But it is hard to solve since you are interested at the same time in both the algebraic expression and the embedded value.\n\nMore generally, instead of having if/else in many methods I think that a better solution would be to have a dedicated class for real embedded element (whose semantic would be to follow standard method of real numbers, possibly having methods like `.cos()`, `.exp()` and such). But that is another question that will not be solved by the ticket.",
    "created_at": "2016-08-03T22:36:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20868#issuecomment-288177",
    "user": "https://github.com/videlec"
}
```

That's indeed an issue. But it is hard to solve since you are interested at the same time in both the algebraic expression and the embedded value.

More generally, instead of having if/else in many methods I think that a better solution would be to have a dedicated class for real embedded element (whose semantic would be to follow standard method of real numbers, possibly having methods like `.cos()`, `.exp()` and such). But that is another question that will not be solved by the ticket.



---

archive/issue_comments_288178.json:
```json
{
    "body": "Replying to [comment:8 vdelecroix]:\n> That's indeed an issue. But it is hard to solve since you are interested at the same time in both the algebraic expression and the embedded value.\n\nTrue, but I meant the print representation of the field itself (the parent), not an element.",
    "created_at": "2016-08-03T22:42:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20868#issuecomment-288178",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:8 vdelecroix]:
> That's indeed an issue. But it is hard to solve since you are interested at the same time in both the algebraic expression and the embedded value.

True, but I meant the print representation of the field itself (the parent), not an element.



---

archive/issue_comments_288179.json:
```json
{
    "body": "Replying to [comment:9 mkoeppe]:\n> Replying to [comment:8 vdelecroix]:\n> > That's indeed an issue. But it is hard to solve since you are interested at the same time in both the algebraic expression and the embedded value.\n> \n> True, but I meant the print representation of the field itself (the parent), not an element.\n\n+1. Put me in cc if you open a ticket.",
    "created_at": "2016-08-03T22:44:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20868#issuecomment-288179",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:9 mkoeppe]:
> Replying to [comment:8 vdelecroix]:
> > That's indeed an issue. But it is hard to solve since you are interested at the same time in both the algebraic expression and the embedded value.
> 
> True, but I meant the print representation of the field itself (the parent), not an element.

+1. Put me in cc if you open a ticket.



---

archive/issue_comments_288180.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-03T22:59:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20868#issuecomment-288180",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_288181.json:
```json
{
    "body": "Replying to [comment:10 vdelecroix]:\n> Replying to [comment:9 mkoeppe]:\n> > Replying to [comment:8 vdelecroix]:\n> > > That's indeed an issue. But it is hard to solve since you are interested at the same time in both the algebraic expression and the embedded value.\n> > \n> > True, but I meant the print representation of the field itself (the parent), not an element.\n> \n> +1. Put me in cc if you open a ticket.\n\nSee #21161.",
    "created_at": "2016-08-03T23:13:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20868#issuecomment-288181",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:10 vdelecroix]:
> Replying to [comment:9 mkoeppe]:
> > Replying to [comment:8 vdelecroix]:
> > > That's indeed an issue. But it is hard to solve since you are interested at the same time in both the algebraic expression and the embedded value.
> > 
> > True, but I meant the print representation of the field itself (the parent), not an element.
> 
> +1. Put me in cc if you open a ticket.

See #21161.



---

archive/issue_comments_288182.json:
```json
{
    "body": "Replying to [comment:6 mkoeppe]:\n> OK, I'll change `a.abs()` too.\nDone.",
    "created_at": "2016-08-03T23:14:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20868#issuecomment-288182",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:6 mkoeppe]:
> OK, I'll change `a.abs()` too.
Done.



---

archive/issue_comments_288183.json:
```json
{
    "body": "This is missing indentation\n\n```\nCheck that for fields with real coercion embeddings, absolute\nvalues are in the same field (:trac:`21105`)::\n\nsage: x = polygen(ZZ)      <---- test should be indented\n```\n",
    "created_at": "2016-08-03T23:22:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20868#issuecomment-288183",
    "user": "https://github.com/videlec"
}
```

This is missing indentation

```
Check that for fields with real coercion embeddings, absolute
values are in the same field (:trac:`21105`)::

sage: x = polygen(ZZ)      <---- test should be indented
```




---

archive/issue_comments_288184.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-03T23:26:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20868#issuecomment-288184",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_288185.json:
```json
{
    "body": "After\n\n```\n            sage: x = polygen(ZZ)\n            sage: f = x^3 - x - 1\n            sage: K.<b> = NumberField(f, embedding=1.3)\n            sage: b.abs()\n            b\n```\n\n  you should also test the output with arguments (both `i` and `prec`).",
    "created_at": "2016-08-05T17:38:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20868#issuecomment-288185",
    "user": "https://github.com/videlec"
}
```

After

```
            sage: x = polygen(ZZ)
            sage: f = x^3 - x - 1
            sage: K.<b> = NumberField(f, embedding=1.3)
            sage: b.abs()
            b
```

  you should also test the output with arguments (both `i` and `prec`).



---

archive/issue_comments_288186.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-05T18:12:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20868#issuecomment-288186",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_288187.json:
```json
{
    "body": "Replying to [comment:17 vdelecroix]:\n>  you should also test the output with arguments (both `i` and `prec`).\n\nDone. \nI've also changed what happens when `prec` is provided. I think it makes more sense now.",
    "created_at": "2016-08-05T18:13:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20868#issuecomment-288187",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:17 vdelecroix]:
>  you should also test the output with arguments (both `i` and `prec`).

Done. 
I've also changed what happens when `prec` is provided. I think it makes more sense now.



---

archive/issue_comments_288188.json:
```json
{
    "body": "If `prec=None` and there is no real embedded, I would actually return an element of `AA` (the real algebraic field). But it becomes beyond the scope of the ticket... (and breaks even more the previous behavior).",
    "created_at": "2016-08-05T20:50:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20868#issuecomment-288188",
    "user": "https://github.com/videlec"
}
```

If `prec=None` and there is no real embedded, I would actually return an element of `AA` (the real algebraic field). But it becomes beyond the scope of the ticket... (and breaks even more the previous behavior).



---

archive/issue_comments_288189.json:
```json
{
    "body": "Yes, I guess that would make sense; but I agree it's too much for this ticket.\n\nBy the way, why does it use complex fields instead of real fields for the result?",
    "created_at": "2016-08-05T21:22:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20868#issuecomment-288189",
    "user": "https://github.com/mkoeppe"
}
```

Yes, I guess that would make sense; but I agree it's too much for this ticket.

By the way, why does it use complex fields instead of real fields for the result?



---

archive/issue_comments_288190.json:
```json
{
    "body": "It does not: the method uses complex field for the embedding. But the result of `.abs()` on a complex number is real\n\n```\nsage: CC(0,1).abs().parent()\nReal Field with 53 bits of precision\n```\n",
    "created_at": "2016-08-05T21:25:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20868#issuecomment-288190",
    "user": "https://github.com/videlec"
}
```

It does not: the method uses complex field for the embedding. But the result of `.abs()` on a complex number is real

```
sage: CC(0,1).abs().parent()
Real Field with 53 bits of precision
```




---

archive/issue_comments_288191.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-05T21:32:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20868#issuecomment-288191",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_288192.json:
```json
{
    "body": "Replying to [comment:22 vdelecroix]:\n> It does not: the method uses complex field for the embedding. But the result of `.abs()` on a complex number is real\n\nAh, thanks. I've reworded the docstring to clarify.",
    "created_at": "2016-08-05T21:34:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20868#issuecomment-288192",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:22 vdelecroix]:
> It does not: the method uses complex field for the embedding. But the result of `.abs()` on a complex number is real

Ah, thanks. I've reworded the docstring to clarify.



---

archive/issue_comments_288193.json:
```json
{
    "body": "I don't understand this sentence from the doc of `abs`\n\n```\nIf ``prec`` is ``None`` or 53, then the complex double field is\nused; otherwise the arbitrary precision (but slow) complex\nfield is used.  The result is in the corresponding real field.\n```\n\nThe \"complex double field\" refers to I guess \"CDF\" but which is actually not used! I would rather remove that sentence and explain that the default precision is `53`.",
    "created_at": "2016-08-05T22:09:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20868#issuecomment-288193",
    "user": "https://github.com/videlec"
}
```

I don't understand this sentence from the doc of `abs`

```
If ``prec`` is ``None`` or 53, then the complex double field is
used; otherwise the arbitrary precision (but slow) complex
field is used.  The result is in the corresponding real field.
```

The "complex double field" refers to I guess "CDF" but which is actually not used! I would rather remove that sentence and explain that the default precision is `53`.



---

archive/issue_comments_288194.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-05T22:22:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20868#issuecomment-288194",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_288195.json:
```json
{
    "body": "Replying to [comment:25 vdelecroix]:\n> I don't understand this sentence from the doc of `abs`\n> {{{\n> If ``prec`` is ``None`` or 53, then the complex double field is\n> used; otherwise the arbitrary precision (but slow) complex\n> field is used.  The result is in the corresponding real field.\n> }}}\n> The \"complex double field\" refers to I guess \"CDF\" but which is actually not used! I would rather remove that sentence and explain that the default precision is `53`.\nThanks for catching this.",
    "created_at": "2016-08-05T22:23:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20868#issuecomment-288195",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:25 vdelecroix]:
> I don't understand this sentence from the doc of `abs`
> {{{
> If ``prec`` is ``None`` or 53, then the complex double field is
> used; otherwise the arbitrary precision (but slow) complex
> field is used.  The result is in the corresponding real field.
> }}}
> The "complex double field" refers to I guess "CDF" but which is actually not used! I would rather remove that sentence and explain that the default precision is `53`.
Thanks for catching this.



---

archive/issue_comments_288196.json:
```json
{
    "body": "Thanks for the fix!",
    "created_at": "2016-08-05T22:28:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20868#issuecomment-288196",
    "user": "https://github.com/videlec"
}
```

Thanks for the fix!



---

archive/issue_comments_288197.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-08-05T22:28:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20868#issuecomment-288197",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_288198.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-08-07T20:01:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20868#issuecomment-288198",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_019793.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2016-08-07T20:01:07Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/20868",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20868#event-19793"
}
```
