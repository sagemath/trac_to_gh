# Issue 24505: New MatrixInput object to deal with constructing matrices

archive/issues_024505.json:
```json
{
    "body": "CC:  @tscrim @videlec @embray\n\nConstructing matrices is a mess currently. There is a lot of code duplication between\n\n1. The global `matrix()` constructor\n\n2. `MatrixSpace.__call__`\n\n3. The various `Matrix.__init__` methods\n\nSince a lot of parameters are involved (matrix size, entries, ring, sparseness, implementation), I decided to create a new class just for dealing with inputting matrices.\n\nRelated: #20211, #19134\n\nIssue created by migration from https://trac.sagemath.org/ticket/24742\n\n",
    "created_at": "2018-02-15T15:17:26Z",
    "labels": [
        "component: linear algebra"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "New MatrixInput object to deal with constructing matrices",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24505",
    "user": "https://github.com/jdemeyer"
}
```
CC:  @tscrim @videlec @embray

Constructing matrices is a mess currently. There is a lot of code duplication between

1. The global `matrix()` constructor

2. `MatrixSpace.__call__`

3. The various `Matrix.__init__` methods

Since a lot of parameters are involved (matrix size, entries, ring, sparseness, implementation), I decided to create a new class just for dealing with inputting matrices.

Related: #20211, #19134

Issue created by migration from https://trac.sagemath.org/ticket/24742





---

archive/issue_comments_343457.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-16T18:08:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343457",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_343458.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-17T11:33:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343458",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_343459.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-19T14:13:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343459",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_343460.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-20T13:39:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343460",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_343461.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-20T16:28:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343461",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_343462.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-21T15:31:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343462",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_343463.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-21T16:17:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343463",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_343464.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-21T16:19:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343464",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_343465.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-22T08:47:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343465",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_343466.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-22T11:06:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343466",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_343467.json:
```json
{
    "body": "Haven't ready it 100% yet but I get the idea.  Definitely looks like an improvement.",
    "created_at": "2018-02-22T15:08:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343467",
    "user": "https://github.com/embray"
}
```

Haven't ready it 100% yet but I get the idea.  Definitely looks like an improvement.



---

archive/issue_comments_343468.json:
```json
{
    "body": "One very minor comment:\n\n```\n+    def __repr__(self):\n+        \"\"\"\n+        Print representation for debugging\n+        \"\"\"\n+        t = \"???\"\n```\n\nI know this is mainly just for debugging, but I think instead of \"???\" as the default something more explicit like \"<unfinalized>\" or \"<invalid>\" would be clearer.",
    "created_at": "2018-02-22T15:10:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343468",
    "user": "https://github.com/embray"
}
```

One very minor comment:

```
+    def __repr__(self):
+        """
+        Print representation for debugging
+        """
+        t = "???"
```

I know this is mainly just for debugging, but I think instead of "???" as the default something more explicit like "<unfinalized>" or "<invalid>" would be clearer.



---

archive/issue_comments_343469.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-22T15:51:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343469",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_343470.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-23T14:30:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343470",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_343471.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-23T14:42:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343471",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_343472.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-23T16:11:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343472",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_343473.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-23T21:50:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343473",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_343474.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-26T16:42:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343474",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_343475.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-27T06:34:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343475",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_343476.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-27T15:56:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343476",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_343477.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-27T16:25:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343477",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_343478.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-27T21:08:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343478",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_343479.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-28T10:18:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343479",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_343480.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-28T11:47:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343480",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_343481.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-28T16:31:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343481",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_343482.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-28T19:37:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343482",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_343483.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-03-01T14:21:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343483",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_343484.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-03-01T16:19:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343484",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_343485.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-03-01T16:22:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343485",
    "user": "https://github.com/jdemeyer"
}
```

New commits:



---

archive/issue_comments_343486.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-03-01T19:07:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343486",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_343487.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-03-01T19:13:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343487",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_343488.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-03-02T11:43:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343488",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_343489.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-03-02T15:47:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343489",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_343490.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-03-02T16:11:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343490",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_343491.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-03-03T08:56:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343491",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_343492.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-03-06T10:13:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343492",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_343493.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-03-11T08:28:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343493",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_343494.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-03-11T08:28:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343494",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_343495.json:
```json
{
    "body": "Very nice work! Though I honestly don't understand the new code in detail, it looks reasonable and I trust the tests more than my own judgment to check that it does the right thing. Even if there are small issues, I think it can only be an improvement compared to what we had before.\n\nI have one significant concern with this ticket though: several simple cases of `matrix(...)` apparently became a lot slower. Compare in particular:\n\nSage 8.1:\n\n```\nsage: %timeit matrix(ZZ,3,3)[0,0] = 1 # used to be a fast way to construct a new mutable matrix\nThe slowest run took 62.41 times longer than the fastest. This could mean that an intermediate result is being cached.\n100000 loops, best of 3: 7 \u00b5s per loop\nsage: c = vector(ZZ, [1,2,3])\nsage: %timeit matrix([c])\nThe slowest run took 4.77 times longer than the fastest. This could mean that an intermediate result is being cached.\n10000 loops, best of 3: 33.7 \u00b5s per loop\n```\nThis ticket:\n\n```\nsage: %timeit matrix(ZZ,3,3)[0,0] = 1\n10000 loops, best of 3: 110 \u00b5s per loop\nsage: c = vector(ZZ, [1,2,3])\nsage: %timeit matrix([c])\n10000 loops, best of 3: 101 \u00b5s per loop\n```\n\nSome nitpicking while I'm at it: it is perhaps not ideal that\n\n```\nsage: matrix(1,1,[[1,2]])\nValueError: inconsistent number of columns: should be 1 but got 2\n```\nand\n\n```\nsage: matrix(ZZ,1,1,[[1,2]])\nValueError: sequence too long (expected length 1, got more)\n```\nyield different errors.",
    "created_at": "2018-03-11T15:00:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343495",
    "user": "https://github.com/mezzarobba"
}
```

Very nice work! Though I honestly don't understand the new code in detail, it looks reasonable and I trust the tests more than my own judgment to check that it does the right thing. Even if there are small issues, I think it can only be an improvement compared to what we had before.

I have one significant concern with this ticket though: several simple cases of `matrix(...)` apparently became a lot slower. Compare in particular:

Sage 8.1:

```
sage: %timeit matrix(ZZ,3,3)[0,0] = 1 # used to be a fast way to construct a new mutable matrix
The slowest run took 62.41 times longer than the fastest. This could mean that an intermediate result is being cached.
100000 loops, best of 3: 7 µs per loop
sage: c = vector(ZZ, [1,2,3])
sage: %timeit matrix([c])
The slowest run took 4.77 times longer than the fastest. This could mean that an intermediate result is being cached.
10000 loops, best of 3: 33.7 µs per loop
```
This ticket:

```
sage: %timeit matrix(ZZ,3,3)[0,0] = 1
10000 loops, best of 3: 110 µs per loop
sage: c = vector(ZZ, [1,2,3])
sage: %timeit matrix([c])
10000 loops, best of 3: 101 µs per loop
```

Some nitpicking while I'm at it: it is perhaps not ideal that

```
sage: matrix(1,1,[[1,2]])
ValueError: inconsistent number of columns: should be 1 but got 2
```
and

```
sage: matrix(ZZ,1,1,[[1,2]])
ValueError: sequence too long (expected length 1, got more)
```
yield different errors.



---

archive/issue_comments_343496.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-03-12T00:20:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343496",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_343497.json:
```json
{
    "body": "There is something very strange going on with the timings:\n\nWith this ticket, constructing a matrix and storing it is an order of magnitude faster than constructing a matrix and *not* storing it:\n\n```\nsage: timeit('matrix(3, 3)', repeat=5, number=10000)\n10000 loops, best of 5: 117 \u00b5s per loop\nsage: timeit('a=matrix(3, 3)', repeat=5, number=10000)\n10000 loops, best of 5: 10.7 \u00b5s per loop\n```\nIt doesn't matter if the storing happens inside the `timeit()` or not:\n\n```\nsage: M = matrix(3,3)\nsage: timeit('matrix(3, 3)', repeat=5, number=10000)\n10000 loops, best of 5: 10.5 \u00b5s per loop\nsage: del M\nsage: timeit('matrix(3, 3)', repeat=5, number=10000)\n10000 loops, best of 5: 115 \u00b5s per loop\n```\nThere must be some caching issue here...\n\nThe current behaviour (without #24742) does not have this.",
    "created_at": "2018-03-12T00:20:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343497",
    "user": "https://github.com/jdemeyer"
}
```

There is something very strange going on with the timings:

With this ticket, constructing a matrix and storing it is an order of magnitude faster than constructing a matrix and *not* storing it:

```
sage: timeit('matrix(3, 3)', repeat=5, number=10000)
10000 loops, best of 5: 117 µs per loop
sage: timeit('a=matrix(3, 3)', repeat=5, number=10000)
10000 loops, best of 5: 10.7 µs per loop
```
It doesn't matter if the storing happens inside the `timeit()` or not:

```
sage: M = matrix(3,3)
sage: timeit('matrix(3, 3)', repeat=5, number=10000)
10000 loops, best of 5: 10.5 µs per loop
sage: del M
sage: timeit('matrix(3, 3)', repeat=5, number=10000)
10000 loops, best of 5: 115 µs per loop
```
There must be some caching issue here...

The current behaviour (without #24742) does not have this.



---

archive/issue_comments_343498.json:
```json
{
    "body": "When a previous matrix is \"cached\", the timings with this ticket are actually better than before.\n\n**Before** (8.2.beta8):\n\n```\nsage: M = matrix(ZZ,3,3)\nsage: timeit('matrix(ZZ,3,3)', repeat=5, number=10000)\n10000 loops, best of 5: 13.2 \u00b5s per loop\n```\n\n```\nsage: c = vector(ZZ, [1,2,3]); matrix([c])\n[1 2 3]\nsage: timeit('matrix([c])', repeat=5, number=10000)\n10000 loops, best of 5: 46.3 \u00b5s per loop\n```\n\n**After** (#24742):\n\n```\nsage: M = matrix(ZZ,3,3)\nsage: timeit('matrix(ZZ,3,3)', repeat=5, number=10000)\n10000 loops, best of 5: 10.7 \u00b5s per loop\n```\n\n```\nsage: c = vector(ZZ, [1,2,3]); matrix([c])\n[1 2 3]\nsage: timeit('matrix([c])', repeat=5, number=10000)\n10000 loops, best of 5: 14.5 \u00b5s per loop\n```",
    "created_at": "2018-03-12T00:29:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343498",
    "user": "https://github.com/jdemeyer"
}
```

When a previous matrix is "cached", the timings with this ticket are actually better than before.

**Before** (8.2.beta8):

```
sage: M = matrix(ZZ,3,3)
sage: timeit('matrix(ZZ,3,3)', repeat=5, number=10000)
10000 loops, best of 5: 13.2 µs per loop
```

```
sage: c = vector(ZZ, [1,2,3]); matrix([c])
[1 2 3]
sage: timeit('matrix([c])', repeat=5, number=10000)
10000 loops, best of 5: 46.3 µs per loop
```

**After** (#24742):

```
sage: M = matrix(ZZ,3,3)
sage: timeit('matrix(ZZ,3,3)', repeat=5, number=10000)
10000 loops, best of 5: 10.7 µs per loop
```

```
sage: c = vector(ZZ, [1,2,3]); matrix([c])
[1 2 3]
sage: timeit('matrix([c])', repeat=5, number=10000)
10000 loops, best of 5: 14.5 µs per loop
```



---

archive/issue_comments_343499.json:
```json
{
    "body": "The slowdown within `timeit()` is tracked at #24954.",
    "created_at": "2018-03-13T16:39:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343499",
    "user": "https://github.com/jdemeyer"
}
```

The slowdown within `timeit()` is tracked at #24954.



---

archive/issue_comments_343500.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-03-15T10:08:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343500",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_343501.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-03-15T10:10:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343501",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_343502.json:
```json
{
    "body": "Replying to [comment:55 mmezzarobba]:\n> Some nitpicking while I'm at it: it is perhaps not ideal that\n> \n> ```\n> sage: matrix(1,1,[[1,2]])\n> ValueError: inconsistent number of columns: should be 1 but got 2\n> ```\n> and\n> \n> ```\n> sage: matrix(ZZ,1,1,[[1,2]])\n> ValueError: sequence too long (expected length 1, got more)\n> ```\n> yield different errors.\n\n\nNot ideal, but it's not clear what the best solution is. The problem is that I'm using different code paths for the case where everything (base ring + matrix dimensions) is known and for when it's not known. In order to determine the base ring, I have to iterate over the entries anyway. It's there that the error \"inconsistent number of columns\" is raised.",
    "created_at": "2018-03-15T10:13:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343502",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:55 mmezzarobba]:
> Some nitpicking while I'm at it: it is perhaps not ideal that
> 
> ```
> sage: matrix(1,1,[[1,2]])
> ValueError: inconsistent number of columns: should be 1 but got 2
> ```
> and
> 
> ```
> sage: matrix(ZZ,1,1,[[1,2]])
> ValueError: sequence too long (expected length 1, got more)
> ```
> yield different errors.


Not ideal, but it's not clear what the best solution is. The problem is that I'm using different code paths for the case where everything (base ring + matrix dimensions) is known and for when it's not known. In order to determine the base ring, I have to iterate over the entries anyway. It's there that the error "inconsistent number of columns" is raised.



---

archive/issue_comments_343503.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-03-23T13:38:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343503",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_343504.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. New commits:",
    "created_at": "2018-03-29T13:13:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343504",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. New commits:



---

archive/issue_comments_343505.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2018-03-29T13:13:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343505",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_343506.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-03-29T13:13:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343506",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_343507.json:
```json
{
    "body": "Trivially rebased.",
    "created_at": "2018-03-29T13:13:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343507",
    "user": "https://github.com/jdemeyer"
}
```

Trivially rebased.



---

archive/issue_comments_343508.json:
```json
{
    "body": "Failures in src/sage/schemes/riemann_surfaces/riemann_surface.py, possibly due to 24370",
    "created_at": "2018-05-07T17:19:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343508",
    "user": "https://github.com/vbraun"
}
```

Failures in src/sage/schemes/riemann_surfaces/riemann_surface.py, possibly due to 24370



---

archive/issue_comments_343509.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-05-07T17:19:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343509",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_343510.json:
```json
{
    "body": "Replying to [comment:67 vbraun]:\n> Failures in src/sage/schemes/riemann_surfaces/riemann_surface.py, possibly due to 24370\n\n\nIf #24370 and #24742 conflict, can we instead set #24370 to needs_work?",
    "created_at": "2018-05-07T17:57:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343510",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:67 vbraun]:
> Failures in src/sage/schemes/riemann_surfaces/riemann_surface.py, possibly due to 24370


If #24370 and #24742 conflict, can we instead set #24370 to needs_work?



---

archive/issue_comments_343511.json:
```json
{
    "body": "I think that #24370 is the ticket that deserved to be set to needs_work, but I'll hear from you if you disagree.",
    "created_at": "2018-05-07T18:05:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343511",
    "user": "https://github.com/jdemeyer"
}
```

I think that #24370 is the ticket that deserved to be set to needs_work, but I'll hear from you if you disagree.



---

archive/issue_comments_343512.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2018-05-07T18:05:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343512",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_343513.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-05-07T19:41:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343513",
    "user": "https://github.com/nbruin"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_343514.json:
```json
{
    "body": "Apparently a conflict with #24370. These tickets just need to be calibrated. The fix is clear either way.",
    "created_at": "2018-05-07T19:41:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343514",
    "user": "https://github.com/nbruin"
}
```

Apparently a conflict with #24370. These tickets just need to be calibrated. The fix is clear either way.



---

archive/issue_comments_343515.json:
```json
{
    "body": "With the updated version of #24370, everything works fine! So *both* tickets can get positive review.",
    "created_at": "2018-05-07T21:55:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343515",
    "user": "https://github.com/jdemeyer"
}
```

With the updated version of #24370, everything works fine! So *both* tickets can get positive review.



---

archive/issue_comments_343516.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2018-05-07T21:56:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343516",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_343517.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-05-09T09:49:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24505#issuecomment-343517",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_062241.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-05-09T09:49:54Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24505",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24505#event-62241"
}
```
