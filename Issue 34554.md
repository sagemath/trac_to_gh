# Issue 34554: move ProductTree and prod_with_derivative to sage.arith.misc

Issue created by migration from https://trac.sagemath.org/ticket/34791

Original creator: lorenz

Original creation time: 2022-11-25 15:31:43

CC:  jhpalmieri

The class `ProductTree` and the function `prod_with_derivative()` were introduced in #34303. Both are fully generic in principle, but they were included in `hom_velusqrt.py` in the heat of the moment.

We should move them to a more suitable place; it seems `sage.arith.misc` is an appropriate choice. While we're at it, slight tweaks to `ProductTree`, and I believe importing it by default is a good idea to increase visibility and ease of use.


---

Comment by lorenz created at 2022-11-25 18:21:09

Changing status from new to needs_review.


---

Comment by mmezzarobba created at 2022-12-07 17:32:18

I think `ProductTree` could even go to its own file, since it may well be extended or ported to cython. Also, most of `misc.py` has a more number-theoretic flavor. (But that's just a suggestion and I'm fine with `misc.py` too.)


---

Comment by lorenz created at 2022-12-08 01:17:27

Currently `sage.misc.misc_c` contains the highly related `prod()` function. I think this could also be in a location such as `sage.rings.generic` (which doesn't currently exist), similar to how `sage.groups.generic` contains generic-group algorithms. Personally I don't have a preference.


---

Comment by klee created at 2022-12-10 08:56:24

> I believe importing it by default is a good idea to increase visibility and ease of use.

-1. I don't think it has so general use. But I would hear John.


---

Comment by jhpalmieri created at 2022-12-10 18:17:25

First, especially if there might be expansions to `ProductTree`, it might very well make sense to put it in its own file. Second, regarding increased visibility, I would say no right now. For example I look at the documentation and I can't tell what it does. (There is one line of description, "A simple product tree," there is one line saying what the inputs are, and that's pretty much the extent of the documentation. I think it should have much more.) You should make sure it's in the reference manual, and if you think it's particularly useful, write a thematic tutorial about it and add that to the documentation — that's a good way to increase visibility.


---

Comment by git created at 2022-12-11 06:40:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by klee created at 2022-12-17 05:36:42

Replying to [comment:5 John Palmieri]:
> For example I look at the documentation and I can't tell what it does. (There is one line of description, "A simple product tree," there is one line saying what the inputs are, and that's pretty much the extent of the documentation. I think it should have much more.) 

+1. In the `ProductTree` class docstring, there is no description about a product tree. It may be described in terms of leaves, layers, and the root in a couple of sentences.

Instead of `a sequence of` (which sounds mathematical), `a list of` would be pythonic, and avoid an unnecessary confusion.

The `ALGORITHM` section of `prod_with_derivative` just describes the source code. Thus it is too much detailed but useless for a user. I suggest to remove it.

The paragraph `The main reason for this function ...` may be moved up and replace the aforementioned `ALGORITHM` section.


---

Comment by lorenz created at 2022-12-18 04:01:55

Thanks for the feedback, everyone. I'll work on the documentation.

Replying to [comment:7 Kwankyu Lee]:
> Instead of `a sequence of` (which sounds mathematical), `a list of` would be pythonic, and avoid an unnecessary confusion.

But in Python "a list" is much more specific than "a sequence"! For example, a tuple is a sequence but not a list. Indeed, the Python documentation does have a concept of "sequence": https://docs.python.org/3/library/stdtypes.html#sequence-types-list-tuple-range

> The paragraph `The main reason for this function ...` may be moved up and replace the aforementioned `ALGORITHM` section.

Are you suggesting to move it outside of the`EXAMPLES` block? Or just swap the two examples?


---

Comment by lorenz created at 2022-12-18 04:01:55

Changing status from needs_review to needs_work.


---

Comment by klee created at 2022-12-18 05:47:04

Replying to [comment:8 Lorenz Panny]:
> Thanks for the feedback, everyone. I'll work on the documentation.
> 
> Replying to [comment:7 Kwankyu Lee]:
> > Instead of `a sequence of` (which sounds mathematical), `a list of` would be pythonic, and avoid an unnecessary confusion.
> 
> But in Python "a list" is much more specific than "a sequence"! For example, a tuple is a sequence but not a list. Indeed, the Python documentation does have a concept of "sequence": https://docs.python.org/3/library/stdtypes.html#sequence-types-list-tuple-range

Strictly speaking, you are right. But it is usual to say "a tuple of" or "a list of" when an input of any sequence type is allowed. I think it is rather unusual to say "a sequence of" for an input of a sequence type (it makes one to think twice).

Again this is not a rule, but a suggestion of a style for uniformity.

> > The paragraph `The main reason for this function ...` may be moved up and replace the aforementioned `ALGORITHM` section.
> 
> Are you suggesting to move it outside of the`EXAMPLES` block? Or just swap the two examples?

To move it to the place of `ALGORITHM` (perhaps removing `alpha`). If you do not, please write a new paragraph to explain the purpose (or usage) of the function at the place of the removed `ALGORITHM`.


---

Comment by jhpalmieri created at 2022-12-18 07:17:12

Replying to [comment:9 Kwankyu Lee]:
> Replying to [comment:8 Lorenz Panny]:
> > Thanks for the feedback, everyone. I'll work on the documentation.
> > 
> > Replying to [comment:7 Kwankyu Lee]:
> > > Instead of `a sequence of` (which sounds mathematical), `a list of` would be pythonic, and avoid an unnecessary confusion.
> > 
> > But in Python "a list" is much more specific than "a sequence"! For example, a tuple is a sequence but not a list. Indeed, the Python documentation does have a concept of "sequence": https://docs.python.org/3/library/stdtypes.html#sequence-types-list-tuple-range
> 
> Strictly speaking, you are right. But it is usual to say "a tuple of" or "a list of" when an input of any sequence type is allowed. I think it is rather unusual to say "a sequence of" for an input of a sequence type (it makes one to think twice).
> 
> Again this is not a rule, but a suggestion of a style for uniformity.

I've seen "an iterable" used in documentation. That would be another option.


---

Comment by git created at 2022-12-18 14:55:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by lorenz created at 2022-12-18 15:00:57

Changing status from needs_work to needs_review.


---

Comment by lorenz created at 2022-12-18 15:00:57

Tweaked documentation according to your suggestions, and moved the code in question to a new file `sage.rings.generic`. Some other functions from `sage.arith.misc` should probably also end up there, but perhaps not in this ticket.

(I didn't remove the `ALGORITHM:` block entirely, only reduced detail, and I clarified the text in the main docstring that was already alluding to the example instead of moving the example. Hopefully that'll make everyone happy.)


---

Comment by klee created at 2022-12-19 04:38:24

Replying to [comment:13 Lorenz Panny]:
> ...Hopefully that'll make everyone happy.

Thanks. LGTM, though I am not completely happy with the overuse of `iterable` where common and simple `list` is enough. It's hard to make everyone happy :)

One last thing. Please insert spaces around `//` in

```diff
+            X = [X[i//2] % V[i] for i in range(len(V))]
```


You can set positive review for me. Thanks!


---

Comment by git created at 2022-12-19 06:37:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by lorenz created at 2022-12-19 06:46:48

Thank you!

(By the way, regarding the "list" vs. "iterable" question, writing `list` has the opposite effect on me. It's the one that makes _me_ think twice: Will passing a tuple or a generator work as well, and can I rely on it to keep working in the future? That's why I prefer specifying the correct technical requirement, even if such details are currently indeed rather non-uniform in the Sage codebase.)


---

Comment by lorenz created at 2022-12-19 06:46:48

Changing status from needs_review to positive_review.


---

Comment by klee created at 2022-12-19 06:55:11

Replying to [comment:17 Lorenz Panny]:
> ... writing `list` has the opposite effect on me. It's the one that makes _me_ think twice: Will passing a tuple or a generator work as well, and can I rely on it to keep working in the future? That's why I prefer specifying the correct technical requirement, even if such details are currently indeed rather non-uniform in the Sage codebase.)

That is a good reason. Okay!
