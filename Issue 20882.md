# Issue 20882: Fix numerical noise on Haswell (single doctest)

Issue created by migration from Trac.

Original creator: leif

Original creation time: 2016-07-28 19:06:27

Fixes numerical noise in a single doctest in `sage/matrix/matrix_double_dense.pyx` on Intel Haswell.

The doctest fails when doing a native build with any GCC version that
supports Haswell:

```
**********************************************************************
File "src/sage/matrix/matrix_double_dense.pyx", line 3761, in sage.matrix.matrix_double_dense.Matrix_double_dense.exp
Failed example:
    A.exp()  # tol 1e-14
Expected:
    [-19.614602953804912 + 12.517743846762578*I   3.7949636449582176 + 28.88379930658099*I]
    [ -32.383580980922254 + 21.88423595789845*I   2.269633004093535 + 44.901324827684824*I]
Got:
    [-19.614602953804923 + 12.517743846762574*I  3.7949636449582007 + 28.883799306580993*I]
    [-32.383580980922275 + 21.884235957898447*I  2.2696330040935115 + 44.901324827684846*I]
Tolerance exceeded in 1 of 8:
    2.269633004093535 vs 2.2696330040935115, tolerance 1e-14 > 1e-14
**********************************************************************
1 item had failures:
   1 of  11 in sage.matrix.matrix_double_dense.Matrix_double_dense.exp
    [636 tests, 1 failure, 3.14 s]
```


I've simply increased the tolerance from 1e-14 to 1.5e-14.


---

Comment by leif created at 2016-07-28 19:14:09

Changing status from new to needs_review.


---

Comment by leif created at 2016-07-28 19:14:09

Please... :P   (This bugging me since ... ages! ;-) )


---

Comment by git created at 2016-07-28 19:20:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by leif created at 2016-07-28 19:21:36

The `1e-14 > 1e-14` is weird anyway...


---

Comment by tscrim created at 2016-07-28 19:41:47

I can't test this, but the patch and reasoning is good with me.


---

Comment by tscrim created at 2016-07-28 19:41:47

Changing status from needs_review to positive_review.


---

Comment by leif created at 2016-07-28 19:43:21

Thanks!


---

Comment by leif created at 2016-07-28 20:29:36

Just figured out that `tol 1.05e-14` would also have worked, but specifying such tolerance is IMHO a bit ridiculous.

Follow-up regarding the `1e-14 > 1e-14`: #21121


---

Comment by leif created at 2016-08-11 16:03:33

Not merged into 7.3.rc0, nor 7.3, and not even 7.4.beta0 although it still applies clean and already had positive review a couple of hours before 7.3.rc0 got released... :-(


---

Comment by tscrim created at 2016-08-12 00:30:52

We might need to set this to a blocker.....


---

Comment by vbraun created at 2016-08-13 16:23:07

Numerical noise isn't a blocker, it'll be merged as soon as I get to it.


---

Comment by leif created at 2016-08-13 17:16:54

Replying to [comment:10 vbraun]:
> Numerical noise isn't a blocker, it'll be merged as soon as I get to it.

He certainly was just kidding.


---

Comment by tscrim created at 2016-08-13 23:40:28

Yes, it was hyperbole.


---

Comment by vbraun created at 2016-08-14 19:05:19

Resolution: fixed
