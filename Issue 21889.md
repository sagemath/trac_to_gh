# Issue 21889: SAGERUNTIME requires future

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2017-01-03 10:31:12

CC:  jhpalmieri




---

Comment by jdemeyer created at 2017-01-05 15:41:03

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2017-01-05 15:41:03

New commits:


---

Comment by chapoton created at 2017-03-17 18:57:36

and what about six ? currently, trying to build with SAGE_PYTHON3=yes fails on trying to import six...


---

Comment by git created at 2017-03-18 10:13:11

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2017-03-18 10:28:18

Rebase to 7.6.rc1 and updated (now also `pyparsing` is needed).

`six` is indirectly installed as dependency of IPython. It is not needed to explicitly add it as dependency of `SAGERUNTIME`.


---

Comment by chapoton created at 2017-03-18 10:31:31

ok. But I would appreciate if somebody could figure (elsewhere) why python3 build is currently broken on six import. This is beyond my meager abilities..


---

Comment by jdemeyer created at 2017-03-18 10:37:20

Replying to [comment:7 chapoton]:
> ok. But I would appreciate if somebody could figure (elsewhere) why python3 build is currently broken on six import. This is beyond my meager abilities..

I might have a look later...

Could it be that some package requires `six` in Python 3 but not in Python 2 (that would be surprising, but it would explain things).


---

Comment by jdemeyer created at 2017-03-18 14:25:36

Replying to [comment:7 chapoton]:
> ok. But I would appreciate if somebody could figure (elsewhere) why python3 build is currently broken on six import. This is beyond my meager abilities..

See #22638


---

Comment by jhpalmieri created at 2017-03-18 15:32:00

If we can lazily import simplicial sets instead of adding this runtime dependency, that would be fine with me.


---

Comment by jhpalmieri created at 2017-03-18 15:37:57

For example, can we just do

```diff
diff --git a/src/sage/homology/all.py b/src/sage/homology/all.py
index 511ad4d..f26eb8c 100644
--- a/src/sage/homology/all.py
+++ b/src/sage/homology/all.py
`@``@` -16,4 +16,4 `@``@` from .cubical_complex import CubicalComplex, cubical_complexes
 from sage.misc.lazy_import import lazy_import
 lazy_import('sage.homology.koszul_complex', 'KoszulComplex')
 
-from . import simplicial_set_catalog as simplicial_sets
+lazy_import('sage.homology', 'simplicial_set_catalog', _as='simplicial_sets')
```

?


---

Comment by jdemeyer created at 2017-03-21 09:07:56

Changing status from needs_review to needs_work.


---

Comment by git created at 2017-03-21 09:10:32

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2017-03-21 09:12:10

Replying to [comment:10 jhpalmieri]:
> If we can lazily import simplicial sets instead of adding this runtime dependency, that would be fine with me.

Done, please review.


---

Comment by jdemeyer created at 2017-03-21 09:12:10

Changing status from needs_work to needs_review.


---

Comment by jhpalmieri created at 2017-03-21 15:28:47

I get an unpickling failure:

```
sage -t --long --warn-long 74.2 src/sage/structure/sage_object.pyx
**********************************************************************
File "src/sage/structure/sage_object.pyx", line 1526, in sage.structure.sage_object.unpickle_all
Failed example:
    sage.structure.sage_object.unpickle_all()  # (4s on sage.math, 2011)
Expected:
    doctest:... DeprecationWarning: ...
    See http://trac.sagemath.org/... for details.
    Successfully unpickled ... objects.
    Failed to unpickle 0 objects.
Got:
    doctest:warning

[snip]

    Failed:
    _class__sage_homology_examples_SimplicialSurface__.sobj
    ----------------------------------------------------------------------
    ** This error is probably due to an old pickle failing to unpickle.
    ** See sage.structure.sage_object.register_unpickle_override for
    ** how to override the default unpickling methods for (old) pickles.
    ** NOTE: pickles should never be removed from the pickle_jar! 
    ----------------------------------------------------------------------
    Successfully unpickled 585 objects.
    Failed to unpickle 1 objects.
**********************************************************************
1 item had failures:
   1 of  11 in sage.structure.sage_object.unpickle_all
    [211 tests, 1 failure, 7.91 s]
----------------------------------------------------------------------
sage -t --long --warn-long 74.2 src/sage/structure/sage_object.pyx  # 1 doctest failed
----------------------------------------------------------------------
```

This is due to the change in importing the simplicial complex catalog, which I think is not necessary for this ticket.


---

Comment by git created at 2017-03-21 16:03:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2017-03-21 16:05:04

Replying to [comment:15 jhpalmieri]:
> This is due to the change in importing the simplicial complex catalog, which I think is not necessary for this ticket.

True, it is not needed. However, I did it by analogy with the other catalog. Anyway, the pickling problem is easily solved by moving the `unpickle_override` to the file `all.py` which is always imported.


---

Comment by jhpalmieri created at 2017-03-21 17:42:48

Looks good, thanks.


---

Comment by jhpalmieri created at 2017-03-21 17:42:48

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-03-27 20:43:03

Resolution: fixed
