# Issue 16926: Speed improvement for DiGraph.in_degree

archive/issues_016926.json:
```json
{
    "body": "CC:  @jm58660\n\nAs reported by Jori, the following is... unexpected:\n\n\n```\nsage: g = digraphs.RandomDirectedGNP(300,.2)\nsage: %timeit g.sinks() # vertices of outdegree 0\n1000 loops, best of 3: 376 \u00b5s per loop\nsage: %timeit g.sources() # vertices of indegree 0\n100 loops, best of 3: 7.78 ms per loop\n```\n\n\nWith this patch:\n\n```\nsage: g = digraphs.RandomDirectedGNP(300,.2)      \nsage: %timeit g.sinks() # vertices of outdegree 0 \n1000 loops, best of 3: 370 \u00b5s per loop\nsage: %timeit g.sources() # vertices of indegree 0\n1000 loops, best of 3: 361 \u00b5s per loop\n```\n\n\nCause:\n\nThis is because the function `in_degree` was not implemented at the data structure level, but \"abstractly\" by iterating over all incoming edges of a vertices and counting them. This is bad, especially since any sensible backends already stores that information.\n\nWhat the branch does:\n\n1) Add a `in_degree` function in the CGraph backend.\n\n2) Add a `in_degree` and `out_degree` (empty) function in the `GenericGraph` backend (the only point is to write somewhere that the `in_degree/out_degree` functions should be implemented by all graph backends\n\n3) Add a `in_degree/out_degree` function to the NetworkX backend. This backend is only used in one doctest, and this is the only backend that did not have this function.\n\n4) Because all backends now have the `in_degree/out_degree` functions, it is now useless to 'check if the backend has the function' before calling it. As a result the code of `DiGraph.in_degree/out_degree` is simplified.\n\nNathann\n\nIssue created by migration from https://trac.sagemath.org/ticket/17163\n\n",
    "created_at": "2014-10-16T06:03:08Z",
    "labels": [
        "component: graph theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Speed improvement for DiGraph.in_degree",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16926",
    "user": "https://github.com/nathanncohen"
}
```
CC:  @jm58660

As reported by Jori, the following is... unexpected:


```
sage: g = digraphs.RandomDirectedGNP(300,.2)
sage: %timeit g.sinks() # vertices of outdegree 0
1000 loops, best of 3: 376 µs per loop
sage: %timeit g.sources() # vertices of indegree 0
100 loops, best of 3: 7.78 ms per loop
```


With this patch:

```
sage: g = digraphs.RandomDirectedGNP(300,.2)      
sage: %timeit g.sinks() # vertices of outdegree 0 
1000 loops, best of 3: 370 µs per loop
sage: %timeit g.sources() # vertices of indegree 0
1000 loops, best of 3: 361 µs per loop
```


Cause:

This is because the function `in_degree` was not implemented at the data structure level, but "abstractly" by iterating over all incoming edges of a vertices and counting them. This is bad, especially since any sensible backends already stores that information.

What the branch does:

1) Add a `in_degree` function in the CGraph backend.

2) Add a `in_degree` and `out_degree` (empty) function in the `GenericGraph` backend (the only point is to write somewhere that the `in_degree/out_degree` functions should be implemented by all graph backends

3) Add a `in_degree/out_degree` function to the NetworkX backend. This backend is only used in one doctest, and this is the only backend that did not have this function.

4) Because all backends now have the `in_degree/out_degree` functions, it is now useless to 'check if the backend has the function' before calling it. As a result the code of `DiGraph.in_degree/out_degree` is simplified.

Nathann

Issue created by migration from https://trac.sagemath.org/ticket/17163





---

archive/issue_comments_223912.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-10-16T06:03:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16926",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16926#issuecomment-223912",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_223913.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-16T06:04:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16926",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16926#issuecomment-223913",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_223914.json:
```json
{
    "body": "Seems to work; now `top()` and `bottom()` on posets take same time. This also explains why timings with #13223 where little strange.\n\nUnfortunately I don't know enought Sage to be able to really review this.",
    "created_at": "2014-10-16T11:28:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16926",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16926#issuecomment-223914",
    "user": "https://github.com/jm58660"
}
```

Seems to work; now `top()` and `bottom()` on posets take same time. This also explains why timings with #13223 where little strange.

Unfortunately I don't know enought Sage to be able to really review this.



---

archive/issue_comments_223915.json:
```json
{
    "body": "The patch is working well. However, there are several places in `src/sage/graphs/base/c_graph.pyx` where you have such instruction (this one from your patch):\n\n\n```\ncdef v_int = get_vertex(v,\n                        self.vertex_ints,\n                        self.vertex_labels,\n                        self._cg)\n```\n\n\nShouldn't you specify the *int* type ?",
    "created_at": "2014-10-18T11:29:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16926",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16926#issuecomment-223915",
    "user": "https://github.com/dcoudert"
}
```

The patch is working well. However, there are several places in `src/sage/graphs/base/c_graph.pyx` where you have such instruction (this one from your patch):


```
cdef v_int = get_vertex(v,
                        self.vertex_ints,
                        self.vertex_labels,
                        self._cg)
```


Shouldn't you specify the *int* type ?



---

archive/issue_comments_223916.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-18T11:58:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16926",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16926#issuecomment-223916",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_223917.json:
```json
{
    "body": "> Shouldn't you specify the *int* type ?\n\nIndeed. I just did, thanks.\n\nNathann",
    "created_at": "2014-10-18T11:58:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16926",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16926#issuecomment-223917",
    "user": "https://github.com/nathanncohen"
}
```

> Shouldn't you specify the *int* type ?

Indeed. I just did, thanks.

Nathann



---

archive/issue_comments_223918.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-10-18T13:29:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16926",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16926#issuecomment-223918",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_223919.json:
```json
{
    "body": "All tests pass on `src/sage/graphs/`, so I give positive review.",
    "created_at": "2014-10-18T13:29:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16926",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16926#issuecomment-223919",
    "user": "https://github.com/dcoudert"
}
```

All tests pass on `src/sage/graphs/`, so I give positive review.



---

archive/issue_comments_223920.json:
```json
{
    "body": "Thanks !\n\nNathann",
    "created_at": "2014-10-18T13:30:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16926",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16926#issuecomment-223920",
    "user": "https://github.com/nathanncohen"
}
```

Thanks !

Nathann



---

archive/issue_comments_223921.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-10-18T18:19:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16926",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16926#issuecomment-223921",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
