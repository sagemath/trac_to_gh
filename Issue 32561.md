# Issue 32561: Clean the use of weights in generic_graph.py - part 1

Issue created by migration from https://trac.sagemath.org/ticket/32798

Original creator: dcoudert

Original creation time: 2021-10-30 10:27:25

part of #13112 and follow-up of #32723.

Here we clean methods:
- `min_spanning_tree`
- `minimum_cycle_basis`


---

Comment by dcoudert created at 2021-10-30 10:28:58

New commits:


---

Comment by dcoudert created at 2021-10-30 10:28:58

Changing status from new to needs_review.


---

Comment by git created at 2021-10-30 10:34:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-12-18 19:53:12

Stalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.


---

Comment by vdelecroix created at 2021-12-30 11:15:24

Changing status from needs_review to positive_review.


---

Comment by vdelecroix created at 2021-12-30 11:15:24

Beyond the scope of this ticket, but why the doctest

```
g.min_spanning_tree(algorith="XXX")
Traceback (most recent call last):
...
ValueError: the weight function cannot find the weight of (1, 2, 'a')
```

is repeated that many times. The check for the weight is among the first operations done in the function. It is neither helpful for the user nor to actually test the code.


---

Comment by vdelecroix created at 2021-12-30 11:16:06

Changing status from positive_review to needs_info.


---

Comment by vdelecroix created at 2021-12-30 11:16:06

Not sure it is beyond the scope : there was no check in that function before, right ?


---

Comment by vdelecroix created at 2021-12-30 11:20:19

Namely the checked before should have happened inside `sage.graphs.spanning_tree.kruskal`, `sage.graphs.spanning_tree.filter_kruskal`, `sage.graphs.spanning_tree.baruvka`, etc. Maybe these functions could assume the weight function is clean?


---

Comment by dcoudert created at 2021-12-30 11:27:08

Changing status from needs_info to needs_work.


---

Comment by dcoudert created at 2021-12-30 11:27:08

Actually, once we get the weight function in `min_spanning_tree`, we don't need to check weights anymore, so we can set the parameter to `False` (which is default) in the calls to `sage.graphs.spanning_tree.kruskal`...


---

Comment by dcoudert created at 2021-12-30 11:33:16

and it's already the case, so we check the weights only once, in `min_spanning_tree`.

So we can simplify the tests to let only

```
            sage: g = Graph([(0, 1, 1), (1, 2, 'a')], weighted=True)
            sage: g.min_spanning_tree()
            Traceback (most recent call last):
            ...
            ValueError: the weight function cannot find the weight of (1, 2, 'a')
```

and

```
            sage: g = Graph([(0, 1, 1), (1, 2, [1, 2, 3])], weighted=True)

            sage: g.min_spanning_tree()
            Traceback (most recent call last):
            ...
            ValueError: the weight function cannot find the weight of (1, 2, [1, 2, 3])
```

I'll do it in this ticket if you agree.


---

Comment by vdelecroix created at 2021-12-30 11:36:30

Sounds good to me.


---

Comment by git created at 2021-12-30 11:41:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2021-12-30 11:42:40

It's good to remove useless doctests.


---

Comment by dcoudert created at 2021-12-30 11:42:40

Changing status from needs_work to needs_review.


---

Comment by vdelecroix created at 2021-12-30 11:46:49

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2022-01-31 23:31:17

Resolution: fixed


---

Comment by mmezzarobba created at 2022-02-18 08:11:42

By reordering the keyword arguments of `min_spanning_tree()`, these changes break calls like `g.min_spanning_tree(my_weight_function)` that might be present in user code. Is there a strong reason for doing so (without a deprecation period)? If there is, how about making the arguments keyword-only?


---

Comment by dcoudert created at 2022-02-18 08:31:47

I did not thought about that. I'm always specifying the parameters. We can revert the reordering if you think it's better.


---

Comment by mmezzarobba created at 2022-03-01 09:00:49

(Sorry for the delay, I missed your reply.)

Replying to [comment:16 dcoudert]:
> I did not thought about that. I'm always specifying the parameters. We can revert the reordering if you think it's better.

Well, if the change was accidental, yes, I think it would be better to go back to the old ordering in order to avoid breaking user code!
