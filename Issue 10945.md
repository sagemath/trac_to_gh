# Issue 10945: improving shortest path all pairs through BFS computations

archive/issues_010945.json:
```json
{
    "body": "Assignee: jason, ncohen, rlm\n\nCC:  ylchapuy\n\nAfter taking a look at the SparseGraph backend, it looks like some time is actually spent obtaining the list of neighbors. This patch caches so that the out_neighbors method does not have to be called so often.\n\nIssue created by migration from https://trac.sagemath.org/ticket/11053\n\n",
    "created_at": "2011-03-26T21:07:04Z",
    "labels": [
        "graph theory",
        "major",
        "enhancement"
    ],
    "title": "improving shortest path all pairs through BFS computations",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10945",
    "user": "ncohen"
}
```
Assignee: jason, ncohen, rlm

CC:  ylchapuy

After taking a look at the SparseGraph backend, it looks like some time is actually spent obtaining the list of neighbors. This patch caches so that the out_neighbors method does not have to be called so often.

Issue created by migration from https://trac.sagemath.org/ticket/11053





---

archive/issue_comments_117761.json:
```json
{
    "body": "Before \n\n```\nsage: g = graphs.Grid2dGraph(60,60)\nsage: %time d = g.shortest_path_all_pairs()\nCPU times: user 14.52 s, sys: 0.51 s, total: 15.03 s\nWall time: 15.03 s\nsage: g = graphs.Grid2dGraph(30,30)\nsage: %timeit d = g.shortest_path_all_pairs()\n5 loops, best of 3: 752 ms per loop\nsage: g = graphs.PetersenGraph()\nsage: %timeit d = g.shortest_path_all_pairs()\n625 loops, best of 3: 73.5 \u00b5s per loop\n```\n\n\nAfter \n\n```\nsage: g = graphs.Grid2dGraph(60,60)\nsage: %time d = g.shortest_path_all_pairs()\nCPU times: user 10.70 s, sys: 0.53 s, total: 11.23 s\nWall time: 11.24 s\nsage: g = graphs.Grid2dGraph(30,30)\nsage: %timeit d = g.shortest_path_all_pairs()\n5 loops, best of 3: 549 ms per loop\nsage: g = graphs.PetersenGraph()\nsage: %timeit d = g.shortest_path_all_pairs()\n625 loops, best of 3: 53.4 \u00b5s per loop\n```\n",
    "created_at": "2011-03-26T21:15:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10945#issuecomment-117761",
    "user": "ncohen"
}
```

Before 

```
sage: g = graphs.Grid2dGraph(60,60)
sage: %time d = g.shortest_path_all_pairs()
CPU times: user 14.52 s, sys: 0.51 s, total: 15.03 s
Wall time: 15.03 s
sage: g = graphs.Grid2dGraph(30,30)
sage: %timeit d = g.shortest_path_all_pairs()
5 loops, best of 3: 752 ms per loop
sage: g = graphs.PetersenGraph()
sage: %timeit d = g.shortest_path_all_pairs()
625 loops, best of 3: 73.5 µs per loop
```


After 

```
sage: g = graphs.Grid2dGraph(60,60)
sage: %time d = g.shortest_path_all_pairs()
CPU times: user 10.70 s, sys: 0.53 s, total: 11.23 s
Wall time: 11.24 s
sage: g = graphs.Grid2dGraph(30,30)
sage: %timeit d = g.shortest_path_all_pairs()
5 loops, best of 3: 549 ms per loop
sage: g = graphs.PetersenGraph()
sage: %timeit d = g.shortest_path_all_pairs()
625 loops, best of 3: 53.4 µs per loop
```




---

archive/issue_comments_117762.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-03-26T21:15:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10945#issuecomment-117762",
    "user": "ncohen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_117763.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-03-30T14:02:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10945#issuecomment-117763",
    "user": "ncohen"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_117764.json:
```json
{
    "body": "Attachment",
    "created_at": "2011-06-05T16:08:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10945#issuecomment-117764",
    "user": "ncohen"
}
```

Attachment



---

archive/issue_comments_117765.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-06-05T16:10:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10945#issuecomment-117765",
    "user": "ncohen"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_117766.json:
```json
{
    "body": "I had set this patch to \"needs review\", as I was wondering why Cython was apparently slower than a C code I had written independently. Turns out the different lies in how the vertices of the 2d grid (which is the graph on which I was testing the performances) were labelled. \n\nIn the C code, they were labelled from left to right, then from top to bottom, why Sage's numbering is much more random, hence different performances in practice.\n\nHail Cython `;-)`\n\nNathann",
    "created_at": "2011-06-05T16:10:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10945#issuecomment-117766",
    "user": "ncohen"
}
```

I had set this patch to "needs review", as I was wondering why Cython was apparently slower than a C code I had written independently. Turns out the different lies in how the vertices of the 2d grid (which is the graph on which I was testing the performances) were labelled. 

In the C code, they were labelled from left to right, then from top to bottom, why Sage's numbering is much more random, hence different performances in practice.

Hail Cython `;-)`

Nathann



---

archive/issue_comments_117767.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-08-04T08:58:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10945#issuecomment-117767",
    "user": "lsampaio"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_117768.json:
```json
{
    "body": "I reviwed the patch and it seens to be working well!",
    "created_at": "2011-08-04T08:58:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10945#issuecomment-117768",
    "user": "lsampaio"
}
```

I reviwed the patch and it seens to be working well!



---

archive/issue_comments_117769.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-08-18T22:03:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10945",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10945#issuecomment-117769",
    "user": "jdemeyer"
}
```

Resolution: fixed
