# Issue 11171: TinyMCE won't work with @ in the username of notebook

Issue created by migration from Trac.

Original creator: kcrisman

Original creation time: 2011-05-17 15:35:54

Assignee: jason, mpatel, was

CC:  jason boothby was mpatel ddrake ppurka

Keywords: notebook, tinymce, at

Please see below for what TinyMCE cells look like if you have an ``@`` in your username.  This is since at least 4.6, see [this thread](http://groups.google.com/group/sage-notebook/browse_thread/thread/f0ceaa24700f4059).

I'm making this critical, because it removes major piece of functionality.  At the *very least*, we'll need to change the login page to remove the `@` availability!!!


---

Attachment

This is also apparently known elsewhere - see more of the same thread.  Changing the upstream designation; hopefully a little more digging will find a workaround.


---

Comment by kcrisman created at 2011-06-13 18:56:12

Okay, here is where one would have to at least change this - `sagenb/data/sage/html/accounts/registration.html`.  The other place is in `twist.py`.


---

Comment by kcrisman created at 2011-06-14 00:01:16

Changing keywords from "notebook, tinymce, at" to "notebook, tinymce, at, sd31".


---

Comment by kcrisman created at 2011-06-14 00:01:16

Okay, I've got this temporarily disabled.    Re-enabling this is #11470.

Please test whether this breaks existing usernames with `@`!!!


---

Comment by kcrisman created at 2011-06-14 00:01:16

Changing status from new to needs_review.


---

Attachment


---

Comment by kcrisman created at 2011-06-16 23:03:34

This is reported upstream at [this link](http://code.google.com/p/sagenb/issues/detail?id=26).


---

Comment by kcrisman created at 2011-06-23 03:26:16

Confirmed for flask as well, at least at demo2.sagenb.org or sagenb.org (I tried both)

```
http://demo2.sagenb.org/home/b%40b/0/
```

is the name but it still causes problems.   You can try this with password 'abc123'.  Note that the user name at the top (next to Toggle) is still `b`@`b`.


---

Comment by kcrisman created at 2011-08-18 01:47:22

What's the status of this?  If the Flask notebook isn't going to be done soon, this should really have been in 4.7.1 :( especially as people upgrade their servers.


---

Comment by jason created at 2011-08-18 02:21:53

At the very least, we should take "`@`" out of the explicitly-listed good characters for notebook names on the registration page!


---

Comment by kcrisman created at 2011-08-18 12:09:31

Replying to [comment:7 jason]:
> At the very least, we should take "`@`" out of the explicitly-listed good characters for notebook names on the registration page!
Which is what my patch does!!!


---

Comment by jason created at 2011-08-18 17:39:41

Ah, I see I just volunteered to review this :)


---

Comment by dimpase created at 2011-09-29 04:34:56

a) cannot repeat this with rkirov's flask version of nb and twisted-11 installed.

b) this is a duplicate of #8995

IMHO this should not be fixed. Let's do the upgrades instead!


---

Comment by dimpase created at 2011-09-29 04:34:56

Changing status from needs_review to needs_info.


---

Comment by kcrisman created at 2011-09-29 13:04:42

Fair enough, but WHEN will the upgrades happen? We really should not be releasing "real" releases of Sage that admins are using for nb servers without fixing at least the documentation.   I don't know what the current status is.  I don't think that the documentation fix was merged in sagenb, despite a number of pesters.  

Is there a specific server I can test this on, Dima?   If there is a sense that flask will be merged soon AND this fixes it, great.    If not...  

Also, did you try it with several browsers?  I don't think it's browser-dependent but it's worth checking.

I'm going to mark #8995 as the dup, just because this has more discussion and a patch, though I don't know if it still applies to sagenb.


---

Comment by dimpase created at 2011-09-29 13:21:25

Replying to [comment:11 kcrisman]:
> Fair enough, but WHEN will the upgrades happen? We really should not be releasing "real" releases of Sage that admins are using for nb servers without fixing at least the documentation.   I don't know what the current status is.  I don't think that the documentation fix was merged in sagenb, despite a number of pesters.  
> 
> Is there a specific server I can test this on, Dima?   If there is a sense that flask will be merged soon AND this fixes it, great.    If not...  

I'm looking into it now. You can try meanwhile using test.sagenb.org, which runs twisted 11.
I'll open a ticket for upgrading twisted to version 11 real soon...
The initial spkg and a patch to have it running on Rado's flack notebook is already on 
http://boxen.math.washington.edu/home/dima/packages/
and
http://boxen.math.washington.edu/home/dima/patches/

> 
> Also, did you try it with several browsers?  I don't think it's browser-dependent but it's worth checking.

no, I didn't. 

> 
> I'm going to mark #8995 as the dup, just because this has more discussion and a patch, though I don't know if it still applies to sagenb.


---

Comment by kcrisman created at 2011-09-29 13:28:57

Changing status from needs_info to needs_review.


---

Comment by kcrisman created at 2011-09-29 13:28:57

Same problem.   See attached screenshot.  You can check this out with username `abc`@`abc` with password `123123`.


---

Attachment

I'm making this a blocker for 4.7.2.  This is totally unacceptable that we do not at least change the login screen to avoid ``@`` until this is fixed.  Sorry, Leif :)


---

Comment by kcrisman created at 2011-09-29 13:30:31

Changing priority from critical to blocker.


---

Comment by dimpase created at 2011-09-29 14:22:30

Replying to [comment:14 kcrisman]:
> Same problem.   See attached screenshot.  You can check this out with username `abc`@`abc` with password `123123`.

I tried with stock  Firefox, and Chrome on MacOSX 10.6.8...
I cannot reproduce it; please state the browser, OS, (and medication ;-))  you are on.

I can reproduce it with the stock Safari on the said platform (this also is not working with the updated version of tiny-mce, locally). 

Oh well, we all but banned IE from using the nb, we should ban other closed-source browsers. I seldom use Safari nowadays. Safari sucks. So is IE. Don't use them for serious business.


---

Comment by dimpase created at 2011-09-29 14:22:30

Changing status from needs_review to needs_info.


---

Comment by kcrisman created at 2011-09-29 15:50:09

> > Same problem.   See attached screenshot.  You can check this out with username `abc`@`abc` with password `123123`.
> 
> I tried with stock  Firefox, and Chrome on MacOSX 10.6.8...
> I cannot reproduce it; please state the browser, OS, (and medication ;-))  you are on.
> 
> I can reproduce it with the stock Safari on the said platform (this also is not working with the updated version of tiny-mce, locally). 

Okay, fair enough.  Hmm, I thought I had seen it on FF.  Checking...

> Oh well, we all but banned IE from using the nb, we should ban other closed-source browsers. I seldom use Safari nowadays. Safari sucks. So is IE. Don't use them for serious business.

Well, it does load significantly faster (for me), and is standards-compliant enough for me.  What about Opera?    

Also, I think it is unreasonable to ban these both longterm.   This ticket isn't for old hands, it's so that new users don't think Sage sucks.  Even with IE (where I agree with you), most of the world is using it, still, and we don't want people to not use Sage because they don't want to download a new browser or whatever.  

Anyway, we need to do _something_ with this issue.    If we aren't merging flask, or whatever fixed this in FF, in 4.7.2, then this should still be fixed for now.  See #11470 for the followup once we do.


---

Comment by dimpase created at 2011-09-29 16:34:27

Basu, care to try this on Opera?


---

Comment by ppurka created at 2011-09-29 16:44:58

Works fine in opera-11.51 even without the patch. (sage-4.7.0)


---

Attachment

Replying to [comment:18 dimpase]:
> Basu, care to try this on Opera?

It works fine in opera even without the patch. But `@` should not have been allowed in usernames anyway because of this message that I got while creating the username:

_The username must start with a letter and be between 4 and 32 characters long. It can only consist of letters, numbers, underscores, and one dot (.)._


---

Comment by ppurka created at 2011-09-29 17:23:51

Replying to [comment:19 ppurka]:
> Replying to [comment:18 dimpase]:
> > Basu, care to try this on Opera?
> 
> It works fine in opera even without the patch. But `@` should not have been allowed in usernames anyway because of this message that I got while creating the username:
> 
> _The username must start with a letter and be between 4 and 32 characters long. It can only consist of letters, numbers, underscores, and one dot (.)._

Sorry, I am not thinking straight today. I forgot that I am running rkirov-flask on the local installation (installed in $HOME). I tried the system installation also (installed in /) which is sage-4.7.1 and it is using the old notebook and the tiny-mce part works fine. (I tested it from the admin account since I am unable to login as any user, even admin, from the sign-in page. This is a separate issue and is unrelated to this bug.)


---

Attachment

Neglect the previous *opera*.png. This is on a fresh .sagenb directory (sage-4.7.1)


---

Comment by ppurka created at 2011-09-29 17:58:29

I created a fresh /tmp/a.sagenb directory and ran sage -n on that directory. The bug is there in opera-11.51 with sage-4.7.1, amd64 Gentoo Linux. Sorry for all the noise I created earlier.

I believe my ~/.sage directory was being written to by both sage-4.7 (with rkirov-flask notebook) and sage-4.7.1 (with old notebook) and so I wasn't seeing this bug earlier.


---

Comment by dimpase created at 2011-09-30 10:02:39

Replying to [comment:21 ppurka]:
> I created a fresh /tmp/a.sagenb directory and ran sage -n on that directory. The bug is there in opera-11.51 with sage-4.7.1, amd64 Gentoo Linux. Sorry for all the noise I created earlier.
> 
> I believe my ~/.sage directory was being written to by both sage-4.7 (with rkirov-flask notebook) and sage-4.7.1 (with old notebook) and so I wasn't seeing this bug earlier.

I cannot reproduce this on Opera 11.51, Build 1087, on Mac OS X 10.6.8 on flack notebook with the new tiny_mce 3.4.5.
Could you please try getting the tiny_mce upgrade from here:
http://boxen.math.washington.edu/home/dima/packages/tiny_mce-3.4.5.tar.bz
replace your `SAGE_ROOT/devel/....../sagenb/data/tiny_mce/` with the contents of this
archive, and try again?


---

Comment by ppurka created at 2011-10-01 08:15:21

In gist, here is the current status of when it works: it works with flask notebook, irrespective of tiny-mce version.


 * sage-4.7.0 + flask nb + tiny-mce (old) + opera-11.51: Works
 * sage-4.7.0 + flask nb + tiny-mce-3.4.5 + opera-11.51: Works
 * sage-4.7.1 + old nb + tiny-mce (old) + opera-11.51: Does not work
 * sage-4.7.1 + old nb + tiny-mce-3.4.5 + opera-11.51: Does not work
 * sage-4.7.1 + old nb + tiny-mce-3.4.5 + firefox-6: Does not work


---

Comment by jdemeyer created at 2011-10-12 19:56:09

This ticket is listed as blocker, what is the current status?  It seems like disallowing users to register usernames with `@` could be a quick and eays solution.  But they should still be able to _log in_ with any existing username.


---

Comment by dimpase created at 2011-10-12 20:04:14

Replying to [comment:24 jdemeyer]:
> This ticket is listed as blocker, what is the current status?  It seems like disallowing users to register usernames with `@` could be a quick and eays solution.  But they should still be able to _log in_ with any existing username.

it's should not be a blocker, as a workaround is to use another browser. I therefore take the liberty to make it just major instead...


---

Comment by dimpase created at 2011-10-12 20:04:14

Changing priority from blocker to major.


---

Comment by kcrisman created at 2011-10-12 20:09:07

Changing status from needs_info to needs_review.


---

Comment by kcrisman created at 2011-10-12 20:09:07

Changing priority from major to critical.


---

Comment by kcrisman created at 2011-10-12 20:09:07

Replying to [comment:24 jdemeyer]:
> This ticket is listed as blocker, what is the current status?  It seems like disallowing users to register usernames with `@` could be a quick and eays solution.  But they should still be able to _log in_ with any existing username.

Which is precisely what [attachment:trac_11343-fix_at_symbol.patch] does.  I just checked and it still applies cleanly...  I just feel this is better than waiting eternally for the flask or TinyMCE update.

I really disagree that it's major and not blocker.   Sage doesn't work properly, and saying "use another browser" is going to keep on being said until we have zero browsers that support it.  If ppurka finds it doesn't work with FF or Opera with the new TinyMCE, and it doesn't work on Safari, and we already suggest (though nowhere official!!!) that IE is gone... should we be sending people to lynx?

So critical.  But if someone just reviews this patch, it fixes the problem, and that is better.  Plus it lights a fire under the flask/sagenb people to finish things off so we don't mess with things any more.


---

Comment by jdemeyer created at 2011-10-14 18:03:17

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2011-10-14 18:03:17

Patch does the job.  New registrations with `@` are not possible, existing ones can still log in.


---

Comment by jdemeyer created at 2011-10-14 18:16:57

Changing priority from critical to blocker.


---

Comment by jdemeyer created at 2011-10-16 15:38:08

Resolution: fixed
