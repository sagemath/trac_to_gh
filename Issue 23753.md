# Issue 23753: Convert symbolic relations to/from !SymPy

archive/issues_023753.json:
```json
{
    "body": "CC:  mforets\n\n\n```\nsage: (x>0)._sympy_()\n...\nNotImplementedError: relation\n```\n\n\nThis functionality is needed both by #22322 and #23923. Needed is a fix to `SympyConverter` in `expression-conversions.pyx`\n\nIssue created by migration from https://trac.sagemath.org/ticket/23990\n\n",
    "created_at": "2017-10-08T14:20:51Z",
    "labels": [
        "interfaces",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "Convert symbolic relations to/from !SymPy",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23753",
    "user": "rws"
}
```
CC:  mforets


```
sage: (x>0)._sympy_()
...
NotImplementedError: relation
```


This functionality is needed both by #22322 and #23923. Needed is a fix to `SympyConverter` in `expression-conversions.pyx`

Issue created by migration from https://trac.sagemath.org/ticket/23990





---

archive/issue_comments_332837.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-10-08T15:23:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23753#issuecomment-332837",
    "user": "rws"
}
```

New commits:



---

archive/issue_comments_332838.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-08T15:35:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23753#issuecomment-332838",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_332839.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-08T15:55:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23753#issuecomment-332839",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_332840.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-09T13:07:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23753#issuecomment-332840",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_332841.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-10-09T13:08:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23753#issuecomment-332841",
    "user": "rws"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_332842.json:
```json
{
    "body": "8.1.beta7 + #23990 passes `ptestlong` on Debian testing running on core i5 + 8 GB RAM with no error whatsoever.\n\n==>`positive_review`\n\nPS : You need to put your name in \"Authors\"\n\nPPS : Thank you very much ! Solving inequations is a domain where Sage and Maxima are currenty weak. This is a nice step in the right direction.",
    "created_at": "2017-10-09T16:08:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23753#issuecomment-332842",
    "user": "charpent"
}
```

8.1.beta7 + #23990 passes `ptestlong` on Debian testing running on core i5 + 8 GB RAM with no error whatsoever.

==>`positive_review`

PS : You need to put your name in "Authors"

PPS : Thank you very much ! Solving inequations is a domain where Sage and Maxima are currenty weak. This is a nice step in the right direction.



---

archive/issue_comments_332843.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-10-09T16:08:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23753#issuecomment-332843",
    "user": "charpent"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_332844.json:
```json
{
    "body": "Thanks!",
    "created_at": "2017-10-10T06:26:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23753#issuecomment-332844",
    "user": "rws"
}
```

Thanks!



---

archive/issue_comments_332845.json:
```json
{
    "body": "P.S. Don't forget to reinstall SymPy before compiling Sage.",
    "created_at": "2017-10-10T06:29:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23753#issuecomment-332845",
    "user": "rws"
}
```

P.S. Don't forget to reinstall SymPy before compiling Sage.



---

archive/issue_comments_332846.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-10-10T06:48:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23753#issuecomment-332846",
    "user": "rws"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_332847.json:
```json
{
    "body": "Sorry, I forgot to increase the SymPy patchlevel, and the patch does no apply anyway.",
    "created_at": "2017-10-10T06:48:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23753#issuecomment-332847",
    "user": "rws"
}
```

Sorry, I forgot to increase the SymPy patchlevel, and the patch does no apply anyway.



---

archive/issue_comments_332848.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-10T07:55:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23753#issuecomment-332848",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_332849.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2017-10-10T07:56:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23753#issuecomment-332849",
    "user": "rws"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_332850.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2017-10-10T07:57:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23753#issuecomment-332850",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_332851.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2017-10-10T07:57:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23753#issuecomment-332851",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_332852.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-10-10T07:57:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23753#issuecomment-332852",
    "user": "rws"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_332853.json:
```json
{
    "body": "Replying to [comment:10 rws]:\n> Sorry, I forgot to increase the SymPy patchlevel, and the patch does no apply anyway.\n\nAh ! I thought that the reverse conversion (which I saw on the sympy site) was reserved for another Sage patch...",
    "created_at": "2017-10-10T10:50:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23753#issuecomment-332853",
    "user": "charpent"
}
```

Replying to [comment:10 rws]:
> Sorry, I forgot to increase the SymPy patchlevel, and the patch does no apply anyway.

Ah ! I thought that the reverse conversion (which I saw on the sympy site) was reserved for another Sage patch...



---

archive/issue_comments_332854.json:
```json
{
    "body": "Changing status from positive_review to needs_info.",
    "created_at": "2017-10-10T11:23:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23753#issuecomment-332854",
    "user": "charpent"
}
```

Changing status from positive_review to needs_info.



---

archive/issue_comments_332855.json:
```json
{
    "body": "\n```\nsage: var(\"a,b\")\n(a, b)\nsage: sympy.sympify(a==b)._sage_()\na == b\nsage: sympy.sympify(a==b).sage()\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n<ipython-input-14-25de6a4c8f0a> in <module>()\n----> 1 sympy.sympify(a==b).sage()\n\nAttributeError: 'Equality' object has no attribute 'sage'\n```\n\n\nIs that the intended behaviour ? Or to you plan to overhaul a `.sage()` method for various Sympy objects ?\n\nIt is not obvious to me why (e. g.) Mathematic objects can be converted back to Sage objects via the (exposed) `.sage()` method, whereas one has to use the (unexposed) `._sage_()` methods for Sympy objects...",
    "created_at": "2017-10-10T11:23:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23753#issuecomment-332855",
    "user": "charpent"
}
```


```
sage: var("a,b")
(a, b)
sage: sympy.sympify(a==b)._sage_()
a == b
sage: sympy.sympify(a==b).sage()
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-14-25de6a4c8f0a> in <module>()
----> 1 sympy.sympify(a==b).sage()

AttributeError: 'Equality' object has no attribute 'sage'
```


Is that the intended behaviour ? Or to you plan to overhaul a `.sage()` method for various Sympy objects ?

It is not obvious to me why (e. g.) Mathematic objects can be converted back to Sage objects via the (exposed) `.sage()` method, whereas one has to use the (unexposed) `._sage_()` methods for Sympy objects...



---

archive/issue_comments_332856.json:
```json
{
    "body": "`_sage_()` is just the SymPy convention, every convertible object has it. They have a lot of other underscore member functions, try `grep 'def _' sympy/*/*/*`. Are Mma objects not Sage objects? Should we enforce coding conventions between projects?\n\nPlease don't forget to set back positive.",
    "created_at": "2017-10-10T13:21:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23753#issuecomment-332856",
    "user": "rws"
}
```

`_sage_()` is just the SymPy convention, every convertible object has it. They have a lot of other underscore member functions, try `grep 'def _' sympy/*/*/*`. Are Mma objects not Sage objects? Should we enforce coding conventions between projects?

Please don't forget to set back positive.



---

archive/issue_comments_332857.json:
```json
{
    "body": "Replying to [comment:17 rws]:\n> `_sage_()` is just the SymPy convention, every convertible object has it. They have a lot of other underscore member functions, try `grep 'def _' sympy/*/*/*`.\n\nIndeed. No quarell here.\n\n> Are Mma objects not Sage objects? \n\nThey are by definition Sage objects, but have no meaning for interacting with Sage \"native\" objects ; a conversion is needed for that.\n\n>Should we enforce coding conventions between projects?\n\nI think that's almost what I was thinking about (syntax consistency rather than coding conventions).\n\nNote that the non-Sympy interfaces are not **that** consistent : compare, for example, interfaces to mathematica, giac, R, maple and fricas... Unifying them would represent a lot of work second-intention consistency is hard...\n\nAnother reason was that, unless I'm mistaken, the docs I read when I was starting to learn Sage (about 2-3 years ago) recommended to \"end users\" to use only \"exposed\" methods, leaving the unexposed ones to internal Sage use. I certainly had this recommendation in mind when I asked my question.\n\nHas this recommendation changed ?\n\n> Please don't forget to set back positive.\n\nOf course ;-).\n\nAnd, BTW, this was only a //question//, not a criticism...",
    "created_at": "2017-10-10T13:54:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23753#issuecomment-332857",
    "user": "charpent"
}
```

Replying to [comment:17 rws]:
> `_sage_()` is just the SymPy convention, every convertible object has it. They have a lot of other underscore member functions, try `grep 'def _' sympy/*/*/*`.

Indeed. No quarell here.

> Are Mma objects not Sage objects? 

They are by definition Sage objects, but have no meaning for interacting with Sage "native" objects ; a conversion is needed for that.

>Should we enforce coding conventions between projects?

I think that's almost what I was thinking about (syntax consistency rather than coding conventions).

Note that the non-Sympy interfaces are not **that** consistent : compare, for example, interfaces to mathematica, giac, R, maple and fricas... Unifying them would represent a lot of work second-intention consistency is hard...

Another reason was that, unless I'm mistaken, the docs I read when I was starting to learn Sage (about 2-3 years ago) recommended to "end users" to use only "exposed" methods, leaving the unexposed ones to internal Sage use. I certainly had this recommendation in mind when I asked my question.

Has this recommendation changed ?

> Please don't forget to set back positive.

Of course ;-).

And, BTW, this was only a //question//, not a criticism...



---

archive/issue_comments_332858.json:
```json
{
    "body": "Changing status from needs_info to positive_review.",
    "created_at": "2017-10-10T13:54:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23753#issuecomment-332858",
    "user": "charpent"
}
```

Changing status from needs_info to positive_review.



---

archive/issue_comments_332859.json:
```json
{
    "body": "The problem is that you seem to want a way to know how to convert a Python object from a different namespace by asking for its methods. But Sage has no control over them because Python does not allow adding methods on-the-fly. It may be an idea to just provide a Sage global function `to_sage(...)` that knows these members and calls them without you having to know. Please open a ticket or a discussion and cite me as much as you want. This ticket has fulfilled its purpose.",
    "created_at": "2017-10-10T14:13:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23753#issuecomment-332859",
    "user": "rws"
}
```

The problem is that you seem to want a way to know how to convert a Python object from a different namespace by asking for its methods. But Sage has no control over them because Python does not allow adding methods on-the-fly. It may be an idea to just provide a Sage global function `to_sage(...)` that knows these members and calls them without you having to know. Please open a ticket or a discussion and cite me as much as you want. This ticket has fulfilled its purpose.



---

archive/issue_comments_332860.json:
```json
{
    "body": "Replying to [comment:19 rws]:\n> ...because Python does not allow adding methods on-the-fly...\n\nI'm a Python noob. I didn't know about `MethodType`.",
    "created_at": "2017-10-10T14:43:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23753#issuecomment-332860",
    "user": "rws"
}
```

Replying to [comment:19 rws]:
> ...because Python does not allow adding methods on-the-fly...

I'm a Python noob. I didn't know about `MethodType`.



---

archive/issue_comments_332861.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-10-20T09:15:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23753#issuecomment-332861",
    "user": "vbraun"
}
```

Resolution: fixed
