# Issue 23753: Convert symbolic relations to/from !SymPy

Issue created by migration from Trac.

Original creator: rws

Original creation time: 2017-10-08 14:20:51

CC:  mforets


```
sage: (x>0)._sympy_()
...
NotImplementedError: relation
```


This functionality is needed both by #22322 and #23923. Needed is a fix to `SympyConverter` in `expression-conversions.pyx`


---

Comment by rws created at 2017-10-08 15:23:17

New commits:


---

Comment by git created at 2017-10-08 15:35:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-10-08 15:55:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-10-09 13:07:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2017-10-09 13:08:58

Changing status from new to needs_review.


---

Comment by charpent created at 2017-10-09 16:08:34

8.1.beta7 + #23990 passes `ptestlong` on Debian testing running on core i5 + 8 GB RAM with no error whatsoever.

==>`positive_review`

PS : You need to put your name in "Authors"

PPS : Thank you very much ! Solving inequations is a domain where Sage and Maxima are currenty weak. This is a nice step in the right direction.


---

Comment by charpent created at 2017-10-09 16:08:34

Changing status from needs_review to positive_review.


---

Comment by rws created at 2017-10-10 06:26:09

Thanks!


---

Comment by rws created at 2017-10-10 06:29:47

P.S. Don't forget to reinstall SymPy before compiling Sage.


---

Comment by rws created at 2017-10-10 06:48:00

Changing status from positive_review to needs_work.


---

Comment by rws created at 2017-10-10 06:48:00

Sorry, I forgot to increase the SymPy patchlevel, and the patch does no apply anyway.


---

Comment by git created at 2017-10-10 07:55:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2017-10-10 07:56:07

Changing status from needs_work to positive_review.


---

Comment by git created at 2017-10-10 07:57:12

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by git created at 2017-10-10 07:57:12

Changing status from positive_review to needs_review.


---

Comment by rws created at 2017-10-10 07:57:46

Changing status from needs_review to positive_review.


---

Comment by charpent created at 2017-10-10 10:50:50

Replying to [comment:10 rws]:
> Sorry, I forgot to increase the SymPy patchlevel, and the patch does no apply anyway.

Ah ! I thought that the reverse conversion (which I saw on the sympy site) was reserved for another Sage patch...


---

Comment by charpent created at 2017-10-10 11:23:18

Changing status from positive_review to needs_info.


---

Comment by charpent created at 2017-10-10 11:23:18


```
sage: var("a,b")
(a, b)
sage: sympy.sympify(a==b)._sage_()
a == b
sage: sympy.sympify(a==b).sage()
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-14-25de6a4c8f0a> in <module>()
----> 1 sympy.sympify(a==b).sage()

AttributeError: 'Equality' object has no attribute 'sage'
```


Is that the intended behaviour ? Or to you plan to overhaul a `.sage()` method for various Sympy objects ?

It is not obvious to me why (e. g.) Mathematic objects can be converted back to Sage objects via the (exposed) `.sage()` method, whereas one has to use the (unexposed) `._sage_()` methods for Sympy objects...


---

Comment by rws created at 2017-10-10 13:21:57

`_sage_()` is just the SymPy convention, every convertible object has it. They have a lot of other underscore member functions, try `grep 'def _' sympy/*/*/*`. Are Mma objects not Sage objects? Should we enforce coding conventions between projects?

Please don't forget to set back positive.


---

Comment by charpent created at 2017-10-10 13:54:49

Replying to [comment:17 rws]:
> `_sage_()` is just the SymPy convention, every convertible object has it. They have a lot of other underscore member functions, try `grep 'def _' sympy/*/*/*`.

Indeed. No quarell here.

> Are Mma objects not Sage objects? 

They are by definition Sage objects, but have no meaning for interacting with Sage "native" objects ; a conversion is needed for that.

>Should we enforce coding conventions between projects?

I think that's almost what I was thinking about (syntax consistency rather than coding conventions).

Note that the non-Sympy interfaces are not **that** consistent : compare, for example, interfaces to mathematica, giac, R, maple and fricas... Unifying them would represent a lot of work second-intention consistency is hard...

Another reason was that, unless I'm mistaken, the docs I read when I was starting to learn Sage (about 2-3 years ago) recommended to "end users" to use only "exposed" methods, leaving the unexposed ones to internal Sage use. I certainly had this recommendation in mind when I asked my question.

Has this recommendation changed ?

> Please don't forget to set back positive.

Of course ;-).

And, BTW, this was only a //question//, not a criticism...


---

Comment by charpent created at 2017-10-10 13:54:49

Changing status from needs_info to positive_review.


---

Comment by rws created at 2017-10-10 14:13:39

The problem is that you seem to want a way to know how to convert a Python object from a different namespace by asking for its methods. But Sage has no control over them because Python does not allow adding methods on-the-fly. It may be an idea to just provide a Sage global function `to_sage(...)` that knows these members and calls them without you having to know. Please open a ticket or a discussion and cite me as much as you want. This ticket has fulfilled its purpose.


---

Comment by rws created at 2017-10-10 14:43:19

Replying to [comment:19 rws]:
> ...because Python does not allow adding methods on-the-fly...

I'm a Python noob. I didn't know about `MethodType`.


---

Comment by vbraun created at 2017-10-20 09:15:13

Resolution: fixed
