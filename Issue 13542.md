# Issue 13542: Do not delete a borrowed reference to reduction strategies in pbori

Issue created by migration from https://trac.sagemath.org/ticket/13746

Original creator: jpflori

Original creation time: 2012-11-22 17:25:34

Assignee: tbd

CC:  simonking alexanderdreyer

Keywords: segfault

In #12313, it was discovered in a painful way that Sage tries to deallocate twice memory allocated for reduction strategies in pbori.

As this fix is now needed by other tickets like #715, I've put the fix on an independent ticket.


---

Comment by jpflori created at 2012-11-22 17:28:47

Patch from #12313 with only changes concerning trac ticket numbers


---

Comment by jpflori created at 2012-11-22 17:30:05

Changing status from new to needs_review.


---

Comment by jpflori created at 2012-11-22 17:30:05

Changing component from PLEASE CHANGE to memleak.


---

Attachment


---

Comment by SimonKing created at 2012-11-22 17:41:11

OK, you took the patch from #12313 and removed the bits that now belong to #13741, right?

I don't recall who wrote most of the code in the patch - in other words: Who can be reviewer for it?


---

Comment by jpflori created at 2012-11-22 17:46:53

Replying to [comment:2 SimonKing]:
> OK, you took the patch from #12313 and removed the bits that now belong to #13741, right?
> 
No, the two patches were orthogonal, they touched different part of quit_sage.
I'm not completely sure the additional garbage collection we introduce here is really needed, but it cannot hurt for sure (or it can reveal nasty bugs :) which is good).
> I don't recall who wrote most of the code in the patch - in other words: Who can be reviewer for it?
I think the patch was already positively reviewed during the process of reviewing #12313, so you or Nils could set this ticket to positive review, I just don't feel doing it as I've opened the ticket.


---

Comment by jpflori created at 2012-11-22 17:48:30

And so this is exactly the same patch as in #12313, except that:
- I've replace 12313 by 13746 in the commit message
- I've replace 12313 by 12313 and 13746 in some comment in the code redirecting the reader to Sage's trac


---

Comment by SimonKing created at 2012-11-22 17:50:09

Replying to [comment:3 jpflori]:
> Replying to [comment:2 SimonKing]:
> > OK, you took the patch from #12313 and removed the bits that now belong to #13741, right?
> > 
> No, the two patches were orthogonal,

Sorry, you are totally right! What I moved to #13471 came from #12215 or so...

> I'm not completely sure the additional garbage collection we introduce here is really needed, but it cannot hurt for sure (or it can reveal nasty bugs :) which is good).

Indeed!

> I think the patch was already positively reviewed during the process of reviewing #12313, so you or Nils could set this ticket to positive review, I just don't feel doing it as I've opened the ticket.

Not before running a full test...


---

Comment by jdemeyer created at 2012-11-23 13:29:37

Changing priority from critical to blocker.


---

Comment by AlexanderDreyer created at 2012-11-26 21:59:30

I could probably review it, since I've already discussed it previously. The patch looks sane, yet I don't understand, why it fails on the patchbot. (Is this related to something else?)


---

Comment by SimonKing created at 2012-11-26 23:03:26

Replying to [comment:8 AlexanderDreyer]:
> I could probably review it, since I've already discussed it previously. The patch looks sane, yet I don't understand, why it fails on the patchbot. (Is this related to something else?)

My guess is that the error is unrelated (it seems to come from a killed Gap session). To be on the safe side, I've just kicked the patchbot, so that it should now repeat the tests.


---

Comment by AlexanderDreyer created at 2012-11-26 23:40:23

Looks good!


---

Comment by AlexanderDreyer created at 2012-11-26 23:40:23

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2012-12-16 13:58:30

Resolution: fixed
