# Issue 19541: McFarland 1973 construction for difference sets

Issue created by migration from https://trac.sagemath.org/ticket/19778

Original creator: vdelecroix

Original creation time: 2015-12-24 17:44:12

CC:  ncohen

We implement McFarland 1973 construction that gives more difference sets (only for large lambda though).


---

Comment by vdelecroix created at 2015-12-24 17:49:47

New commits:


---

Comment by vdelecroix created at 2015-12-24 17:49:47

Changing status from new to needs_review.


---

Comment by ncohen created at 2015-12-25 11:21:55

input sections would be nice. The docstring of `mcfarland_1973_construction` is rather minimalistic.

You moved code around in `difference_family`, and from the diff it is difficult to guess what and why. Could you be more verbose?

Nathann


---

Comment by ncohen created at 2015-12-25 11:22:22

Changing status from needs_review to needs_work.


---

Comment by git created at 2015-12-28 11:43:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2015-12-28 11:46:20

Changing status from needs_work to needs_review.


---

Comment by vdelecroix created at 2015-12-28 11:46:20

Hello,

I moved the code around in `difference_family` in order to have all constructions that does not need the factorisation of `v` before. In other words

```
if does_construction1_work(v,k,l):
    ....
elif does_construction2_work(v,k,l):
    ...
else:
    v = factor(v)
    ...
```


Vincent


---

Comment by ncohen created at 2015-12-28 11:51:21

I'm not being passive-aggressive here, just asking the question: considering the following timings, do you think that we should care?


```
sage: %timeit [factor(i) for i in range(2,10000)]
10 loops, best of 3: 78.7 ms per loop
sage: %timeit [designs.difference_family(i,3,existence=True) for i in range(10000)]
1 loops, best of 3: 1.58 s per loop
```


I don't know if another timing makes more sense. I merely tried the first I could think of.

Nathann


---

Comment by vdelecroix created at 2015-12-28 11:54:25

Replying to [comment:6 ncohen]:
> I'm not being passive-aggressive here, just asking the question: considering the following timings, do you think that we should care?
> 
> {{{
> sage: %timeit [factor(i) for i in range(2,10000)]
> 10 loops, best of 3: 78.7 ms per loop
> sage: %timeit [designs.difference_family(i,3,existence=True) for i in range(10000)]
> 1 loops, best of 3: 1.58 s per loop
> }}}
> 
> I don't know if another timing makes more sense. I merely tried the first I could think of.
 
This is more about code organization rather than timings. The previous version of the code was

```
D = None
... # try some stuff
if D is None:
    ... # try other stuff
if D is None:
    ... # try another one
```



---

Comment by ncohen created at 2015-12-28 11:57:10

> This is more about code organization rather than timings.

If we chose to not care about this call to 'factor', could we have something like that?


```
f = factor(v)
if does_construction1_work(v,k,l):
    ....
elif does_construction2_work(v,k,l):
    ...
elif <tests involving f>:
    ...
elif <tests involving f>:
    ...
return False
```



---

Comment by ncohen created at 2015-12-28 11:58:20

Err: to make it clear: I did not mean that your changes should be reverted because the call to 'factor' was negligible. Quite the contrary --> can we go even further?


---

Comment by git created at 2015-12-28 12:06:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2015-12-28 12:08:42

done. But there is still something annoying at the begining with the construction of the finite field `K`.


---

Comment by ncohen created at 2015-12-28 13:32:02

Hello again,

I have been staring for a while at the parameters v,k,l, looking for a way to avoid the database. Now number theory really isn't my thing, but I wonder about that: shouldn't the gcd of 'v,l,m' be *very* close to `q^s`? Actually, in the factorization of `gcd(v,l,m)` into `pi,si`, aren't we sure that `q^s` is equal to the largest value of `pi^si`.

Actually (please tell me if I am wrong) by developping k as a series I get that `k=lambda+q^(2s)`, thus `gcd(lambda,k)` is a power of `q` greater than `q^s` (because both k and l can be divided by `q^s`).

I'm getting very convinced that `q^s` is actually equal to `gcd(lambda,k)`.

Well, what do you think? `:-/`

Nathann


---

Comment by ncohen created at 2015-12-28 13:56:36

(all this, however, depends on whether I added the missing ')' where it belongs in the explicit formula for 'k' that you provide in `mcfarland_1973_construction`)


---

Comment by ncohen created at 2015-12-28 14:38:31

Just noticed that I was an idiot. Instead of computing gcd, isn't `g^s` equal to `sqrt(k-l)`? `:-P`


---

Comment by ncohen created at 2015-12-28 17:09:08

Just another note: if one can obtain `q^s` with `sqrt(k-l)`, then one can get the value of `q`. It looks easy: `k/l` is equal to `(q<sup>{s+1}-1)/(q</sup>s-1)`. Thus we can compute `kq^s/l` which is equal to `q^{s+1}-1` and so compute `q^{s+1}`, which we can divide by `q^s` to get `q`.


---

Comment by git created at 2015-12-28 18:14:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2015-12-28 18:16:34

You are right. The only problem is actually to compute `s` from `qs` and `q`... I used `is_prime_power` twice and opened #19792 to implement a better solution.

Vincent


---

Comment by ncohen created at 2015-12-29 10:36:55

Input block.


---

Comment by git created at 2015-12-29 10:50:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2015-12-29 11:17:23

Hello again,

I pushed a couple of modifications at `public/19778`. [A typo here/a comment there], though I also added a couple of checks in a test, and multiplied by (q-1) instead of using `// (q-1)`, just in case the integer division may make equal two values which should not be. I also used 'izip' in a loop somewhere: you are welcome to revert it if you do not like it, and to change the ticket's status when you are satisfied with the code.

Thanks for this addition! I will not get a look at the ticket above this one.

Nathann


---

Comment by git created at 2015-12-29 11:23:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2015-12-29 11:24:17

Thanks for your commits. This is fine for me. (I avoided to merge with the last beta).


---

Comment by vdelecroix created at 2015-12-29 11:24:57

Changing status from needs_review to positive_review.


---

Comment by ncohen created at 2015-12-29 11:25:13

You are still in 6.x?


---

Comment by vbraun created at 2015-12-29 17:53:08

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2015-12-29 17:53:08

merge conflict


---

Comment by vdelecroix created at 2015-12-29 17:58:41

Do you have an idea of the conflicter?


---

Comment by ncohen created at 2015-12-30 16:04:11

Beta2 is out, and the "conflicter" is this `f*******` "upper case" ticket #19789.

It seems that others are on the way, for Eulerian, Hamiltonian, Abelian, ...

People have time to waste.

Nathann


---

Comment by dimpase created at 2015-12-31 09:00:14

Replying to [comment:27 ncohen]:
> Beta2 is out, and the "conflicter" is this `f*******` "upper case" ticket #19789.
> 
> It seems that others are on the way, for Eulerian, Hamiltonian, Abelian, ...
> 
> People have time to waste.

Other people might need to learn to spell, you know...


---

Comment by ncohen created at 2015-12-31 09:03:31

> Other people might need to learn to spell, you know...

I have received complaints because my posts on sage-devel had a space before "!?;:", and that while it is the rule in french it is not so in english.

You and I are both right.

Nathann


---

Comment by dimpase created at 2015-12-31 09:08:02

Replying to [comment:29 ncohen]:
> > Other people might need to learn to spell, you know...
> 
> I have received complaints because my posts on sage-devel had a space before "!?;:", and that while it is the rule in french it is not so in english.
> 
> You and I are both right.

depending on the language: e.g. "Def blah():" is wrong in Python...


---

Comment by dimpase created at 2015-12-31 09:18:56

rebased...


---

Comment by dimpase created at 2015-12-31 09:18:56

Changing status from needs_work to needs_review.


---

Comment by ncohen created at 2015-12-31 09:21:48

AAAAAAAnd now by magic you have commits of ticket #19777 in this branch.


---

Comment by dimpase created at 2015-12-31 09:27:28

ohh, I swear I took clean (?) develop branch with 7.0.beta2...


---

Comment by dimpase created at 2015-12-31 10:03:51

OK, mea culpa, I have had these #19777 commits merged. However, I cannot seem to be able to rebase to get rid of them - even if I check out clean develop, get this public/19778beta2 branch, and try 
`git rebase develop -i`, I see

```
pick 4d2c2f4 trac #19777: Three new SRGs and db update
pick 93bd357 trac #19777: Convert the other 2-intersection set
pick 14bdcab Trac 19778: McFarland 1973 difference set construction
pick 8bd17be Trac 19778: input blocks
pick b3dd88a Trac 19778: code reorganization in difference_family
pick 04c7acf Trac 19778: get rid of mcfarland_1973_parameters
pick 8fe3844 Trac 19778: input block
pick cf852fa trac #19778: Reviewer's commit
pick b582040 trac #19778: DOI

# Rebase 036455f..e8bc5ca onto 036455f
...
```

now I delete the top two lines (the 19777 commits) and proceed, and get

```
$ git rebase develop -i
error: could not apply 14bdcab... Trac 19778: McFarland 1973 difference set construction
...
```

which makes no freaking sense to me. Note that for some reason I don't even see my last commit
from public/19778beta2 (commit e8bc5ca4... "it is now one Ring to rule them all")
in this list, even though it is duly in the branch.


---

Comment by git created at 2015-12-31 10:07:39

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by dimpase created at 2015-12-31 10:10:36

OK, removed that 19777...


---

Comment by vdelecroix created at 2016-01-22 01:08:40

Are we good?


---

Comment by ncohen created at 2016-01-22 11:39:12

You can switch the status yourself I guess: Dima is the one who merged it.

Nathann


---

Comment by vdelecroix created at 2016-01-22 12:11:38

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-01-23 20:42:33

Resolution: fixed
