# Issue 25197: Path_Tableaux

Issue created by migration from Trac.

Original creator: Bruce

Original creation time: 2018-05-23 20:28:21

CC:  sage-combinat tscrim mantepse aschilling deinst kdilks




---

Comment by Bruce created at 2018-05-23 21:11:43

I have been unable to push my commits. I get Permission Denied. I will try again in the morning.


---

Comment by tscrim created at 2018-05-24 08:12:11

Changing type from PLEASE CHANGE to enhancement.


---

Comment by tscrim created at 2018-05-24 08:12:11

Changing component from PLEASE CHANGE to combinatorics.


---

Comment by Bruce created at 2018-05-24 09:48:07

Set assignee to Bruce.


---

Comment by embray created at 2018-05-24 19:48:19

It seems there was something about this branch causing the git merge plugin to break so I have deleted the branch for now and will investigate further later.


---

Comment by embray created at 2018-05-24 19:49:17

It seems the branch was just the current `develop` with no new commits on it, so maybe something about that scenario broke the plugin.


---

Comment by Bruce created at 2018-05-24 19:55:32

Replying to [comment:7 embray]:
> It seems the branch was just the current `develop` with no new commits on it, so maybe something about that scenario broke the plugin.

Thanks for sorting that out. I struggled to follow the instructions and no doubt got it messed up.


---

Comment by @darijgr created at 2018-05-30 16:59:40

New commits:


---

Comment by git created at 2018-05-30 19:01:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-05-30 20:45:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by embray created at 2018-05-31 09:59:03

Replying to [comment:8 Bruce]:
> Replying to [comment:7 embray]:
> > It seems the branch was just the current `develop` with no new commits on it, so maybe something about that scenario broke the plugin.
> 
> Thanks for sorting that out. I struggled to follow the instructions and no doubt got it messed up.

No problem, not your fault at all.


---

Comment by git created at 2018-05-31 16:39:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-06-05 07:10:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-06-10 13:38:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by Bruce created at 2018-06-10 13:57:06

I now have the basic functionality in the two implementations I have committed. I would appreciate some feedback before I commit other implementations. I have attempted to explain the purpose of this project but no doubt I could do better.


---

Comment by Bruce created at 2018-06-10 13:57:06

Changing status from new to needs_review.


---

Comment by tscrim created at 2018-06-12 03:09:49

Changing status from needs_review to needs_work.


---

Comment by tscrim created at 2018-06-12 03:09:49

I strongly believe that `PathTableaux` should not be a category. You should just have an abstract base class (ABC) for the `*Tableau` objects (the `ElementMethods` is currently playing this role, but you're using a sledgehammer in place of a ball-peen). It is something that is easy to change back if there becomes a practical use/need for the category, but I think it puts more distance between the concrete class and the ABC code, which makes it harder to maintain.

At this point, I am thinking it might be best to make a new folder in the `combinat` folder called `tableau` with your new code (one file for the ABC and your other two files). Then it will become the eventual home for all tableau files (but moving those should be done on separate tickets).

Some other misc comments:

- What is this doing here: `#!/usr/bin/env python2`?
- I would call the method `plot` instead of `draw`.
- Your `drawL` and `drawC` might be best as separate standalone functions in the ABC file. Otherwise if you feel that they should be methods, then make them hidden by calling them `_drawL` and `_drawC`.
- I don't see the point of having `draw_partition` in `drawL` as an internal helper function (in `drawC`, it makes sense because of the two `for` loops and avoiding code duplication).
- There are a bunch of malformatted docstrings (`EXAMPLES:` -> `EXAMPLES::` (or missing altogether) when followed by code, which should be indented by 1), and some that should be at the class level or at the top of the module.
- The copyright should be comments, not part of the docstring.


---

Comment by git created at 2018-06-12 10:54:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by Bruce created at 2018-06-12 11:10:44

Hi Travis, Thank you for the feedback.

"At this point, I am thinking it might be best to make a new folder in the combinat folder called tableau with your new code (one file for the ABC and your other two files). Then it will become the eventual home for all tableau files (but moving those should be done on separate tickets)."

Could you please expand on this? I understand your suggestion to use an ABC instead of a category.
I am not clear on how this should be done within the trac system.
I understand that I could open a new ticket, copy the files by hand,
and at some point delete the existing ticket. However I suspect you may mean a different approach.

Is the first step to create a new ticket with the new folder called tableau containing just one
file with the ABC?


---

Comment by @darijgr created at 2018-06-12 11:12:19

You can keep making commits and pushing to the same branch (and set the ticket back to needs_review once you're done fixing the issues you're aware of).


---

Comment by git created at 2018-06-12 12:46:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-06-12 12:53:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-06-12 14:18:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-06-12 15:13:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-06-13 14:53:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-06-13 17:17:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by Bruce created at 2018-06-13 17:24:07

Changing status from needs_work to needs_info.


---

Comment by Bruce created at 2018-06-13 17:24:07

I have made the changes suggested by Travis, including removing the Category and using an ABC instead.
I am working on missing doctests. I would appreciate further feedback.


---

Comment by Bruce created at 2018-07-26 12:45:53

Changing status from needs_info to needs_review.


---

Comment by git created at 2018-07-26 13:23:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-07-26 18:12:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-07-27 14:07:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-07-27 16:47:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-07-27 19:40:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bsalisbury1 created at 2018-07-27 19:41:13

Changing status from needs_review to positive_review.


---

Comment by kdilks created at 2018-07-27 19:47:53

Is `from sage.combinat.pathtableau.all import *` right? I don't think the .all is supposed to be there. Tried to run patchbot and immediately crashed because of that.


---

Comment by git created at 2018-07-27 19:50:20

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by git created at 2018-07-27 19:50:20

Changing status from positive_review to needs_review.


---

Comment by git created at 2018-07-27 19:56:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bsalisbury1 created at 2018-07-27 20:05:03

Changing status from needs_review to positive_review.


---

Comment by kdilks created at 2018-07-27 21:46:03

For python 3 compatability, the two print commands in `commutor()` should be changed from 'print stuff' to 'print(stuff)' .


---

Comment by Bruce created at 2018-07-27 22:32:05

The method _rule_ should have `@`staticmethod (before `@`abstractmethod)


---

Comment by Bruce created at 2018-07-27 22:32:30

There should be references.


---

Comment by tscrim created at 2018-07-29 03:11:11

I also think we should rename `_rule_` -> `_rule` as methods with a leading and trailing underscores (`_`) are generally considered as special Sage functions.

In addition to the Python3 compatibility mentioned in commment:43, the test for `dual_equivalence_graph` seems quite brittle. It would be better to explicitly construct the graph and compare it by isomorphism.

I don't see why you have a `PathTableaux` class. It look like it is a very malformed parent.


---

Comment by tscrim created at 2018-07-29 03:11:11

Changing status from positive_review to needs_work.


---

Comment by embray created at 2018-07-30 16:37:40

I would also like to test this ticket on top of my python 3 branch, but that is up to me to do.  Not that python 3 is technically supported yet, so if there are any significant issues in _other_ parts of Sage that affect this code on python 3 then I won't worry about it.  But it would be nice to keep significant new code forward-compatible where possible.


---

Comment by git created at 2018-08-31 14:06:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by Bruce created at 2018-08-31 17:52:05

Replying to [comment:46 tscrim]:

> the test for `dual_equivalence_graph` seems quite brittle. It would be better to explicitly construct the graph and compare it by isomorphism.
I understand this to mean my code could construct the wrong graph but this test would not notice
if it happened to have the same adjacency matrix. Really? or did you mean something else?
> I don't see why you have a `PathTableaux` class. It look like it is a very malformed parent.
Could you please expand on this? I take malformed to be pejorative. I will want these to be (finite) enumerated sets but I haven't thought this through yet.


---

Comment by Bruce created at 2018-08-31 17:54:16

Replying to [comment:48 Bruce]:
This takes care of comments 44, 45 and the first sentence in 47.


---

Comment by Bruce created at 2018-08-31 17:55:32

Replying to [comment:49 git]:

This takes care of comment 46.


---

Comment by Bruce created at 2018-08-31 18:14:33

It seems I could use `RecursivelyEnumeratedSet()` to give a generic enumeration.
Just because I can do something doesn't mean I should.

Does anyone think this would be reasonable? or unreasonable?


---

Comment by mantepse created at 2018-08-31 18:23:12

You could have a look at #25173, where I have done this for staircase tableaux.  Also, I am a bit surprised that you do not reference our joint paper, I must say.


---

Comment by Bruce created at 2018-08-31 19:32:34

Replying to [comment:54 mantepse]:
> You could have a look at #25173, where I have done this for staircase tableaux.  Also, I am a bit surprised that you do not reference our joint paper, I must say.

Is there any code for #25173 (apart from `sl3webs.sage`? or is it a "wish list"?

I will refer to our joint paper in the relevant implementations. At the moment I am concentrating
on getting a positive review for the ABC and the toy implementation.


---

Comment by mantepse created at 2018-08-31 19:33:57

`sl3webs.sage` contains (possibly) relevant code.  Just look for "RecursivelyEnumeratedSet"!


---

Comment by git created at 2018-09-01 10:42:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-09-01 12:04:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-09-01 12:50:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by Bruce created at 2018-09-01 12:52:59

Changing status from needs_work to needs_review.


---

Comment by Bruce created at 2018-09-16 21:01:14

Changing status from needs_review to needs_work.


---

Comment by Bruce created at 2018-09-17 09:05:10

I am working on implementing RecursiveEnumeratedSets and introducing Parents whose category is EnumeratedSets. I am struggling as I don't have an example to follow; DyckWords is the nearest I have found but this uses a deprecated backtracker.


---

Comment by git created at 2018-09-20 17:33:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-09-27 18:41:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-09-28 11:18:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @BruceWestbury created at 2018-09-28 11:26:08

Changing status from needs_work to needs_review.


---

Comment by @BruceWestbury created at 2018-09-28 11:26:08

I have now made all modifications following conversations at ICERM and subsequent comments.
The only one I am not sure about is whether I have correctly dealt with Travis' comment on
"malformed parents".

I would be grateful for a review.


---

Comment by tscrim created at 2018-09-28 21:38:00

Changing status from needs_review to needs_work.


---

Comment by tscrim created at 2018-09-28 21:38:00

Now you have a proper parent and element. So that part is a good improvement over trying to do things with categories.

A naming convention, you should call the folder `path_tableaux`. For filenames, etc. that are all lowercase, words are separated by underscores `_`.

I believe you are better using `ClonableArray` instead of `ClonableList` because your object should be a fixed length because it is effectively immutable.

All methods need a doctest, including `__classcall_private__` and the abstract `_local_rule`.

Instead of `display`, the somewhat standard argument name is `verbose`.

I think your `__getattr__` hack is dangerous and violates the principle of least surprise. It is dangerous because suppose you have two `PathTableau` that convert to each other but neither implements a given method. My understanding is that would lead to an infinite loop. It is also slow because it has to do and then check for each such conversion. Nor does not dispatch to base classes, which might interfere with some of the hacks of the category framework (I would have to check this one specifically, but this might not be an issue because this is not a Cython class).

This is also extremely brittle as it depends heavily on implementations in other unrelated classes (violating code locality) and the result depends strongly on the order of `_conversions`. Which brings me to the violation the principle of least surprise. Suddenly you get a `DyckPath` instead of a `PathTableau` when asking for a method that might be natural or nonsense:

```
sage: t = CatalanTableau([0,1,2,3,2,1,0])
sage: t.to_DyckWord()
[1, 1, 1, 0, 0, 0]
sage: _.reverse()
[1, 1, 1, 0, 0, 0]
sage: t.reverse()
[1, 1, 1, 0, 0, 0]
```

These are `PathTableau`, so either you implement methods directly there or you explicitly convert.

The rest of it mostly looks good other than perhaps a few small formatting tweaks. I can address those once the above is taken care of.


---

Comment by git created at 2018-12-01 15:15:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-12-01 15:31:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by Bruce created at 2018-12-01 15:33:47

Changing status from needs_work to needs_review.


---

Comment by Bruce created at 2018-12-01 15:33:47

I believe I have taken care of Travis' comments.


---

Comment by git created at 2018-12-24 00:26:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by kdilks created at 2019-02-11 11:28:10

Realized that I should probably focus on this one before (or at least concurrently with) oscillating tableau. Travis has hopefully covered all the bases in terms of the programming technicalities (and should probably confirm before this gets a final positive review), I'll focus more on doc/usability.

Some of my previous comments from oscillating tableau actually apply to this ticket (I didn't realize this ticket was being pulled into oscillating tableau ticket as a dependency).

* Adding the underscores to the folder/file names requires a few other lines to be changed. In `src/doc/en/reference/combinat/module_list.rst`, the line `sage/combinat/pathtableau/catalan` needs to be updated to `sage/combinat/path_tableau/catalan`. Also, `sage/combinat/pathtableau/pathtableaux` needs to be updated to `sage/combinat/path_tableau/path_tableaux`. Finally, in CatalanTableaux, the link `:class:`sage.combinat.pathtableau.pathtableaux`` needs to be updated to `:class:`sage.combinat.path_tableau.path_tableaux``.

* As with OscillatingTableaux, the docstrings for CatalanTableaux need to be moved from _classcall_private_ up to the class itself.

* `descents` method needs some sort of definition, because in particular, whatever definition is used here doesn't agree with my first idea of what it should be (i appearing in a row below i+1 in the associated two row tableau.

* `to_perfect_matching` should first check to see if the tableau is skew, and give an appropriate error message (rather than having the call to DyckWord fail). Furthermore, if you input something that doesn't end at 0 (corresponding to a two-row tableau with uneven rows), the code still returns a perfect matching, and I'm not sure this is desired behavior.

* I would modify `to_tableau` some, because it should be possible to have this return a StandardTableau in the case where you start with 0 and aren't actually skew. I would have the default behavior check `is_skew`, and then use the appropriate constructor. I suppose there could be situations where you always want your output to use the SkewTableau constructor, so there could be some optional parameter like skew=False that you could set to be True if you always wanted to use the SkewTableau constructor.


* PathTableaux needs some kind of general definition of what path tableaux actually are. It should appear both with the current description of what it's trying to abstract (which should appear at the top of the documentation page for the module), and also for the PathTableau class itself (so it will show up when viewing PathTableau? ).

* Right now, there's just a method to apply the action of a single cactus group generator. It may be useful to have a method that would take a list/sequence of generators and apply them successively.

* The method `commutor` should give some kind of general definition of what the commutor actually is.


---

Comment by git created at 2019-02-13 20:29:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-02-25 21:31:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-11 13:55:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2019-07-12 16:04:54

`EXAMPLE::` -> `EXAMPLES::` which should also have a blankline after it.

Many methods do not have doctests.

Remove the `CylndricalDiagram.__str__` and change the `__repr__` -> `_repr_`. You should also implement an `_ascii_art_` (and possibly a `_unicode_art_`) and have `pp` call that.

For the `_test_involution`, I would move the `all` out and do an explicit `for` loop that tests each pair (better control of what fails). Also this way you can also use `tester._max_runs` in case `size()` is really big.

`PathTableau` should inherit from `ClonableArray`. IMO your divider comments in that class should be indented to make it easier to read too.

I don't see the point of the `_rule` function in `_local_rule`. Just put that in the `for` loop.

What follows after an `INPUT:` block should *not* be indented.

The docstring for `catalan.py` should be first, not the copyright


---

Comment by tscrim created at 2019-07-12 16:04:54

Changing keywords from "" to "fpsac2019".


---

Comment by tscrim created at 2019-07-12 16:04:54

Changing status from needs_review to needs_work.


---

Comment by git created at 2019-07-30 07:51:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2019-09-28 23:59:25

Is this suppose to be back to needs review?


---

Comment by chapoton created at 2019-09-29 07:36:45

* never use `EXAMPLES::` twice in the doc for one method or function

* There is a missing empty line after one `EXAMPLES::`

* please do not add empty methods


---

Comment by embray created at 2019-12-30 14:48:17

Ticket retargeted after milestone closed


---

Comment by mkoeppe created at 2020-04-14 19:41:51

Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.


---

Comment by git created at 2020-04-30 13:05:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by Bruce created at 2020-04-30 13:10:48

I have improved the coverage of documentation and testing in response to comments by Scrimshaw and Chapoton. There were some places where I was not confident I was getting it right.


---

Comment by Bruce created at 2020-04-30 13:11:13

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2020-05-01 07:58:13

Looking at the patchbot report, one sees:

In the first lines of method docs, replace "Returns" by "Return":

```
++        Returns a string representation of ``self``
++        Returns a `\LaTeX` representation of ``self``
++        Returns an ascii art representation of ``self``
++        Returns a unicode art representation of ``self``
```


There is one function missing documentation:

```
+combinat/path_tableaux/path_tableau.py: 95.8% (23 of 24)
```


Moreover, by a quick look at the ticket:

Also, always have an empty line after the first line of the doc of any function or method.


---

Comment by git created at 2020-05-01 08:15:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by Bruce created at 2020-05-01 08:19:55

I have fixed the above.

The method without a doctest is _element_constructor_ on line 422

I am not sure when this gets called. I assume it has been called several times implicitly in the existing doctests and I don't know what an explicit doctest would do.


---

Comment by git created at 2020-05-01 08:21:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2020-05-01 18:32:42

For the element_constructor doctest, you can add one or several creations of elements, tagged with `# indirect doctest`


---

Comment by chapoton created at 2020-05-01 18:34:20

From comment:78

```
What follows after an INPUT: block should *not* be indented.
```

has not been taken care of yet.


---

Comment by chapoton created at 2020-05-01 18:45:07

Each raise statement must be triggered in one doctest. For example

```
raise ValueError("the perfect matching must be non crossing")
```



---

Comment by chapoton created at 2020-05-01 18:48:23

Still some empty lines missing, for instance

```
+        TESTS::
+            sage: CatalanTableau([0,1,0,-1,0])
```



---

Comment by git created at 2020-05-01 18:57:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-05-01 20:07:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2020-05-13 15:56:38

Travis, any opinion ? I am not sure that we want these things in the global namespace.


---

Comment by tscrim created at 2020-05-19 00:40:46

I am inclined to agree with you. It probably would be best as a catalog of the form `path_tableaux.Name` and have that be in the global namespace.

There are also a few places (e.g., in `to_word()`) that need the docstring to being `r"""` (although I would argue you should essentially always do this to be safe). 

There are also a few other places where the docstrings are not formatted for Sage (`cactus` has `$`'s, `PathTableaux` really has a one-line docstring (instead of having the `"""` on their own lines), one-line docstrings should end in a period/full-stop, etc.) However these are very minor things.


---

Comment by git created at 2020-05-19 09:39:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-05-29 14:50:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-05-30 08:26:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2020-06-03 05:40:28

I did some revisions to get everything up to Sage's standards and make the catalog be lazily imported (and the only entry point). In particular, I removed the `PathTableau[x]` from the catalog since they are ABCs.
----
New commits:


---

Comment by Bruce created at 2020-06-03 13:25:53

Thanks Travis.


---

Comment by git created at 2020-06-03 23:19:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2020-06-05 00:39:32

Green patchbot.


---

Comment by tscrim created at 2020-06-15 04:58:21

So are my changes good? Is this a positive review?


---

Comment by tscrim created at 2020-06-15 05:04:57

One more thing that needs to be done: the `DyckPaths` needs an `_an_element_` method. Then you can change this test, which is wrong:

```diff
-            sage: t = path_tableaux.DyckPath([0,1,2,1,0])
+            sage: t = path_tableaux.DyckPaths()
             sage: TestSuite(t).run()
```



---

Comment by tscrim created at 2020-06-15 05:04:57

Changing status from needs_review to needs_work.


---

Comment by git created at 2020-06-15 12:32:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by Bruce created at 2020-06-15 12:55:50

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2020-06-15 22:57:42

Thank you.


---

Comment by tscrim created at 2020-06-15 22:57:42

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2020-06-22 22:34:35

Resolution: fixed
