# Issue 16194: Run sync-build before docbuild

Issue created by migration from Trac.

Original creator: vbraun

Original creation time: 2014-06-03 11:09:57

CC:  leif




---

Comment by vbraun created at 2014-06-03 12:49:59

Changing type from PLEASE CHANGE to defect.


---

Comment by vbraun created at 2014-06-03 12:49:59

Changing component from PLEASE CHANGE to build.


---

Comment by vbraun created at 2014-06-04 14:04:20

New commits:


---

Comment by vbraun created at 2014-06-04 14:04:20

Changing status from new to needs_review.


---

Comment by mathzeta2 created at 2014-06-04 14:42:02

I'm not up to review this, but I do have two questions:
1. Why not remove `-ba-force` if it is exactly the same as `-ba`? At least its description should be updated.
2. In `find_python_sources` and `installed_files_by_module` the use `os.chdir` seems uneeded. Can we just use a different argument to `os.walk`?


---

Comment by vbraun created at 2014-06-04 15:04:10

1. removal needs deprecation etc. Really it doesn't hurt to keep that alias around.
2. its faster to construct the right relative path from the get-go than having to strip off a leading component.


---

Comment by git created at 2014-06-04 15:47:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by leif created at 2014-06-04 16:42:31

I think you can remove the `sdist` variable entirely from `setup.py`, i.e., also

```python
if len(sys.argv) > 1 and sys.argv[1] == "sdist":
    sdist = True
else:
    sdist = False
```



---

Comment by vbraun created at 2014-06-04 17:56:57

Yes, the setup.py should be broken up and doctested. And we need to decide whether we want to support sdist or not (in which case the Manifest.in can probably go, too). But thats for another ticket.


---

Comment by leif created at 2014-06-04 18:28:12

Replying to [comment:12 vbraun]:
> And we need to decide whether we want to support sdist or not (in which case the Manifest.in can probably go, too).

Is that (still) used anywhere in Sage?  (I mean calling _Sage's_ `setup.py` with `sdist`.)


---

Comment by vbraun created at 2014-06-04 18:31:25

Off-topic, but as far as I know we don't currently use distutils `sdist` anywhere.


---

Comment by leif created at 2014-06-04 18:46:29

Just for the record:  This doesn't fix my docbuild-broken upgraded Sage version (but I didn't really expect it to either; I think it's rather some Sphinx-brokenness w.r.t. Python's multiprocessing).


---

Comment by vbraun created at 2014-06-04 19:03:19

No, thats fixed in #16440


---

Comment by ohanar created at 2014-06-06 04:36:20

Mostly looks good, I haven't checked cython modules, but it doesn't seem like it really handles them at the moment (which would agree with some TODO I think I read in the documentation of some function). Are you planning on adding support for them at the moment, or on a future ticket?

I added a few minor reviewer changes.
----
New commits:


---

Comment by vbraun created at 2014-06-06 10:43:10

Just to clarify: Building / cleaning of Cython modules works. Only the doctest that no cython files are being cleaned after a successful build needs work. In particular, the `module_list.py` would need to be importable **after** building. Could be done with a sys.path hack, but I'd rather do it properly later on.


---

Comment by vbraun created at 2014-06-06 10:44:04

PS: any further functionality should go to a future ticket.


---

Comment by ohanar created at 2014-06-07 06:54:55

Ah, yes. Looking at it again, seems fine. Everything works as expected.


---

Comment by ohanar created at 2014-06-07 06:54:55

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-06-08 12:09:02

Resolution: fixed
