# Issue 16194: Run sync-build before docbuild

archive/issues_016194.json:
```json
{
    "body": "CC:  @nexttime\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/16431\n\n",
    "created_at": "2014-06-03T11:09:57Z",
    "labels": [
        "component: please change"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.3",
    "title": "Run sync-build before docbuild",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16194",
    "user": "https://github.com/vbraun"
}
```
CC:  @nexttime



Issue created by migration from https://trac.sagemath.org/ticket/16431





---

archive/issue_comments_211177.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2014-06-03T12:49:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16194#issuecomment-211177",
    "user": "https://github.com/vbraun"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_211178.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to build.",
    "created_at": "2014-06-03T12:49:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16194#issuecomment-211178",
    "user": "https://github.com/vbraun"
}
```

Changing component from PLEASE CHANGE to build.



---

archive/issue_comments_211179.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-06-04T14:04:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16194#issuecomment-211179",
    "user": "https://github.com/vbraun"
}
```

New commits:



---

archive/issue_comments_211180.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-06-04T14:04:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16194#issuecomment-211180",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_211181.json:
```json
{
    "body": "I'm not up to review this, but I do have two questions:\n1. Why not remove `-ba-force` if it is exactly the same as `-ba`? At least its description should be updated.\n2. In `find_python_sources` and `installed_files_by_module` the use `os.chdir` seems uneeded. Can we just use a different argument to `os.walk`?",
    "created_at": "2014-06-04T14:42:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16194#issuecomment-211181",
    "user": "https://github.com/mathzeta"
}
```

I'm not up to review this, but I do have two questions:
1. Why not remove `-ba-force` if it is exactly the same as `-ba`? At least its description should be updated.
2. In `find_python_sources` and `installed_files_by_module` the use `os.chdir` seems uneeded. Can we just use a different argument to `os.walk`?



---

archive/issue_comments_211182.json:
```json
{
    "body": "1. removal needs deprecation etc. Really it doesn't hurt to keep that alias around.\n2. its faster to construct the right relative path from the get-go than having to strip off a leading component.",
    "created_at": "2014-06-04T15:04:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16194#issuecomment-211182",
    "user": "https://github.com/vbraun"
}
```

1. removal needs deprecation etc. Really it doesn't hurt to keep that alias around.
2. its faster to construct the right relative path from the get-go than having to strip off a leading component.



---

archive/issue_comments_211183.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-06-04T15:47:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16194#issuecomment-211183",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_211184.json:
```json
{
    "body": "I think you can remove the `sdist` variable entirely from `setup.py`, i.e., also\n\n```python\nif len(sys.argv) > 1 and sys.argv[1] == \"sdist\":\n    sdist = True\nelse:\n    sdist = False\n```\n",
    "created_at": "2014-06-04T16:42:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16194#issuecomment-211184",
    "user": "https://github.com/nexttime"
}
```

I think you can remove the `sdist` variable entirely from `setup.py`, i.e., also

```python
if len(sys.argv) > 1 and sys.argv[1] == "sdist":
    sdist = True
else:
    sdist = False
```




---

archive/issue_comments_211185.json:
```json
{
    "body": "Yes, the setup.py should be broken up and doctested. And we need to decide whether we want to support sdist or not (in which case the Manifest.in can probably go, too). But thats for another ticket.",
    "created_at": "2014-06-04T17:56:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16194#issuecomment-211185",
    "user": "https://github.com/vbraun"
}
```

Yes, the setup.py should be broken up and doctested. And we need to decide whether we want to support sdist or not (in which case the Manifest.in can probably go, too). But thats for another ticket.



---

archive/issue_comments_211186.json:
```json
{
    "body": "Replying to [comment:12 vbraun]:\n> And we need to decide whether we want to support sdist or not (in which case the Manifest.in can probably go, too).\n\nIs that (still) used anywhere in Sage?  (I mean calling *Sage's* `setup.py` with `sdist`.)",
    "created_at": "2014-06-04T18:28:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16194#issuecomment-211186",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:12 vbraun]:
> And we need to decide whether we want to support sdist or not (in which case the Manifest.in can probably go, too).

Is that (still) used anywhere in Sage?  (I mean calling *Sage's* `setup.py` with `sdist`.)



---

archive/issue_comments_211187.json:
```json
{
    "body": "Off-topic, but as far as I know we don't currently use distutils `sdist` anywhere.",
    "created_at": "2014-06-04T18:31:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16194#issuecomment-211187",
    "user": "https://github.com/vbraun"
}
```

Off-topic, but as far as I know we don't currently use distutils `sdist` anywhere.



---

archive/issue_comments_211188.json:
```json
{
    "body": "Just for the record:  This doesn't fix my docbuild-broken upgraded Sage version (but I didn't really expect it to either; I think it's rather some Sphinx-brokenness w.r.t. Python's multiprocessing).",
    "created_at": "2014-06-04T18:46:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16194#issuecomment-211188",
    "user": "https://github.com/nexttime"
}
```

Just for the record:  This doesn't fix my docbuild-broken upgraded Sage version (but I didn't really expect it to either; I think it's rather some Sphinx-brokenness w.r.t. Python's multiprocessing).



---

archive/issue_comments_211189.json:
```json
{
    "body": "No, thats fixed in #16440",
    "created_at": "2014-06-04T19:03:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16194#issuecomment-211189",
    "user": "https://github.com/vbraun"
}
```

No, thats fixed in #16440



---

archive/issue_comments_211190.json:
```json
{
    "body": "Mostly looks good, I haven't checked cython modules, but it doesn't seem like it really handles them at the moment (which would agree with some TODO I think I read in the documentation of some function). Are you planning on adding support for them at the moment, or on a future ticket?\n\nI added a few minor reviewer changes.\n----\nNew commits:",
    "created_at": "2014-06-06T04:36:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16194#issuecomment-211190",
    "user": "https://github.com/ohanar"
}
```

Mostly looks good, I haven't checked cython modules, but it doesn't seem like it really handles them at the moment (which would agree with some TODO I think I read in the documentation of some function). Are you planning on adding support for them at the moment, or on a future ticket?

I added a few minor reviewer changes.
----
New commits:



---

archive/issue_comments_211191.json:
```json
{
    "body": "Just to clarify: Building / cleaning of Cython modules works. Only the doctest that no cython files are being cleaned after a successful build needs work. In particular, the `module_list.py` would need to be importable **after** building. Could be done with a sys.path hack, but I'd rather do it properly later on.",
    "created_at": "2014-06-06T10:43:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16194#issuecomment-211191",
    "user": "https://github.com/vbraun"
}
```

Just to clarify: Building / cleaning of Cython modules works. Only the doctest that no cython files are being cleaned after a successful build needs work. In particular, the `module_list.py` would need to be importable **after** building. Could be done with a sys.path hack, but I'd rather do it properly later on.



---

archive/issue_comments_211192.json:
```json
{
    "body": "PS: any further functionality should go to a future ticket.",
    "created_at": "2014-06-06T10:44:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16194#issuecomment-211192",
    "user": "https://github.com/vbraun"
}
```

PS: any further functionality should go to a future ticket.



---

archive/issue_comments_211193.json:
```json
{
    "body": "Ah, yes. Looking at it again, seems fine. Everything works as expected.",
    "created_at": "2014-06-07T06:54:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16194#issuecomment-211193",
    "user": "https://github.com/ohanar"
}
```

Ah, yes. Looking at it again, seems fine. Everything works as expected.



---

archive/issue_comments_211194.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-06-07T06:54:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16194#issuecomment-211194",
    "user": "https://github.com/ohanar"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_211195.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-06-08T12:09:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16194#issuecomment-211195",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
