# Issue 17625: Remove use of PY_IS_NUMERIC

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2015-02-26 14:51:59




---

Comment by jdemeyer created at 2015-02-26 16:15:11

Last 10 new commits:


---

Comment by jdemeyer created at 2015-02-26 16:15:11

Changing status from new to needs_review.


---

Comment by vdelecroix created at 2015-02-26 17:37:41

Could we get rid in the same ticket of `_native_coercion_ranks_inv` and `_native_coercion_ranks` and use `coerce` from Python

```
>>> coerce(True, 1l)
(1L, 1L)
>>> coerce(complex(0,1), 1.0)
(1j, (1+0j))
```

Or even better [PyNumber_Coerce](https://docs.python.org/2/c-api/number.html#c.PyNumber_Coerce) from the C API.


---

Comment by jdemeyer created at 2015-02-26 21:26:08

Can you make a new ticket for that instead?


---

Comment by vdelecroix created at 2015-02-26 22:31:00

Replying to [comment:4 jdemeyer]:
> Can you make a new ticket for that instead?

Yes #17865


---

Comment by vdelecroix created at 2015-02-27 12:57:42

I just have two remarks but not for this ticket I guess:

- Don't we want to use faster functions in `py_scalar_to_element`?

- It is clear that we want compatibility between `structure.coerce.py_scalar_parent` and `structure.element.py_scalar_to_element`. I do not like the fact that these two functions belong to two different files and do not call each other in their doctests.


---

Comment by jdemeyer created at 2015-02-27 13:14:19

Replying to [comment:6 vdelecroix]:
> I just have two remarks but not for this ticket I guess:
> 
> - Don't we want to use faster functions in `py_scalar_to_element`?
If you mean functions like `PyFoo_Check()`: Cython knows them too, it will generate calls to `PyFoo_Check()` in `isinstance`.

> - It is clear that we want compatibility between `structure.coerce.py_scalar_parent` and `structure.element.py_scalar_to_element`. I do not like the fact that these two functions belong to two different files and do not call each other in their doctests.
Good point.


---

Comment by vdelecroix created at 2015-02-27 13:18:15

Replying to [comment:8 jdemeyer]:
> Replying to [comment:6 vdelecroix]:
> > I just have two remarks but not for this ticket I guess:
> > 
> > - Don't we want to use faster functions in `py_scalar_to_element`?
> If you mean functions like `PyFoo_Check()`: Cython knows them too, it will generate calls to `PyFoo_Check()` in `isinstance`.

Nope. I meant the conversion `Python int` -> `Sage integer` and such. The `import` takes quite a long time and `ZZ(x)` is suboptimal to create an integer.


---

Comment by git created at 2015-02-28 09:11:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2015-02-28 09:13:53

I moved `py_scalar_to_element` to `coerce.pyx`, but I couldn't improve the conversion because of circular import problems.


---

Comment by vdelecroix created at 2015-02-28 10:46:46

I did not know

```
sage: isinstance(True,int)
True
```

Do we really want the `bool -> Integer` to happen within Sage? We can do an exact type check instead. That would break support for subtyped Python base classes though. Another drawback is that it would not be possible anymore to count like

```
sage: sum((x >= 3 for x in my_list), ZZ(0))
```

So I am in favor of your solution.

For the speed-up, that is not dramatic.

I changed the doc to make the link `:class:`Element`` works. I am ok for positive review.
----
New commits:


---

Comment by jdemeyer created at 2015-02-28 10:49:20

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-02-28 21:24:12

Resolution: fixed
