# Issue 32791: Unstable doctests in src/sage/matrix/matrix_double_sparse.pyx

Issue created by migration from https://trac.sagemath.org/ticket/33028

Original creator: @kliem

Original creation time: 2021-12-15 17:55:35


```
sage -t --long --random-seed=242043045154948369626155687009615246554 src/sage/matrix/matrix_double_sparse.pyx
**********************************************************************
File "src/sage/matrix/matrix_double_sparse.pyx", line 95, in sage.matrix.matrix_double_sparse.Matrix_double_sparse.cholesky
Failed example:
    L = A.cholesky()
Exception raised:
    Traceback (most recent call last):
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.matrix.matrix_double_sparse.Matrix_double_sparse.cholesky[20]>", line 1, in <module>
        L = A.cholesky()
      File "sage/matrix/matrix_double_sparse.pyx", line 110, in sage.matrix.matrix_double_sparse.Matrix_double_sparse.cholesky (build/cythonized/sage/matrix/matrix_double_sparse.c:2820)
        raise ValueError("matrix is not Hermitian")
    ValueError: matrix is not Hermitian
**********************************************************************
File "src/sage/matrix/matrix_double_sparse.pyx", line 96, in sage.matrix.matrix_double_sparse.Matrix_double_sparse.cholesky
Failed example:
    (A - L*L.H).norm(1) < 1e-10
Exception raised:
    Traceback (most recent call last):
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.matrix.matrix_double_sparse.Matrix_double_sparse.cholesky[21]>", line 1, in <module>
        (A - L*L.H).norm(Integer(1)) < RealNumber('1e-10')
      File "sage/structure/element.pyx", line 1358, in sage.structure.element.Element.__sub__ (build/cythonized/sage/structure/element.c:11603)
        return coercion_model.bin_op(left, right, sub)
      File "sage/structure/coerce.pyx", line 1248, in sage.structure.coerce.CoercionModel.bin_op (build/cythonized/sage/structure/coerce.c:11751)
        raise bin_op_exception(op, x, y)
    TypeError: unsupported operand parent(s) for -: 'Full MatrixSpace of 2 by 2 sparse matrices over Complex Double Field' and 'Full MatrixSpace of 3 by 3 sparse matrices over Real Double Field'
**********************************************************************
File "src/sage/matrix/matrix_double_sparse.pyx", line 99, in sage.matrix.matrix_double_sparse.Matrix_double_sparse.cholesky
Failed example:
    (B.cholesky() - L).norm(1) < 1e-10
Exception raised:
    Traceback (most recent call last):
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.matrix.matrix_double_sparse.Matrix_double_sparse.cholesky[23]>", line 1, in <module>
        (B.cholesky() - L).norm(Integer(1)) < RealNumber('1e-10')
      File "sage/matrix/matrix2.pyx", line 12633, in sage.matrix.matrix2.Matrix.cholesky (build/cythonized/sage/matrix/matrix2.c:84977)
        raise ValueError("matrix is not Hermitian")
    ValueError: matrix is not Hermitian
**********************************************************************
1 item had failures:
   3 of  25 in sage.matrix.matrix_double_sparse.Matrix_double_sparse.cholesky
    [28 tests, 3 failures, 0.04 s]
----------------------------------------------------------------------
sage -t --long --random-seed=242043045154948369626155687009615246554 src/sage/matrix/matrix_double_sparse.pyx  # 3 doctests failed
```



---

Comment by @kliem created at 2021-12-15 18:00:42

Changing status from new to needs_review.


---

Comment by mjo created at 2021-12-15 20:59:27

Changing status from needs_review to positive_review.


---

Comment by @collares created at 2021-12-16 22:17:18

By the way, was this also on aarch64?


---

Comment by mkoeppe created at 2022-01-08 21:27:14

Resolution: invalid
