# Issue 22479: Faster Posets.SetPartitions()

archive/issues_022479.json:
```json
{
    "body": "CC:  tscrim\n\nI tried\n\n\n```\nn = 5\n\n%timeit\nL1 = Posets.SetPartitions(n)\n\n%timeit\nS = SetPartitions(n)\nL = []\nfor s in S:\n    L += [(s, b) for b in s.coarsenings()]\nL2 = LatticePoset( ([], L) )\n\nL1 == L2\n```\n\n\nand got\n\n\n```\nCPU time: 7.16 s,  Wall time: 7.16 s\nCPU time: 1.45 s,  Wall time: 1.45 s\nTrue\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/22716\n\n",
    "created_at": "2017-03-30T11:56:40Z",
    "labels": [
        "combinatorics",
        "minor",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "Faster Posets.SetPartitions()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22479",
    "user": "jmantysalo"
}
```
CC:  tscrim

I tried


```
n = 5

%timeit
L1 = Posets.SetPartitions(n)

%timeit
S = SetPartitions(n)
L = []
for s in S:
    L += [(s, b) for b in s.coarsenings()]
L2 = LatticePoset( ([], L) )

L1 == L2
```


and got


```
CPU time: 7.16 s,  Wall time: 7.16 s
CPU time: 1.45 s,  Wall time: 1.45 s
True
```


Issue created by migration from https://trac.sagemath.org/ticket/22716





---

archive/issue_comments_313272.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-03-30T17:19:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22479#issuecomment-313272",
    "user": "jmantysalo"
}
```

New commits:



---

archive/issue_comments_313273.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-03-30T17:19:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22479#issuecomment-313273",
    "user": "jmantysalo"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_313274.json:
```json
{
    "body": "Wouldn't it be better to explicitly build the cover relations by:\n\n```sage\nsage: def covers(x):\n....:     SP = x.parent()\n....:     for i,s in enumerate(x):\n....:         for j in range(i+1, len(x)):\n....:             L = list(x)\n....:             L[i] = s.union(x[j])\n....:             L.pop(j)\n....:             yield SP(L)\n....:             \nsage: list(covers(x))\n[{{1, 2, 5}, {3, 4}}, {{1, 3, 4}, {2, 5}}, {{1}, {2, 3, 4, 5}}]\n```\n\nThat way you can use the `cover_relations=True` arg to `LatticePoset`.",
    "created_at": "2017-03-30T17:53:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22479#issuecomment-313274",
    "user": "tscrim"
}
```

Wouldn't it be better to explicitly build the cover relations by:

```sage
sage: def covers(x):
....:     SP = x.parent()
....:     for i,s in enumerate(x):
....:         for j in range(i+1, len(x)):
....:             L = list(x)
....:             L[i] = s.union(x[j])
....:             L.pop(j)
....:             yield SP(L)
....:             
sage: list(covers(x))
[{{1, 2, 5}, {3, 4}}, {{1, 3, 4}, {2, 5}}, {{1}, {2, 3, 4, 5}}]
```

That way you can use the `cover_relations=True` arg to `LatticePoset`.



---

archive/issue_comments_313275.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-30T19:45:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22479#issuecomment-313275",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_313276.json:
```json
{
    "body": "Replying to [comment:3 tscrim]:\n\n> Wouldn't it be better to explicitly build the cover relations - -\n\nOf course, but I was too lazy for that. `:=)`. Thanks. After this\n\n\n```\nsage: timeit(\"L = Posets.SetPartitions(4)\")\n5 loops, best of 3: 66.7 ms per loop\nsage: timeit(\"L = Posets.SetPartitions(5)\")\n5 loops, best of 3: 304 ms per loop\n```\n",
    "created_at": "2017-03-30T19:48:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22479#issuecomment-313276",
    "user": "jmantysalo"
}
```

Replying to [comment:3 tscrim]:

> Wouldn't it be better to explicitly build the cover relations - -

Of course, but I was too lazy for that. `:=)`. Thanks. After this


```
sage: timeit("L = Posets.SetPartitions(4)")
5 loops, best of 3: 66.7 ms per loop
sage: timeit("L = Posets.SetPartitions(5)")
5 loops, best of 3: 304 ms per loop
```




---

archive/issue_comments_313277.json:
```json
{
    "body": "You could just do\n\n```\nL = LatticePoset({x: list(covers(x)) for x in S}, cover_relations=True)\n```\n\nas this avoids extra processing on the poset (specifically the call to `transitive_reduction_acyclic`) and the extra conversion call. You can also replace `SP` by `S` in the internal function (and delete `SP = x.parent()`).",
    "created_at": "2017-03-30T19:54:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22479#issuecomment-313277",
    "user": "tscrim"
}
```

You could just do

```
L = LatticePoset({x: list(covers(x)) for x in S}, cover_relations=True)
```

as this avoids extra processing on the poset (specifically the call to `transitive_reduction_acyclic`) and the extra conversion call. You can also replace `SP` by `S` in the internal function (and delete `SP = x.parent()`).



---

archive/issue_comments_313278.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-31T04:15:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22479#issuecomment-313278",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_313279.json:
```json
{
    "body": "As you wish. This does not make so big difference anymore:\n\n\n```\nsage: timeit(\"L = Posets.SetPartitions(4)\")\n5 loops, best of 3: 64 ms per loop\nsage: timeit(\"L = Posets.SetPartitions(5)\")\n5 loops, best of 3: 298 ms per loop\n```\n",
    "created_at": "2017-03-31T04:16:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22479#issuecomment-313279",
    "user": "jmantysalo"
}
```

As you wish. This does not make so big difference anymore:


```
sage: timeit("L = Posets.SetPartitions(4)")
5 loops, best of 3: 64 ms per loop
sage: timeit("L = Posets.SetPartitions(5)")
5 loops, best of 3: 298 ms per loop
```




---

archive/issue_comments_313280.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-03-31T14:19:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22479#issuecomment-313280",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_313281.json:
```json
{
    "body": "But it does help a little bit. Thanks.",
    "created_at": "2017-03-31T14:19:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22479#issuecomment-313281",
    "user": "tscrim"
}
```

But it does help a little bit. Thanks.



---

archive/issue_comments_313282.json:
```json
{
    "body": "FYI: I went through other simple examples on the poset catalog, and found no other slow examples; that is, all other posets and lattices of size at least 100 were created in less than a second in our server.",
    "created_at": "2017-04-01T05:36:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22479#issuecomment-313282",
    "user": "jmantysalo"
}
```

FYI: I went through other simple examples on the poset catalog, and found no other slow examples; that is, all other posets and lattices of size at least 100 were created in less than a second in our server.



---

archive/issue_comments_313283.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-04-05T19:37:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22479#issuecomment-313283",
    "user": "vbraun"
}
```

Resolution: fixed
