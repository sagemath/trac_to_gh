# Issue 29060: Special case is_unitary() for trivial RDF/CDF matrices

Issue created by migration from https://trac.sagemath.org/ticket/29297

Original creator: mjo

Original creation time: 2020-03-08 01:26:56

We have a doctest ensuring that `is_unitary()` crashes for trivial RDF/CDF matrices:


```
The smallest cases.  The Schur decomposition used by the
orthonormal algorithm will fail on a matrix of size zero.  ::

    sage: P = matrix(CDF, 0, 0,)
    sage: P.is_unitary(algorithm='orthonormal')
    Traceback (most recent call last):
    ...
    error: ((lwork==-1)||(lwork >= MAX(1,2*n))) failed for 3rd keyword lwork: zgees:lwork=0
```


Ignoring the value of such a test for the time being... it's failing for me due to some change in a library:


```
Failed example:
    P.is_unitary(algorithm='orthonormal')
Expected:
    Traceback (most recent call last):
    ...
    error: ((lwork==-1)||(lwork >= MAX(1,2*n))) failed for 3rd keyword lwork: zgees:lwork=0
Got:
    ...
    ValueError: On entry to ZGEES parameter number 6 had an illegal value
```


Rather than try to accommodate both error messages... let's just make it work.


---

Comment by mjo created at 2020-03-08 01:35:28

New commits:


---

Comment by mjo created at 2020-03-08 01:35:28

Changing status from new to needs_review.


---

Comment by @mwageringel created at 2020-03-08 12:20:25

I have also observed this issue when building Sage with ATLAS. Thanks for the fix.


---

Comment by @mwageringel created at 2020-03-08 12:20:25

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2020-03-11 23:46:07

Resolution: fixed
